function REe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Ny=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var w2={exports:{}},ww={},C2={exports:{}},Rr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LK;function IEe(){if(LK)return Rr;LK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),S=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function O(Ee){return Ee===null||typeof Ee!="object"?null:(Ee=I&&Ee[I]||Ee["@@iterator"],typeof Ee=="function"?Ee:null)}var M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,U={};function B(Ee,Ce,Pe){this.props=Ee,this.context=Ce,this.refs=U,this.updater=Pe||M}B.prototype.isReactComponent={},B.prototype.setState=function(Ee,Ce){if(typeof Ee!="object"&&typeof Ee!="function"&&Ee!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ee,Ce,"setState")},B.prototype.forceUpdate=function(Ee){this.updater.enqueueForceUpdate(this,Ee,"forceUpdate")};function J(){}J.prototype=B.prototype;function K(Ee,Ce,Pe){this.props=Ee,this.context=Ce,this.refs=U,this.updater=Pe||M}var ne=K.prototype=new J;ne.constructor=K,L(ne,B.prototype),ne.isPureReactComponent=!0;var oe=Array.isArray,se=Object.prototype.hasOwnProperty,le={current:null},Y={key:!0,ref:!0,__self:!0,__source:!0};function Z(Ee,Ce,Pe){var Me,We={},He=null,qe=null;if(Ce!=null)for(Me in Ce.ref!==void 0&&(qe=Ce.ref),Ce.key!==void 0&&(He=""+Ce.key),Ce)se.call(Ce,Me)&&!Y.hasOwnProperty(Me)&&(We[Me]=Ce[Me]);var rt=arguments.length-2;if(rt===1)We.children=Pe;else if(1<rt){for(var et=Array(rt),_t=0;_t<rt;_t++)et[_t]=arguments[_t+2];We.children=et}if(Ee&&Ee.defaultProps)for(Me in rt=Ee.defaultProps,rt)We[Me]===void 0&&(We[Me]=rt[Me]);return{$$typeof:n,type:Ee,key:He,ref:qe,props:We,_owner:le.current}}function X(Ee,Ce){return{$$typeof:n,type:Ee.type,key:Ce,ref:Ee.ref,props:Ee.props,_owner:Ee._owner}}function ie(Ee){return typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===n}function de(Ee){var Ce={"=":"=0",":":"=2"};return"$"+Ee.replace(/[=:]/g,function(Pe){return Ce[Pe]})}var ue=/\/+/g;function pe(Ee,Ce){return typeof Ee=="object"&&Ee!==null&&Ee.key!=null?de(""+Ee.key):Ce.toString(36)}function ke(Ee,Ce,Pe,Me,We){var He=typeof Ee;(He==="undefined"||He==="boolean")&&(Ee=null);var qe=!1;if(Ee===null)qe=!0;else switch(He){case"string":case"number":qe=!0;break;case"object":switch(Ee.$$typeof){case n:case e:qe=!0}}if(qe)return qe=Ee,We=We(qe),Ee=Me===""?"."+pe(qe,0):Me,oe(We)?(Pe="",Ee!=null&&(Pe=Ee.replace(ue,"$&/")+"/"),ke(We,Ce,Pe,"",function(_t){return _t})):We!=null&&(ie(We)&&(We=X(We,Pe+(!We.key||qe&&qe.key===We.key?"":(""+We.key).replace(ue,"$&/")+"/")+Ee)),Ce.push(We)),1;if(qe=0,Me=Me===""?".":Me+":",oe(Ee))for(var rt=0;rt<Ee.length;rt++){He=Ee[rt];var et=Me+pe(He,rt);qe+=ke(He,Ce,Pe,et,We)}else if(et=O(Ee),typeof et=="function")for(Ee=et.call(Ee),rt=0;!(He=Ee.next()).done;)He=He.value,et=Me+pe(He,rt++),qe+=ke(He,Ce,Pe,et,We);else if(He==="object")throw Ce=String(Ee),Error("Objects are not valid as a React child (found: "+(Ce==="[object Object]"?"object with keys {"+Object.keys(Ee).join(", ")+"}":Ce)+"). If you meant to render a collection of children, use an array instead.");return qe}function xe(Ee,Ce,Pe){if(Ee==null)return Ee;var Me=[],We=0;return ke(Ee,Me,"","",function(He){return Ce.call(Pe,He,We++)}),Me}function je(Ee){if(Ee._status===-1){var Ce=Ee._result;Ce=Ce(),Ce.then(function(Pe){(Ee._status===0||Ee._status===-1)&&(Ee._status=1,Ee._result=Pe)},function(Pe){(Ee._status===0||Ee._status===-1)&&(Ee._status=2,Ee._result=Pe)}),Ee._status===-1&&(Ee._status=0,Ee._result=Ce)}if(Ee._status===1)return Ee._result.default;throw Ee._result}var Oe={current:null},we={transition:null},Se={ReactCurrentDispatcher:Oe,ReactCurrentBatchConfig:we,ReactCurrentOwner:le};function Be(){throw Error("act(...) is not supported in production builds of React.")}return Rr.Children={map:xe,forEach:function(Ee,Ce,Pe){xe(Ee,function(){Ce.apply(this,arguments)},Pe)},count:function(Ee){var Ce=0;return xe(Ee,function(){Ce++}),Ce},toArray:function(Ee){return xe(Ee,function(Ce){return Ce})||[]},only:function(Ee){if(!ie(Ee))throw Error("React.Children.only expected to receive a single React element child.");return Ee}},Rr.Component=B,Rr.Fragment=i,Rr.Profiler=l,Rr.PureComponent=K,Rr.StrictMode=o,Rr.Suspense=E,Rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Se,Rr.act=Be,Rr.cloneElement=function(Ee,Ce,Pe){if(Ee==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ee+".");var Me=L({},Ee.props),We=Ee.key,He=Ee.ref,qe=Ee._owner;if(Ce!=null){if(Ce.ref!==void 0&&(He=Ce.ref,qe=le.current),Ce.key!==void 0&&(We=""+Ce.key),Ee.type&&Ee.type.defaultProps)var rt=Ee.type.defaultProps;for(et in Ce)se.call(Ce,et)&&!Y.hasOwnProperty(et)&&(Me[et]=Ce[et]===void 0&&rt!==void 0?rt[et]:Ce[et])}var et=arguments.length-2;if(et===1)Me.children=Pe;else if(1<et){rt=Array(et);for(var _t=0;_t<et;_t++)rt[_t]=arguments[_t+2];Me.children=rt}return{$$typeof:n,type:Ee.type,key:We,ref:He,props:Me,_owner:qe}},Rr.createContext=function(Ee){return Ee={$$typeof:f,_currentValue:Ee,_currentValue2:Ee,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ee.Provider={$$typeof:u,_context:Ee},Ee.Consumer=Ee},Rr.createElement=Z,Rr.createFactory=function(Ee){var Ce=Z.bind(null,Ee);return Ce.type=Ee,Ce},Rr.createRef=function(){return{current:null}},Rr.forwardRef=function(Ee){return{$$typeof:_,render:Ee}},Rr.isValidElement=ie,Rr.lazy=function(Ee){return{$$typeof:C,_payload:{_status:-1,_result:Ee},_init:je}},Rr.memo=function(Ee,Ce){return{$$typeof:S,type:Ee,compare:Ce===void 0?null:Ce}},Rr.startTransition=function(Ee){var Ce=we.transition;we.transition={};try{Ee()}finally{we.transition=Ce}},Rr.unstable_act=Be,Rr.useCallback=function(Ee,Ce){return Oe.current.useCallback(Ee,Ce)},Rr.useContext=function(Ee){return Oe.current.useContext(Ee)},Rr.useDebugValue=function(){},Rr.useDeferredValue=function(Ee){return Oe.current.useDeferredValue(Ee)},Rr.useEffect=function(Ee,Ce){return Oe.current.useEffect(Ee,Ce)},Rr.useId=function(){return Oe.current.useId()},Rr.useImperativeHandle=function(Ee,Ce,Pe){return Oe.current.useImperativeHandle(Ee,Ce,Pe)},Rr.useInsertionEffect=function(Ee,Ce){return Oe.current.useInsertionEffect(Ee,Ce)},Rr.useLayoutEffect=function(Ee,Ce){return Oe.current.useLayoutEffect(Ee,Ce)},Rr.useMemo=function(Ee,Ce){return Oe.current.useMemo(Ee,Ce)},Rr.useReducer=function(Ee,Ce,Pe){return Oe.current.useReducer(Ee,Ce,Pe)},Rr.useRef=function(Ee){return Oe.current.useRef(Ee)},Rr.useState=function(Ee){return Oe.current.useState(Ee)},Rr.useSyncExternalStore=function(Ee,Ce,Pe){return Oe.current.useSyncExternalStore(Ee,Ce,Pe)},Rr.useTransition=function(){return Oe.current.useTransition()},Rr.version="18.3.1",Rr}var MK;function cd(){return MK||(MK=1,C2.exports=IEe()),C2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UK;function AEe(){if(UK)return ww;UK=1;var n=cd(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function f(_,E,S){var C,I={},O=null,M=null;S!==void 0&&(O=""+S),E.key!==void 0&&(O=""+E.key),E.ref!==void 0&&(M=E.ref);for(C in E)o.call(E,C)&&!u.hasOwnProperty(C)&&(I[C]=E[C]);if(_&&_.defaultProps)for(C in E=_.defaultProps,E)I[C]===void 0&&(I[C]=E[C]);return{$$typeof:e,type:_,key:O,ref:M,props:I,_owner:l.current}}return ww.Fragment=i,ww.jsx=f,ww.jsxs=f,ww}var VK;function PEe(){return VK||(VK=1,w2.exports=AEe()),w2.exports}var b=PEe(),k=cd();const _i=Xg(k),jK=REe({__proto__:null,default:_i},[k]);var IO={},R2={exports:{}},ml={},I2={exports:{}},A2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FK;function OEe(){return FK||(FK=1,function(n){function e(we,Se){var Be=we.length;we.push(Se);e:for(;0<Be;){var Ee=Be-1>>>1,Ce=we[Ee];if(0<l(Ce,Se))we[Ee]=Se,we[Be]=Ce,Be=Ee;else break e}}function i(we){return we.length===0?null:we[0]}function o(we){if(we.length===0)return null;var Se=we[0],Be=we.pop();if(Be!==Se){we[0]=Be;e:for(var Ee=0,Ce=we.length,Pe=Ce>>>1;Ee<Pe;){var Me=2*(Ee+1)-1,We=we[Me],He=Me+1,qe=we[He];if(0>l(We,Be))He<Ce&&0>l(qe,We)?(we[Ee]=qe,we[He]=Be,Ee=He):(we[Ee]=We,we[Me]=Be,Ee=Me);else if(He<Ce&&0>l(qe,Be))we[Ee]=qe,we[He]=Be,Ee=He;else break e}}return Se}function l(we,Se){var Be=we.sortIndex-Se.sortIndex;return Be!==0?Be:we.id-Se.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,_=f.now();n.unstable_now=function(){return f.now()-_}}var E=[],S=[],C=1,I=null,O=3,M=!1,L=!1,U=!1,B=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(we){for(var Se=i(S);Se!==null;){if(Se.callback===null)o(S);else if(Se.startTime<=we)o(S),Se.sortIndex=Se.expirationTime,e(E,Se);else break;Se=i(S)}}function oe(we){if(U=!1,ne(we),!L)if(i(E)!==null)L=!0,je(se);else{var Se=i(S);Se!==null&&Oe(oe,Se.startTime-we)}}function se(we,Se){L=!1,U&&(U=!1,J(Z),Z=-1),M=!0;var Be=O;try{for(ne(Se),I=i(E);I!==null&&(!(I.expirationTime>Se)||we&&!de());){var Ee=I.callback;if(typeof Ee=="function"){I.callback=null,O=I.priorityLevel;var Ce=Ee(I.expirationTime<=Se);Se=n.unstable_now(),typeof Ce=="function"?I.callback=Ce:I===i(E)&&o(E),ne(Se)}else o(E);I=i(E)}if(I!==null)var Pe=!0;else{var Me=i(S);Me!==null&&Oe(oe,Me.startTime-Se),Pe=!1}return Pe}finally{I=null,O=Be,M=!1}}var le=!1,Y=null,Z=-1,X=5,ie=-1;function de(){return!(n.unstable_now()-ie<X)}function ue(){if(Y!==null){var we=n.unstable_now();ie=we;var Se=!0;try{Se=Y(!0,we)}finally{Se?pe():(le=!1,Y=null)}}else le=!1}var pe;if(typeof K=="function")pe=function(){K(ue)};else if(typeof MessageChannel<"u"){var ke=new MessageChannel,xe=ke.port2;ke.port1.onmessage=ue,pe=function(){xe.postMessage(null)}}else pe=function(){B(ue,0)};function je(we){Y=we,le||(le=!0,pe())}function Oe(we,Se){Z=B(function(){we(n.unstable_now())},Se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(we){we.callback=null},n.unstable_continueExecution=function(){L||M||(L=!0,je(se))},n.unstable_forceFrameRate=function(we){0>we||125<we?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<we?Math.floor(1e3/we):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(we){switch(O){case 1:case 2:case 3:var Se=3;break;default:Se=O}var Be=O;O=Se;try{return we()}finally{O=Be}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(we,Se){switch(we){case 1:case 2:case 3:case 4:case 5:break;default:we=3}var Be=O;O=we;try{return Se()}finally{O=Be}},n.unstable_scheduleCallback=function(we,Se,Be){var Ee=n.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?Ee+Be:Ee):Be=Ee,we){case 1:var Ce=-1;break;case 2:Ce=250;break;case 5:Ce=1073741823;break;case 4:Ce=1e4;break;default:Ce=5e3}return Ce=Be+Ce,we={id:C++,callback:Se,priorityLevel:we,startTime:Be,expirationTime:Ce,sortIndex:-1},Be>Ee?(we.sortIndex=Be,e(S,we),i(E)===null&&we===i(S)&&(U?(J(Z),Z=-1):U=!0,Oe(oe,Be-Ee))):(we.sortIndex=Ce,e(E,we),L||M||(L=!0,je(se))),we},n.unstable_shouldYield=de,n.unstable_wrapCallback=function(we){var Se=O;return function(){var Be=O;O=Se;try{return we.apply(this,arguments)}finally{O=Be}}}}(A2)),A2}var BK;function kEe(){return BK||(BK=1,I2.exports=OEe()),I2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WK;function NEe(){if(WK)return ml;WK=1;var n=cd(),e=kEe();function i(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,w=1;w<arguments.length;w++)g+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function u(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)o.add(g[p])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,S=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function O(p){return E.call(I,p)?!0:E.call(C,p)?!1:S.test(p)?I[p]=!0:(C[p]=!0,!1)}function M(p,g,w,N){if(w!==null&&w.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return N?!1:w!==null?!w.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function L(p,g,w,N){if(g===null||typeof g>"u"||M(p,g,w,N))return!0;if(N)return!1;if(w!==null)switch(w.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function U(p,g,w,N,j,H,he){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=N,this.attributeNamespace=j,this.mustUseProperty=w,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=he}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new U(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];B[g]=new U(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new U(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new U(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new U(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new U(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new U(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new U(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new U(p,5,!1,p.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(J,K);B[g]=new U(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(J,K);B[g]=new U(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(J,K);B[g]=new U(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new U(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new U("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new U(p,1,!1,p.toLowerCase(),null,!0,!0)});function ne(p,g,w,N){var j=B.hasOwnProperty(g)?B[g]:null;(j!==null?j.type!==0:N||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(L(g,w,j,N)&&(w=null),N||j===null?O(g)&&(w===null?p.removeAttribute(g):p.setAttribute(g,""+w)):j.mustUseProperty?p[j.propertyName]=w===null?j.type===3?!1:"":w:(g=j.attributeName,N=j.attributeNamespace,w===null?p.removeAttribute(g):(j=j.type,w=j===3||j===4&&w===!0?"":""+w,N?p.setAttributeNS(N,g,w):p.setAttribute(g,w))))}var oe=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),le=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),de=Symbol.for("react.context"),ue=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),xe=Symbol.for("react.memo"),je=Symbol.for("react.lazy"),Oe=Symbol.for("react.offscreen"),we=Symbol.iterator;function Se(p){return p===null||typeof p!="object"?null:(p=we&&p[we]||p["@@iterator"],typeof p=="function"?p:null)}var Be=Object.assign,Ee;function Ce(p){if(Ee===void 0)try{throw Error()}catch(w){var g=w.stack.trim().match(/\n( *(at )?)/);Ee=g&&g[1]||""}return`
`+Ee+p}var Pe=!1;function Me(p,g){if(!p||Pe)return"";Pe=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(st){var N=st}Reflect.construct(p,[],g)}else{try{g.call()}catch(st){N=st}p.call(g.prototype)}else{try{throw Error()}catch(st){N=st}p()}}catch(st){if(st&&N&&typeof st.stack=="string"){for(var j=st.stack.split(`
`),H=N.stack.split(`
`),he=j.length-1,Re=H.length-1;1<=he&&0<=Re&&j[he]!==H[Re];)Re--;for(;1<=he&&0<=Re;he--,Re--)if(j[he]!==H[Re]){if(he!==1||Re!==1)do if(he--,Re--,0>Re||j[he]!==H[Re]){var Ue=`
`+j[he].replace(" at new "," at ");return p.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",p.displayName)),Ue}while(1<=he&&0<=Re);break}}}finally{Pe=!1,Error.prepareStackTrace=w}return(p=p?p.displayName||p.name:"")?Ce(p):""}function We(p){switch(p.tag){case 5:return Ce(p.type);case 16:return Ce("Lazy");case 13:return Ce("Suspense");case 19:return Ce("SuspenseList");case 0:case 2:case 15:return p=Me(p.type,!1),p;case 11:return p=Me(p.type.render,!1),p;case 1:return p=Me(p.type,!0),p;default:return""}}function He(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Y:return"Fragment";case le:return"Portal";case X:return"Profiler";case Z:return"StrictMode";case pe:return"Suspense";case ke:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case de:return(p.displayName||"Context")+".Consumer";case ie:return(p._context.displayName||"Context")+".Provider";case ue:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case xe:return g=p.displayName||null,g!==null?g:He(p.type)||"Memo";case je:g=p._payload,p=p._init;try{return He(p(g))}catch{}}return null}function qe(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return He(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function rt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function et(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function _t(p){var g=et(p)?"checked":"value",w=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),N=""+p[g];if(!p.hasOwnProperty(g)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var j=w.get,H=w.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return j.call(this)},set:function(he){N=""+he,H.call(this,he)}}),Object.defineProperty(p,g,{enumerable:w.enumerable}),{getValue:function(){return N},setValue:function(he){N=""+he},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function on(p){p._valueTracker||(p._valueTracker=_t(p))}function dt(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var w=g.getValue(),N="";return p&&(N=et(p)?p.checked?"true":"false":p.value),p=N,p!==w?(g.setValue(p),!0):!1}function kt(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function ct(p,g){var w=g.checked;return Be({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??p._wrapperState.initialChecked})}function Ut(p,g){var w=g.defaultValue==null?"":g.defaultValue,N=g.checked!=null?g.checked:g.defaultChecked;w=rt(g.value!=null?g.value:w),p._wrapperState={initialChecked:N,initialValue:w,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function fn(p,g){g=g.checked,g!=null&&ne(p,"checked",g,!1)}function Wt(p,g){fn(p,g);var w=rt(g.value),N=g.type;if(w!=null)N==="number"?(w===0&&p.value===""||p.value!=w)&&(p.value=""+w):p.value!==""+w&&(p.value=""+w);else if(N==="submit"||N==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Ve(p,g.type,w):g.hasOwnProperty("defaultValue")&&Ve(p,g.type,rt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Te(p,g,w){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var N=g.type;if(!(N!=="submit"&&N!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,w||g===p.value||(p.value=g),p.defaultValue=g}w=p.name,w!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,w!==""&&(p.name=w)}function Ve(p,g,w){(g!=="number"||kt(p.ownerDocument)!==p)&&(w==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+w&&(p.defaultValue=""+w))}var $e=Array.isArray;function Et(p,g,w,N){if(p=p.options,g){g={};for(var j=0;j<w.length;j++)g["$"+w[j]]=!0;for(w=0;w<p.length;w++)j=g.hasOwnProperty("$"+p[w].value),p[w].selected!==j&&(p[w].selected=j),j&&N&&(p[w].defaultSelected=!0)}else{for(w=""+rt(w),g=null,j=0;j<p.length;j++){if(p[j].value===w){p[j].selected=!0,N&&(p[j].defaultSelected=!0);return}g!==null||p[j].disabled||(g=p[j])}g!==null&&(g.selected=!0)}}function vt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return Be({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function St(p,g){var w=g.value;if(w==null){if(w=g.children,g=g.defaultValue,w!=null){if(g!=null)throw Error(i(92));if($e(w)){if(1<w.length)throw Error(i(93));w=w[0]}g=w}g==null&&(g=""),w=g}p._wrapperState={initialValue:rt(w)}}function zt(p,g){var w=rt(g.value),N=rt(g.defaultValue);w!=null&&(w=""+w,w!==p.value&&(p.value=w),g.defaultValue==null&&p.defaultValue!==w&&(p.defaultValue=w)),N!=null&&(p.defaultValue=""+N)}function dn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function vn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nn(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?vn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Ct,sr=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,w,N,j){MSApp.execUnsafeLocalFunction(function(){return p(g,w,N,j)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Ct=Ct||document.createElement("div"),Ct.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Ct.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function xt(p,g){if(g){var w=p.firstChild;if(w&&w===p.lastChild&&w.nodeType===3){w.nodeValue=g;return}}p.textContent=g}var qt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Tr=["Webkit","ms","Moz","O"];Object.keys(qt).forEach(function(p){Tr.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),qt[g]=qt[p]})});function Pi(p,g,w){return g==null||typeof g=="boolean"||g===""?"":w||typeof g!="number"||g===0||qt.hasOwnProperty(p)&&qt[p]?(""+g).trim():g+"px"}function As(p,g){p=p.style;for(var w in g)if(g.hasOwnProperty(w)){var N=w.indexOf("--")===0,j=Pi(w,g[w],N);w==="float"&&(w="cssFloat"),N?p.setProperty(w,j):p[w]=j}}var cr=Be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zn(p,g){if(g){if(cr[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function ia(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ks=null;function ao(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var jc=null,Ps=null,Va=null;function Fo(p){if(p=Rm(p)){if(typeof jc!="function")throw Error(i(280));var g=p.stateNode;g&&(g=Im(g),jc(p.stateNode,p.type,g))}}function ja(p){Ps?Va?Va.push(p):Va=[p]:Ps=p}function fc(){if(Ps){var p=Ps,g=Va;if(Va=Ps=null,Fo(p),g)for(p=0;p<g.length;p++)Fo(g[p])}}function Ol(p,g){return p(g)}function Fa(){}var mc=!1;function _o(p,g,w){if(mc)return p(g,w);mc=!0;try{return Ol(p,g,w)}finally{mc=!1,(Ps!==null||Va!==null)&&(Fa(),fc())}}function ji(p,g){var w=p.stateNode;if(w===null)return null;var N=Im(w);if(N===null)return null;w=N[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(p=p.type,N=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!N;break e;default:p=!1}if(p)return null;if(w&&typeof w!="function")throw Error(i(231,g,typeof w));return w}var ds=!1;if(_)try{var sa={};Object.defineProperty(sa,"passive",{get:function(){ds=!0}}),window.addEventListener("test",sa,sa),window.removeEventListener("test",sa,sa)}catch{ds=!1}function kl(p,g,w,N,j,H,he,Re,Ue){var st=Array.prototype.slice.call(arguments,3);try{g.apply(w,st)}catch(Dt){this.onError(Dt)}}var Ba=!1,Bo=null,mt=!1,hn=null,Or={onError:function(p){Ba=!0,Bo=p}};function Oi(p,g,w,N,j,H,he,Re,Ue){Ba=!1,Bo=null,kl.apply(Or,arguments)}function Nl(p,g,w,N,j,H,he,Re,Ue){if(Oi.apply(this,arguments),Ba){if(Ba){var st=Bo;Ba=!1,Bo=null}else throw Error(i(198));mt||(mt=!0,hn=st)}}function Xi(p){var g=p,w=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(w=g.return),p=g.return;while(p)}return g.tag===3?w:null}function Dl(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function Wo(p){if(Xi(p)!==p)throw Error(i(188))}function pu(p){var g=p.alternate;if(!g){if(g=Xi(p),g===null)throw Error(i(188));return g!==p?null:p}for(var w=p,N=g;;){var j=w.return;if(j===null)break;var H=j.alternate;if(H===null){if(N=j.return,N!==null){w=N;continue}break}if(j.child===H.child){for(H=j.child;H;){if(H===w)return Wo(j),p;if(H===N)return Wo(j),g;H=H.sibling}throw Error(i(188))}if(w.return!==N.return)w=j,N=H;else{for(var he=!1,Re=j.child;Re;){if(Re===w){he=!0,w=j,N=H;break}if(Re===N){he=!0,N=j,w=H;break}Re=Re.sibling}if(!he){for(Re=H.child;Re;){if(Re===w){he=!0,w=H,N=j;break}if(Re===N){he=!0,N=H,w=j;break}Re=Re.sibling}if(!he)throw Error(i(189))}}if(w.alternate!==N)throw Error(i(190))}if(w.tag!==3)throw Error(i(188));return w.stateNode.current===w?p:g}function xl(p){return p=pu(p),p!==null?oa(p):null}function oa(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=oa(p);if(g!==null)return g;p=p.sibling}return null}var fu=e.unstable_scheduleCallback,gc=e.unstable_cancelCallback,Fi=e.unstable_shouldYield,hs=e.unstable_requestPaint,Sn=e.unstable_now,ki=e.unstable_getCurrentPriorityLevel,Fc=e.unstable_ImmediatePriority,Ll=e.unstable_UserBlockingPriority,Wa=e.unstable_NormalPriority,Np=e.unstable_LowPriority,hh=e.unstable_IdlePriority,mu=null,zo=null;function dm(p){if(zo&&typeof zo.onCommitFiberRoot=="function")try{zo.onCommitFiberRoot(mu,p,void 0,(p.current.flags&128)===128)}catch{}}var yo=Math.clz32?Math.clz32:ph,Dp=Math.log,Ml=Math.LN2;function ph(p){return p>>>=0,p===0?32:31-(Dp(p)/Ml|0)|0}var fh=64,wr=4194304;function gu(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function _u(p,g){var w=p.pendingLanes;if(w===0)return 0;var N=0,j=p.suspendedLanes,H=p.pingedLanes,he=w&268435455;if(he!==0){var Re=he&~j;Re!==0?N=gu(Re):(H&=he,H!==0&&(N=gu(H)))}else he=w&~j,he!==0?N=gu(he):H!==0&&(N=gu(H));if(N===0)return 0;if(g!==0&&g!==N&&(g&j)===0&&(j=N&-N,H=g&-g,j>=H||j===16&&(H&4194240)!==0))return g;if((N&4)!==0&&(N|=w&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=N;0<g;)w=31-yo(g),j=1<<w,N|=p[w],g&=~j;return N}function pd(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _c(p,g){for(var w=p.suspendedLanes,N=p.pingedLanes,j=p.expirationTimes,H=p.pendingLanes;0<H;){var he=31-yo(H),Re=1<<he,Ue=j[he];Ue===-1?((Re&w)===0||(Re&N)!==0)&&(j[he]=pd(Re,g)):Ue<=g&&(p.expiredLanes|=Re),H&=~Re}}function aa(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function fd(){var p=fh;return fh<<=1,(fh&4194240)===0&&(fh=64),p}function Ul(p){for(var g=[],w=0;31>w;w++)g.push(p);return g}function yu(p,g,w){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-yo(g),p[g]=w}function ri(p,g){var w=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var N=p.eventTimes;for(p=p.expirationTimes;0<w;){var j=31-yo(w),H=1<<j;g[j]=0,N[j]=-1,p[j]=-1,w&=~H}}function yc(p,g){var w=p.entangledLanes|=g;for(p=p.entanglements;w;){var N=31-yo(w),j=1<<N;j&g|p[N]&g&&(p[N]|=g),w&=~j}}var pr=0;function Bc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var hm,Eu,mh,xp,pm,Lp=!1,ca=[],vs=null,la=null,ua=null,vu=new Map,da=new Map,ha=[],fm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Wc(p,g){switch(p){case"focusin":case"focusout":vs=null;break;case"dragenter":case"dragleave":la=null;break;case"mouseover":case"mouseout":ua=null;break;case"pointerover":case"pointerout":vu.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":da.delete(g.pointerId)}}function Os(p,g,w,N,j,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:w,eventSystemFlags:N,nativeEvent:H,targetContainers:[j]},g!==null&&(g=Rm(g),g!==null&&Eu(g)),p):(p.eventSystemFlags|=N,g=p.targetContainers,j!==null&&g.indexOf(j)===-1&&g.push(j),p)}function md(p,g,w,N,j){switch(g){case"focusin":return vs=Os(vs,p,g,w,N,j),!0;case"dragenter":return la=Os(la,p,g,w,N,j),!0;case"mouseover":return ua=Os(ua,p,g,w,N,j),!0;case"pointerover":var H=j.pointerId;return vu.set(H,Os(vu.get(H)||null,p,g,w,N,j)),!0;case"gotpointercapture":return H=j.pointerId,da.set(H,Os(da.get(H)||null,p,g,w,N,j)),!0}return!1}function Mp(p){var g=Gp(p.target);if(g!==null){var w=Xi(g);if(w!==null){if(g=w.tag,g===13){if(g=Dl(w),g!==null){p.blockedOn=g,pm(p.priority,function(){mh(w)});return}}else if(g===3&&w.stateNode.current.memoizedState.isDehydrated){p.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Vl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var w=kr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(w===null){w=p.nativeEvent;var N=new w.constructor(w.type,w);Ks=N,w.target.dispatchEvent(N),Ks=null}else return g=Rm(w),g!==null&&Eu(g),p.blockedOn=w,!1;g.shift()}return!0}function Su(p,g,w){Vl(p)&&w.delete(g)}function mm(){Lp=!1,vs!==null&&Vl(vs)&&(vs=null),la!==null&&Vl(la)&&(la=null),ua!==null&&Vl(ua)&&(ua=null),vu.forEach(Su),da.forEach(Su)}function za(p,g){p.blockedOn===g&&(p.blockedOn=null,Lp||(Lp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,mm)))}function Ga(p){function g(j){return za(j,p)}if(0<ca.length){za(ca[0],p);for(var w=1;w<ca.length;w++){var N=ca[w];N.blockedOn===p&&(N.blockedOn=null)}}for(vs!==null&&za(vs,p),la!==null&&za(la,p),ua!==null&&za(ua,p),vu.forEach(g),da.forEach(g),w=0;w<ha.length;w++)N=ha[w],N.blockedOn===p&&(N.blockedOn=null);for(;0<ha.length&&(w=ha[0],w.blockedOn===null);)Mp(w),w.blockedOn===null&&ha.shift()}var jl=oe.ReactCurrentBatchConfig,be=!0;function De(p,g,w,N){var j=pr,H=jl.transition;jl.transition=null;try{pr=1,en(p,g,w,N)}finally{pr=j,jl.transition=H}}function it(p,g,w,N){var j=pr,H=jl.transition;jl.transition=null;try{pr=4,en(p,g,w,N)}finally{pr=j,jl.transition=H}}function en(p,g,w,N){if(be){var j=kr(p,g,w,N);if(j===null)wE(p,g,N,tr,w),Wc(p,N);else if(md(j,p,g,w,N))N.stopPropagation();else if(Wc(p,N),g&4&&-1<fm.indexOf(p)){for(;j!==null;){var H=Rm(j);if(H!==null&&hm(H),H=kr(p,g,w,N),H===null&&wE(p,g,N,tr,w),H===j)break;j=H}j!==null&&N.stopPropagation()}else wE(p,g,N,null,w)}}var tr=null;function kr(p,g,w,N){if(tr=null,p=ao(N),p=Gp(p),p!==null)if(g=Xi(p),g===null)p=null;else if(w=g.tag,w===13){if(p=Dl(g),p!==null)return p;p=null}else if(w===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return tr=p,null}function Zr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ki()){case Fc:return 1;case Ll:return 4;case Wa:case Np:return 16;case hh:return 536870912;default:return 16}default:return 16}}var _n=null,Kr=null,Ni=null;function qs(){if(Ni)return Ni;var p,g=Kr,w=g.length,N,j="value"in _n?_n.value:_n.textContent,H=j.length;for(p=0;p<w&&g[p]===j[p];p++);var he=w-p;for(N=1;N<=he&&g[w-N]===j[H-N];N++);return Ni=j.slice(p,1<N?1-N:void 0)}function pa(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function fa(){return!0}function gd(){return!1}function ps(p){function g(w,N,j,H,he){this._reactName=w,this._targetInst=j,this.type=N,this.nativeEvent=H,this.target=he,this.currentTarget=null;for(var Re in p)p.hasOwnProperty(Re)&&(w=p[Re],this[Re]=w?w(H):H[Re]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?fa:gd,this.isPropagationStopped=gd,this}return Be(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=fa)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=fa)},persist:function(){},isPersistent:fa}),g}var Fl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gh=ps(Fl),zc=Be({},Fl,{view:0,detail:0}),r_=ps(zc),gm,_d,ma,bu=Be({},zc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==ma&&(ma&&p.type==="mousemove"?(gm=p.screenX-ma.screenX,_d=p.screenY-ma.screenY):_d=gm=0,ma=p),gm)},movementY:function(p){return"movementY"in p?p.movementY:_d}}),_m=ps(bu),i_=Be({},bu,{dataTransfer:0}),gE=ps(i_),ym=Be({},zc,{relatedTarget:0}),Em=ps(ym),yd=Be({},Fl,{animationName:0,elapsedTime:0,pseudoElement:0}),Ed=ps(yd),vd=Be({},Fl,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),s_=ps(vd),_E=Be({},Fl,{data:0}),$n=ps(_E),vm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ga={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function EE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=yE[p])?!!g[p]:!1}function Gc(){return EE}var A=Be({},zc,{key:function(p){if(p.key){var g=vm[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=pa(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?ga[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gc,charCode:function(p){return p.type==="keypress"?pa(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?pa(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),z=ps(A),re=Be({},bu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=ps(re),Xe=Be({},zc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gc}),ut=ps(Xe),Gt=Be({},Fl,{propertyName:0,elapsedTime:0,pseudoElement:0}),ii=ps(Gt),Ei=Be({},bu,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Nr=ps(Ei),co=[9,13,27,32],ks=_&&"CompositionEvent"in window,Ec=null;_&&"documentMode"in document&&(Ec=document.documentMode);var _a=_&&"TextEvent"in window&&!Ec,Up=_&&(!ks||Ec&&8<Ec&&11>=Ec),Sm=" ",vc=!1;function WR(p,g){switch(p){case"keyup":return co.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var bm=!1;function Z1(p,g){switch(p){case"compositionend":return zR(g);case"keypress":return g.which!==32?null:(vc=!0,Sm);case"textInput":return p=g.data,p===Sm&&vc?null:p;default:return null}}function GR(p,g){if(bm)return p==="compositionend"||!ks&&WR(p,g)?(p=qs(),Ni=Kr=_n=null,bm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Up&&g.locale!=="ko"?null:g.data;default:return null}}var eD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function HR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!eD[p.type]:g==="textarea"}function cb(p,g,w,N){ja(N),g=CE(g,"onChange"),0<g.length&&(w=new gh("onChange","change",null,w,N),p.push({event:w,listeners:g}))}var Vp=null,o_=null;function tD(p){mb(p,0)}function jp(p){var g=Hp(p);if(dt(g))return p}function nD(p,g){if(p==="change")return g}var $R=!1;if(_){var lb;if(_){var Hc="oninput"in document;if(!Hc){var KR=document.createElement("div");KR.setAttribute("oninput","return;"),Hc=typeof KR.oninput=="function"}lb=Hc}else lb=!1;$R=lb&&(!document.documentMode||9<document.documentMode)}function qR(){Vp&&(Vp.detachEvent("onpropertychange",Ha),o_=Vp=null)}function Ha(p){if(p.propertyName==="value"&&jp(o_)){var g=[];cb(g,o_,p,ao(p)),_o(tD,g)}}function rD(p,g,w){p==="focusin"?(qR(),Vp=g,o_=w,Vp.attachEvent("onpropertychange",Ha)):p==="focusout"&&qR()}function iD(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return jp(o_)}function sD(p,g){if(p==="click")return jp(g)}function oD(p,g){if(p==="input"||p==="change")return jp(g)}function YR(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var Bl=typeof Object.is=="function"?Object.is:YR;function a_(p,g){if(Bl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var w=Object.keys(p),N=Object.keys(g);if(w.length!==N.length)return!1;for(N=0;N<w.length;N++){var j=w[N];if(!E.call(g,j)||!Bl(p[j],g[j]))return!1}return!0}function XR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function ub(p,g){var w=XR(p);p=0;for(var N;w;){if(w.nodeType===3){if(N=p+w.textContent.length,p<=g&&N>=g)return{node:w,offset:g-p};p=N}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=XR(w)}}function JR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?JR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function QR(){for(var p=window,g=kt();g instanceof p.HTMLIFrameElement;){try{var w=typeof g.contentWindow.location.href=="string"}catch{w=!1}if(w)p=g.contentWindow;else break;g=kt(p.document)}return g}function c_(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function db(p){var g=QR(),w=p.focusedElem,N=p.selectionRange;if(g!==w&&w&&w.ownerDocument&&JR(w.ownerDocument.documentElement,w)){if(N!==null&&c_(w)){if(g=N.start,p=N.end,p===void 0&&(p=g),"selectionStart"in w)w.selectionStart=g,w.selectionEnd=Math.min(p,w.value.length);else if(p=(g=w.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var j=w.textContent.length,H=Math.min(N.start,j);N=N.end===void 0?H:Math.min(N.end,j),!p.extend&&H>N&&(j=N,N=H,H=j),j=ub(w,H);var he=ub(w,N);j&&he&&(p.rangeCount!==1||p.anchorNode!==j.node||p.anchorOffset!==j.offset||p.focusNode!==he.node||p.focusOffset!==he.offset)&&(g=g.createRange(),g.setStart(j.node,j.offset),p.removeAllRanges(),H>N?(p.addRange(g),p.extend(he.node,he.offset)):(g.setEnd(he.node,he.offset),p.addRange(g)))}}for(g=[],p=w;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<g.length;w++)p=g[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var aD=_&&"documentMode"in document&&11>=document.documentMode,at=null,hb=null,l_=null,pb=!1;function ZR(p,g,w){var N=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;pb||at==null||at!==kt(N)||(N=at,"selectionStart"in N&&c_(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),l_&&a_(l_,N)||(l_=N,N=CE(hb,"onSelect"),0<N.length&&(g=new gh("onSelect","select",null,g,w),p.push({event:g,listeners:N}),g.target=at)))}function vE(p,g){var w={};return w[p.toLowerCase()]=g.toLowerCase(),w["Webkit"+p]="webkit"+g,w["Moz"+p]="moz"+g,w}var Tm={animationend:vE("Animation","AnimationEnd"),animationiteration:vE("Animation","AnimationIteration"),animationstart:vE("Animation","AnimationStart"),transitionend:vE("Transition","TransitionEnd")},fb={},eI={};_&&(eI=document.createElement("div").style,"AnimationEvent"in window||(delete Tm.animationend.animation,delete Tm.animationiteration.animation,delete Tm.animationstart.animation),"TransitionEvent"in window||delete Tm.transitionend.transition);function Fp(p){if(fb[p])return fb[p];if(!Tm[p])return p;var g=Tm[p],w;for(w in g)if(g.hasOwnProperty(w)&&w in eI)return fb[p]=g[w];return p}var Bp=Fp("animationend"),tI=Fp("animationiteration"),nI=Fp("animationstart"),rI=Fp("transitionend"),iI=new Map,SE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _h(p,g){iI.set(p,g),u(g,[p])}for(var bE=0;bE<SE.length;bE++){var Sc=SE[bE],cD=Sc.toLowerCase(),u_=Sc[0].toUpperCase()+Sc.slice(1);_h(cD,"on"+u_)}_h(Bp,"onAnimationEnd"),_h(tI,"onAnimationIteration"),_h(nI,"onAnimationStart"),_h("dblclick","onDoubleClick"),_h("focusin","onFocus"),_h("focusout","onBlur"),_h(rI,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var d_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lD=new Set("cancel close invalid load scroll toggle".split(" ").concat(d_));function sI(p,g,w){var N=p.type||"unknown-event";p.currentTarget=w,Nl(N,g,void 0,p),p.currentTarget=null}function mb(p,g){g=(g&4)!==0;for(var w=0;w<p.length;w++){var N=p[w],j=N.event;N=N.listeners;e:{var H=void 0;if(g)for(var he=N.length-1;0<=he;he--){var Re=N[he],Ue=Re.instance,st=Re.currentTarget;if(Re=Re.listener,Ue!==H&&j.isPropagationStopped())break e;sI(j,Re,st),H=Ue}else for(he=0;he<N.length;he++){if(Re=N[he],Ue=Re.instance,st=Re.currentTarget,Re=Re.listener,Ue!==H&&j.isPropagationStopped())break e;sI(j,Re,st),H=Ue}}}if(mt)throw p=hn,mt=!1,hn=null,p}function Bi(p,g){var w=g[m_];w===void 0&&(w=g[m_]=new Set);var N=p+"__bubble";w.has(N)||(oI(g,p,2,!1),w.add(N))}function gb(p,g,w){var N=0;g&&(N|=4),oI(w,p,N,g)}var TE="_reactListening"+Math.random().toString(36).slice(2);function Wp(p){if(!p[TE]){p[TE]=!0,o.forEach(function(w){w!=="selectionchange"&&(lD.has(w)||gb(w,!1,p),gb(w,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[TE]||(g[TE]=!0,gb("selectionchange",!1,g))}}function oI(p,g,w,N){switch(Zr(g)){case 1:var j=De;break;case 4:j=it;break;default:j=en}w=j.bind(null,g,w,p),j=void 0,!ds||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(j=!0),N?j!==void 0?p.addEventListener(g,w,{capture:!0,passive:j}):p.addEventListener(g,w,!0):j!==void 0?p.addEventListener(g,w,{passive:j}):p.addEventListener(g,w,!1)}function wE(p,g,w,N,j){var H=N;if((g&1)===0&&(g&2)===0&&N!==null)e:for(;;){if(N===null)return;var he=N.tag;if(he===3||he===4){var Re=N.stateNode.containerInfo;if(Re===j||Re.nodeType===8&&Re.parentNode===j)break;if(he===4)for(he=N.return;he!==null;){var Ue=he.tag;if((Ue===3||Ue===4)&&(Ue=he.stateNode.containerInfo,Ue===j||Ue.nodeType===8&&Ue.parentNode===j))return;he=he.return}for(;Re!==null;){if(he=Gp(Re),he===null)return;if(Ue=he.tag,Ue===5||Ue===6){N=H=he;continue e}Re=Re.parentNode}}N=N.return}_o(function(){var st=H,Dt=ao(w),Lt=[];e:{var Nt=iI.get(p);if(Nt!==void 0){var Qt=gh,an=p;switch(p){case"keypress":if(pa(w)===0)break e;case"keydown":case"keyup":Qt=z;break;case"focusin":an="focus",Qt=Em;break;case"focusout":an="blur",Qt=Em;break;case"beforeblur":case"afterblur":Qt=Em;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Qt=_m;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Qt=gE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Qt=ut;break;case Bp:case tI:case nI:Qt=Ed;break;case rI:Qt=ii;break;case"scroll":Qt=r_;break;case"wheel":Qt=Nr;break;case"copy":case"cut":case"paste":Qt=s_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Qt=ge}var cn=(g&4)!==0,ms=!cn&&p==="scroll",Qe=cn?Nt!==null?Nt+"Capture":null:Nt;cn=[];for(var Fe=st,nt;Fe!==null;){nt=Fe;var jt=nt.stateNode;if(nt.tag===5&&jt!==null&&(nt=jt,Qe!==null&&(jt=ji(Fe,Qe),jt!=null&&cn.push(wm(Fe,jt,nt)))),ms)break;Fe=Fe.return}0<cn.length&&(Nt=new Qt(Nt,an,null,w,Dt),Lt.push({event:Nt,listeners:cn}))}}if((g&7)===0){e:{if(Nt=p==="mouseover"||p==="pointerover",Qt=p==="mouseout"||p==="pointerout",Nt&&w!==Ks&&(an=w.relatedTarget||w.fromElement)&&(Gp(an)||an[$c]))break e;if((Qt||Nt)&&(Nt=Dt.window===Dt?Dt:(Nt=Dt.ownerDocument)?Nt.defaultView||Nt.parentWindow:window,Qt?(an=w.relatedTarget||w.toElement,Qt=st,an=an?Gp(an):null,an!==null&&(ms=Xi(an),an!==ms||an.tag!==5&&an.tag!==6)&&(an=null)):(Qt=null,an=st),Qt!==an)){if(cn=_m,jt="onMouseLeave",Qe="onMouseEnter",Fe="mouse",(p==="pointerout"||p==="pointerover")&&(cn=ge,jt="onPointerLeave",Qe="onPointerEnter",Fe="pointer"),ms=Qt==null?Nt:Hp(Qt),nt=an==null?Nt:Hp(an),Nt=new cn(jt,Fe+"leave",Qt,w,Dt),Nt.target=ms,Nt.relatedTarget=nt,jt=null,Gp(Dt)===st&&(cn=new cn(Qe,Fe+"enter",an,w,Dt),cn.target=nt,cn.relatedTarget=ms,jt=cn),ms=jt,Qt&&an)t:{for(cn=Qt,Qe=an,Fe=0,nt=cn;nt;nt=zp(nt))Fe++;for(nt=0,jt=Qe;jt;jt=zp(jt))nt++;for(;0<Fe-nt;)cn=zp(cn),Fe--;for(;0<nt-Fe;)Qe=zp(Qe),nt--;for(;Fe--;){if(cn===Qe||Qe!==null&&cn===Qe.alternate)break t;cn=zp(cn),Qe=zp(Qe)}cn=null}else cn=null;Qt!==null&&h_(Lt,Nt,Qt,cn,!1),an!==null&&ms!==null&&h_(Lt,ms,an,cn,!0)}}e:{if(Nt=st?Hp(st):window,Qt=Nt.nodeName&&Nt.nodeName.toLowerCase(),Qt==="select"||Qt==="input"&&Nt.type==="file")var ln=nD;else if(HR(Nt))if($R)ln=oD;else{ln=iD;var bn=rD}else(Qt=Nt.nodeName)&&Qt.toLowerCase()==="input"&&(Nt.type==="checkbox"||Nt.type==="radio")&&(ln=sD);if(ln&&(ln=ln(p,st))){cb(Lt,ln,w,Dt);break e}bn&&bn(p,Nt,st),p==="focusout"&&(bn=Nt._wrapperState)&&bn.controlled&&Nt.type==="number"&&Ve(Nt,"number",Nt.value)}switch(bn=st?Hp(st):window,p){case"focusin":(HR(bn)||bn.contentEditable==="true")&&(at=bn,hb=st,l_=null);break;case"focusout":l_=hb=at=null;break;case"mousedown":pb=!0;break;case"contextmenu":case"mouseup":case"dragend":pb=!1,ZR(Lt,w,Dt);break;case"selectionchange":if(aD)break;case"keydown":case"keyup":ZR(Lt,w,Dt)}var In;if(ks)e:{switch(p){case"compositionstart":var Fn="onCompositionStart";break e;case"compositionend":Fn="onCompositionEnd";break e;case"compositionupdate":Fn="onCompositionUpdate";break e}Fn=void 0}else bm?WR(p,w)&&(Fn="onCompositionEnd"):p==="keydown"&&w.keyCode===229&&(Fn="onCompositionStart");Fn&&(Up&&w.locale!=="ko"&&(bm||Fn!=="onCompositionStart"?Fn==="onCompositionEnd"&&bm&&(In=qs()):(_n=Dt,Kr="value"in _n?_n.value:_n.textContent,bm=!0)),bn=CE(st,Fn),0<bn.length&&(Fn=new $n(Fn,p,null,w,Dt),Lt.push({event:Fn,listeners:bn}),In?Fn.data=In:(In=zR(w),In!==null&&(Fn.data=In)))),(In=_a?Z1(p,w):GR(p,w))&&(st=CE(st,"onBeforeInput"),0<st.length&&(Dt=new $n("onBeforeInput","beforeinput",null,w,Dt),Lt.push({event:Dt,listeners:st}),Dt.data=In))}mb(Lt,g)})}function wm(p,g,w){return{instance:p,listener:g,currentTarget:w}}function CE(p,g){for(var w=g+"Capture",N=[];p!==null;){var j=p,H=j.stateNode;j.tag===5&&H!==null&&(j=H,H=ji(p,w),H!=null&&N.unshift(wm(p,H,j)),H=ji(p,g),H!=null&&N.push(wm(p,H,j))),p=p.return}return N}function zp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function h_(p,g,w,N,j){for(var H=g._reactName,he=[];w!==null&&w!==N;){var Re=w,Ue=Re.alternate,st=Re.stateNode;if(Ue!==null&&Ue===N)break;Re.tag===5&&st!==null&&(Re=st,j?(Ue=ji(w,H),Ue!=null&&he.unshift(wm(w,Ue,Re))):j||(Ue=ji(w,H),Ue!=null&&he.push(wm(w,Ue,Re)))),w=w.return}he.length!==0&&p.push({event:g,listeners:he})}var uD=/\r\n?/g,dD=/\u0000|\uFFFD/g;function aI(p){return(typeof p=="string"?p:""+p).replace(uD,`
`).replace(dD,"")}function RE(p,g,w){if(g=aI(g),aI(p)!==g&&w)throw Error(i(425))}function IE(){}var AE=null,p_=null;function _b(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var f_=typeof setTimeout=="function"?setTimeout:void 0,hD=typeof clearTimeout=="function"?clearTimeout:void 0,cI=typeof Promise=="function"?Promise:void 0,pD=typeof queueMicrotask=="function"?queueMicrotask:typeof cI<"u"?function(p){return cI.resolve(null).then(p).catch(fD)}:f_;function fD(p){setTimeout(function(){throw p})}function yb(p,g){var w=g,N=0;do{var j=w.nextSibling;if(p.removeChild(w),j&&j.nodeType===8)if(w=j.data,w==="/$"){if(N===0){p.removeChild(j),Ga(g);return}N--}else w!=="$"&&w!=="$?"&&w!=="$!"||N++;w=j}while(w);Ga(g)}function yh(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function lI(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var w=p.data;if(w==="$"||w==="$!"||w==="$?"){if(g===0)return p;g--}else w==="/$"&&g++}p=p.previousSibling}return null}var Cm=Math.random().toString(36).slice(2),Tu="__reactFiber$"+Cm,Eh="__reactProps$"+Cm,$c="__reactContainer$"+Cm,m_="__reactEvents$"+Cm,mD="__reactListeners$"+Cm,gD="__reactHandles$"+Cm;function Gp(p){var g=p[Tu];if(g)return g;for(var w=p.parentNode;w;){if(g=w[$c]||w[Tu]){if(w=g.alternate,g.child!==null||w!==null&&w.child!==null)for(p=lI(p);p!==null;){if(w=p[Tu])return w;p=lI(p)}return g}p=w,w=p.parentNode}return null}function Rm(p){return p=p[Tu]||p[$c],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Hp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function Im(p){return p[Eh]||null}var Eb=[],Am=-1;function Kc(p){return{current:p}}function Wi(p){0>Am||(p.current=Eb[Am],Eb[Am]=null,Am--)}function Di(p,g){Am++,Eb[Am]=p.current,p.current=g}var vh={},Go=Kc(vh),$a=Kc(!1),$p=vh;function Kp(p,g){var w=p.type.contextTypes;if(!w)return vh;var N=p.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===g)return N.__reactInternalMemoizedMaskedChildContext;var j={},H;for(H in w)j[H]=g[H];return N&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=j),j}function Ka(p){return p=p.childContextTypes,p!=null}function PE(){Wi($a),Wi(Go)}function uI(p,g,w){if(Go.current!==vh)throw Error(i(168));Di(Go,g),Di($a,w)}function OE(p,g,w){var N=p.stateNode;if(g=g.childContextTypes,typeof N.getChildContext!="function")return w;N=N.getChildContext();for(var j in N)if(!(j in g))throw Error(i(108,qe(p)||"Unknown",j));return Be({},w,N)}function kE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||vh,$p=Go.current,Di(Go,p),Di($a,$a.current),!0}function dI(p,g,w){var N=p.stateNode;if(!N)throw Error(i(169));w?(p=OE(p,g,$p),N.__reactInternalMemoizedMergedChildContext=p,Wi($a),Wi(Go),Di(Go,p)):Wi($a),Di($a,w)}var qc=null,NE=!1,vb=!1;function hI(p){qc===null?qc=[p]:qc.push(p)}function _D(p){NE=!0,hI(p)}function Sh(){if(!vb&&qc!==null){vb=!0;var p=0,g=pr;try{var w=qc;for(pr=1;p<w.length;p++){var N=w[p];do N=N(!0);while(N!==null)}qc=null,NE=!1}catch(j){throw qc!==null&&(qc=qc.slice(p+1)),fu(Fc,Sh),j}finally{pr=g,vb=!1}}return null}var Pm=[],Sd=0,g_=null,DE=0,Yc=[],bc=0,qp=null,bd=1,Td="";function wd(p,g){Pm[Sd++]=DE,Pm[Sd++]=g_,g_=p,DE=g}function xE(p,g,w){Yc[bc++]=bd,Yc[bc++]=Td,Yc[bc++]=qp,qp=p;var N=bd;p=Td;var j=32-yo(N)-1;N&=~(1<<j),w+=1;var H=32-yo(g)+j;if(30<H){var he=j-j%5;H=(N&(1<<he)-1).toString(32),N>>=he,j-=he,bd=1<<32-yo(g)+j|w<<j|N,Td=H+p}else bd=1<<H|w<<j|N,Td=p}function LE(p){p.return!==null&&(wd(p,1),xE(p,1,0))}function __(p){for(;p===g_;)g_=Pm[--Sd],Pm[Sd]=null,DE=Pm[--Sd],Pm[Sd]=null;for(;p===qp;)qp=Yc[--bc],Yc[bc]=null,Td=Yc[--bc],Yc[bc]=null,bd=Yc[--bc],Yc[bc]=null}var qa=null,Ya=null,vi=!1,ya=null;function pI(p,g){var w=Cc(5,null,null,0);w.elementType="DELETED",w.stateNode=g,w.return=p,g=p.deletions,g===null?(p.deletions=[w],p.flags|=16):g.push(w)}function fI(p,g){switch(p.tag){case 5:var w=p.type;return g=g.nodeType!==1||w.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,qa=p,Ya=yh(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,qa=p,Ya=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(w=qp!==null?{id:bd,overflow:Td}:null,p.memoizedState={dehydrated:g,treeContext:w,retryLane:1073741824},w=Cc(18,null,null,0),w.stateNode=g,w.return=p,p.child=w,qa=p,Ya=null,!0):!1;default:return!1}}function ME(p){return(p.mode&1)!==0&&(p.flags&128)===0}function Sb(p){if(vi){var g=Ya;if(g){var w=g;if(!fI(p,g)){if(ME(p))throw Error(i(418));g=yh(w.nextSibling);var N=qa;g&&fI(p,g)?pI(N,w):(p.flags=p.flags&-4097|2,vi=!1,qa=p)}}else{if(ME(p))throw Error(i(418));p.flags=p.flags&-4097|2,vi=!1,qa=p}}}function mI(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;qa=p}function y_(p){if(p!==qa)return!1;if(!vi)return mI(p),vi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!_b(p.type,p.memoizedProps)),g&&(g=Ya)){if(ME(p))throw gI(),Error(i(418));for(;g;)pI(p,g),g=yh(g.nextSibling)}if(mI(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var w=p.data;if(w==="/$"){if(g===0){Ya=yh(p.nextSibling);break e}g--}else w!=="$"&&w!=="$!"&&w!=="$?"||g++}p=p.nextSibling}Ya=null}}else Ya=qa?yh(p.stateNode.nextSibling):null;return!0}function gI(){for(var p=Ya;p;)p=yh(p.nextSibling)}function Om(){Ya=qa=null,vi=!1}function bb(p){ya===null?ya=[p]:ya.push(p)}var yD=oe.ReactCurrentBatchConfig;function E_(p,g,w){if(p=w.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(i(309));var N=w.stateNode}if(!N)throw Error(i(147,p));var j=N,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(he){var Re=j.refs;he===null?delete Re[H]:Re[H]=he},g._stringRef=H,g)}if(typeof p!="string")throw Error(i(284));if(!w._owner)throw Error(i(290,p))}return p}function UE(p,g){throw p=Object.prototype.toString.call(g),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function Tb(p){var g=p._init;return g(p._payload)}function bh(p){function g(Qe,Fe){if(p){var nt=Qe.deletions;nt===null?(Qe.deletions=[Fe],Qe.flags|=16):nt.push(Fe)}}function w(Qe,Fe){if(!p)return null;for(;Fe!==null;)g(Qe,Fe),Fe=Fe.sibling;return null}function N(Qe,Fe){for(Qe=new Map;Fe!==null;)Fe.key!==null?Qe.set(Fe.key,Fe):Qe.set(Fe.index,Fe),Fe=Fe.sibling;return Qe}function j(Qe,Fe){return Qe=Nd(Qe,Fe),Qe.index=0,Qe.sibling=null,Qe}function H(Qe,Fe,nt){return Qe.index=nt,p?(nt=Qe.alternate,nt!==null?(nt=nt.index,nt<Fe?(Qe.flags|=2,Fe):nt):(Qe.flags|=2,Fe)):(Qe.flags|=1048576,Fe)}function he(Qe){return p&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Re(Qe,Fe,nt,jt){return Fe===null||Fe.tag!==6?(Fe=oT(nt,Qe.mode,jt),Fe.return=Qe,Fe):(Fe=j(Fe,nt),Fe.return=Qe,Fe)}function Ue(Qe,Fe,nt,jt){var ln=nt.type;return ln===Y?Dt(Qe,Fe,nt.props.children,jt,nt.key):Fe!==null&&(Fe.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===je&&Tb(ln)===Fe.type)?(jt=j(Fe,nt.props),jt.ref=E_(Qe,Fe,nt),jt.return=Qe,jt):(jt=Tv(nt.type,nt.key,nt.props,null,Qe.mode,jt),jt.ref=E_(Qe,Fe,nt),jt.return=Qe,jt)}function st(Qe,Fe,nt,jt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==nt.containerInfo||Fe.stateNode.implementation!==nt.implementation?(Fe=aT(nt,Qe.mode,jt),Fe.return=Qe,Fe):(Fe=j(Fe,nt.children||[]),Fe.return=Qe,Fe)}function Dt(Qe,Fe,nt,jt,ln){return Fe===null||Fe.tag!==7?(Fe=af(nt,Qe.mode,jt,ln),Fe.return=Qe,Fe):(Fe=j(Fe,nt),Fe.return=Qe,Fe)}function Lt(Qe,Fe,nt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=oT(""+Fe,Qe.mode,nt),Fe.return=Qe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case se:return nt=Tv(Fe.type,Fe.key,Fe.props,null,Qe.mode,nt),nt.ref=E_(Qe,null,Fe),nt.return=Qe,nt;case le:return Fe=aT(Fe,Qe.mode,nt),Fe.return=Qe,Fe;case je:var jt=Fe._init;return Lt(Qe,jt(Fe._payload),nt)}if($e(Fe)||Se(Fe))return Fe=af(Fe,Qe.mode,nt,null),Fe.return=Qe,Fe;UE(Qe,Fe)}return null}function Nt(Qe,Fe,nt,jt){var ln=Fe!==null?Fe.key:null;if(typeof nt=="string"&&nt!==""||typeof nt=="number")return ln!==null?null:Re(Qe,Fe,""+nt,jt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case se:return nt.key===ln?Ue(Qe,Fe,nt,jt):null;case le:return nt.key===ln?st(Qe,Fe,nt,jt):null;case je:return ln=nt._init,Nt(Qe,Fe,ln(nt._payload),jt)}if($e(nt)||Se(nt))return ln!==null?null:Dt(Qe,Fe,nt,jt,null);UE(Qe,nt)}return null}function Qt(Qe,Fe,nt,jt,ln){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return Qe=Qe.get(nt)||null,Re(Fe,Qe,""+jt,ln);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case se:return Qe=Qe.get(jt.key===null?nt:jt.key)||null,Ue(Fe,Qe,jt,ln);case le:return Qe=Qe.get(jt.key===null?nt:jt.key)||null,st(Fe,Qe,jt,ln);case je:var bn=jt._init;return Qt(Qe,Fe,nt,bn(jt._payload),ln)}if($e(jt)||Se(jt))return Qe=Qe.get(nt)||null,Dt(Fe,Qe,jt,ln,null);UE(Fe,jt)}return null}function an(Qe,Fe,nt,jt){for(var ln=null,bn=null,In=Fe,Fn=Fe=0,Ms=null;In!==null&&Fn<nt.length;Fn++){In.index>Fn?(Ms=In,In=null):Ms=In.sibling;var Dr=Nt(Qe,In,nt[Fn],jt);if(Dr===null){In===null&&(In=Ms);break}p&&In&&Dr.alternate===null&&g(Qe,In),Fe=H(Dr,Fe,Fn),bn===null?ln=Dr:bn.sibling=Dr,bn=Dr,In=Ms}if(Fn===nt.length)return w(Qe,In),vi&&wd(Qe,Fn),ln;if(In===null){for(;Fn<nt.length;Fn++)In=Lt(Qe,nt[Fn],jt),In!==null&&(Fe=H(In,Fe,Fn),bn===null?ln=In:bn.sibling=In,bn=In);return vi&&wd(Qe,Fn),ln}for(In=N(Qe,In);Fn<nt.length;Fn++)Ms=Qt(In,Qe,Fn,nt[Fn],jt),Ms!==null&&(p&&Ms.alternate!==null&&In.delete(Ms.key===null?Fn:Ms.key),Fe=H(Ms,Fe,Fn),bn===null?ln=Ms:bn.sibling=Ms,bn=Ms);return p&&In.forEach(function(Dh){return g(Qe,Dh)}),vi&&wd(Qe,Fn),ln}function cn(Qe,Fe,nt,jt){var ln=Se(nt);if(typeof ln!="function")throw Error(i(150));if(nt=ln.call(nt),nt==null)throw Error(i(151));for(var bn=ln=null,In=Fe,Fn=Fe=0,Ms=null,Dr=nt.next();In!==null&&!Dr.done;Fn++,Dr=nt.next()){In.index>Fn?(Ms=In,In=null):Ms=In.sibling;var Dh=Nt(Qe,In,Dr.value,jt);if(Dh===null){In===null&&(In=Ms);break}p&&In&&Dh.alternate===null&&g(Qe,In),Fe=H(Dh,Fe,Fn),bn===null?ln=Dh:bn.sibling=Dh,bn=Dh,In=Ms}if(Dr.done)return w(Qe,In),vi&&wd(Qe,Fn),ln;if(In===null){for(;!Dr.done;Fn++,Dr=nt.next())Dr=Lt(Qe,Dr.value,jt),Dr!==null&&(Fe=H(Dr,Fe,Fn),bn===null?ln=Dr:bn.sibling=Dr,bn=Dr);return vi&&wd(Qe,Fn),ln}for(In=N(Qe,In);!Dr.done;Fn++,Dr=nt.next())Dr=Qt(In,Qe,Fn,Dr.value,jt),Dr!==null&&(p&&Dr.alternate!==null&&In.delete(Dr.key===null?Fn:Dr.key),Fe=H(Dr,Fe,Fn),bn===null?ln=Dr:bn.sibling=Dr,bn=Dr);return p&&In.forEach(function(xD){return g(Qe,xD)}),vi&&wd(Qe,Fn),ln}function ms(Qe,Fe,nt,jt){if(typeof nt=="object"&&nt!==null&&nt.type===Y&&nt.key===null&&(nt=nt.props.children),typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case se:e:{for(var ln=nt.key,bn=Fe;bn!==null;){if(bn.key===ln){if(ln=nt.type,ln===Y){if(bn.tag===7){w(Qe,bn.sibling),Fe=j(bn,nt.props.children),Fe.return=Qe,Qe=Fe;break e}}else if(bn.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===je&&Tb(ln)===bn.type){w(Qe,bn.sibling),Fe=j(bn,nt.props),Fe.ref=E_(Qe,bn,nt),Fe.return=Qe,Qe=Fe;break e}w(Qe,bn);break}else g(Qe,bn);bn=bn.sibling}nt.type===Y?(Fe=af(nt.props.children,Qe.mode,jt,nt.key),Fe.return=Qe,Qe=Fe):(jt=Tv(nt.type,nt.key,nt.props,null,Qe.mode,jt),jt.ref=E_(Qe,Fe,nt),jt.return=Qe,Qe=jt)}return he(Qe);case le:e:{for(bn=nt.key;Fe!==null;){if(Fe.key===bn)if(Fe.tag===4&&Fe.stateNode.containerInfo===nt.containerInfo&&Fe.stateNode.implementation===nt.implementation){w(Qe,Fe.sibling),Fe=j(Fe,nt.children||[]),Fe.return=Qe,Qe=Fe;break e}else{w(Qe,Fe);break}else g(Qe,Fe);Fe=Fe.sibling}Fe=aT(nt,Qe.mode,jt),Fe.return=Qe,Qe=Fe}return he(Qe);case je:return bn=nt._init,ms(Qe,Fe,bn(nt._payload),jt)}if($e(nt))return an(Qe,Fe,nt,jt);if(Se(nt))return cn(Qe,Fe,nt,jt);UE(Qe,nt)}return typeof nt=="string"&&nt!==""||typeof nt=="number"?(nt=""+nt,Fe!==null&&Fe.tag===6?(w(Qe,Fe.sibling),Fe=j(Fe,nt),Fe.return=Qe,Qe=Fe):(w(Qe,Fe),Fe=oT(nt,Qe.mode,jt),Fe.return=Qe,Qe=Fe),he(Qe)):w(Qe,Fe)}return ms}var km=bh(!0),_I=bh(!1),VE=Kc(null),v_=null,Nm=null,jE=null;function wb(){jE=Nm=v_=null}function Cb(p){var g=VE.current;Wi(VE),p._currentValue=g}function Rb(p,g,w){for(;p!==null;){var N=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,N!==null&&(N.childLanes|=g)):N!==null&&(N.childLanes&g)!==g&&(N.childLanes|=g),p===w)break;p=p.return}}function Cd(p,g){v_=p,jE=Nm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ja=!0),p.firstContext=null)}function Xc(p){var g=p._currentValue;if(jE!==p)if(p={context:p,memoizedValue:g,next:null},Nm===null){if(v_===null)throw Error(i(308));Nm=p,v_.dependencies={lanes:0,firstContext:p}}else Nm=Nm.next=p;return g}var Yp=null;function Ib(p){Yp===null?Yp=[p]:Yp.push(p)}function yI(p,g,w,N){var j=g.interleaved;return j===null?(w.next=w,Ib(g)):(w.next=j.next,j.next=w),g.interleaved=w,Rd(p,N)}function Rd(p,g){p.lanes|=g;var w=p.alternate;for(w!==null&&(w.lanes|=g),w=p,p=p.return;p!==null;)p.childLanes|=g,w=p.alternate,w!==null&&(w.childLanes|=g),w=p,p=p.return;return w.tag===3?w.stateNode:null}var Th=!1;function S_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function EI(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function wu(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function wh(p,g,w){var N=p.updateQueue;if(N===null)return null;if(N=N.shared,(jr&2)!==0){var j=N.pending;return j===null?g.next=g:(g.next=j.next,j.next=g),N.pending=g,Rd(p,w)}return j=N.interleaved,j===null?(g.next=g,Ib(N)):(g.next=j.next,j.next=g),N.interleaved=g,Rd(p,w)}function b_(p,g,w){if(g=g.updateQueue,g!==null&&(g=g.shared,(w&4194240)!==0)){var N=g.lanes;N&=p.pendingLanes,w|=N,g.lanes=w,yc(p,w)}}function vI(p,g){var w=p.updateQueue,N=p.alternate;if(N!==null&&(N=N.updateQueue,w===N)){var j=null,H=null;if(w=w.firstBaseUpdate,w!==null){do{var he={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};H===null?j=H=he:H=H.next=he,w=w.next}while(w!==null);H===null?j=H=g:H=H.next=g}else j=H=g;w={baseState:N.baseState,firstBaseUpdate:j,lastBaseUpdate:H,shared:N.shared,effects:N.effects},p.updateQueue=w;return}p=w.lastBaseUpdate,p===null?w.firstBaseUpdate=g:p.next=g,w.lastBaseUpdate=g}function FE(p,g,w,N){var j=p.updateQueue;Th=!1;var H=j.firstBaseUpdate,he=j.lastBaseUpdate,Re=j.shared.pending;if(Re!==null){j.shared.pending=null;var Ue=Re,st=Ue.next;Ue.next=null,he===null?H=st:he.next=st,he=Ue;var Dt=p.alternate;Dt!==null&&(Dt=Dt.updateQueue,Re=Dt.lastBaseUpdate,Re!==he&&(Re===null?Dt.firstBaseUpdate=st:Re.next=st,Dt.lastBaseUpdate=Ue))}if(H!==null){var Lt=j.baseState;he=0,Dt=st=Ue=null,Re=H;do{var Nt=Re.lane,Qt=Re.eventTime;if((N&Nt)===Nt){Dt!==null&&(Dt=Dt.next={eventTime:Qt,lane:0,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null});e:{var an=p,cn=Re;switch(Nt=g,Qt=w,cn.tag){case 1:if(an=cn.payload,typeof an=="function"){Lt=an.call(Qt,Lt,Nt);break e}Lt=an;break e;case 3:an.flags=an.flags&-65537|128;case 0:if(an=cn.payload,Nt=typeof an=="function"?an.call(Qt,Lt,Nt):an,Nt==null)break e;Lt=Be({},Lt,Nt);break e;case 2:Th=!0}}Re.callback!==null&&Re.lane!==0&&(p.flags|=64,Nt=j.effects,Nt===null?j.effects=[Re]:Nt.push(Re))}else Qt={eventTime:Qt,lane:Nt,tag:Re.tag,payload:Re.payload,callback:Re.callback,next:null},Dt===null?(st=Dt=Qt,Ue=Lt):Dt=Dt.next=Qt,he|=Nt;if(Re=Re.next,Re===null){if(Re=j.shared.pending,Re===null)break;Nt=Re,Re=Nt.next,Nt.next=null,j.lastBaseUpdate=Nt,j.shared.pending=null}}while(!0);if(Dt===null&&(Ue=Lt),j.baseState=Ue,j.firstBaseUpdate=st,j.lastBaseUpdate=Dt,g=j.shared.interleaved,g!==null){j=g;do he|=j.lane,j=j.next;while(j!==g)}else H===null&&(j.shared.lanes=0);tf|=he,p.lanes=he,p.memoizedState=Lt}}function SI(p,g,w){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var N=p[g],j=N.callback;if(j!==null){if(N.callback=null,N=w,typeof j!="function")throw Error(i(191,j));j.call(N)}}}var T_={},Cu=Kc(T_),w_=Kc(T_),Dm=Kc(T_);function Xp(p){if(p===T_)throw Error(i(174));return p}function Ab(p,g){switch(Di(Dm,g),Di(w_,p),Di(Cu,T_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:nn(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=nn(g,p)}Wi(Cu),Di(Cu,g)}function Jp(){Wi(Cu),Wi(w_),Wi(Dm)}function bI(p){Xp(Dm.current);var g=Xp(Cu.current),w=nn(g,p.type);g!==w&&(Di(w_,p),Di(Cu,w))}function xm(p){w_.current===p&&(Wi(Cu),Wi(w_))}var $i=Kc(0);function Ch(p){for(var g=p;g!==null;){if(g.tag===13){var w=g.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Pb=[];function Ob(){for(var p=0;p<Pb.length;p++)Pb[p]._workInProgressVersionPrimary=null;Pb.length=0}var BE=oe.ReactCurrentDispatcher,kb=oe.ReactCurrentBatchConfig,Ru=0,Ji=null,Ns=null,Ds=null,Lm=!1,C_=!1,R_=0,ED=0;function Ho(){throw Error(i(321))}function Nb(p,g){if(g===null)return!1;for(var w=0;w<g.length&&w<p.length;w++)if(!Bl(p[w],g[w]))return!1;return!0}function Mm(p,g,w,N,j,H){if(Ru=H,Ji=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,BE.current=p===null||p.memoizedState===null?bD:DI,p=w(N,j),C_){H=0;do{if(C_=!1,R_=0,25<=H)throw Error(i(301));H+=1,Ds=Ns=null,g.updateQueue=null,BE.current=TD,p=w(N,j)}while(C_)}if(BE.current=HE,g=Ns!==null&&Ns.next!==null,Ru=0,Ds=Ns=Ji=null,Lm=!1,g)throw Error(i(300));return p}function Db(){var p=R_!==0;return R_=0,p}function Ea(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ds===null?Ji.memoizedState=Ds=p:Ds=Ds.next=p,Ds}function Xa(){if(Ns===null){var p=Ji.alternate;p=p!==null?p.memoizedState:null}else p=Ns.next;var g=Ds===null?Ji.memoizedState:Ds.next;if(g!==null)Ds=g,Ns=p;else{if(p===null)throw Error(i(310));Ns=p,p={memoizedState:Ns.memoizedState,baseState:Ns.baseState,baseQueue:Ns.baseQueue,queue:Ns.queue,next:null},Ds===null?Ji.memoizedState=Ds=p:Ds=Ds.next=p}return Ds}function Rh(p,g){return typeof g=="function"?g(p):g}function Qp(p){var g=Xa(),w=g.queue;if(w===null)throw Error(i(311));w.lastRenderedReducer=p;var N=Ns,j=N.baseQueue,H=w.pending;if(H!==null){if(j!==null){var he=j.next;j.next=H.next,H.next=he}N.baseQueue=j=H,w.pending=null}if(j!==null){H=j.next,N=N.baseState;var Re=he=null,Ue=null,st=H;do{var Dt=st.lane;if((Ru&Dt)===Dt)Ue!==null&&(Ue=Ue.next={lane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),N=st.hasEagerState?st.eagerState:p(N,st.action);else{var Lt={lane:Dt,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null};Ue===null?(Re=Ue=Lt,he=N):Ue=Ue.next=Lt,Ji.lanes|=Dt,tf|=Dt}st=st.next}while(st!==null&&st!==H);Ue===null?he=N:Ue.next=Re,Bl(N,g.memoizedState)||(Ja=!0),g.memoizedState=N,g.baseState=he,g.baseQueue=Ue,w.lastRenderedState=N}if(p=w.interleaved,p!==null){j=p;do H=j.lane,Ji.lanes|=H,tf|=H,j=j.next;while(j!==p)}else j===null&&(w.lanes=0);return[g.memoizedState,w.dispatch]}function Um(p){var g=Xa(),w=g.queue;if(w===null)throw Error(i(311));w.lastRenderedReducer=p;var N=w.dispatch,j=w.pending,H=g.memoizedState;if(j!==null){w.pending=null;var he=j=j.next;do H=p(H,he.action),he=he.next;while(he!==j);Bl(H,g.memoizedState)||(Ja=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),w.lastRenderedState=H}return[H,N]}function TI(){}function xb(p,g){var w=Ji,N=Xa(),j=g(),H=!Bl(N.memoizedState,j);if(H&&(N.memoizedState=j,Ja=!0),N=N.queue,Jc(CI.bind(null,w,N,p),[p]),N.getSnapshot!==g||H||Ds!==null&&Ds.memoizedState.tag&1){if(w.flags|=2048,I_(9,Lb.bind(null,w,N,j,g),void 0,null),lo===null)throw Error(i(349));(Ru&30)!==0||wI(w,g,j)}return j}function wI(p,g,w){p.flags|=16384,p={getSnapshot:g,value:w},g=Ji.updateQueue,g===null?(g={lastEffect:null,stores:null},Ji.updateQueue=g,g.stores=[p]):(w=g.stores,w===null?g.stores=[p]:w.push(p))}function Lb(p,g,w,N){g.value=w,g.getSnapshot=N,RI(g)&&WE(p)}function CI(p,g,w){return w(function(){RI(g)&&WE(p)})}function RI(p){var g=p.getSnapshot;p=p.value;try{var w=g();return!Bl(p,w)}catch{return!0}}function WE(p){var g=Rd(p,1);g!==null&&tl(g,p,1,-1)}function zE(p){var g=Ea();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rh,lastRenderedState:p},g.queue=p,p=p.dispatch=SD.bind(null,Ji,p),[g.memoizedState,p]}function I_(p,g,w,N){return p={tag:p,create:g,destroy:w,deps:N,next:null},g=Ji.updateQueue,g===null?(g={lastEffect:null,stores:null},Ji.updateQueue=g,g.lastEffect=p.next=p):(w=g.lastEffect,w===null?g.lastEffect=p.next=p:(N=w.next,w.next=p,p.next=N,g.lastEffect=p)),p}function II(){return Xa().memoizedState}function A_(p,g,w,N){var j=Ea();Ji.flags|=p,j.memoizedState=I_(1|g,w,void 0,N===void 0?null:N)}function Vm(p,g,w,N){var j=Xa();N=N===void 0?null:N;var H=void 0;if(Ns!==null){var he=Ns.memoizedState;if(H=he.destroy,N!==null&&Nb(N,he.deps)){j.memoizedState=I_(g,w,H,N);return}}Ji.flags|=p,j.memoizedState=I_(1|g,w,H,N)}function AI(p,g){return A_(8390656,8,p,g)}function Jc(p,g){return Vm(2048,8,p,g)}function Zp(p,g){return Vm(4,2,p,g)}function Ih(p,g){return Vm(4,4,p,g)}function Mb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Ub(p,g,w){return w=w!=null?w.concat([p]):null,Vm(4,4,Mb.bind(null,g,p),w)}function Id(){}function GE(p,g){var w=Xa();g=g===void 0?null:g;var N=w.memoizedState;return N!==null&&g!==null&&Nb(g,N[1])?N[0]:(w.memoizedState=[p,g],p)}function PI(p,g){var w=Xa();g=g===void 0?null:g;var N=w.memoizedState;return N!==null&&g!==null&&Nb(g,N[1])?N[0]:(p=p(),w.memoizedState=[p,g],p)}function Vb(p,g,w){return(Ru&21)===0?(p.baseState&&(p.baseState=!1,Ja=!0),p.memoizedState=w):(Bl(w,g)||(w=fd(),Ji.lanes|=w,tf|=w,p.baseState=!0),g)}function vD(p,g){var w=pr;pr=w!==0&&4>w?w:4,p(!0);var N=kb.transition;kb.transition={};try{p(!1),g()}finally{pr=w,kb.transition=N}}function jb(){return Xa().memoizedState}function OI(p,g,w){var N=el(p);if(w={lane:N,action:w,hasEagerState:!1,eagerState:null,next:null},Ad(p))kI(g,w);else if(w=yI(p,g,w,N),w!==null){var j=So();tl(w,p,N,j),NI(w,g,N)}}function SD(p,g,w){var N=el(p),j={lane:N,action:w,hasEagerState:!1,eagerState:null,next:null};if(Ad(p))kI(g,j);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var he=g.lastRenderedState,Re=H(he,w);if(j.hasEagerState=!0,j.eagerState=Re,Bl(Re,he)){var Ue=g.interleaved;Ue===null?(j.next=j,Ib(g)):(j.next=Ue.next,Ue.next=j),g.interleaved=j;return}}catch{}finally{}w=yI(p,g,j,N),w!==null&&(j=So(),tl(w,p,N,j),NI(w,g,N))}}function Ad(p){var g=p.alternate;return p===Ji||g!==null&&g===Ji}function kI(p,g){C_=Lm=!0;var w=p.pending;w===null?g.next=g:(g.next=w.next,w.next=g),p.pending=g}function NI(p,g,w){if((w&4194240)!==0){var N=g.lanes;N&=p.pendingLanes,w|=N,g.lanes=w,yc(p,w)}}var HE={readContext:Xc,useCallback:Ho,useContext:Ho,useEffect:Ho,useImperativeHandle:Ho,useInsertionEffect:Ho,useLayoutEffect:Ho,useMemo:Ho,useReducer:Ho,useRef:Ho,useState:Ho,useDebugValue:Ho,useDeferredValue:Ho,useTransition:Ho,useMutableSource:Ho,useSyncExternalStore:Ho,useId:Ho,unstable_isNewReconciler:!1},bD={readContext:Xc,useCallback:function(p,g){return Ea().memoizedState=[p,g===void 0?null:g],p},useContext:Xc,useEffect:AI,useImperativeHandle:function(p,g,w){return w=w!=null?w.concat([p]):null,A_(4194308,4,Mb.bind(null,g,p),w)},useLayoutEffect:function(p,g){return A_(4194308,4,p,g)},useInsertionEffect:function(p,g){return A_(4,2,p,g)},useMemo:function(p,g){var w=Ea();return g=g===void 0?null:g,p=p(),w.memoizedState=[p,g],p},useReducer:function(p,g,w){var N=Ea();return g=w!==void 0?w(g):g,N.memoizedState=N.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},N.queue=p,p=p.dispatch=OI.bind(null,Ji,p),[N.memoizedState,p]},useRef:function(p){var g=Ea();return p={current:p},g.memoizedState=p},useState:zE,useDebugValue:Id,useDeferredValue:function(p){return Ea().memoizedState=p},useTransition:function(){var p=zE(!1),g=p[0];return p=vD.bind(null,p[1]),Ea().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,w){var N=Ji,j=Ea();if(vi){if(w===void 0)throw Error(i(407));w=w()}else{if(w=g(),lo===null)throw Error(i(349));(Ru&30)!==0||wI(N,g,w)}j.memoizedState=w;var H={value:w,getSnapshot:g};return j.queue=H,AI(CI.bind(null,N,H,p),[p]),N.flags|=2048,I_(9,Lb.bind(null,N,H,w,g),void 0,null),w},useId:function(){var p=Ea(),g=lo.identifierPrefix;if(vi){var w=Td,N=bd;w=(N&~(1<<32-yo(N)-1)).toString(32)+w,g=":"+g+"R"+w,w=R_++,0<w&&(g+="H"+w.toString(32)),g+=":"}else w=ED++,g=":"+g+"r"+w.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},DI={readContext:Xc,useCallback:GE,useContext:Xc,useEffect:Jc,useImperativeHandle:Ub,useInsertionEffect:Zp,useLayoutEffect:Ih,useMemo:PI,useReducer:Qp,useRef:II,useState:function(){return Qp(Rh)},useDebugValue:Id,useDeferredValue:function(p){var g=Xa();return Vb(g,Ns.memoizedState,p)},useTransition:function(){var p=Qp(Rh)[0],g=Xa().memoizedState;return[p,g]},useMutableSource:TI,useSyncExternalStore:xb,useId:jb,unstable_isNewReconciler:!1},TD={readContext:Xc,useCallback:GE,useContext:Xc,useEffect:Jc,useImperativeHandle:Ub,useInsertionEffect:Zp,useLayoutEffect:Ih,useMemo:PI,useReducer:Um,useRef:II,useState:function(){return Um(Rh)},useDebugValue:Id,useDeferredValue:function(p){var g=Xa();return Ns===null?g.memoizedState=p:Vb(g,Ns.memoizedState,p)},useTransition:function(){var p=Um(Rh)[0],g=Xa().memoizedState;return[p,g]},useMutableSource:TI,useSyncExternalStore:xb,useId:jb,unstable_isNewReconciler:!1};function Tc(p,g){if(p&&p.defaultProps){g=Be({},g),p=p.defaultProps;for(var w in p)g[w]===void 0&&(g[w]=p[w]);return g}return g}function $E(p,g,w,N){g=p.memoizedState,w=w(N,g),w=w==null?g:Be({},g,w),p.memoizedState=w,p.lanes===0&&(p.updateQueue.baseState=w)}var KE={isMounted:function(p){return(p=p._reactInternals)?Xi(p)===p:!1},enqueueSetState:function(p,g,w){p=p._reactInternals;var N=So(),j=el(p),H=wu(N,j);H.payload=g,w!=null&&(H.callback=w),g=wh(p,H,j),g!==null&&(tl(g,p,j,N),b_(g,p,j))},enqueueReplaceState:function(p,g,w){p=p._reactInternals;var N=So(),j=el(p),H=wu(N,j);H.tag=1,H.payload=g,w!=null&&(H.callback=w),g=wh(p,H,j),g!==null&&(tl(g,p,j,N),b_(g,p,j))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var w=So(),N=el(p),j=wu(w,N);j.tag=2,g!=null&&(j.callback=g),g=wh(p,j,N),g!==null&&(tl(g,p,N,w),b_(g,p,N))}};function Fb(p,g,w,N,j,H,he){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(N,H,he):g.prototype&&g.prototype.isPureReactComponent?!a_(w,N)||!a_(j,H):!0}function xI(p,g,w){var N=!1,j=vh,H=g.contextType;return typeof H=="object"&&H!==null?H=Xc(H):(j=Ka(g)?$p:Go.current,N=g.contextTypes,H=(N=N!=null)?Kp(p,j):vh),g=new g(w,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=KE,p.stateNode=g,g._reactInternals=p,N&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=j,p.__reactInternalMemoizedMaskedChildContext=H),g}function LI(p,g,w,N){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(w,N),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(w,N),g.state!==p&&KE.enqueueReplaceState(g,g.state,null)}function Bb(p,g,w,N){var j=p.stateNode;j.props=w,j.state=p.memoizedState,j.refs={},S_(p);var H=g.contextType;typeof H=="object"&&H!==null?j.context=Xc(H):(H=Ka(g)?$p:Go.current,j.context=Kp(p,H)),j.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&($E(p,g,H,w),j.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(g=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),g!==j.state&&KE.enqueueReplaceState(j,j.state,null),FE(p,w,j,N),j.state=p.memoizedState),typeof j.componentDidMount=="function"&&(p.flags|=4194308)}function jm(p,g){try{var w="",N=g;do w+=We(N),N=N.return;while(N);var j=w}catch(H){j=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:j,digest:null}}function Wb(p,g,w){return{value:p,source:null,stack:w??null,digest:g??null}}function zb(p,g){try{console.error(g.value)}catch(w){setTimeout(function(){throw w})}}var wD=typeof WeakMap=="function"?WeakMap:Map;function Gb(p,g,w){w=wu(-1,w),w.tag=3,w.payload={element:null};var N=g.value;return w.callback=function(){dv||(dv=!0,tT=N),zb(p,g)},w}function Pd(p,g,w){w=wu(-1,w),w.tag=3;var N=p.type.getDerivedStateFromError;if(typeof N=="function"){var j=g.value;w.payload=function(){return N(j)},w.callback=function(){zb(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(w.callback=function(){zb(p,g),typeof N!="function"&&(Ah===null?Ah=new Set([this]):Ah.add(this));var he=g.stack;this.componentDidCatch(g.value,{componentStack:he!==null?he:""})}),w}function MI(p,g,w){var N=p.pingCache;if(N===null){N=p.pingCache=new wD;var j=new Set;N.set(g,j)}else j=N.get(g),j===void 0&&(j=new Set,N.set(g,j));j.has(w)||(j.add(w),p=oA.bind(null,p,g,w),g.then(p,p))}function UI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function VI(p,g,w,N,j){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(g=wu(-1,1),g.tag=2,wh(w,g,1))),w.lanes|=1),p):(p.flags|=65536,p.lanes=j,p)}var CD=oe.ReactCurrentOwner,Ja=!1;function va(p,g,w,N){g.child=p===null?_I(g,null,w,N):km(g,p.child,w,N)}function qE(p,g,w,N,j){w=w.render;var H=g.ref;return Cd(g,j),N=Mm(p,g,w,N,H,j),w=Db(),p!==null&&!Ja?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~j,Iu(p,g,j)):(vi&&w&&LE(g),g.flags|=1,va(p,g,N,j),g.child)}function jI(p,g,w,N,j){if(p===null){var H=w.type;return typeof H=="function"&&!Oh(H)&&H.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(g.tag=15,g.type=H,FI(p,g,H,N,j)):(p=Tv(w.type,null,N,g,g.mode,j),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&j)===0){var he=H.memoizedProps;if(w=w.compare,w=w!==null?w:a_,w(he,N)&&p.ref===g.ref)return Iu(p,g,j)}return g.flags|=1,p=Nd(H,N),p.ref=g.ref,p.return=g,g.child=p}function FI(p,g,w,N,j){if(p!==null){var H=p.memoizedProps;if(a_(H,N)&&p.ref===g.ref)if(Ja=!1,g.pendingProps=N=H,(p.lanes&j)!==0)(p.flags&131072)!==0&&(Ja=!0);else return g.lanes=p.lanes,Iu(p,g,j)}return Hb(p,g,w,N,j)}function BI(p,g,w){var N=g.pendingProps,j=N.children,H=p!==null?p.memoizedState:null;if(N.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Di(Wl,wc),wc|=w;else{if((w&1073741824)===0)return p=H!==null?H.baseLanes|w:w,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Di(Wl,wc),wc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=H!==null?H.baseLanes:w,Di(Wl,wc),wc|=N}else H!==null?(N=H.baseLanes|w,g.memoizedState=null):N=w,Di(Wl,wc),wc|=N;return va(p,g,j,w),g.child}function WI(p,g){var w=g.ref;(p===null&&w!==null||p!==null&&p.ref!==w)&&(g.flags|=512,g.flags|=2097152)}function Hb(p,g,w,N,j){var H=Ka(w)?$p:Go.current;return H=Kp(g,H),Cd(g,j),w=Mm(p,g,w,N,H,j),N=Db(),p!==null&&!Ja?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~j,Iu(p,g,j)):(vi&&N&&LE(g),g.flags|=1,va(p,g,w,j),g.child)}function zI(p,g,w,N,j){if(Ka(w)){var H=!0;kE(g)}else H=!1;if(Cd(g,j),g.stateNode===null)ev(p,g),xI(g,w,N),Bb(g,w,N,j),N=!0;else if(p===null){var he=g.stateNode,Re=g.memoizedProps;he.props=Re;var Ue=he.context,st=w.contextType;typeof st=="object"&&st!==null?st=Xc(st):(st=Ka(w)?$p:Go.current,st=Kp(g,st));var Dt=w.getDerivedStateFromProps,Lt=typeof Dt=="function"||typeof he.getSnapshotBeforeUpdate=="function";Lt||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Re!==N||Ue!==st)&&LI(g,he,N,st),Th=!1;var Nt=g.memoizedState;he.state=Nt,FE(g,N,he,j),Ue=g.memoizedState,Re!==N||Nt!==Ue||$a.current||Th?(typeof Dt=="function"&&($E(g,w,Dt,N),Ue=g.memoizedState),(Re=Th||Fb(g,w,Re,N,Nt,Ue,st))?(Lt||typeof he.UNSAFE_componentWillMount!="function"&&typeof he.componentWillMount!="function"||(typeof he.componentWillMount=="function"&&he.componentWillMount(),typeof he.UNSAFE_componentWillMount=="function"&&he.UNSAFE_componentWillMount()),typeof he.componentDidMount=="function"&&(g.flags|=4194308)):(typeof he.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=N,g.memoizedState=Ue),he.props=N,he.state=Ue,he.context=st,N=Re):(typeof he.componentDidMount=="function"&&(g.flags|=4194308),N=!1)}else{he=g.stateNode,EI(p,g),Re=g.memoizedProps,st=g.type===g.elementType?Re:Tc(g.type,Re),he.props=st,Lt=g.pendingProps,Nt=he.context,Ue=w.contextType,typeof Ue=="object"&&Ue!==null?Ue=Xc(Ue):(Ue=Ka(w)?$p:Go.current,Ue=Kp(g,Ue));var Qt=w.getDerivedStateFromProps;(Dt=typeof Qt=="function"||typeof he.getSnapshotBeforeUpdate=="function")||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Re!==Lt||Nt!==Ue)&&LI(g,he,N,Ue),Th=!1,Nt=g.memoizedState,he.state=Nt,FE(g,N,he,j);var an=g.memoizedState;Re!==Lt||Nt!==an||$a.current||Th?(typeof Qt=="function"&&($E(g,w,Qt,N),an=g.memoizedState),(st=Th||Fb(g,w,st,N,Nt,an,Ue)||!1)?(Dt||typeof he.UNSAFE_componentWillUpdate!="function"&&typeof he.componentWillUpdate!="function"||(typeof he.componentWillUpdate=="function"&&he.componentWillUpdate(N,an,Ue),typeof he.UNSAFE_componentWillUpdate=="function"&&he.UNSAFE_componentWillUpdate(N,an,Ue)),typeof he.componentDidUpdate=="function"&&(g.flags|=4),typeof he.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof he.componentDidUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=1024),g.memoizedProps=N,g.memoizedState=an),he.props=N,he.state=an,he.context=Ue,N=st):(typeof he.componentDidUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Re===p.memoizedProps&&Nt===p.memoizedState||(g.flags|=1024),N=!1)}return YE(p,g,w,N,H,j)}function YE(p,g,w,N,j,H){WI(p,g);var he=(g.flags&128)!==0;if(!N&&!he)return j&&dI(g,w,!1),Iu(p,g,H);N=g.stateNode,CD.current=g;var Re=he&&typeof w.getDerivedStateFromError!="function"?null:N.render();return g.flags|=1,p!==null&&he?(g.child=km(g,p.child,null,H),g.child=km(g,null,Re,H)):va(p,g,Re,H),g.memoizedState=N.state,j&&dI(g,w,!0),g.child}function $b(p){var g=p.stateNode;g.pendingContext?uI(p,g.pendingContext,g.pendingContext!==g.context):g.context&&uI(p,g.context,!1),Ab(p,g.containerInfo)}function GI(p,g,w,N,j){return Om(),bb(j),g.flags|=256,va(p,g,w,N),g.child}var Kb={dehydrated:null,treeContext:null,retryLane:0};function Fm(p){return{baseLanes:p,cachePool:null,transitions:null}}function XE(p,g,w){var N=g.pendingProps,j=$i.current,H=!1,he=(g.flags&128)!==0,Re;if((Re=he)||(Re=p!==null&&p.memoizedState===null?!1:(j&2)!==0),Re?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(j|=1),Di($i,j&1),p===null)return Sb(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(he=N.children,p=N.fallback,H?(N=g.mode,H=g.child,he={mode:"hidden",children:he},(N&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=he):H=kh(he,N,0,null),p=af(p,N,w,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=Fm(w),g.memoizedState=Kb,p):JE(g,he));if(j=p.memoizedState,j!==null&&(Re=j.dehydrated,Re!==null))return HI(p,g,he,N,Re,j,w);if(H){H=N.fallback,he=g.mode,j=p.child,Re=j.sibling;var Ue={mode:"hidden",children:N.children};return(he&1)===0&&g.child!==j?(N=g.child,N.childLanes=0,N.pendingProps=Ue,g.deletions=null):(N=Nd(j,Ue),N.subtreeFlags=j.subtreeFlags&14680064),Re!==null?H=Nd(Re,H):(H=af(H,he,w,null),H.flags|=2),H.return=g,N.return=g,N.sibling=H,g.child=N,N=H,H=g.child,he=p.child.memoizedState,he=he===null?Fm(w):{baseLanes:he.baseLanes|w,cachePool:null,transitions:he.transitions},H.memoizedState=he,H.childLanes=p.childLanes&~w,g.memoizedState=Kb,N}return H=p.child,p=H.sibling,N=Nd(H,{mode:"visible",children:N.children}),(g.mode&1)===0&&(N.lanes=w),N.return=g,N.sibling=null,p!==null&&(w=g.deletions,w===null?(g.deletions=[p],g.flags|=16):w.push(p)),g.child=N,g.memoizedState=null,N}function JE(p,g){return g=kh({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function ef(p,g,w,N){return N!==null&&bb(N),km(g,p.child,null,w),p=JE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function HI(p,g,w,N,j,H,he){if(w)return g.flags&256?(g.flags&=-257,N=Wb(Error(i(422))),ef(p,g,he,N)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=N.fallback,j=g.mode,N=kh({mode:"visible",children:N.children},j,0,null),H=af(H,j,he,null),H.flags|=2,N.return=g,H.return=g,N.sibling=H,g.child=N,(g.mode&1)!==0&&km(g,p.child,null,he),g.child.memoizedState=Fm(he),g.memoizedState=Kb,H);if((g.mode&1)===0)return ef(p,g,he,null);if(j.data==="$!"){if(N=j.nextSibling&&j.nextSibling.dataset,N)var Re=N.dgst;return N=Re,H=Error(i(419)),N=Wb(H,N,void 0),ef(p,g,he,N)}if(Re=(he&p.childLanes)!==0,Ja||Re){if(N=lo,N!==null){switch(he&-he){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}j=(j&(N.suspendedLanes|he))!==0?0:j,j!==0&&j!==H.retryLane&&(H.retryLane=j,Rd(p,j),tl(N,p,j,-1))}return iT(),N=Wb(Error(i(421))),ef(p,g,he,N)}return j.data==="$?"?(g.flags|=128,g.child=p.child,g=vv.bind(null,p),j._reactRetry=g,null):(p=H.treeContext,Ya=yh(j.nextSibling),qa=g,vi=!0,ya=null,p!==null&&(Yc[bc++]=bd,Yc[bc++]=Td,Yc[bc++]=qp,bd=p.id,Td=p.overflow,qp=g),g=JE(g,N.children),g.flags|=4096,g)}function $I(p,g,w){p.lanes|=g;var N=p.alternate;N!==null&&(N.lanes|=g),Rb(p.return,g,w)}function QE(p,g,w,N,j){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:N,tail:w,tailMode:j}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=N,H.tail=w,H.tailMode=j)}function ZE(p,g,w){var N=g.pendingProps,j=N.revealOrder,H=N.tail;if(va(p,g,N.children,w),N=$i.current,(N&2)!==0)N=N&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&$I(p,w,g);else if(p.tag===19)$I(p,w,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}N&=1}if(Di($i,N),(g.mode&1)===0)g.memoizedState=null;else switch(j){case"forwards":for(w=g.child,j=null;w!==null;)p=w.alternate,p!==null&&Ch(p)===null&&(j=w),w=w.sibling;w=j,w===null?(j=g.child,g.child=null):(j=w.sibling,w.sibling=null),QE(g,!1,j,w,H);break;case"backwards":for(w=null,j=g.child,g.child=null;j!==null;){if(p=j.alternate,p!==null&&Ch(p)===null){g.child=j;break}p=j.sibling,j.sibling=w,w=j,j=p}QE(g,!0,w,null,H);break;case"together":QE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function ev(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function Iu(p,g,w){if(p!==null&&(g.dependencies=p.dependencies),tf|=g.lanes,(w&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(i(153));if(g.child!==null){for(p=g.child,w=Nd(p,p.pendingProps),g.child=w,w.return=g;p.sibling!==null;)p=p.sibling,w=w.sibling=Nd(p,p.pendingProps),w.return=g;w.sibling=null}return g.child}function KI(p,g,w){switch(g.tag){case 3:$b(g),Om();break;case 5:bI(g);break;case 1:Ka(g.type)&&kE(g);break;case 4:Ab(g,g.stateNode.containerInfo);break;case 10:var N=g.type._context,j=g.memoizedProps.value;Di(VE,N._currentValue),N._currentValue=j;break;case 13:if(N=g.memoizedState,N!==null)return N.dehydrated!==null?(Di($i,$i.current&1),g.flags|=128,null):(w&g.child.childLanes)!==0?XE(p,g,w):(Di($i,$i.current&1),p=Iu(p,g,w),p!==null?p.sibling:null);Di($i,$i.current&1);break;case 19:if(N=(w&g.childLanes)!==0,(p.flags&128)!==0){if(N)return ZE(p,g,w);g.flags|=128}if(j=g.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),Di($i,$i.current),N)break;return null;case 22:case 23:return g.lanes=0,BI(p,g,w)}return Iu(p,g,w)}var qI,tv,qb,YI;qI=function(p,g){for(var w=g.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===g)break;for(;w.sibling===null;){if(w.return===null||w.return===g)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},tv=function(){},qb=function(p,g,w,N){var j=p.memoizedProps;if(j!==N){p=g.stateNode,Xp(Cu.current);var H=null;switch(w){case"input":j=ct(p,j),N=ct(p,N),H=[];break;case"select":j=Be({},j,{value:void 0}),N=Be({},N,{value:void 0}),H=[];break;case"textarea":j=vt(p,j),N=vt(p,N),H=[];break;default:typeof j.onClick!="function"&&typeof N.onClick=="function"&&(p.onclick=IE)}zn(w,N);var he;w=null;for(st in j)if(!N.hasOwnProperty(st)&&j.hasOwnProperty(st)&&j[st]!=null)if(st==="style"){var Re=j[st];for(he in Re)Re.hasOwnProperty(he)&&(w||(w={}),w[he]="")}else st!=="dangerouslySetInnerHTML"&&st!=="children"&&st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(l.hasOwnProperty(st)?H||(H=[]):(H=H||[]).push(st,null));for(st in N){var Ue=N[st];if(Re=j!=null?j[st]:void 0,N.hasOwnProperty(st)&&Ue!==Re&&(Ue!=null||Re!=null))if(st==="style")if(Re){for(he in Re)!Re.hasOwnProperty(he)||Ue&&Ue.hasOwnProperty(he)||(w||(w={}),w[he]="");for(he in Ue)Ue.hasOwnProperty(he)&&Re[he]!==Ue[he]&&(w||(w={}),w[he]=Ue[he])}else w||(H||(H=[]),H.push(st,w)),w=Ue;else st==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Re=Re?Re.__html:void 0,Ue!=null&&Re!==Ue&&(H=H||[]).push(st,Ue)):st==="children"?typeof Ue!="string"&&typeof Ue!="number"||(H=H||[]).push(st,""+Ue):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&(l.hasOwnProperty(st)?(Ue!=null&&st==="onScroll"&&Bi("scroll",p),H||Re===Ue||(H=[])):(H=H||[]).push(st,Ue))}w&&(H=H||[]).push("style",w);var st=H;(g.updateQueue=st)&&(g.flags|=4)}},YI=function(p,g,w,N){w!==N&&(g.flags|=4)};function P_(p,g){if(!vi)switch(p.tailMode){case"hidden":g=p.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?p.tail=null:w.sibling=null;break;case"collapsed":w=p.tail;for(var N=null;w!==null;)w.alternate!==null&&(N=w),w=w.sibling;N===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:N.sibling=null}}function $o(p){var g=p.alternate!==null&&p.alternate.child===p.child,w=0,N=0;if(g)for(var j=p.child;j!==null;)w|=j.lanes|j.childLanes,N|=j.subtreeFlags&14680064,N|=j.flags&14680064,j.return=p,j=j.sibling;else for(j=p.child;j!==null;)w|=j.lanes|j.childLanes,N|=j.subtreeFlags,N|=j.flags,j.return=p,j=j.sibling;return p.subtreeFlags|=N,p.childLanes=w,g}function nv(p,g,w){var N=g.pendingProps;switch(__(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $o(g),null;case 1:return Ka(g.type)&&PE(),$o(g),null;case 3:return N=g.stateNode,Jp(),Wi($a),Wi(Go),Ob(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(p===null||p.child===null)&&(y_(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,ya!==null&&(gv(ya),ya=null))),tv(p,g),$o(g),null;case 5:xm(g);var j=Xp(Dm.current);if(w=g.type,p!==null&&g.stateNode!=null)qb(p,g,w,N,j),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!N){if(g.stateNode===null)throw Error(i(166));return $o(g),null}if(p=Xp(Cu.current),y_(g)){N=g.stateNode,w=g.type;var H=g.memoizedProps;switch(N[Tu]=g,N[Eh]=H,p=(g.mode&1)!==0,w){case"dialog":Bi("cancel",N),Bi("close",N);break;case"iframe":case"object":case"embed":Bi("load",N);break;case"video":case"audio":for(j=0;j<d_.length;j++)Bi(d_[j],N);break;case"source":Bi("error",N);break;case"img":case"image":case"link":Bi("error",N),Bi("load",N);break;case"details":Bi("toggle",N);break;case"input":Ut(N,H),Bi("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!H.multiple},Bi("invalid",N);break;case"textarea":St(N,H),Bi("invalid",N)}zn(w,H),j=null;for(var he in H)if(H.hasOwnProperty(he)){var Re=H[he];he==="children"?typeof Re=="string"?N.textContent!==Re&&(H.suppressHydrationWarning!==!0&&RE(N.textContent,Re,p),j=["children",Re]):typeof Re=="number"&&N.textContent!==""+Re&&(H.suppressHydrationWarning!==!0&&RE(N.textContent,Re,p),j=["children",""+Re]):l.hasOwnProperty(he)&&Re!=null&&he==="onScroll"&&Bi("scroll",N)}switch(w){case"input":on(N),Te(N,H,!0);break;case"textarea":on(N),dn(N);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(N.onclick=IE)}N=j,g.updateQueue=N,N!==null&&(g.flags|=4)}else{he=j.nodeType===9?j:j.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=vn(w)),p==="http://www.w3.org/1999/xhtml"?w==="script"?(p=he.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof N.is=="string"?p=he.createElement(w,{is:N.is}):(p=he.createElement(w),w==="select"&&(he=p,N.multiple?he.multiple=!0:N.size&&(he.size=N.size))):p=he.createElementNS(p,w),p[Tu]=g,p[Eh]=N,qI(p,g,!1,!1),g.stateNode=p;e:{switch(he=ia(w,N),w){case"dialog":Bi("cancel",p),Bi("close",p),j=N;break;case"iframe":case"object":case"embed":Bi("load",p),j=N;break;case"video":case"audio":for(j=0;j<d_.length;j++)Bi(d_[j],p);j=N;break;case"source":Bi("error",p),j=N;break;case"img":case"image":case"link":Bi("error",p),Bi("load",p),j=N;break;case"details":Bi("toggle",p),j=N;break;case"input":Ut(p,N),j=ct(p,N),Bi("invalid",p);break;case"option":j=N;break;case"select":p._wrapperState={wasMultiple:!!N.multiple},j=Be({},N,{value:void 0}),Bi("invalid",p);break;case"textarea":St(p,N),j=vt(p,N),Bi("invalid",p);break;default:j=N}zn(w,j),Re=j;for(H in Re)if(Re.hasOwnProperty(H)){var Ue=Re[H];H==="style"?As(p,Ue):H==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ue!=null&&sr(p,Ue)):H==="children"?typeof Ue=="string"?(w!=="textarea"||Ue!=="")&&xt(p,Ue):typeof Ue=="number"&&xt(p,""+Ue):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Ue!=null&&H==="onScroll"&&Bi("scroll",p):Ue!=null&&ne(p,H,Ue,he))}switch(w){case"input":on(p),Te(p,N,!1);break;case"textarea":on(p),dn(p);break;case"option":N.value!=null&&p.setAttribute("value",""+rt(N.value));break;case"select":p.multiple=!!N.multiple,H=N.value,H!=null?Et(p,!!N.multiple,H,!1):N.defaultValue!=null&&Et(p,!!N.multiple,N.defaultValue,!0);break;default:typeof j.onClick=="function"&&(p.onclick=IE)}switch(w){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return $o(g),null;case 6:if(p&&g.stateNode!=null)YI(p,g,p.memoizedProps,N);else{if(typeof N!="string"&&g.stateNode===null)throw Error(i(166));if(w=Xp(Dm.current),Xp(Cu.current),y_(g)){if(N=g.stateNode,w=g.memoizedProps,N[Tu]=g,(H=N.nodeValue!==w)&&(p=qa,p!==null))switch(p.tag){case 3:RE(N.nodeValue,w,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&RE(N.nodeValue,w,(p.mode&1)!==0)}H&&(g.flags|=4)}else N=(w.nodeType===9?w:w.ownerDocument).createTextNode(N),N[Tu]=g,g.stateNode=N}return $o(g),null;case 13:if(Wi($i),N=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(vi&&Ya!==null&&(g.mode&1)!==0&&(g.flags&128)===0)gI(),Om(),g.flags|=98560,H=!1;else if(H=y_(g),N!==null&&N.dehydrated!==null){if(p===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[Tu]=g}else Om(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;$o(g),H=!1}else ya!==null&&(gv(ya),ya=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=w,g):(N=N!==null,N!==(p!==null&&p.memoizedState!==null)&&N&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||($i.current&1)!==0?Ls===0&&(Ls=3):iT())),g.updateQueue!==null&&(g.flags|=4),$o(g),null);case 4:return Jp(),tv(p,g),p===null&&Wp(g.stateNode.containerInfo),$o(g),null;case 10:return Cb(g.type._context),$o(g),null;case 17:return Ka(g.type)&&PE(),$o(g),null;case 19:if(Wi($i),H=g.memoizedState,H===null)return $o(g),null;if(N=(g.flags&128)!==0,he=H.rendering,he===null)if(N)P_(H,!1);else{if(Ls!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(he=Ch(p),he!==null){for(g.flags|=128,P_(H,!1),N=he.updateQueue,N!==null&&(g.updateQueue=N,g.flags|=4),g.subtreeFlags=0,N=w,w=g.child;w!==null;)H=w,p=N,H.flags&=14680066,he=H.alternate,he===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=he.childLanes,H.lanes=he.lanes,H.child=he.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=he.memoizedProps,H.memoizedState=he.memoizedState,H.updateQueue=he.updateQueue,H.type=he.type,p=he.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return Di($i,$i.current&1|2),g.child}p=p.sibling}H.tail!==null&&Sn()>zm&&(g.flags|=128,N=!0,P_(H,!1),g.lanes=4194304)}else{if(!N)if(p=Ch(he),p!==null){if(g.flags|=128,N=!0,w=p.updateQueue,w!==null&&(g.updateQueue=w,g.flags|=4),P_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!he.alternate&&!vi)return $o(g),null}else 2*Sn()-H.renderingStartTime>zm&&w!==1073741824&&(g.flags|=128,N=!0,P_(H,!1),g.lanes=4194304);H.isBackwards?(he.sibling=g.child,g.child=he):(w=H.last,w!==null?w.sibling=he:g.child=he,H.last=he)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=Sn(),g.sibling=null,w=$i.current,Di($i,N?w&1|2:w&1),g):($o(g),null);case 22:case 23:return U_(),N=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==N&&(g.flags|=8192),N&&(g.mode&1)!==0?(wc&1073741824)!==0&&($o(g),g.subtreeFlags&6&&(g.flags|=8192)):$o(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function RD(p,g){switch(__(g),g.tag){case 1:return Ka(g.type)&&PE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Jp(),Wi($a),Wi(Go),Ob(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return xm(g),null;case 13:if(Wi($i),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(i(340));Om()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Wi($i),null;case 4:return Jp(),null;case 10:return Cb(g.type._context),null;case 22:case 23:return U_(),null;case 24:return null;default:return null}}var rv=!1,Ko=!1,XI=typeof WeakSet=="function"?WeakSet:Set,rn=null;function Bm(p,g){var w=p.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(N){Qi(p,g,N)}else w.current=null}function O_(p,g,w){try{w()}catch(N){Qi(p,g,N)}}var JI=!1;function Yb(p,g){if(AE=be,p=QR(),c_(p)){if("selectionStart"in p)var w={start:p.selectionStart,end:p.selectionEnd};else e:{w=(w=p.ownerDocument)&&w.defaultView||window;var N=w.getSelection&&w.getSelection();if(N&&N.rangeCount!==0){w=N.anchorNode;var j=N.anchorOffset,H=N.focusNode;N=N.focusOffset;try{w.nodeType,H.nodeType}catch{w=null;break e}var he=0,Re=-1,Ue=-1,st=0,Dt=0,Lt=p,Nt=null;t:for(;;){for(var Qt;Lt!==w||j!==0&&Lt.nodeType!==3||(Re=he+j),Lt!==H||N!==0&&Lt.nodeType!==3||(Ue=he+N),Lt.nodeType===3&&(he+=Lt.nodeValue.length),(Qt=Lt.firstChild)!==null;)Nt=Lt,Lt=Qt;for(;;){if(Lt===p)break t;if(Nt===w&&++st===j&&(Re=he),Nt===H&&++Dt===N&&(Ue=he),(Qt=Lt.nextSibling)!==null)break;Lt=Nt,Nt=Lt.parentNode}Lt=Qt}w=Re===-1||Ue===-1?null:{start:Re,end:Ue}}else w=null}w=w||{start:0,end:0}}else w=null;for(p_={focusedElem:p,selectionRange:w},be=!1,rn=g;rn!==null;)if(g=rn,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,rn=p;else for(;rn!==null;){g=rn;try{var an=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(an!==null){var cn=an.memoizedProps,ms=an.memoizedState,Qe=g.stateNode,Fe=Qe.getSnapshotBeforeUpdate(g.elementType===g.type?cn:Tc(g.type,cn),ms);Qe.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var nt=g.stateNode.containerInfo;nt.nodeType===1?nt.textContent="":nt.nodeType===9&&nt.documentElement&&nt.removeChild(nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(jt){Qi(g,g.return,jt)}if(p=g.sibling,p!==null){p.return=g.return,rn=p;break}rn=g.return}return an=JI,JI=!1,an}function k_(p,g,w){var N=g.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var j=N=N.next;do{if((j.tag&p)===p){var H=j.destroy;j.destroy=void 0,H!==void 0&&O_(g,w,H)}j=j.next}while(j!==N)}}function N_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var w=g=g.next;do{if((w.tag&p)===p){var N=w.create;w.destroy=N()}w=w.next}while(w!==g)}}function Xb(p){var g=p.ref;if(g!==null){var w=p.stateNode;switch(p.tag){case 5:p=w;break;default:p=w}typeof g=="function"?g(p):g.current=p}}function QI(p){var g=p.alternate;g!==null&&(p.alternate=null,QI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[Tu],delete g[Eh],delete g[m_],delete g[mD],delete g[gD])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Jb(p){return p.tag===5||p.tag===3||p.tag===4}function ZI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Jb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Qb(p,g,w){var N=p.tag;if(N===5||N===6)p=p.stateNode,g?w.nodeType===8?w.parentNode.insertBefore(p,g):w.insertBefore(p,g):(w.nodeType===8?(g=w.parentNode,g.insertBefore(p,w)):(g=w,g.appendChild(p)),w=w._reactRootContainer,w!=null||g.onclick!==null||(g.onclick=IE));else if(N!==4&&(p=p.child,p!==null))for(Qb(p,g,w),p=p.sibling;p!==null;)Qb(p,g,w),p=p.sibling}function iv(p,g,w){var N=p.tag;if(N===5||N===6)p=p.stateNode,g?w.insertBefore(p,g):w.appendChild(p);else if(N!==4&&(p=p.child,p!==null))for(iv(p,g,w),p=p.sibling;p!==null;)iv(p,g,w),p=p.sibling}var Eo=null,Qc=!1;function Au(p,g,w){for(w=w.child;w!==null;)eA(p,g,w),w=w.sibling}function eA(p,g,w){if(zo&&typeof zo.onCommitFiberUnmount=="function")try{zo.onCommitFiberUnmount(mu,w)}catch{}switch(w.tag){case 5:Ko||Bm(w,g);case 6:var N=Eo,j=Qc;Eo=null,Au(p,g,w),Eo=N,Qc=j,Eo!==null&&(Qc?(p=Eo,w=w.stateNode,p.nodeType===8?p.parentNode.removeChild(w):p.removeChild(w)):Eo.removeChild(w.stateNode));break;case 18:Eo!==null&&(Qc?(p=Eo,w=w.stateNode,p.nodeType===8?yb(p.parentNode,w):p.nodeType===1&&yb(p,w),Ga(p)):yb(Eo,w.stateNode));break;case 4:N=Eo,j=Qc,Eo=w.stateNode.containerInfo,Qc=!0,Au(p,g,w),Eo=N,Qc=j;break;case 0:case 11:case 14:case 15:if(!Ko&&(N=w.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){j=N=N.next;do{var H=j,he=H.destroy;H=H.tag,he!==void 0&&((H&2)!==0||(H&4)!==0)&&O_(w,g,he),j=j.next}while(j!==N)}Au(p,g,w);break;case 1:if(!Ko&&(Bm(w,g),N=w.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=w.memoizedProps,N.state=w.memoizedState,N.componentWillUnmount()}catch(Re){Qi(w,g,Re)}Au(p,g,w);break;case 21:Au(p,g,w);break;case 22:w.mode&1?(Ko=(N=Ko)||w.memoizedState!==null,Au(p,g,w),Ko=N):Au(p,g,w);break;default:Au(p,g,w)}}function tA(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var w=p.stateNode;w===null&&(w=p.stateNode=new XI),g.forEach(function(N){var j=aA.bind(null,p,N);w.has(N)||(w.add(N),N.then(j,j))})}}function Sa(p,g){var w=g.deletions;if(w!==null)for(var N=0;N<w.length;N++){var j=w[N];try{var H=p,he=g,Re=he;e:for(;Re!==null;){switch(Re.tag){case 5:Eo=Re.stateNode,Qc=!1;break e;case 3:Eo=Re.stateNode.containerInfo,Qc=!0;break e;case 4:Eo=Re.stateNode.containerInfo,Qc=!0;break e}Re=Re.return}if(Eo===null)throw Error(i(160));eA(H,he,j),Eo=null,Qc=!1;var Ue=j.alternate;Ue!==null&&(Ue.return=null),j.return=null}catch(st){Qi(j,g,st)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Zb(g,p),g=g.sibling}function Zb(p,g){var w=p.alternate,N=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Sa(g,p),Qa(p),N&4){try{k_(3,p,p.return),N_(3,p)}catch(cn){Qi(p,p.return,cn)}try{k_(5,p,p.return)}catch(cn){Qi(p,p.return,cn)}}break;case 1:Sa(g,p),Qa(p),N&512&&w!==null&&Bm(w,w.return);break;case 5:if(Sa(g,p),Qa(p),N&512&&w!==null&&Bm(w,w.return),p.flags&32){var j=p.stateNode;try{xt(j,"")}catch(cn){Qi(p,p.return,cn)}}if(N&4&&(j=p.stateNode,j!=null)){var H=p.memoizedProps,he=w!==null?w.memoizedProps:H,Re=p.type,Ue=p.updateQueue;if(p.updateQueue=null,Ue!==null)try{Re==="input"&&H.type==="radio"&&H.name!=null&&fn(j,H),ia(Re,he);var st=ia(Re,H);for(he=0;he<Ue.length;he+=2){var Dt=Ue[he],Lt=Ue[he+1];Dt==="style"?As(j,Lt):Dt==="dangerouslySetInnerHTML"?sr(j,Lt):Dt==="children"?xt(j,Lt):ne(j,Dt,Lt,st)}switch(Re){case"input":Wt(j,H);break;case"textarea":zt(j,H);break;case"select":var Nt=j._wrapperState.wasMultiple;j._wrapperState.wasMultiple=!!H.multiple;var Qt=H.value;Qt!=null?Et(j,!!H.multiple,Qt,!1):Nt!==!!H.multiple&&(H.defaultValue!=null?Et(j,!!H.multiple,H.defaultValue,!0):Et(j,!!H.multiple,H.multiple?[]:"",!1))}j[Eh]=H}catch(cn){Qi(p,p.return,cn)}}break;case 6:if(Sa(g,p),Qa(p),N&4){if(p.stateNode===null)throw Error(i(162));j=p.stateNode,H=p.memoizedProps;try{j.nodeValue=H}catch(cn){Qi(p,p.return,cn)}}break;case 3:if(Sa(g,p),Qa(p),N&4&&w!==null&&w.memoizedState.isDehydrated)try{Ga(g.containerInfo)}catch(cn){Qi(p,p.return,cn)}break;case 4:Sa(g,p),Qa(p);break;case 13:Sa(g,p),Qa(p),j=p.child,j.flags&8192&&(H=j.memoizedState!==null,j.stateNode.isHidden=H,!H||j.alternate!==null&&j.alternate.memoizedState!==null||(uv=Sn())),N&4&&tA(p);break;case 22:if(Dt=w!==null&&w.memoizedState!==null,p.mode&1?(Ko=(st=Ko)||Dt,Sa(g,p),Ko=st):Sa(g,p),Qa(p),N&8192){if(st=p.memoizedState!==null,(p.stateNode.isHidden=st)&&!Dt&&(p.mode&1)!==0)for(rn=p,Dt=p.child;Dt!==null;){for(Lt=rn=Dt;rn!==null;){switch(Nt=rn,Qt=Nt.child,Nt.tag){case 0:case 11:case 14:case 15:k_(4,Nt,Nt.return);break;case 1:Bm(Nt,Nt.return);var an=Nt.stateNode;if(typeof an.componentWillUnmount=="function"){N=Nt,w=Nt.return;try{g=N,an.props=g.memoizedProps,an.state=g.memoizedState,an.componentWillUnmount()}catch(cn){Qi(N,w,cn)}}break;case 5:Bm(Nt,Nt.return);break;case 22:if(Nt.memoizedState!==null){D_(Lt);continue}}Qt!==null?(Qt.return=Nt,rn=Qt):D_(Lt)}Dt=Dt.sibling}e:for(Dt=null,Lt=p;;){if(Lt.tag===5){if(Dt===null){Dt=Lt;try{j=Lt.stateNode,st?(H=j.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Re=Lt.stateNode,Ue=Lt.memoizedProps.style,he=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null,Re.style.display=Pi("display",he))}catch(cn){Qi(p,p.return,cn)}}}else if(Lt.tag===6){if(Dt===null)try{Lt.stateNode.nodeValue=st?"":Lt.memoizedProps}catch(cn){Qi(p,p.return,cn)}}else if((Lt.tag!==22&&Lt.tag!==23||Lt.memoizedState===null||Lt===p)&&Lt.child!==null){Lt.child.return=Lt,Lt=Lt.child;continue}if(Lt===p)break e;for(;Lt.sibling===null;){if(Lt.return===null||Lt.return===p)break e;Dt===Lt&&(Dt=null),Lt=Lt.return}Dt===Lt&&(Dt=null),Lt.sibling.return=Lt.return,Lt=Lt.sibling}}break;case 19:Sa(g,p),Qa(p),N&4&&tA(p);break;case 21:break;default:Sa(g,p),Qa(p)}}function Qa(p){var g=p.flags;if(g&2){try{e:{for(var w=p.return;w!==null;){if(Jb(w)){var N=w;break e}w=w.return}throw Error(i(160))}switch(N.tag){case 5:var j=N.stateNode;N.flags&32&&(xt(j,""),N.flags&=-33);var H=ZI(p);iv(p,H,j);break;case 3:case 4:var he=N.stateNode.containerInfo,Re=ZI(p);Qb(p,Re,he);break;default:throw Error(i(161))}}catch(Ue){Qi(p,p.return,Ue)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Wm(p,g,w){rn=p,eT(p)}function eT(p,g,w){for(var N=(p.mode&1)!==0;rn!==null;){var j=rn,H=j.child;if(j.tag===22&&N){var he=j.memoizedState!==null||rv;if(!he){var Re=j.alternate,Ue=Re!==null&&Re.memoizedState!==null||Ko;Re=rv;var st=Ko;if(rv=he,(Ko=Ue)&&!st)for(rn=j;rn!==null;)he=rn,Ue=he.child,he.tag===22&&he.memoizedState!==null?nA(j):Ue!==null?(Ue.return=he,rn=Ue):nA(j);for(;H!==null;)rn=H,eT(H),H=H.sibling;rn=j,rv=Re,Ko=st}sv(p)}else(j.subtreeFlags&8772)!==0&&H!==null?(H.return=j,rn=H):sv(p)}}function sv(p){for(;rn!==null;){var g=rn;if((g.flags&8772)!==0){var w=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Ko||N_(5,g);break;case 1:var N=g.stateNode;if(g.flags&4&&!Ko)if(w===null)N.componentDidMount();else{var j=g.elementType===g.type?w.memoizedProps:Tc(g.type,w.memoizedProps);N.componentDidUpdate(j,w.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&SI(g,H,N);break;case 3:var he=g.updateQueue;if(he!==null){if(w=null,g.child!==null)switch(g.child.tag){case 5:w=g.child.stateNode;break;case 1:w=g.child.stateNode}SI(g,he,w)}break;case 5:var Re=g.stateNode;if(w===null&&g.flags&4){w=Re;var Ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ue.autoFocus&&w.focus();break;case"img":Ue.src&&(w.src=Ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var st=g.alternate;if(st!==null){var Dt=st.memoizedState;if(Dt!==null){var Lt=Dt.dehydrated;Lt!==null&&Ga(Lt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Ko||g.flags&512&&Xb(g)}catch(Nt){Qi(g,g.return,Nt)}}if(g===p){rn=null;break}if(w=g.sibling,w!==null){w.return=g.return,rn=w;break}rn=g.return}}function D_(p){for(;rn!==null;){var g=rn;if(g===p){rn=null;break}var w=g.sibling;if(w!==null){w.return=g.return,rn=w;break}rn=g.return}}function nA(p){for(;rn!==null;){var g=rn;try{switch(g.tag){case 0:case 11:case 15:var w=g.return;try{N_(4,g)}catch(Ue){Qi(g,w,Ue)}break;case 1:var N=g.stateNode;if(typeof N.componentDidMount=="function"){var j=g.return;try{N.componentDidMount()}catch(Ue){Qi(g,j,Ue)}}var H=g.return;try{Xb(g)}catch(Ue){Qi(g,H,Ue)}break;case 5:var he=g.return;try{Xb(g)}catch(Ue){Qi(g,he,Ue)}}}catch(Ue){Qi(g,g.return,Ue)}if(g===p){rn=null;break}var Re=g.sibling;if(Re!==null){Re.return=g.return,rn=Re;break}rn=g.return}}var ID=Math.ceil,ov=oe.ReactCurrentDispatcher,av=oe.ReactCurrentOwner,Zc=oe.ReactCurrentBatchConfig,jr=0,lo=null,fs=null,xs=0,wc=0,Wl=Kc(0),Ls=0,vo=null,tf=0,cv=0,lv=0,x_=null,ba=null,uv=0,zm=1/0,Pu=null,dv=!1,tT=null,Ah=null,Gm=!1,Ou=null,hv=0,nf=0,nT=null,L_=-1,pv=0;function So(){return(jr&6)!==0?Sn():L_!==-1?L_:L_=Sn()}function el(p){return(p.mode&1)===0?1:(jr&2)!==0&&xs!==0?xs&-xs:yD.transition!==null?(pv===0&&(pv=fd()),pv):(p=pr,p!==0||(p=window.event,p=p===void 0?16:Zr(p.type)),p)}function tl(p,g,w,N){if(50<nf)throw nf=0,nT=null,Error(i(185));yu(p,w,N),((jr&2)===0||p!==lo)&&(p===lo&&((jr&2)===0&&(cv|=w),Ls===4&&Od(p,xs)),qo(p,N),w===1&&jr===0&&(g.mode&1)===0&&(zm=Sn()+500,NE&&Sh()))}function qo(p,g){var w=p.callbackNode;_c(p,g);var N=_u(p,p===lo?xs:0);if(N===0)w!==null&&gc(w),p.callbackNode=null,p.callbackPriority=0;else if(g=N&-N,p.callbackPriority!==g){if(w!=null&&gc(w),g===1)p.tag===0?_D(rf.bind(null,p)):hI(rf.bind(null,p)),pD(function(){(jr&6)===0&&Sh()}),w=null;else{switch(Bc(N)){case 1:w=Fc;break;case 4:w=Ll;break;case 16:w=Wa;break;case 536870912:w=hh;break;default:w=Wa}w=V_(w,fv.bind(null,p))}p.callbackPriority=g,p.callbackNode=w}}function fv(p,g){if(L_=-1,pv=0,(jr&6)!==0)throw Error(i(327));var w=p.callbackNode;if(Hm()&&p.callbackNode!==w)return null;var N=_u(p,p===lo?xs:0);if(N===0)return null;if((N&30)!==0||(N&p.expiredLanes)!==0||g)g=ku(p,N);else{g=N;var j=jr;jr|=2;var H=rA();(lo!==p||xs!==g)&&(Pu=null,zm=Sn()+500,Ph(p,g));do try{AD();break}catch(Re){rT(p,Re)}while(!0);wb(),ov.current=H,jr=j,fs!==null?g=0:(lo=null,xs=0,g=Ls)}if(g!==0){if(g===2&&(j=aa(p),j!==0&&(N=j,g=mv(p,j))),g===1)throw w=vo,Ph(p,0),Od(p,N),qo(p,Sn()),w;if(g===6)Od(p,N);else{if(j=p.current.alternate,(N&30)===0&&!_v(j)&&(g=ku(p,N),g===2&&(H=aa(p),H!==0&&(N=H,g=mv(p,H))),g===1))throw w=vo,Ph(p,0),Od(p,N),qo(p,Sn()),w;switch(p.finishedWork=j,p.finishedLanes=N,g){case 0:case 1:throw Error(i(345));case 2:sf(p,ba,Pu);break;case 3:if(Od(p,N),(N&130023424)===N&&(g=uv+500-Sn(),10<g)){if(_u(p,0)!==0)break;if(j=p.suspendedLanes,(j&N)!==N){So(),p.pingedLanes|=p.suspendedLanes&j;break}p.timeoutHandle=f_(sf.bind(null,p,ba,Pu),g);break}sf(p,ba,Pu);break;case 4:if(Od(p,N),(N&4194240)===N)break;for(g=p.eventTimes,j=-1;0<N;){var he=31-yo(N);H=1<<he,he=g[he],he>j&&(j=he),N&=~H}if(N=j,N=Sn()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*ID(N/1960))-N,10<N){p.timeoutHandle=f_(sf.bind(null,p,ba,Pu),N);break}sf(p,ba,Pu);break;case 5:sf(p,ba,Pu);break;default:throw Error(i(329))}}}return qo(p,Sn()),p.callbackNode===w?fv.bind(null,p):null}function mv(p,g){var w=x_;return p.current.memoizedState.isDehydrated&&(Ph(p,g).flags|=256),p=ku(p,g),p!==2&&(g=ba,ba=w,g!==null&&gv(g)),p}function gv(p){ba===null?ba=p:ba.push.apply(ba,p)}function _v(p){for(var g=p;;){if(g.flags&16384){var w=g.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var N=0;N<w.length;N++){var j=w[N],H=j.getSnapshot;j=j.value;try{if(!Bl(H(),j))return!1}catch{return!1}}}if(w=g.child,g.subtreeFlags&16384&&w!==null)w.return=g,g=w;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Od(p,g){for(g&=~lv,g&=~cv,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var w=31-yo(g),N=1<<w;p[w]=-1,g&=~N}}function rf(p){if((jr&6)!==0)throw Error(i(327));Hm();var g=_u(p,0);if((g&1)===0)return qo(p,Sn()),null;var w=ku(p,g);if(p.tag!==0&&w===2){var N=aa(p);N!==0&&(g=N,w=mv(p,N))}if(w===1)throw w=vo,Ph(p,0),Od(p,g),qo(p,Sn()),w;if(w===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,sf(p,ba,Pu),qo(p,Sn()),null}function M_(p,g){var w=jr;jr|=1;try{return p(g)}finally{jr=w,jr===0&&(zm=Sn()+500,NE&&Sh())}}function kd(p){Ou!==null&&Ou.tag===0&&(jr&6)===0&&Hm();var g=jr;jr|=1;var w=Zc.transition,N=pr;try{if(Zc.transition=null,pr=1,p)return p()}finally{pr=N,Zc.transition=w,jr=g,(jr&6)===0&&Sh()}}function U_(){wc=Wl.current,Wi(Wl)}function Ph(p,g){p.finishedWork=null,p.finishedLanes=0;var w=p.timeoutHandle;if(w!==-1&&(p.timeoutHandle=-1,hD(w)),fs!==null)for(w=fs.return;w!==null;){var N=w;switch(__(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&PE();break;case 3:Jp(),Wi($a),Wi(Go),Ob();break;case 5:xm(N);break;case 4:Jp();break;case 13:Wi($i);break;case 19:Wi($i);break;case 10:Cb(N.type._context);break;case 22:case 23:U_()}w=w.return}if(lo=p,fs=p=Nd(p.current,null),xs=wc=g,Ls=0,vo=null,lv=cv=tf=0,ba=x_=null,Yp!==null){for(g=0;g<Yp.length;g++)if(w=Yp[g],N=w.interleaved,N!==null){w.interleaved=null;var j=N.next,H=w.pending;if(H!==null){var he=H.next;H.next=j,N.next=he}w.pending=N}Yp=null}return p}function rT(p,g){do{var w=fs;try{if(wb(),BE.current=HE,Lm){for(var N=Ji.memoizedState;N!==null;){var j=N.queue;j!==null&&(j.pending=null),N=N.next}Lm=!1}if(Ru=0,Ds=Ns=Ji=null,C_=!1,R_=0,av.current=null,w===null||w.return===null){Ls=1,vo=g,fs=null;break}e:{var H=p,he=w.return,Re=w,Ue=g;if(g=xs,Re.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var st=Ue,Dt=Re,Lt=Dt.tag;if((Dt.mode&1)===0&&(Lt===0||Lt===11||Lt===15)){var Nt=Dt.alternate;Nt?(Dt.updateQueue=Nt.updateQueue,Dt.memoizedState=Nt.memoizedState,Dt.lanes=Nt.lanes):(Dt.updateQueue=null,Dt.memoizedState=null)}var Qt=UI(he);if(Qt!==null){Qt.flags&=-257,VI(Qt,he,Re,H,g),Qt.mode&1&&MI(H,st,g),g=Qt,Ue=st;var an=g.updateQueue;if(an===null){var cn=new Set;cn.add(Ue),g.updateQueue=cn}else an.add(Ue);break e}else{if((g&1)===0){MI(H,st,g),iT();break e}Ue=Error(i(426))}}else if(vi&&Re.mode&1){var ms=UI(he);if(ms!==null){(ms.flags&65536)===0&&(ms.flags|=256),VI(ms,he,Re,H,g),bb(jm(Ue,Re));break e}}H=Ue=jm(Ue,Re),Ls!==4&&(Ls=2),x_===null?x_=[H]:x_.push(H),H=he;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Qe=Gb(H,Ue,g);vI(H,Qe);break e;case 1:Re=Ue;var Fe=H.type,nt=H.stateNode;if((H.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||nt!==null&&typeof nt.componentDidCatch=="function"&&(Ah===null||!Ah.has(nt)))){H.flags|=65536,g&=-g,H.lanes|=g;var jt=Pd(H,Re,g);vI(H,jt);break e}}H=H.return}while(H!==null)}sA(w)}catch(ln){g=ln,fs===w&&w!==null&&(fs=w=w.return);continue}break}while(!0)}function rA(){var p=ov.current;return ov.current=HE,p===null?HE:p}function iT(){(Ls===0||Ls===3||Ls===2)&&(Ls=4),lo===null||(tf&268435455)===0&&(cv&268435455)===0||Od(lo,xs)}function ku(p,g){var w=jr;jr|=2;var N=rA();(lo!==p||xs!==g)&&(Pu=null,Ph(p,g));do try{iA();break}catch(j){rT(p,j)}while(!0);if(wb(),jr=w,ov.current=N,fs!==null)throw Error(i(261));return lo=null,xs=0,Ls}function iA(){for(;fs!==null;)yv(fs)}function AD(){for(;fs!==null&&!Fi();)yv(fs)}function yv(p){var g=Sv(p.alternate,p,wc);p.memoizedProps=p.pendingProps,g===null?sA(p):fs=g,av.current=null}function sA(p){var g=p;do{var w=g.alternate;if(p=g.return,(g.flags&32768)===0){if(w=nv(w,g,wc),w!==null){fs=w;return}}else{if(w=RD(w,g),w!==null){w.flags&=32767,fs=w;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Ls=6,fs=null;return}}if(g=g.sibling,g!==null){fs=g;return}fs=g=p}while(g!==null);Ls===0&&(Ls=5)}function sf(p,g,w){var N=pr,j=Zc.transition;try{Zc.transition=null,pr=1,PD(p,g,w,N)}finally{Zc.transition=j,pr=N}return null}function PD(p,g,w,N){do Hm();while(Ou!==null);if((jr&6)!==0)throw Error(i(327));w=p.finishedWork;var j=p.finishedLanes;if(w===null)return null;if(p.finishedWork=null,p.finishedLanes=0,w===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var H=w.lanes|w.childLanes;if(ri(p,H),p===lo&&(fs=lo=null,xs=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||Gm||(Gm=!0,V_(Wa,function(){return Hm(),null})),H=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||H){H=Zc.transition,Zc.transition=null;var he=pr;pr=1;var Re=jr;jr|=4,av.current=null,Yb(p,w),Zb(w,p),db(p_),be=!!AE,p_=AE=null,p.current=w,Wm(w),hs(),jr=Re,pr=he,Zc.transition=H}else p.current=w;if(Gm&&(Gm=!1,Ou=p,hv=j),H=p.pendingLanes,H===0&&(Ah=null),dm(w.stateNode),qo(p,Sn()),g!==null)for(N=p.onRecoverableError,w=0;w<g.length;w++)j=g[w],N(j.value,{componentStack:j.stack,digest:j.digest});if(dv)throw dv=!1,p=tT,tT=null,p;return(hv&1)!==0&&p.tag!==0&&Hm(),H=p.pendingLanes,(H&1)!==0?p===nT?nf++:(nf=0,nT=p):nf=0,Sh(),null}function Hm(){if(Ou!==null){var p=Bc(hv),g=Zc.transition,w=pr;try{if(Zc.transition=null,pr=16>p?16:p,Ou===null)var N=!1;else{if(p=Ou,Ou=null,hv=0,(jr&6)!==0)throw Error(i(331));var j=jr;for(jr|=4,rn=p.current;rn!==null;){var H=rn,he=H.child;if((rn.flags&16)!==0){var Re=H.deletions;if(Re!==null){for(var Ue=0;Ue<Re.length;Ue++){var st=Re[Ue];for(rn=st;rn!==null;){var Dt=rn;switch(Dt.tag){case 0:case 11:case 15:k_(8,Dt,H)}var Lt=Dt.child;if(Lt!==null)Lt.return=Dt,rn=Lt;else for(;rn!==null;){Dt=rn;var Nt=Dt.sibling,Qt=Dt.return;if(QI(Dt),Dt===st){rn=null;break}if(Nt!==null){Nt.return=Qt,rn=Nt;break}rn=Qt}}}var an=H.alternate;if(an!==null){var cn=an.child;if(cn!==null){an.child=null;do{var ms=cn.sibling;cn.sibling=null,cn=ms}while(cn!==null)}}rn=H}}if((H.subtreeFlags&2064)!==0&&he!==null)he.return=H,rn=he;else e:for(;rn!==null;){if(H=rn,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:k_(9,H,H.return)}var Qe=H.sibling;if(Qe!==null){Qe.return=H.return,rn=Qe;break e}rn=H.return}}var Fe=p.current;for(rn=Fe;rn!==null;){he=rn;var nt=he.child;if((he.subtreeFlags&2064)!==0&&nt!==null)nt.return=he,rn=nt;else e:for(he=Fe;rn!==null;){if(Re=rn,(Re.flags&2048)!==0)try{switch(Re.tag){case 0:case 11:case 15:N_(9,Re)}}catch(ln){Qi(Re,Re.return,ln)}if(Re===he){rn=null;break e}var jt=Re.sibling;if(jt!==null){jt.return=Re.return,rn=jt;break e}rn=Re.return}}if(jr=j,Sh(),zo&&typeof zo.onPostCommitFiberRoot=="function")try{zo.onPostCommitFiberRoot(mu,p)}catch{}N=!0}return N}finally{pr=w,Zc.transition=g}}return!1}function Ev(p,g,w){g=jm(w,g),g=Gb(p,g,1),p=wh(p,g,1),g=So(),p!==null&&(yu(p,1,g),qo(p,g))}function Qi(p,g,w){if(p.tag===3)Ev(p,p,w);else for(;g!==null;){if(g.tag===3){Ev(g,p,w);break}else if(g.tag===1){var N=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(Ah===null||!Ah.has(N))){p=jm(w,p),p=Pd(g,p,1),g=wh(g,p,1),p=So(),g!==null&&(yu(g,1,p),qo(g,p));break}}g=g.return}}function oA(p,g,w){var N=p.pingCache;N!==null&&N.delete(g),g=So(),p.pingedLanes|=p.suspendedLanes&w,lo===p&&(xs&w)===w&&(Ls===4||Ls===3&&(xs&130023424)===xs&&500>Sn()-uv?Ph(p,0):lv|=w),qo(p,g)}function sT(p,g){g===0&&((p.mode&1)===0?g=1:(g=wr,wr<<=1,(wr&130023424)===0&&(wr=4194304)));var w=So();p=Rd(p,g),p!==null&&(yu(p,g,w),qo(p,w))}function vv(p){var g=p.memoizedState,w=0;g!==null&&(w=g.retryLane),sT(p,w)}function aA(p,g){var w=0;switch(p.tag){case 13:var N=p.stateNode,j=p.memoizedState;j!==null&&(w=j.retryLane);break;case 19:N=p.stateNode;break;default:throw Error(i(314))}N!==null&&N.delete(g),sT(p,w)}var Sv;Sv=function(p,g,w){if(p!==null)if(p.memoizedProps!==g.pendingProps||$a.current)Ja=!0;else{if((p.lanes&w)===0&&(g.flags&128)===0)return Ja=!1,KI(p,g,w);Ja=(p.flags&131072)!==0}else Ja=!1,vi&&(g.flags&1048576)!==0&&xE(g,DE,g.index);switch(g.lanes=0,g.tag){case 2:var N=g.type;ev(p,g),p=g.pendingProps;var j=Kp(g,Go.current);Cd(g,w),j=Mm(null,g,N,p,j,w);var H=Db();return g.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ka(N)?(H=!0,kE(g)):H=!1,g.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,S_(g),j.updater=KE,g.stateNode=j,j._reactInternals=g,Bb(g,N,p,w),g=YE(null,g,N,!0,H,w)):(g.tag=0,vi&&H&&LE(g),va(null,g,j,w),g=g.child),g;case 16:N=g.elementType;e:{switch(ev(p,g),p=g.pendingProps,j=N._init,N=j(N._payload),g.type=N,j=g.tag=of(N),p=Tc(N,p),j){case 0:g=Hb(null,g,N,p,w);break e;case 1:g=zI(null,g,N,p,w);break e;case 11:g=qE(null,g,N,p,w);break e;case 14:g=jI(null,g,N,Tc(N.type,p),w);break e}throw Error(i(306,N,""))}return g;case 0:return N=g.type,j=g.pendingProps,j=g.elementType===N?j:Tc(N,j),Hb(p,g,N,j,w);case 1:return N=g.type,j=g.pendingProps,j=g.elementType===N?j:Tc(N,j),zI(p,g,N,j,w);case 3:e:{if($b(g),p===null)throw Error(i(387));N=g.pendingProps,H=g.memoizedState,j=H.element,EI(p,g),FE(g,N,null,w);var he=g.memoizedState;if(N=he.element,H.isDehydrated)if(H={element:N,isDehydrated:!1,cache:he.cache,pendingSuspenseBoundaries:he.pendingSuspenseBoundaries,transitions:he.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){j=jm(Error(i(423)),g),g=GI(p,g,N,w,j);break e}else if(N!==j){j=jm(Error(i(424)),g),g=GI(p,g,N,w,j);break e}else for(Ya=yh(g.stateNode.containerInfo.firstChild),qa=g,vi=!0,ya=null,w=_I(g,null,N,w),g.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(Om(),N===j){g=Iu(p,g,w);break e}va(p,g,N,w)}g=g.child}return g;case 5:return bI(g),p===null&&Sb(g),N=g.type,j=g.pendingProps,H=p!==null?p.memoizedProps:null,he=j.children,_b(N,j)?he=null:H!==null&&_b(N,H)&&(g.flags|=32),WI(p,g),va(p,g,he,w),g.child;case 6:return p===null&&Sb(g),null;case 13:return XE(p,g,w);case 4:return Ab(g,g.stateNode.containerInfo),N=g.pendingProps,p===null?g.child=km(g,null,N,w):va(p,g,N,w),g.child;case 11:return N=g.type,j=g.pendingProps,j=g.elementType===N?j:Tc(N,j),qE(p,g,N,j,w);case 7:return va(p,g,g.pendingProps,w),g.child;case 8:return va(p,g,g.pendingProps.children,w),g.child;case 12:return va(p,g,g.pendingProps.children,w),g.child;case 10:e:{if(N=g.type._context,j=g.pendingProps,H=g.memoizedProps,he=j.value,Di(VE,N._currentValue),N._currentValue=he,H!==null)if(Bl(H.value,he)){if(H.children===j.children&&!$a.current){g=Iu(p,g,w);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Re=H.dependencies;if(Re!==null){he=H.child;for(var Ue=Re.firstContext;Ue!==null;){if(Ue.context===N){if(H.tag===1){Ue=wu(-1,w&-w),Ue.tag=2;var st=H.updateQueue;if(st!==null){st=st.shared;var Dt=st.pending;Dt===null?Ue.next=Ue:(Ue.next=Dt.next,Dt.next=Ue),st.pending=Ue}}H.lanes|=w,Ue=H.alternate,Ue!==null&&(Ue.lanes|=w),Rb(H.return,w,g),Re.lanes|=w;break}Ue=Ue.next}}else if(H.tag===10)he=H.type===g.type?null:H.child;else if(H.tag===18){if(he=H.return,he===null)throw Error(i(341));he.lanes|=w,Re=he.alternate,Re!==null&&(Re.lanes|=w),Rb(he,w,g),he=H.sibling}else he=H.child;if(he!==null)he.return=H;else for(he=H;he!==null;){if(he===g){he=null;break}if(H=he.sibling,H!==null){H.return=he.return,he=H;break}he=he.return}H=he}va(p,g,j.children,w),g=g.child}return g;case 9:return j=g.type,N=g.pendingProps.children,Cd(g,w),j=Xc(j),N=N(j),g.flags|=1,va(p,g,N,w),g.child;case 14:return N=g.type,j=Tc(N,g.pendingProps),j=Tc(N.type,j),jI(p,g,N,j,w);case 15:return FI(p,g,g.type,g.pendingProps,w);case 17:return N=g.type,j=g.pendingProps,j=g.elementType===N?j:Tc(N,j),ev(p,g),g.tag=1,Ka(N)?(p=!0,kE(g)):p=!1,Cd(g,w),xI(g,N,j),Bb(g,N,j,w),YE(null,g,N,!0,p,w);case 19:return ZE(p,g,w);case 22:return BI(p,g,w)}throw Error(i(156,g.tag))};function V_(p,g){return fu(p,g)}function bv(p,g,w,N){this.tag=p,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cc(p,g,w,N){return new bv(p,g,w,N)}function Oh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function of(p){if(typeof p=="function")return Oh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===ue)return 11;if(p===xe)return 14}return 2}function Nd(p,g){var w=p.alternate;return w===null?(w=Cc(p.tag,g,p.key,p.mode),w.elementType=p.elementType,w.type=p.type,w.stateNode=p.stateNode,w.alternate=p,p.alternate=w):(w.pendingProps=g,w.type=p.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=p.flags&14680064,w.childLanes=p.childLanes,w.lanes=p.lanes,w.child=p.child,w.memoizedProps=p.memoizedProps,w.memoizedState=p.memoizedState,w.updateQueue=p.updateQueue,g=p.dependencies,w.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},w.sibling=p.sibling,w.index=p.index,w.ref=p.ref,w}function Tv(p,g,w,N,j,H){var he=2;if(N=p,typeof p=="function")Oh(p)&&(he=1);else if(typeof p=="string")he=5;else e:switch(p){case Y:return af(w.children,j,H,g);case Z:he=8,j|=8;break;case X:return p=Cc(12,w,g,j|2),p.elementType=X,p.lanes=H,p;case pe:return p=Cc(13,w,g,j),p.elementType=pe,p.lanes=H,p;case ke:return p=Cc(19,w,g,j),p.elementType=ke,p.lanes=H,p;case Oe:return kh(w,j,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ie:he=10;break e;case de:he=9;break e;case ue:he=11;break e;case xe:he=14;break e;case je:he=16,N=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return g=Cc(he,w,g,j),g.elementType=p,g.type=N,g.lanes=H,g}function af(p,g,w,N){return p=Cc(7,p,N,g),p.lanes=w,p}function kh(p,g,w,N){return p=Cc(22,p,N,g),p.elementType=Oe,p.lanes=w,p.stateNode={isHidden:!1},p}function oT(p,g,w){return p=Cc(6,p,null,g),p.lanes=w,p}function aT(p,g,w){return g=Cc(4,p.children!==null?p.children:[],p.key,g),g.lanes=w,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function OD(p,g,w,N,j){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ul(0),this.expirationTimes=Ul(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ul(0),this.identifierPrefix=N,this.onRecoverableError=j,this.mutableSourceEagerHydrationData=null}function cT(p,g,w,N,j,H,he,Re,Ue){return p=new OD(p,g,w,Re,Ue),g===1?(g=1,H===!0&&(g|=8)):g=0,H=Cc(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:N,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},S_(H),p}function kD(p,g,w){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:le,key:N==null?null:""+N,children:p,containerInfo:g,implementation:w}}function cA(p){if(!p)return vh;p=p._reactInternals;e:{if(Xi(p)!==p||p.tag!==1)throw Error(i(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ka(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(p.tag===1){var w=p.type;if(Ka(w))return OE(p,w,g)}return g}function wv(p,g,w,N,j,H,he,Re,Ue){return p=cT(w,N,!0,p,j,H,he,Re,Ue),p.context=cA(null),w=p.current,N=So(),j=el(w),H=wu(N,j),H.callback=g??null,wh(w,H,j),p.current.lanes=j,yu(p,j,N),qo(p,N),p}function j_(p,g,w,N){var j=g.current,H=So(),he=el(j);return w=cA(w),g.context===null?g.context=w:g.pendingContext=w,g=wu(H,he),g.payload={element:p},N=N===void 0?null:N,N!==null&&(g.callback=N),p=wh(j,g,he),p!==null&&(tl(p,j,he,H),b_(p,j,he)),he}function Cv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function lT(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var w=p.retryLane;p.retryLane=w!==0&&w<g?w:g}}function uT(p,g){lT(p,g),(p=p.alternate)&&lT(p,g)}function F_(){return null}var zl=typeof reportError=="function"?reportError:function(p){console.error(p)};function Rv(p){this._internalRoot=p}Iv.prototype.render=Rv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(i(409));j_(p,g,null,null)},Iv.prototype.unmount=Rv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;kd(function(){j_(null,p,null,null)}),g[$c]=null}};function Iv(p){this._internalRoot=p}Iv.prototype.unstable_scheduleHydration=function(p){if(p){var g=xp();p={blockedOn:null,target:p,priority:g};for(var w=0;w<ha.length&&g!==0&&g<ha[w].priority;w++);ha.splice(w,0,p),w===0&&Mp(p)}};function dT(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function $m(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function hT(){}function ND(p,g,w,N,j){if(j){if(typeof N=="function"){var H=N;N=function(){var st=Cv(he);H.call(st)}}var he=wv(g,N,p,0,null,!1,!1,"",hT);return p._reactRootContainer=he,p[$c]=he.current,Wp(p.nodeType===8?p.parentNode:p),kd(),he}for(;j=p.lastChild;)p.removeChild(j);if(typeof N=="function"){var Re=N;N=function(){var st=Cv(Ue);Re.call(st)}}var Ue=cT(p,0,!1,null,null,!1,!1,"",hT);return p._reactRootContainer=Ue,p[$c]=Ue.current,Wp(p.nodeType===8?p.parentNode:p),kd(function(){j_(g,Ue,w,N)}),Ue}function cf(p,g,w,N,j){var H=w._reactRootContainer;if(H){var he=H;if(typeof j=="function"){var Re=j;j=function(){var Ue=Cv(he);Re.call(Ue)}}j_(g,he,p,j)}else he=ND(w,g,p,j,N);return Cv(he)}hm=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var w=gu(g.pendingLanes);w!==0&&(yc(g,w|1),qo(g,Sn()),(jr&6)===0&&(zm=Sn()+500,Sh()))}break;case 13:kd(function(){var N=Rd(p,1);if(N!==null){var j=So();tl(N,p,1,j)}}),uT(p,1)}},Eu=function(p){if(p.tag===13){var g=Rd(p,134217728);if(g!==null){var w=So();tl(g,p,134217728,w)}uT(p,134217728)}},mh=function(p){if(p.tag===13){var g=el(p),w=Rd(p,g);if(w!==null){var N=So();tl(w,p,g,N)}uT(p,g)}},xp=function(){return pr},pm=function(p,g){var w=pr;try{return pr=p,g()}finally{pr=w}},jc=function(p,g,w){switch(g){case"input":if(Wt(p,w),g=w.name,w.type==="radio"&&g!=null){for(w=p;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<w.length;g++){var N=w[g];if(N!==p&&N.form===p.form){var j=Im(N);if(!j)throw Error(i(90));dt(N),Wt(N,j)}}}break;case"textarea":zt(p,w);break;case"select":g=w.value,g!=null&&Et(p,!!w.multiple,g,!1)}},Ol=M_,Fa=kd;var Nh={usingClientEntryPoint:!1,Events:[Rm,Hp,Im,ja,fc,M_]},Dd={findFiberByHostInstance:Gp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},DD={bundleType:Dd.bundleType,version:Dd.version,rendererPackageName:Dd.rendererPackageName,rendererConfig:Dd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oe.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=xl(p),p===null?null:p.stateNode},findFiberByHostInstance:Dd.findFiberByHostInstance||F_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Av=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Av.isDisabled&&Av.supportsFiber)try{mu=Av.inject(DD),zo=Av}catch{}}return ml.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nh,ml.createPortal=function(p,g){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dT(g))throw Error(i(200));return kD(p,g,null,w)},ml.createRoot=function(p,g){if(!dT(p))throw Error(i(299));var w=!1,N="",j=zl;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(N=g.identifierPrefix),g.onRecoverableError!==void 0&&(j=g.onRecoverableError)),g=cT(p,1,!1,null,null,w,!1,N,j),p[$c]=g.current,Wp(p.nodeType===8?p.parentNode:p),new Rv(g)},ml.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=xl(g),p=p===null?null:p.stateNode,p},ml.flushSync=function(p){return kd(p)},ml.hydrate=function(p,g,w){if(!$m(g))throw Error(i(200));return cf(null,p,g,!0,w)},ml.hydrateRoot=function(p,g,w){if(!dT(p))throw Error(i(405));var N=w!=null&&w.hydratedSources||null,j=!1,H="",he=zl;if(w!=null&&(w.unstable_strictMode===!0&&(j=!0),w.identifierPrefix!==void 0&&(H=w.identifierPrefix),w.onRecoverableError!==void 0&&(he=w.onRecoverableError)),g=wv(g,null,p,1,w??null,j,!1,H,he),p[$c]=g.current,Wp(p),N)for(p=0;p<N.length;p++)w=N[p],j=w._getVersion,j=j(w._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[w,j]:g.mutableSourceEagerHydrationData.push(w,j);return new Iv(g)},ml.render=function(p,g,w){if(!$m(g))throw Error(i(200));return cf(null,p,g,!1,w)},ml.unmountComponentAtNode=function(p){if(!$m(p))throw Error(i(40));return p._reactRootContainer?(kd(function(){cf(null,null,p,!1,function(){p._reactRootContainer=null,p[$c]=null})}),!0):!1},ml.unstable_batchedUpdates=M_,ml.unstable_renderSubtreeIntoContainer=function(p,g,w,N){if(!$m(w))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return cf(p,g,w,!1,N)},ml.version="18.3.1-next-f1338f8080-20240426",ml}var zK;function NZ(){if(zK)return R2.exports;zK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),R2.exports=NEe(),R2.exports}var GK;function DEe(){if(GK)return IO;GK=1;var n=NZ();return IO.createRoot=n.createRoot,IO.hydrateRoot=n.hydrateRoot,IO}var xEe=DEe();const MN=Xg(xEe);function LEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function UN(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function MEe(){return!!(globalThis!=null&&globalThis.document)}function DZ(n){return n.parentElement&&DZ(n.parentElement)?!0:n.hidden}function UEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function VEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function jEe(n){var e;return((e=xZ(n))==null?void 0:e.defaultView)??window}function xZ(n){return UN(n)?n.ownerDocument:document}function FEe(n){return n.view??window}function BEe(n){return xZ(n).activeElement}function WEe(n){const e=FEe(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function LZ(n){return!!n.touches}function zEe(n){return LZ(n)&&n.touches.length>1}function GEe(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function HEe(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function MZ(n,e="page"){return LZ(n)?GEe(n,e):HEe(n,e)}function $Ee(n){return e=>{const i=WEe(e);(!i||i&&e.button===0)&&n(e)}}function KEe(n,e=!1){function i(l){n(l,{point:MZ(l)})}return e?$Ee(i):i}function ak(n,e,i,o){return LEe(n,e,KEe(i,e==="pointerdown"),o)}function qEe(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const rr=n=>n?"":void 0,Bf=n=>n?!0:void 0;function YEe(n){return Array.isArray(n)}function nd(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!YEe(n)}function XEe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function JEe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function ZU(n){if(n==null)return n;const{unitless:e}=JEe(n);return e||typeof n=="number"?`${n}px`:n}const UZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,jj=n=>Object.fromEntries(Object.entries(n).sort(UZ));function HK(n){const e=jj(n);return Object.assign(Object.values(e),e)}function QEe(n){const e=Object.keys(jj(n));return new Set(e)}function $K(n){if(!n)return n;n=ZU(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function $w(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${ZU(n)})`),e&&i.push("and",`(max-width: ${ZU(e)})`),i.join(" ")}function ZEe(n){if(!n)return null;n.base=n.base??"0px";const e=HK(n),i=Object.entries(n).sort(UZ).map(([u,f],_,E)=>{let[,S]=E[_+1]??[];return S=parseFloat(S)>0?$K(S):void 0,{_minW:$K(f),breakpoint:u,minW:f,maxW:S,maxWQuery:$w(null,S),minWQuery:$w(f),minMaxQuery:$w(f,S)}}),o=QEe(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(u){const f=Object.keys(u);return f.length>0&&f.every(_=>o.has(_))},asObject:jj(n),asArray:HK(n),details:i,get(u){return i.find(f=>f.breakpoint===u)},media:[null,...e.map(u=>$w(u)).slice(1)],toArrayValue(u){if(!nd(u))throw new Error("toArrayValue: value must be an object");const f=l.map(_=>u[_]??null);for(;XEe(f)===null;)f.pop();return f},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((f,_,E)=>{const S=l[E];return S!=null&&_!=null&&(f[S]=_),f},{})}}}function VZ(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function Dn(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function VN(n){return k.Children.toArray(n).filter(e=>k.isValidElement(e))}function jN(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function eve(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ai(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:u,defaultValue:f}=n,_=k.createContext(f);_.displayName=e;function E(){var C;const S=k.useContext(_);if(!S&&i){const I=new Error(u??eve(o,l));throw I.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,I,E),I}return S}return[_.Provider,E,_]}const gn=(...n)=>n.filter(Boolean).join(" "),jZ=n=>n.hasAttribute("tabindex"),tve=n=>jZ(n)&&n.tabIndex===-1;function Hk(n){if(!UN(n)||DZ(n)||VEe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():UEe(n)?!0:jZ(n)}function nve(n){return n?UN(n)&&Hk(n)&&!tve(n):!1}const rve=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],ive=rve.join(),sve=n=>n.offsetWidth>0&&n.offsetHeight>0;function FZ(n){const e=Array.from(n.querySelectorAll(ive));return e.unshift(n),e.filter(i=>Hk(i)&&sve(i))}function ove(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const ave=n=>{const e=new WeakMap;return(o,l,u,f)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,u,f);return _.set(l,E),E}},BZ=ave(ove),cve=n=>n.default||n;function Fj(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function lve(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function Bj(n,e){let i=lve(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function eV(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function KK(n,e,i){return(n-e)*100/(i-e)}function uve(n,e,i){return(i-e)*n+e}function qK(n,e,i){const o=Math.round((n-e)/i)*i+e,l=eV(i);return Bj(o,l)}function ck(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function Y0(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function WZ(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function FN(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):nd(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const dve=n=>typeof n=="function";function bl(n,...e){return dve(n)?n(...e):n}function hve(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function pve(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function zZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:UN(n)&&hve(n)?n:zZ(pve(n))}function fve(n,e){const i={},o={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:o[l]=u;return[i,o]}function mve(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=f=>{const _={};for(let E=0;E<f.length;E++){const S=f[E];i[S]&&(Object.defineProperty(_,S,i[S]),delete i[S])}return _},u=f=>l(Array.isArray(f)?f:o.filter(f));return e.map(u).concat(l(o))}function YK(n,e,i={}){const{stop:o,getKey:l}=i;function u(f,_=[]){if(nd(f)||Array.isArray(f)){const E={};for(const[S,C]of Object.entries(f)){const I=(l==null?void 0:l(S))??S,O=[..._,I];if(o!=null&&o(f,O))return e(f,_);E[I]=u(C,O)}return E}return e(f,_)}return u(n)}var Kw={exports:{}};Kw.exports;var XK;function gve(){return XK||(XK=1,function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,u=16,f=9007199254740991,_="[object Arguments]",E="[object Array]",S="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",O="[object Error]",M="[object Function]",L="[object GeneratorFunction]",U="[object Map]",B="[object Number]",J="[object Null]",K="[object Object]",ne="[object Proxy]",oe="[object RegExp]",se="[object Set]",le="[object String]",Y="[object Undefined]",Z="[object WeakMap]",X="[object ArrayBuffer]",ie="[object DataView]",de="[object Float32Array]",ue="[object Float64Array]",pe="[object Int8Array]",ke="[object Int16Array]",xe="[object Int32Array]",je="[object Uint8Array]",Oe="[object Uint8ClampedArray]",we="[object Uint16Array]",Se="[object Uint32Array]",Be=/[\\^$.*+?()[\]{}|]/g,Ee=/^\[object .+?Constructor\]$/,Ce=/^(?:0|[1-9]\d*)$/,Pe={};Pe[de]=Pe[ue]=Pe[pe]=Pe[ke]=Pe[xe]=Pe[je]=Pe[Oe]=Pe[we]=Pe[Se]=!0,Pe[_]=Pe[E]=Pe[X]=Pe[C]=Pe[ie]=Pe[I]=Pe[O]=Pe[M]=Pe[U]=Pe[B]=Pe[K]=Pe[oe]=Pe[se]=Pe[le]=Pe[Z]=!1;var Me=typeof Ny=="object"&&Ny&&Ny.Object===Object&&Ny,We=typeof self=="object"&&self&&self.Object===Object&&self,He=Me||We||Function("return this")(),qe=e&&!e.nodeType&&e,rt=qe&&!0&&n&&!n.nodeType&&n,et=rt&&rt.exports===qe,_t=et&&Me.process,on=function(){try{var be=rt&&rt.require&&rt.require("util").types;return be||_t&&_t.binding&&_t.binding("util")}catch{}}(),dt=on&&on.isTypedArray;function kt(be,De,it){switch(it.length){case 0:return be.call(De);case 1:return be.call(De,it[0]);case 2:return be.call(De,it[0],it[1]);case 3:return be.call(De,it[0],it[1],it[2])}return be.apply(De,it)}function ct(be,De){for(var it=-1,en=Array(be);++it<be;)en[it]=De(it);return en}function Ut(be){return function(De){return be(De)}}function fn(be,De){return be==null?void 0:be[De]}function Wt(be,De){return function(it){return be(De(it))}}var Te=Array.prototype,Ve=Function.prototype,$e=Object.prototype,Et=He["__core-js_shared__"],vt=Ve.toString,St=$e.hasOwnProperty,zt=function(){var be=/[^.]+$/.exec(Et&&Et.keys&&Et.keys.IE_PROTO||"");return be?"Symbol(src)_1."+be:""}(),dn=$e.toString,vn=vt.call(Object),nn=RegExp("^"+vt.call(St).replace(Be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ct=et?He.Buffer:void 0,sr=He.Symbol,xt=He.Uint8Array;Ct&&Ct.allocUnsafe;var qt=Wt(Object.getPrototypeOf,Object),Tr=Object.create,Pi=$e.propertyIsEnumerable,As=Te.splice,cr=sr?sr.toStringTag:void 0,zn=function(){try{var be=_c(Object,"defineProperty");return be({},"",{}),be}catch{}}(),ia=Ct?Ct.isBuffer:void 0,Ks=Math.max,ao=Date.now,jc=_c(He,"Map"),Ps=_c(Object,"create"),Va=function(){function be(){}return function(De){if(!Wc(De))return{};if(Tr)return Tr(De);be.prototype=De;var it=new be;return be.prototype=void 0,it}}();function Fo(be){var De=-1,it=be==null?0:be.length;for(this.clear();++De<it;){var en=be[De];this.set(en[0],en[1])}}function ja(){this.__data__=Ps?Ps(null):{},this.size=0}function fc(be){var De=this.has(be)&&delete this.__data__[be];return this.size-=De?1:0,De}function Ol(be){var De=this.__data__;if(Ps){var it=De[be];return it===o?void 0:it}return St.call(De,be)?De[be]:void 0}function Fa(be){var De=this.__data__;return Ps?De[be]!==void 0:St.call(De,be)}function mc(be,De){var it=this.__data__;return this.size+=this.has(be)?0:1,it[be]=Ps&&De===void 0?o:De,this}Fo.prototype.clear=ja,Fo.prototype.delete=fc,Fo.prototype.get=Ol,Fo.prototype.has=Fa,Fo.prototype.set=mc;function _o(be){var De=-1,it=be==null?0:be.length;for(this.clear();++De<it;){var en=be[De];this.set(en[0],en[1])}}function ji(){this.__data__=[],this.size=0}function ds(be){var De=this.__data__,it=hs(De,be);if(it<0)return!1;var en=De.length-1;return it==en?De.pop():As.call(De,it,1),--this.size,!0}function sa(be){var De=this.__data__,it=hs(De,be);return it<0?void 0:De[it][1]}function kl(be){return hs(this.__data__,be)>-1}function Ba(be,De){var it=this.__data__,en=hs(it,be);return en<0?(++this.size,it.push([be,De])):it[en][1]=De,this}_o.prototype.clear=ji,_o.prototype.delete=ds,_o.prototype.get=sa,_o.prototype.has=kl,_o.prototype.set=Ba;function Bo(be){var De=-1,it=be==null?0:be.length;for(this.clear();++De<it;){var en=be[De];this.set(en[0],en[1])}}function mt(){this.size=0,this.__data__={hash:new Fo,map:new(jc||_o),string:new Fo}}function hn(be){var De=pd(this,be).delete(be);return this.size-=De?1:0,De}function Or(be){return pd(this,be).get(be)}function Oi(be){return pd(this,be).has(be)}function Nl(be,De){var it=pd(this,be),en=it.size;return it.set(be,De),this.size+=it.size==en?0:1,this}Bo.prototype.clear=mt,Bo.prototype.delete=hn,Bo.prototype.get=Or,Bo.prototype.has=Oi,Bo.prototype.set=Nl;function Xi(be){var De=this.__data__=new _o(be);this.size=De.size}function Dl(){this.__data__=new _o,this.size=0}function Wo(be){var De=this.__data__,it=De.delete(be);return this.size=De.size,it}function pu(be){return this.__data__.get(be)}function xl(be){return this.__data__.has(be)}function oa(be,De){var it=this.__data__;if(it instanceof _o){var en=it.__data__;if(!jc||en.length<i-1)return en.push([be,De]),this.size=++it.size,this;it=this.__data__=new Bo(en)}return it.set(be,De),this.size=it.size,this}Xi.prototype.clear=Dl,Xi.prototype.delete=Wo,Xi.prototype.get=pu,Xi.prototype.has=xl,Xi.prototype.set=oa;function fu(be,De){var it=la(be),en=!it&&vs(be),tr=!it&&!en&&da(be),kr=!it&&!en&&!tr&&Mp(be),Zr=it||en||tr||kr,_n=Zr?ct(be.length,String):[],Kr=_n.length;for(var Ni in be)Zr&&(Ni=="length"||tr&&(Ni=="offset"||Ni=="parent")||kr&&(Ni=="buffer"||Ni=="byteLength"||Ni=="byteOffset")||Ul(Ni,Kr))||_n.push(Ni);return _n}function gc(be,De,it){(it!==void 0&&!ca(be[De],it)||it===void 0&&!(De in be))&&Sn(be,De,it)}function Fi(be,De,it){var en=be[De];(!(St.call(be,De)&&ca(en,it))||it===void 0&&!(De in be))&&Sn(be,De,it)}function hs(be,De){for(var it=be.length;it--;)if(ca(be[it][0],De))return it;return-1}function Sn(be,De,it){De=="__proto__"&&zn?zn(be,De,{configurable:!0,enumerable:!0,value:it,writable:!0}):be[De]=it}var ki=_u();function Fc(be){return be==null?be===void 0?Y:J:cr&&cr in Object(be)?aa(be):hm(be)}function Ll(be){return Os(be)&&Fc(be)==_}function Wa(be){if(!Wc(be)||yc(be))return!1;var De=ha(be)?nn:Ee;return De.test(Lp(be))}function Np(be){return Os(be)&&fm(be.length)&&!!Pe[Fc(be)]}function hh(be){if(!Wc(be))return Bc(be);var De=pr(be),it=[];for(var en in be)en=="constructor"&&(De||!St.call(be,en))||it.push(en);return it}function mu(be,De,it,en,tr){be!==De&&ki(De,function(kr,Zr){if(tr||(tr=new Xi),Wc(kr))zo(be,De,Zr,it,mu,en,tr);else{var _n=en?en(mh(be,Zr),kr,Zr+"",be,De,tr):void 0;_n===void 0&&(_n=kr),gc(be,Zr,_n)}},Su)}function zo(be,De,it,en,tr,kr,Zr){var _n=mh(be,it),Kr=mh(De,it),Ni=Zr.get(Kr);if(Ni){gc(be,it,Ni);return}var qs=kr?kr(_n,Kr,it+"",be,De,Zr):void 0,pa=qs===void 0;if(pa){var fa=la(Kr),gd=!fa&&da(Kr),ps=!fa&&!gd&&Mp(Kr);qs=Kr,fa||gd||ps?la(_n)?qs=_n:vu(_n)?qs=fh(_n):gd?(pa=!1,qs=Dp(Kr)):ps?(pa=!1,qs=ph(Kr)):qs=[]:md(Kr)||vs(Kr)?(qs=_n,vs(_n)?qs=Vl(_n):(!Wc(_n)||ha(_n))&&(qs=fd(Kr))):pa=!1}pa&&(Zr.set(Kr,qs),tr(qs,Kr,en,kr,Zr),Zr.delete(Kr)),gc(be,it,qs)}function dm(be,De){return xp(Eu(be,De,Ga),be+"")}var yo=zn?function(be,De){return zn(be,"toString",{configurable:!0,enumerable:!1,value:za(De),writable:!0})}:Ga;function Dp(be,De){return be.slice()}function Ml(be){var De=new be.constructor(be.byteLength);return new xt(De).set(new xt(be)),De}function ph(be,De){var it=Ml(be.buffer);return new be.constructor(it,be.byteOffset,be.length)}function fh(be,De){var it=-1,en=be.length;for(De||(De=Array(en));++it<en;)De[it]=be[it];return De}function wr(be,De,it,en){var tr=!it;it||(it={});for(var kr=-1,Zr=De.length;++kr<Zr;){var _n=De[kr],Kr=void 0;Kr===void 0&&(Kr=be[_n]),tr?Sn(it,_n,Kr):Fi(it,_n,Kr)}return it}function gu(be){return dm(function(De,it){var en=-1,tr=it.length,kr=tr>1?it[tr-1]:void 0,Zr=tr>2?it[2]:void 0;for(kr=be.length>3&&typeof kr=="function"?(tr--,kr):void 0,Zr&&yu(it[0],it[1],Zr)&&(kr=tr<3?void 0:kr,tr=1),De=Object(De);++en<tr;){var _n=it[en];_n&&be(De,_n,en,kr)}return De})}function _u(be){return function(De,it,en){for(var tr=-1,kr=Object(De),Zr=en(De),_n=Zr.length;_n--;){var Kr=Zr[++tr];if(it(kr[Kr],Kr,kr)===!1)break}return De}}function pd(be,De){var it=be.__data__;return ri(De)?it[typeof De=="string"?"string":"hash"]:it.map}function _c(be,De){var it=fn(be,De);return Wa(it)?it:void 0}function aa(be){var De=St.call(be,cr),it=be[cr];try{be[cr]=void 0;var en=!0}catch{}var tr=dn.call(be);return en&&(De?be[cr]=it:delete be[cr]),tr}function fd(be){return typeof be.constructor=="function"&&!pr(be)?Va(qt(be)):{}}function Ul(be,De){var it=typeof be;return De=De??f,!!De&&(it=="number"||it!="symbol"&&Ce.test(be))&&be>-1&&be%1==0&&be<De}function yu(be,De,it){if(!Wc(it))return!1;var en=typeof De;return(en=="number"?ua(it)&&Ul(De,it.length):en=="string"&&De in it)?ca(it[De],be):!1}function ri(be){var De=typeof be;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?be!=="__proto__":be===null}function yc(be){return!!zt&&zt in be}function pr(be){var De=be&&be.constructor,it=typeof De=="function"&&De.prototype||$e;return be===it}function Bc(be){var De=[];if(be!=null)for(var it in Object(be))De.push(it);return De}function hm(be){return dn.call(be)}function Eu(be,De,it){return De=Ks(De===void 0?be.length-1:De,0),function(){for(var en=arguments,tr=-1,kr=Ks(en.length-De,0),Zr=Array(kr);++tr<kr;)Zr[tr]=en[De+tr];tr=-1;for(var _n=Array(De+1);++tr<De;)_n[tr]=en[tr];return _n[De]=it(Zr),kt(be,this,_n)}}function mh(be,De){if(!(De==="constructor"&&typeof be[De]=="function")&&De!="__proto__")return be[De]}var xp=pm(yo);function pm(be){var De=0,it=0;return function(){var en=ao(),tr=u-(en-it);if(it=en,tr>0){if(++De>=l)return arguments[0]}else De=0;return be.apply(void 0,arguments)}}function Lp(be){if(be!=null){try{return vt.call(be)}catch{}try{return be+""}catch{}}return""}function ca(be,De){return be===De||be!==be&&De!==De}var vs=Ll(function(){return arguments}())?Ll:function(be){return Os(be)&&St.call(be,"callee")&&!Pi.call(be,"callee")},la=Array.isArray;function ua(be){return be!=null&&fm(be.length)&&!ha(be)}function vu(be){return Os(be)&&ua(be)}var da=ia||jl;function ha(be){if(!Wc(be))return!1;var De=Fc(be);return De==M||De==L||De==S||De==ne}function fm(be){return typeof be=="number"&&be>-1&&be%1==0&&be<=f}function Wc(be){var De=typeof be;return be!=null&&(De=="object"||De=="function")}function Os(be){return be!=null&&typeof be=="object"}function md(be){if(!Os(be)||Fc(be)!=K)return!1;var De=qt(be);if(De===null)return!0;var it=St.call(De,"constructor")&&De.constructor;return typeof it=="function"&&it instanceof it&&vt.call(it)==vn}var Mp=dt?Ut(dt):Np;function Vl(be){return wr(be,Su(be))}function Su(be){return ua(be)?fu(be):hh(be)}var mm=gu(function(be,De,it,en){mu(be,De,it,en)});function za(be){return function(){return be}}function Ga(be){return be}function jl(){return!1}n.exports=mm}(Kw,Kw.exports)),Kw.exports}var _ve=gve();const pp=Xg(_ve);function no(n,e=[]){const i=k.useRef(n);return k.useEffect(()=>{i.current=n}),k.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Vy(n,e,i,o){const l=no(i);return k.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,o),()=>{u.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,o)}}function GZ(n){const{isOpen:e,ref:i}=n,[o,l]=k.useState(e),[u,f]=k.useState(!1);return k.useEffect(()=>{u||(l(e),f(!0))},[e,u,o]),Vy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const E=jEe(i.current),S=new E.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(S)}}}var P2,JK;function yve(){return JK||(JK=1,P2=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),P2}var O2,QK;function Eve(){if(QK)return O2;QK=1;var n=yve(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(u){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,f)}function l(u,f){var _,E,S,C,I,O,M=!1;f||(f={}),_=f.debug||!1;try{S=n(),C=document.createRange(),I=document.getSelection(),O=document.createElement("span"),O.textContent=u,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(U){if(U.stopPropagation(),f.format)if(U.preventDefault(),typeof U.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var B=e[f.format]||e.default;window.clipboardData.setData(B,u)}else U.clipboardData.clearData(),U.clipboardData.setData(f.format,u);f.onCopy&&(U.preventDefault(),f.onCopy(U.clipboardData))}),document.body.appendChild(O),C.selectNodeContents(O),I.addRange(C);var L=document.execCommand("copy");if(!L)throw new Error("copy command was unsuccessful");M=!0}catch(U){_&&console.error("unable to copy using execCommand: ",U),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",u),f.onCopy&&f.onCopy(window.clipboardData),M=!0}catch(B){_&&console.error("unable to copy using clipboardData: ",B),_&&console.error("falling back to prompt"),E=o("message"in f?f.message:i),window.prompt(E,u)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(C):I.removeAllRanges()),O&&document.body.removeChild(O),S()}return M}return O2=l,O2}var vve=Eve();const ZK=Xg(vve);function eq(n,e={}){const[i,o]=k.useState(!1),[l,u]=k.useState(n);k.useEffect(()=>u(n),[n]);const{timeout:f=1500,..._}=typeof e=="number"?{timeout:e}:e,E=k.useCallback(S=>{const C=typeof S=="string"?S:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o(ZK(C,_))):o(ZK(C,_))},[l,_]);return k.useEffect(()=>{let S=null;return i&&(S=window.setTimeout(()=>{o(!1)},f)),()=>{S&&window.clearTimeout(S)}},[f,i]),{value:l,setValue:u,onCopy:E,hasCopied:i}}function HZ(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(O,M)=>O!==M}=n,u=no(o),f=no(l),[_,E]=k.useState(i),S=e!==void 0,C=S?e:_,I=no(O=>{const L=typeof O=="function"?O(C):O;f(C,L)&&(S||E(L),u(L))},[S,u,C,f]);return[C,I]}function Sve(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:u=1,min:f=Number.MIN_SAFE_INTEGER,max:_=Number.MAX_SAFE_INTEGER,keepWithinRange:E=!0}=n,S=no(e),[C,I]=k.useState(()=>o==null?"":k2(o,u,i)??""),O=typeof l<"u",M=O?l:C,L=$Z(bg(M),u),U=i??L,B=k.useCallback(ie=>{ie!==M&&(O||I(ie.toString()),S==null||S(ie.toString(),bg(ie)))},[S,O,M]),J=k.useCallback(ie=>{let de=ie;return E&&(de=ck(de,f,_)),Bj(de,U)},[U,E,_,f]),K=k.useCallback((ie=u)=>{let de;M===""?de=bg(ie):de=bg(M)+ie,de=J(de),B(de)},[J,u,B,M]),ne=k.useCallback((ie=u)=>{let de;M===""?de=bg(-ie):de=bg(M)-ie,de=J(de),B(de)},[J,u,B,M]),oe=k.useCallback(()=>{let ie;o==null?ie="":ie=k2(o,u,i)??f,B(ie)},[o,i,u,B,f]),se=k.useCallback(ie=>{const de=k2(ie,u,U)??f;B(de)},[U,u,B,f]),le=bg(M);return{isOutOfRange:le>_||le<f,isAtMax:le===_,isAtMin:le===f,precision:U,value:M,valueAsNumber:le,update:B,reset:oe,increment:K,decrement:ne,clamp:J,cast:se,setValue:I}}function bg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function $Z(n,e){return Math.max(eV(e),eV(n))}function k2(n,e,i){const o=bg(n);if(Number.isNaN(o))return;const l=$Z(o,e);return Bj(o,i??l)}function ld(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,u=no(i),f=no(e),[_,E]=k.useState(n.defaultIsOpen||!1),S=o!==void 0?o:_,C=o!==void 0,I=k.useId(),O=l??`disclosure-${I}`,M=k.useCallback(()=>{C||E(!1),f==null||f()},[C,f]),L=k.useCallback(()=>{C||E(!0),u==null||u()},[C,u]),U=k.useCallback(()=>{S?M():L()},[S,L,M]);function B(K={}){return{...K,"aria-expanded":S,"aria-controls":O,onClick(ne){var oe;(oe=K.onClick)==null||oe.call(K,ne),U()}}}function J(K={}){return{...K,hidden:!S,id:O}}return{isOpen:S,onOpen:L,onClose:M,onToggle:U,isControlled:C,getButtonProps:B,getDisclosureProps:J}}const _p=globalThis!=null&&globalThis.document?k.useLayoutEffect:k.useEffect,Qf=(n,e)=>{const i=k.useRef(!1),o=k.useRef(!1);k.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),k.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function bve(n){const e=n.current;if(!e)return!1;const i=BEe(e);return!i||e.contains(i)?!1:!!nve(i)}function KZ(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,u=i&&!o;Qf(()=>{if(!u||bve(n))return;const f=(l==null?void 0:l.current)||n.current;let _;if(f)return _=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[u,n,l])}const Tve={preventScroll:!0,shouldFocus:!1};function wve(n,e=Tve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:u}=e,f=Cve(n)?n.current:n,_=l&&u,E=k.useRef(_),S=k.useRef(u);_p(()=>{!S.current&&u&&(E.current=_),S.current=u},[u,_]);const C=k.useCallback(()=>{if(!(!u||!f||!E.current)&&(E.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:o})});else{const I=FZ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:o})})}},[u,o,f,i]);Qf(()=>{C()},[C]),Vy(f,"transitionend",C)}function Cve(n){return"current"in n}function Rve(n){return"current"in n}const qZ=()=>typeof window<"u";function Ive(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const Ave=n=>qZ()&&n.test(navigator.vendor),Pve=n=>qZ()&&n.test(Ive()),Ove=()=>Pve(/mac|iphone|ipad|ipod/i),kve=()=>Ove()&&Ave(/apple/i);function Nve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Vy(l,"pointerdown",u=>{var S,C;if(!kve()||!o)return;const f=((C=(S=u.composedPath)==null?void 0:S.call(u))==null?void 0:C[0])??u.target,E=(i??[e]).some(I=>{const O=Rve(I)?I.current:I;return(O==null?void 0:O.contains(f))||O===f});l().activeElement!==f&&E&&(u.preventDefault(),f.focus())})}function Dve(n,e){const i=k.useId();return k.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function xve(n,...e){const i=Dve(n);return k.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function Lve(n,e){const i=no(n);k.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function YZ(n){const e=k.useRef(null);return e.current=n,e}function Mve(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Hi(...n){return e=>{n.forEach(i=>{Mve(i,e)})}}function Uve(...n){return k.useMemo(()=>Hi(...n),n)}function XZ(n){const{ref:e,handler:i,enabled:o=!0}=n,l=no(i),f=k.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;k.useEffect(()=>{if(!o)return;const _=I=>{N2(I,e)&&(f.isPointerDown=!0)},E=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&N2(I,e)&&(f.isPointerDown=!1,l(I))},S=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&N2(I,e)&&(f.isPointerDown=!1,l(I))},C=JZ(e.current);return C.addEventListener("mousedown",_,!0),C.addEventListener("mouseup",E,!0),C.addEventListener("touchstart",_,!0),C.addEventListener("touchend",S,!0),()=>{C.removeEventListener("mousedown",_,!0),C.removeEventListener("mouseup",E,!0),C.removeEventListener("touchstart",_,!0),C.removeEventListener("touchend",S,!0)}},[i,e,l,f,o])}function N2(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!JZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function JZ(n){return(n==null?void 0:n.ownerDocument)??document}function Vve(n,e){const i=no(n);k.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const QZ=1/60*1e3,jve=typeof performance<"u"?()=>performance.now():()=>Date.now(),ZZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(jve()),QZ);function Fve(n){let e=[],i=[],o=0,l=!1,u=!1;const f=new WeakSet,_={schedule:(E,S=!1,C=!1)=>{const I=C&&l,O=I?e:i;return S&&f.add(E),O.indexOf(E)===-1&&(O.push(E),I&&l&&(o=e.length)),E},cancel:E=>{const S=i.indexOf(E);S!==-1&&i.splice(S,1),f.delete(E)},process:E=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let S=0;S<o;S++){const C=e[S];C(E),f.has(C)&&(_.schedule(C),n())}l=!1,u&&(u=!1,_.process(E))}};return _}const Bve=40;let tV=!0,kC=!1,nV=!1;const o0={delta:0,timestamp:0},lR=["read","update","preRender","render","postRender"],BN=lR.reduce((n,e)=>(n[e]=Fve(()=>kC=!0),n),{}),Wve=lR.reduce((n,e)=>{const i=BN[e];return n[e]=(o,l=!1,u=!1)=>(kC||Hve(),i.schedule(o,l,u)),n},{}),zve=lR.reduce((n,e)=>(n[e]=BN[e].cancel,n),{});lR.reduce((n,e)=>(n[e]=()=>BN[e].process(o0),n),{});const Gve=n=>BN[n].process(o0),eee=n=>{kC=!1,o0.delta=tV?QZ:Math.max(Math.min(n-o0.timestamp,Bve),1),o0.timestamp=n,nV=!0,lR.forEach(Gve),nV=!1,kC&&(tV=!1,ZZ(eee))},Hve=()=>{kC=!0,tV=!0,nV||ZZ(eee)},tq=()=>o0;var $ve=Object.defineProperty,Kve=(n,e,i)=>e in n?$ve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Xd=(n,e,i)=>(Kve(n,typeof e!="symbol"?e+"":e,i),i);class qve{constructor(e,i,o){if(Xd(this,"history",[]),Xd(this,"startEvent",null),Xd(this,"lastEvent",null),Xd(this,"lastEventInfo",null),Xd(this,"handlers",{}),Xd(this,"removeListeners",()=>{}),Xd(this,"threshold",3),Xd(this,"win"),Xd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=D2(this.lastEventInfo,this.history),E=this.startEvent!==null,S=Qve(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!S)return;const{timestamp:C}=tq();this.history.push({..._.point,timestamp:C});const{onStart:I,onMove:O}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,_)}),Xd(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,Wve.update(this.updatePoint,!0)}),Xd(this,"onPointerUp",(_,E)=>{const S=D2(E,this.history),{onEnd:C,onSessionEnd:I}=this.handlers;I==null||I(_,S),this.end(),!(!C||!this.startEvent)&&(C==null||C(_,S))}),this.win=e.view??window,zEe(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:MZ(e)},{timestamp:u}=tq();this.history=[{...l.point,timestamp:u}];const{onSessionStart:f}=i;f==null||f(e,D2(l,this.history)),this.removeListeners=Jve(ak(this.win,"pointermove",this.onPointerMove),ak(this.win,"pointerup",this.onPointerUp),ak(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),zve.update(this.updatePoint)}}function nq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function D2(n,e){return{point:n.point,delta:nq(n.point,e[e.length-1]),offset:nq(n.point,e[0]),velocity:Xve(e,.1)}}const Yve=n=>n*1e3;function Xve(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Yve(e)));)i--;if(!o)return{x:0,y:0};const u=(l.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const f={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function Jve(...n){return e=>n.reduce((i,o)=>o(i),e)}function x2(n,e){return Math.abs(n-e)}function rq(n){return"x"in n&&"y"in n}function Qve(n,e){if(typeof n=="number"&&typeof e=="number")return x2(n,e);if(rq(n)&&rq(e)){const i=x2(n.x,e.x),o=x2(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function Zve(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:f,threshold:_}=e,E=!!(i||o||l||u||f),S=k.useRef(null),C=YZ({onSessionStart:u,onSessionEnd:f,onStart:o,onMove:i,onEnd(I,O){S.current=null,l==null||l(I,O)}});k.useEffect(()=>{var I;(I=S.current)==null||I.updateHandlers(C.current)}),k.useEffect(()=>{const I=n.current;if(!I||!E)return;function O(M){S.current=new qve(M,C.current,_)}return ak(I,"pointerdown",O)},[n,E,C,_]),k.useEffect(()=>()=>{var I;(I=S.current)==null||I.end(),S.current=null},[])}const Io={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},tp=n=>tee(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Af=n=>tee(e=>n(e,"~ &"),"[data-peer]",".peer"),tee=(n,...e)=>e.map(n).join(", "),a0={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:tp(Io.open),_groupClosed:tp(Io.closed),_groupHover:tp(Io.hover),_peerHover:Af(Io.hover),_groupFocus:tp(Io.focus),_peerFocus:Af(Io.focus),_groupFocusVisible:tp(Io.focusVisible),_peerFocusVisible:Af(Io.focusVisible),_groupActive:tp(Io.active),_peerActive:Af(Io.active),_groupDisabled:tp(Io.disabled),_peerDisabled:Af(Io.disabled),_groupInvalid:tp(Io.invalid),_peerInvalid:Af(Io.invalid),_groupChecked:tp(Io.checked),_peerChecked:Af(Io.checked),_groupFocusWithin:tp(Io.focusWithin),_peerFocusWithin:Af(Io.focusWithin),_peerPlaceholderShown:Af(Io.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},nee=Object.keys(a0),eSe=n=>/!(important)?$/.test(n),iq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,tSe=(n,e)=>i=>{const o=String(e),l=eSe(o),u=iq(o),f=n?`${n}.${u}`:u;let _=nd(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:e;return _=iq(_),l?`${_} !important`:_};function Wj(n){const{scale:e,transform:i,compose:o}=n;return(u,f)=>{const _=tSe(e,u)(f);let E=(i==null?void 0:i(_,f))??_;return o&&(E=o(E,f)),E}}const AO=(...n)=>e=>n.reduce((i,o)=>o(i),e);function Xu(n,e){return i=>{const o={property:i,scale:n};return o.transform=Wj({scale:n,transform:e}),o}}const nSe=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function rSe(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:nSe(e),transform:i?Wj({scale:i,compose:o}):o}}const ree=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function iSe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...ree].join(" ")}function sSe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...ree].join(" ")}const oSe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},aSe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function cSe(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const lSe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},rV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},uSe=new Set(Object.values(rV)),iV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),dSe=n=>n.trim();function hSe(n,e){if(n==null||iV.has(n))return n;if(!(sV(n)||iV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!u||!f)return n;const _=u.includes("-gradient")?u:`${u}-gradient`,[E,...S]=f.split(",").map(dSe).filter(Boolean);if((S==null?void 0:S.length)===0)return n;const C=E in rV?rV[E]:E;S.unshift(C);const I=S.map(O=>{if(uSe.has(O))return O;const M=O.indexOf(" "),[L,U]=M!==-1?[O.substr(0,M),O.substr(M+1)]:[O],B=sV(U)?U:U&&U.split(" "),J=`colors.${L}`,K=J in e.__cssMap?e.__cssMap[J].varRef:L;return B?[K,...Array.isArray(B)?B:[B]].join(" "):K});return`${_}(${I.join(", ")})`}const sV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),pSe=(n,e)=>hSe(n,e??{});function fSe(n){return/^var\(--.+\)$/.test(n)}const mSe=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},np=n=>e=>`${n}(${e})`,zr={filter(n){return n!=="auto"?n:oSe},backdropFilter(n){return n!=="auto"?n:aSe},ring(n){return cSe(zr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?iSe():n==="auto-gpu"?sSe():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=mSe(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(fSe(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:pSe,blur:np("blur"),opacity:np("opacity"),brightness:np("brightness"),contrast:np("contrast"),dropShadow:np("drop-shadow"),grayscale:np("grayscale"),hueRotate:n=>np("hue-rotate")(zr.degree(n)),invert:np("invert"),saturate:np("saturate"),sepia:np("sepia"),bgImage(n){return n==null||sV(n)||iV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=lSe[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Ge={borderWidths:Xu("borderWidths"),borderStyles:Xu("borderStyles"),colors:Xu("colors"),borders:Xu("borders"),gradients:Xu("gradients",zr.gradient),radii:Xu("radii",zr.px),space:Xu("space",AO(zr.vh,zr.px)),spaceT:Xu("space",AO(zr.vh,zr.px)),degreeT(n){return{property:n,transform:zr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:Wj({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Xu("sizes",AO(zr.vh,zr.px)),sizesT:Xu("sizes",AO(zr.vh,zr.fraction)),shadows:Xu("shadows"),logical:rSe,blur:Xu("blur",zr.blur)},lk={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:zr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:zr.bgClip}};Object.assign(lk,{bgImage:lk.backgroundImage,bgImg:lk.backgroundImage});const oi={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(oi,{rounded:oi.borderRadius,roundedTop:oi.borderTopRadius,roundedTopLeft:oi.borderTopLeftRadius,roundedTopRight:oi.borderTopRightRadius,roundedTopStart:oi.borderStartStartRadius,roundedTopEnd:oi.borderStartEndRadius,roundedBottom:oi.borderBottomRadius,roundedBottomLeft:oi.borderBottomLeftRadius,roundedBottomRight:oi.borderBottomRightRadius,roundedBottomStart:oi.borderEndStartRadius,roundedBottomEnd:oi.borderEndEndRadius,roundedLeft:oi.borderLeftRadius,roundedRight:oi.borderRightRadius,roundedStart:oi.borderInlineStartRadius,roundedEnd:oi.borderInlineEndRadius,borderStart:oi.borderInlineStart,borderEnd:oi.borderInlineEnd,borderTopStartRadius:oi.borderStartStartRadius,borderTopEndRadius:oi.borderStartEndRadius,borderBottomStartRadius:oi.borderEndStartRadius,borderBottomEndRadius:oi.borderEndEndRadius,borderStartRadius:oi.borderInlineStartRadius,borderEndRadius:oi.borderInlineEndRadius,borderStartWidth:oi.borderInlineStartWidth,borderEndWidth:oi.borderInlineEndWidth,borderStartColor:oi.borderInlineStartColor,borderEndColor:oi.borderInlineEndColor,borderStartStyle:oi.borderInlineStartStyle,borderEndStyle:oi.borderInlineEndStyle});const gSe={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},$k={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:zr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign($k,{flexDir:$k.flexDirection});const Zu={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",zr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Zu,{w:Zu.width,h:Zu.height,minW:Zu.minWidth,maxW:Zu.maxWidth,minH:Zu.minHeight,maxH:Zu.maxHeight,overscroll:Zu.overscrollBehavior,overscrollX:Zu.overscrollBehaviorX,overscrollY:Zu.overscrollBehaviorY});const _Se={filter:{transform:zr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",zr.brightness),contrast:Ge.propT("--chakra-contrast",zr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",zr.hueRotate),invert:Ge.propT("--chakra-invert",zr.invert),saturate:Ge.propT("--chakra-saturate",zr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",zr.dropShadow),backdropFilter:{transform:zr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",zr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",zr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",zr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",zr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",zr.saturate)},ySe={ring:{transform:zr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},ESe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:zr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},iee={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function vSe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const SSe=n=>{const e=new WeakMap;return(o,l,u,f)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,u,f);return _.set(l,E),E}},bSe=SSe(vSe),TSe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},wSe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},L2=(n,e,i)=>{const o={},l=bSe(n,e,{});for(const u in l)u in i&&i[u]!=null||(o[u]=l[u]);return o},CSe={srOnly:{transform(n){return n===!0?TSe:n==="focusable"?wSe:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>L2(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>L2(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>L2(e,n,i)}},uC={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(uC,{insetStart:uC.insetInlineStart,insetEnd:uC.insetInlineEnd});const oV={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(oV,{shadow:oV.boxShadow});const is={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(is,{m:is.margin,mt:is.marginTop,mr:is.marginRight,me:is.marginInlineEnd,marginEnd:is.marginInlineEnd,mb:is.marginBottom,ml:is.marginLeft,ms:is.marginInlineStart,marginStart:is.marginInlineStart,mx:is.marginX,my:is.marginY,p:is.padding,pt:is.paddingTop,py:is.paddingY,px:is.paddingX,pb:is.paddingBottom,pl:is.paddingLeft,ps:is.paddingInlineStart,paddingStart:is.paddingInlineStart,pr:is.paddingRight,pe:is.paddingInlineEnd,paddingEnd:is.paddingInlineEnd});const RSe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},ISe={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",zr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},ASe={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},PSe={clipPath:!0,transform:Ge.propT("transform",zr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},OSe={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},kSe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},zj=pp({},lk,oi,gSe,$k,Zu,_Se,ySe,ESe,iee,CSe,uC,oV,is,RSe,ISe,ASe,PSe,OSe,kSe),NSe=Object.assign({},is,Zu,$k,iee,uC),DSe=Object.keys(NSe),xSe=[...Object.keys(zj),...nee],LSe={...zj,...a0},MSe=n=>n in LSe,USe=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,u={};for(const f in n){let _=bl(n[f],e);if(_==null)continue;if(_=nd(_)&&i(_)?o(_):_,!Array.isArray(_)){u[f]=_;continue}const E=_.slice(0,l.length).length;for(let S=0;S<E;S+=1){const C=l==null?void 0:l[S];if(!C){u[f]=_[S];continue}u[C]=u[C]||{},_[S]!=null&&(u[C][f]=_[S])}}return u};function VSe(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(o=!0,i+=u):u===")"?(o=!1,i+=u):u===","&&!o?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function jSe(n){return/^var\(--.+\)$/.test(n)}const FSe=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!jSe(e),BSe=(n,e)=>{if(e==null)return e;const i=f=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[f])==null?void 0:E.varRef},o=f=>i(f)??f,[l,u]=VSe(e);return e=i(l)??o(u)??o(e),e};function WSe(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(u,f=!1)=>{var C;const _=bl(u,o),E=USe(_)(o);let S={};for(let I in E){const O=E[I];let M=bl(O,o);I in i&&(I=i[I]),FSe(I,M)&&(M=BSe(o,M));let L=e[I];if(L===!0&&(L={property:I}),nd(M)){S[I]=S[I]??{},S[I]=pp({},S[I],l(M,!0));continue}let U=((C=L==null?void 0:L.transform)==null?void 0:C.call(L,M,o,_))??M;U=L!=null&&L.processResult?l(U,!0):U;const B=bl(L==null?void 0:L.property,o);if(!f&&(L!=null&&L.static)){const J=bl(L.static,o);S=pp({},S,J)}if(B&&Array.isArray(B)){for(const J of B)S[J]=U;continue}if(B){B==="&"&&nd(U)?S=pp({},S,U):S[B]=U;continue}if(nd(U)){S=pp({},S,U);continue}S[I]=U}return S};return l}const see=n=>e=>WSe({theme:e,pseudos:a0,configs:zj})(n);function c9e(n){return n}function l9e(n){return n}function Yi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function zSe(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function GSe(n,e){if(Array.isArray(n))return n;if(nd(n))return e(n);if(n!=null)return[n]}function HSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function $Se(n){const e=n.__breakpoints;return function(o,l,u,f){var O,M;if(!e)return;const _={},E=GSe(u,e.toArrayValue);if(!E)return _;const S=E.length,C=S===1,I=!!o.parts;for(let L=0;L<S;L++){const U=e.details[L],B=e.details[HSe(E,L)],J=$w(U.minW,B==null?void 0:B._minW),K=bl((O=o[l])==null?void 0:O[E[L]],f);if(K){if(I){(M=o.parts)==null||M.forEach(ne=>{pp(_,{[ne]:C?K[ne]:{[J]:K[ne]}})});continue}if(!I){C?pp(_,K):_[J]=K;continue}_[J]=K}}return _}}function KSe(n){return e=>{const{variant:i,size:o,theme:l}=e,u=$Se(l);return pp({},bl(n.baseStyle??{},e),u(n,"sizes",o,e),u(n,"variants",i,e))}}function Vi(n){return Y0(n,["styleConfig","size","variant","colorScheme"])}function oee(n){return nd(n)&&n.reference?n.reference:String(n)}const WN=(n,...e)=>e.map(oee).join(` ${n} `).replace(/calc/g,""),sq=(...n)=>`calc(${WN("+",...n)})`,oq=(...n)=>`calc(${WN("-",...n)})`,aV=(...n)=>`calc(${WN("*",...n)})`,aq=(...n)=>`calc(${WN("/",...n)})`,cq=n=>{const e=oee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:aV(e,-1)},Nf=Object.assign(n=>({add:(...e)=>Nf(sq(n,...e)),subtract:(...e)=>Nf(oq(n,...e)),multiply:(...e)=>Nf(aV(n,...e)),divide:(...e)=>Nf(aq(n,...e)),negate:()=>Nf(cq(n)),toString:()=>n.toString()}),{add:sq,subtract:oq,multiply:aV,divide:aq,negate:cq});function qSe(n,e="-"){return n.replace(/\s+/g,e)}function YSe(n){const e=qSe(n.toString());return JSe(XSe(e))}function XSe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function JSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function QSe(n,e=""){return[e,n].filter(Boolean).join("-")}function ZSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function e0e(n,e=""){return YSe(`--${QSe(n,e)}`)}function jn(n,e,i){const o=e0e(n,i);return{variable:o,reference:ZSe(o,e)}}function t0e(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,u]=o;i[l]=jn(`${n}-${l}`,u);continue}i[o]=jn(`${n}-${o}`)}return i}const n0e=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function r0e(n){return WZ(n,n0e)}function i0e(n){return n.semanticTokens}function s0e(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function o0e(n){const e=r0e(n),i=i0e(n),o=u=>nee.includes(u)||u==="default",l={};return YK(e,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!1,value:u})}),YK(i,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(o)}),l}function lq(n,e){return jn(String(n).replace(/\./g,"-"),void 0,e)}function a0e(n){var f;const e=o0e(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let o={};const l={};function u(_,E){const C=[String(_).split(".")[0],E].join(".");if(!e[C])return E;const{reference:O}=lq(C,i);return O}for(const[_,E]of Object.entries(e)){const{isSemantic:S,value:C}=E,{variable:I,reference:O}=lq(_,i);if(!S){if(_.startsWith("space")){const L=_.split("."),[U,...B]=L,J=`${U}.-${B.join(".")}`,K=Nf.negate(C),ne=Nf.negate(O);l[J]={value:K,var:I,varRef:ne}}o[I]=C,l[_]={value:C,var:I,varRef:O};continue}const M=nd(C)?C:{default:C};o=pp(o,Object.entries(M).reduce((L,[U,B])=>{if(!B)return L;const J=u(_,`${B}`);if(U==="default")return L[I]=J,L;const K=(a0==null?void 0:a0[U])??U;return L[K]={[I]:J},L},{})),l[_]={value:O,var:I,varRef:O}}return{cssVars:o,cssMap:l}}function c0e(n){const e=s0e(n),{cssMap:i,cssVars:o}=a0e(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:ZEe(e.breakpoints)}),e}function di(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const I of C)e[I]=E(I);return di(n,e)}function u(...C){for(const I of C)I in e||(e[I]=E(I));return di(n,e)}function f(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.className]))}function E(C){const M=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:M,selector:`.${M}`,toString:()=>C}}return{parts:l,toPart:E,extend:u,selectors:f,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const l0e=di("accordion").parts("root","container","button","panel","icon"),u0e=di("alert").parts("title","description","container","icon","spinner"),d0e=di("avatar").parts("label","badge","container","excessLabel","group"),h0e=di("breadcrumb").parts("link","item","container","separator");di("button").parts();const p0e=di("checkbox").parts("control","icon","container","label");di("progress").parts("track","filledTrack","label");const f0e=di("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),m0e=di("editable").parts("preview","input","textarea"),g0e=di("form").parts("container","requiredIndicator","helperText"),_0e=di("formError").parts("text","icon"),y0e=di("input").parts("addon","field","element","group"),E0e=di("list").parts("container","item","icon"),v0e=di("menu").parts("button","list","item","groupTitle","icon","command","divider"),S0e=di("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),b0e=di("numberinput").parts("root","field","stepperGroup","stepper");di("pininput").parts("field");const T0e=di("popover").parts("content","header","body","footer","popper","arrow","closeButton"),w0e=di("progress").parts("label","filledTrack","track"),C0e=di("radio").parts("container","control","label"),R0e=di("select").parts("field","icon"),I0e=di("slider").parts("container","track","thumb","filledTrack","mark"),A0e=di("stat").parts("container","label","helpText","number","icon"),P0e=di("switch").parts("container","track","thumb","label"),O0e=di("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),k0e=di("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),N0e=di("tag").parts("container","label","closeButton"),D0e=di("card").parts("container","header","body","footer");di("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:x0e,defineMultiStyleConfig:L0e}=Yi(l0e.keys),M0e={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},U0e={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},V0e={pt:"2",px:"4",pb:"5"},j0e={fontSize:"1.25em"},F0e=x0e({container:M0e,button:U0e,panel:V0e,icon:j0e}),B0e=L0e({baseStyle:F0e});function Dy(n,e,i){return Math.min(Math.max(n,i),e)}class W0e extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var qw=W0e;function Gj(n){if(typeof n!="string")throw new qw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=X0e.test(n)?H0e(n):n;const i=$0e.exec(e);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(_=>parseInt(NC(_,2),16)),parseInt(NC(f[3]||"f",2),16)/255]}const o=K0e.exec(e);if(o){const f=Array.from(o).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,16)),parseInt(f[3]||"ff",16)/255]}const l=q0e.exec(e);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,10)),parseFloat(f[3]||"1")]}const u=Y0e.exec(e);if(u){const[f,_,E,S]=Array.from(u).slice(1).map(parseFloat);if(Dy(0,100,_)!==_)throw new qw(n);if(Dy(0,100,E)!==E)throw new qw(n);return[...J0e(f,_,E),Number.isNaN(S)?1:S]}throw new qw(n)}function z0e(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const uq=n=>parseInt(n.replace(/_/g,""),36),G0e="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=uq(e.substring(0,3)),o=uq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-o.length;u++)l+="0";return n[i]=`${l}${o}`,n},{});function H0e(n){const e=n.toLowerCase().trim(),i=G0e[z0e(e)];if(!i)throw new qw(n);return`#${i}`}const NC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),$0e=new RegExp(`^#${NC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),K0e=new RegExp(`^#${NC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),q0e=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${NC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Y0e=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,X0e=/^[a-z]+$/i,dq=n=>Math.round(n*255),J0e=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(dq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),f=u*(1-Math.abs(l%2-1));let _=0,E=0,S=0;l>=0&&l<1?(_=u,E=f):l>=1&&l<2?(_=f,E=u):l>=2&&l<3?(E=u,S=f):l>=3&&l<4?(E=f,S=u):l>=4&&l<5?(_=f,S=u):l>=5&&l<6&&(_=u,S=f);const C=o-u/2,I=_+C,O=E+C,M=S+C;return[I,O,M].map(dq)};function Q0e(n,e,i,o){return`rgba(${Dy(0,255,n).toFixed()}, ${Dy(0,255,e).toFixed()}, ${Dy(0,255,i).toFixed()}, ${parseFloat(Dy(0,1,o).toFixed(3))})`}function Z0e(n,e){const[i,o,l,u]=Gj(n);return Q0e(i,o,l,u-e)}function ebe(n){const[e,i,o,l]=Gj(n);let u=f=>{const _=Dy(0,255,f).toString(16);return _.length===1?`0${_}`:_};return`#${u(e)}${u(i)}${u(o)}${l<1?u(Math.round(l*255)):""}`}const tbe=n=>Object.keys(n).length===0;function nbe(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const Lc=(n,e,i)=>{const o=nbe(n,`colors.${e}`,e);try{return ebe(o),o}catch{return i??"#000000"}},rbe=n=>{const[e,i,o]=Gj(n);return(e*299+i*587+o*114)/1e3},ibe=n=>e=>{const i=Lc(e,n);return rbe(i)<128?"dark":"light"},sbe=n=>e=>ibe(n)(e)==="dark",T0=(n,e)=>i=>{const o=Lc(i,n);return Z0e(o,1-e)};function hq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const obe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function abe(n){const e=obe();return!n||tbe(n)?e:n.string&&n.colors?lbe(n.string,n.colors):n.string&&!n.colors?cbe(n.string):n.colors&&!n.string?ube(n.colors):e}function cbe(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function lbe(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function ube(n){return n[Math.floor(Math.random()*n.length)]}function Vn(n,e){return i=>i.colorMode==="dark"?e:n}function Hj(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function aee(n){return nd(n)&&n.reference?n.reference:String(n)}const zN=(n,...e)=>e.map(aee).join(` ${n} `).replace(/calc/g,""),pq=(...n)=>`calc(${zN("+",...n)})`,fq=(...n)=>`calc(${zN("-",...n)})`,cV=(...n)=>`calc(${zN("*",...n)})`,mq=(...n)=>`calc(${zN("/",...n)})`,gq=n=>{const e=aee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:cV(e,-1)},Df=Object.assign(n=>({add:(...e)=>Df(pq(n,...e)),subtract:(...e)=>Df(fq(n,...e)),multiply:(...e)=>Df(cV(n,...e)),divide:(...e)=>Df(mq(n,...e)),negate:()=>Df(gq(n)),toString:()=>n.toString()}),{add:pq,subtract:fq,multiply:cV,divide:mq,negate:gq});function dbe(n){return!Number.isInteger(parseFloat(n.toString()))}function hbe(n,e="-"){return n.replace(/\s+/g,e)}function cee(n){const e=hbe(n.toString());return e.includes("\\.")?n:dbe(n)?e.replace(".","\\."):n}function pbe(n,e=""){return[e,cee(n)].filter(Boolean).join("-")}function fbe(n,e){return`var(${cee(n)}${e?`, ${e}`:""})`}function mbe(n,e=""){return`--${pbe(n,e)}`}function jo(n,e){const i=mbe(n,e==null?void 0:e.prefix);return{variable:i,reference:fbe(i,gbe(e==null?void 0:e.fallback))}}function gbe(n){return n==null?void 0:n.reference}const{definePartsStyle:uR,defineMultiStyleConfig:_be}=Yi(u0e.keys),su=jn("alert-fg"),Zf=jn("alert-bg"),ybe=uR({container:{bg:Zf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:su.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:su.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function $j(n){const{theme:e,colorScheme:i}=n,o=T0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const Ebe=uR(n=>{const{colorScheme:e}=n,i=$j(n);return{container:{[su.variable]:`colors.${e}.600`,[Zf.variable]:i.light,_dark:{[su.variable]:`colors.${e}.200`,[Zf.variable]:i.dark}}}}),vbe=uR(n=>{const{colorScheme:e}=n,i=$j(n);return{container:{[su.variable]:`colors.${e}.600`,[Zf.variable]:i.light,_dark:{[su.variable]:`colors.${e}.200`,[Zf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:su.reference}}}),Sbe=uR(n=>{const{colorScheme:e}=n,i=$j(n);return{container:{[su.variable]:`colors.${e}.600`,[Zf.variable]:i.light,_dark:{[su.variable]:`colors.${e}.200`,[Zf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:su.reference}}}),bbe=uR(n=>{const{colorScheme:e}=n;return{container:{[su.variable]:"colors.white",[Zf.variable]:`colors.${e}.600`,_dark:{[su.variable]:"colors.gray.900",[Zf.variable]:`colors.${e}.200`},color:su.reference}}}),Tbe={subtle:Ebe,"left-accent":vbe,"top-accent":Sbe,solid:bbe},wbe=_be({baseStyle:ybe,variants:Tbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),lee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Cbe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Rbe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},uee={...lee,...Cbe,container:Rbe},Ibe=n=>typeof n=="function";function Mc(n,...e){return Ibe(n)?n(...e):n}const{definePartsStyle:dee,defineMultiStyleConfig:Abe}=Yi(d0e.keys),c0=jn("avatar-border-color"),dC=jn("avatar-bg"),DC=jn("avatar-font-size"),w0=jn("avatar-size"),Pbe={borderRadius:"full",border:"0.2em solid",borderColor:c0.reference,[c0.variable]:"white",_dark:{[c0.variable]:"colors.gray.800"}},Obe={bg:dC.reference,fontSize:DC.reference,width:w0.reference,height:w0.reference,lineHeight:"1",[dC.variable]:"colors.gray.200",_dark:{[dC.variable]:"colors.whiteAlpha.400"}},kbe=n=>{const{name:e,theme:i}=n,o=e?abe({string:e}):"colors.gray.400",l=sbe(o)(i);let u="white";return l||(u="gray.800"),{bg:dC.reference,fontSize:DC.reference,color:u,borderColor:c0.reference,verticalAlign:"top",width:w0.reference,height:w0.reference,"&:not([data-loaded])":{[dC.variable]:o},[c0.variable]:"colors.white",_dark:{[c0.variable]:"colors.gray.800"}}},Nbe={fontSize:DC.reference,lineHeight:"1"},Dbe=dee(n=>({badge:Mc(Pbe,n),excessLabel:Mc(Obe,n),container:Mc(kbe,n),label:Nbe}));function yg(n){const e=n!=="100%"?uee[n]:void 0;return dee({container:{[w0.variable]:e??n,[DC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[w0.variable]:e??n,[DC.variable]:`calc(${e??n} / 2.5)`}})}const xbe={"2xs":yg(4),xs:yg(6),sm:yg(8),md:yg(12),lg:yg(16),xl:yg(24),"2xl":yg(32),full:yg("100%")},Lbe=Abe({baseStyle:Dbe,sizes:xbe,defaultProps:{size:"md"}}),ro=t0e("badge",["bg","color","shadow"]),Mbe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:ro.bg.reference,color:ro.color.reference,boxShadow:ro.shadow.reference},Ube=n=>{const{colorScheme:e,theme:i}=n,o=T0(`${e}.500`,.6)(i);return{[ro.bg.variable]:`colors.${e}.500`,[ro.color.variable]:"colors.white",_dark:{[ro.bg.variable]:o,[ro.color.variable]:"colors.whiteAlpha.800"}}},Vbe=n=>{const{colorScheme:e,theme:i}=n,o=T0(`${e}.200`,.16)(i);return{[ro.bg.variable]:`colors.${e}.100`,[ro.color.variable]:`colors.${e}.800`,_dark:{[ro.bg.variable]:o,[ro.color.variable]:`colors.${e}.200`}}},jbe=n=>{const{colorScheme:e,theme:i}=n,o=T0(`${e}.200`,.8)(i);return{[ro.color.variable]:`colors.${e}.500`,_dark:{[ro.color.variable]:o},[ro.shadow.variable]:`inset 0 0 0px 1px ${ro.color.reference}`}},Fbe={solid:Ube,subtle:Vbe,outline:jbe},hC={baseStyle:Mbe,variants:Fbe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Bbe,definePartsStyle:Wbe}=Yi(h0e.keys),M2=jn("breadcrumb-link-decor"),zbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:M2.reference,[M2.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[M2.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},Gbe=Wbe({link:zbe}),Hbe=Bbe({baseStyle:Gbe}),$be={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},hee=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Vn("gray.800","whiteAlpha.900")(n),_hover:{bg:Vn("gray.100","whiteAlpha.200")(n)},_active:{bg:Vn("gray.200","whiteAlpha.300")(n)}};const o=T0(`${e}.200`,.12)(i),l=T0(`${e}.200`,.24)(i);return{color:Vn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Vn(`${e}.50`,o)(n)},_active:{bg:Vn(`${e}.100`,l)(n)}}},Kbe=n=>{const{colorScheme:e}=n,i=Vn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Mc(hee,n)}},qbe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Ybe=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Vn("gray.100","whiteAlpha.200")(n);return{bg:_,color:Vn("gray.800","whiteAlpha.900")(n),_hover:{bg:Vn("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Vn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=qbe[e]??{},f=Vn(i,`${e}.200`)(n);return{bg:f,color:Vn(o,"gray.800")(n),_hover:{bg:Vn(l,`${e}.300`)(n),_disabled:{bg:f}},_active:{bg:Vn(u,`${e}.400`)(n)}}},Xbe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Vn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Vn(`${e}.700`,`${e}.500`)(n)}}},Jbe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Qbe={ghost:hee,outline:Kbe,solid:Ybe,link:Xbe,unstyled:Jbe},Zbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},eTe={baseStyle:$be,variants:Qbe,sizes:Zbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:jy,defineMultiStyleConfig:tTe}=Yi(D0e.keys),Kk=jn("card-bg"),Wf=jn("card-padding"),pee=jn("card-shadow"),uk=jn("card-radius"),fee=jn("card-border-width","0"),mee=jn("card-border-color"),nTe=jy({container:{[Kk.variable]:"colors.chakra-body-bg",backgroundColor:Kk.reference,boxShadow:pee.reference,borderRadius:uk.reference,color:"chakra-body-text",borderWidth:fee.reference,borderColor:mee.reference},body:{padding:Wf.reference,flex:"1 1 0%"},header:{padding:Wf.reference},footer:{padding:Wf.reference}}),rTe={sm:jy({container:{[uk.variable]:"radii.base",[Wf.variable]:"space.3"}}),md:jy({container:{[uk.variable]:"radii.md",[Wf.variable]:"space.5"}}),lg:jy({container:{[uk.variable]:"radii.xl",[Wf.variable]:"space.7"}})},iTe={elevated:jy({container:{[pee.variable]:"shadows.base",_dark:{[Kk.variable]:"colors.gray.700"}}}),outline:jy({container:{[fee.variable]:"1px",[mee.variable]:"colors.chakra-border-color"}}),filled:jy({container:{[Kk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Wf.variable]:0},header:{[Wf.variable]:0},footer:{[Wf.variable]:0}}},sTe=tTe({baseStyle:nTe,variants:iTe,sizes:rTe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:dk,defineMultiStyleConfig:oTe}=Yi(p0e.keys),pC=jn("checkbox-size"),aTe=n=>{const{colorScheme:e}=n;return{w:pC.reference,h:pC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Vn(`${e}.500`,`${e}.200`)(n),borderColor:Vn(`${e}.500`,`${e}.200`)(n),color:Vn("white","gray.900")(n),_hover:{bg:Vn(`${e}.600`,`${e}.300`)(n),borderColor:Vn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Vn("gray.200","transparent")(n),bg:Vn("gray.200","whiteAlpha.300")(n),color:Vn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Vn(`${e}.500`,`${e}.200`)(n),borderColor:Vn(`${e}.500`,`${e}.200`)(n),color:Vn("white","gray.900")(n)},_disabled:{bg:Vn("gray.100","whiteAlpha.100")(n),borderColor:Vn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Vn("red.500","red.300")(n)}}},cTe={_disabled:{cursor:"not-allowed"}},lTe={userSelect:"none",_disabled:{opacity:.4}},uTe={transitionProperty:"transform",transitionDuration:"normal"},dTe=dk(n=>({icon:uTe,container:cTe,control:Mc(aTe,n),label:lTe})),hTe={sm:dk({control:{[pC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:dk({control:{[pC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:dk({control:{[pC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},wg=oTe({baseStyle:dTe,sizes:hTe,defaultProps:{size:"md",colorScheme:"blue"}}),fC=jo("close-button-size"),Cw=jo("close-button-bg"),pTe={w:[fC.reference],h:[fC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Cw.variable]:"colors.blackAlpha.100",_dark:{[Cw.variable]:"colors.whiteAlpha.100"}},_active:{[Cw.variable]:"colors.blackAlpha.200",_dark:{[Cw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Cw.reference},fTe={lg:{[fC.variable]:"sizes.10",fontSize:"md"},md:{[fC.variable]:"sizes.8",fontSize:"xs"},sm:{[fC.variable]:"sizes.6",fontSize:"2xs"}},mTe={baseStyle:pTe,sizes:fTe,defaultProps:{size:"md"}},{variants:gTe,defaultProps:_Te}=hC,yTe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:ro.bg.reference,color:ro.color.reference,boxShadow:ro.shadow.reference},ETe={baseStyle:yTe,variants:gTe,defaultProps:_Te},vTe={w:"100%",mx:"auto",maxW:"prose",px:"4"},STe={baseStyle:vTe},bTe={opacity:.6,borderColor:"inherit"},TTe={borderStyle:"solid"},wTe={borderStyle:"dashed"},CTe={solid:TTe,dashed:wTe},RTe={baseStyle:bTe,variants:CTe,defaultProps:{variant:"solid"}},{definePartsStyle:lV,defineMultiStyleConfig:ITe}=Yi(f0e.keys),U2=jn("drawer-bg"),V2=jn("drawer-box-shadow");function NS(n){return lV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const ATe={bg:"blackAlpha.600",zIndex:"modal"},PTe={display:"flex",zIndex:"modal",justifyContent:"center"},OTe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[U2.variable]:"colors.white",[V2.variable]:"shadows.lg",_dark:{[U2.variable]:"colors.gray.700",[V2.variable]:"shadows.dark-lg"},bg:U2.reference,boxShadow:V2.reference}},kTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},NTe={position:"absolute",top:"2",insetEnd:"3"},DTe={px:"6",py:"2",flex:"1",overflow:"auto"},xTe={px:"6",py:"4"},LTe=lV(n=>({overlay:ATe,dialogContainer:PTe,dialog:Mc(OTe,n),header:kTe,closeButton:NTe,body:DTe,footer:xTe})),MTe={xs:NS("xs"),sm:NS("md"),md:NS("lg"),lg:NS("2xl"),xl:NS("4xl"),full:NS("full")},UTe=ITe({baseStyle:LTe,sizes:MTe,defaultProps:{size:"xs"}}),{definePartsStyle:VTe,defineMultiStyleConfig:jTe}=Yi(m0e.keys),FTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},BTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},WTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},zTe=VTe({preview:FTe,input:BTe,textarea:WTe}),GTe=jTe({baseStyle:zTe}),{definePartsStyle:HTe,defineMultiStyleConfig:$Te}=Yi(g0e.keys),l0=jn("form-control-color"),KTe={marginStart:"1",[l0.variable]:"colors.red.500",_dark:{[l0.variable]:"colors.red.300"},color:l0.reference},qTe={mt:"2",[l0.variable]:"colors.gray.600",_dark:{[l0.variable]:"colors.whiteAlpha.600"},color:l0.reference,lineHeight:"normal",fontSize:"sm"},YTe=HTe({container:{width:"100%",position:"relative"},requiredIndicator:KTe,helperText:qTe}),XTe=$Te({baseStyle:YTe}),{definePartsStyle:JTe,defineMultiStyleConfig:QTe}=Yi(_0e.keys),u0=jn("form-error-color"),ZTe={[u0.variable]:"colors.red.500",_dark:{[u0.variable]:"colors.red.300"},color:u0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},ewe={marginEnd:"0.5em",[u0.variable]:"colors.red.500",_dark:{[u0.variable]:"colors.red.300"},color:u0.reference},twe=JTe({text:ZTe,icon:ewe}),nwe=QTe({baseStyle:twe}),rwe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},iwe={baseStyle:rwe},swe={fontFamily:"heading",fontWeight:"bold"},owe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},awe={baseStyle:swe,sizes:owe,defaultProps:{size:"xl"}},{definePartsStyle:Mf,defineMultiStyleConfig:cwe}=Yi(y0e.keys),$S=jn("input-height"),KS=jn("input-font-size"),qS=jn("input-padding"),YS=jn("input-border-radius"),lwe=Mf({addon:{height:$S.reference,fontSize:KS.reference,px:qS.reference,borderRadius:YS.reference},field:{width:"100%",height:$S.reference,fontSize:KS.reference,px:qS.reference,borderRadius:YS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),Eg={lg:{[KS.variable]:"fontSizes.lg",[qS.variable]:"space.4",[YS.variable]:"radii.md",[$S.variable]:"sizes.12"},md:{[KS.variable]:"fontSizes.md",[qS.variable]:"space.4",[YS.variable]:"radii.md",[$S.variable]:"sizes.10"},sm:{[KS.variable]:"fontSizes.sm",[qS.variable]:"space.3",[YS.variable]:"radii.sm",[$S.variable]:"sizes.8"},xs:{[KS.variable]:"fontSizes.xs",[qS.variable]:"space.2",[YS.variable]:"radii.sm",[$S.variable]:"sizes.6"}},uwe={lg:Mf({field:Eg.lg,group:Eg.lg}),md:Mf({field:Eg.md,group:Eg.md}),sm:Mf({field:Eg.sm,group:Eg.sm}),xs:Mf({field:Eg.xs,group:Eg.xs})};function Kj(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Vn("blue.500","blue.300")(n),errorBorderColor:i||Vn("red.500","red.300")(n)}}const dwe=Mf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=Kj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Vn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Lc(e,o),boxShadow:`0 0 0 1px ${Lc(e,o)}`},_focusVisible:{zIndex:1,borderColor:Lc(e,i),boxShadow:`0 0 0 1px ${Lc(e,i)}`}},addon:{border:"1px solid",borderColor:Vn("inherit","whiteAlpha.50")(n),bg:Vn("gray.100","whiteAlpha.300")(n)}}}),hwe=Mf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=Kj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Vn("gray.100","whiteAlpha.50")(n),_hover:{bg:Vn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Lc(e,o)},_focusVisible:{bg:"transparent",borderColor:Lc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Vn("gray.100","whiteAlpha.50")(n)}}}),pwe=Mf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=Kj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Lc(e,o),boxShadow:`0px 1px 0px 0px ${Lc(e,o)}`},_focusVisible:{borderColor:Lc(e,i),boxShadow:`0px 1px 0px 0px ${Lc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),fwe=Mf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),mwe={outline:dwe,filled:hwe,flushed:pwe,unstyled:fwe},ui=cwe({baseStyle:lwe,sizes:uwe,variants:mwe,defaultProps:{size:"md",variant:"outline"}}),j2=jn("kbd-bg"),gwe={[j2.variable]:"colors.gray.100",_dark:{[j2.variable]:"colors.whiteAlpha.100"},bg:j2.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},_we={baseStyle:gwe},ywe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},Ewe={baseStyle:ywe},{defineMultiStyleConfig:vwe,definePartsStyle:Swe}=Yi(E0e.keys),bwe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},Twe=Swe({icon:bwe}),wwe=vwe({baseStyle:Twe}),{defineMultiStyleConfig:Cwe,definePartsStyle:Rwe}=Yi(v0e.keys),rp=jn("menu-bg"),F2=jn("menu-shadow"),Iwe={[rp.variable]:"#fff",[F2.variable]:"shadows.sm",_dark:{[rp.variable]:"colors.gray.700",[F2.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:rp.reference,boxShadow:F2.reference},Awe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[rp.variable]:"colors.gray.100",_dark:{[rp.variable]:"colors.whiteAlpha.100"}},_active:{[rp.variable]:"colors.gray.200",_dark:{[rp.variable]:"colors.whiteAlpha.200"}},_expanded:{[rp.variable]:"colors.gray.100",_dark:{[rp.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:rp.reference},Pwe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Owe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},kwe={opacity:.6},Nwe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Dwe={transitionProperty:"common",transitionDuration:"normal"},xwe=Rwe({button:Dwe,list:Iwe,item:Awe,groupTitle:Pwe,icon:Owe,command:kwe,divider:Nwe}),Lwe=Cwe({baseStyle:xwe}),{defineMultiStyleConfig:Mwe,definePartsStyle:uV}=Yi(S0e.keys),B2=jn("modal-bg"),W2=jn("modal-shadow"),Uwe={bg:"blackAlpha.600",zIndex:"modal"},Vwe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},jwe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[B2.variable]:"colors.white",[W2.variable]:"shadows.lg",_dark:{[B2.variable]:"colors.gray.700",[W2.variable]:"shadows.dark-lg"},bg:B2.reference,boxShadow:W2.reference}},Fwe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Bwe={position:"absolute",top:"2",insetEnd:"3"},Wwe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},zwe={px:"6",py:"4"},Gwe=uV(n=>({overlay:Uwe,dialogContainer:Mc(Vwe,n),dialog:Mc(jwe,n),header:Fwe,closeButton:Bwe,body:Mc(Wwe,n),footer:zwe}));function Jd(n){return uV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const Hwe={xs:Jd("xs"),sm:Jd("sm"),md:Jd("md"),lg:Jd("lg"),xl:Jd("xl"),"2xl":Jd("2xl"),"3xl":Jd("3xl"),"4xl":Jd("4xl"),"5xl":Jd("5xl"),"6xl":Jd("6xl"),full:Jd("full")},$we=Mwe({baseStyle:Gwe,sizes:Hwe,defaultProps:{size:"md"}}),gee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:Kwe,definePartsStyle:_ee}=Yi(b0e.keys),qj=jo("number-input-stepper-width"),yee=jo("number-input-input-padding"),qwe=Df(qj).add("0.5rem").toString(),z2=jo("number-input-bg"),G2=jo("number-input-color"),H2=jo("number-input-border-color"),Ywe={[qj.variable]:"sizes.6",[yee.variable]:qwe},Xwe=n=>{var e;return((e=Mc(ui.baseStyle,n))==null?void 0:e.field)??{}},Jwe={width:qj.reference},Qwe={borderStart:"1px solid",borderStartColor:H2.reference,color:G2.reference,bg:z2.reference,[G2.variable]:"colors.chakra-body-text",[H2.variable]:"colors.chakra-border-color",_dark:{[G2.variable]:"colors.whiteAlpha.800",[H2.variable]:"colors.whiteAlpha.300"},_active:{[z2.variable]:"colors.gray.200",_dark:{[z2.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},Zwe=_ee(n=>({root:Ywe,field:Mc(Xwe,n)??{},stepperGroup:Jwe,stepper:Qwe}));function PO(n){var u,f;const e=(u=ui.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((f=e.field)==null?void 0:f.fontSize)??"md",l=gee.fontSizes[o];return _ee({field:{...e.field,paddingInlineEnd:yee.reference,verticalAlign:"top"},stepper:{fontSize:Df(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const eCe={xs:PO("xs"),sm:PO("sm"),md:PO("md"),lg:PO("lg")},tCe=Kwe({baseStyle:Zwe,sizes:eCe,variants:ui.variants,defaultProps:ui.defaultProps});var mZ;const nCe={...(mZ=ui.baseStyle)==null?void 0:mZ.field,textAlign:"center"},rCe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var gZ;const iCe={outline:n=>{var e,i;return((i=Mc((e=ui.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Mc((e=ui.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Mc((e=ui.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((gZ=ui.variants)==null?void 0:gZ.unstyled.field)??{}},sCe={baseStyle:nCe,sizes:rCe,variants:iCe,defaultProps:ui.defaultProps},{defineMultiStyleConfig:oCe,definePartsStyle:aCe}=Yi(T0e.keys),OO=jo("popper-bg"),cCe=jo("popper-arrow-bg"),_q=jo("popper-arrow-shadow-color"),lCe={zIndex:"popover"},uCe={[OO.variable]:"colors.white",bg:OO.reference,[cCe.variable]:OO.reference,[_q.variable]:"colors.gray.200",_dark:{[OO.variable]:"colors.gray.700",[_q.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},dCe={px:3,py:2,borderBottomWidth:"1px"},hCe={px:3,py:2},pCe={px:3,py:2,borderTopWidth:"1px"},fCe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},mCe=aCe({popper:lCe,content:uCe,header:dCe,body:hCe,footer:pCe,closeButton:fCe}),gCe=oCe({baseStyle:mCe}),{defineMultiStyleConfig:_Ce,definePartsStyle:Yw}=Yi(w0e.keys),yCe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,u=Vn(hq(),hq("1rem","rgba(0,0,0,0.1)"))(n),f=Vn(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${Lc(i,f)} 50%,
    transparent 100%
  )`;return{...!o&&l&&u,...o?{bgImage:_}:{bgColor:f}}},ECe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},vCe=n=>({bg:Vn("gray.100","whiteAlpha.300")(n)}),SCe=n=>({transitionProperty:"common",transitionDuration:"slow",...yCe(n)}),bCe=Yw(n=>({label:ECe,filledTrack:SCe(n),track:vCe(n)})),TCe={xs:Yw({track:{h:"1"}}),sm:Yw({track:{h:"2"}}),md:Yw({track:{h:"3"}}),lg:Yw({track:{h:"4"}})},wCe=_Ce({sizes:TCe,baseStyle:bCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:CCe,definePartsStyle:hk}=Yi(C0e.keys),RCe=n=>{var i;const e=(i=Mc(wg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},ICe=hk(n=>{var e,i;return{label:(e=wg.baseStyle)==null?void 0:e.call(wg,n).label,container:(i=wg.baseStyle)==null?void 0:i.call(wg,n).container,control:RCe(n)}}),ACe={md:hk({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:hk({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:hk({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},PCe=CCe({baseStyle:ICe,sizes:ACe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:OCe,definePartsStyle:kCe}=Yi(R0e.keys),kO=jn("select-bg");var _Z;const NCe={...(_Z=ui.baseStyle)==null?void 0:_Z.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:kO.reference,[kO.variable]:"colors.white",_dark:{[kO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:kO.reference}},DCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},xCe=kCe({field:NCe,icon:DCe}),NO={paddingInlineEnd:"8"};var yZ,EZ,vZ,SZ,bZ,TZ,wZ,CZ;const LCe={lg:{...(yZ=ui.sizes)==null?void 0:yZ.lg,field:{...(EZ=ui.sizes)==null?void 0:EZ.lg.field,...NO}},md:{...(vZ=ui.sizes)==null?void 0:vZ.md,field:{...(SZ=ui.sizes)==null?void 0:SZ.md.field,...NO}},sm:{...(bZ=ui.sizes)==null?void 0:bZ.sm,field:{...(TZ=ui.sizes)==null?void 0:TZ.sm.field,...NO}},xs:{...(wZ=ui.sizes)==null?void 0:wZ.xs,field:{...(CZ=ui.sizes)==null?void 0:CZ.xs.field,...NO},icon:{insetEnd:"1"}}},MCe=OCe({baseStyle:xCe,sizes:LCe,variants:ui.variants,defaultProps:ui.defaultProps}),$2=jn("skeleton-start-color"),K2=jn("skeleton-end-color"),UCe={[$2.variable]:"colors.gray.100",[K2.variable]:"colors.gray.400",_dark:{[$2.variable]:"colors.gray.800",[K2.variable]:"colors.gray.600"},background:$2.reference,borderColor:K2.reference,opacity:.7,borderRadius:"sm"},VCe={baseStyle:UCe},q2=jn("skip-link-bg"),jCe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[q2.variable]:"colors.white",_dark:{[q2.variable]:"colors.gray.700"},bg:q2.reference}},FCe={baseStyle:jCe},{defineMultiStyleConfig:BCe,definePartsStyle:GN}=Yi(I0e.keys),Xy=jn("slider-thumb-size"),xC=jn("slider-track-size"),Cg=jn("slider-bg"),WCe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...Hj({orientation:e,vertical:{h:"100%",px:Nf(Xy.reference).divide(2).toString()},horizontal:{w:"100%",py:Nf(Xy.reference).divide(2).toString()}})}},zCe=n=>({...Hj({orientation:n.orientation,horizontal:{h:xC.reference},vertical:{w:xC.reference}}),overflow:"hidden",borderRadius:"sm",[Cg.variable]:"colors.gray.200",_dark:{[Cg.variable]:"colors.whiteAlpha.200"},_disabled:{[Cg.variable]:"colors.gray.300",_dark:{[Cg.variable]:"colors.whiteAlpha.300"}},bg:Cg.reference}),GCe=n=>{const{orientation:e}=n;return{...Hj({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Xy.reference,h:Xy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},HCe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[Cg.variable]:`colors.${e}.500`,_dark:{[Cg.variable]:`colors.${e}.200`},bg:Cg.reference}},$Ce=GN(n=>({container:WCe(n),track:zCe(n),thumb:GCe(n),filledTrack:HCe(n)})),KCe=GN({container:{[Xy.variable]:"sizes.4",[xC.variable]:"sizes.1"}}),qCe=GN({container:{[Xy.variable]:"sizes.3.5",[xC.variable]:"sizes.1"}}),YCe=GN({container:{[Xy.variable]:"sizes.2.5",[xC.variable]:"sizes.0.5"}}),XCe={lg:KCe,md:qCe,sm:YCe},JCe=BCe({baseStyle:$Ce,sizes:XCe,defaultProps:{size:"md",colorScheme:"blue"}}),ky=jo("spinner-size"),QCe={width:[ky.reference],height:[ky.reference]},ZCe={xs:{[ky.variable]:"sizes.3"},sm:{[ky.variable]:"sizes.4"},md:{[ky.variable]:"sizes.6"},lg:{[ky.variable]:"sizes.8"},xl:{[ky.variable]:"sizes.12"}},eRe={baseStyle:QCe,sizes:ZCe,defaultProps:{size:"md"}},{defineMultiStyleConfig:tRe,definePartsStyle:Eee}=Yi(A0e.keys),nRe={fontWeight:"medium"},rRe={opacity:.8,marginBottom:"2"},iRe={verticalAlign:"baseline",fontWeight:"semibold"},sRe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},oRe=Eee({container:{},label:nRe,helpText:rRe,number:iRe,icon:sRe}),aRe={md:Eee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},cRe=tRe({baseStyle:oRe,sizes:aRe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:lRe,definePartsStyle:Xw}=Yi(["stepper","step","title","description","indicator","separator","icon","number"]),xf=jn("stepper-indicator-size"),XS=jn("stepper-icon-size"),JS=jn("stepper-title-font-size"),Jw=jn("stepper-description-font-size"),Rw=jn("stepper-accent-color"),uRe=Xw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[Rw.variable]:`colors.${n}.500`,_dark:{[Rw.variable]:`colors.${n}.200`}},title:{fontSize:JS.reference,fontWeight:"medium"},description:{fontSize:Jw.reference,color:"chakra-subtle-text"},number:{fontSize:JS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:XS.reference,height:XS.reference},indicator:{flexShrink:0,borderRadius:"full",width:xf.reference,height:xf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:Rw.reference},"&[data-status=complete]":{bg:Rw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:Rw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${xf.reference} - 8px)`,top:`calc(${xf.reference} + 4px)`,insetStart:`calc(${xf.reference} / 2 - 1px)`}}})),dRe=lRe({baseStyle:uRe,sizes:{xs:Xw({stepper:{[xf.variable]:"sizes.4",[XS.variable]:"sizes.3",[JS.variable]:"fontSizes.xs",[Jw.variable]:"fontSizes.xs"}}),sm:Xw({stepper:{[xf.variable]:"sizes.6",[XS.variable]:"sizes.4",[JS.variable]:"fontSizes.sm",[Jw.variable]:"fontSizes.xs"}}),md:Xw({stepper:{[xf.variable]:"sizes.8",[XS.variable]:"sizes.5",[JS.variable]:"fontSizes.md",[Jw.variable]:"fontSizes.sm"}}),lg:Xw({stepper:{[xf.variable]:"sizes.10",[XS.variable]:"sizes.6",[JS.variable]:"fontSizes.lg",[Jw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:hRe,definePartsStyle:pk}=Yi(P0e.keys),mC=jo("switch-track-width"),Fy=jo("switch-track-height"),Y2=jo("switch-track-diff"),pRe=Df.subtract(mC,Fy),dV=jo("switch-thumb-x"),Iw=jo("switch-bg"),fRe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[mC.reference],height:[Fy.reference],transitionProperty:"common",transitionDuration:"fast",[Iw.variable]:"colors.gray.300",_dark:{[Iw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Iw.variable]:`colors.${e}.500`,_dark:{[Iw.variable]:`colors.${e}.200`}},bg:Iw.reference}},mRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Fy.reference],height:[Fy.reference],_checked:{transform:`translateX(${dV.reference})`}},gRe=pk(n=>({container:{[Y2.variable]:pRe,[dV.variable]:Y2.reference,_rtl:{[dV.variable]:Df(Y2).negate().toString()}},track:fRe(n),thumb:mRe})),_Re={sm:pk({container:{[mC.variable]:"1.375rem",[Fy.variable]:"sizes.3"}}),md:pk({container:{[mC.variable]:"1.875rem",[Fy.variable]:"sizes.4"}}),lg:pk({container:{[mC.variable]:"2.875rem",[Fy.variable]:"sizes.6"}})},yRe=hRe({baseStyle:gRe,sizes:_Re,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:ERe,definePartsStyle:d0}=Yi(O0e.keys),vRe=d0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),qk={"&[data-is-numeric=true]":{textAlign:"end"}},SRe=d0(n=>{const{colorScheme:e}=n;return{th:{color:Vn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...qk},td:{borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...qk},caption:{color:Vn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),bRe=d0(n=>{const{colorScheme:e}=n;return{th:{color:Vn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...qk},td:{borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...qk},caption:{color:Vn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n)},td:{background:Vn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),TRe={simple:SRe,striped:bRe,unstyled:{}},wRe={sm:d0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:d0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:d0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},CRe=ERe({baseStyle:vRe,variants:TRe,sizes:wRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),El=jn("tabs-color"),nh=jn("tabs-bg"),DO=jn("tabs-border-color"),{defineMultiStyleConfig:RRe,definePartsStyle:yp}=Yi(k0e.keys),IRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},ARe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},PRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},ORe={p:4},kRe=yp(n=>({root:IRe(n),tab:ARe(n),tablist:PRe(n),tabpanel:ORe})),NRe={sm:yp({tab:{py:1,px:4,fontSize:"sm"}}),md:yp({tab:{fontSize:"md",py:2,px:4}}),lg:yp({tab:{fontSize:"lg",py:3,px:4}})},DRe=yp(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[El.variable]:`colors.${e}.600`,_dark:{[El.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[nh.variable]:"colors.gray.200",_dark:{[nh.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:El.reference,bg:nh.reference}}}),xRe=yp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[DO.variable]:"transparent",_selected:{[El.variable]:`colors.${e}.600`,[DO.variable]:"colors.white",_dark:{[El.variable]:`colors.${e}.300`,[DO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:DO.reference},color:El.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),LRe=yp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[nh.variable]:"colors.gray.50",_dark:{[nh.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[nh.variable]:"colors.white",[El.variable]:`colors.${e}.600`,_dark:{[nh.variable]:"colors.gray.800",[El.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:El.reference,bg:nh.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),MRe=yp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Lc(i,`${e}.700`),bg:Lc(i,`${e}.100`)}}}}),URe=yp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[El.variable]:"colors.gray.600",_dark:{[El.variable]:"inherit"},_selected:{[El.variable]:"colors.white",[nh.variable]:`colors.${e}.600`,_dark:{[El.variable]:"colors.gray.800",[nh.variable]:`colors.${e}.300`}},color:El.reference,bg:nh.reference}}}),VRe=yp({}),jRe={line:DRe,enclosed:xRe,"enclosed-colored":LRe,"soft-rounded":MRe,"solid-rounded":URe,unstyled:VRe},FRe=RRe({baseStyle:kRe,sizes:NRe,variants:jRe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:BRe,definePartsStyle:By}=Yi(N0e.keys),yq=jn("tag-bg"),Eq=jn("tag-color"),X2=jn("tag-shadow"),fk=jn("tag-min-height"),mk=jn("tag-min-width"),gk=jn("tag-font-size"),_k=jn("tag-padding-inline"),WRe={fontWeight:"medium",lineHeight:1.2,outline:0,[Eq.variable]:ro.color.reference,[yq.variable]:ro.bg.reference,[X2.variable]:ro.shadow.reference,color:Eq.reference,bg:yq.reference,boxShadow:X2.reference,borderRadius:"md",minH:fk.reference,minW:mk.reference,fontSize:gk.reference,px:_k.reference,_focusVisible:{[X2.variable]:"shadows.outline"}},zRe={lineHeight:1.2,overflow:"visible"},GRe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},HRe=By({container:WRe,label:zRe,closeButton:GRe}),$Re={sm:By({container:{[fk.variable]:"sizes.5",[mk.variable]:"sizes.5",[gk.variable]:"fontSizes.xs",[_k.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:By({container:{[fk.variable]:"sizes.6",[mk.variable]:"sizes.6",[gk.variable]:"fontSizes.sm",[_k.variable]:"space.2"}}),lg:By({container:{[fk.variable]:"sizes.8",[mk.variable]:"sizes.8",[gk.variable]:"fontSizes.md",[_k.variable]:"space.3"}})},KRe={subtle:By(n=>{var e;return{container:(e=hC.variants)==null?void 0:e.subtle(n)}}),solid:By(n=>{var e;return{container:(e=hC.variants)==null?void 0:e.solid(n)}}),outline:By(n=>{var e;return{container:(e=hC.variants)==null?void 0:e.outline(n)}})},qRe=BRe({variants:KRe,baseStyle:HRe,sizes:$Re,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var RZ;const YRe={...(RZ=ui.baseStyle)==null?void 0:RZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var IZ;const XRe={outline:n=>{var e;return((e=ui.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=ui.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=ui.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((IZ=ui.variants)==null?void 0:IZ.unstyled.field)??{}};var AZ,PZ,OZ,kZ;const JRe={xs:((AZ=ui.sizes)==null?void 0:AZ.xs.field)??{},sm:((PZ=ui.sizes)==null?void 0:PZ.sm.field)??{},md:((OZ=ui.sizes)==null?void 0:OZ.md.field)??{},lg:((kZ=ui.sizes)==null?void 0:kZ.lg.field)??{}},QRe={baseStyle:YRe,sizes:JRe,variants:XRe,defaultProps:{size:"md",variant:"outline"}},xO=jo("tooltip-bg"),J2=jo("tooltip-fg"),ZRe=jo("popper-arrow-bg"),eIe={bg:xO.reference,color:J2.reference,[xO.variable]:"colors.gray.700",[J2.variable]:"colors.whiteAlpha.900",_dark:{[xO.variable]:"colors.gray.300",[J2.variable]:"colors.gray.900"},[ZRe.variable]:xO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},tIe={baseStyle:eIe},nIe={Accordion:B0e,Alert:wbe,Avatar:Lbe,Badge:hC,Breadcrumb:Hbe,Button:eTe,Checkbox:wg,CloseButton:mTe,Code:ETe,Container:STe,Divider:RTe,Drawer:UTe,Editable:GTe,Form:XTe,FormError:nwe,FormLabel:iwe,Heading:awe,Input:ui,Kbd:_we,Link:Ewe,List:wwe,Menu:Lwe,Modal:$we,NumberInput:tCe,PinInput:sCe,Popover:gCe,Progress:wCe,Radio:PCe,Select:MCe,Skeleton:VCe,SkipLink:FCe,Slider:JCe,Spinner:eRe,Stat:cRe,Switch:yRe,Table:CRe,Tabs:FRe,Tag:qRe,Textarea:QRe,Tooltip:tIe,Card:sTe,Stepper:dRe},rIe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},iIe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},sIe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},oIe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},aIe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},cIe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},lIe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},uIe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},dIe={property:cIe,easing:lIe,duration:uIe},hIe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},pIe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},fIe={breakpoints:iIe,zIndices:hIe,radii:oIe,blur:pIe,colors:sIe,...gee,sizes:uee,shadows:aIe,space:lee,borders:rIe,transition:dIe},mIe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},gIe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},_Ie="ltr",yIe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},EIe={semanticTokens:mIe,direction:_Ie,...fIe,components:nIe,styles:gIe,config:yIe};function vIe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function SIe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var bIe=function(){function n(i){var o=this;this._insertTag=function(l){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,u),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(SIe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=vIe(l);try{u.insertRule(o,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n}(),ac="-ms-",Yk="-moz-",ai="-webkit-",vee="comm",Yj="rule",Xj="decl",TIe="@import",See="@keyframes",wIe="@layer",CIe=Math.abs,HN=String.fromCharCode,RIe=Object.assign;function IIe(n,e){return Da(n,0)^45?(((e<<2^Da(n,0))<<2^Da(n,1))<<2^Da(n,2))<<2^Da(n,3):0}function bee(n){return n.trim()}function AIe(n,e){return(n=e.exec(n))?n[0]:n}function ci(n,e,i){return n.replace(e,i)}function hV(n,e){return n.indexOf(e)}function Da(n,e){return n.charCodeAt(e)|0}function LC(n,e,i){return n.slice(e,i)}function op(n){return n.length}function Jj(n){return n.length}function LO(n,e){return e.push(n),n}function PIe(n,e){return n.map(e).join("")}var $N=1,C0=1,Tee=0,Pl=0,fo=0,X0="";function KN(n,e,i,o,l,u,f){return{value:n,root:e,parent:i,type:o,props:l,children:u,line:$N,column:C0,length:f,return:""}}function Aw(n,e){return RIe(KN("",null,null,"",null,null,0),n,{length:-n.length},e)}function OIe(){return fo}function kIe(){return fo=Pl>0?Da(X0,--Pl):0,C0--,fo===10&&(C0=1,$N--),fo}function ou(){return fo=Pl<Tee?Da(X0,Pl++):0,C0++,fo===10&&(C0=1,$N++),fo}function Ep(){return Da(X0,Pl)}function yk(){return Pl}function dR(n,e){return LC(X0,n,e)}function MC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function wee(n){return $N=C0=1,Tee=op(X0=n),Pl=0,[]}function Cee(n){return X0="",n}function Ek(n){return bee(dR(Pl-1,pV(n===91?n+2:n===40?n+1:n)))}function NIe(n){for(;(fo=Ep())&&fo<33;)ou();return MC(n)>2||MC(fo)>3?"":" "}function DIe(n,e){for(;--e&&ou()&&!(fo<48||fo>102||fo>57&&fo<65||fo>70&&fo<97););return dR(n,yk()+(e<6&&Ep()==32&&ou()==32))}function pV(n){for(;ou();)switch(fo){case n:return Pl;case 34:case 39:n!==34&&n!==39&&pV(fo);break;case 40:n===41&&pV(n);break;case 92:ou();break}return Pl}function xIe(n,e){for(;ou()&&n+fo!==57;)if(n+fo===84&&Ep()===47)break;return"/*"+dR(e,Pl-1)+"*"+HN(n===47?n:ou())}function LIe(n){for(;!MC(Ep());)ou();return dR(n,Pl)}function MIe(n){return Cee(vk("",null,null,null,[""],n=wee(n),0,[0],n))}function vk(n,e,i,o,l,u,f,_,E){for(var S=0,C=0,I=f,O=0,M=0,L=0,U=1,B=1,J=1,K=0,ne="",oe=l,se=u,le=o,Y=ne;B;)switch(L=K,K=ou()){case 40:if(L!=108&&Da(Y,I-1)==58){hV(Y+=ci(Ek(K),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:Y+=Ek(K);break;case 9:case 10:case 13:case 32:Y+=NIe(L);break;case 92:Y+=DIe(yk()-1,7);continue;case 47:switch(Ep()){case 42:case 47:LO(UIe(xIe(ou(),yk()),e,i),E);break;default:Y+="/"}break;case 123*U:_[S++]=op(Y)*J;case 125*U:case 59:case 0:switch(K){case 0:case 125:B=0;case 59+C:J==-1&&(Y=ci(Y,/\f/g,"")),M>0&&op(Y)-I&&LO(M>32?Sq(Y+";",o,i,I-1):Sq(ci(Y," ","")+";",o,i,I-2),E);break;case 59:Y+=";";default:if(LO(le=vq(Y,e,i,S,C,l,_,ne,oe=[],se=[],I),u),K===123)if(C===0)vk(Y,e,le,le,oe,u,I,_,se);else switch(O===99&&Da(Y,3)===110?100:O){case 100:case 108:case 109:case 115:vk(n,le,le,o&&LO(vq(n,le,le,0,0,l,_,ne,l,oe=[],I),se),l,se,I,_,o?oe:se);break;default:vk(Y,le,le,le,[""],se,0,_,se)}}S=C=M=0,U=J=1,ne=Y="",I=f;break;case 58:I=1+op(Y),M=L;default:if(U<1){if(K==123)--U;else if(K==125&&U++==0&&kIe()==125)continue}switch(Y+=HN(K),K*U){case 38:J=C>0?1:(Y+="\f",-1);break;case 44:_[S++]=(op(Y)-1)*J,J=1;break;case 64:Ep()===45&&(Y+=Ek(ou())),O=Ep(),C=I=op(ne=Y+=LIe(yk())),K++;break;case 45:L===45&&op(Y)==2&&(U=0)}}return u}function vq(n,e,i,o,l,u,f,_,E,S,C){for(var I=l-1,O=l===0?u:[""],M=Jj(O),L=0,U=0,B=0;L<o;++L)for(var J=0,K=LC(n,I+1,I=CIe(U=f[L])),ne=n;J<M;++J)(ne=bee(U>0?O[J]+" "+K:ci(K,/&\f/g,O[J])))&&(E[B++]=ne);return KN(n,e,i,l===0?Yj:_,E,S,C)}function UIe(n,e,i){return KN(n,e,i,vee,HN(OIe()),LC(n,2,-2),0)}function Sq(n,e,i,o){return KN(n,e,i,Xj,LC(n,0,o),LC(n,o+1,-1),o)}function h0(n,e){for(var i="",o=Jj(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function VIe(n,e,i,o){switch(n.type){case wIe:if(n.children.length)break;case TIe:case Xj:return n.return=n.return||n.value;case vee:return"";case See:return n.return=n.value+"{"+h0(n.children,o)+"}";case Yj:n.value=n.props.join(",")}return op(i=h0(n.children,o))?n.return=n.value+"{"+i+"}":""}function jIe(n){var e=Jj(n);return function(i,o,l,u){for(var f="",_=0;_<e;_++)f+=n[_](i,o,l,u)||"";return f}}function FIe(n){return function(e){e.root||(e=e.return)&&n(e)}}var bq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function Ree(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var BIe=function(e,i,o){for(var l=0,u=0;l=u,u=Ep(),l===38&&u===12&&(i[o]=1),!MC(u);)ou();return dR(e,Pl)},WIe=function(e,i){var o=-1,l=44;do switch(MC(l)){case 0:l===38&&Ep()===12&&(i[o]=1),e[o]+=BIe(Pl-1,i,o);break;case 2:e[o]+=Ek(l);break;case 4:if(l===44){e[++o]=Ep()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=HN(l)}while(l=ou());return e},zIe=function(e,i){return Cee(WIe(wee(e),i))},Tq=new WeakMap,GIe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!Tq.get(o))&&!l){Tq.set(e,!0);for(var u=[],f=zIe(i,u),_=o.props,E=0,S=0;E<f.length;E++)for(var C=0;C<_.length;C++,S++)e.props[S]=u[E]?f[E].replace(/&\f/g,_[C]):_[C]+" "+f[E]}}},HIe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Iee(n,e){switch(IIe(n,e)){case 5103:return ai+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ai+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ai+n+Yk+n+ac+n+n;case 6828:case 4268:return ai+n+ac+n+n;case 6165:return ai+n+ac+"flex-"+n+n;case 5187:return ai+n+ci(n,/(\w+).+(:[^]+)/,ai+"box-$1$2"+ac+"flex-$1$2")+n;case 5443:return ai+n+ac+"flex-item-"+ci(n,/flex-|-self/,"")+n;case 4675:return ai+n+ac+"flex-line-pack"+ci(n,/align-content|flex-|-self/,"")+n;case 5548:return ai+n+ac+ci(n,"shrink","negative")+n;case 5292:return ai+n+ac+ci(n,"basis","preferred-size")+n;case 6060:return ai+"box-"+ci(n,"-grow","")+ai+n+ac+ci(n,"grow","positive")+n;case 4554:return ai+ci(n,/([^-])(transform)/g,"$1"+ai+"$2")+n;case 6187:return ci(ci(ci(n,/(zoom-|grab)/,ai+"$1"),/(image-set)/,ai+"$1"),n,"")+n;case 5495:case 3959:return ci(n,/(image-set\([^]*)/,ai+"$1$`$1");case 4968:return ci(ci(n,/(.+:)(flex-)?(.*)/,ai+"box-pack:$3"+ac+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ai+n+n;case 4095:case 3583:case 4068:case 2532:return ci(n,/(.+)-inline(.+)/,ai+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(op(n)-1-e>6)switch(Da(n,e+1)){case 109:if(Da(n,e+4)!==45)break;case 102:return ci(n,/(.+:)(.+)-([^]+)/,"$1"+ai+"$2-$3$1"+Yk+(Da(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~hV(n,"stretch")?Iee(ci(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Da(n,e+1)!==115)break;case 6444:switch(Da(n,op(n)-3-(~hV(n,"!important")&&10))){case 107:return ci(n,":",":"+ai)+n;case 101:return ci(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ai+(Da(n,14)===45?"inline-":"")+"box$3$1"+ai+"$2$3$1"+ac+"$2box$3")+n}break;case 5936:switch(Da(n,e+11)){case 114:return ai+n+ac+ci(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ai+n+ac+ci(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ai+n+ac+ci(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ai+n+ac+n+n}return n}var $Ie=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case Xj:e.return=Iee(e.value,e.length);break;case See:return h0([Aw(e,{value:ci(e.value,"@","@"+ai)})],l);case Yj:if(e.length)return PIe(e.props,function(u){switch(AIe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return h0([Aw(e,{props:[ci(u,/:(read-\w+)/,":"+Yk+"$1")]})],l);case"::placeholder":return h0([Aw(e,{props:[ci(u,/:(plac\w+)/,":"+ai+"input-$1")]}),Aw(e,{props:[ci(u,/:(plac\w+)/,":"+Yk+"$1")]}),Aw(e,{props:[ci(u,/:(plac\w+)/,ac+"input-$1")]})],l)}return""})}},KIe=[$Ie],qIe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(U){var B=U.getAttribute("data-emotion");B.indexOf(" ")!==-1&&(document.head.appendChild(U),U.setAttribute("data-s",""))})}var l=e.stylisPlugins||KIe,u={},f,_=[];f=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(U){for(var B=U.getAttribute("data-emotion").split(" "),J=1;J<B.length;J++)u[B[J]]=!0;_.push(U)});var E,S=[GIe,HIe];{var C,I=[VIe,FIe(function(U){C.insert(U)})],O=jIe(S.concat(l,I)),M=function(B){return h0(MIe(B),O)};E=function(B,J,K,ne){C=K,M(B?B+"{"+J.styles+"}":J.styles),ne&&(L.inserted[J.name]=!0)}}var L={key:i,sheet:new bIe({key:i,container:f,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:E};return L.sheet.hydrate(_),L};function Jy(){return Jy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Jy.apply(null,arguments)}var Q2={exports:{}},gi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wq;function YIe(){if(wq)return gi;wq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,S=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,M=n?Symbol.for("react.memo"):60115,L=n?Symbol.for("react.lazy"):60116,U=n?Symbol.for("react.block"):60121,B=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function ne(se){if(typeof se=="object"&&se!==null){var le=se.$$typeof;switch(le){case e:switch(se=se.type,se){case E:case S:case o:case u:case l:case I:return se;default:switch(se=se&&se.$$typeof,se){case _:case C:case L:case M:case f:return se;default:return le}}case i:return le}}}function oe(se){return ne(se)===S}return gi.AsyncMode=E,gi.ConcurrentMode=S,gi.ContextConsumer=_,gi.ContextProvider=f,gi.Element=e,gi.ForwardRef=C,gi.Fragment=o,gi.Lazy=L,gi.Memo=M,gi.Portal=i,gi.Profiler=u,gi.StrictMode=l,gi.Suspense=I,gi.isAsyncMode=function(se){return oe(se)||ne(se)===E},gi.isConcurrentMode=oe,gi.isContextConsumer=function(se){return ne(se)===_},gi.isContextProvider=function(se){return ne(se)===f},gi.isElement=function(se){return typeof se=="object"&&se!==null&&se.$$typeof===e},gi.isForwardRef=function(se){return ne(se)===C},gi.isFragment=function(se){return ne(se)===o},gi.isLazy=function(se){return ne(se)===L},gi.isMemo=function(se){return ne(se)===M},gi.isPortal=function(se){return ne(se)===i},gi.isProfiler=function(se){return ne(se)===u},gi.isStrictMode=function(se){return ne(se)===l},gi.isSuspense=function(se){return ne(se)===I},gi.isValidElementType=function(se){return typeof se=="string"||typeof se=="function"||se===o||se===S||se===u||se===l||se===I||se===O||typeof se=="object"&&se!==null&&(se.$$typeof===L||se.$$typeof===M||se.$$typeof===f||se.$$typeof===_||se.$$typeof===C||se.$$typeof===B||se.$$typeof===J||se.$$typeof===K||se.$$typeof===U)},gi.typeOf=ne,gi}var Cq;function XIe(){return Cq||(Cq=1,Q2.exports=YIe()),Q2.exports}var Z2,Rq;function JIe(){if(Rq)return Z2;Rq=1;var n=XIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=o,u[n.Memo]=l;function f(L){return n.isMemo(L)?l:u[L.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,O=Object.prototype;function M(L,U,B){if(typeof U!="string"){if(O){var J=I(U);J&&J!==O&&M(L,J,B)}var K=E(U);S&&(K=K.concat(S(U)));for(var ne=f(L),oe=f(U),se=0;se<K.length;++se){var le=K[se];if(!i[le]&&!(B&&B[le])&&!(oe&&oe[le])&&!(ne&&ne[le])){var Y=C(U,le);try{_(L,le,Y)}catch{}}}}return L}return Z2=M,Z2}var QIe=JIe();const ZIe=Xg(QIe);var eAe=!0;function Aee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var Qj=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||eAe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},Zj=function(e,i,o){Qj(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function tAe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var nAe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},rAe=/[A-Z]|^ms/g,iAe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Pee=function(e){return e.charCodeAt(1)===45},Iq=function(e){return e!=null&&typeof e!="boolean"},eU=Ree(function(n){return Pee(n)?n:n.replace(rAe,"-$&").toLowerCase()}),Aq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(iAe,function(o,l,u){return ap={name:l,styles:u,next:ap},l})}return nAe[e]!==1&&!Pee(e)&&typeof i=="number"&&i!==0?i+"px":i};function UC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return ap={name:l.name,styles:l.styles,next:ap},l.name;var u=i;if(u.styles!==void 0){var f=u.next;if(f!==void 0)for(;f!==void 0;)ap={name:f.name,styles:f.styles,next:ap},f=f.next;var _=u.styles+";";return _}return sAe(n,e,i)}case"function":{if(n!==void 0){var E=ap,S=i(n);return ap=E,UC(n,e,S)}break}}var C=i;if(e==null)return C;var I=e[C];return I!==void 0?I:C}function sAe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=UC(n,e,i[l])+";";else for(var u in i){var f=i[u];if(typeof f!="object"){var _=f;e!=null&&e[_]!==void 0?o+=u+"{"+e[_]+"}":Iq(_)&&(o+=eU(u)+":"+Aq(u,_)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(e==null||e[f[0]]===void 0))for(var E=0;E<f.length;E++)Iq(f[E])&&(o+=eU(u)+":"+Aq(u,f[E])+";");else{var S=UC(n,e,f);switch(u){case"animation":case"animationName":{o+=eU(u)+":"+S+";";break}default:o+=u+"{"+S+"}"}}}return o}var Pq=/label:\s*([^\s;{]+)\s*(;|$)/g,ap;function qN(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";ap=void 0;var u=n[0];if(u==null||u.raw===void 0)o=!1,l+=UC(i,e,u);else{var f=u;l+=f[0]}for(var _=1;_<n.length;_++)if(l+=UC(i,e,n[_]),o){var E=u;l+=E[_]}Pq.lastIndex=0;for(var S="",C;(C=Pq.exec(l))!==null;)S+="-"+C[1];var I=tAe(l)+S;return{name:I,styles:l,next:ap}}var oAe=function(e){return e()},Oee=jK.useInsertionEffect?jK.useInsertionEffect:!1,kee=Oee||oAe,Oq=Oee||k.useLayoutEffect,eF=k.createContext(typeof HTMLElement<"u"?qIe({key:"css"}):null);eF.Provider;var aAe=function(){return k.useContext(eF)},tF=function(e){return k.forwardRef(function(i,o){var l=k.useContext(eF);return e(i,l,o)})},R0=k.createContext({}),cAe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return Jy({},e,i)},lAe=bq(function(n){return bq(function(e){return cAe(n,e)})}),uAe=function(e){var i=k.useContext(R0);return e.theme!==i&&(i=lAe(i)(e.theme)),k.createElement(R0.Provider,{value:i},e.children)},nF={}.hasOwnProperty,fV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",dAe=function(e,i){var o={};for(var l in i)nF.call(i,l)&&(o[l]=i[l]);return o[fV]=e,o},hAe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return Qj(i,o,l),kee(function(){return Zj(i,o,l)}),null},pAe=tF(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[fV],u=[o],f="";typeof n.className=="string"?f=Aee(e.registered,u,n.className):n.className!=null&&(f=n.className+" ");var _=qN(u,void 0,k.useContext(R0));f+=e.key+"-"+_.name;var E={};for(var S in n)nF.call(n,S)&&S!=="css"&&S!==fV&&(E[S]=n[S]);return E.className=f,i&&(E.ref=i),k.createElement(k.Fragment,null,k.createElement(hAe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),k.createElement(l,E))}),fAe=pAe,kq=function(e,i){var o=arguments;if(i==null||!nF.call(i,"css"))return k.createElement.apply(void 0,o);var l=o.length,u=new Array(l);u[0]=fAe,u[1]=dAe(e,i);for(var f=2;f<l;f++)u[f]=o[f];return k.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(kq||(kq={}));var YN=tF(function(n,e){var i=n.styles,o=qN([i],void 0,k.useContext(R0)),l=k.useRef();return Oq(function(){var u=e.key+"-global",f=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(f.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",u),f.hydrate([E])),l.current=[f,_],function(){f.flush()}},[e]),Oq(function(){var u=l.current,f=u[0],_=u[1];if(_){u[1]=!1;return}if(o.next!==void 0&&Zj(e,o.next,!0),f.tags.length){var E=f.tags[f.tags.length-1].nextElementSibling;f.before=E,f.flush()}e.insert("",o,f,!1)},[e,o.name]),null});function mAe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return qN(e)}function hR(){var n=mAe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const rF=k.createContext({});rF.displayName="ColorModeContext";function XN(){const n=k.useContext(rF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Ng(n,e){const{colorMode:i}=XN();return i==="dark"?e:n}const MO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function gAe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const u=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?MO.dark:MO.light),document.body.classList.remove(l?MO.light:MO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=o.query(),f=_=>{l(_.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(f):u.addEventListener("change",f),()=>{typeof u.removeListener=="function"?u.removeListener(f):u.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const _Ae="chakra-ui-color-mode";function yAe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const EAe=yAe(_Ae),Nq=()=>{},vAe=MEe()?k.useLayoutEffect:k.useEffect;function Dq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Nee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:f}={},colorModeManager:_=EAe}=e,E=aAe(),S=u==="dark"?"dark":"light",[C,I]=k.useState(()=>Dq(_,S)),[O,M]=k.useState(()=>Dq(_)),{getSystemTheme:L,setClassName:U,setDataset:B,addListener:J}=k.useMemo(()=>gAe({preventTransition:f,nonce:E==null?void 0:E.nonce}),[f,E==null?void 0:E.nonce]),K=u==="system"&&!C?O:C,ne=k.useCallback(le=>{const Y=le==="system"?L():le;I(Y),U(Y==="dark"),B(Y),_.set(Y)},[_,L,U,B]);vAe(()=>{u==="system"&&M(L())},[]),k.useEffect(()=>{const le=_.get();if(le){ne(le);return}if(u==="system"){ne("system");return}ne(S)},[_,S,u,ne]);const oe=k.useCallback(()=>{ne(K==="dark"?"light":"dark")},[K,ne]);k.useEffect(()=>{if(l)return J(ne)},[l,J,ne]);const se=k.useMemo(()=>({colorMode:i??K,toggleColorMode:i?Nq:oe,setColorMode:i?Nq:ne,forced:i!==void 0}),[K,oe,ne,i]);return b.jsx(rF.Provider,{value:se,children:o})};Nee.displayName="ColorModeProvider";const Dee=String.raw,xee=Dee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,SAe=()=>b.jsx(YN,{styles:xee}),bAe=({scope:n=""})=>b.jsx(YN,{styles:Dee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${xee}
    `});function TAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=k.useMemo(()=>c0e(i),[i]);return b.jsxs(uAe,{theme:l,children:[b.jsx(wAe,{root:e}),o]})}function wAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return b.jsx(YN,{styles:i=>({[e]:i.__cssVars})})}Ai({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function CAe(){const{colorMode:n}=XN();return b.jsx(YN,{styles:e=>{const i=BZ(e,"styles.global"),o=bl(i,{theme:e,colorMode:n});return o?see(o)(e):void 0}})}const[RAe,IAe]=Ai({strict:!1,name:"PortalManagerContext"});function iF(n){const{children:e,zIndex:i}=n;return b.jsx(RAe,{value:{zIndex:i},children:e})}iF.displayName="PortalManager";const sF=k.createContext({getDocument(){return document},getWindow(){return window}});sF.displayName="EnvironmentContext";function AAe({defer:n}={}){const[,e]=k.useReducer(i=>i+1,0);return _p(()=>{n&&e()},[n]),k.useContext(sF)}function Lee(n){const{children:e,environment:i,disabled:o}=n,l=k.useRef(null),u=k.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),f=!o||!i;return b.jsxs(sF.Provider,{value:u,children:[e,f&&b.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Lee.displayName="EnvironmentProvider";const PAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:u=!0,theme:f={},environment:_,cssVarsRoot:E,disableEnvironment:S,disableGlobalStyle:C}=n,I=b.jsx(Lee,{environment:_,disabled:S,children:e});return b.jsx(TAe,{theme:f,cssVarsRoot:E,children:b.jsxs(Nee,{colorModeManager:i,options:f.config,children:[u?b.jsx(bAe,{scope:l}):b.jsx(SAe,{}),!C&&b.jsx(CAe,{}),o?b.jsx(iF,{zIndex:o,children:I}):I]})})},oF=k.createContext({});function aF(n){const e=k.useRef(null);return e.current===null&&(e.current=n()),e.current}const pR=k.createContext(null),cF=k.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class OAe extends k.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function kAe({children:n,isPresent:e}){const i=k.useId(),o=k.useRef(null),l=k.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=k.useContext(cF);return k.useInsertionEffect(()=>{const{width:f,height:_,top:E,left:S}=l.current;if(e||!o.current||!f||!_)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return u&&(C.nonce=u),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${S}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),b.jsx(OAe,{isPresent:e,childRef:o,sizeRef:l,children:k.cloneElement(n,{ref:o})})}const NAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:f})=>{const _=aF(DAe),E=k.useId(),S=k.useCallback(I=>{_.set(I,!0);for(const O of _.values())if(!O)return;o&&o()},[_,o]),C=k.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:S,register:I=>(_.set(I,!1),()=>_.delete(I))}),u?[Math.random(),S]:[i,S]);return k.useMemo(()=>{_.forEach((I,O)=>_.set(O,!1))},[i]),k.useEffect(()=>{!i&&!_.size&&o&&o()},[i]),f==="popLayout"&&(n=b.jsx(kAe,{isPresent:i,children:n})),b.jsx(pR.Provider,{value:C,children:n})};function DAe(){return new Map}function lF(n=!0){const e=k.useContext(pR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,u=k.useId();k.useEffect(()=>{n&&l(u)},[n]);const f=k.useCallback(()=>n&&o&&o(u),[u,o,n]);return!i&&o?[!1,f]:[!0]}function xAe(){return LAe(k.useContext(pR))}function LAe(n){return n===null?!0:n.isPresent}const UO=n=>n.key||"";function xq(n){const e=[];return k.Children.forEach(n,i=>{k.isValidElement(i)&&e.push(i)}),e}const uF=typeof window<"u",Mee=uF?k.useLayoutEffect:k.useEffect,J0=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:u="sync",propagate:f=!1})=>{const[_,E]=lF(f),S=k.useMemo(()=>xq(n),[n]),C=f&&!_?[]:S.map(UO),I=k.useRef(!0),O=k.useRef(S),M=aF(()=>new Map),[L,U]=k.useState(S),[B,J]=k.useState(S);Mee(()=>{I.current=!1,O.current=S;for(let oe=0;oe<B.length;oe++){const se=UO(B[oe]);C.includes(se)?M.delete(se):M.get(se)!==!0&&M.set(se,!1)}},[B,C.length,C.join("-")]);const K=[];if(S!==L){let oe=[...S];for(let se=0;se<B.length;se++){const le=B[se],Y=UO(le);C.includes(Y)||(oe.splice(se,0,le),K.push(le))}u==="wait"&&K.length&&(oe=K),J(xq(oe)),U(S);return}const{forceRender:ne}=k.useContext(oF);return b.jsx(b.Fragment,{children:B.map(oe=>{const se=UO(oe),le=f&&!_?!1:S===B||C.includes(se),Y=()=>{if(M.has(se))M.set(se,!0);else return;let Z=!0;M.forEach(X=>{X||(Z=!1)}),Z&&(ne==null||ne(),J(O.current),f&&(E==null||E()),o&&o())};return b.jsx(NAe,{isPresent:le,initial:!I.current||i?void 0:!1,custom:le?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:le?void 0:Y,children:oe},se)})})},au=n=>n;let Uee=au;function dF(n){let e;return()=>(e===void 0&&(e=n()),e)}const I0=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},zf=n=>n*1e3,Gf=n=>n/1e3,MAe={useManualTiming:!1};function UAe(n){let e=new Set,i=new Set,o=!1,l=!1;const u=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function _(S){u.has(S)&&(E.schedule(S),n()),S(f)}const E={schedule:(S,C=!1,I=!1)=>{const M=I&&o?e:i;return C&&u.add(S),M.has(S)||M.add(S),S},cancel:S=>{i.delete(S),u.delete(S)},process:S=>{if(f=S,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(_),e.clear(),o=!1,l&&(l=!1,E.process(S))}};return E}const VO=["read","resolveKeyframes","update","preRender","render","postRender"],VAe=40;function Vee(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,f=VO.reduce((J,K)=>(J[K]=UAe(u),J),{}),{read:_,resolveKeyframes:E,update:S,preRender:C,render:I,postRender:O}=f,M=()=>{const J=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(J-l.timestamp,VAe),1),l.timestamp=J,l.isProcessing=!0,_.process(l),E.process(l),S.process(l),C.process(l),I.process(l),O.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(M))},L=()=>{i=!0,o=!0,l.isProcessing||n(M)};return{schedule:VO.reduce((J,K)=>{const ne=f[K];return J[K]=(oe,se=!1,le=!1)=>(i||L(),ne.schedule(oe,se,le)),J},{}),cancel:J=>{for(let K=0;K<VO.length;K++)f[VO[K]].cancel(J)},state:l,steps:f}}const{schedule:os,cancel:Fg,state:Oa,steps:tU}=Vee(typeof requestAnimationFrame<"u"?requestAnimationFrame:au,!0),jee=k.createContext({strict:!1}),Lq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},A0={};for(const n in Lq)A0[n]={isEnabled:e=>Lq[n].some(i=>!!e[i])};function jAe(n){for(const e in n)A0[e]={...A0[e],...n[e]}}const FAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Xk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||FAe.has(n)}let Fee=n=>!Xk(n);function BAe(n){n&&(Fee=e=>e.startsWith("on")?!Xk(e):n(e))}try{BAe(require("@emotion/is-prop-valid").default)}catch{}function WAe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(Fee(l)||i===!0&&Xk(l)||!e&&!Xk(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function zAe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const JN=k.createContext({});function VC(n){return typeof n=="string"||Array.isArray(n)}function QN(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const hF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],pF=["initial",...hF];function ZN(n){return QN(n.animate)||pF.some(e=>VC(n[e]))}function Bee(n){return!!(ZN(n)||n.variants)}function GAe(n,e){if(ZN(n)){const{initial:i,animate:o}=n;return{initial:i===!1||VC(i)?i:void 0,animate:VC(o)?o:void 0}}return n.inherit!==!1?e:{}}function HAe(n){const{initial:e,animate:i}=GAe(n,k.useContext(JN));return k.useMemo(()=>({initial:e,animate:i}),[Mq(e),Mq(i)])}function Mq(n){return Array.isArray(n)?n.join(" "):n}const $Ae=Symbol.for("motionComponentSymbol");function QS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function KAe(n,e,i){return k.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):QS(i)&&(i.current=o))},[e])}const fF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),qAe="framerAppearId",Wee="data-"+fF(qAe),{schedule:mF}=Vee(queueMicrotask,!1),zee=k.createContext({});function YAe(n,e,i,o,l){var u,f;const{visualElement:_}=k.useContext(JN),E=k.useContext(jee),S=k.useContext(pR),C=k.useContext(cF).reducedMotion,I=k.useRef(null);o=o||E.renderer,!I.current&&o&&(I.current=o(n,{visualState:e,parent:_,props:i,presenceContext:S,blockInitialAnimation:S?S.initial===!1:!1,reducedMotionConfig:C}));const O=I.current,M=k.useContext(zee);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&XAe(I.current,i,l,M);const L=k.useRef(!1);k.useInsertionEffect(()=>{O&&L.current&&O.update(i,S)});const U=i[Wee],B=k.useRef(!!U&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,U))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,U)));return Mee(()=>{O&&(L.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),mF.render(O.render),B.current&&O.animationState&&O.animationState.animateChanges())}),k.useEffect(()=>{O&&(!B.current&&O.animationState&&O.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,U)}),B.current=!1))}),O}function XAe(n,e,i,o){const{layoutId:l,layout:u,drag:f,dragConstraints:_,layoutScroll:E,layoutRoot:S}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:Gee(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!f||_&&QS(_),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:E,layoutRoot:S})}function Gee(n){if(n)return n.options.allowProjection!==!1?n.projection:Gee(n.parent)}function JAe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var u,f;n&&jAe(n);function _(S,C){let I;const O={...k.useContext(cF),...S,layoutId:QAe(S)},{isStatic:M}=O,L=HAe(S),U=o(S,M);if(!M&&uF){ZAe();const B=ePe(O);I=B.MeasureLayout,L.visualElement=YAe(l,U,O,e,B.ProjectionNode)}return b.jsxs(JN.Provider,{value:L,children:[I&&L.visualElement?b.jsx(I,{visualElement:L.visualElement,...O}):null,i(l,S,KAe(U,L.visualElement,C),U,M,L.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(f=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&f!==void 0?f:""})`}`;const E=k.forwardRef(_);return E[$Ae]=l,E}function QAe({layoutId:n}){const e=k.useContext(oF).id;return e&&n!==void 0?e+"-"+n:n}function ZAe(n,e){k.useContext(jee).strict}function ePe(n){const{drag:e,layout:i}=A0;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const tPe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function gF(n){return typeof n!="string"||n.includes("-")?!1:!!(tPe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Uq(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function _F(n,e,i,o){if(typeof e=="function"){const[l,u]=Uq(o);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=Uq(o);e=e(i!==void 0?i:n.custom,l,u)}return e}const mV=n=>Array.isArray(n),nPe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),rPe=n=>mV(n)?n[n.length-1]||0:n,dc=n=>!!(n&&n.getVelocity);function Sk(n){const e=dc(n)?n.get():n;return nPe(e)?e.toValue():e}function iPe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,u){const f={latestValues:sPe(o,l,u,n),renderState:e()};return i&&(f.onMount=_=>i({props:o,current:_,...f}),f.onUpdate=_=>i(_)),f}const Hee=n=>(e,i)=>{const o=k.useContext(JN),l=k.useContext(pR),u=()=>iPe(n,e,o,l);return i?u():aF(u)};function sPe(n,e,i,o){const l={},u=o(n,{});for(const O in u)l[O]=Sk(u[O]);let{initial:f,animate:_}=n;const E=ZN(n),S=Bee(n);e&&S&&!E&&n.inherit!==!1&&(f===void 0&&(f=e.initial),_===void 0&&(_=e.animate));let C=i?i.initial===!1:!1;C=C||f===!1;const I=C?_:f;if(I&&typeof I!="boolean"&&!QN(I)){const O=Array.isArray(I)?I:[I];for(let M=0;M<O.length;M++){const L=_F(n,O[M]);if(L){const{transitionEnd:U,transition:B,...J}=L;for(const K in J){let ne=J[K];if(Array.isArray(ne)){const oe=C?ne.length-1:0;ne=ne[oe]}ne!==null&&(l[K]=ne)}for(const K in U)l[K]=U[K]}}}return l}const Q0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],cE=new Set(Q0),$ee=n=>e=>typeof e=="string"&&e.startsWith(n),Kee=$ee("--"),oPe=$ee("var(--"),yF=n=>oPe(n)?aPe.test(n.split("/*")[0].trim()):!1,aPe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,qee=(n,e)=>e&&typeof n=="number"?e.transform(n):n,em=(n,e,i)=>i>e?e:i<n?n:i,Z0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},jC={...Z0,transform:n=>em(0,1,n)},jO={...Z0,default:1},fR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),Tg=fR("deg"),vp=fR("%"),Wn=fR("px"),cPe=fR("vh"),lPe=fR("vw"),Vq={...vp,parse:n=>vp.parse(n)/100,transform:n=>vp.transform(n*100)},uPe={borderWidth:Wn,borderTopWidth:Wn,borderRightWidth:Wn,borderBottomWidth:Wn,borderLeftWidth:Wn,borderRadius:Wn,radius:Wn,borderTopLeftRadius:Wn,borderTopRightRadius:Wn,borderBottomRightRadius:Wn,borderBottomLeftRadius:Wn,width:Wn,maxWidth:Wn,height:Wn,maxHeight:Wn,top:Wn,right:Wn,bottom:Wn,left:Wn,padding:Wn,paddingTop:Wn,paddingRight:Wn,paddingBottom:Wn,paddingLeft:Wn,margin:Wn,marginTop:Wn,marginRight:Wn,marginBottom:Wn,marginLeft:Wn,backgroundPositionX:Wn,backgroundPositionY:Wn},dPe={rotate:Tg,rotateX:Tg,rotateY:Tg,rotateZ:Tg,scale:jO,scaleX:jO,scaleY:jO,scaleZ:jO,skew:Tg,skewX:Tg,skewY:Tg,distance:Wn,translateX:Wn,translateY:Wn,translateZ:Wn,x:Wn,y:Wn,z:Wn,perspective:Wn,transformPerspective:Wn,opacity:jC,originX:Vq,originY:Vq,originZ:Wn},jq={...Z0,transform:Math.round},EF={...uPe,...dPe,zIndex:jq,size:Wn,fillOpacity:jC,strokeOpacity:jC,numOctaves:jq},hPe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},pPe=Q0.length;function fPe(n,e,i){let o="",l=!0;for(let u=0;u<pPe;u++){const f=Q0[u],_=n[f];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(f.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const S=qee(_,EF[f]);if(!E){l=!1;const C=hPe[f]||f;o+=`${C}(${S}) `}i&&(e[f]=S)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function vF(n,e,i){const{style:o,vars:l,transformOrigin:u}=n;let f=!1,_=!1;for(const E in e){const S=e[E];if(cE.has(E)){f=!0;continue}else if(Kee(E)){l[E]=S;continue}else{const C=qee(S,EF[E]);E.startsWith("origin")?(_=!0,u[E]=C):o[E]=C}}if(e.transform||(f||i?o.transform=fPe(e,n.transform,i):o.transform&&(o.transform="none")),_){const{originX:E="50%",originY:S="50%",originZ:C=0}=u;o.transformOrigin=`${E} ${S} ${C}`}}const mPe={offset:"stroke-dashoffset",array:"stroke-dasharray"},gPe={offset:"strokeDashoffset",array:"strokeDasharray"};function _Pe(n,e,i=1,o=0,l=!0){n.pathLength=1;const u=l?mPe:gPe;n[u.offset]=Wn.transform(-o);const f=Wn.transform(e),_=Wn.transform(i);n[u.array]=`${f} ${_}`}function Fq(n,e,i){return typeof n=="string"?n:Wn.transform(e+i*n)}function yPe(n,e,i){const o=Fq(e,n.x,n.width),l=Fq(i,n.y,n.height);return`${o} ${l}`}function SF(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:u,pathLength:f,pathSpacing:_=1,pathOffset:E=0,...S},C,I){if(vF(n,S,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:M,dimensions:L}=n;O.transform&&(L&&(M.transform=O.transform),delete O.transform),L&&(l!==void 0||u!==void 0||M.transform)&&(M.transformOrigin=yPe(L,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(O.x=e),i!==void 0&&(O.y=i),o!==void 0&&(O.scale=o),f!==void 0&&_Pe(O,f,_,E,!1)}const bF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Yee=()=>({...bF(),attrs:{}}),TF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Xee(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const u in i)n.style.setProperty(u,i[u])}const Jee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Qee(n,e,i,o){Xee(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(Jee.has(l)?l:fF(l),e.attrs[l])}const Jk={};function EPe(n){Object.assign(Jk,n)}function Zee(n,{layout:e,layoutId:i}){return cE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!Jk[n]||n==="opacity")}function wF(n,e,i){var o;const{style:l}=n,u={};for(const f in l)(dc(l[f])||e.style&&dc(e.style[f])||Zee(f,n)||((o=i==null?void 0:i.getValue(f))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[f]=l[f]);return u}function ete(n,e,i){const o=wF(n,e,i);for(const l in n)if(dc(n[l])||dc(e[l])){const u=Q0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[u]=n[l]}return o}function vPe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const Bq=["x","y","width","height","cx","cy","r"],SPe={useVisualState:Hee({scrapeMotionValuesFromProps:ete,createRenderState:Yee,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const _ in l)if(cE.has(_)){u=!0;break}}if(!u)return;let f=!e;if(e)for(let _=0;_<Bq.length;_++){const E=Bq[_];n[E]!==e[E]&&(f=!0)}f&&os.read(()=>{vPe(i,o),os.render(()=>{SF(o,l,TF(i.tagName),n.transformTemplate),Qee(i,o)})})}})},bPe={useVisualState:Hee({scrapeMotionValuesFromProps:wF,createRenderState:bF})};function tte(n,e,i){for(const o in e)!dc(e[o])&&!Zee(o,i)&&(n[o]=e[o])}function TPe({transformTemplate:n},e){return k.useMemo(()=>{const i=bF();return vF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function wPe(n,e){const i=n.style||{},o={};return tte(o,i,n),Object.assign(o,TPe(n,e)),o}function CPe(n,e){const i={},o=wPe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function RPe(n,e,i,o){const l=k.useMemo(()=>{const u=Yee();return SF(u,e,TF(o),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};tte(u,n.style,n),l.style={...u,...l.style}}return l}function IPe(n=!1){return(i,o,l,{latestValues:u},f)=>{const E=(gF(i)?RPe:CPe)(o,u,f,i),S=WAe(o,typeof i=="string",n),C=i!==k.Fragment?{...S,...E,ref:l}:{},{children:I}=o,O=k.useMemo(()=>dc(I)?I.get():I,[I]);return k.createElement(i,{...C,children:O})}}function APe(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...gF(o)?SPe:bPe,preloadedFeatures:n,useRender:IPe(l),createVisualElement:e,Component:o};return JAe(f)}}function nte(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function e1(n,e,i){const o=n.getProps();return _F(o,e,i!==void 0?i:o.custom,n)}const PPe=dF(()=>window.ScrollTimeline!==void 0);class OPe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(PPe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class kPe extends OPe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function CF(n,e){return n?n[e]||n.default||n:void 0}const gV=2e4;function rte(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<gV;)e+=i,o=n.next(e);return e>=gV?1/0:e}function RF(n){return typeof n=="function"}function Wq(n,e){n.timeline=e,n.onfinish=null}const IF=n=>Array.isArray(n)&&typeof n[0]=="number",NPe={linearEasing:void 0};function DPe(n,e){const i=dF(n);return()=>{var o;return(o=NPe[e])!==null&&o!==void 0?o:i()}}const Qk=DPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ite=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)o+=n(I0(0,l-1,u))+", ";return`linear(${o.substring(0,o.length-2)})`};function ste(n){return!!(typeof n=="function"&&Qk()||!n||typeof n=="string"&&(n in _V||Qk())||IF(n)||Array.isArray(n)&&n.every(ste))}const Qw=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,_V={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Qw([0,.65,.55,1]),circOut:Qw([.55,0,1,.45]),backIn:Qw([.31,.01,.66,-.59]),backOut:Qw([.33,1.53,.69,.99])};function ote(n,e){if(n)return typeof n=="function"&&Qk()?ite(n,e):IF(n)?Qw(n):Array.isArray(n)?n.map(i=>ote(i,e)||_V.easeOut):_V[n]}const eh={x:!1,y:!1};function ate(){return eh.x||eh.y}function xPe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function cte(n,e){const i=xPe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function zq(n){return e=>{e.pointerType==="touch"||ate()||n(e)}}function LPe(n,e,i={}){const[o,l,u]=cte(n,i),f=zq(_=>{const{target:E}=_,S=e(_);if(typeof S!="function"||!E)return;const C=zq(I=>{S(I),E.removeEventListener("pointerleave",C)});E.addEventListener("pointerleave",C,l)});return o.forEach(_=>{_.addEventListener("pointerenter",f,l)}),u}const lte=(n,e)=>e?n===e?!0:lte(n,e.parentElement):!1,AF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,MPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function UPe(n){return MPe.has(n.tagName)||n.tabIndex!==-1}const Zw=new WeakSet;function Gq(n){return e=>{e.key==="Enter"&&n(e)}}function nU(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const VPe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=Gq(()=>{if(Zw.has(i))return;nU(i,"down");const l=Gq(()=>{nU(i,"up")}),u=()=>nU(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function Hq(n){return AF(n)&&!ate()}function jPe(n,e,i={}){const[o,l,u]=cte(n,i),f=_=>{const E=_.currentTarget;if(!Hq(_)||Zw.has(E))return;Zw.add(E);const S=e(_),C=(M,L)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",O),!(!Hq(M)||!Zw.has(E))&&(Zw.delete(E),typeof S=="function"&&S(M,{success:L}))},I=M=>{C(M,i.useGlobalTarget||lte(E,M.target))},O=M=>{C(M,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",O,l)};return o.forEach(_=>{!UPe(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",f,l),_.addEventListener("focus",S=>VPe(S,l),l)}),u}function FPe(n){return n==="x"||n==="y"?eh[n]?null:(eh[n]=!0,()=>{eh[n]=!1}):eh.x||eh.y?null:(eh.x=eh.y=!0,()=>{eh.x=eh.y=!1})}const ute=new Set(["width","height","top","left","right","bottom",...Q0]);let bk;function BPe(){bk=void 0}const Sp={now:()=>(bk===void 0&&Sp.set(Oa.isProcessing||MAe.useManualTiming?Oa.timestamp:performance.now()),bk),set:n=>{bk=n,queueMicrotask(BPe)}};function PF(n,e){n.indexOf(e)===-1&&n.push(e)}function OF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class kF{constructor(){this.subscriptions=[]}add(e){return PF(this.subscriptions,e),()=>OF(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let u=0;u<l;u++){const f=this.subscriptions[u];f&&f(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function dte(n,e){return e?n*(1e3/e):0}const $q=30,WPe=n=>!isNaN(parseFloat(n));class zPe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const u=Sp.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Sp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=WPe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new kF);const o=this.events[e].add(i);return e==="change"?()=>{o(),os.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Sp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>$q)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,$q);return dte(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function FC(n,e){return new zPe(n,e)}function GPe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,FC(i))}function HPe(n,e){const i=e1(n,e);let{transitionEnd:o={},transition:l={},...u}=i||{};u={...u,...o};for(const f in u){const _=rPe(u[f]);GPe(n,f,_)}}function $Pe(n){return!!(dc(n)&&n.add)}function yV(n,e){const i=n.getValue("willChange");if($Pe(i))return i.add(e)}function hte(n){return n.props[Wee]}const pte=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,KPe=1e-7,qPe=12;function YPe(n,e,i,o,l){let u,f,_=0;do f=e+(i-e)/2,u=pte(f,o,l)-n,u>0?i=f:e=f;while(Math.abs(u)>KPe&&++_<qPe);return f}function mR(n,e,i,o){if(n===e&&i===o)return au;const l=u=>YPe(u,0,1,n,i);return u=>u===0||u===1?u:pte(l(u),e,o)}const fte=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,mte=n=>e=>1-n(1-e),gte=mR(.33,1.53,.69,.99),NF=mte(gte),_te=fte(NF),yte=n=>(n*=2)<1?.5*NF(n):.5*(2-Math.pow(2,-10*(n-1))),DF=n=>1-Math.sin(Math.acos(n)),Ete=mte(DF),vte=fte(DF),Ste=n=>/^0[^.\s]+$/u.test(n);function XPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||Ste(n):!0}const gC=n=>Math.round(n*1e5)/1e5,xF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function JPe(n){return n==null}const QPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,LF=(n,e)=>i=>!!(typeof i=="string"&&QPe.test(i)&&i.startsWith(n)||e&&!JPe(i)&&Object.prototype.hasOwnProperty.call(i,e)),bte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,u,f,_]=o.match(xF);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},ZPe=n=>em(0,255,n),rU={...Z0,transform:n=>Math.round(ZPe(n))},xy={test:LF("rgb","red"),parse:bte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+rU.transform(n)+", "+rU.transform(e)+", "+rU.transform(i)+", "+gC(jC.transform(o))+")"};function eOe(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const EV={test:LF("#"),parse:eOe,transform:xy.transform},ZS={test:LF("hsl","hue"),parse:bte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+vp.transform(gC(e))+", "+vp.transform(gC(i))+", "+gC(jC.transform(o))+")"},cc={test:n=>xy.test(n)||EV.test(n)||ZS.test(n),parse:n=>xy.test(n)?xy.parse(n):ZS.test(n)?ZS.parse(n):EV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?xy.transform(n):ZS.transform(n)},tOe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function nOe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(xF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(tOe))===null||i===void 0?void 0:i.length)||0)>0}const Tte="number",wte="color",rOe="var",iOe="var(",Kq="${}",sOe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function BC(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let u=0;const _=e.replace(sOe,E=>(cc.test(E)?(o.color.push(u),l.push(wte),i.push(cc.parse(E))):E.startsWith(iOe)?(o.var.push(u),l.push(rOe),i.push(E)):(o.number.push(u),l.push(Tte),i.push(parseFloat(E))),++u,Kq)).split(Kq);return{values:i,split:_,indexes:o,types:l}}function Cte(n){return BC(n).values}function Rte(n){const{split:e,types:i}=BC(n),o=e.length;return l=>{let u="";for(let f=0;f<o;f++)if(u+=e[f],l[f]!==void 0){const _=i[f];_===Tte?u+=gC(l[f]):_===wte?u+=cc.transform(l[f]):u+=l[f]}return u}}const oOe=n=>typeof n=="number"?0:n;function aOe(n){const e=Cte(n);return Rte(n)(e.map(oOe))}const Bg={test:nOe,parse:Cte,createTransformer:Rte,getAnimatableNone:aOe},cOe=new Set(["brightness","contrast","saturate","opacity"]);function lOe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(xF)||[];if(!o)return n;const l=i.replace(o,"");let u=cOe.has(e)?1:0;return o!==i&&(u*=100),e+"("+u+l+")"}const uOe=/\b([a-z-]*)\(.*?\)/gu,vV={...Bg,getAnimatableNone:n=>{const e=n.match(uOe);return e?e.map(lOe).join(" "):n}},dOe={...EF,color:cc,backgroundColor:cc,outlineColor:cc,fill:cc,stroke:cc,borderColor:cc,borderTopColor:cc,borderRightColor:cc,borderBottomColor:cc,borderLeftColor:cc,filter:vV,WebkitFilter:vV},MF=n=>dOe[n];function Ite(n,e){let i=MF(n);return i!==vV&&(i=Bg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const hOe=new Set(["auto","none","0"]);function pOe(n,e,i){let o=0,l;for(;o<n.length&&!l;){const u=n[o];typeof u=="string"&&!hOe.has(u)&&BC(u).values.length&&(l=n[o]),o++}if(l&&i)for(const u of e)n[u]=Ite(i,l)}const qq=n=>n===Z0||n===Wn,Yq=(n,e)=>parseFloat(n.split(", ")[e]),Xq=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return Yq(l[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?Yq(u[1],n):0}},fOe=new Set(["x","y","z"]),mOe=Q0.filter(n=>!fOe.has(n));function gOe(n){const e=[];return mOe.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const P0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:Xq(4,13),y:Xq(5,14)};P0.translateX=P0.x;P0.translateY=P0.y;const Wy=new Set;let SV=!1,bV=!1;function Ate(){if(bV){const n=Array.from(Wy).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=gOe(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([u,f])=>{var _;(_=o.getValue(u))===null||_===void 0||_.set(f)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}bV=!1,SV=!1,Wy.forEach(n=>n.complete()),Wy.clear()}function Pte(){Wy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(bV=!0)})}function _Oe(){Pte(),Ate()}class UF{constructor(e,i,o,l,u,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=u,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Wy.add(this),SV||(SV=!0,os.read(Pte),os.resolveKeyframes(Ate))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const f=l==null?void 0:l.get(),_=e[e.length-1];if(f!==void 0)e[0]=f;else if(o&&i){const E=o.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&f===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Wy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Wy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Ote=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),yOe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function EOe(n){const e=yOe.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function kte(n,e,i=1){const[o,l]=EOe(n);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const f=u.trim();return Ote(f)?parseFloat(f):f}return yF(l)?kte(l,e,i+1):l}const Nte=n=>e=>e.test(n),vOe={test:n=>n==="auto",parse:n=>n},Dte=[Z0,Wn,vp,Tg,lPe,cPe,vOe],Jq=n=>Dte.find(Nte(n));class xte extends UF{constructor(e,i,o,l,u){super(e,i,o,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let S=e[E];if(typeof S=="string"&&(S=S.trim(),yF(S))){const C=kte(S,i.current);C!==void 0&&(e[E]=C),E===e.length-1&&(this.finalKeyframe=S)}}if(this.resolveNoneKeyframes(),!ute.has(o)||e.length!==2)return;const[l,u]=e,f=Jq(l),_=Jq(u);if(f!==_)if(qq(f)&&qq(_))for(let E=0;E<e.length;E++){const S=e[E];typeof S=="string"&&(e[E]=parseFloat(S))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)XPe(e[l])&&o.push(l);o.length&&pOe(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=P0[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(o);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,_=l[f];l[f]=P0[o](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,S])=>{i.getValue(E).set(S)}),this.resolveNoneKeyframes()}}const Qq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Bg.test(n)||n==="0")&&!n.startsWith("url("));function SOe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function bOe(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],f=Qq(l,e),_=Qq(u,e);return!f||!_?!1:SOe(n)||(i==="spring"||RF(i))&&o}const TOe=n=>n!==null;function t1(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(TOe),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const wOe=40;class Lte{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:f="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Sp.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:u,repeatType:f,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>wOe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&_Oe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=Sp.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:u,delay:f,onComplete:_,onUpdate:E,isGenerator:S}=this.options;if(!S&&!bOe(e,o,l,u))if(f)this.options.duration=0;else{E&&E(t1(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Cs=(n,e,i)=>n+(e-n)*i;function iU(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function COe({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,u=0,f=0;if(!e)l=u=f=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=iU(E,_,n+1/3),u=iU(E,_,n),f=iU(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:o}}function Zk(n,e){return i=>i>0?e:n}const sU=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},ROe=[EV,xy,ZS],IOe=n=>ROe.find(e=>e.test(n));function Zq(n){const e=IOe(n);if(!e)return!1;let i=e.parse(n);return e===ZS&&(i=COe(i)),i}const eY=(n,e)=>{const i=Zq(n),o=Zq(e);if(!i||!o)return Zk(n,e);const l={...i};return u=>(l.red=sU(i.red,o.red,u),l.green=sU(i.green,o.green,u),l.blue=sU(i.blue,o.blue,u),l.alpha=Cs(i.alpha,o.alpha,u),xy.transform(l))},AOe=(n,e)=>i=>e(n(i)),gR=(...n)=>n.reduce(AOe),TV=new Set(["none","hidden"]);function POe(n,e){return TV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function OOe(n,e){return i=>Cs(n,e,i)}function VF(n){return typeof n=="number"?OOe:typeof n=="string"?yF(n)?Zk:cc.test(n)?eY:DOe:Array.isArray(n)?Mte:typeof n=="object"?cc.test(n)?eY:kOe:Zk}function Mte(n,e){const i=[...n],o=i.length,l=n.map((u,f)=>VF(u)(u,e[f]));return u=>{for(let f=0;f<o;f++)i[f]=l[f](u);return i}}function kOe(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=VF(n[l])(n[l],e[l]));return l=>{for(const u in o)i[u]=o[u](l);return i}}function NOe(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const f=e.types[u],_=n.indexes[f][l[f]],E=(i=n.values[_])!==null&&i!==void 0?i:0;o[u]=E,l[f]++}return o}const DOe=(n,e)=>{const i=Bg.createTransformer(e),o=BC(n),l=BC(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?TV.has(n)&&!l.values.length||TV.has(e)&&!o.values.length?POe(n,e):gR(Mte(NOe(o,l),l.values),i):Zk(n,e)};function Ute(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?Cs(n,e,i):VF(n)(n,e)}const xOe=5;function Vte(n,e,i){const o=Math.max(e-xOe,0);return dte(i-n(o),e-o)}const Gs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},tY=.001;function LOe({duration:n=Gs.duration,bounce:e=Gs.bounce,velocity:i=Gs.velocity,mass:o=Gs.mass}){let l,u,f=1-e;f=em(Gs.minDamping,Gs.maxDamping,f),n=em(Gs.minDuration,Gs.maxDuration,Gf(n)),f<1?(l=S=>{const C=S*f,I=C*n,O=C-i,M=wV(S,f),L=Math.exp(-I);return tY-O/M*L},u=S=>{const I=S*f*n,O=I*i+i,M=Math.pow(f,2)*Math.pow(S,2)*n,L=Math.exp(-I),U=wV(Math.pow(S,2),f);return(-l(S)+tY>0?-1:1)*((O-M)*L)/U}):(l=S=>{const C=Math.exp(-S*n),I=(S-i)*n+1;return-.001+C*I},u=S=>{const C=Math.exp(-S*n),I=(i-S)*(n*n);return C*I});const _=5/n,E=UOe(l,u,_);if(n=zf(n),isNaN(E))return{stiffness:Gs.stiffness,damping:Gs.damping,duration:n};{const S=Math.pow(E,2)*o;return{stiffness:S,damping:f*2*Math.sqrt(o*S),duration:n}}}const MOe=12;function UOe(n,e,i){let o=i;for(let l=1;l<MOe;l++)o=o-n(o)/e(o);return o}function wV(n,e){return n*Math.sqrt(1-e*e)}const VOe=["duration","bounce"],jOe=["stiffness","damping","mass"];function nY(n,e){return e.some(i=>n[i]!==void 0)}function FOe(n){let e={velocity:Gs.velocity,stiffness:Gs.stiffness,damping:Gs.damping,mass:Gs.mass,isResolvedFromDuration:!1,...n};if(!nY(n,jOe)&&nY(n,VOe))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,u=2*em(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Gs.mass,stiffness:l,damping:u}}else{const i=LOe(n);e={...e,...i,mass:Gs.mass},e.isResolvedFromDuration=!0}return e}function jte(n=Gs.visualDuration,e=Gs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const u=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],_={done:!1,value:u},{stiffness:E,damping:S,mass:C,duration:I,velocity:O,isResolvedFromDuration:M}=FOe({...i,velocity:-Gf(i.velocity||0)}),L=O||0,U=S/(2*Math.sqrt(E*C)),B=f-u,J=Gf(Math.sqrt(E/C)),K=Math.abs(B)<5;o||(o=K?Gs.restSpeed.granular:Gs.restSpeed.default),l||(l=K?Gs.restDelta.granular:Gs.restDelta.default);let ne;if(U<1){const se=wV(J,U);ne=le=>{const Y=Math.exp(-U*J*le);return f-Y*((L+U*J*B)/se*Math.sin(se*le)+B*Math.cos(se*le))}}else if(U===1)ne=se=>f-Math.exp(-J*se)*(B+(L+J*B)*se);else{const se=J*Math.sqrt(U*U-1);ne=le=>{const Y=Math.exp(-U*J*le),Z=Math.min(se*le,300);return f-Y*((L+U*J*B)*Math.sinh(Z)+se*B*Math.cosh(Z))/se}}const oe={calculatedDuration:M&&I||null,next:se=>{const le=ne(se);if(M)_.done=se>=I;else{let Y=0;U<1&&(Y=se===0?zf(L):Vte(ne,se,le));const Z=Math.abs(Y)<=o,X=Math.abs(f-le)<=l;_.done=Z&&X}return _.value=_.done?f:le,_},toString:()=>{const se=Math.min(rte(oe),gV),le=ite(Y=>oe.next(se*Y).value,se,30);return se+"ms "+le}};return oe}function rY({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:f,min:_,max:E,restDelta:S=.5,restSpeed:C}){const I=n[0],O={done:!1,value:I},M=Z=>_!==void 0&&Z<_||E!==void 0&&Z>E,L=Z=>_===void 0?E:E===void 0||Math.abs(_-Z)<Math.abs(E-Z)?_:E;let U=i*e;const B=I+U,J=f===void 0?B:f(B);J!==B&&(U=J-I);const K=Z=>-U*Math.exp(-Z/o),ne=Z=>J+K(Z),oe=Z=>{const X=K(Z),ie=ne(Z);O.done=Math.abs(X)<=S,O.value=O.done?J:ie};let se,le;const Y=Z=>{M(O.value)&&(se=Z,le=jte({keyframes:[O.value,L(O.value)],velocity:Vte(ne,Z,O.value),damping:l,stiffness:u,restDelta:S,restSpeed:C}))};return Y(0),{calculatedDuration:null,next:Z=>{let X=!1;return!le&&se===void 0&&(X=!0,oe(Z),Y(Z)),se!==void 0&&Z>=se?le.next(Z-se):(!X&&oe(Z),O)}}}const BOe=mR(.42,0,1,1),WOe=mR(0,0,.58,1),Fte=mR(.42,0,.58,1),zOe=n=>Array.isArray(n)&&typeof n[0]!="number",GOe={linear:au,easeIn:BOe,easeInOut:Fte,easeOut:WOe,circIn:DF,circInOut:vte,circOut:Ete,backIn:NF,backInOut:_te,backOut:gte,anticipate:yte},iY=n=>{if(IF(n)){Uee(n.length===4);const[e,i,o,l]=n;return mR(e,i,o,l)}else if(typeof n=="string")return GOe[n];return n};function HOe(n,e,i){const o=[],l=i||Ute,u=n.length-1;for(let f=0;f<u;f++){let _=l(n[f],n[f+1]);if(e){const E=Array.isArray(e)?e[f]||au:e;_=gR(E,_)}o.push(_)}return o}function $Oe(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const u=n.length;if(Uee(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const f=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=HOe(e,o,l),E=_.length,S=C=>{if(f&&C<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const O=I0(n[I],n[I+1],C);return _[I](O)};return i?C=>S(em(n[0],n[u-1],C)):S}function KOe(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=I0(0,e,o);n.push(Cs(i,1,l))}}function qOe(n){const e=[0];return KOe(e,n.length-1),e}function YOe(n,e){return n.map(i=>i*e)}function XOe(n,e){return n.map(()=>e||Fte).splice(0,n.length-1)}function eN({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=zOe(o)?o.map(iY):iY(o),u={done:!1,value:e[0]},f=YOe(i&&i.length===e.length?i:qOe(e),n),_=$Oe(f,e,{ease:Array.isArray(l)?l:XOe(e,l)});return{calculatedDuration:n,next:E=>(u.value=_(E),u.done=E>=n,u)}}const JOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>os.update(e,!0),stop:()=>Fg(e),now:()=>Oa.isProcessing?Oa.timestamp:Sp.now()}},QOe={decay:rY,inertia:rY,tween:eN,keyframes:eN,spring:jte},ZOe=n=>n/100;class jF extends Lte{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:o,element:l,keyframes:u}=this.options,f=(l==null?void 0:l.KeyframeResolver)||UF,_=(E,S)=>this.onKeyframesResolved(E,S);this.resolver=new f(u,_,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:u,velocity:f=0}=this.options,_=RF(i)?i:QOe[i]||eN;let E,S;_!==eN&&typeof e[0]!="number"&&(E=gR(ZOe,Ute(e[0],e[1])),e=[0,100]);const C=_({...this.options,keyframes:e});u==="mirror"&&(S=_({...this.options,keyframes:[...e].reverse(),velocity:-f})),C.calculatedDuration===null&&(C.calculatedDuration=rte(C));const{calculatedDuration:I}=C,O=I+l,M=O*(o+1)-l;return{generator:C,mirroredGenerator:S,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:O,totalDuration:M}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:f,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:S,totalDuration:C,resolvedDuration:I}=o;if(this.startTime===null)return u.next(0);const{delay:O,repeat:M,repeatType:L,repeatDelay:U,onUpdate:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const J=this.currentTime-O*(this.speed>=0?1:-1),K=this.speed>=0?J<0:J>C;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let ne=this.currentTime,oe=u;if(M){const Z=Math.min(this.currentTime,C)/I;let X=Math.floor(Z),ie=Z%1;!ie&&Z>=1&&(ie=1),ie===1&&X--,X=Math.min(X,M+1),!!(X%2)&&(L==="reverse"?(ie=1-ie,U&&(ie-=U/I)):L==="mirror"&&(oe=f)),ne=em(0,1,ie)*I}const se=K?{done:!1,value:E[0]}:oe.next(ne);_&&(se.value=_(se.value));let{done:le}=se;!K&&S!==null&&(le=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const Y=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&le);return Y&&l!==void 0&&(se.value=t1(E,this.options,l)),B&&B(se.value),Y&&this.finish(),se}get duration(){const{resolved:e}=this;return e?Gf(e.calculatedDuration):0}get time(){return Gf(this.currentTime)}set time(e){e=zf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Gf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=JOe,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const eke=new Set(["opacity","clipPath","filter","transform"]);function tke(n,e,i,{delay:o=0,duration:l=300,repeat:u=0,repeatType:f="loop",ease:_="easeInOut",times:E}={}){const S={[e]:i};E&&(S.offset=E);const C=ote(_,l);return Array.isArray(C)&&(S.easing=C),n.animate(S,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"})}const nke=dF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),tN=10,rke=2e4;function ike(n){return RF(n.type)||n.type==="spring"||!ste(n.ease)}function ske(n,e){const i=new jF({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let u=0;for(;!o.done&&u<rke;)o=i.sample(u),l.push(o.value),u+=tN;return{times:void 0,keyframes:l,duration:u-tN,ease:"linear"}}const Bte={anticipate:yte,backInOut:_te,circInOut:vte};function oke(n){return n in Bte}class sY extends Lte{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:u}=this.options;this.resolver=new xte(u,(f,_)=>this.onKeyframesResolved(f,_),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:u,type:f,motionValue:_,name:E,startTime:S}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof u=="string"&&Qk()&&oke(u)&&(u=Bte[u]),ike(this.options)){const{onComplete:I,onUpdate:O,motionValue:M,element:L,...U}=this.options,B=ske(e,U);e=B.keyframes,e.length===1&&(e[1]=e[0]),o=B.duration,l=B.times,u=B.ease,f="keyframes"}const C=tke(_.owner.current,E,e,{...this.options,duration:o,times:l,ease:u});return C.startTime=S??this.calcStartTime(),this.pendingTimeline?(Wq(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:I}=this.options;_.set(t1(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:f,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Gf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Gf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=zf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return au;const{animation:o}=i;Wq(o,e)}return au}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:u,ease:f,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:S,onUpdate:C,onComplete:I,element:O,...M}=this.options,L=new jF({...M,keyframes:o,duration:l,type:u,ease:f,times:_,isGenerator:!0}),U=zf(this.time);S.setWithVelocity(L.sample(U-tN).value,L.sample(U).value,tN)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:u,damping:f,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:S}=i.owner.getProps();return nke()&&o&&eke.has(o)&&!E&&!S&&!l&&u!=="mirror"&&f!==0&&_!=="inertia"}}const ake={type:"spring",stiffness:500,damping:25,restSpeed:10},cke=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),lke={type:"keyframes",duration:.8},uke={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dke=(n,{keyframes:e})=>e.length>2?lke:cE.has(n)?n.startsWith("scale")?cke(e[1]):ake:uke;function hke({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:u,repeatType:f,repeatDelay:_,from:E,elapsed:S,...C}){return!!Object.keys(C).length}const FF=(n,e,i,o={},l,u)=>f=>{const _=CF(o,n)||{},E=_.delay||o.delay||0;let{elapsed:S=0}=o;S=S-zf(E);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-S,onUpdate:O=>{e.set(O),_.onUpdate&&_.onUpdate(O)},onComplete:()=>{f(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:u?void 0:l};hke(_)||(C={...C,...dke(n,C)}),C.duration&&(C.duration=zf(C.duration)),C.repeatDelay&&(C.repeatDelay=zf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(I=!0)),I&&!u&&e.get()!==void 0){const O=t1(C.keyframes,_);if(O!==void 0)return os.update(()=>{C.onUpdate(O),C.onComplete()}),new kPe([])}return!u&&sY.supports(C)?new sY(C):new jF(C)};function pke({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function Wte(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var u;let{transition:f=n.getDefaultTransition(),transitionEnd:_,...E}=e;o&&(f=o);const S=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const O=n.getValue(I,(u=n.latestValues[I])!==null&&u!==void 0?u:null),M=E[I];if(M===void 0||C&&pke(C,I))continue;const L={delay:i,...CF(f||{},I)};let U=!1;if(window.MotionHandoffAnimation){const J=hte(n);if(J){const K=window.MotionHandoffAnimation(J,I,os);K!==null&&(L.startTime=K,U=!0)}}yV(n,I),O.start(FF(I,O,M,n.shouldReduceMotion&&ute.has(I)?{type:!1}:L,n,U));const B=O.animation;B&&S.push(B)}return _&&Promise.all(S).then(()=>{os.update(()=>{_&&HPe(n,_)})}),S}function CV(n,e,i={}){var o;const l=e1(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const f=l?()=>Promise.all(Wte(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(S=0)=>{const{delayChildren:C=0,staggerChildren:I,staggerDirection:O}=u;return fke(n,e,C+S,I,O,i)}:()=>Promise.resolve(),{when:E}=u;if(E){const[S,C]=E==="beforeChildren"?[f,_]:[_,f];return S().then(()=>C())}else return Promise.all([f(),_(i.delay)])}function fke(n,e,i=0,o=0,l=1,u){const f=[],_=(n.variantChildren.size-1)*o,E=l===1?(S=0)=>S*o:(S=0)=>_-S*o;return Array.from(n.variantChildren).sort(mke).forEach((S,C)=>{S.notify("AnimationStart",e),f.push(CV(S,e,{...u,delay:i+E(C)}).then(()=>S.notify("AnimationComplete",e)))}),Promise.all(f)}function mke(n,e){return n.sortNodePosition(e)}function gke(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(u=>CV(n,u,i));o=Promise.all(l)}else if(typeof e=="string")o=CV(n,e,i);else{const l=typeof e=="function"?e1(n,e,i.custom):e;o=Promise.all(Wte(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const _ke=pF.length;function zte(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?zte(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<_ke;i++){const o=pF[i],l=n.props[o];(VC(l)||l===!1)&&(e[o]=l)}return e}const yke=[...hF].reverse(),Eke=hF.length;function vke(n){return e=>Promise.all(e.map(({animation:i,options:o})=>gke(n,i,o)))}function Ske(n){let e=vke(n),i=oY(),o=!0;const l=E=>(S,C)=>{var I;const O=e1(n,C,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(O){const{transition:M,transitionEnd:L,...U}=O;S={...S,...U,...L}}return S};function u(E){e=E(n)}function f(E){const{props:S}=n,C=zte(n.parent)||{},I=[],O=new Set;let M={},L=1/0;for(let B=0;B<Eke;B++){const J=yke[B],K=i[J],ne=S[J]!==void 0?S[J]:C[J],oe=VC(ne),se=J===E?K.isActive:null;se===!1&&(L=B);let le=ne===C[J]&&ne!==S[J]&&oe;if(le&&o&&n.manuallyAnimateOnMount&&(le=!1),K.protectedKeys={...M},!K.isActive&&se===null||!ne&&!K.prevProp||QN(ne)||typeof ne=="boolean")continue;const Y=bke(K.prevProp,ne);let Z=Y||J===E&&K.isActive&&!le&&oe||B>L&&oe,X=!1;const ie=Array.isArray(ne)?ne:[ne];let de=ie.reduce(l(J),{});se===!1&&(de={});const{prevResolvedValues:ue={}}=K,pe={...ue,...de},ke=Oe=>{Z=!0,O.has(Oe)&&(X=!0,O.delete(Oe)),K.needsAnimating[Oe]=!0;const we=n.getValue(Oe);we&&(we.liveStyle=!1)};for(const Oe in pe){const we=de[Oe],Se=ue[Oe];if(M.hasOwnProperty(Oe))continue;let Be=!1;mV(we)&&mV(Se)?Be=!nte(we,Se):Be=we!==Se,Be?we!=null?ke(Oe):O.add(Oe):we!==void 0&&O.has(Oe)?ke(Oe):K.protectedKeys[Oe]=!0}K.prevProp=ne,K.prevResolvedValues=de,K.isActive&&(M={...M,...de}),o&&n.blockInitialAnimation&&(Z=!1),Z&&(!(le&&Y)||X)&&I.push(...ie.map(Oe=>({animation:Oe,options:{type:J}})))}if(O.size){const B={};O.forEach(J=>{const K=n.getBaseTarget(J),ne=n.getValue(J);ne&&(ne.liveStyle=!0),B[J]=K??null}),I.push({animation:B})}let U=!!I.length;return o&&(S.initial===!1||S.initial===S.animate)&&!n.manuallyAnimateOnMount&&(U=!1),o=!1,U?e(I):Promise.resolve()}function _(E,S){var C;if(i[E].isActive===S)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(O=>{var M;return(M=O.animationState)===null||M===void 0?void 0:M.setActive(E,S)}),i[E].isActive=S;const I=f(E);for(const O in i)i[O].protectedKeys={};return I}return{animateChanges:f,setActive:_,setAnimateFunction:u,getState:()=>i,reset:()=>{i=oY(),o=!0}}}function bke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!nte(e,n):!1}function wy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function oY(){return{animate:wy(!0),whileInView:wy(),whileHover:wy(),whileTap:wy(),whileDrag:wy(),whileFocus:wy(),exit:wy()}}class Jg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Tke extends Jg{constructor(e){super(e),e.animationState||(e.animationState=Ske(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();QN(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let wke=0;class Cke extends Jg{constructor(){super(...arguments),this.id=wke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Rke={animation:{Feature:Tke},exit:{Feature:Cke}};function WC(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function _R(n){return{point:{x:n.pageX,y:n.pageY}}}const Ike=n=>e=>AF(e)&&n(e,_R(e));function _C(n,e,i,o){return WC(n,e,Ike(i),o)}const aY=(n,e)=>Math.abs(n-e);function Ake(n,e){const i=aY(n.x,e.x),o=aY(n.y,e.y);return Math.sqrt(i**2+o**2)}class Gte{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=aU(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,M=Ake(I.offset,{x:0,y:0})>=3;if(!O&&!M)return;const{point:L}=I,{timestamp:U}=Oa;this.history.push({...L,timestamp:U});const{onStart:B,onMove:J}=this.handlers;O||(B&&B(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,I)},this.handlePointerMove=(I,O)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=oU(O,this.transformPagePoint),os.update(this.updatePoint,!0)},this.handlePointerUp=(I,O)=>{this.end();const{onEnd:M,onSessionEnd:L,resumeAnimation:U}=this.handlers;if(this.dragSnapToOrigin&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const B=aU(I.type==="pointercancel"?this.lastMoveEventInfo:oU(O,this.transformPagePoint),this.history);this.startEvent&&M&&M(I,B),L&&L(I,B)},!AF(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const f=_R(e),_=oU(f,this.transformPagePoint),{point:E}=_,{timestamp:S}=Oa;this.history=[{...E,timestamp:S}];const{onSessionStart:C}=i;C&&C(e,aU(_,this.history)),this.removeListeners=gR(_C(this.contextWindow,"pointermove",this.handlePointerMove),_C(this.contextWindow,"pointerup",this.handlePointerUp),_C(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Fg(this.updatePoint)}}function oU(n,e){return e?{point:e(n.point)}:n}function cY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function aU({point:n},e){return{point:n,delta:cY(n,Hte(e)),offset:cY(n,Pke(e)),velocity:Oke(e,.1)}}function Pke(n){return n[0]}function Hte(n){return n[n.length-1]}function Oke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=Hte(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>zf(e)));)i--;if(!o)return{x:0,y:0};const u=Gf(l.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const f={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const $te=1e-4,kke=1-$te,Nke=1+$te,Kte=.01,Dke=0-Kte,xke=0+Kte;function lu(n){return n.max-n.min}function Lke(n,e,i){return Math.abs(n-e)<=i}function lY(n,e,i,o=.5){n.origin=o,n.originPoint=Cs(e.min,e.max,n.origin),n.scale=lu(i)/lu(e),n.translate=Cs(i.min,i.max,n.origin)-n.originPoint,(n.scale>=kke&&n.scale<=Nke||isNaN(n.scale))&&(n.scale=1),(n.translate>=Dke&&n.translate<=xke||isNaN(n.translate))&&(n.translate=0)}function yC(n,e,i,o){lY(n.x,e.x,i.x,o?o.originX:void 0),lY(n.y,e.y,i.y,o?o.originY:void 0)}function uY(n,e,i){n.min=i.min+e.min,n.max=n.min+lu(e)}function Mke(n,e,i){uY(n.x,e.x,i.x),uY(n.y,e.y,i.y)}function dY(n,e,i){n.min=e.min-i.min,n.max=n.min+lu(e)}function EC(n,e,i){dY(n.x,e.x,i.x),dY(n.y,e.y,i.y)}function Uke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?Cs(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?Cs(i,n,o.max):Math.min(n,i)),n}function hY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function Vke(n,{top:e,left:i,bottom:o,right:l}){return{x:hY(n.x,i,l),y:hY(n.y,e,o)}}function pY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function jke(n,e){return{x:pY(n.x,e.x),y:pY(n.y,e.y)}}function Fke(n,e){let i=.5;const o=lu(n),l=lu(e);return l>o?i=I0(e.min,e.max-o,n.min):o>l&&(i=I0(n.min,n.max-l,e.min)),em(0,1,i)}function Bke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const RV=.35;function Wke(n=RV){return n===!1?n=0:n===!0&&(n=RV),{x:fY(n,"left","right"),y:fY(n,"top","bottom")}}function fY(n,e,i){return{min:mY(n,e),max:mY(n,i)}}function mY(n,e){return typeof n=="number"?n:n[e]||0}const gY=()=>({translate:0,scale:1,origin:0,originPoint:0}),e0=()=>({x:gY(),y:gY()}),_Y=()=>({min:0,max:0}),eo=()=>({x:_Y(),y:_Y()});function ed(n){return[n("x"),n("y")]}function qte({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function zke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function Gke(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function cU(n){return n===void 0||n===1}function IV({scale:n,scaleX:e,scaleY:i}){return!cU(n)||!cU(e)||!cU(i)}function Ry(n){return IV(n)||Yte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Yte(n){return yY(n.x)||yY(n.y)}function yY(n){return n&&n!=="0%"}function nN(n,e,i){const o=n-i,l=e*o;return i+l}function EY(n,e,i,o,l){return l!==void 0&&(n=nN(n,l,o)),nN(n,i,o)+e}function AV(n,e=0,i=1,o,l){n.min=EY(n.min,e,i,o,l),n.max=EY(n.max,e,i,o,l)}function Xte(n,{x:e,y:i}){AV(n.x,e.translate,e.scale,e.originPoint),AV(n.y,i.translate,i.scale,i.originPoint)}const vY=.999999999999,SY=1.0000000000001;function Hke(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,f;for(let _=0;_<l;_++){u=i[_],f=u.projectionDelta;const{visualElement:E}=u.options;E&&E.props.style&&E.props.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&n0(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(e.x*=f.x.scale,e.y*=f.y.scale,Xte(n,f)),o&&Ry(u.latestValues)&&n0(n,u.latestValues))}e.x<SY&&e.x>vY&&(e.x=1),e.y<SY&&e.y>vY&&(e.y=1)}function t0(n,e){n.min=n.min+e,n.max=n.max+e}function bY(n,e,i,o,l=.5){const u=Cs(n.min,n.max,l);AV(n,e,i,u,o)}function n0(n,e){bY(n.x,e.x,e.scaleX,e.scale,e.originX),bY(n.y,e.y,e.scaleY,e.scale,e.originY)}function Jte(n,e){return qte(Gke(n.getBoundingClientRect(),e))}function $ke(n,e,i){const o=Jte(n,i),{scroll:l}=e;return l&&(t0(o.x,l.offset.x),t0(o.y,l.offset.y)),o}const Qte=({current:n})=>n?n.ownerDocument.defaultView:null,Kke=new WeakMap;class qke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=eo(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(_R(C).point)},u=(C,I)=>{const{drag:O,dragPropagation:M,onDragStart:L}=this.getProps();if(O&&!M&&(this.openDragLock&&this.openDragLock(),this.openDragLock=FPe(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ed(B=>{let J=this.getAxisMotionValue(B).get()||0;if(vp.test(J)){const{projection:K}=this.visualElement;if(K&&K.layout){const ne=K.layout.layoutBox[B];ne&&(J=lu(ne)*(parseFloat(J)/100))}}this.originPoint[B]=J}),L&&os.postRender(()=>L(C,I)),yV(this.visualElement,"transform");const{animationState:U}=this.visualElement;U&&U.setActive("whileDrag",!0)},f=(C,I)=>{const{dragPropagation:O,dragDirectionLock:M,onDirectionLock:L,onDrag:U}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:B}=I;if(M&&this.currentDirection===null){this.currentDirection=Yke(B),this.currentDirection!==null&&L&&L(this.currentDirection);return}this.updateAxis("x",I.point,B),this.updateAxis("y",I.point,B),this.visualElement.render(),U&&U(C,I)},_=(C,I)=>this.stop(C,I),E=()=>ed(C=>{var I;return this.getAnimationState(C)==="paused"&&((I=this.getAxisMotionValue(C).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:S}=this.getProps();this.panSession=new Gte(e,{onSessionStart:l,onStart:u,onMove:f,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:S,contextWindow:Qte(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&os.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!FO(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let f=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(f=Uke(f,this.constraints[e],this.elastic[e])),u.set(f)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&QS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=Vke(l.layoutBox,i):this.constraints=!1,this.elastic=Wke(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&ed(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=Bke(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!QS(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=$ke(o,l.root,this.visualElement.getTransformPagePoint());let f=jke(l.layout.layoutBox,u);if(i){const _=i(zke(f));this.hasMutatedConstraints=!!_,_&&(f=qte(_))}return f}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},S=ed(C=>{if(!FO(C,i,this.currentDirection))return;let I=E&&E[C]||{};f&&(I={min:0,max:0});const O=l?200:1e6,M=l?40:1e7,L={type:"inertia",velocity:o?e[C]:0,bounceStiffness:O,bounceDamping:M,timeConstant:750,restDelta:1,restSpeed:10,...u,...I};return this.startAxisValueAnimation(C,L)});return Promise.all(S).then(_)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return yV(this.visualElement,e),o.start(FF(e,o,0,i,this.visualElement,!1))}stopAnimation(){ed(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ed(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){ed(i=>{const{drag:o}=this.getProps();if(!FO(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:_}=l.layout.layoutBox[i];u.set(e[i]-Cs(f,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!QS(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};ed(f=>{const _=this.getAxisMotionValue(f);if(_&&this.constraints!==!1){const E=_.get();l[f]=Fke({min:E,max:E},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),ed(f=>{if(!FO(f,e,null))return;const _=this.getAxisMotionValue(f),{min:E,max:S}=this.constraints[f];_.set(Cs(E,S,l[f]))})}addListeners(){if(!this.visualElement.current)return;Kke.set(this.visualElement,this);const e=this.visualElement.current,i=_C(e,"pointerdown",E=>{const{drag:S,dragListener:C=!0}=this.getProps();S&&C&&this.start(E)}),o=()=>{const{dragConstraints:E}=this.getProps();QS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),os.read(o);const f=WC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:S})=>{this.isDragging&&S&&(ed(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=E[C].translate,I.set(I.get()+E[C].translate))}),this.visualElement.render())});return()=>{f(),i(),u(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:f=RV,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:u,dragElastic:f,dragMomentum:_}}}function FO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function Yke(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class Xke extends Jg{constructor(e){super(e),this.removeGroupControls=au,this.removeListeners=au,this.controls=new qke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||au}unmount(){this.removeGroupControls(),this.removeListeners()}}const TY=n=>(e,i)=>{n&&os.postRender(()=>n(e,i))};class Jke extends Jg{constructor(){super(...arguments),this.removePointerDownListener=au}onPointerDown(e){this.session=new Gte(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Qte(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:TY(e),onStart:TY(i),onMove:o,onEnd:(u,f)=>{delete this.session,l&&os.postRender(()=>l(u,f))}}}mount(){this.removePointerDownListener=_C(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Tk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function wY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Pw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Wn.test(n))n=parseFloat(n);else return n;const i=wY(n,e.target.x),o=wY(n,e.target.y);return`${i}% ${o}%`}},Qke={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Bg.parse(n);if(l.length>5)return o;const u=Bg.createTransformer(n),f=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+f]/=_,l[1+f]/=E;const S=Cs(_,E,.5);return typeof l[2+f]=="number"&&(l[2+f]/=S),typeof l[3+f]=="number"&&(l[3+f]/=S),u(l)}};class Zke extends k.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:u}=e;EPe(eNe),u&&(i.group&&i.group.add(u),o&&o.register&&l&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),Tk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:u}=this.props,f=o.projection;return f&&(f.isPresent=u,l||e.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?f.promote():f.relegate()||os.postRender(()=>{const _=f.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),mF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Zte(n){const[e,i]=lF(),o=k.useContext(oF);return b.jsx(Zke,{...n,layoutGroup:o,switchLayoutGroup:k.useContext(zee),isPresent:e,safeToRemove:i})}const eNe={borderRadius:{...Pw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Pw,borderTopRightRadius:Pw,borderBottomLeftRadius:Pw,borderBottomRightRadius:Pw,boxShadow:Qke};function tNe(n,e,i){const o=dc(n)?n:FC(n);return o.start(FF("",o,e,i)),o.animation}function nNe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const rNe=(n,e)=>n.depth-e.depth;class iNe{constructor(){this.children=[],this.isDirty=!1}add(e){PF(this.children,e),this.isDirty=!0}remove(e){OF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(rNe),this.isDirty=!1,this.children.forEach(e)}}function sNe(n,e){const i=Sp.now(),o=({timestamp:l})=>{const u=l-i;u>=e&&(Fg(o),n(u-e))};return os.read(o,!0),()=>Fg(o)}const ene=["TopLeft","TopRight","BottomLeft","BottomRight"],oNe=ene.length,CY=n=>typeof n=="string"?parseFloat(n):n,RY=n=>typeof n=="number"||Wn.test(n);function aNe(n,e,i,o,l,u){l?(n.opacity=Cs(0,i.opacity!==void 0?i.opacity:1,cNe(o)),n.opacityExit=Cs(e.opacity!==void 0?e.opacity:1,0,lNe(o))):u&&(n.opacity=Cs(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let f=0;f<oNe;f++){const _=`border${ene[f]}Radius`;let E=IY(e,_),S=IY(i,_);if(E===void 0&&S===void 0)continue;E||(E=0),S||(S=0),E===0||S===0||RY(E)===RY(S)?(n[_]=Math.max(Cs(CY(E),CY(S),o),0),(vp.test(S)||vp.test(E))&&(n[_]+="%")):n[_]=S}(e.rotate||i.rotate)&&(n.rotate=Cs(e.rotate||0,i.rotate||0,o))}function IY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const cNe=tne(0,.5,Ete),lNe=tne(.5,.95,au);function tne(n,e,i){return o=>o<n?0:o>e?1:i(I0(n,e,o))}function AY(n,e){n.min=e.min,n.max=e.max}function Ju(n,e){AY(n.x,e.x),AY(n.y,e.y)}function PY(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function OY(n,e,i,o,l){return n-=e,n=nN(n,1/i,o),l!==void 0&&(n=nN(n,1/l,o)),n}function uNe(n,e=0,i=1,o=.5,l,u=n,f=n){if(vp.test(e)&&(e=parseFloat(e),e=Cs(f.min,f.max,e/100)-f.min),typeof e!="number")return;let _=Cs(u.min,u.max,o);n===u&&(_-=e),n.min=OY(n.min,e,i,_,l),n.max=OY(n.max,e,i,_,l)}function kY(n,e,[i,o,l],u,f){uNe(n,e[i],e[o],e[l],e.scale,u,f)}const dNe=["x","scaleX","originX"],hNe=["y","scaleY","originY"];function NY(n,e,i,o){kY(n.x,e,dNe,i?i.x:void 0,o?o.x:void 0),kY(n.y,e,hNe,i?i.y:void 0,o?o.y:void 0)}function DY(n){return n.translate===0&&n.scale===1}function nne(n){return DY(n.x)&&DY(n.y)}function xY(n,e){return n.min===e.min&&n.max===e.max}function pNe(n,e){return xY(n.x,e.x)&&xY(n.y,e.y)}function LY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function rne(n,e){return LY(n.x,e.x)&&LY(n.y,e.y)}function MY(n){return lu(n.x)/lu(n.y)}function UY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class fNe{constructor(){this.members=[]}add(e){PF(this.members,e),e.scheduleRender()}remove(e){if(OF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function mNe(n,e,i){let o="";const l=n.x.translate/e.x,u=n.y.translate/e.y,f=(i==null?void 0:i.z)||0;if((l||u||f)&&(o=`translate3d(${l}px, ${u}px, ${f}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:S,rotate:C,rotateX:I,rotateY:O,skewX:M,skewY:L}=i;S&&(o=`perspective(${S}px) ${o}`),C&&(o+=`rotate(${C}deg) `),I&&(o+=`rotateX(${I}deg) `),O&&(o+=`rotateY(${O}deg) `),M&&(o+=`skewX(${M}deg) `),L&&(o+=`skewY(${L}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(o+=`scale(${_}, ${E})`),o||"none"}const Iy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},eC=typeof window<"u"&&window.MotionDebug!==void 0,lU=["","X","Y","Z"],gNe={visibility:"hidden"},VY=1e3;let _Ne=0;function uU(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function ine(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=hte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",os,!(l||u))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&ine(o)}function sne({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(f={},_=e==null?void 0:e()){this.id=_Ne++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,eC&&(Iy.totalNodes=Iy.resolvedTargetDeltas=Iy.recalculatedProjection=0),this.nodes.forEach(vNe),this.nodes.forEach(CNe),this.nodes.forEach(RNe),this.nodes.forEach(SNe),eC&&window.MotionDebug.record(Iy)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new iNe)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new kF),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const E=this.eventHandlers.get(f);E&&E.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=nNe(f),this.instance=f;const{layoutId:E,layout:S,visualElement:C}=this.options;if(C&&!C.current&&C.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(S||E)&&(this.isLayoutDirty=!0),n){let I;const O=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=sNe(O,250),Tk.hasAnimatedSinceResize&&(Tk.hasAnimatedSinceResize=!1,this.nodes.forEach(FY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&C&&(E||S)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:O,hasRelativeTargetChanged:M,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const U=this.options.transition||C.getDefaultTransition()||kNe,{onLayoutAnimationStart:B,onLayoutAnimationComplete:J}=C.getProps(),K=!this.targetLayout||!rne(this.targetLayout,L)||M,ne=!O&&M;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||O&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ne);const oe={...CF(U,"layout"),onPlay:B,onComplete:J};(C.shouldReduceMotion||this.options.layoutRoot)&&(oe.delay=0,oe.type=!1),this.startAnimation(oe)}else O||FY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Fg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(INe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&ine(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const S=this.getTransformTemplate();this.prevTransformTemplateValue=S?S(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(jY);return}this.isUpdating||this.nodes.forEach(TNe),this.isUpdating=!1,this.nodes.forEach(wNe),this.nodes.forEach(yNe),this.nodes.forEach(ENe),this.clearAllSnapshots();const _=Sp.now();Oa.delta=em(0,1e3/60,_-Oa.timestamp),Oa.timestamp=_,Oa.isProcessing=!0,tU.update.process(Oa),tU.preRender.process(Oa),tU.render.process(Oa),Oa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,mF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(bNe),this.sharedNodes.forEach(ANe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,os.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){os.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=eo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_){const E=o(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!nne(this.projectionDelta),E=this.getTransformTemplate(),S=E?E(this.latestValues,""):void 0,C=S!==this.prevTransformTemplateValue;f&&(_||Ry(this.latestValues)||C)&&(l(this.instance,S),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return f&&(E=this.removeTransform(E)),NNe(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:_}=this.options;if(!_)return eo();const E=_.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(DNe))){const{scroll:C}=this.root;C&&(t0(E.x,C.offset.x),t0(E.y,C.offset.y))}return E}removeElementScroll(f){var _;const E=eo();if(Ju(E,f),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let S=0;S<this.path.length;S++){const C=this.path[S],{scroll:I,options:O}=C;C!==this.root&&I&&O.layoutScroll&&(I.wasRoot&&Ju(E,f),t0(E.x,I.offset.x),t0(E.y,I.offset.y))}return E}applyTransform(f,_=!1){const E=eo();Ju(E,f);for(let S=0;S<this.path.length;S++){const C=this.path[S];!_&&C.options.layoutScroll&&C.scroll&&C!==C.root&&n0(E,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),Ry(C.latestValues)&&n0(E,C.latestValues)}return Ry(this.latestValues)&&n0(E,this.latestValues),E}removeTransform(f){const _=eo();Ju(_,f);for(let E=0;E<this.path.length;E++){const S=this.path[E];if(!S.instance||!Ry(S.latestValues))continue;IV(S.latestValues)&&S.updateSnapshot();const C=eo(),I=S.measurePageBox();Ju(C,I),NY(_,S.latestValues,S.snapshot?S.snapshot.layoutBox:void 0,C)}return Ry(this.latestValues)&&NY(_,this.latestValues),_}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Oa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==E;if(!(f||S&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:O}=this.options;if(!(!this.layout||!(I||O))){if(this.resolvedRelativeTargetAt=Oa.timestamp,!this.targetDelta&&!this.relativeTarget){const M=this.getClosestProjectingParent();M&&M.layout&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=eo(),this.relativeTargetOrigin=eo(),EC(this.relativeTargetOrigin,this.layout.layoutBox,M.layout.layoutBox),Ju(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=eo(),this.targetWithTransforms=eo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Mke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ju(this.target,this.layout.layoutBox),Xte(this.target,this.targetDelta)):Ju(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const M=this.getClosestProjectingParent();M&&!!M.resumingFrom==!!this.resumingFrom&&!M.options.layoutScroll&&M.target&&this.animationProgress!==1?(this.relativeParent=M,this.forceRelativeParentToResolveTarget(),this.relativeTarget=eo(),this.relativeTargetOrigin=eo(),EC(this.relativeTargetOrigin,this.target,M.target),Ju(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}eC&&Iy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||IV(this.parent.latestValues)||Yte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let S=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(S=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===Oa.timestamp&&(S=!1),S)return;const{layout:C,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||I))return;Ju(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,M=this.treeScale.y;Hke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=eo());const{target:L}=_;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(PY(this.prevProjectionDelta.x,this.projectionDelta.x),PY(this.prevProjectionDelta.y,this.projectionDelta.y)),yC(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==M||!UY(this.projectionDelta.x,this.prevProjectionDelta.x)||!UY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L)),eC&&Iy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=e0(),this.projectionDelta=e0(),this.projectionDeltaWithTransform=e0()}setAnimationOrigin(f,_=!1){const E=this.snapshot,S=E?E.latestValues:{},C={...this.latestValues},I=e0();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const O=eo(),M=E?E.source:void 0,L=this.layout?this.layout.source:void 0,U=M!==L,B=this.getStack(),J=!B||B.members.length<=1,K=!!(U&&!J&&this.options.crossfade===!0&&!this.path.some(ONe));this.animationProgress=0;let ne;this.mixTargetDelta=oe=>{const se=oe/1e3;BY(I.x,f.x,se),BY(I.y,f.y,se),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(EC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),PNe(this.relativeTarget,this.relativeTargetOrigin,O,se),ne&&pNe(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=eo()),Ju(ne,this.relativeTarget)),U&&(this.animationValues=C,aNe(C,S,this.latestValues,se,K,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Fg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=os.update(()=>{Tk.hasAnimatedSinceResize=!0,this.currentAnimation=tNe(0,VY,{...f,onUpdate:_=>{this.mixTargetDelta(_),f.onUpdate&&f.onUpdate(_)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(VY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:E,layout:S,latestValues:C}=f;if(!(!_||!E||!S)){if(this!==f&&this.layout&&S&&one(this.options.animationType,this.layout.layoutBox,S.layoutBox)){E=this.target||eo();const I=lu(this.layout.layoutBox.x);E.x.min=f.target.x.min,E.x.max=E.x.min+I;const O=lu(this.layout.layoutBox.y);E.y.min=f.target.y.min,E.y.max=E.y.min+O}Ju(_,E),n0(_,C),yC(this.projectionDeltaWithTransform,this.layoutCorrected,_,C)}}registerSharedNode(f,_){this.sharedNodes.has(f)||this.sharedNodes.set(f,new fNe),this.sharedNodes.get(f).add(_);const S=_.options.initialPromotionConfig;_.promote({transition:S?S.transition:void 0,preserveFollowOpacity:S&&S.shouldPreserveFollowOpacity?S.shouldPreserveFollowOpacity(_):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:E}={}){const S=this.getStack();S&&S.promote(this,E),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:E}=f;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const S={};E.z&&uU("z",f,S,this.animationValues);for(let C=0;C<lU.length;C++)uU(`rotate${lU[C]}`,f,S,this.animationValues),uU(`skew${lU[C]}`,f,S,this.animationValues);f.render();for(const C in S)f.setStaticValue(C,S[C]),this.animationValues&&(this.animationValues[C]=S[C]);f.scheduleRender()}getProjectionStyles(f){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return gNe;const S={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,S.opacity="",S.pointerEvents=Sk(f==null?void 0:f.pointerEvents)||"",S.transform=C?C(this.latestValues,""):"none",S;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const U={};return this.options.layoutId&&(U.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,U.pointerEvents=Sk(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!Ry(this.latestValues)&&(U.transform=C?C({},""):"none",this.hasProjected=!1),U}const O=I.animationValues||I.latestValues;this.applyTransformsToTarget(),S.transform=mNe(this.projectionDeltaWithTransform,this.treeScale,O),C&&(S.transform=C(O,S.transform));const{x:M,y:L}=this.projectionDelta;S.transformOrigin=`${M.origin*100}% ${L.origin*100}% 0`,I.animationValues?S.opacity=I===this?(E=(_=O.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:S.opacity=I===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const U in Jk){if(O[U]===void 0)continue;const{correct:B,applyTo:J}=Jk[U],K=S.transform==="none"?O[U]:B(O[U],I);if(J){const ne=J.length;for(let oe=0;oe<ne;oe++)S[J[oe]]=K}else S[U]=K}return this.options.layoutId&&(S.pointerEvents=I===this?Sk(f==null?void 0:f.pointerEvents)||"":"none"),S}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(jY),this.root.sharedNodes.clear()}}}function yNe(n){n.updateLayout()}function ENe(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:u}=n.options,f=i.source!==n.layout.source;u==="size"?ed(I=>{const O=f?i.measuredBox[I]:i.layoutBox[I],M=lu(O);O.min=o[I].min,O.max=O.min+M}):one(u,i.layoutBox,o)&&ed(I=>{const O=f?i.measuredBox[I]:i.layoutBox[I],M=lu(o[I]);O.max=O.min+M,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+M)});const _=e0();yC(_,o,i.layoutBox);const E=e0();f?yC(E,n.applyTransform(l,!0),i.measuredBox):yC(E,o,i.layoutBox);const S=!nne(_);let C=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:O,layout:M}=I;if(O&&M){const L=eo();EC(L,i.layoutBox,O.layoutBox);const U=eo();EC(U,o,M.layoutBox),rne(L,U)||(C=!0),I.options.layoutRoot&&(n.relativeTarget=U,n.relativeTargetOrigin=L,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:S,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function vNe(n){eC&&Iy.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function SNe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function bNe(n){n.clearSnapshot()}function jY(n){n.clearMeasurements()}function TNe(n){n.isLayoutDirty=!1}function wNe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function FY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function CNe(n){n.resolveTargetDelta()}function RNe(n){n.calcProjection()}function INe(n){n.resetSkewAndRotation()}function ANe(n){n.removeLeadSnapshot()}function BY(n,e,i){n.translate=Cs(e.translate,0,i),n.scale=Cs(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function WY(n,e,i,o){n.min=Cs(e.min,i.min,o),n.max=Cs(e.max,i.max,o)}function PNe(n,e,i,o){WY(n.x,e.x,i.x,o),WY(n.y,e.y,i.y,o)}function ONe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const kNe={duration:.45,ease:[.4,0,.1,1]},zY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),GY=zY("applewebkit/")&&!zY("chrome/")?Math.round:au;function HY(n){n.min=GY(n.min),n.max=GY(n.max)}function NNe(n){HY(n.x),HY(n.y)}function one(n,e,i){return n==="position"||n==="preserve-aspect"&&!Lke(MY(e),MY(i),.2)}function DNe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const xNe=sne({attachResizeListener:(n,e)=>WC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),dU={current:void 0},ane=sne({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!dU.current){const n=new xNe({});n.mount(window),n.setOptions({layoutScroll:!0}),dU.current=n}return dU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),LNe={pan:{Feature:Jke},drag:{Feature:Xke,ProjectionNode:ane,MeasureLayout:Zte}};function $Y(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=o[l];u&&os.postRender(()=>u(e,_R(e)))}class MNe extends Jg{mount(){const{current:e}=this.node;e&&(this.unmount=LPe(e,i=>($Y(this.node,i,"Start"),o=>$Y(this.node,o,"End"))))}unmount(){}}class UNe extends Jg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=gR(WC(this.node.current,"focus",()=>this.onFocus()),WC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function KY(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=o[l];u&&os.postRender(()=>u(e,_R(e)))}class VNe extends Jg{mount(){const{current:e}=this.node;e&&(this.unmount=jPe(e,i=>(KY(this.node,i,"Start"),(o,{success:l})=>KY(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const PV=new WeakMap,hU=new WeakMap,jNe=n=>{const e=PV.get(n.target);e&&e(n)},FNe=n=>{n.forEach(jNe)};function BNe({root:n,...e}){const i=n||document;hU.has(i)||hU.set(i,{});const o=hU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(FNe,{root:n,...e})),o[l]}function WNe(n,e,i){const o=BNe(e);return PV.set(n,i),o.observe(n),()=>{PV.delete(n),o.unobserve(n)}}const zNe={some:0,all:1};class GNe extends Jg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:u}=e,f={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:zNe[l]},_=E=>{const{isIntersecting:S}=E;if(this.isInView===S||(this.isInView=S,u&&!S&&this.hasEnteredView))return;S&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",S);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),O=S?C:I;O&&O(E)};return WNe(this.node.current,f,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(HNe(e,i))&&this.startObserver()}unmount(){}}function HNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const $Ne={inView:{Feature:GNe},tap:{Feature:VNe},focus:{Feature:UNe},hover:{Feature:MNe}},KNe={layout:{ProjectionNode:ane,MeasureLayout:Zte}},OV={current:null},cne={current:!1};function qNe(){if(cne.current=!0,!!uF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>OV.current=n.matches;n.addListener(e),e()}else OV.current=!1}const YNe=[...Dte,cc,Bg],XNe=n=>YNe.find(Nte(n)),qY=new WeakMap;function JNe(n,e,i){for(const o in e){const l=e[o],u=i[o];if(dc(l))n.addValue(o,l);else if(dc(u))n.addValue(o,FC(l,{owner:n}));else if(u!==l)if(n.hasValue(o)){const f=n.getValue(o);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(o);n.addValue(o,FC(f!==void 0?f:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const YY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class QNe{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:u,visualState:f},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=UF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const M=Sp.now();this.renderScheduledAt<M&&(this.renderScheduledAt=M,os.render(this.render,!1,!0))};const{latestValues:E,renderState:S,onUpdate:C}=f;this.onUpdate=C,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=S,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!u,this.isControllingVariants=ZN(i),this.isVariantNode=Bee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const M in O){const L=O[M];E[M]!==void 0&&dc(L)&&L.set(E[M],!1)}}mount(e){this.current=e,qY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),cne.current||qNe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:OV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){qY.delete(this.current),this.projection&&this.projection.unmount(),Fg(this.notifyUpdate),Fg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=cE.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&os.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),f&&f(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in A0){const i=A0[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):eo()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<YY.length;o++){const l=YY[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,f=e[u];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=JNe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=FC(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Ote(l)||Ste(l))?l=parseFloat(l):!XNe(l)&&Bg.test(i)&&(l=Ite(e,i)),this.setBaseTarget(e,dc(l)?l.get():l)),dc(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const f=_F(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[e])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!dc(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new kF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class lne extends QNe{constructor(){super(...arguments),this.KeyframeResolver=xte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;dc(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function ZNe(n){return window.getComputedStyle(n)}class e1e extends lne{constructor(){super(...arguments),this.type="html",this.renderInstance=Xee}readValueFromInstance(e,i){if(cE.has(i)){const o=MF(i);return o&&o.default||0}else{const o=ZNe(e),l=(Kee(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Jte(e,i)}build(e,i,o){vF(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return wF(e,i,o)}}class t1e extends lne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=eo}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(cE.has(i)){const o=MF(i);return o&&o.default||0}return i=Jee.has(i)?i:fF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return ete(e,i,o)}build(e,i,o){SF(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){Qee(e,i,o,l)}mount(e){this.isSVGTag=TF(e.tagName),super.mount(e)}}const n1e=(n,e)=>gF(n)?new t1e(e):new e1e(e,{allowProjection:n!==k.Fragment}),r1e=APe({...Rke,...$Ne,...LNe,...KNe},n1e),Pp=zAe(r1e),i1e=(n,e)=>n.find(i=>i.id===e);function XY(n,e){const i=une(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function une(n,e){for(const[i,o]of Object.entries(n))if(i1e(o,e))return i}function s1e(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function o1e(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:u,left:f}}var a1e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,c1e=Ree(function(n){return a1e.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),l1e=c1e,u1e=function(e){return e!=="theme"},JY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?l1e:u1e},QY=function(e,i,o){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(f){return e.__emotion_forwardProp(f)&&u(f)}:u}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},d1e=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return Qj(i,o,l),kee(function(){return Zj(i,o,l)}),null},h1e=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,u,f;i!==void 0&&(u=i.label,f=i.target);var _=QY(e,i,o),E=_||JY(l),S=!E("as");return function(){var C=arguments,I=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&I.push("label:"+u+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{var O=C[0];I.push(O[0]);for(var M=C.length,L=1;L<M;L++)I.push(C[L],O[L])}var U=tF(function(B,J,K){var ne=S&&B.as||l,oe="",se=[],le=B;if(B.theme==null){le={};for(var Y in B)le[Y]=B[Y];le.theme=k.useContext(R0)}typeof B.className=="string"?oe=Aee(J.registered,se,B.className):B.className!=null&&(oe=B.className+" ");var Z=qN(I.concat(se),J.registered,le);oe+=J.key+"-"+Z.name,f!==void 0&&(oe+=" "+f);var X=S&&_===void 0?JY(ne):E,ie={};for(var de in B)S&&de==="as"||X(de)&&(ie[de]=B[de]);return ie.className=oe,K&&(ie.ref=K),k.createElement(k.Fragment,null,k.createElement(d1e,{cache:J,serialized:Z,isStringTag:typeof ne=="string"}),k.createElement(ne,ie))});return U.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",U.defaultProps=e.defaultProps,U.__emotion_real=U,U.__emotion_base=l,U.__emotion_styles=I,U.__emotion_forwardProp=_,Object.defineProperty(U,"toString",{value:function(){return"."+f}}),U.withComponent=function(B,J){var K=n(B,Jy({},i,J,{shouldForwardProp:QY(U,J,!0)}));return K.apply(void 0,I)},U}},p1e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],kV=h1e.bind(null);p1e.forEach(function(n){kV[n]=kV(n)});const f1e=new Set([...xSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),m1e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function g1e(n){return(m1e.has(n)||!f1e.has(n))&&n[0]!=="_"}const _1e=cve(kV),y1e=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:u,...f}=e,[_]=mve(f,MSe),E=bl(n,e),S=qEe({},l,E,jN(_),u),C=see(S)(e.theme);return o?[C,o]:C};function pU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=g1e);const l=y1e({baseStyle:i}),u=_1e(n,o)(l);return k.forwardRef(function(E,S){const{children:C,...I}=E,{colorMode:O,forced:M}=XN(),L=M?O:void 0;return k.createElement(u,{ref:S,"data-theme":L,...I},C)})}function E1e(){const n=new Map;return new Proxy(pU,{apply(e,i,o){return pU(...o)},get(e,i){return n.has(i)||n.set(i,pU(i)),n.get(i)}})}const Mt=E1e(),v1e={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},dne=k.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:u=!1,position:f="bottom",duration:_=5e3,containerStyle:E,motionVariants:S=v1e,toastSpacing:C="0.5rem"}=n,[I,O]=k.useState(_),M=xAe();Qf(()=>{M||o==null||o()},[M]),Qf(()=>{O(_)},[_]);const L=()=>O(null),U=()=>O(_),B=()=>{M&&l()};k.useEffect(()=>{M&&u&&l()},[M,u,l]),Vve(B,I);const J=k.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...E}),[E,C]),K=k.useMemo(()=>s1e(f),[f]);return b.jsx(Pp.div,{layout:!0,className:"chakra-toast",variants:S,initial:"initial",animate:"animate",exit:"exit",onHoverStart:L,onHoverEnd:U,custom:{position:f},style:K,children:b.jsx(Mt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:bl(i,{id:e,onClose:B})})})});dne.displayName="ToastComponent";function Ft(n){return k.forwardRef(n)}var fU,ZY;function S1e(){if(ZY)return fU;ZY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,f){if(u===f)return!0;if(u&&f&&typeof u=="object"&&typeof f=="object"){if(u.constructor!==f.constructor)return!1;var _,E,S;if(Array.isArray(u)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(!l(u[E],f[E]))return!1;return!0}var C;if(e&&u instanceof Map&&f instanceof Map){if(u.size!==f.size)return!1;for(C=u.entries();!(E=C.next()).done;)if(!f.has(E.value[0]))return!1;for(C=u.entries();!(E=C.next()).done;)if(!l(E.value[1],f.get(E.value[0])))return!1;return!0}if(i&&u instanceof Set&&f instanceof Set){if(u.size!==f.size)return!1;for(C=u.entries();!(E=C.next()).done;)if(!f.has(E.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(f)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(u[E]!==f[E])return!1;return!0}if(u.constructor===RegExp)return u.source===f.source&&u.flags===f.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof f.valueOf=="function")return u.valueOf()===f.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof f.toString=="function")return u.toString()===f.toString();if(S=Object.keys(u),_=S.length,_!==Object.keys(f).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(f,S[E]))return!1;if(n&&u instanceof Element)return!1;for(E=_;E--!==0;)if(!((S[E]==="_owner"||S[E]==="__v"||S[E]==="__o")&&u.$$typeof)&&!l(u[S[E]],f[S[E]]))return!1;return!0}return u!==u&&f!==f}return fU=function(f,_){try{return l(f,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},fU}var b1e=S1e();const T1e=Xg(b1e);function eb(){const n=k.useContext(R0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function hne(){const n=XN(),e=eb();return{...n,theme:e}}function w1e(n,e,i){if(e==null)return e;const o=l=>{var u,f;return(f=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:f.value};return o(e)??o(i)??i}function C1e(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const f=l.filter(Boolean),_=o.map((E,S)=>{const C=`${n}.${E}`;return w1e(u,C,f[S]??E)});return Array.isArray(e)?_:_[0]}}function pne(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:u}=hne(),f=n?BZ(l,`components.${n}`):void 0,_=i||f,E=pp({theme:l,colorMode:u},(_==null?void 0:_.defaultProps)??{},jN(Y0(o,["children"])),(C,I)=>C?void 0:I),S=k.useRef({});if(_){const I=KSe(_)(E);T1e(S.current,I)||(S.current=I)}return S.current}function du(n,e={}){return pne(n,e)}function Ma(n,e={}){return pne(n,e)}const eX={path:b.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[b.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),b.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),b.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},mn=Ft((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:u=!1,children:f,className:_,__css:E,...S}=n,C=gn("chakra-icon",_),I=du("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},M={ref:e,focusable:u,className:C,__css:O},L=o??eX.viewBox;if(i&&typeof i!="string")return b.jsx(Mt.svg,{as:i,...M,...S});const U=f??eX.path;return b.jsx(Mt.svg,{verticalAlign:"middle",viewBox:L,...M,...S,children:U})});mn.displayName="Icon";function R1e(n){return b.jsx(mn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function I1e(n){return b.jsx(mn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function tX(n){return b.jsx(mn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const A1e=hR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),hd=Ft((n,e)=>{const i=du("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:f="transparent",className:_,...E}=Vi(n),S=gn("chakra-spinner",_),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${A1e} ${u} linear infinite`,...i};return b.jsx(Mt.div,{ref:e,__css:C,className:S,...E,children:o&&b.jsx(Mt.span,{srOnly:!0,children:o})})});hd.displayName="Spinner";const[P1e,BF]=Ai({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[O1e,WF]=Ai({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),fne={info:{icon:I1e,colorScheme:"blue"},warning:{icon:tX,colorScheme:"orange"},success:{icon:R1e,colorScheme:"green"},error:{icon:tX,colorScheme:"red"},loading:{icon:hd,colorScheme:"blue"}};function k1e(n){return fne[n].colorScheme}function N1e(n){return fne[n].icon}const Hf=Ft(function(e,i){const{status:o="info",addRole:l=!0,...u}=Vi(e),f=e.colorScheme??k1e(o),_=Ma("Alert",{...e,colorScheme:f}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return b.jsx(P1e,{value:{status:o},children:b.jsx(O1e,{value:_,children:b.jsx(Mt.div,{"data-status":o,role:l?"alert":void 0,ref:i,...u,className:gn("chakra-alert",e.className),__css:E})})})});Hf.displayName="Alert";function $f(n){const{status:e}=BF(),i=N1e(e),o=WF(),l=e==="loading"?o.spinner:o.icon;return b.jsx(Mt.span,{display:"inherit","data-status":e,...n,className:gn("chakra-alert__icon",n.className),__css:l,children:n.children||b.jsx(i,{h:"100%",w:"100%"})})}$f.displayName="AlertIcon";const vC=Ft(function(e,i){const o=WF(),{status:l}=BF();return b.jsx(Mt.div,{ref:i,"data-status":l,...e,className:gn("chakra-alert__title",e.className),__css:o.title})});vC.displayName="AlertTitle";const SC=Ft(function(e,i){const{status:o}=BF(),l=WF(),u={display:"inline",...l.description};return b.jsx(Mt.div,{ref:i,"data-status":o,...e,className:gn("chakra-alert__desc",e.className),__css:u})});SC.displayName="AlertDescription";function D1e(n){return b.jsx(mn,{focusable:"false","aria-hidden":!0,...n,children:b.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const zF=Ft(function(e,i){const o=du("CloseButton",e),{children:l,isDisabled:u,__css:f,..._}=Vi(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return b.jsx(Mt.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...E,...o,...f},..._,children:l||b.jsx(D1e,{width:"1em",height:"1em"})})});zF.displayName="CloseButton";const x1e=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:u,onClose:f,description:_,colorScheme:E,icon:S}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return b.jsxs(Hf,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[b.jsx($f,{children:S}),b.jsxs(Mt.div,{flex:"1",maxWidth:"100%",children:[l&&b.jsx(vC,{id:C==null?void 0:C.title,children:l}),_&&b.jsx(SC,{id:C==null?void 0:C.description,display:"block",children:_})]}),u&&b.jsx(zF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function mne(n={}){const{render:e,toastComponent:i=x1e}=n;return l=>typeof e=="function"?e({...l,...n}):b.jsx(i,{...l,...n})}const L1e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},lp=M1e(L1e);function M1e(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,u)=>{o(f=>({...f,[u]:f[u].filter(_=>_.id!=l)}))},notify:(l,u)=>{const f=U1e(l,u),{position:_,id:E}=f;return o(S=>{const I=_.includes("top")?[f,...S[_]??[]]:[...S[_]??[],f];return{...S,[_]:I}}),E},update:(l,u)=>{l&&o(f=>{const _={...f},{position:E,index:S}=XY(_,l);return E&&S!==-1&&(_[E][S]={..._[E][S],...u,message:mne(u)}),_})},closeAll:({positions:l}={})=>{o(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,S)=>(E[S]=u[S].map(C=>({...C,requestClose:!0})),E),{...u}))},close:l=>{o(u=>{const f=une(u,l);return f?{...u,[f]:u[f].map(_=>_.id==l?{..._,requestClose:!0}:_)}:u})},isActive:l=>!!XY(lp.getState(),l).position}}let nX=0;function U1e(n,e={}){nX+=1;const i=e.id??nX,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>lp.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var gne=NZ();const[_ne,V1e]=Ai({strict:!1,name:"PortalContext"}),GF="chakra-portal",j1e=".chakra-portal",F1e=n=>b.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),B1e=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=k.useState(null),u=k.useRef(null),[,f]=k.useState({});k.useEffect(()=>f({}),[]);const _=V1e(),E=IAe();_p(()=>{if(!o)return;const C=o.ownerDocument,I=e?_??C.body:C.body;if(!I)return;u.current=C.createElement("div"),u.current.className=GF,I.appendChild(u.current),f({});const O=u.current;return()=>{I.contains(O)&&I.removeChild(O)}},[o]);const S=E!=null&&E.zIndex?b.jsx(F1e,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return u.current?gne.createPortal(b.jsx(_ne,{value:u.current,children:S}),u.current):b.jsx("span",{ref:C=>{C&&l(C)}})},W1e=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),f=k.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=GF),E},[l]),[,_]=k.useState({});return _p(()=>_({}),[]),_p(()=>{if(!(!f||!u))return u.appendChild(f),()=>{u.removeChild(f)}},[f,u]),u&&f?gne.createPortal(b.jsx(_ne,{value:o?f:null,children:e}),f):null};function hu(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?b.jsx(W1e,{containerRef:i,...o}):b.jsx(B1e,{...o})}hu.className=GF;hu.selector=j1e;hu.displayName="Portal";const[z1e,G1e]=Ai({name:"ToastOptionsContext",strict:!1}),H1e=n=>{const e=k.useSyncExternalStore(lp.subscribe,lp.getState,lp.getState),{motionVariants:i,component:o=dne,portalProps:l,animatePresenceProps:u}=n,_=Object.keys(e).map(E=>{const S=e[E];return b.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:o1e(E),children:b.jsx(J0,{...u,initial:!1,children:S.map(C=>b.jsx(o,{motionVariants:i,...C},C.id))})},E)});return b.jsx(hu,{...l,children:_})},$1e=n=>function({children:i,theme:o=n,toastOptions:l,...u}){return b.jsxs(PAe,{theme:o,...u,children:[b.jsx(z1e,{value:l==null?void 0:l.defaultOptions,children:i}),b.jsx(H1e,{...l})]})},n1=$1e(EIe);function rX(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const K1e=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function iX(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function sX(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const mU=typeof window<"u"?k.useLayoutEffect:k.useEffect,oX=n=>n;var q1e=Object.defineProperty,Y1e=(n,e,i)=>e in n?q1e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,zs=(n,e,i)=>(Y1e(n,typeof e!="symbol"?e+"":e,i),i);class X1e{constructor(){zs(this,"descendants",new Map),zs(this,"register",e=>{if(e!=null)return K1e(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),zs(this,"unregister",e=>{this.descendants.delete(e);const i=rX(Array.from(this.descendants.keys()));this.assignIndex(i)}),zs(this,"destroy",()=>{this.descendants.clear()}),zs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),zs(this,"count",()=>this.descendants.size),zs(this,"enabledCount",()=>this.enabledValues().length),zs(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),zs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),zs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),zs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),zs(this,"first",()=>this.item(0)),zs(this,"firstEnabled",()=>this.enabledItem(0)),zs(this,"last",()=>this.item(this.descendants.size-1)),zs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),zs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),zs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),zs(this,"next",(e,i=!0)=>{const o=iX(e,this.count(),i);return this.item(o)}),zs(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=iX(l,this.enabledCount(),i);return this.enabledItem(u)}),zs(this,"prev",(e,i=!0)=>{const o=sX(e,this.count()-1,i);return this.item(o)}),zs(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=sX(l,this.enabledCount()-1,i);return this.enabledItem(u)}),zs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=rX(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function yne(){const[n,e]=Ai({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=k.useRef(new X1e);return mU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[f,_]=k.useState(-1),E=k.useRef(null);mU(()=>()=>{E.current&&u.unregister(E.current)},[]),mU(()=>{if(!E.current)return;const C=Number(E.current.dataset.index);f!=C&&!Number.isNaN(C)&&_(C)});const S=oX(l?u.register(l):u.register);return{descendants:u,index:f,enabledIndex:u.enabledIndexOf(E.current),register:Hi(S,E)}}]}const aX={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},zy={enter:{duration:.2,ease:aX.easeOut},exit:{duration:.1,ease:aX.easeIn}},Gy={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},Ene=Ft(function(n,e){const{ratio:i=4/3,children:o,className:l,...u}=n,f=k.Children.only(o),_=gn("chakra-aspect-ratio",l);return b.jsx(Mt.div,{ref:e,position:"relative",className:_,_before:{height:0,content:'""',display:"block",paddingBottom:FN(i,E=>`${1/E*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...u,children:f})});Ene.displayName="AspectRatio";const[J1e,Q1e]=Ai({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function Z1e(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function vne(n){const{name:e,getInitials:i,...o}=n,l=Q1e();return b.jsx(Mt.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}vne.displayName="AvatarName";const Sne=n=>b.jsxs(Mt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[b.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),b.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function bne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:u,crossOrigin:f,sizes:_,ignoreFallback:E}=n,[S,C]=k.useState("pending");k.useEffect(()=>{C(i?"loading":"pending")},[i]);const I=k.useRef(null),O=k.useCallback(()=>{if(!i)return;M();const L=new Image;L.src=i,f&&(L.crossOrigin=f),o&&(L.srcset=o),_&&(L.sizes=_),e&&(L.loading=e),L.onload=U=>{M(),C("loaded"),l==null||l(U)},L.onerror=U=>{M(),C("failed"),u==null||u(U)},I.current=L},[i,f,o,_,l,u,e]),M=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return _p(()=>{if(!E)return S==="loading"&&O(),()=>{M()}},[S,O,E]),E?"loaded":S}const eDe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Tne(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:u,name:f,borderRadius:_,loading:E,iconLabel:S,icon:C=b.jsx(Sne,{}),ignoreFallback:I,referrerPolicy:O,crossOrigin:M}=n,U=bne({src:e,onError:o,crossOrigin:M,ignoreFallback:I})==="loaded";return!e||!U?f?b.jsx(vne,{className:"chakra-avatar__initials",getInitials:u,name:f}):k.cloneElement(C,{role:"img","aria-label":S}):b.jsx(Mt.img,{src:e,srcSet:i,alt:f??S,onLoad:l,referrerPolicy:O,crossOrigin:M??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}Tne.displayName="AvatarImage";const tDe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},wl=Ft((n,e)=>{const i=Ma("Avatar",n),[o,l]=k.useState(!1),{src:u,srcSet:f,name:_,showBorder:E,borderRadius:S="full",onError:C,onLoad:I,getInitials:O=Z1e,icon:M=b.jsx(Sne,{}),iconLabel:L=" avatar",loading:U,children:B,borderColor:J,ignoreFallback:K,crossOrigin:ne,referrerPolicy:oe,...se}=Vi(n),le={borderRadius:S,borderWidth:E?"2px":void 0,...tDe,...i.container};return J&&(le.borderColor=J),b.jsx(Mt.span,{ref:e,...se,className:gn("chakra-avatar",n.className),"data-loaded":rr(o),__css:le,children:b.jsxs(J1e,{value:i,children:[b.jsx(Tne,{src:u,srcSet:f,loading:U,onLoad:Dn(I,()=>{l(!0)}),onError:C,getInitials:O,name:_,borderRadius:S,icon:M,iconLabel:L,ignoreFallback:K,crossOrigin:ne,referrerPolicy:oe}),B]})})});wl.displayName="Avatar";const th=Ft(function(e,i){const o=du("Badge",e),{className:l,...u}=Vi(e);return b.jsx(Mt.span,{ref:i,className:gn("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});th.displayName="Badge";const lt=Mt("div");lt.displayName="Box";const[d9e,nDe]=Ai({strict:!1,name:"ButtonGroupContext"});function tC(n){const{children:e,className:i,...o}=n,l=k.isValidElement(e)?k.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=gn("chakra-button__icon",i);return b.jsx(Mt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:l})}tC.displayName="ButtonIcon";function NV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=b.jsx(hd,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:f,..._}=n,E=gn("chakra-button__spinner",u),S=i==="start"?"marginEnd":"marginStart",C=k.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[S]:e?o:0,fontSize:"1em",lineHeight:"normal",...f}),[f,e,S,o]);return b.jsx(Mt.div,{className:E,..._,__css:C,children:l})}NV.displayName="ButtonSpinner";function rDe(n){const[e,i]=k.useState(!n);return{ref:k.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const Nn=Ft((n,e)=>{const i=nDe(),o=du("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:f,children:_,leftIcon:E,rightIcon:S,loadingText:C,iconSpacing:I="0.5rem",type:O,spinner:M,spinnerPlacement:L="start",className:U,as:B,shouldWrapChildren:J,...K}=Vi(n),ne=k.useMemo(()=>{const Y={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:Y}}},[o,i]),{ref:oe,type:se}=rDe(B),le={rightIcon:S,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:J};return b.jsxs(Mt.button,{disabled:l||u,ref:Uve(e,oe),as:B,type:O??se,"data-active":rr(f),"data-loading":rr(u),__css:ne,className:gn("chakra-button",U),...K,children:[u&&L==="start"&&b.jsx(NV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:I,children:M}),u?C||b.jsx(Mt.span,{opacity:0,children:b.jsx(cX,{...le})}):b.jsx(cX,{...le}),u&&L==="end"&&b.jsx(NV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:I,children:M})]})});Nn.displayName="Button";function cX(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:u}=n;return u?b.jsxs("span",{style:{display:"contents"},children:[e&&b.jsx(tC,{marginEnd:l,children:e}),o,i&&b.jsx(tC,{marginStart:l,children:i})]}):b.jsxs(b.Fragment,{children:[e&&b.jsx(tC,{marginEnd:l,children:e}),o,i&&b.jsx(tC,{marginStart:l,children:i})]})}const xc=Ft((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":u,...f}=n,_=i||o,E=k.isValidElement(_)?k.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return b.jsx(Nn,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...f,children:E})});xc.displayName="IconButton";const wne=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});wne.displayName="Center";const iDe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Ft(function(e,i){const{axis:o="both",...l}=e;return b.jsx(Mt.div,{ref:i,__css:iDe[o],...l,position:"absolute"})});var sDe=()=>typeof document<"u",lX=!1,yR=null,Qy=!1,DV=!1,xV=new Set;function HF(n,e){xV.forEach(i=>i(n,e))}var oDe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function aDe(n){return!(n.metaKey||!oDe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function uX(n){Qy=!0,aDe(n)&&(yR="keyboard",HF("keyboard",n))}function DS(n){if(yR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Qy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;HF("pointer",n)}}function cDe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function lDe(n){cDe(n)&&(Qy=!0,yR="virtual")}function uDe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Qy&&!DV&&(yR="virtual",HF("virtual",n)),Qy=!1,DV=!1)}function dDe(){Qy=!1,DV=!0}function dX(){return yR!=="pointer"}function hDe(){if(!sDe()||lX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Qy=!0,n.apply(this,i)},document.addEventListener("keydown",uX,!0),document.addEventListener("keyup",uX,!0),document.addEventListener("click",lDe,!0),window.addEventListener("focus",uDe,!0),window.addEventListener("blur",dDe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",DS,!0),document.addEventListener("pointermove",DS,!0),document.addEventListener("pointerup",DS,!0)):(document.addEventListener("mousedown",DS,!0),document.addEventListener("mousemove",DS,!0),document.addEventListener("mouseup",DS,!0)),lX=!0}function pDe(n){hDe(),n(dX());const e=()=>n(dX());return xV.add(e),()=>{xV.delete(e)}}const[fDe,Cne]=Ai({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[mDe,tb]=Ai({strict:!1,name:"FormControlContext"});function gDe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:u,...f}=n,_=k.useId(),E=e||`field-${_}`,S=`${E}-label`,C=`${E}-feedback`,I=`${E}-helptext`,[O,M]=k.useState(!1),[L,U]=k.useState(!1),[B,J]=k.useState(!1),K=k.useCallback((Y={},Z=null)=>({id:I,...Y,ref:Hi(Z,X=>{X&&U(!0)})}),[I]),ne=k.useCallback((Y={},Z=null)=>({...Y,ref:Z,"data-focus":rr(B),"data-disabled":rr(l),"data-invalid":rr(o),"data-readonly":rr(u),id:Y.id!==void 0?Y.id:S,htmlFor:Y.htmlFor!==void 0?Y.htmlFor:E}),[E,l,B,o,u,S]),oe=k.useCallback((Y={},Z=null)=>({id:C,...Y,ref:Hi(Z,X=>{X&&M(!0)}),"aria-live":"polite"}),[C]),se=k.useCallback((Y={},Z=null)=>({...Y,...f,ref:Z,role:"group","data-focus":rr(B),"data-disabled":rr(l),"data-invalid":rr(o),"data-readonly":rr(u)}),[f,l,B,o,u]),le=k.useCallback((Y={},Z=null)=>({...Y,ref:Z,role:"presentation","aria-hidden":!0,children:Y.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!l,isFocused:!!B,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:O,setHasFeedbackText:M,hasHelpText:L,setHasHelpText:U,id:E,labelId:S,feedbackId:C,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:oe,getRootProps:se,getLabelProps:ne,getRequiredIndicatorProps:le}}const mr=Ft(function(e,i){const o=Ma("Form",e),l=Vi(e),{getRootProps:u,htmlProps:f,..._}=gDe(l),E=gn("chakra-form-control",e.className);return b.jsx(mDe,{value:_,children:b.jsx(fDe,{value:o,children:b.jsx(Mt.div,{...u({},i),className:E,__css:o.container})})})});mr.displayName="FormControl";const Hy=Ft(function(e,i){const o=tb(),l=Cne(),u=gn("chakra-form__helper-text",e.className);return b.jsx(Mt.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:u})});Hy.displayName="FormHelperText";function $F(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...u}=KF(n);return{...u,disabled:e,readOnly:o,required:l,"aria-invalid":Bf(i),"aria-required":Bf(l),"aria-readonly":Bf(o)}}function KF(n){const e=tb(),{id:i,disabled:o,readOnly:l,required:u,isRequired:f,isInvalid:_,isReadOnly:E,isDisabled:S,onFocus:C,onBlur:I,...O}=n,M=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&M.push(e.feedbackId),e!=null&&e.hasHelpText&&M.push(e.helpTextId),{...O,"aria-describedby":M.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??S??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:u??f??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:Dn(e==null?void 0:e.onFocus,C),onBlur:Dn(e==null?void 0:e.onBlur,I)}}const _De={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function yDe(n={}){const e=KF(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:u,id:f,onBlur:_,onFocus:E,"aria-describedby":S}=e,{defaultChecked:C,isChecked:I,isFocusable:O,onChange:M,isIndeterminate:L,name:U,value:B,tabIndex:J=void 0,"aria-label":K,"aria-labelledby":ne,"aria-invalid":oe,...se}=n,le=Y0(se,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Y=no(M),Z=no(_),X=no(E),[ie,de]=k.useState(!1),[ue,pe]=k.useState(!1),[ke,xe]=k.useState(!1),[je,Oe]=k.useState(!1);k.useEffect(()=>pDe(de),[]);const we=k.useRef(null),[Se,Be]=k.useState(!0),[Ee,Ce]=k.useState(!!C),Pe=I!==void 0,Me=Pe?I:Ee,We=k.useCallback(Ut=>{if(o||i){Ut.preventDefault();return}Pe||Ce(Me?Ut.currentTarget.checked:L?!0:Ut.currentTarget.checked),Y==null||Y(Ut)},[o,i,Me,Pe,L,Y]);_p(()=>{we.current&&(we.current.indeterminate=!!L)},[L]),Qf(()=>{i&&pe(!1)},[i,pe]),_p(()=>{const Ut=we.current;if(!(Ut!=null&&Ut.form))return;const fn=()=>{Ce(!!C)};return Ut.form.addEventListener("reset",fn),()=>{var Wt;return(Wt=Ut.form)==null?void 0:Wt.removeEventListener("reset",fn)}},[]);const He=i&&!O,qe=k.useCallback(Ut=>{Ut.key===" "&&Oe(!0)},[Oe]),rt=k.useCallback(Ut=>{Ut.key===" "&&Oe(!1)},[Oe]);_p(()=>{if(!we.current)return;we.current.checked!==Me&&Ce(we.current.checked)},[we.current]);const et=k.useCallback((Ut={},fn=null)=>{const Wt=Te=>{ue&&Te.preventDefault(),Oe(!0)};return{...Ut,ref:fn,"data-active":rr(je),"data-hover":rr(ke),"data-checked":rr(Me),"data-focus":rr(ue),"data-focus-visible":rr(ue&&ie),"data-indeterminate":rr(L),"data-disabled":rr(i),"data-invalid":rr(u),"data-readonly":rr(o),"aria-hidden":!0,onMouseDown:Dn(Ut.onMouseDown,Wt),onMouseUp:Dn(Ut.onMouseUp,()=>Oe(!1)),onMouseEnter:Dn(Ut.onMouseEnter,()=>xe(!0)),onMouseLeave:Dn(Ut.onMouseLeave,()=>xe(!1))}},[je,Me,i,ue,ie,ke,L,u,o]),_t=k.useCallback((Ut={},fn=null)=>({...Ut,ref:fn,"data-active":rr(je),"data-hover":rr(ke),"data-checked":rr(Me),"data-focus":rr(ue),"data-focus-visible":rr(ue&&ie),"data-indeterminate":rr(L),"data-disabled":rr(i),"data-invalid":rr(u),"data-readonly":rr(o)}),[je,Me,i,ue,ie,ke,L,u,o]),on=k.useCallback((Ut={},fn=null)=>({...le,htmlFor:Se?f:void 0,...Ut,ref:Hi(fn,Wt=>{Wt&&Be(Wt.tagName==="LABEL")}),onClick:Dn(Ut.onClick,()=>{var Wt;Se||((Wt=we.current)==null||Wt.click(),requestAnimationFrame(()=>{var Te;(Te=we.current)==null||Te.focus({preventScroll:!0})}))}),"data-disabled":rr(i),"data-checked":rr(Me),"data-invalid":rr(u)}),[le,i,Me,u,Se,f]),dt=k.useCallback((Ut={},fn=null)=>({...Ut,ref:Hi(we,fn),type:"checkbox",name:U,value:B,id:f,tabIndex:J,onChange:Dn(Ut.onChange,We),onBlur:Dn(Ut.onBlur,Z,()=>pe(!1)),onFocus:Dn(Ut.onFocus,X,()=>pe(!0)),onKeyDown:Dn(Ut.onKeyDown,qe),onKeyUp:Dn(Ut.onKeyUp,rt),required:l,checked:Me,disabled:He,readOnly:o,"aria-label":K,"aria-labelledby":ne,"aria-invalid":oe?!!oe:u,"aria-describedby":S,"aria-disabled":i,"aria-checked":L?"mixed":Me,style:_De}),[U,B,f,J,We,Z,X,qe,rt,l,Me,He,o,K,ne,oe,u,S,i,L]),kt=k.useCallback((Ut={},fn=null)=>({...Ut,ref:fn,onMouseDown:Dn(Ut.onMouseDown,EDe),"data-disabled":rr(i),"data-checked":rr(Me),"data-invalid":rr(u)}),[Me,i,u]);return{state:{isInvalid:u,isFocused:ue,isChecked:Me,isActive:je,isHovered:ke,isIndeterminate:L,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:on,getCheckboxProps:et,getIndicatorProps:_t,getInputProps:dt,getLabelProps:kt,htmlProps:le}}function EDe(n){n.preventDefault(),n.stopPropagation()}const LV=Ft(function(e,i){const{className:o,centerContent:l,...u}=Vi(e),f=du("Container",e);return b.jsx(Mt.div,{ref:i,className:gn("chakra-container",o),...u,__css:{...f,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});LV.displayName="Container";const Kf=Ft(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:f,borderWidth:_,borderStyle:E,borderColor:S,...C}=du("Divider",e),{className:I,orientation:O="horizontal",__css:M,...L}=Vi(e),U={vertical:{borderLeftWidth:o||f||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||_||"1px",width:"100%"}};return b.jsx(Mt.hr,{ref:i,"aria-orientation":O,...L,__css:{...C,border:"0",borderColor:S,borderStyle:E,...U[O],...M},className:gn("chakra-divider",I)})});Kf.displayName="Divider";const Ur=Ft(function(e,i){const{direction:o,align:l,justify:u,wrap:f,basis:_,grow:E,shrink:S,...C}=e,I={display:"flex",flexDirection:o,alignItems:l,justifyContent:u,flexWrap:f,flexBasis:_,flexGrow:E,flexShrink:S};return b.jsx(Mt.div,{ref:i,__css:I,...C})});Ur.displayName="Flex";function vDe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var gU={exports:{}},_U,hX;function SDe(){if(hX)return _U;hX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return _U=n,_U}var yU,pX;function bDe(){if(pX)return yU;pX=1;var n=SDe();function e(){}function i(){}return i.resetWarningCache=e,yU=function(){function o(f,_,E,S,C,I){if(I!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}o.isRequired=o;function l(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},yU}var fX;function TDe(){return fX||(fX=1,gU.exports=bDe()()),gU.exports}var wDe=TDe();const En=Xg(wDe);var MV="data-focus-lock",Rne="data-focus-lock-disabled",CDe="data-no-focus-lock",RDe="data-autofocus-inside",IDe="data-no-autofocus";function EU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function ADe(n,e){var i=k.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var PDe=typeof window<"u"?k.useLayoutEffect:k.useEffect,mX=new WeakMap;function Ine(n,e){var i=ADe(null,function(o){return n.forEach(function(l){return EU(l,o)})});return PDe(function(){var o=mX.get(i);if(o){var l=new Set(o),u=new Set(n),f=i.current;l.forEach(function(_){u.has(_)||EU(_,null)}),u.forEach(function(_){l.has(_)||EU(_,f)})}mX.set(i,n)},[n]),i}var vU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},up=function(){return up=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},up.apply(this,arguments)};function ER(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function ODe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,u;o<l;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return n.concat(u||Array.prototype.slice.call(e))}function Ane(n){return n}function Pne(n,e){e===void 0&&(e=Ane);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var f=e(u,o);return i.push(f),function(){i=i.filter(function(_){return _!==f})}},assignSyncMedium:function(u){for(o=!0;i.length;){var f=i;i=[],f.forEach(u)}i={push:function(_){return u(_)},filter:function(){return i}}},assignMedium:function(u){o=!0;var f=[];if(i.length){var _=i;i=[],_.forEach(u),f=i}var E=function(){var C=f;f=[],C.forEach(u)},S=function(){return Promise.resolve().then(E)};S(),i={push:function(C){f.push(C),S()},filter:function(C){return f=f.filter(C),i}}}};return l}function qF(n,e){return e===void 0&&(e=Ane),Pne(n,e)}function One(n){n===void 0&&(n={});var e=Pne(null);return e.options=up({async:!0,ssr:!1},n),e}var kne=function(n){var e=n.sideCar,i=ER(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return k.createElement(o,up({},i))};kne.isSideCarExport=!0;function kDe(n,e){return n.useMedium(e),kne}var Nne=qF({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Dne=qF(),NDe=qF(),DDe=One({async:!0,ssr:typeof document<"u"}),xDe=k.createContext(void 0),LDe=[],YF=k.forwardRef(function(e,i){var o,l=k.useState(),u=l[0],f=l[1],_=k.useRef(),E=k.useRef(!1),S=k.useRef(null),C=k.useState({}),I=C[1],O=e.children,M=e.disabled,L=M===void 0?!1:M,U=e.noFocusGuards,B=U===void 0?!1:U,J=e.persistentFocus,K=J===void 0?!1:J,ne=e.crossFrame,oe=ne===void 0?!0:ne,se=e.autoFocus,le=se===void 0?!0:se;e.allowTextSelection;var Y=e.group,Z=e.className,X=e.whiteList,ie=e.hasPositiveIndices,de=e.shards,ue=de===void 0?LDe:de,pe=e.as,ke=pe===void 0?"div":pe,xe=e.lockProps,je=xe===void 0?{}:xe,Oe=e.sideCar,we=e.returnFocus,Se=we===void 0?!1:we,Be=e.focusOptions,Ee=e.onActivation,Ce=e.onDeactivation,Pe=k.useState({}),Me=Pe[0],We=k.useCallback(function(fn){var Wt=fn.captureFocusRestore;if(!S.current){var Te,Ve=(Te=document)==null?void 0:Te.activeElement;S.current=Ve,Ve!==document.body&&(S.current=Wt(Ve))}_.current&&Ee&&Ee(_.current),E.current=!0,I()},[Ee]),He=k.useCallback(function(){E.current=!1,Ce&&Ce(_.current),I()},[Ce]),qe=k.useCallback(function(fn){var Wt=S.current;if(Wt){var Te=(typeof Wt=="function"?Wt():Wt)||document.body,Ve=typeof Se=="function"?Se(Te):Se;if(Ve){var $e=typeof Ve=="object"?Ve:void 0;S.current=null,fn?Promise.resolve().then(function(){return Te.focus($e)}):Te.focus($e)}}},[Se]),rt=k.useCallback(function(fn){E.current&&Nne.useMedium(fn)},[]),et=Dne.useMedium,_t=k.useCallback(function(fn){_.current!==fn&&(_.current=fn,f(fn))},[]),on=Jy((o={},o[Rne]=L&&"disabled",o[MV]=Y,o),je),dt=B!==!0,kt=dt&&B!=="tail",ct=Ine([i,_t]),Ut=k.useMemo(function(){return{observed:_,shards:ue,enabled:!L,active:E.current}},[L,E.current,ue,u]);return _i.createElement(k.Fragment,null,dt&&[_i.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:L?-1:0,style:vU}),ie?_i.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:L?-1:1,style:vU}):null],!L&&_i.createElement(Oe,{id:Me,sideCar:DDe,observed:u,disabled:L,persistentFocus:K,crossFrame:oe,autoFocus:le,whiteList:X,shards:ue,onActivation:We,onDeactivation:He,returnFocus:qe,focusOptions:Be,noFocusGuards:B}),_i.createElement(ke,Jy({ref:ct},on,{className:Z,onBlur:et,onFocus:rt}),_i.createElement(xDe.Provider,{value:Ut},O)),kt&&_i.createElement("div",{"data-focus-guard":!0,tabIndex:L?-1:0,style:vU}))});YF.propTypes={};function UV(n,e){return UV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},UV(n,e)}function MDe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,UV(n,e)}function zC(n){"@babel/helpers - typeof";return zC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zC(n)}function UDe(n,e){if(zC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(zC(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function VDe(n){var e=UDe(n,"string");return zC(e)=="symbol"?e:e+""}function jDe(n,e,i){return(e=VDe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function FDe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var u=[],f;function _(){f=n(u.map(function(S){return S.props})),e(f)}var E=function(S){MDe(C,S);function C(){return S.apply(this,arguments)||this}C.peek=function(){return f};var I=C.prototype;return I.componentDidMount=function(){u.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var M=u.indexOf(this);u.splice(M,1),_()},I.render=function(){return _i.createElement(l,this.props)},C}(k.PureComponent);return jDe(E,"displayName","SideEffect("+i(l)+")"),E}}var Op=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Zy=function(n){return Array.isArray(n)?n:[n]},xne=function(n){return Array.isArray(n)?n[0]:n},BDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Lne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Mne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},WDe=function(n){return n.hasAttribute("inert")},zDe=function(n,e){return!n||Mne(n)||!BDe(n)&&!WDe(n)&&e(Lne(n))},Une=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=zDe(e,Une.bind(void 0,n));return n.set(e,o),o},GDe=function(n,e){return n&&!Mne(n)?KDe(n)?e(Lne(n)):!1:!0},Vne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=GDe(e,Vne.bind(void 0,n));return n.set(e,o),o},jne=function(n){return n.dataset},HDe=function(n){return n.tagName==="BUTTON"},Fne=function(n){return n.tagName==="INPUT"},Bne=function(n){return Fne(n)&&n.type==="radio"},$De=function(n){return!((Fne(n)||HDe(n))&&(n.type==="hidden"||n.disabled))},KDe=function(n){var e=n.getAttribute(IDe);return![!0,"true",""].includes(e)},XF=function(n){var e;return!!(n&&(!((e=jne(n))===null||e===void 0)&&e.focusGuard))},VV=function(n){return!XF(n)},qDe=function(n){return!!n},YDe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,u=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||u},XDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},JF=function(n,e,i){return Op(n).map(function(o,l){var u=XDe(o);return{node:o,index:l,tabIndex:i&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(YDe)},JDe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],QF=JDe.join(","),QDe="".concat(QF,", [data-focus-guard]"),Wne=function(n,e){return Op((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?QDe:QF)?[o]:[],Wne(o))},[])},ZDe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?O0([n.contentDocument.body],e):[n]},O0=function(n,e){return n.reduce(function(i,o){var l,u=Wne(o,e),f=(l=[]).concat.apply(l,u.map(function(_){return ZDe(_,e)}));return i.concat(f,o.parentNode?Op(o.parentNode.querySelectorAll(QF)).filter(function(_){return _===o}):[])},[])},exe=function(n){var e=n.querySelectorAll("[".concat(RDe,"]"));return Op(e).map(function(i){return O0([i])}).reduce(function(i,o){return i.concat(o)},[])},ZF=function(n,e){return Op(n).filter(function(i){return Une(e,i)}).filter(function(i){return $De(i)})},gX=function(n,e){return e===void 0&&(e=new Map),Op(n).filter(function(i){return Vne(e,i)})},e4=function(n,e,i){return JF(ZF(O0(n,i),e),!0,i)},GC=function(n,e){return JF(ZF(O0(n),e),!1)},txe=function(n,e){return ZF(exe(n),e)},$y=function(n,e){return n.shadowRoot?$y(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:Op(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?$y(l,e):!1}return $y(i,e)})},nxe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var u=n[o].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(f,_){return!e.has(_)})},zne=function(n){return n.parentNode?zne(n.parentNode):n},t4=function(n){var e=Zy(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(MV);return i.push.apply(i,l?nxe(Op(zne(o).querySelectorAll("[".concat(MV,'="').concat(l,'"]:not([').concat(Rne,'="disabled"])')))):[o]),i},[])},rxe=function(n){try{return n()}catch{return}},HC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?HC(e.shadowRoot):e instanceof HTMLIFrameElement&&rxe(function(){return e.contentWindow.document})?HC(e.contentWindow.document):e}},ixe=function(n,e){return n===e},sxe=function(n,e){return!!Op(n.querySelectorAll("iframe")).some(function(i){return ixe(i,e)})},Gne=function(n,e){return e===void 0&&(e=HC(xne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:t4(n).some(function(i){return $y(i,e)||sxe(i,e)})},oxe=function(n){n===void 0&&(n=document);var e=HC(n);return e?Op(n.querySelectorAll("[".concat(CDe,"]"))).some(function(i){return $y(i,e)}):!1},axe=function(n,e){return e.filter(Bne).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},n4=function(n,e){return Bne(n)&&n.name?axe(n,e):n},cxe=function(n){var e=new Set;return n.forEach(function(i){return e.add(n4(i,n))}),n.filter(function(i){return e.has(i)})},_X=function(n){return n[0]&&n.length>1?n4(n[0],n):n[0]},yX=function(n,e){return n.indexOf(n4(e,n))},jV="NEW_FOCUS",lxe=function(n,e,i,o,l){var u=n.length,f=n[0],_=n[u-1],E=XF(o);if(!(o&&n.indexOf(o)>=0)){var S=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):S,I=l?n.indexOf(l):-1;if(S===-1)return I!==-1?I:jV;if(I===-1)return jV;var O=S-C,M=i.indexOf(f),L=i.indexOf(_),U=cxe(i),B=o!==void 0?U.indexOf(o):-1,J=l?U.indexOf(l):B,K=U.filter(function(Z){return Z.tabIndex>=0}),ne=o!==void 0?K.indexOf(o):-1,oe=l?K.indexOf(l):ne,se=ne>=0&&oe>=0?oe-ne:J-B;if(!O&&I>=0||e.length===0)return I;var le=yX(n,e[0]),Y=yX(n,e[e.length-1]);if(S<=M&&E&&Math.abs(O)>1)return Y;if(S>=L&&E&&Math.abs(O)>1)return le;if(O&&Math.abs(se)>1)return I;if(S<=M)return Y;if(S>L)return le;if(O)return Math.abs(O)>1?I:(u+I+O)%u}},uxe=function(n){return function(e){var i,o=(i=jne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},EX=function(n,e,i){var o=n.map(function(u){var f=u.node;return f}),l=gX(o.filter(uxe(i)));return l&&l.length?_X(l):_X(gX(e))},FV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&FV(n.parentNode.host||n.parentNode,e),e},SU=function(n,e){for(var i=FV(n),o=FV(e),l=0;l<i.length;l+=1){var u=i[l];if(o.indexOf(u)>=0)return u}return!1},Hne=function(n,e,i){var o=Zy(n),l=Zy(e),u=o[0],f=!1;return l.filter(Boolean).forEach(function(_){f=SU(f||_,_)||f,i.filter(Boolean).forEach(function(E){var S=SU(u,E);S&&(!f||$y(S,f)?f=S:f=SU(S,f))})}),f},vX=function(n,e){return n.reduce(function(i,o){return i.concat(txe(o,e))},[])},dxe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(qDe)},hxe=function(n,e){var i=HC(Zy(n).length>0?document:xne(n).ownerDocument),o=t4(n).filter(VV),l=Hne(i||n,n,o),u=new Map,f=GC(o,u),_=f.filter(function(L){var U=L.node;return VV(U)});if(_[0]){var E=GC([l],u).map(function(L){var U=L.node;return U}),S=dxe(E,_),C=S.map(function(L){var U=L.node;return U}),I=S.filter(function(L){var U=L.tabIndex;return U>=0}).map(function(L){var U=L.node;return U}),O=lxe(C,I,E,i,e);if(O===jV){var M=EX(f,I,vX(o,u))||EX(f,C,vX(o,u));if(M)return{node:M};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:S[O]}},pxe=function(n){var e=t4(n).filter(VV),i=Hne(n,n,e),o=JF(O0([i],!0),!0,!0),l=O0(e,!1);return o.map(function(u){var f=u.node,_=u.index;return{node:f,index:_,lockItem:l.indexOf(f)>=0,guard:XF(f)}})},r4=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},bU=0,TU=!1,$ne=function(n,e,i){i===void 0&&(i={});var o=hxe(n,e);if(!TU&&o){if(bU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),TU=!0,setTimeout(function(){TU=!1},1);return}bU++,r4(o.node,i.focusOptions),bU--}};function Ow(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var fxe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:Ow(i),parent:Ow(i.parentElement),left:Ow(i.previousElementSibling),right:Ow(i.nextElementSibling)}),i=i.parentElement;return{element:Ow(n),stack:e,ownerDocument:n.ownerDocument}},mxe=function(n){var e,i,o,l,u;if(n)for(var f=n.stack,_=n.ownerDocument,E=new Map,S=0,C=f;S<C.length;S++){var I=C[S],O=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(O&&_.contains(O)){for(var M=(i=I.left)===null||i===void 0?void 0:i.call(I),L=I.current(),U=O.contains(L)?L:void 0,B=(o=I.right)===null||o===void 0?void 0:o.call(I),J=e4([O],E),K=(u=(l=U??(M==null?void 0:M.nextElementSibling))!==null&&l!==void 0?l:B)!==null&&u!==void 0?u:M;K;){for(var ne=0,oe=J;ne<oe.length;ne++){var se=oe[ne];if(K!=null&&K.contains(se.node))return se.node}K=K.nextElementSibling}if(J.length)return J[0].node}}},Kne=function(n){var e=fxe(n);return function(){return mxe(e)}},gxe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=Zy(e);if(o.every(function(f){return!$y(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?e4(o,new Map):GC(o,new Map),u=l.findIndex(function(f){var _=f.node;return _===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},_xe=function(n,e){var i=e?e4(Zy(n),new Map):GC(Zy(n),new Map);return{first:i[0],last:i[i.length-1]}},yxe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},qne=function(n,e,i){e===void 0&&(e={});var o=yxe(e),l=gxe(n,o.scope,o.onlyTabbable);if(l){var u=i(l,o.cycle);u&&r4(u.node,o.focusOptions)}},Exe=function(n,e){e===void 0&&(e={}),qne(n,e,function(i,o){var l=i.next,u=i.first;return l||o&&u})},vxe=function(n,e){e===void 0&&(e={}),qne(n,e,function(i,o){var l=i.prev,u=i.last;return l||o&&u})},Yne=function(n,e,i){var o,l=_xe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=l[i];u&&r4(u.node,e.focusOptions)},Sxe=function(n,e){e===void 0&&(e={}),Yne(n,e,"first")},bxe=function(n,e){e===void 0&&(e={}),Yne(n,e,"last")};function i4(n){setTimeout(n,1)}var Txe=function(e){return e&&"current"in e?e.current:e},Xne=function(){return document&&document.activeElement===document.body},wxe=function(){return Xne()||oxe()},p0=null,gl=null,SX=function(){return null},f0=null,$C=!1,s4=!1,Cxe=function(){return!0},Rxe=function(e){return(p0.whiteList||Cxe)(e)},Ixe=function(e,i){f0={observerNode:e,portaledElement:i}},Axe=function(e){return f0&&f0.portaledElement===e};function bX(n,e,i,o){var l=null,u=n;do{var f=o[u];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var Pxe=function(e){return e?!!$C:$C==="meanwhile"},Oxe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},kxe=function(e,i){return i.some(function(o){return Oxe(e,o,o)})},Jne=function(e){return GC(e,new Map)},Nxe=function(e){return!Jne([e.parentNode]).some(function(i){return i.node===e})},rN=function(){var e=!1;if(p0){var i=p0,o=i.observed,l=i.persistentFocus,u=i.autoFocus,f=i.shards,_=i.crossFrame,E=i.focusOptions,S=i.noFocusGuards,C=o||f0&&f0.portaledElement;if(Xne()&&gl&&gl!==document.body&&(!document.body.contains(gl)||Nxe(gl))){var I=SX();I&&I.focus()}var O=document&&document.activeElement;if(C){var M=[C].concat(f.map(Txe).filter(Boolean)),L=function(){if(!Pxe(_)||!S||!gl||s4)return!1;var ne=Jne(M),oe=ne.findIndex(function(se){var le=se.node;return le===gl});return oe===0||oe===ne.length-1};if((!O||Rxe(O))&&(l||L()||!wxe()||!gl&&u)&&(C&&!(Gne(M)||O&&kxe(O,M)||Axe(O))&&(document&&!gl&&O&&!u?(O.blur&&O.blur(),document.body.focus()):(e=$ne(M,gl,{focusOptions:E}),f0={})),gl=document&&document.activeElement,gl!==document.body&&(SX=Kne(gl)),$C=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var U=document&&document.activeElement,B=pxe(M),J=B.map(function(K){var ne=K.node;return ne}).indexOf(U);J>-1&&(B.filter(function(K){var ne=K.guard,oe=K.node;return ne&&oe.dataset.focusAutoGuard}).forEach(function(K){var ne=K.node;return ne.removeAttribute("tabIndex")}),bX(J,B.length,1,B),bX(J,-1,-1,B))}}}return e},Qne=function(e){rN()&&e&&(e.stopPropagation(),e.preventDefault())},o4=function(){return i4(rN)},Dxe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||Ixe(o,i)},xxe=function(){return null},Zne=function(){s4=!0},ere=function(){s4=!1,$C="just",i4(function(){$C="meanwhile"})},Lxe=function(){document.addEventListener("focusin",Qne),document.addEventListener("focusout",o4),window.addEventListener("focus",Zne),window.addEventListener("blur",ere)},Mxe=function(){document.removeEventListener("focusin",Qne),document.removeEventListener("focusout",o4),window.removeEventListener("focus",Zne),window.removeEventListener("blur",ere)};function Uxe(n){return n.filter(function(e){var i=e.disabled;return!i})}var tre={moveFocusInside:$ne,focusInside:Gne,focusNextElement:Exe,focusPrevElement:vxe,focusFirstElement:Sxe,focusLastElement:bxe,captureFocusRestore:Kne};function Vxe(n){var e=n.slice(-1)[0];e&&!p0&&Lxe();var i=p0,o=i&&e&&e.id===i.id;p0=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(gl=null,(!o||i.observed!==e.observed)&&e.onActivation(tre),rN(),i4(rN)):(Mxe(),gl=null)}Nne.assignSyncMedium(Dxe);Dne.assignMedium(o4);NDe.assignMedium(function(n){return n(tre)});const jxe=FDe(Uxe,Vxe)(xxe);var BV=k.forwardRef(function(e,i){return _i.createElement(YF,Jy({sideCar:jxe,ref:i},e))}),nre=YF.propTypes||{};nre.sideCar;vDe(nre,["sideCar"]);BV.propTypes={};const Fxe=BV.default??BV,rre=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:u,isDisabled:f,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:S}=n,C=k.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&FZ(o.current).length===0&&requestAnimationFrame(()=>{var L;(L=o.current)==null||L.focus()})},[e,o]),I=k.useCallback(()=>{var M;(M=i==null?void 0:i.current)==null||M.focus()},[i]),O=l&&!i;return b.jsx(Fxe,{crossFrame:S,persistentFocus:E,autoFocus:_,disabled:f,onActivation:C,onDeactivation:I,returnFocus:O,children:u})};rre.displayName="FocusLock";const[Bxe,Wxe]=Ai({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),cp=Ft((n,e)=>{const i=Ma("FormError",n),o=Vi(n),l=tb();return l!=null&&l.isInvalid?b.jsx(Bxe,{value:i,children:b.jsx(Mt.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:gn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});cp.displayName="FormErrorMessage";const zxe=Ft((n,e)=>{const i=Wxe(),o=tb();if(!(o!=null&&o.isInvalid))return null;const l=gn("chakra-form__error-icon",n.className);return b.jsx(mn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:b.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});zxe.displayName="FormErrorIcon";const li=Ft(function(e,i){const o=du("FormLabel",e),l=Vi(e),{className:u,children:f,requiredIndicator:_=b.jsx(ire,{}),optionalIndicator:E=null,...S}=l,C=tb(),I=(C==null?void 0:C.getLabelProps(S,i))??{ref:i,...S};return b.jsxs(Mt.label,{...I,className:gn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[f,C!=null&&C.isRequired?_:E]})});li.displayName="FormLabel";const ire=Ft(function(e,i){const o=tb(),l=Cne();if(!(o!=null&&o.isRequired))return null;const u=gn("chakra-form__required-indicator",e.className);return b.jsx(Mt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});ire.displayName="RequiredIndicator";const a4=Ft(function(e,i){const{templateAreas:o,gap:l,rowGap:u,columnGap:f,column:_,row:E,autoFlow:S,autoRows:C,templateRows:I,autoColumns:O,templateColumns:M,...L}=e,U={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:u,gridColumnGap:f,gridAutoColumns:O,gridColumn:_,gridRow:E,gridAutoFlow:S,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:M};return b.jsx(Mt.div,{ref:i,__css:U,...L})});a4.displayName="Grid";const sre=Ft(function(e,i){const{columns:o,spacingX:l,spacingY:u,spacing:f,minChildWidth:_,...E}=e,S=eb(),C=_?Hxe(_,S):$xe(o);return b.jsx(a4,{ref:i,gap:f,columnGap:l,rowGap:u,templateColumns:C,...E})});sre.displayName="SimpleGrid";function Gxe(n){return typeof n=="number"?`${n}px`:n}function Hxe(n,e){return FN(n,i=>{const o=C1e("sizes",i,Gxe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function $xe(n){return FN(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Qg(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,u=k.Children.toArray(n.path),f=Ft((_,E)=>b.jsx(mn,{ref:E,viewBox:e,...l,..._,children:u.length?u:b.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=o,f}const WV=Ft(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:u,...f}=e;return b.jsx("img",{width:o,height:l,ref:i,alt:u,...f})});WV.displayName="NativeImage";const fp=Ft(function(e,i){const{fallbackSrc:o,fallback:l,src:u,srcSet:f,align:_,fit:E,loading:S,ignoreFallback:C,crossOrigin:I,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:M,...L}=e,U=o!==void 0||l!==void 0,B=S!=null||C||!U,J=bne({...e,crossOrigin:I,ignoreFallback:B}),K=eDe(J,O),ne={ref:i,objectFit:E,objectPosition:_,...B?L:Y0(L,["onError","onLoad"])};return K?l||b.jsx(Mt.img,{as:WV,className:"chakra-image__placeholder",src:o,...ne}):b.jsx(Mt.img,{as:WV,src:u,srcSet:f,crossOrigin:I,loading:S,referrerPolicy:M,className:"chakra-image",...ne})});fp.displayName="Image";const ni=Ft(function(e,i){const{htmlSize:o,...l}=e,u=Ma("Input",l),f=Vi(l),_=$F(f),E=gn("chakra-input",e.className);return b.jsx(Mt.input,{size:o,..._,__css:u.field,ref:i,className:E})});ni.displayName="Input";ni.id="Input";const[Kxe,ore]=Ai({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),xg=Ft(function(e,i){const o=Ma("Input",e),{children:l,className:u,...f}=Vi(e),_=gn("chakra-input__group",u),E={},S=VN(l),C=o.field;S.forEach(O=>{o&&(C&&O.type.id==="InputLeftElement"&&(E.paddingStart=C.height??C.h),C&&O.type.id==="InputRightElement"&&(E.paddingEnd=C.height??C.h),O.type.id==="InputRightAddon"&&(E.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=S.map(O=>{var L,U;const M=jN({size:((L=O.props)==null?void 0:L.size)||e.size,variant:((U=O.props)==null?void 0:U.variant)||e.variant});return O.type.id!=="Input"?k.cloneElement(O,M):k.cloneElement(O,Object.assign(M,E,O.props))});return b.jsx(Mt.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...f,children:b.jsx(Kxe,{value:o,children:I})})});xg.displayName="InputGroup";const qxe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},Yxe=Mt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),c4=Ft(function(e,i){const{placement:o="left",...l}=e,u=qxe[o]??{},f=ore();return b.jsx(Yxe,{ref:i,...l,__css:{...f.addon,...u}})});c4.displayName="InputAddon";const r1=Ft(function(e,i){return b.jsx(c4,{ref:i,placement:"left",...e,className:gn("chakra-input__left-addon",e.className)})});r1.displayName="InputLeftAddon";r1.id="InputLeftAddon";const are=Ft(function(e,i){return b.jsx(c4,{ref:i,placement:"right",...e,className:gn("chakra-input__right-addon",e.className)})});are.displayName="InputRightAddon";are.id="InputRightAddon";const Xxe=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),i1=Ft(function(e,i){const{placement:o="left",...l}=e,u=ore(),f=u.field,E={[o==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...u.element};return b.jsx(Xxe,{ref:i,__css:E,...l})});i1.id="InputElement";i1.displayName="InputElement";const bC=Ft(function(e,i){const{className:o,...l}=e,u=gn("chakra-input__left-element",o);return b.jsx(i1,{ref:i,placement:"left",className:u,...l})});bC.id="InputLeftElement";bC.displayName="InputLeftElement";const iN=Ft(function(e,i){const{className:o,...l}=e,u=gn("chakra-input__right-element",o);return b.jsx(i1,{ref:i,placement:"right",className:u,...l})});iN.id="InputRightElement";iN.displayName="InputRightElement";const nu=Ft(function(e,i){const o=du("Link",e),{className:l,isExternal:u,...f}=Vi(e);return b.jsx(Mt.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:gn("chakra-link",l),...f,__css:o})});nu.displayName="Link";const[Jxe,cre]=Ai({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),s1=Ft(function(e,i){const o=Ma("List",e),{children:l,styleType:u="none",stylePosition:f,spacing:_,...E}=Vi(e),S=VN(l),I=_?{["& > *:not(style) ~ *:not(style)"]:{mt:_}}:{};return b.jsx(Jxe,{value:o,children:b.jsx(Mt.ul,{ref:i,listStyleType:u,listStylePosition:f,role:"list",__css:{...o.container,...I},...E,children:S})})});s1.displayName="List";const Qxe=Ft((n,e)=>{const{as:i,...o}=n;return b.jsx(s1,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...o})});Qxe.displayName="OrderedList";const Zxe=Ft(function(e,i){const{as:o,...l}=e;return b.jsx(s1,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});Zxe.displayName="UnorderedList";const lre=Ft(function(e,i){const o=cre();return b.jsx(Mt.li,{ref:i,...e,__css:o.item})});lre.displayName="ListItem";const eLe=Ft(function(e,i){const o=cre();return b.jsx(mn,{ref:i,role:"presentation",...e,__css:o.icon})});eLe.displayName="ListIcon";function tLe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=AAe(),u=Array.isArray(n)?n:[n];let f=Array.isArray(o)?o:[o];f=f.filter(S=>S!=null);const[_,E]=k.useState(()=>u.map((S,C)=>({media:S,matches:i?!!f[C]:l().matchMedia(S).matches})));return k.useEffect(()=>{const S=l();E(u.map(O=>({media:O,matches:S.matchMedia(O).matches})));const C=u.map(O=>S.matchMedia(O)),I=O=>{E(M=>M.slice().map(L=>L.media===O.media?{...L,matches:O.matches}:L))};return C.forEach(O=>{typeof O.addListener=="function"?O.addListener(I):O.addEventListener("change",I)}),()=>{C.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(I):O.removeEventListener("change",I)})}},[l]),_.map(S=>S.matches)}function nLe(n,e,i,o){if(e==null)return o;if(!o)return n.find(f=>i(f).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(o)?(u=l.indexOf(o)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return o}function rLe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function iLe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=k.useState([]),u=k.useRef(void 0),f=()=>{u.current&&(clearTimeout(u.current),u.current=null)},_=()=>{f(),u.current=setTimeout(()=>{l([]),u.current=null},e)};k.useEffect(()=>f,[]);function E(S){return C=>{if(C.key==="Backspace"){const I=[...o];I.pop(),l(I);return}if(rLe(C)){const I=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(I),S(I.join("")),_()}}}return E}var Cl="top",ud="bottom",dd="right",Rl="left",l4="auto",vR=[Cl,ud,dd,Rl],k0="start",KC="end",sLe="clippingParents",ure="viewport",kw="popper",oLe="reference",TX=vR.reduce(function(n,e){return n.concat([e+"-"+k0,e+"-"+KC])},[]),dre=[].concat(vR,[l4]).reduce(function(n,e){return n.concat([e,e+"-"+k0,e+"-"+KC])},[]),aLe="beforeRead",cLe="read",lLe="afterRead",uLe="beforeMain",dLe="main",hLe="afterMain",pLe="beforeWrite",fLe="write",mLe="afterWrite",gLe=[aLe,cLe,lLe,uLe,dLe,hLe,pLe,fLe,mLe];function Ip(n){return n?(n.nodeName||"").toLowerCase():null}function uu(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function eE(n){var e=uu(n).Element;return n instanceof e||n instanceof Element}function rd(n){var e=uu(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function u4(n){if(typeof ShadowRoot>"u")return!1;var e=uu(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function _Le(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!rd(u)||!Ip(u)||(Object.assign(u.style,o),Object.keys(l).forEach(function(f){var _=l[f];_===!1?u.removeAttribute(f):u.setAttribute(f,_===!0?"":_)}))})}function yLe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],u=e.attributes[o]||{},f=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),_=f.reduce(function(E,S){return E[S]="",E},{});!rd(l)||!Ip(l)||(Object.assign(l.style,_),Object.keys(u).forEach(function(E){l.removeAttribute(E)}))})}}const ELe={name:"applyStyles",enabled:!0,phase:"write",fn:_Le,effect:yLe,requires:["computeStyles"]};function bp(n){return n.split("-")[0]}var Ky=Math.max,sN=Math.min,N0=Math.round;function zV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function hre(){return!/^((?!chrome|android).)*safari/i.test(zV())}function D0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,u=1;e&&rd(n)&&(l=n.offsetWidth>0&&N0(o.width)/n.offsetWidth||1,u=n.offsetHeight>0&&N0(o.height)/n.offsetHeight||1);var f=eE(n)?uu(n):window,_=f.visualViewport,E=!hre()&&i,S=(o.left+(E&&_?_.offsetLeft:0))/l,C=(o.top+(E&&_?_.offsetTop:0))/u,I=o.width/l,O=o.height/u;return{width:I,height:O,top:C,right:S+I,bottom:C+O,left:S,x:S,y:C}}function d4(n){var e=D0(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function pre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&u4(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function tm(n){return uu(n).getComputedStyle(n)}function vLe(n){return["table","td","th"].indexOf(Ip(n))>=0}function Zg(n){return((eE(n)?n.ownerDocument:n.document)||window.document).documentElement}function o1(n){return Ip(n)==="html"?n:n.assignedSlot||n.parentNode||(u4(n)?n.host:null)||Zg(n)}function wX(n){return!rd(n)||tm(n).position==="fixed"?null:n.offsetParent}function SLe(n){var e=/firefox/i.test(zV()),i=/Trident/i.test(zV());if(i&&rd(n)){var o=tm(n);if(o.position==="fixed")return null}var l=o1(n);for(u4(l)&&(l=l.host);rd(l)&&["html","body"].indexOf(Ip(l))<0;){var u=tm(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function SR(n){for(var e=uu(n),i=wX(n);i&&vLe(i)&&tm(i).position==="static";)i=wX(i);return i&&(Ip(i)==="html"||Ip(i)==="body"&&tm(i).position==="static")?e:i||SLe(n)||e}function h4(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function TC(n,e,i){return Ky(n,sN(e,i))}function bLe(n,e,i){var o=TC(n,e,i);return o>i?i:o}function fre(){return{top:0,right:0,bottom:0,left:0}}function mre(n){return Object.assign({},fre(),n)}function gre(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var TLe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,mre(typeof e!="number"?e:gre(e,vR))};function wLe(n){var e,i=n.state,o=n.name,l=n.options,u=i.elements.arrow,f=i.modifiersData.popperOffsets,_=bp(i.placement),E=h4(_),S=[Rl,dd].indexOf(_)>=0,C=S?"height":"width";if(!(!u||!f)){var I=TLe(l.padding,i),O=d4(u),M=E==="y"?Cl:Rl,L=E==="y"?ud:dd,U=i.rects.reference[C]+i.rects.reference[E]-f[E]-i.rects.popper[C],B=f[E]-i.rects.reference[E],J=SR(u),K=J?E==="y"?J.clientHeight||0:J.clientWidth||0:0,ne=U/2-B/2,oe=I[M],se=K-O[C]-I[L],le=K/2-O[C]/2+ne,Y=TC(oe,le,se),Z=E;i.modifiersData[o]=(e={},e[Z]=Y,e.centerOffset=Y-le,e)}}function CLe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||pre(e.elements.popper,l)&&(e.elements.arrow=l))}const RLe={name:"arrow",enabled:!0,phase:"main",fn:wLe,effect:CLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function x0(n){return n.split("-")[1]}var ILe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ALe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:N0(i*l)/l||0,y:N0(o*l)/l||0}}function CX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,u=n.variation,f=n.offsets,_=n.position,E=n.gpuAcceleration,S=n.adaptive,C=n.roundOffsets,I=n.isFixed,O=f.x,M=O===void 0?0:O,L=f.y,U=L===void 0?0:L,B=typeof C=="function"?C({x:M,y:U}):{x:M,y:U};M=B.x,U=B.y;var J=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),ne=Rl,oe=Cl,se=window;if(S){var le=SR(i),Y="clientHeight",Z="clientWidth";if(le===uu(i)&&(le=Zg(i),tm(le).position!=="static"&&_==="absolute"&&(Y="scrollHeight",Z="scrollWidth")),le=le,l===Cl||(l===Rl||l===dd)&&u===KC){oe=ud;var X=I&&le===se&&se.visualViewport?se.visualViewport.height:le[Y];U-=X-o.height,U*=E?1:-1}if(l===Rl||(l===Cl||l===ud)&&u===KC){ne=dd;var ie=I&&le===se&&se.visualViewport?se.visualViewport.width:le[Z];M-=ie-o.width,M*=E?1:-1}}var de=Object.assign({position:_},S&&ILe),ue=C===!0?ALe({x:M,y:U},uu(i)):{x:M,y:U};if(M=ue.x,U=ue.y,E){var pe;return Object.assign({},de,(pe={},pe[oe]=K?"0":"",pe[ne]=J?"0":"",pe.transform=(se.devicePixelRatio||1)<=1?"translate("+M+"px, "+U+"px)":"translate3d("+M+"px, "+U+"px, 0)",pe))}return Object.assign({},de,(e={},e[oe]=K?U+"px":"",e[ne]=J?M+"px":"",e.transform="",e))}function PLe(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,u=i.adaptive,f=u===void 0?!0:u,_=i.roundOffsets,E=_===void 0?!0:_,S={placement:bp(e.placement),variation:x0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,CX(Object.assign({},S,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,CX(Object.assign({},S,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const OLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:PLe,data:{}};var BO={passive:!0};function kLe(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,u=l===void 0?!0:l,f=o.resize,_=f===void 0?!0:f,E=uu(e.elements.popper),S=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&S.forEach(function(C){C.addEventListener("scroll",i.update,BO)}),_&&E.addEventListener("resize",i.update,BO),function(){u&&S.forEach(function(C){C.removeEventListener("scroll",i.update,BO)}),_&&E.removeEventListener("resize",i.update,BO)}}const NLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:kLe,data:{}};var DLe={left:"right",right:"left",bottom:"top",top:"bottom"};function wk(n){return n.replace(/left|right|bottom|top/g,function(e){return DLe[e]})}var xLe={start:"end",end:"start"};function RX(n){return n.replace(/start|end/g,function(e){return xLe[e]})}function p4(n){var e=uu(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function f4(n){return D0(Zg(n)).left+p4(n).scrollLeft}function LLe(n,e){var i=uu(n),o=Zg(n),l=i.visualViewport,u=o.clientWidth,f=o.clientHeight,_=0,E=0;if(l){u=l.width,f=l.height;var S=hre();(S||!S&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:u,height:f,x:_+f4(n),y:E}}function MLe(n){var e,i=Zg(n),o=p4(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=Ky(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=Ky(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-o.scrollLeft+f4(n),E=-o.scrollTop;return tm(l||i).direction==="rtl"&&(_+=Ky(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:f,x:_,y:E}}function m4(n){var e=tm(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function _re(n){return["html","body","#document"].indexOf(Ip(n))>=0?n.ownerDocument.body:rd(n)&&m4(n)?n:_re(o1(n))}function wC(n,e){var i;e===void 0&&(e=[]);var o=_re(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),u=uu(o),f=l?[u].concat(u.visualViewport||[],m4(o)?o:[]):o,_=e.concat(f);return l?_:_.concat(wC(o1(f)))}function GV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function ULe(n,e){var i=D0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function IX(n,e,i){return e===ure?GV(LLe(n,i)):eE(e)?ULe(e,i):GV(MLe(Zg(n)))}function VLe(n){var e=wC(o1(n)),i=["absolute","fixed"].indexOf(tm(n).position)>=0,o=i&&rd(n)?SR(n):n;return eE(o)?e.filter(function(l){return eE(l)&&pre(l,o)&&Ip(l)!=="body"}):[]}function jLe(n,e,i,o){var l=e==="clippingParents"?VLe(n):[].concat(e),u=[].concat(l,[i]),f=u[0],_=u.reduce(function(E,S){var C=IX(n,S,o);return E.top=Ky(C.top,E.top),E.right=sN(C.right,E.right),E.bottom=sN(C.bottom,E.bottom),E.left=Ky(C.left,E.left),E},IX(n,f,o));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function yre(n){var e=n.reference,i=n.element,o=n.placement,l=o?bp(o):null,u=o?x0(o):null,f=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case Cl:E={x:f,y:e.y-i.height};break;case ud:E={x:f,y:e.y+e.height};break;case dd:E={x:e.x+e.width,y:_};break;case Rl:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var S=l?h4(l):null;if(S!=null){var C=S==="y"?"height":"width";switch(u){case k0:E[S]=E[S]-(e[C]/2-i[C]/2);break;case KC:E[S]=E[S]+(e[C]/2-i[C]/2);break}}return E}function qC(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,u=i.strategy,f=u===void 0?n.strategy:u,_=i.boundary,E=_===void 0?sLe:_,S=i.rootBoundary,C=S===void 0?ure:S,I=i.elementContext,O=I===void 0?kw:I,M=i.altBoundary,L=M===void 0?!1:M,U=i.padding,B=U===void 0?0:U,J=mre(typeof B!="number"?B:gre(B,vR)),K=O===kw?oLe:kw,ne=n.rects.popper,oe=n.elements[L?K:O],se=jLe(eE(oe)?oe:oe.contextElement||Zg(n.elements.popper),E,C,f),le=D0(n.elements.reference),Y=yre({reference:le,element:ne,placement:l}),Z=GV(Object.assign({},ne,Y)),X=O===kw?Z:le,ie={top:se.top-X.top+J.top,bottom:X.bottom-se.bottom+J.bottom,left:se.left-X.left+J.left,right:X.right-se.right+J.right},de=n.modifiersData.offset;if(O===kw&&de){var ue=de[l];Object.keys(ie).forEach(function(pe){var ke=[dd,ud].indexOf(pe)>=0?1:-1,xe=[Cl,ud].indexOf(pe)>=0?"y":"x";ie[pe]+=ue[xe]*ke})}return ie}function FLe(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,u=i.rootBoundary,f=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,S=E===void 0?dre:E,C=x0(o),I=C?_?TX:TX.filter(function(L){return x0(L)===C}):vR,O=I.filter(function(L){return S.indexOf(L)>=0});O.length===0&&(O=I);var M=O.reduce(function(L,U){return L[U]=qC(n,{placement:U,boundary:l,rootBoundary:u,padding:f})[bp(U)],L},{});return Object.keys(M).sort(function(L,U){return M[L]-M[U]})}function BLe(n){if(bp(n)===l4)return[];var e=wk(n);return[RX(n),e,RX(e)]}function WLe(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!0:f,E=i.fallbackPlacements,S=i.padding,C=i.boundary,I=i.rootBoundary,O=i.altBoundary,M=i.flipVariations,L=M===void 0?!0:M,U=i.allowedAutoPlacements,B=e.options.placement,J=bp(B),K=J===B,ne=E||(K||!L?[wk(B)]:BLe(B)),oe=[B].concat(ne).reduce(function(Me,We){return Me.concat(bp(We)===l4?FLe(e,{placement:We,boundary:C,rootBoundary:I,padding:S,flipVariations:L,allowedAutoPlacements:U}):We)},[]),se=e.rects.reference,le=e.rects.popper,Y=new Map,Z=!0,X=oe[0],ie=0;ie<oe.length;ie++){var de=oe[ie],ue=bp(de),pe=x0(de)===k0,ke=[Cl,ud].indexOf(ue)>=0,xe=ke?"width":"height",je=qC(e,{placement:de,boundary:C,rootBoundary:I,altBoundary:O,padding:S}),Oe=ke?pe?dd:Rl:pe?ud:Cl;se[xe]>le[xe]&&(Oe=wk(Oe));var we=wk(Oe),Se=[];if(u&&Se.push(je[ue]<=0),_&&Se.push(je[Oe]<=0,je[we]<=0),Se.every(function(Me){return Me})){X=de,Z=!1;break}Y.set(de,Se)}if(Z)for(var Be=L?3:1,Ee=function(We){var He=oe.find(function(qe){var rt=Y.get(qe);if(rt)return rt.slice(0,We).every(function(et){return et})});if(He)return X=He,"break"},Ce=Be;Ce>0;Ce--){var Pe=Ee(Ce);if(Pe==="break")break}e.placement!==X&&(e.modifiersData[o]._skip=!0,e.placement=X,e.reset=!0)}}const zLe={name:"flip",enabled:!0,phase:"main",fn:WLe,requiresIfExists:["offset"],data:{_skip:!1}};function AX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function PX(n){return[Cl,dd,ud,Rl].some(function(e){return n[e]>=0})}function GLe(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,f=qC(e,{elementContext:"reference"}),_=qC(e,{altBoundary:!0}),E=AX(f,o),S=AX(_,l,u),C=PX(E),I=PX(S);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:S,isReferenceHidden:C,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":I})}const HLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:GLe};function $Le(n,e,i){var o=bp(n),l=[Rl,Cl].indexOf(o)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,f=u[0],_=u[1];return f=f||0,_=(_||0)*l,[Rl,dd].indexOf(o)>=0?{x:_,y:f}:{x:f,y:_}}function KLe(n){var e=n.state,i=n.options,o=n.name,l=i.offset,u=l===void 0?[0,0]:l,f=dre.reduce(function(C,I){return C[I]=$Le(I,e.rects,u),C},{}),_=f[e.placement],E=_.x,S=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=S),e.modifiersData[o]=f}const qLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:KLe};function YLe(n){var e=n.state,i=n.name;e.modifiersData[i]=yre({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const XLe={name:"popperOffsets",enabled:!0,phase:"read",fn:YLe,data:{}};function JLe(n){return n==="x"?"y":"x"}function QLe(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!1:f,E=i.boundary,S=i.rootBoundary,C=i.altBoundary,I=i.padding,O=i.tether,M=O===void 0?!0:O,L=i.tetherOffset,U=L===void 0?0:L,B=qC(e,{boundary:E,rootBoundary:S,padding:I,altBoundary:C}),J=bp(e.placement),K=x0(e.placement),ne=!K,oe=h4(J),se=JLe(oe),le=e.modifiersData.popperOffsets,Y=e.rects.reference,Z=e.rects.popper,X=typeof U=="function"?U(Object.assign({},e.rects,{placement:e.placement})):U,ie=typeof X=="number"?{mainAxis:X,altAxis:X}:Object.assign({mainAxis:0,altAxis:0},X),de=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ue={x:0,y:0};if(le){if(u){var pe,ke=oe==="y"?Cl:Rl,xe=oe==="y"?ud:dd,je=oe==="y"?"height":"width",Oe=le[oe],we=Oe+B[ke],Se=Oe-B[xe],Be=M?-Z[je]/2:0,Ee=K===k0?Y[je]:Z[je],Ce=K===k0?-Z[je]:-Y[je],Pe=e.elements.arrow,Me=M&&Pe?d4(Pe):{width:0,height:0},We=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:fre(),He=We[ke],qe=We[xe],rt=TC(0,Y[je],Me[je]),et=ne?Y[je]/2-Be-rt-He-ie.mainAxis:Ee-rt-He-ie.mainAxis,_t=ne?-Y[je]/2+Be+rt+qe+ie.mainAxis:Ce+rt+qe+ie.mainAxis,on=e.elements.arrow&&SR(e.elements.arrow),dt=on?oe==="y"?on.clientTop||0:on.clientLeft||0:0,kt=(pe=de==null?void 0:de[oe])!=null?pe:0,ct=Oe+et-kt-dt,Ut=Oe+_t-kt,fn=TC(M?sN(we,ct):we,Oe,M?Ky(Se,Ut):Se);le[oe]=fn,ue[oe]=fn-Oe}if(_){var Wt,Te=oe==="x"?Cl:Rl,Ve=oe==="x"?ud:dd,$e=le[se],Et=se==="y"?"height":"width",vt=$e+B[Te],St=$e-B[Ve],zt=[Cl,Rl].indexOf(J)!==-1,dn=(Wt=de==null?void 0:de[se])!=null?Wt:0,vn=zt?vt:$e-Y[Et]-Z[Et]-dn+ie.altAxis,nn=zt?$e+Y[Et]+Z[Et]-dn-ie.altAxis:St,Ct=M&&zt?bLe(vn,$e,nn):TC(M?vn:vt,$e,M?nn:St);le[se]=Ct,ue[se]=Ct-$e}e.modifiersData[o]=ue}}const ZLe={name:"preventOverflow",enabled:!0,phase:"main",fn:QLe,requiresIfExists:["offset"]};function eMe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function tMe(n){return n===uu(n)||!rd(n)?p4(n):eMe(n)}function nMe(n){var e=n.getBoundingClientRect(),i=N0(e.width)/n.offsetWidth||1,o=N0(e.height)/n.offsetHeight||1;return i!==1||o!==1}function rMe(n,e,i){i===void 0&&(i=!1);var o=rd(e),l=rd(e)&&nMe(e),u=Zg(e),f=D0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(o||!o&&!i)&&((Ip(e)!=="body"||m4(u))&&(_=tMe(e)),rd(e)?(E=D0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):u&&(E.x=f4(u))),{x:f.left+_.scrollLeft-E.x,y:f.top+_.scrollTop-E.y,width:f.width,height:f.height}}function iMe(n){var e=new Map,i=new Set,o=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var f=[].concat(u.requires||[],u.requiresIfExists||[]);f.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),o.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),o}function sMe(n){var e=iMe(n);return gLe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function oMe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function aMe(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var OX={placement:"bottom",modifiers:[],strategy:"absolute"};function kX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function cMe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?OX:l;return function(_,E,S){S===void 0&&(S=u);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},OX,u),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],O=!1,M={state:C,setOptions:function(J){var K=typeof J=="function"?J(C.options):J;U(),C.options=Object.assign({},u,C.options,K),C.scrollParents={reference:eE(_)?wC(_):_.contextElement?wC(_.contextElement):[],popper:wC(E)};var ne=sMe(aMe([].concat(o,C.options.modifiers)));return C.orderedModifiers=ne.filter(function(oe){return oe.enabled}),L(),M.update()},forceUpdate:function(){if(!O){var J=C.elements,K=J.reference,ne=J.popper;if(kX(K,ne)){C.rects={reference:rMe(K,SR(ne),C.options.strategy==="fixed"),popper:d4(ne)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ie){return C.modifiersData[ie.name]=Object.assign({},ie.data)});for(var oe=0;oe<C.orderedModifiers.length;oe++){if(C.reset===!0){C.reset=!1,oe=-1;continue}var se=C.orderedModifiers[oe],le=se.fn,Y=se.options,Z=Y===void 0?{}:Y,X=se.name;typeof le=="function"&&(C=le({state:C,options:Z,name:X,instance:M})||C)}}}},update:oMe(function(){return new Promise(function(B){M.forceUpdate(),B(C)})}),destroy:function(){U(),O=!0}};if(!kX(_,E))return M;M.setOptions(S).then(function(B){!O&&S.onFirstUpdate&&S.onFirstUpdate(B)});function L(){C.orderedModifiers.forEach(function(B){var J=B.name,K=B.options,ne=K===void 0?{}:K,oe=B.effect;if(typeof oe=="function"){var se=oe({state:C,name:J,instance:M,options:ne}),le=function(){};I.push(se||le)}})}function U(){I.forEach(function(B){return B()}),I=[]}return M}}var lMe=[NLe,XLe,OLe,ELe,qLe,zLe,ZLe,RLe,HLe],uMe=cMe({defaultModifiers:lMe});const xS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),mo={arrowShadowColor:xS("--popper-arrow-shadow-color"),arrowSize:xS("--popper-arrow-size","8px"),arrowSizeHalf:xS("--popper-arrow-size-half"),arrowBg:xS("--popper-arrow-bg"),transformOrigin:xS("--popper-transform-origin"),arrowOffset:xS("--popper-arrow-offset")};function dMe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const hMe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},pMe=n=>hMe[n],NX={scroll:!0,resize:!0};function fMe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...NX,...n}}:e={enabled:n,options:NX},e}const mMe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},gMe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{DX(n)},effect:({state:n})=>()=>{DX(n)}},DX=n=>{n.elements.popper.style.setProperty(mo.transformOrigin.var,pMe(n.placement))},_Me={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{yMe(n)}},yMe=n=>{var i;if(!n.placement)return;const e=EMe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:mo.arrowSize.varRef,height:mo.arrowSize.varRef,zIndex:-1});const o={[mo.arrowSizeHalf.var]:`calc(${mo.arrowSize.varRef} / 2 - 1px)`,[mo.arrowOffset.var]:`calc(${mo.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},EMe=n=>{if(n.startsWith("top"))return{property:"bottom",value:mo.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:mo.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:mo.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:mo.arrowOffset.varRef}},vMe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{xX(n)},effect:({state:n})=>()=>{xX(n)}},xX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=dMe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:mo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},SMe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},bMe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function TMe(n,e="ltr"){var o;const i=((o=SMe[n])==null?void 0:o[e])||n;return e==="ltr"?i:bMe[n]??i}function g4(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:f=!0,offset:_,gutter:E=8,flip:S=!0,boundary:C="clippingParents",preventOverflow:I=!0,matchWidth:O,direction:M="ltr"}=n,L=k.useRef(null),U=k.useRef(null),B=k.useRef(null),J=TMe(o,M),K=k.useRef(()=>{}),ne=k.useCallback(()=>{var ie;!e||!L.current||!U.current||((ie=K.current)==null||ie.call(K),B.current=uMe(L.current,U.current,{placement:J,modifiers:[vMe,_Me,gMe,{...mMe,enabled:!!O},{name:"eventListeners",...fMe(f)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!S,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:C}},...i??[]],strategy:l}),B.current.forceUpdate(),K.current=B.current.destroy)},[J,e,i,O,f,u,_,E,S,I,C,l]);k.useEffect(()=>()=>{var ie;!L.current&&!U.current&&((ie=B.current)==null||ie.destroy(),B.current=null)},[]);const oe=k.useCallback(ie=>{L.current=ie,ne()},[ne]),se=k.useCallback((ie={},de=null)=>({...ie,ref:Hi(oe,de)}),[oe]),le=k.useCallback(ie=>{U.current=ie,ne()},[ne]),Y=k.useCallback((ie={},de=null)=>({...ie,ref:Hi(le,de),style:{...ie.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,le,O]),Z=k.useCallback((ie={},de=null)=>{const{size:ue,shadowColor:pe,bg:ke,style:xe,...je}=ie;return{...je,ref:de,"data-popper-arrow":"",style:wMe(ie)}},[]),X=k.useCallback((ie={},de=null)=>({...ie,ref:de,"data-popper-arrow-inner":""}),[]);return{update(){var ie;(ie=B.current)==null||ie.update()},forceUpdate(){var ie;(ie=B.current)==null||ie.forceUpdate()},transformOrigin:mo.transformOrigin.varRef,referenceRef:oe,popperRef:le,getPopperProps:Y,getArrowProps:Z,getArrowInnerProps:X,getReferenceProps:se}}function wMe(n){const{size:e,shadowColor:i,bg:o,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),o&&(u["--popper-arrow-bg"]=o),u}function CMe(){const n=k.useRef(new Map),e=n.current,i=k.useCallback((l,u,f,_)=>{n.current.set(f,{type:u,el:l,options:_}),l.addEventListener(u,f,_)},[]),o=k.useCallback((l,u,f,_)=>{l.removeEventListener(u,f,_),n.current.delete(f)},[]);return k.useEffect(()=>()=>{e.forEach((l,u)=>{o(l.el,l.type,u,l.options)})},[o,e]),{add:i,remove:o}}function wU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function Ere(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:f,onMouseUp:_,onClick:E,onKeyDown:S,onKeyUp:C,tabIndex:I,onMouseOver:O,onMouseLeave:M,...L}=n,[U,B]=k.useState(!0),[J,K]=k.useState(!1),ne=CMe(),oe=Oe=>{Oe&&Oe.tagName!=="BUTTON"&&B(!1)},se=U?I:I||0,le=i&&!o,Y=k.useCallback(Oe=>{if(i){Oe.stopPropagation(),Oe.preventDefault();return}Oe.currentTarget.focus(),E==null||E(Oe)},[i,E]),Z=k.useCallback(Oe=>{J&&wU(Oe)&&(Oe.preventDefault(),Oe.stopPropagation(),K(!1),ne.remove(document,"keyup",Z,!1))},[J,ne]),X=k.useCallback(Oe=>{if(S==null||S(Oe),i||Oe.defaultPrevented||Oe.metaKey||!wU(Oe.nativeEvent)||U)return;const we=l&&Oe.key==="Enter";u&&Oe.key===" "&&(Oe.preventDefault(),K(!0)),we&&(Oe.preventDefault(),Oe.currentTarget.click()),ne.add(document,"keyup",Z,!1)},[i,U,S,l,u,ne,Z]),ie=k.useCallback(Oe=>{if(C==null||C(Oe),i||Oe.defaultPrevented||Oe.metaKey||!wU(Oe.nativeEvent)||U)return;u&&Oe.key===" "&&(Oe.preventDefault(),K(!1),Oe.currentTarget.click())},[u,U,i,C]),de=k.useCallback(Oe=>{Oe.button===0&&(K(!1),ne.remove(document,"mouseup",de,!1))},[ne]),ue=k.useCallback(Oe=>{if(Oe.button!==0)return;if(i){Oe.stopPropagation(),Oe.preventDefault();return}U||K(!0),Oe.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",de,!1),f==null||f(Oe)},[i,U,f,ne,de]),pe=k.useCallback(Oe=>{Oe.button===0&&(U||K(!1),_==null||_(Oe))},[_,U]),ke=k.useCallback(Oe=>{if(i){Oe.preventDefault();return}O==null||O(Oe)},[i,O]),xe=k.useCallback(Oe=>{J&&(Oe.preventDefault(),K(!1)),M==null||M(Oe)},[J,M]),je=Hi(e,oe);return U?{...L,ref:je,type:"button","aria-disabled":le?void 0:i,disabled:le,onClick:Y,onMouseDown:f,onMouseUp:_,onKeyUp:C,onKeyDown:S,onMouseOver:O,onMouseLeave:M}:{...L,ref:je,role:"button","data-active":rr(J),"aria-disabled":i?"true":void 0,tabIndex:le?void 0:se,onClick:Y,onMouseDown:ue,onMouseUp:pe,onKeyUp:ie,onKeyDown:X,onMouseOver:ke,onMouseLeave:xe}}const[RMe,IMe,AMe,PMe]=yne(),[OMe,bR]=Ai({strict:!1,name:"MenuContext"});function vre(n){return(n==null?void 0:n.ownerDocument)??document}function kMe(n){return vre(n).activeElement===n}function NMe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:f,isOpen:_,defaultIsOpen:E,onClose:S,onOpen:C,placement:I="bottom-start",lazyBehavior:O="unmount",direction:M,computePositionOnMount:L=!1,...U}=n,B=k.useRef(null),J=k.useRef(null),K=k.useRef(!0),ne=AMe(),oe=k.useCallback(()=>{requestAnimationFrame(()=>{var Pe;(Pe=B.current)==null||Pe.focus({preventScroll:!1})})},[]),se=k.useCallback(()=>{const Pe=setTimeout(()=>{var Me,We;if(l)(Me=l.current)==null||Me.focus();else if(!ne.count())(We=B.current)==null||We.focus({preventScroll:!1});else{const He=ne.firstEnabled();He&&ke(He.index)}});Se.current.add(Pe)},[ne,l]),le=k.useCallback(()=>{const Pe=setTimeout(()=>{var Me;if(!ne.count())(Me=B.current)==null||Me.focus({preventScroll:!1});else{const We=ne.lastEnabled();We&&ke(We.index)}});Se.current.add(Pe)},[ne]),Y=k.useCallback(()=>{C==null||C(),u?se():oe()},[u,se,oe,C]),{isOpen:Z,onOpen:X,onClose:ie,onToggle:de}=ld({isOpen:_,defaultIsOpen:E,onClose:S,onOpen:Y});XZ({enabled:Z&&o,ref:B,handler:Pe=>{var We,He,qe;const Me=((He=(We=Pe.composedPath)==null?void 0:We.call(Pe))==null?void 0:He[0])??Pe.target;(qe=J.current)!=null&&qe.contains(Me)||ie()}});const ue=g4({...U,enabled:Z||L,placement:I,direction:M}),[pe,ke]=k.useState(-1);KZ(B,{focusRef:J,visible:Z,shouldFocus:!0});const xe=GZ({isOpen:Z,ref:B}),[je,Oe]=xve(e,"menu-button","menu-list"),we=k.useCallback(()=>{X(),oe()},[X,oe]),Se=k.useRef(new Set([]));k.useEffect(()=>{const Pe=Se.current;return()=>{Pe.forEach(Me=>clearTimeout(Me)),Pe.clear()}},[]),Qf(()=>{var Pe;Z||(ke(-1),(Pe=B.current)==null||Pe.scrollTo(0,0))},[Z]),Qf(()=>{Z&&pe===-1&&oe()},[pe,Z]),k.useEffect(()=>{var Me;if(!Z)return;const Pe=ne.item(pe);(Me=Pe==null?void 0:Pe.node)==null||Me.focus({preventScroll:!K.current})},[ne,pe,Z]);const Be=k.useCallback(()=>{X(),se()},[se,X]),Ee=k.useCallback(()=>{K.current=!0,X(),le()},[X,le]),Ce=k.useCallback(()=>{var qe,rt;const Pe=vre(B.current),Me=(qe=B.current)==null?void 0:qe.contains(Pe.activeElement);if(!(Z&&!Me))return;const He=(rt=ne.item(pe))==null?void 0:rt.node;He==null||He.focus({preventScroll:!K.current})},[Z,pe,ne]);return{openAndFocusMenu:we,openAndFocusFirstItem:Be,openAndFocusLastItem:Ee,onTransitionEnd:Ce,unstable__animationState:xe,descendants:ne,popper:ue,buttonId:je,menuId:Oe,forceUpdate:ue.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:de,onOpen:X,onClose:ie,menuRef:B,buttonRef:J,focusedIndex:pe,closeOnSelect:i,closeOnBlur:o,autoSelect:u,setFocusedIndex:ke,isLazy:f,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:K}}function DMe(n={},e=null){const i=bR(),{onToggle:o,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:f,scrollIntoViewRef:_}=i,E=k.useCallback(S=>{const C=S.key,O={Enter:u,ArrowDown:u,ArrowUp:f}[C];O&&(_.current=!0,S.preventDefault(),S.stopPropagation(),O(S))},[u,f,_]);return{...n,ref:Hi(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":rr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Dn(n.onClick,o),onKeyDown:Dn(n.onKeyDown,E)}}function HV(n){var e;return UMe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function xMe(n={},e=null){const i=bR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:u,isOpen:f,onClose:_,menuId:E,isLazy:S,lazyBehavior:C,scrollIntoViewRef:I,unstable__animationState:O}=i,M=IMe(),L=iLe({preventDefault:K=>K.key!==" "&&HV(K.target)}),U=k.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ne=K.key,se={Tab:Y=>Y.preventDefault(),Escape:Y=>{Y.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const Y=M.nextEnabled(o)??M.firstEnabled();Y&&l(Y.index)},ArrowUp:()=>{I.current=!0;const Y=M.prevEnabled(o)??M.firstEnabled();Y&&l(Y.index)}}[ne];if(se){K.preventDefault(),se(K);return}const le=L(Y=>{const Z=nLe(M.values(),Y,X=>{var ie;return((ie=X==null?void 0:X.node)==null?void 0:ie.textContent)??""},M.item(o));if(Z){const X=M.indexOf(Z.node);l(X)}});HV(K.target)&&le(K)},[M,o,L,_,l,I]),B=k.useRef(!1);f&&(B.current=!0);const J=Fj({wasSelected:B.current,enabled:S,mode:C,isSelected:O.present});return{...n,ref:Hi(u,e),children:J?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Dn(n.onKeyDown,U)}}function LMe(n={}){const{popper:e,isOpen:i}=bR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function MMe(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:u,onFocus:f,isDisabled:_,isFocusable:E,closeOnSelect:S,type:C,...I}=n,O=bR(),{setFocusedIndex:M,focusedIndex:L,closeOnSelect:U,onClose:B,menuId:J,scrollIntoViewRef:K}=O,ne=k.useRef(null),oe=`${J}-menuitem-${k.useId()}`,{index:se,register:le}=PMe({disabled:_&&!E}),Y=k.useCallback(ke=>{i==null||i(ke),!_&&(K.current=!1,M(se))},[M,se,_,i,K]),Z=k.useCallback(ke=>{o==null||o(ke),ne.current&&!kMe(ne.current)&&Y(ke)},[Y,o]),X=k.useCallback(ke=>{l==null||l(ke),!_&&M(-1)},[M,_,l]),ie=k.useCallback(ke=>{u==null||u(ke),HV(ke.currentTarget)&&(S??U)&&B()},[B,u,U,S]),de=k.useCallback(ke=>{f==null||f(ke),M(se)},[M,f,se]),ue=se===L,pe=Ere({onClick:ie,onFocus:de,onMouseEnter:Y,onMouseMove:Z,onMouseLeave:X,ref:Hi(le,ne,e),isDisabled:_,isFocusable:E});return{...I,...pe,type:C??pe.type,id:oe,role:"menuitem",tabIndex:ue?0:-1}}function UMe(n){if(!VMe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function VMe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[jMe,TR]=Ai({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),wR=n=>{const{children:e}=n,i=Ma("Menu",n),o=Vi(n),{direction:l}=eb(),{descendants:u,...f}=NMe({...o,direction:l}),_=k.useMemo(()=>f,[f]),{isOpen:E,onClose:S,forceUpdate:C}=_;return b.jsx(RMe,{value:u,children:b.jsx(OMe,{value:_,children:b.jsx(jMe,{value:i,children:bl(e,{isOpen:E,onClose:S,forceUpdate:C})})})})};wR.displayName="Menu";const FMe=Ft((n,e)=>{const i=TR();return b.jsx(Mt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),CR=Ft((n,e)=>{const{children:i,as:o,...l}=n,u=DMe(l,e),f=o||FMe;return b.jsx(f,{...u,className:gn("chakra-menu__menu-button",n.className),children:b.jsx(Mt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});CR.displayName="MenuButton";const Sre=Ft((n,e)=>{const i=TR();return b.jsx(Mt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});Sre.displayName="MenuCommand";const bre=n=>{const{className:e,children:i,...o}=n,l=TR(),u=k.Children.only(i),f=k.isValidElement(u)?k.cloneElement(u,{focusable:"false","aria-hidden":!0,className:gn("chakra-menu__icon",u.props.className)}):null,_=gn("chakra-menu__icon-wrapper",e);return b.jsx(Mt.span,{className:_,...o,__css:l.icon,children:f})};bre.displayName="MenuIcon";const BMe=Ft((n,e)=>{const{type:i,...o}=n,l=TR(),u=o.as||i?i??void 0:"button",f=k.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return b.jsx(Mt.button,{ref:e,type:u,...o,__css:f})}),dp=Ft((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:u="0.75rem",children:f,..._}=n,E=MMe(_,e),C=i||l?b.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return b.jsxs(BMe,{...E,className:gn("chakra-menu__menuitem",E.className),children:[i&&b.jsx(bre,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&b.jsx(Sre,{marginStart:u,children:l})]})});dp.displayName="MenuItem";const WMe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},zMe=Mt(Pp.div),RR=Ft(function(e,i){var O;const{rootProps:o,motionProps:l,...u}=e,{isOpen:f,onTransitionEnd:_,unstable__animationState:E}=bR(),S=xMe(u,i),C=LMe(o),I=TR();return b.jsx(Mt.div,{...C,__css:{zIndex:e.zIndex??((O=I.list)==null?void 0:O.zIndex)},children:b.jsx(zMe,{variants:WMe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...S,className:gn("chakra-menu__menu-list",S.className),onUpdate:_,onAnimationComplete:VZ(E.onComplete,S.onAnimationComplete)})})});RR.displayName="MenuList";var GMe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},LS=new WeakMap,WO=new WeakMap,zO={},CU=0,Tre=function(n){return n&&(n.host||Tre(n.parentNode))},HMe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=Tre(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},$Me=function(n,e,i,o){var l=HMe(e,Array.isArray(n)?n:[n]);zO[i]||(zO[i]=new WeakMap);var u=zO[i],f=[],_=new Set,E=new Set(l),S=function(I){!I||_.has(I)||(_.add(I),S(I.parentNode))};l.forEach(S);var C=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(O){if(_.has(O))C(O);else try{var M=O.getAttribute(o),L=M!==null&&M!=="false",U=(LS.get(O)||0)+1,B=(u.get(O)||0)+1;LS.set(O,U),u.set(O,B),f.push(O),U===1&&L&&WO.set(O,!0),B===1&&O.setAttribute(i,"true"),L||O.setAttribute(o,"true")}catch(J){console.error("aria-hidden: cannot operate on ",O,J)}})};return C(e),_.clear(),CU++,function(){f.forEach(function(I){var O=LS.get(I)-1,M=u.get(I)-1;LS.set(I,O),u.set(I,M),O||(WO.has(I)||I.removeAttribute(o),WO.delete(I)),M||I.removeAttribute(i)}),CU--,CU||(LS=new WeakMap,LS=new WeakMap,WO=new WeakMap,zO={})}},KMe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=GMe(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live]"))),$Me(o,l,i,"aria-hidden")):function(){return null}},qMe=Object.defineProperty,YMe=(n,e,i)=>e in n?qMe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,XMe=(n,e,i)=>(YMe(n,e+"",i),i);class JMe{constructor(){XMe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const $V=new JMe;function wre(n,e){const[i,o]=k.useState(0);return k.useEffect(()=>{const l=n.current;if(l){if(e){const u=$V.add(l);o(u)}return()=>{$V.remove(l),o(0)}}},[e,n]),i}function QMe(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:f=!0,onOverlayClick:_,onEsc:E}=n,S=k.useRef(null),C=k.useRef(null),[I,O,M]=e2e(o,"chakra-modal","chakra-modal--header","chakra-modal--body");ZMe(S,e&&f);const L=wre(S,e),U=k.useRef(null),B=k.useCallback(X=>{U.current=X.target},[]),J=k.useCallback(X=>{X.key==="Escape"&&(X.stopPropagation(),u&&(i==null||i()),E==null||E())},[u,i,E]),[K,ne]=k.useState(!1),[oe,se]=k.useState(!1),le=k.useCallback((X={},ie=null)=>({role:"dialog",...X,ref:Hi(ie,S),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?O:void 0,"aria-describedby":oe?M:void 0,onClick:Dn(X.onClick,de=>de.stopPropagation())}),[M,oe,I,O,K]),Y=k.useCallback(X=>{X.stopPropagation(),U.current===X.target&&$V.isTopModal(S.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),Z=k.useCallback((X={},ie=null)=>({...X,ref:Hi(ie,C),onClick:Dn(X.onClick,Y),onKeyDown:Dn(X.onKeyDown,J),onMouseDown:Dn(X.onMouseDown,B)}),[J,B,Y]);return{isOpen:e,onClose:i,headerId:O,bodyId:M,setBodyMounted:se,setHeaderMounted:ne,dialogRef:S,overlayRef:C,getDialogProps:le,getDialogContainerProps:Z,index:L}}function ZMe(n,e){const i=n.current;k.useEffect(()=>{if(!(!n.current||!e))return KMe(n.current)},[e,n,i])}function e2e(n,...e){const i=k.useId(),o=n||i;return k.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[t2e,nb]=Ai({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[n2e,tE]=Ai({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),as=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:o,autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:S,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:M,animatePresenceProps:L,onCloseComplete:U}=e,B=Ma("Modal",e),K={...QMe(e),autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:S,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:M};return b.jsx(n2e,{value:K,children:b.jsx(t2e,{value:B,children:b.jsx(J0,{...L,onExitComplete:U,children:K.isOpen&&b.jsx(hu,{...i,children:o})})})})};as.displayName="Modal";var Ck="right-scroll-bar-position",Rk="width-before-scroll-bar",r2e="with-scroll-bars-hidden",i2e="--removed-body-scroll-bar-size",Cre=One(),RU=function(){},a1=k.forwardRef(function(n,e){var i=k.useRef(null),o=k.useState({onScrollCapture:RU,onWheelCapture:RU,onTouchMoveCapture:RU}),l=o[0],u=o[1],f=n.forwardProps,_=n.children,E=n.className,S=n.removeScrollBar,C=n.enabled,I=n.shards,O=n.sideCar,M=n.noIsolation,L=n.inert,U=n.allowPinchZoom,B=n.as,J=B===void 0?"div":B,K=n.gapMode,ne=ER(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),oe=O,se=Ine([i,e]),le=up(up({},ne),l);return k.createElement(k.Fragment,null,C&&k.createElement(oe,{sideCar:Cre,removeScrollBar:S,shards:I,noIsolation:M,inert:L,setCallbacks:u,allowPinchZoom:!!U,lockRef:i,gapMode:K}),f?k.cloneElement(k.Children.only(_),up(up({},le),{ref:se})):k.createElement(J,up({},le,{className:E,ref:se}),_))});a1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};a1.classNames={fullWidth:Rk,zeroRight:Ck};var s2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function o2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=s2e();return e&&n.setAttribute("nonce",e),n}function a2e(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function c2e(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var l2e=function(){var n=0,e=null;return{add:function(i){n==0&&(e=o2e())&&(a2e(e,i),c2e(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},u2e=function(){var n=l2e();return function(e,i){k.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},Rre=function(){var n=u2e(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},d2e={left:0,top:0,right:0,gap:0},IU=function(n){return parseInt(n||"",10)||0},h2e=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[IU(i),IU(o),IU(l)]},p2e=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return d2e;var e=h2e(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},f2e=Rre(),m0="data-scroll-locked",m2e=function(n,e,i,o){var l=n.left,u=n.top,f=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(r2e,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(_,"px ").concat(o,`;
  }
  body[`).concat(m0,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Ck,` {
    right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(Rk,` {
    margin-right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(Ck," .").concat(Ck,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(Rk," .").concat(Rk,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(m0,`] {
    `).concat(i2e,": ").concat(_,`px;
  }
`)},LX=function(){var n=parseInt(document.body.getAttribute(m0)||"0",10);return isFinite(n)?n:0},g2e=function(){k.useEffect(function(){return document.body.setAttribute(m0,(LX()+1).toString()),function(){var n=LX()-1;n<=0?document.body.removeAttribute(m0):document.body.setAttribute(m0,n.toString())}},[])},_2e=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;g2e();var u=k.useMemo(function(){return p2e(l)},[l]);return k.createElement(f2e,{styles:m2e(u,!e,l,i?"":"!important")})},KV=!1;if(typeof window<"u")try{var GO=Object.defineProperty({},"passive",{get:function(){return KV=!0,!0}});window.addEventListener("test",GO,GO),window.removeEventListener("test",GO,GO)}catch{KV=!1}var MS=KV?{passive:!1}:!1,y2e=function(n){return n.tagName==="TEXTAREA"},Ire=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!y2e(n)&&i[e]==="visible")},E2e=function(n){return Ire(n,"overflowY")},v2e=function(n){return Ire(n,"overflowX")},MX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=Are(n,o);if(l){var u=Pre(n,o),f=u[1],_=u[2];if(f>_)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},S2e=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},b2e=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},Are=function(n,e){return n==="v"?E2e(e):v2e(e)},Pre=function(n,e){return n==="v"?S2e(e):b2e(e)},T2e=function(n,e){return n==="h"&&e==="rtl"?-1:1},w2e=function(n,e,i,o,l){var u=T2e(n,window.getComputedStyle(e).direction),f=u*o,_=i.target,E=e.contains(_),S=!1,C=f>0,I=0,O=0;do{var M=Pre(n,_),L=M[0],U=M[1],B=M[2],J=U-B-u*L;(L||J)&&Are(n,_)&&(I+=J,O+=L),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(C&&Math.abs(I)<1||!C&&Math.abs(O)<1)&&(S=!0),S},HO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},UX=function(n){return[n.deltaX,n.deltaY]},VX=function(n){return n&&"current"in n?n.current:n},C2e=function(n,e){return n[0]===e[0]&&n[1]===e[1]},R2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},I2e=0,US=[];function A2e(n){var e=k.useRef([]),i=k.useRef([0,0]),o=k.useRef(),l=k.useState(I2e++)[0],u=k.useState(Rre)[0],f=k.useRef(n);k.useEffect(function(){f.current=n},[n]),k.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var U=ODe([n.lockRef.current],(n.shards||[]).map(VX),!0).filter(Boolean);return U.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),U.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=k.useCallback(function(U,B){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!f.current.allowPinchZoom;var J=HO(U),K=i.current,ne="deltaX"in U?U.deltaX:K[0]-J[0],oe="deltaY"in U?U.deltaY:K[1]-J[1],se,le=U.target,Y=Math.abs(ne)>Math.abs(oe)?"h":"v";if("touches"in U&&Y==="h"&&le.type==="range")return!1;var Z=MX(Y,le);if(!Z)return!0;if(Z?se=Y:(se=Y==="v"?"h":"v",Z=MX(Y,le)),!Z)return!1;if(!o.current&&"changedTouches"in U&&(ne||oe)&&(o.current=se),!se)return!0;var X=o.current||se;return w2e(X,B,U,X==="h"?ne:oe)},[]),E=k.useCallback(function(U){var B=U;if(!(!US.length||US[US.length-1]!==u)){var J="deltaY"in B?UX(B):HO(B),K=e.current.filter(function(se){return se.name===B.type&&(se.target===B.target||B.target===se.shadowParent)&&C2e(se.delta,J)})[0];if(K&&K.should){B.cancelable&&B.preventDefault();return}if(!K){var ne=(f.current.shards||[]).map(VX).filter(Boolean).filter(function(se){return se.contains(B.target)}),oe=ne.length>0?_(B,ne[0]):!f.current.noIsolation;oe&&B.cancelable&&B.preventDefault()}}},[]),S=k.useCallback(function(U,B,J,K){var ne={name:U,delta:B,target:J,should:K,shadowParent:P2e(J)};e.current.push(ne),setTimeout(function(){e.current=e.current.filter(function(oe){return oe!==ne})},1)},[]),C=k.useCallback(function(U){i.current=HO(U),o.current=void 0},[]),I=k.useCallback(function(U){S(U.type,UX(U),U.target,_(U,n.lockRef.current))},[]),O=k.useCallback(function(U){S(U.type,HO(U),U.target,_(U,n.lockRef.current))},[]);k.useEffect(function(){return US.push(u),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:O}),document.addEventListener("wheel",E,MS),document.addEventListener("touchmove",E,MS),document.addEventListener("touchstart",C,MS),function(){US=US.filter(function(U){return U!==u}),document.removeEventListener("wheel",E,MS),document.removeEventListener("touchmove",E,MS),document.removeEventListener("touchstart",C,MS)}},[]);var M=n.removeScrollBar,L=n.inert;return k.createElement(k.Fragment,null,L?k.createElement(u,{styles:R2e(l)}):null,M?k.createElement(_2e,{gapMode:n.gapMode}):null)}function P2e(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const O2e=kDe(Cre,A2e);var Ore=k.forwardRef(function(n,e){return k.createElement(a1,up({},n,{ref:e,sideCar:O2e}))});Ore.classNames=a1.classNames;function k2e(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:f,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:S,lockFocusAcrossFrames:C,isOpen:I}=tE(),[O,M]=lF();k.useEffect(()=>{!O&&M&&setTimeout(M)},[O,M]);const L=wre(o,I);return b.jsx(rre,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:o,lockFocusAcrossFrames:C,children:b.jsx(Ore,{removeScrollBar:!S,allowPinchZoom:f,enabled:L===1&&u,forwardProps:!0,children:n.children})})}const N2e={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Gy.exit(zy.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Gy.enter(zy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:u})=>{const f={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Gy.exit(zy.exit,u),...l?{...f,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...f,...o==null?void 0:o.exit}}}}},nC={initial:"initial",animate:"enter",exit:"exit",variants:N2e},D2e=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,className:f,offsetX:_=0,offsetY:E=8,transition:S,transitionEnd:C,delay:I,animatePresenceProps:O,...M}=e,L=o?l&&o:!0,U=l||o?"enter":"exit",B={offsetX:_,offsetY:E,reverse:u,transition:S,transitionEnd:C,delay:I};return b.jsx(J0,{...O,custom:B,children:L&&b.jsx(Pp.div,{ref:i,className:gn("chakra-offset-slide",f),custom:B,...nC,animate:U,...M})})});D2e.displayName="SlideFade";const x2e={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??Gy.exit(zy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Gy.enter(zy.enter,i),transitionEnd:n==null?void 0:n.enter})},kre={initial:"exit",animate:"enter",exit:"exit",variants:x2e},L2e=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,initialScale:f=.95,className:_,transition:E,transitionEnd:S,delay:C,animatePresenceProps:I,...O}=e,M=o?l&&o:!0,L=l||o?"enter":"exit",U={initialScale:f,reverse:u,transition:E,transitionEnd:S,delay:C};return b.jsx(J0,{...I,custom:U,children:M&&b.jsx(Pp.div,{ref:i,className:gn("chakra-offset-slide",_),...kre,animate:L,custom:U,...O})})});L2e.displayName="ScaleFade";const M2e={slideInBottom:{...nC,custom:{offsetY:16,reverse:!0}},slideInRight:{...nC,custom:{offsetX:16,reverse:!0}},slideInTop:{...nC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...nC,custom:{offsetX:-16,reverse:!0}},scale:{...kre,custom:{initialScale:.95,reverse:!0}},none:{}},U2e=Mt(Pp.section),V2e=n=>M2e[n||"none"],Nre=k.forwardRef((n,e)=>{const{preset:i,motionProps:o=V2e(i),...l}=n;return b.jsx(U2e,{ref:e,...o,...l})});Nre.displayName="ModalTransition";const cs=Ft((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:u,...f}=n,{getDialogProps:_,getDialogContainerProps:E}=tE(),S=_(f,e),C=E(l),I=gn("chakra-modal__content",i),O=nb(),M={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},L={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:U}=tE();return b.jsx(k2e,{children:b.jsx(Mt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:L,children:b.jsx(Nre,{preset:U,motionProps:u,className:I,...S,__css:M,children:o})})})});cs.displayName="ModalContent";const Es=Ft((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:u}=tE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=gn("chakra-modal__body",i),_=nb();return b.jsx(Mt.div,{ref:e,className:f,id:l,...o,__css:_.body})});Es.displayName="ModalBody";const Rs=Ft((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:u}=tE(),f=gn("chakra-modal__close-btn",o),_=nb();return b.jsx(zF,{ref:e,__css:_.closeButton,className:f,onClick:Dn(i,E=>{E.stopPropagation(),u()}),...l})});Rs.displayName="ModalCloseButton";const oh=Ft((n,e)=>{const{className:i,...o}=n,l=gn("chakra-modal__footer",i),u=nb(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return b.jsx(Mt.footer,{ref:e,...o,__css:f,className:l})});oh.displayName="ModalFooter";const so=Ft((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:u}=tE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=gn("chakra-modal__header",i),_=nb(),E={flex:0,..._.header};return b.jsx(Mt.header,{ref:e,className:f,id:l,...o,__css:E})});so.displayName="ModalHeader";const j2e={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Gy.enter(zy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Gy.exit(zy.exit,i),transitionEnd:e==null?void 0:e.exit})},Dre={initial:"exit",animate:"enter",exit:"exit",variants:j2e},F2e=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:u,transition:f,transitionEnd:_,delay:E,animatePresenceProps:S,...C}=e,I=l||o?"enter":"exit",O=o?l&&o:!0,M={transition:f,transitionEnd:_,delay:E};return b.jsx(J0,{...S,custom:M,children:O&&b.jsx(Pp.div,{ref:i,className:gn("chakra-fade",u),custom:M,...Dre,animate:I,...C})})});F2e.displayName="Fade";const B2e=Mt(Pp.div),ls=Ft((n,e)=>{const{className:i,transition:o,motionProps:l,...u}=n,f=gn("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...nb().overlay},{motionPreset:S}=tE(),I=l||(S==="none"?{}:Dre);return b.jsx(B2e,{...I,__css:E,ref:e,className:f,...u})});ls.displayName="ModalOverlay";function W2e(n){const{leastDestructiveRef:e,...i}=n;return b.jsx(as,{...i,initialFocusRef:e})}const z2e=Ft((n,e)=>b.jsx(cs,{ref:e,role:"alertdialog",...n})),G2e=n=>b.jsx(mn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),H2e=n=>b.jsx(mn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function jX(n,e,i,o){k.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],f=new l.MutationObserver(_=>{for(const E of _)E.type==="attributes"&&E.attributeName&&u.includes(E.attributeName)&&i(E)});return f.observe(n.current,{attributes:!0,attributeFilter:u}),()=>f.disconnect()})}const $2e=50,FX=300;function K2e(n,e){const[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,_]=k.useState(!0),E=k.useRef(null),S=()=>clearTimeout(E.current);Lve(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?$2e:null);const C=k.useCallback(()=>{f&&n(),E.current=setTimeout(()=>{_(!1),o(!0),u("increment")},FX)},[n,f]),I=k.useCallback(()=>{f&&e(),E.current=setTimeout(()=>{_(!1),o(!0),u("decrement")},FX)},[e,f]),O=k.useCallback(()=>{_(!0),o(!1),S()},[]);return k.useEffect(()=>()=>S(),[]),{up:C,down:I,stop:O,isSpinning:i}}const q2e=/^[Ee0-9+\-.]$/;function Y2e(n){return q2e.test(n)}function X2e(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function J2e(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:_,isDisabled:E,isRequired:S,isInvalid:C,pattern:I="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:M,id:L,onChange:U,precision:B,name:J,"aria-describedby":K,"aria-label":ne,"aria-labelledby":oe,onFocus:se,onBlur:le,onInvalid:Y,getAriaValueText:Z,isValidCharacter:X,format:ie,parse:de,...ue}=n,pe=no(se),ke=no(le),xe=no(Y),je=no(X??Y2e),Oe=no(Z),we=Sve(n),{update:Se,increment:Be,decrement:Ee}=we,[Ce,Pe]=k.useState(!1),Me=!(_||E),We=k.useRef(null),He=k.useRef(null),qe=k.useRef(null),rt=k.useRef(null),et=k.useCallback(Ct=>Ct.split("").filter(je).join(""),[je]),_t=k.useCallback(Ct=>(de==null?void 0:de(Ct))??Ct,[de]),on=k.useCallback(Ct=>((ie==null?void 0:ie(Ct))??Ct).toString(),[ie]);Qf(()=>{(we.valueAsNumber>u||we.valueAsNumber<l)&&(xe==null||xe("rangeOverflow",on(we.value),we.valueAsNumber))},[we.valueAsNumber,we.value,on,xe]),_p(()=>{if(!We.current)return;if(We.current.value!=we.value){const sr=_t(We.current.value);we.setValue(et(sr))}},[_t,et]);const dt=k.useCallback((Ct=f)=>{Me&&Be(Ct)},[Be,Me,f]),kt=k.useCallback((Ct=f)=>{Me&&Ee(Ct)},[Ee,Me,f]),ct=K2e(dt,kt);jX(qe,"disabled",ct.stop,ct.isSpinning),jX(rt,"disabled",ct.stop,ct.isSpinning);const Ut=k.useCallback(Ct=>{if(Ct.nativeEvent.isComposing)return;const xt=_t(Ct.currentTarget.value);Se(et(xt)),He.current={start:Ct.currentTarget.selectionStart,end:Ct.currentTarget.selectionEnd}},[Se,et,_t]),fn=k.useCallback(Ct=>{var sr;pe==null||pe(Ct),He.current&&(Ct.currentTarget.selectionStart=He.current.start??((sr=Ct.currentTarget.value)==null?void 0:sr.length),Ct.currentTarget.selectionEnd=He.current.end??Ct.currentTarget.selectionStart)},[pe]),Wt=k.useCallback(Ct=>{if(Ct.nativeEvent.isComposing)return;X2e(Ct,je)||Ct.preventDefault();const sr=Te(Ct)*f,xt=Ct.key,Tr={ArrowUp:()=>dt(sr),ArrowDown:()=>kt(sr),Home:()=>Se(l),End:()=>Se(u)}[xt];Tr&&(Ct.preventDefault(),Tr(Ct))},[je,f,dt,kt,Se,l,u]),Te=Ct=>{let sr=1;return(Ct.metaKey||Ct.ctrlKey)&&(sr=.1),Ct.shiftKey&&(sr=10),sr},Ve=k.useMemo(()=>{const Ct=Oe==null?void 0:Oe(we.value);if(Ct!=null)return Ct;const sr=we.value.toString();return sr||void 0},[we.value,Oe]),$e=k.useCallback(()=>{let Ct=we.value;if(we.value==="")return;/^[eE]/.test(we.value.toString())?we.setValue(""):(we.valueAsNumber<l&&(Ct=l),we.valueAsNumber>u&&(Ct=u),we.cast(Ct))},[we,u,l]),Et=k.useCallback(()=>{Pe(!1),i&&$e()},[i,Pe,$e]),vt=k.useCallback(()=>{e&&requestAnimationFrame(()=>{var Ct;(Ct=We.current)==null||Ct.focus()})},[e]),St=k.useCallback(Ct=>{Ct.preventDefault(),ct.up(),vt()},[vt,ct]),zt=k.useCallback(Ct=>{Ct.preventDefault(),ct.down(),vt()},[vt,ct]);Vy(()=>We.current,"wheel",Ct=>{var Pi;const xt=(((Pi=We.current)==null?void 0:Pi.ownerDocument)??document).activeElement===We.current;if(!M||!xt)return;Ct.preventDefault();const qt=Te(Ct)*f,Tr=Math.sign(Ct.deltaY);Tr===-1?dt(qt):Tr===1&&kt(qt)},{passive:!1});const dn=k.useCallback((Ct={},sr=null)=>{const xt=E||o&&we.isAtMax;return{...Ct,ref:Hi(sr,qe),role:"button",tabIndex:-1,onPointerDown:Dn(Ct.onPointerDown,qt=>{qt.button!==0||xt||St(qt)}),onPointerLeave:Dn(Ct.onPointerLeave,ct.stop),onPointerUp:Dn(Ct.onPointerUp,ct.stop),disabled:xt,"aria-disabled":Bf(xt)}},[we.isAtMax,o,St,ct.stop,E]),vn=k.useCallback((Ct={},sr=null)=>{const xt=E||o&&we.isAtMin;return{...Ct,ref:Hi(sr,rt),role:"button",tabIndex:-1,onPointerDown:Dn(Ct.onPointerDown,qt=>{qt.button!==0||xt||zt(qt)}),onPointerLeave:Dn(Ct.onPointerLeave,ct.stop),onPointerUp:Dn(Ct.onPointerUp,ct.stop),disabled:xt,"aria-disabled":Bf(xt)}},[we.isAtMin,o,zt,ct.stop,E]),nn=k.useCallback((Ct={},sr=null)=>({name:J,inputMode:O,type:"text",pattern:I,"aria-labelledby":oe,"aria-label":ne,"aria-describedby":K,id:L,disabled:E,role:"spinbutton",...Ct,readOnly:Ct.readOnly??_,"aria-readonly":Ct.readOnly??_,"aria-required":Ct.required??S,required:Ct.required??S,ref:Hi(We,sr),value:on(we.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(we.valueAsNumber)?void 0:we.valueAsNumber,"aria-invalid":Bf(C??we.isOutOfRange),"aria-valuetext":Ve,autoComplete:"off",autoCorrect:"off",onChange:Dn(Ct.onChange,Ut),onKeyDown:Dn(Ct.onKeyDown,Wt),onFocus:Dn(Ct.onFocus,fn,()=>Pe(!0)),onBlur:Dn(Ct.onBlur,ke,Et)}),[J,O,I,oe,ne,on,K,L,E,S,_,C,we.value,we.valueAsNumber,we.isOutOfRange,l,u,Ve,Ut,Wt,fn,ke,Et]);return{value:on(we.value),valueAsNumber:we.valueAsNumber,isFocused:Ce,isDisabled:E,isReadOnly:_,getIncrementButtonProps:dn,getDecrementButtonProps:vn,getInputProps:nn,htmlProps:ue}}const[Q2e,c1]=Ai({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[Z2e,_4]=Ai({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),Po=Ft(function(e,i){const o=Ma("NumberInput",e),l=Vi(e),u=KF(l),{htmlProps:f,..._}=J2e(u),E=k.useMemo(()=>_,[_]);return b.jsx(Z2e,{value:E,children:b.jsx(Q2e,{value:o,children:b.jsx(Mt.div,{...f,ref:i,className:gn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});Po.displayName="NumberInput";const Oo=Ft(function(e,i){const o=c1();return b.jsx(Mt.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});Oo.displayName="NumberInputStepper";const ko=Ft(function(e,i){const{getInputProps:o}=_4(),l=o(e,i),u=c1();return b.jsx(Mt.input,{...l,className:gn("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});ko.displayName="NumberInputField";const xre=Mt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),No=Ft(function(e,i){const o=c1(),{getDecrementButtonProps:l}=_4(),u=l(e,i);return b.jsx(xre,{...u,__css:o.stepper,children:e.children??b.jsx(G2e,{})})});No.displayName="NumberDecrementStepper";const Do=Ft(function(e,i){const{getIncrementButtonProps:o}=_4(),l=o(e,i),u=c1();return b.jsx(xre,{...l,__css:u.stepper,children:e.children??b.jsx(H2e,{})})});Do.displayName="NumberIncrementStepper";const[eUe,l1]=Ai({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[tUe,Lre]=Ai({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),VS={click:"click",hover:"hover"};function nUe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:u=!0,autoFocus:f=!0,arrowSize:_,arrowShadowColor:E,trigger:S=VS.click,openDelay:C=200,closeDelay:I=200,isLazy:O,lazyBehavior:M="unmount",computePositionOnMount:L,...U}=n,{isOpen:B,onClose:J,onOpen:K,onToggle:ne}=ld(n),[oe,se]=k.useState(u);k.useEffect(()=>se(u),[u]);const le=k.useRef(null),Y=k.useRef(null),Z=k.useRef(null),X=k.useRef(!1),ie=k.useRef(!1);B&&(ie.current=!0);const[de,ue]=k.useState(!1),[pe,ke]=k.useState(!1),xe=k.useId(),je=l??xe,[Oe,we,Se,Be]=["popover-trigger","popover-content","popover-header","popover-body"].map(Wt=>`${Wt}-${je}`),{referenceRef:Ee,getArrowProps:Ce,getPopperProps:Pe,getArrowInnerProps:Me,forceUpdate:We}=g4({...U,enabled:B||!!L}),He=GZ({isOpen:B,ref:Z});Nve({enabled:B,ref:Y}),KZ(Z,{focusRef:Y,visible:B,shouldFocus:oe&&S===VS.click}),wve(Z,{focusRef:o,visible:B,shouldFocus:f&&S===VS.click}),XZ({enabled:B&&e,ref:Z,handler(Wt){var Ve;const Te=((Ve=Wt.composedPath)==null?void 0:Ve.call(Wt)[0])??[Wt.target];$O(Y.current,Te)||(Te&&se(!Hk(Te)),J())}});const qe=Fj({wasSelected:ie.current,enabled:O,mode:M,isSelected:He.present}),rt=k.useCallback((Wt={},Te=null)=>{const Ve={...Wt,style:{...Wt.style,transformOrigin:mo.transformOrigin.varRef,[mo.arrowSize.var]:_?`${_}px`:void 0,[mo.arrowShadowColor.var]:E},ref:Hi(Z,Te),children:qe?Wt.children:null,id:we,tabIndex:-1,role:"dialog",onKeyDown:Dn(Wt.onKeyDown,$e=>{$e.nativeEvent.isComposing||i&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),J())}),onBlur:Dn(Wt.onBlur,$e=>{const Et=BX($e),vt=$O(Z.current,Et),St=$O(Y.current,Et),zt=!vt&&!St;Et&&se(!Hk(Et)),B&&e&&zt&&J()}),"aria-labelledby":de?Se:void 0,"aria-describedby":pe?Be:void 0};return S===VS.hover&&(Ve.role="tooltip",Ve.onMouseEnter=Dn(Wt.onMouseEnter,()=>{X.current=!0}),Ve.onMouseLeave=Dn(Wt.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(X.current=!1,setTimeout(()=>J(),I))})),Ve},[qe,we,de,Se,pe,Be,S,i,J,B,e,I,E,_]),et=k.useCallback((Wt={},Te=null)=>Pe({...Wt,style:{visibility:B?"visible":"hidden",...Wt.style}},Te),[B,Pe]),_t=k.useCallback((Wt,Te=null)=>({...Wt,ref:Hi(Te,le,Ee)}),[le,Ee]),on=k.useRef(void 0),dt=k.useRef(void 0),kt=k.useCallback(Wt=>{le.current==null&&Ee(Wt)},[Ee]),ct=k.useCallback((Wt={},Te=null)=>{const Ve={...Wt,ref:Hi(Y,Te,kt),id:Oe,"aria-haspopup":"dialog","aria-expanded":B,"aria-controls":we};return S===VS.click&&(Ve.onClick=Dn(Wt.onClick,ne)),S===VS.hover&&(Ve.onFocus=Dn(Wt.onFocus,()=>{on.current===void 0&&K()}),Ve.onBlur=Dn(Wt.onBlur,$e=>{const Et=BX($e),vt=!$O(Z.current,Et);B&&e&&vt&&J()}),Ve.onKeyDown=Dn(Wt.onKeyDown,$e=>{$e.key==="Escape"&&J()}),Ve.onMouseEnter=Dn(Wt.onMouseEnter,()=>{X.current=!0,on.current=window.setTimeout(()=>K(),C)}),Ve.onMouseLeave=Dn(Wt.onMouseLeave,()=>{X.current=!1,on.current&&(clearTimeout(on.current),on.current=void 0),dt.current=window.setTimeout(()=>{X.current===!1&&J()},I)})),Ve},[Oe,B,we,S,kt,ne,K,e,J,C,I]);k.useEffect(()=>()=>{on.current&&clearTimeout(on.current),dt.current&&clearTimeout(dt.current)},[]);const Ut=k.useCallback((Wt={},Te=null)=>({...Wt,id:Se,ref:Hi(Te,Ve=>{ue(!!Ve)})}),[Se]),fn=k.useCallback((Wt={},Te=null)=>({...Wt,id:Be,ref:Hi(Te,Ve=>{ke(!!Ve)})}),[Be]);return{forceUpdate:We,isOpen:B,onAnimationComplete:He.onComplete,onClose:J,getAnchorProps:_t,getArrowProps:Ce,getArrowInnerProps:Me,getPopoverPositionerProps:et,getPopoverProps:rt,getTriggerProps:ct,getHeaderProps:Ut,getBodyProps:fn}}function $O(n,e){return n===e||(n==null?void 0:n.contains(e))}function BX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Mre(n){const e=Ma("Popover",n),{children:i,...o}=Vi(n),l=eb(),u=nUe({...o,direction:l.direction});return b.jsx(eUe,{value:u,children:b.jsx(tUe,{value:e,children:bl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}Mre.displayName="Popover";function Ure(n){var i;const e=k.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Vre=Ft(function(e,i){const{getBodyProps:o}=l1(),l=Lre();return b.jsx(Mt.div,{...o(e,i),className:gn("chakra-popover__body",e.className),__css:l.body})});Vre.displayName="PopoverBody";function rUe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const iUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},sUe=Mt(Pp.section),jre=Ft(function(e,i){const{variants:o=iUe,...l}=e,{isOpen:u}=l1();return b.jsx(sUe,{ref:i,variants:rUe(o),initial:!1,animate:u?"enter":"exit",...l})});jre.displayName="PopoverTransition";const Fre=Ft(function(e,i){const{rootProps:o,motionProps:l,...u}=e,{getPopoverProps:f,getPopoverPositionerProps:_,onAnimationComplete:E}=l1(),S=Lre(),C={position:"relative",display:"flex",flexDirection:"column",...S.content};return b.jsx(Mt.div,{..._(o),__css:S.popper,className:"chakra-popover__popper",children:b.jsx(jre,{...l,...f(u,i),onAnimationComplete:VZ(E,u.onAnimationComplete),className:gn("chakra-popover__content",e.className),__css:C})})});Fre.displayName="PopoverContent";function Bre(n){const e=k.Children.only(n.children),{getTriggerProps:i}=l1();return b.jsx(b.Fragment,{children:k.cloneElement(e,i(e.props,Ure(e)))})}Bre.displayName="PopoverTrigger";function oUe(n,e,i){return(n-e)*100/(i-e)}hR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});hR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const aUe=hR({"0%":{left:"-40%"},"100%":{left:"100%"}}),cUe=hR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function lUe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:u,isIndeterminate:f,role:_="progressbar"}=n,E=oUe(e,i,o);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":f?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,E):l})(),role:_},percent:E,value:e}}const[uUe,dUe]=Ai({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),hUe=Ft((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:u,role:f,..._}=n,E=lUe({value:l,min:i,max:o,isIndeterminate:u,role:f}),C={height:"100%",...dUe().filledTrack};return b.jsx(Mt.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:C})}),qy=Ft((n,e)=>{var Y;const{value:i,min:o=0,max:l=100,hasStripe:u,isAnimated:f,children:_,borderRadius:E,isIndeterminate:S,"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,title:M,role:L,...U}=Vi(n),B=Ma("Progress",n),J=E??((Y=B.track)==null?void 0:Y.borderRadius),K={animation:`${cUe} 1s linear infinite`},se={...!S&&u&&f&&K,...S&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${aUe} 1s ease infinite normal none running`}},le={overflow:"hidden",position:"relative",...B.track};return b.jsx(Mt.div,{ref:e,borderRadius:J,__css:le,...U,children:b.jsxs(uUe,{value:B,children:[b.jsx(hUe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,min:o,max:l,value:i,isIndeterminate:S,css:se,borderRadius:J,title:M,role:L}),_]})})});qy.displayName="Progress";const Wre=Ft(function(e,i){const{children:o,placeholder:l,className:u,...f}=e;return b.jsxs(Mt.select,{...f,ref:i,className:gn("chakra-select",u),children:[l&&b.jsx("option",{value:"",children:l}),o]})});Wre.displayName="SelectField";const zre=Ft((n,e)=>{var ne;const i=Ma("Select",n),{rootProps:o,placeholder:l,icon:u,color:f,height:_,h:E,minH:S,minHeight:C,iconColor:I,iconSize:O,...M}=Vi(n),[L,U]=fve(M,DSe),B=$F(U),J={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(ne=i.field)==null?void 0:ne._focus}};return b.jsxs(Mt.div,{className:"chakra-select__wrapper",__css:J,...L,...o,children:[b.jsx(Wre,{ref:e,height:E??_,minH:S??C,placeholder:l,...B,__css:K,children:n.children}),b.jsx(Gre,{"data-disabled":rr(B.disabled),...(I||f)&&{color:I||f},__css:i.icon,...O&&{fontSize:O},children:u})]})});zre.displayName="Select";const pUe=n=>b.jsx("svg",{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),fUe=Mt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Gre=n=>{const{children:e=b.jsx(pUe,{}),...i}=n,o=k.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return b.jsx(fUe,{...i,className:"chakra-select__icon-wrapper",children:k.isValidElement(e)?o:null})};Gre.displayName="SelectIcon";function AU(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function mUe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=M=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...AU({orientation:e,vertical:{bottom:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[M]}% - var(--slider-thumb-size) / 2)`}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...AU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,o?100-i[0]:i[0]],S=_?E:i;let C=S[0];!_&&o&&(C=100-C);const I=Math.abs(S[S.length-1]-S[0]),O={...f,...AU({orientation:e,vertical:o?{height:`${I}%`,top:`${C}%`}:{height:`${I}%`,bottom:`${C}%`},horizontal:o?{width:`${I}%`,right:`${C}%`}:{width:`${I}%`,left:`${C}%`}})};return{trackStyle:f,innerTrackStyle:O,rootStyle:u,getThumbStyle:l}}function gUe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function _Ue(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:u,isReversed:f,direction:_="ltr",orientation:E="horizontal",id:S,isDisabled:C,isReadOnly:I,onChangeStart:O,onChangeEnd:M,step:L=1,getAriaValueText:U,"aria-valuetext":B,"aria-label":J,"aria-labelledby":K,name:ne,focusThumbOnChange:oe=!0,...se}=n,le=no(O),Y=no(M),Z=no(U),X=gUe({isReversed:f,direction:_,orientation:E}),[ie,de]=HZ({value:l,defaultValue:u??EUe(e,i),onChange:o}),[ue,pe]=k.useState(!1),[ke,xe]=k.useState(!1),je=!(C||I),Oe=(i-e)/10,we=L||(i-e)/100,Se=ck(ie,e,i),Be=i-Se+e,Ce=KK(X?Be:Se,e,i),Pe=E==="vertical",Me=YZ({min:e,max:i,step:L,isDisabled:C,value:Se,isInteractive:je,isReversed:X,isVertical:Pe,eventSource:null,focusThumbOnChange:oe,orientation:E}),We=k.useRef(null),He=k.useRef(null),qe=k.useRef(null),rt=k.useId(),et=S??rt,[_t,on]=[`slider-thumb-${et}`,`slider-track-${et}`],dt=k.useCallback(xt=>{var ao;if(!We.current)return;const qt=Me.current;qt.eventSource="pointer";const Tr=We.current.getBoundingClientRect(),{clientX:Pi,clientY:As}=((ao=xt.touches)==null?void 0:ao[0])??xt,cr=Pe?Tr.bottom-As:Pi-Tr.left,zn=Pe?Tr.height:Tr.width;let ia=cr/zn;X&&(ia=1-ia);let Ks=uve(ia,qt.min,qt.max);return qt.step&&(Ks=parseFloat(qK(Ks,qt.min,qt.step))),Ks=ck(Ks,qt.min,qt.max),Ks},[Pe,X,Me]),kt=k.useCallback(xt=>{const qt=Me.current;qt.isInteractive&&(xt=parseFloat(qK(xt,qt.min,we)),xt=ck(xt,qt.min,qt.max),de(xt))},[we,de,Me]),ct=k.useMemo(()=>({stepUp(xt=we){const qt=X?Se-xt:Se+xt;kt(qt)},stepDown(xt=we){const qt=X?Se+xt:Se-xt;kt(qt)},reset(){kt(u||0)},stepTo(xt){kt(xt)}}),[kt,X,Se,we,u]),Ut=k.useCallback(xt=>{const qt=Me.current,Pi={ArrowRight:()=>ct.stepUp(),ArrowUp:()=>ct.stepUp(),ArrowLeft:()=>ct.stepDown(),ArrowDown:()=>ct.stepDown(),PageUp:()=>ct.stepUp(Oe),PageDown:()=>ct.stepDown(Oe),Home:()=>kt(qt.min),End:()=>kt(qt.max)}[xt.key];Pi&&(xt.preventDefault(),xt.stopPropagation(),Pi(xt),qt.eventSource="keyboard")},[ct,kt,Oe,Me]),fn=(Z==null?void 0:Z(Se))??B,{getThumbStyle:Wt,rootStyle:Te,trackStyle:Ve,innerTrackStyle:$e}=k.useMemo(()=>{const xt=Me.current;return mUe({isReversed:X,orientation:xt.orientation,thumbPercents:[Ce]})},[X,Ce,Me]),Et=k.useCallback(()=>{Me.current.focusThumbOnChange&&setTimeout(()=>{var qt;return(qt=He.current)==null?void 0:qt.focus()})},[Me]);Qf(()=>{const xt=Me.current;Et(),xt.eventSource==="keyboard"&&(Y==null||Y(xt.value))},[Se,Y]);function vt(xt){const qt=dt(xt);qt!=null&&qt!==Me.current.value&&de(qt)}Zve(qe,{onPanSessionStart(xt){const qt=Me.current;qt.isInteractive&&(pe(!0),Et(),vt(xt),le==null||le(qt.value))},onPanSessionEnd(){const xt=Me.current;xt.isInteractive&&(pe(!1),Y==null||Y(xt.value))},onPan(xt){Me.current.isInteractive&&vt(xt)}});const St=k.useCallback((xt={},qt=null)=>({...xt,...se,ref:Hi(qt,qe),tabIndex:-1,"aria-disabled":Bf(C),"data-focused":rr(ke),style:{...xt.style,...Te}}),[se,C,ke,Te]),zt=k.useCallback((xt={},qt=null)=>({...xt,ref:Hi(qt,We),id:on,"data-disabled":rr(C),style:{...xt.style,...Ve}}),[C,on,Ve]),dn=k.useCallback((xt={},qt=null)=>({...xt,ref:qt,style:{...xt.style,...$e}}),[$e]),vn=k.useCallback((xt={},qt=null)=>({...xt,ref:Hi(qt,He),role:"slider",tabIndex:je?0:void 0,id:_t,"data-active":rr(ue),"aria-valuetext":fn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Se,"aria-orientation":E,"aria-disabled":Bf(C),"aria-readonly":Bf(I),"aria-label":J,"aria-labelledby":J?void 0:K,style:{...xt.style,...Wt(0)},onKeyDown:Dn(xt.onKeyDown,Ut),onFocus:Dn(xt.onFocus,()=>xe(!0)),onBlur:Dn(xt.onBlur,()=>xe(!1))}),[je,_t,ue,fn,e,i,Se,E,C,I,J,K,Wt,Ut]),nn=k.useCallback((xt,qt=null)=>{const Tr=!(xt.value<e||xt.value>i),Pi=Se>=xt.value,As=KK(xt.value,e,i),cr={position:"absolute",pointerEvents:"none",...yUe({orientation:E,vertical:{bottom:X?`${100-As}%`:`${As}%`},horizontal:{left:X?`${100-As}%`:`${As}%`}})};return{...xt,ref:qt,role:"presentation","aria-hidden":!0,"data-disabled":rr(C),"data-invalid":rr(!Tr),"data-highlighted":rr(Pi),style:{...xt.style,...cr}}},[C,X,i,e,E,Se]),Ct=k.useCallback((xt={},qt=null)=>({...xt,ref:qt,type:"hidden",value:Se,name:ne}),[ne,Se]);return{state:{value:Se,isFocused:ke,isDragging:ue},actions:ct,getRootProps:St,getTrackProps:zt,getInnerTrackProps:dn,getThumbProps:vn,getMarkerProps:nn,getInputProps:Ct}}function yUe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function EUe(n,e){return e<n?n:n+(e-n)/2}const[vUe,u1]=Ai({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[SUe,d1]=Ai({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),qV=Ft((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=Ma("Slider",i),l=Vi(i),{direction:u}=eb();l.direction=u;const{getInputProps:f,getRootProps:_,...E}=_Ue(l),S=_(),C=f({},e);return b.jsx(vUe,{value:E,children:b.jsx(SUe,{value:o,children:b.jsxs(Mt.div,{...S,className:gn("chakra-slider",i.className),__css:o.container,children:[i.children,b.jsx("input",{...C})]})})})});qV.displayName="Slider";const YV=Ft((n,e)=>{const{getThumbProps:i}=u1(),o=d1(),l=i(n,e);return b.jsx(Mt.div,{...l,className:gn("chakra-slider__thumb",n.className),__css:o.thumb})});YV.displayName="SliderThumb";const XV=Ft((n,e)=>{const{getTrackProps:i}=u1(),o=d1(),l=i(n,e);return b.jsx(Mt.div,{...l,className:gn("chakra-slider__track",n.className),__css:o.track})});XV.displayName="SliderTrack";const JV=Ft((n,e)=>{const{getInnerTrackProps:i}=u1(),o=d1(),l=i(n,e);return b.jsx(Mt.div,{...l,className:gn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});JV.displayName="SliderFilledTrack";const bUe=Ft((n,e)=>{const{getMarkerProps:i}=u1(),o=d1(),l=i(n,e);return b.jsx(Mt.div,{...l,className:gn("chakra-slider__marker",n.className),__css:o.mark})});bUe.displayName="SliderMark";const g0=Mt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});g0.displayName="Spacer";const Hre=n=>b.jsx(Mt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Hre.displayName="StackItem";function TUe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":FN(i,l=>o[l])}}const y4=Ft((n,e)=>{const{isInline:i,direction:o,align:l,justify:u,spacing:f="0.5rem",wrap:_,children:E,divider:S,className:C,shouldWrapChildren:I,...O}=n,M=i?"row":o??"column",L=k.useMemo(()=>TUe({spacing:f,direction:M}),[f,M]),U=!!S,B=!I&&!U,J=k.useMemo(()=>{const ne=VN(E);return B?ne:ne.map((oe,se)=>{const le=typeof oe.key<"u"?oe.key:se,Y=se+1===ne.length,X=I?b.jsx(Hre,{children:oe},le):oe;if(!U)return X;const ie=k.cloneElement(S,{__css:L}),de=Y?null:ie;return b.jsxs(k.Fragment,{children:[X,de]},le)})},[S,L,U,B,I,E]),K=gn("chakra-stack",C);return b.jsx(Mt.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:M,flexWrap:_,gap:U?void 0:f,className:K,...O,children:J})});y4.displayName="Stack";const hr=Ft((n,e)=>b.jsx(y4,{align:"center",...n,direction:"row",ref:e}));hr.displayName="HStack";const Mr=Ft((n,e)=>b.jsx(y4,{align:"center",...n,direction:"column",ref:e}));Mr.displayName="VStack";const qf=Ft(function(e,i){const o=Ma("Switch",e),{spacing:l="0.5rem",children:u,...f}=Vi(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:S,getRootProps:C,getLabelProps:I}=yDe(f),O=k.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),M=k.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),L=k.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return b.jsxs(Mt.label,{...C(),className:gn("chakra-switch",e.className),__css:O,children:[b.jsx("input",{className:"chakra-switch__input",...E({},i)}),b.jsx(Mt.span,{...S(),className:"chakra-switch__track",__css:M,children:b.jsx(Mt.span,{__css:o.thumb,className:"chakra-switch__thumb",..._()})}),u&&b.jsx(Mt.span,{className:"chakra-switch__label",...I(),__css:L,children:u})]})});qf.displayName="Switch";const[wUe,CUe,RUe,IUe]=yne();function AUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:u,lazyBehavior:f="unmount",orientation:_="horizontal",direction:E="ltr",...S}=n,[C,I]=k.useState(e??0),[O,M]=HZ({defaultValue:e??0,value:o,onChange:i});k.useEffect(()=>{o!=null&&I(o)},[o]);const L=RUe(),U=k.useId();return{id:`tabs-${n.id??U}`,selectedIndex:O,focusedIndex:C,setSelectedIndex:M,setFocusedIndex:I,isManual:l,isLazy:u,lazyBehavior:f,orientation:_,descendants:L,direction:E,htmlProps:S}}const[PUe,h1]=Ai({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function OUe(n){const{focusedIndex:e,orientation:i,direction:o}=h1(),l=CUe(),u=k.useCallback(f=>{const _=()=>{var ne;const K=l.nextEnabled(e);K&&((ne=K.node)==null||ne.focus())},E=()=>{var ne;const K=l.prevEnabled(e);K&&((ne=K.node)==null||ne.focus())},S=()=>{var ne;const K=l.firstEnabled();K&&((ne=K.node)==null||ne.focus())},C=()=>{var ne;const K=l.lastEnabled();K&&((ne=K.node)==null||ne.focus())},I=i==="horizontal",O=i==="vertical",M=f.key,L=o==="ltr"?"ArrowLeft":"ArrowRight",U=o==="ltr"?"ArrowRight":"ArrowLeft",J={[L]:()=>I&&E(),[U]:()=>I&&_(),ArrowDown:()=>O&&_(),ArrowUp:()=>O&&E(),Home:S,End:C}[M];J&&(f.preventDefault(),J(f))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Dn(n.onKeyDown,u)}}function kUe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:u,id:f,setFocusedIndex:_,selectedIndex:E}=h1(),{index:S,register:C}=IUe({disabled:e&&!i}),I=S===E,O=()=>{l(S)},M=()=>{_(S),!u&&!(e&&i)&&l(S)};return{...Ere({...o,ref:Hi(C,n.ref),isDisabled:e,isFocusable:i,onClick:Dn(n.onClick,O)}),id:$re(f,S),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":Kre(f,S),onFocus:e?void 0:Dn(n.onFocus,M)}}const[NUe,DUe]=Ai({});function xUe(n){const e=h1(),{id:i,selectedIndex:o}=e,u=VN(n.children).map((f,_)=>k.createElement(NUe,{key:f.key??_,value:{isSelected:_===o,id:Kre(i,_),tabId:$re(i,_),selectedIndex:o}},f));return{...n,children:u}}function LUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=h1(),{isSelected:u,id:f,tabId:_}=DUe(),E=k.useRef(!1);u&&(E.current=!0);const S=Fj({wasSelected:E.current,isSelected:u,enabled:o,mode:l});return{tabIndex:0,...i,children:S?e:null,role:"tabpanel","aria-labelledby":_,hidden:!u,id:f}}function $re(n,e){return`${n}--tab-${e}`}function Kre(n,e){return`${n}--tabpanel-${e}`}const[MUe,p1]=Ai({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),L0=Ft(function(e,i){const o=Ma("Tabs",e),{children:l,className:u,...f}=Vi(e),{htmlProps:_,descendants:E,...S}=AUe(f),C=k.useMemo(()=>S,[S]),{isFitted:I,...O}=_,M={position:"relative",...o.root};return b.jsx(wUe,{value:E,children:b.jsx(PUe,{value:C,children:b.jsx(MUe,{value:o,children:b.jsx(Mt.div,{className:gn("chakra-tabs",u),ref:i,...O,__css:M,children:l})})})})});L0.displayName="Tabs";const ka=Ft(function(e,i){const o=p1(),l=kUe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return b.jsx(Mt.button,{...l,className:gn("chakra-tabs__tab",e.className),__css:u})});ka.displayName="Tab";const M0=Ft(function(e,i){const o=OUe({...e,ref:i}),l=p1(),u={display:"flex",...l.tablist};return b.jsx(Mt.div,{...o,className:gn("chakra-tabs__tablist",e.className),__css:u})});M0.displayName="TabList";const Nc=Ft(function(e,i){const o=LUe({...e,ref:i}),l=p1();return b.jsx(Mt.div,{outline:"0",...o,className:gn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Nc.displayName="TabPanel";const YC=Ft(function(e,i){const o=xUe(e),l=p1();return b.jsx(Mt.div,{...o,width:"100%",ref:i,className:gn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});YC.displayName="TabPanels";const[UUe,qre]=Ai({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Yre=Ft((n,e)=>{const i=Ma("Tag",n),o=Vi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return b.jsx(UUe,{value:i,children:b.jsx(Mt.span,{ref:e,...o,__css:l})})});Yre.displayName="Tag";const Xre=Ft((n,e)=>{const i=qre();return b.jsx(Mt.span,{ref:e,noOfLines:1,...n,__css:i.label})});Xre.displayName="TagLabel";const VUe=Ft((n,e)=>b.jsx(mn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));VUe.displayName="TagLeftIcon";const jUe=Ft((n,e)=>b.jsx(mn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));jUe.displayName="TagRightIcon";const Jre=n=>b.jsx(mn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:b.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Jre.displayName="TagCloseIcon";const Qre=Ft((n,e)=>{const{isDisabled:i,children:o,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...qre().closeButton};return b.jsx(Mt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:f,children:o||b.jsx(Jre,{})})});Qre.displayName="TagCloseButton";const FUe=["h","minH","height","minHeight"],Zre=Ft((n,e)=>{const i=du("Textarea",n),{className:o,rows:l,...u}=Vi(n),f=$F(u),_=l?Y0(i,FUe):i;return b.jsx(Mt.textarea,{ref:e,rows:l,...f,className:gn("chakra-textarea",o),__css:_})});Zre.displayName="Textarea";function BUe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function WUe(n,e){const i=l=>({...e,...l,position:BUe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const u=i(l),f=mne(u);return lp.notify(f,u)};return o.update=(l,u)=>{lp.update(l,i(u))},o.promise=(l,u)=>{const f=o({...u.loading,status:"loading",duration:null});l.then(_=>o.update(f,{status:"success",duration:5e3,...bl(u.success,_)})).catch(_=>o.update(f,{status:"error",duration:5e3,...bl(u.error,_)}))},o.closeAll=lp.closeAll,o.close=lp.close,o.isActive=lp.isActive,o}function Ua(n){const{theme:e}=hne(),i=G1e();return k.useMemo(()=>WUe(e.direction,{...i,...n}),[n,e.direction,i])}const zUe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},QV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},Ik=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function GUe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:f=l,closeOnEsc:_=!0,onOpen:E,onClose:S,placement:C,id:I,isOpen:O,defaultIsOpen:M,arrowSize:L=10,arrowShadowColor:U,arrowPadding:B,modifiers:J,isDisabled:K,gutter:ne,offset:oe,direction:se,...le}=n,{isOpen:Y,onOpen:Z,onClose:X}=ld({isOpen:O,defaultIsOpen:M,onOpen:E,onClose:S}),{referenceRef:ie,getPopperProps:de,getArrowInnerProps:ue,getArrowProps:pe}=g4({enabled:Y,placement:C,arrowPadding:B,modifiers:J,gutter:ne,offset:oe,direction:se}),ke=k.useId(),je=`tooltip-${I??ke}`,Oe=k.useRef(null),we=k.useRef(void 0),Se=k.useCallback(()=>{we.current&&(clearTimeout(we.current),we.current=void 0)},[]),Be=k.useRef(void 0),Ee=k.useCallback(()=>{Be.current&&(clearTimeout(Be.current),Be.current=void 0)},[]),Ce=k.useCallback(()=>{Ee(),X()},[X,Ee]),Pe=HUe(Oe,Ce),Me=k.useCallback(()=>{if(!K&&!we.current){Y&&Pe();const dt=Ik(Oe);we.current=dt.setTimeout(Z,e)}},[Pe,K,Y,Z,e]),We=k.useCallback(()=>{Se();const dt=Ik(Oe);Be.current=dt.setTimeout(Ce,i)},[i,Ce,Se]),He=k.useCallback(()=>{Y&&o&&We()},[o,We,Y]),qe=k.useCallback(()=>{Y&&f&&We()},[f,We,Y]),rt=k.useCallback(dt=>{Y&&dt.key==="Escape"&&We()},[Y,We]);Vy(()=>QV(Oe),"keydown",_?rt:void 0),Vy(()=>{if(!u)return null;const dt=Oe.current;if(!dt)return null;const kt=zZ(dt);return kt.localName==="body"?Ik(Oe):kt},"scroll",()=>{Y&&u&&Ce()},{passive:!0,capture:!0}),k.useEffect(()=>{K&&(Se(),Y&&X())},[K,Y,X,Se]),k.useEffect(()=>()=>{Se(),Ee()},[Se,Ee]),Vy(()=>Oe.current,"pointerleave",We);const et=k.useCallback((dt={},kt=null)=>({...dt,ref:Hi(Oe,kt,ie),onPointerEnter:Dn(dt.onPointerEnter,Ut=>{Ut.pointerType!=="touch"&&Me()}),onClick:Dn(dt.onClick,He),onPointerDown:Dn(dt.onPointerDown,qe),onFocus:Dn(dt.onFocus,Me),onBlur:Dn(dt.onBlur,We),"aria-describedby":Y?je:void 0}),[Me,We,qe,Y,je,He,ie]),_t=k.useCallback((dt={},kt=null)=>de({...dt,style:{...dt.style,[mo.arrowSize.var]:L?`${L}px`:void 0,[mo.arrowShadowColor.var]:U}},kt),[de,L,U]),on=k.useCallback((dt={},kt=null)=>{const ct={...dt.style,position:"relative",transformOrigin:mo.transformOrigin.varRef};return{ref:kt,...le,...dt,id:je,role:"tooltip",style:ct}},[le,je]);return{isOpen:Y,show:Me,hide:We,getTriggerProps:et,getTooltipProps:on,getTooltipPositionerProps:_t,getArrowProps:pe,getArrowInnerProps:ue}}const PU="chakra-ui:close-tooltip";function HUe(n,e){return k.useEffect(()=>{const i=QV(n);return i.addEventListener(PU,e),()=>i.removeEventListener(PU,e)},[e,n]),()=>{const i=QV(n),o=Ik(n);i.dispatchEvent(new o.CustomEvent(PU))}}const $Ue=Mt(Pp.div),Yf=Ft((n,e)=>{const i=du("Tooltip",n),o=Vi(n),l=eb(),{children:u,label:f,shouldWrapChildren:_,"aria-label":E,hasArrow:S,bg:C,portalProps:I,background:O,backgroundColor:M,bgColor:L,motionProps:U,animatePresenceProps:B,...J}=o,K=O??M??C??L;if(K){i.bg=K;const ie=zSe(l,"colors",K);i[mo.arrowBg.var]=ie}const ne=GUe({...J,direction:l.direction}),oe=!k.isValidElement(u)||_;let se;if(oe)se=b.jsx(Mt.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:u});else{const ie=k.Children.only(u);se=k.cloneElement(ie,ne.getTriggerProps(ie.props,Ure(ie)))}const le=!!E,Y=ne.getTooltipProps({},e),Z=le?Y0(Y,["role","id"]):Y,X=WZ(Y,["role","id"]);return f?b.jsxs(b.Fragment,{children:[se,b.jsx(J0,{...B,children:ne.isOpen&&b.jsx(hu,{...I,children:b.jsx(Mt.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:b.jsxs($Ue,{variants:zUe,initial:"exit",animate:"enter",exit:"exit",...U,...Z,__css:i,children:[f,le&&b.jsx(Mt.span,{srOnly:!0,...X,children:E}),S&&b.jsx(Mt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:b.jsx(Mt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):b.jsx(b.Fragment,{children:u})});Yf.displayName="Tooltip";const XC=Ft(function(e,i){const o=du("Heading",e),{className:l,...u}=Vi(e);return b.jsx(Mt.h2,{ref:i,className:gn("chakra-heading",e.className),...u,__css:o})});XC.displayName="Heading";const Ze=Ft(function(e,i){const o=du("Text",e),{className:l,align:u,decoration:f,casing:_,...E}=Vi(e),S=jN({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return b.jsx(Mt.p,{ref:i,className:gn("chakra-text",e.className),...S,...E,__css:o})});Ze.displayName="Text";const eie=Ft(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:u,children:f,justify:_,direction:E,align:S,className:C,shouldWrapChildren:I,...O}=e,M=k.useMemo(()=>I?k.Children.map(f,(L,U)=>b.jsx(E4,{children:L},U)):f,[f,I]);return b.jsx(Mt.div,{ref:i,className:gn("chakra-wrap",C),...O,children:b.jsx(Mt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:_,alignItems:S,flexDirection:E,listStyleType:"none",gap:o,columnGap:l,rowGap:u,padding:"0"},children:M})})});eie.displayName="Wrap";const E4=Ft(function(e,i){const{className:o,...l}=e;return b.jsx(Mt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:gn("chakra-wrap__listitem",o),...l})});E4.displayName="WrapItem";const KUe="modulepreload",qUe=function(n,e){return new URL(n,e).href},WX={},OU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(S=>{if(S=qUe(S,o),S in WX)return;WX[S]=!0;const C=S.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(!!o)for(let L=f.length-1;L>=0;L--){const U=f[L];if(U.href===S&&(!C||U.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${S}"]${I}`))return;const M=document.createElement("link");if(M.rel=C?"stylesheet":KUe,C||(M.as="script"),M.crossOrigin="",M.href=S,E&&M.setAttribute("nonce",E),document.head.appendChild(M),C)return new Promise((L,U)=>{M.addEventListener("load",L),M.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${S}`)))})}))}function u(f){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=f,window.dispatchEvent(_),!_.defaultPrevented)throw f}return l.then(f=>{for(const _ of f||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})},KO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},$={log:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${KO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${KO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${KO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${KO()}] ${n}`)}};async function JC(n){let e;try{switch(n){case"default":e=await OU(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await OU(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return $.error("Failed to load theme:",i),e=await OU(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const YUe=()=>{};var zX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tie=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},XUe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[o++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],f=n[i++],_=n[i++],E=((l&7)<<18|(u&63)<<12|(f&63)<<6|_&63)-65536;e[o++]=String.fromCharCode(55296+(E>>10)),e[o++]=String.fromCharCode(56320+(E&1023))}else{const u=n[i++],f=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(u&63)<<6|f&63)}}return e.join("")},nie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const u=n[l],f=l+1<n.length,_=f?n[l+1]:0,E=l+2<n.length,S=E?n[l+2]:0,C=u>>2,I=(u&3)<<4|_>>4;let O=(_&15)<<2|S>>6,M=S&63;E||(M=64,f||(O=64)),o.push(i[C],i[I],i[O],i[M])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(tie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):XUe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const S=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||_==null||S==null||I==null)throw new JUe;const O=u<<2|_>>4;if(o.push(O),S!==64){const M=_<<4&240|S>>2;if(o.push(M),I!==64){const L=S<<6&192|I;o.push(L)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class JUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const QUe=function(n){const e=tie(n);return nie.encodeByteArray(e,!0)},oN=function(n){return QUe(n).replace(/\./g,"")},rie=function(n){try{return nie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eVe=()=>ZUe().__FIREBASE_DEFAULTS__,tVe=()=>{if(typeof process>"u"||typeof zX>"u")return;const n=zX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},nVe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&rie(n[1]);return e&&JSON.parse(e)},f1=()=>{try{return YUe()||eVe()||tVe()||nVe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},iie=n=>{var e,i;return(i=(e=f1())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},v4=n=>{const e=iie(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},sie=()=>{var n;return(n=f1())===null||n===void 0?void 0:n.config},oie=n=>{var e;return(e=f1())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rVe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[oN(JSON.stringify(i)),oN(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function iVe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(pc())}function sVe(){var n;const e=(n=f1())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function oVe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function aVe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function cVe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function lVe(){const n=pc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function uVe(){return!sVe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function dVe(){try{return typeof indexedDB=="object"}catch{return!1}}function hVe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pVe="FirebaseError";class lh extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=pVe,Object.setPrototypeOf(this,lh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,IR.prototype.create)}}class IR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],f=u?fVe(u,o):"Error",_=`${this.serviceName}: ${f} (${l}).`;return new lh(l,_,o)}}function fVe(n,e){return n.replace(mVe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const mVe=/\{\$([^}]+)}/g;function gVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nm(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const u=n[l],f=e[l];if(GX(u)&&GX(f)){if(!nm(u,f))return!1}else if(u!==f)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function GX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AR(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function rC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,u]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function iC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function _Ve(n,e){const i=new yVe(n,e);return i.subscribe.bind(i)}class yVe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");EVe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=kU),l.error===void 0&&(l.error=kU),l.complete===void 0&&(l.complete=kU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function EVe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function kU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(n){return n&&n._delegate?n._delegate:n}class rm{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ay="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vVe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new rVe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(bVe(e))try{this.getOrInitializeService({instanceIdentifier:Ay})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});o.resolve(u)}catch{}}}}clearInstance(e=Ay){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ay){return this.instances.has(e)}getOptions(e=Ay){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[u,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);o===_&&f.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),u=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(l,u);const f=this.instances.get(l);return f&&e(f,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:SVe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ay){return this.component?this.component.multipleInstances?e:Ay:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function SVe(n){return n===Ay?void 0:n}function bVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new vVe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Lr||(Lr={}));const wVe={debug:Lr.DEBUG,verbose:Lr.VERBOSE,info:Lr.INFO,warn:Lr.WARN,error:Lr.ERROR,silent:Lr.SILENT},CVe=Lr.INFO,RVe={[Lr.DEBUG]:"log",[Lr.VERBOSE]:"log",[Lr.INFO]:"info",[Lr.WARN]:"warn",[Lr.ERROR]:"error"},IVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=RVe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class S4{constructor(e){this.name=e,this._logLevel=CVe,this._logHandler=IVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Lr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Lr.DEBUG,...e),this._logHandler(this,Lr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Lr.VERBOSE,...e),this._logHandler(this,Lr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Lr.INFO,...e),this._logHandler(this,Lr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Lr.WARN,...e),this._logHandler(this,Lr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Lr.ERROR,...e),this._logHandler(this,Lr.ERROR,...e)}}const AVe=(n,e)=>e.some(i=>n instanceof i);let HX,$X;function PVe(){return HX||(HX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function OVe(){return $X||($X=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cie=new WeakMap,ZV=new WeakMap,lie=new WeakMap,NU=new WeakMap,b4=new WeakMap;function kVe(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",f)},u=()=>{i(Lg(n.result)),l()},f=()=>{o(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",f)});return e.then(i=>{i instanceof IDBCursor&&cie.set(i,n)}).catch(()=>{}),b4.set(e,n),e}function NVe(n){if(ZV.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",f),n.removeEventListener("abort",f)},u=()=>{i(),l()},f=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",f),n.addEventListener("abort",f)});ZV.set(n,e)}let ej={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return ZV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||lie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Lg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function DVe(n){ej=n(ej)}function xVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(DU(this),e,...i);return lie.set(o,e.sort?e.sort():[e]),Lg(o)}:OVe().includes(n)?function(...e){return n.apply(DU(this),e),Lg(cie.get(this))}:function(...e){return Lg(n.apply(DU(this),e))}}function LVe(n){return typeof n=="function"?xVe(n):(n instanceof IDBTransaction&&NVe(n),AVe(n,PVe())?new Proxy(n,ej):n)}function Lg(n){if(n instanceof IDBRequest)return kVe(n);if(NU.has(n))return NU.get(n);const e=LVe(n);return e!==n&&(NU.set(n,e),b4.set(e,n)),e}const DU=n=>b4.get(n);function MVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:u}={}){const f=indexedDB.open(n,e),_=Lg(f);return o&&f.addEventListener("upgradeneeded",E=>{o(Lg(f.result),E.oldVersion,E.newVersion,Lg(f.transaction),E)}),i&&f.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{u&&E.addEventListener("close",()=>u()),l&&E.addEventListener("versionchange",S=>l(S.oldVersion,S.newVersion,S))}).catch(()=>{}),_}const UVe=["get","getKey","getAll","getAllKeys","count"],VVe=["put","add","delete","clear"],xU=new Map;function KX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(xU.get(e))return xU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=VVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||UVe.includes(i)))return;const u=async function(f,..._){const E=this.transaction(f,l?"readwrite":"readonly");let S=E.store;return o&&(S=S.index(_.shift())),(await Promise.all([S[i](..._),l&&E.done]))[0]};return xU.set(e,u),u}DVe(n=>({...n,get:(e,i,o)=>KX(e,i)||n.get(e,i,o),has:(e,i)=>!!KX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jVe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(FVe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function FVe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const tj="@firebase/app",qX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const im=new S4("@firebase/app"),BVe="@firebase/app-compat",WVe="@firebase/analytics-compat",zVe="@firebase/analytics",GVe="@firebase/app-check-compat",HVe="@firebase/app-check",$Ve="@firebase/auth",KVe="@firebase/auth-compat",qVe="@firebase/database",YVe="@firebase/data-connect",XVe="@firebase/database-compat",JVe="@firebase/functions",QVe="@firebase/functions-compat",ZVe="@firebase/installations",eje="@firebase/installations-compat",tje="@firebase/messaging",nje="@firebase/messaging-compat",rje="@firebase/performance",ije="@firebase/performance-compat",sje="@firebase/remote-config",oje="@firebase/remote-config-compat",aje="@firebase/storage",cje="@firebase/storage-compat",lje="@firebase/firestore",uje="@firebase/vertexai",dje="@firebase/firestore-compat",hje="firebase",pje="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nj="[DEFAULT]",fje={[tj]:"fire-core",[BVe]:"fire-core-compat",[zVe]:"fire-analytics",[WVe]:"fire-analytics-compat",[HVe]:"fire-app-check",[GVe]:"fire-app-check-compat",[$Ve]:"fire-auth",[KVe]:"fire-auth-compat",[qVe]:"fire-rtdb",[YVe]:"fire-data-connect",[XVe]:"fire-rtdb-compat",[JVe]:"fire-fn",[QVe]:"fire-fn-compat",[ZVe]:"fire-iid",[eje]:"fire-iid-compat",[tje]:"fire-fcm",[nje]:"fire-fcm-compat",[rje]:"fire-perf",[ije]:"fire-perf-compat",[sje]:"fire-rc",[oje]:"fire-rc-compat",[aje]:"fire-gcs",[cje]:"fire-gcs-compat",[lje]:"fire-fst",[dje]:"fire-fst-compat",[uje]:"fire-vertex","fire-js":"fire-js",[hje]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aN=new Map,mje=new Map,rj=new Map;function YX(n,e){try{n.container.addComponent(e)}catch(i){im.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Wg(n){const e=n.name;if(rj.has(e))return im.debug(`There were multiple attempts to register component ${e}.`),!1;rj.set(e,n);for(const i of aN.values())YX(i,n);for(const i of mje.values())YX(i,n);return!0}function PR(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function vl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gje={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Mg=new IR("app","Firebase",gje);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _je{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new rm("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Mg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lE=pje;function uie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:nj,automaticDataCollectionEnabled:!1},e),l=o.name;if(typeof l!="string"||!l)throw Mg.create("bad-app-name",{appName:String(l)});if(i||(i=sie()),!i)throw Mg.create("no-options");const u=aN.get(l);if(u){if(nm(i,u.options)&&nm(o,u.config))return u;throw Mg.create("duplicate-app",{appName:l})}const f=new TVe(l);for(const E of rj.values())f.addComponent(E);const _=new _je(i,o,f);return aN.set(l,_),_}function m1(n=nj){const e=aN.get(n);if(!e&&n===nj&&sie())return uie();if(!e)throw Mg.create("no-app",{appName:n});return e}function id(n,e,i){var o;let l=(o=fje[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),f=e.match(/\s|\//);if(u||f){const _=[`Unable to register library "${l}" with version "${e}":`];u&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&f&&_.push("and"),f&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),im.warn(_.join(" "));return}Wg(new rm(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yje="firebase-heartbeat-database",Eje=1,QC="firebase-heartbeat-store";let LU=null;function die(){return LU||(LU=MVe(yje,Eje,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(QC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Mg.create("idb-open",{originalErrorMessage:n.message})})),LU}async function vje(n){try{const i=(await die()).transaction(QC),o=await i.objectStore(QC).get(hie(n));return await i.done,o}catch(e){if(e instanceof lh)im.warn(e.message);else{const i=Mg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});im.warn(i.message)}}}async function XX(n,e){try{const o=(await die()).transaction(QC,"readwrite");await o.objectStore(QC).put(e,hie(n)),await o.done}catch(i){if(i instanceof lh)im.warn(i.message);else{const o=Mg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});im.warn(o.message)}}}function hie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sje=1024,bje=30;class Tje{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new Cje(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=JX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(f=>f.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>bje){const f=Rje(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){im.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=JX(),{heartbeatsToSend:o,unsentEntries:l}=wje(this._heartbeatsCache.heartbeats),u=oN(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return im.warn(i),""}}}function JX(){return new Date().toISOString().substring(0,10)}function wje(n,e=Sje){const i=[];let o=n.slice();for(const l of n){const u=i.find(f=>f.agent===l.agent);if(u){if(u.dates.push(l.date),QX(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),QX(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class Cje{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return dVe()?hVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await vje(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return XX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return XX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function QX(n){return oN(JSON.stringify({version:2,heartbeats:n})).length}function Rje(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ije(n){Wg(new rm("platform-logger",e=>new jVe(e),"PRIVATE")),Wg(new rm("heartbeat",e=>new Tje(e),"PRIVATE")),id(tj,qX,n),id(tj,qX,"esm2017"),id("fire-js","")}Ije("");function pie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Aje=pie,fie=new IR("auth","Firebase",pie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN=new S4("@firebase/auth");function Pje(n,...e){cN.logLevel<=Lr.WARN&&cN.warn(`Auth (${lE}): ${n}`,...e)}function Ak(n,...e){cN.logLevel<=Lr.ERROR&&cN.error(`Auth (${lE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ah(n,...e){throw T4(n,...e)}function Tp(n,...e){return T4(n,...e)}function mie(n,e,i){const o=Object.assign(Object.assign({},Aje()),{[e]:i});return new IR("auth","Firebase",o).create(e,{appName:n.name})}function Xf(n){return mie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function T4(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return fie.create(n,...e)}function Gn(n,e,...i){if(!n)throw T4(e,...i)}function Uf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ak(e),new Error(e)}function sm(n,e){n||Uf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ij(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Oje(){return ZX()==="http:"||ZX()==="https:"}function ZX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kje(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Oje()||aVe()||"connection"in navigator)?navigator.onLine:!0}function Nje(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(e,i){this.shortDelay=e,this.longDelay=i,sm(i>e,"Short delay should be less than long delay!"),this.isMobile=iVe()||cVe()}get(){return kje()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w4(n,e){sm(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Uf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Uf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Uf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dje={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xje=new OR(3e4,6e4);function lm(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function um(n,e,i,o,l={}){return _ie(n,l,async()=>{let u={},f={};o&&(e==="GET"?f=o:u={body:JSON.stringify(o)});const _=AR(Object.assign({key:n.config.apiKey},f)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const S=Object.assign({method:e,headers:E},u);return oVe()||(S.referrerPolicy="no-referrer"),gie.fetch()(yie(n,n.config.apiHost,i,_),S)})}async function _ie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},Dje),e);try{const l=new Mje(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await u.json();if("needConfirmation"in f)throw qO(n,"account-exists-with-different-credential",f);if(u.ok&&!("errorMessage"in f))return f;{const _=u.ok?f.errorMessage:f.error.message,[E,S]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw qO(n,"credential-already-in-use",f);if(E==="EMAIL_EXISTS")throw qO(n,"email-already-in-use",f);if(E==="USER_DISABLED")throw qO(n,"user-disabled",f);const C=o[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(S)throw mie(n,C,S);ah(n,C)}}catch(l){if(l instanceof lh)throw l;ah(n,"network-request-failed",{message:String(l)})}}async function kR(n,e,i,o,l={}){const u=await um(n,e,i,o,l);return"mfaPendingCredential"in u&&ah(n,"multi-factor-auth-required",{_serverResponse:u}),u}function yie(n,e,i,o){const l=`${e}${i}?${o}`;return n.config.emulator?w4(n.config,l):`${n.config.apiScheme}://${l}`}function Lje(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Mje{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(Tp(this.auth,"network-request-failed")),xje.get())})}}function qO(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=Tp(n,e,o);return l.customData._tokenResponse=i,l}function eJ(n){return n!==void 0&&n.enterprise!==void 0}class Uje{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return Lje(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Vje(n,e){return um(n,"GET","/v2/recaptchaConfig",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jje(n,e){return um(n,"POST","/v1/accounts:delete",e)}async function Eie(n,e){return um(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Fje(n,e=!1){const i=Ii(n),o=await i.getIdToken(e),l=C4(o);Gn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,f=u==null?void 0:u.sign_in_provider;return{claims:l,token:o,authTime:CC(MU(l.auth_time)),issuedAtTime:CC(MU(l.iat)),expirationTime:CC(MU(l.exp)),signInProvider:f||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function MU(n){return Number(n)*1e3}function C4(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return Ak("JWT malformed, contained fewer than 3 sections"),null;try{const l=rie(i);return l?JSON.parse(l):(Ak("Failed to decode base64 JWT payload"),null)}catch(l){return Ak("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function tJ(n){const e=C4(n);return Gn(e,"internal-error"),Gn(typeof e.exp<"u","internal-error"),Gn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZC(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof lh&&Bje(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function Bje({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wje{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=CC(this.lastLoginAt),this.creationTime=CC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lN(n){var e;const i=n.auth,o=await n.getIdToken(),l=await ZC(n,Eie(i,{idToken:o}));Gn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const f=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?vie(u.providerUserInfo):[],_=Gje(n.providerData,f),E=n.isAnonymous,S=!(n.email&&u.passwordHash)&&!(_!=null&&_.length),C=E?S:!1,I={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new sj(u.createdAt,u.lastLoginAt),isAnonymous:C};Object.assign(n,I)}async function zje(n){const e=Ii(n);await lN(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Gje(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function vie(n){return n.map(e=>{var{providerId:i}=e,o=ER(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hje(n,e){const i=await _ie(n,{},async()=>{const o=AR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,f=yie(n,l,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",gie.fetch()(f,{method:"POST",headers:_,body:o})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function $je(n,e){return um(n,"POST","/v2/accounts:revokeToken",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Gn(e.idToken,"internal-error"),Gn(typeof e.idToken<"u","internal-error"),Gn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):tJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Gn(e.length!==0,"internal-error");const i=tJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Gn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:u}=await Hje(e,i);this.updateTokensAndExpiration(o,l,Number(u))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:u}=i,f=new _0;return o&&(Gn(typeof o=="string","internal-error",{appName:e}),f.refreshToken=o),l&&(Gn(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),u&&(Gn(typeof u=="number","internal-error",{appName:e}),f.expirationTime=u),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _0,this.toJSON())}_performRefresh(){return Uf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(n,e){Gn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Vf{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,u=ER(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wje(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new sj(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await ZC(this,this.stsTokenManager.getToken(this.auth,e));return Gn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return Fje(this,e)}reload(){return zje(this)}_assign(e){this!==e&&(Gn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Vf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Gn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await lN(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(vl(this.auth.app))return Promise.reject(Xf(this.auth));const e=await this.getIdToken();return await ZC(this,jje(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,u,f,_,E,S,C;const I=(o=i.displayName)!==null&&o!==void 0?o:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,M=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,L=(f=i.photoURL)!==null&&f!==void 0?f:void 0,U=(_=i.tenantId)!==null&&_!==void 0?_:void 0,B=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,J=(S=i.createdAt)!==null&&S!==void 0?S:void 0,K=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:ne,emailVerified:oe,isAnonymous:se,providerData:le,stsTokenManager:Y}=i;Gn(ne&&Y,e,"internal-error");const Z=_0.fromJSON(this.name,Y);Gn(typeof ne=="string",e,"internal-error"),vg(I,e.name),vg(O,e.name),Gn(typeof oe=="boolean",e,"internal-error"),Gn(typeof se=="boolean",e,"internal-error"),vg(M,e.name),vg(L,e.name),vg(U,e.name),vg(B,e.name),vg(J,e.name),vg(K,e.name);const X=new Vf({uid:ne,auth:e,email:O,emailVerified:oe,displayName:I,isAnonymous:se,photoURL:L,phoneNumber:M,tenantId:U,stsTokenManager:Z,createdAt:J,lastLoginAt:K});return le&&Array.isArray(le)&&(X.providerData=le.map(ie=>Object.assign({},ie))),B&&(X._redirectEventId=B),X}static async _fromIdTokenResponse(e,i,o=!1){const l=new _0;l.updateFromServerResponse(i);const u=new Vf({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await lN(u),u}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Gn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?vie(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),_=new _0;_.updateFromIdToken(o);const E=new Vf({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:f}),S={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new sj(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(E,S),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nJ=new Map;function jf(n){sm(n instanceof Function,"Expected a class definition");let e=nJ.get(n);return e?(sm(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,nJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Sie.type="NONE";const rJ=Sie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(n,e,i){return`firebase:${n}:${e}:${i}`}class y0{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:u}=this.auth;this.fullUserKey=Pk(this.userKey,l.apiKey,u),this.fullPersistenceKey=Pk("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Vf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new y0(jf(rJ),e,o);const l=(await Promise.all(i.map(async S=>{if(await S._isAvailable())return S}))).filter(S=>S);let u=l[0]||jf(rJ);const f=Pk(o,e.config.apiKey,e.name);let _=null;for(const S of i)try{const C=await S._get(f);if(C){const I=Vf._fromJSON(e,C);S!==u&&(_=I),u=S;break}}catch{}const E=l.filter(S=>S._shouldAllowMigration);return!u._shouldAllowMigration||!E.length?new y0(u,e,o):(u=E[0],_&&await u._set(f,_.toJSON()),await Promise.all(i.map(async S=>{if(S!==u)try{await S._remove(f)}catch{}})),new y0(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Cie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(bie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Iie(e))return"Blackberry";if(Aie(e))return"Webos";if(Tie(e))return"Safari";if((e.includes("chrome/")||wie(e))&&!e.includes("edge/"))return"Chrome";if(Rie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function bie(n=pc()){return/firefox\//i.test(n)}function Tie(n=pc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function wie(n=pc()){return/crios\//i.test(n)}function Cie(n=pc()){return/iemobile/i.test(n)}function Rie(n=pc()){return/android/i.test(n)}function Iie(n=pc()){return/blackberry/i.test(n)}function Aie(n=pc()){return/webos/i.test(n)}function R4(n=pc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Kje(n=pc()){var e;return R4(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function qje(){return lVe()&&document.documentMode===10}function Pie(n=pc()){return R4(n)||Rie(n)||Aie(n)||Iie(n)||/windows phone/i.test(n)||Cie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oie(n,e=[]){let i;switch(n){case"Browser":i=iJ(pc());break;case"Worker":i=`${iJ(pc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${lE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yje{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=u=>new Promise((f,_)=>{try{const E=e(u);f(E)}catch(E){_(E)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xje(n,e={}){return um(n,"GET","/v2/passwordPolicy",lm(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jje=6;class Qje{constructor(e){var i,o,l,u;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:Jje,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,u,f,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(o=E.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(u=E.containsUppercaseLetter)!==null&&u!==void 0?u:!0),E.isValid&&(E.isValid=(f=E.containsNumericCharacter)!==null&&f!==void 0?f:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zje{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sJ(this),this.idTokenSubscription=new sJ(this),this.beforeStateQueue=new Yje(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=fie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=jf(i)),this._initializationPromise=this.queue(async()=>{var o,l;if(!this._deleted&&(this.persistenceManager=await y0.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Eie(this,{idToken:e}),o=await Vf._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(vl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(_,_))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!f||f===_)&&(E!=null&&E.user)&&(l=E.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Gn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await lN(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Nje()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(vl(this.app))return Promise.reject(Xf(this));const i=e?Ii(e):null;return i&&Gn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Gn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return vl(this.app)?Promise.reject(Xf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return vl(this.app)?Promise.reject(Xf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(jf(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Xje(this),i=new Qje(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new IR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await $je(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&jf(e)||this._popupRedirectResolver;Gn(i,this,"argument-error"),this.redirectPersistenceManager=await y0.create(this,[jf(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let f=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Gn(_,this,"internal-error"),_.then(()=>{f||u(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,o,l);return()=>{f=!0,E()}}else{const E=e.addObserver(i);return()=>{f=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Gn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Oie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(vl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&Pje(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function e_(n){return Ii(n)}class sJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=_Ve(i=>this.observer=i)}get next(){return Gn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eFe(n){g1=n}function kie(n){return g1.loadJS(n)}function tFe(){return g1.recaptchaEnterpriseScript}function nFe(){return g1.gapiScript}function rFe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class iFe{constructor(){this.enterprise=new sFe}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class sFe{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const oFe="recaptcha-enterprise",Nie="NO_RECAPTCHA";class aFe{constructor(e){this.type=oFe,this.auth=e_(e)}async verify(e="verify",i=!1){async function o(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(f,_)=>{Vje(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const S=new Uje(E);return u.tenantId==null?u._agentRecaptchaConfig=S:u._tenantRecaptchaConfigs[u.tenantId]=S,f(S.siteKey)}}).catch(E=>{_(E)})})}function l(u,f,_){const E=window.grecaptcha;eJ(E)?E.enterprise.ready(()=>{E.enterprise.execute(u,{action:e}).then(S=>{f(S)}).catch(()=>{f(Nie)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new iFe().execute("siteKey",{action:"verify"}):new Promise((u,f)=>{o(this.auth).then(_=>{if(!i&&eJ(window.grecaptcha))l(_,u,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let E=tFe();E.length!==0&&(E+=_),kie(E).then(()=>{l(_,u,f)}).catch(S=>{f(S)})}}).catch(_=>{f(_)})})}}async function oJ(n,e,i,o=!1,l=!1){const u=new aFe(n);let f;if(l)f=Nie;else try{f=await u.verify(i)}catch{f=await u.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,S=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:S,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return o?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function uN(n,e,i,o,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await oJ(n,e,i,i==="getOobCode");return o(n,f)}else return o(n,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await oJ(n,e,i,i==="getOobCode");return o(n,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cFe(n,e){const i=PR(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(nm(u,e??{}))return l;ah(l,"already-initialized")}return i.initialize({options:e})}function lFe(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(jf);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function uFe(n,e,i){const o=e_(n);Gn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,u=Die(e),{host:f,port:_}=dFe(e),E=_===null?"":`:${_}`,S={url:`${u}//${f}${E}/`},C=Object.freeze({host:f,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Gn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Gn(nm(S,o.config.emulator)&&nm(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=S,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,hFe()}function Die(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function dFe(n){const e=Die(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const u=l[1];return{host:u,port:aJ(o.substr(u.length+1))}}else{const[u,f]=o.split(":");return{host:u,port:aJ(f)}}}function aJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function hFe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Uf("not implemented")}_getIdTokenResponse(e){return Uf("not implemented")}_linkToIdToken(e,i){return Uf("not implemented")}_getReauthenticationResolver(e){return Uf("not implemented")}}async function pFe(n,e){return um(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fFe(n,e){return kR(n,"POST","/v1/accounts:signInWithPassword",lm(n,e))}async function xie(n,e){return um(n,"POST","/v1/accounts:sendOobCode",lm(n,e))}async function mFe(n,e){return xie(n,e)}async function gFe(n,e){return xie(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _Fe(n,e){return kR(n,"POST","/v1/accounts:signInWithEmailLink",lm(n,e))}async function yFe(n,e){return kR(n,"POST","/v1/accounts:signInWithEmailLink",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR extends I4{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new eR(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new eR(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uN(e,i,"signInWithPassword",fFe);case"emailLink":return _Fe(e,{email:this._email,oobCode:this._password});default:ah(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uN(e,o,"signUpPassword",pFe);case"emailLink":return yFe(e,{idToken:i,email:this._email,oobCode:this._password});default:ah(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E0(n,e){return kR(n,"POST","/v1/accounts:signInWithIdp",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EFe="http://localhost";class nE extends I4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new nE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):ah("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,u=ER(i,["providerId","signInMethod"]);if(!o||!l)return null;const f=new nE(o,l);return f.idToken=u.idToken||void 0,f.accessToken=u.accessToken||void 0,f.secret=u.secret,f.nonce=u.nonce,f.pendingToken=u.pendingToken||null,f}_getIdTokenResponse(e){const i=this.buildRequest();return E0(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,E0(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,E0(e,i)}buildRequest(){const e={requestUri:EFe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=AR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function SFe(n){const e=rC(iC(n)).link,i=e?rC(iC(e)).deep_link_id:null,o=rC(iC(n)).deep_link_id;return(o?rC(iC(o)).link:null)||o||i||e||n}class A4{constructor(e){var i,o,l,u,f,_;const E=rC(iC(e)),S=(i=E.apiKey)!==null&&i!==void 0?i:null,C=(o=E.oobCode)!==null&&o!==void 0?o:null,I=vFe((l=E.mode)!==null&&l!==void 0?l:null);Gn(S&&C&&I,"argument-error"),this.apiKey=S,this.operation=I,this.code=C,this.continueUrl=(u=E.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(f=E.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=SFe(e);try{return new A4(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(){this.providerId=rb.PROVIDER_ID}static credential(e,i){return eR._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=A4.parseLink(i);return Gn(o,"argument-error"),eR._fromEmailAndCode(e,o.code,o.tenantId)}}rb.PROVIDER_ID="password";rb.EMAIL_PASSWORD_SIGN_IN_METHOD="password";rb.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR extends Lie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg extends NR{constructor(){super("facebook.com")}static credential(e){return nE._fromParams({providerId:Rg.PROVIDER_ID,signInMethod:Rg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rg.credentialFromTaggedObject(e)}static credentialFromError(e){return Rg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Rg.credential(e.oauthAccessToken)}catch{return null}}}Rg.FACEBOOK_SIGN_IN_METHOD="facebook.com";Rg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig extends NR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return nE._fromParams({providerId:Ig.PROVIDER_ID,signInMethod:Ig.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Ig.credentialFromTaggedObject(e)}static credentialFromError(e){return Ig.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return Ig.credential(i,o)}catch{return null}}}Ig.GOOGLE_SIGN_IN_METHOD="google.com";Ig.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag extends NR{constructor(){super("github.com")}static credential(e){return nE._fromParams({providerId:Ag.PROVIDER_ID,signInMethod:Ag.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ag.credentialFromTaggedObject(e)}static credentialFromError(e){return Ag.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ag.credential(e.oauthAccessToken)}catch{return null}}}Ag.GITHUB_SIGN_IN_METHOD="github.com";Ag.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg extends NR{constructor(){super("twitter.com")}static credential(e,i){return nE._fromParams({providerId:Pg.PROVIDER_ID,signInMethod:Pg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Pg.credentialFromTaggedObject(e)}static credentialFromError(e){return Pg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return Pg.credential(i,o)}catch{return null}}}Pg.TWITTER_SIGN_IN_METHOD="twitter.com";Pg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bFe(n,e){return kR(n,"POST","/v1/accounts:signUp",lm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const u=await Vf._fromIdTokenResponse(e,o,l),f=cJ(o);return new rE({user:u,providerId:f,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=cJ(o);return new rE({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function cJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dN extends lh{constructor(e,i,o,l){var u;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,dN.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new dN(e,i,o,l)}}function Mie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?dN._fromErrorAndOperation(n,u,e,o):u})}async function TFe(n,e,i=!1){const o=await ZC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return rE._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wFe(n,e,i=!1){const{auth:o}=n;if(vl(o.app))return Promise.reject(Xf(o));const l="reauthenticate";try{const u=await ZC(n,Mie(o,l,e,n),i);Gn(u.idToken,o,"internal-error");const f=C4(u.idToken);Gn(f,o,"internal-error");const{sub:_}=f;return Gn(n.uid===_,o,"user-mismatch"),rE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&ah(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uie(n,e,i=!1){if(vl(n.app))return Promise.reject(Xf(n));const o="signIn",l=await Mie(n,o,e),u=await rE._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(u.user),u}async function CFe(n,e){return Uie(e_(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vie(n){const e=e_(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function RFe(n,e,i){const o=e_(n);await uN(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",gFe)}async function IFe(n,e,i){if(vl(n.app))return Promise.reject(Xf(n));const o=e_(n),f=await uN(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",bFe).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&Vie(n),E}),_=await rE._fromIdTokenResponse(o,"signIn",f);return await o._updateCurrentUser(_.user),_}function AFe(n,e,i){return vl(n.app)?Promise.reject(Xf(n)):CFe(Ii(n),rb.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&Vie(n),o})}async function jie(n,e){const i=Ii(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await mFe(i.auth,l);u!==n.email&&await n.reload()}function PFe(n,e,i,o){return Ii(n).onIdTokenChanged(e,i,o)}function OFe(n,e,i){return Ii(n).beforeAuthStateChanged(e,i)}function kFe(n,e,i,o){return Ii(n).onAuthStateChanged(e,i,o)}function NFe(n){return Ii(n).signOut()}const hN="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fie{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(hN,"1"),this.storage.removeItem(hN),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DFe=1e3,xFe=10;class Bie extends Fie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Pie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((f,_,E)=>{this.notifyListeners(f,E)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(o);!i&&this.localCache[o]===f||this.notifyListeners(o,f)},u=this.storage.getItem(o);qje()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,xFe):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},DFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Bie.type="LOCAL";const LFe=Bie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wie extends Fie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Wie.type="SESSION";const zie=Wie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MFe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new _1(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:u}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const _=Array.from(f).map(async S=>S(i.origin,u)),E=await MFe(_);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}_1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P4(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UFe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,f;return new Promise((_,E)=>{const S=P4("",20);l.port1.start();const C=setTimeout(()=>{E(new Error("unsupported_event"))},o);f={messageChannel:l,onMessage(I){const O=I;if(O.data.eventId===S)switch(O.data.status){case"ack":clearTimeout(C),u=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(O.data.response);break;default:clearTimeout(C),clearTimeout(u),E(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:S,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wp(){return window}function VFe(n){wp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gie(){return typeof wp().WorkerGlobalScope<"u"&&typeof wp().importScripts=="function"}async function jFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function FFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function BFe(){return Gie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hie="firebaseLocalStorageDb",WFe=1,pN="firebaseLocalStorage",$ie="fbase_key";class DR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function y1(n,e){return n.transaction([pN],e?"readwrite":"readonly").objectStore(pN)}function zFe(){const n=indexedDB.deleteDatabase(Hie);return new DR(n).toPromise()}function oj(){const n=indexedDB.open(Hie,WFe);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(pN,{keyPath:$ie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(pN)?e(o):(o.close(),await zFe(),e(await oj()))})})}async function lJ(n,e,i){const o=y1(n,!0).put({[$ie]:e,value:i});return new DR(o).toPromise()}async function GFe(n,e){const i=y1(n,!1).get(e),o=await new DR(i).toPromise();return o===void 0?null:o.value}function uJ(n,e){const i=y1(n,!0).delete(e);return new DR(i).toPromise()}const HFe=800,$Fe=3;class Kie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await oj(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>$Fe)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=_1._getInstance(BFe()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await jFe(),!this.activeServiceWorker)return;this.sender=new UFe(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||FFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await oj();return await lJ(e,hN,"1"),await uJ(e,hN),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>lJ(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>GFe(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>uJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=y1(l,!1).getAll();return new DR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),HFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Kie.type="LOCAL";const KFe=Kie;new OR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qFe(n,e){return e?jf(e):(Gn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4 extends I4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return E0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return E0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return E0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function YFe(n){return Uie(n.auth,new O4(n),n.bypassAuthState)}function XFe(n){const{auth:e,user:i}=n;return Gn(i,e,"internal-error"),wFe(i,new O4(n),n.bypassAuthState)}async function JFe(n){const{auth:e,user:i}=n;return Gn(i,e,"internal-error"),TFe(i,new O4(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qie{constructor(e,i,o,l,u=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:u,error:f,type:_}=e;if(f){this.reject(f);return}const E={auth:this.auth,requestUri:i,sessionId:o,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(S){this.reject(S)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return YFe;case"linkViaPopup":case"linkViaRedirect":return JFe;case"reauthViaPopup":case"reauthViaRedirect":return XFe;default:ah(this.auth,"internal-error")}}resolve(e){sm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){sm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QFe=new OR(2e3,1e4);class r0 extends qie{constructor(e,i,o,l,u){super(e,i,l,u),this.provider=o,this.authWindow=null,this.pollId=null,r0.currentPopupAction&&r0.currentPopupAction.cancel(),r0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Gn(e,this.auth,"internal-error"),e}async onExecution(){sm(this.filter.length===1,"Popup operations only handle one event");const e=P4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Tp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Tp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Tp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,QFe.get())};e()}}r0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZFe="pendingRedirect",Ok=new Map;class e4e extends qie{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=Ok.get(this.auth._key());if(!e){try{const o=await t4e(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}Ok.set(this.auth._key(),e)}return this.bypassAuthState||Ok.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function t4e(n,e){const i=i4e(e),o=r4e(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function n4e(n,e){Ok.set(n._key(),e)}function r4e(n){return jf(n._redirectPersistence)}function i4e(n){return Pk(ZFe,n.config.apiKey,n.name)}async function s4e(n,e,i=!1){if(vl(n.app))return Promise.reject(Xf(n));const o=e_(n),l=qFe(o,e),f=await new e4e(o,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await o._persistUserIfCurrent(f.user),await o._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4e=10*60*1e3;class a4e{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!c4e(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!Yie(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(Tp(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=o4e&&this.cachedEventUids.clear(),this.cachedEventUids.has(dJ(e))}saveEventToCache(e){this.cachedEventUids.add(dJ(e)),this.lastProcessedEventTime=Date.now()}}function dJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Yie({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function c4e(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Yie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l4e(n,e={}){return um(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u4e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,d4e=/^https?/;async function h4e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await l4e(n);for(const i of e)try{if(p4e(i))return}catch{}ah(n,"unauthorized-domain")}function p4e(n){const e=ij(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===o}if(!d4e.test(i))return!1;if(u4e.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f4e=new OR(3e4,6e4);function hJ(){const n=wp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function m4e(n){return new Promise((e,i)=>{var o,l,u;function f(){hJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{hJ(),i(Tp(n,"network-request-failed"))},timeout:f4e.get()})}if(!((l=(o=wp().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=wp().gapi)===null||u===void 0)&&u.load)f();else{const _=rFe("iframefcb");return wp()[_]=()=>{gapi.load?f():i(Tp(n,"network-request-failed"))},kie(`${nFe()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw kk=null,e})}let kk=null;function g4e(n){return kk=kk||m4e(n),kk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4e=new OR(5e3,15e3),y4e="__/auth/iframe",E4e="emulator/auth/iframe",v4e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},S4e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function b4e(n){const e=n.config;Gn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?w4(e,E4e):`https://${n.config.authDomain}/${y4e}`,o={apiKey:e.apiKey,appName:n.name,v:lE},l=S4e.get(n.config.apiHost);l&&(o.eid=l);const u=n._getFrameworks();return u.length&&(o.fw=u.join(",")),`${i}?${AR(o).slice(1)}`}async function T4e(n){const e=await g4e(n),i=wp().gapi;return Gn(i,n,"internal-error"),e.open({where:document.body,url:b4e(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:v4e,dontclear:!0},o=>new Promise(async(l,u)=>{await o.restyle({setHideOnLeave:!1});const f=Tp(n,"network-request-failed"),_=wp().setTimeout(()=>{u(f)},_4e.get());function E(){wp().clearTimeout(_),l(o)}o.ping(E).then(E,()=>{u(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w4e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},C4e=500,R4e=600,I4e="_blank",A4e="http://localhost";class pJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function P4e(n,e,i,o=C4e,l=R4e){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-o)/2,0).toString();let _="";const E=Object.assign(Object.assign({},w4e),{width:o.toString(),height:l.toString(),top:u,left:f}),S=pc().toLowerCase();i&&(_=wie(S)?I4e:i),bie(S)&&(e=e||A4e,E.scrollbars="yes");const C=Object.entries(E).reduce((O,[M,L])=>`${O}${M}=${L},`,"");if(Kje(S)&&_!=="_self")return O4e(e||"",_),new pJ(null);const I=window.open(e||"",_,C);Gn(I,n,"popup-blocked");try{I.focus()}catch{}return new pJ(I)}function O4e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k4e="__/auth/handler",N4e="emulator/auth/handler",D4e=encodeURIComponent("fac");async function fJ(n,e,i,o,l,u){Gn(n.config.authDomain,n,"auth-domain-config-required"),Gn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:lE,eventId:l};if(e instanceof Lie){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",gVe(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,I]of Object.entries({}))f[C]=I}if(e instanceof NR){const C=e.getScopes().filter(I=>I!=="");C.length>0&&(f.scopes=C.join(","))}n.tenantId&&(f.tid=n.tenantId);const _=f;for(const C of Object.keys(_))_[C]===void 0&&delete _[C];const E=await n._getAppCheckToken(),S=E?`#${D4e}=${encodeURIComponent(E)}`:"";return`${x4e(n)}?${AR(_).slice(1)}${S}`}function x4e({config:n}){return n.emulator?w4(n,N4e):`https://${n.authDomain}/${k4e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UU="webStorageSupport";class L4e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=zie,this._completeRedirectFn=s4e,this._overrideRedirectResult=n4e}async _openPopup(e,i,o,l){var u;sm((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const f=await fJ(e,i,o,ij(),l);return P4e(e,f,P4())}async _openRedirect(e,i,o,l){await this._originValidation(e);const u=await fJ(e,i,o,ij(),l);return VFe(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(sm(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await T4e(e),o=new a4e(e);return i.register("authEvent",l=>(Gn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(UU,{type:UU},l=>{var u;const f=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[UU];f!==void 0&&i(!!f),ah(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=h4e(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Pie()||Tie()||R4()}}const M4e=L4e;var mJ="@firebase/auth",gJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U4e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Gn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function j4e(n){Wg(new rm("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:f,authDomain:_}=o.options;Gn(f&&!f.includes(":"),"invalid-api-key",{appName:o.name});const E={apiKey:f,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Oie(n)},S=new Zje(o,l,u,E);return lFe(S,i),S},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),Wg(new rm("auth-internal",e=>{const i=e_(e.getProvider("auth").getImmediate());return(o=>new U4e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),id(mJ,gJ,V4e(n)),id(mJ,gJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F4e=5*60,B4e=oie("authIdTokenMaxAge")||F4e;let _J=null;const W4e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>B4e)return;const l=i==null?void 0:i.token;_J!==l&&(_J=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function E1(n=m1()){const e=PR(n,"auth");if(e.isInitialized())return e.getImmediate();const i=cFe(n,{popupRedirectResolver:M4e,persistence:[KFe,LFe,zie]}),o=oie("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const f=W4e(u.toString());OFe(i,f,()=>f(i.currentUser)),PFe(i,_=>f(_))}}const l=iie("auth");return l&&uFe(i,`http://${l}`),i}function z4e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}eFe({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const u=Tp("internal-error");u.customData=l,i(u)},o.type="text/javascript",o.charset="UTF-8",z4e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});j4e("Browser");var yJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ug,Xie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Y,Z){function X(){}X.prototype=Z.prototype,Y.D=Z.prototype,Y.prototype=new X,Y.prototype.constructor=Y,Y.C=function(ie,de,ue){for(var pe=Array(arguments.length-2),ke=2;ke<arguments.length;ke++)pe[ke-2]=arguments[ke];return Z.prototype[de].apply(ie,pe)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Y,Z,X){X||(X=0);var ie=Array(16);if(typeof Z=="string")for(var de=0;16>de;++de)ie[de]=Z.charCodeAt(X++)|Z.charCodeAt(X++)<<8|Z.charCodeAt(X++)<<16|Z.charCodeAt(X++)<<24;else for(de=0;16>de;++de)ie[de]=Z[X++]|Z[X++]<<8|Z[X++]<<16|Z[X++]<<24;Z=Y.g[0],X=Y.g[1],de=Y.g[2];var ue=Y.g[3],pe=Z+(ue^X&(de^ue))+ie[0]+3614090360&4294967295;Z=X+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(X^de))+ie[1]+3905402710&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(X^ue&(Z^X))+ie[2]+606105819&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=X+(Z^de&(ue^Z))+ie[3]+3250441966&4294967295,X=de+(pe<<22&4294967295|pe>>>10),pe=Z+(ue^X&(de^ue))+ie[4]+4118548399&4294967295,Z=X+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(X^de))+ie[5]+1200080426&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(X^ue&(Z^X))+ie[6]+2821735955&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=X+(Z^de&(ue^Z))+ie[7]+4249261313&4294967295,X=de+(pe<<22&4294967295|pe>>>10),pe=Z+(ue^X&(de^ue))+ie[8]+1770035416&4294967295,Z=X+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(X^de))+ie[9]+2336552879&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(X^ue&(Z^X))+ie[10]+4294925233&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=X+(Z^de&(ue^Z))+ie[11]+2304563134&4294967295,X=de+(pe<<22&4294967295|pe>>>10),pe=Z+(ue^X&(de^ue))+ie[12]+1804603682&4294967295,Z=X+(pe<<7&4294967295|pe>>>25),pe=ue+(de^Z&(X^de))+ie[13]+4254626195&4294967295,ue=Z+(pe<<12&4294967295|pe>>>20),pe=de+(X^ue&(Z^X))+ie[14]+2792965006&4294967295,de=ue+(pe<<17&4294967295|pe>>>15),pe=X+(Z^de&(ue^Z))+ie[15]+1236535329&4294967295,X=de+(pe<<22&4294967295|pe>>>10),pe=Z+(de^ue&(X^de))+ie[1]+4129170786&4294967295,Z=X+(pe<<5&4294967295|pe>>>27),pe=ue+(X^de&(Z^X))+ie[6]+3225465664&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^X&(ue^Z))+ie[11]+643717713&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=X+(ue^Z&(de^ue))+ie[0]+3921069994&4294967295,X=de+(pe<<20&4294967295|pe>>>12),pe=Z+(de^ue&(X^de))+ie[5]+3593408605&4294967295,Z=X+(pe<<5&4294967295|pe>>>27),pe=ue+(X^de&(Z^X))+ie[10]+38016083&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^X&(ue^Z))+ie[15]+3634488961&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=X+(ue^Z&(de^ue))+ie[4]+3889429448&4294967295,X=de+(pe<<20&4294967295|pe>>>12),pe=Z+(de^ue&(X^de))+ie[9]+568446438&4294967295,Z=X+(pe<<5&4294967295|pe>>>27),pe=ue+(X^de&(Z^X))+ie[14]+3275163606&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^X&(ue^Z))+ie[3]+4107603335&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=X+(ue^Z&(de^ue))+ie[8]+1163531501&4294967295,X=de+(pe<<20&4294967295|pe>>>12),pe=Z+(de^ue&(X^de))+ie[13]+2850285829&4294967295,Z=X+(pe<<5&4294967295|pe>>>27),pe=ue+(X^de&(Z^X))+ie[2]+4243563512&4294967295,ue=Z+(pe<<9&4294967295|pe>>>23),pe=de+(Z^X&(ue^Z))+ie[7]+1735328473&4294967295,de=ue+(pe<<14&4294967295|pe>>>18),pe=X+(ue^Z&(de^ue))+ie[12]+2368359562&4294967295,X=de+(pe<<20&4294967295|pe>>>12),pe=Z+(X^de^ue)+ie[5]+4294588738&4294967295,Z=X+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^X^de)+ie[8]+2272392833&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^X)+ie[11]+1839030562&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=X+(de^ue^Z)+ie[14]+4259657740&4294967295,X=de+(pe<<23&4294967295|pe>>>9),pe=Z+(X^de^ue)+ie[1]+2763975236&4294967295,Z=X+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^X^de)+ie[4]+1272893353&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^X)+ie[7]+4139469664&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=X+(de^ue^Z)+ie[10]+3200236656&4294967295,X=de+(pe<<23&4294967295|pe>>>9),pe=Z+(X^de^ue)+ie[13]+681279174&4294967295,Z=X+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^X^de)+ie[0]+3936430074&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^X)+ie[3]+3572445317&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=X+(de^ue^Z)+ie[6]+76029189&4294967295,X=de+(pe<<23&4294967295|pe>>>9),pe=Z+(X^de^ue)+ie[9]+3654602809&4294967295,Z=X+(pe<<4&4294967295|pe>>>28),pe=ue+(Z^X^de)+ie[12]+3873151461&4294967295,ue=Z+(pe<<11&4294967295|pe>>>21),pe=de+(ue^Z^X)+ie[15]+530742520&4294967295,de=ue+(pe<<16&4294967295|pe>>>16),pe=X+(de^ue^Z)+ie[2]+3299628645&4294967295,X=de+(pe<<23&4294967295|pe>>>9),pe=Z+(de^(X|~ue))+ie[0]+4096336452&4294967295,Z=X+(pe<<6&4294967295|pe>>>26),pe=ue+(X^(Z|~de))+ie[7]+1126891415&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~X))+ie[14]+2878612391&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=X+(ue^(de|~Z))+ie[5]+4237533241&4294967295,X=de+(pe<<21&4294967295|pe>>>11),pe=Z+(de^(X|~ue))+ie[12]+1700485571&4294967295,Z=X+(pe<<6&4294967295|pe>>>26),pe=ue+(X^(Z|~de))+ie[3]+2399980690&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~X))+ie[10]+4293915773&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=X+(ue^(de|~Z))+ie[1]+2240044497&4294967295,X=de+(pe<<21&4294967295|pe>>>11),pe=Z+(de^(X|~ue))+ie[8]+1873313359&4294967295,Z=X+(pe<<6&4294967295|pe>>>26),pe=ue+(X^(Z|~de))+ie[15]+4264355552&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~X))+ie[6]+2734768916&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=X+(ue^(de|~Z))+ie[13]+1309151649&4294967295,X=de+(pe<<21&4294967295|pe>>>11),pe=Z+(de^(X|~ue))+ie[4]+4149444226&4294967295,Z=X+(pe<<6&4294967295|pe>>>26),pe=ue+(X^(Z|~de))+ie[11]+3174756917&4294967295,ue=Z+(pe<<10&4294967295|pe>>>22),pe=de+(Z^(ue|~X))+ie[2]+718787259&4294967295,de=ue+(pe<<15&4294967295|pe>>>17),pe=X+(ue^(de|~Z))+ie[9]+3951481745&4294967295,Y.g[0]=Y.g[0]+Z&4294967295,Y.g[1]=Y.g[1]+(de+(pe<<21&4294967295|pe>>>11))&4294967295,Y.g[2]=Y.g[2]+de&4294967295,Y.g[3]=Y.g[3]+ue&4294967295}o.prototype.u=function(Y,Z){Z===void 0&&(Z=Y.length);for(var X=Z-this.blockSize,ie=this.B,de=this.h,ue=0;ue<Z;){if(de==0)for(;ue<=X;)l(this,Y,ue),ue+=this.blockSize;if(typeof Y=="string"){for(;ue<Z;)if(ie[de++]=Y.charCodeAt(ue++),de==this.blockSize){l(this,ie),de=0;break}}else for(;ue<Z;)if(ie[de++]=Y[ue++],de==this.blockSize){l(this,ie),de=0;break}}this.h=de,this.o+=Z},o.prototype.v=function(){var Y=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Y[0]=128;for(var Z=1;Z<Y.length-8;++Z)Y[Z]=0;var X=8*this.o;for(Z=Y.length-8;Z<Y.length;++Z)Y[Z]=X&255,X/=256;for(this.u(Y),Y=Array(16),Z=X=0;4>Z;++Z)for(var ie=0;32>ie;ie+=8)Y[X++]=this.g[Z]>>>ie&255;return Y};function u(Y,Z){var X=_;return Object.prototype.hasOwnProperty.call(X,Y)?X[Y]:X[Y]=Z(Y)}function f(Y,Z){this.h=Z;for(var X=[],ie=!0,de=Y.length-1;0<=de;de--){var ue=Y[de]|0;ie&&ue==Z||(X[de]=ue,ie=!1)}this.g=X}var _={};function E(Y){return-128<=Y&&128>Y?u(Y,function(Z){return new f([Z|0],0>Z?-1:0)}):new f([Y|0],0>Y?-1:0)}function S(Y){if(isNaN(Y)||!isFinite(Y))return I;if(0>Y)return B(S(-Y));for(var Z=[],X=1,ie=0;Y>=X;ie++)Z[ie]=Y/X|0,X*=4294967296;return new f(Z,0)}function C(Y,Z){if(Y.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(Y.charAt(0)=="-")return B(C(Y.substring(1),Z));if(0<=Y.indexOf("-"))throw Error('number format error: interior "-" character');for(var X=S(Math.pow(Z,8)),ie=I,de=0;de<Y.length;de+=8){var ue=Math.min(8,Y.length-de),pe=parseInt(Y.substring(de,de+ue),Z);8>ue?(ue=S(Math.pow(Z,ue)),ie=ie.j(ue).add(S(pe))):(ie=ie.j(X),ie=ie.add(S(pe)))}return ie}var I=E(0),O=E(1),M=E(16777216);n=f.prototype,n.m=function(){if(U(this))return-B(this).m();for(var Y=0,Z=1,X=0;X<this.g.length;X++){var ie=this.i(X);Y+=(0<=ie?ie:4294967296+ie)*Z,Z*=4294967296}return Y},n.toString=function(Y){if(Y=Y||10,2>Y||36<Y)throw Error("radix out of range: "+Y);if(L(this))return"0";if(U(this))return"-"+B(this).toString(Y);for(var Z=S(Math.pow(Y,6)),X=this,ie="";;){var de=oe(X,Z).g;X=J(X,de.j(Z));var ue=((0<X.g.length?X.g[0]:X.h)>>>0).toString(Y);if(X=de,L(X))return ue+ie;for(;6>ue.length;)ue="0"+ue;ie=ue+ie}},n.i=function(Y){return 0>Y?0:Y<this.g.length?this.g[Y]:this.h};function L(Y){if(Y.h!=0)return!1;for(var Z=0;Z<Y.g.length;Z++)if(Y.g[Z]!=0)return!1;return!0}function U(Y){return Y.h==-1}n.l=function(Y){return Y=J(this,Y),U(Y)?-1:L(Y)?0:1};function B(Y){for(var Z=Y.g.length,X=[],ie=0;ie<Z;ie++)X[ie]=~Y.g[ie];return new f(X,~Y.h).add(O)}n.abs=function(){return U(this)?B(this):this},n.add=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),X=[],ie=0,de=0;de<=Z;de++){var ue=ie+(this.i(de)&65535)+(Y.i(de)&65535),pe=(ue>>>16)+(this.i(de)>>>16)+(Y.i(de)>>>16);ie=pe>>>16,ue&=65535,pe&=65535,X[de]=pe<<16|ue}return new f(X,X[X.length-1]&-2147483648?-1:0)};function J(Y,Z){return Y.add(B(Z))}n.j=function(Y){if(L(this)||L(Y))return I;if(U(this))return U(Y)?B(this).j(B(Y)):B(B(this).j(Y));if(U(Y))return B(this.j(B(Y)));if(0>this.l(M)&&0>Y.l(M))return S(this.m()*Y.m());for(var Z=this.g.length+Y.g.length,X=[],ie=0;ie<2*Z;ie++)X[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var de=0;de<Y.g.length;de++){var ue=this.i(ie)>>>16,pe=this.i(ie)&65535,ke=Y.i(de)>>>16,xe=Y.i(de)&65535;X[2*ie+2*de]+=pe*xe,K(X,2*ie+2*de),X[2*ie+2*de+1]+=ue*xe,K(X,2*ie+2*de+1),X[2*ie+2*de+1]+=pe*ke,K(X,2*ie+2*de+1),X[2*ie+2*de+2]+=ue*ke,K(X,2*ie+2*de+2)}for(ie=0;ie<Z;ie++)X[ie]=X[2*ie+1]<<16|X[2*ie];for(ie=Z;ie<2*Z;ie++)X[ie]=0;return new f(X,0)};function K(Y,Z){for(;(Y[Z]&65535)!=Y[Z];)Y[Z+1]+=Y[Z]>>>16,Y[Z]&=65535,Z++}function ne(Y,Z){this.g=Y,this.h=Z}function oe(Y,Z){if(L(Z))throw Error("division by zero");if(L(Y))return new ne(I,I);if(U(Y))return Z=oe(B(Y),Z),new ne(B(Z.g),B(Z.h));if(U(Z))return Z=oe(Y,B(Z)),new ne(B(Z.g),Z.h);if(30<Y.g.length){if(U(Y)||U(Z))throw Error("slowDivide_ only works with positive integers.");for(var X=O,ie=Z;0>=ie.l(Y);)X=se(X),ie=se(ie);var de=le(X,1),ue=le(ie,1);for(ie=le(ie,2),X=le(X,2);!L(ie);){var pe=ue.add(ie);0>=pe.l(Y)&&(de=de.add(X),ue=pe),ie=le(ie,1),X=le(X,1)}return Z=J(Y,de.j(Z)),new ne(de,Z)}for(de=I;0<=Y.l(Z);){for(X=Math.max(1,Math.floor(Y.m()/Z.m())),ie=Math.ceil(Math.log(X)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),ue=S(X),pe=ue.j(Z);U(pe)||0<pe.l(Y);)X-=ie,ue=S(X),pe=ue.j(Z);L(ue)&&(ue=O),de=de.add(ue),Y=J(Y,pe)}return new ne(de,Y)}n.A=function(Y){return oe(this,Y).h},n.and=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),X=[],ie=0;ie<Z;ie++)X[ie]=this.i(ie)&Y.i(ie);return new f(X,this.h&Y.h)},n.or=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),X=[],ie=0;ie<Z;ie++)X[ie]=this.i(ie)|Y.i(ie);return new f(X,this.h|Y.h)},n.xor=function(Y){for(var Z=Math.max(this.g.length,Y.g.length),X=[],ie=0;ie<Z;ie++)X[ie]=this.i(ie)^Y.i(ie);return new f(X,this.h^Y.h)};function se(Y){for(var Z=Y.g.length+1,X=[],ie=0;ie<Z;ie++)X[ie]=Y.i(ie)<<1|Y.i(ie-1)>>>31;return new f(X,Y.h)}function le(Y,Z){var X=Z>>5;Z%=32;for(var ie=Y.g.length-X,de=[],ue=0;ue<ie;ue++)de[ue]=0<Z?Y.i(ue+X)>>>Z|Y.i(ue+X+1)<<32-Z:Y.i(ue+X);return new f(de,Y.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,Xie=o,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=S,f.fromString=C,Ug=f}).apply(typeof yJ<"u"?yJ:typeof self<"u"?self:typeof window<"u"?window:{});var YO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Jie,sC,Qie,Nk,aj,Zie,ese,tse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,re){return A==Array.prototype||A==Object.prototype||(A[z]=re.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof YO=="object"&&YO];for(var z=0;z<A.length;++z){var re=A[z];if(re&&re.Math==Math)return re}throw Error("Cannot find global object")}var o=i(this);function l(A,z){if(z)e:{var re=o;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var Xe=A[ge];if(!(Xe in re))break e;re=re[Xe]}A=A[A.length-1],ge=re[A],z=z(ge),z!=ge&&z!=null&&e(re,A,{configurable:!0,writable:!0,value:z})}}function u(A,z){A instanceof String&&(A+="");var re=0,ge=!1,Xe={next:function(){if(!ge&&re<A.length){var ut=re++;return{value:z(ut,A[ut]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return Xe[Symbol.iterator]=function(){return Xe},Xe}l("Array.prototype.values",function(A){return A||function(){return u(this,function(z,re){return re})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},_=this||self;function E(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function S(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function C(A,z,re){return A.call.apply(A.bind,arguments)}function I(A,z,re){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var Xe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xe,ge),A.apply(z,Xe)}}return function(){return A.apply(z,arguments)}}function O(A,z,re){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:I,O.apply(null,arguments)}function M(A,z){var re=Array.prototype.slice.call(arguments,1);return function(){var ge=re.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function L(A,z){function re(){}re.prototype=z.prototype,A.aa=z.prototype,A.prototype=new re,A.prototype.constructor=A,A.Qb=function(ge,Xe,ut){for(var Gt=Array(arguments.length-2),ii=2;ii<arguments.length;ii++)Gt[ii-2]=arguments[ii];return z.prototype[Xe].apply(ge,Gt)}}function U(A){const z=A.length;if(0<z){const re=Array(z);for(let ge=0;ge<z;ge++)re[ge]=A[ge];return re}return[]}function B(A,z){for(let re=1;re<arguments.length;re++){const ge=arguments[re];if(E(ge)){const Xe=A.length||0,ut=ge.length||0;A.length=Xe+ut;for(let Gt=0;Gt<ut;Gt++)A[Xe+Gt]=ge[Gt]}else A.push(ge)}}class J{constructor(z,re){this.i=z,this.j=re,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function K(A){return/^[\s\xa0]*$/.test(A)}function ne(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function oe(A){return oe[" "](A),A}oe[" "]=function(){};var se=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function le(A,z,re){for(const ge in A)z.call(re,A[ge],ge,A)}function Y(A,z){for(const re in A)z.call(void 0,A[re],re,A)}function Z(A){const z={};for(const re in A)z[re]=A[re];return z}const X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(A,z){let re,ge;for(let Xe=1;Xe<arguments.length;Xe++){ge=arguments[Xe];for(re in ge)A[re]=ge[re];for(let ut=0;ut<X.length;ut++)re=X[ut],Object.prototype.hasOwnProperty.call(ge,re)&&(A[re]=ge[re])}}function de(A){var z=1;A=A.split(":");const re=[];for(;0<z&&A.length;)re.push(A.shift()),z--;return A.length&&re.push(A.join(":")),re}function ue(A){_.setTimeout(()=>{throw A},0)}function pe(){var A=Se;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class ke{constructor(){this.h=this.g=null}add(z,re){const ge=xe.get();ge.set(z,re),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var xe=new J(()=>new je,A=>A.reset());class je{constructor(){this.next=this.g=this.h=null}set(z,re){this.h=z,this.g=re,this.next=null}reset(){this.next=this.g=this.h=null}}let Oe,we=!1,Se=new ke,Be=()=>{const A=_.Promise.resolve(void 0);Oe=()=>{A.then(Ee)}};var Ee=()=>{for(var A;A=pe();){try{A.h.call(A.g)}catch(re){ue(re)}var z=xe;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}we=!1};function Ce(){this.s=this.s,this.C=this.C}Ce.prototype.s=!1,Ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pe(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var Me=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const re=()=>{};_.addEventListener("test",re,z),_.removeEventListener("test",re,z)}catch{}return A}();function We(A,z){if(Pe.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var re=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(se){e:{try{oe(z.nodeName);var Xe=!0;break e}catch{}Xe=!1}Xe||(z=null)}}else re=="mouseover"?z=A.fromElement:re=="mouseout"&&(z=A.toElement);this.relatedTarget=z,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:He[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&We.aa.h.call(this)}}L(We,Pe);var He={2:"touch",3:"pen",4:"mouse"};We.prototype.h=function(){We.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var qe="closure_listenable_"+(1e6*Math.random()|0),rt=0;function et(A,z,re,ge,Xe){this.listener=A,this.proxy=null,this.src=z,this.type=re,this.capture=!!ge,this.ha=Xe,this.key=++rt,this.da=this.fa=!1}function _t(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function on(A){this.src=A,this.g={},this.h=0}on.prototype.add=function(A,z,re,ge,Xe){var ut=A.toString();A=this.g[ut],A||(A=this.g[ut]=[],this.h++);var Gt=kt(A,z,ge,Xe);return-1<Gt?(z=A[Gt],re||(z.fa=!1)):(z=new et(z,this.src,ut,!!ge,Xe),z.fa=re,A.push(z)),z};function dt(A,z){var re=z.type;if(re in A.g){var ge=A.g[re],Xe=Array.prototype.indexOf.call(ge,z,void 0),ut;(ut=0<=Xe)&&Array.prototype.splice.call(ge,Xe,1),ut&&(_t(z),A.g[re].length==0&&(delete A.g[re],A.h--))}}function kt(A,z,re,ge){for(var Xe=0;Xe<A.length;++Xe){var ut=A[Xe];if(!ut.da&&ut.listener==z&&ut.capture==!!re&&ut.ha==ge)return Xe}return-1}var ct="closure_lm_"+(1e6*Math.random()|0),Ut={};function fn(A,z,re,ge,Xe){if(Array.isArray(z)){for(var ut=0;ut<z.length;ut++)fn(A,z[ut],re,ge,Xe);return null}return re=dn(re),A&&A[qe]?A.K(z,re,S(ge)?!!ge.capture:!1,Xe):Wt(A,z,re,!1,ge,Xe)}function Wt(A,z,re,ge,Xe,ut){if(!z)throw Error("Invalid event type");var Gt=S(Xe)?!!Xe.capture:!!Xe,ii=St(A);if(ii||(A[ct]=ii=new on(A)),re=ii.add(z,re,ge,Gt,ut),re.proxy)return re;if(ge=Te(),re.proxy=ge,ge.src=A,ge.listener=re,A.addEventListener)Me||(Xe=Gt),Xe===void 0&&(Xe=!1),A.addEventListener(z.toString(),ge,Xe);else if(A.attachEvent)A.attachEvent(Et(z.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return re}function Te(){function A(re){return z.call(A.src,A.listener,re)}const z=vt;return A}function Ve(A,z,re,ge,Xe){if(Array.isArray(z))for(var ut=0;ut<z.length;ut++)Ve(A,z[ut],re,ge,Xe);else ge=S(ge)?!!ge.capture:!!ge,re=dn(re),A&&A[qe]?(A=A.i,z=String(z).toString(),z in A.g&&(ut=A.g[z],re=kt(ut,re,ge,Xe),-1<re&&(_t(ut[re]),Array.prototype.splice.call(ut,re,1),ut.length==0&&(delete A.g[z],A.h--)))):A&&(A=St(A))&&(z=A.g[z.toString()],A=-1,z&&(A=kt(z,re,ge,Xe)),(re=-1<A?z[A]:null)&&$e(re))}function $e(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[qe])dt(z.i,A);else{var re=A.type,ge=A.proxy;z.removeEventListener?z.removeEventListener(re,ge,A.capture):z.detachEvent?z.detachEvent(Et(re),ge):z.addListener&&z.removeListener&&z.removeListener(ge),(re=St(z))?(dt(re,A),re.h==0&&(re.src=null,z[ct]=null)):_t(A)}}}function Et(A){return A in Ut?Ut[A]:Ut[A]="on"+A}function vt(A,z){if(A.da)A=!0;else{z=new We(z,this);var re=A.listener,ge=A.ha||A.src;A.fa&&$e(A),A=re.call(ge,z)}return A}function St(A){return A=A[ct],A instanceof on?A:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function dn(A){return typeof A=="function"?A:(A[zt]||(A[zt]=function(z){return A.handleEvent(z)}),A[zt])}function vn(){Ce.call(this),this.i=new on(this),this.M=this,this.F=null}L(vn,Ce),vn.prototype[qe]=!0,vn.prototype.removeEventListener=function(A,z,re,ge){Ve(this,A,z,re,ge)};function nn(A,z){var re,ge=A.F;if(ge)for(re=[];ge;ge=ge.F)re.push(ge);if(A=A.M,ge=z.type||z,typeof z=="string")z=new Pe(z,A);else if(z instanceof Pe)z.target=z.target||A;else{var Xe=z;z=new Pe(ge,A),ie(z,Xe)}if(Xe=!0,re)for(var ut=re.length-1;0<=ut;ut--){var Gt=z.g=re[ut];Xe=Ct(Gt,ge,!0,z)&&Xe}if(Gt=z.g=A,Xe=Ct(Gt,ge,!0,z)&&Xe,Xe=Ct(Gt,ge,!1,z)&&Xe,re)for(ut=0;ut<re.length;ut++)Gt=z.g=re[ut],Xe=Ct(Gt,ge,!1,z)&&Xe}vn.prototype.N=function(){if(vn.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var re=A.g[z],ge=0;ge<re.length;ge++)_t(re[ge]);delete A.g[z],A.h--}}this.F=null},vn.prototype.K=function(A,z,re,ge){return this.i.add(String(A),z,!1,re,ge)},vn.prototype.L=function(A,z,re,ge){return this.i.add(String(A),z,!0,re,ge)};function Ct(A,z,re,ge){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var Xe=!0,ut=0;ut<z.length;++ut){var Gt=z[ut];if(Gt&&!Gt.da&&Gt.capture==re){var ii=Gt.listener,Ei=Gt.ha||Gt.src;Gt.fa&&dt(A.i,Gt),Xe=ii.call(Ei,ge)!==!1&&Xe}}return Xe&&!ge.defaultPrevented}function sr(A,z,re){if(typeof A=="function")re&&(A=O(A,re));else if(A&&typeof A.handleEvent=="function")A=O(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:_.setTimeout(A,z||0)}function xt(A){A.g=sr(()=>{A.g=null,A.i&&(A.i=!1,xt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class qt extends Ce{constructor(z,re){super(),this.m=z,this.l=re,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:xt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Tr(A){Ce.call(this),this.h=A,this.g={}}L(Tr,Ce);var Pi=[];function As(A){le(A.g,function(z,re){this.g.hasOwnProperty(re)&&$e(z)},A),A.g={}}Tr.prototype.N=function(){Tr.aa.N.call(this),As(this)},Tr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var cr=_.JSON.stringify,zn=_.JSON.parse,ia=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function Ks(){}Ks.prototype.h=null;function ao(A){return A.h||(A.h=A.i())}function jc(){}var Ps={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Va(){Pe.call(this,"d")}L(Va,Pe);function Fo(){Pe.call(this,"c")}L(Fo,Pe);var ja={},fc=null;function Ol(){return fc=fc||new vn}ja.La="serverreachability";function Fa(A){Pe.call(this,ja.La,A)}L(Fa,Pe);function mc(A){const z=Ol();nn(z,new Fa(z))}ja.STAT_EVENT="statevent";function _o(A,z){Pe.call(this,ja.STAT_EVENT,A),this.stat=z}L(_o,Pe);function ji(A){const z=Ol();nn(z,new _o(z,A))}ja.Ma="timingevent";function ds(A,z){Pe.call(this,ja.Ma,A),this.size=z}L(ds,Pe);function sa(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},z)}function kl(){this.g=!0}kl.prototype.xa=function(){this.g=!1};function Ba(A,z,re,ge,Xe,ut){A.info(function(){if(A.g)if(ut)for(var Gt="",ii=ut.split("&"),Ei=0;Ei<ii.length;Ei++){var Nr=ii[Ei].split("=");if(1<Nr.length){var co=Nr[0];Nr=Nr[1];var ks=co.split("_");Gt=2<=ks.length&&ks[1]=="type"?Gt+(co+"="+Nr+"&"):Gt+(co+"=redacted&")}}else Gt=null;else Gt=ut;return"XMLHTTP REQ ("+ge+") [attempt "+Xe+"]: "+z+`
`+re+`
`+Gt})}function Bo(A,z,re,ge,Xe,ut,Gt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+Xe+"]: "+z+`
`+re+`
`+ut+" "+Gt})}function mt(A,z,re,ge){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+Or(A,re)+(ge?" "+ge:"")})}function hn(A,z){A.info(function(){return"TIMEOUT: "+z})}kl.prototype.info=function(){};function Or(A,z){if(!A.g)return z;if(!z)return null;try{var re=JSON.parse(z);if(re){for(A=0;A<re.length;A++)if(Array.isArray(re[A])){var ge=re[A];if(!(2>ge.length)){var Xe=ge[1];if(Array.isArray(Xe)&&!(1>Xe.length)){var ut=Xe[0];if(ut!="noop"&&ut!="stop"&&ut!="close")for(var Gt=1;Gt<Xe.length;Gt++)Xe[Gt]=""}}}}return cr(re)}catch{return z}}var Oi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Nl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Xi;function Dl(){}L(Dl,Ks),Dl.prototype.g=function(){return new XMLHttpRequest},Dl.prototype.i=function(){return{}},Xi=new Dl;function Wo(A,z,re,ge){this.j=A,this.i=z,this.l=re,this.R=ge||1,this.U=new Tr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new pu}function pu(){this.i=null,this.g="",this.h=!1}var xl={},oa={};function fu(A,z,re){A.L=1,A.v=yc(aa(z)),A.m=re,A.P=!0,gc(A,null)}function gc(A,z){A.F=Date.now(),Sn(A),A.A=aa(A.v);var re=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),vu(re.i,"t",ge),A.C=0,re=A.j.J,A.h=new pu,A.g=_E(A.j,re?z:null,!A.m),0<A.O&&(A.M=new qt(O(A.Y,A,A.g),A.O)),z=A.U,re=A.g,ge=A.ca;var Xe="readystatechange";Array.isArray(Xe)||(Xe&&(Pi[0]=Xe.toString()),Xe=Pi);for(var ut=0;ut<Xe.length;ut++){var Gt=fn(re,Xe[ut],ge||z.handleEvent,!1,z.h||z);if(!Gt)break;z.g[Gt.key]=Gt}z=A.H?Z(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),mc(),Ba(A.i,A.u,A.A,A.l,A.R,A.m)}Wo.prototype.ca=function(A){A=A.target;const z=this.M;z&&Ni(A)==3?z.j():this.Y(A)},Wo.prototype.Y=function(A){try{if(A==this.g)e:{const ks=Ni(this.g);var z=this.g.Ba();const Ec=this.g.Z();if(!(3>ks)&&(ks!=3||this.g&&(this.h.h||this.g.oa()||qs(this.g)))){this.J||ks!=4||z==7||(z==8||0>=Ec?mc(3):mc(2)),Fc(this);var re=this.g.Z();this.X=re;t:if(Fi(this)){var ge=qs(this.g);A="";var Xe=ge.length,ut=Ni(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Wa(this),Ll(this);var Gt="";break t}this.h.i=new _.TextDecoder}for(z=0;z<Xe;z++)this.h.h=!0,A+=this.h.i.decode(ge[z],{stream:!(ut&&z==Xe-1)});ge.length=0,this.h.g+=A,this.C=0,Gt=this.h.g}else Gt=this.g.oa();if(this.o=re==200,Bo(this.i,this.u,this.A,this.l,this.R,ks,re),this.o){if(this.T&&!this.K){t:{if(this.g){var ii,Ei=this.g;if((ii=Ei.g?Ei.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ii)){var Nr=ii;break t}}Nr=null}if(re=Nr)mt(this.i,this.l,re,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Np(this,re);else{this.o=!1,this.s=3,ji(12),Wa(this),Ll(this);break e}}if(this.P){re=!0;let _a;for(;!this.J&&this.C<Gt.length;)if(_a=hs(this,Gt),_a==oa){ks==4&&(this.s=4,ji(14),re=!1),mt(this.i,this.l,null,"[Incomplete Response]");break}else if(_a==xl){this.s=4,ji(15),mt(this.i,this.l,Gt,"[Invalid Chunk]"),re=!1;break}else mt(this.i,this.l,_a,null),Np(this,_a);if(Fi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ks!=4||Gt.length!=0||this.h.h||(this.s=1,ji(16),re=!1),this.o=this.o&&re,!re)mt(this.i,this.l,Gt,"[Invalid Chunked Response]"),Wa(this),Ll(this);else if(0<Gt.length&&!this.W){this.W=!0;var co=this.j;co.g==this&&co.ba&&!co.M&&(co.j.info("Great, no buffering proxy detected. Bytes received: "+Gt.length),i_(co),co.M=!0,ji(11))}}else mt(this.i,this.l,Gt,null),Np(this,Gt);ks==4&&Wa(this),this.o&&!this.J&&(ks==4?Em(this.j,this):(this.o=!1,Sn(this)))}else pa(this.g),re==400&&0<Gt.indexOf("Unknown SID")?(this.s=3,ji(12)):(this.s=0,ji(13)),Wa(this),Ll(this)}}}catch{}finally{}};function Fi(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function hs(A,z){var re=A.C,ge=z.indexOf(`
`,re);return ge==-1?oa:(re=Number(z.substring(re,ge)),isNaN(re)?xl:(ge+=1,ge+re>z.length?oa:(z=z.slice(ge,ge+re),A.C=ge+re,z)))}Wo.prototype.cancel=function(){this.J=!0,Wa(this)};function Sn(A){A.S=Date.now()+A.I,ki(A,A.I)}function ki(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=sa(O(A.ba,A),z)}function Fc(A){A.B&&(_.clearTimeout(A.B),A.B=null)}Wo.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(hn(this.i,this.A),this.L!=2&&(mc(),ji(17)),Wa(this),this.s=2,Ll(this)):ki(this,this.S-A)};function Ll(A){A.j.G==0||A.J||Em(A.j,A)}function Wa(A){Fc(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,As(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function Np(A,z){try{var re=A.j;if(re.G!=0&&(re.g==A||yo(re.h,A))){if(!A.K&&yo(re.h,A)&&re.G==3){try{var ge=re.Da.g.parse(z)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var Xe=ge;if(Xe[0]==0){e:if(!re.u){if(re.g)if(re.g.F+3e3<A.F)ym(re),Fl(re);else break e;_m(re),ji(18)}}else re.za=Xe[1],0<re.za-re.T&&37500>Xe[2]&&re.F&&re.v==0&&!re.C&&(re.C=sa(O(re.Za,re),6e3));if(1>=dm(re.h)&&re.ca){try{re.ca()}catch{}re.ca=void 0}}else Ed(re,11)}else if((A.K||re.g==A)&&ym(re),!K(z))for(Xe=re.Da.g.parse(z),z=0;z<Xe.length;z++){let Nr=Xe[z];if(re.T=Nr[0],Nr=Nr[1],re.G==2)if(Nr[0]=="c"){re.K=Nr[1],re.ia=Nr[2];const co=Nr[3];co!=null&&(re.la=co,re.j.info("VER="+re.la));const ks=Nr[4];ks!=null&&(re.Aa=ks,re.j.info("SVER="+re.Aa));const Ec=Nr[5];Ec!=null&&typeof Ec=="number"&&0<Ec&&(ge=1.5*Ec,re.L=ge,re.j.info("backChannelRequestTimeoutMs_="+ge)),ge=re;const _a=A.g;if(_a){const Up=_a.g?_a.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Up){var ut=ge.h;ut.g||Up.indexOf("spdy")==-1&&Up.indexOf("quic")==-1&&Up.indexOf("h2")==-1||(ut.j=ut.l,ut.g=new Set,ut.h&&(Dp(ut,ut.h),ut.h=null))}if(ge.D){const Sm=_a.g?_a.g.getResponseHeader("X-HTTP-Session-Id"):null;Sm&&(ge.ya=Sm,ri(ge.I,ge.D,Sm))}}re.G=3,re.l&&re.l.ua(),re.ba&&(re.R=Date.now()-A.F,re.j.info("Handshake RTT: "+re.R+"ms")),ge=re;var Gt=A;if(ge.qa=s_(ge,ge.J?ge.ia:null,ge.W),Gt.K){Ml(ge.h,Gt);var ii=Gt,Ei=ge.L;Ei&&(ii.I=Ei),ii.B&&(Fc(ii),Sn(ii)),ge.g=Gt}else bu(ge);0<re.i.length&&zc(re)}else Nr[0]!="stop"&&Nr[0]!="close"||Ed(re,7);else re.G==3&&(Nr[0]=="stop"||Nr[0]=="close"?Nr[0]=="stop"?Ed(re,7):ps(re):Nr[0]!="noop"&&re.l&&re.l.ta(Nr),re.v=0)}}mc(4)}catch{}}var hh=class{constructor(A,z){this.g=A,this.map=z}};function mu(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function zo(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function dm(A){return A.h?1:A.g?A.g.size:0}function yo(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function Dp(A,z){A.g?A.g.add(z):A.h=z}function Ml(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}mu.prototype.cancel=function(){if(this.i=ph(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function ph(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const re of A.g.values())z=z.concat(re.D);return z}return U(A.i)}function fh(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var z=[],re=A.length,ge=0;ge<re;ge++)z.push(A[ge]);return z}z=[],re=0;for(ge in A)z[re++]=A[ge];return z}function wr(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var z=[];A=A.length;for(var re=0;re<A;re++)z.push(re);return z}z=[],re=0;for(const ge in A)z[re++]=ge;return z}}}function gu(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var re=wr(A),ge=fh(A),Xe=ge.length,ut=0;ut<Xe;ut++)z.call(void 0,ge[ut],re&&re[ut],A)}var _u=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pd(A,z){if(A){A=A.split("&");for(var re=0;re<A.length;re++){var ge=A[re].indexOf("="),Xe=null;if(0<=ge){var ut=A[re].substring(0,ge);Xe=A[re].substring(ge+1)}else ut=A[re];z(ut,Xe?decodeURIComponent(Xe.replace(/\+/g," ")):"")}}}function _c(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof _c){this.h=A.h,fd(this,A.j),this.o=A.o,this.g=A.g,Ul(this,A.s),this.l=A.l;var z=A.i,re=new ca;re.i=z.i,z.g&&(re.g=new Map(z.g),re.h=z.h),yu(this,re),this.m=A.m}else A&&(z=String(A).match(_u))?(this.h=!1,fd(this,z[1]||"",!0),this.o=pr(z[2]||""),this.g=pr(z[3]||"",!0),Ul(this,z[4]),this.l=pr(z[5]||"",!0),yu(this,z[6]||"",!0),this.m=pr(z[7]||"")):(this.h=!1,this.i=new ca(null,this.h))}_c.prototype.toString=function(){var A=[],z=this.j;z&&A.push(Bc(z,Eu,!0),":");var re=this.g;return(re||z=="file")&&(A.push("//"),(z=this.o)&&A.push(Bc(z,Eu,!0),"@"),A.push(encodeURIComponent(String(re)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),re=this.s,re!=null&&A.push(":",String(re))),(re=this.l)&&(this.g&&re.charAt(0)!="/"&&A.push("/"),A.push(Bc(re,re.charAt(0)=="/"?xp:mh,!0))),(re=this.i.toString())&&A.push("?",re),(re=this.m)&&A.push("#",Bc(re,Lp)),A.join("")};function aa(A){return new _c(A)}function fd(A,z,re){A.j=re?pr(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function Ul(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function yu(A,z,re){z instanceof ca?(A.i=z,ha(A.i,A.h)):(re||(z=Bc(z,pm)),A.i=new ca(z,A.h))}function ri(A,z,re){A.i.set(z,re)}function yc(A){return ri(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function pr(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Bc(A,z,re){return typeof A=="string"?(A=encodeURI(A).replace(z,hm),re&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function hm(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var Eu=/[#\/\?@]/g,mh=/[#\?:]/g,xp=/[#\?]/g,pm=/[#\?@]/g,Lp=/#/g;function ca(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function vs(A){A.g||(A.g=new Map,A.h=0,A.i&&pd(A.i,function(z,re){A.add(decodeURIComponent(z.replace(/\+/g," ")),re)}))}n=ca.prototype,n.add=function(A,z){vs(this),this.i=null,A=da(this,A);var re=this.g.get(A);return re||this.g.set(A,re=[]),re.push(z),this.h+=1,this};function la(A,z){vs(A),z=da(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function ua(A,z){return vs(A),z=da(A,z),A.g.has(z)}n.forEach=function(A,z){vs(this),this.g.forEach(function(re,ge){re.forEach(function(Xe){A.call(z,Xe,ge,this)},this)},this)},n.na=function(){vs(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),re=[];for(let ge=0;ge<z.length;ge++){const Xe=A[ge];for(let ut=0;ut<Xe.length;ut++)re.push(z[ge])}return re},n.V=function(A){vs(this);let z=[];if(typeof A=="string")ua(this,A)&&(z=z.concat(this.g.get(da(this,A))));else{A=Array.from(this.g.values());for(let re=0;re<A.length;re++)z=z.concat(A[re])}return z},n.set=function(A,z){return vs(this),this.i=null,A=da(this,A),ua(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function vu(A,z,re){la(A,z),0<re.length&&(A.i=null,A.g.set(da(A,z),U(re)),A.h+=re.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var re=0;re<z.length;re++){var ge=z[re];const ut=encodeURIComponent(String(ge)),Gt=this.V(ge);for(ge=0;ge<Gt.length;ge++){var Xe=ut;Gt[ge]!==""&&(Xe+="="+encodeURIComponent(String(Gt[ge]))),A.push(Xe)}}return this.i=A.join("&")};function da(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function ha(A,z){z&&!A.j&&(vs(A),A.i=null,A.g.forEach(function(re,ge){var Xe=ge.toLowerCase();ge!=Xe&&(la(this,ge),vu(this,Xe,re))},A)),A.j=z}function fm(A,z){const re=new kl;if(_.Image){const ge=new Image;ge.onload=M(Os,re,"TestLoadImage: loaded",!0,z,ge),ge.onerror=M(Os,re,"TestLoadImage: error",!1,z,ge),ge.onabort=M(Os,re,"TestLoadImage: abort",!1,z,ge),ge.ontimeout=M(Os,re,"TestLoadImage: timeout",!1,z,ge),_.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else z(!1)}function Wc(A,z){const re=new kl,ge=new AbortController,Xe=setTimeout(()=>{ge.abort(),Os(re,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:ge.signal}).then(ut=>{clearTimeout(Xe),ut.ok?Os(re,"TestPingServer: ok",!0,z):Os(re,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(Xe),Os(re,"TestPingServer: error",!1,z)})}function Os(A,z,re,ge,Xe){try{Xe&&(Xe.onload=null,Xe.onerror=null,Xe.onabort=null,Xe.ontimeout=null),ge(re)}catch{}}function md(){this.g=new ia}function Mp(A,z,re){const ge=re||"";try{gu(A,function(Xe,ut){let Gt=Xe;S(Xe)&&(Gt=cr(Xe)),z.push(ge+ut+"="+encodeURIComponent(Gt))})}catch(Xe){throw z.push(ge+"type="+encodeURIComponent("_badmap")),Xe}}function Vl(A){this.l=A.Ub||null,this.j=A.eb||!1}L(Vl,Ks),Vl.prototype.g=function(){return new Su(this.l,this.j)},Vl.prototype.i=function(A){return function(){return A}}({});function Su(A,z){vn.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(Su,vn),n=Su.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,Ga(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||_).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,za(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,Ga(this)),this.g&&(this.readyState=3,Ga(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;mm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function mm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?za(this):Ga(this),this.readyState==3&&mm(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,za(this))},n.Qa=function(A){this.g&&(this.response=A,za(this))},n.ga=function(){this.g&&za(this)};function za(A){A.readyState=4,A.l=null,A.j=null,A.v=null,Ga(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var re=z.next();!re.done;)re=re.value,A.push(re[0]+": "+re[1]),re=z.next();return A.join(`\r
`)};function Ga(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(Su.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function jl(A){let z="";return le(A,function(re,ge){z+=ge,z+=":",z+=re,z+=`\r
`}),z}function be(A,z,re){e:{for(ge in re){var ge=!1;break e}ge=!0}ge||(re=jl(re),typeof A=="string"?re!=null&&encodeURIComponent(String(re)):ri(A,z,re))}function De(A){vn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(De,vn);var it=/^https?$/i,en=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,re,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Xi.g(),this.v=this.o?ao(this.o):ao(Xi),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(ut){tr(this,ut);return}if(A=re||"",re=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var Xe in ge)re.set(Xe,ge[Xe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const ut of ge.keys())re.set(ut,ge.get(ut));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(re.keys()).find(ut=>ut.toLowerCase()=="content-type"),Xe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(en,z,void 0))||ge||Xe||re.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ut,Gt]of re)this.g.setRequestHeader(ut,Gt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kr(this),this.u=!0,this.g.send(A),this.u=!1}catch(ut){tr(this,ut)}};function tr(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,kr(A),_n(A)}function kr(A){A.A||(A.A=!0,nn(A,"complete"),nn(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,nn(this,"complete"),nn(this,"abort"),_n(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),_n(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Zr(this):this.bb())},n.bb=function(){Zr(this)};function Zr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||Ni(A)!=4||A.Z()!=2)){if(A.u&&Ni(A)==4)sr(A.Ea,0,A);else if(nn(A,"readystatechange"),Ni(A)==4){A.h=!1;try{const Gt=A.Z();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var re;if(!(re=z)){var ge;if(ge=Gt===0){var Xe=String(A.D).match(_u)[1]||null;!Xe&&_.self&&_.self.location&&(Xe=_.self.location.protocol.slice(0,-1)),ge=!it.test(Xe?Xe.toLowerCase():"")}re=ge}if(re)nn(A,"complete"),nn(A,"success");else{A.m=6;try{var ut=2<Ni(A)?A.g.statusText:""}catch{ut=""}A.l=ut+" ["+A.Z()+"]",kr(A)}}finally{_n(A)}}}}function _n(A,z){if(A.g){Kr(A);const re=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||nn(A,"ready");try{re.onreadystatechange=ge}catch{}}}function Kr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Ni(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Ni(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),zn(z)}};function qs(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function pa(A){const z={};A=(A.g&&2<=Ni(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if(K(A[ge]))continue;var re=de(A[ge]);const Xe=re[0];if(re=re[1],typeof re!="string")continue;re=re.trim();const ut=z[Xe]||[];z[Xe]=ut,ut.push(re)}Y(z,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function fa(A,z,re){return re&&re.internalChannelParams&&re.internalChannelParams[A]||z}function gd(A){this.Aa=0,this.i=[],this.j=new kl,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=fa("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=fa("baseRetryDelayMs",5e3,A),this.cb=fa("retryDelaySeedMs",1e4,A),this.Wa=fa("forwardChannelMaxRetries",2,A),this.wa=fa("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new mu(A&&A.concurrentRequestLimit),this.Da=new md,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=gd.prototype,n.la=8,n.G=1,n.connect=function(A,z,re,ge){ji(0),this.W=A,this.H=z||{},re&&ge!==void 0&&(this.H.OSID=re,this.H.OAID=ge),this.F=this.X,this.I=s_(this,null,this.W),zc(this)};function ps(A){if(gh(A),A.G==3){var z=A.U++,re=aa(A.I);if(ri(re,"SID",A.K),ri(re,"RID",z),ri(re,"TYPE","terminate"),_d(A,re),z=new Wo(A,A.j,z),z.L=2,z.v=yc(aa(re)),re=!1,_.navigator&&_.navigator.sendBeacon)try{re=_.navigator.sendBeacon(z.v.toString(),"")}catch{}!re&&_.Image&&(new Image().src=z.v,re=!0),re||(z.g=_E(z.j,null),z.g.ea(z.v)),z.F=Date.now(),Sn(z)}vd(A)}function Fl(A){A.g&&(i_(A),A.g.cancel(),A.g=null)}function gh(A){Fl(A),A.u&&(_.clearTimeout(A.u),A.u=null),ym(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function zc(A){if(!zo(A.h)&&!A.s){A.s=!0;var z=A.Ga;Oe||Be(),we||(Oe(),we=!0),Se.add(z,A),A.B=0}}function r_(A,z){return dm(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=sa(O(A.Ga,A,z),yd(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Xe=new Wo(this,this.j,A);let ut=this.o;if(this.S&&(ut?(ut=Z(ut),ie(ut,this.S)):ut=this.S),this.m!==null||this.O||(Xe.H=ut,ut=null),this.P)e:{for(var z=0,re=0;re<this.i.length;re++){t:{var ge=this.i[re];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(z+=ge,4096<z){z=re;break e}if(z===4096||re===this.i.length-1){z=re+1;break e}}z=1e3}else z=1e3;z=ma(this,Xe,z),re=aa(this.I),ri(re,"RID",A),ri(re,"CVER",22),this.D&&ri(re,"X-HTTP-Session-Id",this.D),_d(this,re),ut&&(this.O?z="headers="+encodeURIComponent(String(jl(ut)))+"&"+z:this.m&&be(re,this.m,ut)),Dp(this.h,Xe),this.Ua&&ri(re,"TYPE","init"),this.P?(ri(re,"$req",z),ri(re,"SID","null"),Xe.T=!0,fu(Xe,re,null)):fu(Xe,re,z),this.G=2}}else this.G==3&&(A?gm(this,A):this.i.length==0||zo(this.h)||gm(this))};function gm(A,z){var re;z?re=z.l:re=A.U++;const ge=aa(A.I);ri(ge,"SID",A.K),ri(ge,"RID",re),ri(ge,"AID",A.T),_d(A,ge),A.m&&A.o&&be(ge,A.m,A.o),re=new Wo(A,A.j,re,A.B+1),A.m===null&&(re.H=A.o),z&&(A.i=z.D.concat(A.i)),z=ma(A,re,1e3),re.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Dp(A.h,re),fu(re,ge,z)}function _d(A,z){A.H&&le(A.H,function(re,ge){ri(z,ge,re)}),A.l&&gu({},function(re,ge){ri(z,ge,re)})}function ma(A,z,re){re=Math.min(A.i.length,re);var ge=A.l?O(A.l.Na,A.l,A):null;e:{var Xe=A.i;let ut=-1;for(;;){const Gt=["count="+re];ut==-1?0<re?(ut=Xe[0].g,Gt.push("ofs="+ut)):ut=0:Gt.push("ofs="+ut);let ii=!0;for(let Ei=0;Ei<re;Ei++){let Nr=Xe[Ei].g;const co=Xe[Ei].map;if(Nr-=ut,0>Nr)ut=Math.max(0,Xe[Ei].g-100),ii=!1;else try{Mp(co,Gt,"req"+Nr+"_")}catch{ge&&ge(co)}}if(ii){ge=Gt.join("&");break e}}}return A=A.i.splice(0,re),z.D=A,ge}function bu(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;Oe||Be(),we||(Oe(),we=!0),Se.add(z,A),A.v=0}}function _m(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=sa(O(A.Fa,A),yd(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,gE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=sa(O(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ji(10),Fl(this),gE(this))};function i_(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function gE(A){A.g=new Wo(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=aa(A.qa);ri(z,"RID","rpc"),ri(z,"SID",A.K),ri(z,"AID",A.T),ri(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&ri(z,"TO",A.ja),ri(z,"TYPE","xmlhttp"),_d(A,z),A.m&&A.o&&be(z,A.m,A.o),A.L&&(A.g.I=A.L);var re=A.g;A=A.ia,re.L=1,re.v=yc(aa(z)),re.m=null,re.P=!0,gc(re,A)}n.Za=function(){this.C!=null&&(this.C=null,Fl(this),_m(this),ji(19))};function ym(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function Em(A,z){var re=null;if(A.g==z){ym(A),i_(A),A.g=null;var ge=2}else if(yo(A.h,z))re=z.D,Ml(A.h,z),ge=1;else return;if(A.G!=0){if(z.o)if(ge==1){re=z.m?z.m.length:0,z=Date.now()-z.F;var Xe=A.B;ge=Ol(),nn(ge,new ds(ge,re)),zc(A)}else bu(A);else if(Xe=z.s,Xe==3||Xe==0&&0<z.X||!(ge==1&&r_(A,z)||ge==2&&_m(A)))switch(re&&0<re.length&&(z=A.h,z.i=z.i.concat(re)),Xe){case 1:Ed(A,5);break;case 4:Ed(A,10);break;case 3:Ed(A,6);break;default:Ed(A,2)}}}function yd(A,z){let re=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(re*=2),re*z}function Ed(A,z){if(A.j.info("Error code "+z),z==2){var re=O(A.fb,A),ge=A.Xa;const Xe=!ge;ge=new _c(ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||fd(ge,"https"),yc(ge),Xe?fm(ge.toString(),re):Wc(ge.toString(),re)}else ji(2);A.G=0,A.l&&A.l.sa(z),vd(A),gh(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),ji(2)):(this.j.info("Failed to ping google.com"),ji(1))};function vd(A){if(A.G=0,A.ka=[],A.l){const z=ph(A.h);(z.length!=0||A.i.length!=0)&&(B(A.ka,z),B(A.ka,A.i),A.h.i.length=0,U(A.i),A.i.length=0),A.l.ra()}}function s_(A,z,re){var ge=re instanceof _c?aa(re):new _c(re);if(ge.g!="")z&&(ge.g=z+"."+ge.g),Ul(ge,ge.s);else{var Xe=_.location;ge=Xe.protocol,z=z?z+"."+Xe.hostname:Xe.hostname,Xe=+Xe.port;var ut=new _c(null);ge&&fd(ut,ge),z&&(ut.g=z),Xe&&Ul(ut,Xe),re&&(ut.l=re),ge=ut}return re=A.D,z=A.ya,re&&z&&ri(ge,re,z),ri(ge,"VER",A.la),_d(A,ge),ge}function _E(A,z,re){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new Vl({eb:re})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function $n(){}n=$n.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function vm(){}vm.prototype.g=function(A,z){return new ga(A,z)};function ga(A,z){vn.call(this),this.g=new gd(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!K(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!K(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new Gc(this)}L(ga,vn),ga.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ga.prototype.close=function(){ps(this.g)},ga.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var re={};re.__data__=A,A=re}else this.u&&(re={},re.__data__=cr(A),A=re);z.i.push(new hh(z.Ya++,A)),z.G==3&&zc(z)},ga.prototype.N=function(){this.g.l=null,delete this.j,ps(this.g),delete this.g,ga.aa.N.call(this)};function yE(A){Va.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const re in z){A=re;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}L(yE,Va);function EE(){Fo.call(this),this.status=1}L(EE,Fo);function Gc(A){this.g=A}L(Gc,$n),Gc.prototype.ua=function(){nn(this.g,"a")},Gc.prototype.ta=function(A){nn(this.g,new yE(A))},Gc.prototype.sa=function(A){nn(this.g,new EE)},Gc.prototype.ra=function(){nn(this.g,"b")},vm.prototype.createWebChannel=vm.prototype.g,ga.prototype.send=ga.prototype.o,ga.prototype.open=ga.prototype.m,ga.prototype.close=ga.prototype.close,tse=function(){return new vm},ese=function(){return Ol()},Zie=ja,aj={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Oi.NO_ERROR=0,Oi.TIMEOUT=8,Oi.HTTP_ERROR=6,Nk=Oi,Nl.COMPLETE="complete",Qie=Nl,jc.EventType=Ps,Ps.OPEN="a",Ps.CLOSE="b",Ps.ERROR="c",Ps.MESSAGE="d",vn.prototype.listen=vn.prototype.K,sC=jc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Jie=De}).apply(typeof YO<"u"?YO:typeof self<"u"?self:typeof window<"u"?window:{});const EJ="@firebase/firestore",vJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}lc.UNAUTHENTICATED=new lc(null),lc.GOOGLE_CREDENTIALS=new lc("google-credentials-uid"),lc.FIRST_PARTY=new lc("first-party-uid"),lc.MOCK_USER=new lc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ib="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=new S4("@firebase/firestore");function BS(){return iE.logLevel}function sn(n,...e){if(iE.logLevel<=Lr.DEBUG){const i=e.map(k4);iE.debug(`Firestore (${ib}): ${n}`,...i)}}function om(n,...e){if(iE.logLevel<=Lr.ERROR){const i=e.map(k4);iE.error(`Firestore (${ib}): ${n}`,...i)}}function U0(n,...e){if(iE.logLevel<=Lr.WARN){const i=e.map(k4);iE.warn(`Firestore (${ib}): ${n}`,...i)}}function k4(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xn(n="Unexpected state"){const e=`FIRESTORE (${ib}) INTERNAL ASSERTION FAILED: `+n;throw om(e),new Error(e)}function yi(n,e){n||Xn()}function ir(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Xt extends lh{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nse{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class G4e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(lc.UNAUTHENTICATED))}shutdown(){}}class H4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class $4e{constructor(e){this.t=e,this.currentUser=lc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){yi(this.o===void 0);let o=this.i;const l=E=>this.i!==o?(o=this.i,i(E)):Promise.resolve();let u=new Jf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Jf,e.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const E=u;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{sn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(sn("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Jf)}},0),f()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(sn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(yi(typeof o.accessToken=="string"),new nse(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return yi(e===null||typeof e=="string"),new lc(e)}}class K4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=lc.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class q4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new K4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(lc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class SJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Y4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,vl(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){yi(this.o===void 0);const o=u=>{u.error!=null&&sn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const f=u.token!==this.R;return this.R=u.token,sn("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>o(u))};const l=u=>{sn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):sn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new SJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(yi(typeof i.token=="string"),this.R=i.token,new SJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rse(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ise{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=X4e(40);for(let u=0;u<l.length;++u)o.length<20&&l[u]<i&&(o+=e.charAt(l[u]%62))}return o}}function br(n,e){return n<e?-1:n>e?1:0}function cj(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return br(o,l);{const u=rse(),f=J4e(u.encode(bJ(n,i)),u.encode(bJ(e,i)));return f!==0?f:br(o,l)}}i+=o>65535?2:1}return br(n.length,e.length)}function bJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function J4e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return br(n[i],e[i]);return br(n.length,e.length)}function V0(n,e,i){return n.length===e.length&&n.every((o,l)=>i(o,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TJ=-62135596800,wJ=1e6;class Lo{static now(){return Lo.fromMillis(Date.now())}static fromDate(e){return Lo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*wJ);return new Lo(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Xt(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Xt(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<TJ)throw new Xt(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Xt(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/wJ}_compareTo(e){return this.seconds===e.seconds?br(this.nanoseconds,e.nanoseconds):br(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-TJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{static fromTimestamp(e){return new er(e)}static min(){return new er(new Lo(0,0))}static max(){return new er(new Lo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CJ="__name__";class ip{constructor(e,i,o){i===void 0?i=0:i>e.length&&Xn(),o===void 0?o=e.length-i:o>e.length-i&&Xn(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return ip.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof ip?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const u=ip.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return br(e.length,i.length)}static compareSegments(e,i){const o=ip.isNumericId(e),l=ip.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?ip.extractNumericId(e).compare(ip.extractNumericId(i)):cj(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ug.fromString(e.substring(4,e.length-2))}}class qi extends ip{construct(e,i,o){return new qi(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new Xt(wt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(l=>l.length>0))}return new qi(i)}static emptyPath(){return new qi([])}}const Q4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class xa extends ip{construct(e,i,o){return new xa(e,i,o)}static isValidIdentifier(e){return Q4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),xa.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===CJ}static keyField(){return new xa([CJ])}static fromServerFormat(e){const i=[];let o="",l=0;const u=()=>{if(o.length===0)throw new Xt(wt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let f=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new Xt(wt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new Xt(wt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=E,l+=2}else _==="`"?(f=!f,l++):_!=="."||f?(o+=_,l++):(u(),l++)}if(u(),f)throw new Xt(wt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new xa(i)}static emptyPath(){return new xa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.path=e}static fromPath(e){return new Rn(qi.fromString(e))}static fromName(e){return new Rn(qi.fromString(e).popFirst(5))}static empty(){return new Rn(qi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&qi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return qi.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Rn(new qi(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=-1;function Z4e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=er.fromTimestamp(o===1e9?new Lo(i+1,0):new Lo(i,o));return new zg(l,Rn.empty(),e)}function e3e(n){return new zg(n.readTime,n.key,tR)}class zg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new zg(er.min(),Rn.empty(),tR)}static max(){return new zg(er.max(),Rn.empty(),tR)}}function t3e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Rn.comparator(n.documentKey,e.documentKey),i!==0?i:br(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n3e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class r3e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sb(n){if(n.code!==wt.FAILED_PRECONDITION||n.message!==n3e)throw n;sn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Xn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Pt((o,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(o,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Pt?i:Pt.resolve(i)}catch(i){return Pt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Pt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Pt.reject(i)}static resolve(e){return new Pt((i,o)=>{i(e)})}static reject(e){return new Pt((i,o)=>{o(e)})}static waitFor(e){return new Pt((i,o)=>{let l=0,u=0,f=!1;e.forEach(_=>{++l,_.next(()=>{++u,f&&u===l&&i()},E=>o(E))}),f=!0,u===l&&i()})}static or(e){let i=Pt.resolve(!1);for(const o of e)i=i.next(l=>l?Pt.resolve(l):o());return i}static forEach(e,i){const o=[];return e.forEach((l,u)=>{o.push(i.call(this,l,u))}),this.waitFor(o)}static mapArray(e,i){return new Pt((o,l)=>{const u=e.length,f=new Array(u);let _=0;for(let E=0;E<u;E++){const S=E;i(e[S]).next(C=>{f[S]=C,++_,_===u&&o(f)},C=>l(C))}})}static doWhile(e,i){return new Pt((o,l)=>{const u=()=>{e()===!0?i().next(()=>{u()},l):o()};u()})}}function i3e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function ob(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.oe(o),this._e=o=>i.writeSequenceNumber(o))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}v1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4=-1;function S1(n){return n==null}function fN(n){return n===0&&1/n==-1/0}function s3e(n){return typeof n=="number"&&Number.isInteger(n)&&!fN(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sse="";function o3e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=RJ(e)),e=a3e(n.get(i),e);return RJ(e)}function a3e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case sse:i+="";break;default:i+=u}}return i}function RJ(n){return n+sse+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function t_(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function ose(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e,i){this.comparator=e,this.root=i||Na.EMPTY}insert(e,i){return new Is(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Na.BLACK,null,null))}remove(e){return new Is(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Na.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){const e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new XO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new XO(this.root,e,this.comparator,!1)}getReverseIterator(){return new XO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new XO(this.root,e,this.comparator,!0)}}class XO{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?o(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Na{constructor(e,i,o,l,u){this.key=e,this.value=i,this.color=o??Na.RED,this.left=l??Na.EMPTY,this.right=u??Na.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,u){return new Na(e??this.key,i??this.value,o??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const u=o(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,o),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Na.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return Na.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Na.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Na.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Xn();const e=this.left.check();if(e!==this.right.check())throw Xn();return e+(this.isRed()?0:1)}}Na.EMPTY=null,Na.RED=!0,Na.BLACK=!1;Na.EMPTY=new class{constructor(){this.size=0}get key(){throw Xn()}get value(){throw Xn()}get color(){throw Xn()}get left(){throw Xn()}get right(){throw Xn()}copy(e,i,o,l,u){return this}insert(e,i,o){return new Na(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e){this.comparator=e,this.data=new Is(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new AJ(this.data.getIterator())}getIteratorFrom(e){return new AJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof Mo)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new Mo(this.comparator);return i.data=e,i}}class AJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(e){this.fields=e,e.sort(xa.comparator)}static empty(){return new ru([])}unionWith(e){let i=new Mo(xa.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new ru(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return V0(this.fields,e.fields,(i,o)=>i.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ase extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new ase("Invalid base64 string: "+u):u}}(e);return new La(i)}static fromUint8Array(e){const i=function(l){let u="";for(let f=0;f<l.length;++f)u+=String.fromCharCode(l[f]);return u}(e);return new La(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return br(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}La.EMPTY_BYTE_STRING=new La("");const c3e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gg(n){if(yi(!!n),typeof n=="string"){let e=0;const i=c3e.exec(n);if(yi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:to(n.seconds),nanos:to(n.nanos)}}function to(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Hg(n){return typeof n=="string"?La.fromBase64String(n):La.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cse="server_timestamp",lse="__type__",use="__previous_value__",dse="__local_write_time__";function b1(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[lse])===null||i===void 0?void 0:i.stringValue)===cse}function T1(n){const e=n.mapValue.fields[use];return b1(e)?T1(e):e}function nR(n){const e=Gg(n.mapValue.fields[dse].timestampValue);return new Lo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3e{constructor(e,i,o,l,u,f,_,E,S){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=u,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=S}}const mN="(default)";class rR{constructor(e,i){this.projectId=e,this.database=i||mN}static empty(){return new rR("","")}get isDefaultDatabase(){return this.database===mN}isEqual(e){return e instanceof rR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hse="__type__",u3e="__max__",JO={mapValue:{}},pse="__vector__",gN="value";function $g(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?b1(n)?4:h3e(n)?9007199254740991:d3e(n)?10:11:Xn()}function Ap(n,e){if(n===e)return!0;const i=$g(n);if(i!==$g(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return nR(n).isEqual(nR(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const f=Gg(l.timestampValue),_=Gg(u.timestampValue);return f.seconds===_.seconds&&f.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return Hg(l.bytesValue).isEqual(Hg(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return to(l.geoPointValue.latitude)===to(u.geoPointValue.latitude)&&to(l.geoPointValue.longitude)===to(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return to(l.integerValue)===to(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const f=to(l.doubleValue),_=to(u.doubleValue);return f===_?fN(f)===fN(_):isNaN(f)&&isNaN(_)}return!1}(n,e);case 9:return V0(n.arrayValue.values||[],e.arrayValue.values||[],Ap);case 10:case 11:return function(l,u){const f=l.mapValue.fields||{},_=u.mapValue.fields||{};if(IJ(f)!==IJ(_))return!1;for(const E in f)if(f.hasOwnProperty(E)&&(_[E]===void 0||!Ap(f[E],_[E])))return!1;return!0}(n,e);default:return Xn()}}function iR(n,e){return(n.values||[]).find(i=>Ap(i,e))!==void 0}function j0(n,e){if(n===e)return 0;const i=$g(n),o=$g(e);if(i!==o)return br(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return br(n.booleanValue,e.booleanValue);case 2:return function(u,f){const _=to(u.integerValue||u.doubleValue),E=to(f.integerValue||f.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return PJ(n.timestampValue,e.timestampValue);case 4:return PJ(nR(n),nR(e));case 5:return cj(n.stringValue,e.stringValue);case 6:return function(u,f){const _=Hg(u),E=Hg(f);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(u,f){const _=u.split("/"),E=f.split("/");for(let S=0;S<_.length&&S<E.length;S++){const C=br(_[S],E[S]);if(C!==0)return C}return br(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,f){const _=br(to(u.latitude),to(f.latitude));return _!==0?_:br(to(u.longitude),to(f.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return OJ(n.arrayValue,e.arrayValue);case 10:return function(u,f){var _,E,S,C;const I=u.fields||{},O=f.fields||{},M=(_=I[gN])===null||_===void 0?void 0:_.arrayValue,L=(E=O[gN])===null||E===void 0?void 0:E.arrayValue,U=br(((S=M==null?void 0:M.values)===null||S===void 0?void 0:S.length)||0,((C=L==null?void 0:L.values)===null||C===void 0?void 0:C.length)||0);return U!==0?U:OJ(M,L)}(n.mapValue,e.mapValue);case 11:return function(u,f){if(u===JO.mapValue&&f===JO.mapValue)return 0;if(u===JO.mapValue)return 1;if(f===JO.mapValue)return-1;const _=u.fields||{},E=Object.keys(_),S=f.fields||{},C=Object.keys(S);E.sort(),C.sort();for(let I=0;I<E.length&&I<C.length;++I){const O=cj(E[I],C[I]);if(O!==0)return O;const M=j0(_[E[I]],S[C[I]]);if(M!==0)return M}return br(E.length,C.length)}(n.mapValue,e.mapValue);default:throw Xn()}}function PJ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return br(n,e);const i=Gg(n),o=Gg(e),l=br(i.seconds,o.seconds);return l!==0?l:br(i.nanos,o.nanos)}function OJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const u=j0(i[l],o[l]);if(u)return u}return br(i.length,o.length)}function F0(n){return lj(n)}function lj(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const o=Gg(i);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Hg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Rn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let o="[",l=!0;for(const u of i.values||[])l?l=!1:o+=",",o+=lj(u);return o+"]"}(n.arrayValue):"mapValue"in n?function(i){const o=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const f of o)u?u=!1:l+=",",l+=`${f}:${lj(i.fields[f])}`;return l+"}"}(n.mapValue):Xn()}function Dk(n){switch($g(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=T1(n);return e?16+Dk(e):16;case 5:return 2*n.stringValue.length;case 6:return Hg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((l,u)=>l+Dk(u),0)}(n.arrayValue);case 10:case 11:return function(o){let l=0;return t_(o.fields,(u,f)=>{l+=u.length+Dk(f)}),l}(n.mapValue);default:throw Xn()}}function _N(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function uj(n){return!!n&&"integerValue"in n}function D4(n){return!!n&&"arrayValue"in n}function kJ(n){return!!n&&"nullValue"in n}function NJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function xk(n){return!!n&&"mapValue"in n}function d3e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[hse])===null||i===void 0?void 0:i.stringValue)===pse}function RC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return t_(n.mapValue.fields,(i,o)=>e.mapValue.fields[i]=RC(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=RC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function h3e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===u3e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e){this.value=e}static empty(){return new Sl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!xk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=RC(i)}setAll(e){let i=xa.emptyPath(),o={},l=[];e.forEach((f,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,o,l),o={},l=[],i=_.popLast()}f?o[_.lastSegment()]=RC(f):l.push(_.lastSegment())});const u=this.getFieldsMap(i);this.applyChanges(u,o,l)}delete(e){const i=this.field(e.popLast());xk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Ap(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];xk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){t_(i,(l,u)=>e[l]=u);for(const l of o)delete e[l]}clone(){return new Sl(RC(this.value))}}function fse(n){const e=[];return t_(n.fields,(i,o)=>{const l=new xa([i]);if(xk(o)){const u=fse(o.mapValue).fields;if(u.length===0)e.push(l);else for(const f of u)e.push(l.child(f))}else e.push(l)}),new ru(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uc{constructor(e,i,o,l,u,f,_){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=u,this.data=f,this.documentState=_}static newInvalidDocument(e){return new uc(e,0,er.min(),er.min(),er.min(),Sl.empty(),0)}static newFoundDocument(e,i,o,l){return new uc(e,1,i,er.min(),o,l,0)}static newNoDocument(e,i){return new uc(e,2,i,er.min(),er.min(),Sl.empty(),0)}static newUnknownDocument(e,i){return new uc(e,3,i,er.min(),er.min(),Sl.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(er.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Sl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Sl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=er.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof uc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new uc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e,i){this.position=e,this.inclusive=i}}function DJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const u=e[l],f=n.position[l];if(u.field.isKeyField()?o=Rn.comparator(Rn.fromName(f.referenceValue),i.key):o=j0(f,i.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function xJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!Ap(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sR{constructor(e,i="asc"){this.field=e,this.dir=i}}function p3e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mse{}class go extends mse{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new m3e(e,i,o):i==="array-contains"?new y3e(e,o):i==="in"?new E3e(e,o):i==="not-in"?new v3e(e,o):i==="array-contains-any"?new S3e(e,o):new go(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new g3e(e,o):new _3e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(j0(i,this.value)):i!==null&&$g(this.value)===$g(i)&&this.matchesComparison(j0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Xn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ch extends mse{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new ch(e,i)}matches(e){return gse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function gse(n){return n.op==="and"}function _se(n){return f3e(n)&&gse(n)}function f3e(n){for(const e of n.filters)if(e instanceof ch)return!1;return!0}function dj(n){if(n instanceof go)return n.field.canonicalString()+n.op.toString()+F0(n.value);if(_se(n))return n.filters.map(e=>dj(e)).join(",");{const e=n.filters.map(i=>dj(i)).join(",");return`${n.op}(${e})`}}function yse(n,e){return n instanceof go?function(o,l){return l instanceof go&&o.op===l.op&&o.field.isEqual(l.field)&&Ap(o.value,l.value)}(n,e):n instanceof ch?function(o,l){return l instanceof ch&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce((u,f,_)=>u&&yse(f,l.filters[_]),!0):!1}(n,e):void Xn()}function Ese(n){return n instanceof go?function(i){return`${i.field.canonicalString()} ${i.op} ${F0(i.value)}`}(n):n instanceof ch?function(i){return i.op.toString()+" {"+i.getFilters().map(Ese).join(" ,")+"}"}(n):"Filter"}class m3e extends go{constructor(e,i,o){super(e,i,o),this.key=Rn.fromName(o.referenceValue)}matches(e){const i=Rn.comparator(e.key,this.key);return this.matchesComparison(i)}}class g3e extends go{constructor(e,i){super(e,"in",i),this.keys=vse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class _3e extends go{constructor(e,i){super(e,"not-in",i),this.keys=vse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function vse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>Rn.fromName(o.referenceValue))}class y3e extends go{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return D4(i)&&iR(i.arrayValue,this.value)}}class E3e extends go{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&iR(this.value.arrayValue,i)}}class v3e extends go{constructor(e,i){super(e,"not-in",i)}matches(e){if(iR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!iR(this.value.arrayValue,i)}}class S3e extends go{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!D4(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>iR(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b3e{constructor(e,i=null,o=[],l=[],u=null,f=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=u,this.startAt=f,this.endAt=_,this.le=null}}function LJ(n,e=null,i=[],o=[],l=null,u=null,f=null){return new b3e(n,e,i,o,l,u,f)}function x4(n){const e=ir(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>dj(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(u){return u.field.canonicalString()+u.dir}(o)).join(","),S1(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>F0(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>F0(o)).join(",")),e.le=i}return e.le}function L4(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!p3e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!yse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!xJ(n.startAt,e.startAt)&&xJ(n.endAt,e.endAt)}function hj(n){return Rn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uE{constructor(e,i=null,o=[],l=[],u=null,f="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=u,this.limitType=f,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function T3e(n,e,i,o,l,u,f,_){return new uE(n,e,i,o,l,u,f,_)}function w1(n){return new uE(n)}function MJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function M4(n){return n.collectionGroup!==null}function v0(n){const e=ir(n);if(e.he===null){e.he=[];const i=new Set;for(const u of e.explicitOrderBy)e.he.push(u),i.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let _=new Mo(xa.comparator);return f.filters.forEach(E=>{E.getFlattenedFilters().forEach(S=>{S.isInequality()&&(_=_.add(S.field))})}),_})(e).forEach(u=>{i.has(u.canonicalString())||u.isKeyField()||e.he.push(new sR(u,o))}),i.has(xa.keyField().canonicalString())||e.he.push(new sR(xa.keyField(),o))}return e.he}function Cp(n){const e=ir(n);return e.Pe||(e.Pe=w3e(e,v0(n))),e.Pe}function w3e(n,e){if(n.limitType==="F")return LJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new sR(l.field,u)});const i=n.endAt?new B0(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new B0(n.startAt.position,n.startAt.inclusive):null;return LJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function pj(n,e){const i=n.filters.concat([e]);return new uE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function yN(n,e,i){return new uE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function C1(n,e){return L4(Cp(n),Cp(e))&&n.limitType===e.limitType}function Sse(n){return`${x4(Cp(n))}|lt:${n.limitType}`}function WS(n){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(l=>Ese(l)).join(", ")}]`),S1(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(l=>F0(l)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(l=>F0(l)).join(",")),`Target(${o})`}(Cp(n))}; limitType=${n.limitType})`}function R1(n,e){return e.isFoundDocument()&&function(o,l){const u=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):Rn.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)}(n,e)&&function(o,l){for(const u of v0(o))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(o,l){for(const u of o.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(o,l){return!(o.startAt&&!function(f,_,E){const S=DJ(f,_,E);return f.inclusive?S<=0:S<0}(o.startAt,v0(o),l)||o.endAt&&!function(f,_,E){const S=DJ(f,_,E);return f.inclusive?S>=0:S>0}(o.endAt,v0(o),l))}(n,e)}function C3e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bse(n){return(e,i)=>{let o=!1;for(const l of v0(n)){const u=R3e(l,e,i);if(u!==0)return u;o=o||l.field.isKeyField()}return 0}}function R3e(n,e,i){const o=n.field.isKeyField()?Rn.comparator(e.key,i.key):function(u,f,_){const E=f.data.field(u),S=_.data.field(u);return E!==null&&S!==null?j0(E,S):Xn()}(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Xn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,u]of o)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){t_(this.inner,(i,o)=>{for(const[l,u]of o)e(l,u)})}isEmpty(){return ose(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I3e=new Is(Rn.comparator);function am(){return I3e}const Tse=new Is(Rn.comparator);function oC(...n){let e=Tse;for(const i of n)e=e.insert(i.key,i);return e}function wse(n){let e=Tse;return n.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function Ly(){return IC()}function Cse(){return IC()}function IC(){return new dE(n=>n.toString(),(n,e)=>n.isEqual(e))}const A3e=new Is(Rn.comparator),P3e=new Mo(Rn.comparator);function Vr(...n){let e=P3e;for(const i of n)e=e.add(i);return e}const O3e=new Mo(br);function k3e(){return O3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U4(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fN(e)?"-0":e}}function Rse(n){return{integerValue:""+n}}function N3e(n,e){return s3e(e)?Rse(e):U4(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(){this._=void 0}}function D3e(n,e,i){return n instanceof EN?function(l,u){const f={fields:{[lse]:{stringValue:cse},[dse]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&b1(u)&&(u=T1(u)),u&&(f.fields[use]=u),{mapValue:f}}(i,e):n instanceof W0?Ase(n,e):n instanceof z0?Pse(n,e):function(l,u){const f=Ise(l,u),_=UJ(f)+UJ(l.Ie);return uj(f)&&uj(l.Ie)?Rse(_):U4(l.serializer,_)}(n,e)}function x3e(n,e,i){return n instanceof W0?Ase(n,e):n instanceof z0?Pse(n,e):i}function Ise(n,e){return n instanceof vN?function(o){return uj(o)||function(u){return!!u&&"doubleValue"in u}(o)}(e)?e:{integerValue:0}:null}class EN extends I1{}class W0 extends I1{constructor(e){super(),this.elements=e}}function Ase(n,e){const i=Ose(e);for(const o of n.elements)i.some(l=>Ap(l,o))||i.push(o);return{arrayValue:{values:i}}}class z0 extends I1{constructor(e){super(),this.elements=e}}function Pse(n,e){let i=Ose(e);for(const o of n.elements)i=i.filter(l=>!Ap(l,o));return{arrayValue:{values:i}}}class vN extends I1{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function UJ(n){return to(n.integerValue||n.doubleValue)}function Ose(n){return D4(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kse{constructor(e,i){this.field=e,this.transform=i}}function L3e(n,e){return n.field.isEqual(e.field)&&function(o,l){return o instanceof W0&&l instanceof W0||o instanceof z0&&l instanceof z0?V0(o.elements,l.elements,Ap):o instanceof vN&&l instanceof vN?Ap(o.Ie,l.Ie):o instanceof EN&&l instanceof EN}(n.transform,e.transform)}class M3e{constructor(e,i){this.version=e,this.transformResults=i}}class sd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new sd}static exists(e){return new sd(void 0,e)}static updateTime(e){return new sd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Lk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class A1{}function Nse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new V4(n.key,sd.none()):new xR(n.key,n.data,sd.none());{const i=n.data,o=Sl.empty();let l=new Mo(xa.comparator);for(let u of e.fields)if(!l.has(u)){let f=i.field(u);f===null&&u.length>1&&(u=u.popLast(),f=i.field(u)),f===null?o.delete(u):o.set(u,f),l=l.add(u)}return new n_(n.key,o,new ru(l.toArray()),sd.none())}}function U3e(n,e,i){n instanceof xR?function(l,u,f){const _=l.value.clone(),E=jJ(l.fieldTransforms,u,f.transformResults);_.setAll(E),u.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,e,i):n instanceof n_?function(l,u,f){if(!Lk(l.precondition,u))return void u.convertToUnknownDocument(f.version);const _=jJ(l.fieldTransforms,u,f.transformResults),E=u.data;E.setAll(Dse(l)),E.setAll(_),u.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,e,i):function(l,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,i)}function AC(n,e,i,o){return n instanceof xR?function(u,f,_,E){if(!Lk(u.precondition,f))return _;const S=u.value.clone(),C=FJ(u.fieldTransforms,E,f);return S.setAll(C),f.convertToFoundDocument(f.version,S).setHasLocalMutations(),null}(n,e,i,o):n instanceof n_?function(u,f,_,E){if(!Lk(u.precondition,f))return _;const S=FJ(u.fieldTransforms,E,f),C=f.data;return C.setAll(Dse(u)),C.setAll(S),f.convertToFoundDocument(f.version,C).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(I=>I.field))}(n,e,i,o):function(u,f,_){return Lk(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):_}(n,e,i)}function V3e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),u=Ise(o.transform,l||null);u!=null&&(i===null&&(i=Sl.empty()),i.set(o.field,u))}return i||null}function VJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&V0(o,l,(u,f)=>L3e(u,f))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class xR extends A1{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class n_ extends A1{constructor(e,i,o,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Dse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}}),e}function jJ(n,e,i){const o=new Map;yi(n.length===i.length);for(let l=0;l<i.length;l++){const u=n[l],f=u.transform,_=e.data.field(u.field);o.set(u.field,x3e(f,_,i[l]))}return o}function FJ(n,e,i){const o=new Map;for(const l of n){const u=l.transform,f=i.data.field(l.field);o.set(l.field,D3e(u,f,e))}return o}class V4 extends A1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class j3e extends A1{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&U3e(u,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=AC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=AC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=Cse();return this.mutations.forEach(l=>{const u=e.get(l.key),f=u.overlayedDocument;let _=this.applyToLocalView(f,u.mutatedFields);_=i.has(l.key)?null:_;const E=Nse(f,_);E!==null&&o.set(l.key,E),f.isValidDocument()||f.convertToNoDocument(er.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Vr())}isEqual(e){return this.batchId===e.batchId&&V0(this.mutations,e.mutations,(i,o)=>VJ(i,o))&&V0(this.baseMutations,e.baseMutations,(i,o)=>VJ(i,o))}}class j4{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){yi(e.mutations.length===o.length);let l=function(){return A3e}();const u=e.mutations;for(let f=0;f<u.length;f++)l=l.insert(u[f].key,o[f].version);return new j4(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W3e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ho,$r;function z3e(n){switch(n){case wt.OK:return Xn();case wt.CANCELLED:case wt.UNKNOWN:case wt.DEADLINE_EXCEEDED:case wt.RESOURCE_EXHAUSTED:case wt.INTERNAL:case wt.UNAVAILABLE:case wt.UNAUTHENTICATED:return!1;case wt.INVALID_ARGUMENT:case wt.NOT_FOUND:case wt.ALREADY_EXISTS:case wt.PERMISSION_DENIED:case wt.FAILED_PRECONDITION:case wt.ABORTED:case wt.OUT_OF_RANGE:case wt.UNIMPLEMENTED:case wt.DATA_LOSS:return!0;default:return Xn()}}function xse(n){if(n===void 0)return om("GRPC error has no .code"),wt.UNKNOWN;switch(n){case ho.OK:return wt.OK;case ho.CANCELLED:return wt.CANCELLED;case ho.UNKNOWN:return wt.UNKNOWN;case ho.DEADLINE_EXCEEDED:return wt.DEADLINE_EXCEEDED;case ho.RESOURCE_EXHAUSTED:return wt.RESOURCE_EXHAUSTED;case ho.INTERNAL:return wt.INTERNAL;case ho.UNAVAILABLE:return wt.UNAVAILABLE;case ho.UNAUTHENTICATED:return wt.UNAUTHENTICATED;case ho.INVALID_ARGUMENT:return wt.INVALID_ARGUMENT;case ho.NOT_FOUND:return wt.NOT_FOUND;case ho.ALREADY_EXISTS:return wt.ALREADY_EXISTS;case ho.PERMISSION_DENIED:return wt.PERMISSION_DENIED;case ho.FAILED_PRECONDITION:return wt.FAILED_PRECONDITION;case ho.ABORTED:return wt.ABORTED;case ho.OUT_OF_RANGE:return wt.OUT_OF_RANGE;case ho.UNIMPLEMENTED:return wt.UNIMPLEMENTED;case ho.DATA_LOSS:return wt.DATA_LOSS;default:return Xn()}}($r=ho||(ho={}))[$r.OK=0]="OK",$r[$r.CANCELLED=1]="CANCELLED",$r[$r.UNKNOWN=2]="UNKNOWN",$r[$r.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$r[$r.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$r[$r.NOT_FOUND=5]="NOT_FOUND",$r[$r.ALREADY_EXISTS=6]="ALREADY_EXISTS",$r[$r.PERMISSION_DENIED=7]="PERMISSION_DENIED",$r[$r.UNAUTHENTICATED=16]="UNAUTHENTICATED",$r[$r.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$r[$r.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$r[$r.ABORTED=10]="ABORTED",$r[$r.OUT_OF_RANGE=11]="OUT_OF_RANGE",$r[$r.UNIMPLEMENTED=12]="UNIMPLEMENTED",$r[$r.INTERNAL=13]="INTERNAL",$r[$r.UNAVAILABLE=14]="UNAVAILABLE",$r[$r.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G3e=new Ug([4294967295,4294967295],0);function BJ(n){const e=rse().encode(n),i=new Xie;return i.update(e),new Uint8Array(i.digest())}function WJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Ug([i,o],0),new Ug([l,u],0)]}class F4{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new aC(`Invalid padding: ${i}`);if(o<0)throw new aC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new aC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new aC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Ug.fromNumber(this.Ee)}Ae(e,i,o){let l=e.add(i.multiply(Ug.fromNumber(o)));return l.compare(G3e)===1&&(l=new Ug([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=BJ(e),[o,l]=WJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(o,l,u);if(!this.Re(f))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),f=new F4(u,l,i);return o.forEach(_=>f.insert(_)),f}insert(e){if(this.Ee===0)return;const i=BJ(e),[o,l]=WJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(o,l,u);this.Ve(f)}}Ve(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class aC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P1{constructor(e,i,o,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,LR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new P1(er.min(),l,new Is(br),am(),Vr())}}class LR{constructor(e,i,o,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new LR(o,i,Vr(),Vr(),Vr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk{constructor(e,i,o,l){this.me=e,this.removedTargetIds=i,this.key=o,this.fe=l}}class Lse{constructor(e,i){this.targetId=e,this.ge=i}}class Mse{constructor(e,i,o=La.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class zJ{constructor(){this.pe=0,this.ye=GJ(),this.we=La.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Vr(),i=Vr(),o=Vr();return this.ye.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:Xn()}}),new LR(this.we,this.Se,e,i,o)}Me(){this.be=!1,this.ye=GJ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,yi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class H3e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=am(),this.$e=QO(),this.Ue=QO(),this.Ke=new Is(br)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const o=this.He(i);switch(e.state){case 0:this.Je(i)&&o.Ce(e.resumeToken);break;case 1:o.Be(),o.De||o.Me(),o.Ce(e.resumeToken);break;case 2:o.Be(),o.De||this.removeTarget(i);break;case 3:this.Je(i)&&(o.Le(),o.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),o.Ce(e.resumeToken));break;default:Xn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((o,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,o=e.ge.count,l=this.Xe(i);if(l){const u=l.target;if(hj(u))if(o===0){const f=new Rn(u.path);this.ze(i,f,uc.newNoDocument(f,er.min()))}else yi(o===1);else{const f=this.et(i);if(f!==o){const _=this.tt(e),E=_?this.nt(_,e,f):1;if(E!==0){this.Ye(i);const S=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,S)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:u=0}=i;let f,_;try{f=Hg(o).toUint8Array()}catch(E){if(E instanceof ase)return U0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new F4(f,l,u)}catch(E){return U0(E instanceof aC?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,o){return i.ge.count===o-this.st(e,i.targetId)?0:2}st(e,i){const o=this.ke.getRemoteKeysForTarget(i);let l=0;return o.forEach(u=>{const f=this.ke.it(),_=`projects/${f.projectId}/databases/${f.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,u,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((u,f)=>{const _=this.Xe(f);if(_){if(u.current&&hj(_.target)){const E=new Rn(_.target.path);this._t(E).has(f)||this.ut(f,E)||this.ze(f,E,uc.newNoDocument(E,e))}u.ve&&(i.set(f,u.Fe()),u.Me())}});let o=Vr();this.Ue.forEach((u,f)=>{let _=!0;f.forEachWhile(E=>{const S=this.Xe(E);return!S||S.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(o=o.add(u))}),this.Qe.forEach((u,f)=>f.setReadTime(e));const l=new P1(e,i,this.Ke,this.Qe,o);return this.Qe=am(),this.$e=QO(),this.Ue=QO(),this.Ke=new Is(br),l}Ge(e,i){if(!this.Je(e))return;const o=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,o),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,o){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),o&&(this.Qe=this.Qe.insert(i,o))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new zJ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new Mo(br),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new Mo(br),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||sn("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new zJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function QO(){return new Is(Rn.comparator)}function GJ(){return new Is(Rn.comparator)}const $3e={asc:"ASCENDING",desc:"DESCENDING"},K3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},q3e={and:"AND",or:"OR"};class Y3e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function fj(n,e){return n.useProto3Json||S1(e)?e:{value:e}}function SN(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Use(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function X3e(n,e){return SN(n,e.toTimestamp())}function Rp(n){return yi(!!n),er.fromTimestamp(function(i){const o=Gg(i);return new Lo(o.seconds,o.nanos)}(n))}function B4(n,e){return mj(n,e).canonicalString()}function mj(n,e){const i=function(l){return new qi(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Vse(n){const e=qi.fromString(n);return yi(zse(e)),e}function gj(n,e){return B4(n.databaseId,e.path)}function VU(n,e){const i=Vse(e);if(i.get(1)!==n.databaseId.projectId)throw new Xt(wt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Xt(wt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Rn(Fse(i))}function jse(n,e){return B4(n.databaseId,e)}function J3e(n){const e=Vse(n);return e.length===4?qi.emptyPath():Fse(e)}function _j(n){return new qi(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Fse(n){return yi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function HJ(n,e,i){return{name:gj(n,e),fields:i.value.mapValue.fields}}function Q3e(n,e){let i;if("targetChange"in e){e.targetChange;const o=function(S){return S==="NO_CHANGE"?0:S==="ADD"?1:S==="REMOVE"?2:S==="CURRENT"?3:S==="RESET"?4:Xn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(S,C){return S.useProto3Json?(yi(C===void 0||typeof C=="string"),La.fromBase64String(C||"")):(yi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),La.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),f=e.targetChange.cause,_=f&&function(S){const C=S.code===void 0?wt.UNKNOWN:xse(S.code);return new Xt(C,S.message||"")}(f);i=new Mse(o,l,u,_||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=VU(n,o.document.name),u=Rp(o.document.updateTime),f=o.document.createTime?Rp(o.document.createTime):er.min(),_=new Sl({mapValue:{fields:o.document.fields}}),E=uc.newFoundDocument(l,u,f,_),S=o.targetIds||[],C=o.removedTargetIds||[];i=new Mk(S,C,E.key,E)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=VU(n,o.document),u=o.readTime?Rp(o.readTime):er.min(),f=uc.newNoDocument(l,u),_=o.removedTargetIds||[];i=new Mk([],_,f.key,f)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=VU(n,o.document),u=o.removedTargetIds||[];i=new Mk([],u,l,null)}else{if(!("filter"in e))return Xn();{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:u}=o,f=new W3e(l,u),_=o.targetId;i=new Lse(_,f)}}return i}function Z3e(n,e){let i;if(e instanceof xR)i={update:HJ(n,e.key,e.value)};else if(e instanceof V4)i={delete:gj(n,e.key)};else if(e instanceof n_)i={update:HJ(n,e.key,e.data),updateMask:c5e(e.fieldMask)};else{if(!(e instanceof j3e))return Xn();i={verify:gj(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(u,f){const _=f.transform;if(_ instanceof EN)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof W0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof z0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof vN)return{fieldPath:f.field.canonicalString(),increment:_.Ie};throw Xn()}(0,o))),e.precondition.isNone||(i.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:X3e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Xn()}(n,e.precondition)),i}function e5e(n,e){return n&&n.length>0?(yi(e!==void 0),n.map(i=>function(l,u){let f=l.updateTime?Rp(l.updateTime):Rp(u);return f.isEqual(er.min())&&(f=Rp(u)),new M3e(f,l.transformResults||[])}(i,e))):[]}function t5e(n,e){return{documents:[jse(n,e.path)]}}function n5e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=jse(n,l);const u=function(S){if(S.length!==0)return Wse(ch.create(S,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const f=function(S){if(S.length!==0)return S.map(C=>function(O){return{field:zS(O.field),direction:s5e(O.dir)}}(C))}(e.orderBy);f&&(i.structuredQuery.orderBy=f);const _=fj(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(S){return{before:S.inclusive,values:S.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(S){return{before:!S.inclusive,values:S.position}}(e.endAt)),{ht:i,parent:l}}function r5e(n){let e=J3e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){yi(o===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let u=[];i.where&&(u=function(I){const O=Bse(I);return O instanceof ch&&_se(O)?O.getFilters():[O]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(O=>function(L){return new sR(GS(L.field),function(B){switch(B){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(O))}(i.orderBy));let _=null;i.limit&&(_=function(I){let O;return O=typeof I=="object"?I.value:I,S1(O)?null:O}(i.limit));let E=null;i.startAt&&(E=function(I){const O=!!I.before,M=I.values||[];return new B0(M,O)}(i.startAt));let S=null;return i.endAt&&(S=function(I){const O=!I.before,M=I.values||[];return new B0(M,O)}(i.endAt)),T3e(e,l,f,u,_,"F",E,S)}function i5e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Xn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Bse(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=GS(i.unaryFilter.field);return go.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=GS(i.unaryFilter.field);return go.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=GS(i.unaryFilter.field);return go.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=GS(i.unaryFilter.field);return go.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Xn()}}(n):n.fieldFilter!==void 0?function(i){return go.create(GS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Xn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return ch.create(i.compositeFilter.filters.map(o=>Bse(o)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Xn()}}(i.compositeFilter.op))}(n):Xn()}function s5e(n){return $3e[n]}function o5e(n){return K3e[n]}function a5e(n){return q3e[n]}function zS(n){return{fieldPath:n.canonicalString()}}function GS(n){return xa.fromServerFormat(n.fieldPath)}function Wse(n){return n instanceof go?function(i){if(i.op==="=="){if(NJ(i.value))return{unaryFilter:{field:zS(i.field),op:"IS_NAN"}};if(kJ(i.value))return{unaryFilter:{field:zS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(NJ(i.value))return{unaryFilter:{field:zS(i.field),op:"IS_NOT_NAN"}};if(kJ(i.value))return{unaryFilter:{field:zS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zS(i.field),op:o5e(i.op),value:i.value}}}(n):n instanceof ch?function(i){const o=i.getFilters().map(l=>Wse(l));return o.length===1?o[0]:{compositeFilter:{op:a5e(i.op),filters:o}}}(n):Xn()}function c5e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function zse(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(e,i,o,l,u=er.min(),f=er.min(),_=La.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new Dg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Dg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Dg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5e{constructor(e){this.Tt=e}}function u5e(n){const e=r5e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yN(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5e{constructor(){this.Tn=new h5e}addToCollectionParentIndex(e,i){return this.Tn.add(i),Pt.resolve()}getCollectionParents(e,i){return Pt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Pt.resolve()}deleteFieldIndex(e,i){return Pt.resolve()}deleteAllFieldIndexes(e){return Pt.resolve()}createTargetIndexes(e,i){return Pt.resolve()}getDocumentsMatchingTarget(e,i){return Pt.resolve(null)}getIndexType(e,i){return Pt.resolve(0)}getFieldIndexes(e,i){return Pt.resolve([])}getNextCollectionGroupToUpdate(e){return Pt.resolve(null)}getMinOffset(e,i){return Pt.resolve(zg.min())}getMinOffsetFromCollectionGroup(e,i){return Pt.resolve(zg.min())}updateCollectionGroup(e,i,o){return Pt.resolve()}updateIndexEntries(e,i){return Pt.resolve()}}class h5e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new Mo(qi.comparator),u=!l.has(o);return this.index[i]=l.add(o),u}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new Mo(qi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $J={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gse=41943040;class yl{static withCacheSize(e){return new yl(e,yl.DEFAULT_COLLECTION_PERCENTILE,yl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yl.DEFAULT_COLLECTION_PERCENTILE=10,yl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yl.DEFAULT=new yl(Gse,yl.DEFAULT_COLLECTION_PERCENTILE,yl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yl.DISABLED=new yl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new G0(0)}static Kn(){return new G0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KJ="LruGarbageCollector",p5e=1048576;function qJ([n,e],[i,o]){const l=br(n,i);return l===0?br(e,o):l}class f5e{constructor(e){this.Hn=e,this.buffer=new Mo(qJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();qJ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class m5e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){sn(KJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){ob(i)?sn(KJ,"Ignoring IndexedDB error during garbage collection: ",i):await sb(i)}await this.er(3e5)})}}class g5e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(o=>Math.floor(i/100*o))}nthSequenceNumber(e,i){if(i===0)return Pt.resolve(v1.ae);const o=new f5e(i);return this.tr.forEachTarget(e,l=>o.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>o.Zn(l))).next(()=>o.maxValue)}removeTargets(e,i,o){return this.tr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(sn("LruGarbageCollector","Garbage collection skipped; disabled"),Pt.resolve($J)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(sn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$J):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let o,l,u,f,_,E,S;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(sn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(o=I,_=Date.now(),this.removeTargets(e,o,i))).next(I=>(u=I,E=Date.now(),this.removeOrphanedDocuments(e,o))).next(I=>(S=Date.now(),BS()<=Lr.DEBUG&&sn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-C}ms
	Determined least recently used ${l} in `+(_-f)+`ms
	Removed ${u} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(S-E)+`ms
Total Duration: ${S-C}ms`),Pt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:I})))}}function _5e(n,e){return new g5e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5e{constructor(){this.changes=new dE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,uc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?Pt.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E5e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(o=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(o!==null&&AC(o.mutation,l,ru.empty(),Lo.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,Vr()).next(()=>o))}getLocalViewOfDocuments(e,i,o=Vr()){const l=Ly();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,o).next(u=>{let f=oC();return u.forEach((_,E)=>{f=f.insert(_,E.overlayedDocument)}),f}))}getOverlayedDocuments(e,i){const o=Ly();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,Vr()))}populateOverlays(e,i,o){const l=[];return o.forEach(u=>{i.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((f,_)=>{i.set(f,_)})})}computeViews(e,i,o,l){let u=am();const f=IC(),_=function(){return IC()}();return i.forEach((E,S)=>{const C=o.get(S.key);l.has(S.key)&&(C===void 0||C.mutation instanceof n_)?u=u.insert(S.key,S):C!==void 0?(f.set(S.key,C.mutation.getFieldMask()),AC(C.mutation,S,C.mutation.getFieldMask(),Lo.now())):f.set(S.key,ru.empty())}),this.recalculateAndSaveOverlays(e,u).next(E=>(E.forEach((S,C)=>f.set(S,C)),i.forEach((S,C)=>{var I;return _.set(S,new E5e(C,(I=f.get(S))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const o=IC();let l=new Is((f,_)=>f-_),u=Vr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(f=>{for(const _ of f)_.keys().forEach(E=>{const S=i.get(E);if(S===null)return;let C=o.get(E)||ru.empty();C=_.applyToLocalView(S,C),o.set(E,C);const I=(l.get(_.batchId)||Vr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const f=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),S=E.key,C=E.value,I=Cse();C.forEach(O=>{if(!u.has(O)){const M=Nse(i.get(O),o.get(O));M!==null&&I.set(O,M),u=u.add(O)}}),f.push(this.documentOverlayCache.saveOverlays(e,S,I))}return Pt.waitFor(f)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,l){return function(f){return Rn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):M4(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next(u=>{const f=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-u.size):Pt.resolve(Ly());let _=tR,E=u;return f.next(S=>Pt.forEach(S,(C,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),u.get(C)?Pt.resolve():this.remoteDocumentCache.getEntry(e,C).next(O=>{E=E.insert(C,O)}))).next(()=>this.populateOverlays(e,S,u)).next(()=>this.computeViews(e,E,S,Vr())).next(C=>({batchId:_,changes:wse(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Rn(i)).next(o=>{let l=oC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const u=i.collectionGroup;let f=oC();return this.indexManager.getCollectionParents(e,u).next(_=>Pt.forEach(_,E=>{const S=function(I,O){return new uE(O,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(u));return this.getDocumentsMatchingCollectionQuery(e,S,o,l).next(C=>{C.forEach((I,O)=>{f=f.insert(I,O)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,i,o,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(f=>(u=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,u,l))).next(f=>{u.forEach((E,S)=>{const C=S.getKey();f.get(C)===null&&(f=f.insert(C,uc.newInvalidDocument(C)))});let _=oC();return f.forEach((E,S)=>{const C=u.get(E);C!==void 0&&AC(C.mutation,S,ru.empty(),Lo.now()),R1(i,S)&&(_=_.insert(E,S))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S5e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Pt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:Rp(l.createTime)}}(i)),Pt.resolve()}getNamedQuery(e,i){return Pt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:u5e(l.bundledQuery),readTime:Rp(l.readTime)}}(i)),Pt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b5e{constructor(){this.overlays=new Is(Rn.comparator),this.Rr=new Map}getOverlay(e,i){return Pt.resolve(this.overlays.get(i))}getOverlays(e,i){const o=Ly();return Pt.forEach(i,l=>this.getOverlay(e,l).next(u=>{u!==null&&o.set(l,u)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((l,u)=>{this.Et(e,i,u)}),Pt.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.Rr.get(o);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Rr.delete(o)),Pt.resolve()}getOverlaysForCollection(e,i,o){const l=Ly(),u=i.length+1,f=new Rn(i.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const E=_.getNext().value,S=E.getKey();if(!i.isPrefixOf(S.path))break;S.path.length===u&&E.largestBatchId>o&&l.set(E.getKey(),E)}return Pt.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let u=new Is((S,C)=>S-C);const f=this.overlays.getIterator();for(;f.hasNext();){const S=f.getNext().value;if(S.getKey().getCollectionGroup()===i&&S.largestBatchId>o){let C=u.get(S.largestBatchId);C===null&&(C=Ly(),u=u.insert(S.largestBatchId,C)),C.set(S.getKey(),S)}}const _=Ly(),E=u.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((S,C)=>_.set(S,C)),!(_.size()>=l)););return Pt.resolve(_)}Et(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(o.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(o.key,new B3e(i,o));let u=this.Rr.get(i);u===void 0&&(u=Vr(),this.Rr.set(i,u)),this.Rr.set(i,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5e{constructor(){this.sessionToken=La.EMPTY_BYTE_STRING}getSessionToken(e){return Pt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Pt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4{constructor(){this.Vr=new Mo(na.mr),this.gr=new Mo(na.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const o=new na(e,i);this.Vr=this.Vr.add(o),this.gr=this.gr.add(o)}yr(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.wr(new na(e,i))}Sr(e,i){e.forEach(o=>this.removeReference(o,i))}br(e){const i=new Rn(new qi([])),o=new na(i,e),l=new na(i,e+1),u=[];return this.gr.forEachInRange([o,l],f=>{this.wr(f),u.push(f.key)}),u}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Rn(new qi([])),o=new na(i,e),l=new na(i,e+1);let u=Vr();return this.gr.forEachInRange([o,l],f=>{u=u.add(f.key)}),u}containsKey(e){const i=new na(e,0),o=this.Vr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class na{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Rn.comparator(e.key,i.key)||br(e.Cr,i.Cr)}static pr(e,i){return br(e.Cr,i.Cr)||Rn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new Mo(na.mr)}checkEmpty(e){return Pt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const u=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new F3e(u,i,o,l);this.mutationQueue.push(f);for(const _ of l)this.Mr=this.Mr.add(new na(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Pt.resolve(f)}lookupMutationBatch(e,i){return Pt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Nr(o),u=l<0?0:l;return Pt.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return Pt.resolve(this.mutationQueue.length===0?N4:this.Fr-1)}getAllMutationBatches(e){return Pt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new na(i,0),l=new na(i,Number.POSITIVE_INFINITY),u=[];return this.Mr.forEachInRange([o,l],f=>{const _=this.Or(f.Cr);u.push(_)}),Pt.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new Mo(br);return i.forEach(l=>{const u=new na(l,0),f=new na(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([u,f],_=>{o=o.add(_.Cr)})}),Pt.resolve(this.Br(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let u=o;Rn.isDocumentKey(u)||(u=u.child(""));const f=new na(new Rn(u),0);let _=new Mo(br);return this.Mr.forEachWhile(E=>{const S=E.key.path;return!!o.isPrefixOf(S)&&(S.length===l&&(_=_.add(E.Cr)),!0)},f),Pt.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(o=>{const l=this.Or(o);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){yi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.Mr;return Pt.forEach(i.mutations,l=>{const u=new na(l.key,i.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=o})}qn(e){}containsKey(e,i){const o=new na(i,0),l=this.Mr.firstAfterOrEqual(o);return Pt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Pt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5e{constructor(e){this.kr=e,this.docs=function(){return new Is(Rn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),u=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:f}),this.size+=f-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return Pt.resolve(o?o.document.mutableCopy():uc.newInvalidDocument(i))}getEntries(e,i){let o=am();return i.forEach(l=>{const u=this.docs.get(l);o=o.insert(l,u?u.document.mutableCopy():uc.newInvalidDocument(l))}),Pt.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let u=am();const f=i.path,_=new Rn(f.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:S,value:{document:C}}=E.getNext();if(!f.isPrefixOf(S.path))break;S.path.length>f.length+1||t3e(e3e(C),o)<=0||(l.has(C.key)||R1(i,C))&&(u=u.insert(C.key,C.mutableCopy()))}return Pt.resolve(u)}getAllFromCollectionGroup(e,i,o,l){Xn()}qr(e,i){return Pt.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new R5e(this)}getSize(e){return Pt.resolve(this.size)}}class R5e extends y5e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((o,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(o)}),Pt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5e{constructor(e){this.persistence=e,this.Qr=new dE(i=>x4(i),L4),this.lastRemoteSnapshotVersion=er.min(),this.highestTargetId=0,this.$r=0,this.Ur=new W4,this.targetCount=0,this.Kr=G0.Un()}forEachTarget(e,i){return this.Qr.forEach((o,l)=>i(l)),Pt.resolve()}getLastRemoteSnapshotVersion(e){return Pt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Pt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Pt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.$r&&(this.$r=i),Pt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new G0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Pt.resolve()}updateTargetData(e,i){return this.zn(i),Pt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Pt.resolve()}removeTargets(e,i,o){let l=0;const u=[];return this.Qr.forEach((f,_)=>{_.sequenceNumber<=i&&o.get(_.targetId)===null&&(this.Qr.delete(f),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),Pt.waitFor(u).next(()=>l)}getTargetCount(e){return Pt.resolve(this.targetCount)}getTargetData(e,i){const o=this.Qr.get(i)||null;return Pt.resolve(o)}addMatchingKeys(e,i,o){return this.Ur.yr(i,o),Pt.resolve()}removeMatchingKeys(e,i,o){this.Ur.Sr(i,o);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach(f=>{u.push(l.markPotentiallyOrphaned(e,f))}),Pt.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),Pt.resolve()}getMatchingKeysForTargetId(e,i){const o=this.Ur.vr(i);return Pt.resolve(o)}containsKey(e,i){return Pt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hse{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new v1(0),this.zr=!1,this.zr=!0,this.jr=new T5e,this.referenceDelegate=e(this),this.Hr=new I5e(this),this.indexManager=new d5e,this.remoteDocumentCache=function(l){return new C5e(l)}(o=>this.referenceDelegate.Jr(o)),this.serializer=new l5e(i),this.Yr=new S5e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new b5e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Wr[e.toKey()];return o||(o=new w5e(i,this.referenceDelegate),this.Wr[e.toKey()]=o),o}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,o){sn("MemoryPersistence","Starting transaction:",e);const l=new A5e(this.Gr.next());return this.referenceDelegate.Zr(),o(l).next(u=>this.referenceDelegate.Xr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}ei(e,i){return Pt.or(Object.values(this.Wr).map(o=>()=>o.containsKey(e,i)))}}class A5e extends r3e{constructor(e){super(),this.currentSequenceNumber=e}}class z4{constructor(e){this.persistence=e,this.ti=new W4,this.ni=null}static ri(e){return new z4(e)}get ii(){if(this.ni)return this.ni;throw Xn()}addReference(e,i,o){return this.ti.addReference(o,i),this.ii.delete(o.toString()),Pt.resolve()}removeReference(e,i,o){return this.ti.removeReference(o,i),this.ii.add(o.toString()),Pt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Pt.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(u=>this.ii.add(u.toString()))}).next(()=>o.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pt.forEach(this.ii,o=>{const l=Rn.fromPath(o);return this.si(e,l).next(u=>{u||i.removeEntry(l,er.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(o=>{o?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Pt.or([()=>Pt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class bN{constructor(e,i){this.persistence=e,this.oi=new dE(o=>o3e(o.path),(o,l)=>o.isEqual(l)),this.garbageCollector=_5e(this,i)}static ri(e,i){return new bN(e,i)}Zr(){}Xr(e){return Pt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>i.next(l=>o+l))}sr(e){let i=0;return this.rr(e,o=>{i++}).next(()=>i)}rr(e,i){return Pt.forEach(this.oi,(o,l)=>this.ar(e,o,l).next(u=>u?Pt.resolve():i(l)))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.qr(e,f=>this.ar(e,f,i).next(_=>{_||(o++,u.removeEntry(f,er.min()))})).next(()=>u.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Pt.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Pt.resolve()}removeReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Pt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Pt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=Dk(e.data.value)),i}ar(e,i,o){return Pt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Pt.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Hi=o,this.Ji=l}static Yi(e,i){let o=Vr(),l=Vr();for(const u of i.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new G4(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O5e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return uVe()?8:i3e(pc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,o,l){const u={result:null};return this.rs(e,i).next(f=>{u.result=f}).next(()=>{if(!u.result)return this.ss(e,i,l,o).next(f=>{u.result=f})}).next(()=>{if(u.result)return;const f=new P5e;return this._s(e,i,f).next(_=>{if(u.result=_,this.Xi)return this.us(e,i,f,_.size)})}).next(()=>u.result)}us(e,i,o,l){return o.documentReadCount<this.es?(BS()<=Lr.DEBUG&&sn("QueryEngine","SDK will not create cache indexes for query:",WS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Pt.resolve()):(BS()<=Lr.DEBUG&&sn("QueryEngine","Query:",WS(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.ts*l?(BS()<=Lr.DEBUG&&sn("QueryEngine","The SDK decides to create cache indexes for query:",WS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Cp(i))):Pt.resolve())}rs(e,i){if(MJ(i))return Pt.resolve(null);let o=Cp(i);return this.indexManager.getIndexType(e,o).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=yN(i,null,"F"),o=Cp(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(u=>{const f=Vr(...u);return this.ns.getDocuments(e,f).next(_=>this.indexManager.getMinOffset(e,o).next(E=>{const S=this.cs(i,_);return this.ls(i,S,f,E.readTime)?this.rs(e,yN(i,null,"F")):this.hs(e,S,i,E)}))})))}ss(e,i,o,l){return MJ(i)||l.isEqual(er.min())?Pt.resolve(null):this.ns.getDocuments(e,o).next(u=>{const f=this.cs(i,u);return this.ls(i,f,o,l)?Pt.resolve(null):(BS()<=Lr.DEBUG&&sn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),WS(i)),this.hs(e,f,i,Z4e(l,tR)).next(_=>_))})}cs(e,i){let o=new Mo(bse(e));return i.forEach((l,u)=>{R1(e,u)&&(o=o.add(u))}),o}ls(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}_s(e,i,o){return BS()<=Lr.DEBUG&&sn("QueryEngine","Using full collection scan to execute query:",WS(i)),this.ns.getDocumentsMatchingQuery(e,i,zg.min(),o)}hs(e,i,o,l){return this.ns.getDocumentsMatchingQuery(e,o,l).next(u=>(i.forEach(f=>{u=u.insert(f.key,f)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H4="LocalStore",k5e=3e8;class N5e{constructor(e,i,o,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new Is(br),this.Is=new dE(u=>x4(u),L4),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(o)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new v5e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function D5e(n,e,i,o){return new N5e(n,e,i,o)}async function $se(n,e){const i=ir(n);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next(u=>(l=u,i.As(e),i.mutationQueue.getAllMutationBatches(o))).next(u=>{const f=[],_=[];let E=Vr();for(const S of l){f.push(S.batchId);for(const C of S.mutations)E=E.add(C.key)}for(const S of u){_.push(S.batchId);for(const C of S.mutations)E=E.add(C.key)}return i.localDocuments.getDocuments(o,E).next(S=>({Rs:S,removedBatchIds:f,addedBatchIds:_}))})})}function x5e(n,e){const i=ir(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const l=e.batch.keys(),u=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,S,C){const I=S.batch,O=I.keys();let M=Pt.resolve();return O.forEach(L=>{M=M.next(()=>C.getEntry(E,L)).next(U=>{const B=S.docVersions.get(L);yi(B!==null),U.version.compareTo(B)<0&&(I.applyToRemoteDocument(U,S),U.isValidDocument()&&(U.setReadTime(S.commitVersion),C.addEntry(U)))})}),M.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,o,e,u).next(()=>u.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(_){let E=Vr();for(let S=0;S<_.mutationResults.length;++S)_.mutationResults[S].transformResults.length>0&&(E=E.add(_.batch.mutations[S].key));return E}(e))).next(()=>i.localDocuments.getDocuments(o,l))})}function Kse(n){const e=ir(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function L5e(n,e){const i=ir(n),o=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((C,I)=>{const O=l.get(I);if(!O)return;_.push(i.Hr.removeMatchingKeys(u,C.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(u,C.addedDocuments,I)));let M=O.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(I)!==null?M=M.withResumeToken(La.EMPTY_BYTE_STRING,er.min()).withLastLimboFreeSnapshotVersion(er.min()):C.resumeToken.approximateByteSize()>0&&(M=M.withResumeToken(C.resumeToken,o)),l=l.insert(I,M),function(U,B,J){return U.resumeToken.approximateByteSize()===0||B.snapshotVersion.toMicroseconds()-U.snapshotVersion.toMicroseconds()>=k5e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(O,M,C)&&_.push(i.Hr.updateTargetData(u,M))});let E=am(),S=Vr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(u,C))}),_.push(M5e(u,f,e.documentUpdates).next(C=>{E=C.Vs,S=C.fs})),!o.isEqual(er.min())){const C=i.Hr.getLastRemoteSnapshotVersion(u).next(I=>i.Hr.setTargetsMetadata(u,u.currentSequenceNumber,o));_.push(C)}return Pt.waitFor(_).next(()=>f.apply(u)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,E,S)).next(()=>E)}).then(u=>(i.Ts=l,u))}function M5e(n,e,i){let o=Vr(),l=Vr();return i.forEach(u=>o=o.add(u)),e.getEntries(n,o).next(u=>{let f=am();return i.forEach((_,E)=>{const S=u.get(_);E.isFoundDocument()!==S.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(er.min())?(e.removeEntry(_,E.readTime),f=f.insert(_,E)):!S.isValidDocument()||E.version.compareTo(S.version)>0||E.version.compareTo(S.version)===0&&S.hasPendingWrites?(e.addEntry(E),f=f.insert(_,E)):sn(H4,"Ignoring outdated watch update for ",_,". Current version:",S.version," Watch version:",E.version)}),{Vs:f,fs:l}})}function U5e(n,e){const i=ir(n);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=N4),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function V5e(n,e){const i=ir(n);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let l;return i.Hr.getTargetData(o,e).next(u=>u?(l=u,Pt.resolve(l)):i.Hr.allocateTargetId(o).next(f=>(l=new Dg(e,f,"TargetPurposeListen",o.currentSequenceNumber),i.Hr.addTargetData(o,l).next(()=>l))))}).then(o=>{const l=i.Ts.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(o.targetId,o),i.Is.set(e,o.targetId)),o})}async function yj(n,e,i){const o=ir(n),l=o.Ts.get(e),u=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",u,f=>o.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!ob(f))throw f;sn(H4,`Failed to update sequence numbers for target ${e}: ${f}`)}o.Ts=o.Ts.remove(e),o.Is.delete(l.target)}function YJ(n,e,i){const o=ir(n);let l=er.min(),u=Vr();return o.persistence.runTransaction("Execute query","readwrite",f=>function(E,S,C){const I=ir(E),O=I.Is.get(C);return O!==void 0?Pt.resolve(I.Ts.get(O)):I.Hr.getTargetData(S,C)}(o,f,Cp(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,o.Hr.getMatchingKeysForTargetId(f,_.targetId).next(E=>{u=E})}).next(()=>o.Ps.getDocumentsMatchingQuery(f,e,i?l:er.min(),i?u:Vr())).next(_=>(j5e(o,C3e(e),_),{documents:_,gs:u})))}function j5e(n,e,i){let o=n.Es.get(e)||er.min();i.forEach((l,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)}),n.Es.set(e,o)}class XJ{constructor(){this.activeTargetIds=k3e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class F5e{constructor(){this.ho=new XJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,o){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new XJ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JJ="ConnectivityMonitor";class QJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){sn(JJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){sn(JJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ZO=null;function Ej(){return ZO===null?ZO=function(){return 268435456+Math.round(2147483648*Math.random())}():ZO++,"0x"+ZO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jU="RestConnection",W5e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class z5e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${o}/databases/${l}`,this.wo=this.databaseId.database===mN?`project_id=${o}`:`project_id=${o}&database_id=${l}`}So(e,i,o,l,u){const f=Ej(),_=this.bo(e,i.toUriEncodedString());sn(jU,`Sending RPC '${e}' ${f}:`,_,o);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,u),this.vo(e,_,E,o).then(S=>(sn(jU,`Received RPC '${e}' ${f}: `,S),S),S=>{throw U0(jU,`RPC '${e}' ${f} failed with error: `,S,"url: ",_,"request:",o),S})}Co(e,i,o,l,u,f){return this.So(e,i,o,l,u)}Do(e,i,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ib}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,u)=>e[u]=l),o&&o.headers.forEach((l,u)=>e[u]=l)}bo(e,i){const o=W5e[e];return`${this.po}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G5e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oc="WebChannelConnection";class H5e extends z5e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,o,l){const u=Ej();return new Promise((f,_)=>{const E=new Jie;E.setWithCredentials(!0),E.listenOnce(Qie.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case Nk.NO_ERROR:const C=E.getResponseJson();sn(oc,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(C)),f(C);break;case Nk.TIMEOUT:sn(oc,`RPC '${e}' ${u} timed out`),_(new Xt(wt.DEADLINE_EXCEEDED,"Request time out"));break;case Nk.HTTP_ERROR:const I=E.getStatus();if(sn(oc,`RPC '${e}' ${u} failed with status:`,I,"response text:",E.getResponseText()),I>0){let O=E.getResponseJson();Array.isArray(O)&&(O=O[0]);const M=O==null?void 0:O.error;if(M&&M.status&&M.message){const L=function(B){const J=B.toLowerCase().replace(/_/g,"-");return Object.values(wt).indexOf(J)>=0?J:wt.UNKNOWN}(M.status);_(new Xt(L,M.message))}else _(new Xt(wt.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new Xt(wt.UNAVAILABLE,"Connection failed."));break;default:Xn()}}finally{sn(oc,`RPC '${e}' ${u} completed.`)}});const S=JSON.stringify(l);sn(oc,`RPC '${e}' ${u} sending request:`,l),E.send(i,"POST",S,o,15)})}Wo(e,i,o){const l=Ej(),u=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=tse(),_=ese(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},S=this.longPollingOptions.timeoutSeconds;S!==void 0&&(E.longPollingTimeout=Math.round(1e3*S)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,o),E.encodeInitMessageHeaders=!0;const C=u.join("");sn(oc,`Creating RPC '${e}' stream ${l}: ${C}`,E);const I=f.createWebChannel(C,E);let O=!1,M=!1;const L=new G5e({Fo:B=>{M?sn(oc,`Not sending because RPC '${e}' stream ${l} is closed:`,B):(O||(sn(oc,`Opening RPC '${e}' stream ${l} transport.`),I.open(),O=!0),sn(oc,`RPC '${e}' stream ${l} sending:`,B),I.send(B))},Mo:()=>I.close()}),U=(B,J,K)=>{B.listen(J,ne=>{try{K(ne)}catch(oe){setTimeout(()=>{throw oe},0)}})};return U(I,sC.EventType.OPEN,()=>{M||(sn(oc,`RPC '${e}' stream ${l} transport opened.`),L.Qo())}),U(I,sC.EventType.CLOSE,()=>{M||(M=!0,sn(oc,`RPC '${e}' stream ${l} transport closed`),L.Uo())}),U(I,sC.EventType.ERROR,B=>{M||(M=!0,U0(oc,`RPC '${e}' stream ${l} transport errored:`,B),L.Uo(new Xt(wt.UNAVAILABLE,"The operation could not be completed")))}),U(I,sC.EventType.MESSAGE,B=>{var J;if(!M){const K=B.data[0];yi(!!K);const ne=K,oe=(ne==null?void 0:ne.error)||((J=ne[0])===null||J===void 0?void 0:J.error);if(oe){sn(oc,`RPC '${e}' stream ${l} received error:`,oe);const se=oe.status;let le=function(X){const ie=ho[X];if(ie!==void 0)return xse(ie)}(se),Y=oe.message;le===void 0&&(le=wt.INTERNAL,Y="Unknown error status: "+se+" with message "+oe.message),M=!0,L.Uo(new Xt(le,Y)),I.close()}else sn(oc,`RPC '${e}' stream ${l} received:`,K),L.Ko(K)}}),U(_,Zie.STAT_EVENT,B=>{B.stat===aj.PROXY?sn(oc,`RPC '${e}' stream ${l} detected buffering proxy`):B.stat===aj.NOPROXY&&sn(oc,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{L.$o()},0),L}}function FU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O1(n){return new Y3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qse{constructor(e,i,o=1e3,l=1.5,u=6e4){this.Ti=e,this.timerId=i,this.Go=o,this.zo=l,this.jo=u,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),o=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-o);l>0&&sn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZJ="PersistentStream";class Yse{constructor(e,i,o,l,u,f,_,E){this.Ti=e,this.n_=o,this.r_=l,this.connection=u,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new qse(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===wt.RESOURCE_EXHAUSTED?(om(i.toString()),om("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===wt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,l])=>{this.i_===i&&this.V_(o,l)},o=>{e(()=>{const l=new Xt(wt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.m_(l)})})}V_(e,i){const o=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{o(()=>this.listener.xo())}),this.stream.No(()=>{o(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{o(()=>this.m_(l))}),this.stream.onMessage(l=>{o(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return sn(ZJ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(sn(ZJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $5e extends Yse{constructor(e,i,o,l,u,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,f),this.serializer=u}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=Q3e(this.serializer,e),o=function(u){if(!("targetChange"in u))return er.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?er.min():f.readTime?Rp(f.readTime):er.min()}(e);return this.listener.p_(i,o)}y_(e){const i={};i.database=_j(this.serializer),i.addTarget=function(u,f){let _;const E=f.target;if(_=hj(E)?{documents:t5e(u,E)}:{query:n5e(u,E).ht},_.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){_.resumeToken=Use(u,f.resumeToken);const S=fj(u,f.expectedCount);S!==null&&(_.expectedCount=S)}else if(f.snapshotVersion.compareTo(er.min())>0){_.readTime=SN(u,f.snapshotVersion.toTimestamp());const S=fj(u,f.expectedCount);S!==null&&(_.expectedCount=S)}return _}(this.serializer,e);const o=i5e(this.serializer,e);o&&(i.labels=o),this.I_(i)}w_(e){const i={};i.database=_j(this.serializer),i.removeTarget=e,this.I_(i)}}class K5e extends Yse{constructor(e,i,o,l,u,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,f),this.serializer=u}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return yi(!!e.streamToken),this.lastStreamToken=e.streamToken,yi(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){yi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=e5e(e.writeResults,e.commitTime),o=Rp(e.commitTime);return this.listener.v_(o,i)}C_(){const e={};e.database=_j(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(o=>Z3e(this.serializer,o))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q5e{}class Y5e extends q5e{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Xt(wt.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,o,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.So(e,mj(i,o),l,u,f)).catch(u=>{throw u.name==="FirebaseError"?(u.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Xt(wt.UNKNOWN,u.toString())})}Co(e,i,o,l,u){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Co(e,mj(i,o),l,f,_,u)).catch(f=>{throw f.name==="FirebaseError"?(f.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Xt(wt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class X5e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(om(i),this.N_=!1):sn("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE="RemoteStore";class J5e{constructor(e,i,o,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=u,this.z_.To(f=>{o.enqueueAndForget(async()=>{hE(this)&&(sn(sE,"Restarting streams for network reachability change."),await async function(E){const S=ir(E);S.W_.add(4),await MR(S),S.j_.set("Unknown"),S.W_.delete(4),await k1(S)}(this))})}),this.j_=new X5e(o,l)}}async function k1(n){if(hE(n))for(const e of n.G_)await e(!0)}async function MR(n){for(const e of n.G_)await e(!1)}function Xse(n,e){const i=ir(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),Y4(i)?q4(i):ab(i).c_()&&K4(i,e))}function $4(n,e){const i=ir(n),o=ab(i);i.K_.delete(e),o.c_()&&Jse(i,e),i.K_.size===0&&(o.c_()?o.P_():hE(i)&&i.j_.set("Unknown"))}function K4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(er.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}ab(n).y_(e)}function Jse(n,e){n.H_.Ne(e),ab(n).w_(e)}function q4(n){n.H_=new H3e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),ab(n).start(),n.j_.B_()}function Y4(n){return hE(n)&&!ab(n).u_()&&n.K_.size>0}function hE(n){return ir(n).W_.size===0}function Qse(n){n.H_=void 0}async function Q5e(n){n.j_.set("Online")}async function Z5e(n){n.K_.forEach((e,i)=>{K4(n,e)})}async function eBe(n,e){Qse(n),Y4(n)?(n.j_.q_(e),q4(n)):n.j_.set("Unknown")}async function tBe(n,e,i){if(n.j_.set("Online"),e instanceof Mse&&e.state===2&&e.cause)try{await async function(l,u){const f=u.cause;for(const _ of u.targetIds)l.K_.has(_)&&(await l.remoteSyncer.rejectListen(_,f),l.K_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(o){sn(sE,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await TN(n,o)}else if(e instanceof Mk?n.H_.We(e):e instanceof Lse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(er.min()))try{const o=await Kse(n.localStore);i.compareTo(o)>=0&&await function(u,f){const _=u.H_.ot(f);return _.targetChanges.forEach((E,S)=>{if(E.resumeToken.approximateByteSize()>0){const C=u.K_.get(S);C&&u.K_.set(S,C.withResumeToken(E.resumeToken,f))}}),_.targetMismatches.forEach((E,S)=>{const C=u.K_.get(E);if(!C)return;u.K_.set(E,C.withResumeToken(La.EMPTY_BYTE_STRING,C.snapshotVersion)),Jse(u,E);const I=new Dg(C.target,E,S,C.sequenceNumber);K4(u,I)}),u.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(o){sn(sE,"Failed to raise snapshot:",o),await TN(n,o)}}async function TN(n,e,i){if(!ob(e))throw e;n.W_.add(1),await MR(n),n.j_.set("Offline"),i||(i=()=>Kse(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{sn(sE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await k1(n)})}function Zse(n,e){return e().catch(i=>TN(n,i,e))}async function N1(n){const e=ir(n),i=Kg(e);let o=e.U_.length>0?e.U_[e.U_.length-1].batchId:N4;for(;nBe(e);)try{const l=await U5e(e.localStore,o);if(l===null){e.U_.length===0&&i.P_();break}o=l.batchId,rBe(e,l)}catch(l){await TN(e,l)}eoe(e)&&toe(e)}function nBe(n){return hE(n)&&n.U_.length<10}function rBe(n,e){n.U_.push(e);const i=Kg(n);i.c_()&&i.S_&&i.b_(e.mutations)}function eoe(n){return hE(n)&&!Kg(n).u_()&&n.U_.length>0}function toe(n){Kg(n).start()}async function iBe(n){Kg(n).C_()}async function sBe(n){const e=Kg(n);for(const i of n.U_)e.b_(i.mutations)}async function oBe(n,e,i){const o=n.U_.shift(),l=j4.from(o,e,i);await Zse(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await N1(n)}async function aBe(n,e){e&&Kg(n).S_&&await async function(o,l){if(function(f){return z3e(f)&&f!==wt.ABORTED}(l.code)){const u=o.U_.shift();Kg(o).h_(),await Zse(o,()=>o.remoteSyncer.rejectFailedWrite(u.batchId,l)),await N1(o)}}(n,e),eoe(n)&&toe(n)}async function eQ(n,e){const i=ir(n);i.asyncQueue.verifyOperationInProgress(),sn(sE,"RemoteStore received new credentials");const o=hE(i);i.W_.add(3),await MR(i),o&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await k1(i)}async function cBe(n,e){const i=ir(n);e?(i.W_.delete(2),await k1(i)):e||(i.W_.add(2),await MR(i),i.j_.set("Unknown"))}function ab(n){return n.J_||(n.J_=function(i,o,l){const u=ir(i);return u.M_(),new $5e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:Q5e.bind(null,n),No:Z5e.bind(null,n),Lo:eBe.bind(null,n),p_:tBe.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),Y4(n)?q4(n):n.j_.set("Unknown")):(await n.J_.stop(),Qse(n))})),n.J_}function Kg(n){return n.Y_||(n.Y_=function(i,o,l){const u=ir(i);return u.M_(),new K5e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:iBe.bind(null,n),Lo:aBe.bind(null,n),D_:sBe.bind(null,n),v_:oBe.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await N1(n)):(await n.Y_.stop(),n.U_.length>0&&(sn(sE,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e,i,o,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=u,this.deferred=new Jf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,u){const f=Date.now()+o,_=new X4(e,i,f,l,u);return _.start(o),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Xt(wt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function J4(n,e){if(om("AsyncQueue",`${e}: ${n}`),ob(n))return new Xt(wt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{static emptySet(e){return new S0(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||Rn.comparator(i.key,o.key):(i,o)=>Rn.comparator(i.key,o.key),this.keyedMap=oC(),this.sortedSet=new Is(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof S0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new S0;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tQ{constructor(){this.Z_=new Is(Rn.comparator)}track(e){const i=e.doc.key,o=this.Z_.get(i);o?e.type!==0&&o.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&o.type!==1?this.Z_=this.Z_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Z_=this.Z_.remove(i):e.type===1&&o.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Xn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,o)=>{e.push(o)}),e}}class H0{constructor(e,i,o,l,u,f,_,E,S){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=u,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=S}static fromInitialDocuments(e,i,o,l,u){const f=[];return i.forEach(_=>{f.push({type:0,doc:_})}),new H0(e,i,S0.emptySet(i),f,o,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&C1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lBe{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class uBe{constructor(){this.queries=nQ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,o){const l=ir(i),u=l.queries;l.queries=nQ(),u.forEach((f,_)=>{for(const E of _.ta)E.onError(o)})})(this,new Xt(wt.ABORTED,"Firestore shutting down"))}}function nQ(){return new dE(n=>Sse(n),C1)}async function Q4(n,e){const i=ir(n);let o=3;const l=e.query;let u=i.queries.get(l);u?!u.na()&&e.ra()&&(o=2):(u=new lBe,o=e.ra()?0:1);try{switch(o){case 0:u.ea=await i.onListen(l,!0);break;case 1:u.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const _=J4(f,`Initialization of query '${WS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,u),u.ta.push(e),e.sa(i.onlineState),u.ea&&e.oa(u.ea)&&e3(i)}async function Z4(n,e){const i=ir(n),o=e.query;let l=3;const u=i.queries.get(o);if(u){const f=u.ta.indexOf(e);f>=0&&(u.ta.splice(f,1),u.ta.length===0?l=e.ra()?0:1:!u.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function dBe(n,e){const i=ir(n);let o=!1;for(const l of e){const u=l.query,f=i.queries.get(u);if(f){for(const _ of f.ta)_.oa(l)&&(o=!0);f.ea=l}}o&&e3(i)}function hBe(n,e,i){const o=ir(n),l=o.queries.get(e);if(l)for(const u of l.ta)u.onError(i);o.queries.delete(e)}function e3(n){n.ia.forEach(e=>{e.next()})}var vj,rQ;(rQ=vj||(vj={}))._a="default",rQ.Cache="cache";class t3{constructor(e,i,o){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=o||{}}oa(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new H0(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const o=i!=="Offline";return(!this.options.Ta||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=H0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==vj.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class noe{constructor(e){this.key=e}}class roe{constructor(e){this.key=e}}class pBe{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Vr(),this.mutatedKeys=Vr(),this.ya=bse(e),this.wa=new S0(this.ya)}get Sa(){return this.fa}ba(e,i){const o=i?i.Da:new tQ,l=i?i.wa:this.wa;let u=i?i.mutatedKeys:this.mutatedKeys,f=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,S=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,I)=>{const O=l.get(C),M=R1(this.query,I)?I:null,L=!!O&&this.mutatedKeys.has(O.key),U=!!M&&(M.hasLocalMutations||this.mutatedKeys.has(M.key)&&M.hasCommittedMutations);let B=!1;O&&M?O.data.isEqual(M.data)?L!==U&&(o.track({type:3,doc:M}),B=!0):this.va(O,M)||(o.track({type:2,doc:M}),B=!0,(E&&this.ya(M,E)>0||S&&this.ya(M,S)<0)&&(_=!0)):!O&&M?(o.track({type:0,doc:M}),B=!0):O&&!M&&(o.track({type:1,doc:O}),B=!0,(E||S)&&(_=!0)),B&&(M?(f=f.add(M),u=U?u.add(C):u.delete(C)):(f=f.delete(C),u=u.delete(C)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const C=this.query.limitType==="F"?f.last():f.first();f=f.delete(C.key),u=u.delete(C.key),o.track({type:1,doc:C})}return{wa:f,Da:o,ls:_,mutatedKeys:u}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const u=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const f=e.Da.X_();f.sort((C,I)=>function(M,L){const U=B=>{switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xn()}};return U(M)-U(L)}(C.type,I.type)||this.ya(C.doc,I.doc)),this.Ca(o),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,S=E!==this.ga;return this.ga=E,f.length!==0||S?{snapshot:new H0(this.query,e.wa,u,f,e.mutatedKeys,E===0,S,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new tQ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Vr(),this.wa.forEach(o=>{this.xa(o.key)&&(this.pa=this.pa.add(o.key))});const i=[];return e.forEach(o=>{this.pa.has(o)||i.push(new roe(o))}),this.pa.forEach(o=>{e.has(o)||i.push(new noe(o))}),i}Oa(e){this.fa=e.gs,this.pa=Vr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return H0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const n3="SyncEngine";class fBe{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class mBe{constructor(e){this.key=e,this.Ba=!1}}class gBe{constructor(e,i,o,l,u,f){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new dE(_=>Sse(_),C1),this.qa=new Map,this.Qa=new Set,this.$a=new Is(Rn.comparator),this.Ua=new Map,this.Ka=new W4,this.Wa={},this.Ga=new Map,this.za=G0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function _Be(n,e,i=!0){const o=loe(n);let l;const u=o.ka.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Na()):l=await ioe(o,e,i,!0),l}async function yBe(n,e){const i=loe(n);await ioe(i,e,!0,!1)}async function ioe(n,e,i,o){const l=await V5e(n.localStore,Cp(e)),u=l.targetId,f=n.sharedClientState.addLocalQueryTarget(u,i);let _;return o&&(_=await EBe(n,e,u,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&Xse(n.remoteStore,l),_}async function EBe(n,e,i,o,l){n.Ha=(I,O,M)=>async function(U,B,J,K){let ne=B.view.ba(J);ne.ls&&(ne=await YJ(U.localStore,B.query,!1).then(({documents:Y})=>B.view.ba(Y,ne)));const oe=K&&K.targetChanges.get(B.targetId),se=K&&K.targetMismatches.get(B.targetId)!=null,le=B.view.applyChanges(ne,U.isPrimaryClient,oe,se);return sQ(U,B.targetId,le.Ma),le.snapshot}(n,I,O,M);const u=await YJ(n.localStore,e,!0),f=new pBe(e,u.gs),_=f.ba(u.documents),E=LR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),S=f.applyChanges(_,n.isPrimaryClient,E);sQ(n,i,S.Ma);const C=new fBe(e,i,f);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),S.snapshot}async function vBe(n,e,i){const o=ir(n),l=o.ka.get(e),u=o.qa.get(l.targetId);if(u.length>1)return o.qa.set(l.targetId,u.filter(f=>!C1(f,e))),void o.ka.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await yj(o.localStore,l.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(l.targetId),i&&$4(o.remoteStore,l.targetId),Sj(o,l.targetId)}).catch(sb)):(Sj(o,l.targetId),await yj(o.localStore,l.targetId,!0))}async function SBe(n,e){const i=ir(n),o=i.ka.get(e),l=i.qa.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),$4(i.remoteStore,o.targetId))}async function bBe(n,e,i){const o=PBe(n);try{const l=await function(f,_){const E=ir(f),S=Lo.now(),C=_.reduce((M,L)=>M.add(L.key),Vr());let I,O;return E.persistence.runTransaction("Locally write mutations","readwrite",M=>{let L=am(),U=Vr();return E.ds.getEntries(M,C).next(B=>{L=B,L.forEach((J,K)=>{K.isValidDocument()||(U=U.add(J))})}).next(()=>E.localDocuments.getOverlayedDocuments(M,L)).next(B=>{I=B;const J=[];for(const K of _){const ne=V3e(K,I.get(K.key).overlayedDocument);ne!=null&&J.push(new n_(K.key,ne,fse(ne.value.mapValue),sd.exists(!0)))}return E.mutationQueue.addMutationBatch(M,S,J,_)}).next(B=>{O=B;const J=B.applyToLocalDocumentSet(I,U);return E.documentOverlayCache.saveOverlays(M,B.batchId,J)})}).then(()=>({batchId:O.batchId,changes:wse(I)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),function(f,_,E){let S=f.Wa[f.currentUser.toKey()];S||(S=new Is(br)),S=S.insert(_,E),f.Wa[f.currentUser.toKey()]=S}(o,l.batchId,i),await UR(o,l.changes),await N1(o.remoteStore)}catch(l){const u=J4(l,"Failed to persist write");i.reject(u)}}async function soe(n,e){const i=ir(n);try{const o=await L5e(i.localStore,e);e.targetChanges.forEach((l,u)=>{const f=i.Ua.get(u);f&&(yi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?yi(f.Ba):l.removedDocuments.size>0&&(yi(f.Ba),f.Ba=!1))}),await UR(i,o,e)}catch(o){await sb(o)}}function iQ(n,e,i){const o=ir(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.ka.forEach((u,f)=>{const _=f.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(f,_){const E=ir(f);E.onlineState=_;let S=!1;E.queries.forEach((C,I)=>{for(const O of I.ta)O.sa(_)&&(S=!0)}),S&&e3(E)}(o.eventManager,e),l.length&&o.La.p_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function TBe(n,e,i){const o=ir(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Ua.get(e),u=l&&l.key;if(u){let f=new Is(Rn.comparator);f=f.insert(u,uc.newNoDocument(u,er.min()));const _=Vr().add(u),E=new P1(er.min(),new Map,new Is(br),f,_);await soe(o,E),o.$a=o.$a.remove(u),o.Ua.delete(e),r3(o)}else await yj(o.localStore,e,!1).then(()=>Sj(o,e,i)).catch(sb)}async function wBe(n,e){const i=ir(n),o=e.batch.batchId;try{const l=await x5e(i.localStore,e);aoe(i,o,null),ooe(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await UR(i,l)}catch(l){await sb(l)}}async function CBe(n,e,i){const o=ir(n);try{const l=await function(f,_){const E=ir(f);return E.persistence.runTransaction("Reject batch","readwrite-primary",S=>{let C;return E.mutationQueue.lookupMutationBatch(S,_).next(I=>(yi(I!==null),C=I.keys(),E.mutationQueue.removeMutationBatch(S,I))).next(()=>E.mutationQueue.performConsistencyCheck(S)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(S,C,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,C)).next(()=>E.localDocuments.getDocuments(S,C))})}(o.localStore,e);aoe(o,e,i),ooe(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await UR(o,l)}catch(l){await sb(l)}}function ooe(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function aoe(n,e,i){const o=ir(n);let l=o.Wa[o.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),o.Wa[o.currentUser.toKey()]=l}}function Sj(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.qa.get(e))n.ka.delete(o),i&&n.La.Ja(o,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(o=>{n.Ka.containsKey(o)||coe(n,o)})}function coe(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&($4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),r3(n))}function sQ(n,e,i){for(const o of i)o instanceof noe?(n.Ka.addReference(o.key,e),RBe(n,o)):o instanceof roe?(sn(n3,"Document no longer in limbo: "+o.key),n.Ka.removeReference(o.key,e),n.Ka.containsKey(o.key)||coe(n,o.key)):Xn()}function RBe(n,e){const i=e.key,o=i.path.canonicalString();n.$a.get(i)||n.Qa.has(o)||(sn(n3,"New document in limbo: "+i),n.Qa.add(o),r3(n))}function r3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Rn(qi.fromString(e)),o=n.za.next();n.Ua.set(o,new mBe(i)),n.$a=n.$a.insert(i,o),Xse(n.remoteStore,new Dg(Cp(w1(i.path)),o,"TargetPurposeLimboResolution",v1.ae))}}async function UR(n,e,i){const o=ir(n),l=[],u=[],f=[];o.ka.isEmpty()||(o.ka.forEach((_,E)=>{f.push(o.Ha(E,e,i).then(S=>{var C;if((S||i)&&o.isPrimaryClient){const I=S?!S.fromCache:(C=i==null?void 0:i.targetChanges.get(E.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(S){l.push(S);const I=G4.Yi(E.targetId,S);u.push(I)}}))}),await Promise.all(f),o.La.p_(l),await async function(E,S){const C=ir(E);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Pt.forEach(S,O=>Pt.forEach(O.Hi,M=>C.persistence.referenceDelegate.addReference(I,O.targetId,M)).next(()=>Pt.forEach(O.Ji,M=>C.persistence.referenceDelegate.removeReference(I,O.targetId,M)))))}catch(I){if(!ob(I))throw I;sn(H4,"Failed to update sequence numbers: "+I)}for(const I of S){const O=I.targetId;if(!I.fromCache){const M=C.Ts.get(O),L=M.snapshotVersion,U=M.withLastLimboFreeSnapshotVersion(L);C.Ts=C.Ts.insert(O,U)}}}(o.localStore,u))}async function IBe(n,e){const i=ir(n);if(!i.currentUser.isEqual(e)){sn(n3,"User change. New user:",e.toKey());const o=await $se(i.localStore,e);i.currentUser=e,function(u,f){u.Ga.forEach(_=>{_.forEach(E=>{E.reject(new Xt(wt.CANCELLED,f))})}),u.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await UR(i,o.Rs)}}function ABe(n,e){const i=ir(n),o=i.Ua.get(e);if(o&&o.Ba)return Vr().add(o.key);{let l=Vr();const u=i.qa.get(e);if(!u)return l;for(const f of u){const _=i.ka.get(f);l=l.unionWith(_.view.Sa)}return l}}function loe(n){const e=ir(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=soe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ABe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TBe.bind(null,e),e.La.p_=dBe.bind(null,e.eventManager),e.La.Ja=hBe.bind(null,e.eventManager),e}function PBe(n){const e=ir(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wBe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=CBe.bind(null,e),e}class wN{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=O1(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return D5e(this.persistence,new O5e,e.initialUser,this.serializer)}Xa(e){return new Hse(z4.ri,this.serializer)}Za(e){return new F5e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}wN.provider={build:()=>new wN};class OBe extends wN{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){yi(this.persistence.referenceDelegate instanceof bN);const o=this.persistence.referenceDelegate.garbageCollector;return new m5e(o,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?yl.withCacheSize(this.cacheSizeBytes):yl.DEFAULT;return new Hse(o=>bN.ri(o,i),this.serializer)}}class bj{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>iQ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=IBe.bind(null,this.syncEngine),await cBe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new uBe}()}createDatastore(e){const i=O1(e.databaseInfo.databaseId),o=function(u){return new H5e(u)}(e.databaseInfo);return function(u,f,_,E){return new Y5e(u,f,_,E)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,l,u,f,_){return new J5e(o,l,u,f,_)}(this.localStore,this.datastore,e.asyncQueue,i=>iQ(this.syncEngine,i,0),function(){return QJ.D()?new QJ:new B5e}())}createSyncEngine(e,i){return function(l,u,f,_,E,S,C){const I=new gBe(l,u,f,_,E,S);return C&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const u=ir(l);sn(sE,"RemoteStore shutting down."),u.W_.add(5),await MR(u),u.z_.shutdown(),u.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}bj.provider={build:()=>new bj};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):om("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qg="FirestoreClient";class kBe{constructor(e,i,o,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=lc.UNAUTHENTICATED,this.clientId=ise.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,async f=>{sn(qg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(o,f=>(sn(qg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Jf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=J4(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function BU(n,e){n.asyncQueue.verifyOperationInProgress(),sn(qg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener(async l=>{o.isEqual(l)||(await $se(e.localStore,l),o=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function oQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await NBe(n);sn(qg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(o=>eQ(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,l)=>eQ(e.remoteStore,l)),n._onlineComponents=e}async function NBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){sn(qg,"Using user provided OfflineComponentProvider");try{await BU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===wt.FAILED_PRECONDITION||l.code===wt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;U0("Error using user provided cache. Falling back to memory cache: "+i),await BU(n,new wN)}}else sn(qg,"Using default OfflineComponentProvider"),await BU(n,new OBe(void 0));return n._offlineComponents}async function uoe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(sn(qg,"Using user provided OnlineComponentProvider"),await oQ(n,n._uninitializedComponentsProvider._online)):(sn(qg,"Using default OnlineComponentProvider"),await oQ(n,new bj))),n._onlineComponents}function DBe(n){return uoe(n).then(e=>e.syncEngine)}async function CN(n){const e=await uoe(n),i=e.eventManager;return i.onListen=_Be.bind(null,e.syncEngine),i.onUnlisten=vBe.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=yBe.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=SBe.bind(null,e.syncEngine),i}function xBe(n,e,i={}){const o=new Jf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,S){const C=new i3({next:O=>{C.su(),f.enqueueAndForget(()=>Z4(u,I));const M=O.docs.has(_);!M&&O.fromCache?S.reject(new Xt(wt.UNAVAILABLE,"Failed to get document because the client is offline.")):M&&O.fromCache&&E&&E.source==="server"?S.reject(new Xt(wt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):S.resolve(O)},error:O=>S.reject(O)}),I=new t3(w1(_.path),C,{includeMetadataChanges:!0,Ta:!0});return Q4(u,I)}(await CN(n),n.asyncQueue,e,i,o)),o.promise}function LBe(n,e,i={}){const o=new Jf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,S){const C=new i3({next:O=>{C.su(),f.enqueueAndForget(()=>Z4(u,I)),O.fromCache&&E.source==="server"?S.reject(new Xt(wt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):S.resolve(O)},error:O=>S.reject(O)}),I=new t3(_,C,{includeMetadataChanges:!0,Ta:!0});return Q4(u,I)}(await CN(n),n.asyncQueue,e,i,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function doe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hoe(n,e,i){if(!i)throw new Xt(wt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function MBe(n,e,i,o){if(e===!0&&o===!0)throw new Xt(wt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function cQ(n){if(!Rn.isDocumentKey(n))throw new Xt(wt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function lQ(n){if(Rn.isDocumentKey(n))throw new Xt(wt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function D1(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Xn()}function Il(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Xt(wt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=D1(n);throw new Xt(wt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const poe="firestore.googleapis.com",uQ=!0;class dQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Xt(wt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=poe,this.ssl=uQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:uQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Gse;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<p5e)throw new Xt(wt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}MBe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=doe((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Xt(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Xt(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Xt(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,l){return o.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class x1{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new dQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Xt(wt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Xt(wt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new dQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new G4e;switch(o.type){case"firstParty":return new q4e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Xt(wt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const o=aQ.get(i);o&&(sn("ComponentProvider","Removing Datastore"),aQ.delete(i),o.terminate())}(this),Promise.resolve()}}function UBe(n,e,i,o={}){var l;const u=(n=Il(n,x1))._getSettings(),f=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;u.host!==poe&&u.host!==_&&U0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},u),{host:_,ssl:!1,emulatorOptions:o});if(!nm(E,f)&&(n._setSettings(E),o.mockUserToken)){let S,C;if(typeof o.mockUserToken=="string")S=o.mockUserToken,C=lc.MOCK_USER;else{S=aie(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=o.mockUserToken.sub||o.mockUserToken.user_id;if(!I)throw new Xt(wt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new lc(I)}n._authCredentials=new H4e(new nse(S,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new kp(this.firestore,e,this._query)}}class hc{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Vg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hc(this.firestore,e,this._key)}}class Vg extends kp{constructor(e,i,o){super(e,i,w1(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new hc(this.firestore,null,new Rn(e))}withConverter(e){return new Vg(this.firestore,e,this._path)}}function Al(n,e,...i){if(n=Ii(n),hoe("collection","path",e),n instanceof x1){const o=qi.fromString(e,...i);return lQ(o),new Vg(n,null,o)}{if(!(n instanceof hc||n instanceof Vg))throw new Xt(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(qi.fromString(e,...i));return lQ(o),new Vg(n.firestore,null,o)}}function gr(n,e,...i){if(n=Ii(n),arguments.length===1&&(e=ise.newId()),hoe("doc","path",e),n instanceof x1){const o=qi.fromString(e,...i);return cQ(o),new hc(n,null,new Rn(o))}{if(!(n instanceof hc||n instanceof Vg))throw new Xt(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(qi.fromString(e,...i));return cQ(o),new hc(n.firestore,n instanceof Vg?n.converter:null,new Rn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hQ="AsyncQueue";class pQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new qse(this,"async_queue_retry"),this.Su=()=>{const o=FU();o&&sn(hQ,"Visibility state changed to "+o.visibilityState),this.a_.t_()},this.bu=e;const i=FU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=FU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Jf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!ob(e))throw e;sn(hQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(o=>{this.gu=o,this.pu=!1;const l=function(f){let _=f.message||"";return f.stack&&(_=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),_}(o);throw om("INTERNAL UNHANDLED ERROR: ",l),o}).then(o=>(this.pu=!1,o))));return this.bu=i,i}enqueueAfterDelay(e,i,o){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=X4.createAndSchedule(this,e,i,o,u=>this.Fu(u));return this.fu.push(l),l}Du(){this.gu&&Xn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function fQ(n){return function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of o)if(u in l&&typeof l[u]=="function")return!0;return!1}(n,["next","error","complete"])}class cm extends x1{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new pQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new pQ(e),this._firestoreClient=void 0,await e}}}function Uk(n,e){const i=typeof n=="object"?n:m1(),o=typeof n=="string"?n:mN,l=PR(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const u=v4("firestore");u&&UBe(l,...u)}return l}function L1(n){if(n._terminated)throw new Xt(wt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||VBe(n),n._firestoreClient}function VBe(n){var e,i,o;const l=n._freezeSettings(),u=function(_,E,S,C){return new l3e(_,E,S,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,doe(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new kBe(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $0(La.fromBase64String(e))}catch(i){throw new Xt(wt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new $0(La.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M1{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Xt(wt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Xt(wt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Xt(wt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return br(this._lat,e._lat)||br(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jBe=/^__.*__$/;class FBe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new n_(e,this.data,this.fieldMask,i,this.fieldTransforms):new xR(e,this.data,i,this.fieldTransforms)}}class foe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new n_(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function moe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xn()}}class U1{constructor(e,i,o,l,u,f){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,u===void 0&&this.Bu(),this.fieldTransforms=u||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new U1(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.$u(e),l}Uu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return RN(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(moe(this.Lu)&&jBe.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class BBe{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||O1(e)}ju(e,i,o,l=!1){return new U1({Lu:e,methodName:i,zu:o,path:xa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function jR(n){const e=n._freezeSettings(),i=O1(n._databaseId);return new BBe(n._databaseId,!!e.ignoreUndefinedProperties,i)}function goe(n,e,i,o,l,u={}){const f=n.ju(u.merge||u.mergeFields?2:0,e,i,l);l3("Data must be an object, but it was:",f,o);const _=Eoe(o,f);let E,S;if(u.merge)E=new ru(f.fieldMask),S=f.fieldTransforms;else if(u.mergeFields){const C=[];for(const I of u.mergeFields){const O=Tj(e,I,i);if(!f.contains(O))throw new Xt(wt.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);Soe(C,O)||C.push(O)}E=new ru(C),S=f.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,S=f.fieldTransforms;return new FBe(new Sl(_),E,S)}class V1 extends VR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof V1}}function _oe(n,e,i){return new U1({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class a3 extends VR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=_oe(this,e,!0),o=this.Hu.map(u=>pE(u,i)),l=new W0(o);return new kse(e.path,l)}isEqual(e){return e instanceof a3&&nm(this.Hu,e.Hu)}}class c3 extends VR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=_oe(this,e,!0),o=this.Hu.map(u=>pE(u,i)),l=new z0(o);return new kse(e.path,l)}isEqual(e){return e instanceof c3&&nm(this.Hu,e.Hu)}}function WBe(n,e,i,o){const l=n.ju(1,e,i);l3("Data must be an object, but it was:",l,o);const u=[],f=Sl.empty();t_(o,(E,S)=>{const C=u3(e,E,i);S=Ii(S);const I=l.Uu(C);if(S instanceof V1)u.push(C);else{const O=pE(S,I);O!=null&&(u.push(C),f.set(C,O))}});const _=new ru(u);return new foe(f,_,l.fieldTransforms)}function zBe(n,e,i,o,l,u){const f=n.ju(1,e,i),_=[Tj(e,o,i)],E=[l];if(u.length%2!=0)throw new Xt(wt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<u.length;O+=2)_.push(Tj(e,u[O])),E.push(u[O+1]);const S=[],C=Sl.empty();for(let O=_.length-1;O>=0;--O)if(!Soe(S,_[O])){const M=_[O];let L=E[O];L=Ii(L);const U=f.Uu(M);if(L instanceof V1)S.push(M);else{const B=pE(L,U);B!=null&&(S.push(M),C.set(M,B))}}const I=new ru(S);return new foe(C,I,f.fieldTransforms)}function yoe(n,e,i,o=!1){return pE(i,n.ju(o?4:3,e))}function pE(n,e){if(voe(n=Ii(n)))return l3("Unsupported field value:",e,n),Eoe(n,e);if(n instanceof VR)return function(o,l){if(!moe(l.Lu))throw l.Wu(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(o,l){const u=[];let f=0;for(const _ of o){let E=pE(_,l.Ku(f));E==null&&(E={nullValue:"NULL_VALUE"}),u.push(E),f++}return{arrayValue:{values:u}}}(n,e)}return function(o,l){if((o=Ii(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return N3e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=Lo.fromDate(o);return{timestampValue:SN(l.serializer,u)}}if(o instanceof Lo){const u=new Lo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:SN(l.serializer,u)}}if(o instanceof s3)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof $0)return{bytesValue:Use(l.serializer,o._byteString)};if(o instanceof hc){const u=l.databaseId,f=o.firestore._databaseId;if(!f.isEqual(u))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:B4(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof o3)return function(f,_){return{mapValue:{fields:{[hse]:{stringValue:pse},[gN]:{arrayValue:{values:f.toArray().map(S=>{if(typeof S!="number")throw _.Wu("VectorValues must only contain numeric values.");return U4(_.serializer,S)})}}}}}}(o,l);throw l.Wu(`Unsupported field value: ${D1(o)}`)}(n,e)}function Eoe(n,e){const i={};return ose(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):t_(n,(o,l)=>{const u=pE(l,e.qu(o));u!=null&&(i[o]=u)}),{mapValue:{fields:i}}}function voe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Lo||n instanceof s3||n instanceof $0||n instanceof hc||n instanceof VR||n instanceof o3)}function l3(n,e,i){if(!voe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const o=D1(i);throw o==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+o)}}function Tj(n,e,i){if((e=Ii(e))instanceof M1)return e._internalPath;if(typeof e=="string")return u3(n,e);throw RN("Field path arguments must be of type string or ",n,!1,void 0,i)}const GBe=new RegExp("[~\\*/\\[\\]]");function u3(n,e,i){if(e.search(GBe)>=0)throw RN(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new M1(...e.split("."))._internalPath}catch{throw RN(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function RN(n,e,i,o,l){const u=o&&!o.isEmpty(),f=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(u||f)&&(E+=" (found",u&&(E+=` in field ${o}`),f&&(E+=` in document ${l}`),E+=")"),new Xt(wt.INVALID_ARGUMENT,_+n+E)}function Soe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d3{constructor(e,i,o,l,u){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new hc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new HBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(j1("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class HBe extends d3{data(){return super.data()}}function j1(n,e){return typeof e=="string"?u3(n,e):e instanceof M1?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function boe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Xt(wt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class h3{}class F1 extends h3{}function IN(n,e,...i){let o=[];e instanceof h3&&o.push(e),o=o.concat(i),function(u){const f=u.filter(E=>E instanceof p3).length,_=u.filter(E=>E instanceof B1).length;if(f>1||f>0&&_>0)throw new Xt(wt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const l of o)n=l._apply(n);return n}class B1 extends F1{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new B1(e,i,o)}_apply(e){const i=this._parse(e);return Toe(e._query,i),new kp(e.firestore,e.converter,pj(e._query,i))}_parse(e){const i=jR(e.firestore);return function(u,f,_,E,S,C,I){let O;if(S.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new Xt(wt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){_Q(I,C);const L=[];for(const U of I)L.push(gQ(E,u,U));O={arrayValue:{values:L}}}else O=gQ(E,u,I)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||_Q(I,C),O=yoe(_,f,I,C==="in"||C==="not-in");return go.create(S,C,O)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function mQ(n,e,i){const o=e,l=j1("where",n);return B1._create(l,o,i)}class p3 extends h3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new p3(e,i)}_parse(e){const i=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return i.length===1?i[0]:ch.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,u){let f=l;const _=u.getFlattenedFilters();for(const E of _)Toe(f,E),f=pj(f,E)}(e._query,i),new kp(e.firestore,e.converter,pj(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class f3 extends F1{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new f3(e,i)}_apply(e){const i=function(l,u,f){if(l.startAt!==null)throw new Xt(wt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Xt(wt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sR(u,f)}(e._query,this._field,this._direction);return new kp(e.firestore,e.converter,function(l,u){const f=l.explicitOrderBy.concat([u]);return new uE(l.path,l.collectionGroup,f,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function $Be(n,e="asc"){const i=e,o=j1("orderBy",n);return f3._create(o,i)}class m3 extends F1{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new m3(e,i,o)}_apply(e){return new kp(e.firestore,e.converter,yN(e._query,this._limit,this._limitType))}}function KBe(n){return m3._create("limit",n,"F")}class g3 extends F1{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new g3(e,i,o)}_apply(e){const i=YBe(e,this.type,this._docOrFields,this._inclusive);return new kp(e.firestore,e.converter,function(l,u){return new uE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,u,l.endAt)}(e._query,i))}}function qBe(...n){return g3._create("startAt",n,!0)}function YBe(n,e,i,o){if(i[0]=Ii(i[0]),i[0]instanceof d3)return function(u,f,_,E,S){if(!E)throw new Xt(wt.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${_}().`);const C=[];for(const I of v0(u))if(I.field.isKeyField())C.push(_N(f,E.key));else{const O=E.data.field(I.field);if(b1(O))throw new Xt(wt.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+I.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(O===null){const M=I.field.canonicalString();throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${M}' (used as the orderBy) does not exist.`)}C.push(O)}return new B0(C,S)}(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=jR(n.firestore);return function(f,_,E,S,C,I){const O=f.explicitOrderBy;if(C.length>O.length)throw new Xt(wt.INVALID_ARGUMENT,`Too many arguments provided to ${S}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const M=[];for(let L=0;L<C.length;L++){const U=C[L];if(O[L].field.isKeyField()){if(typeof U!="string")throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${S}(), but got a ${typeof U}`);if(!M4(f)&&U.indexOf("/")!==-1)throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${S}() must be a plain document ID, but '${U}' contains a slash.`);const B=f.path.child(qi.fromString(U));if(!Rn.isDocumentKey(B))throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${S}() must result in a valid document path, but '${B}' is not because it contains an odd number of segments.`);const J=new Rn(B);M.push(_N(_,J))}else{const B=yoe(E,S,U);M.push(B)}}return new B0(M,I)}(n._query,n.firestore._databaseId,l,e,i,o)}}function gQ(n,e,i){if(typeof(i=Ii(i))=="string"){if(i==="")throw new Xt(wt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!M4(e)&&i.indexOf("/")!==-1)throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(qi.fromString(i));if(!Rn.isDocumentKey(o))throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return _N(n,new Rn(o))}if(i instanceof hc)return _N(n,i._key);throw new Xt(wt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${D1(i)}.`)}function _Q(n,e){if(!Array.isArray(n)||n.length===0)throw new Xt(wt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Toe(n,e){const i=function(l,u){for(const f of l)for(const _ of f.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Xt(wt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Xt(wt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class XBe{convertValue(e,i="none"){switch($g(e)){case 0:return null;case 1:return e.booleanValue;case 2:return to(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Hg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Xn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return t_(e,(l,u)=>{o[l]=this.convertValue(u,i)}),o}convertVectorValue(e){var i,o,l;const u=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[gN].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map(f=>to(f.doubleValue));return new o3(u)}convertGeoPoint(e){return new s3(to(e.latitude),to(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":const o=T1(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(nR(e));default:return null}}convertTimestamp(e){const i=Gg(e);return new Lo(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=qi.fromString(e);yi(zse(o));const l=new rR(o.get(1),o.get(3)),u=new Rn(o.popFirst(5));return l.isEqual(i)||om(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function woe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Coe extends d3{constructor(e,i,o,l,u,f){super(e,i,o,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Vk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(j1("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}}class Vk extends Coe{data(e={}){return super.data(e)}}class Roe{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new cC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(o=>{e.call(i,new Vk(this._firestore,this._userDataWriter,o.key,o,new cC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Xt(wt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(_=>{const E=new Vk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new cC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>u||_.type!==3).map(_=>{const E=new Vk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new cC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let S=-1,C=-1;return _.type!==0&&(S=f.indexOf(_.doc.key),f=f.delete(_.doc.key)),_.type!==1&&(f=f.add(_.doc),C=f.indexOf(_.doc.key)),{type:JBe(_.type),doc:E,oldIndex:S,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function JBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uo(n){n=Il(n,hc);const e=Il(n.firestore,cm);return xBe(L1(e),n._key).then(i=>Aoe(e,n,i))}class _3 extends XBe{constructor(e){super(),this.firestore=e}convertBytes(e){return new $0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new hc(this.firestore,null,i)}}function od(n){n=Il(n,kp);const e=Il(n.firestore,cm),i=L1(e),o=new _3(e);return boe(n._query),LBe(i,n._query).then(l=>new Roe(e,o,n,l))}function Yg(n,e,i){n=Il(n,hc);const o=Il(n.firestore,cm),l=woe(n.converter,e,i);return W1(o,[goe(jR(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,sd.none())])}function oo(n,e,i,...o){n=Il(n,hc);const l=Il(n.firestore,cm),u=jR(l);let f;return f=typeof(e=Ii(e))=="string"||e instanceof M1?zBe(u,"updateDoc",n._key,e,i,o):WBe(u,"updateDoc",n._key,e),W1(l,[f.toMutation(n._key,sd.exists(!0))])}function QBe(n){return W1(Il(n.firestore,cm),[new V4(n._key,sd.none())])}function ZBe(n,e){const i=Il(n.firestore,cm),o=gr(n),l=woe(n.converter,e);return W1(i,[goe(jR(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,sd.exists(!1))]).then(()=>o)}function Ioe(n,...e){var i,o,l;n=Ii(n);let u={includeMetadataChanges:!1,source:"default"},f=0;typeof e[f]!="object"||fQ(e[f])||(u=e[f],f++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(fQ(e[f])){const I=e[f];e[f]=(i=I.next)===null||i===void 0?void 0:i.bind(I),e[f+1]=(o=I.error)===null||o===void 0?void 0:o.bind(I),e[f+2]=(l=I.complete)===null||l===void 0?void 0:l.bind(I)}let E,S,C;if(n instanceof hc)S=Il(n.firestore,cm),C=w1(n._key.path),E={next:I=>{e[f]&&e[f](Aoe(S,n,I))},error:e[f+1],complete:e[f+2]};else{const I=Il(n,kp);S=Il(I.firestore,cm),C=I._query;const O=new _3(S);E={next:M=>{e[f]&&e[f](new Roe(S,O,I,M))},error:e[f+1],complete:e[f+2]},boe(n._query)}return function(O,M,L,U){const B=new i3(U),J=new t3(M,B,L);return O.asyncQueue.enqueueAndForget(async()=>Q4(await CN(O),J)),()=>{B.su(),O.asyncQueue.enqueueAndForget(async()=>Z4(await CN(O),J))}}(L1(S),C,_,E)}function W1(n,e){return function(o,l){const u=new Jf;return o.asyncQueue.enqueueAndForget(async()=>bBe(await DBe(o),l,u)),u.promise}(L1(n),e)}function Aoe(n,e,i){const o=i.docs.get(e._key),l=new _3(n);return new Coe(n,l,e._key,o,new cC(i.hasPendingWrites,i.fromCache),e.converter)}function e6e(...n){return new a3("arrayUnion",n)}function Poe(...n){return new c3("arrayRemove",n)}(function(e,i=!0){(function(l){ib=l})(lE),Wg(new rm("firestore",(o,{instanceIdentifier:l,options:u})=>{const f=o.getProvider("app").getImmediate(),_=new cm(new $4e(o.getProvider("auth-internal")),new Y4e(f,o.getProvider("app-check-internal")),function(S,C){if(!Object.prototype.hasOwnProperty.apply(S.options,["projectId"]))throw new Xt(wt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rR(S.options.projectId,C)}(f,l),f);return u=Object.assign({useFetchStreams:i},u),_._setSettings(u),_},"PUBLIC").setMultipleInstances(!0)),id(EJ,vJ,e),id(EJ,vJ,"esm2017")})();var t6e="firebase",n6e="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */id(t6e,n6e,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r6e="type.googleapis.com/google.protobuf.Int64Value",i6e="type.googleapis.com/google.protobuf.UInt64Value";function Ooe(n,e){const i={};for(const o in n)n.hasOwnProperty(o)&&(i[o]=e(n[o]));return i}function AN(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>AN(e));if(typeof n=="function"||typeof n=="object")return Ooe(n,e=>AN(e));throw new Error("Data cannot be encoded in JSON: "+n)}function K0(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case r6e:case i6e:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>K0(e)):typeof n=="function"||typeof n=="object"?Ooe(n,e=>K0(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y3="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yQ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Tl extends lh{constructor(e,i,o){super(`${y3}/${e}`,i||""),this.details=o,Object.setPrototypeOf(this,Tl.prototype)}}function s6e(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function PN(n,e){let i=s6e(n),o=i,l;try{const u=e&&e.error;if(u){const f=u.status;if(typeof f=="string"){if(!yQ[f])return new Tl("internal","internal");i=yQ[f],o=f}const _=u.message;typeof _=="string"&&(o=_),l=u.details,l!==void 0&&(l=K0(l))}}catch{}return i==="ok"?null:new Tl(i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o6e{constructor(e,i,o,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,vl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||i.get().then(u=>this.auth=u,()=>{}),this.messaging||o.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l==null||l.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(e){const i=await this.getAuthToken(),o=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:i,messagingToken:o,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wj="us-central1",a6e=/^data: (.*?)(?:\n|$)/;function c6e(n){let e=null;return{promise:new Promise((i,o)=>{e=setTimeout(()=>{o(new Tl("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class l6e{constructor(e,i,o,l,u=wj,f=(..._)=>fetch(..._)){this.app=e,this.fetchImpl=f,this.emulatorOrigin=null,this.contextProvider=new o6e(e,i,o,l),this.cancelAllRequests=new Promise(_=>{this.deleteService=()=>Promise.resolve(_())});try{const _=new URL(u);this.customDomain=_.origin+(_.pathname==="/"?"":_.pathname),this.region=wj}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${i}.cloudfunctions.net/${e}`}}function u6e(n,e,i){n.emulatorOrigin=`http://${e}:${i}`}function d6e(n,e,i){const o=l=>p6e(n,e,l,{});return o.stream=(l,u)=>m6e(n,e,l,u),o}async function h6e(n,e,i,o){i["Content-Type"]="application/json";let l;try{l=await o(n,{method:"POST",body:JSON.stringify(e),headers:i})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function koe(n,e){const i={},o=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return o.authToken&&(i.Authorization="Bearer "+o.authToken),o.messagingToken&&(i["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=o.appCheckToken),i}function p6e(n,e,i,o){const l=n._url(e);return f6e(n,l,i,o)}async function f6e(n,e,i,o){i=AN(i);const l={data:i},u=await koe(n,o),f=o.timeout||7e4,_=c6e(f),E=await Promise.race([h6e(e,l,u,n.fetchImpl),_.promise,n.cancelAllRequests]);if(_.cancel(),!E)throw new Tl("cancelled","Firebase Functions instance was deleted.");const S=PN(E.status,E.json);if(S)throw S;if(!E.json)throw new Tl("internal","Response is not valid JSON object.");let C=E.json.data;if(typeof C>"u"&&(C=E.json.result),typeof C>"u")throw new Tl("internal","Response is missing data field.");return{data:K0(C)}}function m6e(n,e,i,o){const l=n._url(e);return g6e(n,l,i,o||{})}async function g6e(n,e,i,o){var l;i=AN(i);const u={data:i},f=await koe(n,o);f["Content-Type"]="application/json",f.Accept="text/event-stream";let _;try{_=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(u),headers:f,signal:o==null?void 0:o.signal})}catch(M){if(M instanceof Error&&M.name==="AbortError"){const U=new Tl("cancelled","Request was cancelled.");return{data:Promise.reject(U),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(U)}}}}}}const L=PN(0,null);return{data:Promise.reject(L),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(L)}}}}}}let E,S;const C=new Promise((M,L)=>{E=M,S=L});(l=o==null?void 0:o.signal)===null||l===void 0||l.addEventListener("abort",()=>{const M=new Tl("cancelled","Request was cancelled.");S(M)});const I=_.body.getReader(),O=_6e(I,E,S,o==null?void 0:o.signal);return{stream:{[Symbol.asyncIterator](){const M=O.getReader();return{async next(){const{value:L,done:U}=await M.read();return{value:L,done:U}},async return(){return await M.cancel(),{done:!0,value:void 0}}}}},data:C}}function _6e(n,e,i,o){const l=(f,_)=>{const E=f.match(a6e);if(!E)return;const S=E[1];try{const C=JSON.parse(S);if("result"in C){e(K0(C.result));return}if("message"in C){_.enqueue(K0(C.message));return}if("error"in C){const I=PN(0,C);_.error(I),i(I);return}}catch(C){if(C instanceof Tl){_.error(C),i(C);return}}},u=new TextDecoder;return new ReadableStream({start(f){let _="";return E();async function E(){if(o!=null&&o.aborted){const S=new Tl("cancelled","Request was cancelled");return f.error(S),i(S),Promise.resolve()}try{const{value:S,done:C}=await n.read();if(C){_.trim()&&l(_.trim(),f),f.close();return}if(o!=null&&o.aborted){const O=new Tl("cancelled","Request was cancelled");f.error(O),i(O),await n.cancel();return}_+=u.decode(S,{stream:!0});const I=_.split(`
`);_=I.pop()||"";for(const O of I)O.trim()&&l(O.trim(),f);return E()}catch(S){const C=S instanceof Tl?S:PN(0,null);f.error(C),i(C)}}},cancel(){return n.cancel()}})}const EQ="@firebase/functions",vQ="0.12.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y6e="auth-internal",E6e="app-check-internal",v6e="messaging-internal";function S6e(n){const e=(i,{instanceIdentifier:o})=>{const l=i.getProvider("app").getImmediate(),u=i.getProvider(y6e),f=i.getProvider(v6e),_=i.getProvider(E6e);return new l6e(l,u,f,_,o)};Wg(new rm(y3,e,"PUBLIC").setMultipleInstances(!0)),id(EQ,vQ,n),id(EQ,vQ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b6e(n=m1(),e=wj){const o=PR(Ii(n),y3).getImmediate({identifier:e}),l=v4("functions");return l&&T6e(o,...l),o}function T6e(n,e,i){u6e(Ii(n),e,i)}function E3(n,e,i){return d6e(Ii(n),e)}S6e();const w6e=[{key:"VITE_FIREBASE_API_KEY",value:void 0},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:void 0},{key:"VITE_FIREBASE_PROJECT_ID",value:void 0},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:void 0},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:void 0},{key:"VITE_FIREBASE_APP_ID",value:void 0}],Cj=w6e.filter(n=>!n.value);if(Cj.length>0){const e=`Missing environment variables: ${Cj.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;$.warn(e),console.warn(e)}const C6e={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},R6e=Cj.length>0;$.log(`Firebase initializing with ${R6e?"fallback":"environment"} configuration`);let ek,v3,Hn,z1;try{ek=uie(C6e),v3=E1(ek),Hn=Uk(ek),z1=b6e(ek),$.log("Firebase initialized successfully")}catch(n){$.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const td=n=>!0,SQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},oR=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return $.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();$.log(`userFirestore: Checking if username "${e}" is taken`);const i=Al(Hn,"users"),o=IN(i,KBe(100)),l=await od(o);let u=!1;return l.forEach(f=>{const _=f.data();_.username&&_.username.toLowerCase()===e&&(u=!0)}),$.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return $.error("userFirestore: Error checking username availability:",e),!0}},I6e=async(n,e)=>{let i=SQ(n,e),o=0;const l=10;for(;o<l;){if(!await oR(i))return i;i=SQ(n,e),o++}return i+Math.floor(Math.random()*100)},cu=async n=>{try{$.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=gr(Hn,"users",n),i=await Uo(e);if(i.exists()){const o=i.data();return $.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return $.error("userFirestore: user profile document not found"),null}catch(e){throw $.error("userFirestore: Error fetching user public profile data:",e),e}},A6e=async(n,e,i)=>{try{if($.log("userFirestore: Starting registerUser process"),$.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw $.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};$.log("userFirestore: Critical fields captured for registration"),$.log("userFirestore: Creating user auth record");const u=(await IFe(v3,n,e)).user;await jie(u),$.log("userFirestore: Verification email sent"),$.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(M=>setTimeout(M,5e3));const f=gr(Hn,"users",u.uid),_=await Uo(f);if(_.exists()){$.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const M=_.data(),L={};M.firstName||(L.firstName=o.firstName),M.lastName||(L.lastName=o.lastName),M.Nickname||(L.Nickname=o.Nickname),M.username||(L.username=o.username),M.companyName||(L.companyName=o.companyName),M.linkedInProfile||(L.linkedInProfile=o.linkedInProfile),M.rpmURL||(L.rpmURL=o.rpmURL),Object.keys(L).length>0&&($.log("userFirestore: Updating document with fields:",Object.keys(L).join(", ")),await oo(f,{...L,lastUpdated:new Date}))}else{$.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Yg(f,{...o,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const M=gr(Hn,"users",u.uid,"private","data");await Yg(M,{email:u.email,emailVerified:!1})}const E=await Uo(f);if(!E.exists())throw new Error("User document does not exist even after creation attempts");let S=E.data();S.firstName||(S.firstName=o.firstName),S.lastName||(S.lastName=o.lastName),S.Nickname||(S.Nickname=o.Nickname),S.username||(S.username=o.username),S.companyName||(S.companyName=o.companyName);let C=!1,I={};for(const M in o)(!S[M]||S[M]==="")&&(I[M]=o[M],C=!0);(!S.groups||!S.groups.includes("users"))&&(I.groups=S.groups?[...S.groups,"users"]:["users"],C=!0,$.log("userFirestore: Adding user to users group")),C&&($.log("userFirestore: Updating user document with missing fields"),$.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await oo(f,I),S=(await Uo(f)).data());const O={...u,...S,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return $.log("userFirestore: Registration complete, returning user data"),$.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(o){throw $.error("userFirestore: Error creating user:",o),o}},Noe=async(n,e)=>{try{$.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=gr(Hn,"users",n);await oo(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),$.log("userFirestore: rpmURL updated successfully.")}catch(i){throw $.error("userFirestore: Error updating rpmURL:",i),i}},P6e=async(n,e)=>{try{const i=await cu(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return $.error("userFirestore: Error checking group membership:",i),!1}},O6e=async(n,e)=>{try{if(td(e),await oR(e))throw new Error("Username is already taken");const o=gr(Hn,"users",n);return await oo(o,{username:e,lastUpdated:new Date}),$.log(`userFirestore: Username updated for user ${n}`),!0}catch(i){throw $.error("userFirestore: Error updating username:",i),i}};var k6e={};const ON=()=>{const n=typeof process<"u"&&k6e&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},N6e=(n,e)=>{if(!ON())return $.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},D6e=(n,e)=>{if(!ON())return $.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},S3=typeof ON=="function"?ON():!1;S3&&$.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const x6e=async(n,e)=>{if(S3)return N6e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const o=E1().currentUser;if(o&&o.uid===n.uid)try{const u=(await o.getIdTokenResult(!0)).claims.groups||[],f=`space_${e}_owners`;if(u.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return $.error("Error checking space owner permissions:",i),!1}},Doe=async(n,e)=>{if(S3)return D6e();try{if($.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return $.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await cu(n);if($.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if($.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return $.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else $.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=E1().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if($.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return $.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){$.error("userPermissions: Error checking token claims:",o)}}return $.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return $.error("userPermissions: Error checking if user belongs to group:",i),!1}},L6e=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],ih={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class M6e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),$.log(`EventBus: Published event '${e}'`)):$.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const sh=new M6e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xoe="firebasestorage.googleapis.com",Loe="storageBucket",U6e=2*60*1e3,V6e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends lh{constructor(e,i,o=0){super(WU(e),`Firebase Storage: ${i} (${WU(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,$s.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return WU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Hs||(Hs={}));function WU(n){return"storage/"+n}function b3(){const n="An unknown error occurred, please check the error payload for server response.";return new $s(Hs.UNKNOWN,n)}function j6e(n){return new $s(Hs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function F6e(n){return new $s(Hs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function B6e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new $s(Hs.UNAUTHENTICATED,n)}function W6e(){return new $s(Hs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function z6e(n){return new $s(Hs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function G6e(){return new $s(Hs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function H6e(){return new $s(Hs.CANCELED,"User canceled the upload/download.")}function $6e(n){return new $s(Hs.INVALID_URL,"Invalid URL '"+n+"'.")}function K6e(n){return new $s(Hs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function q6e(){return new $s(Hs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Loe+"' property when initializing the app?")}function Y6e(){return new $s(Hs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function X6e(){return new $s(Hs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function J6e(n){return new $s(Hs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Rj(n){return new $s(Hs.INVALID_ARGUMENT,n)}function Moe(){return new $s(Hs.APP_DELETED,"The Firebase app was deleted.")}function Q6e(n){return new $s(Hs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function PC(n,e){return new $s(Hs.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Nw(n){throw new $s(Hs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iu{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=iu.makeFromUrl(e,i)}catch{return new iu(e,"")}if(o.path==="")return o;throw K6e(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function u(oe){oe.path.charAt(oe.path.length-1)==="/"&&(oe.path_=oe.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+l+f,"i"),E={bucket:1,path:3};function S(oe){oe.path_=decodeURIComponent(oe.path)}const C="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",M=new RegExp(`^https?://${I}/${C}/b/${l}/o${O}`,"i"),L={bucket:1,path:3},U=i===xoe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,B="([^?#]*)",J=new RegExp(`^https?://${U}/${l}/${B}`,"i"),ne=[{regex:_,indices:E,postModify:u},{regex:M,indices:L,postModify:S},{regex:J,indices:{bucket:1,path:2},postModify:S}];for(let oe=0;oe<ne.length;oe++){const se=ne[oe],le=se.regex.exec(e);if(le){const Y=le[se.indices.bucket];let Z=le[se.indices.path];Z||(Z=""),o=new iu(Y,Z),se.postModify(o);break}}if(o==null)throw $6e(e);return o}}class Z6e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eWe(n,e,i){let o=1,l=null,u=null,f=!1,_=0;function E(){return _===2}let S=!1;function C(...B){S||(S=!0,e.apply(null,B))}function I(B){l=setTimeout(()=>{l=null,n(M,E())},B)}function O(){u&&clearTimeout(u)}function M(B,...J){if(S){O();return}if(B){O(),C.call(null,B,...J);return}if(E()||f){O(),C.call(null,B,...J);return}o<64&&(o*=2);let ne;_===1?(_=2,ne=0):ne=(o+Math.random())*1e3,I(ne)}let L=!1;function U(B){L||(L=!0,O(),!S&&(l!==null?(B||(_=2),clearTimeout(l),I(0)):B||(_=1)))}return I(0),u=setTimeout(()=>{f=!0,U(!0)},i),U}function tWe(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nWe(n){return n!==void 0}function rWe(n){return typeof n=="object"&&!Array.isArray(n)}function T3(n){return typeof n=="string"||n instanceof String}function bQ(n){return w3()&&n instanceof Blob}function w3(){return typeof Blob<"u"}function TQ(n,e,i,o){if(o<e)throw Rj(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw Rj(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G1(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function Uoe(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var Yy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Yy||(Yy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iWe(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sWe{constructor(e,i,o,l,u,f,_,E,S,C,I,O=!0){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=E,this.timeout_=S,this.progressCallback_=C,this.connectionFactory_=I,this.retry=O,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((M,L)=>{this.resolve_=M,this.reject_=L,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new tk(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const f=_=>{const E=_.loaded,S=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,S)};this.progressCallback_!==null&&u.addUploadProgressListener(f),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(f),this.pendingConnection_=null;const _=u.getErrorCode()===Yy.NO_ERROR,E=u.getStatus();if(!_||iWe(E,this.additionalRetryCodes_)&&this.retry){const C=u.getErrorCode()===Yy.ABORT;o(!1,new tk(!1,null,C));return}const S=this.successCodes_.indexOf(E)!==-1;o(!0,new tk(S,u))})},i=(o,l)=>{const u=this.resolve_,f=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());nWe(E)?u(E):u()}catch(E){f(E)}else if(_!==null){const E=b3();E.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,E)):f(E)}else if(l.canceled){const E=this.appDelete_?Moe():H6e();f(E)}else{const E=G6e();f(E)}};this.canceled_?i(!1,new tk(!1,null,!0)):this.backoffId_=eWe(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&tWe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class tk{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function oWe(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function aWe(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function cWe(n,e){e&&(n["X-Firebase-GMPID"]=e)}function lWe(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function uWe(n,e,i,o,l,u,f=!0){const _=Uoe(n.urlParams),E=n.url+_,S=Object.assign({},n.headers);return cWe(S,e),oWe(S,i),aWe(S,u),lWe(S,o),new sWe(E,n.method,S,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dWe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function hWe(...n){const e=dWe();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(w3())return new Blob(n);throw new $s(Hs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function pWe(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fWe(n){if(typeof atob>"u")throw J6e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class zU{constructor(e,i){this.data=e,this.contentType=i||null}}function mWe(n,e){switch(n){case mp.RAW:return new zU(Voe(e));case mp.BASE64:case mp.BASE64URL:return new zU(joe(n,e));case mp.DATA_URL:return new zU(_We(e),yWe(e))}throw b3()}function Voe(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=o,f=n.charCodeAt(++i);o=65536|(u&1023)<<10|f&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function gWe(n){let e;try{e=decodeURIComponent(n)}catch{throw PC(mp.DATA_URL,"Malformed data URL.")}return Voe(e)}function joe(n,e){switch(n){case mp.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw PC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case mp.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw PC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=fWe(e)}catch(l){throw l.message.includes("polyfill")?l:PC(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class Foe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw PC(mp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=EWe(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function _We(n){const e=new Foe(n);return e.base64?joe(mp.BASE64,e.rest):gWe(e.rest)}function yWe(n){return new Foe(n).contentType}function EWe(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Og{constructor(e,i){let o=0,l="";bQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(bQ(this.data_)){const o=this.data_,l=pWe(o,e,i);return l===null?null:new Og(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new Og(o,!0)}}static getBlob(...e){if(w3()){const i=e.map(o=>o instanceof Og?o.data_:o);return new Og(hWe.apply(null,i))}else{const i=e.map(f=>T3(f)?mWe(mp.RAW,f).data:f.data_);let o=0;i.forEach(f=>{o+=f.byteLength});const l=new Uint8Array(o);let u=0;return i.forEach(f=>{for(let _=0;_<f.length;_++)l[u++]=f[_]}),new Og(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Boe(n){let e;try{e=JSON.parse(n)}catch{return null}return rWe(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vWe(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function SWe(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function Woe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bWe(n,e){return e}class kc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||bWe}}let nk=null;function TWe(n){return!T3(n)||n.length<2?n:Woe(n)}function zoe(){if(nk)return nk;const n=[];n.push(new kc("bucket")),n.push(new kc("generation")),n.push(new kc("metageneration")),n.push(new kc("name","fullPath",!0));function e(u,f){return TWe(f)}const i=new kc("name");i.xform=e,n.push(i);function o(u,f){return f!==void 0?Number(f):f}const l=new kc("size");return l.xform=o,n.push(l),n.push(new kc("timeCreated")),n.push(new kc("updated")),n.push(new kc("md5Hash",null,!0)),n.push(new kc("cacheControl",null,!0)),n.push(new kc("contentDisposition",null,!0)),n.push(new kc("contentEncoding",null,!0)),n.push(new kc("contentLanguage",null,!0)),n.push(new kc("contentType",null,!0)),n.push(new kc("metadata","customMetadata",!0)),nk=n,nk}function wWe(n,e){function i(){const o=n.bucket,l=n.fullPath,u=new iu(o,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function CWe(n,e,i){const o={};o.type="file";const l=i.length;for(let u=0;u<l;u++){const f=i[u];o[f.local]=f.xform(o,e[f.server])}return wWe(o,n),o}function Goe(n,e,i){const o=Boe(e);return o===null?null:CWe(n,o,i)}function RWe(n,e,i,o){const l=Boe(e);if(l===null||!T3(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const f=encodeURIComponent;return u.split(",").map(S=>{const C=n.bucket,I=n.fullPath,O="/b/"+f(C)+"/o/"+f(I),M=G1(O,i,o),L=Uoe({alt:"media",token:S});return M+L})[0]}function IWe(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class C3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hoe(n){if(!n)throw b3()}function AWe(n,e){function i(o,l){const u=Goe(n,l,e);return Hoe(u!==null),u}return i}function PWe(n,e){function i(o,l){const u=Goe(n,l,e);return Hoe(u!==null),RWe(u,l,n.host,n._protocol)}return i}function $oe(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=W6e():l=B6e():i.getStatus()===402?l=F6e(n.bucket):i.getStatus()===403?l=z6e(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function Koe(n){const e=$oe(n);function i(o,l){let u=e(o,l);return o.getStatus()===404&&(u=j6e(n.path)),u.serverResponse=l.serverResponse,u}return i}function OWe(n,e,i){const o=e.fullServerUrl(),l=G1(o,n.host,n._protocol),u="GET",f=n.maxOperationRetryTime,_=new C3(l,u,PWe(n,i),f);return _.errorHandler=Koe(e),_}function kWe(n,e){const i=e.fullServerUrl(),o=G1(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function f(E,S){}const _=new C3(o,l,f,u);return _.successCodes=[200,204],_.errorHandler=Koe(e),_}function NWe(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function DWe(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=NWe(null,e)),o}function xWe(n,e,i,o,l){const u=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function _(){let ne="";for(let oe=0;oe<2;oe++)ne=ne+Math.random().toString().slice(2);return ne}const E=_();f["Content-Type"]="multipart/related; boundary="+E;const S=DWe(e,o,l),C=IWe(S,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+E+`\r
Content-Type: `+S.contentType+`\r
\r
`,O=`\r
--`+E+"--",M=Og.getBlob(I,o,O);if(M===null)throw Y6e();const L={name:S.fullPath},U=G1(u,n.host,n._protocol),B="POST",J=n.maxUploadRetryTime,K=new C3(U,B,AWe(n,i),J);return K.urlParams=L,K.headers=f,K.body=M.uploadData(),K.errorHandler=$oe(e),K}class LWe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Yy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Yy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Yy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l){if(this.sent_)throw Nw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Nw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Nw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Nw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Nw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class MWe extends LWe{initXhr(){this.xhr_.responseType="text"}}function R3(){return new MWe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,i){this._service=e,i instanceof iu?this._location=i:this._location=iu.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new oE(e,i)}get root(){const e=new iu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Woe(this._location.path)}get storage(){return this._service}get parent(){const e=vWe(this._location.path);if(e===null)return null;const i=new iu(this._location.bucket,e);return new oE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw Q6e(e)}}function UWe(n,e,i){n._throwIfRoot("uploadBytes");const o=xWe(n.storage,n._location,zoe(),new Og(e,!0),i);return n.storage.makeRequestWithTokens(o,R3).then(l=>({metadata:l,ref:n}))}function VWe(n){n._throwIfRoot("getDownloadURL");const e=OWe(n.storage,n._location,zoe());return n.storage.makeRequestWithTokens(e,R3).then(i=>{if(i===null)throw X6e();return i})}function jWe(n){n._throwIfRoot("deleteObject");const e=kWe(n.storage,n._location);return n.storage.makeRequestWithTokens(e,R3)}function FWe(n,e){const i=SWe(n._location.path,e),o=new iu(n._location.bucket,i);return new oE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BWe(n){return/^[A-Za-z]+:\/\//.test(n)}function WWe(n,e){return new oE(n,e)}function qoe(n,e){if(n instanceof I3){const i=n;if(i._bucket==null)throw q6e();const o=new oE(i,i._bucket);return e!=null?qoe(o,e):o}else return e!==void 0?FWe(n,e):n}function zWe(n,e){if(e&&BWe(e)){if(n instanceof I3)return WWe(n,e);throw Rj("To use ref(service, url), the first argument must be a Storage instance.")}else return qoe(n,e)}function wQ(n,e){const i=e==null?void 0:e[Loe];return i==null?null:iu.makeFromBucketSpec(i,n)}function GWe(n,e,i,o={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=o;l&&(n._overrideAuthToken=typeof l=="string"?l:aie(l,n.app.options.projectId))}class I3{constructor(e,i,o,l,u){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=xoe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=U6e,this._maxUploadRetryTime=V6e,this._requests=new Set,l!=null?this._bucket=iu.makeFromBucketSpec(l,this._host):this._bucket=wQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=iu.makeFromBucketSpec(this._url,e):this._bucket=wQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){TQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){TQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(vl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new oE(this,e)}_makeRequest(e,i,o,l,u=!0){if(this._deleted)return new Z6e(Moe());{const f=uWe(e,this._appId,o,l,i,this._firebaseVersion,u);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const CQ="@firebase/storage",RQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yoe="storage";function A3(n,e,i){return n=Ii(n),UWe(n,e,i)}function H1(n){return n=Ii(n),VWe(n)}function P3(n){return n=Ii(n),jWe(n)}function fE(n,e){return n=Ii(n),zWe(n,e)}function mE(n=m1(),e){n=Ii(n);const o=PR(n,Yoe).getImmediate({identifier:e}),l=v4("storage");return l&&HWe(o,...l),o}function HWe(n,e,i,o={}){GWe(n,e,i,o)}function $We(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new I3(i,o,l,e,lE)}function KWe(){Wg(new rm(Yoe,$We,"PUBLIC").setMultipleInstances(!0)),id(CQ,RQ,""),id(CQ,RQ,"esm2017")}KWe();const jk=async n=>{const e=mE(),i=fE(e,n);try{return await H1(i)}catch(o){throw $.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let Ij={};const ad=async n=>{try{const e=gr(Hn,"spaces",n),i=await Uo(e);if(i.exists()){let o=i.data();const l=o.name,u=o.description;if(o.webglBuildId){const f=gr(Hn,"webglBuilds",o.webglBuildId),_=await Uo(f);if(_.exists()){const E=_.data();o={...o,...E,name:l||E.name,description:u||E.description}}else $.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await qWe(o),o=YWe(o),console.log("Space data:",o),$.log(`spacesFirestore: Caching space data for: ${n}`),Ij[n]=o,o}else return $.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw $.error("spacesFirestore: Error fetching item data:",e),e}},qWe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await jk(l))});return await Promise.all(i),n},YWe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let GU={};const Xoe=async n=>{$.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(GU[n])return $.log("spacesFirestore: Returning cached videos for space:",n),GU[n];const e=Al(Hn,`spaces/${n}/videos`),i=await od(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),GU[n]=o,o}catch(e){throw $.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},XWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=mE(),o=Date.now(),l=e.name.split(".").pop(),u=`logo_${o}.${l}`,f=fE(i,`spaces/${n}/logo/${u}`);$.log(`Uploading logo for space ${n}`);const _=await A3(f,e),E=await H1(_.ref),S=gr(Hn,"spaces",n);return await oo(S,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:u,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw $.error("Error uploading space logo:",i),i}},JWe=async n=>{try{const e=gr(Hn,"spaces",n),i=await Uo(e);if(!i.exists())return $.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=mE(),u=fE(l,o.logoGsUrl);try{await P3(u),$.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(f){$.warn(`Could not delete logo file from storage: ${f.message}`)}}return await oo(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw $.error("Error deleting space logo:",e),e}},QWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=mE(),o=Date.now(),l=e.name.split(".").pop(),u=`background_${o}.${l}`,f=fE(i,`spaces/${n}/background/${u}`);$.log(`Uploading background for space ${n}`);const _=await A3(f,e),E=await H1(_.ref),S=gr(Hn,"spaces",n);return await oo(S,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:u,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw $.error("Error uploading space background:",i),i}},ZWe=async n=>{try{const e=gr(Hn,"spaces",n),i=await Uo(e);if(!i.exists())return $.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=mE(),u=fE(l,o.backgroundGsUrl);try{await P3(u),$.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(f){$.warn(`Could not delete background file from storage: ${f.message}`)}}return await oo(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed background for space ${n}`),!0}catch(e){throw $.error("Error deleting space background:",e),e}},eze=async(n,e)=>{try{if(!n||!e||!e.uid)throw new Error("Missing required parameters");const i=gr(Hn,`spaces/${n}/BannedUsers`,e.uid),o=Object.entries({...e,bannedAt:e.bannedAt||new Date().toISOString()}).reduce((l,[u,f])=>(f!==void 0&&(l[u]=f),l),{});await Yg(i,o);try{const l=gr(Hn,"users",e.uid),u=await Uo(l);if(u.exists()){const f=u.data(),_=Array.isArray(f.groups)?f.groups:[],E=`space_${n}_banned`;_.includes(E)||await oo(l,{groups:[..._,E]})}}catch(l){$.error("spacesFirestore: failed to add banned group to user",l)}return $.log(`spacesFirestore: Added banned user ${e.uid} to space ${n}`),!0}catch(i){throw $.error("spacesFirestore: Error adding banned user:",i),i}},O3=async(n,e)=>{try{$.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=gr(Hn,"spaces",n);return await oo(i,{...e,updatedAt:new Date().toISOString()}),Ij[n]&&delete Ij[n],!0}catch(i){throw $.error("spacesFirestore: Error updating space settings:",i),i}},tze=async(n,e)=>O3(n,{accessibleToAllUsers:e}),Aj=async(n,e)=>O3(n,{HLSStreamURL:e}),Joe=async n=>{try{const e=gr(Hn,"spaces",n),i=await Uo(e);return i.exists()&&i.data().HLSStreamURL||null}catch(e){throw $.error("spacesFirestore: Error getting HLS stream:",e),e}},nze=async(n,e)=>($.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),rze=async n=>($.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),us=k.createContext(null),Qoe=k.createContext(null),$1=({children:n})=>{const[e,i]=k.useState(null),o=k.useRef(null),[l,u]=k.useState(!0),[f,_]=k.useState(!1),E=E1(),S=le=>le?le.Nickname?le.Nickname:`${le.firstName} ${le.lastName}`:"Anon";k.useEffect(()=>{const le=kFe(E,async Y=>{if($.log("UserProvider: Firebase onAuthStateChanged() fired"),Y)try{const Z=await cu(Y.uid),X=S(Z),ie={uid:Y.uid,email:Y.email,emailVerified:Y.emailVerified,...Z,displayName:X};$.log(`UserProvider: User authenticated: ${Y.uid}`),i(ie),o.current=ie,M(ie)}catch(Z){$.error("UserProvider: Error fetching user profile data:",Z)}else i(null),o.current=null;u(!1)});return()=>{le&&le()}},[]);const C=async(le,Y,Z)=>{try{_(!0),$.log("UserProvider: Starting registration process"),$.log("UserProvider: Registration includes fields:",Object.keys(Z||{}).join(", "));const X={...Z},ie=["firstName","lastName","username","companyName","linkedInProfile"],de=ie.filter(we=>!X[we]);de.length>0&&$.warn(`UserProvider: Registration missing fields: ${de.join(", ")}`);const ue=X.firstName&&X.lastName?`${X.firstName}${X.lastName.charAt(0).toUpperCase()}`:"";$.log("UserProvider: Generated default nickname for registration");const pe={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:X.Nickname||ue,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...X};$.log("UserProvider: Prepared registration data with fields:",Object.keys(pe).join(", "));const ke=await A6e(le,Y,pe);$.log("UserProvider: Registration successful, received user data");const xe=ie.filter(we=>!ke[we]);xe.length>0&&$.warn(`UserProvider: Returned user data missing fields: ${xe.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(we=>{ke[we]||($.warn(`UserProvider: ${we} is missing in returned data, using original value`),ke[we]=pe[we])});const Oe={uid:ke.uid,email:ke.email,...ke,displayName:S(ke)};return $.log("UserProvider: Created user object with fields:",Object.keys(Oe).join(", ")),i(Oe),o.current=Oe,$.log("UserProvider: User registered successfully with groups:",pe.groups),await new Promise(we=>setTimeout(we,2e3)),_(!1),Oe}catch(X){throw _(!1),$.error("UserProvider: Error during registration:",X),X}},I=async(le,Y,Z)=>{try{if($.log("UserProvider: Signing in user"),!Z)throw new Error("CAPTCHA verification is required");const ie=(await AFe(E,le,Y)).user;return $.log("UserProvider: User signed in successfully:",ie.email),ie}catch(X){throw $.error("UserProvider: Error signing in:",X),X}},O=async()=>{try{await NFe(E),i(null),$.log("UserProvider: User signed out.")}catch(le){throw $.error("UserProvider: Error signing out:",le),le}},M=()=>{const le=o.current;if(le){const Y=L(le);$.log("UserProvider: sendUserToUnity() using the eventBus",Y),sh.publish(ih.sendUserToUnity,Y)}else $.log("UserProvider: No current user to send to Unity.")},L=le=>{const Y={};return[...L6e,"uid"].forEach(X=>{le.hasOwnProperty(X)&&(Y[X]=le[X])}),Y},U=async le=>!e||!e.uid?!1:await Doe(e.uid,le),B=async le=>{try{return!e||!e.uid?!1:e.groups&&e.groups.includes(`space_${le}_banned`)?!0:(await Uo(gr(Hn,`spaces/${le}/BannedUsers`,e.uid))).exists()}catch(Y){return Y.code!=="permission-denied"&&$.error("UserProvider: isUserBannedFromSpace error:",Y),!1}},J=async le=>{if(!e||!e.uid)return!1;try{if(await B(le))return $.warn(`UserProvider: User ${e.uid} banned from ${le}`),!1;const Y=await ad(le);if(Y.usersAllowed.includes(e.uid)||Y.userAdmin.includes(e.uid)||Y.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const X=`space_${le}_owners`,ie=`space_${le}_hosts`;if(e.groups.includes(X)||e.groups.includes(ie))return $.log(`UserProvider: User ${e.uid} has access to space ${le} as owner/host`),!0}return Y.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(Y){return $.error("UserProvider: Error verifying user access to space:",Y),!1}},K=async le=>{if(!e||!e.uid)return!1;try{return(await ad(le)).userAdmin.includes(e.uid)}catch(Y){return $.error("UserProvider: Error verifying user admin status for space:",Y),!1}},ne=async le=>{if(!e||!e.uid)return!1;try{return(await ad(le)).usersModerators.includes(e.uid)}catch(Y){return $.error("UserProvider: Error verifying user moderator status for space:",Y),!1}},oe=async()=>{try{const le=E.currentUser;return le&&!le.emailVerified?(await jie(le),$.log("UserProvider: Verification email resent to:",le.email),!0):!1}catch(le){throw $.error("UserProvider: Error resending verification email:",le),le}},se=async()=>{try{const le=E.currentUser;if(!le)return $.warn("UserProvider: updateUser called but no current user exists"),null;$.log("UserProvider: Updating user data from Firestore");const Y=await cu(le.uid);if(!Y)return $.error("UserProvider: Failed to fetch updated user profile"),null;const Z=S(Y),X={uid:le.uid,email:le.email,emailVerified:le.emailVerified,...Y,displayName:Z};return $.log("UserProvider: User data updated with fields:",Object.keys(X).join(", ")),i(X),o.current=X,M(X),X}catch(le){throw $.error("UserProvider: Error updating user data:",le),le}};return b.jsx(Qoe.Provider,{value:{registrationInProgress:f},children:b.jsx(us.Provider,{value:{user:e,loading:l,register:C,signIn:I,signOut:O,sendUserToUnity:M,isUserInGroup:U,userHasAccessToSpace:J,userIsAdminOfSpace:K,userIsModeratorOfSpace:ne,resendVerificationEmail:oe,updateUser:se,isUserBannedFromSpace:B},children:n})})},ize=()=>{const n=k.useContext(Qoe);if(n===void 0)throw new Error("useRegistration must be used within a UserProvider");return n},Zoe=k.createContext(),uh=()=>k.useContext(Zoe),k3=({children:n})=>{const[e,i]=k.useState(!1),o=k.useRef(null),[l,u]=k.useState(!1);k.useEffect(()=>{const E=()=>{const S=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(S)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const f=k.useCallback(E=>{o.current=E},[]),_=k.useCallback(()=>{const E=o.current;if(!E)return;const S=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{S?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{S?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return k.useEffect(()=>{const E=()=>{const S=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!S)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),b.jsx(Zoe.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:o,setFullscreenRef:f,isMobile:l},children:b.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},sze=Qg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),oze=Qg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),aze=Qg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),eae=Qg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),IQ=Qg({displayName:"EmailIcon",path:b.jsxs("g",{fill:"currentColor",children:[b.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),b.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),cze=Qg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),lze=Qg({displayName:"QuestionOutlineIcon",path:b.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[b.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),b.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),b.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),uze=Qg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var FR=n=>n.type==="checkbox",My=n=>n instanceof Date,Dc=n=>n==null;const tae=n=>typeof n=="object";var io=n=>!Dc(n)&&!Array.isArray(n)&&tae(n)&&!My(n),dze=n=>io(n)&&n.target?FR(n.target)?n.target.checked:n.target.value:n,hze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,pze=(n,e)=>n.has(hze(e)),fze=n=>{const e=n.constructor&&n.constructor.prototype;return io(e)&&e.hasOwnProperty("isPrototypeOf")},N3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Qu(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(N3&&(n instanceof Blob||o))&&(i||io(n)))if(e=i?[]:{},!i&&!fze(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Qu(n[l]));else return n;return e}var K1=n=>Array.isArray(n)?n.filter(Boolean):[],po=n=>n===void 0,pn=(n,e,i)=>{if(!e||!io(n))return i;const o=K1(e.split(/[,[\].]+?/)).reduce((l,u)=>Dc(l)?l:l[u],n);return po(o)||o===n?po(n[e])?i:n[e]:o},sp=n=>typeof n=="boolean",D3=n=>/^\w*$/.test(n),nae=n=>K1(n.replace(/["|']|\]/g,"").split(/\.|\[/)),ss=(n,e,i)=>{let o=-1;const l=D3(e)?[e]:nae(e),u=l.length,f=u-1;for(;++o<u;){const _=l[o];let E=i;if(o!==f){const S=n[_];E=io(S)||Array.isArray(S)?S:isNaN(+l[o+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const AQ={BLUR:"blur",FOCUS_OUT:"focusout"},rh={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Pf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};_i.createContext(null);var mze=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const f=u;return e._proxyFormState[f]!==rh.all&&(e._proxyFormState[f]=!o||rh.all),n[f]}});return l},_l=n=>io(n)&&!Object.keys(n).length,gze=(n,e,i,o)=>{i(n);const{name:l,...u}=n;return _l(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(f=>e[f]===rh.all)},Fk=n=>Array.isArray(n)?n:[n];function _ze(n){const e=_i.useRef(n);e.current=n,_i.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var gp=n=>typeof n=="string",yze=(n,e,i,o,l)=>gp(n)?(o&&e.watch.add(n),pn(i,n,l)):Array.isArray(n)?n.map(u=>(o&&e.watch.add(u),pn(i,u))):(o&&(e.watchAll=!0),i),Eze=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},PQ=n=>({isOnSubmit:!n||n===rh.onSubmit,isOnBlur:n===rh.onBlur,isOnChange:n===rh.onChange,isOnAll:n===rh.all,isOnTouch:n===rh.onTouched}),OQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const OC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const u=pn(n,l);if(u){const{_f:f,..._}=u;if(f){if(f.refs&&f.refs[0]&&e(f.refs[0],l)&&!o)return!0;if(f.ref&&e(f.ref,f.name)&&!o)return!0;if(OC(_,e))break}else if(io(_)&&OC(_,e))break}}};var vze=(n,e,i)=>{const o=Fk(pn(n,i));return ss(o,"root",e[i]),ss(n,i,o),n},x3=n=>n.type==="file",hp=n=>typeof n=="function",kN=n=>{if(!N3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Bk=n=>gp(n),L3=n=>n.type==="radio",NN=n=>n instanceof RegExp;const kQ={value:!1,isValid:!1},NQ={value:!0,isValid:!0};var rae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!po(n[0].attributes.value)?po(n[0].value)||n[0].value===""?NQ:{value:n[0].value,isValid:!0}:NQ:kQ}return kQ};const DQ={isValid:!1,value:null};var iae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,DQ):DQ;function xQ(n,e,i="validate"){if(Bk(n)||Array.isArray(n)&&n.every(Bk)||sp(n)&&!n)return{type:i,message:Bk(n)?n:"",ref:e}}var jS=n=>io(n)&&!NN(n)?n:{value:n,message:""},LQ=async(n,e,i,o,l,u)=>{const{ref:f,refs:_,required:E,maxLength:S,minLength:C,min:I,max:O,pattern:M,validate:L,name:U,valueAsNumber:B,mount:J}=n._f,K=pn(i,U);if(!J||e.has(U))return{};const ne=_?_[0]:f,oe=ue=>{l&&ne.reportValidity&&(ne.setCustomValidity(sp(ue)?"":ue||""),ne.reportValidity())},se={},le=L3(f),Y=FR(f),Z=le||Y,X=(B||x3(f))&&po(f.value)&&po(K)||kN(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,ie=Eze.bind(null,U,o,se),de=(ue,pe,ke,xe=Pf.maxLength,je=Pf.minLength)=>{const Oe=ue?pe:ke;se[U]={type:ue?xe:je,message:Oe,ref:f,...ie(ue?xe:je,Oe)}};if(u?!Array.isArray(K)||!K.length:E&&(!Z&&(X||Dc(K))||sp(K)&&!K||Y&&!rae(_).isValid||le&&!iae(_).isValid)){const{value:ue,message:pe}=Bk(E)?{value:!!E,message:E}:jS(E);if(ue&&(se[U]={type:Pf.required,message:pe,ref:ne,...ie(Pf.required,pe)},!o))return oe(pe),se}if(!X&&(!Dc(I)||!Dc(O))){let ue,pe;const ke=jS(O),xe=jS(I);if(!Dc(K)&&!isNaN(K)){const je=f.valueAsNumber||K&&+K;Dc(ke.value)||(ue=je>ke.value),Dc(xe.value)||(pe=je<xe.value)}else{const je=f.valueAsDate||new Date(K),Oe=Be=>new Date(new Date().toDateString()+" "+Be),we=f.type=="time",Se=f.type=="week";gp(ke.value)&&K&&(ue=we?Oe(K)>Oe(ke.value):Se?K>ke.value:je>new Date(ke.value)),gp(xe.value)&&K&&(pe=we?Oe(K)<Oe(xe.value):Se?K<xe.value:je<new Date(xe.value))}if((ue||pe)&&(de(!!ue,ke.message,xe.message,Pf.max,Pf.min),!o))return oe(se[U].message),se}if((S||C)&&!X&&(gp(K)||u&&Array.isArray(K))){const ue=jS(S),pe=jS(C),ke=!Dc(ue.value)&&K.length>+ue.value,xe=!Dc(pe.value)&&K.length<+pe.value;if((ke||xe)&&(de(ke,ue.message,pe.message),!o))return oe(se[U].message),se}if(M&&!X&&gp(K)){const{value:ue,message:pe}=jS(M);if(NN(ue)&&!K.match(ue)&&(se[U]={type:Pf.pattern,message:pe,ref:f,...ie(Pf.pattern,pe)},!o))return oe(pe),se}if(L){if(hp(L)){const ue=await L(K,i),pe=xQ(ue,ne);if(pe&&(se[U]={...pe,...ie(Pf.validate,pe.message)},!o))return oe(pe.message),se}else if(io(L)){let ue={};for(const pe in L){if(!_l(ue)&&!o)break;const ke=xQ(await L[pe](K,i),ne,pe);ke&&(ue={...ke,...ie(pe,ke.message)},oe(ke.message),o&&(se[U]=ue))}if(!_l(ue)&&(se[U]={ref:ne,...ue},!o))return se}}return oe(!0),se};function Sze(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=po(n)?o++:n[e[o++]];return n}function bze(n){for(const e in n)if(n.hasOwnProperty(e)&&!po(n[e]))return!1;return!0}function Ao(n,e){const i=Array.isArray(e)?e:D3(e)?[e]:nae(e),o=i.length===1?n:Sze(n,i),l=i.length-1,u=i[l];return o&&delete o[u],l!==0&&(io(o)&&_l(o)||Array.isArray(o)&&bze(o))&&Ao(n,i.slice(0,-1)),n}var HU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}},Pj=n=>Dc(n)||!tae(n);function kg(n,e){if(Pj(n)||Pj(e))return n===e;if(My(n)&&My(e))return n.getTime()===e.getTime();const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const l of i){const u=n[l];if(!o.includes(l))return!1;if(l!=="ref"){const f=e[l];if(My(u)&&My(f)||io(u)&&io(f)||Array.isArray(u)&&Array.isArray(f)?!kg(u,f):u!==f)return!1}}return!0}var sae=n=>n.type==="select-multiple",Tze=n=>L3(n)||FR(n),$U=n=>kN(n)&&n.isConnected,oae=n=>{for(const e in n)if(hp(n[e]))return!0;return!1};function DN(n,e={}){const i=Array.isArray(n);if(io(n)||i)for(const o in n)Array.isArray(n[o])||io(n[o])&&!oae(n[o])?(e[o]=Array.isArray(n[o])?[]:{},DN(n[o],e[o])):Dc(n[o])||(e[o]=!0);return e}function aae(n,e,i){const o=Array.isArray(n);if(io(n)||o)for(const l in n)Array.isArray(n[l])||io(n[l])&&!oae(n[l])?po(e)||Pj(i[l])?i[l]=Array.isArray(n[l])?DN(n[l],[]):{...DN(n[l])}:aae(n[l],Dc(e)?{}:e[l],i[l]):i[l]=!kg(n[l],e[l]);return i}var Dw=(n,e)=>aae(n,e,DN(e)),cae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>po(n)?n:e?n===""?NaN:n&&+n:i&&gp(n)?new Date(n):o?o(n):n;function KU(n){const e=n.ref;return x3(e)?e.files:L3(e)?iae(n.refs).value:sae(e)?[...e.selectedOptions].map(({value:i})=>i):FR(e)?rae(n.refs).value:cae(po(e.value)?n.ref.value:e.value,n)}var wze=(n,e,i,o)=>{const l={};for(const u of n){const f=pn(e,u);f&&ss(l,u,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},xw=n=>po(n)?n:NN(n)?n.source:io(n)?NN(n.value)?n.value.source:n.value:n;const MQ="AsyncFunction";var Cze=n=>!!n&&!!n.validate&&!!(hp(n.validate)&&n.validate.constructor.name===MQ||io(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===MQ)),Rze=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function UQ(n,e,i){const o=pn(n,i);if(o||D3(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),f=pn(e,u),_=pn(n,u);if(f&&!Array.isArray(f)&&i!==u)return{name:i};if(_&&_.type)return{name:u,error:_};l.pop()}return{name:i}}var Ize=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,Aze=(n,e)=>!K1(pn(n,e)).length&&Ao(n,e);const Pze={mode:rh.onSubmit,reValidateMode:rh.onChange,shouldFocusError:!0};function Oze(n={}){let e={...Pze,...n},i={submitCount:0,isDirty:!1,isLoading:hp(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=io(e.defaultValues)||io(e.values)?Qu(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:Qu(l),f={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,S=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:HU(),array:HU(),state:HU()},O=PQ(e.mode),M=PQ(e.reValidateMode),L=e.criteriaMode===rh.all,U=Te=>Ve=>{clearTimeout(S),S=setTimeout(Te,Ve)},B=async Te=>{if(!e.disabled&&(C.isValid||Te)){const Ve=e.resolver?_l((await Z()).errors):await ie(o,!0);Ve!==i.isValid&&I.state.next({isValid:Ve})}},J=(Te,Ve)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((Te||Array.from(_.mount)).forEach($e=>{$e&&(Ve?ss(i.validatingFields,$e,Ve):Ao(i.validatingFields,$e))}),I.state.next({validatingFields:i.validatingFields,isValidating:!_l(i.validatingFields)}))},K=(Te,Ve=[],$e,Et,vt=!0,St=!0)=>{if(Et&&$e&&!e.disabled){if(f.action=!0,St&&Array.isArray(pn(o,Te))){const zt=$e(pn(o,Te),Et.argA,Et.argB);vt&&ss(o,Te,zt)}if(St&&Array.isArray(pn(i.errors,Te))){const zt=$e(pn(i.errors,Te),Et.argA,Et.argB);vt&&ss(i.errors,Te,zt),Aze(i.errors,Te)}if(C.touchedFields&&St&&Array.isArray(pn(i.touchedFields,Te))){const zt=$e(pn(i.touchedFields,Te),Et.argA,Et.argB);vt&&ss(i.touchedFields,Te,zt)}C.dirtyFields&&(i.dirtyFields=Dw(l,u)),I.state.next({name:Te,isDirty:ue(Te,Ve),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else ss(u,Te,Ve)},ne=(Te,Ve)=>{ss(i.errors,Te,Ve),I.state.next({errors:i.errors})},oe=Te=>{i.errors=Te,I.state.next({errors:i.errors,isValid:!1})},se=(Te,Ve,$e,Et)=>{const vt=pn(o,Te);if(vt){const St=pn(u,Te,po($e)?pn(l,Te):$e);po(St)||Et&&Et.defaultChecked||Ve?ss(u,Te,Ve?St:KU(vt._f)):xe(Te,St),f.mount&&B()}},le=(Te,Ve,$e,Et,vt)=>{let St=!1,zt=!1;const dn={name:Te};if(!e.disabled){const vn=!!(pn(o,Te)&&pn(o,Te)._f&&pn(o,Te)._f.disabled);if(!$e||Et){C.isDirty&&(zt=i.isDirty,i.isDirty=dn.isDirty=ue(),St=zt!==dn.isDirty);const nn=vn||kg(pn(l,Te),Ve);zt=!!(!vn&&pn(i.dirtyFields,Te)),nn||vn?Ao(i.dirtyFields,Te):ss(i.dirtyFields,Te,!0),dn.dirtyFields=i.dirtyFields,St=St||C.dirtyFields&&zt!==!nn}if($e){const nn=pn(i.touchedFields,Te);nn||(ss(i.touchedFields,Te,$e),dn.touchedFields=i.touchedFields,St=St||C.touchedFields&&nn!==$e)}St&&vt&&I.state.next(dn)}return St?dn:{}},Y=(Te,Ve,$e,Et)=>{const vt=pn(i.errors,Te),St=C.isValid&&sp(Ve)&&i.isValid!==Ve;if(e.delayError&&$e?(E=U(()=>ne(Te,$e)),E(e.delayError)):(clearTimeout(S),E=null,$e?ss(i.errors,Te,$e):Ao(i.errors,Te)),($e?!kg(vt,$e):vt)||!_l(Et)||St){const zt={...Et,...St&&sp(Ve)?{isValid:Ve}:{},errors:i.errors,name:Te};i={...i,...zt},I.state.next(zt)}},Z=async Te=>{J(Te,!0);const Ve=await e.resolver(u,e.context,wze(Te||_.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return J(Te),Ve},X=async Te=>{const{errors:Ve}=await Z(Te);if(Te)for(const $e of Te){const Et=pn(Ve,$e);Et?ss(i.errors,$e,Et):Ao(i.errors,$e)}else i.errors=Ve;return Ve},ie=async(Te,Ve,$e={valid:!0})=>{for(const Et in Te){const vt=Te[Et];if(vt){const{_f:St,...zt}=vt;if(St){const dn=_.array.has(St.name),vn=vt._f&&Cze(vt._f);vn&&C.validatingFields&&J([Et],!0);const nn=await LQ(vt,_.disabled,u,L,e.shouldUseNativeValidation&&!Ve,dn);if(vn&&C.validatingFields&&J([Et]),nn[St.name]&&($e.valid=!1,Ve))break;!Ve&&(pn(nn,St.name)?dn?vze(i.errors,nn,St.name):ss(i.errors,St.name,nn[St.name]):Ao(i.errors,St.name))}!_l(zt)&&await ie(zt,Ve,$e)}}return $e.valid},de=()=>{for(const Te of _.unMount){const Ve=pn(o,Te);Ve&&(Ve._f.refs?Ve._f.refs.every($e=>!$U($e)):!$U(Ve._f.ref))&&He(Te)}_.unMount=new Set},ue=(Te,Ve)=>!e.disabled&&(Te&&Ve&&ss(u,Te,Ve),!kg(Ee(),l)),pe=(Te,Ve,$e)=>yze(Te,_,{...f.mount?u:po(Ve)?l:gp(Te)?{[Te]:Ve}:Ve},$e,Ve),ke=Te=>K1(pn(f.mount?u:l,Te,e.shouldUnregister?pn(l,Te,[]):[])),xe=(Te,Ve,$e={})=>{const Et=pn(o,Te);let vt=Ve;if(Et){const St=Et._f;St&&(!St.disabled&&ss(u,Te,cae(Ve,St)),vt=kN(St.ref)&&Dc(Ve)?"":Ve,sae(St.ref)?[...St.ref.options].forEach(zt=>zt.selected=vt.includes(zt.value)):St.refs?FR(St.ref)?St.refs.length>1?St.refs.forEach(zt=>(!zt.defaultChecked||!zt.disabled)&&(zt.checked=Array.isArray(vt)?!!vt.find(dn=>dn===zt.value):vt===zt.value)):St.refs[0]&&(St.refs[0].checked=!!vt):St.refs.forEach(zt=>zt.checked=zt.value===vt):x3(St.ref)?St.ref.value="":(St.ref.value=vt,St.ref.type||I.values.next({name:Te,values:{...u}})))}($e.shouldDirty||$e.shouldTouch)&&le(Te,vt,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&Be(Te)},je=(Te,Ve,$e)=>{for(const Et in Ve){const vt=Ve[Et],St=`${Te}.${Et}`,zt=pn(o,St);(_.array.has(Te)||io(vt)||zt&&!zt._f)&&!My(vt)?je(St,vt,$e):xe(St,vt,$e)}},Oe=(Te,Ve,$e={})=>{const Et=pn(o,Te),vt=_.array.has(Te),St=Qu(Ve);ss(u,Te,St),vt?(I.array.next({name:Te,values:{...u}}),(C.isDirty||C.dirtyFields)&&$e.shouldDirty&&I.state.next({name:Te,dirtyFields:Dw(l,u),isDirty:ue(Te,St)})):Et&&!Et._f&&!Dc(St)?je(Te,St,$e):xe(Te,St,$e),OQ(Te,_)&&I.state.next({...i}),I.values.next({name:f.mount?Te:void 0,values:{...u}})},we=async Te=>{f.mount=!0;const Ve=Te.target;let $e=Ve.name,Et=!0;const vt=pn(o,$e),St=()=>Ve.type?KU(vt._f):dze(Te),zt=dn=>{Et=Number.isNaN(dn)||My(dn)&&isNaN(dn.getTime())||kg(dn,pn(u,$e,dn))};if(vt){let dn,vn;const nn=St(),Ct=Te.type===AQ.BLUR||Te.type===AQ.FOCUS_OUT,sr=!Rze(vt._f)&&!e.resolver&&!pn(i.errors,$e)&&!vt._f.deps||Ize(Ct,pn(i.touchedFields,$e),i.isSubmitted,M,O),xt=OQ($e,_,Ct);ss(u,$e,nn),Ct?(vt._f.onBlur&&vt._f.onBlur(Te),E&&E(0)):vt._f.onChange&&vt._f.onChange(Te);const qt=le($e,nn,Ct,!1),Tr=!_l(qt)||xt;if(!Ct&&I.values.next({name:$e,type:Te.type,values:{...u}}),sr)return C.isValid&&(e.mode==="onBlur"&&Ct?B():Ct||B()),Tr&&I.state.next({name:$e,...xt?{}:qt});if(!Ct&&xt&&I.state.next({...i}),e.resolver){const{errors:Pi}=await Z([$e]);if(zt(nn),Et){const As=UQ(i.errors,o,$e),cr=UQ(Pi,o,As.name||$e);dn=cr.error,$e=cr.name,vn=_l(Pi)}}else J([$e],!0),dn=(await LQ(vt,_.disabled,u,L,e.shouldUseNativeValidation))[$e],J([$e]),zt(nn),Et&&(dn?vn=!1:C.isValid&&(vn=await ie(o,!0)));Et&&(vt._f.deps&&Be(vt._f.deps),Y($e,vn,dn,qt))}},Se=(Te,Ve)=>{if(pn(i.errors,Ve)&&Te.focus)return Te.focus(),1},Be=async(Te,Ve={})=>{let $e,Et;const vt=Fk(Te);if(e.resolver){const St=await X(po(Te)?Te:vt);$e=_l(St),Et=Te?!vt.some(zt=>pn(St,zt)):$e}else Te?(Et=(await Promise.all(vt.map(async St=>{const zt=pn(o,St);return await ie(zt&&zt._f?{[St]:zt}:zt)}))).every(Boolean),!(!Et&&!i.isValid)&&B()):Et=$e=await ie(o);return I.state.next({...!gp(Te)||C.isValid&&$e!==i.isValid?{}:{name:Te},...e.resolver||!Te?{isValid:$e}:{},errors:i.errors}),Ve.shouldFocus&&!Et&&OC(o,Se,Te?vt:_.mount),Et},Ee=Te=>{const Ve={...f.mount?u:l};return po(Te)?Ve:gp(Te)?pn(Ve,Te):Te.map($e=>pn(Ve,$e))},Ce=(Te,Ve)=>({invalid:!!pn((Ve||i).errors,Te),isDirty:!!pn((Ve||i).dirtyFields,Te),error:pn((Ve||i).errors,Te),isValidating:!!pn(i.validatingFields,Te),isTouched:!!pn((Ve||i).touchedFields,Te)}),Pe=Te=>{Te&&Fk(Te).forEach(Ve=>Ao(i.errors,Ve)),I.state.next({errors:Te?i.errors:{}})},Me=(Te,Ve,$e)=>{const Et=(pn(o,Te,{_f:{}})._f||{}).ref,vt=pn(i.errors,Te)||{},{ref:St,message:zt,type:dn,...vn}=vt;ss(i.errors,Te,{...vn,...Ve,ref:Et}),I.state.next({name:Te,errors:i.errors,isValid:!1}),$e&&$e.shouldFocus&&Et&&Et.focus&&Et.focus()},We=(Te,Ve)=>hp(Te)?I.values.subscribe({next:$e=>Te(pe(void 0,Ve),$e)}):pe(Te,Ve,!0),He=(Te,Ve={})=>{for(const $e of Te?Fk(Te):_.mount)_.mount.delete($e),_.array.delete($e),Ve.keepValue||(Ao(o,$e),Ao(u,$e)),!Ve.keepError&&Ao(i.errors,$e),!Ve.keepDirty&&Ao(i.dirtyFields,$e),!Ve.keepTouched&&Ao(i.touchedFields,$e),!Ve.keepIsValidating&&Ao(i.validatingFields,$e),!e.shouldUnregister&&!Ve.keepDefaultValue&&Ao(l,$e);I.values.next({values:{...u}}),I.state.next({...i,...Ve.keepDirty?{isDirty:ue()}:{}}),!Ve.keepIsValid&&B()},qe=({disabled:Te,name:Ve,field:$e,fields:Et})=>{(sp(Te)&&f.mount||Te||_.disabled.has(Ve))&&(Te?_.disabled.add(Ve):_.disabled.delete(Ve),le(Ve,KU($e?$e._f:pn(Et,Ve)._f),!1,!1,!0))},rt=(Te,Ve={})=>{let $e=pn(o,Te);const Et=sp(Ve.disabled)||sp(e.disabled);return ss(o,Te,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:Te}},name:Te,mount:!0,...Ve}}),_.mount.add(Te),$e?qe({field:$e,disabled:sp(Ve.disabled)?Ve.disabled:e.disabled,name:Te}):se(Te,!0,Ve.value),{...Et?{disabled:Ve.disabled||e.disabled}:{},...e.progressive?{required:!!Ve.required,min:xw(Ve.min),max:xw(Ve.max),minLength:xw(Ve.minLength),maxLength:xw(Ve.maxLength),pattern:xw(Ve.pattern)}:{},name:Te,onChange:we,onBlur:we,ref:vt=>{if(vt){rt(Te,Ve),$e=pn(o,Te);const St=po(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,zt=Tze(St),dn=$e._f.refs||[];if(zt?dn.find(vn=>vn===St):St===$e._f.ref)return;ss(o,Te,{_f:{...$e._f,...zt?{refs:[...dn.filter($U),St,...Array.isArray(pn(l,Te))?[{}]:[]],ref:{type:St.type,name:Te}}:{ref:St}}}),se(Te,!1,void 0,St)}else $e=pn(o,Te,{}),$e._f&&($e._f.mount=!1),(e.shouldUnregister||Ve.shouldUnregister)&&!(pze(_.array,Te)&&f.action)&&_.unMount.add(Te)}}},et=()=>e.shouldFocusError&&OC(o,Se,_.mount),_t=Te=>{sp(Te)&&(I.state.next({disabled:Te}),OC(o,(Ve,$e)=>{const Et=pn(o,$e);Et&&(Ve.disabled=Et._f.disabled||Te,Array.isArray(Et._f.refs)&&Et._f.refs.forEach(vt=>{vt.disabled=Et._f.disabled||Te}))},0,!1))},on=(Te,Ve)=>async $e=>{let Et;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let vt=Qu(u);if(_.disabled.size)for(const St of _.disabled)ss(vt,St,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:St,values:zt}=await Z();i.errors=St,vt=zt}else await ie(o);if(Ao(i.errors,"root"),_l(i.errors)){I.state.next({errors:{}});try{await Te(vt,$e)}catch(St){Et=St}}else Ve&&await Ve({...i.errors},$e),et(),setTimeout(et);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:_l(i.errors)&&!Et,submitCount:i.submitCount+1,errors:i.errors}),Et)throw Et},dt=(Te,Ve={})=>{pn(o,Te)&&(po(Ve.defaultValue)?Oe(Te,Qu(pn(l,Te))):(Oe(Te,Ve.defaultValue),ss(l,Te,Qu(Ve.defaultValue))),Ve.keepTouched||Ao(i.touchedFields,Te),Ve.keepDirty||(Ao(i.dirtyFields,Te),i.isDirty=Ve.defaultValue?ue(Te,Qu(pn(l,Te))):ue()),Ve.keepError||(Ao(i.errors,Te),C.isValid&&B()),I.state.next({...i}))},kt=(Te,Ve={})=>{const $e=Te?Qu(Te):l,Et=Qu($e),vt=_l(Te),St=vt?l:Et;if(Ve.keepDefaultValues||(l=$e),!Ve.keepValues){if(Ve.keepDirtyValues){const zt=new Set([..._.mount,...Object.keys(Dw(l,u))]);for(const dn of Array.from(zt))pn(i.dirtyFields,dn)?ss(St,dn,pn(u,dn)):Oe(dn,pn(St,dn))}else{if(N3&&po(Te))for(const zt of _.mount){const dn=pn(o,zt);if(dn&&dn._f){const vn=Array.isArray(dn._f.refs)?dn._f.refs[0]:dn._f.ref;if(kN(vn)){const nn=vn.closest("form");if(nn){nn.reset();break}}}}o={}}u=e.shouldUnregister?Ve.keepDefaultValues?Qu(l):{}:Qu(St),I.array.next({values:{...St}}),I.values.next({values:{...St}})}_={mount:Ve.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!C.isValid||!!Ve.keepIsValid||!!Ve.keepDirtyValues,f.watch=!!e.shouldUnregister,I.state.next({submitCount:Ve.keepSubmitCount?i.submitCount:0,isDirty:vt?!1:Ve.keepDirty?i.isDirty:!!(Ve.keepDefaultValues&&!kg(Te,l)),isSubmitted:Ve.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:vt?{}:Ve.keepDirtyValues?Ve.keepDefaultValues&&u?Dw(l,u):i.dirtyFields:Ve.keepDefaultValues&&Te?Dw(l,Te):Ve.keepDirty?i.dirtyFields:{},touchedFields:Ve.keepTouched?i.touchedFields:{},errors:Ve.keepErrors?i.errors:{},isSubmitSuccessful:Ve.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},ct=(Te,Ve)=>kt(hp(Te)?Te(u):Te,Ve);return{control:{register:rt,unregister:He,getFieldState:Ce,handleSubmit:on,setError:Me,_executeSchema:Z,_getWatch:pe,_getDirty:ue,_updateValid:B,_removeUnmounted:de,_updateFieldArray:K,_updateDisabledField:qe,_getFieldArray:ke,_reset:kt,_resetDefaultValues:()=>hp(e.defaultValues)&&e.defaultValues().then(Te=>{ct(Te,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Te=>{i={...i,...Te}},_disableForm:_t,_subjects:I,_proxyFormState:C,_setErrors:oe,get _fields(){return o},get _formValues(){return u},get _state(){return f},set _state(Te){f=Te},get _defaultValues(){return l},get _names(){return _},set _names(Te){_=Te},get _formState(){return i},set _formState(Te){i=Te},get _options(){return e},set _options(Te){e={...e,...Te}}},trigger:Be,register:rt,handleSubmit:on,watch:We,setValue:Oe,getValues:Ee,reset:ct,resetField:dt,clearErrors:Pe,unregister:He,setError:Me,setFocus:(Te,Ve={})=>{const $e=pn(o,Te),Et=$e&&$e._f;if(Et){const vt=Et.refs?Et.refs[0]:Et.ref;vt.focus&&(vt.focus(),Ve.shouldSelect&&hp(vt.select)&&vt.select())}},getFieldState:Ce}}function lae(n={}){const e=_i.useRef(void 0),i=_i.useRef(void 0),[o,l]=_i.useState({isDirty:!1,isValidating:!1,isLoading:hp(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:hp(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...Oze(n),formState:o});const u=e.current.control;return u._options=n,_ze({subject:u._subjects.state,next:f=>{gze(f,u._proxyFormState,u._updateFormState)&&l({...u._formState})}}),_i.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),_i.useEffect(()=>{if(u._proxyFormState.isDirty){const f=u._getDirty();f!==o.isDirty&&u._subjects.state.next({isDirty:f})}},[u,o.isDirty]),_i.useEffect(()=>{n.values&&!kg(n.values,i.current)?(u._reset(n.values,u._options.resetOptions),i.current=n.values,l(f=>({...f}))):u._resetDefaultValues()},[n.values,u]),_i.useEffect(()=>{n.errors&&u._setErrors(n.errors)},[n.errors,u]),_i.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),_i.useEffect(()=>{n.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[n.shouldUnregister,u]),e.current.formState=mze(o,u),e.current}var kze=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function Oj(){return Oj=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Oj.apply(this,arguments)}function Nze(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function rk(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Dze(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,kj(n,e)}function kj(n,e){return kj=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},kj(n,e)}var q1=function(n){Dze(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(rk(o)),o.handleErrored=o.handleErrored.bind(rk(o)),o.handleChange=o.handleChange.bind(rk(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(rk(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,f){l.executionResolve=u,l.executionReject=f,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=Nze(l,kze);return k.createElement("div",Oj({},u,{ref:this.handleRecaptchaRef}))},e}(k.Component);q1.displayName="ReCAPTCHA";q1.propTypes={sitekey:En.string.isRequired,onChange:En.func,grecaptcha:En.object,theme:En.oneOf(["dark","light"]),type:En.oneOf(["image","audio"]),tabindex:En.number,onExpired:En.func,onErrored:En.func,size:En.oneOf(["compact","normal","invisible"]),stoken:En.string,hl:En.string,badge:En.oneOf(["bottomright","bottomleft","inline"]),isolated:En.bool};q1.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function Nj(){return Nj=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Nj.apply(this,arguments)}function xze(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function Lze(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var Qd={},Mze=0;function Uze(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",u=function(_){Lze(E,_);function E(C,I){var O;return O=_.call(this,C,I)||this,O.state={},O.__scriptURL="",O}var S=E.prototype;return S.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+Mze++),this.__scriptLoaderID},S.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},S.asyncScriptLoaderHandleLoad=function(I){var O=this;this.setState(I,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},S.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Qd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var O in I.observers)I.observers[O](I);delete window[e.callbackName]},S.componentDidMount=function(){var I=this,O=this.setupScriptURL(),M=this.asyncScriptLoaderGetScriptLoaderID(),L=e,U=L.globalName,B=L.callbackName,J=L.scriptId;if(U&&typeof window[U]<"u"&&(Qd[O]={loaded:!0,observers:{}}),Qd[O]){var K=Qd[O];if(K&&(K.loaded||K.errored)){this.asyncScriptLoaderHandleLoad(K);return}K.observers[M]=function(Y){return I.asyncScriptLoaderHandleLoad(Y)};return}var ne={};ne[M]=function(Y){return I.asyncScriptLoaderHandleLoad(Y)},Qd[O]={loaded:!1,observers:ne};var oe=document.createElement("script");oe.src=O,oe.async=!0;for(var se in e.attributes)oe.setAttribute(se,e.attributes[se]);J&&(oe.id=J);var le=function(Z){if(Qd[O]){var X=Qd[O],ie=X.observers;for(var de in ie)Z(ie[de])&&delete ie[de]}};B&&typeof window<"u"&&(window[B]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),oe.onload=function(){var Y=Qd[O];Y&&(Y.loaded=!0,le(function(Z){return B?!1:(Z(Y),!0)}))},oe.onerror=function(){var Y=Qd[O];Y&&(Y.errored=!0,le(function(Z){return Z(Y),!0}))},document.body.appendChild(oe)},S.componentWillUnmount=function(){var I=this.__scriptURL;if(e.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),M=0;M<O.length;M+=1)O[M].src.indexOf(I)>-1&&O[M].parentNode&&O[M].parentNode.removeChild(O[M]);var L=Qd[I];L&&(delete L.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete Qd[I])},S.render=function(){var I=e.globalName,O=this.props;O.asyncScriptOnLoad;var M=O.forwardedRef,L=xze(O,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(L[I]=typeof window[I]<"u"?window[I]:void 0),L.ref=M,k.createElement(o,L)},E}(k.Component),f=k.forwardRef(function(_,E){return k.createElement(u,Nj({},_,{forwardedRef:E}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:En.func},ZIe(f,o)}}var Dj="onloadcallback",Vze="grecaptcha";function xj(){return typeof window<"u"&&window.recaptchaOptions||{}}function jze(){var n=xj(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+Dj+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+Dj+"&render=explicit"}const uae=Uze(jze,{callbackName:Dj,globalName:Vze,attributes:xj().nonce?{nonce:xj().nonce}:{}})(q1),Y1=(n,e="generic-modal")=>{k.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),$.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){$.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),$.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):$.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){$.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},dae=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[u,f]=k.useState((i==null?void 0:i.username)||""),[_,E]=k.useState((i==null?void 0:i.Nickname)||""),[S,C]=k.useState(!1),[I,O]=k.useState(null),[M,L]=k.useState(!1),U=Ua(),B=oe=>!(!oe||oe.trim()===""||!/^[a-z0-9]{1,15}$/.test(oe)),J=async oe=>{var se,le;if(!B(oe))return!oe||oe.trim()===""?O("Username cannot be empty"):O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),O(null);try{let Y=!1,Z=0;const X=3;for(;Z<X;)try{Y=await oR(oe);break}catch(ie){if($.error(`Attempt ${Z+1}: Error checking username:`,ie),Z++,Z>=X)throw ie;await new Promise(de=>setTimeout(de,1e3))}return Y?(O("Username is already taken"),!1):!0}catch(Y){return $.error("Error checking username after retries:",Y),Y.code==="permission-denied"||(se=Y.message)!=null&&se.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),Y.code==="permission-denied"||((le=Y.message)==null?void 0:le.includes("permissions"))}finally{C(!1)}};k.useEffect(()=>{if(!u){O("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const oe=setTimeout(async()=>{await J(u)},500);return()=>clearTimeout(oe)}},[u]),k.useEffect(()=>{if(i&&i.firstName&&i.lastName){const oe=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;E(oe)}},[i]);const K=async()=>{L(!0);try{if(!await J(u)){L(!1);return}if(_.length>15){O("Display Name must be at most 15 characters"),L(!1);return}td(_),$.log("UsernameConfirmation: Preparing to confirm user registration");const se=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",le={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:_||se,email:i.email,password:i.password};$.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(le).join(", ")),await o(le),e()}catch(oe){$.error("Error during username confirmation:",oe),U({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{L(!1)}},ne=()=>{M||e()};return b.jsxs(as,{isOpen:n,onClose:ne,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!M,closeOnEsc:!M,children:[b.jsx(ls,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),b.jsxs(cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[b.jsxs(so,{children:[b.jsx(XC,{size:"lg",mb:2,children:"Customize Your Profile"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),b.jsx(Rs,{color:"gray.400",isDisabled:M}),b.jsx(Es,{children:b.jsxs(Mr,{spacing:6,align:"stretch",children:[b.jsxs(mr,{isInvalid:!!I,children:[b.jsx(li,{children:"Username"}),b.jsxs(xg,{children:[b.jsx(r1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),b.jsx(ni,{placeholder:"username",value:u,onChange:oe=>f(oe.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?b.jsx(cp,{children:I}):b.jsx(Hy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),b.jsxs(mr,{children:[b.jsx(li,{children:"Nickname"}),b.jsx(ni,{placeholder:"Nickname",value:_,onChange:oe=>E(oe.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),b.jsx(Hy,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),b.jsx(oh,{children:b.jsxs(Ur,{gap:3,width:"100%",children:[b.jsx(Nn,{variant:"outline",onClick:ne,flex:"1",isDisabled:M,children:"Back"}),b.jsx(Nn,{colorScheme:"blue",onClick:K,isLoading:M||S,isDisabled:!!I||!u||M,flex:"2",children:"Finish"})]})})]})]})};dae.propTypes={isOpen:En.bool.isRequired,onClose:En.func.isRequired,userData:En.object.isRequired,onConfirm:En.func.isRequired,fullscreenRef:En.object};const Fze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function X1({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:u,handleSubmit:f,formState:{errors:_}}=lae(),{register:E}=k.useContext(us),S=Ua(),{fullscreenRef:C}=uh(),[I,O]=k.useState(!1),[M,L]=k.useState(!1),[U,B]=k.useState(null),J=k.useRef(null),[K,ne]=k.useState(!1),[oe,se]=k.useState(null),[le,Y]=k.useState(!1),Z=o!==void 0?o:I,X=l||(()=>O(!1));Y1(Z||K),k.useEffect(()=>{!Z&&J.current&&(J.current.reset(),B(null))},[Z]);const ie=xe=>{B(xe)},de=async xe=>{$.log("Register.jsx: Processing registration form submission");const{email:je,password:Oe,confirmPassword:we,...Se}=xe;if($.log("Register.jsx: Registration data fields:",Object.keys(Se).join(", ")),!U){S({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(Oe!==we){S({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}td(Se.firstName),td(Se.lastName),td(Se.companyName),L(!0);try{const Be=await I6e(Se.firstName||"",Se.lastName||""),Ee=Se.firstName&&Se.lastName?`${Se.firstName}${Se.lastName.charAt(0).toUpperCase()}`:"";Ee&&td(Ee),$.log("Register.jsx: Generated username and nickname for new user");const Ce={...Se,firstName:Se.firstName||"",lastName:Se.lastName||"",companyName:Se.companyName||"",linkedInProfile:Se.linkedInProfile||"",email:je,password:Oe,username:Be,Nickname:Ee,captchaToken:U};$.log("Register.jsx: Prepared registration data with fields:",Object.keys(Ce).join(", ")),se(Ce),ne(!0)}catch(Be){$.error("User: Registration Error:",Be);let Ee="An error occurred during registration. Please try again.",Ce=!1;Be.code==="auth/email-already-in-use"?(Ee="This email address is already registered. Please sign in instead.",Ce=!0):Be.code==="auth/invalid-email"?Ee="The email address is not valid. Please check and try again.":Be.code==="auth/weak-password"?Ee="The password is too weak. Please choose a stronger password.":Be.message&&(Ee=Be.message),S({title:"Registration Failed",description:b.jsxs(b.Fragment,{children:[Ee,Ce&&b.jsx(Ze,{mt:2,children:b.jsx(nu,{color:"blue.400",onClick:()=>{X(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{L(!1),J.current&&J.current.reset()}},ue=async xe=>{L(!0);try{$.log("Register.jsx: Completing registration with confirmed username");const{email:je,password:Oe,...we}=xe,Se={...we,firstName:we.firstName||"",lastName:we.lastName||"",companyName:we.companyName||"",linkedInProfile:we.linkedInProfile||"",username:we.username||"",Nickname:we.Nickname||""};$.log("Register.jsx: Final registration data includes fields:",Object.keys(Se).join(", "));const Be=await E(je,Oe,Se);X(),ne(!1),$.log("User: Registration process complete."),S({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),se(null),Y(!1)}catch(je){$.error("User: Registration Error during final step:",je);let Oe="An error occurred during registration. Please try again.";je.code==="auth/email-already-in-use"?Oe="This email address is already in use. Please try another one.":je.message&&(Oe=je.message),S({title:"Registration Failed",description:Oe,status:"error",duration:5e3,isClosable:!0,position:"top"}),ne(!1),se(null),Y(!1)}finally{L(!1)}},pe=()=>{l?l():O(!I)},ke=n==="link"?b.jsx(nu,{variant:"header",onClick:pe,children:e}):b.jsx(Nn,{onClick:pe,...i,children:e});return b.jsxs(b.Fragment,{children:[!o&&ke,b.jsxs(as,{isOpen:Z&&!K,onClose:X,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[b.jsx(ls,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),b.jsxs(cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[b.jsxs(so,{p:8,textAlign:"center",children:[b.jsx(XC,{size:"lg",mb:2,children:"Create Account"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),b.jsx(Rs,{color:"gray.400"}),b.jsx(Es,{px:8,children:b.jsx("form",{onSubmit:f(de),children:b.jsxs(Mr,{spacing:4,children:[b.jsxs(mr,{isInvalid:_.companyName,isRequired:!0,children:[b.jsx(ni,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:xe=>xe===""?"":xe})}),b.jsx(cp,{children:_.companyName&&_.companyName.message})]}),b.jsxs(Ur,{gap:4,w:"100%",children:[b.jsxs(mr,{isInvalid:_.firstName,isRequired:!0,children:[b.jsx(ni,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:xe=>xe===""?"":xe})}),b.jsx(cp,{children:_.firstName&&_.firstName.message})]}),b.jsxs(mr,{isInvalid:_.lastName,isRequired:!0,children:[b.jsx(ni,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:xe=>xe===""?"":xe})}),b.jsx(cp,{children:_.lastName&&_.lastName.message})]})]}),b.jsxs(mr,{isInvalid:_.email,isRequired:!0,children:[b.jsx(ni,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),b.jsx(cp,{children:_.email&&_.email.message})]}),b.jsxs(Ur,{gap:4,w:"100%",children:[b.jsxs(mr,{isInvalid:_.password,isRequired:!0,children:[b.jsx(ni,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),b.jsx(cp,{children:_.password&&_.password.message})]}),b.jsxs(mr,{isInvalid:_.confirmPassword,isRequired:!0,children:[b.jsx(ni,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),b.jsx(cp,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),b.jsx(mr,{children:b.jsx(ni,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:xe=>xe===""?"":xe})})}),b.jsx(lt,{width:"100%",display:"flex",justifyContent:"center",my:4,children:b.jsx(uae,{ref:J,sitekey:Fze,onChange:ie,theme:"dark"})})]})})}),b.jsxs(oh,{px:8,pb:8,flexDirection:"column",gap:4,children:[b.jsx(Nn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(de),isLoading:M,loadingText:"Processing",isDisabled:!U,children:"Next: Set Your Username"}),b.jsxs(Ze,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",b.jsx(nu,{color:"blue.400",onClick:()=>{X(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),K&&b.jsx(dae,{isOpen:K,onClose:()=>ne(!1),userData:oe,onConfirm:ue,fullscreenRef:C,isRegistering:le})]})}X1.propTypes={mode:En.oneOf(["button","link"]),label:En.string,buttonProps:En.object,isOpen:En.bool,onClose:En.func};const Bze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function J1({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l}=k.useContext(us),{fullscreenRef:u}=uh(),f=Ua(),{register:_,handleSubmit:E,formState:{errors:S}}=lae(),[C,I]=k.useState(!1),[O,M]=k.useState(o),[L,U]=k.useState(!1),[B,J]=k.useState(!1),[K,ne]=k.useState(""),[oe,se]=k.useState(!1),[le,Y]=k.useState(null),Z=k.useRef(null);Y1(O||B),k.useEffect(()=>{const je=()=>{M(!0)};return window.addEventListener("openSignInModal",je),()=>{window.removeEventListener("openSignInModal",je)}},[]);const X=je=>{Y(je)},ie=async je=>{if(!le){f({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l(je.email,je.password,le),$.log("User: Sign-in process complete."),M(!1),window.location.reload()}catch(Oe){$.error("User: SignIn Error:",Oe);const we=Oe.message||"An error occurred while logging in. Please check your credentials.",Se=we.includes("verify your email");f({title:Se?"Email Verification Required":"Error",description:we,status:Se?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:u.current})}finally{I(!1),Z.current&&Z.current.reset()}},de=async()=>{if(!K){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:u.current});return}try{se(!0),await RFe(v3,K),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:u.current}),J(!1)}catch(je){$.error("User: Reset Password Error:",je),f({title:"Error",description:je.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:u.current})}finally{se(!1)}},ue=()=>M(je=>!je),pe=()=>{M(!1),U(!0)},ke=()=>{J(!0)},xe=n==="link"?b.jsx(nu,{variant:"header",onClick:ue,children:e}):b.jsx(Nn,{onClick:ue,...i,children:e});return b.jsxs(b.Fragment,{children:[xe,b.jsxs(as,{isOpen:O,onClose:ue,size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[b.jsx(ls,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),b.jsx("form",{onSubmit:E(ie),children:b.jsxs(cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:je=>{je.stopPropagation()},children:[b.jsxs(so,{p:8,textAlign:"center",children:[b.jsx(XC,{size:"lg",mb:2,children:"Welcome Back"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),b.jsx(Rs,{color:"gray.400"}),b.jsx(Es,{px:8,pb:8,children:b.jsxs(Mr,{spacing:4,children:[b.jsxs(mr,{isInvalid:S.email,children:[b.jsxs(xg,{children:[b.jsx(bC,{pointerEvents:"none",children:b.jsx(IQ,{color:"gray.500"})}),b.jsx(ni,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),b.jsx(cp,{children:S.email&&S.email.message})]}),b.jsxs(mr,{isInvalid:S.password,children:[b.jsxs(xg,{children:[b.jsx(bC,{pointerEvents:"none",children:b.jsx(aze,{color:"gray.500"})}),b.jsx(ni,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),b.jsx(cp,{children:S.password&&S.password.message})]}),b.jsx(lt,{alignSelf:"flex-end",children:b.jsx(nu,{color:"blue.400",fontSize:"sm",onClick:ke,children:"Forgot Password?"})}),b.jsx(Ur,{width:"100%",justifyContent:"center",my:4,children:b.jsx(uae,{ref:Z,sitekey:Bze,onChange:X,theme:"dark"})})]})}),b.jsxs(oh,{px:8,pb:8,flexDirection:"column",gap:4,children:[b.jsx(Nn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!le,children:"Sign In"}),b.jsxs(Ze,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",b.jsx(nu,{color:"blue.400",onClick:pe,children:"Sign Up"})]})]})]})})]}),b.jsxs(as,{isOpen:B,onClose:()=>J(!1),size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[b.jsx(ls,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),b.jsxs(cs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:je=>{je.stopPropagation()},children:[b.jsxs(so,{p:8,textAlign:"center",children:[b.jsx(XC,{size:"lg",mb:2,children:"Reset Password"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),b.jsx(Rs,{color:"gray.400"}),b.jsx(Es,{px:8,pb:4,children:b.jsx(mr,{children:b.jsxs(xg,{children:[b.jsx(bC,{pointerEvents:"none",children:b.jsx(IQ,{color:"gray.500"})}),b.jsx(ni,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:K,onChange:je=>ne(je.target.value)})]})})}),b.jsxs(oh,{px:8,pb:8,flexDirection:"column",gap:4,children:[b.jsx(Nn,{colorScheme:"blue",size:"lg",width:"100%",onClick:de,isLoading:oe,loadingText:"Sending",children:"Send Reset Link"}),b.jsxs(Ze,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",b.jsx(nu,{color:"blue.400",onClick:()=>J(!1),children:"Back to Sign In"})]})]})]})]}),b.jsx(X1,{mode:"link",isOpen:L,onClose:()=>U(!1)})]})}J1.propTypes={mode:En.oneOf(["button","link"]),label:En.string,buttonProps:En.object,initialIsOpen:En.bool};function M3({mode:n="button",label:e="Sign Out"}){const i=Ua(),{signOut:o}=k.useContext(us),{fullscreenRef:l}=uh(),u=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?b.jsx(nu,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return b.jsx(b.Fragment,{children:f})}M3.propTypes={mode:En.oneOf(["button","link"]),label:En.string};const q0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,U3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=o.target.closest("canvas")||o.target.closest("#webgl-root"),_=document.activeElement===u;!l&&(f||_)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},hae=()=>{document.body.classList.remove("unity-focused")};function xN(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?U3():hae(),new Promise(e=>{try{const i=q0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(o){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",o)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(o){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",o)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),Lj(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function Lj(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=q0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(u){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",u);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${u}ms`),window.__unityInstancePoller=setTimeout(o,u)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(o,500)}function Wze(){const n=q0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function i0(n=!0){return console.log("Focusing Unity canvas"),n?U3():hae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){xN(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function Lf(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),U3(),new Promise(e=>{try{if(n)xN(!1).then(i=>{var u;i&&console.log("Successfully disabled Unity keyboard capture");const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=q0();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=q0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),xN(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function zze(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Failed to apply pending keyboard state with fallback method",o)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function Gze(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=xN,window.focusUnity=i0,window.blockUnityKeyboardInput=Lf,window.hasUnityKeyboardFocus=Wze,window.getUnityInstance=q0,window.registerUnityInstance=zze,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),Lj(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),Lj(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),Lf(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),Lf(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),Lf(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(Gze,0);const Hze=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,u]=k.useState(!1),[f,_]=k.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,S]=k.useState(!1),[C,I]=k.useState(!1),[O,M]=k.useState(""),[L,U]=k.useState(!1),B=Ua(),{sendUserToUnity:J,updateUser:K}=k.useContext(us),ne=k.useRef(null);k.useEffect(()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),k.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),Lf(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),Lf(!1).then(()=>{setTimeout(()=>{i0(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),Lf(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),k.useEffect(()=>{if(l&&ne.current){const X=()=>{ne.current.focus(),I(!0),Lf(!0)};X();const ie=setTimeout(X,100),de=setTimeout(X,300);return()=>{clearTimeout(ie),clearTimeout(de)}}else I(!1)},[l]),k.useEffect(()=>{const ie=setTimeout(async()=>{if(f.username&&f.username!==(i==null?void 0:i.username)){U(!0),M("");try{if(!/^[a-z0-9]{1,15}$/.test(f.username)){M("Username must be 1-15 characters, lowercase letters and numbers only"),U(!1);return}td(f.username),await oR(f.username)&&M("Username is already taken")}catch(de){$.error("Error checking username:",de),M("Error checking username availability")}finally{U(!1)}}},500);return()=>clearTimeout(ie)},[f.username,i==null?void 0:i.username]);const oe=()=>{u(!1),I(!1),e()},se=X=>{const{name:ie,value:de}=X.target;if(ie==="username"){const ue=de.toLowerCase().replace(/[^a-z0-9]/g,"");_(pe=>({...pe,[ie]:ue}))}else _(ue=>({...ue,[ie]:de}))},le=async()=>{if(f.Nickname.trim()===""){B({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if(td(f.Nickname),f.firstName&&td(f.firstName),f.lastName&&td(f.lastName),f.companyName&&td(f.companyName),O){B({title:"Error",description:O,status:"error",duration:3e3,isClosable:!0});return}S(!0);try{if(f.username!==i.username&&(td(f.username),await oR(f.username))){M("Username is already taken"),B({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),S(!1);return}const X=gr(Hn,"users",i.uid);if(f.username!==i.username)try{if($.log("ProfileModal: Updating username from",i.username,"to",f.username),!await O6e(i.uid,f.username))throw new Error("Failed to update username");$.log("ProfileModal: Username updated successfully")}catch(ie){$.error("Error updating username:",ie),B({title:"Error",description:"Failed to update username: "+(ie.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),S(!1);return}$.log("ProfileModal: Updating user profile");try{const ie={Nickname:f.Nickname,companyName:f.companyName,firstName:f.firstName,lastName:f.lastName,linkedInProfile:f.linkedInProfile,username:f.username,lastUpdated:new Date().toISOString()};await oo(X,ie),$.log("ProfileModal: Profile updated successfully");const de=Ioe(X,ue=>{if(ue.exists()&&ue.data().Nickname===f.Nickname){try{J()}catch(ke){$.error("Error sending user to Unity:",ke)}de()}},ue=>{$.error("Error in profile update listener:",ue)});try{await K()}catch(ue){$.error("Error updating user context:",ue)}_({Nickname:f.Nickname,username:f.username,companyName:f.companyName,firstName:f.firstName,lastName:f.lastName,linkedInProfile:f.linkedInProfile}),B({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),u(!1)}catch(ie){$.error("Error updating profile data:",ie),B({title:"Error",description:"Failed to update profile: "+(ie.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(X){$.error("Error in handleSave:",X),B({title:"Error",description:"An unexpected error occurred: "+(X.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{S(!1)}},Y=()=>b.jsxs(Mr,{spacing:4,align:"stretch",w:"100%",children:[b.jsxs(Ur,{direction:"column",align:"center",gap:2,children:[b.jsx(Ze,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),b.jsxs(Ze,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),b.jsxs(Mr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[b.jsxs(Ur,{direction:"column",children:[b.jsx(Ze,{color:"gray.400",fontSize:"sm",children:"Company"}),b.jsx(Ze,{children:i.companyName||"Not specified"})]}),b.jsxs(Ur,{direction:"column",children:[b.jsx(Ze,{color:"gray.400",fontSize:"sm",children:"Full Name"}),b.jsx(Ze,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),b.jsxs(Ur,{direction:"column",children:[b.jsx(Ze,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),b.jsx(Ze,{children:i.linkedInProfile||"Not specified"})]})]}),b.jsx(Nn,{onClick:()=>u(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),Z=()=>b.jsxs(Mr,{spacing:4,align:"stretch",w:"100%",children:[b.jsxs(mr,{children:[b.jsx(li,{color:"gray.400",fontSize:"sm",children:"Display Name"}),b.jsx(ni,{ref:ne,name:"Nickname",value:f.Nickname,onChange:se,onFocus:()=>{I(!0),Lf(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),b.jsxs(mr,{isInvalid:!!O,children:[b.jsx(li,{color:"gray.400",fontSize:"sm",children:"Username"}),b.jsxs(xg,{children:[b.jsx(r1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),b.jsx(ni,{name:"username",value:f.username,onChange:se,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:L})]}),O&&b.jsx(Ze,{color:"red.400",fontSize:"sm",mt:1,children:O}),b.jsx(Hy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),b.jsxs(mr,{children:[b.jsx(li,{color:"gray.400",fontSize:"sm",children:"Company Name"}),b.jsx(ni,{name:"companyName",value:f.companyName,onChange:se,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(Ur,{gap:4,children:[b.jsxs(mr,{children:[b.jsx(li,{color:"gray.400",fontSize:"sm",children:"First Name"}),b.jsx(ni,{name:"firstName",value:f.firstName,onChange:se,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(mr,{children:[b.jsx(li,{color:"gray.400",fontSize:"sm",children:"Last Name"}),b.jsx(ni,{name:"lastName",value:f.lastName,onChange:se,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),b.jsxs(mr,{children:[b.jsx(li,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),b.jsx(ni,{name:"linkedInProfile",value:f.linkedInProfile,onChange:se,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(Ur,{gap:2,justify:"flex-end",mt:2,children:[b.jsx(Nn,{onClick:()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),u(!1),M("")},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),b.jsx(Nn,{onClick:le,colorScheme:"blue",size:"sm",isLoading:E||L,isDisabled:!!O||L,children:"Save Changes"})]})]});return b.jsxs(as,{isOpen:n,onClose:oe,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[b.jsx(ls,{backdropFilter:"blur(10px)"}),b.jsxs(cs,{bg:"gray.800",color:"white",children:[b.jsx(so,{children:"Profile"}),b.jsx(Rs,{}),b.jsx(Es,{pb:6,children:b.jsxs(Mr,{spacing:6,children:[b.jsx(wl,{src:o,size:"2xl",borderRadius:"full"}),l?Z():Y(),!l&&b.jsx(Nn,{variant:"ghost",size:"sm",colorScheme:"blue",width:"100%",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Visit Support Site"})]})})]})]})},ik={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},pae=()=>{var C;const{user:n,updateUser:e}=k.useContext(us),[i,o]=k.useState(!0),{isOpen:l,onOpen:u,onClose:f}=ld();k.useEffect(()=>{const I=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(I)},[]);const _=()=>{f(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,S=(C=n==null?void 0:n.groups)==null?void 0:C.includes("disruptiveAdmin");return i?null:b.jsx(Ur,{align:"center",gap:"4",children:n?b.jsxs(b.Fragment,{children:[b.jsx(Hze,{isOpen:l,onClose:_,user:n,profileImageUrl:E}),b.jsxs(wR,{children:[b.jsx(CR,{as:lt,cursor:"pointer",children:b.jsx(Ur,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:b.jsxs(Ur,{align:"center",gap:"3",children:[b.jsx(lt,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:b.jsx(wl,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),b.jsx(Ze,{color:"white",fontWeight:"medium",children:n.Nickname}),b.jsx(lt,{display:"flex",alignItems:"center",height:"28px",children:b.jsx(eae,{color:"white",w:4,h:4})})]})})}),b.jsx(hu,{children:b.jsxs(RR,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[b.jsxs(lt,{p:4,display:"flex",alignItems:"center",gap:3,children:[b.jsx(wl,{src:E,size:"md",borderRadius:"full"}),b.jsx(Ze,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),b.jsx(Kf,{borderColor:"gray.700"}),S&&b.jsx(dp,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),b.jsx(dp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),b.jsx(dp,{onClick:u,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),b.jsx(Kf,{borderColor:"gray.700"}),b.jsx(dp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),b.jsx(dp,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:b.jsx(M3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):b.jsxs(b.Fragment,{children:[b.jsx(X1,{mode:"button",label:"Register",buttonProps:{...ik,width:["100%","auto"]},customButton:b.jsxs(Nn,{...ik,children:[b.jsx(lt,{as:"span",fontSize:"xl",children:""}),"Register"]})}),b.jsx(J1,{mode:"button",label:"Sign In",buttonProps:{...ik,width:["100%","auto"]},customButton:b.jsxs(Nn,{...ik,children:[b.jsx(lt,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},$ze=()=>{const{registrationInProgress:n}=ize();return n?b.jsxs(as,{isOpen:!0,onClose:()=>{},closeOnEsc:!1,closeOnOverlayClick:!1,isCentered:!0,motionPreset:"none",size:"full",children:[b.jsx(ls,{bg:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"}),b.jsx(cs,{bg:"transparent",boxShadow:"none",maxW:"100%",maxH:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:b.jsxs(Ur,{direction:"column",align:"center",justify:"center",p:8,maxW:"md",textAlign:"center",children:[b.jsx(hd,{size:"xl",thickness:"4px",speed:"0.8s",color:"blue.400",mb:6}),b.jsx(Ze,{fontSize:"2xl",fontWeight:"bold",color:"white",mb:4,children:"Creating Your Account"}),b.jsx(Ze,{fontSize:"md",color:"gray.300",mb:3,children:"Please wait while we set up your profile with Spaces Metaverse"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",mb:1,children:"This typically takes 5-10 seconds to complete"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Please do not refresh or close this page"})]})})]}):null},qU=document.getElementById("header-auth-root");if(qU){const n=qU.getAttribute("data-theme")||"default",e=()=>{const[i,o]=k.useState(null);return k.useEffect(()=>{JC(n).then(o)},[]),i?b.jsx(n1,{theme:i,children:b.jsx($1,{children:b.jsxs(k3,{children:[b.jsx(pae,{}),b.jsx($ze,{})]})})}):b.jsx("div",{children:"Loading theme..."})};MN.createRoot(qU).render(b.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var YU={},Lw={},Mw={},VQ;function Kze(){if(VQ)return Mw;VQ=1,Object.defineProperty(Mw,"__esModule",{value:!0}),Mw.useUnityCanvasId=void 0;var n=cd(),e=0,i="react-unity-webgl-canvas",o=function(l){if(l.id!==void 0)return l.id;var u=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return u};return Mw.useUnityCanvasId=o,Mw}var Of={},Uw={},jQ;function fae(){if(jQ)return Uw;jQ=1,Object.defineProperty(Uw,"__esModule",{value:!0}),Uw.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(Uw.UnityLoaderStatus=n={})),Uw}var Vw={},FQ;function V3(){return FQ||(FQ=1,Object.defineProperty(Vw,"__esModule",{value:!0}),Vw.isBrowserEnvironment=void 0,Vw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Vw}var BQ;function qze(){if(BQ)return Of;BQ=1;var n=Of&&Of.__awaiter||function(f,_,E,S){function C(I){return I instanceof E?I:new E(function(O){O(I)})}return new(E||(E=Promise))(function(I,O){function M(B){try{U(S.next(B))}catch(J){O(J)}}function L(B){try{U(S.throw(B))}catch(J){O(J)}}function U(B){B.done?I(B.value):C(B.value).then(M,L)}U((S=S.apply(f,_||[])).next())})},e=Of&&Of.__generator||function(f,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},S,C,I,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=M(0),O.throw=M(1),O.return=M(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function M(U){return function(B){return L([U,B])}}function L(U){if(S)throw new TypeError("Generator is already executing.");for(;O&&(O=0,U[0]&&(E=0)),E;)try{if(S=1,C&&(I=U[0]&2?C.return:U[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,U[1])).done)return I;switch(C=0,I&&(U=[U[0]&2,I.value]),U[0]){case 0:case 1:I=U;break;case 4:return E.label++,{value:U[1],done:!1};case 5:E.label++,C=U[1],U=[0];continue;case 7:U=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(U[0]===6||U[0]===2)){E=0;continue}if(U[0]===3&&(!I||U[1]>I[0]&&U[1]<I[3])){E.label=U[1];break}if(U[0]===6&&E.label<I[1]){E.label=I[1],I=U;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(U);break}I[2]&&E.ops.pop(),E.trys.pop();continue}U=_.call(f,E)}catch(B){U=[6,B],C=0}finally{S=I=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}};Object.defineProperty(Of,"__esModule",{value:!0}),Of.useUnityInstance=void 0;var i=cd(),o=fae(),l=V3(),u=function(f,_,E,S){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var C,I;return e(this,function(O){switch(O.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==o.UnityLoaderStatus.Loaded||_===null)return S.setUnityInstance(null),S.setInitialisationError(null),[2];O.label=1;case 1:return O.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,S.setLoadingProgression)];case 2:return C=O.sent(),S.setUnityInstance(C),S.setInitialisationError(null),[3,4];case 3:return I=O.sent(),S.setUnityInstance(null),S.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,_,E,S])};return Of.useUnityInstance=u,Of}var jw={},WQ;function Yze(){if(WQ)return jw;WQ=1,Object.defineProperty(jw,"__esModule",{value:!0}),jw.useUnityArguments=void 0;var n=cd(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(o){},printErr:function(o){}}},[])};return jw.useUnityArguments=e,jw}var Fw={},zQ;function Xze(){if(zQ)return Fw;zQ=1,Object.defineProperty(Fw,"__esModule",{value:!0}),Fw.useUnityLoader=void 0;var n=cd(),e=V3(),i=fae(),o=function(l){var u=(0,n.useState)(i.UnityLoaderStatus.Loading),f=u[0],_=u[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var S=function(C){return _(C.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",S),E.addEventListener("error",S),function(){E!==null&&(E.removeEventListener("load",S),E.removeEventListener("error",S),window.document.body.removeChild(E))}}},[l.loaderUrl]),f};return Fw.useUnityLoader=o,Fw}var GQ;function Jze(){if(GQ)return Lw;GQ=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.Unity=void 0;var n=cd(),e=cd(),i=Kze(),o=qze(),l=Yze(),u=Xze(),f=(0,e.forwardRef)(function(_,E){var S=(0,e.useRef)(null),C=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),O=(0,u.useUnityLoader)(_.unityProvider.unityConfig);return(0,o.useUnityInstance)(O,S.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return S.current}),(0,n.createElement)("canvas",{ref:S,id:C,style:_.style,className:_.className,tabIndex:_.tabIndex})});return Lw.Unity=f,Lw}var kf={},Bw={},HQ;function mae(){if(HQ)return Bw;HQ=1,Object.defineProperty(Bw,"__esModule",{value:!0}),Bw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Bw.errorMessages=n,Bw}var Cy={},$Q;function Qze(){if($Q)return Cy;$Q=1;var n=Cy&&Cy.__spreadArray||function(_,E,S){if(S||arguments.length===2)for(var C=0,I=E.length,O;C<I;C++)(O||!(C in E))&&(O||(O=Array.prototype.slice.call(E,0,C)),O[C]=E[C]);return _.concat(O||Array.prototype.slice.call(E))};Object.defineProperty(Cy,"__esModule",{value:!0}),Cy.useEventSystem=void 0;var e=cd(),i=mae(),o=V3(),l=[],u=function(_){for(var E=[],S=1;S<arguments.length;S++)E[S-1]=arguments[S];var C=void 0;return l.forEach(function(I){C=I.apply(void 0,n([_],E,!1))}),C};o.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=u);var f=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,O){_.current=n(n([],_.current,!0),[{eventName:I,callback:O}],!1)},[_]),S=(0,e.useCallback)(function(I,O){_.current=_.current.filter(function(M){return M.eventName!==I&&M.callback!==O})},[_]),C=(0,e.useCallback)(function(I){for(var O=[],M=1;M<arguments.length;M++)O[M-1]=arguments[M];var L=_.current.find(function(U){return U.eventName===I});if(typeof L>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return L.callback.apply(L,O)},[_]);return(0,e.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:E,removeEventListener:S}};return Cy.useEventSystem=f,Cy}var Ww={},KQ;function Zze(){if(KQ)return Ww;KQ=1,Object.defineProperty(Ww,"__esModule",{value:!0}),Ww.useNullableState=void 0;var n=cd(),e=function(i){return(0,n.useState)(i||null)};return Ww.useNullableState=e,Ww}var qQ;function e8e(){if(qQ)return kf;qQ=1;var n=kf&&kf.__awaiter||function(_,E,S,C){function I(O){return O instanceof S?O:new S(function(M){M(O)})}return new(S||(S=Promise))(function(O,M){function L(J){try{B(C.next(J))}catch(K){M(K)}}function U(J){try{B(C.throw(J))}catch(K){M(K)}}function B(J){J.done?O(J.value):I(J.value).then(L,U)}B((C=C.apply(_,E||[])).next())})},e=kf&&kf.__generator||function(_,E){var S={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},C,I,O,M=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return M.next=L(0),M.throw=L(1),M.return=L(2),typeof Symbol=="function"&&(M[Symbol.iterator]=function(){return this}),M;function L(B){return function(J){return U([B,J])}}function U(B){if(C)throw new TypeError("Generator is already executing.");for(;M&&(M=0,B[0]&&(S=0)),S;)try{if(C=1,I&&(O=B[0]&2?I.return:B[0]?I.throw||((O=I.return)&&O.call(I),0):I.next)&&!(O=O.call(I,B[1])).done)return O;switch(I=0,O&&(B=[B[0]&2,O.value]),B[0]){case 0:case 1:O=B;break;case 4:return S.label++,{value:B[1],done:!1};case 5:S.label++,I=B[1],B=[0];continue;case 7:B=S.ops.pop(),S.trys.pop();continue;default:if(O=S.trys,!(O=O.length>0&&O[O.length-1])&&(B[0]===6||B[0]===2)){S=0;continue}if(B[0]===3&&(!O||B[1]>O[0]&&B[1]<O[3])){S.label=B[1];break}if(B[0]===6&&S.label<O[1]){S.label=O[1],O=B;break}if(O&&S.label<O[2]){S.label=O[2],S.ops.push(B);break}O[2]&&S.ops.pop(),S.trys.pop();continue}B=E.call(_,S)}catch(J){B=[6,J],I=0}finally{C=O=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(kf,"__esModule",{value:!0}),kf.useUnityContext=void 0;var i=cd(),o=mae(),l=Qze(),u=Zze(),f=function(_){var E=(0,u.useNullableState)(),S=E[0],C=E[1],I=(0,i.useState)(0),O=I[0],M=I[1],L=(0,i.useState)(!1),U=L[0],B=L[1],J=(0,u.useNullableState)(),K=J[0],ne=J[1],oe=(0,l.useEventSystem)(),se=(0,i.useRef)({setLoadingProgression:M,setInitialisationError:ne,setUnityInstance:C,setIsLoaded:B,unityConfig:_}),le=(0,i.useCallback)(function(ue){if(S===null){console.warn(o.errorMessages.requestFullscreenNoUnityInstance);return}S.SetFullscreen(ue===!0?1:0)},[S]),Y=(0,i.useCallback)(function(){if(S===null||typeof S.Module.canvas>"u"){console.warn(o.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return S.Module.canvas.requestPointerLock()},[S]),Z=(0,i.useCallback)(function(ue,pe,ke){if(S===null){console.warn(o.errorMessages.sendMessageNoUnityInstance);return}S.SendMessage(ue,pe,ke)},[S]),X=(0,i.useCallback)(function(ue,pe){if(S===null||typeof S.Module.canvas>"u"){console.warn(o.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return S.Module.canvas.toDataURL(ue,pe)},[S]),ie=(0,i.useCallback)(function(){return S===null?(console.warn(o.errorMessages.quitNoUnityInstance),Promise.reject()):S.Quit()},[S]),de=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var ue;return e(this,function(pe){switch(pe.label){case 0:return S===null||typeof S.Module.canvas>"u"?(console.warn(o.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(ue=S.Module.canvas,document.body.appendChild(ue),ue.style.display="none",[4,ie()]);case 1:return pe.sent(),ue.remove(),[2]}})})},[S]);return(0,i.useEffect)(function(){B(O===1)},[O]),{unityProvider:se.current,loadingProgression:O,initialisationError:K,isLoaded:U,UNSAFE__unityInstance:S,requestFullscreen:le,requestPointerLock:Y,sendMessage:Z,takeScreenshot:X,unload:ie,UNSAFE__detachAndUnloadImmediate:de,addEventListener:oe.addEventListener,removeEventListener:oe.removeEventListener}};return kf.useUnityContext=f,kf}var YQ;function t8e(){return YQ||(YQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=Jze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=e8e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(YU)),YU}var gae=t8e();const Zd="[UnityProvider]",Mj=k.createContext(),n8e=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u,loadingBackground:f,showLoginButton:_,showDisruptiveLogo:E})=>{$.log(`${Zd} Initializing with spaceID:`,n),$.log(`${Zd} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u});const{unityProvider:S,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:M,removeEventListener:L,error:U}=gae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u}),B={unityProvider:S,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:M,removeEventListener:L,error:U,spaceID:n},J=k.useRef(null),K=k.useRef(Date.now());k.useEffect(()=>{const le=()=>{document.hidden?($.log(`${Zd} Page hidden, starting keep-alive`),ne()):($.log(`${Zd} Page visible, stopping keep-alive`),oe())};return document.addEventListener("visibilitychange",le),()=>{document.removeEventListener("visibilitychange",le),oe()}},[]),k.useEffect(()=>{const le=()=>{K.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",le),window.addEventListener("keydown",le),window.addEventListener("touchstart",le),()=>{window.removeEventListener("mousemove",le),window.removeEventListener("keydown",le),window.removeEventListener("touchstart",le)}},[O]);const ne=()=>{J.current||(J.current=setInterval(()=>{I&&document.hidden&&(O("WebGLInputManager","KeepAlive"),$.debug(`${Zd} Sent keep-alive message`))},1e4))},oe=()=>{J.current&&(clearInterval(J.current),J.current=null)};k.useEffect(()=>($.log(`${Zd} Component mounted`),()=>{$.log(`${Zd} Component unmounting`),oe()}),[]),k.useEffect(()=>{$.log(`${Zd} Loading progress:`,C)},[C]),k.useEffect(()=>{I&&($.log(`${Zd} Unity instance loaded for:`,n),document.hidden&&ne())},[I,n]),k.useEffect(()=>{U&&$.error(`${Zd} Unity error:`,U)},[U]),$.log(`${Zd} Rendering provider with instance:`,B),k.useEffect(()=>{$.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u})},[i,o,l,u]);const se=[];if(i||se.push("loaderUrl"),o||se.push("dataUrl"),l||se.push("frameworkUrl"),u||se.push("codeUrl"),se.length>0)return $.error(`UnityProvider: Missing required Unity build URLs: ${se.join(", ")}`),b.jsx(Mj.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${se.join(", ")}`),spaceID:n},children:e});try{return k.useEffect(()=>{$.log("UnityProvider: Unity context created:",S),S?$.log("UnityProvider: Unity provider is available"):$.error("UnityProvider: Unity provider is not available"),I?$.log("UnityProvider: Unity is loaded"):$.log("UnityProvider: Unity is not loaded yet")},[S,I]),b.jsx(Mj.Provider,{value:B,children:e})}catch(le){return $.error("UnityProvider: Error creating Unity context:",le),b.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[b.jsx("h3",{children:"Unity Error"}),b.jsxs("p",{children:["Error creating Unity context: ",le.message]}),b.jsx("p",{children:"Please check the console for more details."})]})}},Vo=()=>k.useContext(Mj),Uc=()=>{const{sendMessage:n,isLoaded:e}=Vo(),i=k.useRef([]),o=k.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:f}=i.current.shift();$.log("useSendUnityEvent: Processing queued event to Unity:",u,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(f)}))}catch(_){$.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:u,data:f});break}}},[n,e]);return k.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),k.useCallback((u,f)=>{$.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:f}),o()},[o])},Vc=()=>{const{addEventListener:n,removeEventListener:e}=Vo();return k.useCallback((i,o)=>{const l=u=>{$.log(i+" unity message received.");let f=null;if(u)try{f=JSON.parse(u)}catch(_){$.warn("Failed to parse JSON data from Unity message:",_)}o(f)};return n(i,l),()=>{e(i,l)}},[n,e])},_ae=()=>{const[n,e]=k.useState({}),[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,_]=k.useState(0),E=Uc(),S=Vc(),{spaceID:C,sendMessage:I,isLoaded:O}=Vo(),M=k.useCallback((J,K)=>{if(!J)return;$.log(`useHLSStream: Sending stream URL to Unity: ${J} for player ${K}`);const ne={identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:J};if(E("SetHLSStream",ne),O&&I)try{$.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ne)})),$.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:J})),$.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",J),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:K.toString(),Url:J}))}catch(oe){$.error("useHLSStream: Error with direct message:",oe)}else $.warn("useHLSStream: Unity not loaded, could not send direct message")},[E,I,O]);k.useEffect(()=>{C&&L(C)},[C]);const L=async J=>{try{if(!J){$.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),$.log(`useHLSStream: Loading stream from Firebase for space ${J}`);const K=await Joe(J);if(K&&K.streamUrl)if($.log(`useHLSStream: Loaded stream data from Firebase for space ${J}`,K),u(K),O)$.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{M(K.streamUrl,K.playerIndex||"0")},500),setTimeout(()=>{$.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),M(K.streamUrl,K.playerIndex||"0")},2e3);else{$.warn("useHLSStream: Unity is not loaded yet, will try again later");const ne=setInterval(()=>{O&&($.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),M(K.streamUrl,K.playerIndex||"0"),clearInterval(ne))},1e3);setTimeout(()=>{clearInterval(ne)},3e4)}else $.log(`useHLSStream: No saved stream found for space ${J}`),u(null)}catch(K){$.error(`useHLSStream: Error loading stream from Firebase for space ${J}`,K)}finally{o(!1)}},U=k.useCallback(async()=>{C&&($.log(`useHLSStream: Forcing reload of stream data for space ${C}`),_(J=>J+1),await L(C))},[C]),B=k.useCallback(async(J,K=0,ne={})=>{try{if(!J||!J.trim()){$.error("useHLSStream: Invalid stream URL");return}o(!0),$.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${K}]`,J);const{enabled:oe=!0,rtmpUrl:se="",streamKey:le="",skipSendToUnity:Y=!1}=ne;if(Y||M(J,K),C)try{const Z={streamUrl:J,playerIndex:K.toString(),enabled:oe,rtmpUrl:se,streamKey:le,updatedAt:new Date().toISOString()};$.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,Z),await Aj(C,Z),u(Z)}catch(Z){throw $.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,Z),Z}else $.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[M,C]);return k.useEffect(()=>{const K=S("SetHLSStream",ne=>{if(ne)try{$.log("useHLSStream: Received player status update",ne);const{identifier:oe,playerIndex:se,isReady:le,isPlaying:Y}=ne,Z=`${oe}_${se}`;e(X=>({...X,[Z]:{identifier:oe,playerIndex:se,isReady:le,isPlaying:Y}}))}catch(oe){$.error("useHLSStream: Error handling player status update",oe)}});return()=>{K()}},[S]),k.useEffect(()=>{if(l&&l.streamUrl){$.log("useHLSStream: Resending saved stream URL to Unity");const J=setTimeout(()=>{M(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(J)}},[l,n,M,f]),k.useEffect(()=>{const J=K=>{if(K.detail){if($.log("useHLSStream: Received stream update event",K.detail),C===K.detail.spaceId)$.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),L(C);else if(K.detail.streamUrl){$.log(`useHLSStream: Using stream URL directly from event: ${K.detail.streamUrl}`);const ne=K.detail.playerIndex||"0";M(K.detail.streamUrl,ne),u(K.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",J),window.addEventListener("SpaceStreamUpdated",J),()=>{window.removeEventListener("SpaceHLSStreamUpdated",J),window.removeEventListener("SpaceStreamUpdated",J)}},[C,M]),{setHLSStreamUrl:B,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:U}},r8e=()=>{const[n,e]=k.useState(!1),i=Vc();return k.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{$.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},i8e=()=>{const[n,e]=k.useState(null),i=Vc();return console.log(" Nameplate click hook initialized"),k.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof f=="string"?JSON.parse(f):f;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},s8e=()=>{const n=Vc(),{sendUserToUnity:e}=k.useContext(us);return k.useEffect(()=>{const o=n("RequestUserForUnity",()=>{$.log("React: Request from Unity to send user data"),e()});return()=>{o()}},[n,e]),!0},XQ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:f=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=mE(),S=Date.now(),C=i.name.split(".").pop(),I=`${e}_${S}.${C}`,O=fE(E,`spaces/${n}/mediaScreens/${I}`);$.log(`Uploading image for media screen ${e} in space ${n}`);const M=await A3(O,i);_=await H1(M.ref);const L=gr(Hn,`spaces/${n}/mediaScreens`,e);await Yg(L,{imageUrl:_,gsUrl:`gs://${M.ref.bucket}/${M.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){_=f;const E=gr(Hn,`spaces/${n}/mediaScreens`,e);await Yg(E,{videoUrl:f,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return $.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),_}catch(l){throw $.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},j3=async n=>{$.log(`Getting media screen images for space: ${n}`);try{const e=Al(Hn,`spaces/${n}/mediaScreens`),i=await od(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw $.error("Error fetching media screen images from Firestore:",e),e}},Ff=async(n,e)=>{try{const i=gr(Hn,`spaces/${n}/mediaScreens`,e),o=await Uo(i);return o.exists()?{id:o.id,...o.data()}:($.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw $.error("Error fetching media screen image:",i),i}},o8e=async(n,e)=>{try{const i=await Ff(n,e);if(!i)return $.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=mE(),u=fE(l,i.gsUrl);try{await P3(u),$.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){$.warn(`Could not delete file from storage: ${f.message}`)}}const o=gr(Hn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await oo(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),$.log(`Successfully removed video for media screen ${e}`)):(await oo(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),$.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw $.error("Error deleting media screen image:",i),i}},a8e=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await Ff(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return $.warn(`No media screen content found with ID: ${e} to update`),!1;const l=gr(Hn,`spaces/${n}/mediaScreens`,e);return await oo(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),$.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw $.error("Error updating media screen display mode:",o),o}},c8e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},yae=()=>{const{spaceID:n}=Vo(),e=Uc(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{$.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){$.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}$.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await j3(n);$.log("Fetched Media Screen Images",u),u.forEach(f=>{const{id:_,imageUrl:E,displayAsVideo:S,videoUrl:C}=f;let I=null;(!S||!C)&&(I=E?c8e(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:C||null,displayAsVideo:S||!1,timestamp:Date.now()}),$.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${S})`),S&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),$.log(`Set display mode to video for screen ${_}`))})}catch(u){$.error("Error fetching media screen images:",u)}})()},[e,n,i])},l8e=()=>{const{spaceID:n}=Vo(),e=Uc(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{$.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){$.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}$.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await Xoe(n),f=async S=>{const C=`https://vimeo.com/api/oembed.json?url=${S}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const O=await I.json(),M=O.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let U=null;for(let B of L){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){U=J;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${J}`,K)}}return U||O.thumbnail_url},_=u.map(async S=>{const C=await f(S.url);return{gameObjectName:S.id,thumbnailUrl:C}}),E=await Promise.all(_);$.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:S,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:S,thumbnailUrl:C})})}catch(u){$.error("Error fetching thumbnails:",u)}})()},[e,n,i])},Eae=()=>{const[n,e]=k.useState([]),i=Vc();return k.useEffect(()=>{let o=!0,l=null;const u=()=>{window.unityInstance&&($.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=M=>{if(o){$.log("UpdatePlayerList unity message received.");try{let L=[];if(typeof M=="object"&&M!==null?L=M.players||[]:L=JSON.parse(M).players||[],Array.isArray(L)){const U=Array.from(new Map(L.map(B=>[B.playerId,B])).values());e(U),l&&(clearTimeout(l),l=null)}}catch(L){$.error("Error handling player list data:",L),l||(l=setTimeout(u,1e3))}}},_=()=>{$.log("Player disconnected, requesting fresh player list"),u()},E=()=>{$.log("Player left, requesting fresh player list"),u()};u();const S=i("UpdatePlayerList",f),C=i("PlayerDisconnected",_),I=i("PlayerLeft",E),O=setInterval(u,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof S=="function"&&S(),typeof C=="function"&&C(),typeof I=="function"&&I(),clearInterval(O)}},[i]),n},vae=()=>{const n=Uc(),e=k.useCallback((o,l,u,f,_,E)=>{const S=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const O={portalId:o,prefabName:l||"PortalObjectPrefab",position:S,rotation:C,scale:I,initialImageUrl:E};return $.log("Sending portal placement to Unity:",O),n("PlacePortalPrefab",O),!0}catch(O){return $.error("Error placing portal:",O),!1}},[n]),i=k.useCallback((o,l,u,f,_,E)=>{const S=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const O={portalId:o,prefabName:l||"PortalObjectPrefab",position:S,rotation:C,scale:I,initialImageUrl:E},M={eventName:"PlacePortalPrefab",data:JSON.stringify(O)};return $.log("Directly sending portal placement to Unity:",O),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(M)),!0}catch(O){return $.error("Error directly placing portal:",O),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},Sae=()=>{const n=Uc(),e=k.useCallback((o,l,u,f,_)=>{const E=u||{x:0,y:0,z:0},S=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:o,glbUrl:l,position:E,rotation:S,scale:C};return $.log("Sending seating hotspot placement to Unity:",I),n("SeatingHotspot",I),!0}catch(I){return $.error("Error placing seating hotspot:",I),!1}},[n]),i=k.useCallback((o,l,u,f,_)=>{const E=u||{x:0,y:0,z:0},S=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:o,glbUrl:l,position:E,rotation:S,scale:C},O={eventName:"SeatingHotspot",data:JSON.stringify(I)};return $.log("Directly sending seating hotspot placement to Unity:",I),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(O)),!0}catch(I){return $.error("Error directly placing seating hotspot:",I),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},u8e=E3(z1,"trackAnalytics"),d8e=E3(z1,"createAnalyticsSession"),h8e=E3(z1,"endAnalyticsSession"),p8e=async(n,e={})=>{try{$.log(`Creating secure analytics session for space ${n}`);const i=await d8e({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...e}});return $.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw $.error("Error creating secure analytics session:",i),i}},f8e=async(n,e,i,o={})=>{try{$.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await u8e({spaceId:n,sessionId:e,eventType:i,eventData:{...o,timestamp:new Date().toISOString(),clientSide:!0}});return $.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw $.error("Error tracking secure analytics event:",l),l}},m8e=async(n,e)=>{try{$.log(`Ending secure analytics session: ${e} in space ${n}`),await h8e({spaceId:n,sessionId:e}),$.log(`Secure analytics session ended: ${e}`)}catch(i){throw $.error("Error ending secure analytics session:",i),i}},ra={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change"}},xo={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},g8e=async(n,e,i={})=>{try{return $.log(`Creating secure analytics session for user ${e} in space ${n}`),await p8e(n,i)}catch(o){throw $.error("Error creating analytics session:",o),o}},Wk=async(n,e,i,o={})=>{try{return $.log(`Tracking secure analytics event: ${i} in space ${n}`),await f8e(n,e,i,o)}catch(l){throw $.error("Error tracking analytics event:",l),l}},_8e=async(n,e)=>{try{$.log(`Ending secure analytics session: ${e} in space ${n}`),await m8e(n,e)}catch(i){throw $.error("Error ending analytics session:",i),i}},y8e=async(n,e,i,o)=>Wk(n,e,ra.UNITY.VIDEO_PLAY,{userId:i,category:xo.MEDIA_INTERACTION,source:"unity",videoId:o.gameObjectName,videoUrl:o.videoUrl,spaceId:n,...o}),BR=(n,e={})=>{const{user:i}=k.useContext(us),o=k.useRef(null),[l,u]=k.useState(!1),[f,_]=k.useState(!1),E=k.useRef(!1),S=k.useRef(!1),C=k.useRef(!1),{autoStart:I=!0,sessionMetadata:O={},enableDebugLogs:M=!1}=e;k.useEffect(()=>(i&&n&&I&&!o.current&&!C.current&&L(),()=>{o.current&&U()}),[i,n,I]),k.useEffect(()=>{const le=()=>{document.hidden&&o.current&&U()},Y=()=>{o.current&&U()};return document.addEventListener("visibilitychange",le),window.addEventListener("beforeunload",Y),()=>{document.removeEventListener("visibilitychange",le),window.removeEventListener("beforeunload",Y)}},[]);const L=k.useCallback(async()=>{if(!i||!n||o.current||C.current){M&&$.log("Analytics session already initializing or initialized, skipping");return}try{C.current=!0,_(!0);const le=await g8e(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...O});o.current=le,u(!0),E.current?M&&$.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await Wk(n,le,ra.REACT.SPACE_ENTER,{userId:i.uid,category:xo.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),E.current=!0,M&&$.log(` Analytics: Space entry tracked for session ${le}`)),M&&$.log(`Analytics session initialized: ${le} for space ${n}`)}catch(le){$.error("Failed to initialize analytics session:",le),_(!1)}finally{C.current=!1}},[i,n,O,M]),U=k.useCallback(async()=>{if(!(!o.current||!n))try{S.current?M&&$.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await Wk(n,o.current,ra.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:xo.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),S.current=!0,M&&$.log(` Analytics: Space exit tracked for session ${o.current}`)),await _8e(n,o.current),M&&$.log(`Analytics session ended: ${o.current}`),o.current=null,u(!1),_(!1),E.current=!1,S.current=!1}catch(le){$.error("Failed to end analytics session:",le)}},[n,i==null?void 0:i.uid,M]),B=k.useCallback(async(le,Y={})=>{if(!o.current||!n||!f)return M&&$.warn("Cannot track event: No active analytics session"),null;try{const Z=await Wk(n,o.current,le,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...Y});return M&&$.log(`Analytics event tracked: ${le}`,Y),Z}catch(Z){return $.error("Failed to track analytics event:",Z),null}},[n,i==null?void 0:i.uid,f,M]),J=k.useCallback(async le=>{if(!o.current||!n||!f)return M&&$.warn("Cannot track video play: No active analytics session"),null;try{const Y=await y8e(n,o.current,i==null?void 0:i.uid,le);return M&&$.log("Video play event tracked:",le),Y}catch(Y){return $.error("Failed to track video play event:",Y),null}},[n,i==null?void 0:i.uid,f,M]),K=k.useCallback(async(le,Y={})=>B(le,{...Y,source:"unity",category:Y.category||xo.USER_BEHAVIOR}),[B]),ne=k.useCallback(async(le,Y={})=>B(le,{...Y,source:"react",category:Y.category||xo.UI_INTERACTION}),[B]),oe=k.useCallback(async(le,Y,Z={})=>{const X=le==="open"?ra.REACT.MODAL_OPEN:ra.REACT.MODAL_CLOSE;return ne(X,{modalName:Y,action:le,category:xo.UI_INTERACTION,...Z})},[ne]),se=k.useCallback(async()=>{o.current&&await U(),await L()},[U,L]);return{isInitialized:l,isTracking:f,sessionId:o.current,track:B,trackVideoPlay:J,trackUnityEvent:K,trackReactEvent:ne,trackModal:oe,initializeSession:L,endSession:U,restartSession:se,isReady:l&&f&&o.current!==null}},E8e=n=>{const[e,i]=k.useState(null),{user:o}=k.useContext(us),l=Vc(),{spaceID:u}=Vo(),{trackUnityEvent:f,isReady:_}=BR(u,{enableDebugLogs:!0});return k.useEffect(()=>{let S=!0;const I=l("PlayVideo",async O=>{try{const{gameObjectName:M}=O;if(!M){$.error("Game object name is missing in Unity event data.");return}const L=await Xoe(u);$.log("SPACES VIDEOS",L);const U=L.find(B=>B.id===M);U&&S?(i(U.url),$.log("Video URL set to:",U.url),_&&o&&(f(ra.UNITY.VIDEO_PLAY,{category:xo.MEDIA_INTERACTION,videoId:M,videoUrl:U.url,videoTitle:U.title||U.name||M,isEditMode:!1,spaceId:u,timestamp:new Date().toISOString(),videoData:{gameObjectName:M,videoMetadata:U}}),$.log(" Analytics: Video play event tracked for:",M))):console.error("Video not found for game object:",M)}catch(M){console.error("Error fetching space videos:",M)}});return()=>{S=!1,I()}},[l,u,n]),[e,()=>{i(null)}]},v8e=()=>{const[n,e]=k.useState(null),[i,o]=k.useState(!1),[l,u]=k.useState(null),f=Vc(),_=Uc();k.useEffect(()=>f("KickPlayerResult",I=>{$.log("KickPlayerResult event received:",I),I?(e(I),o(!1),I.success?u(null):u(I.errorMessage||"Failed to kick player")):($.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),o(!1))}),[f]);const E=k.useCallback((C,I)=>{var O;try{if(!C){u("Player UID is required");return}o(!0),u(null),e(null);const M={uid:C,requestedBy:I||((O=window.currentUser)==null?void 0:O.uid)};$.log("Sending KickPlayer event to Unity:",M),_("KickPlayer",M)}catch(M){$.error("Error kicking player:",M),u(M.message||"Failed to send kick request"),o(!1)}},[_]),S=k.useCallback(()=>{e(null),u(null),o(!1)},[]);return{kickPlayer:E,isKicking:i,kickResult:n,error:l,resetKickState:S}},S8e=n=>{const{placePortal:e}=vae();k.useEffect(()=>{const i=async()=>{try{const o=Al(Hn,"spaces",n,"portals"),l=await od(o);if(l.empty){$.log("useSpacePortals: No portals found for space:",n);return}$.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const f=u.data();$.log(`useSpacePortals: Placing portal ${f.portalId} in Unity:`,f),e(f.portalId,f.prefabName,f.position,f.rotation,f.scale)})}catch(o){$.error("useSpacePortals: Error loading portals:",o)}};if(window.unityInstance)$.log("useSpacePortals: Unity is ready, loading portals"),i();else{const o=()=>{$.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},bae=async(n,e)=>{console.log(" fetchPortalAnalyticsData called with:",{spaceId:n,portalId:e});let i=null,o=null;try{if(!n||!e)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${e}`);const u=gr(Hn,"spaces",n,"portals",e);console.log(" Querying Firestore path:",`spaces/${n}/portals/${e}`);const f=await Uo(u);if(f.exists()){const _=f.data();i=_.targetSpaceId,o=_.targetSpaceName,console.log(" Portal data fetched from Firestore:",{targetSpaceId:i,targetSpaceName:o})}else{console.warn(" Portal document not found in Firestore for:",e);const _=e.split("_");_.length>=3&&(i=_[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}}catch(u){console.error(" Error fetching portal data from Firestore:",u);const f=e.split("_");f.length>=3&&(i=f[2],console.log(" Fallback: Parsed targetSpaceId from portalId:",i))}const l={targetSpaceId:i,targetSpaceName:o};return console.log(" fetchPortalAnalyticsData returning:",l),l},b8e=()=>{const[n,e]=k.useState(null),{user:i}=k.useContext(us),o=Vc(),{spaceID:l}=Vo(),{trackUnityEvent:u,isReady:f}=BR(l,{enableDebugLogs:!0});return k.useEffect(()=>{console.log("Setting up portal click listener...");const S=o("PortalClicked",async C=>{console.log("Portal click event received:",C);try{const I=typeof C=="string"?JSON.parse(C):C;if(console.log("Parsed portal data:",I),e(I),f&&i&&I&&I.portalId)try{const{targetSpaceId:O,targetSpaceName:M}=await bae(l,I.portalId);await u(ra.UNITY.PORTAL_CLICK,{category:xo.NAVIGATION,portalId:I.portalId,targetSpaceId:O,targetSpaceName:M,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked for:",I.portalId,"targeting:",M||O)}catch(O){console.error(" Analytics: Error tracking portal click:",O);try{await u(ra.UNITY.PORTAL_CLICK,{category:xo.NAVIGATION,portalId:I.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()}),console.log(" Analytics: Portal click event tracked (fallback) for:",I.portalId)}catch(M){console.error(" Analytics: Failed to track portal click even with fallback:",M)}}}catch(I){console.error("Error parsing portal click data:",I,"Data:",C)}});return()=>{console.log("Cleaning up portal click listener"),typeof S=="function"&&S()}},[o,f,i,l,u]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),e(null)},isAnalyticsReady:f,trackPortalClick:u}},T8e=()=>{const{user:n}=k.useContext(us),e=Vc(),{spaceID:i}=Vo(),{trackUnityEvent:o,isReady:l}=BR(i,{enableDebugLogs:!0});k.useEffect(()=>{console.log("Setting up portal navigation listener...");const f=e("PortalNavigate",async _=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const E=typeof _=="string"?JSON.parse(_):_;if(console.log("Portal data:",E),!E.portalId){console.error("Portal ID is missing from portal data");return}let S=null,C=null;try{const I=await bae(i,E.portalId);S=I.targetSpaceId,C=I.targetSpaceName}catch(I){console.error("Error fetching portal analytics data:",I);const O=E.portalId.split("_");O.length>=3&&(S=O[2])}if(S){if(console.log("Navigating to space:",S,`(${C||"Unknown space name"})`),l&&n&&E)try{await o(ra.UNITY.PORTAL_NAVIGATE,{category:xo.NAVIGATION,portalId:E.portalId,targetSpaceId:S,targetSpaceName:C,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",E.portalId,"",C||S)}catch(I){console.error(" Analytics: Error tracking portal navigation:",I)}window.location.href=`/?spaceId=${S}`}else console.error("Could not determine target space ID from portal:",E.portalId)}catch(E){console.error("Error handling portal navigation:",E)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof f=="function"&&f()}},[e,l,n,i,o])},w8e=n=>{const{placeCatalogueItem:e}=Sae();k.useEffect(()=>{const i=async()=>{try{const o=Al(Hn,"spaces",n,"catalogue"),l=await od(o);if(l.empty){$.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}$.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(u=>{const f=u.data();$.log(`useSpaceCatalogueItems: Placing item ${f.itemId} in Unity:`,f),e(f.itemId,f.glbUrl,f.position,f.rotation,f.scale)})}catch(o){$.error("useSpaceCatalogueItems: Error loading catalogue items:",o)}};if(window.unityInstance)$.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const o=()=>{$.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Tae=()=>{const[n,e]=k.useState(null),i=Vc();return k.useEffect(()=>{$.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async f=>{$.log(" Seating hotspot click event received from Unity:",f);try{const _=typeof f=="string"?JSON.parse(f):f;$.log(" Parsed Unity click data:",_);const E=_.hotspotId.split("_");if(E.length>=3){const S=E.slice(1,-1).join("_");$.log(" Extracted spaceId:",S);const C=gr(Hn,"spaces",S,"catalogue",_.hotspotId);$.log(" Fetching from Firebase path:",`spaces/${S}/catalogue/${_.hotspotId}`);const I=await Uo(C);if(I.exists()){const O=I.data();$.log(" Fetched Firebase data:",O),$.log(" Firebase position:",O.position),$.log(" Unity position:",_.position);const M={..._,position:O.position||_.position,rotation:O.rotation||_.rotation,scale:O.scale||_.scale};$.log(" Combined data being set:",M),e(M)}else $.warn(" Item not found in Firebase:",_.hotspotId),e(_)}else $.error(" Invalid hotspot ID format:",_.hotspotId),e(_)}catch(_){$.error(" Error handling seating hotspot click:",_,"Data:",f)}});return()=>{$.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{$.log("Clearing clicked item state"),e(null)}}},C8e=n=>({opacity:1});function R8e(){const{loadingProgression:n,isLoaded:e,error:i}=Vo(),{user:o}=k.useContext(us),[l,u]=k.useState(!1),[f,_]=k.useState(!1),[E,S]=k.useState(!1),[C,I]=k.useState(!1),O=k.useRef(!1),M=k.useRef(!1),L=k.useRef(null),U=k.useRef(null),B=k.useRef(null),J=Vc(),K=k.useRef(null),ne=k.useRef(null),oe=k.useRef(null);k.useRef(null),k.useEffect(()=>{u(!o&&n===0)},[o,n]),k.useEffect(()=>{const Y=document.createElement("style");return Y.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Y),K.current=Y,()=>{K.current&&document.head.removeChild(K.current)}},[]),k.useEffect(()=>{const Y=()=>{const Z=document.getElementById("unity-canvas"),X=document.getElementById("unity-container");Z&&(L.current=Z,Z.style.zIndex="1"),X&&(U.current=X,X.style.zIndex="1"),Z&&X&&oe.current&&(clearInterval(oe.current),oe.current=null)};return Y(),oe.current=setInterval(Y,100),()=>{oe.current&&(clearInterval(oe.current),oe.current=null)}},[]),k.useEffect(()=>{window.isFirstSceneLoaded&&(M.current=!0,I(!0));const Z=J("FirstSceneLoaded",()=>{M.current=!0,I(!0),window.isFirstSceneLoaded=!0}),X=setTimeout(()=>{M.current||(M.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Z(),clearTimeout(X)}},[J]),k.useEffect(()=>{window.isPlayerInstantiated&&(O.current=!0,S(!0),M.current||(M.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Y=()=>{O.current=!0,S(!0),M.current||(M.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Y);const Z=J("PlayerInstantiated",Y),X=setTimeout(()=>{O.current||(O.current=!0,S(!0),M.current||(M.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Y),Z(),clearTimeout(X)}},[J]),k.useEffect(()=>(C&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ne.current&&clearTimeout(ne.current),ne.current=setTimeout(()=>{L.current&&(L.current.style.opacity="1",L.current.style.removeProperty("opacity")),U.current&&(U.current.style.opacity="1",U.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="0",B.current.style.pointerEvents="none",setTimeout(()=>{B.current&&(B.current.style.display="none")},1500))},2e3)),()=>{ne.current&&clearTimeout(ne.current)}),[C,E]);const se=()=>e?e&&!C&&!E?"Scene initializing":C&&!E?"Player initializing":"Ready":"World loading",le=()=>e?e&&!C&&!E?85:C&&!E?95:100:n*80;return b.jsx(b.Fragment,{children:l?b.jsx(lt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:b.jsxs(Mr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[b.jsx(Ze,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),b.jsx(Ze,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),b.jsx(Nn,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):b.jsx(lt,{ref:B,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:b.jsxs(Ur,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[b.jsx(Ze,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),b.jsx(Ze,{fontSize:"sm",children:se()}),b.jsx(qy,{value:le(),size:"lg",width:"100%",marginY:2})]})})})}function I8e(){const{user:n}=k.useContext(us);return b.jsx("div",{children:n!==null?b.jsx("div",{children:b.jsx(M3,{})}):b.jsxs("div",{children:[b.jsx(X1,{}),b.jsx(J1,{})]})})}function A8e(){const{fullscreenRef:n}=uh(),[e,i]=k.useState(!1),o=()=>{i(!e)};return b.jsxs(b.Fragment,{children:[b.jsx(Yf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:b.jsx(xc,{"aria-label":"Controller Help",icon:b.jsx(lze,{}),onClick:o,variant:"iconButton"})}),b.jsxs(as,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[b.jsx(ls,{}),b.jsxs(cs,{children:[b.jsx(so,{children:"Notes"}),b.jsx(Rs,{}),b.jsx(Es,{children:b.jsx(Ze,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),b.jsx(oh,{children:b.jsx(Nn,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var wae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},JQ=_i.createContext&&_i.createContext(wae),jg=function(){return jg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},jg.apply(this,arguments)},P8e=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function Cae(n){return n&&n.map(function(e,i){return _i.createElement(e.tag,jg({key:i},e.attr),Cae(e.child))})}function Ir(n){return function(e){return _i.createElement(O8e,jg({attr:jg({},n.attr)},e),Cae(n.child))}}function O8e(n){var e=function(i){var o=n.attr,l=n.size,u=n.title,f=P8e(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),_i.createElement("svg",jg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,f,{className:E,style:jg(jg({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),u&&_i.createElement("title",null,u),n.children)};return JQ!==void 0?_i.createElement(JQ.Consumer,null,function(i){return e(i)}):e(wae)}function Rae(n){return Ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function k8e(n){return Ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function QQ(n){return Ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function ZQ(n){return Ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function Uj(n){return Ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function N8e(n){return Ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function D8e(n){return Ir({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function x8e(n){return Ir({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function L8e(n){return Ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Iae(n){return Ir({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function M8e(n){return Ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function U8e(n){return Ir({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Aae(n){return Ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function Pae(n){return Ir({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function V8e(n){return Ir({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function j8e(n){return Ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function F8e(n){return Ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function Vj(n){return Ir({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function B8e(n){return Ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function W8e(n){return Ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function z8e(n){return Ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function Oae({open:n,onClose:e}){const i=k.useRef(null),o=Uc(),{user:l}=k.useContext(us),u=E=>{i.current&&!i.current.contains(E.target)&&e()},f=async E=>{const S=_(E);if((S==null?void 0:S.source)==="readyplayerme"&&(S.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),S.eventName==="v1.avatar.exported")){const C=S.data.url;if(console.log(`Avatar URL: ${C}`),o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await Noe(l.uid,C),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return k.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",f)}),[n]),n&&b.jsx(hu,{children:b.jsx(lt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:b.jsx(lt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:b.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function G8e({isOpen:n,onClose:e}){const[i,o]=k.useState(!1),[l,u]=k.useState(null),{user:f}=k.useContext(us),_=Uc(),E=L=>{L.stopPropagation(),o(!0)},S=()=>{o(!1),e()},C=async L=>{if(u(L),f&&f.uid)try{await Noe(f.uid,L.url),_("AvatarUrlFromReact",{url:L.url}),e()}catch(U){console.error("Error updating RPM URL:",U)}else console.error("No authenticated user found to update rpmURL.")},I=Ng("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",M=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return b.jsxs(b.Fragment,{children:[b.jsx(hu,{children:b.jsxs(as,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[b.jsx(ls,{bg:"rgba(0, 0, 0, 0.7)"}),b.jsxs(cs,{bg:"gray.800",color:"white",maxW:"900px",children:[b.jsx(so,{fontSize:"lg",children:"Customise Your Avatar"}),b.jsx(Rs,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),b.jsx(Es,{pb:4,children:b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsx(Ze,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),b.jsxs(sre,{columns:5,spacing:2,children:[b.jsx(lt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:b.jsxs(Mr,{spacing:1,children:[b.jsx(mn,{as:j8e,boxSize:4}),b.jsx(Ze,{fontSize:"xs",children:"Create Custom Avatar"})]})}),M.map(L=>b.jsxs(lt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===L.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>C(L),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[b.jsx(fp,{src:L.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:L.name,width:"100%",height:"100%",objectFit:"cover"}),b.jsx(lt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:b.jsx(Ze,{fontSize:"xs",children:L.name})})]},L.id))]})]})})]})]})}),i&&b.jsx(Oae,{open:i,onClose:S})]})}function H8e(){const{fullscreenRef:n}=uh(),[e,i]=k.useState(!1),[o,l]=k.useState(!1),[u,f]=k.useState(!1),[_,E]=k.useState(!1),{user:S}=k.useContext(us),[C,I]=k.useState(null),[O,M]=k.useState(!0),L=(K,ne)=>!K||!ne?"?":`${K.charAt(0)}${ne.charAt(0)}`.toUpperCase(),U=async()=>{if(S!=null&&S.uid){M(!0);try{const K=await cu(S.uid);I({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{M(!1)}}};k.useEffect(()=>{U()},[S==null?void 0:S.uid]),k.useEffect(()=>{const K=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const B=()=>l(!o),J=()=>{l(!1),U()};return e?b.jsxs(b.Fragment,{children:[b.jsx(Yf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:b.jsxs(lt,{position:"relative",onMouseEnter:()=>{f(!0),E(!0)},onMouseLeave:()=>{f(!1),E(!1)},cursor:"pointer",onClick:B,children:[b.jsx(wl,{src:O||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:O?L(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&b.jsx(lt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:b.jsx(Ze,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),b.jsx(G8e,{isOpen:o,onClose:J})]}):null}function $8e(n){return Ir({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function K8e(n){return Ir({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function q8e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=uh(),l=Ua();k.useEffect(()=>{const f=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const u=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return b.jsx(Yf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:b.jsx(xc,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?b.jsx($8e,{}):b.jsx(K8e,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const eZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function Y8e(){const{isOpen:n,onOpen:e,onClose:i}=ld(),{fullscreenRef:o}=uh(),[l,u]=E8e(!1);k.useEffect(()=>{$.log("VideoPlayer: Current video URL:",l),l&&($.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const f=()=>{$.log("VideoPlayer: Closing modal"),u(),i()};return b.jsx(hu,{containerRef:o,children:b.jsxs(as,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[b.jsx(ls,{bg:"rgba(0, 0, 0, 0.8)"}),b.jsxs(cs,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[b.jsx(Rs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),b.jsx(Es,{p:0,width:"100%",children:l&&b.jsx(lt,{style:eZ.iframeContainer,children:b.jsx("iframe",{src:l,style:eZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function X8e({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[u,f]=k.useState(null),[_,E]=k.useState(!0),[S,C]=k.useState(null);return k.useEffect(()=>{n&&(async()=>{if(E(!0),C(null),!l){$.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),E(!1);return}try{$.log("NameplateModal: Fetching profile for UID:",l);const O=await cu(l);O?f({firstName:O.firstName,lastName:O.lastName,linkedinUrl:O.linkedinUrl,websiteUrl:O.websiteUrl,rpmURL:O.rpmURL?O.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(O){$.error("Error fetching profile data:",O),C("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),b.jsxs(as,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[b.jsx(ls,{backdropFilter:"blur(10px)"}),b.jsxs(cs,{bg:"gray.900",color:"white",borderRadius:"xl",children:[b.jsx(so,{children:"Player Info"}),b.jsx(Rs,{}),b.jsx(Es,{pb:6,children:_?b.jsx(wne,{py:8,children:b.jsx(hd,{size:"xl",color:"blue.400"})}):S?b.jsxs(Hf,{status:"warning",variant:"solid",borderRadius:"md",children:[b.jsx($f,{}),S]}):b.jsxs(Mr,{spacing:4,align:"center",children:[b.jsx(wl,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),b.jsxs(Mr,{spacing:1,children:[b.jsx(Ze,{fontSize:"2xl",fontWeight:"bold",children:i}),(u==null?void 0:u.firstName)&&b.jsxs(Ze,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),b.jsxs(Ze,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&b.jsxs(b.Fragment,{children:[b.jsx(Kf,{borderColor:"whiteAlpha.300"}),b.jsxs(hr,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&b.jsx(nu,{href:u.linkedinUrl,isExternal:!0,children:b.jsx(xc,{icon:b.jsx(Rae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&b.jsx(nu,{href:u.websiteUrl,isExternal:!0,children:b.jsx(xc,{icon:b.jsx(Iae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const J8e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=tLe("(max-width: 768px)"),[l,u]=k.useState(!1);k.useEffect(()=>{u(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const f=o||l,_=Eae(),[E,S]=k.useState(!1),[C,I]=k.useState([]),[O,M]=k.useState(!1),[L,U]=k.useState({}),[B,J]=k.useState({}),[K,ne]=k.useState(!1),oe=Ua(),[se,le]=k.useState(null),[Y,Z]=k.useState(null),{isOpen:X,onOpen:ie,onClose:de}=ld(),[ue,pe]=k.useState(null),{isOpen:ke,onOpen:xe,onClose:je}=ld(),[Oe,we]=k.useState(null),Se=window.currentUser||{},Ee=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";k.useEffect(()=>{ad(Ee).then(ct=>ne(!!(ct!=null&&ct.voiceDisabled)))},[Ee]),k.useEffect(()=>{const ct=()=>S(!0);return window.addEventListener("PlayerInstantiated",ct),window.isPlayerInstantiated&&S(!0),()=>window.removeEventListener("PlayerInstantiated",ct)},[]),k.useEffect(()=>{const ct={};_.forEach(Ut=>{var fn;Ut.uid&&((fn=window.agoraClient)!=null&&fn.client)&&(ct[Ut.uid]=Ut.isLocalPlayer?window.agoraClient.client.uid:Ut.uid)}),J(ct)},[_]),k.useEffect(()=>{const ct=setInterval(()=>{var Ut;if(window.agoraClient){M(!!window.agoraClient.isVoiceEnabled);const fn={};(Ut=window.agoraClient.client)==null||Ut.remoteUsers.forEach(Wt=>{fn[Wt.uid]=!!Wt.audioTrack&&!Wt.audioTrack.muted}),U(fn)}},500);return()=>clearInterval(ct)},[]),k.useEffect(()=>{(async()=>{const Ut=await Promise.all(_.map(async fn=>{var Wt,Te;if(!fn.uid)return fn;try{const Ve=await cu(fn.uid),$e=`space_${Ee}_owners`,Et=`space_${Ee}_hosts`,vt=(Wt=Ve.groups)!=null&&Wt.includes($e)?"owner":(Te=Ve.groups)!=null&&Te.includes(Et)?"host":null,St=Ve.rpmURL?Ve.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...fn,...Ve,rpmURL:St,role:vt}}catch{return fn}}));I(Ut)})()},[_,Ee]);const{kickPlayer:Ce,isKicking:Pe,kickResult:Me,error:We,resetKickState:He}=v8e();k.useEffect(()=>{Me!=null&&Me.success&&(se||Oe)&&(se&&(oe({title:"Remove Successful",description:`${se} has been removed.`,status:"success",duration:3e3,isClosable:!0}),le(null)),Oe&&(oe({title:"Ban Successful",description:`${Oe} has been banned.`,status:"success",duration:3e3,isClosable:!0}),we(null)),He()),We&&(oe({title:"Error",description:We,status:"error",duration:3e3,isClosable:!0}),le(null),we(null),He())},[Me,We,se,Oe,oe,He]);const qe=ct=>ct.isLocalPlayer||ct.uid===Se.uid,rt=ct=>qe(ct)?O:L[B[ct.uid]],et=({role:ct})=>ct==="owner"?b.jsx(mn,{as:Uj,color:"green.400",boxSize:3,ml:1}):ct==="host"?b.jsx(mn,{as:Vj,color:"purple.400",boxSize:3,ml:1}):null,_t=({role:ct})=>ct==="owner"?b.jsxs(hr,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[b.jsx(mn,{as:Uj,color:"green.300"}),b.jsx(th,{colorScheme:"green",variant:"solid",children:"Owner"})]}):ct==="host"?b.jsxs(hr,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[b.jsx(mn,{as:Vj,color:"purple.300"}),b.jsx(th,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,on=()=>{Y&&(le(Y.playerName),Ce(Y.uid,Se.uid),de())},dt=async()=>{ue&&(we(ue.playerName),await eze(Ee,{uid:ue.uid,playerName:ue.playerName,bannedAt:new Date().toISOString(),...Se.uid&&{bannedBy:Se.uid}}),Ce(ue.uid,Se.uid),je())},kt=(ct,Ut)=>{var Wt;if(!(((Wt=C.find(Te=>Te.isLocalPlayer))==null?void 0:Wt.role)==="owner"))return oe({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});ct==="remove"?(Z(Ut),ie()):ct==="ban"&&(pe(Ut),xe())};return b.jsxs(b.Fragment,{children:[b.jsxs(lt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!f?"visible":"hidden",role:"group",children:[b.jsx(lt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:b.jsx(xc,{icon:b.jsx(cze,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:e})}),b.jsxs(Ze,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),b.jsx(lt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:b.jsx(Mr,{align:"stretch",spacing:1,width:"100%",children:C.sort((ct,Ut)=>ct.isLocalPlayer?-1:Ut.isLocalPlayer?1:0).map((ct,Ut)=>{var Ve;const fn=qe(ct),Wt=((Ve=C.find($e=>$e.isLocalPlayer))==null?void 0:Ve.role)==="owner"&&!fn&&ct.role!=="owner",Te=!K&&rt(ct);return b.jsx(lt,{children:b.jsxs(Mre,{placement:"left",trigger:"hover",children:[b.jsx(Bre,{children:b.jsxs(hr,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[b.jsx(wl,{size:"xs",bg:"whiteAlpha.400",src:ct.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),b.jsx(Ze,{fontSize:"xs",children:ct.playerName}),b.jsx(et,{role:ct.role}),b.jsx(g0,{}),!K&&(Te?b.jsx(lt,{color:"green.400",children:b.jsx(Pae,{})}):b.jsx(lt,{color:"red.400",children:b.jsx(Aae,{})})),fn?b.jsx(Ze,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):Wt?b.jsxs(wR,{children:[b.jsx(CR,{as:xc,"aria-label":"Options",icon:b.jsx(x8e,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),b.jsxs(RR,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[b.jsx(dp,{icon:b.jsx(B8e,{}),onClick:()=>kt("remove",ct),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),b.jsx(dp,{icon:b.jsx(k8e,{}),onClick:()=>kt("ban",ct),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),b.jsx(Fre,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:b.jsx(Vre,{children:b.jsxs(Mr,{align:"center",spacing:3,children:[b.jsx(wl,{size:"lg",src:ct.rpmURL}),b.jsx(Ze,{fontWeight:"bold",children:ct.playerName}),b.jsx(_t,{role:ct.role}),ct.firstName&&b.jsxs(Ze,{fontSize:"sm",color:"gray.300",children:[ct.firstName," ",ct.lastName]}),b.jsxs(hr,{spacing:4,pt:2,children:[ct.linkedInProfile&&b.jsx(nu,{href:ct.linkedInProfile,isExternal:!0,children:b.jsx(mn,{as:Rae})}),ct.websiteUrl&&b.jsx(nu,{href:ct.websiteUrl,isExternal:!0,children:b.jsx(mn,{as:Iae})})]})]})})})]})},Ut)})})})]}),b.jsxs(as,{isOpen:X,onClose:de,isCentered:!0,children:[b.jsx(ls,{}),b.jsxs(cs,{bg:"gray.800",color:"white",children:[b.jsx(so,{children:"Confirm Removal"}),b.jsx(Rs,{}),b.jsx(Es,{children:b.jsxs(Ze,{children:["Remove ",Y==null?void 0:Y.playerName," from the room?"]})}),b.jsxs(oh,{children:[b.jsx(Nn,{colorScheme:"red",onClick:on,isLoading:Pe,mr:3,children:"Remove"}),b.jsx(Nn,{bg:"white",color:"gray.800",onClick:de,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),b.jsxs(as,{isOpen:ke,onClose:je,isCentered:!0,children:[b.jsx(ls,{}),b.jsxs(cs,{bg:"gray.800",color:"white",children:[b.jsx(so,{children:"Confirm Ban"}),b.jsx(Rs,{}),b.jsx(Es,{children:b.jsxs(Ze,{children:["Ban ",ue==null?void 0:ue.playerName," from the room? They will not be able to re-enter."]})}),b.jsxs(oh,{children:[b.jsx(Nn,{colorScheme:"red",onClick:dt,isLoading:Pe,mr:3,children:"Ban"}),b.jsx(Nn,{bg:"white",color:"gray.800",onClick:je,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var zk={exports:{}},Q8e=zk.exports,tZ;function Z8e(){return tZ||(tZ=1,function(n,e){(function(i,o){n.exports=o()})(Q8e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Ny<"u"?Ny:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},f=!u(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=f,E=Function.prototype,S=E.call,C=_&&E.bind.bind(S,S),I=_?C:function(t){return function(){return S.apply(t,arguments)}},O=I({}.isPrototypeOf),M=function(t){return t&&t.Math==Math&&t},L=M(typeof globalThis=="object"&&globalThis)||M(typeof window=="object"&&window)||M(typeof self=="object"&&self)||M(typeof o=="object"&&o)||function(){return this}()||o||Function("return this")(),U=f,B=Function.prototype,J=B.apply,K=B.call,ne=typeof Reflect=="object"&&Reflect.apply||(U?K.bind(J):function(){return K.apply(J,arguments)}),oe=I,se=oe({}.toString),le=oe("".slice),Y=function(t){return le(se(t),8,-1)},Z=Y,X=I,ie=function(t){if(Z(t)==="Function")return X(t)},de=typeof document=="object"&&document.all,ue={all:de,IS_HTMLDDA:de===void 0&&de!==void 0},pe=ue.all,ke=ue.IS_HTMLDDA?function(t){return typeof t=="function"||t===pe}:function(t){return typeof t=="function"},xe={},je=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Oe=f,we=Function.prototype.call,Se=Oe?we.bind(we):function(){return we.apply(we,arguments)},Be={},Ee={}.propertyIsEnumerable,Ce=Object.getOwnPropertyDescriptor,Pe=Ce&&!Ee.call({1:2},1);Be.f=Pe?function(t){var r=Ce(this,t);return!!r&&r.enumerable}:Ee;var Me,We,He=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},qe=u,rt=Y,et=Object,_t=I("".split),on=qe(function(){return!et("z").propertyIsEnumerable(0)})?function(t){return rt(t)=="String"?_t(t,""):et(t)}:et,dt=function(t){return t==null},kt=dt,ct=TypeError,Ut=function(t){if(kt(t))throw ct("Can't call method on "+t);return t},fn=on,Wt=Ut,Te=function(t){return fn(Wt(t))},Ve=ke,$e=ue.all,Et=ue.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Ve(t)||t===$e}:function(t){return typeof t=="object"?t!==null:Ve(t)},vt={},St=vt,zt=L,dn=ke,vn=function(t){return dn(t)?t:void 0},nn=function(t,r){return arguments.length<2?vn(St[t])||vn(zt[t]):St[t]&&St[t][r]||zt[t]&&zt[t][r]},Ct=typeof navigator<"u"&&String(navigator.userAgent)||"",sr=L,xt=Ct,qt=sr.process,Tr=sr.Deno,Pi=qt&&qt.versions||Tr&&Tr.version,As=Pi&&Pi.v8;As&&(We=(Me=As.split("."))[0]>0&&Me[0]<4?1:+(Me[0]+Me[1])),!We&&xt&&(!(Me=xt.match(/Edge\/(\d+)/))||Me[1]>=74)&&(Me=xt.match(/Chrome\/(\d+)/))&&(We=+Me[1]);var cr=We,zn=cr,ia=u,Ks=L.String,ao=!!Object.getOwnPropertySymbols&&!ia(function(){var t=Symbol();return!Ks(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&zn&&zn<41}),jc=ao&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ps=nn,Va=ke,Fo=O,ja=Object,fc=jc?function(t){return typeof t=="symbol"}:function(t){var r=Ps("Symbol");return Va(r)&&Fo(r.prototype,ja(t))},Ol=String,Fa=function(t){try{return Ol(t)}catch{return"Object"}},mc=ke,_o=Fa,ji=TypeError,ds=function(t){if(mc(t))return t;throw ji(_o(t)+" is not a function")},sa=ds,kl=dt,Ba=function(t,r){var s=t[r];return kl(s)?void 0:sa(s)},Bo=Se,mt=ke,hn=Et,Or=TypeError,Oi={exports:{}},Nl=L,Xi=Object.defineProperty,Dl=function(t,r){try{Xi(Nl,t,{value:r,configurable:!0,writable:!0})}catch{Nl[t]=r}return r},Wo="__core-js_shared__",pu=L[Wo]||Dl(Wo,{}),xl=pu;(Oi.exports=function(t,r){return xl[t]||(xl[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var oa=Oi.exports,fu=Ut,gc=Object,Fi=function(t){return gc(fu(t))},hs=Fi,Sn=I({}.hasOwnProperty),ki=Object.hasOwn||function(t,r){return Sn(hs(t),r)},Fc=I,Ll=0,Wa=Math.random(),Np=Fc(1 .toString),hh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Np(++Ll+Wa,36)},mu=oa,zo=ki,dm=hh,yo=ao,Dp=jc,Ml=L.Symbol,ph=mu("wks"),fh=Dp?Ml.for||Ml:Ml&&Ml.withoutSetter||dm,wr=function(t){return zo(ph,t)||(ph[t]=yo&&zo(Ml,t)?Ml[t]:fh("Symbol."+t)),ph[t]},gu=Se,_u=Et,pd=fc,_c=Ba,aa=function(t,r){var s,a;if(mt(s=t.toString)&&!hn(a=Bo(s,t))||mt(s=t.valueOf)&&!hn(a=Bo(s,t)))return a;throw Or("Can't convert object to primitive value")},fd=TypeError,Ul=wr("toPrimitive"),yu=function(t,r){if(!_u(t)||pd(t))return t;var s,a=_c(t,Ul);if(a){if(s=gu(a,t,r),!_u(s)||pd(s))return s;throw fd("Can't convert object to primitive value")}return aa(t)},ri=fc,yc=function(t){var r=yu(t,"string");return ri(r)?r:r+""},pr=Et,Bc=L.document,hm=pr(Bc)&&pr(Bc.createElement),Eu=function(t){return hm?Bc.createElement(t):{}},mh=Eu,xp=!je&&!u(function(){return Object.defineProperty(mh("div"),"a",{get:function(){return 7}}).a!=7}),pm=je,Lp=Se,ca=Be,vs=He,la=Te,ua=yc,vu=ki,da=xp,ha=Object.getOwnPropertyDescriptor;xe.f=pm?ha:function(t,r){if(t=la(t),r=ua(r),da)try{return ha(t,r)}catch{}if(vu(t,r))return vs(!Lp(ca.f,t,r),t[r])};var fm=u,Wc=ke,Os=/#|\.prototype\./,md=function(t,r){var s=Vl[Mp(t)];return s==mm||s!=Su&&(Wc(r)?fm(r):!!r)},Mp=md.normalize=function(t){return String(t).replace(Os,".").toLowerCase()},Vl=md.data={},Su=md.NATIVE="N",mm=md.POLYFILL="P",za=md,Ga=ds,jl=f,be=ie(ie.bind),De=function(t,r){return Ga(t),r===void 0?t:jl?be(t,r):function(){return t.apply(r,arguments)}},it={},en=je&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),tr=Et,kr=String,Zr=TypeError,_n=function(t){if(tr(t))return t;throw Zr(kr(t)+" is not an object")},Kr=je,Ni=xp,qs=en,pa=_n,fa=yc,gd=TypeError,ps=Object.defineProperty,Fl=Object.getOwnPropertyDescriptor,gh="enumerable",zc="configurable",r_="writable";it.f=Kr?qs?function(t,r,s){if(pa(t),r=fa(r),pa(s),typeof t=="function"&&r==="prototype"&&"value"in s&&r_ in s&&!s[r_]){var a=Fl(t,r);a&&a[r_]&&(t[r]=s.value,s={configurable:zc in s?s[zc]:a[zc],enumerable:gh in s?s[gh]:a[gh],writable:!1})}return ps(t,r,s)}:ps:function(t,r,s){if(pa(t),r=fa(r),pa(s),Ni)try{return ps(t,r,s)}catch{}if("get"in s||"set"in s)throw gd("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var gm=it,_d=He,ma=je?function(t,r,s){return gm.f(t,r,_d(1,s))}:function(t,r,s){return t[r]=s,t},bu=L,_m=ne,i_=ie,gE=ke,ym=xe.f,Em=za,yd=vt,Ed=De,vd=ma,s_=ki,_E=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return _m(t,this,arguments)};return r.prototype=t.prototype,r},$n=function(t,r){var s,a,c,d,h,m,y,v,T,R=t.target,P=t.global,D=t.stat,G=t.proto,F=P?bu:D?bu[R]:(bu[R]||{}).prototype,W=P?yd:yd[R]||vd(yd,R,{})[R],Q=W.prototype;for(d in r)a=!(s=Em(P?d:R+(D?".":"#")+d,t.forced))&&F&&s_(F,d),m=W[d],a&&(y=t.dontCallGetSet?(T=ym(F,d))&&T.value:F[d]),h=a&&y?y:r[d],a&&typeof m==typeof h||(v=t.bind&&a?Ed(h,bu):t.wrap&&a?_E(h):G&&gE(h)?i_(h):h,(t.sham||h&&h.sham||m&&m.sham)&&vd(v,"sham",!0),vd(W,d,v),G&&(s_(yd,c=R+"Prototype")||vd(yd,c,{}),vd(yd[c],d,h),t.real&&Q&&(s||!Q[d])&&vd(Q,d,h)))},vm=Math.ceil,ga=Math.floor,yE=Math.trunc||function(t){var r=+t;return(r>0?ga:vm)(r)},EE=yE,Gc=function(t){var r=+t;return r!=r||r===0?0:EE(r)},A=Gc,z=Math.max,re=Math.min,ge=function(t,r){var s=A(t);return s<0?z(s+r,0):re(s,r)},Xe=Gc,ut=Math.min,Gt=function(t){return t>0?ut(Xe(t),9007199254740991):0},ii=Gt,Ei=function(t){return ii(t.length)},Nr=Te,co=ge,ks=Ei,Ec=function(t){return function(r,s,a){var c,d=Nr(r),h=ks(d),m=co(a,h);if(t&&s!=s){for(;h>m;)if((c=d[m++])!=c)return!0}else for(;h>m;m++)if((t||m in d)&&d[m]===s)return t||m||0;return!t&&-1}},_a={includes:Ec(!0),indexOf:Ec(!1)},Up=_a.includes;$n({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return Up(this,t,arguments.length>1?arguments[1]:void 0)}});var Sm=vt,vc=function(t){return Sm[t+"Prototype"]},WR=vc("Array").includes,zR=Et,bm=Y,Z1=wr("match"),GR=function(t){var r;return zR(t)&&((r=t[Z1])!==void 0?!!r:bm(t)=="RegExp")},eD=GR,HR=TypeError,cb={};cb[wr("toStringTag")]="z";var Vp=String(cb)==="[object z]",o_=Vp,tD=ke,jp=Y,nD=wr("toStringTag"),$R=Object,lb=jp(function(){return arguments}())=="Arguments",Hc=o_?jp:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(r=$R(t),nD))=="string"?s:lb?jp(r):(a=jp(r))=="Object"&&tD(r.callee)?"Arguments":a},KR=Hc,qR=String,Ha=function(t){if(KR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return qR(t)},rD=wr("match"),iD=$n,sD=function(t){if(eD(t))throw HR("The method doesn't accept regular expressions");return t},oD=Ut,YR=Ha,Bl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[rD]=!1,"/./"[t](r)}catch{}}return!1},a_=I("".indexOf);iD({target:"String",proto:!0,forced:!Bl("includes")},{includes:function(t){return!!~a_(YR(oD(this)),YR(sD(t)),arguments.length>1?arguments[1]:void 0)}});var XR=vc("String").includes,ub=O,JR=WR,QR=XR,c_=Array.prototype,db=String.prototype,aD=function(t){var r=t.includes;return t===c_||ub(c_,t)&&r===c_.includes?JR:typeof t=="string"||t===db||ub(db,t)&&r===db.includes?QR:r},at=l(aD),hb=ds,l_=Fi,pb=on,ZR=Ei,vE=TypeError,Tm=function(t){return function(r,s,a,c){hb(s);var d=l_(r),h=pb(d),m=ZR(d),y=t?m-1:0,v=t?-1:1;if(a<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw vE("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,d));return c}},fb={left:Tm(!1)},eI=u,Fp=function(t,r){var s=[][t];return!!s&&eI(function(){s.call(null,r||function(){return 1},1)})},Bp=typeof process<"u"&&Y(process)=="process",tI=fb.left;$n({target:"Array",proto:!0,forced:!Bp&&cr>79&&cr<83||!Fp("reduce")},{reduce:function(t){var r=arguments.length;return tI(this,t,r,r>1?arguments[1]:void 0)}});var nI=vc("Array").reduce,rI=O,iI=nI,SE=Array.prototype,_h=function(t){var r=t.reduce;return t===SE||rI(SE,t)&&r===SE.reduce?iI:r},bE=_h,Sc=l(bE),cD=Y,u_=Array.isArray||function(t){return cD(t)=="Array"},d_=$n,lD=u_,sI=I([].reverse),mb=[1,2];d_({target:"Array",proto:!0,forced:String(mb)===String(mb.reverse())},{reverse:function(){return lD(this)&&(this.length=this.length),sI(this)}});var Bi=vc("Array").reverse,gb=O,TE=Bi,Wp=Array.prototype,oI=function(t){var r=t.reverse;return t===Wp||gb(Wp,t)&&r===Wp.reverse?TE:r},wE=oI,wm=l(wE),CE=hh,zp=oa("keys"),h_=function(t){return zp[t]||(zp[t]=CE(t))},uD=!u(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),dD=ki,aI=ke,RE=Fi,IE=uD,AE=h_("IE_PROTO"),p_=Object,_b=p_.prototype,f_=IE?p_.getPrototypeOf:function(t){var r=RE(t);if(dD(r,AE))return r[AE];var s=r.constructor;return aI(s)&&r instanceof s?s.prototype:r instanceof p_?_b:null},hD=I,cI=ds,pD=ke,fD=String,yb=TypeError,yh=function(t,r,s){try{return hD(cI(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},lI=_n,Cm=function(t){if(typeof t=="object"||pD(t))return t;throw yb("Can't set "+fD(t)+" as a prototype")},Tu=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=yh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return lI(a),Cm(c),r?t(a,c):a.__proto__=c,a}}():void 0),Eh={},$c={},m_=ki,mD=Te,gD=_a.indexOf,Gp=$c,Rm=I([].push),Hp=function(t,r){var s,a=mD(t),c=0,d=[];for(s in a)!m_(Gp,s)&&m_(a,s)&&Rm(d,s);for(;r.length>c;)m_(a,s=r[c++])&&(~gD(d,s)||Rm(d,s));return d},Im=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Eb=Hp,Am=Im.concat("length","prototype");Eh.f=Object.getOwnPropertyNames||function(t){return Eb(t,Am)};var Kc={};Kc.f=Object.getOwnPropertySymbols;var Wi=nn,Di=Eh,vh=Kc,Go=_n,$a=I([].concat),$p=Wi("Reflect","ownKeys")||function(t){var r=Di.f(Go(t)),s=vh.f;return s?$a(r,s(t)):r},Kp=ki,Ka=$p,PE=xe,uI=it,OE={},kE=Hp,dI=Im,qc=Object.keys||function(t){return kE(t,dI)},NE=je,vb=en,hI=it,_D=_n,Sh=Te,Pm=qc;OE.f=NE&&!vb?Object.defineProperties:function(t,r){_D(t);for(var s,a=Sh(r),c=Pm(r),d=c.length,h=0;d>h;)hI.f(t,s=c[h++],a[s]);return t};var Sd,g_=nn("document","documentElement"),DE=_n,Yc=OE,bc=Im,qp=$c,bd=g_,Td=Eu,wd="prototype",xE="script",LE=h_("IE_PROTO"),__=function(){},qa=function(t){return"<"+xE+">"+t+"</"+xE+">"},Ya=function(t){t.write(qa("")),t.close();var r=t.parentWindow.Object;return t=null,r},vi=function(){try{Sd=new ActiveXObject("htmlfile")}catch{}var t,r,s;vi=typeof document<"u"?document.domain&&Sd?Ya(Sd):(r=Td("iframe"),s="java"+xE+":",r.style.display="none",bd.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(qa("document.F=Object")),t.close(),t.F):Ya(Sd);for(var a=bc.length;a--;)delete vi[wd][bc[a]];return vi()};qp[LE]=!0;var ya=Object.create||function(t,r){var s;return t!==null?(__[wd]=DE(t),s=new __,__[wd]=null,s[LE]=t):s=vi(),r===void 0?s:Yc.f(s,r)},pI=Et,fI=ma,ME=Error,Sb=I("".replace),mI=String(ME("zxcasd").stack),y_=/\n\s*at [^:]*:[^\n]*/,gI=y_.test(mI),Om=He,bb=!u(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Om(1,7)),t.stack!==7)}),yD=ma,E_=function(t,r){if(gI&&typeof t=="string"&&!ME.prepareStackTrace)for(;r--;)t=Sb(t,y_,"");return t},UE=bb,Tb=Error.captureStackTrace,bh={},km=bh,_I=wr("iterator"),VE=Array.prototype,v_=function(t){return t!==void 0&&(km.Array===t||VE[_I]===t)},Nm=Hc,jE=Ba,wb=dt,Cb=bh,Rb=wr("iterator"),Cd=function(t){if(!wb(t))return jE(t,Rb)||jE(t,"@@iterator")||Cb[Nm(t)]},Xc=Se,Yp=ds,Ib=_n,yI=Fa,Rd=Cd,Th=TypeError,S_=function(t,r){var s=arguments.length<2?Rd(t):r;if(Yp(s))return Ib(Xc(s,t));throw Th(yI(t)+" is not iterable")},EI=Se,wu=_n,wh=Ba,b_=function(t,r,s){var a,c;wu(t);try{if(!(a=wh(t,"return"))){if(r==="throw")throw s;return s}a=EI(a,t)}catch(d){c=!0,a=d}if(r==="throw")throw s;if(c)throw a;return wu(a),s},vI=De,FE=Se,SI=_n,T_=Fa,Cu=v_,w_=Ei,Dm=O,Xp=S_,Ab=Cd,Jp=b_,bI=TypeError,xm=function(t,r){this.stopped=t,this.result=r},$i=xm.prototype,Ch=function(t,r,s){var a,c,d,h,m,y,v,T=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),D=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),F=vI(r,T),W=function(ee){return a&&Jp(a,"normal",ee),new xm(!0,ee)},Q=function(ee){return R?(SI(ee),G?F(ee[0],ee[1],W):F(ee[0],ee[1])):G?F(ee,W):F(ee)};if(P)a=t.iterator;else if(D)a=t;else{if(!(c=Ab(t)))throw bI(T_(t)+" is not iterable");if(Cu(c)){for(d=0,h=w_(t);h>d;d++)if((m=Q(t[d]))&&Dm($i,m))return m;return new xm(!1)}a=Xp(t,c)}for(y=P?t.next:a.next;!(v=FE(y,a)).done;){try{m=Q(v.value)}catch(ee){Jp(a,"throw",ee)}if(typeof m=="object"&&m&&Dm($i,m))return m}return new xm(!1)},Pb=Ha,Ob=$n,BE=O,kb=f_,Ru=Tu,Ji=function(t,r,s){for(var a=Ka(r),c=uI.f,d=PE.f,h=0;h<a.length;h++){var m=a[h];Kp(t,m)||s&&Kp(s,m)||c(t,m,d(r,m))}},Ns=ya,Ds=ma,Lm=He,C_=function(t,r){pI(r)&&"cause"in r&&fI(t,"cause",r.cause)},R_=function(t,r,s,a){UE&&(Tb?Tb(t,r):yD(t,"stack",E_(s,a)))},ED=Ch,Ho=function(t,r){return t===void 0?arguments.length<2?"":r:Pb(t)},Nb=wr("toStringTag"),Mm=Error,Db=[].push,Ea=function(t,r){var s,a=BE(Xa,this);Ru?s=Ru(Mm(),a?kb(this):Xa):(s=a?this:Ns(Xa),Ds(s,Nb,"Error")),r!==void 0&&Ds(s,"message",Ho(r)),R_(s,Ea,s.stack,1),arguments.length>2&&C_(s,arguments[2]);var c=[];return ED(t,Db,{that:c}),Ds(s,"errors",c),s};Ru?Ru(Ea,Mm):Ji(Ea,Mm,{name:!0});var Xa=Ea.prototype=Ns(Mm.prototype,{constructor:Lm(1,Ea),message:Lm(1,""),name:Lm(1,"AggregateError")});Ob({global:!0},{AggregateError:Ea});var Rh,Qp,Um,TI=ke,xb=L.WeakMap,wI=TI(xb)&&/native code/.test(String(xb)),Lb=L,CI=Et,RI=ma,WE=ki,zE=pu,I_=h_,II=$c,A_="Object already initialized",Vm=Lb.TypeError,AI=Lb.WeakMap;if(wI||zE.state){var Jc=zE.state||(zE.state=new AI);Jc.get=Jc.get,Jc.has=Jc.has,Jc.set=Jc.set,Rh=function(t,r){if(Jc.has(t))throw Vm(A_);return r.facade=t,Jc.set(t,r),r},Qp=function(t){return Jc.get(t)||{}},Um=function(t){return Jc.has(t)}}else{var Zp=I_("state");II[Zp]=!0,Rh=function(t,r){if(WE(t,Zp))throw Vm(A_);return r.facade=t,RI(t,Zp,r),r},Qp=function(t){return WE(t,Zp)?t[Zp]:{}},Um=function(t){return WE(t,Zp)}}var Ih,Mb,Ub,Id={set:Rh,get:Qp,has:Um,enforce:function(t){return Um(t)?Qp(t):Rh(t,{})},getterFor:function(t){return function(r){var s;if(!CI(r)||(s=Qp(r)).type!==t)throw Vm("Incompatible receiver, "+t+" required");return s}}},GE=je,PI=ki,Vb=Function.prototype,vD=GE&&Object.getOwnPropertyDescriptor,jb=PI(Vb,"name"),OI={PROPER:jb&&(function(){}).name==="something",CONFIGURABLE:jb&&(!GE||GE&&vD(Vb,"name").configurable)},SD=ma,Ad=function(t,r,s,a){return a&&a.enumerable?t[r]=s:SD(t,r,s),t},kI=u,NI=ke,HE=Et,bD=ya,DI=f_,TD=Ad,Tc=wr("iterator"),$E=!1;[].keys&&("next"in(Ub=[].keys())?(Mb=DI(DI(Ub)))!==Object.prototype&&(Ih=Mb):$E=!0);var KE=!HE(Ih)||kI(function(){var t={};return Ih[Tc].call(t)!==t});NI((Ih=KE?{}:bD(Ih))[Tc])||TD(Ih,Tc,function(){return this});var Fb={IteratorPrototype:Ih,BUGGY_SAFARI_ITERATORS:$E},xI=Hc,LI=Vp?{}.toString:function(){return"[object "+xI(this)+"]"},Bb=Vp,jm=it.f,Wb=ma,zb=ki,wD=LI,Gb=wr("toStringTag"),Pd=function(t,r,s,a){if(t){var c=s?t:t.prototype;zb(c,Gb)||jm(c,Gb,{configurable:!0,value:r}),a&&!Bb&&Wb(c,"toString",wD)}},MI=Fb.IteratorPrototype,UI=ya,VI=He,CD=Pd,Ja=bh,va=function(){return this},qE=function(t,r,s,a){var c=r+" Iterator";return t.prototype=UI(MI,{next:VI(+!a,s)}),CD(t,c,!1,!0),Ja[c]=va,t},jI=$n,FI=Se,BI=OI,WI=qE,Hb=f_,zI=Pd,YE=Ad,$b=bh,GI=Fb,Kb=BI.PROPER,Fm=GI.BUGGY_SAFARI_ITERATORS,XE=wr("iterator"),JE="keys",ef="values",HI="entries",$I=function(){return this},QE=function(t,r,s,a,c,d,h){WI(s,r,a);var m,y,v,T=function(Q){if(Q===c&&F)return F;if(!Fm&&Q in D)return D[Q];switch(Q){case JE:case ef:case HI:return function(){return new s(this,Q)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,D=t.prototype,G=D[XE]||D["@@iterator"]||c&&D[c],F=!Fm&&G||T(c),W=r=="Array"&&D.entries||G;if(W&&(m=Hb(W.call(new t)))!==Object.prototype&&m.next&&(zI(m,R,!0,!0),$b[R]=$I),Kb&&c==ef&&G&&G.name!==ef&&(P=!0,F=function(){return FI(G,this)}),c)if(y={values:T(ef),keys:d?F:T(JE),entries:T(HI)},h)for(v in y)(Fm||P||!(v in D))&&YE(D,v,y[v]);else jI({target:r,proto:!0,forced:Fm||P},y);return h&&D[XE]!==F&&YE(D,XE,F,{}),$b[r]=F,y},ZE=function(t,r){return{value:t,done:r}},ev=Te,Iu=bh,KI=Id;it.f;var qI=QE,tv=ZE,qb="Array Iterator",YI=KI.set,P_=KI.getterFor(qb);qI(Array,"Array",function(t,r){YI(this,{type:qb,target:ev(t),index:0,kind:r})},function(){var t=P_(this),r=t.target,s=t.kind,a=t.index++;return!r||a>=r.length?(t.target=void 0,tv(void 0,!0)):tv(s=="keys"?a:s=="values"?r[a]:[a,r[a]],!1)},"values"),Iu.Arguments=Iu.Array;var $o=it,nv=function(t,r,s){return $o.f(t,r,s)},RD=nn,rv=nv,Ko=je,XI=wr("species"),rn=O,Bm=TypeError,O_=function(t,r){if(rn(r,t))return t;throw Bm("Incorrect invocation")},JI=ke,Yb=pu,k_=I(Function.toString);JI(Yb.inspectSource)||(Yb.inspectSource=function(t){return k_(t)});var N_=Yb.inspectSource,Xb=I,QI=u,Jb=ke,ZI=Hc,Qb=N_,iv=function(){},Eo=[],Qc=nn("Reflect","construct"),Au=/^\s*(?:class|function)\b/,eA=Xb(Au.exec),tA=!Au.exec(iv),Sa=function(t){if(!Jb(t))return!1;try{return Qc(iv,Eo,t),!0}catch{return!1}},Zb=function(t){if(!Jb(t))return!1;switch(ZI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return tA||!!eA(Au,Qb(t))}catch{return!0}};Zb.sham=!0;var Qa,Wm,eT,sv,D_=!Qc||QI(function(){var t;return Sa(Sa.call)||!Sa(Object)||!Sa(function(){t=!0})||t})?Zb:Sa,nA=D_,ID=Fa,ov=TypeError,av=_n,Zc=function(t){if(nA(t))return t;throw ov(ID(t)+" is not a constructor")},jr=dt,lo=wr("species"),fs=function(t,r){var s,a=av(t).constructor;return a===void 0||jr(s=av(a)[lo])?r:Zc(s)},xs=I([].slice),wc=TypeError,Wl=function(t,r){if(t<r)throw wc("Not enough arguments");return t},Ls=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ct),vo=L,tf=ne,cv=De,lv=ke,x_=ki,ba=u,uv=g_,zm=xs,Pu=Eu,dv=Wl,tT=Ls,Ah=Bp,Gm=vo.setImmediate,Ou=vo.clearImmediate,hv=vo.process,nf=vo.Dispatch,nT=vo.Function,L_=vo.MessageChannel,pv=vo.String,So=0,el={},tl="onreadystatechange";ba(function(){Qa=vo.location});var qo=function(t){if(x_(el,t)){var r=el[t];delete el[t],r()}},fv=function(t){return function(){qo(t)}},mv=function(t){qo(t.data)},gv=function(t){vo.postMessage(pv(t),Qa.protocol+"//"+Qa.host)};Gm&&Ou||(Gm=function(t){dv(arguments.length,1);var r=lv(t)?t:nT(t),s=zm(arguments,1);return el[++So]=function(){tf(r,void 0,s)},Wm(So),So},Ou=function(t){delete el[t]},Ah?Wm=function(t){hv.nextTick(fv(t))}:nf&&nf.now?Wm=function(t){nf.now(fv(t))}:L_&&!tT?(sv=(eT=new L_).port2,eT.port1.onmessage=mv,Wm=cv(sv.postMessage,sv)):vo.addEventListener&&lv(vo.postMessage)&&!vo.importScripts&&Qa&&Qa.protocol!=="file:"&&!ba(gv)?(Wm=gv,vo.addEventListener("message",mv,!1)):Wm=tl in Pu("script")?function(t){uv.appendChild(Pu("script"))[tl]=function(){uv.removeChild(this),qo(t)}}:function(t){setTimeout(fv(t),0)});var _v={set:Gm,clear:Ou},Od=function(){this.head=null,this.tail=null};Od.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var rf,M_,kd,U_,Ph,rT=Od,rA=/ipad|iphone|ipod/i.test(Ct)&&typeof Pebble<"u",iT=/web0s(?!.*chrome)/i.test(Ct),ku=L,iA=De,AD=xe.f,yv=_v.set,sA=rT,sf=Ls,PD=rA,Hm=iT,Ev=Bp,Qi=ku.MutationObserver||ku.WebKitMutationObserver,oA=ku.document,sT=ku.process,vv=ku.Promise,aA=AD(ku,"queueMicrotask"),Sv=aA&&aA.value;if(!Sv){var V_=new sA,bv=function(){var t,r;for(Ev&&(t=sT.domain)&&t.exit();r=V_.get();)try{r()}catch(s){throw V_.head&&rf(),s}t&&t.enter()};sf||Ev||Hm||!Qi||!oA?!PD&&vv&&vv.resolve?((U_=vv.resolve(void 0)).constructor=vv,Ph=iA(U_.then,U_),rf=function(){Ph(bv)}):Ev?rf=function(){sT.nextTick(bv)}:(yv=iA(yv,ku),rf=function(){yv(bv)}):(M_=!0,kd=oA.createTextNode(""),new Qi(bv).observe(kd,{characterData:!0}),rf=function(){kd.data=M_=!M_}),Sv=function(t){V_.head||rf(),V_.add(t)}}var Cc=Sv,Oh=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},of=L.Promise,Nd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Tv=!Nd&&!Bp&&typeof window=="object"&&typeof document=="object",af=L,kh=of,oT=ke,aT=za,OD=N_,cT=wr,kD=Tv,cA=Nd,wv=cr,j_=kh&&kh.prototype,Cv=cT("species"),lT=oT(af.PromiseRejectionEvent),uT=aT("Promise",function(){var t=OD(kh),r=t!==String(kh);if(!r&&wv===66||!j_.catch||!j_.finally)return!0;if(!wv||wv<51||!/native code/.test(t)){var s=new kh(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[Cv]=a,!(s.then(function(){})instanceof a))return!0}return!r&&(kD||cA)&&!lT}),F_={CONSTRUCTOR:uT,REJECTION_EVENT:lT},zl={},Rv=ds,Iv=TypeError,dT=function(t){var r,s;this.promise=new t(function(a,c){if(r!==void 0||s!==void 0)throw Iv("Bad Promise constructor");r=a,s=c}),this.resolve=Rv(r),this.reject=Rv(s)};zl.f=function(t){return new dT(t)};var $m,hT,ND=$n,cf=Bp,Nh=L,Dd=Se,DD=Ad,Av=Pd,p=function(t){var r=RD(t);Ko&&r&&!r[XI]&&rv(r,XI,{configurable:!0,get:function(){return this}})},g=ds,w=ke,N=Et,j=O_,H=fs,he=_v.set,Re=Cc,Ue=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},st=Oh,Dt=rT,Lt=Id,Nt=of,Qt=F_,an=zl,cn="Promise",ms=Qt.CONSTRUCTOR,Qe=Qt.REJECTION_EVENT,Fe=Lt.getterFor(cn),nt=Lt.set,jt=Nt&&Nt.prototype,ln=Nt,bn=jt,In=Nh.TypeError,Fn=Nh.document,Ms=Nh.process,Dr=an.f,Dh=Dr,xD=!!(Fn&&Fn.createEvent&&Nh.dispatchEvent),W3="unhandledrejection",z3=function(t){var r;return!(!N(t)||!w(r=t.then))&&r},G3=function(t,r){var s,a,c,d=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,T=t.domain;try{m?(h||(r.rejection===2&&Yae(r),r.rejection=1),m===!0?s=d:(T&&T.enter(),s=m(d),T&&(T.exit(),c=!0)),s===t.promise?v(In("Promise-chain cycle")):(a=z3(s))?Dd(a,s,y,v):y(s)):v(d)}catch(R){T&&!c&&T.exit(),v(R)}},H3=function(t,r){t.notified||(t.notified=!0,Re(function(){for(var s,a=t.reactions;s=a.get();)G3(s,t);t.notified=!1,r&&!t.rejection&&qae(t)}))},$3=function(t,r,s){var a,c;xD?((a=Fn.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),Nh.dispatchEvent(a)):a={promise:r,reason:s},!Qe&&(c=Nh["on"+t])?c(a):t===W3&&Ue("Unhandled promise rejection",s)},qae=function(t){Dd(he,Nh,function(){var r,s=t.facade,a=t.value;if(K3(t)&&(r=st(function(){cf?Ms.emit("unhandledRejection",a,s):$3(W3,s,a)}),t.rejection=cf||K3(t)?2:1,r.error))throw r.value})},K3=function(t){return t.rejection!==1&&!t.parent},Yae=function(t){Dd(he,Nh,function(){var r=t.facade;cf?Ms.emit("rejectionHandled",r):$3("rejectionhandled",r,t.value)})},Pv=function(t,r,s){return function(a){t(r,a,s)}},Ov=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,H3(t,!0))},LD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw In("Promise can't be resolved itself");var a=z3(r);a?Re(function(){var c={done:!1};try{Dd(a,r,Pv(LD,c,t),Pv(Ov,c,t))}catch(d){Ov(c,d,t)}}):(t.value=r,t.state=1,H3(t,!1))}catch(c){Ov({done:!1},c,t)}}};ms&&(bn=(ln=function(t){j(this,bn),g(t),Dd($m,this);var r=Fe(this);try{t(Pv(LD,r),Pv(Ov,r))}catch(s){Ov(r,s)}}).prototype,($m=function(t){nt(this,{type:cn,done:!1,notified:!1,parent:!1,reactions:new Dt,rejection:!1,state:0,value:void 0})}).prototype=DD(bn,"then",function(t,r){var s=Fe(this),a=Dr(H(this,ln));return s.parent=!0,a.ok=!w(t)||t,a.fail=w(r)&&r,a.domain=cf?Ms.domain:void 0,s.state==0?s.reactions.add(a):Re(function(){G3(a,s)}),a.promise}),hT=function(){var t=new $m,r=Fe(t);this.promise=t,this.resolve=Pv(LD,r),this.reject=Pv(Ov,r)},an.f=Dr=function(t){return t===ln||t===void 0?new hT(t):Dh(t)}),ND({global:!0,wrap:!0,forced:ms},{Promise:ln}),Av(ln,cn,!1,!0),p(cn);var q3=wr("iterator"),Y3=!1;try{var Xae=0,X3={next:function(){return{done:!!Xae++}},return:function(){Y3=!0}};X3[q3]=function(){return this},Array.from(X3,function(){throw 2})}catch{}var Jae=of,Qae=function(t,r){if(!Y3)return!1;var s=!1;try{var a={};a[q3]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},lA=F_.CONSTRUCTOR||!Qae(function(t){Jae.all(t).then(void 0,function(){})}),Zae=Se,ece=ds,tce=zl,nce=Oh,rce=Ch;$n({target:"Promise",stat:!0,forced:lA},{all:function(t){var r=this,s=tce.f(r),a=s.resolve,c=s.reject,d=nce(function(){var h=ece(r.resolve),m=[],y=0,v=1;rce(t,function(T){var R=y++,P=!1;v++,Zae(h,r,T).then(function(D){P||(P=!0,m[R]=D,--v||a(m))},c)}),--v||a(m)});return d.error&&c(d.value),s.promise}});var ice=$n,sce=F_.CONSTRUCTOR;of&&of.prototype,ice({target:"Promise",proto:!0,forced:sce,real:!0},{catch:function(t){return this.then(void 0,t)}});var oce=Se,ace=ds,cce=zl,lce=Oh,uce=Ch;$n({target:"Promise",stat:!0,forced:lA},{race:function(t){var r=this,s=cce.f(r),a=s.reject,c=lce(function(){var d=ace(r.resolve);uce(t,function(h){oce(d,r,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var dce=Se,hce=zl;$n({target:"Promise",stat:!0,forced:F_.CONSTRUCTOR},{reject:function(t){var r=hce.f(this);return dce(r.reject,void 0,t),r.promise}});var pce=_n,fce=Et,mce=zl,J3=function(t,r){if(pce(t),fce(r)&&r.constructor===t)return r;var s=mce.f(t);return(0,s.resolve)(r),s.promise},gce=$n,_ce=of,yce=F_.CONSTRUCTOR,Ece=J3,vce=nn("Promise"),Sce=!yce;gce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Ece(Sce&&this===vce?_ce:this,t)}});var bce=Se,Tce=ds,wce=zl,Cce=Oh,Rce=Ch;$n({target:"Promise",stat:!0,forced:lA},{allSettled:function(t){var r=this,s=wce.f(r),a=s.resolve,c=s.reject,d=Cce(function(){var h=Tce(r.resolve),m=[],y=0,v=1;Rce(t,function(T){var R=y++,P=!1;v++,bce(h,r,T).then(function(D){P||(P=!0,m[R]={status:"fulfilled",value:D},--v||a(m))},function(D){P||(P=!0,m[R]={status:"rejected",reason:D},--v||a(m))})}),--v||a(m)});return d.error&&c(d.value),s.promise}});var Ice=Se,Ace=ds,Pce=nn,Oce=zl,kce=Oh,Nce=Ch,Q3="No one promise resolved";$n({target:"Promise",stat:!0,forced:lA},{any:function(t){var r=this,s=Pce("AggregateError"),a=Oce.f(r),c=a.resolve,d=a.reject,h=kce(function(){var m=Ace(r.resolve),y=[],v=0,T=1,R=!1;Nce(t,function(P){var D=v++,G=!1;T++,Ice(m,r,P).then(function(F){G||R||(R=!0,c(F))},function(F){G||R||(G=!0,y[D]=F,--T||d(new s(y,Q3)))})}),--T||d(new s(y,Q3))});return h.error&&d(h.value),a.promise}});var Dce=$n,MD=of,xce=u,Lce=nn,Mce=ke,Uce=fs,Z3=J3,Vce=MD&&MD.prototype;Dce({target:"Promise",proto:!0,real:!0,forced:!!MD&&xce(function(){Vce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Uce(this,Lce("Promise")),s=Mce(t);return this.then(s?function(a){return Z3(r,t()).then(function(){return a})}:t,s?function(a){return Z3(r,t()).then(function(){throw a})}:t)}});var UD=I,jce=Gc,Fce=Ha,Bce=Ut,Wce=UD("".charAt),e5=UD("".charCodeAt),zce=UD("".slice),t5=function(t){return function(r,s){var a,c,d=Fce(Bce(r)),h=jce(s),m=d.length;return h<0||h>=m?t?"":void 0:(a=e5(d,h))<55296||a>56319||h+1===m||(c=e5(d,h+1))<56320||c>57343?t?Wce(d,h):a:t?zce(d,h,h+2):c-56320+(a-55296<<10)+65536}},VD={codeAt:t5(!1),charAt:t5(!0)},Gce=VD.charAt,Hce=Ha,n5=Id,$ce=QE,r5=ZE,i5="String Iterator",Kce=n5.set,qce=n5.getterFor(i5);$ce(String,"String",function(t){Kce(this,{type:i5,string:Hce(t),index:0})},function(){var t,r=qce(this),s=r.string,a=r.index;return a>=s.length?r5(void 0,!0):(t=Gce(s,a),r.index+=t.length,r5(t,!1))});var Yce=vt.Promise,Xce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jce=L,Qce=Hc,Zce=ma,s5=bh,o5=wr("toStringTag");for(var jD in Xce){var a5=Jce[jD],FD=a5&&a5.prototype;FD&&Qce(FD)!==o5&&Zce(FD,o5,jD),s5[jD]=s5.Array}var c5=Yce,pt=l(c5),ele=vc("Array").values,tle=Hc,nle=ki,rle=O,ile=ele,BD=Array.prototype,sle={DOMTokenList:!0,NodeList:!0},ole=function(t){var r=t.values;return t===BD||rle(BD,t)&&r===BD.values||nle(sle,tle(t))?ile:r},nl=l(ole),ale=u,cle=wr("iterator"),WD=!ale(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),a="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),a+=d+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[cle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("http://x",void 0).host!=="x"}),lle=Ad,ule=yc,dle=it,hle=He,uA=function(t,r,s){var a=ule(r);a in t?dle.f(t,a,hle(0,s)):t[a]=s},l5=ge,ple=Ei,fle=uA,mle=Array,gle=Math.max,zD=function(t,r,s){for(var a=ple(t),c=l5(r,a),d=l5(s===void 0?a:s,a),h=mle(gle(d-c,0)),m=0;c<d;c++,m++)fle(h,m,t[c]);return h.length=m,h},u5=zD,_le=Math.floor,GD=function(t,r){var s=t.length,a=_le(s/2);return s<8?yle(t,r):Ele(t,GD(u5(t,0,a),r),GD(u5(t,a),r),r)},yle=function(t,r){for(var s,a,c=t.length,d=1;d<c;){for(a=d,s=t[d];a&&r(t[a-1],s)>0;)t[a]=t[--a];a!==d++&&(t[a]=s)}return t},Ele=function(t,r,s,a){for(var c=r.length,d=s.length,h=0,m=0;h<c||m<d;)t[h+m]=h<c&&m<d?a(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},d5=GD,HD=$n,kv=L,dA=Se,xh=I,Nv=je,h5=WD,p5=Ad,vle=nv,Sle=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:lle(t,a,r[a],s);return t},ble=Pd,Tle=qE,$D=Id,f5=O_,KD=ke,wle=ki,Cle=De,Rle=Hc,Ile=_n,m5=Et,Rc=Ha,Ale=ya,g5=He,qD=S_,Ple=Cd,Dv=Wl,Ole=d5,kle=wr("iterator"),pT="URLSearchParams",_5=pT+"Iterator",y5=$D.set,Nu=$D.getterFor(pT),Nle=$D.getterFor(_5),Dle=Object.getOwnPropertyDescriptor,YD=function(t){if(!Nv)return kv[t];var r=Dle(kv,t);return r&&r.value},E5=YD("fetch"),hA=YD("Request"),fT=YD("Headers"),XD=hA&&hA.prototype,v5=fT&&fT.prototype,xle=kv.RegExp,Lle=kv.TypeError,S5=kv.decodeURIComponent,Mle=kv.encodeURIComponent,Ule=xh("".charAt),b5=xh([].join),B_=xh([].push),JD=xh("".replace),Vle=xh([].shift),T5=xh([].splice),w5=xh("".split),jle=xh("".slice),Fle=/\+/g,C5=Array(4),Ble=function(t){return C5[t-1]||(C5[t-1]=xle("((?:%[\\da-f]{2}){"+t+"})","gi"))},Wle=function(t){try{return S5(t)}catch{return t}},R5=function(t){var r=JD(t,Fle," "),s=4;try{return S5(r)}catch{for(;s;)r=JD(r,Ble(s--),Wle);return r}},zle=/[!'()~]|%20/g,Gle={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Hle=function(t){return Gle[t]},I5=function(t){return JD(Mle(t),zle,Hle)},QD=Tle(function(t,r){y5(this,{type:_5,iterator:qD(Nu(t).entries),kind:r})},"Iterator",function(){var t=Nle(this),r=t.kind,s=t.iterator.next(),a=s.value;return s.done||(s.value=r==="keys"?a.key:r==="values"?a.value:[a.key,a.value]),s},!0),A5=function(t){this.entries=[],this.url=null,t!==void 0&&(m5(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Ule(t,0)==="?"?jle(t,1):t:Rc(t)))};A5.prototype={type:pT,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,d,h,m,y=Ple(t);if(y)for(s=(r=qD(t,y)).next;!(a=dA(s,r)).done;){if(d=(c=qD(Ile(a.value))).next,(h=dA(d,c)).done||(m=dA(d,c)).done||!dA(d,c).done)throw Lle("Expected sequence with length 2");B_(this.entries,{key:Rc(h.value),value:Rc(m.value)})}else for(var v in t)wle(t,v)&&B_(this.entries,{key:v,value:Rc(t[v])})},parseQuery:function(t){if(t)for(var r,s,a=w5(t,"&"),c=0;c<a.length;)(r=a[c++]).length&&(s=w5(r,"="),B_(this.entries,{key:R5(Vle(s)),value:R5(b5(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],B_(s,I5(t.key)+"="+I5(t.value));return b5(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var pA=function(){f5(this,xv);var t=y5(this,new A5(arguments.length>0?arguments[0]:void 0));Nv||(this.size=t.entries.length)},xv=pA.prototype;if(Sle(xv,{append:function(t,r){var s=Nu(this);Dv(arguments.length,2),B_(s.entries,{key:Rc(t),value:Rc(r)}),Nv||this.length++,s.updateURL()},delete:function(t){for(var r=Nu(this),s=Dv(arguments.length,1),a=r.entries,c=Rc(t),d=s<2?void 0:arguments[1],h=d===void 0?d:Rc(d),m=0;m<a.length;){var y=a[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(T5(a,m,1),h!==void 0)break}Nv||(this.size=a.length),r.updateURL()},get:function(t){var r=Nu(this).entries;Dv(arguments.length,1);for(var s=Rc(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=Nu(this).entries;Dv(arguments.length,1);for(var s=Rc(t),a=[],c=0;c<r.length;c++)r[c].key===s&&B_(a,r[c].value);return a},has:function(t){for(var r=Nu(this).entries,s=Dv(arguments.length,1),a=Rc(t),c=s<2?void 0:arguments[1],d=c===void 0?c:Rc(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=Nu(this);Dv(arguments.length,1);for(var a,c=s.entries,d=!1,h=Rc(t),m=Rc(r),y=0;y<c.length;y++)(a=c[y]).key===h&&(d?T5(c,y--,1):(d=!0,a.value=m));d||B_(c,{key:h,value:m}),Nv||(this.size=c.length),s.updateURL()},sort:function(){var t=Nu(this);Ole(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=Nu(this).entries,a=Cle(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new QD(this,"keys")},values:function(){return new QD(this,"values")},entries:function(){return new QD(this,"entries")}},{enumerable:!0}),p5(xv,kle,xv.entries,{}),p5(xv,"toString",function(){return Nu(this).serialize()},{enumerable:!0}),Nv&&vle(xv,"size",{get:function(){return Nu(this).entries.length},configurable:!0,enumerable:!0}),ble(pA,pT),HD({global:!0,forced:!h5},{URLSearchParams:pA}),!h5&&KD(fT)){var $le=xh(v5.has),Kle=xh(v5.set),P5=function(t){if(m5(t)){var r,s=t.body;if(Rle(s)===pT)return r=t.headers?new fT(t.headers):new fT,$le(r,"content-type")||Kle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Ale(t,{body:g5(0,Rc(s)),headers:g5(0,r)})}return t};if(KD(E5)&&HD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return E5(t,arguments.length>1?P5(arguments[1]):{})}}),KD(hA)){var ZD=function(t){return f5(this,XD),new hA(t,arguments.length>1?P5(arguments[1]):{})};XD.constructor=ZD,ZD.prototype=XD,HD({global:!0,dontCallGetSet:!0,forced:!0},{Request:ZD})}}var Du,qle={URLSearchParams:pA,getState:Nu},Yle=vt.URLSearchParams,O5=je,Xle=I,Jle=Se,Qle=u,ex=qc,Zle=Kc,eue=Be,tue=Fi,nue=on,Lv=Object.assign,k5=Object.defineProperty,rue=Xle([].concat),iue=!Lv||Qle(function(){if(O5&&Lv({b:1},Lv(k5({},"a",{enumerable:!0,get:function(){k5(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach(function(c){r[c]=c}),Lv({},t)[s]!=7||ex(Lv({},r)).join("")!=a})?function(t,r){for(var s=tue(t),a=arguments.length,c=1,d=Zle.f,h=eue.f;a>c;)for(var m,y=nue(arguments[c++]),v=d?rue(ex(y),d(y)):ex(y),T=v.length,R=0;T>R;)m=v[R++],O5&&!Jle(h,y,m)||(s[m]=y[m]);return s}:Lv,sue=_n,oue=b_,aue=De,cue=Se,lue=Fi,uue=function(t,r,s,a){try{return a?r(sue(s)[0],s[1]):r(s)}catch(c){oue(t,"throw",c)}},due=v_,hue=D_,pue=Ei,N5=uA,fue=S_,mue=Cd,D5=Array,W_=I,tx=2147483647,gue=/[^\0-\u007E]/,x5=/[.\u3002\uFF0E\uFF61]/g,L5="Overflow: input needs wider integers to process",M5=RangeError,_ue=W_(x5.exec),Mv=Math.floor,nx=String.fromCharCode,U5=W_("".charCodeAt),V5=W_([].join),Km=W_([].push),yue=W_("".replace),Eue=W_("".split),vue=W_("".toLowerCase),j5=function(t){return t+22+75*(t<26)},Sue=function(t,r,s){var a=0;for(t=s?Mv(t/700):t>>1,t+=Mv(t/r);t>455;)t=Mv(t/35),a+=36;return Mv(a+36*t/(t+38))},bue=function(t){var r=[];t=function(Q){for(var ee=[],fe=0,ye=Q.length;fe<ye;){var ve=U5(Q,fe++);if(ve>=55296&&ve<=56319&&fe<ye){var _e=U5(Q,fe++);(64512&_e)==56320?Km(ee,((1023&ve)<<10)+(1023&_e)+65536):(Km(ee,ve),fe--)}else Km(ee,ve)}return ee}(t);var s,a,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&Km(r,nx(a));var y=r.length,v=y;for(y&&Km(r,"-");v<c;){var T=tx;for(s=0;s<t.length;s++)(a=t[s])>=d&&a<T&&(T=a);var R=v+1;if(T-d>Mv((tx-h)/R))throw M5(L5);for(h+=(T-d)*R,d=T,s=0;s<t.length;s++){if((a=t[s])<d&&++h>tx)throw M5(L5);if(a==d){for(var P=h,D=36;;){var G=D<=m?1:D>=m+26?26:D-m;if(P<G)break;var F=P-G,W=36-G;Km(r,nx(j5(G+F%W))),P=Mv(F/W),D+=36}Km(r,nx(j5(P))),m=Sue(h,R,v==y),h=0,v++}}h++,d++}return V5(r,"")},Tue=$n,rx=je,wue=WD,ix=L,F5=De,xu=I,fA=Ad,Lu=nv,Cue=O_,sx=ki,ox=iue,Uv=function(t){var r=lue(t),s=hue(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=aue(c,a>2?arguments[2]:void 0));var h,m,y,v,T,R,P=mue(r),D=0;if(!P||this===D5&&due(P))for(h=pue(r),m=s?new this(h):D5(h);h>D;D++)R=d?c(r[D],D):r[D],N5(m,D,R);else for(T=(v=fue(r,P)).next,m=s?new this:[];!(y=cue(T,v)).done;D++)R=d?uue(v,c,[y.value,D],!0):y.value,N5(m,D,R);return m.length=D,m},xd=zD,Rue=VD.codeAt,Iue=function(t){var r,s,a=[],c=Eue(yue(vue(t),x5,"."),".");for(r=0;r<c.length;r++)s=c[r],Km(a,_ue(gue,s)?"xn--"+bue(s):s);return V5(a,".")},lf=Ha,Aue=Pd,Pue=Wl,B5=qle,W5=Id,Oue=W5.set,mA=W5.getterFor("URL"),kue=B5.URLSearchParams,Nue=B5.getState,mT=ix.URL,ax=ix.TypeError,gA=ix.parseInt,Due=Math.floor,z5=Math.pow,Mu=xu("".charAt),Ld=xu(/./.exec),gT=xu([].join),xue=xu(1 .toString),Lue=xu([].pop),Vv=xu([].push),cx=xu("".replace),Mue=xu([].shift),Uue=xu("".split),_T=xu("".slice),_A=xu("".toLowerCase),Vue=xu([].unshift),lx="Invalid scheme",z_="Invalid host",G5="Invalid port",H5=/[a-z]/i,jue=/[\d+-.a-z]/i,ux=/\d/,Fue=/^0x/i,Bue=/^[0-7]+$/,Wue=/^\d+$/,$5=/^[\da-f]+$/i,zue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Gue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Hue=/^[\u0000-\u0020]+/,$ue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Kue=/[\t\n\r]/g,yT=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Vue(r,t%256),t=Due(t/256);return gT(r,".")}if(typeof t=="object"){for(r="",a=function(d){for(var h=null,m=1,y=null,v=0,T=0;T<8;T++)d[T]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=T),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=xue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},yA={},K5=ox({},yA,{" ":1,'"':1,"<":1,">":1,"`":1}),q5=ox({},K5,{"#":1,"?":1,"{":1,"}":1}),dx=ox({},q5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),qm=function(t,r){var s=Rue(t,0);return s>32&&s<127&&!sx(r,t)?t:encodeURIComponent(t)},EA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ET=function(t,r){var s;return t.length==2&&Ld(H5,Mu(t,0))&&((s=Mu(t,1))==":"||!r&&s=="|")},Y5=function(t){var r;return t.length>1&&ET(_T(t,0,2))&&(t.length==2||(r=Mu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},que=function(t){return t==="."||_A(t)==="%2e"},hx={},X5={},px={},J5={},Q5={},fx={},Z5={},eB={},vA={},SA={},mx={},gx={},_x={},yx={},tB={},Ex={},jv={},Lh={},nB={},G_={},uf={},vx=function(t,r,s){var a,c,d,h=lf(t);if(r){if(c=this.parse(h))throw ax(c);this.searchParams=null}else{if(s!==void 0&&(a=new vx(s,!0)),c=this.parse(h,null,a))throw ax(c);(d=Nue(new kue)).bindURL(this),this.searchParams=d}};vx.prototype={type:"URL",parse:function(t,r,s){var a,c,d,h,m,y=this,v=r||hx,T=0,R="",P=!1,D=!1,G=!1;for(t=lf(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=cx(t,Hue,""),t=cx(t,$ue,"$1")),t=cx(t,Kue,""),a=Uv(t);T<=a.length;){switch(c=a[T],v){case hx:if(!c||!Ld(H5,c)){if(r)return lx;v=px;continue}R+=_A(c),v=X5;break;case X5:if(c&&(Ld(jue,c)||c=="+"||c=="-"||c=="."))R+=_A(c);else{if(c!=":"){if(r)return lx;R="",v=px,T=0;continue}if(r&&(y.isSpecial()!=sx(EA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&EA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=yx:y.isSpecial()&&s&&s.scheme==y.scheme?v=J5:y.isSpecial()?v=eB:a[T+1]=="/"?(v=Q5,T++):(y.cannotBeABaseURL=!0,Vv(y.path,""),v=nB)}break;case px:if(!s||s.cannotBeABaseURL&&c!="#")return lx;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=xd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=uf;break}v=s.scheme=="file"?yx:fx;continue;case J5:if(c!="/"||a[T+1]!="/"){v=fx;continue}v=vA,T++;break;case Q5:if(c=="/"){v=SA;break}v=Lh;continue;case fx:if(y.scheme=s.scheme,c==Du)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=xd(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=Z5;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=xd(s.path),y.query="",v=G_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=xd(s.path),y.path.length--,v=Lh;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=xd(s.path),y.query=s.query,y.fragment="",v=uf}break;case Z5:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=Lh;continue}v=SA}else v=vA;break;case eB:if(v=vA,c!="/"||Mu(R,T+1)!="/")continue;T++;break;case vA:if(c!="/"&&c!="\\"){v=SA;continue}break;case SA:if(c=="@"){P&&(R="%40"+R),P=!0,d=Uv(R);for(var F=0;F<d.length;F++){var W=d[F];if(W!=":"||G){var Q=qm(W,dx);G?y.password+=Q:y.username+=Q}else G=!0}R=""}else if(c==Du||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";T-=Uv(R).length+1,R="",v=mx}else R+=c;break;case mx:case gx:if(r&&y.scheme=="file"){v=Ex;continue}if(c!=":"||D){if(c==Du||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return z_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=jv,r)return;continue}c=="["?D=!0:c=="]"&&(D=!1),R+=c}else{if(R=="")return z_;if(h=y.parseHost(R))return h;if(R="",v=_x,r==gx)return}break;case _x:if(!Ld(ux,c)){if(c==Du||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var ee=gA(R,10);if(ee>65535)return G5;y.port=y.isSpecial()&&ee===EA[y.scheme]?null:ee,R=""}if(r)return;v=jv;continue}return G5}R+=c;break;case yx:if(y.scheme="file",c=="/"||c=="\\")v=tB;else{if(!s||s.scheme!="file"){v=Lh;continue}if(c==Du)y.host=s.host,y.path=xd(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=xd(s.path),y.query="",v=G_;else{if(c!="#"){Y5(gT(xd(a,T),""))||(y.host=s.host,y.path=xd(s.path),y.shortenPath()),v=Lh;continue}y.host=s.host,y.path=xd(s.path),y.query=s.query,y.fragment="",v=uf}}break;case tB:if(c=="/"||c=="\\"){v=Ex;break}s&&s.scheme=="file"&&!Y5(gT(xd(a,T),""))&&(ET(s.path[0],!0)?Vv(y.path,s.path[0]):y.host=s.host),v=Lh;continue;case Ex:if(c==Du||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&ET(R))v=Lh;else if(R==""){if(y.host="",r)return;v=jv}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=jv}continue}R+=c;break;case jv:if(y.isSpecial()){if(v=Lh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=Du&&(v=Lh,c!="/"))continue}else y.fragment="",v=uf;else y.query="",v=G_;break;case Lh:if(c==Du||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=_A(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||Vv(y.path,"")):que(R)?c=="/"||c=="\\"&&y.isSpecial()||Vv(y.path,""):(y.scheme=="file"&&!y.path.length&&ET(R)&&(y.host&&(y.host=""),R=Mu(R,0)+":"),Vv(y.path,R)),R="",y.scheme=="file"&&(c==Du||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)Mue(y.path);c=="?"?(y.query="",v=G_):c=="#"&&(y.fragment="",v=uf)}else R+=qm(c,q5);break;case nB:c=="?"?(y.query="",v=G_):c=="#"?(y.fragment="",v=uf):c!=Du&&(y.path[0]+=qm(c,yA));break;case G_:r||c!="#"?c!=Du&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":qm(c,yA)):(y.fragment="",v=uf);break;case uf:c!=Du&&(y.fragment+=qm(c,K5))}T++}},parseHost:function(t){var r,s,a;if(Mu(t,0)=="["){if(Mu(t,t.length-1)!="]"||(r=function(c){var d,h,m,y,v,T,R,P=[0,0,0,0,0,0,0,0],D=0,G=null,F=0,W=function(){return Mu(c,F)};if(W()==":"){if(Mu(c,1)!=":")return;F+=2,G=++D}for(;W();){if(D==8)return;if(W()!=":"){for(d=h=0;h<4&&Ld($5,W());)d=16*d+gA(W(),16),F++,h++;if(W()=="."){if(h==0||(F-=h,D>6))return;for(m=0;W();){if(y=null,m>0){if(!(W()=="."&&m<4))return;F++}if(!Ld(ux,W()))return;for(;Ld(ux,W());){if(v=gA(W(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;F++}P[D]=256*P[D]+y,++m!=2&&m!=4||D++}if(m!=4)return;break}if(W()==":"){if(F++,!W())return}else if(W())return;P[D++]=d}else{if(G!==null)return;F++,G=++D}}if(G!==null)for(T=D-G,D=7;D!=0&&T>0;)R=P[D],P[D--]=P[G+T-1],P[G+--T]=R;else if(D!=8)return;return P}(_T(t,1,-1)),!r))return z_;this.host=r}else if(this.isSpecial()){if(t=Iue(t),Ld(zue,t)||(r=function(c){var d,h,m,y,v,T,R,P=Uue(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(d=P.length)>4)return c;for(h=[],m=0;m<d;m++){if((y=P[m])=="")return c;if(v=10,y.length>1&&Mu(y,0)=="0"&&(v=Ld(Fue,y)?16:8,y=_T(y,v==8?1:2)),y==="")T=0;else{if(!Ld(v==10?Wue:v==8?Bue:$5,y))return c;T=gA(y,v)}Vv(h,T)}for(m=0;m<d;m++)if(T=h[m],m==d-1){if(T>=z5(256,5-d))return null}else if(T>255)return null;for(R=Lue(h),m=0;m<h.length;m++)R+=h[m]*z5(256,3-m);return R}(t),r===null))return z_;this.host=r}else{if(Ld(Gue,t))return z_;for(r="",s=Uv(t),a=0;a<s.length;a++)r+=qm(s[a],yA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return sx(EA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&ET(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,d=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(a?":"+a:"")+"@"),v+=yT(c),d!==null&&(v+=":"+d)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+gT(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw ax(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Fv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+yT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(lf(t)+":",hx)},getUsername:function(){return this.username},setUsername:function(t){var r=Uv(lf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=qm(r[s],dx)}},getPassword:function(){return this.password},setPassword:function(t){var r=Uv(lf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=qm(r[s],dx)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?yT(t):yT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,mx)},getHostname:function(){var t=this.host;return t===null?"":yT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,gx)},getPort:function(){var t=this.port;return t===null?"":lf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=lf(t))==""?this.port=null:this.parse(t,_x))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+gT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,jv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=lf(t))==""?this.query=null:(Mu(t,0)=="?"&&(t=_T(t,1)),this.query="",this.parse(t,G_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=lf(t))!=""?(Mu(t,0)=="#"&&(t=_T(t,1)),this.fragment="",this.parse(t,uf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Fv=function(t){var r=Cue(this,Ic),s=Pue(arguments.length,1)>1?arguments[1]:void 0,a=Oue(r,new vx(t,!1,s));rx||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},Ic=Fv.prototype,Uu=function(t,r){return{get:function(){return mA(this)[t]()},set:r&&function(s){return mA(this)[r](s)},configurable:!0,enumerable:!0}};if(rx&&(Lu(Ic,"href",Uu("serialize","setHref")),Lu(Ic,"origin",Uu("getOrigin")),Lu(Ic,"protocol",Uu("getProtocol","setProtocol")),Lu(Ic,"username",Uu("getUsername","setUsername")),Lu(Ic,"password",Uu("getPassword","setPassword")),Lu(Ic,"host",Uu("getHost","setHost")),Lu(Ic,"hostname",Uu("getHostname","setHostname")),Lu(Ic,"port",Uu("getPort","setPort")),Lu(Ic,"pathname",Uu("getPathname","setPathname")),Lu(Ic,"search",Uu("getSearch","setSearch")),Lu(Ic,"searchParams",Uu("getSearchParams")),Lu(Ic,"hash",Uu("getHash","setHash"))),fA(Ic,"toJSON",function(){return mA(this).serialize()},{enumerable:!0}),fA(Ic,"toString",function(){return mA(this).serialize()},{enumerable:!0}),mT){var rB=mT.createObjectURL,iB=mT.revokeObjectURL;rB&&fA(Fv,"createObjectURL",F5(rB,mT)),iB&&fA(Fv,"revokeObjectURL",F5(iB,mT))}Aue(Fv,"URL"),Tue({global:!0,forced:!wue,sham:!rx},{URL:Fv});var Yue=$n,Xue=u,Jue=Wl,sB=Ha,Que=WD,oB=nn("URL");Yue({target:"URL",stat:!0,forced:!(Que&&Xue(function(){oB.canParse()}))},{canParse:function(t){var r=Jue(arguments.length,1),s=sB(t),a=r<2||arguments[1]===void 0?void 0:sB(arguments[1]);try{return!!new oB(s,a)}catch{return!1}}});var bA=l(vt.URL);let aB=!0,cB=!0;function TA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function H_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const T=s(v);T&&(m.handleEvent?m.handleEvent(T):m(T))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,y])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Zue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(aB=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function ede(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(cB=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function lB(){if(typeof window=="object"){if(aB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Sx(t,r){cB&&console.warn(t+" is deprecated, please use "+r+" instead.")}function uB(t){return Object.prototype.toString.call(t)==="[object Object]"}function dB(t){var r;return uB(t)?Sc(r=Object.keys(t)).call(r,function(s,a){const c=uB(t[a]),d=c?dB(t[a]):t[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):t}function bx(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?bx(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach(c=>{bx(t,t.get(c),s)})}))}function hB(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{t.forEach(m=>{m.type===a&&m.trackId===h.id&&bx(t,m,c)})}),c}const pB=lB;function fB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const T=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[T("min",y)]=v.ideal,m.optional.push(R),R={},R[T("max",y)]=v.ideal,m.optional.push(R)):(R[T("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[T("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[T(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,T,R){T in v&&!(R in v)&&(v[R]=v[T],delete v[T])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let T;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?T=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(T=["front"]),T)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(D=>D.kind==="videoinput")).find(D=>T.some(G=>{var F;return at(F=D.label.toLowerCase()).call(F,G)}));return!P&&R.length&&at(T).call(T,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=a(h.video),pB("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return pB("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,T=>{y&&y(d(T))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(T=>{T.stop()}),new DOMException("","NotFoundError");return v},v=>pt.reject(d(v))))}}}function mB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function gB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else H_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function _B(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function yB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const y={};return m.result().forEach(v=>{const T={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{T[R]=v.stat(R)}),y[T.id]=T}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){a(h(d(y)))};return r.apply(this,[m,s])}return new pt((m,y)=>{r.apply(this,[function(v){m(h(d(v)))},y])}).then(a,c)}}function EB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>hB(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),H_(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>hB(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||a&&c?pt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():pt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function vB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(y=>{if(this.getSenders().find(T=>T.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function SB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return vB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}a.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function d(y,v){let T=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];T=T.replace(new RegExp(D.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:T})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const T=[].slice.call(arguments,1);if(T.length!==1||!T[0].getTracks().find(D=>D===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(y),pt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new t.MediaStream([y]);this._streams[v.id]=D,this._reverseStreams[D.id]=v,this.addStream(D)}return this.getSenders().find(D=>D.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],T={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[P=>{const D=d(this,P);R[0].apply(null,[D])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):v.apply(this,arguments).then(P=>d(this,P))}};t.RTCPeerConnection.prototype[y]=T[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let T=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];T=T.replace(new RegExp(P.id,"g"),D.id)}),new RTCSessionDescription({type:v.type,sdp:T})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:d(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(R=>y.track===R)&&(v=this._streams[T])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Tx(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function bB(t,r){H_(t,"negotiationneeded",s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var TB=Object.freeze({__proto__:null,fixNegotiationNeeded:bB,shimAddTrackRemoveTrack:SB,shimAddTrackRemoveTrackWithNative:vB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(a=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_B,shimGetStats:yB,shimGetUserMedia:fB,shimMediaStream:mB,shimOnTrack:gB,shimPeerConnection:Tx,shimSenderReceiverGetStats:EB});function wB(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){Sx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function CB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then(m=>{if(r.version<53&&!d)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,T)=>{m.set(T,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(d,h)}}function RB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):pt.resolve(new Map)}}function IB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s}),H_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function AB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){Sx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&at(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function PB(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function OB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function kB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function NB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function DB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var xB=Object.freeze({__proto__:null,shimAddTransceiver:OB,shimCreateAnswer:DB,shimCreateOffer:NB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,pt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:kB,shimGetUserMedia:wB,shimOnTrack:CB,shimPeerConnection:wx,shimRTCDataChannel:PB,shimReceiverGetStats:IB,shimRemoveStream:AB,shimSenderGetStats:RB});function LB(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),at(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var m;this._localStreams?at(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach(c=>{at(a).call(a,c.track)&&this.removeTrack(c)})})}}function MB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),at(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),r.apply(s,arguments)}}}function UB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const T=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[T]);return v?(R.then(y,v),pt.resolve()):R},r.createAnswer=function(y,v){const T=arguments.length>=2?arguments[2]:arguments[0],R=a.apply(this,[T]);return v?(R.then(y,v),pt.resolve()):R};let m=function(y,v,T){const R=c.apply(this,[y]);return T?(R.then(v,T),pt.resolve()):R};r.setLocalDescription=m,m=function(y,v,T){const R=d.apply(this,[y]);return T?(R.then(v,T),pt.resolve()):R},r.setRemoteDescription=m,m=function(y,v,T){const R=h.apply(this,[y]);return T?(R.then(v,T),pt.resolve()):R},r.addIceCandidate=m}function VB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(jB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function jB(t){return t&&t.video!==void 0?Object.assign({},t,{video:dB(t.video)}):t}function FB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(Sx("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function BB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function WB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function zB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var GB=Object.freeze({__proto__:null,shimAudioContext:zB,shimCallbacksAPI:UB,shimConstraints:jB,shimCreateOfferLegacy:WB,shimGetUserMedia:VB,shimLocalStreamsAPI:LB,shimRTCIceServerUrls:FB,shimRemoteStreamsAPI:MB,shimTrackEventTransceiver:BB}),HB=`	
\v\f\r \u2028\u2029\uFEFF`,tde=Ut,nde=Ha,Cx=HB,$B=I("".replace),rde=RegExp("^["+Cx+"]+"),ide=RegExp("(^|[^"+Cx+"])["+Cx+"]+$"),sde=function(t){return function(r){var s=nde(tde(r));return 1&t&&(s=$B(s,rde,"")),2&t&&(s=$B(s,ide,"$1")),s}},ode={trim:sde(3)},ade=OI.PROPER,cde=u,KB=HB,lde=ode.trim;$n({target:"String",proto:!0,forced:function(t){return cde(function(){return!!KB[t]()||""[t]()!==""||ade&&KB[t].name!==t})}("trim")},{trim:function(){return lde(this)}});var ude=vc("String").trim,dde=O,hde=ude,Rx=String.prototype,pde=function(t){var r=t.trim;return typeof t=="string"||t===Rx||dde(Rx,t)&&r===Rx.trim?hde:r},bo=l(pde),qB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},r.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter(c=>c.indexOf(a)===0)},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],d=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),T=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=T.length?r.parseFmtp(T[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const T=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(D=>parseInt(D,10)));T.length>0&&T[0].length>1&&T[0][0]===y&&(v=T[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let D={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&v&&(D.rtx={ssrc:v}),a.push(D),d&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},a.push(D))}}),a.length===0&&y&&a.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,a.forEach(P=>{P.maxBitrate=R})),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let d;const h=a!==void 0?a:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(qB);var YB=qB.exports,Bv=l(YB),fde=i({__proto__:null,default:Bv},[YB]);function wA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=Bv.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,H_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function Ix(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||H_(t,"icecandidate",r=>{if(r.candidate){const s=Bv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function CA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=Bv.splitSections(m.sdp);return y.shift(),y.some(v=>{const T=Bv.parseMLine(v);return T&&T.kind==="application"&&T.protocol.indexOf("SCTP")!==-1})},a=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},d=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const T=Bv.matchPrefix(m.sdp,"a=max-message-size:");return T.length>0?v=parseInt(T[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),y=c(m),v=d(arguments[0],m);let T;T=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>T}),this._sctp=R}return h.apply(this,arguments)}}function RA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},H_(t,"datachannel",a=>(r(a.channel,a.target),a))}function Ax(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Px(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(d=>bo(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function IA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?pt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),pt.resolve())})}function AA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var mde=Object.freeze({__proto__:null,removeExtmapAllowMixed:Px,shimAddIceCandidateNullOrEmpty:IA,shimConnectionState:Ax,shimMaxMessageSize:CA,shimParameterlessSetLocalDescription:AA,shimRTCIceCandidate:wA,shimRTCIceCandidateRelayProtocol:Ix,shimSendThrowTypeError:RA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=lB,a=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=TA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=TA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=TA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:a,commonShim:mde,extractVersion:TA,disableLog:Zue,disableWarnings:ede,sdp:fde};switch(a.browser){case"chrome":if(!TB||!Tx||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=TB,IA(t,a),AA(t),fB(t,a),mB(t),Tx(t,a),gB(t),SB(t,a),_B(t),yB(t),EB(t),bB(t,a),wA(t),Ix(t),Ax(t),CA(t,a),RA(t),Px(t,a);break;case"firefox":if(!xB||!wx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=xB,IA(t,a),AA(t),wB(t,a),wx(t,a),CB(t),AB(t),RB(t),IB(t),PB(t),OB(t),kB(t),NB(t),DB(t),wA(t),Ax(t),CA(t,a),RA(t);break;case"safari":if(!GB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=GB,IA(t,a),AA(t),FB(t),WB(t),UB(t),LB(t),MB(t),BB(t),VB(t),zB(t),wA(t),Ix(t),CA(t,a),RA(t),Px(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var XB=Fa,gde=TypeError,JB=Ct.match(/firefox\/(\d+)/i),_de=!!JB&&+JB[1],yde=/MSIE|Trident/.test(Ct),QB=Ct.match(/AppleWebKit\/(\d+)\./),Ede=!!QB&&+QB[1],vde=$n,ZB=I,Sde=ds,bde=Fi,e6=Ei,Tde=function(t,r){if(!delete t[r])throw gde("Cannot delete property "+XB(r)+" of "+XB(t))},t6=Ha,Ox=u,wde=d5,Cde=Fp,n6=_de,Rde=yde,r6=cr,i6=Ede,Ym=[],s6=ZB(Ym.sort),Ide=ZB(Ym.push),Ade=Ox(function(){Ym.sort(void 0)}),Pde=Ox(function(){Ym.sort(null)}),Ode=Cde("sort"),o6=!Ox(function(){if(r6)return r6<70;if(!(n6&&n6>3)){if(Rde)return!0;if(i6)return i6<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Ym.push({k:r+a,v:s})}for(Ym.sort(function(d,h){return h.v-d.v}),a=0;a<Ym.length;a++)r=Ym[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});vde({target:"Array",proto:!0,forced:Ade||!Pde||!Ode||!o6},{sort:function(t){t!==void 0&&Sde(t);var r=bde(this);if(o6)return t===void 0?s6(r):s6(r,t);var s,a,c=[],d=e6(r);for(a=0;a<d;a++)a in r&&Ide(c,r[a]);for(wde(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:t6(m)>t6(y)?1:-1}}(t)),s=e6(c),a=0;a<s;)r[a]=c[a++];for(;a<d;)Tde(r,a++);return r}});var kde=vc("Array").sort,Nde=O,Dde=kde,kx=Array.prototype,xde=function(t){var r=t.sort;return t===kx||Nde(kx,t)&&r===kx.sort?Dde:r},vT=l(xde),Nx=L;$n({global:!0,forced:Nx.globalThis!==Nx},{globalThis:Nx});var a6=l(L),Dx={exports:{}};(function(t,r){(function(s,a){var c="function",d="undefined",h="object",m="string",y="major",v="model",T="name",R="type",P="vendor",D="version",G="architecture",F="console",W="mobile",Q="tablet",ee="smarttv",fe="wearable",ye="embedded",ve="Amazon",_e="Apple",Ne="ASUS",Je="BlackBerry",ft="Browser",yt="Chrome",An="Firefox",Pn="Google",vr="Huawei",fi="LG",ti="Microsoft",Pa="Motorola",ze="Opera",ot="Samsung",At="Sharp",Ke="Sony",V="Xiaomi",ce="Zebra",me="Facebook",tt="Chromium OS",Zt="Mac OS",dr=function(Ui){for(var rs={},xr=0;xr<Ui.length;xr++)rs[Ui[xr].toUpperCase()]=Ui[xr];return rs},ns=function(Ui,rs){return typeof Ui===m&&ic(rs).indexOf(ic(Ui))!==-1},ic=function(Ui){return Ui.toLowerCase()},If=function(Ui,rs){if(typeof Ui===m)return Ui=Ui.replace(/^\s\s*/,""),typeof rs===d?Ui:Ui.substring(0,350)},by=function(Ui,rs){for(var xr,Oc,ep,mi,Yn,sc,_g=0;_g<rs.length&&!Yn;){var Yd=rs[_g],xK=rs[_g+1];for(xr=Oc=0;xr<Yd.length&&!Yn&&Yd[xr];)if(Yn=Yd[xr++].exec(Ui))for(ep=0;ep<xK.length;ep++)sc=Yn[++Oc],typeof(mi=xK[ep])===h&&mi.length>0?mi.length===2?typeof mi[1]==c?this[mi[0]]=mi[1].call(this,sc):this[mi[0]]=mi[1]:mi.length===3?typeof mi[1]!==c||mi[1].exec&&mi[1].test?this[mi[0]]=sc?sc.replace(mi[1],mi[2]):a:this[mi[0]]=sc?mi[1].call(this,sc,mi[2]):a:mi.length===4&&(this[mi[0]]=sc?mi[3].call(this,sc.replace(mi[1],mi[2])):a):this[mi]=sc||a;_g+=2}},Tw=function(Ui,rs){for(var xr in rs)if(typeof rs[xr]===h&&rs[xr].length>0){for(var Oc=0;Oc<rs[xr].length;Oc++)if(ns(rs[xr][Oc],Ui))return xr==="?"?a:xr}else if(ns(rs[xr],Ui))return xr==="?"?a:xr;return Ui},CO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},RO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[T,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[T,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[T,D],[/opios[\/ ]+([\w\.]+)/i],[D,[T,ze+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[T,ze]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[T,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[T,"UC"+ft]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[T,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[T,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[T,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[T,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[T,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[T,/(.+)/,"$1 Secure "+ft],D],[/\bfocus\/([\w\.]+)/i],[D,[T,An+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[T,ze+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[T,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[T,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[T,ze+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[T,"MIUI "+ft]],[/fxios\/([-\w\.]+)/i],[D,[T,An]],[/\bqihu|(qi?ho?o?|360)browser/i],[[T,"360 "+ft]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[T,/(.+)/,"$1 "+ft],D],[/(comodo_dragon)\/([\w\.]+)/i],[[T,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[T,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[T],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[T,me],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[T,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[T,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[T,yt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[T,yt+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[T,"Android "+ft]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[T,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[T,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,T],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[T,[D,Tw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[T,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[T,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[T,An+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[T,D],[/(cobalt)\/([\w\.]+)/i],[T,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,ic]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",ic]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,ic]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[P,ot],[R,Q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[P,ot],[R,W]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[P,_e],[R,W]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[P,_e],[R,Q]],[/(macintosh);/i],[v,[P,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[P,At],[R,W]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[P,vr],[R,Q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[P,vr],[R,W]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[P,V],[R,W]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[P,V],[R,Q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[P,"OPPO"],[R,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[P,"Vivo"],[R,W]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[P,"Realme"],[R,W]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[P,Pa],[R,W]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[P,Pa],[R,Q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[P,fi],[R,Q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[P,fi],[R,W]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[P,"Lenovo"],[R,Q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[P,"Nokia"],[R,W]],[/(pixel c)\b/i],[v,[P,Pn],[R,Q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[P,Pn],[R,W]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[P,Ke],[R,W]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[P,Ke],[R,Q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[P,"OnePlus"],[R,W]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[P,ve],[R,Q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[P,ve],[R,W]],[/(playbook);[-\w\),; ]+(rim)/i],[v,P,[R,Q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[P,Je],[R,W]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[P,Ne],[R,Q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[P,Ne],[R,W]],[/(nexus 9)/i],[v,[P,"HTC"],[R,Q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[v,/_/g," "],[R,W]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[P,"Acer"],[R,Q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[P,"Meizu"],[R,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,v,[R,W]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,v,[R,Q]],[/(surface duo)/i],[v,[P,ti],[R,Q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[P,"Fairphone"],[R,W]],[/(u304aa)/i],[v,[P,"AT&T"],[R,W]],[/\bsie-(\w*)/i],[v,[P,"Siemens"],[R,W]],[/\b(rct\w+) b/i],[v,[P,"RCA"],[R,Q]],[/\b(venue[\d ]{2,7}) b/i],[v,[P,"Dell"],[R,Q]],[/\b(q(?:mv|ta)\w+) b/i],[v,[P,"Verizon"],[R,Q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[P,"Barnes & Noble"],[R,Q]],[/\b(tm\d{3}\w+) b/i],[v,[P,"NuVision"],[R,Q]],[/\b(k88) b/i],[v,[P,"ZTE"],[R,Q]],[/\b(nx\d{3}j) b/i],[v,[P,"ZTE"],[R,W]],[/\b(gen\d{3}) b.+49h/i],[v,[P,"Swiss"],[R,W]],[/\b(zur\d{3}) b/i],[v,[P,"Swiss"],[R,Q]],[/\b((zeki)?tb.*\b) b/i],[v,[P,"Zeki"],[R,Q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],v,[R,Q]],[/\b(ns-?\w{0,9}) b/i],[v,[P,"Insignia"],[R,Q]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[P,"NextBook"],[R,Q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],v,[R,W]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],v,[R,W]],[/\b(ph-1) /i],[v,[P,"Essential"],[R,W]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[P,"Envizen"],[R,Q]],[/\b(trio[-\w\. ]+) b/i],[v,[P,"MachSpeed"],[R,Q]],[/\btu_(1491) b/i],[v,[P,"Rotor"],[R,Q]],[/(shield[\w ]+) b/i],[v,[P,"Nvidia"],[R,Q]],[/(sprint) (\w+)/i],[P,v,[R,W]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[P,ti],[R,W]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[P,ce],[R,Q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[P,ce],[R,W]],[/smart-tv.+(samsung)/i],[P,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[P,ot],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,fi],[R,ee]],[/(apple) ?tv/i],[P,[v,_e+" TV"],[R,ee]],[/crkey/i],[[v,yt+"cast"],[P,Pn],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[v,[P,ve],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[P,At],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[v,[P,Ke],[R,ee]],[/(mitv-\w{5}) bui/i],[v,[P,V],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[P,v,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,If],[v,If],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,v,[R,F]],[/droid.+; (shield) bui/i],[v,[P,"Nvidia"],[R,F]],[/(playstation [345portablevi]+)/i],[v,[P,Ke],[R,F]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[P,ti],[R,F]],[/((pebble))app/i],[P,v,[R,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[P,_e],[R,fe]],[/droid.+; (glass) \d/i],[v,[P,Pn],[R,fe]],[/droid.+; (wt63?0{2,3})\)/i],[v,[P,ce],[R,fe]],[/(quest( 2| pro)?)/i],[v,[P,me],[R,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,Q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,Q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,W]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[T,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[T,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[T,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,T]],os:[[/microsoft (windows) (vista|xp)/i],[T,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[T,[D,Tw,CO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,"Windows"],[D,Tw,CO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[T,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[T,Zt],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,T],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[T,D],[/\(bb(10);/i],[D,[T,Je]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[T,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[T,An+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[T,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[T,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[T,yt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[T,tt],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[T,D],[/(sunos) ?([\w\.\d]*)/i],[[T,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[T,D]]},eu=function(Ui,rs){if(typeof Ui===h&&(rs=Ui,Ui=a),!(this instanceof eu))return new eu(Ui,rs).getResult();var xr=typeof s!==d&&s.navigator?s.navigator:a,Oc=Ui||(xr&&xr.userAgent?xr.userAgent:""),ep=xr&&xr.userAgentData?xr.userAgentData:a,mi=rs?function(Yn,sc){var _g={};for(var Yd in Yn)sc[Yd]&&sc[Yd].length%2==0?_g[Yd]=sc[Yd].concat(Yn[Yd]):_g[Yd]=Yn[Yd];return _g}(RO,rs):RO;return this.getBrowser=function(){var Yn={};return Yn[T]=a,Yn[D]=a,by.call(Yn,Oc,mi.browser),Yn[y]=function(sc){return typeof sc===m?sc.replace(/[^\d\.]/g,"").split(".")[0]:a}(Yn[D]),xr&&xr.brave&&typeof xr.brave.isBrave==c&&(Yn[T]="Brave"),Yn},this.getCPU=function(){var Yn={};return Yn[G]=a,by.call(Yn,Oc,mi.cpu),Yn},this.getDevice=function(){var Yn={};return Yn[P]=a,Yn[v]=a,Yn[R]=a,by.call(Yn,Oc,mi.device),!Yn[R]&&ep&&ep.mobile&&(Yn[R]=W),Yn[v]=="Macintosh"&&xr&&typeof xr.standalone!==d&&xr.maxTouchPoints&&xr.maxTouchPoints>2&&(Yn[v]="iPad",Yn[R]=Q),Yn},this.getEngine=function(){var Yn={};return Yn[T]=a,Yn[D]=a,by.call(Yn,Oc,mi.engine),Yn},this.getOS=function(){var Yn={};return Yn[T]=a,Yn[D]=a,by.call(Yn,Oc,mi.os),!Yn[T]&&ep&&ep.platform!="Unknown"&&(Yn[T]=ep.platform.replace(/chrome os/i,tt).replace(/macos/i,Zt)),Yn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Oc},this.setUA=function(Yn){return Oc=typeof Yn===m&&Yn.length>350?If(Yn,350):Yn,this},this.setUA(Oc),this};eu.VERSION="0.7.34",eu.BROWSER=dr([T,D,y]),eu.CPU=dr([G]),eu.DEVICE=dr([v,P,R,F,W,ee,Q,fe,ye]),eu.ENGINE=eu.OS=dr([T,D]),t.exports&&(r=t.exports=eu),r.UAParser=eu;var gg=typeof s!==d&&(s.jQuery||s.Zepto);if(gg&&!gg.ua){var Ty=new eu;gg.ua=Ty.getResult(),gg.ua.get=function(){return Ty.getUA()},gg.ua.set=function(Ui){Ty.setUA(Ui);var rs=Ty.getResult();for(var xr in rs)gg.ua[xr]=rs[xr]}}})(typeof window=="object"?window:o)})(Dx,Dx.exports);var Lde=l(Dx.exports),Mde=Hc,Ude=ki,Vde=dt,jde=bh,Fde=wr("iterator"),Bde=Object,Wde=function(t){if(Vde(t))return!1;var r=Bde(t);return r[Fde]!==void 0||"@@iterator"in r||Ude(jde,Mde(r))},zde=l(Wde),c6=_v.clear;$n({global:!0,bind:!0,forced:L.clearImmediate!==c6},{clearImmediate:c6});var Gde=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",l6=L,Hde=ne,$de=ke,Kde=Gde,qde=Ct,Yde=xs,Xde=Wl,Jde=l6.Function,Qde=/MSIE .\./.test(qde)||Kde&&function(){var t=l6.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Zde=$n,u6=L,d6=_v.set,ehe=function(t,r){var s=1;return Qde?function(a,c){var d=Xde(arguments.length,1)>s,h=$de(a)?a:Jde(a),m=d?Yde(arguments,s):[],y=d?function(){Hde(h,this,m)}:h;return t(y)}:t},h6=u6.setImmediate?ehe(d6):d6;Zde({global:!0,bind:!0,forced:u6.setImmediate!==h6},{setImmediate:h6});var p6=l(vt.setImmediate),the=$n,nhe=Cc,rhe=ds,ihe=Wl,she=Bp,ohe=L.process;the({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){ihe(arguments.length,1),rhe(t);var r=she&&ohe.domain;nhe(r?r.bind(t):t)}});var f6=l(vt.queueMicrotask);function m6(t,r){return function(){return t.apply(r,arguments)}}const{toString:ahe}=Object.prototype,{getPrototypeOf:xx}=Object,PA=(Lx=Object.create(null),t=>{const r=ahe.call(t);return Lx[r]||(Lx[r]=r.slice(8,-1).toLowerCase())});var Lx;const Md=t=>(t=t.toLowerCase(),r=>PA(r)===t),OA=t=>r=>typeof r===t,{isArray:Wv}=Array,ST=OA("undefined"),g6=Md("ArrayBuffer"),che=OA("string"),Gl=OA("function"),_6=OA("number"),kA=t=>t!==null&&typeof t=="object",NA=t=>{if(PA(t)!=="object")return!1;const r=xx(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||zde(t))},lhe=Md("Date"),uhe=Md("File"),dhe=Md("Blob"),hhe=Md("FileList"),phe=Md("URLSearchParams"),[fhe,mhe,ghe,_he]=["ReadableStream","Request","Response","Headers"].map(Md);function bT(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Wv(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function y6(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const $_=a6!==void 0?a6:typeof self<"u"?self:typeof window<"u"?window:Ny,E6=t=>!ST(t)&&t!==$_,yhe=(Mx=typeof Uint8Array<"u"&&xx(Uint8Array),t=>Mx&&t instanceof Mx);var Mx;const Ehe=Md("HTMLFormElement"),v6=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),vhe=Md("RegExp"),S6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};bT(s,(c,d)=>{let h;(h=r(c,d,t))!==!1&&(a[d]=h||c)}),Object.defineProperties(t,a)},Ux="abcdefghijklmnopqrstuvwxyz",b6="0123456789",T6={DIGIT:b6,ALPHA:Ux,ALPHA_DIGIT:Ux+Ux.toUpperCase()+b6},She=Md("AsyncFunction"),w6=(C6=typeof p6=="function",R6=Gl($_.postMessage),C6?p6:R6?(Vx="axios@".concat(Math.random()),DA=[],$_.addEventListener("message",t=>{let{source:r,data:s}=t;r===$_&&s===Vx&&DA.length&&DA.shift()()},!1),t=>{DA.push(t),$_.postMessage(Vx,"*")}):t=>setTimeout(t));var C6,R6,Vx,DA;const bhe=f6!==void 0?f6.bind($_):typeof process<"u"&&process.nextTick||w6;var ht={isArray:Wv,isArrayBuffer:g6,isBuffer:function(t){return t!==null&&!ST(t)&&t.constructor!==null&&!ST(t.constructor)&&Gl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Gl(t.append)&&((r=PA(t))==="formdata"||r==="object"&&Gl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&g6(t.buffer),r},isString:che,isNumber:_6,isBoolean:t=>t===!0||t===!1,isObject:kA,isPlainObject:NA,isReadableStream:fhe,isRequest:mhe,isResponse:ghe,isHeaders:_he,isUndefined:ST,isDate:lhe,isFile:uhe,isBlob:dhe,isRegExp:vhe,isFunction:Gl,isStream:t=>kA(t)&&Gl(t.pipe),isURLSearchParams:phe,isTypedArray:yhe,isFileList:hhe,forEach:bT,merge:function t(){const{caseless:r}=E6(this)&&this||{},s={},a=(c,d)=>{const h=r&&y6(s,d)||d;NA(s[h])&&NA(c)?s[h]=t(s[h],c):NA(c)?s[h]=t({},c):Wv(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&bT(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return bT(r,(c,d)=>{s&&Gl(c)?t[d]=m6(c,s):t[d]=c},{allOwnKeys:a}),t},trim:t=>bo(t)?bo(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&xx(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:PA,kindOfTest:Md,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(Wv(t))return t;let r=t.length;if(!_6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:Ehe,hasOwnProperty:v6,hasOwnProp:v6,reduceDescriptors:S6,freezeMethods:t=>{S6(t,(r,s)=>{if(Gl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];Gl(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach(d=>{s[d]=!0})};return Wv(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:y6,global:$_,isContextDefined:E6,ALPHABET:T6,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:T6.ALPHA_DIGIT,s="";const{length:a}=r;for(;t--;)s+=r[Math.random()*a|0];return s},isSpecCompliantForm:function(t){return!!(t&&Gl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(kA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const d=Wv(a)?[]:{};return bT(a,(h,m)=>{const y=s(h,c+1);!ST(y)&&(d[m]=y)}),r[c]=void 0,d}}return a};return s(t,0)},isAsyncFn:She,isThenable:t=>t&&(kA(t)||Gl(t))&&Gl(t.then)&&Gl(t.catch),setImmediate:w6,asap:bhe};function lr(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}ht.inherits(lr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ht.toJSONObject(this.config),code:this.code,status:this.status}}});const I6=lr.prototype,A6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{A6[t]={value:t}}),Object.defineProperties(lr,A6),Object.defineProperty(I6,"isAxiosError",{value:!0}),lr.from=(t,r,s,a,c,d)=>{const h=Object.create(I6);return ht.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),lr.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function jx(t){return ht.isPlainObject(t)||ht.isArray(t)}function P6(t){return ht.endsWith(t,"[]")?t.slice(0,-2):t}function O6(t,r,s){return t?t.concat(r).map(function(a,c){return a=P6(a),!s&&c?"["+a+"]":a}).join(s?".":""):r}const The=ht.toFlatObject(ht,{},null,function(t){return/^is[A-Z]/.test(t)});function xA(t,r,s){if(!ht.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=ht.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,D){return!ht.isUndefined(D[P])})).metaTokens,c=s.visitor||v,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ht.isSpecCompliantForm(r);if(!ht.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(ht.isDate(P))return P.toISOString();if(!m&&ht.isBlob(P))throw new lr("Blob is not supported. Use a Buffer instead.");return ht.isArrayBuffer(P)||ht.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function v(P,D,G){let F=P;if(P&&!G&&typeof P=="object"){if(ht.endsWith(D,"{}"))D=a?D:D.slice(0,-2),P=JSON.stringify(P);else if(ht.isArray(P)&&function(W){return ht.isArray(W)&&!W.some(jx)}(P)||(ht.isFileList(P)||ht.endsWith(D,"[]"))&&(F=ht.toArray(P)))return D=P6(D),F.forEach(function(W,Q){!ht.isUndefined(W)&&W!==null&&r.append(h===!0?O6([D],Q,d):h===null?D:D+"[]",y(W))}),!1}return!!jx(P)||(r.append(O6(G,D,d),y(P)),!1)}const T=[],R=Object.assign(The,{defaultVisitor:v,convertValue:y,isVisitable:jx});if(!ht.isObject(t))throw new TypeError("data must be an object");return function P(D,G){if(!ht.isUndefined(D)){if(T.indexOf(D)!==-1)throw Error("Circular reference detected in "+G.join("."));T.push(D),ht.forEach(D,function(F,W){(!(ht.isUndefined(F)||F===null)&&c.call(r,F,ht.isString(W)?bo(W).call(W):W,G,R))===!0&&P(F,G?G.concat(W):[W])}),T.pop()}}(t),r}function k6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function Fx(t,r){this._pairs=[],t&&xA(t,this,r)}const N6=Fx.prototype;function whe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function D6(t,r,s){if(!r)return t;const a=s&&s.encode||whe;ht.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):ht.isURLSearchParams(r)?r.toString():new Fx(r,s).toString(a),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}N6.append=function(t,r){this._pairs.push([t,r])},N6.toString=function(t){const r=t?function(s){return t.call(this,s,k6)}:k6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var x6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ht.forEach(this.handlers,function(r){r!==null&&t(r)})}},L6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},M6={exports:{}},Che=$n,Rhe=je,U6=it.f;Che({target:"Object",stat:!0,forced:Object.defineProperty!==U6,sham:!Rhe},{defineProperty:U6});var V6=vt.Object,Ihe=M6.exports=function(t,r,s){return V6.defineProperty(t,r,s)};V6.defineProperty.sham&&(Ihe.sham=!0);var j6=l(M6.exports),Ahe=TypeError,F6=u_,Phe=D_,Ohe=Et,khe=wr("species"),B6=Array,Nhe=function(t){var r;return F6(t)&&(r=t.constructor,(Phe(r)&&(r===B6||F6(r.prototype))||Ohe(r)&&(r=r[khe])===null)&&(r=void 0)),r===void 0?B6:r},W6=function(t,r){return new(Nhe(t))(r===0?0:r)},Dhe=u,xhe=cr,Lhe=wr("species"),z6=function(t){return xhe>=51||!Dhe(function(){var r=[];return(r.constructor={})[Lhe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},Mhe=$n,Uhe=u,Vhe=u_,jhe=Et,Fhe=Fi,Bhe=Ei,G6=function(t){if(t>9007199254740991)throw Ahe("Maximum allowed index exceeded");return t},H6=uA,Whe=W6,zhe=z6,Ghe=cr,$6=wr("isConcatSpreadable"),Hhe=Ghe>=51||!Uhe(function(){var t=[];return t[$6]=!1,t.concat()[0]!==t}),$he=function(t){if(!jhe(t))return!1;var r=t[$6];return r!==void 0?!!r:Vhe(t)};Mhe({target:"Array",proto:!0,forced:!Hhe||!zhe("concat")},{concat:function(t){var r,s,a,c,d,h=Fhe(this),m=Whe(h,0),y=0;for(r=-1,a=arguments.length;r<a;r++)if($he(d=r===-1?h:arguments[r]))for(c=Bhe(d),G6(y+c),s=0;s<c;s++,y++)s in d&&H6(m,y,d[s]);else G6(y+1),H6(m,y++,d);return m.length=y,m}});var K6={},Khe=Y,qhe=Te,q6=Eh.f,Yhe=zD,Y6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];K6.f=function(t){return Y6&&Khe(t)=="Window"?function(r){try{return q6(r)}catch{return Yhe(Y6)}}(t):q6(qhe(t))};var zv={},Xhe=wr;zv.f=Xhe;var X6=vt,Jhe=ki,Qhe=zv,Zhe=it.f,Us=function(t){var r=X6.Symbol||(X6.Symbol={});Jhe(r,t)||Zhe(r,t,{value:Qhe.f(t)})},epe=Se,tpe=nn,npe=wr,rpe=Ad,J6=function(){var t=tpe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=npe("toPrimitive");r&&!r[a]&&rpe(r,a,function(c){return epe(s,this)},{})},ipe=De,spe=on,ope=Fi,ape=Ei,cpe=W6,Q6=I([].push),lpe=function(t){var r=t==1,s=t==2,a=t==3,c=t==4,d=t==6,h=t==7,m=t==5||d;return function(y,v,T,R){for(var P,D,G=ope(y),F=spe(G),W=ipe(v,T),Q=ape(F),ee=0,fe=R||cpe,ye=r?fe(y,Q):s||h?fe(y,0):void 0;Q>ee;ee++)if((m||ee in F)&&(D=W(P=F[ee],ee,G),t))if(r)ye[ee]=D;else if(D)switch(t){case 3:return!0;case 5:return P;case 6:return ee;case 2:Q6(ye,P)}else switch(t){case 4:return!1;case 7:Q6(ye,P)}return d?-1:a||c?c:ye}},Z6={forEach:lpe(0)},LA=$n,Bx=L,Wx=Se,upe=I,Gv=je,Hv=ao,dpe=u,Yo=ki,hpe=O,zx=_n,MA=Te,Gx=yc,ppe=Ha,Hx=He,TT=ya,eW=qc,fpe=Eh,tW=K6,mpe=Kc,nW=xe,rW=it,gpe=OE,iW=Be,sW=Ad,_pe=nv,$x=oa,oW=$c,aW=hh,ype=wr,Epe=zv,vpe=Us,Spe=J6,bpe=Pd,cW=Id,UA=Z6.forEach,rl=h_("hidden"),VA="Symbol",wT="prototype",Tpe=cW.set,lW=cW.getterFor(VA),Ud=Object[wT],K_=Bx.Symbol,jA=K_&&K_[wT],wpe=Bx.TypeError,Kx=Bx.QObject,uW=nW.f,q_=rW.f,dW=tW.f,Cpe=iW.f,hW=upe([].push),df=$x("symbols"),CT=$x("op-symbols"),Rpe=$x("wks"),qx=!Kx||!Kx[wT]||!Kx[wT].findChild,Yx=Gv&&dpe(function(){return TT(q_({},"a",{get:function(){return q_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var a=uW(Ud,r);a&&delete Ud[r],q_(t,r,s),a&&t!==Ud&&q_(Ud,r,a)}:q_,Xx=function(t,r){var s=df[t]=TT(jA);return Tpe(s,{type:VA,tag:t,description:r}),Gv||(s.description=r),s},FA=function(t,r,s){t===Ud&&FA(CT,r,s),zx(t);var a=Gx(r);return zx(s),Yo(df,a)?(s.enumerable?(Yo(t,rl)&&t[rl][a]&&(t[rl][a]=!1),s=TT(s,{enumerable:Hx(0,!1)})):(Yo(t,rl)||q_(t,rl,Hx(1,{})),t[rl][a]=!0),Yx(t,a,s)):q_(t,a,s)},Jx=function(t,r){zx(t);var s=MA(r),a=eW(s).concat(gW(s));return UA(a,function(c){Gv&&!Wx(pW,s,c)||FA(t,c,s[c])}),t},pW=function(t){var r=Gx(t),s=Wx(Cpe,this,r);return!(this===Ud&&Yo(df,r)&&!Yo(CT,r))&&(!(s||!Yo(this,r)||!Yo(df,r)||Yo(this,rl)&&this[rl][r])||s)},fW=function(t,r){var s=MA(t),a=Gx(r);if(s!==Ud||!Yo(df,a)||Yo(CT,a)){var c=uW(s,a);return!c||!Yo(df,a)||Yo(s,rl)&&s[rl][a]||(c.enumerable=!0),c}},mW=function(t){var r=dW(MA(t)),s=[];return UA(r,function(a){Yo(df,a)||Yo(oW,a)||hW(s,a)}),s},gW=function(t){var r=t===Ud,s=dW(r?CT:MA(t)),a=[];return UA(s,function(c){!Yo(df,c)||r&&!Yo(Ud,c)||hW(a,df[c])}),a};Hv||(K_=function(){if(hpe(jA,this))throw wpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?ppe(arguments[0]):void 0,r=aW(t),s=function(a){this===Ud&&Wx(s,CT,a),Yo(this,rl)&&Yo(this[rl],r)&&(this[rl][r]=!1),Yx(this,r,Hx(1,a))};return Gv&&qx&&Yx(Ud,r,{configurable:!0,set:s}),Xx(r,t)},sW(jA=K_[wT],"toString",function(){return lW(this).tag}),sW(K_,"withoutSetter",function(t){return Xx(aW(t),t)}),iW.f=pW,rW.f=FA,gpe.f=Jx,nW.f=fW,fpe.f=tW.f=mW,mpe.f=gW,Epe.f=function(t){return Xx(ype(t),t)},Gv&&_pe(jA,"description",{configurable:!0,get:function(){return lW(this).description}})),LA({global:!0,wrap:!0,forced:!Hv,sham:!Hv},{Symbol:K_}),UA(eW(Rpe),function(t){vpe(t)}),LA({target:VA,stat:!0,forced:!Hv},{useSetter:function(){qx=!0},useSimple:function(){qx=!1}}),LA({target:"Object",stat:!0,forced:!Hv,sham:!Gv},{create:function(t,r){return r===void 0?TT(t):Jx(TT(t),r)},defineProperty:FA,defineProperties:Jx,getOwnPropertyDescriptor:fW}),LA({target:"Object",stat:!0,forced:!Hv},{getOwnPropertyNames:mW}),Spe(),bpe(K_,VA),oW[rl]=!0;var _W=ao&&!!Symbol.for&&!!Symbol.keyFor,Ipe=$n,Ape=nn,Ppe=ki,Ope=Ha,yW=oa,kpe=_W,Qx=yW("string-to-symbol-registry"),Npe=yW("symbol-to-string-registry");Ipe({target:"Symbol",stat:!0,forced:!kpe},{for:function(t){var r=Ope(t);if(Ppe(Qx,r))return Qx[r];var s=Ape("Symbol")(r);return Qx[r]=s,Npe[s]=r,s}});var Dpe=$n,xpe=ki,Lpe=fc,Mpe=Fa,Upe=_W,EW=oa("symbol-to-string-registry");Dpe({target:"Symbol",stat:!0,forced:!Upe},{keyFor:function(t){if(!Lpe(t))throw TypeError(Mpe(t)+" is not a symbol");if(xpe(EW,t))return EW[t]}});var vW=u_,Vpe=ke,SW=Y,jpe=Ha,bW=I([].push),Fpe=$n,TW=nn,wW=ne,Bpe=Se,RT=I,CW=u,RW=ke,IW=fc,AW=xs,Wpe=function(t){if(Vpe(t))return t;if(vW(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?bW(s,c):typeof c!="number"&&SW(c)!="Number"&&SW(c)!="String"||bW(s,jpe(c))}var d=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(vW(this))return y;for(var v=0;v<d;v++)if(s[v]===m)return y}}},zpe=ao,Gpe=String,Xm=TW("JSON","stringify"),BA=RT(/./.exec),PW=RT("".charAt),Hpe=RT("".charCodeAt),$pe=RT("".replace),Kpe=RT(1 .toString),qpe=/[\uD800-\uDFFF]/g,OW=/^[\uD800-\uDBFF]$/,kW=/^[\uDC00-\uDFFF]$/,NW=!zpe||CW(function(){var t=TW("Symbol")();return Xm([t])!="[null]"||Xm({a:t})!="{}"||Xm(Object(t))!="{}"}),DW=CW(function(){return Xm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Xm("\uDEAD")!=='"\\udead"'}),Ype=function(t,r){var s=AW(arguments),a=Wpe(r);if(RW(a)||t!==void 0&&!IW(t))return s[1]=function(c,d){if(RW(a)&&(d=Bpe(a,this,Gpe(c),d)),!IW(d))return d},wW(Xm,null,s)},Xpe=function(t,r,s){var a=PW(s,r-1),c=PW(s,r+1);return BA(OW,t)&&!BA(kW,c)||BA(kW,t)&&!BA(OW,a)?"\\u"+Kpe(Hpe(t,0),16):t};Xm&&Fpe({target:"JSON",stat:!0,forced:NW||DW},{stringify:function(t,r,s){var a=AW(arguments),c=wW(NW?Ype:Xm,null,a);return DW&&typeof c=="string"?$pe(c,qpe,Xpe):c}});var xW=Kc,Jpe=Fi;$n({target:"Object",stat:!0,forced:!ao||u(function(){xW.f(1)})},{getOwnPropertySymbols:function(t){var r=xW.f;return r?r(Jpe(t)):[]}}),Us("asyncIterator"),Us("hasInstance"),Us("isConcatSpreadable"),Us("iterator"),Us("match"),Us("matchAll"),Us("replace"),Us("search"),Us("species"),Us("split");var Qpe=J6;Us("toPrimitive"),Qpe();var Zpe=nn,efe=Pd;Us("toStringTag"),efe(Zpe("Symbol"),"Symbol"),Us("unscopables"),Pd(L.JSON,"JSON",!0);var tfe=vt.Symbol,nfe=wr,rfe=it.f,LW=nfe("metadata"),MW=Function.prototype;MW[LW]===void 0&&rfe(MW,LW,{value:null}),Us("dispose"),Us("metadata");var ife=tfe;Us("asyncDispose");var sfe=I,Zx=nn("Symbol"),ofe=Zx.keyFor,afe=sfe(Zx.prototype.valueOf),UW=Zx.isRegisteredSymbol||function(t){try{return ofe(afe(t))!==void 0}catch{return!1}};$n({target:"Symbol",stat:!0},{isRegisteredSymbol:UW});for(var cfe=oa,VW=nn,lfe=I,ufe=fc,dfe=wr,WA=VW("Symbol"),jW=WA.isWellKnownSymbol,FW=VW("Object","getOwnPropertyNames"),hfe=lfe(WA.prototype.valueOf),BW=cfe("wks"),eL=0,WW=FW(WA),pfe=WW.length;eL<pfe;eL++)try{var zW=WW[eL];ufe(WA[zW])&&dfe(zW)}catch{}var GW=function(t){if(jW&&jW(t))return!0;try{for(var r=hfe(t),s=0,a=FW(BW),c=a.length;s<c;s++)if(BW[a[s]]==r)return!0}catch{}return!1};$n({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:GW}),Us("matcher"),Us("observable"),$n({target:"Symbol",stat:!0},{isRegistered:UW}),$n({target:"Symbol",stat:!0,forced:!0},{isWellKnown:GW}),Us("metadataKey"),Us("patternMatch"),Us("replaceAll");var $v=l(ife),HW=l(zv.f("iterator"));function IT(t){return IT=typeof $v=="function"&&typeof HW=="symbol"?function(r){return typeof r}:function(r){return r&&typeof $v=="function"&&r.constructor===$v&&r!==$v.prototype?"symbol":typeof r},IT(t)}var ffe=l(zv.f("toPrimitive"));function mfe(t){var r=function(s,a){if(IT(s)!=="object"||s===null)return s;var c=s[ffe];if(c!==void 0){var d=c.call(s,a);if(IT(d)!=="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(t,"string");return IT(r)==="symbol"?r:String(r)}function q(t,r,s){return(r=mfe(r))in t?j6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var $W=l(Yle),gfe={isBrowser:!0,classes:{URLSearchParams:$W!==void 0?$W:Fx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const tL=typeof window<"u"&&typeof document<"u",nL=typeof navigator=="object"&&navigator||void 0,_fe=tL&&(!nL||["ReactNative","NativeScript","NS"].indexOf(nL.product)<0),yfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Efe=tL&&window.location.href||"http://localhost";function KW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function qW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KW(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var Za=qW(qW({},Object.freeze({__proto__:null,hasBrowserEnv:tL,hasStandardBrowserEnv:_fe,hasStandardBrowserWebWorkerEnv:yfe,navigator:nL,origin:Efe})),gfe),vfe=_n,Sfe=Se,bfe=ki,Tfe=O,wfe=function(){var t=vfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},YW=RegExp.prototype,XW=function(t){var r=t.flags;return r!==void 0||"flags"in YW||bfe(t,"flags")||!Tfe(YW,t)?r:Sfe(wfe,t)},Cfe=VD.charAt,JW=Se,Rfe=_n,Ife=ke,Afe=Y,Pfe=/./.exec,Ofe=TypeError,kfe=$n,QW=Se,ZW=ie,Nfe=qE,zA=ZE,ez=Ut,tz=Gt,AT=Ha,Dfe=_n,xfe=dt,Lfe=Y,Mfe=GR,nz=XW,Ufe=Ba,Vfe=u,jfe=fs,Ffe=function(t,r,s){return r+(s?Cfe(t,r).length:1)},Bfe=function(t,r){var s=t.exec;if(Ife(s)){var a=JW(s,t,r);return a!==null&&Rfe(a),a}if(Afe(t)==="RegExp")return JW(Pfe,t,r);throw Ofe("RegExp#exec called on incompatible receiver")},rz=Id,Wfe=wr("matchAll"),iz="RegExp String",sz=iz+" Iterator",zfe=rz.set,Gfe=rz.getterFor(sz),Hfe=TypeError,rL=ZW("".indexOf),GA=ZW("".matchAll),iL=!!GA&&!Vfe(function(){GA("a",/./)}),$fe=Nfe(function(t,r,s,a){zfe(this,{type:sz,regexp:t,string:r,global:s,unicode:a,done:!1})},iz,function(){var t=Gfe(this);if(t.done)return zA(void 0,!0);var r=t.regexp,s=t.string,a=Bfe(r,s);return a===null?(t.done=!0,zA(void 0,!0)):t.global?(AT(a[0])===""&&(r.lastIndex=Ffe(s,tz(r.lastIndex),t.unicode)),zA(a,!1)):(t.done=!0,zA(a,!1))}),oz=function(t){var r,s,a,c=Dfe(this),d=AT(t),h=jfe(c,RegExp),m=AT(nz(c));return r=new h(h===RegExp?c.source:c,m),s=!!~rL(m,"g"),a=!!~rL(m,"u"),r.lastIndex=tz(c.lastIndex),new $fe(r,d,s,a)};kfe({target:"String",proto:!0,forced:iL},{matchAll:function(t){var r,s,a,c,d=ez(this);if(xfe(t)){if(iL)return GA(d,t)}else{if(Mfe(t)&&(r=AT(ez(nz(t))),!~rL(r,"g")))throw Hfe("`.matchAll` does not allow non-global regexes");if(iL)return GA(d,t);if((a=Ufe(t,Wfe))===void 0&&Lfe(t)=="RegExp"&&(a=oz),a)return QW(a,t,d)}return s=AT(d),c=new RegExp(t,"g"),QW(oz,c,s)}});var Kfe=vc("String").matchAll,qfe=O,Yfe=Kfe,sL=String.prototype,Xfe=function(t){var r=t.matchAll;return typeof t=="string"||t===sL||qfe(sL,t)&&r===sL.matchAll?Yfe:r},Jfe=l(Xfe);function az(t){function r(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=d>=s.length;return h=!h&&ht.isArray(c)?c.length:h,y?(ht.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&ht.isObject(c[h])||(c[h]=[]),r(s,a,c[h],d)&&ht.isArray(c[h])&&(c[h]=function(v){const T={},R=Object.keys(v);let P;const D=R.length;let G;for(P=0;P<D;P++)G=R[P],T[G]=v[G];return T}(c[h])),!m)}if(ht.isFormData(t)&&ht.isFunction(t.entries)){const s={};return ht.forEachEntry(t,(a,c)=>{r(function(d){return Jfe(ht).call(ht,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}const oL={transitional:L6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=ht.isObject(t);if(c&&ht.isHTMLForm(t)&&(t=new FormData(t)),ht.isFormData(t))return a?JSON.stringify(az(t)):t;if(ht.isArrayBuffer(t)||ht.isBuffer(t)||ht.isStream(t)||ht.isFile(t)||ht.isBlob(t)||ht.isReadableStream(t))return t;if(ht.isArrayBufferView(t))return t.buffer;if(ht.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return xA(h,new Za.classes.URLSearchParams,Object.assign({visitor:function(y,v,T,R){return Za.isNode&&ht.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=ht.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return xA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),function(h,m,y){if(ht.isString(h))try{return(m||JSON.parse)(h),bo(ht).call(ht,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||oL.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(ht.isResponse(t)||ht.isReadableStream(t))return t;if(t&&ht.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?lr.from(d,lr.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Za.classes.FormData,Blob:Za.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ht.forEach(["delete","get","head","post","put","patch"],t=>{oL.headers[t]={}});var aL=oL;const Qfe=ht.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cz=Symbol("internals");function PT(t){var r;return t&&bo(r=String(t)).call(r).toLowerCase()}function HA(t){return t===!1||t==null?t:ht.isArray(t)?t.map(HA):String(t)}function cL(t,r,s,a,c){return ht.isFunction(a)?a.call(this,r,s):(c&&(r=s),ht.isString(r)?ht.isString(a)?r.indexOf(a)!==-1:ht.isRegExp(a)?a.test(r):void 0:void 0)}class $A{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function d(y,v,T){const R=PT(v);if(!R)throw new Error("header name must be a non-empty string");const P=ht.findKey(c,R);(!P||c[P]===void 0||T===!0||T===void 0&&c[P]!==!1)&&(c[P||v]=HA(y))}const h=(y,v)=>ht.forEach(y,(T,R)=>d(T,R,v));if(ht.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ht.isString(r)&&(r=bo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(bo(m=r).call(m)))h((y=>{const v={};let T,R,P;return y&&y.split(`
`).forEach(function(D){var G,F;P=D.indexOf(":"),T=bo(G=D.substring(0,P)).call(G).toLowerCase(),R=bo(F=D.substring(P+1)).call(F),!T||v[T]&&Qfe[T]||(T==="set-cookie"?v[T]?v[T].push(R):v[T]=[R]:v[T]=v[T]?v[T]+", "+R:R)}),v})(r),s);else if(ht.isHeaders(r))for(const[y,v]of r.entries())d(v,y,a);else r!=null&&d(s,r,a);var m;return this}get(r,s){if(r=PT(r)){const a=ht.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(d);)h[y[1]]=y[2];return h}(c);if(ht.isFunction(s))return s.call(this,c,a);if(ht.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=PT(r)){const a=ht.findKey(this,r);return!(!a||this[a]===void 0||s&&!cL(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function d(h){if(h=PT(h)){const m=ht.findKey(a,h);!m||s&&!cL(0,a[m],m,s)||(delete a[m],c=!0)}}return ht.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const d=s[a];r&&!cL(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,a={};return ht.forEach(this,(c,d)=>{var h;const m=ht.findKey(a,d);if(m)return s[m]=HA(c),void delete s[d];const y=r?function(v){return bo(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(T,R,P)=>R.toUpperCase()+P)}(d):bo(h=String(d)).call(h);y!==d&&delete s[d],s[y]=HA(c),a[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ht.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=r&&ht.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,a]=r;return s+": "+a}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[cz]=this[cz]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=PT(d);s[h]||(function(m,y){const v=ht.toCamelCase(" "+y);["get","set","has"].forEach(T=>{Object.defineProperty(m,T+v,{value:function(R,P,D){return this[T].call(this,y,R,P,D)},configurable:!0})})}(a,d),s[h]=!0)}return ht.isArray(r)?r.forEach(c):c(r),this}}$A.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ht.reduceDescriptors($A.prototype,(t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}}),ht.freezeMethods($A);var Vd=$A;function lL(t,r){const s=this||aL,a=r||s,c=Vd.from(a.headers);let d=a.data;return ht.forEach(t,function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function lz(t){return!(!t||!t.__CANCEL__)}function Kv(t,r,s){lr.call(this,t??"canceled",lr.ERR_CANCELED,r,s),this.name="CanceledError"}function uz(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new lr("Request failed with status code "+s.status,[lr.ERR_BAD_REQUEST,lr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ht.inherits(Kv,lr,{__CANCEL__:!0});const KA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(d,h){d=d||10;const m=new Array(d),y=new Array(d);let v,T=0,R=0;return h=h!==void 0?h:1e3,function(P){const D=Date.now(),G=y[R];v||(v=D),m[T]=P,y[T]=D;let F=R,W=0;for(;F!==T;)W+=m[F++],F%=d;if(T=(T+1)%d,T===R&&(R=(R+1)%d),D-v<h)return;const Q=G&&D-G;return Q?Math.round(1e3*W/Q):void 0}}(50,250);return function(d,h){let m,y,v=0,T=1e3/h;const R=function(P){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),d.apply(null,P)};return[function(){const P=Date.now(),D=P-v;for(var G=arguments.length,F=new Array(G),W=0;W<G;W++)F[W]=arguments[W];D>=T?R(F,P):(m=F,y||(y=setTimeout(()=>{y=null,R(m)},T-D)))},()=>m&&R(m)]}(d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,y=h-a,v=c(y);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},dz=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},hz=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return ht.asap(()=>t(...s))};var Zfe=Za.hasStandardBrowserEnv?((t,r)=>s=>(s=new bA(s,Za.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new bA(Za.origin),Za.navigator&&/(msie|trident)/i.test(Za.navigator.userAgent)):()=>!0,eme=Za.hasStandardBrowserEnv?{write(t,r,s,a,c,d){const h=[t+"="+encodeURIComponent(r)];ht.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ht.isString(a)&&h.push("path="+a),ht.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function pz(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,a){return a?s.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):s}(t,r):r}function fz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const mz=t=>t instanceof Vd?function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?fz(Object(a),!0).forEach(function(c){q(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):fz(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t):t;function Y_(t,r){r=r||{};const s={};function a(v,T,R,P){return ht.isPlainObject(v)&&ht.isPlainObject(T)?ht.merge.call({caseless:P},v,T):ht.isPlainObject(T)?ht.merge({},T):ht.isArray(T)?T.slice():T}function c(v,T,R,P){return ht.isUndefined(T)?ht.isUndefined(v)?void 0:a(void 0,v,0,P):a(v,T,0,P)}function d(v,T){if(!ht.isUndefined(T))return a(void 0,T)}function h(v,T){return ht.isUndefined(T)?ht.isUndefined(v)?void 0:a(void 0,v):a(void 0,T)}function m(v,T,R){return R in r?a(v,T):R in t?a(void 0,v):void 0}const y={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,T,R)=>c(mz(v),mz(T),0,!0)};return ht.forEach(Object.keys(Object.assign({},t,r)),function(v){const T=y[v]||c,R=T(t[v],r[v],v);ht.isUndefined(R)&&T!==m||(s[v]=R)}),s}var gz=t=>{const r=Y_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=Vd.from(m),r.url=D6(pz(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),ht.isFormData(a)){if(Za.hasStandardBrowserEnv||Za.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...T]=s?s.split(";").map(R=>bo(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...T].join("; "))}}if(Za.hasStandardBrowserEnv&&(c&&ht.isFunction(c)&&(c=c(r)),c||c!==!1&&Zfe(r.url))){const v=d&&h&&eme.read(h);v&&m.set(d,v)}return r},tme=typeof XMLHttpRequest<"u"&&function(t){return new pt(function(r,s){const a=gz(t);let c=a.data;const d=Vd.from(a.headers).normalize();let h,m,y,v,T,{responseType:R,onUploadProgress:P,onDownloadProgress:D}=a;function G(){v&&v(),T&&T(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let F=new XMLHttpRequest;function W(){if(!F)return;const ee=Vd.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders());uz(function(fe){r(fe),G()},function(fe){s(fe),G()},{data:R&&R!=="text"&&R!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:ee,config:t,request:F}),F=null}F.open(a.method.toUpperCase(),a.url,!0),F.timeout=a.timeout,"onloadend"in F?F.onloadend=W:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(W)},F.onabort=function(){F&&(s(new lr("Request aborted",lr.ECONNABORTED,t,F)),F=null)},F.onerror=function(){s(new lr("Network Error",lr.ERR_NETWORK,t,F)),F=null},F.ontimeout=function(){let ee=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const fe=a.transitional||L6;a.timeoutErrorMessage&&(ee=a.timeoutErrorMessage),s(new lr(ee,fe.clarifyTimeoutError?lr.ETIMEDOUT:lr.ECONNABORTED,t,F)),F=null},c===void 0&&d.setContentType(null),"setRequestHeader"in F&&ht.forEach(d.toJSON(),function(ee,fe){F.setRequestHeader(fe,ee)}),ht.isUndefined(a.withCredentials)||(F.withCredentials=!!a.withCredentials),R&&R!=="json"&&(F.responseType=a.responseType),D&&([y,T]=KA(D,!0),F.addEventListener("progress",y)),P&&F.upload&&([m,v]=KA(P),F.upload.addEventListener("progress",m),F.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(h=ee=>{F&&(s(!ee||ee.type?new Kv(null,t,F):ee),F.abort(),F=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const Q=function(ee){const fe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return fe&&fe[1]||""}(a.url);Q&&Za.protocols.indexOf(Q)===-1?s(new lr("Unsupported protocol "+Q+":",lr.ERR_BAD_REQUEST,t)):F.send(c||null)})},nme=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const d=function(v){if(!a){a=!0,m();const T=v instanceof Error?v:this.reason;c.abort(T instanceof lr?T:new Kv(T instanceof Error?T.message:T))}};let h=r&&setTimeout(()=>{h=null,d(new lr("timeout ".concat(r," of ms exceeded"),lr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)}),t=null)};t.forEach(v=>v.addEventListener("abort",d));const{signal:y}=c;return y.unsubscribe=()=>ht.asap(m),y}},rme=c5,ime=zl;$n({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=ime.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var sme=zl,ome=Oh;$n({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=sme.f(this),s=ome(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var uL=l(rme),_z=zv.f("asyncIterator"),ame=l(_z);function dL(t,r){this.v=t,this.k=r}function OT(t){var r,s;function a(d,h){try{var m=t[d](h),y=m.value,v=y instanceof dL;uL.resolve(v?y.v:y).then(function(T){if(v){var R=d==="return"?"return":"next";if(!y.k||T.done)return a(R,T);T=t[R](T).value}c(m.done?"return":"normal",T)},function(T){a("throw",T)})}catch(T){c("throw",T)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(d,h){return new uL(function(m,y){var v={key:d,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,a(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function Hl(t){return function(){return new OT(t.apply(this,arguments))}}function xn(t){return new dL(t,0)}function qA(t){var r={},s=!1;function a(c,d){return s=!0,{done:!1,value:new dL(d=new uL(function(h){h(t[c](d))}),1)}}return r[$v!==void 0&&HW||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}OT.prototype[typeof $v=="function"&&ame||"@@asyncIterator"]=function(){return this},OT.prototype.next=function(t){return this._invoke("next",t)},OT.prototype.throw=function(t){return this._invoke("throw",t)},OT.prototype.return=function(t){return this._invoke("return",t)};var hL=l(_z);function pL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=hL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new YA(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function YA(t){function r(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var a=s.done;return pt.resolve(s.value).then(function(c){return{value:c,done:a}})}return YA=function(s){this.s=s,this.n=s.next},YA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?pt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?pt.reject(s):r(a.apply(this.s,arguments))}},new YA(t)}const cme=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},lme=function(){var t=Hl(function*(r,s){var a,c=!1,d=!1;try{for(var h,m=pL(ume(r));c=!(h=yield xn(m.next())).done;c=!1){const y=h.value;yield*qA(pL(cme(y,s)))}}catch(y){d=!0,a=y}finally{try{c&&m.return!=null&&(yield xn(m.return()))}finally{if(d)throw a}}});return function(r,s){return t.apply(this,arguments)}}(),ume=function(){var t=Hl(function*(r){if(r[hL])return void(yield*qA(pL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield xn(s.read());if(a)break;yield c}}finally{yield xn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),yz=(t,r,s,a)=>{const c=lme(t,r);let d,h=0,m=y=>{d||(d=!0,a&&a(y))};return new ReadableStream({async pull(y){try{const{done:v,value:T}=await c.next();if(v)return m(),void y.close();let R=T.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(T))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function Ez(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function vz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Ez(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Ez(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const XA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Sz=XA&&typeof ReadableStream=="function",dme=XA&&(typeof TextEncoder=="function"?(bz=new TextEncoder,t=>bz.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var bz;const Tz=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},hme=Sz&&Tz(()=>{let t=!1;const r=new Request(Za.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),fL=Sz&&Tz(()=>ht.isReadableStream(new Response("").body)),JA={stream:fL&&(t=>t.body)};var wz;XA&&(wz=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!JA[t]&&(JA[t]=ht.isFunction(wz[t])?r=>r[t]():(r,s)=>{throw new lr("Response type '".concat(t,"' is not supported"),lr.ERR_NOT_SUPPORT,s)})}));const pme=async(t,r)=>{const s=ht.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:ht.isBlob(a)?a.size:ht.isSpecCompliantForm(a)?(await new Request(Za.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:ht.isArrayBufferView(a)||ht.isArrayBuffer(a)?a.byteLength:(ht.isURLSearchParams(a)&&(a+=""),ht.isString(a)?(await dme(a)).byteLength:void 0))(r)};var fme=XA&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:T,withCredentials:R="same-origin",fetchOptions:P}=gz(t);v=v?(v+"").toLowerCase():"text";let D,G=nme([c,d&&d.toAbortSignal()],h);const F=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let W;try{if(y&&hme&&s!=="get"&&s!=="head"&&(W=await pme(T,a))!==0){let ve,_e=new Request(r,{method:"POST",body:a,duplex:"half"});if(ht.isFormData(a)&&(ve=_e.headers.get("content-type"))&&T.setContentType(ve),_e.body){const[Ne,Je]=dz(W,KA(hz(y)));a=yz(_e.body,65536,Ne,Je)}}ht.isString(R)||(R=R?"include":"omit");const Q="credentials"in Request.prototype;D=new Request(r,vz(vz({},P),{},{signal:G,method:s.toUpperCase(),headers:T.normalize().toJSON(),body:a,duplex:"half",credentials:Q?R:void 0}));let ee=await fetch(D);const fe=fL&&(v==="stream"||v==="response");if(fL&&(m||fe&&F)){const ve={};["status","statusText","headers"].forEach(ft=>{ve[ft]=ee[ft]});const _e=ht.toFiniteNumber(ee.headers.get("content-length")),[Ne,Je]=m&&dz(_e,KA(hz(m),!0))||[];ee=new Response(yz(ee.body,65536,Ne,()=>{Je&&Je(),F&&F()}),ve)}v=v||"text";let ye=await JA[ht.findKey(JA,v)||"text"](ee,t);return!fe&&F&&F(),await new pt((ve,_e)=>{uz(ve,_e,{data:ye,headers:Vd.from(ee.headers),status:ee.status,statusText:ee.statusText,config:t,request:D})})}catch(Q){throw F&&F(),Q&&Q.name==="TypeError"&&/fetch/i.test(Q.message)?Object.assign(new lr("Network Error",lr.ERR_NETWORK,t,D),{cause:Q.cause||Q}):lr.from(Q,Q&&Q.code,t,D)}});const mL={http:null,xhr:tme,fetch:fme};ht.forEach(mL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const Cz=t=>"- ".concat(t),mme=t=>ht.isFunction(t)||t===null||t===!1;var Rz={getAdapter:t=>{t=ht.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],a=s,!mme(s)&&(a=mL[(h=String(s)).toLowerCase()],a===void 0))throw new lr("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new lr("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(Cz).join(`
`):" "+Cz(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:mL};function gL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Kv(null,t)}function Iz(t){return gL(t),t.headers=Vd.from(t.headers),t.data=lL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Rz.getAdapter(t.adapter||aL.adapter)(t).then(function(r){return gL(t),r.data=lL.call(t,t.transformResponse,r),r.headers=Vd.from(r.headers),r},function(r){return lz(r)||(gL(t),r&&r.response&&(r.response.data=lL.call(t,t.transformResponse,r.response),r.response.headers=Vd.from(r.response.headers))),pt.reject(r)})}const Az="1.7.9",QA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{QA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const Pz={};QA.transitional=function(t,r,s){function a(c,d){return"[Axios v"+Az+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new lr(a(d," has been removed"+(r?" in "+r:"")),lr.ERR_DEPRECATED);return r&&!Pz[d]&&(Pz[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},QA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var ZA={assertOptions:function(t,r,s){if(typeof t!="object")throw new lr("options must be an object",lr.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const d=a[c],h=r[d];if(h){const m=t[d],y=m===void 0||h(m,d,t);if(y!==!0)throw new lr("option "+d+" must be "+y,lr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new lr("Unknown option "+d,lr.ERR_BAD_OPTION)}},validators:QA};const Mh=ZA.validators;let eP=class{constructor(t){this.defaults=t,this.interceptors={request:new x6,response:new x6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=Y_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&ZA.assertOptions(s,{silentJSONParsing:Mh.transitional(Mh.boolean),forcedJSONParsing:Mh.transitional(Mh.boolean),clarifyTimeoutError:Mh.transitional(Mh.boolean)},!1),a!=null&&(ht.isFunction(a)?r.paramsSerializer={serialize:a}:ZA.assertOptions(a,{encode:Mh.function,serialize:Mh.function},!0)),ZA.assertOptions(r,{baseUrl:Mh.spelling("baseURL"),withXsrfToken:Mh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&ht.merge(c.common,c[r.method]);c&&ht.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),r.headers=Vd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(r)===!1||(m=m&&D.synchronous,h.unshift(D.fulfilled,D.rejected))});const y=[];let v;this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let T,R=0;if(!m){const D=[Iz.bind(this),void 0];for(D.unshift.apply(D,h),D.push.apply(D,y),T=D.length,v=pt.resolve(r);R<T;)v=v.then(D[R++],D[R++]);return v}T=h.length;let P=r;for(R=0;R<T;){const D=h[R++],G=h[R++];try{P=D(P)}catch(F){G.call(this,F);break}}try{v=Iz.call(this,P)}catch(D){return pt.reject(D)}for(R=0,T=y.length;R<T;)v=v.then(y[R++],y[R++]);return v}getUri(t){return D6(pz((t=Y_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};ht.forEach(["delete","get","head","options"],function(t){eP.prototype[t]=function(r,s){return this.request(Y_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ht.forEach(["post","put","patch"],function(t){function r(s){return function(a,c,d){return this.request(Y_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}eP.prototype[t]=r(),eP.prototype[t+"Form"]=r(!0)});var tP=eP;class _L{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new pt(function(c){s=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d;const h=new pt(m=>{a.subscribe(m),d=m}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},r(function(c,d,h){a.reason||(a.reason=new Kv(c,d,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new _L(function(a){r=a}),cancel:r}}}var gme=_L;const yL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yL).forEach(t=>{let[r,s]=t;yL[s]=r});var _me=yL;const uo=function t(r){const s=new tP(r),a=m6(tP.prototype.request,s);return ht.extend(a,tP.prototype,s,{allOwnKeys:!0}),ht.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(Y_(r,c))},a}(aL);uo.Axios=tP,uo.CanceledError=Kv,uo.CancelToken=gme,uo.isCancel=lz,uo.VERSION=Az,uo.toFormData=xA,uo.AxiosError=lr,uo.Cancel=uo.CanceledError,uo.all=function(t){return pt.all(t)},uo.spread=function(t){return function(r){return t.apply(null,r)}},uo.isAxiosError=function(t){return ht.isObject(t)&&t.isAxiosError===!0},uo.mergeConfig=Y_,uo.AxiosHeaders=Vd,uo.formToJSON=t=>az(ht.isHTMLForm(t)?new FormData(t):t),uo.getAdapter=Rz.getAdapter,uo.HttpStatusCode=_me,uo.default=uo;var Ta=uo;const yme=()=>{};function kT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:yme};return t.promise=new pt((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}}),t}const nP=new Map,rP=new Map,Uh=new Map;let Zi=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Kn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const Oz=new Lde;let jd=Oz.getResult(),EL=null;function Ln(t){if(!EL){jd=Oz.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Kn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Kn.CHROME;case"Safari":case"Mobile Safari":return Kn.SAFARI;case"Edge":return Kn.EDGE;case"Firefox":return Kn.FIREFOX;case"QQ":case"QQBrowser":return Kn.QQ;case"Opera":return Kn.OPERA;case"WeChat":return Kn.WECHAT;default:return m.browser.name||""}}(jd),s=kz(jd),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(jd),c=jd.os.version,d=kz(jd,!1),h=jd.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};EL={name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return EL}function kz(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function iP(){return Ln().os}function Nz(){const t=Ln();return"".concat(t.os," ").concat(t.osVersion)}function sP(){const t=Ln();return!!(jd.engine.name==="WebKit"&&t.os===Zi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Kn.SAFARI||Xo()&&t.name!==Kn.SAFARI)}function hf(){return Ln().name===Kn.CHROME}function Vs(){return Ln().name===Kn.SAFARI}function Dz(){return Ln().name===Kn.EDGE}function qr(){return Ln().name===Kn.FIREFOX}function Xo(){return Ln().os===Zi.IOS}function NT(t){const r=Ln();return!(r.name!==Kn.CHROME||!r.osVersion)&&Number(r.version)>=t}function xz(t){const r=Ln();return!(r.name!==Kn.CHROME||!r.osVersion)&&Number(r.version)<t}function vL(t,r,s){const a=Ln();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function SL(t){const r=Ln();return!(r.name!==Kn.EDGE||!r.osVersion)&&Number(r.version)>=t}function Lz(t){const r=Ln();return!(r.name!==Kn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function Mz(t,r,s){const a=Ln();if(a.os!==Zi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function Uz(t,r,s){const a=Ln();if(a.name!==Kn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function bL(t){const r=Ln();return!(r.name!==Kn.OPERA||!r.osVersion)&&Number(r.version)>=t}function Vz(){const t=Ln();if(t.os!==Zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function qv(){const t=Ln();if(t.os!==Zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function TL(){const t=Ln();if(t.os!==Zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function jz(){const t=Ln();if(t.os!==Zi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Vu(){return Vs()&&navigator.maxTouchPoints>0}function Fz(){return Ln().name===Kn.WECHAT}function Bz(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function wL(){const t=iP();return function(){const{deviceType:r}=Ln();return r==="mobile"||r==="tablet"}()||t===Zi.ANDROID||t===Zi.IOS||t===Zi.HARMONY_OS}function pf(){const t=Ln();return t.name!==Kn.EDGE&&t.name!==Kn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function oP(){return iP()===Zi.ANDROID}function DT(){const t=Ln();return oP()&&(t.name===Kn.CHROME||t.name===Kn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Wz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function bt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Wz(Object(s),!0).forEach(function(a){Jt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Wz(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Jt(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let te=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Jt(this,"code",void 0),Jt(this,"message",void 0),Jt(this,"data",void 0),Jt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function ff(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Ki(t,r,s){if(!at(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function ur(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function CL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&ur(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&ur(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&ur(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&ur(t.ideal,"".concat(r,".ideal"),1,1/0)}else ur(t,r,1,1/0)}function Ss(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!zz(t,s,a,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function mf(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Yr(t){return t==null}function zz(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}var xT=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(xT||{}),RL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(RL||{});const Gz=new class{constructor(){Jt(this,"_clientSize",null),Jt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Jt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Jt(this,"getStyle",t=>window.getComputedStyle(t,null)),Jt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=a;return(c==="none"||at(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const T=y.split("(")[0];return at(v=["brightness","blur","opacity"]).call(v,T)}).map(y=>{const[v,T]=y.split(/\(|\)/);return[v,Number(T.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,T]=y;switch(v){case"brightness":(T<.1||T>3)&&(s=!1);break;case"blur":T>3&&(s=!1);break;case"opacity":T<.1&&(s=!1)}}),s)}),Jt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,a=!0;const c=h=>r(h);let d=t;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),Jt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Jt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:a,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:d,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),Jt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Jt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Jt(this,"checkCoverForAPoint",(t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s}),Jt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const T=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(a*m+(v===0?.1:v===4?(d*v*m-1e5)/m:d*v)*m)/m;h.push({x:T,y:R})}return[...h]}),Jt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Jt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Jt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,y,v,T;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(y=r<d?r:d,s<0)v=0;else{if(!(s<c))return!1;v=s}if(a<0)return!1;T=a<c?a:c;const R=y-m,P=T-v;return this.checkSizeIsVisible(R,P,h)}),Jt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Jt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(xT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(xT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(xT.SIZE)}}return this.returnHiddenResult(xT.STYLE)}return this.returnHiddenResult(RL.UNMOUNTED)}return this.returnHiddenResult(RL.INVALID_HTML_ELEMENT)}),Jt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function IL(t){return new TextEncoder().encode(t)}const Hz=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},AL=async t=>function(r,s){let a="";return new Uint8Array(r).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",IL(t)),16);let Gr=class{constructor(){Jt(this,"_events",{}),Jt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],a=this._indexOfListener(s,r);a!==-1&&s.splice(a,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(d=>d);for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];for(let d=0;d<r.length;d+=1){const h=r[d];h.once&&this.off(t,h.listener),h.listener.apply(this,a||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},LT=null;function $z(){if(LT)return LT;if(window.electron)return LT=window.electron;if(!window.require)return null;try{return LT=window.require("electron"),LT}catch{return null}}let xi=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Xr=function(t){return t.TRACER="tracer",t}({});function Kz(t){return ur(t.timeout,"config.timeout",0,1e5),ur(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ur(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ur(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Eme=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Jn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function MT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function qz(t){return Ss(t.turnServerURL,"turnServerURL"),Ss(t.username,"username"),Ss(t.password,"password"),t.udpport&&ur(t.udpport,"udpport",1,99999,!0),t.forceturn&&ff(t.forceturn,"forceturn"),t.security&&ff(t.security,"security"),t.tcpport&&ur(t.tcpport,"tcpport",1,99999,!0),!0}function PL(t){return t.level!==void 0&&Ki(t.level,"level",[1,2,3]),t.delay!==void 0&&ur(t.delay,"delay",0,3e3,!0),!0}let Tn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),js=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Ac=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Yv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Fs(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?pt.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new pt((d,h)=>{t.emit(r,...a,d,h)})}function _r(t,r){if(t.getListeners(r).length===0)return pt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Fs(t,r,...a)}function il(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return UT(t,r,...a)}function UT(t,r){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const Si=new class extends Gr{set networkState(t){this.emit(Yv.NETWORK_STATE_CHANGE,t,this._networkState),t===Ac.ONLINE?this.emit(Yv.ONLINE):t===Ac.OFFLINE&&(this.onlineWaiter=new pt(r=>{this.once(Yv.ONLINE,()=>{this.onlineWaiter=void 0,r(Ac.ONLINE)})}),this.emit(Yv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ac.ONLINE}constructor(){super(),Jt(this,"_moduleName","network-indicator"),Jt(this,"_networkState",Ac.ONLINE),Jt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ac.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ac.OFFLINE})}};function aP(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Xv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function cP(t){pt!==void 0?pt.resolve().then(t):setTimeout(t,0)}function Jr(t){return JSON.parse(JSON.stringify(t))}function X_(t){try{return Jr(t)}catch{return t}}const Yz={};function Jm(t,r){Yz[r]||(Yz[r]=!0,t())}function J_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function Qm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function Xz(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function Jz(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=Sc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach(h=>{c.set(h,d),d+=h.length}),c}function Vh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function Qz(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?Vh(s):s.size}),r+138}function vme(t){const r=new Le(te.TIMEOUT,"timeout");return new pt((s,a)=>{window.setTimeout(()=>a(r),t)})}function bs(t){return new pt(r=>{window.setTimeout(r,t)})}function yr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+yr(t-s.length,"")}function Q_(){return yr(32,"").toUpperCase()}const lP=()=>{},Zz=new class{constructor(){Jt(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,bt(bt({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:a})}}},e8=Zz.throttleByKey.bind(Zz);function t8(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function OL(t,r){if(!t8(t)||!t8(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=OL(t[a],r[a]);return s}{const s=bt({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=OL(t[a],r[a]):s[a]=r[a]);return s}}function n8(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function kL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function r8(t){const r="0123456789abcdef";function s(fe){let ye,ve="";for(ye=0;ye<=3;ye++)ve+=r.charAt(fe>>8*ye+4&15)+r.charAt(fe>>8*ye&15);return ve}function a(fe,ye){const ve=(65535&fe)+(65535&ye);return(fe>>16)+(ye>>16)+(ve>>16)<<16|65535&ve}function c(fe,ye,ve,_e,Ne,Je){return a(function(ft,yt){return ft<<yt|ft>>>32-yt}(a(a(ye,fe),a(_e,Je)),Ne),ve)}function d(fe,ye,ve,_e,Ne,Je,ft){return c(ye&ve|~ye&_e,fe,ye,Ne,Je,ft)}function h(fe,ye,ve,_e,Ne,Je,ft){return c(ye&_e|ve&~_e,fe,ye,Ne,Je,ft)}function m(fe,ye,ve,_e,Ne,Je,ft){return c(ye^ve^_e,fe,ye,Ne,Je,ft)}function y(fe,ye,ve,_e,Ne,Je,ft){return c(ve^(ye|~_e),fe,ye,Ne,Je,ft)}const v=function(fe){let ye;const ve=1+(fe.length+8>>6),_e=new Array(16*ve);for(ye=0;ye<16*ve;ye++)_e[ye]=0;for(ye=0;ye<fe.length;ye++)_e[ye>>2]|=fe.charCodeAt(ye)<<ye%4*8;return _e[ye>>2]|=128<<ye%4*8,_e[16*ve-2]=8*fe.length,_e}(t);let T,R,P,D,G,F=1732584193,W=-271733879,Q=-1732584194,ee=271733878;for(T=0;T<v.length;T+=16)R=F,P=W,D=Q,G=ee,F=d(F,W,Q,ee,v[T+0],7,-680876936),ee=d(ee,F,W,Q,v[T+1],12,-389564586),Q=d(Q,ee,F,W,v[T+2],17,606105819),W=d(W,Q,ee,F,v[T+3],22,-1044525330),F=d(F,W,Q,ee,v[T+4],7,-176418897),ee=d(ee,F,W,Q,v[T+5],12,1200080426),Q=d(Q,ee,F,W,v[T+6],17,-1473231341),W=d(W,Q,ee,F,v[T+7],22,-45705983),F=d(F,W,Q,ee,v[T+8],7,1770035416),ee=d(ee,F,W,Q,v[T+9],12,-1958414417),Q=d(Q,ee,F,W,v[T+10],17,-42063),W=d(W,Q,ee,F,v[T+11],22,-1990404162),F=d(F,W,Q,ee,v[T+12],7,1804603682),ee=d(ee,F,W,Q,v[T+13],12,-40341101),Q=d(Q,ee,F,W,v[T+14],17,-1502002290),W=d(W,Q,ee,F,v[T+15],22,1236535329),F=h(F,W,Q,ee,v[T+1],5,-165796510),ee=h(ee,F,W,Q,v[T+6],9,-1069501632),Q=h(Q,ee,F,W,v[T+11],14,643717713),W=h(W,Q,ee,F,v[T+0],20,-373897302),F=h(F,W,Q,ee,v[T+5],5,-701558691),ee=h(ee,F,W,Q,v[T+10],9,38016083),Q=h(Q,ee,F,W,v[T+15],14,-660478335),W=h(W,Q,ee,F,v[T+4],20,-405537848),F=h(F,W,Q,ee,v[T+9],5,568446438),ee=h(ee,F,W,Q,v[T+14],9,-1019803690),Q=h(Q,ee,F,W,v[T+3],14,-187363961),W=h(W,Q,ee,F,v[T+8],20,1163531501),F=h(F,W,Q,ee,v[T+13],5,-1444681467),ee=h(ee,F,W,Q,v[T+2],9,-51403784),Q=h(Q,ee,F,W,v[T+7],14,1735328473),W=h(W,Q,ee,F,v[T+12],20,-1926607734),F=m(F,W,Q,ee,v[T+5],4,-378558),ee=m(ee,F,W,Q,v[T+8],11,-2022574463),Q=m(Q,ee,F,W,v[T+11],16,1839030562),W=m(W,Q,ee,F,v[T+14],23,-35309556),F=m(F,W,Q,ee,v[T+1],4,-1530992060),ee=m(ee,F,W,Q,v[T+4],11,1272893353),Q=m(Q,ee,F,W,v[T+7],16,-155497632),W=m(W,Q,ee,F,v[T+10],23,-1094730640),F=m(F,W,Q,ee,v[T+13],4,681279174),ee=m(ee,F,W,Q,v[T+0],11,-358537222),Q=m(Q,ee,F,W,v[T+3],16,-722521979),W=m(W,Q,ee,F,v[T+6],23,76029189),F=m(F,W,Q,ee,v[T+9],4,-640364487),ee=m(ee,F,W,Q,v[T+12],11,-421815835),Q=m(Q,ee,F,W,v[T+15],16,530742520),W=m(W,Q,ee,F,v[T+2],23,-995338651),F=y(F,W,Q,ee,v[T+0],6,-198630844),ee=y(ee,F,W,Q,v[T+7],10,1126891415),Q=y(Q,ee,F,W,v[T+14],15,-1416354905),W=y(W,Q,ee,F,v[T+5],21,-57434055),F=y(F,W,Q,ee,v[T+12],6,1700485571),ee=y(ee,F,W,Q,v[T+3],10,-1894986606),Q=y(Q,ee,F,W,v[T+10],15,-1051523),W=y(W,Q,ee,F,v[T+1],21,-2054922799),F=y(F,W,Q,ee,v[T+8],6,1873313359),ee=y(ee,F,W,Q,v[T+15],10,-30611744),Q=y(Q,ee,F,W,v[T+6],15,-1560198380),W=y(W,Q,ee,F,v[T+13],21,1309151649),F=y(F,W,Q,ee,v[T+4],6,-145523070),ee=y(ee,F,W,Q,v[T+11],10,-1120210379),Q=y(Q,ee,F,W,v[T+2],15,718787259),W=y(W,Q,ee,F,v[T+9],21,-343485551),F=a(F,R),W=a(W,P),Q=a(Q,D),ee=a(ee,G);return s(F)+s(W)+s(Q)+s(ee)}let Sme=1,i8=console,Ys=class{static setLogger(t){i8=t}constructor(t,r){Jt(this,"id",void 0),Jt(this,"lockingPromise",pt.resolve()),Jt(this,"locks",0),Jt(this,"name",""),Jt(this,"lockId",void 0),this.lockId=Sme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");i8.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new pt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function Jv(t,r){return function(s,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var y=arguments.length,v=new Array(y),T=0;T<y;T++)v[T]=arguments[T];return await d.apply(this,v)}finally{m()}},c}}const Li={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function NL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function Fd(t,r,s,a){const c=Object.assign({},Li,a);let d=c.timeout;const h=async()=>{await function(v){return new pt(T=>{window.setTimeout(T,v)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const y=new pt(async(v,T)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return T(new Le(te.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return v(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return T(P);await h()}}});return y.cancel=()=>m=!0,y}let uP,s8=class{constructor(t){Jt(this,"input",[]),Jt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Sc(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},dP=0,DL=0;function xL(t,r,s,a){return new pt((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),dP+=Vh(r.data)):s&&(r.data.size?dP+=r.data.size:r.data instanceof FormData?dP+=Qz(r.data):dP+=Vh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ta.request(r).then(h=>{typeof h.data=="string"?DL+=Vh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?DL+=h.data.byteLength:DL+=Vh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Ta.isCancel(h)?d(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(te.NETWORK_ERROR,h.message))})})}async function bme(t,r){const s=new Blob([r.data],{type:"buffer"});return await xL(t,bt(bt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const o8=()=>window.isSecureContext!==void 0;function ju(t){if(Array.isArray(t))return t.map(s=>s);if(!a8(t))return t;const r={};for(const s in t){const a=t[s];a8(a)||Array.isArray(a)?r[s]=ju(a):r[s]=a}return r}function a8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let LL=class{constructor(t){Jt(this,"input",[]),Jt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const jh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},VT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:jh,remoteCandidate:jh},updateInterval:0},c8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},l8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},u8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},d8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let ML=class{constructor(t,r){Jt(this,"onFirstVideoReceived",void 0),Jt(this,"onFirstVideoDecoded",void 0),Jt(this,"onFirstAudioReceived",void 0),Jt(this,"onFirstVideoDecodedTimeout",void 0),Jt(this,"onFirstAudioDecoded",void 0),Jt(this,"onSelectedLocalCandidateChanged",void 0),Jt(this,"onSelectedRemoteCandidateChanged",void 0),Jt(this,"videoIsReady",!1),Jt(this,"videoIsReady2",{}),Jt(this,"pc",void 0),Jt(this,"options",void 0),Jt(this,"intervalTimer",void 0),Jt(this,"stats",ju(VT)),Jt(this,"isFirstVideoReceived",{}),Jt(this,"isFirstVideoDecoded",{}),Jt(this,"isFirstAudioReceived",{}),Jt(this,"isFirstAudioDecoded",{}),Jt(this,"isFirstVideoDecodedTimeout",{}),Jt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new pt(t=>{t({local:bt({},jh),remote:bt({},jh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const T=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(a+=T,d+=R):(c+=T,h+=R),Number.isNaN(T)||Number.isNaN(T)?y.packetLostRate=0:y.packetLostRate=T<=0||R<=0?0:R/(T+R)});t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Tme=class extends ML{constructor(){super(...arguments),Jt(this,"_stats",VT),Jt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=ju(VT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const a=r.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const a=at(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=ju(l8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=ju(c8),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:bt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=ju(d8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=ju(u8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new pt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),r.push(a)}),r}},jT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),hP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),UL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),sl=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Qv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Qv||{});function FT(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Qv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[a]);if(typeof y!="number")return;const v=h-y;return v?(d-m)/v*c:void 0}let h8=class extends ML{constructor(){super(...arguments),Jt(this,"_stats",VT),Jt(this,"report",void 0),Jt(this,"lastDecodeVideoReceiverStats",new Map),Jt(this,"lastVideoFramesRecv",new Map),Jt(this,"lastVideoFramesSent",new Map),Jt(this,"lastVideoFramesDecode",new Map),Jt(this,"lastVideoFramesOutput",new Map),Jt(this,"lastVideoJBDelay",new Map),Jt(this,"lastAudioJBDelay",new Map),Jt(this,"mediaBytesSent",new Map),Jt(this,"mediaBytesRetransmit",new Map),Jt(this,"mediaBytesTargetEncode",new Map),Jt(this,"lastDecodeAudioReceiverStats",new Map),Jt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ju(VT),this.report.forEach(t=>{switch(t.type){case sl.OUTBOUND:case sl.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===sl.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===sl.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case sl.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case sl.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:bt({},jh),remote:bt({},jh)};return t.forEach(s=>{let a;if(s.type===sl.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===sl.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&c(r.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===sl.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===sl.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===sl.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(bt({},r),bt({},this.stats.selectedCandidatePair.localCandidate)),t.type===sl.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(bt({},r),bt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);r||(r=ju(d8),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=FT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Qv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,bt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=ju(c8),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=FT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=FT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Qv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=FT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Qv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=FT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Qv.kMillisecondsFromSeconds),a&&d-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:bt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);r||(r=ju(l8),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new LL(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new LL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new LL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,sl.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=ju(u8),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,sl.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(nl(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,y=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,T=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof T=="number"||(v=0,T=0),R==null){const P=Date.now(),D=this.lastVideoFramesSent.get(s.ssrc);D&&P-D.lts>=800?(R=Math.round((y-D.count)/((P-D.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:v,height:T,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var a,c,d,h,m;const y=r?this.report.get(r):void 0,v=(a=y==null?void 0:y.framesReceived)!==null&&a!==void 0?a:t.framesReceived,T=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(d=y==null?void 0:y.frameHeight)!==null&&d!==void 0?d:t.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,D=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),F=Date.now();s.framesReceivedCount=v;let W=0;G&&F-G.lts>=800?(W=Math.round((v-G.count)/((F-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:F,rate:W})):G?W=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:F,rate:0}),s.receivedFrame={width:T||0,height:R||0,frameRate:W||0},s.decodedFrame={width:T||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:T||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&D){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=G.jitterBufferMs;const W=D-G.jitterBufferEmittedCount;W>0&&(F=1e3*(P-G.jitterBufferDelay)/W),s.jitterBufferMs=F,s.currentDelayMs=Math.round(F),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:D,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,y=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,v=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var a,c,d,h,m,y,v;const T=r?this.report.get(r):void 0,R=(a=T==null?void 0:T.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,P=(c=T==null?void 0:T.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,D=(d=T==null?void 0:T.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,G=(h=T==null?void 0:T.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,F=(m=T==null?void 0:T.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,W=(y=T==null?void 0:T.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,Q=(v=T==null?void 0:T.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),D&&G){const fe=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=fe.jitterBufferMs;const ve=G-fe.jitterBufferEmittedCount;ve>0&&(ye=1e3*(D-fe.jitterBufferDelay)/ve),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=F;let ee=1920;W&&P&&(ee=P/W/50,s.receivedFrames=Math.round(P/ee)),Q&&(s.droppedFrames=Math.round(Q/ee))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},wme=class extends ML{updateStats(){return pt.resolve()}};function VL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Tme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new h8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof pt||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new h8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new wme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const p8="websdk_ng_install_id";function jL(){try{if(ae("INSTALL_ID"))return ae("INSTALL_ID");let t=window.localStorage.getItem(p8);return t||(t=Q_(),window.localStorage.setItem(p8,t)),or("INSTALL_ID",t),t}catch{return}}const $l=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.23.2"),FL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Z_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Bs=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Bs;const pP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},BL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},WL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",zL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Ar=bt(bt(bt({},zL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:BL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},pP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function or(t,r,s){var a,c,d;at(a=Object.keys(Ar)).call(a,t)&&(!s&&at(c=Object.keys(Bd)).call(c,t)||(Ar[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(Ar.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(Ar.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,Ar.USE_NEW_NETWORK_CONFIG=d,d&&(Ar.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ar.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ar.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ar.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ar.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ar.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(Ar.ENABLE_INSTANT_VIDEO=!0,Ar.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(Ar.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(Ar.NEW_TURN_MODE||(Ar.NEW_TURN_MODE=4))))}function ae(t){return Ar[t]}FL||(Ar.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ar.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ar.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ar.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ar.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ar.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ar.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ar.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ar.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ar.AREAS=["NORTH_AMERICA","OVERSEA"]);let f8=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Bd={};var wn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(wn||{});let fP=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const m8=128,Cme=96,g8=1e3,Zv=10;let Rme=0;var _8=(()=>{var t={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>ft,Printer:()=>fi,parse:()=>ot,print:()=>At});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function T(Ke){return Ke>="0"&&Ke<="9"}function R(Ke){return Ke>="!"&&Ke<="~"}function P(Ke){return R(Ke)||Ke>=""&&Ke<=""}function D(Ke){return Ke==="!"||Ke>="#"&&Ke<="'"||Ke>="*"&&Ke<="+"||Ke>="-"&&Ke<="."||Ke>="0"&&Ke<="9"||Ke>="A"&&Ke<="Z"||Ke>="^"&&Ke<="~"}function G(Ke){return Ke>="1"&&Ke<="9"}function F(Ke){return Ke>="A"&&Ke<="Z"||Ke>="a"&&Ke<="z"}function W(Ke){return Ke==="d"||Ke==="h"||Ke==="m"||Ke==="s"}function Q(Ke){return Ke>""&&Ke<"	"||Ke>"\v"&&Ke<"\f"||Ke>""&&Ke<""}function ee(Ke){return F(Ke)||T(Ke)||Ke==="+"||Ke==="/"}function fe(Ke){return T(Ke)||F(Ke)||Ke==="+"||Ke==="/"||Ke==="-"||Ke==="_"}function ye(Ke){return F(Ke)||T(Ke)||Ke==="+"||Ke==="/"}function ve(Ke,V){var ce=Object.keys(Ke);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(Ke);V&&(me=me.filter(function(tt){return Object.getOwnPropertyDescriptor(Ke,tt).enumerable})),ce.push.apply(ce,me)}return ce}function _e(Ke){for(var V=1;V<arguments.length;V++){var ce=arguments[V]!=null?arguments[V]:{};V%2?ve(Object(ce),!0).forEach(function(me){Ne(Ke,me,ce[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ke,Object.getOwnPropertyDescriptors(ce)):ve(Object(ce)).forEach(function(me){Object.defineProperty(Ke,me,Object.getOwnPropertyDescriptor(ce,me))})}return Ke}function Ne(Ke,V,ce){return V in Ke?Object.defineProperty(Ke,V,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ke[V]=ce,Ke}(function(Ke){Ke.VERSION="v",Ke.ORIGIN="o",Ke.SESSION_NAME="s",Ke.INFORMATION="i",Ke.URI="u",Ke.EMAIL="e",Ke.PHONE="p",Ke.CONNECTION="c",Ke.BANDWIDTH="b",Ke.TIME="t",Ke.REPEAT="r",Ke.ZONE_ADJUSTMENTS="z",Ke.KEY="k",Ke.ATTRIBUTE="a",Ke.MEDIA="m"})(v||(v={}));class Je{consumeText(V,ce){let me=ce;for(;me<V.length;){const tt=V[me];if(tt==="\0"||tt==="\r"||tt===h)break;me+=1}if(me-ce==0)throw new Error("Invalid text, at ".concat(V));return me}consumeUnicastAddress(V,ce,me){return this.consumeTill(V,ce,y)}consumeOneOrMore(V,ce,me){let tt=ce;for(;me(V[tt]);)tt++;if(tt-ce==0)throw new Error("Invalid rule at ".concat(ce,"."));return tt}consumeSpace(V,ce){if(V[ce]===y)return ce+1;throw new Error("Invalid space at ".concat(ce,"."))}consumeIP4Address(V,ce){let me=ce;for(let tt=0;tt<4;tt++)if(me=this.consumeDecimalUChar(V,me),tt!==3){if(V[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(V,ce){let me=ce;for(let Zt=0;Zt<3&&T(V[me]);Zt++,me++);if(me-ce==0)throw new Error("Invalid decimal uchar.");const tt=parseInt(V.slice(ce,me));if(tt>=0&&tt<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(V,ce){let me=this.consumeHexpart(V,ce);return V[me]===":"&&(me+=1,me=this.consumeIP4Address(V,me)),me}consumeHexpart(V,ce){let me=ce;if(V[me]===":"&&V[me+1]===":"){me+=2;try{me=this.consumeHexseq(V,me)}catch{}return me}if(me=this.consumeHexseq(V,me),V[me]===":"&&V[me+1]===":"){me+=2;try{me=this.consumeHexseq(V,me)}catch{}return me}return me}consumeHexseq(V,ce){let me=ce;for(;me=this.consumeHex4(V,me),V[me]===":"&&V[me+1]!==":";)me+=1;return me}consumeHex4(V,ce){let me=0;for(;me<4;me++)if(!((tt=V[ce+me])>="0"&&tt<="9"||tt>="a"&&tt<="f"||tt>="A"&&tt<="F")){if(me===0)throw new Error("Invalid hex 4");break}var tt;return ce+me}consumeFQDN(V,ce){let me=ce;for(;T(V[me])||F(V[me])||V[me]==="-"||V[me]===".";)me+=1;if(me-ce<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(V,ce){return this.consumeOneOrMore(V,ce,P)}consumeMulticastAddress(V,ce,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(V,ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(V,ce);default:try{return this.consumeFQDN(V,ce)}catch{return this.consumeExtnAddr(V,ce)}}}consumeIP6MulticastAddress(V,ce){const me=this.consumeHexpart(V,ce);return V[me]==="/"?this.consumeInteger(V,me+1):me}consumeIP4MulticastAddress(V,ce){let me=ce+3;const tt=V.slice(ce,me),Zt=parseInt(tt);if(Zt<224||Zt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dr=0;dr<3;dr++){if(V[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(V,me)}return V[me]==="/"&&(me+=1),me=this.consumeTTL(V,me),V[me]==="/"&&(me=this.consumeInteger(V,me)),me}consumeInteger(V,ce){if(!G(V[ce]))throw new Error("Invalid integer.");for(ce+=1;T(V[ce]);)ce+=1;return ce}consumeTTL(V,ce){if(V[ce]==="0")return ce+1;if(!G(V[ce]))throw new Error("Invalid TTL.");ce+=1;for(let me=0;me<2&&T(V[ce]);me++)ce+=1;return ce}consumeToken(V,ce){return this.consumeOneOrMore(V,ce,D)}consumeTime(V,ce){let me=ce;if(V[me]==="0")return me+1;for(G(V[me])&&(me+=1);T(V[me]);)me++;if(me-ce<10)throw new Error("Invalid time");return me}consumeAddress(V,ce){return this.consumeTill(V,ce,y)}consumeTypedTime(V,ce){let me=ce;return me=this.consumeOneOrMore(V,me,T),W(V[me])?me+1:me}consumeRepeatInterval(V,ce){if(!G(V[ce]))throw new Error("Invalid repeat interval");for(ce+=1;T(V[ce]);)ce+=1;return W(V[ce])&&(ce+=1),ce}consumePort(V,ce){return this.consumeOneOrMore(V,ce,T)}consume(V,ce,me){for(let tt=0;tt<me.length;tt++){if(ce+tt>=V.length)throw new Error("consume exceeding value length");if(V[ce+tt]!==me[tt])throw new Error("consume ".concat(me," failed at ").concat(tt))}return ce+me.length}consumeTill(V,ce,me){let tt=ce;for(;tt<V.length&&(typeof me!="string"||V[tt]!==me)&&(typeof me!="function"||!me(V[tt]));)tt++;return tt}}class ft extends Je{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(V){const ce=this.probeEOL(V);this.records=V.split(ce).filter(Ty=>!!bo(Ty).call(Ty)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),tt=this.parseOrigin(),Zt=this.parseSessionName(),dr=this.parseInformation(),ns=this.parseUri(),ic=this.parseEmail(),If=this.parsePhone(),by=this.parseConnection(),Tw=this.parseBandWidth(),CO=this.parseTimeFields(),RO=this.parseKey(),eu=this.parseSessionAttribute(),gg=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:tt,sessionName:Zt,information:dr,uri:ns,emails:ic,phones:If,connection:by,bandwidths:Tw,timeFields:CO,key:RO,attributes:eu,mediaDescriptions:gg}}getCurrentRecord(){const V=this.records[this.currentLine];if(!V)throw new Error("Record doesn't exit.");return V}probeEOL(V){for(let ce=0;ce<V.length;ce++)if(V[ce]===h)return V[ce-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(V,ce){if(V.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=V[0];if(V[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:V.slice(2),line:ce,cur:0}}parseSessionAttribute(){const V=new An;for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(ce,tt=>D(tt)&&tt!==":"),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,me.attValue=this.extractOneOrMore(ce,Q)),V.parse(me),this.currentLine++}return V.digest()}parseMediaAttributes(V){const ce=new Pn(V);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==v.ATTRIBUTE)break;const tt={attField:this.extractOneOrMore(me,Zt=>D(Zt)&&Zt!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,tt.attValue=this.extractOneOrMore(me,Q)),ce.parse(tt),this.currentLine++}return ce.digest()}parseKey(){const V=this.getCurrentRecord();if(V.type===v.KEY){if(V.value==="prompt"||V.value==="clear:"||V.value==="base64:"||V.value==="uri:")return V.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const V=this.getCurrentRecord();if(V.type===v.ZONE_ADJUSTMENTS){const ce=[];for(;;)try{const me=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);let tt=!1;V.value[V.cur]==="-"&&(tt=!0,V.cur+=1);const Zt=this.extract(V,this.consumeTypedTime);ce.push({time:me,typedTime:Zt,back:tt})}catch{break}if(ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ce}return[]}parseRepeat(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.REPEAT)break;{const me=this.extract(ce,this.consumeRepeatInterval),tt=this.parseTypedTime(ce);V.push({repeatInterval:me,typedTimes:tt}),this.currentLine++}}return V}parseTypedTime(V){const ce=[];for(;;)try{this.consumeSpaceForRecord(V),ce.push(this.extract(V,this.consumeTypedTime))}catch{break}if(ce.length===0)throw new Error("Invalid typed time.");return ce}parseTime(){const V=this.getCurrentRecord(),ce=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);const me=this.extract(V,this.consumeTime);return this.currentLine++,{startTime:ce,stopTime:me}}parseBandWidth(){const V=[];for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.BANDWIDTH)break;{const me=this.extractOneOrMore(ce,D);if(ce.value[ce.cur]!==":")throw new Error("Invalid bandwidth field.");ce.cur++;const tt=this.extractOneOrMore(ce,T);V.push({bwtype:me,bandwidth:tt}),this.currentLine++}}return V}parseVersion(){const V=this.getCurrentRecord();if(V.type!==v.VERSION)throw new Error("first sdp record must be version");const ce=V.value.slice(0,this.consumeOneOrMore(V.value,0,T));if(ce.length!==V.value.length)throw new Error('invalid proto version, "v='.concat(V.value,'"'));return this.currentLine++,ce}parseOrigin(){const V=this.getCurrentRecord();if(V.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ce=this.extractOneOrMore(V,P);this.consumeSpaceForRecord(V);const me=this.extractOneOrMore(V,T);this.consumeSpaceForRecord(V);const tt=this.extractOneOrMore(V,T);this.consumeSpaceForRecord(V);const Zt=this.extractOneOrMore(V,D);this.consumeSpaceForRecord(V);const dr=this.extractOneOrMore(V,D);this.consumeSpaceForRecord(V);const ns=this.extract(V,this.consumeUnicastAddress);return this.currentLine++,{username:ce,sessId:me,sessVersion:tt,nettype:Zt,addrtype:dr,unicastAddress:ns}}parseSessionName(){const V=this.getCurrentRecord();if(V.type===v.SESSION_NAME){const ce=this.extract(V,this.consumeText);return this.currentLine++,ce}}parseInformation(){const V=this.getCurrentRecord();if(V.type!==v.INFORMATION)return;const ce=this.extract(V,this.consumeText);return this.currentLine++,ce}parseUri(){const V=this.getCurrentRecord();if(V.type===v.URI)return this.currentLine++,V.value}parseEmail(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.EMAIL)break;V.push(ce.value),this.currentLine++}return V}parsePhone(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.PHONE)break;V.push(ce.value),this.currentLine++}return V}parseConnection(){const V=this.getCurrentRecord();if(V.type===v.CONNECTION){const ce=this.extractOneOrMore(V,D);this.consumeSpaceForRecord(V);const me=this.extractOneOrMore(V,D);this.consumeSpaceForRecord(V);const tt=this.extract(V,this.consumeAddress);return this.currentLine++,{nettype:ce,addrtype:me,address:tt}}}parseMedia(){const V=this.getCurrentRecord(),ce=this.extract(V,this.consumeToken);this.consumeSpaceForRecord(V);let me=this.extract(V,this.consumePort);V.value[V.cur]==="/"&&(V.cur+=1,me+=this.extract(V,this.consumeInteger)),this.consumeSpaceForRecord(V);const tt=[];for(tt.push(this.extract(V,this.consumeToken));V.value[V.cur]==="/";)V.cur+=1,tt.push(this.extract(V,this.consumeToken));if(tt.length===0)throw new Error("Invalid proto");const Zt=this.parseFmt(V);return this.currentLine++,{mediaType:ce,port:me,protos:tt,fmts:Zt}}parseTimeFields(){const V=[];for(;this.getCurrentRecord().type===v.TIME;){const ce=this.parseTime(),me=this.parseRepeat(),tt=this.parseZone();V.push({time:ce,repeats:me,zones:tt})}return V}parseMediaDescription(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ce=this.parseMedia(),me=this.parseInformation(),tt=this.parseConnections(),Zt=this.parseBandWidth(),dr=this.parseKey(),ns=this.parseMediaAttributes(ce);V.push({media:ce,information:me,connections:tt,bandwidths:Zt,key:dr,attributes:ns})}return V}parseConnections(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)V.push(this.parseConnection());return V}parseFmt(V){const ce=[];for(;;)try{this.consumeSpaceForRecord(V),ce.push(this.extract(V,this.consumeToken))}catch{break}if(ce.length===0)throw new Error("Invalid fmts");return ce}extract(V,ce){for(var me=arguments.length,tt=new Array(me>2?me-2:0),Zt=2;Zt<me;Zt++)tt[Zt-2]=arguments[Zt];const dr=ce.call(this,V.value,V.cur,...tt),ns=V.value.slice(V.cur,dr);return V.cur=dr,ns}extractOneOrMore(V,ce){const me=this.consumeOneOrMore(V.value,V.cur,ce),tt=V.value.slice(V.cur,me);return V.cur=me,tt}consumeSpaceForRecord(V){if(V.value[V.cur]!==y)throw new Error("Invalid space at ".concat(V.cur,"."));V.cur+=1}}class yt extends Je{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(V,ce,me){const tt=this.consumeOneOrMore(V.attValue,V._cur,ce),Zt=V.attValue.slice(V._cur,tt),[dr,ns]=me||[];if(typeof dr=="number"&&Zt.length<dr)throw new Error("error in length, should be more or equal than ".concat(dr," characters."));if(typeof ns=="number"&&Zt.length>ns)throw new Error("error in length, should be less or equal than ".concat(ns," characters."));return V._cur=tt,Zt}consumeAttributeSpace(V){if(V.attValue[V._cur]!==y)throw new Error("Invalid space at ".concat(V._cur,"."));V._cur+=1}extract(V,ce){if(!V.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,tt=new Array(me>2?me-2:0),Zt=2;Zt<me;Zt++)tt[Zt-2]=arguments[Zt];const dr=ce.call(this,V.attValue,V._cur,...tt),ns=V.attValue.slice(V._cur,dr);return V._cur=dr,ns}atEnd(V){if(!V.attValue)throw new Error;return V._cur>=V.attValue.length}peekChar(V){if(!V.attValue)throw new Error;return V.attValue[V._cur]}peek(V,ce){if(!V.attValue)throw new Error;for(let me=0;me<ce.length;me++)if(ce[me]!==V.attValue[V._cur+me])return!1;return!0}parseIceUfrag(V){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(V,ee,[4,256])}parseIcePwd(V){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(V,ee,[22,256])}parseIceOptions(V){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ce=[];for(;!this.atEnd(V);){ce.push(this.extractOneOrMore(V,ee));try{this.consumeAttributeSpace(V)}catch(me){if(this.atEnd(V))break;throw me}}this.attributes.iceOptions=ce}parseFingerprint(V){const ce=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const me=this.extract(V,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ce,fingerprint:me})}parseExtmap(V){const ce=this.extractOneOrMore(V,T);let me;this.peekChar(V)==="/"&&(this.extract(V,this.consume,"/"),me=this.extract(V,this.consumeToken)),this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeTill,y),Zt=_e(_e({entry:parseInt(ce,10)},me&&{direction:me}),{},{extensionName:tt});this.peekChar(V)===y&&(this.consumeAttributeSpace(V),Zt.extensionAttributes=this.extract(V,this.consumeTill)),this.attributes.extmaps.push(Zt)}parseSetup(V){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ce=this.extract(V,this.consumeTill);if(ce!=="active"&&ce!=="passive"&&ce!=="actpass"&&ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ce}}class An extends yt{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"group":this.parseGroup(V);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"fingerprint":this.parseFingerprint(V);break;case"setup":this.parseSetup(V);break;case"tls-id":this.parseTlsId(V);break;case"identity":this.parseIdentity(V);break;case"extmap":this.parseExtmap(V);break;case"msid-semantic":this.parseMsidSemantic(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(ce){throw console.error("parsing session attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),ce}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(V){const ce=this.extract(V,this.consumeToken),me=[];for(;!this.atEnd(V)&&this.peekChar(V)===y;)this.consumeAttributeSpace(V),me.push(this.extract(V,this.consumeToken));this.attributes.groups.push({semantic:ce,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(V){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(V,fe)}parseIdentity(V){const ce=this.extractOneOrMore(V,ye),me=[];for(;!this.atEnd(V)&&this.peekChar(V)===y;){this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.extract(V,this.consume,"=");const Zt=this.extractOneOrMore(V,dr=>dr!==y&&Q(dr));me.push({name:tt,value:Zt})}this.attributes.identities.push({assertionValue:ce,extensions:me})}parseMsidSemantic(V){this.peekChar(V)===y&&this.consumeAttributeSpace(V);const ce={semantic:this.extract(V,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(V)}catch{break}if(this.peekChar(V)==="*"){this.extract(V,this.consume,"*"),ce.applyForAll=!0;break}{const me=this.extract(V,this.consumeTill,y);ce.identifierList.push(me)}}this.attributes.msidSemantic=ce}}class Pn extends yt{constructor(V){super(),Ne(this,"attributes",void 0),V.protos.indexOf("RTP")!==-1||V.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"extmap":this.parseExtmap(V);break;case"setup":this.parseSetup(V);break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"candidate":this.parseCandidate(V);break;case"remote-candidate":this.parseRemoteCandidate(V);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(V);break;case"rtpmap":this.parseRtpmap(V);break;case"ptime":this.parsePtime(V);break;case"maxptime":this.parseMaxPtime(V);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(V);break;case"ssrc":this.parseSSRC(V);break;case"fmtp":this.parseFmtp(V);break;case"rtcp-fb":this.parseRtcpFb(V);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(V);break;case"mid":this.parseMid(V);break;case"msid":this.parseMsid(V);break;case"imageattr":this.parseImageAttr(V);break;case"rid":this.parseRid(V);break;case"simulcast":this.parseSimulcast(V);break;case"sctp-port":this.parseSctpPort(V);break;case"max-message-size":this.parseMaxMessageSize(V);break;case"ssrc-group":this.parseSSRCGroup(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(ce){throw console.error("parsing media attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),ce}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}parseCandidate(V){const ce=this.extractOneOrMore(V,ee,[1,32]);this.consumeAttributeSpace(V);const me=this.extractOneOrMore(V,T,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const Zt=this.extractOneOrMore(V,T,[1,10]);this.consumeAttributeSpace(V);const dr=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const ns=this.extract(V,this.consumePort);this.consumeAttributeSpace(V),this.extract(V,this.consume,"typ"),this.consumeAttributeSpace(V);const ic={foundation:ce,componentId:me,transport:tt,priority:Zt,connectionAddress:dr,port:ns,type:this.extract(V,this.consumeToken),extension:{}};for(this.peek(V," raddr")&&(this.extract(V,this.consume," raddr"),this.consumeAttributeSpace(V),ic.relAddr=this.extract(V,this.consumeAddress)),this.peek(V," rport")&&(this.extract(V,this.consume," rport"),this.consumeAttributeSpace(V),ic.relPort=this.extract(V,this.consumePort));this.peekChar(V)===y;){this.consumeAttributeSpace(V);const If=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V),ic.extension[If]=this.extractOneOrMore(V,R)}this.attributes.candidates.push(ic)}parseRemoteCandidate(V){const ce=[];for(;;){const me=this.extractOneOrMore(V,T,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const Zt=this.extract(V,this.consumePort);ce.push({componentId:me,connectionAddress:tt,port:Zt});try{this.consumeAttributeSpace(V)}catch{break}}this.attributes.remoteCandidatesList.push(ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(V){const ce=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const me=this.extract(V,this.consumeTill,"/");this.extract(V,this.consume,"/");const tt={encodingName:me,clockRate:this.extractOneOrMore(V,T)};this.atEnd(V)||this.peekChar(V)!=="/"||(this.extract(V,this.consume,"/"),tt.encodingParameters=parseInt(this.extract(V,this.consumeTill),10));const Zt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ce,10));Zt?Zt.rtpMap=tt:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtpMap:tt,rtcpFeedbacks:[]})}parsePtime(V){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(V,this.consumeTill)}parseMaxPtime(V){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(V,this.consumeTill)}parseDirection(V){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=V.attField}parseSSRC(V){const ce=this.extractOneOrMore(V,T);this.consumeAttributeSpace(V);const me=this.extract(V,this.consumeTill,":");let tt;this.peekChar(V)===":"&&(this.extract(V,this.consume,":"),tt=this.extract(V,this.consumeTill));const Zt=this.attributes.ssrcs.find(dr=>dr.ssrcId===parseInt(ce,10));Zt?Zt.attributes[me]=tt:this.attributes.ssrcs.push({ssrcId:parseInt(ce,10),attributes:{[me]:tt}})}parseFmtp(V){const ce=this.extract(V,this.consumeTill,y);this.consumeAttributeSpace(V);const me=this.extract(V,this.consumeTill),tt={};me.split(";").forEach(dr=>{let[ns,ic]=dr.split("=");ns=bo(ns).call(ns);const If=typeof ic=="string"?bo(ic).call(ic):null;typeof ns=="string"&&ns.length>0&&(tt[ns]=If)});const Zt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ce,10));Zt?Zt.fmtp={parameters:tt}:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[],fmtp:{parameters:tt}})}parseFmtParameters(V){const ce={},me=this.extract(V,this.consumeTill,"=");V._cur++;const tt=this.extract(V,this.consumeTill,";");for(ce[me]=tt;V.attValue[V._cur]===";";){const Zt=this.extract(V,this.consumeTill,"=");V._cur++;const dr=this.extract(V,this.consumeTill,";");ce[Zt]=dr}return ce}parseRtcpFb(V){let ce="";ce=this.peekChar(V)==="*"?this.extract(V,this.consume,"*"):this.extract(V,this.consumeTill,y),this.consumeAttributeSpace(V);const me=this.extract(V,this.consumeTill,y);let tt;if(me==="trr-int")tt={type:me,interval:this.extract(V,this.consumeTill)};else{const Zt={type:me};this.peekChar(V)===y&&(this.consumeAttributeSpace(V),Zt.parameter=this.extract(V,this.consumeToken),this.peekChar(V)===y&&(Zt.additional=this.extract(V,this.consumeTill))),tt=Zt}if(ce==="*")this.attributes.rtcpFeedbackWildcards.push(tt);else{const Zt=this.attributes.payloads.find(dr=>dr.payloadType===parseInt(ce,10));Zt?Zt.rtcpFeedbacks.push(tt):this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[tt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(V){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ce={port:this.extract(V,this.consumePort)};this.peekChar(V)===y&&(this.consumeAttributeSpace(V),ce.netType=this.extractOneOrMore(V,D),this.consumeAttributeSpace(V),ce.addressType=this.extractOneOrMore(V,D),this.consumeAttributeSpace(V),ce.address=this.extract(V,this.consumeAddress)),this.attributes.rtcp=ce}parseMsid(V){const ce={id:this.extractOneOrMore(V,D,[1,64])};this.peekChar(V)===y&&(this.consumeAttributeSpace(V),ce.appdata=this.extractOneOrMore(V,D,[1,64])),this.attributes.msids.push(ce)}parseImageAttr(V){this.attributes.imageattr.push(V.attValue)}parseRid(V){const ce=this.extractOneOrMore(V,tt=>F(tt)||T(tt)||tt==="_"||tt==="-");this.consumeAttributeSpace(V);const me={id:ce,direction:this.extract(V,this.consumeToken),params:[]};if(this.peekChar(V)===y){if(this.consumeAttributeSpace(V),this.peek(V,"pt=")){this.extract(V,this.consume,"pt=");const tt=[];for(;;){const Zt=this.extract(V,this.consumeToken);tt.push(Zt);try{this.extract(V,this.consume,",")}catch{break}}me.payloads=tt,this.peekChar(V)===y&&this.extract(V,this.consume,y)}for(;;){const tt=this.extract(V,this.consumeToken);switch(tt){case"depend":{const Zt={type:tt,rids:this.extract(V,this.consume,"=").split(",")};me.params.push(Zt);break}default:{const Zt={type:tt};this.peekChar(V)==="="&&(this.extract(V,this.consume,"="),Zt.val=this.extract(V,this.consumeTill,";")),me.params.push(Zt)}}try{this.extract(V,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(V){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=V.attValue,this.extract(V,this.consumeTill)}parseSctpPort(V){this.attributes.sctpPort=this.extractOneOrMore(V,T,[1,5])}parseMaxMessageSize(V){this.attributes.maxMessageSize=this.extractOneOrMore(V,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(V){this.attributes.mid=this.extract(V,this.consumeToken)}parseSSRCGroup(V){const ce=this.extract(V,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeInteger);me.push(parseInt(tt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ce,ssrcIds:me})}}function vr(Ke,V,ce){return V in Ke?Object.defineProperty(Ke,V,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ke[V]=ce,Ke}class fi{constructor(){vr(this,"eol",m)}print(V,ce){let me="";return ce&&(this.eol=ce),me+=this.printVersion(V.version),me+=this.printOrigin(V.origin),me+=this.printSessionName(V.sessionName),me+=this.printInformation(V.information),me+=this.printUri(V.uri),me+=this.printEmail(V.emails),me+=this.printPhone(V.phones),me+=this.printConnection(V.connection),me+=this.printBandwidth(V.bandwidths),me+=this.printTimeFields(V.timeFields),me+=this.printKey(V.key),me+=this.printSessionAttributes(V.attributes),me+=this.printMediaDescription(V.mediaDescriptions),me}printVersion(V){return"v=".concat(V).concat(this.eol)}printOrigin(V){return"o=".concat(V.username," ").concat(V.sessId," ").concat(V.sessVersion," ").concat(V.nettype," ").concat(V.addrtype," ").concat(V.unicastAddress).concat(this.eol)}printSessionName(V){return V?"s=".concat(V).concat(this.eol):""}printInformation(V){return V?"i=".concat(V).concat(this.eol):""}printUri(V){return V?"u=".concat(V).concat(this.eol):""}printEmail(V){let ce="";for(const me of V)ce+="e=".concat(me).concat(this.eol);return ce}printPhone(V){let ce="";for(const me of V)ce+="e=".concat(me).concat(this.eol);return ce}printConnection(V){return V?"c=".concat(V.nettype," ").concat(V.addrtype," ").concat(V.address).concat(this.eol):""}printBandwidth(V){let ce="";for(const me of V)ce+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return ce}printTimeFields(V){let ce="";for(const me of V){ce+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const tt of me.repeats)ce+="r=".concat(tt.repeatInterval," ").concat(tt.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(ce+="z=",ce+="z=".concat(me.zoneAdjustments.map(tt=>"".concat(tt.time," ").concat(tt.back?"-":""," ").concat(tt.typedTime)).join(" ")).concat(this.eol),ce+=this.eol)}return ce}printKey(V){return V?"k=".concat(V).concat(this.eol):""}printAttributes(V){let ce="";for(const me of V)ce+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return ce}printMediaDescription(V){let ce="";for(const me of V)ce+=this.printMedia(me.media),ce+=this.printInformation(me.information),ce+=this.printConnections(me.connections),ce+=this.printBandwidth(me.bandwidths),ce+=this.printKey(me.key),ce+=this.printMediaAttributes(me);return ce}printConnections(V){let ce="";for(const me of V)ce+=this.printConnection(me);return ce}printMedia(V){return"m=".concat(V.mediaType," ").concat(V.port," ").concat(V.protos.join("/")," ").concat(V.fmts.join(" ")).concat(this.eol)}printSessionAttributes(V){return new Pa(this.eol).print(V)}printMediaAttributes(V){return new ze(this.eol).print(V)}}class ti{constructor(V){vr(this,"eol",void 0),this.eol=V}printIceUfrag(V){return V===void 0?"":"a=ice-ufrag:".concat(V).concat(this.eol)}printIcePwd(V){return V===void 0?"":"a=ice-pwd:".concat(V).concat(this.eol)}printIceOptions(V){return V===void 0?"":"a=ice-options:".concat(V.join(y)).concat(this.eol)}printFingerprints(V){return V.length>0?V.map(ce=>"a=fingerprint:".concat(ce.hashFunction).concat(y).concat(ce.fingerprint)).join(this.eol)+this.eol:""}printExtmap(V){return V.map(ce=>"a=extmap:".concat(ce.entry).concat(ce.direction?"/".concat(ce.direction):"").concat(y).concat(ce.extensionName).concat(ce.extensionAttributes?"".concat(y).concat(ce.extensionAttributes):"").concat(this.eol)).join("")}printSetup(V){return V===void 0?"":"a=setup:".concat(V).concat(this.eol)}printUnrecognized(V){return V.map(ce=>"a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol)).join("")}}class Pa extends ti{print(V){let ce="";return ce+=this.printGroups(V.groups),ce+=this.printMsidSemantic(V.msidSemantic),ce+=this.printIceLite(V.iceLite),ce+=this.printIceUfrag(V.iceUfrag),ce+=this.printIcePwd(V.icePwd),ce+=this.printIceOptions(V.iceOptions),ce+=this.printFingerprints(V.fingerprints),ce+=this.printSetup(V.setup),ce+=this.printTlsId(V.tlsId),ce+=this.printIdentity(V.identities),ce+=this.printExtmap(V.extmaps),ce+=this.printUnrecognized(V.unrecognized),ce}printGroups(V){let ce="";return V.length>0&&(ce+=V.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(tt=>"".concat(y).concat(tt)).join("")).concat(this.eol)).join("")),ce}printIceLite(V){return V===void 0?"":"a=ice-lite"+this.eol}printTlsId(V){return V?"a=tls-id:".concat(V).concat(this.eol):""}printIdentity(V){return V.length===0?"":V.map(ce=>"a=identity:".concat(ce.assertionValue).concat(ce.extensions.map(me=>"".concat(y).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(V){if(!V)return"";let ce="a=msid-semantic:".concat(V.semantic);return V.applyForAll?ce+="".concat(y,"*"):V.identifierList.length>0&&(ce+=V.identifierList.map(me=>"".concat(y).concat(me))),ce+this.eol}}class ze extends ti{print(V){const ce=V.attributes;let me="";return me+=this.printRTCP(ce.rtcp),me+=this.printIceUfrag(ce.iceUfrag),me+=this.printIcePwd(ce.icePwd),me+=this.printIceOptions(ce.iceOptions),me+=this.printCandidates(ce.candidates),me+=this.printRemoteCandidatesList(ce.remoteCandidatesList),me+=this.printEndOfCandidates(ce.endOfCandidates),me+=this.printFingerprints(ce.fingerprints),me+=this.printSetup(ce.setup),me+=this.printMid(ce.mid),me+=this.printExtmap(ce.extmaps),me+=this.printRTPRelated(ce),me+=this.printPtime(ce.ptime),me+=this.printMaxPtime(ce.maxPtime),me+=this.printDirection(ce.direction),me+=this.printSSRCGroups(ce.ssrcGroups),me+=this.printSSRC(ce.ssrcs),me+=this.printRTCPMux(ce.rtcpMux),me+=this.printRTCPMuxOnly(ce.rtcpMuxOnly),me+=this.printRTCPRsize(ce.rtcpRsize),me+=this.printMSId(ce.msids),me+=this.printImageattr(ce.imageattr),me+=this.printRid(ce.rids),me+=this.printSimulcast(ce.simulcast),me+=this.printSCTPPort(ce.sctpPort),me+=this.printMaxMessageSize(ce.maxMessageSize),me+=this.printUnrecognized(ce.unrecognized),me}printCandidates(V){return V.map(ce=>"a=candidate:".concat(ce.foundation).concat(y).concat(ce.componentId).concat(y).concat(ce.transport).concat(y).concat(ce.priority).concat(y).concat(ce.connectionAddress).concat(y).concat(ce.port).concat(y,"typ").concat(y).concat(ce.type).concat(ce.relAddr?"".concat(y,"raddr").concat(y).concat(ce.relAddr):"").concat(ce.relPort?"".concat(y,"rport").concat(y).concat(ce.relPort):"").concat(Object.keys(ce.extension).map(me=>"".concat(y).concat(me).concat(y).concat(ce.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(V){return V.map(ce=>"a=remote-candidates:".concat(ce.join(y)).concat(this.eol)).join("")}printEndOfCandidates(V){return V===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(V){if(!V.payloads)return"";const ce=V.payloads;let me="";me+=V.rtcpFeedbackWildcards.map(tt=>this.printRTCPFeedback("*",tt)).join("");for(const tt of ce)me+=this.printRtpMap(tt.payloadType,tt.rtpMap),me+=this.printFmtp(tt.payloadType,tt.fmtp),me+=tt.rtcpFeedbacks.map(Zt=>this.printRTCPFeedback(tt.payloadType,Zt)).join("");return me}printFmtp(V,ce){if(!ce)return"";const me=Object.keys(ce.parameters);return me.length===1&&ce.parameters[me[0]]===null?"a=fmtp:".concat(V).concat(y).concat(me[0]).concat(this.eol):"a=fmtp:".concat(V).concat(y).concat(Object.keys(ce.parameters).map(tt=>"".concat(tt,"=").concat(ce.parameters[tt])).join(";")).concat(this.eol)}printRtpMap(V,ce){return ce?"a=rtpmap:".concat(V).concat(y).concat(ce.encodingName,"/").concat(ce.clockRate).concat(ce.encodingParameters?"/".concat(ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(V,ce){let me="a=rtcp-fb:".concat(V).concat(y),tt=ce;return tt.type==="trr-int"?me+="ttr-int".concat(y).concat(tt.interval):(me+="".concat(tt.type),tt.parameter&&(me+="".concat(y).concat(tt.parameter),tt.additional&&(me+="".concat(y).concat(tt.additional)))),me+this.eol}printPtime(V){return V===void 0?"":"a=ptime:".concat(V).concat(this.eol)}printMaxPtime(V){return V===void 0?"":"a=maxptime:".concat(V).concat(this.eol)}printDirection(V){return V===void 0?"":"a=".concat(V).concat(this.eol)}printSSRC(V){return V.map(ce=>Object.keys(ce.attributes).map(me=>"a=ssrc:".concat(ce.ssrcId.toString(10)).concat(y).concat(me).concat(ce.attributes[me]?":".concat(ce.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(V){return V===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(V){return V===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(V){return V===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(V){if(V===void 0)return"";let ce="a=rtcp:".concat(V.port);return V.netType&&(ce+="".concat(y).concat(V.netType)),V.addressType&&(ce+="".concat(y).concat(V.addressType)),V.address&&(ce+="".concat(y).concat(V.address)),ce+this.eol}printMSId(V){return V.map(ce=>"a=msid:".concat(ce.id).concat(ce.appdata?"".concat(y).concat(ce.appdata):"").concat(this.eol)).join("")}printImageattr(V){return V.map(ce=>"a=imageattr:".concat(ce).concat(this.eol)).join("")}printRid(V){return V.map(ce=>{let me="a=rid:".concat(ce.id).concat(y).concat(ce.direction);return ce.payloads&&(me+="".concat(y,"pt=").concat(ce.payloads.join(","))),ce.params.length>0&&(me+="".concat(y).concat(ce.params.map(tt=>tt.type==="depend"?"depend=".concat(tt.rids.join(",")):"".concat(tt.type,"=").concat(tt.val)).join(";"))),me+this.eol}).join("")}printSimulcast(V){return V===void 0?"":"a=simulcast:".concat(V).concat(this.eol)}printSCTPPort(V){return V===void 0?"":"a=sctp-port:".concat(V).concat(this.eol)}printMaxMessageSize(V){return V===void 0?"":"a=max-message-size:".concat(V).concat(this.eol)}printMid(V){return V===void 0?"":"a=mid:".concat(V).concat(this.eol)}printSSRCGroups(V){return V.map(ce=>"a=ssrc-group:".concat(ce.semantic).concat(ce.ssrcIds.map(me=>"".concat(y).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function ot(Ke){return new ft().parse(Ke)}function At(Ke,V){return new fi().print(Ke,V)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function ec(t){return _8.parse(t)}function Zm(t,r){return _8.print(t,r)}var Ime=vc("Array").keys,Ame=Hc,Pme=ki,Ome=O,kme=Ime,GL=Array.prototype,Nme={DOMTokenList:!0,NodeList:!0},Dme=function(t){var r=t.keys;return t===GL||Ome(GL,t)&&r===GL.keys||Pme(Nme,Ame(t))?kme:r},ol=l(Dme);function y8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function un(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?y8(Object(s),!0).forEach(function(a){Qr(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):y8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Qr(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const E8=new class extends Gr{constructor(){super(...arguments),Qr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class xme{constructor(r){Qr(this,"logger",void 0),Qr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function HL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function v8(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Kl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},mP=Date.now(),BT=t=>{for(const r in Kl)if(Object.prototype.hasOwnProperty.call(Kl,r)&&Kl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Qr(this,"proxyServerURL",void 0),Qr(this,"logLevel",Kl.DEBUG),Qr(this,"uploadState","collecting"),Qr(this,"uploadLogWaitingList",[]),Qr(this,"uploadLogUploadingList",[]),Qr(this,"uploadErrorCount",0),Qr(this,"currentLogID",0),Qr(this,"url",void 0),Qr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Kl.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Kl.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Kl.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Kl.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Kl.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){or("UPLOAD_LOG",!0)}disableLogUpload(){or("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new xme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-mP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-mP);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=HL()+" Agora-SDK [".concat(BT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=HL()+" %cAgora-SDK [".concat(BT(a),"]:");let d=[];if(!ae("USE_NEW_LOG"))switch(a){case Kl.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Kl.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Kl.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Kl.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-mP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-mP);const a=Math.max(0,Math.min(4,r[0]));r[0]=HL()+" Agora-SDK [".concat(BT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!ae("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=v8()+" Agora-SDK [".concat(BT(t),"]:"):s[0]=v8()+" Agora-SDK [".concat(BT(t),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:$l,process_id:ae("PROCESS_ID"),payload:JSON.stringify(t)};return Fd(async()=>{const s=await Ta.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(ae("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(ae("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{const a={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),E8.reportLogUploadError(a),!0},{timeout:ae("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:ae("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,ae("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),ae("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),ae("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),ae("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var S8;function Lme(t){return Ss(t.reportId,"params.reportId",0,100,!1),Ss(t.category,"params.category",0,100,!1),Ss(t.event,"params.event",0,100,!1),Ss(t.label,"params.label",0,100,!1),ur(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(S8={}).FREE="free",S8.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Mme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let es=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Fr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Ume=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Ht(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let T=y;if(t.argsMap)try{T=t.argsMap(this,...y)}catch(P){x.warning(P),T=[]}try{JSON.stringify(T)}catch{x.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),T=[]}const R=(t.report||Ot).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:T,tag:Xr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,y);return P instanceof pt?P.then(D=>(R.onSuccess(t.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return a}}const Ot=new class{constructor(){Qr(this,"baseInfoMap",new Map),Qr(this,"proxyServer",void 0),Qr(this,"eventUploadTimer",void 0),Qr(this,"setSessionIdTimer",void 0),Qr(this,"url",void 0),Qr(this,"sids",new Set),Qr(this,"backupUrl",void 0),Qr(this,"_appId",void 0),Qr(this,"_aid",0),Qr(this,"keyEventUploadPendingItems",[]),Qr(this,"normalEventUploadPendingItems",[]),Qr(this,"apiInvokeUploadPendingItems",[]),Qr(this,"apiInvokeCount",0),Qr(this,"apiInvokeLoggedCount",0),Qr(this,"ltsList",[]),Qr(this,"lastSendNormalEventTime",Date.now()),Qr(this,"customReportCounterTimer",void 0),Qr(this,"customReportCount",0),Qr(this,"extApiInvoke",async t=>{for(const r of t){const s=un(un({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Xr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),ae("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),ae("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,a]=r;return s+a}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!ae("SHOW_REPORT_INVOKER_LOG"),h=!!ae("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(D,G){if(m){let F="[apiInvoke-".concat(y,"]");r.id&&(F+="[".concat(r.id,"]")),r.name&&(F+="[".concat(r.name,"]")),x.info("".concat(F," ").concat(D),D==="start"?r.options:G||"")}}const T=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});v("start");let R=!1;bs(r.timeout).then(()=>{R||(this.sendApiInvoke(un(un({},T()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const P=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:D=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(un(un({},T()),{},{success:!0},r.reportResult&&{result:D})),v("onSuccess"),D};return s?e8(G,r.name+"Success",s,()=>R=!0):G()},onError:D=>{const G=()=>{if(R)throw D;R=!0,this.sendApiInvoke(un(un({},T()),{},{success:!1,error:D})),v("onFailure",D.toString())};return s?e8(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:ae("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:FL?"global":"oversea",areas:ae("AREAS")&&ae("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:T}=r,R=Date.now(),P=un(un({},a),{},{eventType:es.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:WL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:ae("PROCESS_ID"),appType:ae("APP_TYPE"),success:!0,version:$l,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:at(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:T,serviceId:ae("PROCESS_ID"),extensionID:ae("PLUGIN_INFO").join(",")||""});var D;this.send({type:Fr.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{role:r.role,eventType:es.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Fr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:es.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Fr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:d,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(d&&h?h:s.startTime),T=un(un({},a),{},{eventType:es.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:jL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=T.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:Fr.JOIN_GATEWAY,data:T},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),F=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),F=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete T.success,delete T.eventType,delete T.firstSuccess,T.vid=Number(T.vid);const D=Object.assign({},T,P,{eventType:es.REJOIN_GATEWAY});this.send({type:Fr.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=un(un({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:Fr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:es.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Fr.PUBLISH,data:d},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),h=un(un({},c),{},{eventType:es.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Fr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...ol(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),m=un(un({},d),{},{eventType:es.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Fr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=un(un(un({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=un(un(un({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:es.AB_TEST,lts:c});this.send({type:Fr.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:es.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Fr.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:es.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Fr.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=un(un(un({},d),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:es.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Fr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:es.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Fr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{eventType:es.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Fr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Fr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(d,h,m){const y=d[h];if(!y||typeof y!="string")return[d];d[h]="";const v=Vh(JSON.stringify(d));let T=0;const R=[];let P=0;for(let D=0;D<y.length;D++)P+=y.charCodeAt(D)<=127?1:3,P<=m-v||(R[R.length]=bt(bt({},d),{},{[h]:y.substring(T,D)}),T=D,P=y.charCodeAt(D)<=127?1:3);return T!==y.length-1&&(R[R.length]=bt(bt({},d),{},{[h]:y.substring(T)})),R})(un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:Fr.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Fr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Fr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=un(un(un({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Fr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>ae("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),a=r.map(c=>({type:Fr.USER_ANALYTICS,data:un(un({sid:t},c),{},{lts:s})}));try{ae("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=ae("NOT_REPORT_EVENT");if(t.tag&&at(r)&&at(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Fr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>ae("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):a.push(d)}t.push(...a);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),vT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),ae("ENABLE_EVENT_REPORT")&&s.length&&(ae("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{ae("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>ae("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-ae("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){Si.networkState===Ac.OFFLINE&&await pt.race([Si.onlineWaiter,bs(2*Li.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(h=>{const m=IL(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let P=0;return Object.entries(Fr).forEach(D=>{let[G,F]=D;F===R.type&&(P=Ume[G])}),P})(h),T=new DataView(y);T.setUint16(0,m.byteLength,!0),T.setUint8(2,255&v),T.setUint8(3,v>>>8&255),T.setUint8(4,v>>>16&255),d=Hz(d,new Uint8Array(y)),d=Hz(d,m)}),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ae("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(ae("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ae("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(ae("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await xL(a,{timeout:1e4,data:r(t),headers:un(un({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:a};Si.networkState===Ac.OFFLINE&&await pt.race([Si.onlineWaiter,bs(2*Li.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ae("EVENT_REPORT_DOMAIN"),"&p=").concat(ae("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(ae("EVENT_REPORT_DOMAIN"),":").concat(ae("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ae("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(ae("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(ae("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(ae("STATS_COLLECTOR_PORT")).concat(d)));try{r?await bme(h,{timeout:1e4,data:c}):await xL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Mme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:Xr.TRACER}).onSuccess()}};E8.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Si.networkState,Ot.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Xr.TRACER}).onSuccess("logUploadError")});class Ae extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Qr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const Ts={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Bn(){return Ts}function b8(){return"setSinkId"in HTMLAudioElement.prototype&&(!ae("RESTRICTION_SET_PLAYBACK_DEVICE")||(hf()||Dz())&&!wL())}function T8(){return!Ts.supportUnifiedPlan||ae("CHROME_FORCE_PLAN_B")&&pf()}let ws=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function eS(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Mn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function Fu(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function $L(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Vme={"90p":Mn(160,90),"90p_1":Mn(160,90),"120p":Mn(160,120,15,30,65),"120p_1":Mn(160,120,15,30,65),"120p_3":Mn(120,120,15,30,50),"120p_4":Mn(212,120),"180p":Mn(320,180,15,30,140),"180p_1":Mn(320,180,15,30,140),"180p_3":Mn(180,180,15,30,100),"180p_4":Mn(240,180,15,30,120),"240p":Mn(320,240,15,40,200),"240p_1":Mn(320,240,15,40,200),"240p_3":Mn(240,240,15,40,140),"240p_4":Mn(424,240,15,40,220),"360p":Mn(640,360,15,80,400),"360p_1":Mn(640,360,15,80,400),"360p_3":Mn(360,360,15,80,260),"360p_4":Mn(640,360,30,80,600),"360p_6":Mn(360,360,30,80,400),"360p_7":Mn(480,360,15,80,320),"360p_8":Mn(480,360,30,80,490),"360p_9":Mn(640,360,15,80,800),"360p_10":Mn(640,360,24,80,800),"360p_11":Mn(640,360,24,80,1e3),"480p":Mn(640,480,15,100,500),"480p_1":Mn(640,480,15,100,500),"480p_2":Mn(640,480,30,100,1e3),"480p_3":Mn(480,480,15,100,400),"480p_4":Mn(640,480,30,100,750),"480p_6":Mn(480,480,30,100,600),"480p_8":Mn(848,480,15,100,610),"480p_9":Mn(848,480,30,100,930),"480p_10":Mn(640,480,10,100,400),"720p":Mn(1280,720,15,120,1130),"720p_auto":Mn(1280,720,30,900,3e3),"720p_1":Mn(1280,720,15,120,1130),"720p_2":Mn(1280,720,30,120,2e3),"720p_3":Mn(1280,720,30,120,1710),"720p_5":Mn(960,720,15,120,910),"720p_6":Mn(960,720,30,120,1380),"1080p":Mn(1920,1080,15,120,2080),"1080p_1":Mn(1920,1080,15,120,2080),"1080p_2":Mn(1920,1080,30,120,3e3),"1080p_3":Mn(1920,1080,30,120,3150),"1080p_5":Mn(1920,1080,60,120,4780),"1440p":Mn(2560,1440,30,120,4850),"1440p_1":Mn(2560,1440,30,120,4850),"1440p_2":Mn(2560,1440,60,120,7350),"4k":Mn(3840,2160,30,120,8910),"4k_1":Mn(3840,2160,30,120,8910),"4k_3":Mn(3840,2160,60,120,13500)},jme={"480p":Fu(640,480,5),"480p_1":Fu(640,480,5),"480p_2":Fu(640,480,30),"480p_3":Fu(640,480,15),"720p":Fu(1280,720,5),"720p_auto":Mn(1280,720,30,900,3e3),"720p_1":Fu(1280,720,5),"720p_2":Fu(1280,720,30),"720p_3":Fu(1280,720,15),"1080p":Fu(1920,1080,5),"1080p_1":Fu(1920,1080,5),"1080p_2":Fu(1920,1080,30),"1080p_3":Fu(1920,1080,15)},Fme={"1SL1TL":$L(1,1),"3SL3TL":$L(3,3),"2SL3TL":$L(2,3)};function Fh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Vme[t]):t}function KL(t){return typeof t=="string"?Object.assign({},jme[t]):t}function gP(t){return typeof t=="string"?Object.assign({},Fme[t]):t}const Bme={speech_low_quality:eS(16e3,!1),speech_standard:eS(32e3,!1,18),music_standard:eS(48e3,!1),standard_stereo:eS(48e3,!0,56),high_quality:eS(48e3,!1,128),high_quality_stereo:eS(48e3,!0,192)};function _P(t){return typeof t=="string"?Object.assign({},Bme[t]):t}const tS=[];function w8(t){return Ki(t,"mediaSource",["screen","window","application"]),!0}let Rt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Er=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),nS=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Wme=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),zme=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),ey=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),rS=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),iS=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),sS=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),al=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const qL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},C8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Gme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},R8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Jo=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),cl=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),WT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),ty=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),To=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Bh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const XL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let yP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function I8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Br(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?I8(Object(s),!0).forEach(function(a){Ie(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):I8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ie(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Un(t,r,s,a,c){var d,h,m={};return Object.keys(a).forEach(function(y){m[y]=a[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Sc(d=wm(h=s.slice()).call(h)).call(d,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class A8 extends Gr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(ey.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Ie(this,"trackMediaType",void 0),Ie(this,"_ID",void 0),Ie(this,"_rtpTransceiver",void 0),Ie(this,"_lowRtpTransceiver",void 0),Ie(this,"_hints",[]),Ie(this,"_isClosed",!1),Ie(this,"_originMediaStreamTrack",void 0),Ie(this,"mediaStreamTrack",void 0),Ie(this,"_external",{}),this._ID=s||yr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(a){at(tS).call(tS,a)||tS.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Jm(()=>{var s;Ot.reportApiInvoke(null,{name:xi.GET_MEDIA_STREAM_TRACK,options:[],tag:Xr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===nS.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=tS.indexOf(r);s!==-1&&tS.splice(s,1)}(this),this.emit(rS.CLOSED),this.removeAllListeners(ey.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===nS.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ey.TRANSCEIVER_UPDATED,r,s)}}class oS extends A8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Ie(this,"_enabled",!0),Ie(this,"_muted",!1),Ie(this,"_isExternalTrack",!1),Ie(this,"_isClosed",!1),Ie(this,"_enabledMutex",void 0),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ys("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Rt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _r(this,Rt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(rS.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),ff(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():pt.resolve([])}}const P8=window.AudioContext||window.webkitAudioContext;let ll=null;const ar=new class extends Gr{constructor(){super(...arguments),Ie(this,"prevState",void 0),Ie(this,"curState",void 0),Ie(this,"currentTime",void 0),Ie(this,"currentTimeStuckAt",void 0),Ie(this,"interruptDetectorTrack",void 0),Ie(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(ws.IOS_15_16_INTERRUPTION_START)}),Ie(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(ll&&await ll.suspend(),this.emit(ws.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function aS(){if(!ll){if(function(){if(!P8)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Br({},ae("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),ll=new P8(t),ar.curState=ll.state,ll.onstatechange=()=>{ar.prevState=ar.curState,ar.curState=ll?ll.state:void 0;const{prevState:r,curState:s}=ar,a=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",y=Ln().osVersion;(Xo()||Vu())&&d&&c&&(x.info("ios".concat(y,"-interruption-start")),ar.emit(ws.IOS_INTERRUPTION_START)),(Xo()||Vu())&&(h||m)&&a&&(x.info("ios".concat(y,"-interruption-end")),ar.emit(ws.IOS_INTERRUPTION_END)),r!==s&&ar.emit(ws.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=ll)===null||r===void 0?void 0:r.currentTime;ar.currentTime!==s?(ar.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),ar.currentTimeStuckAt=void 0),ar.currentTime=s):(s!==ar.currentTimeStuckAt&&(Ot.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Xr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),ar.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,d=!1,h=!1;function m(F){r.state==="running"?y(!1):Xo()||Vu()?r.state==="suspended"&&(y(!0),F&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),F&&r.resume().then(v,v))}function y(F){if(c!==F){c=F;for(let W=0,Q=s;W<Q.length;W+=1){const ee=Q[W];F?window.addEventListener(ee,T,{capture:!0,passive:!0}):window.removeEventListener(ee,T,{capture:!0,passive:!0})}}}function v(){m(!1)}function T(){m(!0)}function R(F){if(!h)if(a.paused)if(F){let W;P(!1),h=!0;try{W=a.play(),W?W.then(D,D):(a.addEventListener("playing",D),a.addEventListener("abort",D),a.addEventListener("error",D))}catch{D()}}else P(!0);else P(!1)}function P(F){if(d!==F){d=F;for(let W=0,Q=s;W<Q.length;W++){const ee=Q[W];F?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function D(){a.removeEventListener("playing",D),a.removeEventListener("abort",D),a.removeEventListener("error",D),h=!1,R(!1)}function G(){R(!0)}if(Xo()){const F=r.createMediaStreamDestination(),W=document.createElement("div");W.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=W.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=F.stream,R(!0)}ar.on(ws.STATE_CHANGE,function(){m(!0)}),m(!1)}(ll)}(),!ll)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return ll}return ll}function ny(t){if(function(){if(JL!==null)return JL;const a=aS(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),JL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),at(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,d)):r.call(t,a,c)),t},t.disconnect=(a,c,d)=>{s.call(t),a?aP(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let JL=null;function QL(t,r){let s=!1;const a=1/r;if(ae("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*a)}else{const c=aS();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class O8{constructor(){Ie(this,"context",void 0),Ie(this,"analyserNode",void 0),Ie(this,"sourceNode",void 0),this.context=aS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Xo()||Vu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=Sc(r).call(r,(a,c)=>a+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class k8 extends Gr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ie(this,"outputNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"isPlayed",!1),Ie(this,"sourceNode",void 0),Ie(this,"context",void 0),Ie(this,"audioBufferNode",void 0),Ie(this,"destNode",void 0),Ie(this,"audioOutputLevel",0),Ie(this,"volumeLevelAnalyser",void 0),Ie(this,"_processedNode",void 0),Ie(this,"playNode",void 0),Ie(this,"isDestroyed",!1),Ie(this,"onNoAudioInput",void 0),Ie(this,"isNoAudioInput",!1),Ie(this,"_noAudioInputCount",0),this.context=aS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ny(this.outputNode),this.volumeLevelAnalyser=new O8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(al.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Bn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&cP(()=>{ar.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Xo()||Vu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await bs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class N8 extends k8{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Ie(this,"sourceNode",void 0),Ie(this,"track",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"audioElement",void 0),Ie(this,"isCurrentTrackCloned",!1),Ie(this,"isRemoteTrack",!1),Ie(this,"originVolumeLevelAnalyser",void 0),Ie(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),ny(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),ny(this.outputNode),this.emit(al.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),ny(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));ny(y),this.originVolumeLevelAnalyser=new O8,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=Ln();s&&h.os===Zi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(ar.on(ws.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),ny(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(al.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),ar.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));ny(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function D8(t,r,s){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Hme(t,r){const s=await x8(t.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new pt((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const T=document.createElement("div");T.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Q);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",y(ee)};let F=h;const W=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const fe=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),fe.innerText="Share audio",ee.checked=F,ee.onchange=()=>{F=ee.checked},W.appendChild(ee),W.appendChild(fe)}D.appendChild(W),D.appendChild(G),T.appendChild(R),T.appendChild(P),T.appendChild(D);const Q=document.createElement("div");Q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Q.appendChild(v),Q.appendChild(T),document.body.appendChild(Q),d.map(ee=>{if(ee.id){const fe=document.createElement("div");fe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=ee.thumbnail;try{const{width:ve}=ye.getSize();ve>1920&&(ye=ye.resize({width:1920}))}catch(ve){throw ve&&ve.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ve}fe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(ve){return"&#"+ve.charCodeAt(0)+";"})+"</span>",fe.onclick=()=>{document.body.removeChild(Q),m({sourceId:ee.id,audio:F})},P.appendChild(fe)}})})}(s,r);return await D8(a,t,c)}async function x8(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=$z();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new pt((d,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):d(y)})}));try{return await a}catch(d){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const ZL=new Ys("safari");let L8=!1,M8=!1;async function ul(t,r){let s=0,a=null;for(;s<2;)try{a=await $me(t,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const d=EP(c.name||c.code||c,c.message);if(d.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await bs(500);continue}throw x.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function $me(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=Bn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if($z())t.screen.sourceId?cS(c,await D8(t.screen.sourceId,t.screen,!!t.screenAudio)):cS(c,await Hme(t.screen,!!t.screenAudio));else if(hf()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new pt((D,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},F=>{if(!F||!F.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),F),void G(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(F.streamId)})}catch(F){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),F.toString()),G(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,cS(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&w8(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:G,systemAudio:F,preferCurrentTab:W}=t.screen,Q={selfBrowserSurface:D,surfaceSwitching:G,systemAudio:F,preferCurrentTab:W};!D&&delete Q.selfBrowserSurface,!G&&delete Q.surfaceSwitching,!F&&delete Q.systemAudio,!W&&delete Q.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:Q})),cS(c,await navigator.mediaDevices.getDisplayMedia(Br({video:P,audio:t.screenAudio},Q)))}else{if(!qr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&w8(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),cS(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=ae("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=OL(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),Ln();let T,R=null;(Vs()||Xo()||sP())&&(R=await ZL.lock());try{T=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(L8=!0),y.video&&(M8=!0),cS(c,T),R&&R(),c}function EP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function cS(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const dl=new class extends Gr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(ty.STATE_CHANGE,t),this._state=t)}constructor(){super(),Ie(this,"_state",WT.IDLE),Ie(this,"isAccessMicrophonePermission",!1),Ie(this,"isAccessCameraPermission",!1),Ie(this,"lastAccessMicrophonePermission",!1),Ie(this,"lastAccessCameraPermission",!1),Ie(this,"checkdeviceMatched",!1),Ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(ae("ENUMERATE_DEVICES_INTERVAL")||(oP()||iP()===Zi.HARMONY_OS)&&pf())&&this.updateDevicesInfo()},ae("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(d||h)){if(ZL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await ZL.lock())(),x.debug("[device manager] GUM unlock")),L8&&(d=!1,this.isAccessMicrophonePermission=!0),M8&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(T){const R=EP(T.name||T.code||T,T.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(T){const R=EP(T.name||T.code||T,T.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(T){const R=EP(T.name||T.code||T,T.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const T=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,T}catch(T){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new Le(te.ENUMERATE_DEVICES_FAILED,T.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=WT.INITING;try{await this.updateDevicesInfo(),this.state=WT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=WT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):x.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==WT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ty.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ty.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ty.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let eM=!1;const hl=new class extends Gr{constructor(){super(...arguments),Ie(this,"onAutoplayFailed",void 0),Ie(this,"onAudioAutoplayFailed",void 0)}};function U8(){if(Ln(),!eM){const t=r=>{r.preventDefault(),eM=!1,DT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};eM=!0,DT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),hl.onAutoplayFailed?hl.onAutoplayFailed():hl.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),hl.emit("autoplay-failed")}}function V8(t,r,s,a){if(!t)return;const c=Ot.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Br(Br({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:hl.onAutoplayFailed||hl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});Ot.send({type:Fr.AUTOPLAY_FAILED,data:m},!0)}const Kme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],wa=new class{constructor(){Ie(this,"onAutoplayFailed",void 0),Ie(this,"elementMap",new Map),Ie(this,"elementStateMap",new Map),Ie(this,"elementsNeedToResume",[]),Ie(this,"sinkIdMap",new Map),Ie(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,a]=r;const c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(ar.curState==="running")return qv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),ar.on(ws.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ar.on(ws.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ar.on(ws.STATE_CHANGE,()=>{Xo()&&ar.prevState==="suspended"&&ar.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,To.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{a&&V8(a,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),cP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),U8()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Kme.forEach(s=>{r.addEventListener(s,a=>{const c=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new pt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{DT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function hi(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof pt?new pt((y,v)=>{m.then(y).catch(v)}):m}),s}}class j8 extends Gr{constructor(r){super(),Ie(this,"name","VideoProcessorDestination"),Ie(this,"ID","0"),Ie(this,"_source",void 0),Ie(this,"videoContext",void 0),Ie(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Jo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Jo.ON_TRACK,void 0)}}class F8 extends Gr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"usageRegistry",[]),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Fs(this,cl.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),_r(this,cl.REQUEST_UPDATE_CONSTRAINTS,Array.from(nl(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),_r(this,cl.REQUEST_UPDATE_CONSTRAINTS,Array.from(nl(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof pt&&(a=await a),r.push(Br(Br({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class B8 extends Gr{constructor(r){super(),Ie(this,"name","AudioProcessorDestination"),Ie(this,"ID","0"),Ie(this,"inputTrack",void 0),Ie(this,"inputNode",void 0),Ie(this,"audioProcessorContext",void 0),Ie(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Jo.ON_TRACK,void 0),this.emit(Jo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Jo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Jo.ON_NODE,this.inputNode))}}class W8 extends Gr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"audioContext",void 0),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"usageRegistry",[]),Ie(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return Fs(this,cl.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),_r(this,cl.REQUEST_UPDATE_CONSTRAINTS,Array.from(nl(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),_r(this,cl.REQUEST_UPDATE_CONSTRAINTS,Array.from(nl(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof pt&&(a=await a),r.push(Br(Br({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class tM extends Gr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ie(this,"context",void 0),Ie(this,"processSourceNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"processedNode",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"outputNode",void 0),this.outputNode=new qme}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class qme{disconnect(){}connect(){}}function z8(t){return new pt((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=Xo()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&qr()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(lP),setTimeout(()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function vP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Fh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!Bz()&&s.frameRate&&(r.frameRate=s.frameRate),Dz()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),qr()&&(r.frameRate={ideal:30,max:30}),r}function G8(t){const r={};return Bz()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,hf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function H8(t){const r=G8(t);if(t.encoderConfig){const s=_P(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),oP()&&(r.sampleRate=void 0),r}const Yme=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=a,height:m=c}=r;if(!d||!h||!m)return;h=kL(h),m=kL(m),d=kL(d);const{max:y,min:v}=function(D,G,F){const W=200*Math.pow(F/15,.6)*Math.pow(D*G/640/360,.75);return{min:Math.floor(W),max:Math.floor(4*W)}}(h,m,d),{bitrateMax:T,bitrateMin:R}=r||{};T||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(T,", brMin: ").concat(R,"]"));const{maxFramerate:P}=ae("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(d=Math.min(d,P)),{frameRate:d,bitrateMax:T||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},$8=async(t,r,s)=>await(async(a,c,d)=>{const h=function(v){const T=[];for(let R=0;R<v.length;R+=2)T.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(T)}(r8(""+c+d)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,a))})(t.buffer,r,s),nM=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new pt((s,a)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await K8(c);s({buffer:d,width:r.width,height:r.height})}else a(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},K8=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var q8,Y8,X8,J8,Q8,Z8,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,Hr,hG,pG,fG,mG,gG,_G,Wh,yG,EG,vG,SG,bG,TG,wG,CG,RG,IG,AG,PG,OG,Ws;let ei=(q8=Ht({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),Y8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),X8=hi(),J8=Jv("LocalAudioTrack","_enabledMutex"),Q8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),Z8=hi(),eG=Jv("LocalAudioTrack","_enabledMutex"),tG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),nG=hi(),rG=hi(),iG=hi(),sG=Ht({argsMap:t=>[t.getTrackId()]}),oG=hi(),aG=Ht({argsMap:t=>[t.getTrackId()]}),cG=hi(),lG=Ht({argsMap:t=>[t.getTrackId()]}),uG=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),dG=Ht({argsMap:t=>[t.getTrackId()]}),Un((Hr=class extends oS{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?wa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Ie(this,"trackMediaType",sS.AUDIO),Ie(this,"_encoderConfig",void 0),Ie(this,"_trackSource",void 0),Ie(this,"metadata",[]),Ie(this,"_enabled",!0),Ie(this,"_volume",100),Ie(this,"_useAudioElement",!0),Ie(this,"_bypassWebAudio",!1),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_processorDestination",void 0),Ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new tM,ae("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),ae("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Vs()&&!ll?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ur(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&wa.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,_r(this,Rt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!b8())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wa.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await _r(this,Rt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await _r(this,Rt.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await _r(this,Rt.NEED_MUTE_TRACK,this):await _r(this,Rt.NEED_UNMUTE_TRACK,this))}getStats(){return Jm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),il(this,Rt.GET_STATS)||Br({},qL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(al.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(al.ON_AUDIO_BUFFER),this._source.on(al.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),wa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?wa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _r(this,Rt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return pt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Jo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await _r(this,Rt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _r(this,Rt.NEED_REPLACE_TRACK,this))}),t.on(Jo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Jo.ON_TRACK),t.removeAllListeners(Jo.ON_NODE)}bindProcessorContextEvents(t){t.on(cl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(cl.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof tM&&(this._trackSource=new N8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new W8(this._source.context,this.getTrackId(),"local"),r=new B8(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(al.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(wa.stop(this.getTrackId()),this._source.play()),_r(this,Rt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[q8],Object.getOwnPropertyDescriptor(Hr.prototype,"setVolume"),Hr.prototype),Un(Hr.prototype,"setPlaybackDevice",[Y8,X8],Object.getOwnPropertyDescriptor(Hr.prototype,"setPlaybackDevice"),Hr.prototype),Un(Hr.prototype,"setEnabled",[J8,Q8,Z8],Object.getOwnPropertyDescriptor(Hr.prototype,"setEnabled"),Hr.prototype),Un(Hr.prototype,"setMuted",[eG,tG,nG],Object.getOwnPropertyDescriptor(Hr.prototype,"setMuted"),Hr.prototype),Un(Hr.prototype,"getStats",[rG],Object.getOwnPropertyDescriptor(Hr.prototype,"getStats"),Hr.prototype),Un(Hr.prototype,"setAudioFrameCallback",[iG],Object.getOwnPropertyDescriptor(Hr.prototype,"setAudioFrameCallback"),Hr.prototype),Un(Hr.prototype,"play",[sG,oG],Object.getOwnPropertyDescriptor(Hr.prototype,"play"),Hr.prototype),Un(Hr.prototype,"stop",[aG,cG],Object.getOwnPropertyDescriptor(Hr.prototype,"stop"),Hr.prototype),Un(Hr.prototype,"close",[lG],Object.getOwnPropertyDescriptor(Hr.prototype,"close"),Hr.prototype),Un(Hr.prototype,"pipe",[uG],Object.getOwnPropertyDescriptor(Hr.prototype,"pipe"),Hr.prototype),Un(Hr.prototype,"unpipe",[dG],Object.getOwnPropertyDescriptor(Hr.prototype,"unpipe"),Hr.prototype),Hr),SP=(hG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),pG=hi(),fG=Jv("MicrophoneAudioTrack","_enabledMutex"),mG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),gG=hi(),_G=Ht({argsMap:t=>[t.getTrackId()]}),Un((Wh=class extends ei{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?_P(r.encoderConfig):{},a,ae("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ie(this,"_config",void 0),Ie(this,"_deviceName","default"),Ie(this,"_constraints",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(qv()||TL())&&ar.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await dl.getDeviceById(t),s={};s.audio=Br({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await ul(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await ul({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await dl.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),ae("AUTO_RESET_AUDIO_ROUTE")&&(Xo()||Vu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await _r(this,Rt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Br({},this._constraints),d=dl.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await ul({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await _r(this,Rt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(qv()||TL())&&ar.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Xo()||Vu())&&this._enabled&&!this._isClosed&&ar.duringInterruption){const t=async()=>{ar.off(ws.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ar.on(ws.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(rS.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=dl.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await ul({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(cl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(cl.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[hG,pG],Object.getOwnPropertyDescriptor(Wh.prototype,"setDevice"),Wh.prototype),Un(Wh.prototype,"setEnabled",[fG,mG,gG],Object.getOwnPropertyDescriptor(Wh.prototype,"setEnabled"),Wh.prototype),Un(Wh.prototype,"close",[_G],Object.getOwnPropertyDescriptor(Wh.prototype,"close"),Wh.prototype),Wh),Xme=(yG=Ht({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),EG=hi(),vG=Ht({argsMap:t=>[t.getTrackId()]}),SG=hi(),bG=Ht({argsMap:t=>[t.getTrackId()]}),TG=hi(),wG=Ht({argsMap:t=>[t.getTrackId()]}),CG=hi(),RG=Ht({argsMap:t=>[t.getTrackId()]}),IG=hi(),AG=Ht({argsMap:t=>[t.getTrackId()]}),PG=Ht({argsMap:t=>[t.getTrackId()]}),OG=hi(),Un((Ws=class extends ei{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Ie(this,"source",void 0),Ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(al.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(rS.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ur(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[yG,EG],Object.getOwnPropertyDescriptor(Ws.prototype,"startProcessAudioBuffer"),Ws.prototype),Un(Ws.prototype,"pauseProcessAudioBuffer",[vG,SG],Object.getOwnPropertyDescriptor(Ws.prototype,"pauseProcessAudioBuffer"),Ws.prototype),Un(Ws.prototype,"seekAudioBuffer",[bG,TG],Object.getOwnPropertyDescriptor(Ws.prototype,"seekAudioBuffer"),Ws.prototype),Un(Ws.prototype,"resumeProcessAudioBuffer",[wG,CG],Object.getOwnPropertyDescriptor(Ws.prototype,"resumeProcessAudioBuffer"),Ws.prototype),Un(Ws.prototype,"stopProcessAudioBuffer",[RG,IG],Object.getOwnPropertyDescriptor(Ws.prototype,"stopProcessAudioBuffer"),Ws.prototype),Un(Ws.prototype,"close",[AG],Object.getOwnPropertyDescriptor(Ws.prototype,"close"),Ws.prototype),Un(Ws.prototype,"setAudioBufferPlaybackSpeed",[PG,OG],Object.getOwnPropertyDescriptor(Ws.prototype,"setAudioBufferPlaybackSpeed"),Ws.prototype),Ws);class zi extends ei{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=aS().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,yr(8,"track-mix-")),Ie(this,"trackList",void 0),Ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}aP(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof zi?s.emit(ey.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Jme extends k8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(al.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ie(this,"audioBuffer",void 0),Ie(this,"sourceNode",void 0),Ie(this,"startPlayTime",0),Ie(this,"startPlayOffset",0),Ie(this,"pausePlayTime",0),Ie(this,"options",void 0),Ie(this,"currentLoopCount",0),Ie(this,"currentPlaybackSpeed",100),Ie(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const kG=new Map;class rM{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Ie(this,"trackId",void 0),Ie(this,"config",void 0),Ie(this,"onFirstVideoFrameDecoded",void 0),Ie(this,"onVideoStateChanged",void 0),Ie(this,"freezeTimeCounterList",[]),Ie(this,"renderFreezeAccTime",0),Ie(this,"isKeepLastFrame",!1),Ie(this,"timeUpdatedCount",0),Ie(this,"freezeTime",0),Ie(this,"playbackTime",0),Ie(this,"lastTimeUpdatedTime",0),Ie(this,"autoplayFailed",!1),Ie(this,"videoTrack",void 0),Ie(this,"videoElement",void 0),Ie(this,"cacheVideoElement",void 0),Ie(this,"renderStats",void 0),Ie(this,"_videoState",Bh.VideoStateStopped),Ie(this,"videoElementCheckInterval",void 0),Ie(this,"videoElementFreezeTimeout",void 0),Ie(this,"_videoElementStatus",To.NONE),Ie(this,"isGettingVideoDimensions",!1),Ie(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ar.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Nz())),jz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ie(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=To.PLAYING;break;case"loadeddata":if(this.videoState=Bh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=To.CANPLAY;break;case"stalled":this.videoElementStatus=To.STALLED;break;case"suspend":this.videoElementStatus=To.SUSPEND;break;case"pause":this.videoElementStatus=To.PAUSED,Xo()||Vu()||Vs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=To.WAITING;break;case"abort":this.videoElementStatus=To.ABORT;break;case"ended":this.videoElementStatus=To.ENDED;break;case"emptied":this.videoElementStatus=To.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=To.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,gf.lastVisibleTime<gf.lastHiddenTime||d<gf.lastHiddenTime||d<gf.lastVisibleTime)return;for(c>ae("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Nz())),jz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),ar.on(ws.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ar.on(ws.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&V8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const a=Ln();if((a.name==="Safari"&&Number(a.version)===15||qv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new pt((d,h)=>{a.toBlob(async m=>{if(a.remove(),m){const y=await K8(m);d({buffer:y,width:a.width,height:a.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await nM(r)}destroy(){this.renderStats=void 0,ar.off(ws.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ar.off(ws.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Bh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=To.INIT,!this.videoElementCheckInterval&&(NG.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)||(this.videoElementStatus=To.DESTROYED)},1e3),ae("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,ae("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Bh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Bh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,T)=>{if(this.videoElementStatus===To.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=T.mediaTime):this.renderStats={lastTs:T.mediaTime,curTs:T.mediaTime,lastRenderNum:0,renderNum:0},d){const D=T.presentationTime-d.presentationTime;this.videoState===Bh.VideoStateStarting&&(this.videoState=Bh.VideoStateDecoding),this.videoState===Bh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,ae("VIDEO_FREEZE_DURATION"))),D<ae("VIDEO_FREEZE_DURATION")&&this.videoState===Bh.VideoStateFrozen&&(this.videoState=Bh.VideoStateDecoding),D>ae("VIDEO_FREEZE_DURATION")&&gf.lastVisibleTime>=gf.lastHiddenTime&&d.timestamp>gf.lastVisibleTime&&d.timestamp>gf.lastHiddenTime&&(this.renderFreezeAccTime+=D)}d=Br(Br({},T),{},{timestamp:v})}var R,P;ae("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),oP()&&!ae("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Ln();a.name==="Safari"&&Number(a.version)===15||qv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,qr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{x.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){NG.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=To.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{x.error(a)}),this.autoplayFailed=!1,DT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};DT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),U8()}}const NG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class DG extends rM{constructor(r){super(r),Ie(this,"container",void 0),Ie(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await nM(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",ae("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var xG,LG,MG,UG,VG,jG,FG,BG,WG,zG,GG,HG,$G,KG,qG,YG,XG,JG,QG,ZG,eH,tH,nH,rH,On,iH,sH,oH,aH,cH,lH,uH,dH,pl;let Pr=(xG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),LG=hi(),MG=Ht({argsMap:t=>[t.getTrackId()]}),UG=Jv("LocalVideoTrack","_enabledMutex"),VG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),jG=hi(),FG=Jv("LocalVideoTrack","_enabledMutex"),BG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),WG=hi(),zG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),GG=hi(),HG=hi(),$G=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),KG=hi(),qG=hi(),YG=hi(),XG=hi(),JG=hi(),QG=hi(),ZG=hi(),eH=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),tH=Ht({argsMap:t=>[t.getTrackId()]}),nH=Ht({argsMap:t=>[t.getTrackId()]}),rH=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),On=class kae extends oS{get videoHeight(){if(Vs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Vs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==To.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,d,h){if(super(r,d),Ie(this,"trackMediaType",sS.VIDEO),Ie(this,"_player",void 0),Ie(this,"isUseScaleResolutionDownBy",!1),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"_encoderConfig",void 0),Ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ie(this,"_optimizationMode",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_videoWidth",void 0),Ie(this,"_forceBitrateLimit",void 0),Ie(this,"_enabled",!0),Ie(this,"_processorDestination",void 0),Ie(this,"_processorContext",void 0),Vs()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(Er.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(vL(Kn.CHROME,115)&&iP().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&Bn().supportWebRTCInsertableStream){const T=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,D,G=Date.now();const F=()=>{W&&(clearInterval(W),W=void 0),P&&(P.close(),P=void 0),y.stop(),D=void 0,R.removeEventListener("ended",F)};let W=window.setInterval(()=>{if(D&&P&&Date.now()-G>1e3)try{R.readyState==="live"?D.enqueue(P.clone()):F()}catch{F()}},1e3);const Q=new TransformStream({transform:(ee,fe)=>{R.readyState==="live"?(D=fe,G=Date.now(),P===void 0?(P=ee,fe.enqueue(ee.clone())):(fe.enqueue(P),P=ee)):ee.close()}});return R.addEventListener("ended",F),T.readable.pipeThrough(Q).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(Er.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new F8(this.getTrackId(),"local"),this._processorDestination=new j8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Br(Br(Br({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new rM(a):this._player=new DG(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(rS.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},ae("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await _r(this,Rt.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await _r(this,Rt.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await _r(this,Rt.NEED_MUTE_TRACK,this):await _r(this,Rt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Fh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=vP({encoderConfig:r});(Vs()||Xo()||Vu())&&(a.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(Er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _r(this,Rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(x)}}getStats(){return Jm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),il(this,Rt.GET_STATS)||Br({},YL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await nM(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await _r(this,Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){z8(this._originMediaStreamTrack).then(r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s}).catch(lP)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Fh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _r(this,Rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=function(y,v,T,R,P){const D=ae("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const W=Math.floor(200*Math.pow(T/15,.6)*Math.pow(y*v/640/360,.75));P=D==="STANDARD_BITRATE"?4*W:2*W,R=(G=R)!==null&&G!==void 0?G:W}else{var F;R=(F=R)!==null&&F!==void 0?F:Math.floor(P/10)}return{min:R,max:P}}(r,s,a,d,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=Gz.checkOneElementVisible(d),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=Ot.reportApiInvoke(null,{tag:Xr.TRACER,name:xi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(a){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Br(Br({},a),Fh(r))),a=X_(a);const c=yr(8,"track-video-cloned-"),d=new kae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,X_(this._scalabilityMode),this._optimizationMode,c,X_(this._hints));return r&&a&&d.setEncoderConfiguration(a),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Jm(()=>{Ot.reportApiInvoke(null,{name:xi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Xr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!ae("ENABLE_VIDEO_SEI")||!ae("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Jo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await _r(this,Rt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await _r(this,Rt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Jo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(cl.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(cl.REQUEST_CONSTRAINTS)}},Un(On.prototype,"play",[xG,LG],Object.getOwnPropertyDescriptor(On.prototype,"play"),On.prototype),Un(On.prototype,"stop",[MG],Object.getOwnPropertyDescriptor(On.prototype,"stop"),On.prototype),Un(On.prototype,"setEnabled",[UG,VG,jG],Object.getOwnPropertyDescriptor(On.prototype,"setEnabled"),On.prototype),Un(On.prototype,"setMuted",[FG,BG,WG],Object.getOwnPropertyDescriptor(On.prototype,"setMuted"),On.prototype),Un(On.prototype,"setEncoderConfiguration",[zG,GG],Object.getOwnPropertyDescriptor(On.prototype,"setEncoderConfiguration"),On.prototype),Un(On.prototype,"getStats",[HG],Object.getOwnPropertyDescriptor(On.prototype,"getStats"),On.prototype),Un(On.prototype,"setBeautyEffect",[$G,KG],Object.getOwnPropertyDescriptor(On.prototype,"setBeautyEffect"),On.prototype),Un(On.prototype,"getCurrentFrameData",[qG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameData"),On.prototype),Un(On.prototype,"getCurrentFrameImage",[YG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameImage"),On.prototype),Un(On.prototype,"setBitrateLimit",[XG],Object.getOwnPropertyDescriptor(On.prototype,"setBitrateLimit"),On.prototype),Un(On.prototype,"setOptimizationMode",[JG],Object.getOwnPropertyDescriptor(On.prototype,"setOptimizationMode"),On.prototype),Un(On.prototype,"setScalabiltyMode",[QG],Object.getOwnPropertyDescriptor(On.prototype,"setScalabiltyMode"),On.prototype),Un(On.prototype,"updateMediaStreamTrackResolution",[ZG],Object.getOwnPropertyDescriptor(On.prototype,"updateMediaStreamTrackResolution"),On.prototype),Un(On.prototype,"pipe",[eH],Object.getOwnPropertyDescriptor(On.prototype,"pipe"),On.prototype),Un(On.prototype,"unpipe",[tH],Object.getOwnPropertyDescriptor(On.prototype,"unpipe"),On.prototype),Un(On.prototype,"close",[nH],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),Un(On.prototype,"replaceTrack",[rH],Object.getOwnPropertyDescriptor(On.prototype,"replaceTrack"),On.prototype),On),iM=(iH=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),sH=hi(),oH=Jv("CameraVideoTrack","_enabledMutex"),aH=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),cH=hi(),lH=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),uH=hi(),dH=Ht({argsMap:t=>[t.getTrackId()]}),pl=class Nae extends Pr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,d,h){super(r,Fh(s.encoderConfig),c,d,h),Ie(this,"_config",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_constraints",void 0),Ie(this,"_enabled",!0),Ie(this,"_deviceName","default"),Ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(qv()||TL())&&!function(){const m=Ln();if(m.os!==Zi.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&Fz()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Fh(this._config.encoderConfig),ar.on(ws.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ar.on(ws.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await dl.getDeviceById(r),a={};a.video=Br({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ul(a,this.getTrackId())}catch(d){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await ul({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await dl.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Br(Br({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await ul(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await ul({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Br({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await ul({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await _r(this,Rt.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await _r(this,Rt.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Fh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=Jr(this._config);a.encoderConfig=r;const c=vP(a);(Vs()||Xo()||Vu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(te.UNEXPECTED_ERROR,d.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Er.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await _r(this,Rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Xo()||Vu())&&this._enabled&&!this._isClosed&&ar.duringInterruption){const r=async()=>{ar.off(ws.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ar.on(ws.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(rS.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=dl.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await ul({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ar.off(ws.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ar.off(ws.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Br(Br({},a),Fh(r))),a=X_(a);const c=yr(8,"track-cam-cloned-"),d=new Nae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,X_(Br(Br({},this._config),{},{encoderConfig:a})),X_(this._constraints),X_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&d.setEncoderConfiguration(a),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(cl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(cl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Un(pl.prototype,"setDevice",[iH,sH],Object.getOwnPropertyDescriptor(pl.prototype,"setDevice"),pl.prototype),Un(pl.prototype,"setEnabled",[oH,aH,cH],Object.getOwnPropertyDescriptor(pl.prototype,"setEnabled"),pl.prototype),Un(pl.prototype,"setEncoderConfiguration",[lH,uH],Object.getOwnPropertyDescriptor(pl.prototype,"setEncoderConfiguration"),pl.prototype),Un(pl.prototype,"close",[dH],Object.getOwnPropertyDescriptor(pl.prototype,"close"),pl.prototype),pl);function sM(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Br(Br({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var hH,pH,fH,mH,ql,gH,_H,yH,EH,vH,SH,wo;class bH extends A8{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(yr(5,""))),Ie(this,"_userId",void 0),Ie(this,"_uintId",void 0),Ie(this,"_isDestroyed",!1),Ie(this,"store",void 0),Ie(this,"processor",void 0),Ie(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let lS=(hH=Ht({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),pH=Ht({argsMap:t=>[t.getTrackId()]}),fH=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),mH=Ht({argsMap:t=>[t.getTrackId()]}),Un((ql=class extends bH{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==To.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a){super(t,r,s,a),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"trackMediaType",sS.VIDEO),Ie(this,"_videoWidth",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_player",void 0),Ie(this,"processorDestination",void 0),Ie(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new F8(this.getTrackId(),"remote"),this.processorDestination=new j8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Jm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),il(this,Rt.GET_STATS)||Br({},R8)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Br(Br({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new rM(s):this._player=new DG(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(iS.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(iS.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(iS.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},ae("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){z8(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(lP)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=Gz.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=Ot.reportApiInvoke(null,{tag:Xr.TRACER,name:xi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Jo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Jo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ey.SEI_RECEIVED,t)}}).prototype,"play",[hH],Object.getOwnPropertyDescriptor(ql.prototype,"play"),ql.prototype),Un(ql.prototype,"stop",[pH],Object.getOwnPropertyDescriptor(ql.prototype,"stop"),ql.prototype),Un(ql.prototype,"pipe",[fH],Object.getOwnPropertyDescriptor(ql.prototype,"pipe"),ql.prototype),Un(ql.prototype,"unpipe",[mH],Object.getOwnPropertyDescriptor(ql.prototype,"unpipe"),ql.prototype),ql),uS=(gH=Ht({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),_H=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),yH=Ht({argsMap:t=>[t.getTrackId()]}),EH=Ht({argsMap:t=>[t.getTrackId()]}),vH=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),SH=Ht({argsMap:t=>[t.getTrackId()]}),Un((wo=class extends bH{get isPlaying(){return this._useAudioElement?wa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Ie(this,"trackMediaType",sS.AUDIO),Ie(this,"_source",void 0),Ie(this,"_useAudioElement",!0),Ie(this,"_volume",100),Ie(this,"processorContext",void 0),Ie(this,"processorDestination",void 0),Ie(this,"_played",!1),Ie(this,"_bypassWebAudio",!1),ae("DISABLE_WEBAUDIO")?(this._source=new tM,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new N8(t,!0),ae("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(al.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(iS.FIRST_FRAME_DECODED)}),this.processorContext=new W8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new B8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(al.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(al.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(al.ON_AUDIO_BUFFER),this._source.on(al.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?wa.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!b8())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wa.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Jm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),il(this,Rt.GET_STATS)||Br({},C8)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),wa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?wa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Jo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Jo.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Jo.ON_TRACK),this.processorDestination.removeAllListeners(Jo.ON_NODE)}}).prototype,"setVolume",[gH],Object.getOwnPropertyDescriptor(wo.prototype,"setVolume"),wo.prototype),Un(wo.prototype,"setPlaybackDevice",[_H],Object.getOwnPropertyDescriptor(wo.prototype,"setPlaybackDevice"),wo.prototype),Un(wo.prototype,"play",[yH],Object.getOwnPropertyDescriptor(wo.prototype,"play"),wo.prototype),Un(wo.prototype,"stop",[EH],Object.getOwnPropertyDescriptor(wo.prototype,"stop"),wo.prototype),Un(wo.prototype,"pipe",[vH],Object.getOwnPropertyDescriptor(wo.prototype,"pipe"),wo.prototype),Un(wo.prototype,"unpipe",[SH],Object.getOwnPropertyDescriptor(wo.prototype,"unpipe"),wo.prototype),wo);const gf=new class extends Gr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ie(this,"_lastHiddenTime",0),Ie(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class TH extends Gr{constructor(r,s){super(),Ie(this,"trackMediaType",sS.DATA),Ie(this,"_version",1),Ie(this,"_type",3),Ie(this,"_config",void 0),Ie(this,"_originDataChannel",void 0),Ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ie(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Ie(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return ae("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new pt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout(()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[yP.OPEN,yP.CLOSE,yP.ERROR].forEach(s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;r.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class Qme extends TH{constructor(r){super(r),Ie(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(ae("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(yP.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Zme extends TH{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function bP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>bA.revokeObjectURL(t),0),new Worker(bA.createObjectURL(t))}const wH=71,oM=1,aM=2,cM=1,CH=2;var _f=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(_f||{});function RH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==wH)return;const a=t.getUint16(1),c=oM+aM+a,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:d};let m=oM+aM;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+cM),T=cM+CH;if(y===_f.AUDIO_LEVEL){let R=t.getUint8(m+T);for(let P=1;P<v;P++)R=R<<8|t.getUint8(m+T+P);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===_f.METADATA||y===_f.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let P=0;P<v;P++)R[P]=t.getUint8(m+T+P);h.tlv.push({tag:y,length:v,value:R})}m+=T+v}return h}const TP=new Map,wP=127,ry=1e-10,lM=139/13,CP=new Map;function uM(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return CP.has(a)?c=CP.get(a):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let T=h,R=1;T>m;T--,R++)v=v*T/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,CP.set(a,c)),c<ry&&(c=ry),c}function IH(t,r,s){const a=r.length,c=t.length/a;let d=!1;for(let h=0,m=0;h<a;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,d=!0)}return d}window.cache=CP;let ege=0;class AH{constructor(r){Ie(this,"id",void 0),Ie(this,"immediates",[]),Ie(this,"lastNonSilence",-1),Ie(this,"immediateSpeechActivityScore",ry),Ie(this,"lastLevelChangedTime",Date.now()),Ie(this,"levels",[]),Ie(this,"longs",[]),Ie(this,"longSpeechActivityScore",ry),Ie(this,"mediums",[]),Ie(this,"mediumSpeechActivityScore",ry),Ie(this,"minLevel",0),Ie(this,"nextMinLevel",0),Ie(this,"nextMinLevelWindowLength",0),Ie(this,"energyScore",0),this.id=r||"".concat(ege++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+lM;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<a&&(h=0);const m=Math.floor(h/lM);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return IH(this.mediums,this.longs,4)}computeMediums(){return IH(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=uM(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=uM(this.longs[0],10,47),this.longSpeechActivityScore>ry&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=uM(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(wm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>wP&&(a=wP),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+lM?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>wP&&(s=wP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class tge{constructor(r){Ie(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class dM{constructor(r,s,a){Ie(this,"isDominant",void 0),Ie(this,"energyRanking",void 0),Ie(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class nge extends Gr{constructor(r){super(),Ie(this,"dominantId",null),Ie(this,"lastDecisionTime",0),Ie(this,"lastLevelChangedTime",0),Ie(this,"lastLevelIdleTime",0),Ie(this,"relativeSpeechActivities",[]),Ie(this,"speakers",new Map),Ie(this,"enableSilence",!1),Ie(this,"timeoutToSilenceInterval",0),Ie(this,"decisionMaker",null),Ie(this,"loudest",[]),Ie(this,"numLoudestToTrack",3),Ie(this,"energyExpireTimeMs",250),Ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new AH(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new dM(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new dM(c,0,r.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new dM(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new tge(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=nl(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const T=this.speakers.entries().next();T.value&&(d=T.value[0],m=T.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const T of this.speakers.entries()){const[R,P]=T;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let W=0;W<y.length;++W){const Q=m==null?ry:m.getSpeechActivityScore(W);y[W]=Math.log(P.getSpeechActivityScore(W)/Q)}const D=y[0],G=y[1],F=y[2];D>3&&G>2&&F>0&&G>v&&(v=G,d=R)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of nl(a=this.speakers).call(a)){var a;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const dS=new Map;let Wd=null,RP=null;const PH=3;let iy=[];const zd=new Map,IP=new Map;class rge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Ie(this,"id",void 0),Ie(this,"track",void 0),Ie(this,"score",0),Ie(this,"active",!0),Ie(this,"muted",!1),Ie(this,"timer",0),Ie(this,"actives",0),Ie(this,"inactives",0),this.id=r,this.track=s,this.setActive(zd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=function(){const c=[],d=[];return Array.from(nl(zd).call(zd)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let a;return Array.from(nl(zd).call(zd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let a;return Array.from(nl(zd).call(zd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let AP;function OH(t){const r=zd.get(t);r&&(zd.delete(t),r.clearTimer())}const PP=new Map,ige=new Map;function sge(t,r,s){let a=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}const OP=new Map,zT=new Map;(function(){const t=Ln();Ts.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Ts.getStreamFromExtension=t.name===Kn.CHROME&&Number(t.version)>34,Ts.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),Ts.supportMinBitrate=t.name===Kn.CHROME||t.name===Kn.EDGE,Ts.supportSetRtpSenderParameters=function(){const r=Ln();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!pf()||!(!Vs()&&!sP())||r.name===Kn.FIREFOX&&Number(r.version)>=64)}(),t.name===Kn.SAFARI&&(Number(t.version)>=14?Ts.supportDualStream=!0:Ts.supportDualStream=!1),Ts.webAudioMediaStreamDest=function(){const r=Ln();return!(r.name===Kn.SAFARI&&Number(r.version)<12)}(),Ts.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Ts.supportWebGL=typeof WebGLRenderingContext<"u",Ts.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,pf()||(Ts.webAudioWithAEC=!0),Ts.supportShareAudio=function(){const r=Ln();return(r.os===Zi.WIN_10||r.os===Zi.WIN_81||r.os===Zi.WIN_7||r.os===Zi.LINUX||r.os===Zi.MAC_OS||r.os===Zi.CHROMIUM_OS)&&r.name===Kn.CHROME&&Number(r.version)>=74}(),Ts.supportDataChannel=!!(NT(76)||function(r){const s=Ln();return!(s.name!==Kn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||Lz(14)),Ts.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!qr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),Ts.supportWebRTCEncodedTransform=function(){const r=Ln();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),Ts.supportWebRTCInsertableStream=function(){const r=Ln();return(r.name===Kn.CHROME||r.name===Kn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Ts.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Ts.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,cP(()=>{Ts.supportDualStreamEncoding=function(){const r=Ln();return!!ae("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&ae("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",Ts)})})();const oge=["CHINA","GLOBAL"],kH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],sy=[],hS=[];function oy(t,r){return!!r&&sy.some(s=>s.uid===t&&s.channelName===r)}function hM(){return hS.length>0}var age=Z6.forEach,NH=Fp("forEach")?[].forEach:function(t){return age(this,t,arguments.length>1?arguments[1]:void 0)};$n({target:"Array",proto:!0,forced:[].forEach!=NH},{forEach:NH});var cge=vc("Array").forEach,lge=Hc,uge=ki,dge=O,hge=cge,pM=Array.prototype,pge={DOMTokenList:!0,NodeList:!0},fge=function(t){var r=t.forEach;return t===pM||dge(pM,t)&&r===pM.forEach||uge(pge,lge(t))?hge:r},mge=l(fge),gge=Fi,DH=qc;$n({target:"Object",stat:!0,forced:u(function(){DH(1)})},{keys:function(t){return DH(gge(t))}});var xH=l(vt.Object.keys),_ge=l(bE),yge=l(wE),Ege=$n,LH=u_,vge=D_,Sge=Et,MH=ge,bge=Ei,Tge=Te,wge=uA,Cge=wr,Rge=xs,Ige=z6("slice"),Age=Cge("species"),fM=Array,Pge=Math.max;Ege({target:"Array",proto:!0,forced:!Ige},{slice:function(t,r){var s,a,c,d=Tge(this),h=bge(d),m=MH(t,h),y=MH(r===void 0?h:r,h);if(LH(d)&&(s=d.constructor,(vge(s)&&(s===fM||LH(s.prototype))||Sge(s)&&(s=s[Age])===null)&&(s=void 0),s===fM||s===void 0))return Rge(d,m,y);for(a=new(s===void 0?fM:s)(Pge(y-m,0)),c=0;m<y;m++,c++)m in d&&wge(a,c,d[m]);return a.length=c,a}});var Oge=vc("Array").slice,kge=O,Nge=Oge,mM=Array.prototype,Dge=function(t){var r=t.slice;return t===mM||kge(mM,t)&&r===mM.slice?Nge:r},xge=l(Dge);function It(t,r,s,a,c){var d,h,m,y={};return mge(d=xH(a)).call(d,function(v){y[v]=a[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=_ge(h=yge(m=xge(s).call(s)).call(m)).call(h,function(v,T){return T(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(j6(t,r,y),y=null),y}let kP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),gM=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Bu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Qo=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Bt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Sr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Yt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Kt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),GT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Cn=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Zo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),tn=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function NP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Ae(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function DP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||zz(t,1,255)))throw new Ae(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let yf=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Lge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},_M={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function yM(t,r){Ss(t.url,"".concat(r,".url"),1,1e3,!1),Yr(t.x)||ur(t.x,"".concat(r,".x"),0,1e4),Yr(t.y)||ur(t.y,"".concat(r,".y"),0,1e4),Yr(t.width)||ur(t.width,"".concat(r,".width"),0,1e4),Yr(t.height)||ur(t.height,"".concat(r,".height"),0,1e4),Yr(t.zOrder)||ur(t.zOrder,"".concat(r,".zOrder"),0,255),Yr(t.alpha)||ur(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Mge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let eg=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),EM=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Gi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function UH(t){if(!t.channelName)throw new Ae(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Ae(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ss(t.token,"info.token",1,2047),DP(t.uid),NP(t.channelName),!0}let ea=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Ef=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),tc=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),pS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Zn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),gs=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),xP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),ts=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),qn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const VH=[qn.AFRICA,qn.ASIA,qn.CHINA,qn.EUROPE,qn.GLOBAL,qn.INDIA,qn.JAPAN,qn.NORTH_AMERICA,qn.OCEANIA,qn.OVERSEA,qn.SOUTH_AMERICA];let Xs=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const LP={CHINA:{},ASIA:{CODE:Xs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Xs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Xs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Xs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Xs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Xs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Xs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Xs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Xs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Xs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Xs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Xs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Xs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};FL&&(LP.CHINA={CODE:Xs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let HT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function jH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class FH extends Gr{constructor(r,s){super(),q(this,"onICEConnectionStateChange",void 0),q(this,"onConnectionStateChange",void 0),q(this,"onDTLSTransportStateChange",void 0),q(this,"onDTLSTransportError",void 0),q(this,"onICETransportStateChange",void 0),q(this,"onFirstAudioReceived",void 0),q(this,"onFirstVideoReceived",void 0),q(this,"onFirstAudioDecoded",void 0),q(this,"onFirstVideoDecoded",void 0),q(this,"onFirstVideoDecodedTimeout",void 0),q(this,"onSelectedLocalCandidateChanged",void 0),q(this,"onSelectedRemoteCandidateChanged",void 0),q(this,"onICECandidateError",void 0),q(this,"getLocalVideoStats",void 0)}}class BH extends FH{constructor(r,s){super(r,s),q(this,"establishPromise",void 0)}}let Tt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Js=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),vf=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const WH=["disconnected","failed"];let Ye=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Qn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Vt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Wu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),zu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),_s=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),zH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),zh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Yl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Gd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),fS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),pi=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),mS=function(t){return t.ABORT="abort",t}({}),tg=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Uge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Vge={[kP.ACCESS_POINT]:{[Qo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Qo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Qo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Qo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Qo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Qo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Qo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[kP.UNILBS]:{[Bu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Bu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Bu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Bu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Bu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Bu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Bu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Bu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Bu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Bu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Bu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Bu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[kP.STRING_UID_ALLOCATOR]:{[gM.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[gM.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[gM.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function gS(t){const r=Vge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===kP.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const jge={[Bt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Bt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Bt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Bt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Bt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Bt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Bt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Bt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Bt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Bt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Bt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Bt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Bt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Bt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Bt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Bt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Bt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Bt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Bt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Bt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Bt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Bt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Bt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Bt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Bt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Bt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Bt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Bt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Bt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Bt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Bt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Bt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Bt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Bt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Bt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Bt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Bt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Bt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Bt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Bt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Bt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Bt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Bt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Bt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Bt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Bt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Bt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Bt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Bt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Bt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Bt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Bt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Bt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Bt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Bt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Bt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function $T(t){return jge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function GH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function vM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?GH(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):GH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function HH(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const d=ae("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const Fge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Bge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Wge=/wss:\/\/(.+):([0-9]+)\/?/,zge=/wss:\/\/(.[^\/]+)\/?/;let Gge=0;class Hge{constructor(r,s){q(this,"id",0),q(this,"store",void 0),q(this,"recordIndex",void 0),q(this,"websockets",[]),q(this,"try443PortDuration",2e3),q(this,"forceCloseWSDuration",5e3),q(this,"try443PortTimeout",null),q(this,"forceCloseTimeout",null),q(this,"isTry443PortFailed",!1),q(this,"isNormalPortFailed",!1),q(this,"useDoubleDomain",!1),q(this,"useProxy",!1),q(this,"startTime",Date.now()),this.id=++Gge,this.try443PortDuration=ae("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=ae("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find(P=>{var D;return at(D=r.host).call(D,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(HH(vM(vM({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=vM({},r);if(s&&m){const D=c.find(G=>G!==m);D&&(P.host=P.host.replace(m,D))}y.push(HH(P,s))}try{y.forEach(P=>{const D=new WebSocket(P);D.binaryType="arraybuffer",h.push(D),this.logger("ws is connecting:",D.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(D=>D.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new Ae(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const v=kT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(D=>{D!==P&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,v.resolve(P)},P.onclose=D=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(P.readyState));const G=h.every(F=>F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),v.reject({code:D.code,reason:xP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=D=>this.logger("".concat(P.url," onmessage: ").concat(D.data))}),this.websockets.push(...h);const T=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(v.isResolved)return T();Ln().os===Zi.MAC_OS&&qr()&&T(),this.createWebSocket(r,!0,!0).then(P=>{v.resolve(P)}).catch(P=>{this.isNormalPortFailed&&v.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,T()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,T()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(d){let h,m,y;return[,h,m,y]=d.match(Fge)||[],h||([,m,y]=d.match(Bge)||[]),m&&y||([,m,y]=d.match(Wge)||[]),m&&y||([,m]=d.match(zge)||[]),m||x.warning("un-destructible url: ",d),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function $H(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class KH extends Gr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;at(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(tn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(tn.CONNECTED):this._state==="closed"?this.emit(tn.CLOSED):this._state==="failed"&&this.emit(tn.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),q(this,"connectionID",0),q(this,"currentURLIndex",0),q(this,"urls",[]),q(this,"_reconnectMode","tryNext"),q(this,"reconnectReason",void 0),q(this,"_initMutex",void 0),q(this,"name",void 0),q(this,"_state","closed"),q(this,"reconnectInterrupter",void 0),q(this,"websocket",void 0),q(this,"retryConfig",void 0),q(this,"reconnectCount",0),q(this,"forceCloseTimeout",5e3),q(this,"onlineReconnectListener",void 0),q(this,"useCompress",void 0),q(this,"tryDoubleDomain",!1),q(this,"use443PortOnly",!1),q(this,"wsInflateLength",0),q(this,"wsDeflateLength",0),q(this,"closeEstablishingWs",()=>{}),q(this,"store",void 0),q(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var D=arguments[P]!=null?arguments[P]:{};P%2?$H(Object(D),!0).forEach(function(G){q(R,G,D[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):$H(Object(D)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(D,G))})}return R}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Ys("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),T=Math.max(1.2,Math.floor(8*y)/10);Ac.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=T),Si.on(Yv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===Ac.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=T):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=kT(),d=this.urls[this.currentURLIndex];ae("ENABLE_PREALLOC_PC")&&this.emit(zH.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(c.resolve).catch(c.reject),this.once(tn.CLOSED,()=>{c.reject(new Le(te.WS_DISCONNECT))}),this.once(tn.CONNECTED,c.resolve),await c.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=kT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=T=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),T),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async T=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(T.code,", reason: ").concat(T.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(T.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=T.reason,this.state="reconnecting");const P=il(this,tn.WILL_RECONNECT,this.reconnectMode,T.reason)||this.reconnectMode,D=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return a.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(T.code))),this.close(!0);a.resolve()}},h=T=>{this.emit(tn.ON_MESSAGE,T)},m=T=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(T))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),ae("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=ae("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const T=await this.chooseBestWebsocketConnection(r);this.websocket=T,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(T){const R=this.state==="closed",P=T instanceof Le,D=P&&T.code===te.WS_ABORT,G=P&&T.code===te.WS_ERR,F=P?T.message:T&&(T.reason||T.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(F)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[T]},y),R||G?(a.reject(R?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(F)):new Le(te.WS_ERR,"init websocket failed: ".concat(F))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(F))):d&&d(T)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Si.isOnline||!Si.onlineWaiter||(this.onlineReconnectListener=Si.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=NL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await pt.race([bs(h),this.onlineReconnectListener||new pt(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(tn.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Fs(this,tn.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&at(m).call(m,"dynamic key expired")?(this.emit(tn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class SM extends KH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=kT(),c=function(h,m){return new Hge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const d=ae("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class KT extends KH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new pt((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=ae("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),T=m.find(G=>v!==-1?at(r).call(r,G,v):at(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",T,", domains: ",m);let R=!this.tryDoubleDomain||!T;if(!R&&T){var P;const G=Date.now();try{m.forEach(F=>{const W=v===-1?r.replace(T,F):r.substr(0,v)+r.substr(v).replace(T,F),Q=new WebSocket(W);Q.binaryType="arraybuffer",h.push(Q),x.debug("[choose-best-ws] ws is connecting:",Q.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(W=>W.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(F=>F.url),service:"gateway"},s),h.forEach(F=>{F.onopen=()=>{if(d)return;const W=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(W,"ms")),h.filter(Q=>Q!==F).forEach(Q=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Q.url)),Q.close()}),d=!0,a(F)},F.onclose=W=>{y=W,!d&&(h.find(Q=>!(Q.readyState===WebSocket.CLOSED||Q.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),d=!0,c(y)))},F.onmessage=W=>{x.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(W.data))}}),bs(this.forceCloseTimeout).then(()=>{h.forEach(F=>{F.readyState!==WebSocket.OPEN&&F.close()})})}if(R){var D;let G;x.debug("[choose-best-ws] use single url: ",r),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(F){const W=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(F.toString()));return x.error("[".concat(this.name,"]").concat(W)),void c(W)}G.onopen=()=>{a(G)},G.onclose=F=>{c(F)},G.onmessage=F=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(F.data))},bs(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class $ge extends Gr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Sr.CONNECTED?this.emit(Yt.WS_CONNECTED):r===Sr.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):r===Sr.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",Sr.CLOSED),q(this,"reconnectToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new s8(5)),q(this,"pingpongTimer",void 0),q(this,"wsInflateDataTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Jn.UID_BANNED);break;case 15:this.close(Jn.IP_BANNED);break;case 16:this.close(Jn.CHANNEL_BANNED)}if(c._type===Cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(Jn.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(Jn.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Jn.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(Jn.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Jn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(Jn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new SM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,ae("JOIN_GATEWAY_USE_DUAL_DOMAIN"),ae("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Sr.CONNECTED&&this.reconnect("retry",js.OFFLINE)})}async request(r,s,a,c){const d=yr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new pt((G,F)=>{if(this.connectionState===Sr.CONNECTED)return G();const W=()=>{this.off(Yt.WS_CLOSED,Q),G()},Q=()=>{this.off(Yt.WS_CONNECTED,W),F(new Ae(te.WS_ABORT))};this.once(Yt.WS_CONNECTED,W),this.once(Yt.WS_CLOSED,Q),r!==Kt.PUBLISH&&r!==Kt.PUBLISH_DATASTREAM&&r!==Kt.SUBSCRIBE&&r!==Kt.SUBSCRIBE_DATASTREAM&&r!==Kt.UNSUBSCRIBE&&r!==Kt.UNSUBSCRIBE_DATASTREAM&&r!==Kt.UNPUBLISH&&r!==Kt.UNPUBLISH_DATASTREAM&&r!==Kt.CONTROL&&r!==Kt.RESTART_ICE||this.once(Yt.DISCONNECT_P2P,()=>{F(new Ae(te.DISCONNECT_P2P))}),r!==Kt.PUBLISH&&r!==Kt.RESTART_ICE||this.once(Yt.ABORT_P2P_EXECUTION,()=>{F(new Ae(te.DISCONNECT_P2P))})});if(this.connectionState!==Sr.CONNECTING&&this.connectionState!==Sr.RECONNECTING||r===Kt.JOIN||r===Kt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new pt((G,F)=>{let W=!1;const Q=(fe,ye)=>{W=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.emit(Yt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Q);const ee=()=>{F(new Ae(te.WS_ABORT,"type: ".concat(r))),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.off("res-@".concat(d),Q)};this.once(Yt.WS_CLOSED,ee),this.once(Yt.WS_RECONNECTING,ee),bs(ae("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Yt.REQUEST_TIMEOUT,r,s))})});let T=null;try{T=await v}catch(G){if(this.connectionState===Sr.CLOSED||r===Kt.LEAVE)throw new Ae(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Kt.JOIN||r===Kt.REJOIN?null:(await y(),await this.request(r,s))}if(T.isSuccess)return T.message;const R=Number(T.message.error_code||T.message.code),P=$T(R),D=new Ae(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(T.message.error_str),{code:R,data:T.message,desc:P.desc});return P.action==="success"?T.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Kt.JOIN||r===Kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",js.MULTI_IP)):this.reconnect(P.action,js.SERVER_ERROR),r===Kt.JOIN||r===Kt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new pt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(GT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=ae("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Sr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},ae("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,a)=>{this.once(Yt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Yt.WS_CLOSED,c=>a(this.initError||new Ae(te.WS_ABORT,c))),this.connectionState=Sr.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Jn.LEAVE,this.connectionState=Sr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const r=await Fs(this,Yt.REQUEST_JOIN_INFO),s=await this.request(Kt.JOIN,r);if(!s)return this.emit(Yt.REPORT_JOIN_GATEWAY,xP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Sr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ae(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=UT(this,Yt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Kt.REJOIN,r);return!!s&&(this.connectionState=Sr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(Cn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Cn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Cn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Cn.MUTE_AUDIO,{uid:a.uid}):this.emit(Cn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Cn.MUTE_VIDEO,{uid:a.uid}):this.emit(Cn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Cn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Cn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Cn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Cn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Cn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=$T(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Yt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Jn.UID_BANNED),void this.close()):void this.reconnect(s.action,js.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=ae("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ae("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",js.TIMEOUT):this.request(Kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),ae("REPORT_STATS")&&this.send(Kt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(GT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(tn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(tn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(tn.CLOSED,()=>{this.connectionState=Sr.CLOSED}),this.websocket.on(tn.FAILED,()=>{this._disconnectedReason=Jn.NETWORK_ERROR,this.connectionState=Sr.CLOSED}),this.websocket.on(tn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Sr.CONNECTED?this.connectionState=Sr.RECONNECTING:this.connectionState=Sr.CONNECTING}),this.websocket.on(tn.WILL_RECONNECT,(r,s,a)=>{const c=UT(this,Yt.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=xP.P2P_DISCONNECTED),d&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Yt.REPORT_JOIN_GATEWAY,s||xP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Yt.DISCONNECT_P2P)),a(r)}),this.websocket.on(tn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",js.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Ae){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return this.initError=new Ae(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Jn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",js.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(tn.REQUEST_NEW_URLS,(r,s)=>{Fs(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(tn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(zH.PRE_CONNECT_PC,()=>{this.emit(Yt.PRE_CONNECT_PC)})}}let Kge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),bi=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function qH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function MP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?qH(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):qH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function ng(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(ae("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function bM(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(ae("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:D}=R;return{address:"".concat(P,":").concat(D)}});const v=ae("GATEWAY_DOMAINS");let T=v[1]&&at(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:D,ip:G}=R;if(P)return{address:"".concat(P,".").concat(v[T++%v.length],":").concat(D)};const F=/^[\.\:\d]+$/.test(G),W=F?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[T++%v.length],":").concat(D):"".concat(G,":").concat(D);return F||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:D,address:W}})}(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let y=0;y<m.length;y++){var c;const v=bo(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,y]=d.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Pc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function YH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(Pc(r.width),"x").concat(Pc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function XH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function qT(t,r){let s,a,c;switch(r){case bi.CHOOSE_SERVER:a=4096,c="choose server";break;case bi.CLOUD_PROXY:a=1048576,c="proxy";break;case bi.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case bi.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Ae(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>MP(MP({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:MP(MP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!s)throw new Ae(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function JH(t,r){return await pt.all(t.addresses.map(async s=>({address:ae("USE_TURN_IP")?s.ip:ng(s.ip),tcpport:s.port,udpport:s.port,username:r&&ae("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Bs.username,password:r&&ae("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await AL(r.toString()):Bs.password})))}function TM(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Pc(t.height),Pc(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function rg(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=d}return m}function UP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ae("SVC_MODE");if(ae("ENABLE_SVC"))return function(r){return r in hP}(t)?t:hP.L1T3}const QH={[Tt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Tt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function VP(t,r,s){r.forEach(a=>{var c;const d=QH[t].find(m=>{var y;let{key:v}=m;return at(y=a.extensionName).call(y,v)});if(!d)return;const h=s.find(m=>{let{extensionName:y}=m;return at(y).call(y,d.key)});h&&at(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function _S(t,r){r.forEach(s=>{var a;const c=QH[t].find(d=>{var h;let{key:m}=d;return at(h=s.extensionName).call(h,m)});at(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function ZH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||at(t).call(t,"abs-send-time")}function jP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||at(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function e9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function t9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?e9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):e9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function YT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let T=[],R=[],P=[],D=[],G=!1,F=!1;if(ec(t).mediaDescriptions.forEach(Q=>{a&&a!==Q.attributes.direction||(Q.media.mediaType!=="video"||G||(R=Q.attributes.payloads,D=Q.attributes.extmaps,G=!0),Q.media.mediaType!=="audio"||F||(T=Q.attributes.payloads,P=Q.attributes.extmaps,F=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||T.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(Q=>{var ee;(ee=Q.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),v&&Q.rtcpFeedbacks.push({type:"rrtr"})}),T.forEach(Q=>{var ee;(ee=Q.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),v&&Q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(T=T.filter(Q=>{var ee;return((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(Q=>{var ee;return((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),d&&(R=R.filter(Q=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(T=T.filter(Q=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(T=T.filter(Q=>{var ee;return at(m).call(m,((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const Q=R.filter(ee=>{var fe;return at(y).call(y,((fe=ee.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLowerCase())||"")});R=Q.concat(c?[]:RM(Q,R))}const W=ae("UNSUPPORTED_VIDEO_CODEC");return W&&W.length>0&&(R=R.filter(Q=>!(Q.rtpMap&&at(W).call(W,Q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:T,videoCodecs:R,audioExtensions:P,videoExtensions:D}}function ig(t){const r=ec(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function n9(t,r){const s=[],a=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=a.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function r9(t,r,s){const{cname:a}=t;let c=[];r&&(c=i9(r)),c.length===0&&(c=t.iceParameters.candidates.map(T=>({foundation:T.foundation,componentId:"1",transport:T.protocol,priority:T.priority.toString(),connectionAddress:T.ip,port:T.port.toString(),type:T.type,extension:{}})),x.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(T=>({hashFunction:T.algorithm,fingerprint:T.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=BP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(T=>{v.push({kind:Tt.VIDEO,ssrcId:T.v,rtx:T.v_rtx,mslabel:"".concat(T.v,"_").concat(T.a)},{kind:Tt.AUDIO,ssrcId:T.a,mslabel:"".concat(T.v,"_").concat(T.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:a,preSSRCs:v}}function i9(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function ay(t,r,s){const a=[],c=[];return t.forEach(d=>{let{ssrcId:h,rtx:m}=d;const y=yr(8,"track-"),v={ssrcId:h,attributes:t9({label:y,mslabel:s=s||yr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(a.push(v),m!==void 0){const T={ssrcId:m,attributes:t9({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};a.push(T),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function yS(t,r){r instanceof ei&&t.attributes.payloads.forEach(s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!qr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function wM(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function CM(t,r){var s;if(!(r instanceof Pr&&r._encoderConfig&&r._hints.indexOf(Er.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;Bn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,h;at(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Bn().supportMinBitrate&&!at(s=r._hints).call(s,Er.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,h;at(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(ae("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function s9(t){if(t.media.mediaType!=="video")return;const r=Ln();if(r.name!==Kn.SAFARI&&r.os!==Zi.IOS)return;const s=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function FP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=a.find(h=>jP(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>jP(y.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(T=>!!y.find(R=>R.payloadType===T.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>jP(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const d=a.find(h=>ZH(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(T=>!!y.find(R=>R.payloadType===T.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(h=>ZH(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function o9(t,r,s){if(qr()||t.media.mediaType!=="video"||!(r instanceof Pr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!ae("SIMULCAST")||s==="vp9"&&ae("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Jr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:Jr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function a9(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const T=YT(v,m,y,"sendonly"),R=YT(v,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Gu(T,R,"videoExtensions",P,D,G),Gu(T,R,"videoCodecs",P,D,G),Gu(T,R,"audioExtensions",P,D,G),Gu(T,R,"audioCodecs",P,D,G),ae("RAISE_H264_BASELINE_PRIORITY")){const F=[],W=[];G.videoCodecs.forEach((Q,ee)=>{var fe;if(((fe=Q.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){var ye,ve;const _e=G.videoCodecs[ee+1],Ne=_e&&h9(Q,_e),Je=(ye=Q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],ft=(ve=Q.fmtp)===null||ve===void 0?void 0:ve.parameters["packetization-mode"];!Je||Je!==ae("FIRST_H264_PROFILE_LEVEL_ID")||ae("FIRST_PACKETIZATION_MODE")&&ft!==ae("FIRST_PACKETIZATION_MODE")?Ne?W.push([Q,_e]):W.push([Q]):Ne?F.push([Q,_e]):F.push([Q])}}),F.length>0&&W.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Q,ee)=>{var fe;if(((fe=Q.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){const ye=h9(Q,G.videoCodecs[ee+1]),ve=F.shift()||W.shift()||[];ve.length>0&&(ye?G.videoCodecs.splice(ee,2,...ve):G.videoCodecs.splice(ee,1,...ve))}}),D.videoCodecs=D.videoCodecs.filter(Q=>{var ee,fe;return!(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Q.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==ae("FIRST_H264_PROFILE_LEVEL_ID"))}),ae("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Q=>{var ee,fe;return!(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Q.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==ae("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:D,sendrecv:G}}(t,r,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function c9(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=YT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Gu(t,r,"videoExtensions",s,a,c),Gu(t,r,"videoCodecs",s,a,c),Gu(t,r,"audioExtensions",s,a,c),Gu(t,r,"audioCodecs",s,a,c),ae("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function Gu(t,r,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function BP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function ES(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function XT(t,r,s,a){let c=[];if(t===Tt.VIDEO){if(ae("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter(d=>{var h;return at(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===ae("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const T=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";at(T).call(T,a)?d.push(v):at(T).call(T,"vp9")?h.push(v):at(T).call(T,"vp8")?m.push(v):at(T).call(T,"h264")&&y.push(v)}),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):m.length!==0?(d=m,v="vp8"):y.length!==0&&(d=y,v="h264"),x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=r.videoCodecs.filter(v=>d.some(T=>T.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),ae("USE_PUB_RTX")||ae("USE_SUB_RTX")){const d=RM(c,r.videoCodecs);c=[...c,...d]}}else c=r.audioCodecs.filter(d=>{var h;return at(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(d=>{var h;return at(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function RM(t,r){const s=t.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&at(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function JT(t,r,s){const a=r.toString(),c=u9(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=l9(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function l9(t,r,s){const a=ec(t),{useXR:c}=r;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!at(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&ES(d),c&&at(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Zm(a)}function u9(t,r,s,a){if(ae("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{u9(c,"answer",s==="local"?"remote":"local",a)}:void 0}function d9(t){const r=ae("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>at(t).call(t,s))}function h9(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function p9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Xl(t,r){return typeof ae(t)===r?ae(t):void 0}function qge(){try{const t=ae("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?p9(Object(a),!0).forEach(function(c){q(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):p9(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const f9={};function sg(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),f9[t.name]=t}function Sf(t){const r=f9[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function m9(t,r){return Sf("DataStream").create(t,r)}function WP(){return Sf("InterceptFrame").create()}function g9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function bf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?g9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const IM=new Map;class Yge extends Gr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(gs.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(gs.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,d;super(),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"key",void 0),q(this,"ntpOffset",0),q(this,"signal",void 0),q(this,"role",void 0),q(this,"inChannelInfo",{joinAt:null,duration:0}),q(this,"spec",void 0),q(this,"_state","DISCONNECTED"),q(this,"_statsCollector",void 0),q(this,"_disconnectedReason",void 0),q(this,"isSignalRecover",!1),q(this,"hasChangeBGPAddress",!1),q(this,"trafficStatsInterval",void 0),q(this,"networkQualityInterval",void 0),q(this,"_joinGatewayStartTime",0),q(this,"_signalTimeout",!1),q(this,"_clientRoleOptions",void 0),q(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:bf(bf({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=Sf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new $ge(bf(bf({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=IM.get(r.cname);if(d||(d=new Map,IM.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const v=new Ae(te.UID_CONFLICT);throw Ot.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(T=>{let{address:R}=T;const[P,D]=R.split(":"),G={host:P,port:D};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Ot.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(gs.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(gs.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(gs.NETWORK_QUALITY,{uplinkNetworkQuality:XH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:XH(this._statsCollector.trafficStats.B_dnq)}):this.emit(gs.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Jn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Sr.CONNECTED||await function(a,c){return c===1/0?a:pt.race([a,vme(c)])}(this.signal.request(Kt.LEAVE,void 0,!0),3e3)}catch(a){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==Jn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:ae("PUB_EXTEND"),twcc:!!ae("PUBLISH_TWCC"),rtx:!!ae("USE_PUB_RTX")};try{return(await this.signal.request(Kt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Kt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Kt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(r.map(s=>this.signal.request(Kt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!ae("SUBSCRIBE_TWCC"),rtx:!!ae("USE_SUB_RTX")||void 0,extend:ae("SUB_EXTEND"),svc:Array.isArray(ae("SVC"))&&ae("SVC").length!==0?ae("SVC"):void 0};try{return await this.signal.request(Kt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!ae("SUBSCRIBE_TWCC"),rtx:!!ae("USE_SUB_RTX"),extend:ae("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(ae("SVC"))&&ae("SVC").length!==0?ae("SVC"):void 0};try{return(await this.signal.request(Kt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Kt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!ae("USE_SUB_RTX"),twcc:!!ae("SUBSCRIBE_TWCC"),svc:Array.isArray(ae("SVC"))&&ae("SVC").length!==0?ae("SVC"):void 0};try{return await this.signal.request(Kt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(r);if(s)return this.signal.request(Kt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(r.map(a=>this.signal.request(Kt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){x.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(Kt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Kt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Kt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Kt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),ae("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(ae("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},ae("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),ae("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},ae("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(ae("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Kt.SET_CLIENT_ROLE,{role:r,level:c,delay:a,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Kt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Kt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Kt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Kt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Kt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),bf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Kt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=IM.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Bs.username,password:Bs.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(bf(bf({},Bs),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Kt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&cP(()=>{this.emit(gs.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Ae(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let a=ae("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var c;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(gs.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,at(hS).call(hS,c)||hS.push(c);const d=!(qr()||xz(87)||T8())&&typeof ae("ENABLE_PRE_SUB")=="boolean"&&ae("ENABLE_PRE_SUB"),h=!T8()&&Xl("ENABLE_PREALLOC_PC","boolean"),m=qge(),y=NT(87)||function(){const T=Ln();if(T.name!==Kn.SAFARI||!T.browserVersion)return!1;const R=T.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=bf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:$l,browser:navigator.userAgent,process_id:ae("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:ae("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:bf({enableEncodedTransform:!!ae("ENABLE_AUDIO_METADATA")&&y||!!ae("ENABLE_AUDIO_TOPN")&&vL(Kn.CHROME,87,116)||void 0,enableAudioMetadata:!!ae("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!ae("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:ae("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:ae("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:ae("TOPN_SWITCH_HOLD_MS"),topnAudioGain:ae("TOPN_AUDIO_GAIN"),enablePublishedUserList:ae("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:ae("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Xl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Xl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Xl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:ae("USE_PUB_RTX")===!0||ae("USE_SUB_RTX")===!0||void 0,disableFEC:ae("DISABLE_FEC"),enableNTPReport:!!ae("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!ae("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!ae("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Xl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!ae("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!ae("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Xl("USE_XR","boolean"),enableLossbasedBwe:Xl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!ae("ENABLE_AUT_CC")||void 0,enableCCFallback:Xl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:d?Xl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Xl("PUBLISH_TWCC","boolean"),enableSubTWCC:Xl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Xl("USE_PUB_RTX","boolean"),enableSubRTX:Xl("USE_SUB_RTX","boolean"),enableSubSVC:ae("ENABLE_SVC")?ae("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(ae("SVC"))&&ae("SVC").length!==0?ae("SVC"):void 0,enableSvcExtended:ae("ENABLE_SVC")&&Array.isArray(ae("SVC_EXTENDED"))&&ae("SVC_EXTENDED").length!==0?ae("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,ae("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Ae(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Yt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Yt.WS_RECONNECTING,r=>{this.joinInfo&&Ot.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||js.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ot.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Yt.WS_CLOSED,r=>{let s;switch(r){case Jn.LEAVE:s=js.LEAVE;break;case Jn.UID_BANNED:case Jn.IP_BANNED:case Jn.CHANNEL_BANNED:case Jn.SERVER_ERROR:s=js.SERVER_ERROR;break;case Jn.FALLBACK:s=js.FALLBACK;break;case Jn.LICENSE_MISSING:case Jn.LICENSE_EXPIRED:case Jn.LICENSE_MINUTES_EXCEEDED:case Jn.LICENSE_PERIOD_INVALID:case Jn.LICENSE_MULTIPLE_SDK_SERVICE:case Jn.LICENSE_ILLEGAL:case Jn.TOKEN_EXPIRE:s=r;break;default:s=js.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+js.NETWORK_ERROR)),this.joinInfo&&Ot.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Jn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Jn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Yt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=ae("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Ot.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));or("EVENT_REPORT_DOMAIN",r[1]),or("EVENT_REPORT_BACKUP_DOMAIN",r[1]),or("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(Cn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Yt.REQUEST_RECOVER,(r,s,a)=>{if(!this.joinInfo)return a(new Ae(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Fs(this,gs.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(Yt.REQUEST_JOIN_INFO,async(r,s,a)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const d=Jr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(ae("NEW_TURN_MODE")&&d){let v=d.servers,T=d.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],d.servers=v),Array.isArray(T)&&T.length>0&&(T=[T[0]],d.serversFromGateway=T),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await Fs(this,gs.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on(Yt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Yt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let a,c="";var d;r instanceof Ae?(a=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):a=r,Ot.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Yt.IS_P2P_DISCONNECTED,r=>{r(UT(this,gs.IS_P2P_DISCONNECTED))}),this.signal.on(Yt.DISCONNECT_P2P,()=>{this.emit(gs.DISCONNECT_P2P)}),this.signal.on(Yt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Yt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Yt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(gs.JOIN_RESPONSE,r,s)}),this.signal.on(Yt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=ae("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const a=i9(r);this.emit(gs.PRE_CONNECT_PC,{candidates:a,fingerprint:s})}}}),this.signal.on(Yt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof ae("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(ae("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Kt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Kt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw x.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Kt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Kt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw x.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(Kt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find(c=>c.stream_type===Zn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Kt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find(c=>c.stream_type===Zn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Kt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===Tt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Kt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===Tt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Kt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Kt.RESTART_ICE,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||js.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!ae("GATEWAY_WSS_ADDRESS"))return ae("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Kt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let zP=0,AM=0;function Hd(t,r,s,a){return new pt((c,d)=>{r.timeout=r.timeout||ae("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),zP+=Vh(r.data)):s&&(r.data.size?zP+=r.data.size:r.data instanceof FormData?zP+=Qz(r.data):zP+=Vh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Ta.request(r).then(h=>{typeof h.data=="string"?AM+=Vh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?AM+=h.data.byteLength:AM+=Vh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Ta.isCancel(h)?d(new Ae(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Ae(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Ae(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Ae(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ze){var ot=0;return function(){return ot<ze.length?{done:!1,value:ze[ot++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(ze,ot,At){return ze==Array.prototype||ze==Object.prototype||(ze[ot]=At.value),ze},a,c=function(ze){ze=[typeof globalThis=="object"&&globalThis,ze,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var ot=0;ot<ze.length;++ot){var At=ze[ot];if(At&&At.Math==Math)return At}throw Error("Cannot find global object")}(this);function d(ze,ot){if(ot)e:{var At=c;ze=ze.split(".");for(var Ke=0;Ke<ze.length-1;Ke++){var V=ze[Ke];if(!(V in At))break e;At=At[V]}(ot=ot(Ke=At[ze=ze[ze.length-1]]))!=Ke&&ot!=null&&s(At,ze,{configurable:!0,writable:!0,value:ot})}}function h(ze){return(ze={next:ze})[Symbol.iterator]=function(){return this},ze}function m(ze){var ot=typeof Symbol<"u"&&Symbol.iterator&&ze[Symbol.iterator];return ot?ot.call(ze):{next:r(ze)}}if(d("Symbol",function(ze){function ot(V,ce){this.A=V,s(this,"description",{configurable:!0,writable:!0,value:ce})}if(ze)return ze;ot.prototype.toString=function(){return this.A};var At="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ke=0;return function V(ce){if(this instanceof V)throw new TypeError("Symbol is not a constructor");return new ot(At+(ce||"")+"_"+Ke++,ce)}}),d("Symbol.iterator",function(ze){if(ze)return ze;ze=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),At=0;At<ot.length;At++){var Ke=c[ot[At]];typeof Ke=="function"&&typeof Ke.prototype[ze]!="function"&&s(Ke.prototype,ze,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ze}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}a=y?function(ze,ot){if(ze.__proto__=ot,ze.__proto__!==ot)throw new TypeError(ze+" is not extensible");return ze}:null}var T=a;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(ze){if(ze.m)throw new TypeError("Generator is already running");ze.m=!0}function D(ze,ot){return ze.h=3,{value:ot}}function G(ze){this.g=new R,this.G=ze}function F(ze,ot,At,Ke){try{var V=ot.call(ze.g.j,At);if(!(V instanceof Object))throw new TypeError("Iterator result "+V+" is not an object");if(!V.done)return ze.g.m=!1,V;var ce=V.value}catch(me){return ze.g.j=null,ze.g.s(me),W(ze)}return ze.g.j=null,Ke.call(ze.g,ce),W(ze)}function W(ze){for(;ze.g.h;)try{var ot=ze.G(ze.g);if(ot)return ze.g.m=!1,{value:ot.value,done:!1}}catch(At){ze.g.v=void 0,ze.g.s(At)}if(ze.g.m=!1,ze.g.l){if(ot=ze.g.l,ze.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function Q(ze){this.next=function(ot){return ze.o(ot)},this.throw=function(ot){return ze.s(ot)},this.return=function(ot){return function(At,Ke){P(At.g);var V=At.g.j;return V?F(At,"return"in V?V.return:function(ce){return{value:ce,done:!0}},Ke,At.g.return):(At.g.return(Ke),W(At))}(ze,ot)},this[Symbol.iterator]=function(){return this}}function ee(ze,ot){return ot=new Q(new G(ot)),T&&ze.prototype&&T(ot,ze.prototype),ot}if(R.prototype.o=function(ze){this.v=ze},R.prototype.s=function(ze){this.l={D:ze,F:!0},this.h=this.C||this.u},R.prototype.return=function(ze){this.l={return:ze},this.h=this.u},G.prototype.o=function(ze){return P(this.g),this.g.j?F(this,this.g.j.next,ze,this.g.o):(this.g.o(ze),W(this))},G.prototype.s=function(ze){return P(this.g),this.g.j?F(this,this.g.j.throw,ze,this.g.o):(this.g.s(ze),W(this))},d("Array.prototype.entries",function(ze){return ze||function(){return function(ot,At){ot instanceof String&&(ot+="");var Ke=0,V=!1,ce={next:function(){if(!V&&Ke<ot.length){var me=Ke++;return{value:At(me,ot[me]),done:!1}}return V=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(ot,At){return[ot,At]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fe=function(ze,ot){for(var At=0;At<ze.length;At++)ot(ze[At])},ye=function(ze){return ze.replace(/\r?\n|\r/g,`\r
`)},ve=function(ze,ot,At){return ot instanceof Blob?(At=At!==void 0?At+"":typeof ot.name=="string"?ot.name:"blob",ot.name===At&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],At)),[String(ze),ot]):[String(ze),String(ot)]},_e=function(ze,ot){if(ze.length<ot)throw new TypeError(ot+" argument required, but only "+ze.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Je=Ne.FormData,ft=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,yt=Ne.Request&&Ne.fetch,An=Ne.navigator&&Ne.navigator.sendBeacon,Pn=Ne.Element&&Ne.Element.prototype,vr=Ne.Symbol&&Symbol.toStringTag;vr&&(Blob.prototype[vr]||(Blob.prototype[vr]="Blob"),"File"in Ne&&!File.prototype[vr]&&(File.prototype[vr]="File"));try{new File([],"")}catch{Ne.File=function(ot,At,Ke){return ot=new Blob(ot,Ke||{}),Object.defineProperties(ot,{name:{value:At},lastModified:{value:+(Ke&&Ke.lastModified!==void 0?new Date(Ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),vr&&Object.defineProperty(ot,vr,{value:"File"}),ot}}var fi=function(ze){return ze.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ti=function(ze){this.i=[];var ot=this;ze&&fe(ze.elements,function(At){if(At.name&&!At.disabled&&At.type!=="submit"&&At.type!=="button"&&!At.matches("form fieldset[disabled] *"))if(At.type==="file"){var Ke=At.files&&At.files.length?At.files:[new File([],"",{type:"application/octet-stream"})];fe(Ke,function(V){ot.append(At.name,V)})}else At.type==="select-multiple"||At.type==="select-one"?fe(At.options,function(V){!V.disabled&&V.selected&&ot.append(At.name,V.value)}):At.type==="checkbox"||At.type==="radio"?At.checked&&ot.append(At.name,At.value):(Ke=At.type==="textarea"?ye(At.value):At.value,ot.append(At.name,Ke))})};if((t=ti.prototype).append=function(ze,ot,At){_e(arguments,2),this.i.push(ve(ze,ot,At))},t.delete=function(ze){_e(arguments,1);var ot=[];ze=String(ze),fe(this.i,function(At){At[0]!==ze&&ot.push(At)}),this.i=ot},t.entries=function ze(){var ot,At=this;return ee(ze,function(Ke){if(Ke.h==1&&(ot=0),Ke.h!=3)return ot<At.i.length?Ke=D(Ke,At.i[ot]):(Ke.h=0,Ke=void 0),Ke;ot++,Ke.h=2})},t.forEach=function(ze,ot){_e(arguments,1);for(var At=m(this),Ke=At.next();!Ke.done;Ke=At.next()){var V=m(Ke.value);Ke=V.next().value,V=V.next().value,ze.call(ot,V,Ke,this)}},t.get=function(ze){_e(arguments,1);var ot=this.i;ze=String(ze);for(var At=0;At<ot.length;At++)if(ot[At][0]===ze)return ot[At][1];return null},t.getAll=function(ze){_e(arguments,1);var ot=[];return ze=String(ze),fe(this.i,function(At){At[0]===ze&&ot.push(At[1])}),ot},t.has=function(ze){_e(arguments,1),ze=String(ze);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===ze)return!0;return!1},t.keys=function ze(){var ot,At,Ke,V,ce=this;return ee(ze,function(me){if(me.h==1&&(ot=m(ce),At=ot.next()),me.h!=3)return At.done?void(me.h=0):(Ke=At.value,V=m(Ke),D(me,V.next().value));At=ot.next(),me.h=2})},t.set=function(ze,ot,At){_e(arguments,2),ze=String(ze);var Ke=[],V=ve(ze,ot,At),ce=!0;fe(this.i,function(me){me[0]===ze?ce&&(ce=!Ke.push(V)):Ke.push(me)}),ce&&Ke.push(V),this.i=Ke},t.values=function ze(){var ot,At,Ke,V,ce=this;return ee(ze,function(me){if(me.h==1&&(ot=m(ce),At=ot.next()),me.h!=3)return At.done?void(me.h=0):(Ke=At.value,(V=m(Ke)).next(),D(me,V.next().value));At=ot.next(),me.h=2})},ti.prototype._asNative=function(){for(var ze=new Je,ot=m(this),At=ot.next();!At.done;At=ot.next()){var Ke=m(At.value);At=Ke.next().value,Ke=Ke.next().value,ze.append(At,Ke)}return ze},ti.prototype._blob=function(){var ze="----formdata-polyfill-"+Math.random(),ot=[],At="--"+ze+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ke,V){return typeof Ke=="string"?ot.push(At+fi(ye(V))+`"\r
\r
`+ye(Ke)+`\r
`):ot.push(At+fi(ye(V))+'"; filename="'+fi(Ke.name)+`"\r
Content-Type: `+(Ke.type||"application/octet-stream")+`\r
\r
`,Ke,`\r
`)}),ot.push("--"+ze+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+ze})},ti.prototype[Symbol.iterator]=function(){return this.entries()},ti.prototype.toString=function(){return"[object FormData]"},Pn&&!Pn.matches&&(Pn.matches=Pn.matchesSelector||Pn.mozMatchesSelector||Pn.msMatchesSelector||Pn.oMatchesSelector||Pn.webkitMatchesSelector||function(ze){for(var ot=(ze=(this.document||this.ownerDocument).querySelectorAll(ze)).length;0<=--ot&&ze.item(ot)!==this;);return-1<ot}),vr&&(ti.prototype[vr]="FormData"),ft){var Pa=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(ze,ot){Pa.call(this,ze,ot),ze.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(ze){ze instanceof ti?(ze=ze._blob(),this.B||this.setRequestHeader("Content-Type",ze.type),ft.call(this,ze)):ft.call(this,ze)}}yt&&(Ne.fetch=function(ze,ot){return ot&&ot.body&&ot.body instanceof ti&&(ot.body=ot.body._blob()),yt.call(this,ze,ot)}),An&&(Ne.navigator.sendBeacon=function(ze,ot){return ot instanceof ti&&(ot=ot._asNative()),An.call(this,ze,ot)}),Ne.FormData=ti}})();const QT=()=>{const t=ae("AREAS");return t.length===0&&t.push(qn.GLOBAL),Sc(t).call(t,(r,s,a)=>{const c=_9(s);return c?a===0?c:"".concat(r,",").concat(c):r},"")},_9=t=>t===qn.OVERSEA?"".concat(Xs.ASIA,",").concat(Xs.EUROPE,",").concat(Xs.AFRICA,",").concat(Xs.NORTH_AMERICA,",").concat(Xs.SOUTH_AMERICA,",").concat(Xs.OCEANIA):Xs[t],Xge=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const a=LP[s],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(a[d]))})}),r},GP={GLOBAL:{ASIA:[qn.CHINA,qn.JAPAN,qn.INDIA,qn.KOREA,qn.HKMC],EUROPE:[],NORTH_AMERICA:[qn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},HP=Object.keys(GP[qn.GLOBAL]),PM=[qn.CHINA,qn.NORTH_AMERICA,qn.EUROPE,qn.ASIA,qn.JAPAN,qn.INDIA,qn.OCEANIA,qn.SOUTH_AMERICA,qn.AFRICA,qn.KOREA,qn.HKMC,qn.US],Jge=function(t,r){let s=[];if(at(t).call(t,qn.GLOBAL)){const d=[qn.GLOBAL,qn.OVERSEA],h=Object.keys(LP);if(r===qn.GLOBAL)throw new Ae(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===qn.CHINA)s=[qn.OVERSEA];else if(c=r,at(HP).call(HP,c)){const m=(a=r,GP[qn.GLOBAL][a]||[]),y=[...d,r,...m];s=h.filter(v=>!at(y).call(y,v))}else if(function(m){let y=!1;return HP.forEach(v=>{var T;at(T=GP[qn.GLOBAL][v]).call(T,m)&&(y=!0)}),y}(r)){const m=function(v){let T;return HP.forEach(R=>{var P;at(P=GP[qn.GLOBAL][R]).call(P,v)&&(T=R)}),T}(r),y=[...d,m,r];s=h.filter(v=>!at(y).call(y,v))}else s=t;s=function(m){const y=[];return PM.forEach(v=>{at(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!at(PM).call(PM,v)))}(s)}else s=t;var a,c;return s};function y9(t){var r,s;if(!t&&at(r=ae("AREAS")).call(r,qn.EXTENSIONS))return x.debug("update area from ap : reset"),void OM(oge,!0);if(!at(s=ae("AREAS")).call(s,qn.GLOBAL)||!t)return;let a=LP.EXTENSIONS;a&&(a={CODE:_9(qn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),a),or("AREAS",[qn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?or(c,a[c][0]):or(c,a[c])}))}function OM(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Ot.reportApiInvoke(null,{name:xi.SET_AREA,options:t,tag:Xr.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!at(VH).call(VH,d))throw new Ae(te.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new Ae(te.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=h?Jge(m,h):m}if(!r){if(Bd.AREAS){const d=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void x.warning("setArea is prohibited because of config-distribute")}if(at(a).call(a,qn.GLOBAL)&&ae("AREAS")===qn.EXTENSIONS){const d=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void x.warning("setArea is prohibited because of ap extensions")}}or("AREAS",a,r);const c=Xge(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?or(d,c[d][0]):or(d,c[d])}),x.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function E9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Gh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?E9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):E9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let kM=1;function Qge(t,r,s,a,c){kM+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:kM,requestId:kM,version:$l,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,y,v=t[0];return Fd(async()=>{m=Date.now();const T=await Hd(v,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,T.code!==0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+T.code,{retry:!0,responseTime:y});throw x.error(D.toString()),D}const R=JSON.parse(T.json_body);if(R.code!==200){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(D.toString()),D}const P=function(D,G){return{addressList:D.servers.map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(ae("WORKER_DOMAIN"),":").concat(F.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:D.workerToken,vid:D.vid}}(R,r);return ae("LIVE_STREAMING_ADDRESS")&&(P.addressList=ae("LIVE_STREAMING_ADDRESS")instanceof Array?ae("LIVE_STREAMING_ADDRESS"):[ae("LIVE_STREAMING_ADDRESS")]),Gh(Gh({},P),{},{responseTime:y})},(T,R)=>(Ot.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(T.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(T,R)=>(Ot.apworkerEvent(s.sid,{success:!1,sc:T.data&&T.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(T.code!==te.OPERATION_ABORTED&&T.code!==te.UNEXPECTED_RESPONSE||T.data&&T.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let NM=1;function v9(t,r,s,a){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const T=r.role,[R,P]=xM(r,d,[bi.CHOOSE_SERVER]);let D=Si.networkState;return Fd(async()=>{D&&Si.networkState===Ac.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,bs(a&&a.maxRetryTimeout||Li.maxRetryTimeout)]),D=Si.networkState;const{data:G,headers:F}=await Hd(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=F.http3==="1"?1:-1,Ot.reportResourceTiming(c,m),b9(G,c,r,y,[bi.CHOOSE_SERVER],v);const W=qT(G,bi.CHOOSE_SERVER);return DM(W),bM(W,c)},G=>(G&&Ot.joinChooseServer(m,{role:T,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(F=>F.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Ot.joinChooseServer(m,{role:T,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),a)}function S9(t,r,s,a){let c,{url:d,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[T,R]=xM(r,h,m);let P;return Fd(async()=>{P&&Si.networkState===Ac.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,bs(a&&a.maxRetryTimeout||Li.maxRetryTimeout)]),P=Si.networkState;const{data:D,headers:G}=await Hd(d,{data:T,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Ot.reportResourceTiming(d,r.sid),b9(D,d,r,y,m,c);const F=qT(D,bi.CHOOSE_SERVER),W=qT(D,r.cloudProxyServer==="proxy5"?bi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK);return DM(F),{gatewayInfo:bM(F,d),proxyInfo:W,url:d}},D=>(D.gatewayInfo&&Ot.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:d,serverList:D.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&Ot.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:d,turnServerAddrList:D.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),D=>D.code!==te.OPERATION_ABORTED&&(D.code===te.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(Ot.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:D.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),D),!0)),a)}const b9=(t,r,s,a,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],T=R=>{R.flag===4096?Ot.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Ot.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(D),T(D)}if(P!==0){const D=gS(P),G={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),T(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},DM=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(ae("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?y9(t.detail[23].toLowerCase()):y9()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var d;const v=bo(d=m[y]).call(d);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(ae("GATEWAY_ADDRESS")&&ae("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",ae("GATEWAY_ADDRESS"));const h=ae("GATEWAY_ADDRESS").map(m=>{var y,v;const T=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:T}});t.addresses=h}},Zge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=gS(s.buffer.code);throw new Ae(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Ae(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},xM=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Gh(Gh(Gh({6:t.stringUid,11:r,12:ae("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},e_e=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let vS=0;function SS(t){return pt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const ZT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let y,v=0;const T=async()=>{const R=(()=>{const P=h*m,D=P+m;return s.slice(P,D).map(a)})();d&&d.push(...R);try{y=await SS(R)}catch(P){if(v+=m,h++,!(v>=s.length))return void await T();c(P)}R.forEach(P=>P.cancel())};return await T(),y},T9=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(d++,d>=c||a!=null&&a(y))throw y;return h()}};return h()};async function LM(t,r,s,a){return{gatewayInfo:await async function(d,h,m,y){let v=null;const T=[],R=async()=>{const D=ae("WEBCS_DOMAIN").slice(0,ae("AJAX_REQUEST_CONCURRENT")).map(W=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:QT()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),F=await ZT({fragementLength:ae("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(d.clientId,"] Connect to choose_server:"),W.url),v9(W,d,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:T});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},P=async()=>{if(await bs(1e3),v!==null)return v;const D=ae("WEBCS_DOMAIN_BACKUP_LIST").map(W=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:QT()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),F=await ZT({fragementLength:ae("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),W.url),v9(W,d,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:T});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};try{return v=await SS([R(),P()]),T.length&&T.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),v}catch(D){throw D[0]}}(t,r,s,a)}}async function w9(t,r,s,a,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await LM(t,r,s,c);if(ae("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:D}=await I9(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=D.map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Bs.tcpport,udpport:F.udpport||Bs.udpport,username:F.username||Bs.username,password:F.password||Bs.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const F=(h=t.uid)!==null&&h!==void 0?h:P.uid,W="glb:".concat(F.toString()),Q=await AL(W),ee=D.map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||Bs.tcpport,udpport:fe.udpport||Bs.udpport,username:W,password:Q,forceturn:!1,security:!0}));G.push(...ee)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await LM(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await I9(t,r,s,c),v={gatewayInfo:y},T=m.map(P=>({turnServerURL:P.address,tcpport:d==="proxy3"?void 0:P.tcpport?P.tcpport:Bs.tcpport,udpport:d==="proxy4"?void 0:P.udpport?P.udpport:Bs.udpport,username:P.username||Bs.username,password:P.password||Bs.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:y.uid,D="glb:".concat(P.toString()),G=await AL(D),F=m.map(W=>({turnServerURL:W.address,tcpport:d==="proxy3"?void 0:W.tcpport||Bs.tcpport,udpport:d==="proxy4"?void 0:W.udpport||Bs.udpport,username:D,password:G,forceturn:d!=="proxy4",security:d==="proxy5"}));T.push(...F)}return t.turnServer={mode:"manual",servers:T},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),v}async function C9(t,r,s,a,c){const d=ae("ACCOUNT_REGISTER").slice(0,ae("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):d.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,T,R,P,D){const G=Date.now(),F={sid:R.sid,opid:10,appid:R.appId,string_uid:T};let W=v[0];const Q=await Fd(()=>Hd(W+"".concat(W.indexOf("?")===-1?"?":"&","action=stringuid"),{data:F,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,fe)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(T," => ").concat(ee.uid),ee),Ot.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:W,stringUid:F.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:F}),new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return Ot.reqUserAccount(F.sid,{lts:G,success:!0,serverAddr:W,stringUid:F.string_uid,uid:ee.uid,errorCode:null,extend:F}),!1}const ye=gS(ee.code);return ye.retry&&(W=v[(fe+1)%v.length]),Ot.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:W,stringUid:F.string_uid,uid:ee.uid,errorCode:ye.desc,extend:F}),ye.retry},(ee,fe)=>ee.code!==te.OPERATION_ABORTED&&(Ot.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:W,stringUid:F.string_uid,uid:null,errorCode:ee.code,extend:F}),W=v[(fe+1)%v.length],!0),D);if(Q.code!==0){const ee=gS(Q.code);throw new Ae(te.UNEXPECTED_RESPONSE,ee.desc)}return Q}(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function t_e(t,r,s){const a=ae("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await T9({referenceList:c,asyncMapHandler:h=>async function(m,y,v,T){const R=Date.now(),P={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const D=await Hd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const G=gS(D.code);throw new Ae(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function n_e(t,r,s){const a=ae("CDS_AP").slice(0,ae("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=a.map(y=>function(v,T,R,P){const D=Ln(),G={flag:64,cipher_method:0,features:Gh(Gh(Gh(Gh(Gh({install_id:jL(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:T.appId,version:$l,cname:T.cname,session_id:T.sid,proxyServer:T.proxyServer,sdk_type:Kge.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:T.cname},T.stringUid&&{string_uid:T.stringUid}),T.uid&&{uid:T.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return Fd(()=>Hd(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,F=>F.code!==te.OPERATION_ABORTED,P)}(y,t,r,s));let d=null,h=null,m={};try{d=await SS(c)}catch(y){if(y.code===te.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),Ot.reportApiInvoke(t.sid,{name:xi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,T=Object.keys(v),R={};return T.forEach(P=>{var D;const G=bo(D=P.slice(4)).call(D),F=JSON.parse(v[P]),W=F[1];R[G]={tag:F[0]||"",value:W}}),R}(d)}catch{}return m}async function R9(t,r){const s=ae("WEBCS_DOMAIN").concat(ae("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:QT(),serviceIds:[bi.CHOOSE_SERVER,bi.CLOUD_PROXY_FALLBACK]}));try{return await T9({referenceList:s,asyncMapHandler:c=>async function(d,h,m){let y,{url:v,areaCode:T,serviceIds:R}=d;const P=Date.now(),[D,G]=xM(h,T,R);let F=Si.networkState;try{F&&Si.networkState===Ac.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,bs(Li.maxRetryTimeout)]),F=Si.networkState;const{data:W,headers:Q}=await Hd(v,{data:D,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=Q.http3==="1"?1:-1,(ve=>{const _e=[];if(ve.response_body.forEach(Ne=>{const Je=Ne.buffer.code;if(Ne.uri===23&&Je===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const ft={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ve.detail[502]}),flag:Ne.buffer.flag};_e.push(ft)}if(Je!==0){const ft=gS(Je),yt={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,ft.desc,{desc:ft.desc,retry:ft.retry,csIp:ve.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(yt.error.toString()):_e.push(yt)}}),_e.length)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,_e.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!_e.find(Ne=>Ne.error.data.retry),csIp:ve.detail[502],desc:[...new Set(_e.map(Ne=>{var Je;return Ne==null||(Je=Ne.error)===null||Je===void 0||(Je=Je.data)===null||Je===void 0?void 0:Je.desc}).filter(Ne=>!!Ne))]})})(W);const fe=qT(W,bi.CHOOSE_SERVER),ye=qT(W,bi.CLOUD_PROXY_FALLBACK);return DM(fe),{gatewayInfo:bM(fe,v),proxyInfo:ye,opid:G,requestTime:P,url:v,isHttp3:y,elapse:Date.now()-P}}catch(W){throw W}}(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function I9(t,r,s,a){const c=ae("PROXY_SERVER_TYPE3"),d=(D,G,F)=>{let W=F||c;return Array.isArray(W)&&(W=G%2==0?c[1]:c[0]),"https://".concat(W,"/ap/?url=").concat(D)};let h=null;const m=[],y=async()=>{const D=ae("WEBCS_DOMAIN").slice(0,ae("AJAX_REQUEST_CONCURRENT")).map((W,Q)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q),{url:ee,areaCode:QT(),serviceIds:[bi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?bi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),F=await ZT({fragementLength:ae("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),W.url),S9(W,t,r,s)),allFailedhandler:W=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},v=async()=>{if(await bs(1e3),h!==null)return h;const D=ae("WEBCS_DOMAIN_BACKUP_LIST").map((W,Q)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q),{url:ee,areaCode:QT(),serviceIds:[bi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?bi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),F=await ZT({fragementLength:ae("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),W.url),S9(W,t,r,s)),allFailedhandler:W=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};let T,R,P;try{({gatewayInfo:T,proxyInfo:R,url:P}=await SS([y(),v()]))}catch(D){throw D[0]}if(m.length&&m.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!T||!R)throw new Ae(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];at(c).call(c,D)&&(t.proxyServer=D,x.setProxyServer(D),Ot.setProxyServer(D))}return h={gatewayInfo:T,proxyInfo:await JH(R,T.uid)},h}async function r_e(t,r,s){const a=ae("UAP_AP").slice(0,ae("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,m,y,v){const T={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:$l,cname:m.cname,uid:m.uid.toString(),requestId:NM,seq:NM};NM+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(T)};return Fd(async()=>{const P=await Hd(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const D=JSON.parse(P.json_body);if(D.code!==200){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(G.toString()),G}if(!D.servers||D.servers.length===0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:D.vid,workerToken:D.workerToken,addressList:(ae("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(ae("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),v)}(d,t,r,s));try{const d=await SS(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function i_e(t,r,s){let a=null;const c=[],d=async h=>{const m=ae(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await bs(1e3),a!==null)?a:await ZT({fragementLength:ae("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,T,R,P){const[D]=e_e(T,[bi.CHOOSE_SERVER]);let G=Si.networkState;return Fd(async()=>{G&&Si.networkState===Ac.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,bs(P&&P.maxRetryTimeout||Li.maxRetryTimeout)]),G=Si.networkState;const F=await Hd(v,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Zge(F,v)},()=>!1,F=>F.code!==te.OPERATION_ABORTED&&(F.code===te.UPDATE_TICKET_FAILED?F.data.retry:(x.warning("[".concat(T.clientId,"] update ticket network error, retry"),F),!0)),P)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return a=await SS([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function A9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function MM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?A9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):A9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class s_e extends Gr{get isSuccess(){return!!this.configs}constructor(r,s){super(),q(this,"configs",void 0),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"cancelToken",void 0),q(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),q(this,"interval",void 0),q(this,"mutex",void 0),q(this,"mutableParamsRead",!1),q(this,"configCache",{}),q(this,"limit_bitrate",void 0),this.mutex=new Ys("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),ae("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},ae("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ot.reportApiInvoke(null,{options:void 0,name:xi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Xr.TRACER}).onSuccess(JSON.stringify(Bd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await n_e(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=function(c){var d;const h=vT(d=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(d);for(let v=0;v<h.length;v++)for(let T=h.length-1;T>v;T--){const R=h[T],P=c[R].value;if(typeof P.__priority=="number"){const D=P.__priority,G=h[T-1],F=c[G].value;if(typeof F.__priority=="number"){if(!(D>F.__priority))continue;{const W=R;h[T]=h[T-1],h[T-1]=W}}else{const W=R;h[T]=h[T-1],h[T-1]=W}}}const m=Date.now();let y={};return h.forEach(v=>{const T=c[v].value.__expires;T&&T<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Ae(te.NETWORK_RESPONSE_ERROR,a);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){jH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(HT.UPDATE_BITRATE_LIMIT,r):this.emit(HT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&MM({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach(d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const y=h.__type,v=r[d].value,T=r[d].tag;let R=0;y?y===f8.REALTIME&&(R=1):Object.keys(v).some(P=>Object.prototype.hasOwnProperty.call(zL,P)||!hM()&&Object.prototype.hasOwnProperty.call(pP,P)?(R=1,!0):void 0),c.push({tag:T,isApplied:R,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:m,params:y,isApplied:v}=d;this.store.sessionId&&Ot.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const d={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(T=>{T==="__id"||T==="__type"||T==="__priority"||T==="__expires"||Object.prototype.hasOwnProperty.call(d,T)||(d[T]=MM(MM({value:m[T]},y&&{expires:y}),v&&{type:v}))})}),d}(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&jH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:T,type:R,expires:P}=m[v];P&&P<=y||((R===f8.REALTIME||Object.prototype.hasOwnProperty.call(zL,v))&&(Bd[v]=T,Ar[v]=T,x.debug("Update realtime parameters from config distribute",v,T)),R||hM()||!Object.prototype.hasOwnProperty.call(pP,v)||(Bd[v]=T,Ar[v]=T,x.debug("Update gateway parameters from config distribute",v,T)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(d))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ar,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Ar[a],c)||(Bd[a]=c,Ar[a]=c,this.emit(HT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class o_e extends Gr{constructor(){super(...arguments),q(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(ae("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(a),c.result.length>=5)){var d;const h=at(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",P9[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",P9[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof zi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=Pc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof zi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const P9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Qs=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function O9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function cy(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?O9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):O9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class ew{constructor(r){q(this,"store",void 0),q(this,"onStatsException",void 0),q(this,"onUploadPublishDuration",void 0),q(this,"onStatsChanged",void 0),q(this,"localStats",new Map),q(this,"remoteStats",new Map),q(this,"updateStatsInterval",void 0),q(this,"trafficStats",void 0),q(this,"trafficStatsPeerList",[]),q(this,"uplinkStats",void 0),q(this,"exceptionMonitor",void 0),q(this,"p2pChannel",void 0),q(this,"scalabilityMode",hP.L1T1),q(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new o_e,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ye.LocalAudioTrack)||cy({},qL)}getLocalVideoTrackStats(){return this.localStats.get(Ye.LocalVideoTrack)||cy({},YL)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRTCStats(){let r=0,s=0,a=0,c=0;const d=this.localStats.get(Ye.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(Ye.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Ye.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:T,videoStats:R}=v;T&&(a+=T.receiveBytes,c+=T.receiveBitrate),R&&(a+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?Qs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Qs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Ye.LocalVideoTrack:case Ye.LocalVideoLowTrack:{const h=c,m=cy({},YL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const T=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ye.LocalVideoTrack);T.codec!=="H264"&&T.codec!=="H265"&&T.codec!=="VP8"&&T.codec!=="VP9"&&T.codec!=="AV1X"&&T.codec!=="AV1"||(m.codecType=T.codec),m.sendBytes=T.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,T.inputFrame?(m.captureFrameRate=T.inputFrame.frameRate,m.captureResolutionHeight=T.inputFrame.height,m.captureResolutionWidth=T.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),T.sentFrame?(m.sendFrameRate=T.sentFrame.frameRate,m.sendResolutionHeight=T.sentFrame.height,m.sendResolutionWidth=T.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),T.avgEncodeMs&&(m.encodeDelay=T.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(m.totalFreezeTime+=1),T.scalabilityMode&&this.scalabilityMode!==T.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(T.scalabilityMode)),this.scalabilityMode=T.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Ye.LocalAudioTrack:{const h=c,m=cy({},qL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const T=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){if(T.codec!=="opus"&&T.codec!=="aac"&&T.codec!=="PCMU"&&T.codec!=="PCMA"&&T.codec!=="G722"||(m.codecType=T.codec),T.inputLevel)m.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=T.bytes,m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ye.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[d,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,T=h,R=y,P=cy({},C8),D=cy({},R8),G=cy({},Gme),{audioTrack:F,videoTrack:W,audioSSRC:Q,videoSSRC:ee}=r.getRemoteMedia(d);let fe;fe=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(a=fe)===null||a===void 0?void 0:a.audioRecv.find(Je=>Je.ssrc===Q),ve=(c=fe)===null||c===void 0?void 0:c.videoRecv.find(Je=>Je.ssrc===ee),_e=this.trafficStats&&this.trafficStats.peer_delay.find(Je=>Je.peer_uid===d);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(P.codecType=ye.codec),ye.outputLevel?P.receiveLevel=Math.round(32767*ye.outputLevel):F&&(P.receiveLevel=Math.round(32767*F.getVolumeLevel())),P.receiveBytes=ye.bytes,P.receivePackets=ye.packets,P.receivePacketsLost=ye.packetsLost,P.receivePacketsDiscarded=ye.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=v?8*Math.max(0,P.receiveBytes-v.receiveBytes):0,P.totalDuration=v?v.totalDuration+1:1,P.totalFreezeTime=v?v.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ye.jitterBufferMs,P.totalDuration>10&&ew.isRemoteAudioFreeze(F)&&(P.totalFreezeTime+=1)),ve){var Ne;ve.codec!=="H264"&&ve.codec!=="H265"&&ve.codec!=="VP8"&&ve.codec!=="VP9"&&ve.codec!=="AV1X"&&ve.codec!=="AV1"||(D.codecType=ve.codec),D.receiveBytes=ve.bytes,D.receiveBitrate=T?8*Math.max(0,D.receiveBytes-T.receiveBytes):0,D.decodeFrameRate=ve.decodeFrameRate<0?0:ve.decodeFrameRate,D.renderFrameRate=ve.decodeFrameRate<0?0:ve.decodeFrameRate,ve.outputFrame&&(D.renderFrameRate=ve.outputFrame.frameRate),ve.receivedFrame?(D.receiveFrameRate=ve.receivedFrame.frameRate,D.receiveResolutionHeight=ve.receivedFrame.height,D.receiveResolutionWidth=ve.receivedFrame.width):W&&(D.receiveResolutionHeight=W._videoHeight||0,D.receiveResolutionWidth=W._videoWidth||0),ve.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(ve.framesRateFirefox)),D.receivePackets=ve.packets,D.receivePacketsLost=ve.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Je=T?T.totalFreezeTime:0,ft=T?T.totalDuration:0;D.totalDuration=T?T.totalDuration+1:1,D.totalFreezeTime=(Ne=ve.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Je||0,D.receiveDelay=ve.jitterBufferMs||0;const yt=!!ee&&r.getRemoteVideoIsReady(ee);ve.totalFreezesDuration===void 0&&W&&yt&&ew.isRemoteVideoFreeze(W,ve,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Je)/(D.totalDuration-ft),1))}_e&&(P.end2EndDelay=_e.B_ad,D.end2EndDelay=_e.B_vd,P.transportDelay=_e.B_ed,D.transportDelay=_e.B_ed,P.currentPacketLossRate=_e.B_ealr4/100,D.currentPacketLossRate=_e.B_evlr4/100,G.uplinkNetworkQuality=_e.B_punq?_e.B_punq:0,G.downlinkNetworkQuality=_e.B_pdnq?_e.B_pdnq:0),this.remoteStats.set(d,{audioStats:P,videoStats:D,videoPcStats:ve,networkStats:G}),F&&this.exceptionMonitor.setRemoteAudioStats(F,P),W&&this.exceptionMonitor.setRemoteVideoStats(W,D)})}}class k9{constructor(){q(this,"destChannelMediaInfos",new Map),q(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){UH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){UH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){NP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function N9(t){if(!(t instanceof k9))return new Ae(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Ae(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Ae(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class og{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){q(this,"uid",void 0),q(this,"_uintid",void 0),q(this,"_trust_in_room_",!0),q(this,"_trust_audio_enabled_state_",!0),q(this,"_trust_video_enabled_state_",!0),q(this,"_trust_audio_mute_state_",!0),q(this,"_trust_video_mute_state_",!0),q(this,"_audio_muted_",!1),q(this,"_video_muted_",!1),q(this,"_audio_enabled_",!0),q(this,"_video_enabled_",!0),q(this,"_audio_added_",!1),q(this,"_video_added_",!1),q(this,"_is_pre_created",!1),q(this,"_video_pre_subscribed",!1),q(this,"_audio_pre_subscribed",!1),q(this,"_trust_video_stream_added_state_",!0),q(this,"_trust_audio_stream_added_state_",!0),q(this,"_audioTrack",void 0),q(this,"_videoTrack",void 0),q(this,"_dataChannels",[]),q(this,"_audioSSRC",void 0),q(this,"_videoSSRC",void 0),q(this,"_audioOrtc",void 0),q(this,"_videoOrtc",void 0),q(this,"_cname",void 0),q(this,"_rtxSsrcId",void 0),q(this,"_videoMid",void 0),q(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function D9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function x9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?D9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):D9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const tw="9",L9=4e4;function M9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Tf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?M9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var bS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(bS||{});const $P=new Map;function U9(t,r,s,a){let{scale:c}=t;if(c===0&&a===bS.UP||c>=r.length-1&&a===bS.DOWN)return t;let d=Tf(Tf({},t),{},{scale:a===bS.DOWN?++c:--c});switch(s){case"maintain-framerate":d=Tf(Tf({},d),r[c].motion);break;case"maintain-resolution":d=Tf(Tf({},d),r[c].detail);break;case"balanced":d=Tf(Tf({},d),r[c].balanced)}return d}function V9(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:j9(r)};$P.set(t,s)}else $P.delete(t)}function j9(t){const r=Tf({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:T,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:F,BALANCE_FRAMERATE_FACTOR:W,BALANCE_RESOLUTION_FACTOR:Q,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:fe,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:ve}=BL,_e=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(D,1)*_e),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let Je=1;Je<=y;Je++){const ft={bwe_up:Math.round(Math.pow(R,Je)*s),bwe_down:Math.round(Math.pow(P,Je+1)*s),fps_up:Math.round(Math.pow(G,Je)*_e),fps_down:Math.round(Math.pow(D,Je+1)*_e)},yt={scaleResolutionDownBy:c/Math.pow(Q,Je),frameRate:Math.max(Math.round(Math.pow(W,Je)*a),h),bitrateMax:Math.max(Math.round(Math.pow(F,Je)*s),T),bitrateMin:Math.max(Math.round(Math.pow(F,Je)*d),v)},An={scaleResolutionDownBy:c/Math.pow(ee,Je),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(fe,Je)*s),T),bitrateMin:Math.max(Math.round(Math.pow(fe,Je)*d),v)},Pn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Je)*a),h),bitrateMax:Math.max(Math.round(Math.pow(ve,Je)*s),T),bitrateMin:Math.max(Math.round(Math.pow(ve,Je)*d),v)};Ne.push({scale:Je,threshold:ft,balanced:yt,motion:An,detail:Pn})}return Ne}function a_e(t,r,s,a,c,d){const h=$P.get(t)||{overUse:0,underUse:0,adaptationList:j9(c)},{adaptationList:m}=h;$P.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=BL,{scale:T}=a;let R,P;return typeof r=="number"&&r>0&&function(D,G,F,W){if(G>=F.length)return!1;let{threshold:{fps_down:Q}}=F[G];return ae("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Q=F[0].threshold.fps_down),D<Q}(r,T,m,d)&&(h.overUse++,P=jT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(D,G,F){if(G>=F.length)return!1;const{threshold:{bwe_down:W}}=F[G];return D<W}(s,T,m)&&(h.overUse++,P=jT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=U9(a,m,d,bS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(D,G,F,W){if(G===0)return;let{threshold:{fps_up:Q}}=F[G];return ae("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Q=F[1].threshold.fps_up),D>Q}(r,T,m,d)&&function(D,G,F){if(G===0)return;const{threshold:{bwe_up:W}}=F[G];return D>W}(s,T,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=U9(a,m,d,bS.UP),R.scale===0&&(P=jT.NONE))),[R,P])}function F9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function UM(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?F9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):F9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function c_e(t){var r;return!!ae("ENABLE_AG_ADAPTATION")&&!!(t instanceof iM||at(r=t._hints).call(r,Er.CUSTOM_TRACK))&&(!!ae("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const a=Ln();if(a.os!==Zi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])>=s}(14)&&Mz(17,4)||Lz(14)&&Uz(17,4,!0)))}const KP=new Map;function qP(t,r){const s=KP.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),KP.delete(t)}r.qualityLimitationReason=jT.NONE,V9(t)}function l_e(t,r){var s;let a;switch(r){case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoTrack:a=at(s=t._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return a}function VM(t){const r=Bn();if(t.some(s=>s._bypassWebAudio))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function jM(t,r){VM(t);const s=new zi;return t.forEach(a=>s.addAudioTrack(a)),s}const u_e=!Bn().supportUnifiedPlan||ae("CHROME_FORCE_PLAN_B")&&pf();function YP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return u_e?(s={spec:r,store:t},Sf("PlanBConnection").create(s)):new Hh(r,t)}function FM(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function B9(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(MT(t.turnServer.servers))return!1;if(ae("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var kn;function W9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function $d(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?W9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):W9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Hh=(kn=class Py extends BH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return at(s=Object.keys(fP)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"id",yr(5,"connection-")),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"forceTurn",!1),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"transportEventReceiver",void 0),q(this,"statsFilter",void 0),q(this,"extension",{useXR:ae("USE_XR")}),q(this,"localCapabilities",void 0),q(this,"remoteCodecs",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"isPreallocation",!1),q(this,"preSSRCMap",new Map),q(this,"dataStreamChannelMap",new Map),q(this,"establishPromise",void 0),q(this,"recoveredDataChannelIds",[]),q(this,"currentDataChannelId",1),q(this,"supportAV1RtpSpec",!1),q(this,"mutex",void 0),q(this,"qualityLimitationReason",jT.NONE),q(this,"isFirstConnected",!1),this.store=s,this.forceTurn=B9(r),this.mutex=new Ys("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Py.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=VL(this.peerConnection,ae("STATS_UPDATE_INTERVAL"),void 0,qr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(a)return{transceiver:a,track:a.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=ig(a.sdp),d=await a9({filterRTX:!ae("USE_PUB_RTX")&&!ae("USE_SUB_RTX"),filterVideoFec:ae("FILTER_VIDEO_FEC"),filterAudioFec:ae("FILTER_AUDIO_FEC"),filterVideoCodec:ae("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=BP(d),this.initialOffer=a,ae("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:hP.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const T=ec(v.sdp).mediaDescriptions[0];if(!T)return;const R=T.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&d9(a.sdp)&&(h=Jr(d),(s=h).send&&(_S(Tt.VIDEO,s.send.videoExtensions),_S(Tt.AUDIO,s.send.audioExtensions)),s.recv&&(_S(Tt.VIDEO,s.recv.videoExtensions),_S(Tt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(_S(Tt.VIDEO,s.sendrecv.videoExtensions),_S(Tt.AUDIO,s.sendrecv.audioExtensions))),$d($d({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&d9(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(VP(Tt.VIDEO,s.send.videoExtensions,a.send.videoExtensions),VP(Tt.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(VP(Tt.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),VP(Tt.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Jr(this._localCapabilities)}get rtpCapabilities(){return Jr(this._rtpCapabilities)}get candidates(){return Jr(this._candidates)}get iceParameters(){return Jr(this._iceParameters)}get dtlsParameters(){return Jr(this._dtlsParameters)}constructor(v){let T=arguments.length>1&&arguments[1]!==void 0&&arguments[1];q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_originCandidates",void 0),q(this,"_iceParameters",void 0),q(this,"_isUseExtmapAllowMixed",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),q(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=T,v=Jr(v);const{iceParameters:R,dtlsParameters:P,candidates:D,rtpCapabilities:G,setup:F,localCapabilities:W,cname:Q}=v;this._rtpCapabilities=G,this._candidates=D,this._originCandidates=Jr(D),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=W,this.setup=F,this.cname=Q,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const T=this.candidates,R=this.dtlsParameters,P=this.iceParameters,D=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let F=1;F<v;F++){const W=2*F+2e4,Q=2*F+L9,{ssrcs:ee,ssrcGroups:fe}=ay([{ssrcId:W}],this.cname),{ssrcs:ye,ssrcGroups:ve}=ay([{ssrcId:Q,rtx:ae("USE_SUB_RTX")?Q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:tw,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:T,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:ve,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:tw,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:T,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:fe,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Zm(this.sessionDesc)}send(v,T,R,P){const{ssrcs:D,ssrcGroups:G}=ay(T,this.cname,ae("SYNC_GROUP")?R:void 0),F=this.findPreloadMediaDesc(D);if(F){if(qr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,F.attributes.mid),P&&(P.twcc||P.remb)){const W=this.sessionDesc.mediaDescriptions.indexOf(F);return this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(F,P),{mid:F.attributes.mid,needExchangeSDP:!0}}return{mid:F.attributes.mid,needExchangeSDP:!1}}{const W=this.findAvailableMediaIndex(v,D);let Q;return W===-1||W===1&&(Vs()||function(){const ee=Ln();return!(ee.name!==Kn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||ae("ENABLE_ENCODED_TRANSFORM")&&hf())||W===0&&ae("USE_SUB_RTX")||Vz()?(Q=this.createOrRecycleSendMedia(v,D,G,"sendonly",P),this.updateBundleMids()):(Q=Jr(this.sessionDesc.mediaDescriptions[W]),Q.attributes.direction="sendonly",Q.attributes.ssrcs=D,Q.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(Q,P)),qr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,Q.attributes.mid),{mid:Q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:T}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:T}}batchSend(v){const T=v.map(D=>{let{kind:G,ssrcMsg:F,mslabel:W}=D;return this.send(G,F,W)}),R=[];let P=!1;return T.forEach(D=>{let{mid:G,needExchangeSDP:F}=D;F&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");T.forEach(R=>{R.attributes.mid==="0"||qr()||Vz()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!T)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));T.attributes.direction="inactive"}unmute(v){const T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!T)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));T.attributes.direction="sendonly"}muteRemote(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>at(v).call(v,R.attributes.mid||""));if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>at(v).call(v,R.attributes.mid||""));if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,T,R,P){v.forEach((D,G)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",T,R,P[G])}),this.updateBundleMids()}stopReceiving(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(T.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");T.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const T=this.sessionDesc||ec((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const P=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const G of T.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const F=D.videoCodecs.filter(W=>{var Q,ee;return(Q=W.rtpMap)===null||Q===void 0?void 0:at(ee=Q.encodingName.toLowerCase()).call(ee,"vp8")})||[D.videoCodecs[0]];G.media.fmts=F.map(W=>W.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,ae("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:W}=ay([{ssrcId:L9,rtx:ae("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=W}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const F=D.audioCodecs.filter(W=>{var Q,ee;return(Q=W.rtpMap)===null||Q===void 0?void 0:at(ee=Q.encodingName.toLowerCase()).call(ee,"opus")})||[D.audioCodecs[0]];G.media.fmts=F.map(W=>W.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,ES(G),ae("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:W}=ay([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=W}}}return this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const T=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(T.forEach(P=>{R.push(x9(x9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),T.length!==0){switch(v){case Js.TCP_RELAY:this._candidates=R;break;case Js.UDP_TCP_RELAY:case Js.RELAY:this._candidates=[...T,...R];break;default:this._candidates=T}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(v){v=Jr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.iceUfrag=v.iceUfrag,T.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const T=[];for(let R=0;R<v;R++)T.push((this.currentMidIndex+R+1).toString(10));return T}findAvailableMediaIndex(v,T){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(qr()){if(P){const D=this.firefoxSsrcMidMap.get(T[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),T={media:{mediaType:"application",port:tw,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(T),{mediaDesc:T,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,T,R,P,D,G){const F=v._mediaStreamTrack.kind,W=this.rtpCapabilities.recv,Q=XT(F,W,this.localCapabilities.send,F===Tt.VIDEO?P:D),ee=F===Tt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const fe="".concat(this.currentMidIndex);let ye={media:{mediaType:F,port:tw,protos:["UDP","TLS","RTP","SAVPF"],fmts:Q.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(fe)}};ye=this.mungRecvMediaDsec(ye,v,G);const ve=this.findFirstClosedMedia(F);if(ve){const _e=this.sessionDesc.mediaDescriptions.indexOf(ve);this.sessionDesc.mediaDescriptions[_e]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(v,T,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var ve;return at(ve=Object.keys(fP)).call(ve,ye)}))],D=new Set(T);if(P.every(ye=>D.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(T)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(ye=>T.some(ve=>{var _e;return at(_e=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(_e,ve)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(T)),!1;const F=[...new Set(G.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let W;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(F)),v.length===0)W=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(W=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&at(v).call(v,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),W.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(T)),!1;if(ae("USE_PUB_RTX")||ae("USE_SUB_RTX")){const ye=RM(G,this.rtpCapabilities.recv.videoCodecs);G.push(...ye)}this._rtpCapabilities.recv.videoCodecs=G;const Q=this.localCapabilities.send,ee=this.rtpCapabilities.recv,fe=XT(Tt.VIDEO,ee,Q,R);return W.forEach(ye=>{const ve=fe.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",fe),ye.attributes.payloads=fe,ye.media.fmts=ve}),!0}createOrRecycleSendMedia(v,T,R,P,D){const G=this.rtpCapabilities.send,F=v===Tt.VIDEO?G.videoCodecs:G.audioCodecs,W=v===Tt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let ee={media:{mediaType:v,port:tw,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:W,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};ee=this.mungSendMediaDesc(ee,D);const fe=this.findFirstClosedMedia(v);if(fe){const ye=this.sessionDesc.mediaDescriptions.indexOf(fe);this.sessionDesc.mediaDescriptions[ye]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,T,R){const P=Jr(v);return wM(P),yS(P,T),CM(P,T),s9(P),FP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(v,T){const R=Jr(v);return FP(R,T,this.localCapabilities.recv),ES(R),R}updateRecvMedia(v,T){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===v);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],T);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(T=>qr()?T.media.port==="0"&&T.media.mediaType===v:T.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(T=>{var R;return((R=T.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var T;return(T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||T===void 0?void 0:T.attributes.ssrcs}}($d($d({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=l9(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),ae("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(ae("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const T=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(T)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(T=>({kind:T.kind,ssrcMsg:[{ssrcId:T.ssrcId,rtx:T.rtx}],mslabel:T.mslabel})));v.forEach((T,R)=>{this.preSSRCMap.set(y[R].ssrcId,T)}),await JT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:a}=r;if(Array.isArray(a)&&a.length>0){const{mids:c}=this.remoteSDP.batchSend(a.map(d=>Object.assign({},{kind:d.kind,ssrcMsg:[{ssrcId:d.ssrcId,rtx:d.rtx}],mslabel:d.mslabel})));c.forEach((d,h)=>{this.preSSRCMap.set(a[h].ssrcId,d)})}await JT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Hl(function*(){const d=yield xn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=UP();r.forEach(W=>{const Q=c.peerConnection.addTransceiver(W._mediaStreamTrack,$d({direction:"sendonly"},W.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Q),W._updateRtpTransceiver(Q)}),qr()&&ae("SIMULCAST")===!0&&(yield xn(c.applySimulcastForFirefox(h,r)));const y=yield xn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),T=c.mungSendOfferSDP(y.sdp,r,v),R=ec(T),P=v.map(W=>{const Q=R.mediaDescriptions.find(ee=>ee.attributes.mid===W);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return n9(Q,ae("USE_PUB_RTX"))});let D;try{D=yield P}catch(W){D=[],c.remoteSDP.receive(r,s,a,D);const Q=c.remoteSDP.toString();throw yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield xn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),yield xn(c.stopSending(v,!0)),W}c.remoteSDP.receive(r,s,a,D);const G=c.remoteSDP.toString(),F=c.logSDPExchange(T,"offer","local","send");return yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield xn(c.applySimulcastEncodings(h,r)),yield xn(c.applySendEncodings(h,r)),F==null||F(G),yield xn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Q)=>{const ee=v[Q];return{localSSRC:P[Q],id:ee,transceiver:W}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:ae("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;qP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await JT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await JT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===d)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Hl(function*(){const a=yield xn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Bn().supportPCSetConfiguration,d=ae("FORCE_TURN_TCP")||s.forceTurn;if(r===Js.RELAY&&!c)return;if(c&&!d){const R=r===Js.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield xn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=ig(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),T=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield xn(s.peerConnection.setLocalDescription(h)),T==null||T(v),yield xn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Js.TCP_RELAY),await JT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{qP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return $d($d({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?qr()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:$d($d({},jh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:$d($d({},jh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ae("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(MT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:ae("NEW_TURN_MODE")&&s.iceServers?(ae("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Py.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Py.newTurnServerConfigToIceServers(r.turnServer.servers)),ae("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Py.turnServerConfigToIceServers(r.turnServer.servers)),ae("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Py.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),ae("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),ae("ENABLE_ENCODED_TRANSFORM")&&Bn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(ng(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!ae("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{const c=ae("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(ng(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(ng(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(W=>W.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(F,W){return F.getTransceivers().find(Q=>Q.sender.track===W||Q.receiver.track===W)}(this.peerConnection,r._mediaStreamTrack),y=Yme(r);if(c_e(r)&&m&&s&&y&&this.getLocalVideoStats&&at(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const F=d.degradationPreference||(at(v=r._hints).call(v,Er.CUSTOM_TRACK)?ae("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(W,Q,ee,fe,ye,ve){if(qP(W,ee),ye(Q),fe!=="balanced"&&fe!=="maintain-framerate"&&fe!=="maintain-resolution")return;let _e=-1;V9(W,Q);const Ne=window.setInterval(()=>{const ft=KP.get(W);if(!ae("ENABLE_AG_ADAPTATION")||!ft)return qP(W,ee),void ye(Q);const yt=ve();if(yt.sendPackets>0&&yt.OutgoingAvailableBandwidth>0){if(_e===-1)return void(_e=Date.now());if(Date.now()-_e<1e3)return;const An=yt.sendFrameRate,Pn=yt.OutgoingAvailableBandwidth,[vr,fi]=a_e(W,An,Pn,ft.adaptationConfig,Q,fe);fi&&(ee.qualityLimitationReason=fi),vr&&ft.adaptationConfig.scale!==vr.scale&&(x.debug("[".concat(W,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(An,", bwe ").concat(Pn,", switch from ").concat(ft.adaptationConfig.scale," to ").concat(vr.scale," ")),ft.adaptationConfig=UM(UM({},ft.adaptationConfig),vr),ye(vr))}},ae("CHECK_LOCAL_STATS_INTERVAL")),Je=UM({},Q);KP.set(W,{timer:Ne,adaptationConfig:Je,originConfig:Q,adaptationFunc:ye}),x.debug("[".concat(W,"] start adaptation, originConfig: ").concat(JSON.stringify(Q),", degradationPreference: ").concat(fe))})(this.id+m.mid,y,this,F,W=>{s&&this.updateAdaptation(s,W)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var T;const{bitrateMax:F,frameRate:W,scaleResolutionDownBy:Q}=r._encoderConfig;F&&(h.maxBitrate=1e3*F),(at(T=r._hints).call(T,Er.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(W&&(h.maxFramerate=Pc(W)),Q&&Q>=1&&(h.scaleResolutionDownBy=Q))}const{maxFramerate:R}=ae("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),ae("DSCP_TYPE")&&pf()){var P;const F=ae("DSCP_TYPE");at(P=["very-low","low","medium","high"]).call(P,F)&&(h.networkPriority=F)}const D=s.getParameters(),G=(c=D.encodings)===null||c===void 0?void 0:c[0];qr()&&!G&&(d.encodings=[h]),G&&Object.assign(G,h),Object.assign(D,d),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await async function(F,W,Q){try{var ee;if(!Bn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(F)||!ae("ENABLE_SVC"))return;const fe={},ye={},ve=W.getParameters(),_e=(ee=ve.encodings)===null||ee===void 0?void 0:ee[0];ye.scalabilityMode=UP(Q),_e&&Object.assign(_e,ye),Object.assign(ve,fe),await W.setParameters(ve),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ve.encodings)))}catch(fe){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",fe)}}(this.store.codec,s,ae("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Bn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=Pc(m)),y&&y>=1&&at(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=y);const v=r.getParameters(),T=(c=v.encodings)===null||c===void 0?void 0:c[0];T&&Object.assign(T,d),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Bn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Pr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=ec(r);return s.forEach((d,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(yS(y,d),o9(y,d,this.store.codec))}),Zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,d,h,m;const v=r[y],T=s[y];if(T instanceof Pr&&!at(a=T._hints).call(a,Er.LOW_STREAM)&&(c=T._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=T._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!qr()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Pr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Pr&&ae("SIMULCAST")&&this.store.codec==="vp8"&&!at(s=r._hints).call(s,Er.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(ae("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Bn().supportPCSetConfiguration){const s=Py.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},It(kn.prototype,"updateRemoteRTPCapabilities",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteRTPCapabilities"),kn.prototype),It(kn.prototype,"connect",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"connect"),kn.prototype),It(kn.prototype,"updateRemoteConnect",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteConnect"),kn.prototype),It(kn.prototype,"createDataChannels",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"createDataChannels"),kn.prototype),It(kn.prototype,"receive",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"receive"),kn.prototype),It(kn.prototype,"batchReceive",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"batchReceive"),kn.prototype),It(kn.prototype,"stopReceiving",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"stopReceiving"),kn.prototype),It(kn.prototype,"muteRemote",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),It(kn.prototype,"unmuteRemote",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),It(kn.prototype,"muteLocal",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"muteLocal"),kn.prototype),It(kn.prototype,"unmuteLocal",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteLocal"),kn.prototype),It(kn.prototype,"close",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),It(kn.prototype,"updateEncoderConfig",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateEncoderConfig"),kn.prototype),It(kn.prototype,"updateSendParameters",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateSendParameters"),kn.prototype),It(kn.prototype,"replaceTrack",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),It(kn.prototype,"updateAdaptation",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"updateAdaptation"),kn.prototype),It(kn.prototype,"getRemoteSSRC",[Ca],Object.getOwnPropertyDescriptor(kn.prototype,"getRemoteSSRC"),kn.prototype),kn);function Ca(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}function BM(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=Pc(r.width),a.height=Pc(r.height);const c=Pc(r.framerate||15);document.body.append(s),document.body.append(a);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new Ae(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Bn(),y=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const T=s.videoWidth,R=s.videoHeight/T,P=a.width*R;Math.abs(P-a.height)>=2&&(x.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(P)),a.height=P)}h.drawImage(s,0,0,a.width,a.height),y.requestFrame&&y.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=QL(()=>a.startCapture&&a.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),x.debug("clean low stream renderer")},y}var XP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(XP||{}),Ti=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(Ti||{}),ly=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(ly||{}),wi=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(wi||{}),uy=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(uy||{}),z9=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(z9||{}),$h=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}($h||{}),Ra=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(Ra||{}),G9=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(G9||{}),Ia=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ia||{}),JP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(JP||{});const dy=1e3,hy=6,QP=3,d_e=Math.max(hy,QP);function $t(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function H9(t){const r={[Ia.CONN_TYPE]:0,[Ia.RTT]:t.rtt,[Ia.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Ia.CONN_TYPE]=1),s==="tcp"&&(r[Ia.CONN_TYPE]=3),s==="tls"&&(r[Ia.CONN_TYPE]=4);break}case"srflx":r[Ia.CONN_TYPE]=2;break;case"unknown":r[Ia.CONN_TYPE]=5;break;default:r[Ia.CONN_TYPE]=0}return r}function $9(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class K9 extends Gr{constructor(r){super(),q(this,"store",void 0),q(this,"uploadWRTCStatsTimer",void 0),q(this,"uploadOutboundDenoiserStatsTimer",void 0),q(this,"uploadExtStatsTimer",void 0),q(this,"uploadExtUsageStatsTimer",void 0),q(this,"uploadInboundExtStatsTimer",void 0),q(this,"requestStats",void 0),q(this,"requestTransportStats",void 0),q(this,"requestLocalMedia",void 0),q(this,"requestRemoteMedia",void 0),q(this,"requestAllTracks",void 0),q(this,"requestVideoIsReady",void 0),q(this,"requestUploadStats",void 0),q(this,"requestUpload",void 0),q(this,"uploadOutboundStarted",!1),q(this,"uploadInboundStarted",!1),q(this,"uploadTransportStarted",!1),q(this,"uploadBaseStatsStarted",!1),q(this,"uploadExtensionUsageStarted",!1),q(this,"lastRecvStats",void 0),q(this,"lastSendStats",void 0),q(this,"lastRefRecvStats",void 0),q(this,"lastRefSendStats",void 0),q(this,"lastFullRecvStats",void 0),q(this,"lastFullSendStats",void 0),q(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%QP==0,a=r%hy==0;let c,d;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),c||d){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,d,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,a?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,a);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&d){const v=this.getInboundStats(d,a?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,a);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[JP.RTC_PEER_CONNECTION_STATE]=UL[y]):m.misc=[{addition:{[JP.RTC_PEER_CONNECTION_STATE]:UL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=d,this.lastSendStats=c,a&&(this.lastFullRecvStats=d,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=d,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[JP.RTC_PEER_CONNECTION_STATE]:UL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===d_e+1&&(r=1)},dy)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[Ia.RTT]:r.rtt,[Ia.CONN_TYPE]:void 0,[Ia.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=H9(r);if(this.store.useP2P){if(s){const d=H9(s);c[Ia.CONN_TYPE]+=d[Ia.CONN_TYPE]<<3}c[Ia.CONN_TYPE]+=110}else c[Ia.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let h,m,y;return d.forEach(v=>{let[T,{track:R,ssrcs:P}]=v;switch(T){case Ye.LocalVideoLowTrack:case Ye.LocalVideoTrack:if(T===Ye.LocalVideoTrack){const D=function(W,Q,ee,fe,ye,ve){const _e=Q.videoSend.find(yt=>yt.ssrc===W);if(!_e)return;const Ne={},{sentFrame:Je,inputFrame:ft}=_e;if(ve&&($t(Ne,Ti.QP_SUM,_e.qpSumPerFrame),ft&&Je)){const yt=ft.frameRate,An=Je.frameRate;Ne[Ti.FREEZE]=function(Pn,vr){let fi=!0;return fi=!(Pn<=5)&&(Pn<=10?vr<3:Pn<=20?vr<4:vr<5),fi}(yt,An)?1:0}if(ye){switch(Je&&($t(Ne,Ti.HEIGHT,Je.height),$t(Ne,Ti.WIDTH,Je.width),$t(Ne,Ti.FRAME_RATE,Je.frameRate)),Ne[Ti.DISABLED]=fe._originMediaStreamTrack&&!fe._originMediaStreamTrack.enabled||fe._mediaStreamTrack&&!fe._mediaStreamTrack.enabled?1:0,_e.adaptionChangeReason){case"none":Ne[Ti.ADAPTATION]=0;break;case"cpu":Ne[Ti.ADAPTATION]=1;break;case"bandwidth":Ne[Ti.ADAPTATION]=2;break;case"other":Ne[Ti.ADAPTATION]=3}let yt=0;_e.adaptionChangeReason&&(yt+=$9(_e.adaptionChangeReason)),Q.qualityLimitationReason&&(yt+=$9(Q.qualityLimitationReason)<<3),Ne[Ti.ADAPTATION]=yt,Ne[Ti.PLAYER_STATUS]=XL[fe._player?fe._player.videoElementStatus:"uninit"],$t(Ne,Ti.NACKS,_e.nacksCount),$t(Ne,Ti.PLIS,_e.plisCount),$t(Ne,Ti.FIRS,_e.firsCount),$t(Ne,Ti.AVG_ENCODE,_e.avgEncodeMs),$t(Ne,Ti.HUGE_FRAME_SENT,_e.hugeFramesSent),$t(Ne,Ti.BYTES_RETRANSMIT,_e.retransmittedBytesSent),$t(Ne,Ti.PACKAGES_RETRANSMIT,_e.retransmittedPacketsSent),$t(Ne,Ti.KEY_FRAMES_ENCODED,_e.keyFramesEncoded);const An=ee&&ee.videoSend.find(Pn=>Pn.ssrc===W);if(An){let Pn=ye?dy:dy*hy;An.timestamp&&_e.timestamp&&(Pn=_e.timestamp-An.timestamp),An.packets!=null&&_e.packets!=null&&$t(Ne,Ti.PACKAGE_RATE,1e3*(_e.packets-An.packets)/Pn),_e.packetsLost!=null&&An.packetsLost!=null&&$t(Ne,Ti.PACKAGE_LOST,_e.packetsLost-An.packetsLost),An.bytes!=null&&_e.bytes!=null&&$t(Ne,Ti.BITRATE,8*(_e.bytes-An.bytes)/Pn)}}return Ne}(P[0].ssrcId,r,s,R,a,c),G=R&&function(W,Q,ee,fe){const ye=Q.videoSend.find(_e=>_e.ssrc===W);if(!ye)return null;const ve={};if(fe){const _e=ye.inputFrame,Ne=_e&&_e.height||ee.videoHeight||0,Je=_e&&_e.width||ee.videoWidth||0,ft=_e&&_e.frameRate||0;$t(ve,XP.HEIGHT,Ne),$t(ve,XP.WIDTH,Je),$t(ve,XP.FRAME_RATE,ft)}return ve}(P[0].ssrcId,r,R,a),F=function(W,Q){const ee={};return Q&&($t(ee,Ti.RETRANSMIT,W.bitrate.retransmit),$t(ee,Ti.TARGET_ENCODED,W.bitrate.targetEncoded),$t(ee,Ti.ACTUAL_ENCODED,W.bitrate.actualEncoded),$t(ee,Ti.TRANSMIT,W.bitrate.transmit),$t(ee,Ti.BANDWIDTH,W.sendBandwidth)),ee}(r,a);m=Object.assign({},D,G,F)}else y=function(D,G,F,W){const Q=G.videoSend.find(fe=>fe.ssrc===D);if(!Q)return;const ee={};if(W){const fe=Q.sentFrame;if(fe&&($t(ee,ly.HEIGHT,fe.height),$t(ee,ly.WIDTH,fe.width),$t(ee,ly.FRAME_RATE,fe.frameRate)),F){const ye=F.videoSend.find(ve=>ve.ssrc===D);if(ye){let ve=dy*hy;ye.timestamp&&Q.timestamp&&(ve=Q.timestamp-ye.timestamp),ye.packets!=null&&Q.packets!=null&&$t(ee,ly.PACKAGE_RATE,1e3*(Q.packets-ye.packets)/ve),Q.packetsLost!=null&&ye.packetsLost!=null&&$t(ee,ly.PACKAGE_LOST,Q.packetsLost-ye.packetsLost),ye.bytes!=null&&Q.bytes!=null&&$t(ee,ly.BITRATE,8*(Q.bytes-ye.bytes)/ve)}}}return ee}(P[0].ssrcId,r,s,a);break;case Ye.LocalAudioTrack:h=R&&function(D,G,F,W,Q){const ee=G.audioSend.find(ye=>ye.ssrc===D);if(!ee)return;const fe={};if(Q){fe[$h.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const ye=100*W._source.getAccurateVolumeLevel(),ve=ee.inputLevel;if(ve!=null){const Ne=Math.ceil(50*Math.log10(100*ve+1));$t(fe,$h.LEVEL,Ne)}$t(fe,z9.PCM_LEVEL,ye),$t(fe,$h.AEC_RETURN_LOSS,ee.aecReturnLoss),$t(fe,$h.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),$t(fe,$h.BYTES_RETRANSMIT,ee.retransmittedBytesSent),$t(fe,$h.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),fe[$h.FREEZE]=0;const _e=F&&F.audioSend.find(Ne=>Ne.ssrc===D);if(_e){let Ne=dy*hy;_e.timestamp&&ee.timestamp&&(Ne=ee.timestamp-_e.timestamp),_e.bytes!=null&&ee.bytes!=null&&$t(fe,$h.BITRATE,8*(ee.bytes-_e.bytes)/Ne),_e.packets!=null&&ee.packets!=null&&$t(fe,$h.PACKAGE_RATE,1e3*(ee.packets-_e.packets)/Ne)}}return fe}(P[0].ssrcId,r,s,R,a)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(m=>{let[y,v]=m;const T={peer:y.uid};if(v.has(Tt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(D,G,F,W,Q,ee,fe,ye){const ve=G.videoRecv.find(Pn=>Pn.ssrc===D);if(!ve)return;const _e={},{receivedFrame:Ne,outputFrame:Je,decodeFrameRate:ft}=ve,yt=F&&F.videoRecv.find(Pn=>Pn.ssrc===D);if($t(_e,uy.FRAME_RATE_DECODE,ft),ve.framesRateFirefox&&$t(_e,wi.FRAME_RATE,ve.framesRateFirefox),Ne&&$t(_e,wi.FRAME_RATE,Ne.frameRate),$t(_e,wi.FRAMES_DROPPED,ve.framesDroppedCount),$t(_e,wi.BYTES_RETRANSMIT,ve.retransmittedBytesReceived),$t(_e,wi.PACKAGES_RETRANSMIT,ve.retransmittedPacketsReceived),$t(_e,wi.PACKAGES_DISCARDED,ve.packetsDiscarded),$t(_e,wi.AVG_DECODE,ve.avgDecodeMs),$t(_e,wi.AVG_PROCESSING_DELAY,ve.avgProcessingDelayMs),$t(_e,wi.AVG_ASSEMBLY_TIME,ve.avgFramesAssembledFromMultiplePacketsMs),$t(_e,wi.AVG_INTER_FRAME_DELAY,ve.avgInterFrameDelayMs),$t(_e,wi.KEY_FRAMES_DECODED,ve.keyFramesDecoded),yt){const Pn=G.timestamp-F.timestamp||dy*(ye?hy:fe?QP:1);ve.packetsLost!=null&&yt.packetsLost!=null&&$t(_e,wi.PACKAGE_LOST,ve.packetsLost-yt.packetsLost),yt.bytes!=null&&ve.bytes!=null&&$t(_e,wi.BITRATE,8*(ve.bytes-yt.bytes)/Pn),yt.packets!=null&&ve.packets!=null&&$t(_e,wi.PACKAGE_RATE,1e3*(ve.packets-yt.packets)/Pn)}if(ye&&($t(_e,wi.QP_SUM,ve.qpSumPerFrame),_e[wi.FREEZE]=Q&&ew.isRemoteVideoFreeze(W,ve,yt)?1:0),fe){var An;Ne?($t(_e,wi.HEIGHT,Ne.height),$t(_e,wi.WIDTH,Ne.width)):W&&($t(_e,wi.HEIGHT,W._videoHeight||0),$t(_e,wi.WIDTH,W._videoWidth||0)),Je&&$t(_e,uy.FRAME_RATE_OUTPUT,Je.frameRate);const Pn=(An=W._player)===null||An===void 0?void 0:An.rendFrameRate.toFixed(0);if(Pn&&$t(_e,uy.FRAME_RATE_RENDER,+Pn),$t(_e,wi.JITTER_BUFFER,ve.jitterBufferMs),$t(_e,wi.CURRENT_DELAY,ve.currentDelayMs),$t(_e,wi.FIRS,ve.firsCount),$t(_e,wi.NACKS,ve.nacksCount),$t(_e,wi.PLIS,ve.plisCount),W){_e[wi.DISABLED]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1;const vr=W._player;if(vr){const{freezeTimeCounterList:fi,renderFreezeAccTime:ti,videoElementStatus:Pa}=vr;if(fi&&fi.length>0&&$t(_e,uy.FREEZE_TIME,fi.splice(0,1)[0]),ee&&gf.visibility==="visible"&&Pa===To.PLAYING&&Bn().supportRequestVideoFrameCallback){const ze=Math.min(6e3,ti);vr.renderFreezeAccTime=Math.max(0,ti-ze),$t(_e,uy.FREEZE_TIME_RENDER,ze)}if(typeof ve.totalFreezesDuration=="number"){const ze=yt&&yt.totalFreezesDuration?ve.totalFreezesDuration-yt.totalFreezesDuration:ve.totalFreezesDuration;$t(_e,uy.FREEZE_DURATION,1e3*ze)}}}if(_e[wi.PLAYER_STATUS]=XL[W._player?W._player.videoElementStatus:"uninit"],yt&&ve.totalInterFrameDelay!==void 0&&ve.totalSquaredInterFrameDelay!==void 0&&yt.totalInterFrameDelay!==void 0&&yt.totalSquaredInterFrameDelay!==void 0){const vr=ve.totalInterFrameDelay-yt.totalInterFrameDelay,fi=ve.totalSquaredInterFrameDelay-yt.totalSquaredInterFrameDelay,ti=ve.framesDecodeCount-yt.framesDecodeCount,Pa=vr/ti*1e3,ze=Math.round(1e3*Math.sqrt((fi-Math.pow(vr,2)/ti)/ti));!isNaN(ze)&&Pa+ze>Math.max(3*Pa,Pa+150)&&(_e[wi.I_FRAME_DELAY]=ze)}}return _e}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,a,c):void 0;P&&(T.video=P)}if(v.has(Tt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,D,G,F,W,Q){const ee=D.audioRecv.find(_e=>_e.ssrc===P);if(!ee)return;const fe={},ye=G&&G.audioRecv.find(_e=>_e.ssrc===P);if($t(fe,Ra.JITTER,ee.jitterMs),$t(fe,Ra.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),$t(fe,Ra.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),$t(fe,Ra.PACKAGES_DISCARDED,ee.packetsDiscarded),$t(fe,Ra.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),ye){const _e=D.timestamp-G.timestamp||dy*(Q?hy:W?QP:1);ee.packets!=null&&ye.packets!=null&&$t(fe,Ra.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/_e),W&&ye.bytes!=null&&ee.bytes!=null&&$t(fe,Ra.BITRATE,8*(ee.bytes-ye.bytes)/_e),ee.packetsLost!=null&&ye.packetsLost!=null&&$t(fe,Ra.PACKAGE_LOST,ee.packetsLost-ye.packetsLost)}if(Q){const{receivedFrames:_e,droppedFrames:Ne}=ee;_e!=null&&Ne!=null&&(fe[Ra.FREEZE]=(ve=_e)===0||100*Ne/ve>20?1:0)}var ve;if(W){const _e=100*F._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Je=Math.ceil(50*Math.log10(100*Ne+1));$t(fe,G9.LEVEL,Je)}if($t(fe,Ra.PCM_LEVEL,_e),F&&(fe[Ra.DISABLED]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1),$t(fe,Ra.JITTER_BUFFER,ee.jitterBufferMs),$t(fe,Ra.CURRENT_DELAY,ee.jitterBufferMs),fe[Ra.PLAYER_STATUS]=XL[wa.getPlayerState(F.getTrackId())],ye){const Je=ee.concealedSamples-ye.concealedSamples;Je>0&&$t(fe,Ra.CONCEALED_SAMPLES,Je);const ft=ee.totalSamplesReceived-ye.totalSamplesReceived;ft>0&&$t(fe,Ra.TOTAL_SAMPLES_RECEIVED,ft)}}return fe}(y._audioSSRC,r,s,y.audioTrack,a,c):void 0;R&&(T.audio=R)}(T.video||T.audio)&&h.push(T)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof SP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(GT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,a]=r;a.has(Tt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(Tt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),a={connectionInterval:ae("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,T]of h)T.has(Tt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),T.has(Tt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(v,T){const R={};for(const{id:F,value:W,level:Q,direction:ee}of v){var P;const fe=(P=T.get(F))!==null&&P!==void 0?P:0,ye=W===2?fe+ae("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fe;var D,G;T.set(F,ye),R[F]?(W===2&&(R[F].value=W),Q>R[F].level&&(R[F].level=Q),ee==="remote"&&(R[F].remoteUidCount+=1),R[F].totalTs=(D=T.get(F))!==null&&D!==void 0?D:0):R[F]={value:W,level:Q,remoteUidCount:ee==="local"?0:1,totalTs:(G=T.get(F))!==null&&G!==void 0?G:0}}return Object.keys(R).map(F=>{const{level:W,value:Q,totalTs:ee}=R[F];return{id:F,level:W,value:Q,totalTs:ee}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(GT.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:y})},ae("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const h_e=ae("ICE_RESTART_INTERVAL");let ZP=new Map,TS=new Map,ag=[Js.UDP_TCP_RELAY,Js.TCP_RELAY,Js.RELAY],WM=ae("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bn().supportPCSetConfiguration;function q9(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=ZP.get(t.id);s&&(window.clearTimeout(s),ZP.delete(t.id));const a=TS.get(t.id);r&&a&&a.index===ag.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),TS.delete(t.id))}function Y9(t,r,s){if(ZP.size===0&&TS.size===0&&(Array.isArray(ae("RESTART_SEQUENCE"))&&ae("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const T=m[v];if(m.filter(R=>R===T).length!==y.filter(R=>R===T).length)return!1}return!0}(ag,ae("RESTART_SEQUENCE"))&&(ag=ae("RESTART_SEQUENCE").filter(m=>{var y;if(at(y=Object.values(Js)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(ag.join(" => ")))),WM=ae("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bn().supportPCSetConfiguration),ag.length===0)return void s();let a,{index:c=0,type:d}=TS.get(t.id)||{};if(WM&&d===Js.RELAY)return void s();let h=d&&c>=ag.length-1;if(WM)d=Js.RELAY;else{if(h)return void s();d?(c++,d=ag[c]):(d=ag[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),TS.set(t.id,{index:c,type:d}),a=window.setTimeout(()=>Y9(t,r,s),h_e),ZP.set(t.id,a)}var yn;function X9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Kh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?X9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):X9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function J9(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=hL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new eO(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function eO(t){function r(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var a=s.done;return pt.resolve(s.value).then(function(c){return{value:c,done:a}})}return eO=function(s){this.s=s,this.n=s.next},eO.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?pt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?pt.reject(s):r(a.apply(this.s,arguments))}},new eO(t)}let nw=(yn=class extends Gr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),q(this,"isPlanB",void 0),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"connection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"remoteDataChannelMap",new Map),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"pendingLocalDataChannels",[]),q(this,"pendingRemoteDataChannels",[]),q(this,"statsCollector",void 0),q(this,"shouldForwardP2PCreation",void 0),q(this,"iceFailedCount",0),q(this,"dtlsFailedCount",0),q(this,"mutex",void 0),q(this,"_state",Qn.Disconnected),q(this,"_pcStatsUploadType",ae("NEW_ICE_RESTART")?vf.FIRST_CONNECTION:vf.OLD_FIRST_CONNECTION),q(this,"_isStartRestartIce",!1),q(this,"_restartTimer",void 0),q(this,"_isTryConnecting",!1),q(this,"_iceError",null),q(this,"_forceTurn",!1),q(this,"_isWaitPcToRePub",!1),q(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const y=this.createMuteMessage(h);await _r(this,Vt.RequestMuteLocal,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!ae("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding){const T=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T}else{const T=BM(s,UT(this,Vt.RequestLowStreamParameter));v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T}await new pt((T,R)=>{this.handleReplaceTrack(v.track,T,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const y=this.createUnmuteMessage(h);await _r(this,Vt.RequestUnmuteLocal,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Qn.Connected)return void a();const{id:v,track:T}=y;await this.connection.updateSendParameters(v,T),await this.connection.updateEncoderConfig(v,T),this.emit(Vt.UpdateVideoEncoder,T),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Qn.Connected)return void a();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleReplaceMixingTrack",async(s,a,c,d)=>{if(!this.connection||this.state!==Qn.Connected)return void a();const h=jM([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),q(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:R}]=T;return s===R});if(!this.connection||!v||this.state!==Qn.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const T=v[1];T.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],T)}if(v[0]===Ye.LocalVideoTrack&&!ae("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding){const T=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(T){const R=s._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=R,T.track._originMediaStreamTrack=R,await new pt((P,D)=>{this.handleReplaceTrack(T.track,P,D,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new K9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ys("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Bn().supportUnifiedPlan||ae("CHROME_FORCE_PLAN_B")&&pf(),this.shouldForwardP2PCreation=ae("FORWARD_P2P_CREATION")&&Bn().supportPCSetConfiguration&&wL(),this.shouldForwardP2PCreation&&(this.connection=YP(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Qn.New,this._forceTurn=B9(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=YP(this.store,t),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=ae("NEW_ICE_RESTART")?vf.FIRST_CONNECTION:vf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");ae("ENABLE_PREALLOC_PC")&&this.state===Qn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Qn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return at(d=[Ye.LocalVideoLowTrack,Ye.LocalVideoTrack]).call(d,h)}),s=r.map(c=>{let[,{id:d}]=c;return d}),a=r.map(c=>{let[d]=c;return d});if(this.connection instanceof Hh){if(Ot.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!at(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>at(t).call(t,d));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Hh&&this.connection.peerConnectionState!=="closed"&&at(t=[Qn.New,Qn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Qn.Connected){if(this.state===Qn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var a;at(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var a=this;return Hl(function*(){const c=yield xn(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&at(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==Qn.Connected||h){if(a.state===Qn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(y),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,Qs.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield xn(a.tryToUnmuteAudio(t)));yield*qA(J9(a.doPublish(a.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return Hl(function*(){r.forEach(P=>{let{track:D,type:G}=P;const F=Date.now();s.store.publish(D.getTrackId(),G===Ye.LocalAudioTrack?"audio":"video",F)}),s.bindLocalTrackEvents(r);const a=r.map(P=>{let{track:D}=P;return D}),c=yield xn(t.send(a,s.store.codec,s.store.audioCodec)),d=(yield xn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(D=>{let{track:G}=D;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,a),v=(yield xn(c.next(y))).value;if(s.state===Qn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");ae("ENABLE_VIDEO_SEI");const T=ae("ENABLE_ENCODED_TRANSFORM"),R=ae("ENABLE_AUDIO_METADATA");a.forEach(async P=>{const D=P.getRTCRtpTransceiver();if(!D||!T)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:F}=WP();P.trackMediaType===Tt.VIDEO?await G(D.sender,P):P.trackMediaType===Tt.AUDIO&&await F(D.sender,{metadata:R?()=>{const W=P.metadata.shift();return W&&W.value}:void 0})}),r.forEach(P=>{let{type:D}=P;s.statsCollector.addLocalStats(D)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:D,type:G}=P;const F=Date.now();s.store.publish(D.getTrackId(),G===Ye.LocalAudioTrack?"audio":"video",void 0,F)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Pr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=TM(d,h)),m.maxFramerate=d.framerate?Pc(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Ye.LocalVideoLowTrack||!ae("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return x.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=Pc(m.width)),m.height&&(y.height=Pc(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=QL(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},Pc(m.framerate)))})(d,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Hl(function*(){if(!r.connection||r.state!==Qn.Connected)return;const s=yield xn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ye.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ye.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Ye.LocalVideoLowTrack}];if(yield*qA(J9(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Ye.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield xn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Fs(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Fs(this,Vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==Tt.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==Tt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Fs(this,Vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===Tt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Vt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Qn.Connected)return void t.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Qn.Connected)return void t.forEach(s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Qn.Connected)return;const t=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ye.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),r.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Qn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(a=>a.id)}async subscribe(t,r,s,a,c){var d;if(!this.connection||this.state!==Qn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const P=c.find(G=>{let{stream_type:F}=G;return F===r});if(!P)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const D=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof Hh&&(y=D.transceiver),h=D.track,m=D.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof Hh&&(y=P.transceiver),h=P.track,m=P.id}if(r===Tt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new uS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new lS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&ae("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:D}=WP();r==Tt.VIDEO?await P(y.receiver,{onSei:ae("ENABLE_VIDEO_SEI")&&(G=>{var F;return(F=t._videoTrack)===null||F===void 0?void 0:F._onSei(G)})}):r==Tt.AUDIO&&await D(y.receiver,{enableTopn:!!ae("ENABLE_AUDIO_TOPN"),enableMetadata:!!ae("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(Vt.AudioMetadata,G)}})}const T=this.remoteUserMap.get(t);T?T.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:D,kind:G}=P;return D.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Qn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);d?s.set(c.ssrcId,d):r.push(c)});const a=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{s.set(c.ssrcId,a[d])});for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:y,id:v,transceiver:T}=m;if(T&&ae("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=WP();d==Tt.VIDEO?await D(T.receiver,{onSei:ae("ENABLE_VIDEO_SEI")&&(F=>{var W;return(W=c._videoTrack)===null||W===void 0?void 0:W._onSei(F)})}):d==Tt.AUDIO&&await G(T.receiver,{enableTopn:!!ae("ENABLE_AUDIO_TOPN"),enableMetadata:!!ae("ENABLE_AUDIO_METADATA"),onMetadata:F=>{this.safeEmit(Vt.AudioMetadata,F)}})}if(d===Tt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new uS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),T&&c._audioTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new lS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),T&&c._videoTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(c,c._videoTrack)),ae("ENABLE_VIDEO_SEI")&&T){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=WP();d==Tt.VIDEO?await D(T.receiver,{onSei:F=>{var W;(W=c._videoTrack)===null||W===void 0||W._onSei(F)}}):d==Tt.AUDIO&&await G(T.receiver)}const R=this.remoteUserMap.get(c);R?R.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(D=>{let{user:G,kind:F}=D;return G.uid===c.uid&&d===F});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(Vt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Qn.Connected||s||a.forEach(h=>{let{kind:m}=h;var y;if(m===Tt.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===Tt.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Qn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,T;if(y===Tt.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===Tt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((T=m._videoTrack)===null||T===void 0||T._destroy(),m._videoTrack=void 0);else if(y===Tt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(t);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return d!==void 0?y.uid===c.uid&&d===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Qn.Connected)return void r.forEach(c=>{let{user:d,kind:h}=c;var m;if(h===Tt.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===Tt.VIDEO){var y;(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0}});const s=Sc(t).call(t,(c,d)=>{let{user:h,mediaType:m}=d;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var m,y;if(h===Tt.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===Tt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0;else if(h===Tt.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==Qn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===Tt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ye.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ye.LocalAudioTrack);if((r==null?void 0:r.track)instanceof zi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ye.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Ye.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Ye.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Ye.LocalAudioTrack),m=a?this.localTrackMap.get(Ye.LocalVideoLowTrack):this.localTrackMap.get(Ye.LocalVideoTrack);Ot.publish(this.store.sessionId,{eventElapse:Qs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Er.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof ei),m=a?(d=this.localTrackMap.get(Ye.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Pr);Ot.publish(this.store.sessionId,{eventElapse:Qs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Er.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===Tt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ot.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===Tt.VIDEO,audio:a===Tt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Qs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ys("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=YP(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ye.LocalAudioTrack);if((t==null?void 0:t.track)instanceof zi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Qn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ye.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ye.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Pr||r&&r.track instanceof ei?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(ol(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ye.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=vT(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Qn.Reconnecting,ae("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=YP(this.store),this.emit(Vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Ye.LocalVideoTrack:at(r=a._hints).call(r,Er.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ye.LocalAudioTrack:a instanceof zi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ye.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(ol(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(ol(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(r,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof og?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof og?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Hl(function*(){if(!r.connection||r.state!==Qn.Connected)return;const s=yield xn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield xn(r.connection.restartICE(t));const d=yield xn(a.next());if(d.done)return;const h=d.value,m=yield h;switch(FM(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Js.UDP_TCP_RELAY:r._pcStatsUploadType=vf.UDP_TCP_RESTART;break;case Js.TCP_RELAY:r._pcStatsUploadType=vf.TCP_RESTART;break;case Js.RELAY:r._pcStatsUploadType=vf.RELAY_RESTART;break;default:r._pcStatsUploadType=vf.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalAudioTrack),a=t.videoSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(D=>D.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;const d=il(this,Vt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,T=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(Er.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const F=(1e3*D-G)/(1e3*D);return kH[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=il(this,Vt.NeedSignalRTT),v=t.rtt,T=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let D=.7*P*100/50+.3*T/1500;R&&(D=.6*P*100/50+.2*T/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new pt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Qn.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const d=a[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Ye.LocalVideoTrack&&!ae("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding){const d=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new pt((m,y)=>{this.handleReplaceTrack(d.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=Xv(t=t.filter(y=>c.indexOf(y)===-1));let d,h=!1;const m=this.localTrackMap.get(Ye.LocalAudioTrack);for(const y of t){if(y instanceof Pr&&(this.localTrackMap.has(Ye.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Ye.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Ye.LocalVideoLowTrack})}if(y instanceof ei)if(m){const v=m.track;if(v instanceof zi)VM([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const T=jM([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(T.getTrackId(),"]")),this.replaceTrack(v,T)}}else d instanceof zi?(VM([y]),d.addAudioTrack(y)):d||!y._useAudioElement&&Bn().webAudioMediaStreamDest&&!y._bypassWebAudio?d=jM(d?[y,d]:[y]):d=y}return d&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Ye.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Xv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof ei){const c=this.localTrackMap.get(Ye.LocalAudioTrack);if(!c)continue;c.track instanceof zi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Ye.LocalAudioTrack,c]),c.track.close())):r.push([Ye.LocalAudioTrack,c])}if(a instanceof Pr){const c=this.localTrackMap.get(Ye.LocalVideoTrack);if(!c)continue;r.push([Ye.LocalVideoTrack,c]);const d=this.localTrackMap.get(Ye.LocalVideoLowTrack);d&&r.push([Ye.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Xv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Xv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ye.LocalVideoTrack:s.addListener(Rt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Rt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof zi?t.trackList.forEach(s=>{s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Rt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ye.LocalVideoTrack:s.off(Rt.GET_STATS,this.handleGetLocalVideoStats),s.off(Rt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof zi?t.trackList.forEach(r=>{r.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Rt.GET_STATS,this.handleGetLocalAudioStats),r.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Rt.GET_STATS,this.handleGetLocalAudioStats),t.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Rt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof lS&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof uS&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Rt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Tt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Tt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,h,{track:m,type:y}=s;switch(y){case Ye.LocalAudioTrack:d=Zn.Audio,h={dtx:m instanceof SP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ye.LocalVideoTrack:d=at(c=m._hints).call(c,Er.SCREEN_TRACK)?Zn.Screen:Zn.High,h=Kh(Kh({},YH(m)),{},{codec:this.store.codec,svc_mode:UP()});break;case Ye.LocalVideoLowTrack:d=Zn.Low,h=Kh(Kh({},YH(m)),{},{codec:this.store.codec,svc_mode:UP()})}return{stream_type:d,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalVideoTrack:a=at(s=d._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Hh&&!qr()&&ae("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},ae("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Hh&&q9(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vf.DISCONNECTED_OR_FAILED,il(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Ot.reportApiInvoke(this.store.sessionId,{name:xi.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:Xr.TRACER}).onSuccess(),this.republish()}if(ae("NEW_ICE_RESTART")&&t instanceof Hh&&!qr()&&!this._forceTurn){if(at(WH).call(WH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{FM(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),il(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE,c))},a=()=>{FM(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{Y9(t,s,a)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&ae("ICE_RESTART")&&il(this,Vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Vt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Ot.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Xr.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(ol(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(iS.FIRST_FRAME_DECODED),Ot.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_DECODE,Fr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(ol(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&Ot.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_RECEIVED,Fr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(ol(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&Ot.firstRemoteFrame(this.store.sessionId,es.FIRST_VIDEO_RECEIVED,Fr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Vt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(rg(s))," -> ").concat(JSON.stringify(rg(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(rg(s))," -> ").concat(JSON.stringify(rg(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Kh(Kh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Hh&&function(r){TS.delete(r.id),q9(r)}(t),t.close(),this.emit(Vt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof ei&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive||r.push([Ye.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===Ye.LocalVideoTrack)){const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof ei&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive&&r.push([Ye.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===Ye.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoTrack:a=at(s=d._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoTrack:a=at(s=d._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case Tt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:Tt.VIDEO,ssrcId:a._videoSSRC}));case Tt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:Tt.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[a,{kind:c}]=s;if(r.has(a)){let d=r.get(a);c===Tt.VIDEO?d|=ts.Video:d|=ts.Audio,r.set(a,d)}else c===Tt.VIDEO?r.set(a,ts.Video):r.set(a,ts.Audio)}),{users:Array.from(r.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new pt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new pt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((a,c)=>{var d;let{stream_type:h}=a;const m=(d=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||d===void 0?void 0:d.attributes;if(m&&ae("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(at(y).call(y,Er.SCREEN_TRACK)||at(y).call(y,Er.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof ei){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(a);return void await _r(this,Vt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await bs(NL(this.dtlsFailedCount,Li)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Fs(this,Vt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ye.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Pr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Pr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof ei).length>1&&(t.some(r=>r instanceof ei&&r._bypassWebAudio)||!Bn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Pr&&this.pendingLocalTracks.some(s=>s instanceof Pr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ei&&this.pendingLocalTracks.some(s=>s instanceof ei)&&(!Bn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ei&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!ae("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding,c=Kh(Kh({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?t._mediaStreamTrack.clone():BM(t,c);const h=yr(8,"track-low-"),m=new Pr(d,Kh(Kh({},a&&{scaleResolutionDownBy:TM(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(ey.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,nS.LOW_STREAM)}),m._hints.push(Er.LOW_STREAM),at(s=t._hints).call(s,Er.SCREEN_TRACK)&&m._hints.push(Er.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(Rt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Hh){var c,d,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:T,peerConnectionState:R}=this.connection,{local:P,remote:D}=await this.connection.getSelectedCandidatePair();Ot.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:T,connectionstate:R,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=P.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=D.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=D.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(ol(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Ot.firstRemoteVideoDecode(this.store.sessionId,es.FIRST_VIDEO_DECODE,Fr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ye.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,nS.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},It(yn.prototype,"startP2PConnection",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"startP2PConnection"),yn.prototype),It(yn.prototype,"connect",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"connect"),yn.prototype),It(yn.prototype,"updateRemoteRTPCapabilities",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"updateRemoteRTPCapabilities"),yn.prototype),It(yn.prototype,"publishDataChannel",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"publishDataChannel"),yn.prototype),It(yn.prototype,"unpublish",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"unpublish"),yn.prototype),It(yn.prototype,"unpublishDataChannel",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishDataChannel"),yn.prototype),It(yn.prototype,"unpublishLowStream",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishLowStream"),yn.prototype),It(yn.prototype,"subscribeDataChannel",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"subscribeDataChannel"),yn.prototype),It(yn.prototype,"subscribe",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"subscribe"),yn.prototype),It(yn.prototype,"massSubscribe",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"massSubscribe"),yn.prototype),It(yn.prototype,"unsubscribe",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribe"),yn.prototype),It(yn.prototype,"unsubscribeDataChannel",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribeDataChannel"),yn.prototype),It(yn.prototype,"massUnsubscribe",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"massUnsubscribe"),yn.prototype),It(yn.prototype,"muteRemote",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"muteRemote"),yn.prototype),It(yn.prototype,"unmuteRemote",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"unmuteRemote"),yn.prototype),It(yn.prototype,"hasRemoteMediaWithLock",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"hasRemoteMediaWithLock"),yn.prototype),It(yn.prototype,"disconnectForReconnect",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"disconnectForReconnect"),yn.prototype),It(yn.prototype,"updateBitrateLimit",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"updateBitrateLimit"),yn.prototype),It(yn.prototype,"remoteMediaSsrcChanged",[Co],Object.getOwnPropertyDescriptor(yn.prototype,"remoteMediaSsrcChanged"),yn.prototype),yn);function Co(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}function Q9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Z9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Q9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Q9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const p_e=Date.now(),f_e=20,zM=new Map,tO=new Map;async function e$(t){const r=zM.get(t),s=Array.isArray(r)&&r[r.length-1],a=tO.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),t$(s.context,c),m=0):m=Math.min(m,f_e),setTimeout(()=>r.length&&e$(t),m)}function t$(t,r){t.safeEmit(Tn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function m_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return t$(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=zM.get(a)||[],d=c.findIndex(v=>t.sendTs>=v.sendTs),h=Z9(Z9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),zM.set(a,c);let m=!1;var y;tO.has(a)?m=!((y=tO.get(a))===null||y===void 0||!y.isSyncing):tO.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||e$(a)}const g_e=Ln().name;function n$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function r$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?n$(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):n$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const wS="websdk_ng_cache_parameter",__e=ae("MAX_PRELOAD_ASYNC_LENGTH"),y_e=1e4,py=new Map,fy=[];let GM=null,HM=0,$M=0;const nO=new Map,E_e=function(t,r){const s=[];let a=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&a<r?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new pt(async(y,v)=>{s.push(async()=>{try{const T=await t(...h);y(T)}catch(T){v(T)}}),a<r&&(a++,c())})}}(i$,__e),KM=Ta.CancelToken.source();async function i$(t,r,s,a,c,d){try{if(!ae("ENABLE_PRELOAD"))return;if(!Bn().supportWebCrypto)return void Jm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Ss(s,"token",1,2047),Ss(t,"appid",1,2047),NP(r),a&&DP(a);const h=Q_();x.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let y,v;typeof a=="string"?(m.stringUid=a,[v,y]=await pt.all([t_e(a,{sid:h,appId:t},KM.token),R9(r$(r$({},m),{},{token:s||t,uid:0}),KM.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),y=await R9(m,KM.token));const T={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let P;try{R.uid&&o$({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=u$(R),G=await async function(W,Q){try{const ee=await window.crypto.subtle.importKey("raw",Xz(Q),"AES-GCM",!1,["encrypt"]),fe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,J_(window.btoa(JSON.stringify(W))));return Qm(new Uint8Array(fe))}catch{return}}(R,R.token||R.appId);if(!G)return;P=l$(wS);const F=P?JSON.parse(P):[];F.push({[D]:G}),F.length>ae("AP_CACHE_NUM")&&F.shift(),rO(wS,JSON.stringify(F))}catch(D){x.warn("Error caching server parameters:",D.message),rO(wS,"")}}(T),HM++}catch(h){throw $M++,function(m){GM||(GM=window.setTimeout(()=>{let v="";nO.forEach((T,R)=>{v+="".concat(R,": ").concat(T," ;")}),Ot.reportApiInvoke(null,{name:xi.PRELOAD,options:{success:HM,failed:$M,err:v}}).onError(m),HM=0,$M=0,nO.clear(),GM=null},y_e));const y=nO.get(m.code)||0;nO.set(m.code,y+1)}(h),h}}async function s$(t){try{if(ae("AP_REQUEST_DETAIL")||ae("ENABLE_ROLE_SELECT_EDGE"))return;const r=o$(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",Xz(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,J_(a));return JSON.parse(window.atob(Qm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<ae("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function o$(t){let r;try{if(r=l$(wS),!r)return;const s=JSON.parse(r),a=u$(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>a in h);if(c===-1)return;const d=s.splice(c,1)[0];return rO(wS,JSON.stringify(s)),d[a]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),rO(wS,"")}}function qM(t){if(t){let r=py.get(t);r&&(window.clearTimeout(r),r=null,py.delete(t)),at(fy).call(fy,t)||t.cloudProxyServer!=="disabled"||fy.push(t)}if(py.size<ae("AP_CACHE_NUM")&&fy.length>0){const r=fy.shift();py.set(r,window.setTimeout(async()=>{const{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await E_e(s,a,c,h,m,d),py.has(r)&&qM(r)}catch(y){x.warn("update preload failed",y.message),a$(r)}},ae("AP_UPDATE_INTERVAL")))}}function a$(t){const r=fy.indexOf(t);r!==-1&&fy.splice(r,1);let s=py.get(t);s&&(window.clearTimeout(s),s=null,py.delete(t),qM())}function c$(t,r){const s=t.sua,a=t.ap;r&&s&&Ot.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Ot.reportResourceTiming(t.ap.url,t.sid),Ot.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[bi.CHOOSE_SERVER,bi.CLOUD_PROXY_FALLBACK].toString()}),Ot.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function l$(t){return window.atob(window.localStorage.getItem(t)||"")}function rO(t,r){window.localStorage.setItem(t,window.btoa(r))}function u$(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),r8(r)}function v_e(t){let r=function(){const s=T_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(Ci(a,10),cg(a,c));let d=s.cid;d!==void 0&&(Ci(a,16),Ci(a,d));let h=s.cname;h!==void 0&&(Ci(a,26),cg(a,h));let m=s.deviceId;m!==void 0&&(Ci(a,34),cg(a,m));let y=s.elapse;y!==void 0&&(Ci(a,40),lg(a,y));let v=s.fileSize;v!==void 0&&(Ci(a,48),lg(a,CS(v)));let T=s.height;T!==void 0&&(Ci(a,56),lg(a,CS(T)));let R=s.jpg;R!==void 0&&(Ci(a,66),Ci(a,R.length),h$(a,R));let P=s.networkType;P!==void 0&&(Ci(a,72),lg(a,CS(P)));let D=s.osType;D!==void 0&&(Ci(a,80),lg(a,CS(D)));let G=s.requestId;G!==void 0&&(Ci(a,90),cg(a,G));let F=s.sdkVersion;F!==void 0&&(Ci(a,98),cg(a,F));let W=s.sequence;W!==void 0&&(Ci(a,104),lg(a,CS(W)));let Q=s.sid;Q!==void 0&&(Ci(a,114),cg(a,Q));let ee=s.timestamp;ee!==void 0&&(Ci(a,120),lg(a,ee));let fe=s.uid;fe!==void 0&&(Ci(a,128),Ci(a,fe));let ye=s.vid;ye!==void 0&&(Ci(a,136),Ci(a,ye));let ve=s.width;ve!==void 0&&(Ci(a,144),lg(a,CS(ve)));let _e=s.service;_e!==void 0&&(Ci(a,152),Ci(a,_e));let Ne=s.callbackData;Ne!==void 0&&(Ci(a,162),Ci(a,Ne.length),h$(a,Ne));let Je=s.ticket;Je!==void 0&&(Ci(a,170),cg(a,Je));let ft=s.vendorConfigs;ft!==void 0&&(Ci(a,178),cg(a,ft))}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function S_e(t){return function(s){let a={};e:for(;!w_e(s);){let c=rw(s);switch(c>>>3){case 0:break e;case 1:a.code=rw(s);break;case 2:a.msg=p$(s,rw(s));break;case 3:a.requestId=p$(s,rw(s));break;case 4:a.timestamp=C_e(s,!1);break;default:b_e(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function b_e(t,r){switch(r){case 0:for(;128&Hu(t););break;case 2:YM(t,rw(t));break;case 5:YM(t,4);break;case 1:YM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function CS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let T_e=[];function YM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function w_e(t){return t.offset>=t.limit}function iO(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function d$(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function h$(t,r){let s=iO(t,r.length);t.bytes.set(r,s)}function p$(t,r){let s=d$(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,T,R,P=c[m+s];(128&P)==0?h+=a(P):(224&P)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&P)<<6|63&y,R<128?h+=d:(h+=a(R),m++))):(240&P)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=a(R),m+=2))):(248&P)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],T=c[m+s+3],(12632256&(y|v<<8|T<<16))!=8421504?h+=d:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&T,R<65536||R>1114111?h+=d:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function cg(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Ci(t,a);let c=iO(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function Hu(t){return t.bytes[d$(t,1)]}function f$(t,r){let s=iO(t,1);t.bytes[s]=r}function rw(t){let r,s=0,a=0;do r=Hu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Ci(t,r){for(r>>>=0;r>=128;)f$(t,127&r|128),r>>>=7;f$(t,r)}function C_e(t,r){let s,a=0,c=0,d=0;return s=Hu(t),a=127&s,128&s&&(s=Hu(t),a|=(127&s)<<7,128&s&&(s=Hu(t),a|=(127&s)<<14,128&s&&(s=Hu(t),a|=(127&s)<<21,128&s&&(s=Hu(t),c=127&s,128&s&&(s=Hu(t),c|=(127&s)<<7,128&s&&(s=Hu(t),c|=(127&s)<<14,128&s&&(s=Hu(t),c|=(127&s)<<21,128&s&&(s=Hu(t),d=127&s,128&s&&(s=Hu(t),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:r}}function lg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=iO(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const m$={},g$={},sO=4294967296,R_e=sO*sO,I_e=R_e/2;y$(0,!0);const _$=y$(0),A_e=iw(0,-2147483648,!1),P_e=iw(-1,2147483647,!1);function y$(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=g$[t],a)?a:(s=iw(t,0,!0),c&&(g$[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=m$[t],a)?a:(s=iw(t,t<0?-1:0,!1),c&&(m$[t]=s),s)}function iw(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function E$(t,r){if(isNaN(t))return _$;{if(t<=-9223372036854776e3)return A_e;if(t+1>=I_e)return P_e}return t<0?_$:iw(t%sO|0,t/sO|0,r)}function v$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class XM extends Gr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Gd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),q(this,"name","AgoraRTCImageModeration"),q(this,"_connectionState",Yl.CONNECTING),q(this,"_sequence",0),q(this,"_moderationStartTime",void 0),q(this,"_workerConnection",void 0),q(this,"_workerMessageLengthLimit",void 0),q(this,"_qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",Ta.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"_moderationInterval",void 0),q(this,"_moderationTimer",null),q(this,"_moderationMode",1),q(this,"_quality",1),q(this,"_qualityTimer",null),q(this,"_ticket",void 0),q(this,"_moderationIntervalMinimum",void 0),q(this,"_uploadFailedNum",0),q(this,"_uploadNum",0),q(this,"_uploadTimer",null),q(this,"_extraInfo",void 0),q(this,"_vendor",""),q(this,"_encoder",new TextEncoder),q(this,"_moderationId",void 0),q(this,"inspectImage",()=>{if(this.connectionState!==Yl.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Yl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=yr(5,"image-moderation-"),this._workerMessageLengthLimit=ae("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=ae("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=ae("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new KT("worker-"+this._moderationId,Li),this.on(Gd.STATE_CHANGE,(a,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(fS[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Gd.STATE_CHANGE,fS.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new pt((c,d)=>{this.on(Gd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Yl.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Yl.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=ae("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),d=await function(y,v,T,R){let{appId:P,areaCode:D,cname:G,sid:F,token:W,uid:Q}=v;vS++;const ee="moderation_plugin",fe={service_name:ee,json_body:JSON.stringify({appId:P,areaCode:D,cname:G,command:"allocateEdge",requestId:vS,seq:vS,sid:F,appToken:W,ts:Date.now(),uid:Q+""})};let ye,ve,_e=y[0];return Fd(async()=>{ye=Date.now();const Ne=await Hd(_e,{data:fe,cancelToken:T,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ve=Date.now()-ye,Ne.code!==0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:ve});throw x.error(yt.toString()),yt}const Je=JSON.parse(Ne.json_body);if(Je.code!==200){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Je.code,", reason: ").concat(Je.reason),{code:Je.code,responseTime:ve});throw x.error(yt.toString()),yt}if(!Je.servers||!Array.isArray(Je.servers)||Je.servers.length===0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Je.code,responseTime:ve});throw x.error(yt.toString()),yt}if(!Je.servers.some(yt=>!!yt.wss)){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Je.code,responseTime:ve});throw x.error(yt.toString()),yt}const ft=ae("IMAGE_MODERATION_WORKER_HOST");return{addressList:Je.servers.map(yt=>{let{address:An,wss:Pn}=yt;if(An&&Pn)return"wss://".concat(An.replace(/\./g,"-"),".").concat(ft,":").concat(Pn,"/moderation")}).filter(yt=>!!yt),workerToken:Je.workerToken,vid:Je.vid,ticket:Je.appTicket,responseTime:ve}},(Ne,Je)=>(Ot.apworkerEvent(F,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Je===0,responseTime:ve,serverIp:y[Je%y.length]}),!1),(Ne,Je)=>(Ot.apworkerEvent(F,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:ve,serverIp:y[Je%y.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(_e=y[(Je+1)%y.length],!0)),R)}(c,r,s,a);this.emit(Gd.STATE_CHANGE,fS.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(Gd.STATE_CHANGE,fS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(tn.CONNECTED,async()=>{this.emit(Gd.STATE_CHANGE,fS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Yl.CONNECTED}),this._workerConnection.on(tn.CLOSED,()=>{this.connectionState=Yl.CLOSED}),this._workerConnection.on(tn.FAILED,()=>{this.connectionState=Yl.CLOSED}),this._workerConnection.on(tn.RECONNECTING,()=>{this.connectionState=this.connectionState===Yl.CONNECTED?Yl.RECONNECTING:Yl.CONNECTING}),this._workerConnection.on(tn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=S_e(new Uint8Array(r.data));ae("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ot.reportApiInvoke(this._connectInfo.sid||null,{name:xi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Xr.TRACER}).onError(new Ae(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},ae("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(tn.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this._workerConnection.on(tn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=il(this,Gd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(ae("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else ae("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),T=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await $8(T,a,c),P=this._sequence+"-"+d+"-"+y+"-"+v+"-"+yr(12,""),D={appId:a,cid:d,cname:c,deviceId:"",elapse:XM.intToLong(Number(v-this._moderationStartTime)),fileSize:T.buffer.byteLength,height:T.height,width:T.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:E$(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const G=v_e(D);if(G.byteLength<this._workerMessageLengthLimit){if(ae("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const F=function(W){for(var Q=1;Q<arguments.length;Q++){var ee=arguments[Q]!=null?arguments[Q]:{};Q%2?v$(Object(ee),!0).forEach(function(fe){q(W,fe,ee[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(ee)):v$(Object(ee)).forEach(function(fe){Object.defineProperty(W,fe,Object.getOwnPropertyDescriptor(ee,fe))})}return W}({},D);delete F.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(F))}return G}{const F=this.quality*this._qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ta.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Yl.CLOSED,this.emit(Gd.STATE_CHANGE,fS.CLOSED)}}function S$(t){if(ur(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Ae(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const O_e={name:"ImageModeration",create:function(t){let{config:r}=t;return S$(r),new XM(r)}};var b$,T$,w$,C$,R$,I$,A$,P$,O$,k$,N$,D$,x$,L$,M$,U$,V$,j$,F$,B$,W$,z$,G$,H$,$$,K$,q$,Y$,X$,J$,Q$,Z$,e7,t7,n7,r7,i7,s7,o7,a7,c7,gt;function l7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function $u(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?l7(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}Ys.setLogger(x);let k_e=(b$=Ht(),T$=Ht({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof oS))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),w$=Ht({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==sS.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),C$=Ht({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),R$=Ht({argsMap:(t,r,s)=>[r,s]}),I$=Ht({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),A$=Ht({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),P$=Ht({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),O$=Ht(),k$=Ht(),N$=Ht(),D$=Ht(),x$=Ht(),L$=Ht(),M$=Ht(),U$=Ht(),V$=Ht(),j$=Ht(),F$=Ht(),B$=Ht(),W$=Ht(),z$=Ht(),G$=Ht(),H$=Ht({argsMap:(t,r)=>[r]}),$$=Ht(),K$=Ht(),q$=Ht(),Y$=Ht(),X$=Ht(),J$=Ht(),Q$=Ht(),Z$=Ht(),e7=Ht({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),t7=Ht(),n7=Ht(),r7=Ht(),i7=Ht(),s7=Ht(),o7=Ht(),a7=Ht({reportResult:!0}),c7=Ht(),gt=class extends Gr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),q(this,"store",void 0),q(this,"_uid",void 0),q(this,"_channelName",void 0),q(this,"_uintUid",void 0),q(this,"_users",[]),q(this,"_config",void 0),q(this,"_clientId",void 0),q(this,"_appId",void 0),q(this,"_sessionId",null),q(this,"_key",void 0),q(this,"_rtmConfig",{}),q(this,"_joinInfo",void 0),q(this,"_gateway",void 0),q(this,"_statsCollector",void 0),q(this,"_configDistribute",void 0),q(this,"_leaveMutex",void 0),q(this,"_publishMutex",void 0),q(this,"_renewTokenMutex",void 0),q(this,"_subscribeMutex",void 0),q(this,"_encryptionMode","none"),q(this,"_encryptionSecret",null),q(this,"_encryptionSalt",null),q(this,"_encryptDataStream",!1),q(this,"_encryptDataStreamKey",null),q(this,"_encryptDataStreamIv",null),q(this,"_proxyServer",void 0),q(this,"_turnServer",{servers:[],mode:"auto"}),q(this,"_cloudProxyServerMode","disabled"),q(this,"_isDualStreamEnabled",!1),q(this,"_defaultStreamFallbackType",void 0),q(this,"_lowStreamParameter",void 0),q(this,"_streamFallbackTypeCacheMap",new Map),q(this,"_remoteStreamTypeCacheMap",new Map),q(this,"_axiosCancelSource",Ta.CancelToken.source()),q(this,"_audioVolumeIndicationInterval",void 0),q(this,"_networkQualityInterval",void 0),q(this,"_userOfflineTimeout",void 0),q(this,"_streamRemovedTimeout",void 0),q(this,"_liveTranscodeStreamingClient",void 0),q(this,"_liveRawStreamingClient",void 0),q(this,"_channelMediaRelayClient",void 0),q(this,"_networkQualitySensitivity","normal"),q(this,"_p2pChannel",void 0),q(this,"_useLocalAccessPoint",!1),q(this,"_setLocalAPVersion",void 0),q(this,"_joinAndNotLeaveYet",!1),q(this,"_numberOfJoinCount",0),q(this,"_remoteDefaultVideoStreamType",void 0),q(this,"_inspect",void 0),q(this,"_moderation",void 0),q(this,"_license",void 0),q(this,"_pendingPublishedUsers",[]),q(this,"ntpAlignErrorCount",0),q(this,"remoteInboundOffset",0),q(this,"_peerConnectionState",void 0),q(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),q(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),q(this,"_handleUserOnline",c=>{if(ae("BLOCK_LOCAL_CLIENT")&&oy(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(Tn.USER_JOINED,d));else{const h=new og(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(Tn.USER_JOINED,h)}}),q(this,"_handleUserOffline",c=>{if(ae("BLOCK_LOCAL_CLIENT")&&oy(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:aP(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Tn.USER_LEAVED,d,c.reason))}),q(this,"_handleAddAudioOrVideoStream",(c,d,h,m,y,v,T)=>{if(ae("BLOCK_LOCAL_CLIENT")&&oy(d,this.channelName))return;const R=this._users.find(D=>D.uid===d);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||d),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),T!==void 0&&(R._rtxSsrcId=T),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(Tn.USER_PUBLISHED,R,c)),c==="video"?Ot.onGatewayStream(this._sessionId,es.ON_ADD_VIDEO_STREAM,Fr.ON_ADD_VIDEO_STREAM,{peer:y||d,ssrc:R._videoSSRC}):Ot.onGatewayStream(this._sessionId,es.ON_ADD_AUDIO_STREAM,Fr.ON_ADD_AUDIO_STREAM,{peer:y||d,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof nw))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),q(this,"_handleRemoveStream",c=>{if(ae("BLOCK_LOCAL_CLIENT")&&oy(c.uid,this.channelName))return;const d=this._users.find(m=>m.uid===c.uid);if(!d)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Tn.USER_UNPUBLISHED,d,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Tn.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(Tn.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(Tn.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof nw&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Ot.onGatewayStream(this._sessionId,es.ON_REMOVE_STREAM,Fr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),q(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(ae("BLOCK_LOCAL_CLIENT")&&oy(d,this.channelName))return;const m=this._users.find(T=>T.uid===d);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const T=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===T)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,d,R)}}else{m._trust_video_enabled_state_=!0;const T=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===T)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,d,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(Tn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(Tn.USER_UNPUBLISHED,m,c)):void 0}),q(this,"_handleMuteStream",(c,d,h)=>{if(ae("BLOCK_LOCAL_CLIENT")&&oy(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find(T=>T.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const T=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===T)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const T=m._video_muted_;if(m._video_muted_=h,m._video_muted_===T)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,c,R)}}const v=d==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(Tn.USER_PUBLISHED,m,d)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(Tn.USER_UNPUBLISHED,m,d)}}),q(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),q(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Tn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),q(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),q(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Tn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Tn.NETWORK_QUALITY,c)}),q(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,m)=>{const y=this._users.find(T=>T.uid===d);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(Tn.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(T=>{x.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._config=t,this._clientId=r||yr(5,"client-"),this.store=new class{constructor(c,d,h,m){Jt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Z_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case wn.SET_SESSION_ID:return bt(bt({},d),{},{sessionId:h.sessionId});case wn.SET_P2P_ID:return bt(bt({},d),{},{p2pId:h.p2pId});case wn.SET_UID:return bt(bt({},d),{},{uid:h.uid});case wn.SET_INT_UID:return bt(bt({},d),{},{intUid:h.intUid});case wn.SET_PUB_ID:return bt(bt({},d),{},{pubId:h.pubId});case wn.KEY_METRIC_CLIENT_CREATED:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{clientCreated:h.metric})});case wn.KEY_METRIC_JOIN_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinStart:h.metric})});case wn.AVOID_JOIN_START:return bt(bt({},d),{},{avoidJoinStart:h.avoidJoinStart});case wn.KEY_METRIC_JOIN_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinEnd:h.metric})});case wn.KEY_METRIC_REQUEST_AP_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{requestAPStart:h.metric})});case wn.KEY_METRIC_REQUEST_AP_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{requestAPEnd:h.metric})});case wn.KEY_METRIC_JOIN_GATEWAY_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case wn.KEY_METRIC_JOIN_GATEWAY_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case wn.KEY_METRIC_PEER_CONNECTION_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case wn.KEY_METRIC_PEER_CONNECTION_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case wn.KEY_METRIC_DESCRIPTION_START:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{descriptionStart:h.metric})});case wn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case wn.KEY_METRIC_ICE_CONNECTION_END:return bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case wn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=bt(bt({},m[y]),h.metric),bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{publish:[...m]})})):bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case wn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=bt(bt({},m[y]),h.metric),bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{subscribe:[...m]})})):bt(bt({},d),{},{keyMetrics:bt(bt({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case wn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case wn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=bt(bt({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case wn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case wn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case wn.SET_USE_P2P:return bt(bt({},d),{},{useP2P:h.val});case wn.SET_TRANSPORT_TYPE:return bt(bt({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set sessionId(c){this.dispatch({type:wn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:wn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:wn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:wn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:wn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:wn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:wn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:wn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:wn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:wn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:wn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:wn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:wn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:wn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:wn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:wn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:wn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:wn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:wn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:wn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:wn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:wn.KEY_METRIC_PUBLISH,metric:bt(bt({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,y,v,T){this.dispatch({type:wn.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt(bt(bt({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),T&&{firstDecoded:T})})}massSubscribe(c,d,h,m){c.forEach(y=>{this.dispatch({type:wn.KEY_METRIC_SUBSCRIBE,metric:bt(bt(bt({userId:y.userId,type:y.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:wn.RECORD_JOIN_CHANNEL_SERVICE,record:bt(bt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:wn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:wn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:wn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:wn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Ys("client-leave",this._clientId),this._publishMutex=new Ys("client-publish",this._clientId),this._renewTokenMutex=new Ys("client-renewtoken",this._clientId),this._subscribeMutex=new Ys("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat($l," build: ").concat(WL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{PL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new ew(this.store),this._statsCollector.onStatsException=(c,d,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(Tn.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&Ot.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Yge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Li,httpRetryConfig:t.httpRetryConfig||Li,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new s_e(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},Sf("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new nw(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];or("JOIN_GATEWAY_USE_443PORT_ONLY",d),or("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof SM&&(m.use443PortOnly=d,m.tryDoubleDomain=h),async function(y,v,T){nP.get(y)||nP.set(y,[]),rP.get(y)||rP.set(y,v),Uh.get(y)||Uh.set(y,0);const R=nP.get(y),P=rP.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Uh.get(y)===P){const Q=kT();R.push(Q),await Q.promise}Uh.set(y,Uh.get(y)+1);for(var D=arguments.length,G=new Array(D>3?D-3:0),F=3;F<D;F++)G[F-3]=arguments[F];const W=await T(...G);return Uh.set(y,Uh.get(y)-1),Uh.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),Uh.get(y)===0&&(nP.set(y,[]),rP.set(y,0),Uh.set(y,0)),W}("client.join",ae("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(uP||uP||(uP=(window.location.protocol.split(":")[0]||"").toUpperCase(),uP))==="HTTPS",m=o8()?window.isSecureContext:"Browser Not Support";(!o8()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Ot.setAppId(t);try{if(!s&&s!==null)throw new Ae(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Ss(s,"token",1,2047),Ss(t,"appid",1,2047),NP(r),a&&DP(a),c&&Ss(c,"optionalInfo",1,2047)}catch(F){throw Ot.reportApiInvoke(Q_(),{name:xi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Xr.TRACER}).onError(F),F}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const F=new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ot.reportApiInvoke(Q_(),{name:xi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Xr.TRACER}).onError(F),F}this._gateway.state="CONNECTING";const y=await s$({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||Q_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const T=Ot.reportApiInvoke(v,{id:this._clientId,name:xi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Xr.TRACER}),R=$u($u($u({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:ae("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(R.stringUid=a,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async F=>{const W=function(ye){const ve=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_e=new Uint8Array(new ArrayBuffer(ve.length));for(let Ne=0;Ne<ve.length;Ne+=1)_e[Ne]=ve.charCodeAt(Ne);return _e}(),Q=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=IL(F),fe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Q,ee);return function(ye){let ve="";for(let _e=0;_e<ye.length;_e+=1)ve+=String.fromCharCode(ye[_e]);return window.btoa(ve)}(new Uint8Array(fe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const F=new TextEncoder,W=ae("USE_PURE_ENCRYPTION_MASTER_KEY")?F.encode(R.appId+this._encryptionSecret+this._encryptionSecret):F.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Q,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),ve=Q==="aes-128-gcm2"?128:256,_e=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:g8,hash:"SHA-256",salt:fe},ye,ve+Cme);return new Uint8Array(_e).subarray(ve/8)}(this._encryptionMode,W,J_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Q,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),ve=Q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:g8,hash:"SHA-256",salt:fe},ye,{name:"AES-GCM",length:ve},!0,["encrypt","decrypt"])}(this._encryptionMode,W,J_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Ot.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let F;const W=R.cloudProxyServer;if(at(D=["proxy3","proxy4","proxy5"]).call(D,W)){const ve=ae("PROXY_SERVER_TYPE3");Array.isArray(ve)?R.proxyServer=ve[0]:R.proxyServer=ve}if(Ot.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),F={gatewayInfo:y.ap.gatewayInfo},ae("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ve=(await JH(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(_e=>({turnServerURL:_e.address,tcpport:_e.tcpport||Bs.tcpport,udpport:_e.udpport||Bs.udpport,username:_e.username||Bs.username,password:_e.password||Bs.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:ve}}c$(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let ve;[ve,F]=await pt.all([C9(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Li,this.store),w9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Li,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(ve)),R.uid=ve,F.gatewayInfo.uid=ve,F.gatewayInfo.res.uid=ve}else F=await w9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Li,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(HT.UPDATE_BITRATE_LIMIT,ve=>{this._p2pChannel.updateBitrateLimit(ve)}),this._configDistribute.on(HT.UPDATE_CLIENT_ROLE_OPTIONS,ve=>{this._setClientRoleOptions(ve)})},0),this._key=s||t;const Q=F.gatewayInfo,ee=R.uid?R.uid:Q.uid;this._joinInfo=$u($u({},R),{},{cid:Q.cid,uid:ee,vid:Q.vid,apResponse:Q.res,apGatewayAddress:Q.apGatewayAddress,uni_lbs_ip:Q.uni_lbs_ip,gatewayAddrs:Q.gatewayAddrs}),this.store.intUid=ee,this.store.cid=Q.cid;const fe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));T.onSuccess(fe),this._appId=t,this._channelName=R.cname,this._uid=fe,this.store.uid=fe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,at(sy).call(sy,G)||sy.push(G),this._cloudProxyServerMode==="disabled"&&Bn().supportWebCrypto&&ae("ENABLE_PRELOAD")&&qM(this._joinInfo),fe}catch(F){const W=Array.isArray(F)?F[0]:F;throw W&&W.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W):x.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W),W.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),T.onError(W),W}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Ae(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!ae("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=sy.indexOf(r);s!==-1&&sy.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Jn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof oS))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Ae(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Ae(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof oS))throw new Ae(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Ae(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Pr&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){ur(t.id,"id",0,65535,!0),ff(t.ordered,"ordered"),Ss(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Ae(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ae("FORCE_TURN")&&!ae("TURN_ENABLE_TCP")&&!ae("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return m9(c,!1)}(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ae(te.CREATE_DATACHANNEL_ERROR);try{await pt.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof oS))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(pi.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw x.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof og)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Ki(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Ae(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===Tt.AUDIO,a=r===Tt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new Ae(te.UNEXPECTED_RESPONSE,"no ssrc id");let T=this._users.find(P=>P.uid===t);T||(T=new og(t,v||t),T._is_pre_created=!0,this._users.push(T)),y&&(T._cname=y),T._uintid||(T._uintid=v||t),s&&(T._audioSSRC=d,T._audio_pre_subscribed=!0,h&&(T._audioOrtc=h)),a&&(T._videoSSRC=d,T._video_pre_subscribed=!0,h&&(T._videoOrtc=h),m!=null&&(T._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(T,r,d,m,h);const R=s?T._audioTrack:T._videoTrack;if(!R)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(T._trust_audio_stream_added_state_=!0,T._audio_added_=!0),a&&(T._trust_video_stream_added_state_=!0,T._video_added_=!0),R}catch(d){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(ur(r,"channelId",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Ae(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&at(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ae(te.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(Ki(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Ki(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Tt.AUDIO:Tt.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const T=r==="audio"?t._audioSSRC:t._videoSSRC;T!==void 0&&T!==c&&(c=T,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Tt.AUDIO:Tt.VIDEO,ssrcId:c}),Qs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(T){throw this._p2pChannel.reportSubscribeEvent(!1,T==null?void 0:T.code,t,r),T}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(T=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),T)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(mf(t,"subscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),d=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:T,mediaType:R}=v;if(Ki(R,"mediaType",["audio","video"]),!T){const F=new Ae(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===T)){const F=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(T.uid,", this user is not in the channel")),c[y].error=F,t.splice(y,1);continue}if(R==="audio"&&(!T.hasAudio||T._audioSSRC===void 0)||R==="video"&&(!T.hasVideo||T._videoSSRC===void 0)){const F=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(T.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=F,t.splice(y,1);continue}const D=ts.Video|ts.LwoVideo,G=s.get(T);if(G){if(R==="video"?G&D:G&ts.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(T.uid,", mediaType:").concat(R," twice"));continue}s.set(T,G|(R==="video"?D:ts.Audio))}else s.set(T,R==="video"?D:ts.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:T,mediaType:R}=v,P=ts.Video|ts.LwoVideo;if(this._p2pChannel.hasRemoteMedia(T,R)){await this._p2pChannel.unmuteRemoteNoLock(T,R);const D=s.get(T);s.set(T,R==="video"?D^P:D^ts.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=Sc(h=Array.from(s.entries())).call(h,(y,v)=>{let[T,R]=v;if(R===0)return y;const P={stream_id:T.uid,stream_type:R};return R&ts.Audio&&(P.audio_ssrc=T._audioSSRC),R&ts.Video&&(P.video_ssrc=T._videoSSRC),y.push(P),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:T,mediaType:R}=v;return{user:T,mediaType:R,ssrcId:R===Tt.VIDEO?T._videoSSRC:T._audioSSRC,rtxSsrcId:R===Tt.VIDEO?T._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(T=>{let{stream_id:R,video_error_code:P,audio_error_code:D,error_code:G}=T;(P||D||G)&&y.set(R,{video_error_code:P,audio_error_code:D,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(T=>{let[R,P]=T;const D=this.remoteUsers.find(G=>G.uid===R);if(D){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=Tt.VIDEO:P.audio_error_code&&(G=Tt.AUDIO),v.push({user:D,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const T=y.get(v.user.uid);if(T){const R=T.error_code||v.mediaType==="audio"&&T.audio_error_code||v.mediaType==="video"&&T.video_error_code;if(R){const P=$T(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(P.desc)),v.error=new Ae(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var T;Ot.subscribe(this.store.sessionId,{succ:!!v.error,ec:((T=v.error)===null||T===void 0?void 0:T.code)||null,video:v.mediaType===Tt.VIDEO,audio:v.mediaType===Tt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===Tt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:T,mediaType:R}=v;return"user: ".concat(T==null?void 0:T.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{d(),a()}}async unsubscribe(t,r,s){if(!(t instanceof og)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Ki(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&aP(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&ur(r,"id",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(mf(t,"unsubscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new Ae(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ki(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=ts.Video|ts.LwoVideo;if(r.has(a)){const m=r.get(a);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&ts.Audio;break;default:y=m&(ts.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|ts.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|ts.Audio|h)}else c?c==="audio"?r.set(a,ts.Audio):c==="video"&&r.set(a,h):r.set(a,ts.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);Yr(s.width)||CL(s.width,"streamParameter.width"),Yr(s.height)||CL(s.height,"streamParameter.height"),Yr(s.framerate)||CL(s.framerate,"streamParameter.framerate"),Yr(s.bitrate)||ur(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ye.LocalVideoLowTrack)}async enableDualStream(){if(!Bn().supportDualStream)throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ae(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ae(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ye.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Ot.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(a){Ki(a,"role",["audience","host"])}(t),r&&PL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ae(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Ae(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ae(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&ae("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",js.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&PL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Ss(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Ot.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}if(MT(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>qz(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"you should set license before join channel");if(Ss(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Ae(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Ae(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Ae(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Stop proxy server after leave channel");Ot.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Ae(te.INVALID_PARAMS,"accessPoints is required.");mf(t.accessPoints.serverList,"accessPoints.serverList"),Ss(t.accessPoints.domain,"accessPoints.domain");const r=(P,D)=>{ur(P,D,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");ae("CLOSE_AFB_FOR_LOCAL_AP")&&(or("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),or("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(P=>a.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=d.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,or("WEBCS_DOMAIN",h),or("WEBCS_DOMAIN_BACKUP_LIST",h),or("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(mf(t.report.hostname,"report.hostname"),or("EVENT_REPORT_DOMAIN",t.report.hostname[0]),or("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(or("EVENT_REPORT_DOMAIN",d[0]),or("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),or("STATS_COLLECTOR_PORT",m),t.report?or("ENABLE_EVENT_REPORT",!0):or("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(mf(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=d[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),or("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let T=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(mf(t.cds.hostname,"cds.hostname"),T=t.cds.hostname):T=d;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),or("CDS_AP",T.map(P=>"".concat(P,":").concat(R))),t.cds?or("ENABLE_CONFIG_DISTRIBUTE",!0):or("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(mf(t,"serverList"),Ss(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,or("WEBCS_DOMAIN",t),or("WEBCS_DOMAIN_BACKUP_LIST",t),or("GATEWAY_DOMAINS",[r]),or("EVENT_REPORT_DOMAIN",t[0]),or("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),or("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Ki(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Ki(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(a=>a.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Ki(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(d){Ki(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ss(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(at(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Ae(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(ff(a,"encryptDataStream"),!at(c).call(c,t))throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Qm(s))}async renewToken(t){if(Ss(t,"token",1,2047),!this._key||!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(ae("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await i_e(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Li);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(Tn.VOLUME_INDICATOR,t)},ae("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Ae(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?yf.TRANSCODE:yf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(yf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Ae(te.INVALID_PARAMS,"can not find live streaming url to stop");await pt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){N9(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){N9(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof nw&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&at(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await async function(c,d,h){var m;const y=Sc(m=Array.from(h)).call(m,(F,W)=>F+W,0),v={serverTs:0,seq:Rme++,length:h.length,checkSum:y},T=new Uint8Array(n8(y,2)),R=new ArrayBuffer(Zv),P=new DataView(R);P.setUint32(0,v.serverTs),P.setUint16(4,v.seq),P.setUint16(6,v.length),P.setUint16(8,v.checkSum);const D=16-h.length%16;h=Jz(h,new Uint8Array(D));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:m8,additionalData:T},d,h);return Jz(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Ae(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Kt.DATA_STREAM,{payload:Qm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-p_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Ae(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Kt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Qm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Lme),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send custom report, not joined");await Ot.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Ki(r.spatialLayer,"spatialLayer",[0,1,2,3]),Ki(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(ff(r,"apRTM"),ur(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=hS.indexOf(t);r!==-1&&hS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ta.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&a$(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ot.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ys("client-publish",this._clientId),this._subscribeMutex=new Ys("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||Q_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(a)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,Ot.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Ot.sessionInit(this._sessionId,$u({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ae("FORCE_TURN")&&!ae("TURN_ENABLE_TCP")&&!ae("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(pi.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Pr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Ae(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Sf("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{Ot.reportApiInvoke(this._sessionId,{name:xi.ON_LIVE_STREAM_ERROR,options:[c,d],tag:Xr.TRACER}).onSuccess(),this.safeEmit(Tn.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Ot.reportApiInvoke(this._sessionId,{name:xi.ON_LIVE_STREAM_WARNING,options:[c,d],tag:Xr.TRACER}).onSuccess(),this.safeEmit(Tn.LIVE_STREAMING_WARNING,c,d)},s.on(EM.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Ae(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,T){const R=ae("UAP_AP").slice(0,ae("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Qge(R,m,y,v,T)})(c,this._joinInfo,this._axiosCancelSource.token,Li).then(d).catch(h)}),s};return t===yf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ae(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},Sf("ChannelMediaRelay").create(t));a.on("state",c=>{c===tc.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(Tn.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(Tn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:T}=d,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),at(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===d.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:v,metadata:T},D=function(G){return m9(G,!0)}(P);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(Tn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,d.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,d.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(Tn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h,stream_id:m}=d,y=this._users.find(T=>T._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(T=>T.id===d.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(T=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),T)return this._gateway.unsubscribeDataChannel(T,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(Tn.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(Tn.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(gs.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(a=>{const{value:c,type:d,expires:h}=r[a];h&&h<=s||d||hM()||!Object.prototype.hasOwnProperty.call(pP,a)||(Bd[a]=c,Ar[a]=c,x.debug("Update gateway parameters from config distribute",a,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(gs.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(gs.CONNECTION_STATE_CHANGE,(t,r,s)=>{var a;if(s===Jn.FALLBACK)return;const c=()=>{this.safeEmit(Tn.CONNECTION_STATE_CHANGE,t,r,s)};if(Ot.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:xi.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Xr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Tt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Tt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(gs.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Ae(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await s$($u($u({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,c$(a),this._joinInfo.preload=!0):(s=await LM(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Li,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(gs.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Tn.NETWORK_QUALITY,t)}),this._gateway.on(gs.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(Tn.STREAM_TYPE_CHANGED,t,r),Ot.reportApiInvoke(this._sessionId,{name:xi.STREAM_TYPE_CHANGE,options:[t,r],tag:Xr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(gs.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(gs.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();ae("ENABLE_PREALLOC_PC")&&a||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}}),this._gateway.on(gs.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const a=r9(t.ortc,r,s);this._p2pChannel.connect(a)}),this._gateway.on(gs.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var a;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:d}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(d,"_").concat(c),icePwd:"".concat(d,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=ae("FINGERPRINT"))!==null&&a!==void 0?a:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Cn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Cn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Cn.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Cn.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Cn.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Cn.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Cn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Cn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Cn.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Tt.AUDIO,!0)),this._gateway.signal.on(Cn.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Tt.AUDIO,!1)),this._gateway.signal.on(Cn.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Tt.VIDEO,!0)),this._gateway.signal.on(Cn.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Tt.VIDEO,!1)),this._gateway.signal.on(Cn.RECEIVE_METADATA,t=>{const r=J_(t.metadata);this.safeEmit(Tn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(Cn.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=J_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&at(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Zv)throw new Ae(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Zv));s=await async function(d,h,m){const y=m.subarray(0,Zv),v=y.slice(8,Zv),T=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:m8,additionalData:new Uint8Array(n8(T,2))},h,m.subarray(Zv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),m_e($u($u({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Cn.ON_CRYPT_ERROR,()=>{Jm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Tn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Cn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Jn.TOKEN_EXPIRE),this.safeEmit(Tn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Cn.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(Tn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Cn.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Cn.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Cn.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Yt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Kt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const d=c.some(y=>{let{stream_type:v}=y;return v===Zn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==Zn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===Zn.Screen||v===Zn.ScreenLow});r.state==="offer"&&Ot.publish(this._joinInfo.sid,{eventElapse:Qs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find(y=>{let{stream_type:v}=y;return v===Zn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(y=>{let{stream_type:v}=y;return v!==Zn.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Kt.SUBSCRIBE:r&&Ot.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===Tt.AUDIO,video:r.stream_type===Tt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Qs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(Cn.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Cn.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;ae("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!oy(a.string_id||a.stream_id,this.channelName)));const r=[],s=[];for(const a of t.users){let c=this._users.find(T=>T._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new og(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(Tn.USER_JOINED,c)));const d=ts.Audio&a.stream_type,h=(ts.Video|ts.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,y=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!y&&this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Tn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Tn.USER_PUBLISHED,c,"video")),(d&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(Tn.PUBLISHED_USER_LIST).length>0?ae("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(a=>a.uid).join(", "))),this.safeEmit(Tn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(Cn.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof nw&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var a;return at(a=Object.keys(fP)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Cn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(pi.PUBLISH,(t,r,s)=>{const{uid:a}=t;t.forEach(c=>{const{kind:d,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,m);const v=this._users.find(T=>T.uid===a);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(a,d,!!y)})}),this._gateway.signal.on(pi.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Yt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(pi.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,d=this._users.find(h=>h.uid===c);if(!d)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach(async h=>{let{stream_type:m}=h;const y=m===Zn.Audio?Tt.AUDIO:Tt.VIDEO;await this._p2pChannel.unsubscribe(d,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(pi.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case tg.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Tt.VIDEO,!0);break;case tg.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Tt.AUDIO,!0);break;case tg.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Tt.VIDEO,!1);break;case tg.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Tt.AUDIO,!1)}}),this._gateway.signal.on(pi.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==Zo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}}),this._gateway.signal.on(pi.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Vt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(pi.RESTART_ICE,t,a===Zo.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(Vt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(pi.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Vt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(pi.CONTROL,t,!0),r()}catch(a){s(a)}}),this._p2pChannel.on(Vt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.StateChange,(t,r)=>{r===Qn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Vt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(Tn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Vt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(Vt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestRePublishDataChannel,(t,r,s)=>{pt.all(t.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==te.DISCONNECT_P2P)throw d}})).then(r).catch(s)}),this._p2pChannel.on(Vt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===Tt.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}}),this._p2pChannel.on(Vt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Vt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Vt.MediaReconnectStart,t=>{this.safeEmit(Tn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Vt.MediaReconnectEnd,t=>{this.safeEmit(Tn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Vt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Vt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:d}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(Vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Vt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=r9(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Vt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(Vt.P2PLost,()=>{this.safeEmit(Tn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Vt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Vt.ConnectionTypeChange,t=>{this.safeEmit(Tn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Vt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Vt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Vt.AudioMetadata,t=>{this.safeEmit(Tn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},Sf("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:y,vid:v?Number(v):0},Li)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(_s.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Tn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Wu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Tn.CONTENT_INSPECT_ERROR,new Ae(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(_s.INSPECT_RESULT,(r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(Tn.CONTENT_INSPECT_RESULT,r,s)}),t.on(_s.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(ff(t,"enabled"),t){if(!r)throw new Ae(te.INVALID_PARAMS,"config is required");if(S$(r),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},Sf("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:m,uid:y,cid:v,vid:T}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:y,cid:v,vid:T?Number(T):0},Li)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(Gd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Tn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Yl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ae(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Gd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Ki(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Ae(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){ff(t,"enabled"),or("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},It(gt.prototype,"leave",[b$],Object.getOwnPropertyDescriptor(gt.prototype,"leave"),gt.prototype),It(gt.prototype,"publish",[T$],Object.getOwnPropertyDescriptor(gt.prototype,"publish"),gt.prototype),It(gt.prototype,"unpublish",[w$],Object.getOwnPropertyDescriptor(gt.prototype,"unpublish"),gt.prototype),It(gt.prototype,"subscribe",[C$],Object.getOwnPropertyDescriptor(gt.prototype,"subscribe"),gt.prototype),It(gt.prototype,"presubscribe",[R$],Object.getOwnPropertyDescriptor(gt.prototype,"presubscribe"),gt.prototype),It(gt.prototype,"massSubscribe",[I$],Object.getOwnPropertyDescriptor(gt.prototype,"massSubscribe"),gt.prototype),It(gt.prototype,"unsubscribe",[A$],Object.getOwnPropertyDescriptor(gt.prototype,"unsubscribe"),gt.prototype),It(gt.prototype,"massUnsubscribe",[P$],Object.getOwnPropertyDescriptor(gt.prototype,"massUnsubscribe"),gt.prototype),It(gt.prototype,"setLowStreamParameter",[O$],Object.getOwnPropertyDescriptor(gt.prototype,"setLowStreamParameter"),gt.prototype),It(gt.prototype,"enableDualStream",[k$],Object.getOwnPropertyDescriptor(gt.prototype,"enableDualStream"),gt.prototype),It(gt.prototype,"disableDualStream",[N$],Object.getOwnPropertyDescriptor(gt.prototype,"disableDualStream"),gt.prototype),It(gt.prototype,"setClientRole",[D$],Object.getOwnPropertyDescriptor(gt.prototype,"setClientRole"),gt.prototype),It(gt.prototype,"_setClientRoleOptions",[x$],Object.getOwnPropertyDescriptor(gt.prototype,"_setClientRoleOptions"),gt.prototype),It(gt.prototype,"setProxyServer",[L$],Object.getOwnPropertyDescriptor(gt.prototype,"setProxyServer"),gt.prototype),It(gt.prototype,"setTurnServer",[M$],Object.getOwnPropertyDescriptor(gt.prototype,"setTurnServer"),gt.prototype),It(gt.prototype,"setLicense",[U$],Object.getOwnPropertyDescriptor(gt.prototype,"setLicense"),gt.prototype),It(gt.prototype,"startProxyServer",[V$],Object.getOwnPropertyDescriptor(gt.prototype,"startProxyServer"),gt.prototype),It(gt.prototype,"stopProxyServer",[j$],Object.getOwnPropertyDescriptor(gt.prototype,"stopProxyServer"),gt.prototype),It(gt.prototype,"setLocalAccessPointsV2",[F$],Object.getOwnPropertyDescriptor(gt.prototype,"setLocalAccessPointsV2"),gt.prototype),It(gt.prototype,"setLocalAccessPoints",[B$],Object.getOwnPropertyDescriptor(gt.prototype,"setLocalAccessPoints"),gt.prototype),It(gt.prototype,"setRemoteDefaultVideoStreamType",[W$],Object.getOwnPropertyDescriptor(gt.prototype,"setRemoteDefaultVideoStreamType"),gt.prototype),It(gt.prototype,"setRemoteVideoStreamType",[z$],Object.getOwnPropertyDescriptor(gt.prototype,"setRemoteVideoStreamType"),gt.prototype),It(gt.prototype,"setStreamFallbackOption",[G$],Object.getOwnPropertyDescriptor(gt.prototype,"setStreamFallbackOption"),gt.prototype),It(gt.prototype,"setEncryptionConfig",[H$],Object.getOwnPropertyDescriptor(gt.prototype,"setEncryptionConfig"),gt.prototype),It(gt.prototype,"renewToken",[$$],Object.getOwnPropertyDescriptor(gt.prototype,"renewToken"),gt.prototype),It(gt.prototype,"enableAudioVolumeIndicator",[K$],Object.getOwnPropertyDescriptor(gt.prototype,"enableAudioVolumeIndicator"),gt.prototype),It(gt.prototype,"startLiveStreaming",[q$],Object.getOwnPropertyDescriptor(gt.prototype,"startLiveStreaming"),gt.prototype),It(gt.prototype,"setLiveTranscoding",[Y$],Object.getOwnPropertyDescriptor(gt.prototype,"setLiveTranscoding"),gt.prototype),It(gt.prototype,"stopLiveStreaming",[X$],Object.getOwnPropertyDescriptor(gt.prototype,"stopLiveStreaming"),gt.prototype),It(gt.prototype,"startChannelMediaRelay",[J$],Object.getOwnPropertyDescriptor(gt.prototype,"startChannelMediaRelay"),gt.prototype),It(gt.prototype,"updateChannelMediaRelay",[Q$],Object.getOwnPropertyDescriptor(gt.prototype,"updateChannelMediaRelay"),gt.prototype),It(gt.prototype,"stopChannelMediaRelay",[Z$],Object.getOwnPropertyDescriptor(gt.prototype,"stopChannelMediaRelay"),gt.prototype),It(gt.prototype,"sendCustomReportMessage",[e7],Object.getOwnPropertyDescriptor(gt.prototype,"sendCustomReportMessage"),gt.prototype),It(gt.prototype,"pickSVCLayer",[t7],Object.getOwnPropertyDescriptor(gt.prototype,"pickSVCLayer"),gt.prototype),It(gt.prototype,"setRTMConfig",[n7],Object.getOwnPropertyDescriptor(gt.prototype,"setRTMConfig"),gt.prototype),It(gt.prototype,"enableContentInspect",[r7],Object.getOwnPropertyDescriptor(gt.prototype,"enableContentInspect"),gt.prototype),It(gt.prototype,"disableContentInspect",[i7],Object.getOwnPropertyDescriptor(gt.prototype,"disableContentInspect"),gt.prototype),It(gt.prototype,"setImageModeration",[s7],Object.getOwnPropertyDescriptor(gt.prototype,"setImageModeration"),gt.prototype),It(gt.prototype,"setP2PTransport",[o7],Object.getOwnPropertyDescriptor(gt.prototype,"setP2PTransport"),gt.prototype),It(gt.prototype,"getJoinChannelServiceRecords",[a7],Object.getOwnPropertyDescriptor(gt.prototype,"getJoinChannelServiceRecords"),gt.prototype),It(gt.prototype,"setPublishAudioFilterEnabled",[c7],Object.getOwnPropertyDescriptor(gt.prototype,"setPublishAudioFilterEnabled"),gt.prototype),gt);class sw{constructor(r,s){q(this,"id",0),q(this,"element",void 0),q(this,"peerPair",void 0),q(this,"context",void 0),q(this,"audioPlayerElement",void 0),q(this,"audioTrack",void 0),sw.count+=1,this.id=sw.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new pt(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new Ae(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Ae(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Ae(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var u7,oO;q(sw,"count",0);const N_e=window.AudioContext||window.webkitAudioContext,D_e=new(u7=Ht({report:Ot}),It((oO=class{constructor(){q(this,"units",[]),q(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new N_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new sw(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Ln().name!==Kn.SAFARI}}).prototype,"processExternalMediaAEC",[u7],Object.getOwnPropertyDescriptor(oO.prototype,"processExternalMediaAEC"),oO.prototype),oO);function d7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function h7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?d7(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const JM=window||document;function p7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!JM)return;const s=Mi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(Mi.onSecurityPolicyViolation||Mi.getListeners(zh.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;ae("CSP_DETECTED_HOSTNAME_LIST").some(h=>at(d).call(d,h))&&(Mi.onSecurityPolicyViolation&&typeof Mi.onSecurityPolicyViolation=="function"&&Mi.onSecurityPolicyViolation(c),Mi.getListeners(zh.SECURITY_POLICY_VIOLATION).length>0&&Mi.safeEmit(zh.SECURITY_POLICY_VIOLATION,c))};s&&JM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Mi.getListeners(zh.SECURITY_POLICY_VIOLATION).length>0)&&JM.addEventListener("securitypolicyviolation",a),Mi._cspEventHandlerPointer=a}var x_e=O,L_e=XW,f7=RegExp.prototype,M_e=function(t){return t===f7||x_e(f7,t)?L_e(t):t.flags},Ro=l(M_e);function RS(t){let r=t.length;for(;--r>=0;)t[r]=0}const QM=256,m7=286,ow=30,aw=15,ZM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),aO=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),g7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wf=new Array(576);RS(wf);const cw=new Array(60);RS(cw);const lw=new Array(512);RS(lw);const uw=new Array(256);RS(uw);const e2=new Array(29);RS(e2);const cO=new Array(ow);function t2(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let _7,y7,E7;function n2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}RS(cO);const v7=t=>t<256?lw[t]:lw[256+(t>>>7)],dw=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},fl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,dw(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},qh=(t,r,s)=>{fl(t,s[2*r],s[2*r+1])},S7=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},b7=(t,r,s)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=aw;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=S7(a[m]++,m))}},T7=t=>{let r;for(r=0;r<m7;r++)t.dyn_ltree[2*r]=0;for(r=0;r<ow;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},w7=t=>{t.bi_valid>8?dw(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},C7=(t,r,s,a)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&a[r]<=a[s]},r2=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&C7(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!C7(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},R7=(t,r,s)=>{let a,c,d,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?qh(t,c,r):(d=uw[c],qh(t,d+QM+1,r),h=ZM[d],h!==0&&(c-=e2[d],fl(t,c,h)),a--,d=v7(a),qh(t,d,s),h=aO[d],h!==0&&(a-=cO[d],fl(t,a,h)));while(m<t.sym_next);qh(t,256,r)},i2=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=a[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)r2(t,s,h);y=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],r2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,r2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((T,R)=>{const P=R.dyn_tree,D=R.max_code,G=R.stat_desc.static_tree,F=R.stat_desc.has_stree,W=R.stat_desc.extra_bits,Q=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let fe,ye,ve,_e,Ne,Je,ft=0;for(_e=0;_e<=aw;_e++)T.bl_count[_e]=0;for(P[2*T.heap[T.heap_max]+1]=0,fe=T.heap_max+1;fe<573;fe++)ye=T.heap[fe],_e=P[2*P[2*ye+1]+1]+1,_e>ee&&(_e=ee,ft++),P[2*ye+1]=_e,ye>D||(T.bl_count[_e]++,Ne=0,ye>=Q&&(Ne=W[ye-Q]),Je=P[2*ye],T.opt_len+=Je*(_e+Ne),F&&(T.static_len+=Je*(G[2*ye+1]+Ne)));if(ft!==0){do{for(_e=ee-1;T.bl_count[_e]===0;)_e--;T.bl_count[_e]--,T.bl_count[_e+1]+=2,T.bl_count[ee]--,ft-=2}while(ft>0);for(_e=ee;_e!==0;_e--)for(ye=T.bl_count[_e];ye!==0;)ve=T.heap[--fe],ve>D||(P[2*ve+1]!==_e&&(T.opt_len+=(_e-P[2*ve+1])*P[2*ve],P[2*ve+1]=_e),ye--)}})(t,r),b7(s,v,t.bl_count)},I7=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},A7=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<y&&c===h)){if(m<v)do qh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(qh(t,c,t.bl_tree),m--),qh(t,16,t.bl_tree),fl(t,m-3,2)):m<=10?(qh(t,17,t.bl_tree),fl(t,m-3,3)):(qh(t,18,t.bl_tree),fl(t,m-11,7));m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let P7=!1;const O7=(t,r,s,a)=>{fl(t,0+(a?1:0),3),w7(t),dw(t,s),dw(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var V_e=t=>{P7||((()=>{let r,s,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(e2[c]=a,r=0;r<1<<ZM[c];r++)uw[a++]=c;for(uw[a-1]=c,d=0,c=0;c<16;c++)for(cO[c]=d,r=0;r<1<<aO[c];r++)lw[d++]=c;for(d>>=7;c<ow;c++)for(cO[c]=d<<7,r=0;r<1<<aO[c]-7;r++)lw[256+d++]=c;for(s=0;s<=aw;s++)h[s]=0;for(r=0;r<=143;)wf[2*r+1]=8,r++,h[8]++;for(;r<=255;)wf[2*r+1]=9,r++,h[9]++;for(;r<=279;)wf[2*r+1]=7,r++,h[7]++;for(;r<=287;)wf[2*r+1]=8,r++,h[8]++;for(b7(wf,287,h),r=0;r<ow;r++)cw[2*r+1]=5,cw[2*r]=S7(r,5);_7=new t2(wf,ZM,257,m7,aw),y7=new t2(cw,aO,0,ow,aw),E7=new t2(new Array(0),U_e,0,19,7)})(),P7=!0),t.l_desc=new n2(t.dyn_ltree,_7),t.d_desc=new n2(t.dyn_dtree,y7),t.bl_desc=new n2(t.bl_tree,E7),t.bi_buf=0,t.bi_valid=0,T7(t)},j_e=(t,r,s,a)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<QM;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),i2(t,t.l_desc),i2(t,t.d_desc),h=(m=>{let y;for(I7(m,m.dyn_ltree,m.l_desc.max_code),I7(m,m.dyn_dtree,m.d_desc.max_code),i2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*g7[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?O7(t,r,s,a):t.strategy===4||d===c?(fl(t,2+(a?1:0),3),R7(t,wf,cw)):(fl(t,4+(a?1:0),3),((m,y,v,T)=>{let R;for(fl(m,y-257,5),fl(m,v-1,5),fl(m,T-4,4),R=0;R<T;R++)fl(m,m.bl_tree[2*g7[R]+1],3);A7(m,m.dyn_ltree,y-1),A7(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),R7(t,t.dyn_ltree,t.dyn_dtree)),T7(t),a&&w7(t)},F_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(uw[s]+QM+1)]++,t.dyn_dtree[2*v7(r)]++),t.sym_next===t.sym_end),B_e=t=>{fl(t,2,3),qh(t,256,wf),(r=>{r.bi_valid===16?(dw(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},W_e={_tr_init:V_e,_tr_stored_block:O7,_tr_flush_block:j_e,_tr_tally:F_e,_tr_align:B_e},hw=(t,r,s,a)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const z_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ta=(t,r,s,a)=>{const c=z_e,d=a+s;t^=-1;for(let h=a;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},my={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},lO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:G_e,_tr_stored_block:s2,_tr_flush_block:H_e,_tr_tally:ug,_tr_align:$_e}=W_e,{Z_NO_FLUSH:dg,Z_PARTIAL_FLUSH:K_e,Z_FULL_FLUSH:q_e,Z_FINISH:Ku,Z_BLOCK:k7,Z_OK:Aa,Z_STREAM_END:N7,Z_STREAM_ERROR:Yh,Z_DATA_ERROR:Y_e,Z_BUF_ERROR:o2,Z_DEFAULT_COMPRESSION:X_e,Z_FILTERED:J_e,Z_HUFFMAN_ONLY:uO,Z_RLE:Q_e,Z_FIXED:Z_e,Z_DEFAULT_STRATEGY:eye,Z_UNKNOWN:tye,Z_DEFLATED:dO}=lO,a2=286,nye=30,rye=19,iye=2*a2+1,sye=15,gy=258,Xh=262,IS=42,_y=113,pw=666,yy=(t,r)=>(t.msg=my[r],r),D7=t=>2*t-(t>4?9:0),hg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},oye=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let pg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Jl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},Ql=(t,r)=>{H_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Jl(t.strm)},si=(t,r)=>{t.pending_buf[t.pending++]=r},fw=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},c2=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=hw(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ta(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},x7=(t,r)=>{let s,a,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-Xh?t.strstart-(t.w_size-Xh):0,v=t.window,T=t.w_mask,R=t.prev,P=t.strstart+gy;let D=v[d+h-1],G=v[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===D&&v[s]===v[d]&&v[++s]===v[d+1]){d+=2,s++;do;while(v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&d<P);if(a=gy-(P-d),d=P-gy,a>h){if(t.match_start=r,h=a,a>=m)break;D=v[d+h-1],G=v[d+h]}}while((r=R[r&T])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},AS=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Xh)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),oye(t),a+=r),t.strm.avail_in===0)break;if(s=c2(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=pg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=pg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Xh&&t.strm.avail_in!==0)},L7=(t,r)=>{let s,a,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==Ku||r===dg||s!==a+t.strm.avail_in)))break;h=r===Ku&&s===a+t.strm.avail_in?1:0,s2(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Jl(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(c2(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==dg&&r!==Ku&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(c2(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=d||(a||r===Ku)&&r!==dg&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Ku&&t.strm.avail_in===0&&s===a?1:0,s2(t,t.block_start,s,h),t.block_start+=s,Jl(t.strm)),h?3:1)},l2=(t,r)=>{let s,a;for(;;){if(t.lookahead<Xh){if(AS(t),t.lookahead<Xh&&r===dg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=pg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Xh&&(t.match_length=x7(t,s)),t.match_length>=3)if(a=ug(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=pg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=pg(t,t.ins_h,t.window[t.strstart+1]);else a=ug(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(Ql(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Ku?(Ql(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ql(t,!1),t.strm.avail_out===0)?1:2},PS=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<Xh){if(AS(t),t.lookahead<Xh&&r===dg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=pg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Xh&&(t.match_length=x7(t,s),t.match_length<=5&&(t.strategy===J_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=ug(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=pg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(Ql(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=ug(t,0,t.window[t.strstart-1]),a&&Ql(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=ug(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Ku?(Ql(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ql(t,!1),t.strm.avail_out===0)?1:2};function Jh(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const mw=[new Jh(0,0,0,0,L7),new Jh(4,4,8,4,l2),new Jh(4,5,16,8,l2),new Jh(4,6,32,32,l2),new Jh(4,4,16,16,PS),new Jh(8,16,32,32,PS),new Jh(8,16,128,128,PS),new Jh(8,32,128,256,PS),new Jh(32,128,258,1024,PS),new Jh(32,258,258,4096,PS)];function aye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=dO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*iye),this.dyn_dtree=new Uint16Array(2*(2*nye+1)),this.bl_tree=new Uint16Array(2*(2*rye+1)),hg(this.dyn_ltree),hg(this.dyn_dtree),hg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(sye+1),this.heap=new Uint16Array(2*a2+1),hg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*a2+1),hg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const gw=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==IS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==_y&&r.status!==pw?1:0},M7=t=>{if(gw(t))return yy(t,Yh);t.total_in=t.total_out=0,t.data_type=tye;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?IS:_y,t.adler=r.wrap===2?0:1,r.last_flush=-2,G_e(r),Aa},U7=t=>{const r=M7(t);return r===Aa&&(s=>{s.window_size=2*s.w_size,hg(s.head),s.max_lazy_match=mw[s.level].max_lazy,s.good_match=mw[s.level].good_length,s.nice_match=mw[s.level].nice_length,s.max_chain_length=mw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},V7=(t,r,s,a,c,d)=>{if(!t)return Yh;let h=1;if(r===X_e&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==dO||a<8||a>15||r<0||r>9||d<0||d>Z_e||a===8&&h!==1)return yy(t,Yh);a===8&&(a=9);const m=new aye;return t.state=m,m.strm=t,m.status=IS,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,U7(t)};var cye=(t,r)=>{if(gw(t)||r>k7||r<0)return t?yy(t,Yh):Yh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===pw&&r!==Ku)return yy(t,t.avail_out===0?o2:Yh);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Jl(t),t.avail_out===0)return s.last_flush=-1,Aa}else if(t.avail_in===0&&D7(r)<=D7(a)&&r!==Ku)return yy(t,o2);if(s.status===pw&&t.avail_in!==0)return yy(t,o2);if(s.status===IS&&s.wrap===0&&(s.status=_y),s.status===IS){let c=dO+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=uO||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,fw(s,c),s.strstart!==0&&(fw(s,t.adler>>>16),fw(s,65535&t.adler)),t.adler=1,s.status=_y,Jl(t),s.pending!==0)return s.last_flush=-1,Aa}if(s.status===57){if(t.adler=0,si(s,31),si(s,139),si(s,8),s.gzhead)si(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),si(s,255&s.gzhead.time),si(s,s.gzhead.time>>8&255),si(s,s.gzhead.time>>16&255),si(s,s.gzhead.time>>24&255),si(s,s.level===9?2:s.strategy>=uO||s.level<2?4:0),si(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(si(s,255&s.gzhead.extra.length),si(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ta(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(si(s,0),si(s,0),si(s,0),si(s,0),si(s,0),si(s,s.level===9?2:s.strategy>=uO||s.level<2?4:0),si(s,3),s.status=_y,Jl(t),s.pending!==0)return s.last_flush=-1,Aa}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ta(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Jl(t),s.pending!==0)return s.last_flush=-1,Aa;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=ta(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ta(t.adler,s.pending_buf,s.pending-d,d)),Jl(t),s.pending!==0)return s.last_flush=-1,Aa;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,si(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ta(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ta(t.adler,s.pending_buf,s.pending-d,d)),Jl(t),s.pending!==0)return s.last_flush=-1,Aa;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,si(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ta(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Jl(t),s.pending!==0))return s.last_flush=-1,Aa;si(s,255&t.adler),si(s,t.adler>>8&255),t.adler=0}if(s.status=_y,Jl(t),s.pending!==0)return s.last_flush=-1,Aa}if(t.avail_in!==0||s.lookahead!==0||r!==dg&&s.status!==pw){let c=s.level===0?L7(s,r):s.strategy===uO?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(AS(d),d.lookahead===0)){if(h===dg)return 1;break}if(d.match_length=0,m=ug(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(Ql(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Ku?(Ql(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Ql(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===Q_e?((d,h)=>{let m,y,v,T;const R=d.window;for(;;){if(d.lookahead<=gy){if(AS(d),d.lookahead<=gy&&h===dg)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){T=d.strstart+gy;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<T);d.match_length=gy-(T-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=ug(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=ug(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(Ql(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Ku?(Ql(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Ql(d,!1),d.strm.avail_out===0)?1:2})(s,r):mw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=pw),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Aa;if(c===2&&(r===K_e?$_e(s):r!==k7&&(s2(s,0,0,!1),r===q_e&&(hg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Jl(t),t.avail_out===0))return s.last_flush=-1,Aa}return r!==Ku?Aa:s.wrap<=0?N7:(s.wrap===2?(si(s,255&t.adler),si(s,t.adler>>8&255),si(s,t.adler>>16&255),si(s,t.adler>>24&255),si(s,255&t.total_in),si(s,t.total_in>>8&255),si(s,t.total_in>>16&255),si(s,t.total_in>>24&255)):(fw(s,t.adler>>>16),fw(s,65535&t.adler)),Jl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Aa:N7)},lye=(t,r)=>{let s=r.length;if(gw(t))return Yh;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==IS||a.lookahead)return Yh;if(c===1&&(t.adler=hw(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(hg(a.head),a.strstart=0,a.block_start=0,a.insert=0);let y=new Uint8Array(a.w_size);y.set(r.subarray(s-a.w_size,s),0),r=y,s=a.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,AS(a);a.lookahead>=3;){let y=a.strstart,v=a.lookahead-2;do a.ins_h=pg(a,a.ins_h,a.window[y+3-1]),a.prev[y&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=y,y++;while(--v);a.strstart=y,a.lookahead=2,AS(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,a.wrap=c,Aa},_w={deflateInit:(t,r)=>V7(t,r,dO,15,8,eye),deflateInit2:V7,deflateReset:U7,deflateResetKeep:M7,deflateSetHeader:(t,r)=>gw(t)||t.state.wrap!==2?Yh:(t.state.gzhead=r,Aa),deflate:cye,deflateEnd:t=>{if(gw(t))return Yh;const r=t.state.status;return t.state=null,r===_y?yy(t,Y_e):Aa},deflateSetDictionary:lye,deflateInfo:"pako deflate (from Nodeca project)"};const uye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var hO={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)uye(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,d=t.length;a<d;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let j7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{j7=!1}const yw=new Uint8Array(256);for(let t=0;t<256;t++)yw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;yw[254]=yw[254]=1;var Ew={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const d=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){d[c++]=h;continue}let m=yw[h];if(m>4)d[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&j7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+yw[t[s]]>r?s:r}},F7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const B7=Object.prototype.toString,{Z_NO_FLUSH:dye,Z_SYNC_FLUSH:hye,Z_FULL_FLUSH:pye,Z_FINISH:fye,Z_OK:pO,Z_STREAM_END:mye,Z_DEFAULT_COMPRESSION:gye,Z_DEFAULT_STRATEGY:_ye,Z_DEFLATED:yye}=lO;function fO(t){this.options=hO.assign({level:gye,method:yye,chunkSize:16384,windowBits:15,memLevel:8,strategy:_ye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F7,this.strm.avail_out=0;let s=_w.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==pO)throw new Error(my[s]);if(r.header&&_w.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?Ew.string2buf(r.dictionary):B7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=_w.deflateSetDictionary(this.strm,a),s!==pO)throw new Error(my[s]);this._dict_set=!0}}function Eye(t,r){const s=new fO(r);if(s.push(t,!0),s.err)throw s.msg||my[s.err];return s.result}fO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?fye:dye,typeof t=="string"?s.input=Ew.string2buf(t):B7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===hye||d===pye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=_w.deflate(s,d),c===mye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=_w.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===pO;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},fO.prototype.onData=function(t){this.chunks.push(t)},fO.prototype.onEnd=function(t){t===pO&&(this.result=hO.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var vye={deflate:Eye};const mO=16209;var Sye=function(t,r){let s,a,c,d,h,m,y,v,T,R,P,D,G,F,W,Q,ee,fe,ye,ve,_e,Ne,Je,ft;const yt=t.state;s=t.next_in,Je=t.input,a=s+(t.avail_in-5),c=t.next_out,ft=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=yt.dmax,y=yt.wsize,v=yt.whave,T=yt.wnext,R=yt.window,P=yt.hold,D=yt.bits,G=yt.lencode,F=yt.distcode,W=(1<<yt.lenbits)-1,Q=(1<<yt.distbits)-1;e:do{D<15&&(P+=Je[s++]<<D,D+=8,P+=Je[s++]<<D,D+=8),ee=G[P&W];t:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,fe===0)ft[c++]=65535&ee;else{if(!(16&fe)){if((64&fe)==0){ee=G[(65535&ee)+(P&(1<<fe)-1)];continue t}if(32&fe){yt.mode=16191;break e}t.msg="invalid literal/length code",yt.mode=mO;break e}ye=65535&ee,fe&=15,fe&&(D<fe&&(P+=Je[s++]<<D,D+=8),ye+=P&(1<<fe)-1,P>>>=fe,D-=fe),D<15&&(P+=Je[s++]<<D,D+=8,P+=Je[s++]<<D,D+=8),ee=F[P&Q];n:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,!(16&fe)){if((64&fe)==0){ee=F[(65535&ee)+(P&(1<<fe)-1)];continue n}t.msg="invalid distance code",yt.mode=mO;break e}if(ve=65535&ee,fe&=15,D<fe&&(P+=Je[s++]<<D,D+=8,D<fe&&(P+=Je[s++]<<D,D+=8)),ve+=P&(1<<fe)-1,ve>m){t.msg="invalid distance too far back",yt.mode=mO;break e}if(P>>>=fe,D-=fe,fe=c-d,ve>fe){if(fe=ve-fe,fe>v&&yt.sane){t.msg="invalid distance too far back",yt.mode=mO;break e}if(_e=0,Ne=R,T===0){if(_e+=y-fe,fe<ye){ye-=fe;do ft[c++]=R[_e++];while(--fe);_e=c-ve,Ne=ft}}else if(T<fe){if(_e+=y+T-fe,fe-=T,fe<ye){ye-=fe;do ft[c++]=R[_e++];while(--fe);if(_e=0,T<ye){fe=T,ye-=fe;do ft[c++]=R[_e++];while(--fe);_e=c-ve,Ne=ft}}}else if(_e+=T-fe,fe<ye){ye-=fe;do ft[c++]=R[_e++];while(--fe);_e=c-ve,Ne=ft}for(;ye>2;)ft[c++]=Ne[_e++],ft[c++]=Ne[_e++],ft[c++]=Ne[_e++],ye-=3;ye&&(ft[c++]=Ne[_e++],ye>1&&(ft[c++]=Ne[_e++]))}else{_e=c-ve;do ft[c++]=ft[_e++],ft[c++]=ft[_e++],ft[c++]=ft[_e++],ye-=3;while(ye>2);ye&&(ft[c++]=ft[_e++],ye>1&&(ft[c++]=ft[_e++]))}break}}break}}while(s<a&&c<h);ye=D>>3,s-=ye,D-=ye<<3,P&=(1<<D)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),yt.hold=P,yt.bits=D};const gO=15,bye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Tye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),wye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Cye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var vw=(t,r,s,a,c,d,h,m)=>{const y=m.bits;let v,T,R,P,D,G,F=0,W=0,Q=0,ee=0,fe=0,ye=0,ve=0,_e=0,Ne=0,Je=0,ft=null;const yt=new Uint16Array(16),An=new Uint16Array(16);let Pn,vr,fi,ti=null;for(F=0;F<=gO;F++)yt[F]=0;for(W=0;W<a;W++)yt[r[s+W]]++;for(fe=y,ee=gO;ee>=1&&yt[ee]===0;ee--);if(fe>ee&&(fe=ee),ee===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(Q=1;Q<ee&&yt[Q]===0;Q++);for(fe<Q&&(fe=Q),_e=1,F=1;F<=gO;F++)if(_e<<=1,_e-=yt[F],_e<0)return-1;if(_e>0&&(t===0||ee!==1))return-1;for(An[1]=0,F=1;F<gO;F++)An[F+1]=An[F]+yt[F];for(W=0;W<a;W++)r[s+W]!==0&&(h[An[r[s+W]]++]=W);if(t===0?(ft=ti=h,G=20):t===1?(ft=bye,ti=Tye,G=257):(ft=wye,ti=Cye,G=0),Je=0,W=0,F=Q,D=d,ye=fe,ve=0,R=-1,Ne=1<<fe,P=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){Pn=F-ve,h[W]+1<G?(vr=0,fi=h[W]):h[W]>=G?(vr=ti[h[W]-G],fi=ft[h[W]-G]):(vr=96,fi=0),v=1<<F-ve,T=1<<ye,Q=T;do T-=v,c[D+(Je>>ve)+T]=Pn<<24|vr<<16|fi|0;while(T!==0);for(v=1<<F-1;Je&v;)v>>=1;if(v!==0?(Je&=v-1,Je+=v):Je=0,W++,--yt[F]==0){if(F===ee)break;F=r[s+h[W]]}if(F>fe&&(Je&P)!==R){for(ve===0&&(ve=fe),D+=Q,ye=F-ve,_e=1<<ye;ye+ve<ee&&(_e-=yt[ye+ve],!(_e<=0));)ye++,_e<<=1;if(Ne+=1<<ye,t===1&&Ne>852||t===2&&Ne>592)return 1;R=Je&P,c[R]=fe<<24|ye<<16|D-d|0}}return Je!==0&&(c[D+Je]=F-ve<<24|64<<16|0),m.bits=fe,0};const{Z_FINISH:W7,Z_BLOCK:Rye,Z_TREES:_O,Z_OK:Ey,Z_STREAM_END:Iye,Z_NEED_DICT:Aye,Z_STREAM_ERROR:qu,Z_DATA_ERROR:z7,Z_MEM_ERROR:G7,Z_BUF_ERROR:Pye,Z_DEFLATED:H7}=lO,yO=16180,EO=16190,Cf=16191,u2=16192,d2=16194,vO=16199,SO=16200,h2=16206,ys=16209,$7=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Oye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const vy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<yO||r.mode>16211?1:0},K7=t=>{if(vy(t))return qu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=yO,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,Ey},q7=t=>{if(vy(t))return qu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,K7(t)},Y7=(t,r)=>{let s;if(vy(t))return qu;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?qu:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,q7(t))},X7=(t,r)=>{if(!t)return qu;const s=new Oye;t.state=s,s.strm=t,s.window=null,s.mode=yO;const a=Y7(t,r);return a!==Ey&&(t.state=null),a};let p2,f2,J7=!0;const kye=t=>{if(J7){p2=new Int32Array(512),f2=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(vw(1,t.lens,0,288,p2,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;vw(2,t.lens,0,32,f2,0,t.work,{bits:5}),J7=!1}t.lencode=p2,t.lenbits=9,t.distcode=f2,t.distbits=5},Q7=(t,r,s,a)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(r.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(r.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Nye=(t,r)=>{let s,a,c,d,h,m,y,v,T,R,P,D,G,F,W,Q,ee,fe,ye,ve,_e,Ne,Je=0;const ft=new Uint8Array(4);let yt,An;const Pn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(vy(t)||!t.output||!t.input&&t.avail_in!==0)return qu;s=t.state,s.mode===Cf&&(s.mode=u2),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,v=s.hold,T=s.bits,R=m,P=y,Ne=Ey;e:for(;;)switch(s.mode){case yO:if(s.wrap===0){s.mode=u2;break}for(;T<16;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,ft[0]=255&v,ft[1]=v>>>8&255,s.check=ta(s.check,ft,2,0),v=0,T=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ys;break}if((15&v)!==H7){t.msg="unknown compression method",s.mode=ys;break}if(v>>>=4,T-=4,_e=8+(15&v),s.wbits===0&&(s.wbits=_e),_e>15||_e>s.wbits){t.msg="invalid window size",s.mode=ys;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:Cf,v=0,T=0;break;case 16181:for(;T<16;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(s.flags=v,(255&Ro(s))!==H7){t.msg="unknown compression method",s.mode=ys;break}if(57344&Ro(s)){t.msg="unknown header flags set",s.mode=ys;break}s.head&&(s.head.text=v>>8&1),512&Ro(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,s.check=ta(s.check,ft,2,0)),v=0,T=0,s.mode=16182;case 16182:for(;T<32;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}s.head&&(s.head.time=v),512&Ro(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,ft[2]=v>>>16&255,ft[3]=v>>>24&255,s.check=ta(s.check,ft,4,0)),v=0,T=0,s.mode=16183;case 16183:for(;T<16;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&Ro(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,s.check=ta(s.check,ft,2,0)),v=0,T=0,s.mode=16184;case 16184:if(1024&Ro(s)){for(;T<16;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}s.length=v,s.head&&(s.head.extra_len=v),512&Ro(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,s.check=ta(s.check,ft,2,0)),v=0,T=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Ro(s)&&(D=s.length,D>m&&(D=m),D&&(s.head&&(_e=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+D),_e)),512&Ro(s)&&4&s.wrap&&(s.check=ta(s.check,a,D,d)),m-=D,d+=D,s.length-=D),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Ro(s)){if(m===0)break e;D=0;do _e=a[d+D++],s.head&&_e&&s.length<65536&&(s.head.name+=String.fromCharCode(_e));while(_e&&D<m);if(512&Ro(s)&&4&s.wrap&&(s.check=ta(s.check,a,D,d)),m-=D,d+=D,_e)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Ro(s)){if(m===0)break e;D=0;do _e=a[d+D++],s.head&&_e&&s.length<65536&&(s.head.comment+=String.fromCharCode(_e));while(_e&&D<m);if(512&Ro(s)&&4&s.wrap&&(s.check=ta(s.check,a,D,d)),m-=D,d+=D,_e)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Ro(s)){for(;T<16;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ys;break}v=0,T=0}s.head&&(s.head.hcrc=Ro(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=Cf;break;case 16189:for(;T<32;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}t.adler=s.check=$7(v),v=0,T=0,s.mode=EO;case EO:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=T,Aye;t.adler=s.check=1,s.mode=Cf;case Cf:if(r===Rye||r===_O)break e;case u2:if(s.last){v>>>=7&T,T-=7&T,s.mode=h2;break}for(;T<3;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}switch(s.last=1&v,v>>>=1,T-=1,3&v){case 0:s.mode=16193;break;case 1:if(kye(s),s.mode=vO,r===_O){v>>>=2,T-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ys}v>>>=2,T-=2;break;case 16193:for(v>>>=7&T,T-=7&T;T<32;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ys;break}if(s.length=65535&v,v=0,T=0,s.mode=d2,r===_O)break e;case d2:s.mode=16195;case 16195:if(D=s.length,D){if(D>m&&(D=m),D>y&&(D=y),D===0)break e;c.set(a.subarray(d,d+D),h),m-=D,d+=D,y-=D,h+=D,s.length-=D;break}s.mode=Cf;break;case 16196:for(;T<14;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(s.nlen=257+(31&v),v>>>=5,T-=5,s.ndist=1+(31&v),v>>>=5,T-=5,s.ncode=4+(15&v),v>>>=4,T-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ys;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;T<3;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}s.lens[Pn[s.have++]]=7&v,v>>>=3,T-=3}for(;s.have<19;)s.lens[Pn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,yt={bits:s.lenbits},Ne=vw(0,s.lens,0,19,s.lencode,0,s.work,yt),s.lenbits=yt.bits,Ne){t.msg="invalid code lengths set",s.mode=ys;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Je=s.lencode[v&(1<<s.lenbits)-1],W=Je>>>24,Q=Je>>>16&255,ee=65535&Je,!(W<=T);){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(ee<16)v>>>=W,T-=W,s.lens[s.have++]=ee;else{if(ee===16){for(An=W+2;T<An;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(v>>>=W,T-=W,s.have===0){t.msg="invalid bit length repeat",s.mode=ys;break}_e=s.lens[s.have-1],D=3+(3&v),v>>>=2,T-=2}else if(ee===17){for(An=W+3;T<An;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}v>>>=W,T-=W,_e=0,D=3+(7&v),v>>>=3,T-=3}else{for(An=W+7;T<An;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}v>>>=W,T-=W,_e=0,D=11+(127&v),v>>>=7,T-=7}if(s.have+D>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ys;break}for(;D--;)s.lens[s.have++]=_e}}if(s.mode===ys)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ys;break}if(s.lenbits=9,yt={bits:s.lenbits},Ne=vw(1,s.lens,0,s.nlen,s.lencode,0,s.work,yt),s.lenbits=yt.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ys;break}if(s.distbits=6,s.distcode=s.distdyn,yt={bits:s.distbits},Ne=vw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,yt),s.distbits=yt.bits,Ne){t.msg="invalid distances set",s.mode=ys;break}if(s.mode=vO,r===_O)break e;case vO:s.mode=SO;case SO:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=T,Sye(t,P),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,v=s.hold,T=s.bits,s.mode===Cf&&(s.back=-1);break}for(s.back=0;Je=s.lencode[v&(1<<s.lenbits)-1],W=Je>>>24,Q=Je>>>16&255,ee=65535&Je,!(W<=T);){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(Q&&(240&Q)==0){for(fe=W,ye=Q,ve=ee;Je=s.lencode[ve+((v&(1<<fe+ye)-1)>>fe)],W=Je>>>24,Q=Je>>>16&255,ee=65535&Je,!(fe+W<=T);){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}v>>>=fe,T-=fe,s.back+=fe}if(v>>>=W,T-=W,s.back+=W,s.length=ee,Q===0){s.mode=16205;break}if(32&Q){s.back=-1,s.mode=Cf;break}if(64&Q){t.msg="invalid literal/length code",s.mode=ys;break}s.extra=15&Q,s.mode=16201;case 16201:if(s.extra){for(An=s.extra;T<An;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,T-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Je=s.distcode[v&(1<<s.distbits)-1],W=Je>>>24,Q=Je>>>16&255,ee=65535&Je,!(W<=T);){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if((240&Q)==0){for(fe=W,ye=Q,ve=ee;Je=s.distcode[ve+((v&(1<<fe+ye)-1)>>fe)],W=Je>>>24,Q=Je>>>16&255,ee=65535&Je,!(fe+W<=T);){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}v>>>=fe,T-=fe,s.back+=fe}if(v>>>=W,T-=W,s.back+=W,64&Q){t.msg="invalid distance code",s.mode=ys;break}s.offset=ee,s.extra=15&Q,s.mode=16203;case 16203:if(s.extra){for(An=s.extra;T<An;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,T-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ys;break}s.mode=16204;case 16204:if(y===0)break e;if(D=P-y,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ys;break}D>s.wnext?(D-=s.wnext,G=s.wsize-D):G=s.wnext-D,D>s.length&&(D=s.length),F=s.window}else F=c,G=h-s.offset,D=s.length;D>y&&(D=y),y-=D,s.length-=D;do c[h++]=F[G++];while(--D);s.length===0&&(s.mode=SO);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=SO;break;case h2:if(s.wrap){for(;T<32;){if(m===0)break e;m--,v|=a[d++]<<T,T+=8}if(P-=y,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=Ro(s)?ta(s.check,c,P,h-P):hw(s.check,c,P,h-P)),P=y,4&s.wrap&&(Ro(s)?v:$7(v))!==s.check){t.msg="incorrect data check",s.mode=ys;break}v=0,T=0}s.mode=16207;case 16207:if(s.wrap&&Ro(s)){for(;T<32;){if(m===0)break e;m--,v+=a[d++]<<T,T+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ys;break}v=0,T=0}s.mode=16208;case 16208:Ne=Iye;break e;case ys:Ne=z7;break e;case 16210:return G7;default:return qu}return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=T,(s.wsize||P!==t.avail_out&&s.mode<ys&&(s.mode<h2||r!==W7))&&Q7(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=Ro(s)?ta(s.check,c,P,t.next_out-P):hw(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===Cf?128:0)+(s.mode===vO||s.mode===d2?256:0),(R===0&&P===0||r===W7)&&Ne===Ey&&(Ne=Pye),Ne},Rf={inflateReset:q7,inflateReset2:Y7,inflateResetKeep:K7,inflateInit:t=>X7(t,15),inflateInit2:X7,inflate:Nye,inflateEnd:t=>{if(vy(t))return qu;let r=t.state;return r.window&&(r.window=null),t.state=null,Ey},inflateGetHeader:(t,r)=>{if(vy(t))return qu;const s=t.state;return(2&s.wrap)==0?qu:(s.head=r,r.done=!1,Ey)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,d;return vy(t)?qu:(a=t.state,a.wrap!==0&&a.mode!==EO?qu:a.mode===EO&&(c=1,c=hw(c,r,s,0),c!==a.check)?z7:(d=Q7(t,r,s,s),d?(a.mode=16210,G7):(a.havedict=1,Ey)))},inflateInfo:"pako inflate (from Nodeca project)"},Dye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Z7=Object.prototype.toString,{Z_NO_FLUSH:xye,Z_FINISH:Lye,Z_OK:Sw,Z_STREAM_END:m2,Z_NEED_DICT:g2,Z_STREAM_ERROR:Mye,Z_DATA_ERROR:eK,Z_MEM_ERROR:Uye}=lO;function bO(t){this.options=hO.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F7,this.strm.avail_out=0;let s=Rf.inflateInit2(this.strm,r.windowBits);if(s!==Sw)throw new Error(my[s]);if(this.header=new Dye,Rf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Ew.string2buf(r.dictionary):Z7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=Rf.inflateSetDictionary(this.strm,r.dictionary),s!==Sw)))throw new Error(my[s])}function Vye(t,r){const s=new bO(r);if(s.push(t),s.err)throw s.msg||my[s.err];return s.result}bO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Lye:xye,Z7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=Rf.inflate(s,h),d===g2&&c&&(d=Rf.inflateSetDictionary(s,c),d===Sw?d=Rf.inflate(s,h):d===eK&&(d=g2));s.avail_in>0&&d===m2&&s.state.wrap>0&&t[s.next_in]!==0;)Rf.inflateReset(s),d=Rf.inflate(s,h);switch(d){case Mye:case eK:case g2:case Uye:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===m2))if(this.options.to==="string"){let y=Ew.utf8border(s.output,s.next_out),v=s.next_out-y,T=Ew.buf2string(s.output,y);s.next_out=v,s.avail_out=a-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(T)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==Sw||m!==0){if(d===m2)return d=Rf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},bO.prototype.onData=function(t){this.chunks.push(t)},bO.prototype.onEnd=function(t){t===Sw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=hO.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var jye={inflate:Vye};const{deflate:Fye}=vye,{inflate:Bye}=jye;var Wye=Fye,zye=Bye,tK=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(tK||{});class Gye{constructor(){q(this,"_sequence",0),q(this,"_startTime",Date.now()),q(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;ae("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,ae("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let y=!1;if(m.datas.length>0){const v=m.datas.find(T=>T.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),m=new DataView(d);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,a),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==a+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(a+2));return d}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const d=s.getUint8(a);a++;const h=c===tK.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<d;){let T=0,R=0,P=new ArrayBuffer(0);h?(T=y.getUint8(v),v++,R=y.getUint8(v),v++):(T=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(P=y.buffer.slice(v+2,v+2+R),v+=P.byteLength),m.push({id:T,length:R,data:P})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return zye(new Uint8Array(r))}compress(r){return Wye(new Uint8Array(r))}}const Hye={name:"DataStream",create:(t,r)=>{const s=r?new Qme(t):new Zme(t);return s.useDataStream(new Gye),s}};class $ye extends Gr{constructor(r,s,a){super(),q(this,"ws",void 0),q(this,"requestId",1),q(this,"heartBeatTimer",void 0),q(this,"joinInfo",void 0),q(this,"clientId",void 0),q(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),q(this,"onClose",c=>{this.emit("close"),this.dispose()}),q(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=s,this.ws=new KT("cross-channel-".concat(this.clientId),a),this.ws.on(tn.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(tn.CONNECTED,this.onOpen),this.ws.on(tn.ON_MESSAGE,this.onMessage),this.ws.on(tn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new pt((s,a)=>{const c=window.setTimeout(()=>{a(new Ae(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new Ae(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Ae(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Ae(te.WS_DISCONNECT);const s=()=>new pt((h,m)=>{this.ws.once(tn.CLOSED,()=>m(new Ae(te.WS_ABORT))),this.ws.once(tn.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new pt((h,m)=>{const y=()=>{m(new Ae(te.WS_ABORT))};this.ws.once(tn.RECONNECTING,y),this.ws.once(tn.CLOSED,y),this.once("req_".concat(a),h),bs(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(tn.RECONNECTING,y),this.ws.off(tn.CLOSED,y),m(new Ae(te.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Ae(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(tn.REQUEST_NEW_URLS),this.ws.on(tn.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Kye extends Gr{set state(r){r!==this._state&&(r!==tc.RELAY_STATE_FAILURE&&(this.errorCode=pS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,d){super(),q(this,"joinInfo",void 0),q(this,"sid",void 0),q(this,"clientId",void 0),q(this,"cancelToken",Ta.CancelToken.source()),q(this,"workerToken",void 0),q(this,"requestId",0),q(this,"signal",void 0),q(this,"prevChannelMediaConfig",void 0),q(this,"httpRetryConfig",void 0),q(this,"_resolution",void 0),q(this,"_state",tc.RELAY_STATE_IDLE),q(this,"errorCode",pS.RELAY_OK),q(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Ef.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Ef.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=pS.SRC_TOKEN_EXPIRED,this.state=tc.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=pS.DEST_TOKEN_EXPIRED,this.state=tc.RELAY_STATE_FAILURE))}),q(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ef.NETWORK_DISCONNECTED),this.state=tc.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==tc.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=pS.SERVER_CONNECTION_LOST,this.state=tc.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=Q_(),this.signal=new $ye(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==tc.RELAY_STATE_IDLE)throw new Ae(te.INVALID_OPERATION);this.state=tc.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Ae(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==tc.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==tc.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);const s=this.genMessage(ea.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tc.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ta.CancelToken.source(),this.state=tc.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await r_e(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Ef.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(ea.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(ea.SetSdkProfile,r);await this.signal.request(a),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(ea.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ef.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(ea.SetSourceUserId,r);await this.signal.request(d),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(ea.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ef.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(ea.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Ef.PACKET_SENT_TO_DEST_CHANNEL),this.state=tc.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(ea.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",Ef.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(ea.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:$l,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case ea.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case ea.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case ea.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case ea.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case ea.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case ea.Reconnect:return h.clientRequest={command:"Reconnect"},h;case ea.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case ea.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case ea.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const qye={name:"ChannelMediaRelay",create:function(t){return new Kye(t.joinInfo,t.clientId,t.websocketRetryConfig||Li,t.httpRetryConfig||Li,t.resolution)}};function nK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function bw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?nK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):nK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Yye extends Gr{constructor(r,s,a,c){super(),q(this,"spec",void 0),q(this,"token",void 0),q(this,"websocket",void 0),q(this,"pingpongTimer",void 0),q(this,"reconnectMode","retry"),q(this,"serviceMode",void 0),q(this,"reqId",0),q(this,"commandReqId",0),q(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),q(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Ot.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===yf.TRANSCODE?1:2}),this.emit(eg.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new KT("live-streaming",a),this.websocket.on(tn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(tn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(tn.REQUEST_NEW_URLS,(d,h)=>{Fs(this,eg.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(tn.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Ae(te.UNEXPECTED_ERROR);const m=bw({command:r,sdkVersion:$l==="4.23.2"?"0.0.1":$l,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Ae(te.WS_DISCONNECT);const y=()=>new pt((P,D)=>{this.websocket.once(tn.CLOSED,()=>D(new Ae(te.WS_ABORT))),this.websocket.once(tn.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new pt((P,D)=>{const G=()=>{D(new Ae(te.WS_ABORT))};this.websocket.once(tn.RECONNECTING,G),this.websocket.once(tn.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),F=>{P(F)})});c&&Ot.workerEvent(this.spec.sid,bw(bw({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const T=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,a)}return c&&Ot.workerEvent(this.spec.sid,bw(bw({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-T})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=$l==="4.23.2"?"0.0.1":$l;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Gi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Gi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Gi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Gi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ae(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ae(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(eg.WARNING,s,r.serverResponse.url)}case Gi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Ae(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(eg.WARNING,s,r.serverResponse.url)}case Gi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ae(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Ae(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(eg.WARNING,s,r.serverResponse.url)}case Gi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Gi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Gi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(lP)},6e3)}}function rK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function nc(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?rK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):rK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Xye extends Gr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Li,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Li;super(),q(this,"onLiveStreamWarning",void 0),q(this,"onLiveStreamError",void 0),q(this,"spec",void 0),q(this,"retryTimeout",1e4),q(this,"connection",void 0),q(this,"httpRetryConfig",void 0),q(this,"wsRetryConfig",void 0),q(this,"streamingTasks",new Map),q(this,"isStartingStreamingTask",!1),q(this,"taskMutex",new Ys("live-streaming")),q(this,"cancelToken",Ta.CancelToken.source()),q(this,"transcodingConfig",void 0),q(this,"uapResponse",void 0),q(this,"lastTaskId",1),q(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=nc(nc({},Mge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>nc(nc(nc({},Lge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Yr(h.width)||ur(h.width,"config.width",0,1e4),Yr(h.height)||ur(h.height,"config.height",0,1e4),Yr(h.videoBitrate)||ur(h.videoBitrate,"config.videoBitrate",1,1e6),Yr(h.videoFrameRate)||ur(h.videoFrameRate,"config.videoFrameRate"),Yr(h.lowLatency)||ff(h.lowLatency,"config.lowLatency"),Yr(h.audioSampleRate)||Ki(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Yr(h.audioBitrate)||ur(h.audioBitrate,"config.audioBitrate",1,128),Yr(h.audioChannels)||Ki(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Yr(h.videoGop)||ur(h.videoGop,"config.videoGop"),Yr(h.videoCodecProfile)||Ki(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Yr(h.userCount)||ur(h.userCount,"config.userCount",0,17),Yr(h.backgroundColor)||ur(h.backgroundColor,"config.backgroundColor",0,16777215),Yr(h.userConfigExtraInfo)||Ss(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Yr(h.transcodingUsers)&&(mf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{DP(m.uid),Yr(m.x)||ur(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Yr(m.y)||ur(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Yr(m.width)||ur(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Yr(m.height)||ur(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Yr(m.zOrder)||ur(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Yr(m.alpha)||ur(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Yr(h.watermark)||yM(h.watermark,"watermark"),Yr(h.backgroundImage)||yM(h.backgroundImage,"backgroundImage"),h.images&&!Yr(h.images)&&(mf(h.images,"config.images"),h.images.forEach((m,y)=>{yM(m,"images[".concat(y,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>nc(nc(nc({},_M),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(nc(nc(nc({},_M),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(nc(nc(nc({},_M),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>nc({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?pt.resolve(h.uid):C9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await pt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(nl(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===yf.TRANSCODE)throw new Ae(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(r)&&!a)return d(),new Ae(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case yf.TRANSCODE:c.transcodingConfig=nc({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new pt((v,T)=>{bs(this.retryTimeout).then(()=>{if(a)return T(a);const R=this.statusError.get(r);return R?(this.statusError.delete(r),T(R)):void 0})}),y=await pt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===yf.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new pt((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Ae(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===yf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var r;const s=Array.from(nl(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ta.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Ae(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Fs(this,EM.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new Yye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(eg.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(eg.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(eg.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Ae(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Fs(this,EM.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Gi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Gi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Gi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(nl(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const Jye={name:"LiveStreaming",create:function(t){return new Xye(t.joinInfo,t.websocketRetryConfig||Li,t.httpRetryConfig||Li)}};function Qye(t){let r=oK();return function(s,a){let c=s.appId;c!==void 0&&(nr(a,10),Qh(a,c));let d=s.cid;d!==void 0&&(nr(a,16),nr(a,d));let h=s.cname;h!==void 0&&(nr(a,26),Qh(a,h));let m=s.deviceId;m!==void 0&&(nr(a,34),Qh(a,m));let y=s.elapse;y!==void 0&&(nr(a,40),fg(a,y));let v=s.fileSize;v!==void 0&&(nr(a,48),fg(a,OS(v)));let T=s.height;T!==void 0&&(nr(a,56),fg(a,OS(T)));let R=s.jpg;R!==void 0&&(nr(a,66),nr(a,R.length),function(Pa,ze){let ot=kS(Pa,ze.length);Pa.bytes.set(ze,ot)}(a,R));let P=s.networkType;P!==void 0&&(nr(a,72),fg(a,OS(P)));let D=s.osType;D!==void 0&&(nr(a,80),fg(a,OS(D)));let G=s.requestId;G!==void 0&&(nr(a,90),Qh(a,G));let F=s.sdkVersion;F!==void 0&&(nr(a,98),Qh(a,F));let W=s.sequence;W!==void 0&&(nr(a,104),fg(a,OS(W)));let Q=s.sid;Q!==void 0&&(nr(a,114),Qh(a,Q));let ee=s.timestamp;ee!==void 0&&(nr(a,120),fg(a,ee));let fe=s.uid;fe!==void 0&&(nr(a,128),nr(a,fe));let ye=s.vid;ye!==void 0&&(nr(a,136),nr(a,ye));let ve=s.width;ve!==void 0&&(nr(a,144),fg(a,OS(ve)));let _e=s.service;_e!==void 0&&(nr(a,152),nr(a,_e));let Ne=s.callbackData;Ne!==void 0&&(nr(a,162),Qh(a,Ne));let Je=s.jpgEncryption;Je!==void 0&&(nr(a,168),nr(a,Je));let ft=s.requestType;ft!==void 0&&(nr(a,176),nr(a,ft));let yt=s.scorePorn;yt!==void 0&&(nr(a,185),S2(a,yt));let An=s.scoreSexy;An!==void 0&&(nr(a,193),S2(a,An));let Pn=s.scoreNeutral;Pn!==void 0&&(nr(a,201),S2(a,Pn));let vr=s.scene;vr!==void 0&&(nr(a,208),nr(a,vr));let fi=s.ossFilePrefix;fi!==void 0&&(nr(a,218),Qh(a,fi));let ti=s.serviceVendor;if(ti!==void 0)for(let Pa of ti){nr(a,226);let ze=oK();tEe(Pa,ze),nr(a,ze.limit),sEe(a,ze),iEe(ze)}}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function Zye(t){return function(s){let a={};e:for(;!aK(s);){let c=Zh(s);switch(c>>>3){case 0:break e;case 1:a.code=Zh(s);break;case 2:a.msg=cK(s,Zh(s));break;case 3:{let d=nEe(s);a.data=eEe(s),s.limit=d;break}default:iK(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function eEe(t){let r={};e:for(;!aK(t);){let s=Zh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=cK(t,Zh(t));break;case 2:r.requestType=Zh(t)>>>0;break;case 3:r.scorePorn=v2(t);break;case 4:r.scoreSexy=v2(t);break;case 5:r.scoreNeutral=v2(t);break;case 6:r.requestScene=Zh(t)>>>0;break;case 7:r.scene=Zh(t)>>>0;break;default:iK(t,7&s)}}return r}function tEe(t,r){let s=t.service;s!==void 0&&(nr(r,8),nr(r,s));let a=t.vendor;a!==void 0&&(nr(r,16),nr(r,a));let c=t.token;c!==void 0&&(nr(r,26),Qh(r,c));let d=t.callbackUrl;d!==void 0&&(nr(r,34),Qh(r,d))}function nEe(t){let r=Zh(t),s=t.limit;return t.limit=t.offset+r,s}function iK(t,r){switch(r){case 0:for(;128&lK(t););break;case 2:y2(t,Zh(t));break;case 5:y2(t,4);break;case 1:y2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let rEe=new Float32Array(1);new Uint8Array(rEe.buffer);let _2=new Float64Array(1),rc=new Uint8Array(_2.buffer);function OS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let sK=[];function oK(){const t=sK.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function iEe(t){sK.push(t)}function y2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function aK(t){return t.offset>=t.limit}function kS(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function E2(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function cK(t,r){let s=E2(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,T,R,P=c[m+s];(128&P)==0?h+=a(P):(224&P)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&P)<<6|63&y,R<128?h+=d:(h+=a(R),m++))):(240&P)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=a(R),m+=2))):(248&P)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],T=c[m+s+3],(12632256&(y|v<<8|T<<16))!=8421504?h+=d:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&T,R<65536||R>1114111?h+=d:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function Qh(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}nr(t,a);let c=kS(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function sEe(t,r){let s=kS(t,r.limit),a=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+s]=c[d]}function lK(t){return t.bytes[E2(t,1)]}function uK(t,r){let s=kS(t,1);t.bytes[s]=r}function v2(t){let r=E2(t,8),s=t.bytes;return rc[0]=s[r++],rc[1]=s[r++],rc[2]=s[r++],rc[3]=s[r++],rc[4]=s[r++],rc[5]=s[r++],rc[6]=s[r++],rc[7]=s[r++],_2[0]}function S2(t,r){let s=kS(t,8),a=t.bytes;_2[0]=r,a[s++]=rc[0],a[s++]=rc[1],a[s++]=rc[2],a[s++]=rc[3],a[s++]=rc[4],a[s++]=rc[5],a[s++]=rc[6],a[s++]=rc[7]}function Zh(t){let r,s=0,a=0;do r=lK(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function nr(t,r){for(r>>>=0;r>=128;)uK(t,127&r|128),r>>>=7;uK(t,r)}function fg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=kS(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function dK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const oEe=new Map([["moderation",1],["supervise",2]]);class aEe extends Gr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(_s.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Sc(s=r.map(a=>oEe.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),q(this,"name","AgoraRTCVideoContentInspect"),q(this,"_connectionState",Wu.CONNECTING),q(this,"_innerConnectionState",void 0),q(this,"sequence",0),q(this,"inspectStartTime",void 0),q(this,"workerManagerConnection",void 0),q(this,"workerConnection",void 0),q(this,"workerMessageLengthLimit",void 0),q(this,"inspectIntervalMinimum",void 0),q(this,"qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",Ta.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"wmSequence",0),q(this,"inspectInterval",void 0),q(this,"inspectTimer",null),q(this,"ossFilePrefix",void 0),q(this,"extraInfo",void 0),q(this,"_inspectType",void 0),q(this,"_inspectMode",void 0),q(this,"_quality",1),q(this,"qualityTimer",null),q(this,"_inspectId",void 0),q(this,"_needWorkUrlOnly",!1),q(this,"inspectImage",()=>{if(this.connectionState!==Wu.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Wu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=yr(5,"inspect-"),this.workerMessageLengthLimit=ae("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=ae("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=ae("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new KT("worker-manager-"+this._inspectId,Li),this.on(_s.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(zu[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new KT("worker-"+this._inspectId,Li),this.handleWorkerEvents()}async init(r,s){this.emit(_s.STATE_CHANGE,zu.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new pt((c,d)=>{this.on(_s.CONNECTION_STATE_CHANGE,(h,m)=>{m===Wu.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(r,s,a){const c=ae("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,y,v,T){let{appId:R,areaCode:P,cname:D,sid:G,token:F,uid:W}=y;vS++;const Q="image_moderation_api",ee={service_name:Q,json_body:JSON.stringify({appId:R,areaCode:P,cname:D,command:"allocateEdge",requestId:vS,seq:vS,sid:G,token:F,ts:Date.now(),uid:W+""})};let fe,ye,ve=m[0];return Fd(async()=>{fe=Date.now();const _e=await Hd(ve,{data:ee,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-fe,_e.code!==0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_e.code,{retry:!0,responseTime:ye});throw x.error(yt.toString()),yt}const Ne=JSON.parse(_e.json_body);if(Ne.code!==200){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:ye});throw x.error(yt.toString()),yt}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:ye});throw x.error(yt.toString()),yt}const Je=ae("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ft=ae("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(yt=>{let{address:An,wss:Pn}=yt;if(An&&Pn)return"wss://".concat(An.replace(/\./g,"-"),".").concat(Je,":").concat(ft||Pn)}).filter(yt=>!!yt),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:ye}},(_e,Ne)=>(Ot.apworkerEvent(G,{success:!0,sc:200,serviceName:Q,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Ne===0,responseTime:ye,serverIp:m[Ne%m.length]}),!1),(_e,Ne)=>(Ot.apworkerEvent(G,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:Q,responseTime:ye,serverIp:m[Ne%m.length]}),!!(_e.code!==te.OPERATION_ABORTED&&_e.code!==te.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(ve=m[(Ne+1)%m.length],!0)),T)}(c,r,s,a);this.emit(_s.STATE_CHANGE,zu.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(_s.STATE_CHANGE,zu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(tn.CONNECTED,async()=>{this.emit(_s.STATE_CHANGE,zu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(tn.CLOSED,()=>{this._innerConnectionState<zu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(tn.FAILED,()=>{this._innerConnectionState<zu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(tn.RECONNECTING,()=>{this._innerConnectionState<zu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(tn.ON_MESSAGE,async r=>{this.emit(_s.STATE_CHANGE,zu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Ae(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Ae(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=ae("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(_s.STATE_CHANGE,zu.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(_s.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(tn.WILL_RECONNECT,(r,s,a)=>{a(r)}),this.workerManagerConnection.on(tn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(tn.CONNECTED,async()=>{this.emit(_s.STATE_CHANGE,zu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Wu.CONNECTED}),this.workerConnection.on(tn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const a=Zye(new Uint8Array(r.data));if(ae("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(_s.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Sc(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===d);this.emit(_s.INSPECT_RESULT,h)}else this.emit(_s.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(_s.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(_s.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(tn.CLOSED,()=>{this.connectionState=Wu.CLOSED}),this.workerConnection.on(tn.FAILED,()=>{this.connectionState=Wu.CLOSED}),this.workerConnection.on(tn.RECONNECTING,()=>{this.connectionState=this.connectionState===Wu.CONNECTED?Wu.RECONNECTING:Wu.CONNECTING}),this.workerConnection.on(tn.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this.workerConnection.on(tn.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(_s.REQUEST_NEW_WORKER_URL,a=>{r([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;const r=il(this,_s.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(_s.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(_s.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),T=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await $8(T,a,c),P=this.sequence+"-"+d+"-"+y+"-"+v+"-"+yr(12,""),D={appId:a,cid:d,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:T.height,width:T.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:E$(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const F=Qye(D);if(F.byteLength<this.workerMessageLengthLimit){if(ae("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const W=function(Q){for(var ee=1;ee<arguments.length;ee++){var fe=arguments[ee]!=null?arguments[ee]:{};ee%2?dK(Object(fe),!0).forEach(function(ye){q(Q,ye,fe[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(fe)):dK(Object(fe)).forEach(function(ye){Object.defineProperty(Q,ye,Object.getOwnPropertyDescriptor(fe,ye))})}return Q}({},D);delete W.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(W))}return F}{const W=this.quality*this.qualityRatio;return this.quality=W,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ta.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Wu.CLOSED,this.emit(_s.STATE_CHANGE,zu.CLOSED)}}const cEe={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Ae(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Ae(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach(c=>{var d;if(!at(d=["supervise","moderation"]).call(d,c))throw new Ae(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new aEe(r)}};var hK=l(vt.Object.getOwnPropertySymbols),lEe=$n,uEe=_a.indexOf,dEe=Fp,b2=ie([].indexOf),pK=!!b2&&1/b2([1],1,-0)<0;lEe({target:"Array",proto:!0,forced:pK||!dEe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return pK?b2(this,t,r)||0:uEe(this,t,r)}});var hEe=vc("Array").indexOf,pEe=O,fEe=hEe,T2=Array.prototype,mEe=function(t){var r=t.indexOf;return t===T2||pEe(T2,t)&&r===T2.indexOf?fEe:r},fK=l(mEe);function gEe(t,r){if(t==null)return{};var s,a,c=function(h,m){if(h==null)return{};var y,v,T={},R=xH(h);for(v=0;v<R.length;v++)y=R[v],fK(m).call(m,y)>=0||(T[y]=h[y]);return T}(t,r);if(hK){var d=hK(t);for(a=0;a<d.length;a++)s=d[a],fK(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let mK=class{get localCapabilities(){return Jr(this._localCapabilities)}get rtpCapabilities(){return Jr(this._rtpCapabilities)}get candidates(){return Jr(this._candidates)}get iceParameters(){return Jr(this._iceParameters)}get dtlsParameters(){return Jr(this._dtlsParameters)}constructor(t){q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_iceParameters",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname","o/i14u9pJrxRKAsu"),q(this,"firefoxSsrcMidMap",new Map),t=Jr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let T;this.setup=m,T=h===Zo.RECEIVE_ONLY?ec(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ec(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const R=h===Zo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Zo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=h===Zo.RECEIVE_ONLY?c.send.videoCodecs:XT(Tt.VIDEO,R,P,y),G=h===Zo.RECEIVE_ONLY?c.send.audioCodecs:XT(Tt.AUDIO,R,P,v);for(const F of T.mediaDescriptions)F.attributes.iceUfrag=r.iceUfrag,F.attributes.icePwd=r.icePwd,F.attributes.fingerprints=s.fingerprints,F.attributes.candidates=a,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"&&(F.media.fmts=D.map(W=>W.payloadType.toString(10)),F.attributes.payloads=D,F.attributes.extmaps=R.videoExtensions),F.media.mediaType==="audio"&&(F.media.fmts=G.map(W=>W.payloadType.toString(10)),F.attributes.payloads=G,F.attributes.extmaps=R.audioExtensions,ES(F));this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return Zm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=ay(r,this.cname,ae("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(qr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,d,a);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,d,h,"sendonly",a,c),this.updateBundleMids()):(v=Jr(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),qr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Jr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:y})}),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(T=>T.priority===v.priority&&T.connectionAddress===v.connectionAddress&&T.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=XT(d,h,this.localCapabilities.send,d===Tt.AUDIO?c:a),y=d===Tt.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let T={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};T=this.mungRecvMediaDsec(T,t);const R=this.findFirstClosedMedia(d);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=T}else this.sessionDesc.mediaDescriptions.push(T);return T}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>at(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>at(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(qr()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Jr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,a,c,d){const h=this.rtpCapabilities.send,m=t===Tt.VIDEO?h.videoCodecs:h.audioCodecs,y=t===Tt.VIDEO?h.videoExtensions:h.audioExtensions;qr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const T=this.findFirstClosedMedia(t);if(T){const R=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const a=Jr(t);return wM(a),yS(a,r),CM(a,r),s9(a),FP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=Jr(t);return FP(s,r,this.localCapabilities.recv),ES(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>qr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const _Ee=["sdp"];var Cr;function gK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function mg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?gK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):gK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let _K=(Cr=class HS extends FH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),q(this,"direction",void 0),q(this,"name",void 0),q(this,"store",void 0),q(this,"spec",void 0),q(this,"peerConnection",void 0),q(this,"initialOffer",void 0),q(this,"transport",void 0),q(this,"statsFilter",void 0),q(this,"localCandidateCount",0),q(this,"_isInRestartIce",!1),q(this,"mutex",void 0),q(this,"onLocalCandidate",void 0),q(this,"remoteSDP",void 0),q(this,"pendingCandidates",[]),q(this,"localCapabilities",void 0),q(this,"isReady",!1),q(this,"restartCnt",0),q(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Ys("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(HS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Zo.SEND_ONLY,this.name=this.direction===Zo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=VL(this.peerConnection,ae("STATS_UPDATE_INTERVAL"),void 0,qr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await a9();if(this.localCapabilities=BP(s),r){const{sdp:a}=r,c=gEe(r,_Ee),d=function(){const T={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=YT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Gu(R,T,"videoExtensions",P,D,G),Gu(R,T,"videoCodecs",P,D,G),Gu(R,T,"audioExtensions",P,D,G),Gu(R,T,"audioCodecs",P,D,G),ae("RAISE_H264_BASELINE_PRIORITY")){const F=G.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]==="42001f");if(F!==-1){const W=G.videoCodecs.findIndex(Q=>Q.rtpMap&&Q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(W<F){x.debug("raising H264 baseline profile priority");const Q=G.videoCodecs[F];G.videoCodecs.splice(F,1),G.videoCodecs.splice(W,0,Q)}W!==-1&&ae("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Q=>!(Q.rtpMap&&Q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Q.fmtp&&Q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:D,sendrecv:G}}({},{},a);this.remoteSDP=new mK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=ig(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await c9({},{},h.sdp);this.localCapabilities=BP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),mg(mg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=ig(a.sdp);return this.initialOffer=a,mg(mg({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,d=await c9({},{},s);this.remoteSDP=new mK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Hl(function*(){const d=yield xn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach((W,Q)=>{if(m[Q].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(W._mediaStreamTrack,{direction:"sendonly"});h.push(ee),W._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(fe=>fe.mid===m[Q].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Q].mid));h.push(ee),W._updateRtpTransceiver(ee)}}),qr()&&ae("SIMULCAST")===!0&&(yield xn(c.applySimulcastForFirefox(h,r)));const y=m.map(W=>W.mid),v=yield xn(c.peerConnection.createOffer()),T=c.mungSendOfferSDP(v.sdp,r,y),R=ec(T),P=y.map(W=>{const Q=R.mediaDescriptions.find(ee=>ee.attributes.mid===W);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return n9(Q,ae("USE_PUB_RTX"))}),D=h.map((W,Q)=>{const ee=y[Q];return{localSSRC:P[Q],id:ee}});yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:T}));try{yield D}catch(W){const Q=c.remoteSDP.toString();throw yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield xn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),yield xn(c.stopSending(y,!0)),W}yield xn(c.applySimulcastEncodings(h,r)),yield xn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),F=c.logSDPExchange(T,"offer","local","send");return F==null||F(G),yield xn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Q)=>{const ee=y[Q];return{localSSRC:P[Q],id:ee}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const T=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(T.sdp,d,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),T=this.mungReceiveAnswerSDP(v.sdp,d,r);y==null||y(T||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:T}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Z_.Auto&&(this.store.p2pTransport=Z_.SdRtn,Bn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(HS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Bn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(HS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=ig(s.sdp);return this.store.descriptionStart(),this.direction===Zo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Zo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=ig(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?qr()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:mg(mg({},jh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:mg(mg({},jh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;at(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(MT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...HS.turnServerConfigToIceServers(r.turnServer.servers,s,a)),ae("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...HS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),at(d=[Z_.Relay,Z_.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),ae("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),ae("ENABLE_ENCODED_TRANSFORM")&&Bn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(s){case Z_.SdRtn:const m=r.filter(v=>{var T;return at(T=v.username).call(T,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>a?m[a]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(ng(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(ng(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case Z_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(ng(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(ng(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(T=>T.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:T,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;T&&(d.maxBitrate=1e3*T),at(h=r._hints).call(h,Er.LOW_STREAM)&&(R&&(d.maxFramerate=Pc(R)),P&&P>=1&&(d.scaleResolutionDownBy=P))}if(ae("DSCP_TYPE")&&pf()){var m;const T=ae("DSCP_TYPE");at(m=["very-low","low","medium","high"]).call(m,T)&&(d.networkPriority=T)}const y=s.getParameters(),v=(a=y.encodings)===null||a===void 0?void 0:a[0];qr()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!Bn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Pr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=ec(r);return s.forEach((d,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(yS(y,d),o9(y,d,this.store.codec))}),Zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,d,h,m;const v=r[y],T=s[y];if(T instanceof Pr&&!at(a=T._hints).call(a,Er.LOW_STREAM)&&(c=T._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=T._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!qr()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Pr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Pr&&ae("SIMULCAST")&&this.store.codec==="vp8"&&!at(s=r._hints).call(s,Er.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(ae("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a,c;if(s=(a=s)!==null&&a!==void 0?a:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var d;const h=(d=ec(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||d===void 0?void 0:d.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),at(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=ec(r),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===Tt.AUDIO&&d.media.mediaType==="audio"&&ES(d),Zm(c)}},It(Cr.prototype,"establish",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"establish"),Cr.prototype),It(Cr.prototype,"connect",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"connect"),Cr.prototype),It(Cr.prototype,"receive",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"receive"),Cr.prototype),It(Cr.prototype,"mockReceive",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"mockReceive"),Cr.prototype),It(Cr.prototype,"stopReceiving",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"stopReceiving"),Cr.prototype),It(Cr.prototype,"restartICE",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"restartICE"),Cr.prototype),It(Cr.prototype,"close",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"close"),Cr.prototype),It(Cr.prototype,"updateEncoderConfig",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"updateEncoderConfig"),Cr.prototype),It(Cr.prototype,"updateSendParameters",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"updateSendParameters"),Cr.prototype),It(Cr.prototype,"replaceTrack",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"replaceTrack"),Cr.prototype),It(Cr.prototype,"muteLocal",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"muteLocal"),Cr.prototype),It(Cr.prototype,"unmuteLocal",[Yu],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteLocal"),Cr.prototype),Cr);function Yu(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}let Kd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var yK,EK,vK,SK,bK,TK,wK,CK,RK,IK,AK,Wr;function PK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function TO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?PK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):PK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let yEe=(yK=qd(Kd.SEND_ONLY),EK=qd(Kd.SEND_ONLY),vK=qd(),SK=qd(Kd.RECEIVE_ONLY),bK=qd(Kd.RECEIVE_ONLY),TK=qd(Kd.RECEIVE_ONLY),wK=qd(Kd.RECEIVE_ONLY),CK=qd(Kd.RECEIVE_ONLY),RK=qd(Kd.RECEIVE_ONLY),IK=qd(),AK=qd(Kd.RECEIVE_ONLY),Wr=class extends Gr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Vt.StateChange,r,this._state)}constructor(t,r){super(),q(this,"isPlanB",!1),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"sendConnection",void 0),q(this,"recvConnection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"statsCollector",void 0),q(this,"dtlsFailedCount",0),q(this,"sendMutex",void 0),q(this,"recvMutex",void 0),q(this,"_state",Qn.Disconnected),q(this,"_restartStates",["disconnected","failed"]),q(this,"reconnectInterval",void 0),q(this,"uploadUnplinkStarted",!1),q(this,"uploadDownlinkStarted",!1),q(this,"uplinkStateUploadInterval",void 0),q(this,"downlinkStatsUploadInterval",void 0),q(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void a();const v=y.find(D=>D[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(D=>{let[,{id:G}]=D;return G}));let T=!1;var h,m;s.trackMediaType==="video"?T=!((h=this.localTrackMap.get(Ye.LocalAudioTrack))===null||h===void 0||!h.track._muted):T=((m=this.localTrackMap.get(Ye.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await _r(this,Vt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?tg.MUTE_LOCAL_VIDEO:tg.MUTE_LOCAL_AUDIO;await _r(this,Vt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:T}),a()}catch(y){c(y)}finally{d()}}),q(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?tg.UNMUTE_LOCAL_VIDEO:tg.UNMUTE_LOCAL_AUDIO;await _r(this,Vt.RequestP2PMuteLocal,{action:y,message:m}),a()}catch(h){c(h)}finally{d()}}),q(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Qn.Connected)return void a();const{id:v,track:T}=y;v&&(await this.sendConnection.updateSendParameters(v,T),await this.sendConnection.updateEncoderConfig(v,T),this.emit(Vt.UpdateVideoEncoder,T)),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ye.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Qn.Connected)return void a();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:R}]=T;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Qn.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Ye.LocalVideoTrack&&Bn().supportDualStreamEncoding){const T=this.localTrackMap.get(Ye.LocalVideoLowTrack);if(T){const R=s._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=R,T.track._originMediaStreamTrack=R,await new pt((P,D)=>{this.handleReplaceTrack(T.track,P,D,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new K9(t),this.bindStatsUploaderEvents(),this.sendMutex=new Ys("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Ys("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},ae("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new _K(t,this.store,Zo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=Qn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new _K(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Qn.Connected}async addRemoteCandidate(t,r){if(r===Zo.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Hl(function*(){const c=yield xn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Qn.Connected){a.throwIfTrackTypeNotMatch(t);const v=t.filter(T=>a.pendingLocalTracks.indexOf(T)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,Qs.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield xn(a.tryToUnmuteAudio(t)));d.forEach(v=>{let{track:T,type:R}=v;const P=Date.now();a.store.publish(T.getTrackId(),R===Ye.LocalAudioTrack?"audio":"video",P)}),a.bindLocalTrackEvents(d);const h=yield xn(a.sendConnection.send(d.map(v=>{let{track:T}=v;return T}),a.store.codec,a.store.audioCodec)),m=(yield xn(h.next())).value,y=a.createGatewayPublishMessage(d,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===te.WS_ABORT&&d.forEach(T=>{let{track:R}=T;a.pendingLocalTracks.indexOf(R)===-1&&a.pendingLocalTracks.push(R)}),a.unbindLocalTrackEvents(d),v}yield xn(h.next()),d.forEach(v=>{let{type:T}=v;a.statsCollector.addLocalStats(T)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach(v=>{let{track:T,type:R}=v;const P=Date.now();a.store.publish(T.getTrackId(),R===Ye.LocalAudioTrack?"audio":"video",void 0,P)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Qn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!at(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Qn.Connected)return s&&s[1].track.close(),a;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a;const m={stream_type:l_e(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(a=>{_r(this,Vt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{_r(this,Vt.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Hl(function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Fs(this,Vt.RequestRePublish,this.pendingLocalTracks),this.emit(Vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===Tt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new uS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new lS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(T=>{let{user:R,kind:P}=T;return R.uid===t.uid&&r===P});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Vt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(a.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(d=>{let{kind:h}=d;var m;if(h===Tt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===Tt.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:m}]=d;var y,v;if(m===Tt.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Tt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===Tt.AUDIO){var T;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((T=h._audioTrack)===null||T===void 0||T._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;_r(this,Vt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[Tt.VIDEO,Tt.AUDIO].forEach(a=>{s.has(a)?_r(this,Vt.RequestP2PUnmuteRemote,a):_r(this,Vt.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===Tt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ye.LocalAudioTrack);if((r==null?void 0:r.track)instanceof zi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ye.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Ye.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Ye.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Ye.LocalAudioTrack),m=a?this.localTrackMap.get(Ye.LocalVideoLowTrack):this.localTrackMap.get(Ye.LocalVideoTrack);Ot.publish(this.store.sessionId,{eventElapse:Qs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Er.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof ei),m=a?(d=this.localTrackMap.get(Ye.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Pr);Ot.publish(this.store.sessionId,{eventElapse:Qs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Er.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===Tt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ot.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===Tt.VIDEO,audio:a===Tt.AUDIO,peerid:s.uid,subscribeRequestid:a===Tt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Qs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ys("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ys("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ye.LocalAudioTrack);if((t==null?void 0:t.track)instanceof zi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Qn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ye.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ye.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Pr||r&&r.track instanceof ei?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(ol(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ye.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=vT(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Qn.Reconnecting,ae("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Ye.LocalVideoTrack:at(r=a._hints).call(r,Er.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ye.LocalAudioTrack:a instanceof zi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ye.LocalVideoLowTrack:}}),this.emit(Vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(ol(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(Vt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof og?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===Zo.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await Fs(this,Vt.RequestP2PRestartICE,{direction:Zo.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalAudioTrack),a=t.videoSend.find(D=>{var G;return D.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(D=>{var G;return D.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!a||!c)return 1;const d=il(this,Vt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,T=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(Er.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const F=(1e3*D-G)/(1e3*D);return kH[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=il(this,Vt.NeedSignalRTT),v=t.rtt,T=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let D=.7*P*100/50+.3*T/1500;R&&(D=.6*P*100/50+.2*T/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new pt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const a=[],c=Bn(),d=this.getAllTracks();t=Xv(t=t.filter(y=>d.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Pr&&(this.localTrackMap.has(Ye.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Ye.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Ye.LocalVideoLowTrack})}if(y instanceof ei){const v=this.localTrackMap.get(Ye.LocalAudioTrack);if(v){if(!(v.track instanceof zi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const T=a.find(R=>{let{type:P}=R;return P===Ye.LocalAudioTrack});if(!(T.track instanceof zi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");T.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof zi||y._bypassWebAudio)a.push({track:y,type:Ye.LocalAudioTrack});else{const T=new zi;T.addAudioTrack(y),a.push({track:T,type:Ye.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Xv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof ei){const c=this.localTrackMap.get(Ye.LocalAudioTrack);if(!c)continue;c.track instanceof zi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Ye.LocalAudioTrack,c]),c.track.close())):r.push([Ye.LocalAudioTrack,c])}if(a instanceof Pr){const c=this.localTrackMap.get(Ye.LocalVideoTrack);if(!c)continue;r.push([Ye.LocalVideoTrack,c]);const d=this.localTrackMap.get(Ye.LocalVideoLowTrack);d&&r.push([Ye.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ye.LocalVideoTrack:s.addListener(Rt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof zi?t.trackList.forEach(s=>{s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ye.LocalVideoTrack:s.off(Rt.GET_STATS,this.handleGetLocalVideoStats),s.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ye.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ye.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof zi?t.trackList.forEach(r=>{r.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Rt.GET_STATS,this.handleGetLocalAudioStats),r.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Rt.GET_STATS,this.handleGetLocalAudioStats),t.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof lS&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof uS&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Rt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Tt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Tt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,{track:h,type:m}=s;switch(m){case Ye.LocalAudioTrack:d=Zn.Audio;break;case Ye.LocalVideoTrack:d=at(c=h._hints).call(c,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:d=Zn.Low}return{kind:m===Ye.LocalAudioTrack?Tt.AUDIO:Tt.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalVideoTrack:a=at(s=d._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Vt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),at(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await bs(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Ot.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Xr.TRACER}).onSuccess(),this.emit(Vt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(ol(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(iS.FIRST_FRAME_DECODED),Ot.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_DECODE,Fr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(ol(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&Ot.firstRemoteFrame(this.store.sessionId,es.FIRST_AUDIO_RECEIVED,Fr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(ol(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&Ot.firstRemoteFrame(this.store.sessionId,es.FIRST_VIDEO_RECEIVED,Fr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Vt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(rg(s))," -> ").concat(JSON.stringify(rg(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(rg(s))," -> ").concat(JSON.stringify(rg(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Vt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Zo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Zo.SEND_ONLY?this.restartICE(t):Fs(this,Vt.RequestP2PRestartICE,{direction:Zo.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof ei&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive||r.push([Ye.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===Ye.LocalVideoTrack)){const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ye.LocalAudioTrack);if(t instanceof ei&&(s==null?void 0:s.track)instanceof zi)return s.track.isActive&&r.push([Ye.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===Ye.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Ye.LocalVideoLowTrack);c&&r.push([Ye.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoTrack:a=at(s=d._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Ye.LocalAudioTrack:a=Zn.Audio;break;case Ye.LocalVideoTrack:a=at(s=d._hints).call(s,Er.SCREEN_TRACK)?Zn.Screen:Zn.High;break;case Ye.LocalVideoLowTrack:a=Zn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case Tt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:Tt.VIDEO,ssrcId:a._videoSSRC}));case Tt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:Tt.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ye.LocalVideoTrack),s=this.localTrackMap.get(Ye.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new pt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new pt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof ei){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await _r(this,Vt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Vt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await bs(NL(this.dtlsFailedCount,Li)),this.emit(Vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ye.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Pr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Pr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof ei).length>1&&(t.some(r=>r instanceof ei&&r._bypassWebAudio)||!Bn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Pr&&this.pendingLocalTracks.some(s=>s instanceof Pr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ei&&this.pendingLocalTracks.some(s=>s instanceof ei)&&(!Bn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof ei&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!ae("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding,a=TO(TO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():BM(t,a);const d=yr(8,"track-low-"),h=new Pr(c,TO(TO({},s&&{scaleResolutionDownBy:TM(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(ey.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,nS.LOW_STREAM)}),h._hints.push(Er.LOW_STREAM),t.addListener(Rt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(ol(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Ot.firstRemoteVideoDecode(this.store.sessionId,es.FIRST_VIDEO_DECODE,Fr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Qs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ye.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,nS.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},It(Wr.prototype,"p2pConnect",[yK],Object.getOwnPropertyDescriptor(Wr.prototype,"p2pConnect"),Wr.prototype),It(Wr.prototype,"unpublish",[EK],Object.getOwnPropertyDescriptor(Wr.prototype,"unpublish"),Wr.prototype),It(Wr.prototype,"unpublishLowStream",[vK],Object.getOwnPropertyDescriptor(Wr.prototype,"unpublishLowStream"),Wr.prototype),It(Wr.prototype,"subscribe",[SK],Object.getOwnPropertyDescriptor(Wr.prototype,"subscribe"),Wr.prototype),It(Wr.prototype,"mockSubscribe",[bK],Object.getOwnPropertyDescriptor(Wr.prototype,"mockSubscribe"),Wr.prototype),It(Wr.prototype,"unsubscribe",[TK],Object.getOwnPropertyDescriptor(Wr.prototype,"unsubscribe"),Wr.prototype),It(Wr.prototype,"muteRemote",[wK],Object.getOwnPropertyDescriptor(Wr.prototype,"muteRemote"),Wr.prototype),It(Wr.prototype,"unmuteRemote",[CK],Object.getOwnPropertyDescriptor(Wr.prototype,"unmuteRemote"),Wr.prototype),It(Wr.prototype,"hasRemoteMediaWithLock",[RK],Object.getOwnPropertyDescriptor(Wr.prototype,"hasRemoteMediaWithLock"),Wr.prototype),It(Wr.prototype,"disconnectForReconnect",[IK],Object.getOwnPropertyDescriptor(Wr.prototype,"disconnectForReconnect"),Wr.prototype),It(Wr.prototype,"remoteMediaSsrcChanged",[AK],Object.getOwnPropertyDescriptor(Wr.prototype,"remoteMediaSsrcChanged"),Wr.prototype),Wr);function qd(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case Kd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Kd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},a}}class Sy extends Gr{constructor(r,s){super(),q(this,"signal",void 0),q(this,"token",void 0),q(this,"tokenTimeout",void 0),q(this,"tokenInterval",void 0),q(this,"_sequence",0),q(this,"userMap",new Map),q(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===Sr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*ae("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,d){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(nl(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:yr(6,""),d=(y=d)!==null&&y!==void 0?y:this._sequence++;const T={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(v)};ae("SHOW_P2P_LOG")&&x.debug("send message",T,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(T)).forEach(P=>{this.signal.request(Kt.DATA_STREAM,{payload:Qm(this.encoder.encode(P))})});const R=new pt((P,D)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),Q),this.off(mS.ABORT,W),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?D(new Le(te.INVALID_REMOTE_USER)):D(new Le(te.TIMEOUT))},ae("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),F=()=>{G&&window.clearTimeout(G),this.off(mS.ABORT,W),a&&P()},W=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),Q),D(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(mS.ABORT,W),this.once("res-@".concat(c,"_ack"),F);const Q=(fe,ye)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off(mS.ABORT,W),fe==="success"?P(ye):D(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;a||(this.once("res-@".concat(c),Q),bs(ae("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(T))}))});try{return await R}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,s,a,c,d);throw P}}onMessage(r){var s;const{_uid:a}=r;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==pi.CHECK)return;const{token:v}=r;c=new Map,d={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Cn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:T}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==T)return;{const P=vT(R).call(R,(D,G)=>D.index-G.index).map(D=>D.payload).join("");c.delete(v),(r=JSON.parse(P))._uid=a}}const{_type:m,token:y}=r;if(at(s=[pi.ACK,pi.CHECK]).call(s,m))return m===pi.CHECK&&this.handleCheckToken(d,y),void this.receiveMessage(r);y==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:yr(6,""),token:this.token,_type:pi.CHECK};ae("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Kt.DATA_STREAM,{payload:Qm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:pi.ACK,token:this.token};ae("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Kt.DATA_STREAM,{payload:Qm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(pi.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:T,nextExpectedSequenceNumber:R}=v;for(;T.has(R);){const P=T.get(R);T.delete(R),this.receiveMessage(P),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:a,_seq:c}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=d;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:d}=r;if(ae("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==pi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case pi.CANDIDATE:case pi.CONTROL:this.signal.emit(a,h,d);break;case pi.PUBLISH:case pi.UNPUBLISH:case pi.RESTART_ICE:case pi.CALL:h.uid=d,Fs(this.signal,a,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case pi.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case pi.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<Sy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=yr(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const y={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(y).length>Sy.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},ae("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Fs(this.signal,pi.CALL,void 0),s=await this.send(pi.CALL,r);this.signal.emit(Yt.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(mS.ABORT),this.signal.emit(Cn.ON_USER_OFFLINE,{uid:a.uid,reason:Uge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=yr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(mS.ABORT)}}q(Sy,"MAX_SIZE",1),q(Sy,"MAX_MESSAGE_SIZE",1024);class EEe extends Gr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Sr.CONNECTED?this.emit(Yt.WS_CONNECTED):r===Sr.RECONNECTING?this.emit(Yt.WS_RECONNECTING,this._websocketReconnectReason):r===Sr.CLOSED&&this.emit(Yt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",Sr.CLOSED),q(this,"reconnectToken",void 0),q(this,"p2pToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new s8(5)),q(this,"pingpongTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"_external_signal",void 0),q(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Yt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Cn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Cn.MUTE_AUDIO:case Cn.MUTE_VIDEO:case Cn.ON_P2P_LOST:case Cn.ON_USER_ONLINE:return;case Cn.ON_USER_OFFLINE:const{uid:d}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Jn.UID_BANNED);break;case 15:this.close(Jn.IP_BANNED);break;case 16:this.close(Jn.CHANNEL_BANNED)}if(c._type===Cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(Jn.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(Jn.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Jn.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(Jn.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Jn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(Jn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new SM("gateway-".concat(this.clientId),this.spec.retryConfig,!0,ae("JOIN_GATEWAY_USE_DUAL_DOMAIN"),ae("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Sr.CONNECTED&&this.reconnect("retry",js.OFFLINE)}),this.p2pToken=yr(6,""),this._external_signal=new Sy(this,this.p2pToken)}async request(r,s,a,c){const d=yr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new pt((G,F)=>{if(this.connectionState===Sr.CONNECTED)return G();const W=()=>{this.off(Yt.WS_CLOSED,Q),G()},Q=()=>{this.off(Yt.WS_CONNECTED,W),F(new Le(te.WS_ABORT))};this.once(Yt.WS_CONNECTED,W),this.once(Yt.WS_CLOSED,Q)});if(this.connectionState!==Sr.CONNECTING&&this.connectionState!==Sr.RECONNECTING||r===Kt.JOIN||r===Kt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new pt((G,F)=>{let W=!1;const Q=(fe,ye)=>{W=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.emit(Yt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Q);const ee=()=>{F(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(Yt.WS_CLOSED,ee),this.off(Yt.WS_RECONNECTING,ee),this.off("res-@".concat(d),Q)};this.once(Yt.WS_CLOSED,ee),this.once(Yt.WS_RECONNECTING,ee),bs(ae("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Yt.REQUEST_TIMEOUT,r,s))})});let T=null;try{T=await v}catch(G){if(this.connectionState===Sr.CLOSED||r===Kt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Kt.JOIN||r===Kt.REJOIN?null:(await y(),await this.request(r,s))}if(T.isSuccess)return T.message;const R=Number(T.message.error_code||T.message.code),P=$T(R),D=new Le(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(T.message.error_str),{code:R,data:T.message,desc:P.desc});return P.action==="success"?T.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Kt.JOIN||r===Kt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",js.MULTI_IP)):this.reconnect(P.action,js.SERVER_ERROR),r===Kt.JOIN||r===Kt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new pt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(GT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=ae("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Sr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},ae("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,a)=>{this.once(Yt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Yt.WS_CLOSED,()=>a(this.initError||new Le(te.WS_ABORT))),this.connectionState=Sr.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Jn.LEAVE,this.connectionState=Sr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=yr(6,""),this._external_signal.clear(),this._external_signal=new Sy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Yt.ABORT_P2P_EXECUTION);const r=await Fs(this,Yt.REQUEST_JOIN_INFO),s=await this.request(Kt.JOIN,r);if(!s)return this.emit(Yt.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Yt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Sr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const a=J_(r.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||at(s=Object.values(pi)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(Cn.ON_DATA_STREAM,r)}catch{this.emit(Cn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=$T(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Jn.UID_BANNED),void this.close()):void this.reconnect(s.action,js.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=ae("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ae("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",js.TIMEOUT):this.request(Kt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),ae("REPORT_STATS")&&this.send(Kt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(tn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Yt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(tn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(tn.CLOSED,()=>{this.connectionState=Sr.CLOSED}),this.websocket.on(tn.FAILED,()=>{this._disconnectedReason=Jn.NETWORK_ERROR,this.connectionState=Sr.CLOSED}),this.websocket.on(tn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Sr.CONNECTED?this.connectionState=Sr.RECONNECTING:this.connectionState=Sr.CONNECTING}),this.websocket.on(tn.WILL_RECONNECT,(r,s,a)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(tn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Yt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",js.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",js.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(tn.REQUEST_NEW_URLS,(r,s)=>{Fs(this,Yt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(tn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const vEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new yEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new EEe(s,r)}};function OK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function kK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?OK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):OK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class SEe{constructor(r){q(this,"sessionDesc",void 0),q(this,"localCapabilities",void 0),q(this,"rtpCapabilities",void 0),q(this,"candidates",void 0),q(this,"_originCandidates",void 0),q(this,"iceParameters",void 0),q(this,"dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),r=Jr(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,T=ec(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=Jr(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<T.mediaDescriptions.length;R++){const P=T.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=a.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=d.videoCodecs.map(G=>G.payloadType.toString(10));let D=d.videoCodecs.filter(G=>{var F,W;return(F=G.rtpMap)===null||F===void 0?void 0:at(W=F.encodingName.toLowerCase()).call(W,y)});D.length===0&&(D=d.videoCodecs),P.attributes.payloads=D,P.attributes.extmaps=d.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=d.audioCodecs.map(D=>D.payloadType.toString(10)),P.attributes.payloads=d.audioCodecs,P.attributes.extmaps=d.audioExtensions),T.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return Zm(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:d}=ay(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===Tt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{at(r).call(r,h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;at(m=d.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(kK(kK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Js.TCP_RELAY:this.candidates=a;break;case Js.UDP_TCP_RELAY:case Js.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Jr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=Jr(r);return yS(a,s),CM(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Tt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(r){const s=Jr(r);return wM(s),function(a){const c=a.attributes.extmaps.find(d=>jP(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var fr;function NK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function wO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?NK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):NK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let bEe=(fr=class lC extends BH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return at(s=Object.keys(fP)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"statsFilter",void 0),q(this,"useRTX",!1),q(this,"localCapabilities",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"establishPromise",void 0),q(this,"mutex",void 0),this.store=s,this.mutex=new Ys("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(lC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=VL(this.peerConnection,ae("STATS_UPDATE_INTERVAL"),void 0,qr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=ig(r.sdp),a=YT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:ae("FILTER_VIDEO_FEC"),filterAudioFec:ae("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,wO(wO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new SEe(wO(wO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Hl(function*(){const c=yield xn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(P=>a.peerConnection.addTrack(P._mediaStreamTrack)),h=yield xn(a.peerConnection.createOffer()),m=ec(h.sdp),y=r.map(P=>{const D=P._mediaStreamTrack,G=m.mediaDescriptions.find(F=>F.attributes.mid===D.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(F,W,Q){const ee=F.attributes.ssrcs.filter(ye=>ye.attributes.label===W),fe=F.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fe&&ee.length>1){const ye=fe.find(ve=>ve.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:Q?ye.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,D.id,a.useRTX)});let v;try{v=yield y}catch(P){throw d.forEach(D=>{Vs()&&D.replaceTrack(null),a.peerConnection.removeTrack(D)}),P}const T=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,v);const R=a.remoteSDP.toString();return yield xn(a.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield xn(a.applySendEncodings(d,r)),yield xn(a.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,D)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[D],id:G}})}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{Vs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new pt((T,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(d)))},1e4),D=G=>{const F=Ln();if((F.name==="Safari"&&Number(F.version)===11||Xo())&&G.track.id!==d&&G.streams[0].id===h){var W;const Q=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(r,d,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void T(Q)}if(G.track.id===d)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void T(G.track)};this.peerConnection.addEventListener("track",D)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:d}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(Vs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(Vs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Hl(function*(){const a=yield xn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Bn().supportPCSetConfiguration;if(r===Js.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),T=r===Js.RELAY?"relay":"all";v.iceTransportPolicy!==T&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(T,"]")),v.iceTransportPolicy=T,s.peerConnection.setConfiguration(v))}r!==Js.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield xn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=ig(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield xn(s.peerConnection.setLocalDescription(d)),yield xn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ae("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(MT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...lC.turnServerConfigToIceServers(r.turnServer.servers)),ae("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...lC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(v=>{var T;return((T=v.track)===null||T===void 0?void 0:T.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Bn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Pr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(ae("DSCP_TYPE")&&pf()){var h;const v=ae("DSCP_TYPE");at(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const m=s.getParameters(),y=(a=m.encodings)===null||a===void 0?void 0:a[0];y&&Object.assign(y,d),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Bn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=ec(r);return s.forEach((c,d)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&yS(m,c)}),Zm(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((d,h)=>{let{id:m,mslabel:y}=d;const{kind:v}=r[h];return new pt((T,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),D=G=>{const F=Ln();if(F.name==="Safari"&&Number(F.version)===11&&G.track.id!==m&&G.streams[0].id===y){var W;const Q=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void T({track:Q,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void T({track:G.track,id:m})};this.peerConnection.addEventListener("track",D)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await pt.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Bn().supportPCSetConfiguration){const s=lC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},It(fr.prototype,"connect",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"connect"),fr.prototype),It(fr.prototype,"stopSending",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"stopSending"),fr.prototype),It(fr.prototype,"receive",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"receive"),fr.prototype),It(fr.prototype,"stopReceiving",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"stopReceiving"),fr.prototype),It(fr.prototype,"muteRemote",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"muteRemote"),fr.prototype),It(fr.prototype,"unmuteRemote",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteRemote"),fr.prototype),It(fr.prototype,"muteLocal",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"muteLocal"),fr.prototype),It(fr.prototype,"unmuteLocal",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"unmuteLocal"),fr.prototype),It(fr.prototype,"close",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"close"),fr.prototype),It(fr.prototype,"updateEncoderConfig",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"updateEncoderConfig"),fr.prototype),It(fr.prototype,"updateSendParameters",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"updateSendParameters"),fr.prototype),It(fr.prototype,"replaceTrack",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"replaceTrack"),fr.prototype),It(fr.prototype,"getRemoteSSRC",[Zl],Object.getOwnPropertyDescriptor(fr.prototype,"getRemoteSSRC"),fr.prototype),fr);function Zl(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}const TEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new bEe(s,r)}},wEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(TP.has(t)||!t.track)return;const s={track:t.track};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=r.metadata&&r.metadata();y?function(v,T){const{chunk:R,controller:P}=T,D=ae("ENABLE_AUDIO_PTS_METADATA")?_f.AUDIO_64_BIT_PTS:_f.METADATA;R.data=function(G,F,W){const Q=W.byteLength,ee=Q+cM+CH,fe=oM+aM+ee,ye=new ArrayBuffer(G.byteLength+fe),ve=new DataView(ye);ve.setUint8(0,wH),ve.setUint16(1,ee),ve.setUint8(3,F),ve.setUint16(4,Q);for(let Ne=0;Ne<Q;Ne++)ve.setUint8(6+Ne,W[Ne]);const _e=new Uint8Array(ve.buffer);return _e.set(new Uint8Array(G),fe),_e.buffer}(R.data,D,v),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=bP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&d.port1.postMessage({metadata:v})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=TP.get(t);if(c){TP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}TP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(PP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");vL(Kn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?function(y,v,T){var R;const P=RH(new DataView(v.data));if(!P)return T.enqueue(v);const D=y.track.id;ige.set(D,y.track);const G=(R=P.tlv.find(ye=>ye.tag===_f.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let F=0;typeof G=="number"&&(F=127-G);const W=Math.round(Math.pow(10,F/60)-1),{selected:Q,speaker:ee}=function(ye,ve){let _e=dS.get(ye);if(_e||(_e=function(Ne){const Je=new AH;return dS.set(Ne,Je),Wd||(Wd=new nge(ae("TOPN_SILENCE_THRESHOLD")||500),Wd.on("ActiveSpeakerChanged",ft=>{ft!=null&&(RP=ft)})),Wd.addSpeakers([Je]),Je}(ye)),dS.size<=PH)return{selected:!0,speaker:_e};if(!Wd)throw new Error("no active speaker detector");return Wd.levelChanged(_e.id,ve),iy=Wd.loudest.map(Ne=>Ne.id),RP&&!at(iy).call(iy,RP)&&iy.length>=PH&&iy.pop(),{selected:at(iy).call(iy,_e.id)||_e.id===RP,speaker:_e}}(y,W),fe=function(ye,ve,_e){const Ne=zd.get(ye)||new rge(ye,ve);return Ne.score=_e,zd.set(ye,Ne),function(Je){if(IP.set(Je,!0),!AP)return void(AP=Date.now());const ft=Date.now();ft-AP>1e3&&(IP.get(Je)?IP.set(Je,!1):(OH(Je),IP.delete(Je)),AP=ft)}(ye),Ne}(D,y.track,ee.energyScore);fe.addSample(Q),fe.active&&(v.data=P.frame.buffer,T.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,T){const R=RH(new DataView(y.data));if(!R)return v.enqueue(y);const P=R.tlv.find(D=>D.tag===_f.METADATA||D.tag===_f.AUDIO_64_BIT_PTS);P&&T&&P.value instanceof Uint8Array&&T(P.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=bP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function a(){t.track.removeEventListener("ended",a),function(c){const d=PP.get(c);if(d){(function(y){const v=dS.get(y);v&&(dS.delete(y),Wd&&(Wd.removeSpeakers([v]),dS.size===0&&(Wd.destroy(),Wd=null)))})(c),OH(c.track.id),PP.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}PP.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!Bn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(OP.has(t)||!t.track)return;const s={track:t.track};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",m=>{d.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const v=d.shift();v&&(m.data=function(T,R){const P=function(ee){const fe=ee.length;let ye=[],ve=0;for(;ve<fe;)ve+2<fe&&ee[ve]===0&&ee[ve+1]===0&&(ee[ve+2]===0||ee[ve+2]===1||ee[ve+2]===2||ee[ve+2]===3)?(ye.push(ee[ve],ee[ve+1],3,ee[ve+2]),ve+=3):(ye.push(ee[ve]),ve++);return new Uint8Array(ye)}(R),D=P.length,G=Math.floor(D/255),F=D%255,W=new Uint8Array(6+G+1+D+T.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=6,W[5]=101;let Q=0;for(;Q<G;)W[6+Q]=255,Q++;return W[6+Q]=F,Q++,W.set(P,6+Q),W.set(new Uint8Array(T),6+Q+D),W.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Vs())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=bP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=OP.get(t);if(c){OP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}OP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(zT.has(t)){const c=zT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=function(v){const T=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(T.getUint8(R+0)===0&&T.getUint8(R+1)===0&&T.getUint8(R+2)===0&&T.getUint8(R+3)===1&&T.getUint8(R+4)===6){let P=R+6,D=0,G=0;for(;(G=T.getUint8(P++))===255;)D+=255;D+=G;const F=sge(v.data,P,D);return new Uint8Array(F)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=bP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const d=zT.get(c);if(d){zT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}zT.set(t,s),t.track.addEventListener("ended",a)}},CEe={name:"InterceptFrame",create:()=>wEe};jL(),or("PROCESS_ID","process-".concat(yr(8,""),"-").concat(yr(4,""),"-").concat(yr(4,""),"-").concat(yr(4,""),"-").concat(yr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Ar,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;Bd[a]=c,Ar[a]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Bd.AREAS)&&Bd.AREAS.length>0&&OM(Bd.AREAS,!0);const DK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),or(t,r,s)};sg(qye,!1),sg(Jye,!1),sg(O_e,!1),sg(cEe,!1),sg(Hye,!1),sg(vEe,!1),sg(TEe,!1),sg(CEe,!1);const Mi=function(t){const r=new Gr,s=t,a={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(h,m){h===zh.SECURITY_POLICY_VIOLATION&&p7(m,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return h7(h7({},s),a)}({__TRACK_LIST__:tS,VERSION:$l,BUILD:WL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:DK,getParameter:ae,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(a){let c;return Bn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Ae(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Ot.reportApiInvoke(null,{name:xi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Xr.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&wL()&&xz(75)&&new d().close()}catch(d){return x.error("check system requirement failed: ",d),!1}let s=!1;const a=Ln();a.name===Kn.CHROME&&Number(a.version)>=58&&(jd.engine.name!=="WebKit"||function(){const d=Ln();if(sP()){if(d.os===Zi.MAC_OS)return!0;if(d.os===Zi.IOS){const h=jd.os.version&&jd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===Kn.FIREFOX&&Number(a.version)>=56||a.name===Kn.OPERA&&Number(a.version)>=45||a.name===Kn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Xo()||Vu())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||Fz()||Ln().name===Kn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return dl.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return dl.getRecordingDevices(t)},getCameras:function(t){return dl.getCamerasDevices(t)},getElectronScreenSources:x8,getPlaybackDevices:function(t){return dl.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=yr(5,"client-"),a=Ot.reportApiInvoke(null,{id:s,name:xi.CREATE_CLIENT,options:[r],tag:Xr.TRACER});try{(function(c){Ki(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ki(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ki(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Ss(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&qz(c.turnServer),c.httpRetryConfig!==void 0&&Kz(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&Kz(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(Mz(16,0)||Uz(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),or("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new k_e($u($u({forceWaitGatewayResponse:!0},r),{},{role:at(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=ae("CAMERA_CAPTURE_CONFIG"),s=yr(8,"track-cam-"),a=Ot.reportApiInvoke(null,{id:s,tag:Xr.TRACER,name:xi.CREATE_CAM_VIDEO_TRACK,options:[Br({},t),r]});r&&(t.encoderConfig=r);const c=vP(t);let d=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await ul({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(x)}t.optimizationMode&&sM(s,d,t,Fh(t.encoderConfig));const h=new iM(d,t,c,t.scalabiltyMode?gP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=yr(8,"track-cus-"),s=Ot.reportApiInvoke(null,{id:r,tag:Xr.TRACER,name:xi.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),a=new Pr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?gP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Er.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),x.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return G8(P)}(r):void 0;s&&(r="auto");const a=yr(8,"track-scr-v-"),c=Ot.reportApiInvoke(null,{id:a,tag:Xr.TRACER,name:xi.CREATE_SCREEN_VIDEO_TRACK,options:[Br({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(P){const D={};P.screenSourceType&&(D.mediaSource=P.screenSourceType),P.extensionId&&hf()&&(D.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:F,surfaceSwitching:W,systemAudio:Q,preferCurrentTab:ee}=P;(NT(107)||SL(107)||bL(93))&&(G&&(Ki(G,"displaySurface",["browser","window","monitor"]),D.displaySurface=G),F?(Ki(F,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=F):D.selfBrowserSurface="include",W&&(Ki(W,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=W)),(NT(105)||SL(105)||bL(91))&&Q&&(Ki(Q,"systemAudio",["exclude","include"]),D.systemAudio=Q),(NT(94)||SL(94)||bL(80))&&ee&&(D.preferCurrentTab=!0),P.electronScreenSourceId&&(D.sourceId=P.electronScreenSourceId);const fe=P.encoderConfig?KL(P.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:fe?fe.width:void 0,maxHeight:fe?fe.height:void 0},fe&&(fe.frameRate&&(typeof fe.frameRate=="number"?(D.mandatory.maxFrameRate=fe.frameRate,D.mandatory.minFrameRate=fe.frameRate):(D.mandatory.maxFrameRate=fe.frameRate.max||fe.frameRate.ideal||fe.frameRate.exact||void 0,D.mandatory.minFrameRate=fe.frameRate.min||fe.frameRate.ideal||fe.frameRate.exact||void 0),D.frameRate=fe.frameRate),fe.width&&(D.width=fe.width),fe.height&&(D.height=fe.height)),D}(t);let h=null,m=null;const y=Bn();if(!y.supportShareAudio&&r==="enable"){const P=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const v=y.supportShareAudio&&r!=="disable";try{const P=await ul({screen:d,screenAudio:v?s||!0:void 0},a);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(sM(a,h,t,t.encoderConfig&&KL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const T=new Pr(h,t.encoderConfig?KL(t.encoderConfig):{},t.scalabiltyMode?gP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[Er.SCREEN_TRACK]);if(!m)return c.onSuccess(T.getTrackId()),x.info("create screen video track success","video:",T.getTrackId()),T;const R=new ei(m,void 0,yr(8,"track-scr-a-"),!1);return c.onSuccess([T.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",T.getTrackId(),"audio:",R.getTrackId()),[T,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=ae("CAMERA_CAPTURE_CONFIG"),a=yr(8,"track-mic-"),c=yr(8,"track-cam-"),d=Ot.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:Xr.TRACER,name:xi.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=vP(r),m=H8(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await ul({audio:m,video:h},"".concat(a,"-").concat(c));y=P.getAudioTracks()[0],v=P.getVideoTracks()[0]}catch(P){throw d.onError(P),P}if(!y||!v){const P=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(P),P.throw(x)}r.optimizationMode&&sM(c,v,r,Fh(r.encoderConfig));const T=new SP(y,t,m,a),R=new iM(v,r,h,r.scalabiltyMode?gP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([T.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[T,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=yr(8,"track-mic-"),s=Ot.reportApiInvoke(null,{id:r,tag:Xr.TRACER,name:xi.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=H8(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await ul({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const d=new SP(c,t,a,r);return s.onSuccess(d.getTrackId()),x.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=yr(8,"track-cus-"),s=Ot.reportApiInvoke(null,{id:r,tag:Xr.TRACER,name:xi.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new ei(t.mediaStreamTrack,t.encoderConfig?_P(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=yr(8,"track-buf-"),m=Ot.reportApiInvoke(null,{id:h,tag:Xr.TRACER,name:xi.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(ae("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let D=null;if(typeof R=="string"){const F=kG.get(R);if(F)return x.debug("use cached audio resource: ",R),F;try{D=(await Fd(()=>Ta.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(W){throw new Le(te.FETCH_AUDIO_FILE_FAILED,W.toString())}}else D=await new pt((W,Q)=>{const ee=new FileReader;ee.onload=fe=>{fe.target?W(fe.target.result):Q(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{Q(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(F){const W=aS();return new pt((Q,ee)=>{W.decodeAudioData(F,fe=>{Q(fe)},fe=>{ee(new Le(te.DECODE_AUDIO_FILE_FAILED,fe.toString()))})})}(D);return typeof R=="string"&&P&&kG.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new Jme(c),T=new Xme(y,v,a?_P(a):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(T.getTrackId()),T},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Ae(te.INVALID_PARAMS,"invalid app type",t);or("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){ae("USE_NEW_LOG")?or("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){ae("USE_NEW_LOG")?or("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new k9},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ot.reportApiInvoke(null,{tag:Xr.TRACER,name:xi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof ei||t instanceof uS)){const y=new Ae(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof ei?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new pt(y=>{const v=setInterval(()=>{const T=t.getVolumeLevel();d=T>d?T:d,h=T<h?T:h;const R=d-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(v);const D=R,G={duration:P,deviceLabel:a,maxVolumeLevel:d,result:D};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(D)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ot.reportApiInvoke(null,{tag:Xr.TRACER,name:xi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Pr||t instanceof lS)){const R=new Ae(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Pr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Vs()||sP())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,D,G,F){let W,Q=0,ee=null;return new pt((fe,ye)=>{function ve(){Q>F&&W&&(W(),fe(Q));const _e=G.getContext("2d");if(!_e){const ft=new Ae(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(ft.toString()),void ye(ft)}_e.drawImage(P,0,0,160,120);const Ne=_e.getImageData(0,0,G.width,G.height),Je=Math.floor(Ne.data.length/3);if(ee){for(let ft=0;ft<Je;ft+=3)if(Ne.data[ft]!==ee[ft])return Q+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{W&&(W(),fe(Q))},D),W=QL(()=>{ve()},30)})}(d,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}g_e===Kn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=m>4,T={duration:y,changedPicNum:m,deviceLabel:a,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(T))),s.onSuccess(T),v},setArea:OM,audioElementPlayCenter:wa,resumeAudioContext:function(){wa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){D_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=ae("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!at(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=x.extLog,a.reporter.hookApiInvoke=Ot.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=ae(c)})}),DK("PLUGIN_INFO",r)},ChannelMediaRelayError:pS,ChannelMediaRelayEvent:Ef,ChannelMediaRelayState:tc,RemoteStreamFallbackType:zme,RemoteStreamType:Wme,ConnectionDisconnectedReason:Jn,AudienceLatencyLevelType:Eme,AREAS:qn,preload:async function(t,r,s,a){return i$(t,r,s,a)}});return Object.defineProperties(Mi,{onAudioAutoplayFailed:{get:()=>hl.onAudioAutoplayFailed,set:t=>{hl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>hl.onAutoplayFailed,set:t=>{hl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Mi._onSecurityPolicyViolation,set(t){Mi._onSecurityPolicyViolation=t,p7(t)}},__CLIENT_LIST__:{get:()=>ae("SHOW_GLOBAL_CLIENT_LIST")?sy:[]}}),dl.on(ty.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Mi.onCameraChanged&&Mi.onCameraChanged(t),Mi.safeEmit(zh.CAMERA_CHANGED,t)}),dl.on(ty.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Mi.onMicrophoneChanged&&Mi.onMicrophoneChanged(t),Mi.safeEmit(zh.MICROPHONE_CHANGED,t)}),dl.on(ty.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Mi.onPlaybackDeviceChanged&&Mi.onPlaybackDeviceChanged(t),Mi.safeEmit(zh.PLAYBACK_DEVICE_CHANGED,t)}),wa.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),hl.onAudioAutoplayFailed&&hl.onAudioAutoplayFailed()},ar.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),hl.onAudioAutoplayFailed&&hl.onAudioAutoplayFailed(),Mi.safeEmit(zh.AUTOPLAY_FAILED)}),ar.on(ws.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Mi.onAudioContextStateChanged&&Mi.onAudioContextStateChanged(t,r),Mi.safeEmit(zh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),Si.on(Yv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Mi),Mi})}(zk)),zk.exports}var eGe=Z8e();const aR=Xg(eGe),tGe="a2a7f4eb05284449b1063eb71d8301dc",nGe=aR.createClient({mode:"rtc",codec:"vp8"});let zw=null;const Dae=k.createContext(null),xae=({children:n,appId:e=tGe,channel:i=null,token:o=null,uid:l=null,enabled:u=!0,startMuted:f=!0,onClientReady:_=()=>{}})=>{const[E,S]=k.useState(!1),[C,I]=k.useState(!1),[O,M]=k.useState([]),[L,U]=k.useState(null),[B,J]=k.useState(null),[K,ne]=k.useState(null),[oe,se]=k.useState(!1),[le,Y]=k.useState(!1),[Z,X]=k.useState(!1),[ie,de]=k.useState(null),[ue,pe]=k.useState(!1),ke=Ua(),xe=k.useRef(nGe),je=k.useRef({appId:e,channel:i,uid:l,enabled:u}),Oe=k.useRef(!1),we=k.useRef(null);k.useRef(null),k.useEffect(()=>{je.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),k.useEffect(()=>{J(i)},[i]),k.useEffect(()=>{if(!xe.current)return;const qe=rt=>{$.log(`Connection state changed to: ${rt}`),rt==="DISCONNECTED"?(S(!1),$.log("Disconnected from Agora")):rt==="CONNECTED"&&(S(!0),U(null))};return xe.current.on("connection-state-change",qe),()=>{xe.current.off("connection-state-change",qe)}},[]),k.useEffect(()=>{if(!i||!u)return;const qe=async(dt,kt)=>{$.log(`User published: ${dt.uid}, mediaType: ${kt}`);try{await xe.current.subscribe(dt,kt),kt==="audio"&&dt.audioTrack.play(),M(ct=>ct.some(Ut=>Ut.uid===dt.uid)?ct:[...ct,dt])}catch(ct){$.error("Error subscribing to user:",ct)}},rt=(dt,kt)=>{$.log(`User unpublished: ${dt.uid}, mediaType: ${kt}`),kt==="audio"&&dt.audioTrack&&dt.audioTrack.stop()},et=dt=>{$.log(`User joined: ${dt.uid}`),M(kt=>kt.some(ct=>ct.uid===dt.uid)?kt:[...kt,dt])},_t=dt=>{$.log(`User left: ${dt.uid}`),M(kt=>kt.filter(ct=>ct.uid!==dt.uid))};return xe.current.on("user-published",qe),xe.current.on("user-unpublished",rt),xe.current.on("user-joined",et),xe.current.on("user-left",_t),(async()=>{if(Oe.current){$.log("Already initializing, skipping duplicate initialization");return}Oe.current=!0;try{if(E&&we.current===i){$.log(`Already joined to channel ${i}`),se(!0),_(xe.current);return}if(xe.current.connectionState==="CONNECTING"||xe.current.connectionState==="CONNECTED")if(we.current&&we.current!==i){$.log("Connected to different channel, leaving first");try{await Ee()}catch(dt){$.error("Error leaving channel:",dt)}}else{S(!0),se(!0),we.current=i,zw=i,_(xe.current);return}$.log(`Joining channel ${i}`),await Be(),$.log("Join channel completed")}catch(dt){$.error("Error during initialization:",dt)}finally{Oe.current=!1}})(),()=>{$.log("Cleaning up event listeners"),xe.current.off("user-published",qe),xe.current.off("user-unpublished",rt),xe.current.off("user-joined",et),xe.current.off("user-left",_t)}},[i,u,l,_,E]);const Se=async()=>{if(!u||K)return K;$.log("Initializing microphone");try{const qe=await aR.createMicrophoneAudioTrack();return await qe.setMuted(f),ne(qe),$.log("Microphone initialized successfully"),qe}catch(qe){return $.error("Error initializing microphone:",qe),U("Failed to initialize microphone. Please check your permissions."),null}};k.useEffect(()=>{(async()=>{if(i)try{const _t=await ad(i);_t&&_t.voiceDisabled?($.log("Voice is disabled for this space"),pe(!0),E&&await Ee()):pe(!1)}catch(et){$.error("Error checking if voice is disabled:",et)}})();const rt=et=>{et.detail&&typeof et.detail.voiceDisabled=="boolean"&&($.log("Voice setting changed:",et.detail.voiceDisabled),pe(et.detail.voiceDisabled),et.detail.voiceDisabled&&E?Ee():!et.detail.voiceDisabled&&!E&&u&&i&&Be())};return window.addEventListener("SpaceVoiceSettingChanged",rt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",rt)}},[i,E,u]);const Be=async()=>{if(!u)return $.log("Agora is disabled, not joining channel"),!1;if(ue)return $.log("Voice is disabled for this space, not joining channel"),U("Voice chat is disabled for this space"),!1;if(!i)return $.error("AgoraProvider: No channel specified"),U("No channel specified"),!1;if($.log(`joinChannel called for channel ${i} with UID ${l}`),$.log("Current state:",{isJoined:E,isJoining:le,connectionState:xe.current.connectionState,joinedChannel:we.current}),E&&we.current===i)return $.log(`Already joined to channel: ${i}`),!0;if(le)return $.log("AgoraProvider: Already in the process of joining"),!1;if(xe.current.connectionState==="CONNECTED")if(we.current&&we.current!==i){$.log("Connected to different channel, leaving first");try{await Ee()}catch(qe){$.error("Error leaving channel:",qe)}}else return $.log("Client already connected, setting joined state to true"),S(!0),se(!0),we.current=i,zw=i,_(xe.current),!0;if(xe.current.connectionState==="CONNECTING")return $.log("Client already connecting, waiting for connection"),Y(!0),new Promise(qe=>{const rt=setInterval(()=>{xe.current.connectionState==="CONNECTED"&&(clearInterval(rt),S(!0),Y(!1),se(!0),we.current=i,zw=i,_(xe.current),qe(!0))},500);setTimeout(()=>{clearInterval(rt),$.log("AgoraProvider: Connection timeout, considering join failed"),Y(!1),qe(!1)},1e4)});try{if($.log(`Joining channel: ${i} with UID: ${l||"random"}`),$.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const rt="AgoraProvider: App ID is empty or invalid";return $.error(rt),U(rt),Y(!1),!1}Y(!0);const qe=l||Math.floor(Math.random()*1e6);return await xe.current.join(e,i,o,qe),$.log(`Joined channel successfully with UID: ${xe.current.uid}`),S(!0),Y(!1),se(!0),we.current=i,zw=i,_(xe.current),!0}catch(qe){return $.error("Error joining channel:",qe),U(`Error joining channel: ${qe.toString()}`),Y(!1),!1}},Ee=async()=>{if(E)try{K&&await xe.current.unpublish(K),await xe.current.leave(),zw=null,we.current=null,$.log("Left channel successfully"),S(!1),M([])}catch(qe){$.error("Error leaving channel:",qe),U(qe.message||"Failed to leave channel")}};k.useEffect(()=>()=>{K&&K.close()},[]),k.useEffect(()=>{u&&i&&(!E||we.current!==i)&&Be()},[u,i,E]);const Ce=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(qe){return $.error("Error checking microphone status:",qe),!1}};k.useEffect(()=>{const qe=()=>{const et=Ce();et!==C&&($.log("Syncing microphone state:",{actualStatus:et,currentState:C}),I(et),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:et}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=et,window.agoraClient.microphoneTrack=K))};K&&qe();const rt=setInterval(qe,1e3);return()=>{clearInterval(rt)}},[K,C]);const Pe=async()=>{var qe;if(ue)return $.log("Voice is disabled for this space, cannot toggle"),ke({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const rt=C!==void 0?C:K?!K.muted:!1;if($.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:rt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&($.log("AgoraProvider: No microphone track, initializing..."),!await Se()))return $.error("AgoraProvider: Failed to initialize microphone"),rt;const et=!rt;if($.log("AgoraProvider: New voice state will be:",et),rt){if(K)try{$.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||($.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),$.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(_t){return $.error("Error muting track:",_t),rt}}else if(K)try{xe.current&&E&&!((qe=xe.current.localTracks)!=null&&qe.includes(K))&&($.log("AgoraProvider: Publishing microphone track"),await xe.current.publish(K),$.log("AgoraProvider: Microphone track published successfully")),$.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&($.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),$.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(_t){return $.error("Error unmuting track:",_t),rt}return I(et),et}catch(rt){return $.error("Error toggling voice:",rt),C}},Me=async qe=>{try{ne(qe),$.log("Microphone track updated successfully")}catch(rt){throw $.error("Error updating microphone track:",rt),rt}},We=async()=>{if(!xe.current||!i)return $.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return $.log("AgoraProvider: Stopping screen share"),ie&&(Array.isArray(ie)?(await xe.current.unpublish(ie),ie.forEach(qe=>qe.close())):(await xe.current.unpublish(ie),ie.close()),de(null)),X(!1),$.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;$.log("AgoraProvider: Starting screen share");try{const qe=await aR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return $.log("AgoraProvider: Screen track created:",qe),qe.on("track-ended",()=>{$.log("AgoraProvider: Screen sharing ended by browser UI"),xe.current.unpublish(qe),qe.close(),de(null),X(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await xe.current.publish(qe),de(qe),X(!0),$.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=qe,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(qe){return $.error("AgoraProvider: Error creating screen track:",qe),X(!1),de(null),!1}}catch(qe){return $.error("AgoraProvider: Error toggling screen share:",qe),X(!1),de(null),!1}};k.useEffect(()=>{if($.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:xe.current,isScreenSharing:!1,screenTrack:null};const qe=et=>{$.log("AgoraProvider: Received ToggleScreenShare event"),We().then(_t=>{et.detail&&et.detail.callback&&et.detail.callback(!0,_t)}).catch(_t=>{$.error("AgoraProvider: Error handling ToggleScreenShare event:",_t),et.detail&&et.detail.callback&&et.detail.callback(!1,Z)})},rt=et=>{$.log("AgoraProvider: Received JoinVoiceChat event"),Be().then(_t=>{et.detail&&et.detail.callback&&et.detail.callback(_t)}).catch(_t=>{$.error("AgoraProvider: Error handling JoinVoiceChat event:",_t),et.detail&&et.detail.callback&&et.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",qe),window.addEventListener("JoinVoiceChat",rt),()=>{window.removeEventListener("ToggleScreenShare",qe),window.removeEventListener("JoinVoiceChat",rt),typeof window<"u"&&window.agoraClient&&($.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&($.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),k.useEffect(()=>{$.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=K,window.agoraClient.client=xe.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),$.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,K]);const He={client:xe.current,isJoined:E,isVoiceEnabled:C,users:O,error:L,channel:B,appId:e,toggleVoice:Pe,leaveChannel:Ee,joinChannel:Be,microphoneTrack:K,isReady:oe,createMicrophoneTrack:Me,isScreenSharing:Z,screenTrack:ie,toggleScreenShare:We,voiceDisabled:ue};return b.jsx(Dae.Provider,{value:He,children:n})},Lae=()=>{const n=k.useContext(Dae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};xae.propTypes={children:En.node.isRequired,appId:En.string.isRequired,channel:En.string.isRequired,token:En.string,uid:En.oneOfType([En.string,En.number])};const rGe=()=>{var Oe,we;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:u,isReady:f,channel:_,appId:E,toggleVoice:S,joinChannel:C,leaveChannel:I,createMicrophoneTrack:O,isScreenSharing:M,screenTrack:L,toggleScreenShare:U,voiceDisabled:B}=Lae(),[J,K]=k.useState(e!==void 0?e:((Oe=window.agoraClient)==null?void 0:Oe.isVoiceEnabled)||!1),[ne,oe]=k.useState(M!==void 0?M:((we=window.agoraClient)==null?void 0:we.isScreenSharing)||!1),[se,le]=k.useState(B!==void 0?B:!1),[Y,Z]=k.useState(!0);k.useEffect(()=>{var Se;e!==void 0?K(e):((Se=window.agoraClient)==null?void 0:Se.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):u&&K(!u.muted)},[e,u]),k.useEffect(()=>{var Se;M!==void 0?oe(M):((Se=window.agoraClient)==null?void 0:Se.isScreenSharing)!==void 0&&oe(window.agoraClient.isScreenSharing)},[M]),k.useEffect(()=>{B!==void 0&&le(B)},[B]);const X=k.useRef({isVoiceEnabled:J,isScreenSharing:ne,isJoined:i,users:o,error:l,isReady:f,channel:_,appId:E,voiceDisabled:se});k.useEffect(()=>{X.current={isVoiceEnabled:J,isScreenSharing:ne,isJoined:i,users:o,error:l,isReady:f,channel:_,appId:E,voiceDisabled:se}},[J,ne,i,o,l,f,_,E,se]),k.useEffect(()=>{const Se=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(Se)},[]),k.useEffect(()=>{f&&Z(!1)},[f]),k.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:J,contextIsScreenSharing:M,localScreenSharing:ne,isJoined:i,users:o.length,error:l,isReady:f,channel:_,appId:E,hasMicrophoneTrack:!!u,trackMuted:u==null?void 0:u.muted,hasScreenTrack:!!L})},[e,J,M,ne,i,o,l,f,_,E,u,L]);const ie=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const Se=await S();if(console.log("useVoiceChat: Toggle result:",Se),Se!==void 0)K(Se);else{const Be=!J;K(Be),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Be)}return Se!==void 0?Se:!J}catch(Se){return console.error("useVoiceChat: Error toggling voice:",Se),J}},de=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ne);const Se=await U();if(console.log("useVoiceChat: Screen share toggle result:",Se),Se!==void 0)oe(Se);else{const Be=!ne;oe(Be),window.agoraClient&&(window.agoraClient.isScreenSharing=Be)}return Se!==void 0?Se:!ne}catch(Se){return console.error("useVoiceChat: Error toggling screen share:",Se),ne}},ue=async()=>{J&&u&&await ie()},pe=async()=>{!J&&u&&await ie()},ke=Se=>o.some(Be=>{var Ee;return Be.uid===Se&&((Ee=Be.audioTrack)==null?void 0:Ee.isPlaying)}),xe=k.useCallback(()=>{if(!u||!J)return 0;try{return u.getVolumeLevel()}catch(Se){return console.error("Error getting volume level:",Se),0}},[u,J]);return{isVoiceEnabled:J,isScreenSharing:ne,isJoined:i,users:o,error:l,toggleVoice:ie,toggleScreenShare:de,mute:ue,unmute:pe,isUserSpeaking:ke,getVolumeLevel:xe,microphoneTrack:u,screenTrack:L,isLoading:Y,channel:_,appId:E,joinChannel:C,leaveChannel:I,client:n,setMicrophoneDevice:async Se=>{try{if(!Se){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(J&&await n.unpublish(u),await u.close());const Be=await aR.createMicrophoneAudioTrack({microphoneId:Se,encoderConfig:"music_standard"});O&&await O(Be),J&&await n.publish(Be),console.log("Microphone device changed successfully")}catch(Be){throw console.error("Error changing microphone device:",Be),Be}},voiceDisabled:se}},iGe=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:f,isJoined:_,joinChannel:E,channel:S,client:C,voiceDisabled:I}=rGe(),[O,M]=k.useState(!1),[L,U]=k.useState(!1);k.useEffect(()=>{const K=()=>{$.log("VoiceButton: Player instantiated, showing button"),U(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&($.log("VoiceButton: Player was already instantiated"),U(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),k.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:u,isJoined:_,channel:S,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:L,voiceDisabled:I})},[u,_,S,C,L,I]);const B=async()=>{if(!(O||I)){M(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:u,isJoined:_});try{if(!_&&o)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ne)}console.log("VoiceButton: Toggling voice state from:",u);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{M(!1)}}},J=()=>I?"Voice chat is disabled for this space":L?O?"Processing...":_?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!L||I?null:b.jsx(Yf,{label:J(),placement:e,hasArrow:!0,children:b.jsxs(lt,{position:"relative",cursor:"pointer",onClick:B,children:[b.jsx(wl,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?b.jsx(Pae,{color:"white"}):b.jsx(Aae,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&b.jsx(lt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:b.jsx(hd,{size:"sm",color:"white"})})]})})},sGe=_i.createContext({user:null}),oGe=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:u}=Lae(),[f,_]=k.useState([]),[E,S]=k.useState(!1),[C,I]=k.useState(!0);k.useRef({});const O=k.useRef(null);k.useRef(null);const{user:M}=k.useContext(sGe)||{user:null},[L,U]=k.useState({}),B=k.useRef(o),[J,K]=k.useState(null),{isOpen:ne,onOpen:oe,onClose:se}=ld(),[le,Y]=k.useState(!1),Z=k.useRef(null),X=k.useRef(null);k.useEffect(()=>{B.current=o},[o]),k.useEffect(()=>{if(!e||!i){S(!1);return}const ke=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const xe=e.connectionState;if(console.log("Current connection state:",xe),xe==="CONNECTED")S(!0),I(!1);else{S(!1);const je=Oe=>{console.log("Connection state changed:",Oe),Oe==="CONNECTED"?(S(!0),I(!1)):S(!1)};return e.on("connection-state-change",je),()=>{e.off("connection-state-change",je),clearTimeout(ke)}}return()=>{clearTimeout(ke)}},[e,i]),k.useEffect(()=>{const ke=async()=>{const xe={...L};let je=!1;for(const Oe of f){if(L[Oe.uid])continue;let we=null,Se=Oe.uid;if(typeof Se=="string"&&(Se.includes("-")?(we=Se.split("-")[0],Se=Se.split("-")[1]):Se.includes("_")&&(we=Se.split("_")[0],Se=Se.split("_")[1])),Se)try{console.log("Trying to fetch nickname for user ID:",Se);const Be=await cu(Se);Be&&Be.Nickname?(console.log("Found nickname in Firebase for user ID:",Se,"Nickname:",Be.Nickname),xe[Oe.uid]=Be.Nickname,je=!0):we?(console.log("Using extracted name for user ID:",Se,"Name:",we),xe[Oe.uid]=we,je=!0):(xe[Oe.uid]="User",je=!0)}catch(Be){console.error("Error fetching user profile:",Be),we?(xe[Oe.uid]=we,je=!0):(xe[Oe.uid]="User",je=!0)}else we?(xe[Oe.uid]=we,je=!0):(xe[Oe.uid]="User",je=!0)}je&&U(xe)};f.length>0&&ke()},[f,L]),k.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const ke=async(Oe,we)=>{if(console.log("User published:",Oe.uid,we,Oe),we==="video"){console.log("Remote video track detected:",Oe.uid);try{await e.subscribe(Oe,we),console.log("Subscribed to remote video track:",Oe.uid),_(Se=>Se.some(Be=>Be.uid===Oe.uid)?Se:[...Se,Oe])}catch(Se){console.error("Error subscribing to remote video track:",Se)}}},xe=(Oe,we)=>{if(console.log("User unpublished:",Oe.uid,we),we==="video"){if(console.log("Remote video track unpublished:",Oe.uid),Oe.videoTrack)try{Oe.videoTrack.stop()}catch(Se){console.error("Error stopping video track:",Se)}if(_(Se=>Se.filter(Be=>Be.uid!==Oe.uid)),l&&B.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),B.current.play(O.current)}catch(Se){console.error("Error replaying local screen track:",Se)}}},je=Oe=>{console.log("User left:",Oe.uid);const we=f.find(Se=>Se.uid===Oe.uid);if(we&&we.videoTrack)try{we.videoTrack.stop()}catch(Se){console.error("Error stopping video track:",Se)}if(_(Se=>Se.filter(Be=>Be.uid!==Oe.uid)),l&&B.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user left"),B.current.play(O.current)}catch(Se){console.error("Error replaying local screen track:",Se)}};return e.on("user-published",ke),e.on("user-unpublished",xe),e.on("user-left",je),()=>{e.off("user-published",ke),e.off("user-unpublished",xe),e.off("user-left",je)}},[e,i,E,f,l]),k.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(ke=>{if(ke.videoTrack)try{console.log("Playing video track for:",ke.uid),ke.videoTrack.play(`video-container-${ke.uid}`)}catch(xe){console.error("Error playing video track:",xe)}}),l&&B.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),B.current.play(O.current)}catch(ke){console.error("Error replaying local screen track:",ke)}},[f,l]),k.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,o),l&&o&&O.current)try{console.log("Playing local screen track"),o.play(O.current)}catch(ke){console.error("Error playing local screen track:",ke)}},[l,o]),k.useEffect(()=>()=>{if(f.forEach(ke=>{if(ke.videoTrack)try{ke.videoTrack.stop()}catch(xe){console.error("Error stopping video track on unmount:",xe)}}),o)try{o.stop()}catch(ke){console.error("Error stopping local screen track on unmount:",ke)}},[f,o]);const ie=()=>{console.log("Stopping local screen share"),u()},de=ke=>(console.log("Getting display name for UID:",ke,"type:",typeof ke),l&&M&&(ke===M.uid||ke===(e==null?void 0:e.uid))?n||"You":L[ke]?L[ke]:typeof ke=="string"?ke.includes("-")?ke.split("-")[0]:ke.includes("_")?ke.split("_")[0]:ke:"User"),ue=ke=>{console.log("Opening modal for remote screen",ke),K(ke),oe()},pe=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),oe()};return k.useEffect(()=>{ne&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&B.current)try{console.log("Playing local screen in modal"),B.current.play("modal-screen-container"),Y(!0)}catch(ke){console.error("Error playing local screen in modal:",ke)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),Y(!0)}catch(ke){console.error("Error playing remote screen in modal:",ke)}},500)):ne||(Y(!1),K(null),setTimeout(()=>{if(l&&B.current)try{B.current.play("local-screen-container")}catch(ke){console.error("Error playing local screen in small container:",ke)}f.forEach(ke=>{if(ke.videoTrack)try{ke.videoTrack.play(`video-container-${ke.uid}`)}catch(xe){console.error(`Error playing remote screen ${ke.uid} in small container:`,xe)}})},500))},[ne,J,l,f]),!E||C&&f.length===0&&!l||f.length===0&&!l?null:b.jsxs(b.Fragment,{children:[!ne&&b.jsxs(lt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&o&&b.jsxs(lt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:pe,children:[b.jsx(lt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),b.jsx(lt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(ke=>{const xe=L[ke.uid]||de(ke.uid);return b.jsxs(lt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>ue(ke),children:[b.jsx(lt,{id:`video-container-${ke.uid}`,width:"100%",height:"100%",position:"relative"}),b.jsx(lt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${xe}'s Screen`})]},ke.uid)})]}),ne&&b.jsx(lt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:se,children:b.jsxs(lt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:ke=>ke.stopPropagation(),children:[!le&&b.jsxs(lt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[b.jsx(hd,{size:"xl"}),b.jsx(Ze,{mt:4,children:"Loading screen share..."})]}),b.jsx(lt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:X}),b.jsx(lt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:se,children:""}),b.jsx(lt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${L[J==null?void 0:J.uid]||de(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&b.jsx(lt,{position:"absolute",bottom:4,right:4,children:b.jsx(Nn,{colorScheme:"red",size:"sm",onClick:ie,children:"Stop Sharing"})})]})})]})},aGe=({onClose:n})=>{const e=Ua(),[i,o]=k.useState(!1),[l,u]=k.useState(!1);k.useEffect(()=>{const E=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};E();const S=setInterval(E,1e3),C=()=>{E()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(S),window.removeEventListener("ScreenShareToggled",C)}},[]);const f=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const S=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}_()}}});window.dispatchEvent(S)}}catch(S){console.error("Error in screen share handler:",S),o(!1),e({title:"Screen sharing error",description:S.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(S,C)=>{o(!1),S?(u(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),o(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return b.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function cGe({open:n,onClose:e}){const[i,o]=k.useState(0);return b.jsxs(as,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[b.jsx(ls,{backdropFilter:"blur(4px)"}),b.jsxs(cs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[b.jsx(so,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),b.jsx(Rs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),b.jsx(Es,{p:0,display:"flex",children:b.jsxs(L0,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[b.jsxs(M0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:U8e,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Movement"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:V8e,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Camera"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:L8e,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Actions"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:M8e,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Tips"})]})]}),b.jsxs(YC,{flexGrow:1,display:"flex",flexDirection:"column",children:[b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),b.jsxs(Ur,{wrap:"wrap",gap:3,children:[b.jsx(tu,{keyLabel:"W",description:"Move Forward"}),b.jsx(tu,{keyLabel:"A",description:"Move Left"}),b.jsx(tu,{keyLabel:"S",description:"Move Backward"}),b.jsx(tu,{keyLabel:"D",description:"Move Right"}),b.jsx(tu,{keyLabel:"Shift",description:"Run"}),b.jsx(tu,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),b.jsxs(Ur,{wrap:"wrap",gap:3,children:[b.jsx(tu,{keyLabel:"Mouse",description:"Look Around"}),b.jsx(tu,{keyLabel:"Click + Drag",description:"Rotate Camera"}),b.jsx(tu,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),b.jsxs(Ur,{wrap:"wrap",gap:3,children:[b.jsx(tu,{keyLabel:"E",description:"Interact"}),b.jsx(tu,{keyLabel:"F",description:"Emote Menu"}),b.jsx(tu,{keyLabel:"T",description:"Chat"}),b.jsx(tu,{keyLabel:"M",description:"Mute Mic"})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),b.jsxs(Mr,{align:"stretch",spacing:2,children:[b.jsx(Ze,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),b.jsx(Ze,{fontSize:"xs",children:" Press ESC to access settings"}),b.jsx(Ze,{fontSize:"xs",children:" Click on players to view their profile"}),b.jsx(Ze,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const tu=({keyLabel:n,description:e})=>b.jsx(lt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:b.jsxs(hr,{spacing:2,children:[b.jsx(lt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),b.jsx(Ze,{fontSize:"xs",children:e})]})}),lGe=()=>{const[n,e]=k.useState([]),[i,o]=k.useState(""),[l,u]=k.useState(0),[f,_]=k.useState(100),[E,S]=k.useState(100),[C,I]=k.useState(!0),[O,M]=k.useState(!0),[L,U]=k.useState(!1);k.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const se=await aR.getMicrophones();e(se),se.length>0&&o(se[0].deviceId)}catch(se){console.error("Error getting audio devices:",se)}})()},[]),k.useEffect(()=>{const oe=setInterval(()=>{u(L?Math.random()*50:0)},100);return()=>clearInterval(oe)},[L]);const B=oe=>{const se=oe.target.value;o(se),console.log("Microphone changed to:",se)},J=oe=>{_(oe),console.log("Microphone volume set to:",oe)},K=oe=>{S(oe),console.log("Speaker volume set to:",oe)},ne=()=>{U(!L)};return b.jsxs(Mr,{spacing:6,align:"stretch",children:[b.jsxs(mr,{children:[b.jsxs(li,{children:["Microphone",b.jsx(th,{ml:2,colorScheme:L?"green":"red",children:L?"Enabled":"Muted"})]}),b.jsxs(zre,{value:i,onChange:B,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(oe=>b.jsx("option",{value:oe.deviceId,children:oe.label||`Microphone ${oe.deviceId.slice(0,5)}...`},oe.deviceId)),n.length===0&&b.jsx("option",{value:"",children:"No microphones found"})]})]}),b.jsxs(lt,{children:[b.jsx(Ze,{mb:2,children:"Microphone Level"}),b.jsx(qy,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),b.jsxs(mr,{children:[b.jsxs(li,{children:["Microphone Volume: ",f,"%"]}),b.jsxs(qV,{value:f,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[b.jsx(XV,{bg:"gray.700",children:b.jsx(JV,{})}),b.jsx(YV,{boxSize:6})]})]}),b.jsxs(mr,{children:[b.jsxs(li,{children:["Speaker Volume: ",E,"%"]}),b.jsxs(qV,{value:E,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[b.jsx(XV,{bg:"gray.700",children:b.jsx(JV,{})}),b.jsx(YV,{boxSize:6})]})]}),b.jsxs(mr,{display:"flex",alignItems:"center",children:[b.jsx(li,{mb:"0",children:"Microphone Enabled"}),b.jsx(qf,{isChecked:L,onChange:ne,colorScheme:"green",size:"lg"})]}),b.jsxs(mr,{display:"flex",alignItems:"center",children:[b.jsx(li,{mb:"0",children:"Echo Cancellation"}),b.jsx(qf,{isChecked:C,onChange:()=>I(!C),colorScheme:"green",size:"lg"})]}),b.jsxs(mr,{display:"flex",alignItems:"center",children:[b.jsx(li,{mb:"0",children:"Noise Suppression"}),b.jsx(qf,{isChecked:O,onChange:()=>M(!O),colorScheme:"green",size:"lg"})]}),b.jsxs(Hf,{status:"info",borderRadius:"md",children:[b.jsx($f,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function uGe({open:n,onClose:e,containerRef:i}){return b.jsx(hu,{containerRef:i,children:b.jsxs(as,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[b.jsx(ls,{}),b.jsxs(cs,{bg:"gray.900",color:"white",borderRadius:"lg",children:[b.jsx(so,{children:"Settings"}),b.jsx(Rs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),b.jsx(Es,{children:b.jsxs(L0,{variant:"enclosed",children:[b.jsxs(M0,{mb:4,children:[b.jsx(ka,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),b.jsx(ka,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),b.jsxs(YC,{children:[b.jsx(Nc,{children:b.jsx(lt,{p:4,bg:"gray.800",borderRadius:"md",children:b.jsx(lGe,{})})}),b.jsx(Nc,{children:b.jsx(lt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function dGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function hGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function nZ(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Uy(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Mae(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function pGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function fGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function mGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function b0(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function Gk(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function gGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function _Ge(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function rZ(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function s0(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function yGe(n){return Ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const EGe=async()=>{try{$.log("tagsFirestore: Fetching all tags");const n=Al(Hn,"tags"),e=await od(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw $.error("tagsFirestore: Error fetching tags:",n),n}},vGe=async n=>{try{$.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=gr(Hn,"tags",n),i=await Uo(e);return i.exists()?{id:i.id,...i.data()}:($.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw $.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},SGe=async({id:n,name:e,color:i,description:o})=>{try{$.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const f=gr(Hn,"tags",n);await Yg(f,l),u=n}else{const f=Al(Hn,"tags");u=(await ZBe(f,l)).id}return{id:u,...l}}catch(l){throw $.error("tagsFirestore: Error creating tag:",l),l}},bGe=async(n,e)=>{try{$.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=gr(Hn,"tags",e);if(!(await Uo(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=gr(Hn,"spaces",n);return await oo(l,{tags:e6e(e)}),!0}catch(i){throw $.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},TGe=async(n,e)=>{try{$.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=gr(Hn,"spaces",n);return await oo(i,{tags:Poe(e)}),!0}catch(i){throw $.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},wGe=async n=>{try{$.log(`tagsFirestore: Getting tags for space ${n}`);const e=gr(Hn,"spaces",n),i=await Uo(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const f of l){const _=await vGe(f);_&&u.push(_)}return u}catch(e){throw $.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},CGe=async()=>{$.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){$.log(`tagsFirestore: Processing tag: ${o.name}`);const l=gr(Hn,"tags",o.id);(await Uo(l)).exists()?($.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await SGe(o),e++,$.log(`tagsFirestore: Created tag: ${o.name}`))}return $.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw $.error("tagsFirestore: Error initializing default tags:",e),e}},Uae=({spaceID:n})=>{const[e,i]=k.useState([]),[o,l]=k.useState([]),[u,f]=k.useState(!0),[_,E]=k.useState(!1),[S,C]=k.useState(!1),[I,O]=k.useState(null),{isOpen:M,onOpen:L,onClose:U}=ld(),B=Ua(),{user:J}=k.useContext(us),K=(J==null?void 0:J.groups)&&(J.groups.includes("disruptiveAdmin")||J.groups.includes("admin"));k.useEffect(()=>{ne()},[n]);const ne=async()=>{f(!0);try{let X=[];try{X=await EGe(),i(X)}catch(ie){$.error("SpaceTagsManager: Error loading available tags:",ie),i([]),B({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ie=await wGe(n);l(ie)}catch(ie){$.error("SpaceTagsManager: Error loading space tags:",ie),l([]),B({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(X){$.error("SpaceTagsManager: Error in loadTags:",X),B({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},oe=async()=>{C(!0),O(null);try{const X=await CGe();console.log("Tag initialization result:",X),O(X),B({title:"Tags initialized",description:`Successfully created ${X.created} tags. Skipped ${X.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ne()}catch(X){$.error("SpaceTagsManager: Error initializing tags:",X),O(!1),B({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},se=async X=>{if(!(!n||!X)){E(!0);try{await bGe(n,X);const ie=e.find(de=>de.id===X);ie&&l(de=>[...de,ie]),B({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ie){$.error(`SpaceTagsManager: Error adding tag ${X} to space:`,ie),B({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},le=async X=>{if(!(!n||!X)){E(!0);try{await TGe(n,X),l(ie=>ie.filter(de=>de.id!==X)),B({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ie){$.error(`SpaceTagsManager: Error removing tag ${X} from space:`,ie),B({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},Y=()=>{const X=o.map(ie=>ie.id);return e.filter(ie=>!X.includes(ie.id))},Z=Y().length===0;return b.jsxs(lt,{children:[b.jsx(Ur,{mb:3,justifyContent:"space-between",alignItems:"center",children:b.jsxs(hr,{spacing:2,ml:"auto",children:[K&&b.jsx(Nn,{size:"xs",leftIcon:b.jsx(oze,{}),onClick:L,variant:"outline",colorScheme:"purple",children:"Admin"}),b.jsxs(wR,{children:[b.jsx(CR,{as:Nn,size:"xs",leftIcon:b.jsx(sze,{}),rightIcon:b.jsx(eae,{}),isDisabled:u||_||Z,children:Z?"No Available Tags":"Add Tag"}),b.jsx(RR,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:Y().length>0?Y().map(X=>b.jsx(dp,{onClick:()=>se(X.id),icon:b.jsx(lt,{width:"12px",height:"12px",borderRadius:"full",bg:X.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:X.name},X.id)):b.jsx(dp,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?b.jsx(Ur,{justify:"center",py:4,children:b.jsx(hd,{size:"sm",color:"blue.300"})}):e.length===0?b.jsx(lt,{children:b.jsxs(Ze,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?b.jsx(Ze,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):b.jsx(eie,{spacing:2,children:o.map(X=>b.jsx(E4,{children:b.jsxs(Yre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${X.color||"#888"}`,children:[b.jsx(lt,{width:"8px",height:"8px",borderRadius:"full",bg:X.color||"#888",mr:1}),b.jsx(Xre,{children:X.name}),b.jsx(Qre,{onClick:()=>le(X.id),isDisabled:_})]})},X.id))}),b.jsxs(as,{isOpen:M,onClose:U,size:"md",children:[b.jsx(ls,{backdropFilter:"blur(4px)"}),b.jsxs(cs,{bg:"gray.800",color:"white",children:[b.jsx(so,{fontSize:"md",children:"Tag System Administration"}),b.jsx(Rs,{}),b.jsxs(Es,{children:[b.jsx(Ze,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&b.jsxs(Hf,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[b.jsx($f,{}),b.jsxs(Ze,{fontSize:"sm",children:["Tags initialized. Created: ",b.jsx("b",{children:I.created}),", Skipped: ",b.jsx("b",{children:I.skipped})]})]}),b.jsx(Nn,{colorScheme:"blue",onClick:oe,isLoading:S,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),b.jsx(oh,{children:b.jsx(Nn,{variant:"ghost",size:"sm",onClick:U,children:"Close"})})]})]})]})};Uae.propTypes={spaceID:En.string.isRequired};const RGe=({isOpen:n,onClose:e})=>{const{spaceID:i}=Vo(),[o,l]=k.useState(0),[u,f]=k.useState(""),[_,E]=k.useState(""),[S,C]=k.useState(!1),[I,O]=k.useState(null),[M,L]=k.useState(null),[U,B]=k.useState(!1),[J,K]=k.useState(0),[ne,oe]=k.useState(null),se=k.useRef(null),[le,Y]=k.useState(null),[Z,X]=k.useState(null),[ie,de]=k.useState(!1),[ue,pe]=k.useState(0),[ke,xe]=k.useState(null),je=k.useRef(null),[Oe,we]=k.useState(null),[Se,Be]=k.useState(null),[Ee,Ce]=k.useState(!1),[Pe,Me]=k.useState(0),[We,He]=k.useState(null),qe=k.useRef(null),[rt,et]=k.useState([]),[_t,on]=k.useState([]),[dt,kt]=k.useState(!1),[ct,Ut]=k.useState([]),[fn,Wt]=k.useState(null),[Te,Ve]=k.useState(!1),[$e,Et]=k.useState(!0),[vt,St]=k.useState(!1),[zt,dn]=k.useState(!1),[vn,nn]=k.useState(""),[Ct,sr]=k.useState(""),[xt,qt]=k.useState(""),[Tr,Pi]=k.useState(!1),{setHLSStreamUrl:As,savedStreamData:cr}=_ae(),zn=Ua();k.useEffect(()=>{n&&i&&ia()},[n,i]);const ia=async()=>{try{const mt=await ad(i);mt.logoUrl&&oe(mt.logoUrl),mt.backgroundUrl&&xe(mt.backgroundUrl),mt.videoBackgroundUrl&&He(mt.videoBackgroundUrl),mt.voiceDisabled!==void 0&&Ve(mt.voiceDisabled),mt.accessibleToAllUsers!==void 0&&Et(mt.accessibleToAllUsers),f(mt.name||""),E(mt.description||"");try{const hn=await Joe(i);if(hn){nn(hn.streamUrl||""),sr(hn.rtmpUrl||""),qt(hn.streamKey||"");const Or=hn.enabled===!0;dn(Or),$.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:Or,rawValue:hn.enabled})}else dn(!1),$.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(hn){if($.error("Error fetching stream data directly:",hn),cr){nn(cr.streamUrl||""),sr(cr.rtmpUrl||""),qt(cr.streamKey||"");const Or=cr.enabled===!0;dn(Or),$.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:Or,rawValue:cr.enabled})}else dn(!1),$.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}Ks(mt)}catch(mt){$.error("Error fetching space data:",mt),zn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};k.useEffect(()=>{if(cr){if(!Tr){nn(cr.streamUrl||""),sr(cr.rtmpUrl||""),qt(cr.streamKey||"");const mt=cr.enabled===!0;dn(mt),$.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:mt,rawValue:cr.enabled})}}else n&&!Tr&&$.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[cr,Tr,n]);const Ks=async mt=>{if(i&&n){kt(!0);try{const hn=Uk(),Or=`space_${i}_owners`,Oi=IN(Al(hn,"users"),mQ("groups","array-contains",Or)),Nl=await od(Oi),Xi=[];for(const Fi of Nl.docs){const hs=Fi.data(),Sn=await cu(Fi.id);Xi.push({uid:Fi.id,email:hs.email,displayName:hs.displayName||Sn.Nickname||"Unknown User",photoURL:hs.photoURL||Sn.photoURL,firstName:Sn.firstName,lastName:Sn.lastName})}et(Xi);const Dl=`space_${i}_hosts`,Wo=IN(Al(hn,"users"),mQ("groups","array-contains",Dl)),pu=await od(Wo),xl=[];for(const Fi of pu.docs){const hs=Fi.data(),Sn=await cu(Fi.id);xl.push({uid:Fi.id,email:hs.email,displayName:hs.displayName||Sn.Nickname||"Unknown User",photoURL:hs.photoURL||Sn.photoURL,firstName:Sn.firstName,lastName:Sn.lastName})}on(xl);const oa=Al(hn,`spaces/${i}/BannedUsers`),fu=await od(oa),gc=[];for(const Fi of fu.docs){const hs=Fi.id;try{const Sn=await cu(hs);gc.push({uid:hs,displayName:(Sn==null?void 0:Sn.Nickname)||hs,firstName:Sn==null?void 0:Sn.firstName,lastName:Sn==null?void 0:Sn.lastName,photoURL:Sn==null?void 0:Sn.photoURL})}catch{gc.push({uid:hs,displayName:hs})}}Ut(gc)}catch(hn){$.error("Error fetching space users:",hn),zn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{kt(!1)}}};k.useEffect(()=>{i&&n&&o===4&&Ks()},[i,n,o]);const ao=mt=>{const hn=mt.target.files[0];if(hn){if(!hn.type.startsWith("image/")){zn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(hn);const Or=new FileReader;Or.onloadend=()=>{L(Or.result)},Or.readAsDataURL(hn)}},jc=mt=>{const hn=mt.target.files[0];if(hn){if(!hn.type.startsWith("image/")){zn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}Y(hn);const Or=new FileReader;Or.onloadend=()=>{X(Or.result)},Or.readAsDataURL(hn)}},Ps=mt=>{const hn=mt.target.files[0];if(hn){if(!hn.type.startsWith("video/")){zn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const Or=5*1024*1024;if(hn.size>Or){zn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}we(hn);const Oi=new FileReader;Oi.onloadend=()=>{Be(Oi.result)},Oi.readAsDataURL(hn)}},Va=async()=>{if(!I){zn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const mt=setInterval(()=>{K(Or=>{const Oi=Or+10;return Oi>=90?90:Oi})},300),hn=await XWe(i,I);clearInterval(mt),K(100),oe(hn),zn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),L(null),K(0),B(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:hn}}))}catch(mt){console.error("Error uploading logo:",mt),zn({title:"Upload failed",description:mt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),B(!1),K(0)}},Fo=async()=>{if(!le){zn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{de(!0);const mt=setInterval(()=>{pe(Or=>{const Oi=Or+10;return Oi>=90?90:Oi})},300),hn=await QWe(i,le);clearInterval(mt),pe(100),xe(hn),zn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Y(null),X(null),pe(0),de(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:hn}}))}catch(mt){console.error("Error uploading background:",mt),zn({title:"Upload failed",description:mt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),de(!1),pe(0)}},ja=async()=>{if(ne)try{B(!0),await JWe(i),oe(null),zn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),B(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(mt){console.error("Error deleting logo:",mt),zn({title:"Deletion failed",description:mt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),B(!1)}},fc=async()=>{if(ke)try{de(!0),await ZWe(i),xe(null),zn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),de(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(mt){console.error("Error deleting background:",mt),zn({title:"Deletion failed",description:mt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),de(!1)}},Ol=async()=>{if(!Oe){zn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{Ce(!0);const mt=setInterval(()=>{Me(Or=>{const Oi=Or+10;return Oi>=90?90:Oi})},300),hn=await nze(i,Oe);clearInterval(mt),Me(100),He(hn),zn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{we(null),Be(null),Me(0),Ce(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:hn}}))}catch(mt){console.error("Error uploading video background:",mt),zn({title:"Upload failed",description:mt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),Ce(!1),Me(0)}},Fa=async()=>{if(We)try{Ce(!0),await rze(i),He(null),zn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),Ce(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(mt){console.error("Error deleting video background:",mt),zn({title:"Deletion failed",description:mt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),Ce(!1)}},mc=()=>{se.current&&se.current.click()},_o=()=>{je.current&&je.current.click()},ji=()=>{qe.current&&qe.current.click()},ds=async()=>{St(!0);try{await O3(i,{voiceDisabled:!Te}),Ve(!Te),zn({title:"Settings Updated",description:`Voice chat has been ${Te?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(mt){$.error("Error updating voice settings:",mt),zn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{St(!1)}},sa=async()=>{St(!0);try{await tze(i,!$e),Et(!$e),zn({title:"Settings Updated",description:`Space is now ${$e?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(mt){$.error("Error updating accessibility settings:",mt),zn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{St(!1)}},kl=async()=>{if(i){C(!0);try{const mt=Uk(),hn=gr(mt,"spaces",i);await oo(hn,{name:u,description:_}),zn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:_}}))}catch(mt){$.error("Error updating space details:",mt),zn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},Ba=async()=>{if(i){Pi(!0);try{const mt={enabled:zt,streamUrl:vn,rtmpUrl:Ct,streamKey:xt,playerIndex:"0",updatedAt:new Date().toISOString()};$.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:zt,url:vn,hasRtmp:!!Ct,hasKey:!!xt});try{await Aj(i,mt),$.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(hn){throw $.error("SpaceManageModal: Error updating stream settings directly in Firebase:",hn),hn}await As(vn,0,{enabled:zt,rtmpUrl:Ct,streamKey:xt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:zt,spaceId:i}})),zn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${zt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{ia()},500)}catch(mt){$.error("Error updating stream settings:",mt),zn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Pi(!1)}}},Bo=async mt=>{try{Wt(mt);const hn=Uk();await QBe(gr(hn,`spaces/${i}/BannedUsers`,mt));const Or=gr(hn,"users",mt),Oi=`space_${i}_banned`;await oo(Or,{groups:Poe(Oi)}),Ut(Nl=>Nl.filter(Xi=>Xi.uid!==mt)),zn({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(hn){$.error("Error unbanning user:",hn),zn({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{Wt(null)}};return b.jsxs(as,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[b.jsx(ls,{backdropFilter:"blur(4px)"}),b.jsxs(cs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[b.jsx(so,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),b.jsx(Rs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),b.jsx(Es,{p:0,display:"flex",overflow:"hidden",children:b.jsxs(L0,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[b.jsxs(M0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:Mae,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Details"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:Uy,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Logo"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:hGe,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Background"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:fGe,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Settings"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:rZ,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Users"})]}),b.jsxs(ka,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(mn,{as:s0,mb:1}),b.jsx(Ze,{fontSize:"xs",children:"Stream"})]})]}),b.jsxs(YC,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsxs(mr,{children:[b.jsx(li,{fontSize:"xs",children:"Space Name"}),b.jsx(ni,{value:u,onChange:mt=>f(mt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),b.jsxs(mr,{children:[b.jsx(li,{fontSize:"xs",children:"Description"}),b.jsx(Zre,{value:_,onChange:mt=>E(mt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),b.jsxs(mr,{children:[b.jsx(li,{fontSize:"xs",children:"Space Tags"}),b.jsx(lt,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?b.jsx(Uae,{spaceID:i}):b.jsxs(Hf,{status:"warning",variant:"subtle",borderRadius:"md",children:[b.jsx($f,{}),b.jsx(vC,{fontSize:"sm",children:"Space ID missing"}),b.jsx(SC,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),b.jsx(Nn,{colorScheme:"blue",size:"sm",onClick:kl,isLoading:S,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),b.jsx(Ze,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ne||M)&&b.jsxs(Ur,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ne&&b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),b.jsx(fp,{src:ne,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),b.jsx(Nn,{mt:3,colorScheme:"red",leftIcon:b.jsx(mn,{as:b0}),onClick:ja,isLoading:U,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),M&&b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),b.jsx(fp,{src:M,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),b.jsxs(mr,{children:[b.jsx(li,{fontSize:"xs",children:"Upload New Logo"}),b.jsx(ni,{type:"file",accept:"image/*",onChange:ao,ref:se,display:"none"}),U&&b.jsxs(lt,{mt:3,mb:3,children:[b.jsxs(Ze,{fontSize:"xs",mb:1,children:["Uploading... ",J,"%"]}),b.jsx(qy,{value:J,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),b.jsxs(hr,{mt:3,spacing:3,children:[b.jsx(Nn,{colorScheme:"blue",leftIcon:b.jsx(mn,{as:Uy}),onClick:mc,isDisabled:U,size:"sm",variant:"outline",children:"Browse"}),b.jsx(Nn,{colorScheme:"green",leftIcon:b.jsx(mn,{as:Gk}),onClick:Va,isLoading:U,loadingText:"Uploading...",isDisabled:!I||U,size:"sm",children:"Upload"})]}),b.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Background"}),b.jsx(Ze,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),b.jsxs(L0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[b.jsxs(M0,{children:[b.jsxs(ka,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[b.jsx(mn,{as:Uy,mr:2}),"Image"]}),b.jsxs(ka,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[b.jsx(mn,{as:nZ,mr:2}),"Video (max 5MB)"]})]}),b.jsxs(YC,{mt:4,children:[b.jsxs(Nc,{p:0,children:[(ke||Z)&&b.jsxs(Ur,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ke&&b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),b.jsx(fp,{src:ke,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),b.jsx(Nn,{mt:3,colorScheme:"red",leftIcon:b.jsx(mn,{as:b0}),onClick:fc,isLoading:ie,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Z&&b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),b.jsx(fp,{src:Z,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),b.jsxs(mr,{children:[b.jsx(li,{fontSize:"xs",children:"Upload New Background Image"}),b.jsx(ni,{type:"file",accept:"image/*",onChange:jc,ref:je,display:"none"}),ie&&b.jsxs(lt,{mt:3,mb:3,children:[b.jsxs(Ze,{fontSize:"xs",mb:1,children:["Uploading... ",ue,"%"]}),b.jsx(qy,{value:ue,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),b.jsxs(hr,{mt:3,spacing:3,children:[b.jsx(Nn,{colorScheme:"blue",leftIcon:b.jsx(mn,{as:Uy}),onClick:_o,isDisabled:ie,size:"sm",variant:"outline",children:"Browse"}),b.jsx(Nn,{colorScheme:"green",leftIcon:b.jsx(mn,{as:Gk}),onClick:Fo,isLoading:ie,loadingText:"Uploading...",isDisabled:!le||ie,size:"sm",children:"Upload"})]}),b.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),b.jsxs(Nc,{p:0,children:[(We||Se)&&b.jsxs(Ur,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[We&&b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),b.jsx(lt,{maxH:"160px",overflow:"hidden",position:"relative",children:b.jsx("video",{src:We,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),b.jsx(Nn,{mt:3,colorScheme:"red",leftIcon:b.jsx(mn,{as:b0}),onClick:Fa,isLoading:Ee,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Se&&b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),b.jsx(lt,{maxH:"160px",overflow:"hidden",children:b.jsx("video",{src:Se,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),b.jsxs(mr,{children:[b.jsx(li,{fontSize:"xs",children:"Upload New Video Background"}),b.jsx(ni,{type:"file",accept:"video/*",onChange:Ps,ref:qe,display:"none"}),Ee&&b.jsxs(lt,{mt:3,mb:3,children:[b.jsxs(Ze,{fontSize:"xs",mb:1,children:["Uploading... ",Pe,"%"]}),b.jsx(qy,{value:Pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),b.jsxs(hr,{mt:3,spacing:3,children:[b.jsx(Nn,{colorScheme:"blue",leftIcon:b.jsx(mn,{as:nZ}),onClick:ji,isDisabled:Ee,size:"sm",variant:"outline",children:"Browse"}),b.jsx(Nn,{colorScheme:"green",leftIcon:b.jsx(mn,{as:Gk}),onClick:Ol,isLoading:Ee,loadingText:"Uploading...",isDisabled:!Oe||Ee,size:"sm",children:"Upload"})]}),b.jsx(Hy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),b.jsx(Ze,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:b.jsxs(hr,{justify:"space-between",align:"center",children:[b.jsxs(lt,{children:[b.jsxs(hr,{mb:1,spacing:2,children:[b.jsxs(lt,{position:"relative",w:"16px",h:"16px",children:[b.jsx(mn,{as:yGe,color:Te?"red.400":"green.400"}),Te&&b.jsx(lt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.800",children:Te?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),b.jsx(qf,{isChecked:!Te,onChange:ds,colorScheme:"green",size:"md",isDisabled:vt})]})}),b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:b.jsxs(hr,{justify:"space-between",align:"center",children:[b.jsxs(lt,{children:[b.jsxs(hr,{mb:1,spacing:2,children:[b.jsx(lt,{position:"relative",w:"16px",h:"16px",children:b.jsx(mn,{as:rZ,color:$e?"green.400":"red.400"})}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.800",children:$e?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),b.jsx(Ze,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),b.jsx(qf,{isChecked:$e,onChange:sa,colorScheme:"green",size:"md",isDisabled:vt})]})}),b.jsxs(Hf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[b.jsx($f,{color:"blue.300"}),b.jsxs(lt,{children:[b.jsx(vC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),b.jsx(SC,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),b.jsx(Ze,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),dt?b.jsx(Ur,{justify:"center",align:"center",h:"200px",children:b.jsx(hd,{color:"blue.300"})}):b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsxs(lt,{children:[b.jsxs(hr,{mb:2,children:[b.jsx(mn,{as:dGe,color:"green.400"}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Owners"}),b.jsx(th,{colorScheme:"green",ml:2,children:rt.length})]}),b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:rt.length===0?b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):b.jsx(Mr,{spacing:1,align:"stretch",children:rt.map(mt=>b.jsxs(hr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[b.jsx(wl,{size:"xs",src:mt.photoURL,name:mt.displayName}),b.jsxs(lt,{children:[b.jsx(Ze,{fontSize:"xs",children:mt.displayName}),b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:mt.firstName&&mt.lastName?`${mt.firstName} ${mt.lastName}`:"Full name not available"})]}),b.jsx(g0,{}),b.jsx(th,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},mt.uid))})})]}),b.jsxs(lt,{children:[b.jsxs(hr,{mb:2,children:[b.jsx(mn,{as:mGe,color:"purple.400"}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),b.jsx(th,{colorScheme:"purple",ml:2,children:_t.length})]}),b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:_t.length===0?b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):b.jsx(Mr,{spacing:1,align:"stretch",children:_t.map(mt=>b.jsxs(hr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[b.jsx(wl,{size:"xs",src:mt.photoURL,name:mt.displayName}),b.jsxs(lt,{children:[b.jsx(Ze,{fontSize:"xs",children:mt.displayName}),b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:mt.firstName&&mt.lastName?`${mt.firstName} ${mt.lastName}`:"Full name not available"})]}),b.jsx(g0,{}),b.jsx(th,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},mt.uid))})})]}),b.jsxs(lt,{children:[b.jsxs(hr,{mb:2,children:[b.jsx(mn,{as:gGe,color:"red.400"}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),b.jsx(th,{colorScheme:"red",ml:2,children:ct.length})]}),b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ct.length===0?b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):b.jsx(Mr,{spacing:1,align:"stretch",children:ct.map(mt=>b.jsxs(hr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[b.jsx(wl,{size:"xs",src:mt.photoURL,name:mt.displayName}),b.jsxs(lt,{children:[b.jsx(Ze,{fontSize:"xs",children:mt.displayName}),mt.firstName&&b.jsxs(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:[mt.firstName," ",mt.lastName]})]}),b.jsx(g0,{}),b.jsxs(hr,{spacing:2,children:[b.jsx(Nn,{size:"xs",colorScheme:"green",isLoading:fn===mt.uid,onClick:()=>Bo(mt.uid),leftIcon:b.jsx(mn,{as:_Ge}),children:"Unban"}),b.jsx(th,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},mt.uid))})})]})]})]}),b.jsxs(Nc,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:b.jsxs(hr,{justify:"space-between",align:"center",children:[b.jsx(lt,{children:b.jsxs(hr,{mb:1,spacing:2,children:[b.jsx(lt,{position:"relative",w:"16px",h:"16px",children:b.jsx(mn,{as:s0,color:zt?"green.400":"red.400"})}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),b.jsx(qf,{isChecked:zt,onChange:async()=>{const mt=!zt;dn(mt),Pi(!0);try{$.log("SpaceManageModal: Auto-saving streaming enabled state:",mt);const hn={enabled:mt,streamUrl:vn||"",rtmpUrl:Ct||"",streamKey:xt||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await Aj(i,hn),$.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(Or){throw $.error("SpaceManageModal: Error updating streaming state directly in Firebase:",Or),Or}await As(vn,0,{enabled:mt,rtmpUrl:Ct,streamKey:xt}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:mt,spaceId:i}})),zn({title:"Streaming "+(mt?"Enabled":"Disabled"),description:`Streaming is now ${mt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(hn){$.error("Error auto-saving streaming state:",hn),dn(!mt),zn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Pi(!1),setTimeout(()=>{ia()},500)}},colorScheme:"green",size:"md",isDisabled:Tr})]})}),b.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),b.jsxs(mr,{mb:4,children:[b.jsx(li,{fontSize:"xs",children:"Stream URL"}),b.jsx(ni,{value:vn,onChange:mt=>nn(mt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Tr})]}),b.jsx(Kf,{my:3,borderColor:"whiteAlpha.200"}),b.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),b.jsxs(mr,{mb:3,children:[b.jsx(li,{fontSize:"xs",children:"RTMP URL"}),b.jsx(ni,{value:Ct,onChange:mt=>sr(mt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Tr})]}),b.jsxs(mr,{mb:3,children:[b.jsx(li,{fontSize:"xs",children:"Stream Key"}),b.jsx(ni,{value:xt,onChange:mt=>qt(mt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Tr,type:"password"})]})]}),b.jsx(Nn,{colorScheme:"blue",size:"sm",onClick:Ba,isLoading:Tr,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:zt?"inline-flex":"none",children:"Save Stream Settings"}),b.jsxs(Hf,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[b.jsx($f,{color:"blue.300"}),b.jsxs(lt,{children:[b.jsx(vC,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),b.jsx(SC,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Vae="spaces",jae="portals",IGe=async(n,e,i)=>{try{const o=gr(Hn,Vae,n,jae,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Yg(o,l),$.log(`Saved portal ${e} to space ${n}`),!0}catch(o){return $.error("Error saving portal:",o),!1}},iZ=async(n,e,i)=>{try{const o=gr(Hn,Vae,n,jae,e),l={...i,updatedAt:new Date().toISOString()};return await oo(o,l),$.log(`Updated portal ${e} in space ${n}`),!0}catch(o){return $.error("Error updating portal:",o),!1}},AGe=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[o,l]=k.useState([]),[u,f]=k.useState(!1),[_,E]=k.useState(null),[S,C]=k.useState(!1),I=Ua(),{placePortal:O,directPlacePortal:M}=vae(),L=Ng("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),U=Ng("gray.800","white"),B=Ng("gray.200","whiteAlpha.200"),J=Ng("gray.200","whiteAlpha.300");k.useEffect(()=>{n&&(async()=>{f(!0),E(null),l([]);try{const se=Al(Hn,"spaces"),Y=(await od(se)).docs.map(Z=>({id:Z.id,name:Z.data().name||`Space ID: ${Z.id}`}));l(Y)}catch(se){$.error("PortalAdminModal: Error fetching spaces:",se),E("Failed to load spaces. Please check your connection and try again.")}f(!1)})()},[n]);const K=async(oe,se)=>{if(!i){$.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),I({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),$.log(`PortalAdminModal: Attempting to place portal to ${se} (${oe}) in space ${i}`);try{const le=await ad(oe);if(!le)throw new Error(`Failed to fetch target space data for ${oe}`);const Y=le.backgroundUrl||le.backgroundGsUrl;Y||$.warn(`PortalAdminModal: No background image URL found for target space: ${oe}`);const Z="PortalObjectPrefab",X={x:0,y:1.5,z:0},ie={x:0,y:0,z:0},de={x:1,y:1,z:1},ue=`portal_${i}_${oe}_${Date.now()}`;if(!await IGe(i,ue,{type:"portal",targetSpaceId:oe,targetSpaceName:se,portalId:ue,position:X,rotation:ie,scale:de,prefabName:Z,initialImageUrl:Y})){$.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),I({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}$.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let xe=!1;try{const je={portalId:ue,prefabName:Z,position:X,rotation:ie,scale:de,initialImageUrl:Y};xe=O(ue,Z,X,ie,de,Y),xe||(xe=M(ue,Z,X,ie,de,Y)),$.log("PortalAdminModal: Portal placement in Unity:",xe)}catch(je){$.error("PortalAdminModal: Error placing portal in Unity:",je)}xe?(I({title:"Portal Placed",description:`Portal to ${se} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(I({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(le){$.error("PortalAdminModal: Error creating portal:",le),I({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},ne=u||S;return b.jsxs(as,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[b.jsx(ls,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),b.jsxs(cs,{bg:L,backdropFilter:"blur(18px)",color:U,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[b.jsx(so,{borderBottom:"1px solid",borderColor:J,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),b.jsx(Rs,{}),b.jsxs(Es,{p:6,children:[ne&&b.jsxs(Mr,{justifyContent:"center",alignItems:"center",height:"200px",children:[b.jsx(hd,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),b.jsx(Ze,{mt:3,children:"Loading Spaces..."})]}),_&&b.jsxs(Hf,{status:"error",borderRadius:"md",variant:"subtle",children:[b.jsx($f,{}),_]}),!u&&!_&&o.length===0&&b.jsx(Ze,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!_&&o.length>0&&b.jsx(s1,{spacing:3,children:o.map(oe=>b.jsx(lre,{p:3,borderRadius:"md",_hover:{bg:B,cursor:ne?"not-allowed":"pointer",transform:ne?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!ne&&K(oe.id,oe.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:ne?.7:1,pointerEvents:ne?"none":"auto",children:oe.name},oe.id))})]})]})]})},sZ=["Recent","Furniture","Objects","Upload","Portals"],PGe={Furniture:"chair",Objects:"misc"},OGe=({isOpen:n,onClose:e,settings:i})=>{const[o,l]=k.useState(sZ[0]),[u,f]=k.useState(""),[_,E]=k.useState(!1),[S,C]=k.useState(!1),[I,O]=k.useState([]),[M,L]=k.useState(!0),[U,B]=k.useState(null),{placeCatalogueItem:J}=Sae(),K=Ng("blue.500","blue.300"),ne=Ng("gray.500","gray.400"),oe=Ng("whiteAlpha.200","whiteAlpha.200");k.useEffect(()=>{n&&(async()=>{L(!0),B(null),O([]);try{const ue=Al(Hn,"catalogue"),pe=await od(ue),ke=[];pe.forEach(xe=>{var we,Se;const je=xe.data(),Oe=["chair","misc"];je.glbUrl&&((we=je.categories)!=null&&we.some(Be=>Oe.includes(Be)))&&ke.push({id:xe.id,name:je.name||"Unnamed Item",thumbnail:((Se=je.thumbnail)==null?void 0:Se.src)||"https://via.placeholder.com/150",glbUrl:je.glbUrl,categories:je.categories})}),O(ke)}catch(ue){console.error("Error fetching catalogue items:",ue),B("Failed to load catalogue items. Please check your connection and try again.")}L(!1)})()},[n]);const se=de=>{l(de),f(""),E(de==="Portals")},le=(de,ue)=>{const pe=PGe[ue];let ke=de;return pe&&(ke=ke.filter(xe=>{var je;return(je=xe.categories)==null?void 0:je.includes(pe)})),u&&(ke=ke.filter(xe=>xe.name.toLowerCase().includes(u.toLowerCase()))),ke},Y=["Furniture","Objects"].includes(o)?le(I,o):[],Z=async de=>{console.log(`Placing item: ${de.name}`);try{if(!de.glbUrl){console.error("Item is missing GLB URL");return}const ue=`item_${i.spaceID}_${Date.now()}`,pe={x:0,y:0,z:0},ke={x:0,y:0,z:0},xe={x:1,y:1,z:1},je={itemId:ue,name:de.name||"Unnamed Item",glbUrl:de.glbUrl,thumbnail:de.thumbnail||"https://via.placeholder.com/150",position:pe,rotation:ke,scale:xe,createdAt:Date.now(),updatedAt:Date.now(),categories:de.categories||[]};if(!je.glbUrl)throw new Error("GLB URL is required");await Yg(gr(Hn,"spaces",i.spaceID,"catalogue",ue),je),J(ue,je.glbUrl,pe,ke,xe)?e():console.error("Failed to place item in Unity")}catch(ue){console.error("Error placing item:",ue)}},X=()=>{C(!0)},ie=()=>{C(!1)};return b.jsxs(as,{isOpen:n,onClose:e,size:"5xl",isCentered:!0,children:[b.jsx(ls,{bg:"blackAlpha.600",backdropFilter:"blur(5px)"}),b.jsxs(cs,{bg:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(15px)",color:"white",borderRadius:"xl",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[b.jsx(so,{pb:2,borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:_?"Create New Portal":"Content Catalogue"}),b.jsx(Rs,{top:"14px"}),b.jsxs(Es,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[b.jsxs(hr,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[sZ.filter(de=>de!=="Portals").map(de=>b.jsx(Nn,{variant:"ghost",size:"md",fontWeight:o===de?"semibold":"normal",color:o===de?"white":ne,bg:o===de?oe:"transparent",borderBottom:o===de?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!==de?"whiteAlpha.100":oe,color:"white"},onClick:()=>se(de),px:4,whiteSpace:"nowrap",children:de},de)),b.jsx(g0,{}),b.jsx(Nn,{variant:"ghost",size:"md",fontWeight:o==="Portals"?"semibold":"normal",color:o==="Portals"?"white":ne,bg:o==="Portals"?oe:"transparent",borderBottom:o==="Portals"?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!=="Portals"?"whiteAlpha.100":oe,color:"white"},onClick:()=>se("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),_&&o==="Portals"?b.jsx(lt,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:b.jsx(Nn,{size:"lg",colorScheme:"blue",onClick:X,children:"Browse"})}):b.jsxs(b.Fragment,{children:[b.jsx(lt,{p:4,children:b.jsx(ni,{placeholder:`Search in ${o}...`,value:u,onChange:de=>f(de.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),b.jsx(lt,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:b.jsx(a4,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:M?b.jsx(Ze,{color:"whiteAlpha.700",children:"Loading items..."}):Y.length>0?Y.map(de=>b.jsxs(lt,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>Z(de),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[b.jsx(lt,{bgImage:`url(${de.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),b.jsx(Ze,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:de.name})]},de.id)):b.jsxs(Ze,{color:"whiteAlpha.700",children:[o==="Furniture"&&"No chairs found in the catalogue.",o==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(o)&&`No items found in "${o}"${u&&` matching "${u}"`}.`]})})})]})]})]}),b.jsx(AGe,{isOpen:S,onClose:ie,currentSpaceId:i==null?void 0:i.spaceID})]})},kGe=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=uh(),[o,l]=k.useState(!0),[u,f]=k.useState(!1),[_,E]=k.useState(!1),[S,C]=k.useState(!1),[I,O]=k.useState(!1),[M,L]=k.useState(!1),[U,B]=k.useState(!1),[J,K]=k.useState(null),[ne,oe]=k.useState(!1),[se,le]=k.useState(!1),[Y,Z]=k.useState(!1),[X,ie]=k.useState(!1),de=Ua(),{user:ue}=k.useContext(us),pe=(ue==null?void 0:ue.Nickname)||"Unknown",[ke,xe]=k.useState(!1),je=async()=>{if(ue!=null&&ue.uid&&e)try{const He=await cu(ue.uid);let qe=!1,rt=!1;if(He.groups){const _t=`space_${e}_owners`,on=`space_${e}_hosts`;qe=He.groups.includes(_t),rt=He.groups.includes(on)}const et=await Doe(ue.uid,"disruptiveAdmin");if(ie(et),K({rpmURL:He.rpmURL?He.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),le(qe||et),Z(rt),!qe&&!et&&ne){oe(!1);const _t=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(_t),de({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(He){console.error("Error fetching profile data:",He),le(!1),Z(!1),ie(!1)}else le(!1),Z(!1),ie(!1)};k.useEffect(()=>{je()},[ue==null?void 0:ue.uid,e,ne]),k.useEffect(()=>{const He=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",He),()=>{window.removeEventListener("PlayerInstantiated",He)}},[]),k.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&xe(window.agoraClient.voiceDisabled)}catch(rt){console.error("Error checking if voice is disabled:",rt)}})();const qe=rt=>{rt.detail&&typeof rt.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",rt.detail.voiceDisabled),xe(rt.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",qe),()=>{window.removeEventListener("SpaceVoiceSettingChanged",qe)}},[]);const Oe=()=>E(!_),we=()=>C(!S),Se=()=>{L(!M),Me()},Be=()=>{O(!1),je()},Ee=()=>{B(!1)},Ce=()=>{B(!0),Me()},Pe=He=>{He.stopPropagation(),typeof n=="function"&&($.log("CanvasMainMenu: Toggling player list"),n())},Me=()=>{f(!1)},We=He=>{if(He.stopPropagation(),!se){de({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const qe=!ne;oe(qe);const rt=new CustomEvent("editModeChanged",{detail:{enabled:qe}});window.dispatchEvent(rt),de({title:qe?"Edit Mode Enabled":"Edit Mode Disabled",description:qe?"You can now make changes to the scene.":"Scene editing is now disabled.",status:qe?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return b.jsxs(b.Fragment,{children:[b.jsxs(wR,{isOpen:u,onClose:()=>f(!1),children:[b.jsx(CR,{as:xc,icon:b.jsx(uze,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:u?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:u?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!u)}),b.jsx(hu,{containerRef:i,children:b.jsx(RR,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:b.jsxs(Mr,{align:"stretch",spacing:4,children:[b.jsxs(hr,{children:[b.jsx(wl,{size:"md",src:J==null?void 0:J.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),b.jsxs(Mr,{align:"start",spacing:0,children:[b.jsxs(hr,{children:[b.jsx(Ze,{fontWeight:"bold",children:pe}),se&&!X&&b.jsx(Yf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:b.jsx(lt,{display:"inline-block",children:b.jsx(mn,{as:Uj,color:"green.400",boxSize:3})})}),!se&&Y&&!X&&b.jsx(Yf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:b.jsx(lt,{display:"inline-block",children:b.jsx(mn,{as:Vj,color:"purple.400",boxSize:3})})}),X&&b.jsx(Yf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:b.jsx(lt,{display:"inline-block",children:b.jsx(mn,{as:F8e,color:"blue.400",boxSize:3})})})]}),b.jsx(Ze,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),b.jsxs(hr,{spacing:4,justify:"center",children:[b.jsx(xc,{icon:b.jsx(W8e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Pe}),se&&b.jsx(xc,{icon:b.jsx(D8e,{}),variant:"ghost",colorScheme:ne?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:We}),!ne&&b.jsx(xc,{icon:b.jsx(lt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),ne&&b.jsx(xc,{icon:b.jsx(N8e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:Ce}),b.jsx(xc,{icon:b.jsx(lt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),b.jsx(Kf,{borderColor:"whiteAlpha.300"}),b.jsxs(Mr,{align:"stretch",spacing:2,children:[se&&b.jsxs(hr,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[b.jsx(Ze,{fontSize:"md",children:"Edit Mode"}),b.jsx(qf,{id:"edit-mode-toggle",isChecked:ne,onChange:We,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:ne?"green.500":"black"}}})]}),se&&b.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Se,children:"Manage Space"}),ue&&e&&!ke&&b.jsx(aGe,{onClose:Me}),b.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Oe,children:"Settings"}),b.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Controls"}),b.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),b.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),S&&b.jsx(cGe,{open:S,onClose:we}),_&&b.jsx(uGe,{open:_,onClose:Oe}),I&&b.jsx(Oae,{open:I,onClose:Be}),b.jsx(RGe,{isOpen:M,onClose:Se}),b.jsx(OGe,{isOpen:U,onClose:Ee,settings:{spaceID:e}})]})},NGe=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=Vo(),u=Uc(),f=Ua(),_=k.useRef(null),E=k.useRef(null),S=k.useRef(),[C,I]=k.useState(null),[O,M]=k.useState(""),[L,U]=k.useState(!1),[B,J]=k.useState(0),[K,ne]=k.useState(null),[oe,se]=k.useState(!0),[le,Y]=k.useState(!1),[Z,X]=k.useState(!1),[ie,de]=k.useState(0),[ue,pe]=k.useState("image"),[ke,xe]=k.useState(""),[je,Oe]=k.useState(!1);k.useEffect(()=>{(async()=>{if(n&&i&&l){se(!0);try{const _t=await Ff(l,i);if(_t&&(_t.imageUrl||_t.videoUrl)){ne(_t);const on=_t.mediaType==="video";pe(on?"video":"image"),Oe(_t.displayAsVideo||!1),on&&_t.videoUrl&&(xe(_t.videoUrl),de(1))}else ne(null)}catch(_t){$.error("Error fetching existing image:",_t),ne(null)}finally{se(!1)}}})()},[n,i,l]),k.useEffect(()=>{n||(I(null),M(""),J(0),xe(""))},[n]);const we=k.useCallback(et=>{et.preventDefault(),et.stopPropagation(),X(!0)},[]),Se=k.useCallback(et=>{et.preventDefault(),et.stopPropagation(),X(!1)},[]),Be=k.useCallback(et=>{et.preventDefault(),et.stopPropagation()},[]),Ee=k.useCallback(et=>{if(et.preventDefault(),et.stopPropagation(),X(!1),et.dataTransfer.files&&et.dataTransfer.files.length>0){const _t=et.dataTransfer.files[0];Ce(_t)}},[]);k.useEffect(()=>{const et=E.current;if(et)return et.addEventListener("dragenter",we),et.addEventListener("dragleave",Se),et.addEventListener("dragover",Be),et.addEventListener("drop",Ee),()=>{et.removeEventListener("dragenter",we),et.removeEventListener("dragleave",Se),et.removeEventListener("dragover",Be),et.removeEventListener("drop",Ee)}},[we,Se,Be,Ee]);const Ce=et=>{if(!et)return;if(!et.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(et);const _t=new FileReader;_t.onloadend=()=>{M(_t.result)},_t.readAsDataURL(et)},Pe=et=>{const _t=et.target.files[0];Ce(_t)},Me=async et=>{const _t=et.target.checked;if(Oe(_t),K)try{await a8e(l,i,_t),_t?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ne({...K,displayAsVideo:_t}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${_t?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),$.log(`Updated display mode for media screen ${i} to ${_t?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:_t})}catch(on){$.error("Error updating display mode:",on),f({title:"Update failed",description:on.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Oe(!_t)}},We=async()=>{if(ue==="image"&&!C){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(ue==="video"&&!ke){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{U(!0);const et=setInterval(()=>{J(kt=>{const ct=kt+10;return ct>=90?90:ct})},300);let _t;ue==="image"?_t=await XQ(l,i,C,{mediaType:ue,displayAsVideo:je}):(_t=ke,await XQ(l,i,null,{mediaType:"video",directUrl:ke,displayAsVideo:je})),clearInterval(et),J(100);let on=null,dt=null;ue==="image"?(on=je?null:_t,dt=(K==null?void 0:K.videoUrl)||null):(on=!je&&(K!=null&&K.imageUrl)?K.imageUrl:null,dt=_t),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:on,videoUrl:dt,mediaType:ue,displayAsVideo:je}),$.log(`Uploaded and sent ${ue} for media screen ${i} (display as video: ${je})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:ue==="image"?_t:K==null?void 0:K.imageUrl,videoUrl:ue==="video"?_t:K==null?void 0:K.videoUrl,mediaType:ue,displayAsVideo:je}),f({title:"Upload successful",description:`The ${ue} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),M(""),U(!1),J(0),e()},1e3)}catch(et){$.error(`Error uploading ${ue}:`,et),f({title:"Upload failed",description:et.message||`An error occurred while uploading the ${ue}`,status:"error",duration:5e3,isClosable:!0}),U(!1),J(0)}},He=async()=>{Y(!1);try{U(!0),await o8e(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:ue==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:ue==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),$.log(`Deleted ${ue} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),f({title:`${ue==="image"?"Image":"Video"} deleted`,description:`The ${ue} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),U(!1),xe(""),Oe(!1),setTimeout(()=>{e()},500)}catch(et){$.error(`Error deleting ${ue}:`,et),f({title:"Deletion failed",description:et.message||`An error occurred while deleting the ${ue}`,status:"error",duration:5e3,isClosable:!0}),U(!1)}},qe=()=>{L||(I(null),M(""),J(0),e())},rt=et=>{de(et),pe(et===0?"image":"video")};return b.jsxs(b.Fragment,{children:[b.jsxs(as,{isOpen:n,onClose:qe,size:"xl",children:[b.jsx(ls,{backdropFilter:"blur(10px)"}),b.jsxs(cs,{bg:"gray.800",color:"white",maxW:"900px",children:[b.jsx(so,{children:"Media Screen Content"}),b.jsx(Rs,{isDisabled:L}),b.jsxs(lt,{px:6,pb:2,children:[b.jsxs(Ur,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[b.jsxs(hr,{spacing:4,children:[b.jsx(Ze,{fontWeight:"medium",children:"Display as:"}),b.jsxs(hr,{spacing:2,children:[b.jsx(mn,{as:Uy,color:je?"gray.400":"green.300"}),b.jsx(qf,{colorScheme:"purple",size:"md",isChecked:je,onChange:Me}),b.jsx(mn,{as:s0,color:je?"purple.300":"gray.400"})]})]}),b.jsx(th,{colorScheme:je?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:je?"Video Output":"Image Output"})]}),b.jsxs(Ze,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",b.jsx("strong",{children:i})]}),b.jsx(Ze,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),b.jsx(Kf,{mb:4})]}),b.jsx(Es,{children:b.jsxs(Ur,{children:[b.jsx(L0,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ie,onChange:rt,h:"100%",minW:"120px",mr:4,children:b.jsxs(M0,{children:[b.jsxs(ka,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[b.jsx(mn,{as:Uy,mr:2})," Image"]}),b.jsxs(ka,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[b.jsx(mn,{as:s0,mr:2})," Video"]})]})}),b.jsx(lt,{flex:"1",children:oe?b.jsx(Ur,{justify:"center",align:"center",h:"150px",children:b.jsx(hd,{size:"xl",color:"blue.400"})}):b.jsxs(b.Fragment,{children:[b.jsx(lt,{children:ie===0?b.jsxs(Mr,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&ue==="image"&&b.jsxs(lt,{children:[b.jsx(Ze,{fontWeight:"semibold",mb:2,children:"Current Image:"}),b.jsxs(Ur,{children:[b.jsx(lt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:b.jsx(fp,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),b.jsxs(Mr,{align:"flex-start",spacing:2,children:[b.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),b.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),b.jsx(Nn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:b.jsx(mn,{as:b0}),onClick:()=>Y(!0),isDisabled:L,children:"Delete"})]})]}),b.jsx(Kf,{my:4})]}),b.jsx(Ze,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&ue==="image"?"Replace with new image:":"Upload new image:"}),b.jsxs(lt,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[O?b.jsx(lt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:b.jsx(fp,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):b.jsxs(Mr,{spacing:2,children:[b.jsx(mn,{as:Gk,boxSize:"24px",color:"gray.400"}),b.jsx(Ze,{children:"Drag and drop an image here, or click to browse"}),b.jsx(Ze,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),b.jsx(ni,{type:"file",accept:"image/*",onChange:Pe,ref:_,display:"none"})]}),C&&b.jsxs(Ze,{fontSize:"sm",children:["Selected file: ",C.name," (",Math.round(C.size/1024)," KB)"]})]}):b.jsxs(Mr,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&ue==="video"&&b.jsxs(lt,{children:[b.jsx(Ze,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),b.jsxs(Ur,{children:[b.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:b.jsx(Ze,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),b.jsxs(Mr,{align:"flex-start",spacing:2,children:[b.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),b.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),b.jsx(Nn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:b.jsx(mn,{as:b0}),onClick:()=>Y(!0),isDisabled:L,children:"Delete"})]})]}),b.jsx(Kf,{my:4})]}),b.jsx(Ze,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&ue==="video"?"Replace with new video:":"Add video URL:"}),b.jsx(lt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:b.jsxs(hr,{children:[b.jsx(mn,{as:Mae,color:"blue.300"}),b.jsx(Ze,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),b.jsxs(mr,{children:[b.jsx(li,{fontSize:"sm",children:"Video URL"}),b.jsx(ni,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:ke,onChange:et=>xe(et.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),b.jsx(Ze,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),b.jsxs(lt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[b.jsxs(hr,{children:[b.jsx(mn,{as:s0,color:"blue.300"}),b.jsx(Ze,{fontWeight:"medium",children:"Video Support"})]}),b.jsx(Ze,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),b.jsx(Ze,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),ke&&b.jsxs(lt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[b.jsxs(hr,{mb:2,children:[b.jsx(mn,{as:pGe,color:"blue.300"}),b.jsx(Ze,{fontWeight:"medium",children:"URL Preview"})]}),b.jsx(Ze,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:ke}),b.jsx(Ze,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),L&&b.jsxs(lt,{mt:4,children:[b.jsxs(Ze,{mb:2,children:["Uploading: ",B,"%"]}),b.jsx(qy,{value:B,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),b.jsxs(oh,{children:[b.jsx(Nn,{variant:"ghost",mr:3,onClick:qe,isDisabled:L,children:"Cancel"}),b.jsx(Nn,{colorScheme:"blue",onClick:We,isLoading:L,loadingText:"Uploading",isDisabled:ue==="image"&&!C||ue==="video"&&!ke||L||oe,leftIcon:b.jsx(mn,{as:ue==="image"?Uy:s0}),size:"lg",px:6,children:ue==="image"?"Upload Image":"Save Video URL"})]})]})]}),b.jsx(W2e,{isOpen:le,leastDestructiveRef:S,onClose:()=>Y(!1),children:b.jsx(ls,{children:b.jsxs(z2e,{bg:"gray.800",color:"white",children:[b.jsxs(so,{fontSize:"lg",fontWeight:"bold",children:["Delete ",ue==="video"?"Video":"Image"]}),b.jsxs(Es,{children:["Are you sure you want to delete this ",ue,"? This will revert the media screen to its blank state."]}),b.jsxs(oh,{children:[b.jsx(Nn,{ref:S,onClick:()=>Y(!1),children:"Cancel"}),b.jsx(Nn,{colorScheme:"red",onClick:He,ml:3,leftIcon:b.jsx(mn,{as:b0}),children:"Delete"})]})]})})})]})},DGe=n=>{const[e,i]=k.useState(null),[o,l]=k.useState(""),[u,f]=k.useState(null),[_,E]=k.useState(!1),S=Vc(),{spaceID:C}=Vo(),I=k.useCallback(L=>{var U,B;try{if(!L)return null;if(L.includes("youtube.com")||L.includes("youtu.be")){let J="";return L.includes("youtube.com/watch")?J=new URLSearchParams(new URL(L).search).get("v"):L.includes("youtu.be/")&&(J=L.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:L}if(L.includes("vimeo.com")){if(L.includes("player.vimeo.com/video"))return L;const J=(B=(U=L.split("vimeo.com/")[1])==null?void 0:U.split("?")[0])==null?void 0:B.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:L}return L}catch(J){return $.error("Error converting to embed URL:",J),L}},[]),O=k.useCallback(()=>{setTimeout(()=>{E(!1),$.log("Video processing state reset")},100)},[]);k.useEffect(()=>{let L=!0,U=null;const J=S("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ne,videoUrl:oe}=K||{};if(!ne){$.error("Media screen ID is missing in Unity event data."),O();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ne}, setting ID but not playing video`),$.log("Edit mode is active, setting media screen ID but not playing video"),f(ne);return}if(E(!0),U=setTimeout(()=>{L&&($.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),oe){if(console.log(`Using direct video URL from event: ${oe}`),L)try{const se=I(oe);console.log(`Setting video URL to: ${se} (original: ${oe})`),i(se),l(`Media Screen ${ne}`),f(ne),$.log("Media screen video URL set directly from event:",se)}catch(se){$.error("Error setting video URL from direct URL:",se)}finally{O(),clearTimeout(U)}return}console.log(`Fetching media screen data for ID: ${ne}`);try{const se=await Ff(C,ne);if(console.log("Media screen data from Firestore:",se),!se||!se.videoUrl){$.error("No video URL found for media screen:",ne),O(),clearTimeout(U);return}if(!se.displayAsVideo){$.log("Media screen is not set to display as video:",ne),console.log("displayAsVideo flag is false for this media screen"),O(),clearTimeout(U);return}if(L)try{const le=I(se.videoUrl);console.log(`Setting video URL to: ${le} (original: ${se.videoUrl})`),i(le),l(se.title||`Media Screen ${ne}`),f(ne),$.log("Media screen video URL set to:",le)}catch(le){$.error("Error setting video URL from Firestore:",le)}finally{O(),clearTimeout(U)}}catch(se){$.error(`Error fetching media screen data for ${ne}:`,se),O(),clearTimeout(U)}}catch(ne){$.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),O(),clearTimeout(U)}});return()=>{L=!1,U&&clearTimeout(U),J()}},[S,C,n,I,O]);const M=k.useCallback(()=>{i(null),l(""),f(null),E(!1),$.log("Video player state reset")},[]);return[e,o,u,M,_]},xGe=()=>{const{spaceID:n}=Vo(),e=Uc(),i=Vc(),[o,l]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const S=()=>{$.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",S),()=>{window.removeEventListener("PlayerInstantiated",S)}},[]);const u=k.useCallback(async S=>{try{return S.includes("vimeo.com")?await f(S):S.includes("youtube.com")||S.includes("youtu.be")?await _(S):"https://via.placeholder.com/640x360?text=Video"}catch(C){return $.error(`Error fetching thumbnail for ${S}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async S=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(S)}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const O=await I.json(),M=O.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let U=null;for(let B of L){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${M}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){U=J;break}}catch(K){$.warn(`Failed to validate thumbnail URL: ${J}`,K)}}return U||O.thumbnail_url}catch(C){return $.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async S=>{let C="";if(S.includes("youtube.com/watch")?C=new URLSearchParams(new URL(S).search).get("v"):S.includes("youtu.be/")&&(C=S.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(O){$.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,O)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},E=k.useCallback(async S=>{try{if(!n||!S)return;$.log(`Refreshing thumbnail for media screen ${S}`);const C=await Ff(n,S);if(!C){$.log(`No media screen found with ID ${S}`);return}if($.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){$.log(`Media screen ${S} is not set to display as video or has no video URL`);return}const I=await u(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:S,thumbnailUrl:I}),$.log(`Sent refreshed thumbnail for media screen ${S}: ${I}`)}catch(C){$.error(`Error refreshing thumbnail for media screen ${S}:`,C)}},[n,u,e]);k.useEffect(()=>{if(!o){$.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}$.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:O,thumbnailUrl:M}=I;M==="refresh"&&O&&(console.log(`Received request to refresh thumbnail for media screen ${O}`),await E(O))}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{C()}},[i,E,o]),k.useEffect(()=>{if(!o){$.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}$.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const S=async()=>{try{if(!n)throw new Error("spaceID is not defined.");$.log("Fetching media screens for thumbnails...");const I=await j3(n);$.log("All media screens:",I);const O=I.filter(U=>U.displayAsVideo&&U.videoUrl);if($.log("Media screens set to display as videos:",O),O.length===0){$.log("No media screens set to display as videos found.");return}$.log(`Found ${O.length} media screens set to display as videos.`);const M=O.map(async U=>{try{const B=await u(U.videoUrl);return $.log(`Fetched thumbnail for ${U.id}: ${B}`),{mediaScreenId:U.id,thumbnailUrl:B}}catch(B){return $.error(`Error processing thumbnail for media screen ${U.id}:`,B),{mediaScreenId:U.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),L=await Promise.all(M);$.log("Fetched Media Screen Thumbnails",L),L.forEach(({mediaScreenId:U,thumbnailUrl:B})=>{e("SetMediaScreenThumbnail",{mediaScreenId:U,thumbnailUrl:B}),$.log(`Sent thumbnail to Unity for media screen ${U}: ${B}`)})}catch(I){$.error("Error fetching media screen thumbnails:",I)}};S();const C=setInterval(S,5*60*1e3);return()=>{clearInterval(C)}},[e,n,u,o])},oZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},LGe=()=>b.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),MGe=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:u}=uh();return Y1(o,`video-modal-${i}`),k.useEffect(()=>{if(o){const f=S=>{S.target.classList&&S.target.classList.contains("chakra-modal__overlay")&&(S.stopPropagation(),S.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(S){console.error("Error disabling Unity input:",S)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(S){console.error("Error re-enabling Unity input:",S)}}}},[o]),b.jsxs(b.Fragment,{children:[b.jsx(LGe,{}),b.jsxs(as,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[b.jsx(ls,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),b.jsxs(cs,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[b.jsx(Rs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),b.jsx(Es,{p:0,width:"100%",children:n?b.jsx(lt,{className:"iframe-container",style:oZ.iframeContainer,children:b.jsx("iframe",{className:"video-iframe",src:n,style:oZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):b.jsxs(Ur,{direction:"column",align:"center",justify:"center",h:"400px",children:[b.jsx(hd,{size:"xl",mb:4}),b.jsx(Ze,{children:"Unable to load video"}),b.jsx(Ze,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Zs=(...n)=>{},UGe=()=>{const{isOpen:n,onOpen:e,onClose:i}=ld(),[o,l]=k.useState(null),[u,f]=k.useState("image"),_=k.useRef(null);Y1(n,"image-viewer-modal");const E=k.useCallback(I=>{I.stopPropagation()},[]);return k.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const O=document.getElementById("unity-canvas");return O&&(O.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),O&&(O.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:o,currentMediaType:u,openImageViewer:(I,O="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${O}`);const M=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),L=M?"image":O;console.log(`[DEBUG] Detected URL as ${M?"image":"non-image"}, using media type: ${L}`),l(I),f(L),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:_,preventPropagation:E}},VGe=()=>b.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),XU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),Zs(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},jGe=()=>{const{spaceID:n}=Vo(),[e,i]=k.useState(!1),[o,l]=k.useState([]),[u,f]=k.useState(null),{isOpen:_,onOpen:E,onClose:S}=ld(),[C,I]=k.useState({}),[O,M]=k.useState(0);k.useRef(null);const L=Uc(),{fullscreenRef:U}=uh(),B=Vc(),[J,K]=k.useState(!1),{isOpen:ne,currentImageUrl:oe,currentMediaType:se,openImageViewer:le,closeImageViewer:Y,modalContentRef:Z,preventPropagation:X}=UGe(),[ie,de,ue,pe,ke]=DGe(e),{isOpen:xe,onOpen:je,onClose:Oe}=ld();xGe(),yae(),k.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Ce=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Ce),()=>{window.removeEventListener("PlayerInstantiated",Ce)}},[]);const we=k.useCallback(Ce=>{if(Array.isArray(o)&&o.length>0){const Pe=o.find(Me=>Me.mediaScreenId===Ce);if(Pe){const Me=Pe.imageUrl,We=Pe.videoUrl;return{screen:Pe,imageUrl:Me,videoUrl:We,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",o);if(oe){let Pe=null;return Array.isArray(o)&&(Pe=o.find(Me=>Me.mediaScreenId===Ce)),{screen:Pe||{mediaScreenId:Ce},imageUrl:oe,videoUrl:null,mediaType:(Pe==null?void 0:Pe.mediaType)||"image",displayAsVideo:(Pe==null?void 0:Pe.displayAsVideo)||!1}}return n&&Ce&&Ff(n,Ce).then(Pe=>{Pe&&l(Me=>Array.isArray(Me)&&Me.some(He=>He.mediaScreenId===Ce)?Me.map(He=>He.mediaScreenId===Ce?{...He,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:He):[...Array.isArray(Me)?Me:[],{mediaScreenId:Ce,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Pe=>{console.error(`Error fetching media screen data for ${Ce}:`,Pe)}),console.warn("No screen data found for:",Ce),null},[o,oe,n,l]),Se=k.useCallback(Ce=>{if(console.log(`[DEBUG] Processing click on screen: ${Ce}, isEditMode: ${e}`),f(Ce),e)console.log(`[DEBUG] Opening upload modal for screen: ${Ce} in edit mode`),E();else{const Pe=we(Ce);if(Pe){if(console.log(`[DEBUG] Screen data for ${Ce}:`,Pe),Zs("Screen data details:",{mediaScreenId:Ce,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType,displayAsVideo:Pe.displayAsVideo}),xe&&ue===Ce)return;if(Pe.displayAsVideo&&Pe.videoUrl)Zs(`Opening video player for: ${Pe.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:Ce,videoUrl:Pe.videoUrl});else if(Pe.imageUrl){Zs(`Opening viewer modal with ${Pe.mediaType}: ${Pe.imageUrl}`);const We=XU(Pe.imageUrl);le(We,Pe.mediaType||"image")}else n&&Ff(n,Ce).then(We=>{if(We){if(We.displayAsVideo&&We.videoUrl)Zs(`Opening video player for: ${We.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:Ce,videoUrl:We.videoUrl});else if(We.imageUrl){Zs(`Opening viewer modal with image: ${We.imageUrl}`);const He=XU(We.imageUrl);le(He,We.mediaType||"image")}l(He=>Array.isArray(He)&&He.some(rt=>rt.mediaScreenId===Ce)?He.map(rt=>rt.mediaScreenId===Ce?{...rt,...We,mediaScreenId:Ce,source:"firestore-click",lastUpdated:new Date().toISOString()}:rt):[...Array.isArray(He)?He:[],{...We,mediaScreenId:Ce,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(We=>{console.error(`Error fetching media screen data for ${Ce}:`,We)})}else n&&Ff(n,Ce).then(Me=>{if(Me){if(Me.displayAsVideo&&Me.videoUrl)Zs(`Opening video player for: ${Me.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:Ce,videoUrl:Me.videoUrl});else if(Me.imageUrl){Zs(`Opening viewer modal with image: ${Me.imageUrl}`);const We=XU(Me.imageUrl);le(We,Me.mediaType||"image")}l(We=>Array.isArray(We)&&We.some(qe=>qe.mediaScreenId===Ce)?We.map(qe=>qe.mediaScreenId===Ce?{...qe,...Me,mediaScreenId:Ce,source:"firestore-click",lastUpdated:new Date().toISOString()}:qe):[...Array.isArray(We)?We:[],{...Me,mediaScreenId:Ce,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Me=>{console.error(`Error fetching media screen data for ${Ce}:`,Me)})}},[e,E,we,xe,ue,L,le,n]);k.useEffect(()=>{if(!J)return;const Ce=async()=>{if(n)try{const Me=await j3(n),We={};Me.forEach(He=>{He.id&&He.imageUrl&&(We[He.id]=He.imageUrl)}),l(He=>He.map(qe=>{const rt=!!We[qe.mediaScreenId],et=We[qe.mediaScreenId],_t=qe.mediaType||"image";return{...qe,hasImage:rt,imageUrl:et,mediaType:_t}}))}catch(Me){console.error("Error fetching media screen images:",Me)}};Ce();let Pe=null;return e&&(Pe=setInterval(Ce,5e3)),()=>{Pe&&clearInterval(Pe)}},[n,e,O,J]);const Be=Ce=>{l(Pe=>Pe.map(Me=>{if(Me.mediaScreenId===Ce.mediaScreenId){if(Ce.type==="upload")return{...Me,hasImage:!0,imageUrl:Ce.imageUrl,mediaType:Ce.mediaType||"image"};if(Ce.type==="delete")return{...Me,hasImage:!1,imageUrl:null,mediaType:null}}return Me})),Ce.type==="delete"?(setTimeout(()=>{l(Pe=>Pe.filter(Me=>Me.mediaScreenId!==Ce.mediaScreenId))},100),setTimeout(()=>{l(Pe=>Pe.filter(Me=>Me.mediaScreenId!==Ce.mediaScreenId))},1500)):setTimeout(()=>{l(Pe=>Pe.some(We=>We.mediaScreenId===Ce.mediaScreenId)?Pe.map(We=>We.mediaScreenId===Ce.mediaScreenId?{...We,imageUrl:Ce.imageUrl,hasImage:!0,mediaType:Ce.mediaType||"image"}:We):[...Pe,{mediaScreenId:Ce.mediaScreenId,imageUrl:Ce.imageUrl,hasImage:!0,mediaType:Ce.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};k.useEffect(()=>{const Ce=Pe=>{const Me=Pe.detail.enabled;i(Me),Me?L("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):L("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Ce),()=>{window.removeEventListener("editModeChanged",Ce)}},[L]),k.useEffect(()=>(window.JsSendMediaScreenClick=function(Ce){console.log("Unity: MediaScreenClick received with data:",Ce);try{const Pe=JSON.parse(Ce),Me=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Pe)});window.dispatchEvent(Me)}catch(Pe){console.error("Error processing MediaScreenClick data:",Pe)}},window.handleMediaScreenClick=function(Ce){console.log("Direct call to handleMediaScreenClick with ID:",Ce),Se(Ce)},window.TestJavaScriptFromUnity=function(Ce){console.log("Unity called TestJavaScriptFromUnity with:",Ce),alert("Unity called JavaScript: "+Ce)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Se]),k.useEffect(()=>{const Ce=We=>{try{const He=JSON.parse(We.detail);$.log(`MediaScreen registered: ${He.mediaScreenId}`),Zs("MediaScreen registered from Unity:",He),l(rt=>rt.some(_t=>_t.mediaScreenId===He.mediaScreenId)?rt.map(_t=>_t.mediaScreenId===He.mediaScreenId?{..._t,...He,source:"event",lastUpdated:new Date().toISOString()}:_t):[...rt,{...He,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&L("SetMediaScreenEditMode",{mediaScreenId:He.mediaScreenId,enabled:!0,showUploadIcon:!0});const qe=He.mediaScreenId;qe&&Ff(n,qe).then(rt=>{rt&&(Zs(`Media screen data for ${qe}:`,rt),rt.displayAsVideo&&rt.videoUrl&&(Zs(`Media screen ${qe} should display as video, sending null imageUrl`),L("SetMediaScreenImage",{mediaScreenId:qe,imageUrl:null,displayAsVideo:!0})))}).catch(rt=>{console.error(`Error fetching media screen data for ${qe}:`,rt)})}catch(He){console.error("Error handling MediaScreen registration:",He)}},Pe=We=>{try{Zs("MediaScreenClick event received:",We);let He;if(typeof We=="string")He=We,Zs("MediaScreenClick: Direct call with ID:",He);else{Zs("MediaScreenClick: Event from Unity:",We),Zs("MediaScreenClick: Event detail:",We.detail);try{He=JSON.parse(We.detail).mediaScreenId,Zs("MediaScreenClick: Parsed mediaScreenId:",He)}catch(qe){if(console.error("MediaScreenClick: Error parsing event detail:",qe),We.detail&&We.detail.mediaScreenId)He=We.detail.mediaScreenId,Zs("MediaScreenClick: Using direct mediaScreenId from detail:",He);else throw new Error("Could not extract mediaScreenId from event")}}$.log(`MediaScreen clicked: ${He}`),Zs("MediaScreen clicked:",He),Se(He)}catch(He){console.error("Error handling MediaScreen click:",He)}},Me=We=>{if(We.detail&&We.detail.eventName==="RegisterMediaScreen")Ce({detail:We.detail.eventData});else if(We.detail&&We.detail.eventName==="MediaScreenClick")Pe({detail:We.detail.eventData});else if(We.detail&&We.detail.eventName==="SetMediaScreenImage")try{const He=JSON.parse(We.detail.eventData);He.mediaScreenId&&(Zs("SetMediaScreenImage event received:",He),l(qe=>Array.isArray(qe)&&qe.some(et=>et.mediaScreenId===He.mediaScreenId)?qe.map(et=>et.mediaScreenId===He.mediaScreenId?{...et,imageUrl:He.imageUrl,hasImage:!!He.imageUrl,displayAsVideo:He.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:et):[...Array.isArray(qe)?qe:[],{mediaScreenId:He.mediaScreenId,imageUrl:He.imageUrl,hasImage:!!He.imageUrl,displayAsVideo:He.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(He){console.error("Error handling SetMediaScreenImage event:",He)}};return window.addEventListener("RegisterMediaScreen",Ce),window.addEventListener("MediaScreenClick",Pe),window.addEventListener("reactUnityEvent",Me),()=>{window.removeEventListener("RegisterMediaScreen",Ce),window.removeEventListener("MediaScreenClick",Pe),window.removeEventListener("reactUnityEvent",Me)}},[e,E,L,o,ne,xe,le,Se,n]),k.useEffect(()=>{const Ce=Pe=>{try{Zs("Direct MediaScreenClick event received:",Pe);let Me;if(Pe.detail)try{Me=JSON.parse(Pe.detail).mediaScreenId}catch(We){console.error("Error parsing MediaScreenClick event detail:",We);return}if(!Me){console.error("No mediaScreenId found in MediaScreenClick event");return}Zs(`Direct handler: Processing click for media screen ${Me}`),Se(Me)}catch(Me){console.error("Error in direct MediaScreenClick handler:",Me)}};return window.addEventListener("MediaScreenClick",Ce),()=>{window.removeEventListener("MediaScreenClick",Ce)}},[Se]),k.useEffect(()=>{ie&&je()},[ie,je]);const Ee=()=>{pe(),Oe()};return k.useEffect(()=>{const Pe=B("RegisterMediaScreen",Me=>{try{if($.log("Direct RegisterMediaScreen event received with data:",Me),!Me||!Me.mediaScreenId){$.warn("RegisterMediaScreen event received with invalid data");return}const We=Me.mediaScreenId;$.log(`Media screen registered directly: ${We}`),l(He=>He.some(rt=>rt.mediaScreenId===We)?He.map(rt=>rt.mediaScreenId===We?{...rt,...Me,source:"direct-event",lastUpdated:new Date().toISOString()}:rt):[...He,{...Me,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&L("SetMediaScreenEditMode",{mediaScreenId:We,enabled:!0,showUploadIcon:!0})}catch(We){console.error("Error handling direct RegisterMediaScreen event:",We)}});return()=>{Pe()}},[B,e,L]),k.useEffect(()=>{const Pe=B("MediaScreenClick",Me=>{try{if($.log("Direct MediaScreenClick event received with data:",Me),!Me||!Me.mediaScreenId){$.warn("MediaScreenClick event received with invalid data");return}const We=Me.mediaScreenId;$.log(`Media screen clicked directly: ${We}`),Se(We)}catch(We){console.error("Error handling direct MediaScreenClick event:",We)}});return()=>{Pe()}},[B,Se]),k.useEffect(()=>{e&&ue&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${ue}`),f(ue),E(),pe())},[e,ue,E,pe]),b.jsxs(b.Fragment,{children:[b.jsx(NGe,{isOpen:_,onClose:S,mediaScreenId:u,onImageChange:Be}),b.jsx(VGe,{}),b.jsx(hu,{containerRef:U,children:b.jsxs(as,{isOpen:ne,onClose:Y,size:"lg",isCentered:!0,portalProps:{containerRef:U},id:"image-viewer-modal",blockScrollOnMount:!0,children:[b.jsx(ls,{bg:"rgba(0, 0, 0, 0.8)",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X}),b.jsxs(cs,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[b.jsx(Rs,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),b.jsx(Es,{p:0,width:"100%",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:oe?b.jsx(lt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:se==="image"?b.jsx(fp,{src:oe,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",oe),onError:Ce=>console.error("Error loading image:",Ce,oe),onClick:X}):b.jsxs(lt,{width:"100%",textAlign:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[b.jsx(Ze,{mb:4,fontSize:"lg",children:"Video URL:"}),b.jsx(Ze,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:oe}),b.jsx(Ze,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):b.jsx(Ur,{direction:"column",align:"center",justify:"center",h:"400px",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:b.jsx(Ze,{children:"No image available"})})})]})]})}),b.jsx(MGe,{videoUrl:ie,videoTitle:de,mediaScreenId:ue,isOpen:xe,onClose:Ee})]})},Fae=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=k.useState(!1),[u,f]=k.useState(n),[_,E]=k.useState(e),S=k.useRef(null),C=k.useRef(null),I=k.useRef(null),O=k.useRef(!1),M=k.useRef(!1);k.useEffect(()=>{if(!(O.current||M.current)){if(M.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${e}, imageUrl: ${n}`),e){console.log(` PersistentBackground: Using provided video URL: ${e}`),U(e),O.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),B(n),O.current=!0;return}L()}},[n,e]),k.useEffect(()=>{const ne=oe=>{const{videoBackgroundUrl:se}=oe.detail;console.log(` PersistentBackground: Received video background update event: ${se}`),se&&!O.current&&(U(se),O.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",ne),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",ne)}},[]);const L=()=>{const oe=window.location.pathname.match(/\/space\/([^\/]+)/);if(!oe||!oe[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const se=oe[1];console.log(` PersistentBackground: Found space ID: ${se}`),ad(se).then(le=>{if(console.log(` PersistentBackground: Retrieved space data for ${se}:`,le?"success":"null"),le&&le.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${le.videoBackgroundUrl}`),U(le.videoBackgroundUrl),O.current=!0;else if(le&&(le.backgroundUrl||le.backgroundGsUrl)){const Y=le.backgroundUrl||le.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${Y}`),B(Y),O.current=!0}}).catch(le=>{console.error(" PersistentBackground: Error fetching space data:",le)})},U=ne=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${ne}`),K();const oe=document.createElement("video");I.current=oe,oe.autoplay=!0,oe.loop=!0,oe.muted=!0,oe.playsInline=!0,oe.setAttribute("playsinline",""),oe.setAttribute("webkit-playsinline",""),oe.setAttribute("preload","auto"),oe.src=ne,Object.assign(oe.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(oe),J(),oe.load();try{oe.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(se=>{console.warn(" First video play attempt failed:",se);const le=()=>{oe.play().then(()=>console.log(" Video started after user interaction")).catch(Y=>console.error(" Video still failed to play:",Y))};window.addEventListener("click",le,{once:!0}),window.addEventListener("touchstart",le,{once:!0}),setTimeout(()=>{oe.play().then(()=>console.log(" Video started after timeout")).catch(Y=>console.error(" Video still failed to play after timeout:",Y))},1e3)})}catch(se){console.error(" Error attempting to play video:",se)}},B=ne=>{if(!i||!i.current||!ne)return;console.log(` PersistentBackground: Setting up image background: ${ne}`);const oe=document.createElement("div");S.current=oe,Object.assign(oe.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${ne}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(oe),J()},J=()=>{if(!i||!i.current)return;const ne=document.createElement("div");C.current=ne,Object.assign(ne.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ne)},K=()=>{!i||!i.current||(S.current&&i.current.contains(S.current)&&(i.current.removeChild(S.current),S.current=null),I.current&&i.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),i.current.removeChild(I.current),I.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return k.useEffect(()=>{if(!i||!i.current)return;const ne=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),S.current&&(S.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{K()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),ne();return}sh.subscribe(ih.playerInstantiated,ne),window.addEventListener("PlayerInstantiated",ne);const oe=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),ne()},3e4);return()=>{sh.unsubscribe(ih.playerInstantiated,ne),window.removeEventListener("PlayerInstantiated",ne),clearTimeout(oe),K()}},[i]),null};Fae.propTypes={backgroundUrl:En.string,videoBackgroundUrl:En.string,containerRef:En.shape({current:En.instanceOf(Element)})};const aZ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Bae=({containerRef:n})=>{const{spaceID:e}=Vo(),{isUserBannedFromSpace:i}=k.useContext(us),[o,l]=k.useState(!1),[u,f]=k.useState(!1),[_,E]=k.useState(!1),[S,C]=k.useState(0),[I,O]=k.useState("Initialising World"),[M,L]=k.useState(null),U=k.useRef(null),B=k.useRef(null),J=k.useRef(null),K=k.useRef(null),ne=k.useRef(null),oe=k.useRef(null);k.useEffect(()=>($.log("PersistentLoader: Component mounted with spaceID:",e),$.log("PersistentLoader: Container ref:",n),()=>{$.log("PersistentLoader: Component unmounting")}),[]);const{error:se}=Vo(),[le,Y]=k.useState(!1);return k.useEffect(()=>{se&&($.error("PersistentLoader: Unity error detected:",se),Y(!0),setTimeout(()=>{if(U.current){const Z=U.current.querySelector("div:first-child");Z&&(Z.textContent="Reconnecting...")}},3e3))},[se]),k.useEffect(()=>{(async()=>{if(e){$.log(`PersistentLoader: Fetching logo for space ${e}`);try{const X=await ad(e);X&&X.logoUrl?($.log(`PersistentLoader: Found logo URL: ${X.logoUrl}`),L(X.logoUrl)):$.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(X){$.error("PersistentLoader: Error fetching space logo:",X)}}else $.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),k.useEffect(()=>{const Z=X=>{const{logoUrl:ie}=X.detail;$.log(`PersistentLoader: Logo update event received with URL: ${ie}`),L(ie),B.current?ie?($.log("PersistentLoader: Updating logo element with new URL"),B.current.src=ie,J.current.style.display="flex"):($.log("PersistentLoader: Hiding logo element (no URL)"),J.current.style.display="none"):$.warn("PersistentLoader: Logo ref is null during update")};return $.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",Z),()=>{$.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",Z)}},[]),k.useEffect(()=>{(async()=>{if(e&&i)try{await i(e)&&($.warn(`PersistentLoader: user banned from space ${e}`),l(!0))}catch(X){$.error("PersistentLoader: error checking ban status",X)}})()},[e,i]),k.useEffect(()=>{if(!n||!n.current){$.error("PersistentLoader: Container ref missing");return}if(o){const Be=document.createElement("div");return Object.assign(Be.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),Be.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(Be),()=>{n.current.removeChild(Be)}}$.log("PersistentLoader: Creating loader elements");const Z=document.createElement("div");if(U.current=Z,Object.assign(Z.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),M){$.log(`PersistentLoader: Creating logo element with URL: ${M}`);const Be=document.createElement("div");J.current=Be,Object.assign(Be.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const Ee=document.createElement("img");B.current=Ee,Ee.src=M,Ee.alt="Space Logo",Ee.style.maxHeight="100px",Ee.style.maxWidth="100%",Ee.style.objectFit="contain",Ee.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Be.appendChild(Ee),n.current.appendChild(Be),$.log("PersistentLoader: Logo container added to main container")}else $.log("PersistentLoader: No logo URL available, skipping logo creation");const X=document.createElement("style");X.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(X),$.log("PersistentLoader: Animation styles added to document head");const ie=document.createElement("div");ie.style.fontSize="16px",ie.style.fontWeight="bold",ie.style.textAlign="center",ie.style.marginBottom="16px",ie.style.color="#ffffff",ie.textContent="Initialising World";const de=document.createElement("div");de.style.width="240px",de.style.height="100px",de.style.position="relative",de.style.marginBottom="15px",de.style.padding="0px",de.style.overflow="hidden",de.style.boxSizing="border-box",de.style.transition="opacity 0.8s ease-in-out",de.style.opacity="0";const ue=document.createElement("div");ue.style.width="100%",ue.style.height="100%",ue.style.position="absolute",ue.style.top="0",ue.style.left="0",ue.style.maskImage=`url(${aZ})`,ue.style.maskSize="contain",ue.style.maskPosition="center",ue.style.maskRepeat="no-repeat",ue.style.webkitMaskImage=`url(${aZ})`,ue.style.webkitMaskSize="contain",ue.style.webkitMaskPosition="center",ue.style.webkitMaskRepeat="no-repeat",ue.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",ue.style.backgroundSize="100% 100%",ue.style.transition="background 0.5s ease-out",K.current=ue,ne.current=null,de.appendChild(ue);const pe=document.createElement("div");pe.style.marginTop="8px",pe.style.fontSize="14px",pe.style.fontWeight="bold",pe.style.color="#ffffff",pe.textContent="0%",Z.appendChild(ie),Z.appendChild(de),Z.appendChild(pe),n.current.appendChild(Z),$.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{J.current&&(J.current.style.opacity="1"),Z.style.opacity="1",de.style.opacity="1"},500);const ke=Be=>{C(Be);const Ee=Math.round(Be*100),Ce=`linear-gradient(to right, #4facfe 0%, #00f2fe ${Ee}%, white ${Ee}%, white 100%)`;ue.style.background=Ce,pe.textContent=`${Ee}%`,$.log(`PersistentLoader: Progress updated to ${Ee}%`)},xe=Be=>{O(Be),ie.textContent=Be,$.log(`PersistentLoader: Loading stage updated to "${Be}"`)},je=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];le&&(je[0].stage="Connecting to Space",je[1].stage="Reconnecting...",je[2].stage="Please Wait"),xe(je[0].stage),ke(.25);const Oe=Be=>{const Ee=Be.detail.progress;$.log(`PersistentLoader: Progress event received with value: ${Ee}`),ke(Ee),Ee<.33?xe(je[0].stage):Ee<.66?xe(je[1].stage):xe(je[2].stage)},we=()=>{$.log("PersistentLoader: First scene loaded event received"),f(!0),xe(je[1].stage),ke(.66)},Se=()=>{if($.log("PersistentLoader: Player instantiated event received"),oe.current&&(clearInterval(oe.current),$.log("PersistentLoader: Progress interval cleared")),E(!0),xe(je[2].stage),ke(1),le){$.log("PersistentLoader: Keeping loader visible due to Unity error");return}Z.style.transition="all 0.5s ease-in-out",de.style.transition="opacity 1.2s ease-in-out",ie.style.transition="opacity 0.4s ease-in-out",pe.style.transition="opacity 0.4s ease-in-out",J.current&&(J.current.style.transition="opacity 0.5s ease-in-out"),Z.style.backgroundColor="rgba(0, 0, 0, 0)",Z.style.backdropFilter="blur(0px)",Z.style.WebkitBackdropFilter="blur(0px)",Z.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",Z.style.border="1px solid rgba(255, 255, 255, 0)",ie.style.opacity="0",pe.style.opacity="0",J.current&&(J.current.style.opacity="0"),setTimeout(()=>{de.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(Z)?(n.current.removeChild(Z),$.log("PersistentLoader: Loader element removed after fade")):$.warn("PersistentLoader: Could not remove loader element (not found in container)"),J.current&&n.current&&n.current.contains(J.current)?(n.current.removeChild(J.current),$.log("PersistentLoader: Logo container removed after fade")):J.current&&$.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)$.log("PersistentLoader: Player was already instantiated"),Se();else{$.log("PersistentLoader: Subscribing to playerInstantiated event"),sh.subscribe(ih.playerInstantiated,Se);const Be=()=>Se();$.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",Be),$.log("PersistentLoader: Adding firstSceneLoaded event listener"),sh.subscribe(ih.firstSceneLoaded,we),$.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Oe),oe.current=setInterval(()=>{_||C(Ce=>{const Pe=Math.min(Ce+.02,.95);return ke(Pe),Pe<.33&&I!==je[0].stage?xe(je[0].stage):Pe>=.33&&Pe<.66&&I!==je[1].stage?xe(je[1].stage):Pe>=.66&&I!==je[2].stage&&xe(je[2].stage),Pe})},300);const Ee=setTimeout(()=>{$.log("PersistentLoader: Forcing loader removal after timeout"),Se()},6e4);return()=>{$.log("PersistentLoader: Cleaning up event listeners"),sh.unsubscribe(ih.playerInstantiated,Se),window.removeEventListener("PlayerInstantiated",Be),sh.unsubscribe(ih.firstSceneLoaded,we),window.removeEventListener("UnityProgress",Oe),clearInterval(oe.current),clearTimeout(Ee),n.current&&n.current.contains(Z)&&(n.current.removeChild(Z),$.log("PersistentLoader: Loader element removed during cleanup")),J.current&&n.current&&n.current.contains(J.current)&&(n.current.removeChild(J.current),$.log("PersistentLoader: Logo container removed during cleanup"))}}},[M,n]),null};Bae.propTypes={containerRef:En.shape({current:En.instanceOf(Element)})};const FGe=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=k.useState(!1),[u,f]=k.useState(!1),{savedStreamData:_,reloadStreamData:E}=_ae(),{spaceID:S}=Vo(),{user:C}=k.useContext(us),I=Ua(),[O,M]=k.useState(!1),L=eq((_==null?void 0:_.rtmpUrl)||""),U=eq((_==null?void 0:_.streamKey)||"");k.useEffect(()=>{if(S){$.log("LiveStreamButton: Forcing reload of stream data"),E();const K=()=>{$.log("LiveStreamButton: Stream settings changed, reloading data"),E()};return window.addEventListener("StreamSettingsChanged",K),()=>{window.removeEventListener("StreamSettingsChanged",K)}}},[S,E]),k.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!S){M(!1);return}try{const ne=await P6e(C.uid,"disruptiveAdmin"),oe=await x6e(C,S);M(ne||oe)}catch(ne){$.error("Error checking user permissions:",ne),M(!1)}})()},[C==null?void 0:C.uid,S]),k.useEffect(()=>{$.log("LiveStreamButton: Current streaming data:",{enabled:_==null?void 0:_.enabled,hasRtmpUrl:!!(_!=null&&_.rtmpUrl),hasStreamKey:!!(_!=null&&_.streamKey),hasPermission:O,isPlayerReady:u})},[_,O,u]),k.useEffect(()=>{const K=()=>{$.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&($.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const B=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},J=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!O||(_==null?void 0:_.enabled)!==!0?($.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!O,streamingDisabled:(_==null?void 0:_.enabled)!==!0,enabledValue:_==null?void 0:_.enabled}),null):b.jsxs(b.Fragment,{children:[b.jsx(Yf,{label:"Live Stream Info",placement:e,hasArrow:!0,children:b.jsx(wl,{size:n,borderRadius:"full",bg:"black",icon:b.jsx(z8e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:B})}),b.jsxs(as,{isOpen:o,onClose:J,isCentered:!0,size:"md",children:[b.jsx(ls,{backdropFilter:"blur(4px)"}),b.jsxs(cs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[b.jsx(so,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),b.jsx(Rs,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),b.jsx(Es,{p:4,children:_!=null&&_.rtmpUrl&&(_!=null&&_.streamKey)?b.jsxs(lt,{children:[b.jsx(Ze,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),b.jsxs(lt,{mb:4,children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),b.jsx(Ur,{children:b.jsxs(xg,{size:"sm",children:[b.jsx(ni,{value:_.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),b.jsx(iN,{children:b.jsx(xc,{"aria-label":"Copy RTMP URL",icon:L.hasCopied?b.jsx(QQ,{}):b.jsx(ZQ,{}),size:"xs",colorScheme:L.hasCopied?"green":"blue",onClick:()=>{L.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),b.jsxs(lt,{mb:4,children:[b.jsx(Ze,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),b.jsx(Ur,{children:b.jsxs(xg,{size:"sm",children:[b.jsx(ni,{value:_.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),b.jsx(iN,{children:b.jsx(xc,{"aria-label":"Copy Stream Key",icon:U.hasCopied?b.jsx(QQ,{}):b.jsx(ZQ,{}),size:"xs",colorScheme:U.hasCopied?"green":"blue",onClick:()=>{U.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),b.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):b.jsxs(lt,{textAlign:"center",p:4,children:[b.jsx(Ze,{color:"white",children:"No stream configuration found for this space."}),b.jsx(Ze,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})};function BGe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const WGe=({isOpen:n,onClose:e,portal:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,f]=k.useState({x:0,y:1.5,z:0}),[_,E]=k.useState({x:0,y:0,z:0}),[S,C]=k.useState({x:1,y:1,z:1}),I=Uc(),O=Ua();k.useEffect(()=>{i&&(f(i.position||{x:0,y:1.5,z:0}),E(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{I("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:_,scale:S})},[u,_,S,i.portalId,I]),BGe(()=>{const L={...i,position:u,rotation:_,scale:S};iZ(o,i.portalId,L)},300,[u,_,S,o,i.portalId]);const M=async()=>{try{if(I("DeletePortal",{portalId:i.portalId}),await iZ(o,i.portalId,null))O({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{O({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return b.jsxs(lt,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[b.jsx(lt,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsxs(mr,{children:[b.jsx(li,{children:"Position"}),b.jsxs(hr,{children:[b.jsxs(Po,{value:u.x,onChange:(L,U)=>f(B=>({...B,x:U})),step:.1,precision:2,children:[b.jsx(ko,{placeholder:"X"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:u.y,onChange:(L,U)=>f(B=>({...B,y:U})),step:.1,precision:2,children:[b.jsx(ko,{placeholder:"Y"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:u.z,onChange:(L,U)=>f(B=>({...B,z:U})),step:.1,precision:2,children:[b.jsx(ko,{placeholder:"Z"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]})]})]}),b.jsxs(mr,{children:[b.jsx(li,{children:"Rotation"}),b.jsxs(hr,{children:[b.jsxs(Po,{value:_.x,onChange:(L,U)=>E(B=>({...B,x:U})),step:1,children:[b.jsx(ko,{placeholder:"X"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:_.y,onChange:(L,U)=>E(B=>({...B,y:U})),step:1,children:[b.jsx(ko,{placeholder:"Y"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:_.z,onChange:(L,U)=>E(B=>({...B,z:U})),step:1,children:[b.jsx(ko,{placeholder:"Z"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]})]})]}),b.jsxs(mr,{children:[b.jsx(li,{children:"Scale"}),b.jsxs(hr,{children:[b.jsxs(Po,{value:S.x,onChange:(L,U)=>C(B=>({...B,x:U})),step:.1,precision:2,min:.1,children:[b.jsx(ko,{placeholder:"X"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:S.y,onChange:(L,U)=>C(B=>({...B,y:U})),step:.1,precision:2,min:.1,children:[b.jsx(ko,{placeholder:"Y"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:S.z,onChange:(L,U)=>C(B=>({...B,z:U})),step:.1,precision:2,min:.1,children:[b.jsx(ko,{placeholder:"Z"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]})]})]}),b.jsx(hr,{spacing:4,width:"100%",justify:"flex-end",children:b.jsx(Nn,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Portal"})}),b.jsx(Nn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},zGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},GGe=()=>{const{spaceID:n}=Vo(),e=Uc(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityPortalImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{$.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){$.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}$.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=Al(Hn,"spaces",n,"portals"),f=await od(u);if(f.empty){$.log("useUnityPortalImages: No portals found for space:",n);return}$.log(`useUnityPortalImages: Found ${f.size} portals for space ${n}`);for(const _ of f.docs){const E=_.data(),S=E.portalId,C=E.targetSpaceId;if(!C){$.warn(`useUnityPortalImages: No target space ID found for portal: ${S}`);continue}const I=await ad(C);if(!I){$.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const O=I.backgroundUrl||I.backgroundGsUrl;if(!O){$.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const M=zGe(O);e("SetPortalImage",JSON.stringify({portalId:S,imageUrl:M})),$.log(`Sent portal image data to Unity for portal ${S}: ${M}`)}}catch(u){$.error("Error fetching portal images:",u)}})()},[e,n,i])},HGe=()=>(GGe(),null);function $Ge(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const KGe=({isOpen:n,onClose:e,item:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,f]=k.useState({x:0,y:0,z:0}),[_,E]=k.useState({x:0,y:0,z:0}),[S,C]=k.useState({x:1,y:1,z:1}),I=Uc(),O=Ua();k.useEffect(()=>{i&&(f(i.position||{x:0,y:0,z:0}),E(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{I("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:_,scale:S})},[u,_,S,i.hotspotId,I]),$Ge(()=>{const L=gr(Hn,"spaces",o,"catalogue",i.hotspotId);oo(L,{position:u,rotation:_,scale:S,updatedAt:Date.now()})},300,[u,_,S,o,i.hotspotId]);const M=async()=>{try{I("DeleteCatalogueItem",{hotspotId:i.hotspotId});const L=gr(Hn,"spaces",o,"catalogue",i.hotspotId);await oo(L,{deleted:!0}),O({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{O({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return b.jsxs(lt,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[b.jsx(lt,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsxs(mr,{children:[b.jsx(li,{children:"Position"}),b.jsxs(hr,{children:[b.jsxs(Po,{value:u.x,onChange:(L,U)=>f(B=>({...B,x:U})),step:.1,precision:2,children:[b.jsx(ko,{placeholder:"X"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:u.y,onChange:(L,U)=>f(B=>({...B,y:U})),step:.1,precision:2,children:[b.jsx(ko,{placeholder:"Y"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:u.z,onChange:(L,U)=>f(B=>({...B,z:U})),step:.1,precision:2,children:[b.jsx(ko,{placeholder:"Z"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]})]})]}),b.jsxs(mr,{children:[b.jsx(li,{children:"Rotation"}),b.jsxs(hr,{children:[b.jsxs(Po,{value:_.x,onChange:(L,U)=>E(B=>({...B,x:U})),step:1,children:[b.jsx(ko,{placeholder:"X"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:_.y,onChange:(L,U)=>E(B=>({...B,y:U})),step:1,children:[b.jsx(ko,{placeholder:"Y"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:_.z,onChange:(L,U)=>E(B=>({...B,z:U})),step:1,children:[b.jsx(ko,{placeholder:"Z"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]})]})]}),b.jsxs(mr,{children:[b.jsx(li,{children:"Scale"}),b.jsxs(hr,{children:[b.jsxs(Po,{value:S.x,onChange:(L,U)=>C(B=>({...B,x:U})),step:.1,precision:2,min:.1,children:[b.jsx(ko,{placeholder:"X"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:S.y,onChange:(L,U)=>C(B=>({...B,y:U})),step:.1,precision:2,min:.1,children:[b.jsx(ko,{placeholder:"Y"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]}),b.jsxs(Po,{value:S.z,onChange:(L,U)=>C(B=>({...B,z:U})),step:.1,precision:2,min:.1,children:[b.jsx(ko,{placeholder:"Z"}),b.jsxs(Oo,{children:[b.jsx(Do,{}),b.jsx(No,{})]})]})]})]}),b.jsx(hr,{spacing:4,width:"100%",justify:"flex-end",children:b.jsx(Nn,{colorScheme:"red",onClick:M,variant:"outline",children:"Delete Item"})}),b.jsx(Nn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function qGe(){const{clickedItem:n,clearClickedItem:e}=Tae(),[i,o]=k.useState(!1);k.useEffect(()=>{const f=_=>{_!=null&&_.detail&&typeof _.detail.enabled=="boolean"&&(o(_.detail.enabled),_.detail.enabled||e())};return window.addEventListener("editModeChanged",f),()=>window.removeEventListener("editModeChanged",f)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const f=n.hotspotId.split("_");f.length>=3&&(u=f.slice(1,-1).join("_"))}return b.jsx(b.Fragment,{children:n&&i&&b.jsx(KGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const YGe=(n,e={})=>{const{user:i}=k.useContext(us),{trackUnityEvent:o,isReady:l}=BR(n,{enableDebugLogs:e.enableDebugLogs||!1}),u=Vc();return k.useEffect(()=>{if(!l||!i)return;$.log(" Unity Analytics: Setting up event listeners");const f=u("PlayVideo",L=>{$.log(" Unity Analytics: Video play event detected",L),o(ra.UNITY.VIDEO_PLAY,{category:xo.MEDIA_INTERACTION,videoId:L==null?void 0:L.gameObjectName,videoUrl:L==null?void 0:L.videoUrl,isEditMode:(L==null?void 0:L.isEditMode)||!1,timestamp:new Date().toISOString(),...L})}),_=u("PlayMediaScreenVideo",L=>{$.log(" Unity Analytics: Media screen click event detected",L),o(ra.UNITY.MEDIA_SCREEN_CLICK,{category:xo.MEDIA_INTERACTION,mediaScreenId:L==null?void 0:L.mediaScreenId,videoUrl:L==null?void 0:L.videoUrl,isEditMode:(L==null?void 0:L.isEditMode)||!1,timestamp:new Date().toISOString(),...L})}),E=u("OpenNameplateModal",L=>{$.log(" Unity Analytics: Nameplate click event detected",L),o(ra.UNITY.NAMEPLATE_CLICK,{category:xo.SOCIAL_INTERACTION,targetUserId:L==null?void 0:L.uid,targetPlayerName:L==null?void 0:L.playerName,targetPlayerId:L==null?void 0:L.playerId,isLocalPlayer:(L==null?void 0:L.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...L})}),S=u("PlayerInstantiated",L=>{$.log(" Unity Analytics: Player spawn event detected",L),o(ra.UNITY.PLAYER_SPAWN,{category:xo.SYSTEM_EVENT,timestamp:new Date().toISOString(),...L})}),C=u("FirstSceneLoaded",L=>{$.log(" Unity Analytics: First scene loaded event detected",L),o(ra.UNITY.SPACE_READY,{category:xo.SYSTEM_EVENT,timestamp:new Date().toISOString(),...L})}),I=u("SeatingHotspotClicked",L=>{$.log(" Unity Analytics: Catalogue item click event detected",L),o(ra.UNITY.OBJECT_INTERACT,{category:xo.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:L==null?void 0:L.hotspotId,itemId:L==null?void 0:L.itemId,position:L==null?void 0:L.position,timestamp:new Date().toISOString(),...L})}),O=u("UpdatePlayerList",L=>{L!=null&&L.players&&Array.isArray(L.players)&&($.log(" Unity Analytics: Player list update event detected",L),o(ra.UNITY.PLAYER_MOVE,{category:xo.SOCIAL_INTERACTION,activePlayerCount:L.players.length,playerList:L.players.map(U=>({playerId:U.playerId,playerName:U.playerName,isLocalPlayer:U.isLocalPlayer})),timestamp:new Date().toISOString()}))}),M=u("RequestUserForUnity",L=>{$.log(" Unity Analytics: Unity user request event detected",L),o(ra.UNITY.SPACE_LOAD,{category:xo.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...L})});return()=>{$.log(" Unity Analytics: Cleaning up event listeners"),f(),_(),E(),S(),C(),I(),O(),M()}},[l,i,o,u]),{isReady:l,trackUnityEvent:o}},XGe="a2a7f4eb05284449b1063eb71d8301dc",JU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),F3=k.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=Vo(),u=r8e();s8e();const f=Uc(),_=C8e(u),{user:E}=k.useContext(us),[S,C]=k.useState(!1),[I,O]=k.useState(window.devicePixelRatio),[M,L]=i8e();Eae().find(dt=>dt.isLocalPlayer);const[B,J]=k.useState(!0),[K,ne]=k.useState(!0),oe=n.spaceID||"default";T8e(),S8e(oe),YGe(oe,{enableDebugLogs:!0});const{trackUnityEvent:se}=BR(oe,{enableDebugLogs:!0}),[le,Y]=k.useState(!1),[Z,X]=k.useState(!1),[ie,de]=k.useState(!1),ue=k.useMemo(()=>{const ct=new URLSearchParams(window.location.search).get("sessionId")||oe;return console.log("WebGLRenderer: Using session ID:",ct),ct},[oe]),[pe,ke]=k.useState(null);k.useEffect(()=>{E!=null&&E.uid&&cu(E.uid).then(dt=>{ke(dt),console.log("WebGLRenderer: User profile loaded:",(dt==null?void 0:dt.Nickname)||"Unknown")}).catch(dt=>{console.error("Error fetching user profile:",dt)})},[E==null?void 0:E.uid]),k.useEffect(()=>{if(l||!E){console.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const dt=setTimeout(()=>{X(!0),de(!0)},1e3);return()=>clearTimeout(dt)}else X(!1)},[l,E]),k.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const dt=()=>{console.log("WebGLRenderer: Player instantiated event received"),ne(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ne(!0)),sh.subscribe(ih.playerInstantiated,dt);const kt=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ne(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{sh.unsubscribe(ih.playerInstantiated,dt),clearTimeout(kt)}},[K]),k.useEffect(()=>{const dt=()=>{console.log("WebGLRenderer: Modal opened"),de(!0)},kt=()=>{console.log("WebGLRenderer: Modal closed"),de(!1)};return window.addEventListener("modal-opened",dt),window.addEventListener("modal-closed",kt),()=>{window.removeEventListener("modal-opened",dt),window.removeEventListener("modal-closed",kt)}},[]),k.useEffect(()=>{de(M!==null)},[M]),k.useEffect(()=>{o||u?setTimeout(()=>{C(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,u]),k.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(dt){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",dt)}},1e3)},[o,i]),k.useEffect(()=>{const dt=document.getElementById("webgl-root");return dt?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),dt.style.display="block",dt.getAttribute("data-space-id")!==oe&&(dt.setAttribute("data-space-id",oe),console.log(`WebGLRenderer: Set data-space-id attribute to ${oe}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[oe]),k.useEffect(()=>{const dt=()=>{const Ut=JU();Ut?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ut.tabIndex=1,Ut.style.outline="none",Ut.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ie||i0(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};dt();const kt=setTimeout(dt,1e3),ct=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),dt()};return window.addEventListener("unityReady",ct),()=>{clearTimeout(kt),window.removeEventListener("unityReady",ct)}},[o,ie]);const xe=k.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),ie||i0(!0)},[ie]);k.useEffect(()=>{if(o&&i){const dt=JU();if(dt)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),dt.addEventListener("click",xe),()=>{dt.removeEventListener("click",xe)}}},[o,i,xe]),k.useEffect(()=>{if(o&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const dt=kt=>{if(ie){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(kt.target.tagName==="INPUT"||kt.target.tagName==="TEXTAREA"||kt.target.tagName==="SELECT"||kt.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(kt.target.closest(".chakra-modal__content")||kt.target.closest('[role="dialog"]')||kt.target.closest('[role="menu"]')||kt.target.closest(".chakra-popover__content")||kt.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const ct=JU();if(ct&&(kt.target===ct||ct.contains(kt.target)))return;if(kt.target.closest(".webgl-overlay")||kt.target.closest(".game-ui")||kt.target.closest(".player-list")||kt.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{ie||i0(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{ct&&!ie&&((ct.tabIndex===void 0||ct.tabIndex<0)&&(ct.tabIndex=1),ct.focus(),i0(!0))},50)};return document.addEventListener("click",dt,!0),()=>{document.removeEventListener("click",dt,!0)}}},[o,i,ie]),k.useEffect(()=>{const dt=kt=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",kt)};return sh.subscribe(ih.sendUserToUnity,dt),()=>sh.unsubscribe(ih.sendUserToUnity,dt)},[f]);const{setFullscreenRef:je,fullscreenRef:Oe}=uh();k.useEffect(()=>{je(e.current)},[e,je]);const we=()=>{J(!B)},Se=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:K,showVoiceChat:Se,sessionId:ue}),k.useEffect(()=>{const dt=kt=>{console.log("Edit mode changed event:",kt.detail),Y(kt.detail.enabled)};return window.addEventListener("editModeChanged",dt),()=>{window.removeEventListener("editModeChanged",dt)}},[]),yae(),l8e();const Be=k.useRef(null),{clickedPortal:Ee,clearClickedPortal:Ce}=b8e(),[Pe,Me]=k.useState(!1),[We,He]=k.useState(!1),[qe,rt]=k.useState(""),[et,_t]=k.useState("");k.useEffect(()=>{async function dt(){if(rt(""),_t(""),Ee&&!le){let kt=Ee.targetSpaceId;if(!kt&&Ee.portalId)try{const ct=gr(Hn,"spaces",oe,"portals",Ee.portalId),Ut=await Uo(ct);Ut.exists()&&(kt=Ut.data().targetSpaceId)}catch{}if(kt)try{const ct=await ad(kt);rt((ct==null?void 0:ct.name)||kt),_t((ct==null?void 0:ct.slug)||""),He(!0)}catch{rt(kt),_t(""),He(!0)}else rt(""),_t(""),He(!0)}}Ee&&le&&Me(!0),Ee&&!le&&dt()},[Ee,le,oe]);const on=()=>{console.log("Closing portal editor"),Me(!1),Ce()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:Pe,clickedPortal:Ee,isEditMode:le}),w8e(oe),Tae(),b.jsxs(lt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&b.jsx(Fae,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:Be}),!Z&&b.jsx(Bae,{containerRef:Be}),Z&&b.jsx(lt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:b.jsx(J1,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),b.jsx(qGe,{spaceId:oe,isEditMode:le}),b.jsx(iF,{containerRef:Oe.current?Oe:document.body,children:b.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[b.jsxs(lt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&b.jsx(I8e,{}),E&&b.jsx(FGe,{size:"md"}),Se&&b.jsxs(xae,{appId:XGe,channel:ue,uid:E==null?void 0:E.uid,enabled:!0,children:[b.jsx(iGe,{size:"md",defaultMuted:!0,joinOnClick:!0}),b.jsx(oGe,{userNickname:pe==null?void 0:pe.Nickname})]}),b.jsx(H8e,{}),b.jsx(lt,{position:"relative",zIndex:"9999",children:b.jsx(kGe,{onTogglePlayerList:we,spaceID:oe})})]}),b.jsxs(lt,{ref:Be,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[b.jsx(lt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),b.jsx(lt,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?b.jsx(gae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):b.jsx(lt,{width:"100%",height:"100%"})}),b.jsx(lt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:b.jsx(R8e,{})})]}),b.jsx(lt,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&b.jsx(fp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),b.jsxs(lt,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&b.jsx(A8e,{}),b.jsx(q8e,{})]}),b.jsx(Y8e,{}),b.jsx(X8e,{isOpen:M!==null,onClose:()=>{console.log(" Closing nameplate modal"),L()},playerName:(M==null?void 0:M.playerName)||"Unknown Player",playerId:(M==null?void 0:M.playerId)||"Unknown ID"}),b.jsx(J8e,{isVisible:B,onToggleVisibility:J,spaceID:oe}),b.jsx(jGe,{}),b.jsx(lt,{position:"absolute",top:4,right:4,zIndex:1e3,children:Pe&&Ee&&b.jsx(WGe,{isOpen:Pe,onClose:on,portal:Ee,spaceId:oe})}),!le&&We&&b.jsxs(as,{isOpen:We,onClose:()=>{He(!1),Ce(),rt(""),_t("")},isCentered:!0,children:[b.jsx(ls,{}),b.jsxs(cs,{bg:"#181818",borderRadius:"2xl",boxShadow:"2xl",maxW:"420px",p:0,children:[b.jsx(so,{textAlign:"center",fontWeight:"extrabold",fontSize:"2xl",color:"white",pt:8,pb:4,children:qe?`Visit ${qe}?`:"Visit Space?"}),b.jsx(Rs,{color:"white",top:4,right:4}),b.jsx(Es,{pb:8,pt:2,px:8,children:b.jsxs(Ur,{mt:4,gap:6,justify:"center",children:[b.jsx(Nn,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{He(!1),Ce(),rt(""),_t("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),b.jsx(Nn,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(Ee&&E){let dt=null;if(Ee.portalId){const kt=Ee.portalId.split("_");kt.length>=3&&(dt=kt[2])}await se(ra.UNITY.PORTAL_NAVIGATE,{category:xo.NAVIGATION,portalId:Ee.portalId,targetSpaceId:dt,sourceSpaceId:oe,targetSpaceName:qe,targetSpaceSlug:et,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()}),console.log(" Analytics: Portal navigation event tracked for:",Ee.portalId,"",dt)}et&&window.open(`https://www.spacesmetaverse.com/w/${et}`,"_blank","noopener"),He(!1),Ce(),rt(""),_t("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),b.jsx(HGe,{})]})})]})});F3.displayName="WebGLRenderer";F3.propTypes={settings:En.shape({urlLoadingBackground:En.string,videoBackgroundUrl:En.string,showAuthButton:En.bool,showDisruptiveLogo:En.bool,urlDisruptiveLogo:En.string,showHelpButton:En.bool,enableVoiceChat:En.bool,spaceID:En.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if($.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),$.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const B3=({spaceID:n,overrideSettings:e})=>{const i=k.useRef(null),[o,l]=k.useState(!0),{loading:u,isUserBannedFromSpace:f,user:_}=k.useContext(us),[E,S]=k.useState(!1),[C,I]=k.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[O,M]=k.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return k.useEffect(()=>{(async()=>{try{const U=await ad(n);if(U){console.log("Space data: ",U),I(ne=>({...ne,spaceID:n,loaderUrl:U.loaderUrl,dataUrl:U.dataUrl,frameworkUrl:U.frameworkUrl,codeUrl:U.codeUrl}));const B=await jk(O.urlDisruptiveLogo);let J="";if(U.backgroundUrl)J=U.backgroundUrl;else if(U.backgroundGsUrl)try{J=await jk(U.backgroundGsUrl)}catch(ne){$.warn("WebGLLoader: Error fetching background from GS URL:",ne)}else if(U.gsUrlLoadingBackground)try{J=await jk(U.gsUrlLoadingBackground)}catch(ne){$.warn("WebGLLoader: Error fetching background from legacy GS URL:",ne)}let K="";U.videoBackgroundUrl&&(K=U.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",K)),M(ne=>({...ne,urlLoadingBackground:J,videoBackgroundUrl:K,showAuthButton:U.showAuthButton!==void 0?U.showAuthButton:!0,showDisruptiveLogo:U.showDisruptiveLogo!==void 0?U.showDisruptiveLogo:!0,showHelpButton:U.showHelpButton!==void 0?U.showHelpButton:!0,enableVoiceChat:U.enableVoiceChat!==void 0?U.enableVoiceChat:!0,urlDisruptiveLogo:B,spaceID:n,...e||{}})),K&&(console.log("WebGLLoader: Dispatching video background event with URL:",K),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:K}}))),l(!1)}else $.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(U){$.error("WebGLLoader: Error fetching space data:",U)}finally{l(!1)}})()},[n,O.urlDisruptiveLogo,e]),k.useEffect(()=>{(async()=>{if(!u&&_&&f)try{const U=await f(n);S(U)}catch(U){$.error("WebGLLoader: ban check error",U)}})()},[u,_,n,f]),k.useEffect(()=>{o||($.log("WebGLLoader: Unity config from Firebase",C),$.log("WebGLLoader: Space settings from Firebase",O))},[o]),u?b.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):E?b.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):n?b.jsx(b.Fragment,{children:o?b.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):b.jsx(n8e,{...C,children:b.jsx(F3,{ref:i,settings:O})})}):null};B3.propTypes={spaceID:En.string.isRequired,overrideSettings:En.object};function cZ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,u]=k.useState(null);return k.useEffect(()=>{JC(i).then(u)},[]),l?b.jsx(n1,{theme:l,children:b.jsx($1,{children:b.jsx(k3,{children:b.jsx(B3,{spaceID:e})})})}):b.jsx("div",{children:"Loading theme..."})};try{MN.createRoot(n).render(b.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",cZ):cZ());const JGe=(n,e)=>{try{const i=Al(Hn,`spaces/${n}/chatMessages`),o=new Date,l=IN(i,$Be("timestamp","asc"),qBe(o));return Ioe(l,u=>{const f=[];u.docChanges().forEach(_=>{if(_.type==="added"){const E=_.doc.data();console.log("Firestore document data:",E),f.push({id:_.doc.id,...E})}}),f.length>0&&e(f)})}catch(i){throw $.error("Error subscribing to space chat messages:",i),i}};function dh(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function aE(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const Wae=6048e5,QGe=864e5;let ZGe={};function Q1(){return ZGe}function cR(n,e){var _,E,S,C;const i=Q1(),o=(e==null?void 0:e.weekStartsOn)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.weekStartsOn)??i.weekStartsOn??((C=(S=i.locale)==null?void 0:S.options)==null?void 0:C.weekStartsOn)??0,l=dh(n),u=l.getDay(),f=(u<o?7:0)+u-o;return l.setDate(l.getDate()-f),l.setHours(0,0,0,0),l}function LN(n){return cR(n,{weekStartsOn:1})}function zae(n){const e=dh(n),i=e.getFullYear(),o=aE(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=LN(o),u=aE(n,0);u.setFullYear(i,0,4),u.setHours(0,0,0,0);const f=LN(u);return e.getTime()>=l.getTime()?i+1:e.getTime()>=f.getTime()?i:i-1}function lZ(n){const e=dh(n);return e.setHours(0,0,0,0),e}function uZ(n){const e=dh(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function eHe(n,e){const i=lZ(n),o=lZ(e),l=+i-uZ(i),u=+o-uZ(o);return Math.round((l-u)/QGe)}function tHe(n){const e=zae(n),i=aE(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),LN(i)}function nHe(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function rHe(n){if(!nHe(n)&&typeof n!="number")return!1;const e=dh(n);return!isNaN(Number(e))}function iHe(n){const e=dh(n),i=aE(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const sHe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},oHe=(n,e,i)=>{let o;const l=sHe[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function QU(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const aHe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},cHe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},lHe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},uHe={date:QU({formats:aHe,defaultWidth:"full"}),time:QU({formats:cHe,defaultWidth:"full"}),dateTime:QU({formats:lHe,defaultWidth:"full"})},dHe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},hHe=(n,e,i,o)=>dHe[n];function Gw(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const f=n.defaultFormattingWidth||n.defaultWidth,_=i!=null&&i.width?String(i.width):f;l=n.formattingValues[_]||n.formattingValues[f]}else{const f=n.defaultWidth,_=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[_]||n.values[f]}const u=n.argumentCallback?n.argumentCallback(e):e;return l[u]}}const pHe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},fHe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},mHe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},gHe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},_He={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},yHe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},EHe=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},vHe={ordinalNumber:EHe,era:Gw({values:pHe,defaultWidth:"wide"}),quarter:Gw({values:fHe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Gw({values:mHe,defaultWidth:"wide"}),day:Gw({values:gHe,defaultWidth:"wide"}),dayPeriod:Gw({values:_He,defaultWidth:"wide",formattingValues:yHe,defaultFormattingWidth:"wide"})};function Hw(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],u=e.match(l);if(!u)return null;const f=u[0],_=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],E=Array.isArray(_)?bHe(_,I=>I.test(f)):SHe(_,I=>I.test(f));let S;S=n.valueCallback?n.valueCallback(E):E,S=i.valueCallback?i.valueCallback(S):S;const C=e.slice(f.length);return{value:S,rest:C}}}function SHe(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function bHe(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function THe(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],u=e.match(n.parsePattern);if(!u)return null;let f=n.valueCallback?n.valueCallback(u[0]):u[0];f=i.valueCallback?i.valueCallback(f):f;const _=e.slice(l.length);return{value:f,rest:_}}}const wHe=/^(\d+)(th|st|nd|rd)?/i,CHe=/\d+/i,RHe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},IHe={any:[/^b/i,/^(a|c)/i]},AHe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},PHe={any:[/1/i,/2/i,/3/i,/4/i]},OHe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},kHe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},NHe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},DHe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},xHe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},LHe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},MHe={ordinalNumber:THe({matchPattern:wHe,parsePattern:CHe,valueCallback:n=>parseInt(n,10)}),era:Hw({matchPatterns:RHe,defaultMatchWidth:"wide",parsePatterns:IHe,defaultParseWidth:"any"}),quarter:Hw({matchPatterns:AHe,defaultMatchWidth:"wide",parsePatterns:PHe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Hw({matchPatterns:OHe,defaultMatchWidth:"wide",parsePatterns:kHe,defaultParseWidth:"any"}),day:Hw({matchPatterns:NHe,defaultMatchWidth:"wide",parsePatterns:DHe,defaultParseWidth:"any"}),dayPeriod:Hw({matchPatterns:xHe,defaultMatchWidth:"any",parsePatterns:LHe,defaultParseWidth:"any"})},UHe={code:"en-US",formatDistance:oHe,formatLong:uHe,formatRelative:hHe,localize:vHe,match:MHe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function VHe(n){const e=dh(n);return eHe(e,iHe(e))+1}function jHe(n){const e=dh(n),i=+LN(e)-+tHe(e);return Math.round(i/Wae)+1}function Gae(n,e){var C,I,O,M;const i=dh(n),o=i.getFullYear(),l=Q1(),u=(e==null?void 0:e.firstWeekContainsDate)??((I=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??l.firstWeekContainsDate??((M=(O=l.locale)==null?void 0:O.options)==null?void 0:M.firstWeekContainsDate)??1,f=aE(n,0);f.setFullYear(o+1,0,u),f.setHours(0,0,0,0);const _=cR(f,e),E=aE(n,0);E.setFullYear(o,0,u),E.setHours(0,0,0,0);const S=cR(E,e);return i.getTime()>=_.getTime()?o+1:i.getTime()>=S.getTime()?o:o-1}function FHe(n,e){var _,E,S,C;const i=Q1(),o=(e==null?void 0:e.firstWeekContainsDate)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.firstWeekContainsDate)??i.firstWeekContainsDate??((C=(S=i.locale)==null?void 0:S.options)==null?void 0:C.firstWeekContainsDate)??1,l=Gae(n,e),u=aE(n,0);return u.setFullYear(l,0,o),u.setHours(0,0,0,0),cR(u,e)}function BHe(n,e){const i=dh(n),o=+cR(i,e)-+FHe(i,e);return Math.round(o/Wae)+1}function Ri(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const Sg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return Ri(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ri(i+1,2)},d(n,e){return Ri(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ri(n.getHours()%12||12,e.length)},H(n,e){return Ri(n.getHours(),e.length)},m(n,e){return Ri(n.getMinutes(),e.length)},s(n,e){return Ri(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return Ri(l,e.length)}},FS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},dZ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return Sg.y(n,e)},Y:function(n,e,i,o){const l=Gae(n,o),u=l>0?l:1-l;if(e==="YY"){const f=u%100;return Ri(f,2)}return e==="Yo"?i.ordinalNumber(u,{unit:"year"}):Ri(u,e.length)},R:function(n,e){const i=zae(n);return Ri(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ri(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return Ri(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return Ri(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return Sg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return Ri(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=BHe(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ri(l,e.length)},I:function(n,e,i){const o=jHe(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):Ri(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):Sg.d(n,e)},D:function(n,e,i){const o=VHe(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):Ri(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(u);case"ee":return Ri(u,2);case"eo":return i.ordinalNumber(u,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(u);case"cc":return Ri(u,e.length);case"co":return i.ordinalNumber(u,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return Ri(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=FS.noon:o===0?l=FS.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=FS.evening:o>=12?l=FS.afternoon:o>=4?l=FS.morning:l=FS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return Sg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):Sg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):Ri(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):Ri(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):Sg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):Sg.s(n,e)},S:function(n,e){return Sg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return pZ(o);case"XXXX":case"XX":return Oy(o);case"XXXXX":case"XXX":default:return Oy(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return pZ(o);case"xxxx":case"xx":return Oy(o);case"xxxxx":case"xxx":default:return Oy(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+hZ(o,":");case"OOOO":default:return"GMT"+Oy(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+hZ(o,":");case"zzzz":default:return"GMT"+Oy(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return Ri(o,e.length)},T:function(n,e,i){const o=n.getTime();return Ri(o,e.length)}};function hZ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),u=o%60;return u===0?i+String(l):i+String(l)+e+Ri(u,2)}function pZ(n,e){return n%60===0?(n>0?"-":"+")+Ri(Math.abs(n)/60,2):Oy(n,e)}function Oy(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Ri(Math.trunc(o/60),2),u=Ri(o%60,2);return i+l+e+u}const fZ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Hae=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},WHe=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return fZ(n,e);let u;switch(o){case"P":u=e.dateTime({width:"short"});break;case"PP":u=e.dateTime({width:"medium"});break;case"PPP":u=e.dateTime({width:"long"});break;case"PPPP":default:u=e.dateTime({width:"full"});break}return u.replace("{{date}}",fZ(o,e)).replace("{{time}}",Hae(l,e))},zHe={p:Hae,P:WHe},GHe=/^D+$/,HHe=/^Y+$/,$He=["D","DD","YY","YYYY"];function KHe(n){return GHe.test(n)}function qHe(n){return HHe.test(n)}function YHe(n,e,i){const o=XHe(n,e,i);if(console.warn(o),$He.includes(n))throw new RangeError(o)}function XHe(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const JHe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,QHe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ZHe=/^'([^]*?)'?$/,e9e=/''/g,t9e=/[a-zA-Z]/;function n9e(n,e,i){var C,I,O,M;const o=Q1(),l=o.locale??UHe,u=o.firstWeekContainsDate??((I=(C=o.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??1,f=o.weekStartsOn??((M=(O=o.locale)==null?void 0:O.options)==null?void 0:M.weekStartsOn)??0,_=dh(n);if(!rHe(_))throw new RangeError("Invalid time value");let E=e.match(QHe).map(L=>{const U=L[0];if(U==="p"||U==="P"){const B=zHe[U];return B(L,l.formatLong)}return L}).join("").match(JHe).map(L=>{if(L==="''")return{isToken:!1,value:"'"};const U=L[0];if(U==="'")return{isToken:!1,value:r9e(L)};if(dZ[U])return{isToken:!0,value:L};if(U.match(t9e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+U+"`");return{isToken:!1,value:L}});l.localize.preprocessor&&(E=l.localize.preprocessor(_,E));const S={firstWeekContainsDate:u,weekStartsOn:f,locale:l};return E.map(L=>{if(!L.isToken)return L.value;const U=L.value;(qHe(U)||KHe(U))&&YHe(U,e,String(n));const B=dZ[U[0]];return B(_,U,l.localize,S)}).join("")}function r9e(n){const e=n.match(ZHe);return e?e[1].replace(e9e,"'"):n}const i9e=Pp(lt),$ae=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:o});const l=e&&e.toDate?n9e(e.toDate(),"HH:mm"):"Invalid date";return b.jsxs(i9e,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[b.jsxs(lt,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[b.jsx(Ze,{fontWeight:"bold",children:n}),b.jsx(Ze,{children:i})]}),b.jsx(Ze,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};$ae.propTypes={name:En.string.isRequired,timestamp:En.object,text:En.string.isRequired,isCurrentUser:En.bool.isRequired};const s9e=({spaceID:n})=>{const[e,i]=k.useState([]),{user:o}=k.useContext(us),l=k.useRef(null);return k.useEffect(()=>{const u=JGe(n,f=>{console.log("New messages received:",f),i(_=>[..._,...f]),$.log("Messages updated:",f)});return()=>u()},[n]),k.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),b.jsxs(lt,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(u=>{const f=u.uid===(o==null?void 0:o.uid);return b.jsx($ae,{name:u.user,timestamp:u.timestamp,text:u.text,isCurrentUser:f},u.id)}),b.jsx("div",{ref:l})]})},o9e=({spaceID:n})=>{},Kae=({spaceID:n})=>{const{user:e}=k.useContext(us);return e?b.jsxs(lt,{children:[b.jsx(lt,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:b.jsx(s9e,{spaceID:n})}),b.jsx(lt,{mt:"8px",children:b.jsx(o9e,{spaceID:n})})]}):(console.log("No user found, returning login message"),b.jsx(lt,{children:b.jsx(Ze,{children:"Please log in to view the chat."})}))},sk=document.getElementById("chat-root");if(sk){const n=sk.getAttribute("data-space-id"),e=sk.getAttribute("data-theme")||"default",i=()=>{const[o,l]=k.useState(null);return k.useEffect(()=>{JC(e).then(l)},[]),o?b.jsx(n1,{theme:o,children:b.jsx($1,{children:b.jsx(Kae,{spaceID:n})})}):b.jsx("div",{children:"Loading theme..."})};MN.createRoot(sk).render(b.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class a9e extends k.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?b.jsx(lt,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:b.jsx(Ze,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const ok=document.getElementById("root");if(ok){const n=ok.getAttribute("data-space-id"),e=ok.getAttribute("data-theme")||"default",i=()=>{const[o,l]=k.useState(null);return k.useEffect(()=>{JC(e).then(l);const u=()=>{document.hidden||JC(e).then(l)};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]),o?b.jsx(n1,{theme:o,children:b.jsx($1,{children:b.jsx(k3,{children:b.jsxs(Mr,{spacing:4,align:"stretch",children:[b.jsxs(Ur,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[b.jsx(Ze,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),b.jsx(lt,{zIndex:"100",position:"relative",children:b.jsx(pae,{})})]}),b.jsx(LV,{maxW:"container.xl",p:0,zIndex:"1",children:b.jsx(Ene,{ratio:16/9,bg:"blue.100",m:0,children:b.jsx(lt,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:b.jsx(a9e,{children:b.jsx(B3,{spaceID:n})})})})}),b.jsx(LV,{maxW:"container.xl",p:0,children:b.jsx(Kae,{spaceID:n})})]})})})}):b.jsx("div",{children:"Loading theme..."})};MN.createRoot(ok).render(b.jsx(i,{}))}else console.error("Root element 'root' not found.");export{YEe as a,S0e as b,Yi as c,y0e as d,l9e as e,c9e as f,u0e as g,nd as i,pp as m,EIe as t};
