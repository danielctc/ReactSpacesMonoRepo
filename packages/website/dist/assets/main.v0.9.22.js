var gEe=Object.defineProperty;var _Ee=(n,e,i)=>e in n?gEe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var vf=(n,e,i)=>_Ee(n,typeof e!="symbol"?e+"":e,i);function yEe(n,e){for(var i=0;i<e.length;i++){const a=e[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Iy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fM={exports:{}},_w={},mM={exports:{}},vr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CK;function EEe(){if(CK)return vr;CK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),I=Symbol.iterator;function k(ke){return ke===null||typeof ke!="object"?null:(ke=I&&ke[I]||ke["@@iterator"],typeof ke=="function"?ke:null)}var V={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,F={};function B(ke,Re,he){this.props=ke,this.context=Re,this.refs=F,this.updater=he||V}B.prototype.isReactComponent={},B.prototype.setState=function(ke,Re){if(typeof ke!="object"&&typeof ke!="function"&&ke!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ke,Re,"setState")},B.prototype.forceUpdate=function(ke){this.updater.enqueueForceUpdate(this,ke,"forceUpdate")};function q(){}q.prototype=B.prototype;function $(ke,Re,he){this.props=ke,this.context=Re,this.refs=F,this.updater=he||V}var Q=$.prototype=new q;Q.constructor=$,L(Q,B.prototype),Q.isPureReactComponent=!0;var ae=Array.isArray,re=Object.prototype.hasOwnProperty,fe={current:null},Z={key:!0,ref:!0,__self:!0,__source:!0};function ee(ke,Re,he){var we,Ue={},Fe=null,$e=null;if(Re!=null)for(we in Re.ref!==void 0&&($e=Re.ref),Re.key!==void 0&&(Fe=""+Re.key),Re)re.call(Re,we)&&!Z.hasOwnProperty(we)&&(Ue[we]=Re[we]);var ct=arguments.length-2;if(ct===1)Ue.children=he;else if(1<ct){for(var it=Array(ct),Ct=0;Ct<ct;Ct++)it[Ct]=arguments[Ct+2];Ue.children=it}if(ke&&ke.defaultProps)for(we in ct=ke.defaultProps,ct)Ue[we]===void 0&&(Ue[we]=ct[we]);return{$$typeof:n,type:ke,key:Fe,ref:$e,props:Ue,_owner:fe.current}}function ne(ke,Re){return{$$typeof:n,type:ke.type,key:Re,ref:ke.ref,props:ke.props,_owner:ke._owner}}function oe(ke){return typeof ke=="object"&&ke!==null&&ke.$$typeof===n}function ge(ke){var Re={"=":"=0",":":"=2"};return"$"+ke.replace(/[=:]/g,function(he){return Re[he]})}var pe=/\/+/g;function le(ke,Re){return typeof ke=="object"&&ke!==null&&ke.key!=null?ge(""+ke.key):Re.toString(36)}function Me(ke,Re,he,we,Ue){var Fe=typeof ke;(Fe==="undefined"||Fe==="boolean")&&(ke=null);var $e=!1;if(ke===null)$e=!0;else switch(Fe){case"string":case"number":$e=!0;break;case"object":switch(ke.$$typeof){case n:case e:$e=!0}}if($e)return $e=ke,Ue=Ue($e),ke=we===""?"."+le($e,0):we,ae(Ue)?(he="",ke!=null&&(he=ke.replace(pe,"$&/")+"/"),Me(Ue,Re,he,"",function(Ct){return Ct})):Ue!=null&&(oe(Ue)&&(Ue=ne(Ue,he+(!Ue.key||$e&&$e.key===Ue.key?"":(""+Ue.key).replace(pe,"$&/")+"/")+ke)),Re.push(Ue)),1;if($e=0,we=we===""?".":we+":",ae(ke))for(var ct=0;ct<ke.length;ct++){Fe=ke[ct];var it=we+le(Fe,ct);$e+=Me(Fe,Re,he,it,Ue)}else if(it=k(ke),typeof it=="function")for(ke=it.call(ke),ct=0;!(Fe=ke.next()).done;)Fe=Fe.value,it=we+le(Fe,ct++),$e+=Me(Fe,Re,he,it,Ue);else if(Fe==="object")throw Re=String(ke),Error("Objects are not valid as a React child (found: "+(Re==="[object Object]"?"object with keys {"+Object.keys(ke).join(", ")+"}":Re)+"). If you meant to render a collection of children, use an array instead.");return $e}function He(ke,Re,he){if(ke==null)return ke;var we=[],Ue=0;return Me(ke,we,"","",function(Fe){return Re.call(he,Fe,Ue++)}),we}function tt(ke){if(ke._status===-1){var Re=ke._result;Re=Re(),Re.then(function(he){(ke._status===0||ke._status===-1)&&(ke._status=1,ke._result=he)},function(he){(ke._status===0||ke._status===-1)&&(ke._status=2,ke._result=he)}),ke._status===-1&&(ke._status=0,ke._result=Re)}if(ke._status===1)return ke._result.default;throw ke._result}var Ee={current:null},Ie={transition:null},ve={ReactCurrentDispatcher:Ee,ReactCurrentBatchConfig:Ie,ReactCurrentOwner:fe};function Be(){throw Error("act(...) is not supported in production builds of React.")}return vr.Children={map:He,forEach:function(ke,Re,he){He(ke,function(){Re.apply(this,arguments)},he)},count:function(ke){var Re=0;return He(ke,function(){Re++}),Re},toArray:function(ke){return He(ke,function(Re){return Re})||[]},only:function(ke){if(!oe(ke))throw Error("React.Children.only expected to receive a single React element child.");return ke}},vr.Component=B,vr.Fragment=i,vr.Profiler=l,vr.PureComponent=$,vr.StrictMode=a,vr.Suspense=E,vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ve,vr.act=Be,vr.cloneElement=function(ke,Re,he){if(ke==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+ke+".");var we=L({},ke.props),Ue=ke.key,Fe=ke.ref,$e=ke._owner;if(Re!=null){if(Re.ref!==void 0&&(Fe=Re.ref,$e=fe.current),Re.key!==void 0&&(Ue=""+Re.key),ke.type&&ke.type.defaultProps)var ct=ke.type.defaultProps;for(it in Re)re.call(Re,it)&&!Z.hasOwnProperty(it)&&(we[it]=Re[it]===void 0&&ct!==void 0?ct[it]:Re[it])}var it=arguments.length-2;if(it===1)we.children=he;else if(1<it){ct=Array(it);for(var Ct=0;Ct<it;Ct++)ct[Ct]=arguments[Ct+2];we.children=ct}return{$$typeof:n,type:ke.type,key:Ue,ref:Fe,props:we,_owner:$e}},vr.createContext=function(ke){return ke={$$typeof:f,_currentValue:ke,_currentValue2:ke,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},ke.Provider={$$typeof:d,_context:ke},ke.Consumer=ke},vr.createElement=ee,vr.createFactory=function(ke){var Re=ee.bind(null,ke);return Re.type=ke,Re},vr.createRef=function(){return{current:null}},vr.forwardRef=function(ke){return{$$typeof:_,render:ke}},vr.isValidElement=oe,vr.lazy=function(ke){return{$$typeof:w,_payload:{_status:-1,_result:ke},_init:tt}},vr.memo=function(ke,Re){return{$$typeof:b,type:ke,compare:Re===void 0?null:Re}},vr.startTransition=function(ke){var Re=Ie.transition;Ie.transition={};try{ke()}finally{Ie.transition=Re}},vr.unstable_act=Be,vr.useCallback=function(ke,Re){return Ee.current.useCallback(ke,Re)},vr.useContext=function(ke){return Ee.current.useContext(ke)},vr.useDebugValue=function(){},vr.useDeferredValue=function(ke){return Ee.current.useDeferredValue(ke)},vr.useEffect=function(ke,Re){return Ee.current.useEffect(ke,Re)},vr.useId=function(){return Ee.current.useId()},vr.useImperativeHandle=function(ke,Re,he){return Ee.current.useImperativeHandle(ke,Re,he)},vr.useInsertionEffect=function(ke,Re){return Ee.current.useInsertionEffect(ke,Re)},vr.useLayoutEffect=function(ke,Re){return Ee.current.useLayoutEffect(ke,Re)},vr.useMemo=function(ke,Re){return Ee.current.useMemo(ke,Re)},vr.useReducer=function(ke,Re,he){return Ee.current.useReducer(ke,Re,he)},vr.useRef=function(ke){return Ee.current.useRef(ke)},vr.useState=function(ke){return Ee.current.useState(ke)},vr.useSyncExternalStore=function(ke,Re,he){return Ee.current.useSyncExternalStore(ke,Re,he)},vr.useTransition=function(){return Ee.current.useTransition()},vr.version="18.3.1",vr}var RK;function zu(){return RK||(RK=1,mM.exports=EEe()),mM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IK;function vEe(){if(IK)return _w;IK=1;var n=zu(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(_,E,b){var w,I={},k=null,V=null;b!==void 0&&(k=""+b),E.key!==void 0&&(k=""+E.key),E.ref!==void 0&&(V=E.ref);for(w in E)a.call(E,w)&&!d.hasOwnProperty(w)&&(I[w]=E[w]);if(_&&_.defaultProps)for(w in E=_.defaultProps,E)I[w]===void 0&&(I[w]=E[w]);return{$$typeof:e,type:_,key:k,ref:V,props:I,_owner:l.current}}return _w.Fragment=i,_w.jsx=f,_w.jsxs=f,_w}var AK;function SEe(){return AK||(AK=1,fM.exports=vEe()),fM.exports}var S=SEe(),D=zu();const _r=Xf(D),XU=yEe({__proto__:null,default:_r},[D]);var R1={},gM={exports:{}},Yc={},_M={exports:{}},yM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PK;function bEe(){return PK||(PK=1,function(n){function e(Ie,ve){var Be=Ie.length;Ie.push(ve);e:for(;0<Be;){var ke=Be-1>>>1,Re=Ie[ke];if(0<l(Re,ve))Ie[ke]=ve,Ie[Be]=Re,Be=ke;else break e}}function i(Ie){return Ie.length===0?null:Ie[0]}function a(Ie){if(Ie.length===0)return null;var ve=Ie[0],Be=Ie.pop();if(Be!==ve){Ie[0]=Be;e:for(var ke=0,Re=Ie.length,he=Re>>>1;ke<he;){var we=2*(ke+1)-1,Ue=Ie[we],Fe=we+1,$e=Ie[Fe];if(0>l(Ue,Be))Fe<Re&&0>l($e,Ue)?(Ie[ke]=$e,Ie[Fe]=Be,ke=Fe):(Ie[ke]=Ue,Ie[we]=Be,ke=we);else if(Fe<Re&&0>l($e,Be))Ie[ke]=$e,Ie[Fe]=Be,ke=Fe;else break e}}return ve}function l(Ie,ve){var Be=Ie.sortIndex-ve.sortIndex;return Be!==0?Be:Ie.id-ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,_=f.now();n.unstable_now=function(){return f.now()-_}}var E=[],b=[],w=1,I=null,k=3,V=!1,L=!1,F=!1,B=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(Ie){for(var ve=i(b);ve!==null;){if(ve.callback===null)a(b);else if(ve.startTime<=Ie)a(b),ve.sortIndex=ve.expirationTime,e(E,ve);else break;ve=i(b)}}function ae(Ie){if(F=!1,Q(Ie),!L)if(i(E)!==null)L=!0,tt(re);else{var ve=i(b);ve!==null&&Ee(ae,ve.startTime-Ie)}}function re(Ie,ve){L=!1,F&&(F=!1,q(ee),ee=-1),V=!0;var Be=k;try{for(Q(ve),I=i(E);I!==null&&(!(I.expirationTime>ve)||Ie&&!ge());){var ke=I.callback;if(typeof ke=="function"){I.callback=null,k=I.priorityLevel;var Re=ke(I.expirationTime<=ve);ve=n.unstable_now(),typeof Re=="function"?I.callback=Re:I===i(E)&&a(E),Q(ve)}else a(E);I=i(E)}if(I!==null)var he=!0;else{var we=i(b);we!==null&&Ee(ae,we.startTime-ve),he=!1}return he}finally{I=null,k=Be,V=!1}}var fe=!1,Z=null,ee=-1,ne=5,oe=-1;function ge(){return!(n.unstable_now()-oe<ne)}function pe(){if(Z!==null){var Ie=n.unstable_now();oe=Ie;var ve=!0;try{ve=Z(!0,Ie)}finally{ve?le():(fe=!1,Z=null)}}else fe=!1}var le;if(typeof $=="function")le=function(){$(pe)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=pe,le=function(){He.postMessage(null)}}else le=function(){B(pe,0)};function tt(Ie){Z=Ie,fe||(fe=!0,le())}function Ee(Ie,ve){ee=B(function(){Ie(n.unstable_now())},ve)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ie){Ie.callback=null},n.unstable_continueExecution=function(){L||V||(L=!0,tt(re))},n.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<Ie?Math.floor(1e3/Ie):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(Ie){switch(k){case 1:case 2:case 3:var ve=3;break;default:ve=k}var Be=k;k=ve;try{return Ie()}finally{k=Be}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ie,ve){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var Be=k;k=Ie;try{return ve()}finally{k=Be}},n.unstable_scheduleCallback=function(Ie,ve,Be){var ke=n.unstable_now();switch(typeof Be=="object"&&Be!==null?(Be=Be.delay,Be=typeof Be=="number"&&0<Be?ke+Be:ke):Be=ke,Ie){case 1:var Re=-1;break;case 2:Re=250;break;case 5:Re=1073741823;break;case 4:Re=1e4;break;default:Re=5e3}return Re=Be+Re,Ie={id:w++,callback:ve,priorityLevel:Ie,startTime:Be,expirationTime:Re,sortIndex:-1},Be>ke?(Ie.sortIndex=Be,e(b,Ie),i(E)===null&&Ie===i(b)&&(F?(q(ee),ee=-1):F=!0,Ee(ae,Be-ke))):(Ie.sortIndex=Re,e(E,Ie),L||V||(L=!0,tt(re))),Ie},n.unstable_shouldYield=ge,n.unstable_wrapCallback=function(Ie){var ve=k;return function(){var Be=k;k=ve;try{return Ie.apply(this,arguments)}finally{k=Be}}}}(yM)),yM}var OK;function TEe(){return OK||(OK=1,_M.exports=bEe()),_M.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kK;function wEe(){if(kK)return Yc;kK=1;var n=zu(),e=TEe();function i(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,C=1;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},I={};function k(p){return E.call(I,p)?!0:E.call(w,p)?!1:b.test(p)?I[p]=!0:(w[p]=!0,!1)}function V(p,g,C,O){if(C!==null&&C.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:C!==null?!C.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function L(p,g,C,O){if(g===null||typeof g>"u"||V(p,g,C,O))return!0;if(O)return!1;if(C!==null)switch(C.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function F(p,g,C,O,U,H,ce){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=U,this.mustUseProperty=C,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ce}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new F(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];B[g]=new F(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new F(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new F(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new F(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new F(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new F(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new F(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new F(p,5,!1,p.toLowerCase(),null,!1,!1)});var q=/[\-:]([a-z])/g;function $(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(q,$);B[g]=new F(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(q,$);B[g]=new F(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(q,$);B[g]=new F(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new F(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new F(p,1,!1,p.toLowerCase(),null,!0,!0)});function Q(p,g,C,O){var U=B.hasOwnProperty(g)?B[g]:null;(U!==null?U.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(L(g,C,U,O)&&(C=null),O||U===null?k(g)&&(C===null?p.removeAttribute(g):p.setAttribute(g,""+C)):U.mustUseProperty?p[U.propertyName]=C===null?U.type===3?!1:"":C:(g=U.attributeName,O=U.attributeNamespace,C===null?p.removeAttribute(g):(U=U.type,C=U===3||U===4&&C===!0?"":""+C,O?p.setAttributeNS(O,g,C):p.setAttribute(g,C))))}var ae=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,re=Symbol.for("react.element"),fe=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),ee=Symbol.for("react.strict_mode"),ne=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),ge=Symbol.for("react.context"),pe=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),Ee=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function ve(p){return p===null||typeof p!="object"?null:(p=Ie&&p[Ie]||p["@@iterator"],typeof p=="function"?p:null)}var Be=Object.assign,ke;function Re(p){if(ke===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);ke=g&&g[1]||""}return`
`+ke+p}var he=!1;function we(p,g){if(!p||he)return"";he=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(st){var O=st}Reflect.construct(p,[],g)}else{try{g.call()}catch(st){O=st}p.call(g.prototype)}else{try{throw Error()}catch(st){O=st}p()}}catch(st){if(st&&O&&typeof st.stack=="string"){for(var U=st.stack.split(`
`),H=O.stack.split(`
`),ce=U.length-1,Ae=H.length-1;1<=ce&&0<=Ae&&U[ce]!==H[Ae];)Ae--;for(;1<=ce&&0<=Ae;ce--,Ae--)if(U[ce]!==H[Ae]){if(ce!==1||Ae!==1)do if(ce--,Ae--,0>Ae||U[ce]!==H[Ae]){var Le=`
`+U[ce].replace(" at new "," at ");return p.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",p.displayName)),Le}while(1<=ce&&0<=Ae);break}}}finally{he=!1,Error.prepareStackTrace=C}return(p=p?p.displayName||p.name:"")?Re(p):""}function Ue(p){switch(p.tag){case 5:return Re(p.type);case 16:return Re("Lazy");case 13:return Re("Suspense");case 19:return Re("SuspenseList");case 0:case 2:case 15:return p=we(p.type,!1),p;case 11:return p=we(p.type.render,!1),p;case 1:return p=we(p.type,!0),p;default:return""}}function Fe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Z:return"Fragment";case fe:return"Portal";case ne:return"Profiler";case ee:return"StrictMode";case le:return"Suspense";case Me:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case ge:return(p.displayName||"Context")+".Consumer";case oe:return(p._context.displayName||"Context")+".Provider";case pe:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case He:return g=p.displayName||null,g!==null?g:Fe(p.type)||"Memo";case tt:g=p._payload,p=p._init;try{return Fe(p(g))}catch{}}return null}function $e(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fe(g);case 8:return g===ee?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ct(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function it(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ct(p){var g=it(p)?"checked":"value",C=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var U=C.get,H=C.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return U.call(this)},set:function(ce){O=""+ce,H.call(this,ce)}}),Object.defineProperty(p,g,{enumerable:C.enumerable}),{getValue:function(){return O},setValue:function(ce){O=""+ce},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function Vt(p){p._valueTracker||(p._valueTracker=Ct(p))}function Dt(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var C=g.getValue(),O="";return p&&(O=it(p)?p.checked?"true":"false":p.value),p=O,p!==C?(g.setValue(p),!0):!1}function an(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function jn(p,g){var C=g.checked;return Be({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??p._wrapperState.initialChecked})}function Qt(p,g){var C=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;C=ct(g.value!=null?g.value:C),p._wrapperState={initialChecked:O,initialValue:C,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Ot(p,g){g=g.checked,g!=null&&Q(p,"checked",g,!1)}function Lt(p,g){Ot(p,g);var C=ct(g.value),O=g.type;if(C!=null)O==="number"?(C===0&&p.value===""||p.value!=C)&&(p.value=""+C):p.value!==""+C&&(p.value=""+C);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Ve(p,g.type,C):g.hasOwnProperty("defaultValue")&&Ve(p,g.type,ct(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Ce(p,g,C){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,C||g===p.value||(p.value=g),p.defaultValue=g}C=p.name,C!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,C!==""&&(p.name=C)}function Ve(p,g,C){(g!=="number"||an(p.ownerDocument)!==p)&&(C==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+C&&(p.defaultValue=""+C))}var Ye=Array.isArray;function _t(p,g,C,O){if(p=p.options,g){g={};for(var U=0;U<C.length;U++)g["$"+C[U]]=!0;for(C=0;C<p.length;C++)U=g.hasOwnProperty("$"+p[C].value),p[C].selected!==U&&(p[C].selected=U),U&&O&&(p[C].defaultSelected=!0)}else{for(C=""+ct(C),g=null,U=0;U<p.length;U++){if(p[U].value===C){p[U].selected=!0,O&&(p[U].defaultSelected=!0);return}g!==null||p[U].disabled||(g=p[U])}g!==null&&(g.selected=!0)}}function vt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return Be({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function St(p,g){var C=g.value;if(C==null){if(C=g.children,g=g.defaultValue,C!=null){if(g!=null)throw Error(i(92));if(Ye(C)){if(1<C.length)throw Error(i(93));C=C[0]}g=C}g==null&&(g=""),C=g}p._wrapperState={initialValue:ct(C)}}function Ht(p,g){var C=ct(g.value),O=ct(g.defaultValue);C!=null&&(C=""+C,C!==p.value&&(p.value=C),g.defaultValue==null&&p.defaultValue!==C&&(p.defaultValue=C)),O!=null&&(p.defaultValue=""+O)}function fn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function mn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jt(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?mn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Hn,mc=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,C,O,U){MSApp.execUnsafeLocalFunction(function(){return p(g,C,O,U)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Hn=Hn||document.createElement("div"),Hn.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Hn.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Bt(p,g){if(g){var C=p.firstChild;if(C&&C===p.lastChild&&C.nodeType===3){C.nodeValue=g;return}}p.textContent=g}var un={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rs=["Webkit","ms","Moz","O"];Object.keys(un).forEach(function(p){rs.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),un[g]=un[p]})});function Fs(p,g,C){return g==null||typeof g=="boolean"||g===""?"":C||typeof g!="number"||g===0||un.hasOwnProperty(p)&&un[p]?(""+g).trim():g+"px"}function Qs(p,g){p=p.style;for(var C in g)if(g.hasOwnProperty(C)){var O=C.indexOf("--")===0,U=Fs(C,g[C],O);C==="float"&&(C="cssFloat"),O?p.setProperty(C,U):p[C]=U}}var Ei=Be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $a(p,g){if(g){if(Ei[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function dl(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _o=null;function yo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var ql=null,Bs=null,gc=null;function ua(p){if(p=gm(p)){if(typeof ql!="function")throw Error(i(280));var g=p.stateNode;g&&(g=_m(g),ql(p.stateNode,p.type,g))}}function _c(p){Bs?gc?gc.push(p):gc=[p]:Bs=p}function hl(){if(Bs){var p=Bs,g=gc;if(gc=Bs=null,ua(p),g)for(p=0;p<g.length;p++)ua(g[p])}}function qu(p,g){return p(g)}function yc(){}var pl=!1;function Do(p,g,C){if(pl)return p(g,C);pl=!0;try{return qu(p,g,C)}finally{pl=!1,(Bs!==null||gc!==null)&&(yc(),hl())}}function Mi(p,g){var C=p.stateNode;if(C===null)return null;var O=_m(C);if(O===null)return null;C=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(C&&typeof C!="function")throw Error(i(231,g,typeof C));return C}var ds=!1;if(_)try{var Ka={};Object.defineProperty(Ka,"passive",{get:function(){ds=!0}}),window.addEventListener("test",Ka,Ka),window.removeEventListener("test",Ka,Ka)}catch{ds=!1}function Yu(p,g,C,O,U,H,ce,Ae,Le){var st=Array.prototype.slice.call(arguments,3);try{g.apply(C,st)}catch(At){this.onError(At)}}var Ec=!1,da=null,ha=!1,Qd=null,Qg={onError:function(p){Ec=!0,da=p}};function Xu(p,g,C,O,U,H,ce,Ae,Le){Ec=!1,da=null,Yu.apply(Qg,arguments)}function Tp(p,g,C,O,U,H,ce,Ae,Le){if(Xu.apply(this,arguments),Ec){if(Ec){var st=da;Ec=!1,da=null}else throw Error(i(198));ha||(ha=!0,Qd=st)}}function Ws(p){var g=p,C=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(C=g.return),p=g.return;while(p)}return g.tag===3?C:null}function Ju(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function pa(p){if(Ws(p)!==p)throw Error(i(188))}function Zd(p){var g=p.alternate;if(!g){if(g=Ws(p),g===null)throw Error(i(188));return g!==p?null:p}for(var C=p,O=g;;){var U=C.return;if(U===null)break;var H=U.alternate;if(H===null){if(O=U.return,O!==null){C=O;continue}break}if(U.child===H.child){for(H=U.child;H;){if(H===C)return pa(U),p;if(H===O)return pa(U),g;H=H.sibling}throw Error(i(188))}if(C.return!==O.return)C=U,O=H;else{for(var ce=!1,Ae=U.child;Ae;){if(Ae===C){ce=!0,C=U,O=H;break}if(Ae===O){ce=!0,O=U,C=H;break}Ae=Ae.sibling}if(!ce){for(Ae=H.child;Ae;){if(Ae===C){ce=!0,C=H,O=U;break}if(Ae===O){ce=!0,O=H,C=U;break}Ae=Ae.sibling}if(!ce)throw Error(i(189))}}if(C.alternate!==O)throw Error(i(190))}if(C.tag!==3)throw Error(i(188));return C.stateNode.current===C?p:g}function eh(p){return p=Zd(p),p!==null?qa(p):null}function qa(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=qa(p);if(g!==null)return g;p=p.sibling}return null}var th=e.unstable_scheduleCallback,Qu=e.unstable_cancelCallback,xo=e.unstable_shouldYield,nh=e.unstable_requestPaint,$r=e.unstable_now,vi=e.unstable_getCurrentPriorityLevel,vc=e.unstable_ImmediatePriority,fl=e.unstable_UserBlockingPriority,fa=e.unstable_NormalPriority,wp=e.unstable_LowPriority,rh=e.unstable_IdlePriority,Yl=null,Eo=null;function tm(p){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(Yl,p,void 0,(p.current.flags&128)===128)}catch{}}var Zs=Math.clz32?Math.clz32:ih,Cp=Math.log,ml=Math.LN2;function ih(p){return p>>>=0,p===0?32:31-(Cp(p)/ml|0)|0}var sh=64,yr=4194304;function Xl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Jl(p,g){var C=p.pendingLanes;if(C===0)return 0;var O=0,U=p.suspendedLanes,H=p.pingedLanes,ce=C&268435455;if(ce!==0){var Ae=ce&~U;Ae!==0?O=Xl(Ae):(H&=ce,H!==0&&(O=Xl(H)))}else ce=C&~U,ce!==0?O=Xl(ce):H!==0&&(O=Xl(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&U)===0&&(U=O&-O,H=g&-g,U>=H||U===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=C&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)C=31-Zs(g),U=1<<C,O|=p[C],g&=~U;return O}function Zu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ya(p,g){for(var C=p.suspendedLanes,O=p.pingedLanes,U=p.expirationTimes,H=p.pendingLanes;0<H;){var ce=31-Zs(H),Ae=1<<ce,Le=U[ce];Le===-1?((Ae&C)===0||(Ae&O)!==0)&&(U[ce]=Zu(Ae,g)):Le<=g&&(p.expiredLanes|=Ae),H&=~Ae}}function Lo(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function ed(){var p=sh;return sh<<=1,(sh&4194240)===0&&(sh=64),p}function gl(p){for(var g=[],C=0;31>C;C++)g.push(p);return g}function Ql(p,g,C){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-Zs(g),p[g]=C}function Xr(p,g){var C=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<C;){var U=31-Zs(C),H=1<<U;g[U]=0,O[U]=-1,p[U]=-1,C&=~H}}function Xa(p,g){var C=p.entangledLanes|=g;for(p=p.entanglements;C;){var O=31-Zs(C),U=1<<O;U&g|p[O]&g&&(p[O]|=g),C&=~U}}var lr=0;function Sc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var nm,Zl,oh,Rp,rm,Ip=!1,Mo=[],is=null,Uo=null,Vo=null,eu=new Map,jo=new Map,Fo=[],im="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bc(p,g){switch(p){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":Uo=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":eu.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":jo.delete(g.pointerId)}}function hs(p,g,C,O,U,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:C,eventSystemFlags:O,nativeEvent:H,targetContainers:[U]},g!==null&&(g=gm(g),g!==null&&Zl(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,U!==null&&g.indexOf(U)===-1&&g.push(U),p)}function td(p,g,C,O,U){switch(g){case"focusin":return is=hs(is,p,g,C,O,U),!0;case"dragenter":return Uo=hs(Uo,p,g,C,O,U),!0;case"mouseover":return Vo=hs(Vo,p,g,C,O,U),!0;case"pointerover":var H=U.pointerId;return eu.set(H,hs(eu.get(H)||null,p,g,C,O,U)),!0;case"gotpointercapture":return H=U.pointerId,jo.set(H,hs(jo.get(H)||null,p,g,C,O,U)),!0}return!1}function Ap(p){var g=Mp(p.target);if(g!==null){var C=Ws(g);if(C!==null){if(g=C.tag,g===13){if(g=Ju(C),g!==null){p.blockedOn=g,rm(p.priority,function(){oh(C)});return}}else if(g===3&&C.stateNode.current.memoizedState.isDehydrated){p.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}p.blockedOn=null}function _l(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var C=wr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(C===null){C=p.nativeEvent;var O=new C.constructor(C.type,C);_o=O,C.target.dispatchEvent(O),_o=null}else return g=gm(C),g!==null&&Zl(g),p.blockedOn=C,!1;g.shift()}return!0}function tu(p,g,C){_l(p)&&C.delete(g)}function sm(){Ip=!1,is!==null&&_l(is)&&(is=null),Uo!==null&&_l(Uo)&&(Uo=null),Vo!==null&&_l(Vo)&&(Vo=null),eu.forEach(tu),jo.forEach(tu)}function ma(p,g){p.blockedOn===g&&(p.blockedOn=null,Ip||(Ip=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,sm)))}function ga(p){function g(U){return ma(U,p)}if(0<Mo.length){ma(Mo[0],p);for(var C=1;C<Mo.length;C++){var O=Mo[C];O.blockedOn===p&&(O.blockedOn=null)}}for(is!==null&&ma(is,p),Uo!==null&&ma(Uo,p),Vo!==null&&ma(Vo,p),eu.forEach(g),jo.forEach(g),C=0;C<Fo.length;C++)O=Fo[C],O.blockedOn===p&&(O.blockedOn=null);for(;0<Fo.length&&(C=Fo[0],C.blockedOn===null);)Ap(C),C.blockedOn===null&&Fo.shift()}var yl=ae.ReactCurrentBatchConfig,be=!0;function De(p,g,C,O){var U=lr,H=yl.transition;yl.transition=null;try{lr=1,Yt(p,g,C,O)}finally{lr=U,yl.transition=H}}function rt(p,g,C,O){var U=lr,H=yl.transition;yl.transition=null;try{lr=4,Yt(p,g,C,O)}finally{lr=U,yl.transition=H}}function Yt(p,g,C,O){if(be){var U=wr(p,g,C,O);if(U===null)vE(p,g,O,Xn,C),bc(p,O);else if(td(U,p,g,C,O))O.stopPropagation();else if(bc(p,O),g&4&&-1<im.indexOf(p)){for(;U!==null;){var H=gm(U);if(H!==null&&nm(H),H=wr(p,g,C,O),H===null&&vE(p,g,O,Xn,C),H===U)break;U=H}U!==null&&O.stopPropagation()}else vE(p,g,O,null,C)}}var Xn=null;function wr(p,g,C,O){if(Xn=null,p=yo(O),p=Mp(p),p!==null)if(g=Ws(p),g===null)p=null;else if(C=g.tag,C===13){if(p=Ju(g),p!==null)return p;p=null}else if(C===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Xn=p,null}function Kr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vi()){case vc:return 1;case fl:return 4;case fa:case wp:return 16;case rh:return 536870912;default:return 16}default:return 16}}var dn=null,jr=null,Si=null;function Ps(){if(Si)return Si;var p,g=jr,C=g.length,O,U="value"in dn?dn.value:dn.textContent,H=U.length;for(p=0;p<C&&g[p]===U[p];p++);var ce=C-p;for(O=1;O<=ce&&g[C-O]===U[H-O];O++);return Si=U.slice(p,1<O?1-O:void 0)}function Bo(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function Wo(){return!0}function nd(){return!1}function Ji(p){function g(C,O,U,H,ce){this._reactName=C,this._targetInst=U,this.type=O,this.nativeEvent=H,this.target=ce,this.currentTarget=null;for(var Ae in p)p.hasOwnProperty(Ae)&&(C=p[Ae],this[Ae]=C?C(H):H[Ae]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Wo:nd,this.isPropagationStopped=nd,this}return Be(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=Wo)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=Wo)},persist:function(){},isPersistent:Wo}),g}var El={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ah=Ji(El),Tc=Be({},El,{view:0,detail:0}),Zg=Ji(Tc),om,rd,zo,nu=Be({},Tc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==zo&&(zo&&p.type==="mousemove"?(om=p.screenX-zo.screenX,rd=p.screenY-zo.screenY):rd=om=0,zo=p),om)},movementY:function(p){return"movementY"in p?p.movementY:rd}}),am=Ji(nu),e_=Be({},nu,{dataTransfer:0}),hE=Ji(e_),cm=Be({},Tc,{relatedTarget:0}),lm=Ji(cm),id=Be({},El,{animationName:0,elapsedTime:0,pseudoElement:0}),sd=Ji(id),od=Be({},El,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),t_=Ji(od),pE=Be({},El,{data:0}),Fn=Ji(pE),um={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Go={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=fE[p])?!!g[p]:!1}function wc(){return mE}var A=Be({},Tc,{key:function(p){if(p.key){var g=um[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=Bo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Go[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wc,charCode:function(p){return p.type==="keypress"?Bo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Bo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),z=Ji(A),te=Be({},nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),me=Ji(te),Xe=Be({},Tc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wc}),lt=Ji(Xe),Ut=Be({},El,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jr=Ji(Ut),hi=Be({},nu,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Cr=Ji(hi),zs=[9,13,27,32],ps=_&&"CompositionEvent"in window,Ja=null;_&&"documentMode"in document&&(Ja=document.documentMode);var Ho=_&&"TextEvent"in window&&!Ja,Pp=_&&(!ps||Ja&&8<Ja&&11>=Ja),dm=" ",Qa=!1;function BR(p,g){switch(p){case"keyup":return zs.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function WR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var hm=!1;function zN(p,g){switch(p){case"compositionend":return WR(g);case"keypress":return g.which!==32?null:(Qa=!0,dm);case"textInput":return p=g.data,p===dm&&Qa?null:p;default:return null}}function zR(p,g){if(hm)return p==="compositionend"||!ps&&BR(p,g)?(p=Ps(),Si=jr=dn=null,hm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Pp&&g.locale!=="ko"?null:g.data;default:return null}}var GN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function GR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!GN[p.type]:g==="textarea"}function tb(p,g,C,O){_c(O),g=SE(g,"onChange"),0<g.length&&(C=new ah("onChange","change",null,C,O),p.push({event:C,listeners:g}))}var Op=null,n_=null;function HN(p){cb(p,0)}function kp(p){var g=Up(p);if(Dt(g))return p}function $N(p,g){if(p==="change")return g}var HR=!1;if(_){var nb;if(_){var Cc="oninput"in document;if(!Cc){var $R=document.createElement("div");$R.setAttribute("oninput","return;"),Cc=typeof $R.oninput=="function"}nb=Cc}else nb=!1;HR=nb&&(!document.documentMode||9<document.documentMode)}function KR(){Op&&(Op.detachEvent("onpropertychange",_a),n_=Op=null)}function _a(p){if(p.propertyName==="value"&&kp(n_)){var g=[];tb(g,n_,p,yo(p)),Do(HN,g)}}function KN(p,g,C){p==="focusin"?(KR(),Op=g,n_=C,Op.attachEvent("onpropertychange",_a)):p==="focusout"&&KR()}function qN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return kp(n_)}function YN(p,g){if(p==="click")return kp(g)}function XN(p,g){if(p==="input"||p==="change")return kp(g)}function qR(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var vl=typeof Object.is=="function"?Object.is:qR;function r_(p,g){if(vl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var C=Object.keys(p),O=Object.keys(g);if(C.length!==O.length)return!1;for(O=0;O<C.length;O++){var U=C[O];if(!E.call(g,U)||!vl(p[U],g[U]))return!1}return!0}function YR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function rb(p,g){var C=YR(p);p=0;for(var O;C;){if(C.nodeType===3){if(O=p+C.textContent.length,p<=g&&O>=g)return{node:C,offset:g-p};p=O}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=YR(C)}}function XR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?XR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function JR(){for(var p=window,g=an();g instanceof p.HTMLIFrameElement;){try{var C=typeof g.contentWindow.location.href=="string"}catch{C=!1}if(C)p=g.contentWindow;else break;g=an(p.document)}return g}function i_(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function ib(p){var g=JR(),C=p.focusedElem,O=p.selectionRange;if(g!==C&&C&&C.ownerDocument&&XR(C.ownerDocument.documentElement,C)){if(O!==null&&i_(C)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in C)C.selectionStart=g,C.selectionEnd=Math.min(p,C.value.length);else if(p=(g=C.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var U=C.textContent.length,H=Math.min(O.start,U);O=O.end===void 0?H:Math.min(O.end,U),!p.extend&&H>O&&(U=O,O=H,H=U),U=rb(C,H);var ce=rb(C,O);U&&ce&&(p.rangeCount!==1||p.anchorNode!==U.node||p.anchorOffset!==U.offset||p.focusNode!==ce.node||p.focusOffset!==ce.offset)&&(g=g.createRange(),g.setStart(U.node,U.offset),p.removeAllRanges(),H>O?(p.addRange(g),p.extend(ce.node,ce.offset)):(g.setEnd(ce.node,ce.offset),p.addRange(g)))}}for(g=[],p=C;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<g.length;C++)p=g[C],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var JN=_&&"documentMode"in document&&11>=document.documentMode,at=null,sb=null,s_=null,ob=!1;function QR(p,g,C){var O=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;ob||at==null||at!==an(O)||(O=at,"selectionStart"in O&&i_(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),s_&&r_(s_,O)||(s_=O,O=SE(sb,"onSelect"),0<O.length&&(g=new ah("onSelect","select",null,g,C),p.push({event:g,listeners:O}),g.target=at)))}function gE(p,g){var C={};return C[p.toLowerCase()]=g.toLowerCase(),C["Webkit"+p]="webkit"+g,C["Moz"+p]="moz"+g,C}var pm={animationend:gE("Animation","AnimationEnd"),animationiteration:gE("Animation","AnimationIteration"),animationstart:gE("Animation","AnimationStart"),transitionend:gE("Transition","TransitionEnd")},ab={},ZR={};_&&(ZR=document.createElement("div").style,"AnimationEvent"in window||(delete pm.animationend.animation,delete pm.animationiteration.animation,delete pm.animationstart.animation),"TransitionEvent"in window||delete pm.transitionend.transition);function Np(p){if(ab[p])return ab[p];if(!pm[p])return p;var g=pm[p],C;for(C in g)if(g.hasOwnProperty(C)&&C in ZR)return ab[p]=g[C];return p}var Dp=Np("animationend"),eI=Np("animationiteration"),tI=Np("animationstart"),nI=Np("transitionend"),rI=new Map,_E="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ch(p,g){rI.set(p,g),d(g,[p])}for(var yE=0;yE<_E.length;yE++){var Za=_E[yE],QN=Za.toLowerCase(),o_=Za[0].toUpperCase()+Za.slice(1);ch(QN,"on"+o_)}ch(Dp,"onAnimationEnd"),ch(eI,"onAnimationIteration"),ch(tI,"onAnimationStart"),ch("dblclick","onDoubleClick"),ch("focusin","onFocus"),ch("focusout","onBlur"),ch(nI,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var a_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZN=new Set("cancel close invalid load scroll toggle".split(" ").concat(a_));function iI(p,g,C){var O=p.type||"unknown-event";p.currentTarget=C,Tp(O,g,void 0,p),p.currentTarget=null}function cb(p,g){g=(g&4)!==0;for(var C=0;C<p.length;C++){var O=p[C],U=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var ce=O.length-1;0<=ce;ce--){var Ae=O[ce],Le=Ae.instance,st=Ae.currentTarget;if(Ae=Ae.listener,Le!==H&&U.isPropagationStopped())break e;iI(U,Ae,st),H=Le}else for(ce=0;ce<O.length;ce++){if(Ae=O[ce],Le=Ae.instance,st=Ae.currentTarget,Ae=Ae.listener,Le!==H&&U.isPropagationStopped())break e;iI(U,Ae,st),H=Le}}}if(ha)throw p=Qd,ha=!1,Qd=null,p}function Ai(p,g){var C=g[d_];C===void 0&&(C=g[d_]=new Set);var O=p+"__bubble";C.has(O)||(sI(g,p,2,!1),C.add(O))}function lb(p,g,C){var O=0;g&&(O|=4),sI(C,p,O,g)}var EE="_reactListening"+Math.random().toString(36).slice(2);function xp(p){if(!p[EE]){p[EE]=!0,a.forEach(function(C){C!=="selectionchange"&&(ZN.has(C)||lb(C,!1,p),lb(C,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[EE]||(g[EE]=!0,lb("selectionchange",!1,g))}}function sI(p,g,C,O){switch(Kr(g)){case 1:var U=De;break;case 4:U=rt;break;default:U=Yt}C=U.bind(null,g,C,p),U=void 0,!ds||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(U=!0),O?U!==void 0?p.addEventListener(g,C,{capture:!0,passive:U}):p.addEventListener(g,C,!0):U!==void 0?p.addEventListener(g,C,{passive:U}):p.addEventListener(g,C,!1)}function vE(p,g,C,O,U){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ce=O.tag;if(ce===3||ce===4){var Ae=O.stateNode.containerInfo;if(Ae===U||Ae.nodeType===8&&Ae.parentNode===U)break;if(ce===4)for(ce=O.return;ce!==null;){var Le=ce.tag;if((Le===3||Le===4)&&(Le=ce.stateNode.containerInfo,Le===U||Le.nodeType===8&&Le.parentNode===U))return;ce=ce.return}for(;Ae!==null;){if(ce=Mp(Ae),ce===null)return;if(Le=ce.tag,Le===5||Le===6){O=H=ce;continue e}Ae=Ae.parentNode}}O=O.return}Do(function(){var st=H,At=yo(C),Pt=[];e:{var It=rI.get(p);if(It!==void 0){var Kt=ah,tn=p;switch(p){case"keypress":if(Bo(C)===0)break e;case"keydown":case"keyup":Kt=z;break;case"focusin":tn="focus",Kt=lm;break;case"focusout":tn="blur",Kt=lm;break;case"beforeblur":case"afterblur":Kt=lm;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Kt=am;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Kt=hE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Kt=lt;break;case Dp:case eI:case tI:Kt=sd;break;case nI:Kt=Jr;break;case"scroll":Kt=Zg;break;case"wheel":Kt=Cr;break;case"copy":case"cut":case"paste":Kt=t_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Kt=me}var nn=(g&4)!==0,Zi=!nn&&p==="scroll",Ze=nn?It!==null?It+"Capture":null:It;nn=[];for(var je=st,nt;je!==null;){nt=je;var xt=nt.stateNode;if(nt.tag===5&&xt!==null&&(nt=xt,Ze!==null&&(xt=Mi(je,Ze),xt!=null&&nn.push(fm(je,xt,nt)))),Zi)break;je=je.return}0<nn.length&&(It=new Kt(It,tn,null,C,At),Pt.push({event:It,listeners:nn}))}}if((g&7)===0){e:{if(It=p==="mouseover"||p==="pointerover",Kt=p==="mouseout"||p==="pointerout",It&&C!==_o&&(tn=C.relatedTarget||C.fromElement)&&(Mp(tn)||tn[Rc]))break e;if((Kt||It)&&(It=At.window===At?At:(It=At.ownerDocument)?It.defaultView||It.parentWindow:window,Kt?(tn=C.relatedTarget||C.toElement,Kt=st,tn=tn?Mp(tn):null,tn!==null&&(Zi=Ws(tn),tn!==Zi||tn.tag!==5&&tn.tag!==6)&&(tn=null)):(Kt=null,tn=st),Kt!==tn)){if(nn=am,xt="onMouseLeave",Ze="onMouseEnter",je="mouse",(p==="pointerout"||p==="pointerover")&&(nn=me,xt="onPointerLeave",Ze="onPointerEnter",je="pointer"),Zi=Kt==null?It:Up(Kt),nt=tn==null?It:Up(tn),It=new nn(xt,je+"leave",Kt,C,At),It.target=Zi,It.relatedTarget=nt,xt=null,Mp(At)===st&&(nn=new nn(Ze,je+"enter",tn,C,At),nn.target=nt,nn.relatedTarget=Zi,xt=nn),Zi=xt,Kt&&tn)t:{for(nn=Kt,Ze=tn,je=0,nt=nn;nt;nt=Lp(nt))je++;for(nt=0,xt=Ze;xt;xt=Lp(xt))nt++;for(;0<je-nt;)nn=Lp(nn),je--;for(;0<nt-je;)Ze=Lp(Ze),nt--;for(;je--;){if(nn===Ze||Ze!==null&&nn===Ze.alternate)break t;nn=Lp(nn),Ze=Lp(Ze)}nn=null}else nn=null;Kt!==null&&c_(Pt,It,Kt,nn,!1),tn!==null&&Zi!==null&&c_(Pt,Zi,tn,nn,!0)}}e:{if(It=st?Up(st):window,Kt=It.nodeName&&It.nodeName.toLowerCase(),Kt==="select"||Kt==="input"&&It.type==="file")var rn=$N;else if(GR(It))if(HR)rn=XN;else{rn=qN;var gn=KN}else(Kt=It.nodeName)&&Kt.toLowerCase()==="input"&&(It.type==="checkbox"||It.type==="radio")&&(rn=YN);if(rn&&(rn=rn(p,st))){tb(Pt,rn,C,At);break e}gn&&gn(p,It,st),p==="focusout"&&(gn=It._wrapperState)&&gn.controlled&&It.type==="number"&&Ve(It,"number",It.value)}switch(gn=st?Up(st):window,p){case"focusin":(GR(gn)||gn.contentEditable==="true")&&(at=gn,sb=st,s_=null);break;case"focusout":s_=sb=at=null;break;case"mousedown":ob=!0;break;case"contextmenu":case"mouseup":case"dragend":ob=!1,QR(Pt,C,At);break;case"selectionchange":if(JN)break;case"keydown":case"keyup":QR(Pt,C,At)}var vn;if(ps)e:{switch(p){case"compositionstart":var Ln="onCompositionStart";break e;case"compositionend":Ln="onCompositionEnd";break e;case"compositionupdate":Ln="onCompositionUpdate";break e}Ln=void 0}else hm?BR(p,C)&&(Ln="onCompositionEnd"):p==="keydown"&&C.keyCode===229&&(Ln="onCompositionStart");Ln&&(Pp&&C.locale!=="ko"&&(hm||Ln!=="onCompositionStart"?Ln==="onCompositionEnd"&&hm&&(vn=Ps()):(dn=At,jr="value"in dn?dn.value:dn.textContent,hm=!0)),gn=SE(st,Ln),0<gn.length&&(Ln=new Fn(Ln,p,null,C,At),Pt.push({event:Ln,listeners:gn}),vn?Ln.data=vn:(vn=WR(C),vn!==null&&(Ln.data=vn)))),(vn=Ho?zN(p,C):zR(p,C))&&(st=SE(st,"onBeforeInput"),0<st.length&&(At=new Fn("onBeforeInput","beforeinput",null,C,At),Pt.push({event:At,listeners:st}),At.data=vn))}cb(Pt,g)})}function fm(p,g,C){return{instance:p,listener:g,currentTarget:C}}function SE(p,g){for(var C=g+"Capture",O=[];p!==null;){var U=p,H=U.stateNode;U.tag===5&&H!==null&&(U=H,H=Mi(p,C),H!=null&&O.unshift(fm(p,H,U)),H=Mi(p,g),H!=null&&O.push(fm(p,H,U))),p=p.return}return O}function Lp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function c_(p,g,C,O,U){for(var H=g._reactName,ce=[];C!==null&&C!==O;){var Ae=C,Le=Ae.alternate,st=Ae.stateNode;if(Le!==null&&Le===O)break;Ae.tag===5&&st!==null&&(Ae=st,U?(Le=Mi(C,H),Le!=null&&ce.unshift(fm(C,Le,Ae))):U||(Le=Mi(C,H),Le!=null&&ce.push(fm(C,Le,Ae)))),C=C.return}ce.length!==0&&p.push({event:g,listeners:ce})}var eD=/\r\n?/g,tD=/\u0000|\uFFFD/g;function oI(p){return(typeof p=="string"?p:""+p).replace(eD,`
`).replace(tD,"")}function bE(p,g,C){if(g=oI(g),oI(p)!==g&&C)throw Error(i(425))}function TE(){}var wE=null,l_=null;function ub(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var u_=typeof setTimeout=="function"?setTimeout:void 0,nD=typeof clearTimeout=="function"?clearTimeout:void 0,aI=typeof Promise=="function"?Promise:void 0,rD=typeof queueMicrotask=="function"?queueMicrotask:typeof aI<"u"?function(p){return aI.resolve(null).then(p).catch(iD)}:u_;function iD(p){setTimeout(function(){throw p})}function db(p,g){var C=g,O=0;do{var U=C.nextSibling;if(p.removeChild(C),U&&U.nodeType===8)if(C=U.data,C==="/$"){if(O===0){p.removeChild(U),ga(g);return}O--}else C!=="$"&&C!=="$?"&&C!=="$!"||O++;C=U}while(C);ga(g)}function lh(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function cI(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var C=p.data;if(C==="$"||C==="$!"||C==="$?"){if(g===0)return p;g--}else C==="/$"&&g++}p=p.previousSibling}return null}var mm=Math.random().toString(36).slice(2),ru="__reactFiber$"+mm,uh="__reactProps$"+mm,Rc="__reactContainer$"+mm,d_="__reactEvents$"+mm,sD="__reactListeners$"+mm,oD="__reactHandles$"+mm;function Mp(p){var g=p[ru];if(g)return g;for(var C=p.parentNode;C;){if(g=C[Rc]||C[ru]){if(C=g.alternate,g.child!==null||C!==null&&C.child!==null)for(p=cI(p);p!==null;){if(C=p[ru])return C;p=cI(p)}return g}p=C,C=p.parentNode}return null}function gm(p){return p=p[ru]||p[Rc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Up(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function _m(p){return p[uh]||null}var hb=[],ym=-1;function Ic(p){return{current:p}}function Pi(p){0>ym||(p.current=hb[ym],hb[ym]=null,ym--)}function bi(p,g){ym++,hb[ym]=p.current,p.current=g}var dh={},vo=Ic(dh),ya=Ic(!1),Vp=dh;function jp(p,g){var C=p.type.contextTypes;if(!C)return dh;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var U={},H;for(H in C)U[H]=g[H];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=U),U}function Ea(p){return p=p.childContextTypes,p!=null}function CE(){Pi(ya),Pi(vo)}function lI(p,g,C){if(vo.current!==dh)throw Error(i(168));bi(vo,g),bi(ya,C)}function RE(p,g,C){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return C;O=O.getChildContext();for(var U in O)if(!(U in g))throw Error(i(108,$e(p)||"Unknown",U));return Be({},C,O)}function IE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||dh,Vp=vo.current,bi(vo,p),bi(ya,ya.current),!0}function uI(p,g,C){var O=p.stateNode;if(!O)throw Error(i(169));C?(p=RE(p,g,Vp),O.__reactInternalMemoizedMergedChildContext=p,Pi(ya),Pi(vo),bi(vo,p)):Pi(ya),bi(ya,C)}var Ac=null,AE=!1,pb=!1;function dI(p){Ac===null?Ac=[p]:Ac.push(p)}function aD(p){AE=!0,dI(p)}function hh(){if(!pb&&Ac!==null){pb=!0;var p=0,g=lr;try{var C=Ac;for(lr=1;p<C.length;p++){var O=C[p];do O=O(!0);while(O!==null)}Ac=null,AE=!1}catch(U){throw Ac!==null&&(Ac=Ac.slice(p+1)),th(vc,hh),U}finally{lr=g,pb=!1}}return null}var Em=[],ad=0,h_=null,PE=0,Pc=[],ec=0,Fp=null,cd=1,ld="";function ud(p,g){Em[ad++]=PE,Em[ad++]=h_,h_=p,PE=g}function OE(p,g,C){Pc[ec++]=cd,Pc[ec++]=ld,Pc[ec++]=Fp,Fp=p;var O=cd;p=ld;var U=32-Zs(O)-1;O&=~(1<<U),C+=1;var H=32-Zs(g)+U;if(30<H){var ce=U-U%5;H=(O&(1<<ce)-1).toString(32),O>>=ce,U-=ce,cd=1<<32-Zs(g)+U|C<<U|O,ld=H+p}else cd=1<<H|C<<U|O,ld=p}function kE(p){p.return!==null&&(ud(p,1),OE(p,1,0))}function p_(p){for(;p===h_;)h_=Em[--ad],Em[ad]=null,PE=Em[--ad],Em[ad]=null;for(;p===Fp;)Fp=Pc[--ec],Pc[ec]=null,ld=Pc[--ec],Pc[ec]=null,cd=Pc[--ec],Pc[ec]=null}var va=null,Sa=null,pi=!1,$o=null;function hI(p,g){var C=rc(5,null,null,0);C.elementType="DELETED",C.stateNode=g,C.return=p,g=p.deletions,g===null?(p.deletions=[C],p.flags|=16):g.push(C)}function pI(p,g){switch(p.tag){case 5:var C=p.type;return g=g.nodeType!==1||C.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,va=p,Sa=lh(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,va=p,Sa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(C=Fp!==null?{id:cd,overflow:ld}:null,p.memoizedState={dehydrated:g,treeContext:C,retryLane:1073741824},C=rc(18,null,null,0),C.stateNode=g,C.return=p,p.child=C,va=p,Sa=null,!0):!1;default:return!1}}function NE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function fb(p){if(pi){var g=Sa;if(g){var C=g;if(!pI(p,g)){if(NE(p))throw Error(i(418));g=lh(C.nextSibling);var O=va;g&&pI(p,g)?hI(O,C):(p.flags=p.flags&-4097|2,pi=!1,va=p)}}else{if(NE(p))throw Error(i(418));p.flags=p.flags&-4097|2,pi=!1,va=p}}}function fI(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;va=p}function f_(p){if(p!==va)return!1;if(!pi)return fI(p),pi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!ub(p.type,p.memoizedProps)),g&&(g=Sa)){if(NE(p))throw mI(),Error(i(418));for(;g;)hI(p,g),g=lh(g.nextSibling)}if(fI(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var C=p.data;if(C==="/$"){if(g===0){Sa=lh(p.nextSibling);break e}g--}else C!=="$"&&C!=="$!"&&C!=="$?"||g++}p=p.nextSibling}Sa=null}}else Sa=va?lh(p.stateNode.nextSibling):null;return!0}function mI(){for(var p=Sa;p;)p=lh(p.nextSibling)}function vm(){Sa=va=null,pi=!1}function mb(p){$o===null?$o=[p]:$o.push(p)}var cD=ae.ReactCurrentBatchConfig;function m_(p,g,C){if(p=C.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(i(309));var O=C.stateNode}if(!O)throw Error(i(147,p));var U=O,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ce){var Ae=U.refs;ce===null?delete Ae[H]:Ae[H]=ce},g._stringRef=H,g)}if(typeof p!="string")throw Error(i(284));if(!C._owner)throw Error(i(290,p))}return p}function DE(p,g){throw p=Object.prototype.toString.call(g),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function gb(p){var g=p._init;return g(p._payload)}function ph(p){function g(Ze,je){if(p){var nt=Ze.deletions;nt===null?(Ze.deletions=[je],Ze.flags|=16):nt.push(je)}}function C(Ze,je){if(!p)return null;for(;je!==null;)g(Ze,je),je=je.sibling;return null}function O(Ze,je){for(Ze=new Map;je!==null;)je.key!==null?Ze.set(je.key,je):Ze.set(je.index,je),je=je.sibling;return Ze}function U(Ze,je){return Ze=yd(Ze,je),Ze.index=0,Ze.sibling=null,Ze}function H(Ze,je,nt){return Ze.index=nt,p?(nt=Ze.alternate,nt!==null?(nt=nt.index,nt<je?(Ze.flags|=2,je):nt):(Ze.flags|=2,je)):(Ze.flags|=1048576,je)}function ce(Ze){return p&&Ze.alternate===null&&(Ze.flags|=2),Ze}function Ae(Ze,je,nt,xt){return je===null||je.tag!==6?(je=Zb(nt,Ze.mode,xt),je.return=Ze,je):(je=U(je,nt),je.return=Ze,je)}function Le(Ze,je,nt,xt){var rn=nt.type;return rn===Z?At(Ze,je,nt.props.children,xt,nt.key):je!==null&&(je.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===tt&&gb(rn)===je.type)?(xt=U(je,nt.props),xt.ref=m_(Ze,je,nt),xt.return=Ze,xt):(xt=Ev(nt.type,nt.key,nt.props,null,Ze.mode,xt),xt.ref=m_(Ze,je,nt),xt.return=Ze,xt)}function st(Ze,je,nt,xt){return je===null||je.tag!==4||je.stateNode.containerInfo!==nt.containerInfo||je.stateNode.implementation!==nt.implementation?(je=eT(nt,Ze.mode,xt),je.return=Ze,je):(je=U(je,nt.children||[]),je.return=Ze,je)}function At(Ze,je,nt,xt,rn){return je===null||je.tag!==7?(je=Qp(nt,Ze.mode,xt,rn),je.return=Ze,je):(je=U(je,nt),je.return=Ze,je)}function Pt(Ze,je,nt){if(typeof je=="string"&&je!==""||typeof je=="number")return je=Zb(""+je,Ze.mode,nt),je.return=Ze,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case re:return nt=Ev(je.type,je.key,je.props,null,Ze.mode,nt),nt.ref=m_(Ze,null,je),nt.return=Ze,nt;case fe:return je=eT(je,Ze.mode,nt),je.return=Ze,je;case tt:var xt=je._init;return Pt(Ze,xt(je._payload),nt)}if(Ye(je)||ve(je))return je=Qp(je,Ze.mode,nt,null),je.return=Ze,je;DE(Ze,je)}return null}function It(Ze,je,nt,xt){var rn=je!==null?je.key:null;if(typeof nt=="string"&&nt!==""||typeof nt=="number")return rn!==null?null:Ae(Ze,je,""+nt,xt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case re:return nt.key===rn?Le(Ze,je,nt,xt):null;case fe:return nt.key===rn?st(Ze,je,nt,xt):null;case tt:return rn=nt._init,It(Ze,je,rn(nt._payload),xt)}if(Ye(nt)||ve(nt))return rn!==null?null:At(Ze,je,nt,xt,null);DE(Ze,nt)}return null}function Kt(Ze,je,nt,xt,rn){if(typeof xt=="string"&&xt!==""||typeof xt=="number")return Ze=Ze.get(nt)||null,Ae(je,Ze,""+xt,rn);if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case re:return Ze=Ze.get(xt.key===null?nt:xt.key)||null,Le(je,Ze,xt,rn);case fe:return Ze=Ze.get(xt.key===null?nt:xt.key)||null,st(je,Ze,xt,rn);case tt:var gn=xt._init;return Kt(Ze,je,nt,gn(xt._payload),rn)}if(Ye(xt)||ve(xt))return Ze=Ze.get(nt)||null,At(je,Ze,xt,rn,null);DE(je,xt)}return null}function tn(Ze,je,nt,xt){for(var rn=null,gn=null,vn=je,Ln=je=0,ys=null;vn!==null&&Ln<nt.length;Ln++){vn.index>Ln?(ys=vn,vn=null):ys=vn.sibling;var Rr=It(Ze,vn,nt[Ln],xt);if(Rr===null){vn===null&&(vn=ys);break}p&&vn&&Rr.alternate===null&&g(Ze,vn),je=H(Rr,je,Ln),gn===null?rn=Rr:gn.sibling=Rr,gn=Rr,vn=ys}if(Ln===nt.length)return C(Ze,vn),pi&&ud(Ze,Ln),rn;if(vn===null){for(;Ln<nt.length;Ln++)vn=Pt(Ze,nt[Ln],xt),vn!==null&&(je=H(vn,je,Ln),gn===null?rn=vn:gn.sibling=vn,gn=vn);return pi&&ud(Ze,Ln),rn}for(vn=O(Ze,vn);Ln<nt.length;Ln++)ys=Kt(vn,Ze,Ln,nt[Ln],xt),ys!==null&&(p&&ys.alternate!==null&&vn.delete(ys.key===null?Ln:ys.key),je=H(ys,je,Ln),gn===null?rn=ys:gn.sibling=ys,gn=ys);return p&&vn.forEach(function(wh){return g(Ze,wh)}),pi&&ud(Ze,Ln),rn}function nn(Ze,je,nt,xt){var rn=ve(nt);if(typeof rn!="function")throw Error(i(150));if(nt=rn.call(nt),nt==null)throw Error(i(151));for(var gn=rn=null,vn=je,Ln=je=0,ys=null,Rr=nt.next();vn!==null&&!Rr.done;Ln++,Rr=nt.next()){vn.index>Ln?(ys=vn,vn=null):ys=vn.sibling;var wh=It(Ze,vn,Rr.value,xt);if(wh===null){vn===null&&(vn=ys);break}p&&vn&&wh.alternate===null&&g(Ze,vn),je=H(wh,je,Ln),gn===null?rn=wh:gn.sibling=wh,gn=wh,vn=ys}if(Rr.done)return C(Ze,vn),pi&&ud(Ze,Ln),rn;if(vn===null){for(;!Rr.done;Ln++,Rr=nt.next())Rr=Pt(Ze,Rr.value,xt),Rr!==null&&(je=H(Rr,je,Ln),gn===null?rn=Rr:gn.sibling=Rr,gn=Rr);return pi&&ud(Ze,Ln),rn}for(vn=O(Ze,vn);!Rr.done;Ln++,Rr=nt.next())Rr=Kt(vn,Ze,Ln,Rr.value,xt),Rr!==null&&(p&&Rr.alternate!==null&&vn.delete(Rr.key===null?Ln:Rr.key),je=H(Rr,je,Ln),gn===null?rn=Rr:gn.sibling=Rr,gn=Rr);return p&&vn.forEach(function(wD){return g(Ze,wD)}),pi&&ud(Ze,Ln),rn}function Zi(Ze,je,nt,xt){if(typeof nt=="object"&&nt!==null&&nt.type===Z&&nt.key===null&&(nt=nt.props.children),typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case re:e:{for(var rn=nt.key,gn=je;gn!==null;){if(gn.key===rn){if(rn=nt.type,rn===Z){if(gn.tag===7){C(Ze,gn.sibling),je=U(gn,nt.props.children),je.return=Ze,Ze=je;break e}}else if(gn.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===tt&&gb(rn)===gn.type){C(Ze,gn.sibling),je=U(gn,nt.props),je.ref=m_(Ze,gn,nt),je.return=Ze,Ze=je;break e}C(Ze,gn);break}else g(Ze,gn);gn=gn.sibling}nt.type===Z?(je=Qp(nt.props.children,Ze.mode,xt,nt.key),je.return=Ze,Ze=je):(xt=Ev(nt.type,nt.key,nt.props,null,Ze.mode,xt),xt.ref=m_(Ze,je,nt),xt.return=Ze,Ze=xt)}return ce(Ze);case fe:e:{for(gn=nt.key;je!==null;){if(je.key===gn)if(je.tag===4&&je.stateNode.containerInfo===nt.containerInfo&&je.stateNode.implementation===nt.implementation){C(Ze,je.sibling),je=U(je,nt.children||[]),je.return=Ze,Ze=je;break e}else{C(Ze,je);break}else g(Ze,je);je=je.sibling}je=eT(nt,Ze.mode,xt),je.return=Ze,Ze=je}return ce(Ze);case tt:return gn=nt._init,Zi(Ze,je,gn(nt._payload),xt)}if(Ye(nt))return tn(Ze,je,nt,xt);if(ve(nt))return nn(Ze,je,nt,xt);DE(Ze,nt)}return typeof nt=="string"&&nt!==""||typeof nt=="number"?(nt=""+nt,je!==null&&je.tag===6?(C(Ze,je.sibling),je=U(je,nt),je.return=Ze,Ze=je):(C(Ze,je),je=Zb(nt,Ze.mode,xt),je.return=Ze,Ze=je),ce(Ze)):C(Ze,je)}return Zi}var Sm=ph(!0),gI=ph(!1),xE=Ic(null),g_=null,bm=null,LE=null;function _b(){LE=bm=g_=null}function yb(p){var g=xE.current;Pi(xE),p._currentValue=g}function Eb(p,g,C){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===C)break;p=p.return}}function dd(p,g){g_=p,LE=bm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ta=!0),p.firstContext=null)}function Oc(p){var g=p._currentValue;if(LE!==p)if(p={context:p,memoizedValue:g,next:null},bm===null){if(g_===null)throw Error(i(308));bm=p,g_.dependencies={lanes:0,firstContext:p}}else bm=bm.next=p;return g}var Bp=null;function vb(p){Bp===null?Bp=[p]:Bp.push(p)}function _I(p,g,C,O){var U=g.interleaved;return U===null?(C.next=C,vb(g)):(C.next=U.next,U.next=C),g.interleaved=C,hd(p,O)}function hd(p,g){p.lanes|=g;var C=p.alternate;for(C!==null&&(C.lanes|=g),C=p,p=p.return;p!==null;)p.childLanes|=g,C=p.alternate,C!==null&&(C.childLanes|=g),C=p,p=p.return;return C.tag===3?C.stateNode:null}var fh=!1;function __(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yI(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function iu(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function mh(p,g,C){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Or&2)!==0){var U=O.pending;return U===null?g.next=g:(g.next=U.next,U.next=g),O.pending=g,hd(p,C)}return U=O.interleaved,U===null?(g.next=g,vb(O)):(g.next=U.next,U.next=g),O.interleaved=g,hd(p,C)}function y_(p,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,C|=O,g.lanes=C,Xa(p,C)}}function EI(p,g){var C=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,C===O)){var U=null,H=null;if(C=C.firstBaseUpdate,C!==null){do{var ce={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};H===null?U=H=ce:H=H.next=ce,C=C.next}while(C!==null);H===null?U=H=g:H=H.next=g}else U=H=g;C={baseState:O.baseState,firstBaseUpdate:U,lastBaseUpdate:H,shared:O.shared,effects:O.effects},p.updateQueue=C;return}p=C.lastBaseUpdate,p===null?C.firstBaseUpdate=g:p.next=g,C.lastBaseUpdate=g}function ME(p,g,C,O){var U=p.updateQueue;fh=!1;var H=U.firstBaseUpdate,ce=U.lastBaseUpdate,Ae=U.shared.pending;if(Ae!==null){U.shared.pending=null;var Le=Ae,st=Le.next;Le.next=null,ce===null?H=st:ce.next=st,ce=Le;var At=p.alternate;At!==null&&(At=At.updateQueue,Ae=At.lastBaseUpdate,Ae!==ce&&(Ae===null?At.firstBaseUpdate=st:Ae.next=st,At.lastBaseUpdate=Le))}if(H!==null){var Pt=U.baseState;ce=0,At=st=Le=null,Ae=H;do{var It=Ae.lane,Kt=Ae.eventTime;if((O&It)===It){At!==null&&(At=At.next={eventTime:Kt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var tn=p,nn=Ae;switch(It=g,Kt=C,nn.tag){case 1:if(tn=nn.payload,typeof tn=="function"){Pt=tn.call(Kt,Pt,It);break e}Pt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=nn.payload,It=typeof tn=="function"?tn.call(Kt,Pt,It):tn,It==null)break e;Pt=Be({},Pt,It);break e;case 2:fh=!0}}Ae.callback!==null&&Ae.lane!==0&&(p.flags|=64,It=U.effects,It===null?U.effects=[Ae]:It.push(Ae))}else Kt={eventTime:Kt,lane:It,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},At===null?(st=At=Kt,Le=Pt):At=At.next=Kt,ce|=It;if(Ae=Ae.next,Ae===null){if(Ae=U.shared.pending,Ae===null)break;It=Ae,Ae=It.next,It.next=null,U.lastBaseUpdate=It,U.shared.pending=null}}while(!0);if(At===null&&(Le=Pt),U.baseState=Le,U.firstBaseUpdate=st,U.lastBaseUpdate=At,g=U.shared.interleaved,g!==null){U=g;do ce|=U.lane,U=U.next;while(U!==g)}else H===null&&(U.shared.lanes=0);Kp|=ce,p.lanes=ce,p.memoizedState=Pt}}function vI(p,g,C){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],U=O.callback;if(U!==null){if(O.callback=null,O=C,typeof U!="function")throw Error(i(191,U));U.call(O)}}}var E_={},su=Ic(E_),v_=Ic(E_),Tm=Ic(E_);function Wp(p){if(p===E_)throw Error(i(174));return p}function Sb(p,g){switch(bi(Tm,g),bi(v_,p),bi(su,E_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Jt(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=Jt(g,p)}Pi(su),bi(su,g)}function zp(){Pi(su),Pi(v_),Pi(Tm)}function SI(p){Wp(Tm.current);var g=Wp(su.current),C=Jt(g,p.type);g!==C&&(bi(v_,p),bi(su,C))}function wm(p){v_.current===p&&(Pi(su),Pi(v_))}var Di=Ic(0);function gh(p){for(var g=p;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var bb=[];function Tb(){for(var p=0;p<bb.length;p++)bb[p]._workInProgressVersionPrimary=null;bb.length=0}var UE=ae.ReactCurrentDispatcher,wb=ae.ReactCurrentBatchConfig,ou=0,Ui=null,fs=null,ms=null,Cm=!1,S_=!1,b_=0,lD=0;function So(){throw Error(i(321))}function Cb(p,g){if(g===null)return!1;for(var C=0;C<g.length&&C<p.length;C++)if(!vl(p[C],g[C]))return!1;return!0}function Rm(p,g,C,O,U,H){if(ou=H,Ui=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,UE.current=p===null||p.memoizedState===null?hD:NI,p=C(O,U),S_){H=0;do{if(S_=!1,b_=0,25<=H)throw Error(i(301));H+=1,ms=fs=null,g.updateQueue=null,UE.current=pD,p=C(O,U)}while(S_)}if(UE.current=BE,g=fs!==null&&fs.next!==null,ou=0,ms=fs=Ui=null,Cm=!1,g)throw Error(i(300));return p}function Rb(){var p=b_!==0;return b_=0,p}function Ko(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?Ui.memoizedState=ms=p:ms=ms.next=p,ms}function ba(){if(fs===null){var p=Ui.alternate;p=p!==null?p.memoizedState:null}else p=fs.next;var g=ms===null?Ui.memoizedState:ms.next;if(g!==null)ms=g,fs=p;else{if(p===null)throw Error(i(310));fs=p,p={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},ms===null?Ui.memoizedState=ms=p:ms=ms.next=p}return ms}function _h(p,g){return typeof g=="function"?g(p):g}function Gp(p){var g=ba(),C=g.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=p;var O=fs,U=O.baseQueue,H=C.pending;if(H!==null){if(U!==null){var ce=U.next;U.next=H.next,H.next=ce}O.baseQueue=U=H,C.pending=null}if(U!==null){H=U.next,O=O.baseState;var Ae=ce=null,Le=null,st=H;do{var At=st.lane;if((ou&At)===At)Le!==null&&(Le=Le.next={lane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),O=st.hasEagerState?st.eagerState:p(O,st.action);else{var Pt={lane:At,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null};Le===null?(Ae=Le=Pt,ce=O):Le=Le.next=Pt,Ui.lanes|=At,Kp|=At}st=st.next}while(st!==null&&st!==H);Le===null?ce=O:Le.next=Ae,vl(O,g.memoizedState)||(Ta=!0),g.memoizedState=O,g.baseState=ce,g.baseQueue=Le,C.lastRenderedState=O}if(p=C.interleaved,p!==null){U=p;do H=U.lane,Ui.lanes|=H,Kp|=H,U=U.next;while(U!==p)}else U===null&&(C.lanes=0);return[g.memoizedState,C.dispatch]}function Im(p){var g=ba(),C=g.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=p;var O=C.dispatch,U=C.pending,H=g.memoizedState;if(U!==null){C.pending=null;var ce=U=U.next;do H=p(H,ce.action),ce=ce.next;while(ce!==U);vl(H,g.memoizedState)||(Ta=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),C.lastRenderedState=H}return[H,O]}function bI(){}function Ib(p,g){var C=Ui,O=ba(),U=g(),H=!vl(O.memoizedState,U);if(H&&(O.memoizedState=U,Ta=!0),O=O.queue,kc(wI.bind(null,C,O,p),[p]),O.getSnapshot!==g||H||ms!==null&&ms.memoizedState.tag&1){if(C.flags|=2048,T_(9,Ab.bind(null,C,O,U,g),void 0,null),Gs===null)throw Error(i(349));(ou&30)!==0||TI(C,g,U)}return U}function TI(p,g,C){p.flags|=16384,p={getSnapshot:g,value:C},g=Ui.updateQueue,g===null?(g={lastEffect:null,stores:null},Ui.updateQueue=g,g.stores=[p]):(C=g.stores,C===null?g.stores=[p]:C.push(p))}function Ab(p,g,C,O){g.value=C,g.getSnapshot=O,CI(g)&&VE(p)}function wI(p,g,C){return C(function(){CI(g)&&VE(p)})}function CI(p){var g=p.getSnapshot;p=p.value;try{var C=g();return!vl(p,C)}catch{return!0}}function VE(p){var g=hd(p,1);g!==null&&Lc(g,p,1,-1)}function jE(p){var g=Ko();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_h,lastRenderedState:p},g.queue=p,p=p.dispatch=dD.bind(null,Ui,p),[g.memoizedState,p]}function T_(p,g,C,O){return p={tag:p,create:g,destroy:C,deps:O,next:null},g=Ui.updateQueue,g===null?(g={lastEffect:null,stores:null},Ui.updateQueue=g,g.lastEffect=p.next=p):(C=g.lastEffect,C===null?g.lastEffect=p.next=p:(O=C.next,C.next=p,p.next=O,g.lastEffect=p)),p}function RI(){return ba().memoizedState}function w_(p,g,C,O){var U=Ko();Ui.flags|=p,U.memoizedState=T_(1|g,C,void 0,O===void 0?null:O)}function Am(p,g,C,O){var U=ba();O=O===void 0?null:O;var H=void 0;if(fs!==null){var ce=fs.memoizedState;if(H=ce.destroy,O!==null&&Cb(O,ce.deps)){U.memoizedState=T_(g,C,H,O);return}}Ui.flags|=p,U.memoizedState=T_(1|g,C,H,O)}function II(p,g){return w_(8390656,8,p,g)}function kc(p,g){return Am(2048,8,p,g)}function Hp(p,g){return Am(4,2,p,g)}function yh(p,g){return Am(4,4,p,g)}function Pb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Ob(p,g,C){return C=C!=null?C.concat([p]):null,Am(4,4,Pb.bind(null,g,p),C)}function pd(){}function FE(p,g){var C=ba();g=g===void 0?null:g;var O=C.memoizedState;return O!==null&&g!==null&&Cb(g,O[1])?O[0]:(C.memoizedState=[p,g],p)}function AI(p,g){var C=ba();g=g===void 0?null:g;var O=C.memoizedState;return O!==null&&g!==null&&Cb(g,O[1])?O[0]:(p=p(),C.memoizedState=[p,g],p)}function kb(p,g,C){return(ou&21)===0?(p.baseState&&(p.baseState=!1,Ta=!0),p.memoizedState=C):(vl(C,g)||(C=ed(),Ui.lanes|=C,Kp|=C,p.baseState=!0),g)}function uD(p,g){var C=lr;lr=C!==0&&4>C?C:4,p(!0);var O=wb.transition;wb.transition={};try{p(!1),g()}finally{lr=C,wb.transition=O}}function Nb(){return ba().memoizedState}function PI(p,g,C){var O=xc(p);if(C={lane:O,action:C,hasEagerState:!1,eagerState:null,next:null},fd(p))OI(g,C);else if(C=_I(p,g,C,O),C!==null){var U=no();Lc(C,p,O,U),kI(C,g,O)}}function dD(p,g,C){var O=xc(p),U={lane:O,action:C,hasEagerState:!1,eagerState:null,next:null};if(fd(p))OI(g,U);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ce=g.lastRenderedState,Ae=H(ce,C);if(U.hasEagerState=!0,U.eagerState=Ae,vl(Ae,ce)){var Le=g.interleaved;Le===null?(U.next=U,vb(g)):(U.next=Le.next,Le.next=U),g.interleaved=U;return}}catch{}finally{}C=_I(p,g,U,O),C!==null&&(U=no(),Lc(C,p,O,U),kI(C,g,O))}}function fd(p){var g=p.alternate;return p===Ui||g!==null&&g===Ui}function OI(p,g){S_=Cm=!0;var C=p.pending;C===null?g.next=g:(g.next=C.next,C.next=g),p.pending=g}function kI(p,g,C){if((C&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,C|=O,g.lanes=C,Xa(p,C)}}var BE={readContext:Oc,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},hD={readContext:Oc,useCallback:function(p,g){return Ko().memoizedState=[p,g===void 0?null:g],p},useContext:Oc,useEffect:II,useImperativeHandle:function(p,g,C){return C=C!=null?C.concat([p]):null,w_(4194308,4,Pb.bind(null,g,p),C)},useLayoutEffect:function(p,g){return w_(4194308,4,p,g)},useInsertionEffect:function(p,g){return w_(4,2,p,g)},useMemo:function(p,g){var C=Ko();return g=g===void 0?null:g,p=p(),C.memoizedState=[p,g],p},useReducer:function(p,g,C){var O=Ko();return g=C!==void 0?C(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=PI.bind(null,Ui,p),[O.memoizedState,p]},useRef:function(p){var g=Ko();return p={current:p},g.memoizedState=p},useState:jE,useDebugValue:pd,useDeferredValue:function(p){return Ko().memoizedState=p},useTransition:function(){var p=jE(!1),g=p[0];return p=uD.bind(null,p[1]),Ko().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,C){var O=Ui,U=Ko();if(pi){if(C===void 0)throw Error(i(407));C=C()}else{if(C=g(),Gs===null)throw Error(i(349));(ou&30)!==0||TI(O,g,C)}U.memoizedState=C;var H={value:C,getSnapshot:g};return U.queue=H,II(wI.bind(null,O,H,p),[p]),O.flags|=2048,T_(9,Ab.bind(null,O,H,C,g),void 0,null),C},useId:function(){var p=Ko(),g=Gs.identifierPrefix;if(pi){var C=ld,O=cd;C=(O&~(1<<32-Zs(O)-1)).toString(32)+C,g=":"+g+"R"+C,C=b_++,0<C&&(g+="H"+C.toString(32)),g+=":"}else C=lD++,g=":"+g+"r"+C.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},NI={readContext:Oc,useCallback:FE,useContext:Oc,useEffect:kc,useImperativeHandle:Ob,useInsertionEffect:Hp,useLayoutEffect:yh,useMemo:AI,useReducer:Gp,useRef:RI,useState:function(){return Gp(_h)},useDebugValue:pd,useDeferredValue:function(p){var g=ba();return kb(g,fs.memoizedState,p)},useTransition:function(){var p=Gp(_h)[0],g=ba().memoizedState;return[p,g]},useMutableSource:bI,useSyncExternalStore:Ib,useId:Nb,unstable_isNewReconciler:!1},pD={readContext:Oc,useCallback:FE,useContext:Oc,useEffect:kc,useImperativeHandle:Ob,useInsertionEffect:Hp,useLayoutEffect:yh,useMemo:AI,useReducer:Im,useRef:RI,useState:function(){return Im(_h)},useDebugValue:pd,useDeferredValue:function(p){var g=ba();return fs===null?g.memoizedState=p:kb(g,fs.memoizedState,p)},useTransition:function(){var p=Im(_h)[0],g=ba().memoizedState;return[p,g]},useMutableSource:bI,useSyncExternalStore:Ib,useId:Nb,unstable_isNewReconciler:!1};function tc(p,g){if(p&&p.defaultProps){g=Be({},g),p=p.defaultProps;for(var C in p)g[C]===void 0&&(g[C]=p[C]);return g}return g}function WE(p,g,C,O){g=p.memoizedState,C=C(O,g),C=C==null?g:Be({},g,C),p.memoizedState=C,p.lanes===0&&(p.updateQueue.baseState=C)}var zE={isMounted:function(p){return(p=p._reactInternals)?Ws(p)===p:!1},enqueueSetState:function(p,g,C){p=p._reactInternals;var O=no(),U=xc(p),H=iu(O,U);H.payload=g,C!=null&&(H.callback=C),g=mh(p,H,U),g!==null&&(Lc(g,p,U,O),y_(g,p,U))},enqueueReplaceState:function(p,g,C){p=p._reactInternals;var O=no(),U=xc(p),H=iu(O,U);H.tag=1,H.payload=g,C!=null&&(H.callback=C),g=mh(p,H,U),g!==null&&(Lc(g,p,U,O),y_(g,p,U))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var C=no(),O=xc(p),U=iu(C,O);U.tag=2,g!=null&&(U.callback=g),g=mh(p,U,O),g!==null&&(Lc(g,p,O,C),y_(g,p,O))}};function Db(p,g,C,O,U,H,ce){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,H,ce):g.prototype&&g.prototype.isPureReactComponent?!r_(C,O)||!r_(U,H):!0}function DI(p,g,C){var O=!1,U=dh,H=g.contextType;return typeof H=="object"&&H!==null?H=Oc(H):(U=Ea(g)?Vp:vo.current,O=g.contextTypes,H=(O=O!=null)?jp(p,U):dh),g=new g(C,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=zE,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=U,p.__reactInternalMemoizedMaskedChildContext=H),g}function xI(p,g,C,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,O),g.state!==p&&zE.enqueueReplaceState(g,g.state,null)}function xb(p,g,C,O){var U=p.stateNode;U.props=C,U.state=p.memoizedState,U.refs={},__(p);var H=g.contextType;typeof H=="object"&&H!==null?U.context=Oc(H):(H=Ea(g)?Vp:vo.current,U.context=jp(p,H)),U.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(WE(p,g,H,C),U.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(g=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),g!==U.state&&zE.enqueueReplaceState(U,U.state,null),ME(p,C,U,O),U.state=p.memoizedState),typeof U.componentDidMount=="function"&&(p.flags|=4194308)}function Pm(p,g){try{var C="",O=g;do C+=Ue(O),O=O.return;while(O);var U=C}catch(H){U=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:U,digest:null}}function Lb(p,g,C){return{value:p,source:null,stack:C??null,digest:g??null}}function Mb(p,g){try{console.error(g.value)}catch(C){setTimeout(function(){throw C})}}var fD=typeof WeakMap=="function"?WeakMap:Map;function Ub(p,g,C){C=iu(-1,C),C.tag=3,C.payload={element:null};var O=g.value;return C.callback=function(){av||(av=!0,qb=O),Mb(p,g)},C}function md(p,g,C){C=iu(-1,C),C.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var U=g.value;C.payload=function(){return O(U)},C.callback=function(){Mb(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(C.callback=function(){Mb(p,g),typeof O!="function"&&(Eh===null?Eh=new Set([this]):Eh.add(this));var ce=g.stack;this.componentDidCatch(g.value,{componentStack:ce!==null?ce:""})}),C}function LI(p,g,C){var O=p.pingCache;if(O===null){O=p.pingCache=new fD;var U=new Set;O.set(g,U)}else U=O.get(g),U===void 0&&(U=new Set,O.set(g,U));U.has(C)||(U.add(C),p=sA.bind(null,p,g,C),g.then(p,p))}function MI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function UI(p,g,C,O,U){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(g=iu(-1,1),g.tag=2,mh(C,g,1))),C.lanes|=1),p):(p.flags|=65536,p.lanes=U,p)}var mD=ae.ReactCurrentOwner,Ta=!1;function qo(p,g,C,O){g.child=p===null?gI(g,null,C,O):Sm(g,p.child,C,O)}function GE(p,g,C,O,U){C=C.render;var H=g.ref;return dd(g,U),O=Rm(p,g,C,O,H,U),C=Rb(),p!==null&&!Ta?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~U,au(p,g,U)):(pi&&C&&kE(g),g.flags|=1,qo(p,g,O,U),g.child)}function VI(p,g,C,O,U){if(p===null){var H=C.type;return typeof H=="function"&&!Sh(H)&&H.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(g.tag=15,g.type=H,jI(p,g,H,O,U)):(p=Ev(C.type,null,O,g,g.mode,U),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&U)===0){var ce=H.memoizedProps;if(C=C.compare,C=C!==null?C:r_,C(ce,O)&&p.ref===g.ref)return au(p,g,U)}return g.flags|=1,p=yd(H,O),p.ref=g.ref,p.return=g,g.child=p}function jI(p,g,C,O,U){if(p!==null){var H=p.memoizedProps;if(r_(H,O)&&p.ref===g.ref)if(Ta=!1,g.pendingProps=O=H,(p.lanes&U)!==0)(p.flags&131072)!==0&&(Ta=!0);else return g.lanes=p.lanes,au(p,g,U)}return Vb(p,g,C,O,U)}function FI(p,g,C){var O=g.pendingProps,U=O.children,H=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},bi(Sl,nc),nc|=C;else{if((C&1073741824)===0)return p=H!==null?H.baseLanes|C:C,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,bi(Sl,nc),nc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:C,bi(Sl,nc),nc|=O}else H!==null?(O=H.baseLanes|C,g.memoizedState=null):O=C,bi(Sl,nc),nc|=O;return qo(p,g,U,C),g.child}function BI(p,g){var C=g.ref;(p===null&&C!==null||p!==null&&p.ref!==C)&&(g.flags|=512,g.flags|=2097152)}function Vb(p,g,C,O,U){var H=Ea(C)?Vp:vo.current;return H=jp(g,H),dd(g,U),C=Rm(p,g,C,O,H,U),O=Rb(),p!==null&&!Ta?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~U,au(p,g,U)):(pi&&O&&kE(g),g.flags|=1,qo(p,g,C,U),g.child)}function WI(p,g,C,O,U){if(Ea(C)){var H=!0;IE(g)}else H=!1;if(dd(g,U),g.stateNode===null)XE(p,g),DI(g,C,O),xb(g,C,O,U),O=!0;else if(p===null){var ce=g.stateNode,Ae=g.memoizedProps;ce.props=Ae;var Le=ce.context,st=C.contextType;typeof st=="object"&&st!==null?st=Oc(st):(st=Ea(C)?Vp:vo.current,st=jp(g,st));var At=C.getDerivedStateFromProps,Pt=typeof At=="function"||typeof ce.getSnapshotBeforeUpdate=="function";Pt||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==O||Le!==st)&&xI(g,ce,O,st),fh=!1;var It=g.memoizedState;ce.state=It,ME(g,O,ce,U),Le=g.memoizedState,Ae!==O||It!==Le||ya.current||fh?(typeof At=="function"&&(WE(g,C,At,O),Le=g.memoizedState),(Ae=fh||Db(g,C,Ae,O,It,Le,st))?(Pt||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=Le),ce.props=O,ce.state=Le,ce.context=st,O=Ae):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ce=g.stateNode,yI(p,g),Ae=g.memoizedProps,st=g.type===g.elementType?Ae:tc(g.type,Ae),ce.props=st,Pt=g.pendingProps,It=ce.context,Le=C.contextType,typeof Le=="object"&&Le!==null?Le=Oc(Le):(Le=Ea(C)?Vp:vo.current,Le=jp(g,Le));var Kt=C.getDerivedStateFromProps;(At=typeof Kt=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==Pt||It!==Le)&&xI(g,ce,O,Le),fh=!1,It=g.memoizedState,ce.state=It,ME(g,O,ce,U);var tn=g.memoizedState;Ae!==Pt||It!==tn||ya.current||fh?(typeof Kt=="function"&&(WE(g,C,Kt,O),tn=g.memoizedState),(st=fh||Db(g,C,st,O,It,tn,Le)||!1)?(At||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(O,tn,Le),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(O,tn,Le)),typeof ce.componentDidUpdate=="function"&&(g.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&It===p.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&It===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=tn),ce.props=O,ce.state=tn,ce.context=Le,O=st):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&It===p.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&It===p.memoizedState||(g.flags|=1024),O=!1)}return HE(p,g,C,O,H,U)}function HE(p,g,C,O,U,H){BI(p,g);var ce=(g.flags&128)!==0;if(!O&&!ce)return U&&uI(g,C,!1),au(p,g,H);O=g.stateNode,mD.current=g;var Ae=ce&&typeof C.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&ce?(g.child=Sm(g,p.child,null,H),g.child=Sm(g,null,Ae,H)):qo(p,g,Ae,H),g.memoizedState=O.state,U&&uI(g,C,!0),g.child}function jb(p){var g=p.stateNode;g.pendingContext?lI(p,g.pendingContext,g.pendingContext!==g.context):g.context&&lI(p,g.context,!1),Sb(p,g.containerInfo)}function zI(p,g,C,O,U){return vm(),mb(U),g.flags|=256,qo(p,g,C,O),g.child}var Fb={dehydrated:null,treeContext:null,retryLane:0};function Om(p){return{baseLanes:p,cachePool:null,transitions:null}}function $E(p,g,C){var O=g.pendingProps,U=Di.current,H=!1,ce=(g.flags&128)!==0,Ae;if((Ae=ce)||(Ae=p!==null&&p.memoizedState===null?!1:(U&2)!==0),Ae?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(U|=1),bi(Di,U&1),p===null)return fb(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ce=O.children,p=O.fallback,H?(O=g.mode,H=g.child,ce={mode:"hidden",children:ce},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ce):H=bh(ce,O,0,null),p=Qp(p,O,C,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=Om(C),g.memoizedState=Fb,p):KE(g,ce));if(U=p.memoizedState,U!==null&&(Ae=U.dehydrated,Ae!==null))return GI(p,g,ce,O,Ae,U,C);if(H){H=O.fallback,ce=g.mode,U=p.child,Ae=U.sibling;var Le={mode:"hidden",children:O.children};return(ce&1)===0&&g.child!==U?(O=g.child,O.childLanes=0,O.pendingProps=Le,g.deletions=null):(O=yd(U,Le),O.subtreeFlags=U.subtreeFlags&14680064),Ae!==null?H=yd(Ae,H):(H=Qp(H,ce,C,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,ce=p.child.memoizedState,ce=ce===null?Om(C):{baseLanes:ce.baseLanes|C,cachePool:null,transitions:ce.transitions},H.memoizedState=ce,H.childLanes=p.childLanes&~C,g.memoizedState=Fb,O}return H=p.child,p=H.sibling,O=yd(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=C),O.return=g,O.sibling=null,p!==null&&(C=g.deletions,C===null?(g.deletions=[p],g.flags|=16):C.push(p)),g.child=O,g.memoizedState=null,O}function KE(p,g){return g=bh({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function $p(p,g,C,O){return O!==null&&mb(O),Sm(g,p.child,null,C),p=KE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function GI(p,g,C,O,U,H,ce){if(C)return g.flags&256?(g.flags&=-257,O=Lb(Error(i(422))),$p(p,g,ce,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=O.fallback,U=g.mode,O=bh({mode:"visible",children:O.children},U,0,null),H=Qp(H,U,ce,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&Sm(g,p.child,null,ce),g.child.memoizedState=Om(ce),g.memoizedState=Fb,H);if((g.mode&1)===0)return $p(p,g,ce,null);if(U.data==="$!"){if(O=U.nextSibling&&U.nextSibling.dataset,O)var Ae=O.dgst;return O=Ae,H=Error(i(419)),O=Lb(H,O,void 0),$p(p,g,ce,O)}if(Ae=(ce&p.childLanes)!==0,Ta||Ae){if(O=Gs,O!==null){switch(ce&-ce){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(O.suspendedLanes|ce))!==0?0:U,U!==0&&U!==H.retryLane&&(H.retryLane=U,hd(p,U),Lc(O,p,U,-1))}return Jb(),O=Lb(Error(i(421))),$p(p,g,ce,O)}return U.data==="$?"?(g.flags|=128,g.child=p.child,g=gv.bind(null,p),U._reactRetry=g,null):(p=H.treeContext,Sa=lh(U.nextSibling),va=g,pi=!0,$o=null,p!==null&&(Pc[ec++]=cd,Pc[ec++]=ld,Pc[ec++]=Fp,cd=p.id,ld=p.overflow,Fp=g),g=KE(g,O.children),g.flags|=4096,g)}function HI(p,g,C){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),Eb(p.return,g,C)}function qE(p,g,C,O,U){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:C,tailMode:U}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=C,H.tailMode=U)}function YE(p,g,C){var O=g.pendingProps,U=O.revealOrder,H=O.tail;if(qo(p,g,O.children,C),O=Di.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&HI(p,C,g);else if(p.tag===19)HI(p,C,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(bi(Di,O),(g.mode&1)===0)g.memoizedState=null;else switch(U){case"forwards":for(C=g.child,U=null;C!==null;)p=C.alternate,p!==null&&gh(p)===null&&(U=C),C=C.sibling;C=U,C===null?(U=g.child,g.child=null):(U=C.sibling,C.sibling=null),qE(g,!1,U,C,H);break;case"backwards":for(C=null,U=g.child,g.child=null;U!==null;){if(p=U.alternate,p!==null&&gh(p)===null){g.child=U;break}p=U.sibling,U.sibling=C,C=U,U=p}qE(g,!0,C,null,H);break;case"together":qE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function XE(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function au(p,g,C){if(p!==null&&(g.dependencies=p.dependencies),Kp|=g.lanes,(C&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(i(153));if(g.child!==null){for(p=g.child,C=yd(p,p.pendingProps),g.child=C,C.return=g;p.sibling!==null;)p=p.sibling,C=C.sibling=yd(p,p.pendingProps),C.return=g;C.sibling=null}return g.child}function $I(p,g,C){switch(g.tag){case 3:jb(g),vm();break;case 5:SI(g);break;case 1:Ea(g.type)&&IE(g);break;case 4:Sb(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,U=g.memoizedProps.value;bi(xE,O._currentValue),O._currentValue=U;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(bi(Di,Di.current&1),g.flags|=128,null):(C&g.child.childLanes)!==0?$E(p,g,C):(bi(Di,Di.current&1),p=au(p,g,C),p!==null?p.sibling:null);bi(Di,Di.current&1);break;case 19:if(O=(C&g.childLanes)!==0,(p.flags&128)!==0){if(O)return YE(p,g,C);g.flags|=128}if(U=g.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),bi(Di,Di.current),O)break;return null;case 22:case 23:return g.lanes=0,FI(p,g,C)}return au(p,g,C)}var KI,JE,Bb,qI;KI=function(p,g){for(var C=g.child;C!==null;){if(C.tag===5||C.tag===6)p.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===g)break;for(;C.sibling===null;){if(C.return===null||C.return===g)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},JE=function(){},Bb=function(p,g,C,O){var U=p.memoizedProps;if(U!==O){p=g.stateNode,Wp(su.current);var H=null;switch(C){case"input":U=jn(p,U),O=jn(p,O),H=[];break;case"select":U=Be({},U,{value:void 0}),O=Be({},O,{value:void 0}),H=[];break;case"textarea":U=vt(p,U),O=vt(p,O),H=[];break;default:typeof U.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=TE)}$a(C,O);var ce;C=null;for(st in U)if(!O.hasOwnProperty(st)&&U.hasOwnProperty(st)&&U[st]!=null)if(st==="style"){var Ae=U[st];for(ce in Ae)Ae.hasOwnProperty(ce)&&(C||(C={}),C[ce]="")}else st!=="dangerouslySetInnerHTML"&&st!=="children"&&st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(l.hasOwnProperty(st)?H||(H=[]):(H=H||[]).push(st,null));for(st in O){var Le=O[st];if(Ae=U!=null?U[st]:void 0,O.hasOwnProperty(st)&&Le!==Ae&&(Le!=null||Ae!=null))if(st==="style")if(Ae){for(ce in Ae)!Ae.hasOwnProperty(ce)||Le&&Le.hasOwnProperty(ce)||(C||(C={}),C[ce]="");for(ce in Le)Le.hasOwnProperty(ce)&&Ae[ce]!==Le[ce]&&(C||(C={}),C[ce]=Le[ce])}else C||(H||(H=[]),H.push(st,C)),C=Le;else st==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Ae=Ae?Ae.__html:void 0,Le!=null&&Ae!==Le&&(H=H||[]).push(st,Le)):st==="children"?typeof Le!="string"&&typeof Le!="number"||(H=H||[]).push(st,""+Le):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&(l.hasOwnProperty(st)?(Le!=null&&st==="onScroll"&&Ai("scroll",p),H||Ae===Le||(H=[])):(H=H||[]).push(st,Le))}C&&(H=H||[]).push("style",C);var st=H;(g.updateQueue=st)&&(g.flags|=4)}},qI=function(p,g,C,O){C!==O&&(g.flags|=4)};function C_(p,g){if(!pi)switch(p.tailMode){case"hidden":g=p.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?p.tail=null:C.sibling=null;break;case"collapsed":C=p.tail;for(var O=null;C!==null;)C.alternate!==null&&(O=C),C=C.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function bo(p){var g=p.alternate!==null&&p.alternate.child===p.child,C=0,O=0;if(g)for(var U=p.child;U!==null;)C|=U.lanes|U.childLanes,O|=U.subtreeFlags&14680064,O|=U.flags&14680064,U.return=p,U=U.sibling;else for(U=p.child;U!==null;)C|=U.lanes|U.childLanes,O|=U.subtreeFlags,O|=U.flags,U.return=p,U=U.sibling;return p.subtreeFlags|=O,p.childLanes=C,g}function QE(p,g,C){var O=g.pendingProps;switch(p_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bo(g),null;case 1:return Ea(g.type)&&CE(),bo(g),null;case 3:return O=g.stateNode,zp(),Pi(ya),Pi(vo),Tb(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(f_(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,$o!==null&&(hv($o),$o=null))),JE(p,g),bo(g),null;case 5:wm(g);var U=Wp(Tm.current);if(C=g.type,p!==null&&g.stateNode!=null)Bb(p,g,C,O,U),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(i(166));return bo(g),null}if(p=Wp(su.current),f_(g)){O=g.stateNode,C=g.type;var H=g.memoizedProps;switch(O[ru]=g,O[uh]=H,p=(g.mode&1)!==0,C){case"dialog":Ai("cancel",O),Ai("close",O);break;case"iframe":case"object":case"embed":Ai("load",O);break;case"video":case"audio":for(U=0;U<a_.length;U++)Ai(a_[U],O);break;case"source":Ai("error",O);break;case"img":case"image":case"link":Ai("error",O),Ai("load",O);break;case"details":Ai("toggle",O);break;case"input":Qt(O,H),Ai("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},Ai("invalid",O);break;case"textarea":St(O,H),Ai("invalid",O)}$a(C,H),U=null;for(var ce in H)if(H.hasOwnProperty(ce)){var Ae=H[ce];ce==="children"?typeof Ae=="string"?O.textContent!==Ae&&(H.suppressHydrationWarning!==!0&&bE(O.textContent,Ae,p),U=["children",Ae]):typeof Ae=="number"&&O.textContent!==""+Ae&&(H.suppressHydrationWarning!==!0&&bE(O.textContent,Ae,p),U=["children",""+Ae]):l.hasOwnProperty(ce)&&Ae!=null&&ce==="onScroll"&&Ai("scroll",O)}switch(C){case"input":Vt(O),Ce(O,H,!0);break;case"textarea":Vt(O),fn(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=TE)}O=U,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ce=U.nodeType===9?U:U.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=mn(C)),p==="http://www.w3.org/1999/xhtml"?C==="script"?(p=ce.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ce.createElement(C,{is:O.is}):(p=ce.createElement(C),C==="select"&&(ce=p,O.multiple?ce.multiple=!0:O.size&&(ce.size=O.size))):p=ce.createElementNS(p,C),p[ru]=g,p[uh]=O,KI(p,g,!1,!1),g.stateNode=p;e:{switch(ce=dl(C,O),C){case"dialog":Ai("cancel",p),Ai("close",p),U=O;break;case"iframe":case"object":case"embed":Ai("load",p),U=O;break;case"video":case"audio":for(U=0;U<a_.length;U++)Ai(a_[U],p);U=O;break;case"source":Ai("error",p),U=O;break;case"img":case"image":case"link":Ai("error",p),Ai("load",p),U=O;break;case"details":Ai("toggle",p),U=O;break;case"input":Qt(p,O),U=jn(p,O),Ai("invalid",p);break;case"option":U=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},U=Be({},O,{value:void 0}),Ai("invalid",p);break;case"textarea":St(p,O),U=vt(p,O),Ai("invalid",p);break;default:U=O}$a(C,U),Ae=U;for(H in Ae)if(Ae.hasOwnProperty(H)){var Le=Ae[H];H==="style"?Qs(p,Le):H==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&mc(p,Le)):H==="children"?typeof Le=="string"?(C!=="textarea"||Le!=="")&&Bt(p,Le):typeof Le=="number"&&Bt(p,""+Le):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Le!=null&&H==="onScroll"&&Ai("scroll",p):Le!=null&&Q(p,H,Le,ce))}switch(C){case"input":Vt(p),Ce(p,O,!1);break;case"textarea":Vt(p),fn(p);break;case"option":O.value!=null&&p.setAttribute("value",""+ct(O.value));break;case"select":p.multiple=!!O.multiple,H=O.value,H!=null?_t(p,!!O.multiple,H,!1):O.defaultValue!=null&&_t(p,!!O.multiple,O.defaultValue,!0);break;default:typeof U.onClick=="function"&&(p.onclick=TE)}switch(C){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return bo(g),null;case 6:if(p&&g.stateNode!=null)qI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(i(166));if(C=Wp(Tm.current),Wp(su.current),f_(g)){if(O=g.stateNode,C=g.memoizedProps,O[ru]=g,(H=O.nodeValue!==C)&&(p=va,p!==null))switch(p.tag){case 3:bE(O.nodeValue,C,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&bE(O.nodeValue,C,(p.mode&1)!==0)}H&&(g.flags|=4)}else O=(C.nodeType===9?C:C.ownerDocument).createTextNode(O),O[ru]=g,g.stateNode=O}return bo(g),null;case 13:if(Pi(Di),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(pi&&Sa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)mI(),vm(),g.flags|=98560,H=!1;else if(H=f_(g),O!==null&&O.dehydrated!==null){if(p===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[ru]=g}else vm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;bo(g),H=!1}else $o!==null&&(hv($o),$o=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=C,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Di.current&1)!==0?_s===0&&(_s=3):Jb())),g.updateQueue!==null&&(g.flags|=4),bo(g),null);case 4:return zp(),JE(p,g),p===null&&xp(g.stateNode.containerInfo),bo(g),null;case 10:return yb(g.type._context),bo(g),null;case 17:return Ea(g.type)&&CE(),bo(g),null;case 19:if(Pi(Di),H=g.memoizedState,H===null)return bo(g),null;if(O=(g.flags&128)!==0,ce=H.rendering,ce===null)if(O)C_(H,!1);else{if(_s!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ce=gh(p),ce!==null){for(g.flags|=128,C_(H,!1),O=ce.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=C,C=g.child;C!==null;)H=C,p=O,H.flags&=14680066,ce=H.alternate,ce===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ce.childLanes,H.lanes=ce.lanes,H.child=ce.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ce.memoizedProps,H.memoizedState=ce.memoizedState,H.updateQueue=ce.updateQueue,H.type=ce.type,p=ce.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),C=C.sibling;return bi(Di,Di.current&1|2),g.child}p=p.sibling}H.tail!==null&&$r()>Dm&&(g.flags|=128,O=!0,C_(H,!1),g.lanes=4194304)}else{if(!O)if(p=gh(ce),p!==null){if(g.flags|=128,O=!0,C=p.updateQueue,C!==null&&(g.updateQueue=C,g.flags|=4),C_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ce.alternate&&!pi)return bo(g),null}else 2*$r()-H.renderingStartTime>Dm&&C!==1073741824&&(g.flags|=128,O=!0,C_(H,!1),g.lanes=4194304);H.isBackwards?(ce.sibling=g.child,g.child=ce):(C=H.last,C!==null?C.sibling=ce:g.child=ce,H.last=ce)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=$r(),g.sibling=null,C=Di.current,bi(Di,O?C&1|2:C&1),g):(bo(g),null);case 22:case 23:return D_(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(nc&1073741824)!==0&&(bo(g),g.subtreeFlags&6&&(g.flags|=8192)):bo(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function gD(p,g){switch(p_(g),g.tag){case 1:return Ea(g.type)&&CE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return zp(),Pi(ya),Pi(vo),Tb(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return wm(g),null;case 13:if(Pi(Di),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(i(340));vm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Pi(Di),null;case 4:return zp(),null;case 10:return yb(g.type._context),null;case 22:case 23:return D_(),null;case 24:return null;default:return null}}var ZE=!1,To=!1,YI=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function km(p,g){var C=p.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(O){Vi(p,g,O)}else C.current=null}function R_(p,g,C){try{C()}catch(O){Vi(p,g,O)}}var XI=!1;function Wb(p,g){if(wE=be,p=JR(),i_(p)){if("selectionStart"in p)var C={start:p.selectionStart,end:p.selectionEnd};else e:{C=(C=p.ownerDocument)&&C.defaultView||window;var O=C.getSelection&&C.getSelection();if(O&&O.rangeCount!==0){C=O.anchorNode;var U=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{C.nodeType,H.nodeType}catch{C=null;break e}var ce=0,Ae=-1,Le=-1,st=0,At=0,Pt=p,It=null;t:for(;;){for(var Kt;Pt!==C||U!==0&&Pt.nodeType!==3||(Ae=ce+U),Pt!==H||O!==0&&Pt.nodeType!==3||(Le=ce+O),Pt.nodeType===3&&(ce+=Pt.nodeValue.length),(Kt=Pt.firstChild)!==null;)It=Pt,Pt=Kt;for(;;){if(Pt===p)break t;if(It===C&&++st===U&&(Ae=ce),It===H&&++At===O&&(Le=ce),(Kt=Pt.nextSibling)!==null)break;Pt=It,It=Pt.parentNode}Pt=Kt}C=Ae===-1||Le===-1?null:{start:Ae,end:Le}}else C=null}C=C||{start:0,end:0}}else C=null;for(l_={focusedElem:p,selectionRange:C},be=!1,Zt=g;Zt!==null;)if(g=Zt,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,Zt=p;else for(;Zt!==null;){g=Zt;try{var tn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var nn=tn.memoizedProps,Zi=tn.memoizedState,Ze=g.stateNode,je=Ze.getSnapshotBeforeUpdate(g.elementType===g.type?nn:tc(g.type,nn),Zi);Ze.__reactInternalSnapshotBeforeUpdate=je}break;case 3:var nt=g.stateNode.containerInfo;nt.nodeType===1?nt.textContent="":nt.nodeType===9&&nt.documentElement&&nt.removeChild(nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(xt){Vi(g,g.return,xt)}if(p=g.sibling,p!==null){p.return=g.return,Zt=p;break}Zt=g.return}return tn=XI,XI=!1,tn}function I_(p,g,C){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var U=O=O.next;do{if((U.tag&p)===p){var H=U.destroy;U.destroy=void 0,H!==void 0&&R_(g,C,H)}U=U.next}while(U!==O)}}function A_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var C=g=g.next;do{if((C.tag&p)===p){var O=C.create;C.destroy=O()}C=C.next}while(C!==g)}}function zb(p){var g=p.ref;if(g!==null){var C=p.stateNode;switch(p.tag){case 5:p=C;break;default:p=C}typeof g=="function"?g(p):g.current=p}}function JI(p){var g=p.alternate;g!==null&&(p.alternate=null,JI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[ru],delete g[uh],delete g[d_],delete g[sD],delete g[oD])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Gb(p){return p.tag===5||p.tag===3||p.tag===4}function QI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Gb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Hb(p,g,C){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?C.nodeType===8?C.parentNode.insertBefore(p,g):C.insertBefore(p,g):(C.nodeType===8?(g=C.parentNode,g.insertBefore(p,C)):(g=C,g.appendChild(p)),C=C._reactRootContainer,C!=null||g.onclick!==null||(g.onclick=TE));else if(O!==4&&(p=p.child,p!==null))for(Hb(p,g,C),p=p.sibling;p!==null;)Hb(p,g,C),p=p.sibling}function ev(p,g,C){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?C.insertBefore(p,g):C.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(ev(p,g,C),p=p.sibling;p!==null;)ev(p,g,C),p=p.sibling}var eo=null,Nc=!1;function cu(p,g,C){for(C=C.child;C!==null;)ZI(p,g,C),C=C.sibling}function ZI(p,g,C){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(Yl,C)}catch{}switch(C.tag){case 5:To||km(C,g);case 6:var O=eo,U=Nc;eo=null,cu(p,g,C),eo=O,Nc=U,eo!==null&&(Nc?(p=eo,C=C.stateNode,p.nodeType===8?p.parentNode.removeChild(C):p.removeChild(C)):eo.removeChild(C.stateNode));break;case 18:eo!==null&&(Nc?(p=eo,C=C.stateNode,p.nodeType===8?db(p.parentNode,C):p.nodeType===1&&db(p,C),ga(p)):db(eo,C.stateNode));break;case 4:O=eo,U=Nc,eo=C.stateNode.containerInfo,Nc=!0,cu(p,g,C),eo=O,Nc=U;break;case 0:case 11:case 14:case 15:if(!To&&(O=C.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){U=O=O.next;do{var H=U,ce=H.destroy;H=H.tag,ce!==void 0&&((H&2)!==0||(H&4)!==0)&&R_(C,g,ce),U=U.next}while(U!==O)}cu(p,g,C);break;case 1:if(!To&&(km(C,g),O=C.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=C.memoizedProps,O.state=C.memoizedState,O.componentWillUnmount()}catch(Ae){Vi(C,g,Ae)}cu(p,g,C);break;case 21:cu(p,g,C);break;case 22:C.mode&1?(To=(O=To)||C.memoizedState!==null,cu(p,g,C),To=O):cu(p,g,C);break;default:cu(p,g,C)}}function eA(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var C=p.stateNode;C===null&&(C=p.stateNode=new YI),g.forEach(function(O){var U=oA.bind(null,p,O);C.has(O)||(C.add(O),O.then(U,U))})}}function Yo(p,g){var C=g.deletions;if(C!==null)for(var O=0;O<C.length;O++){var U=C[O];try{var H=p,ce=g,Ae=ce;e:for(;Ae!==null;){switch(Ae.tag){case 5:eo=Ae.stateNode,Nc=!1;break e;case 3:eo=Ae.stateNode.containerInfo,Nc=!0;break e;case 4:eo=Ae.stateNode.containerInfo,Nc=!0;break e}Ae=Ae.return}if(eo===null)throw Error(i(160));ZI(H,ce,U),eo=null,Nc=!1;var Le=U.alternate;Le!==null&&(Le.return=null),U.return=null}catch(st){Vi(U,g,st)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)$b(g,p),g=g.sibling}function $b(p,g){var C=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Yo(g,p),wa(p),O&4){try{I_(3,p,p.return),A_(3,p)}catch(nn){Vi(p,p.return,nn)}try{I_(5,p,p.return)}catch(nn){Vi(p,p.return,nn)}}break;case 1:Yo(g,p),wa(p),O&512&&C!==null&&km(C,C.return);break;case 5:if(Yo(g,p),wa(p),O&512&&C!==null&&km(C,C.return),p.flags&32){var U=p.stateNode;try{Bt(U,"")}catch(nn){Vi(p,p.return,nn)}}if(O&4&&(U=p.stateNode,U!=null)){var H=p.memoizedProps,ce=C!==null?C.memoizedProps:H,Ae=p.type,Le=p.updateQueue;if(p.updateQueue=null,Le!==null)try{Ae==="input"&&H.type==="radio"&&H.name!=null&&Ot(U,H),dl(Ae,ce);var st=dl(Ae,H);for(ce=0;ce<Le.length;ce+=2){var At=Le[ce],Pt=Le[ce+1];At==="style"?Qs(U,Pt):At==="dangerouslySetInnerHTML"?mc(U,Pt):At==="children"?Bt(U,Pt):Q(U,At,Pt,st)}switch(Ae){case"input":Lt(U,H);break;case"textarea":Ht(U,H);break;case"select":var It=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!H.multiple;var Kt=H.value;Kt!=null?_t(U,!!H.multiple,Kt,!1):It!==!!H.multiple&&(H.defaultValue!=null?_t(U,!!H.multiple,H.defaultValue,!0):_t(U,!!H.multiple,H.multiple?[]:"",!1))}U[uh]=H}catch(nn){Vi(p,p.return,nn)}}break;case 6:if(Yo(g,p),wa(p),O&4){if(p.stateNode===null)throw Error(i(162));U=p.stateNode,H=p.memoizedProps;try{U.nodeValue=H}catch(nn){Vi(p,p.return,nn)}}break;case 3:if(Yo(g,p),wa(p),O&4&&C!==null&&C.memoizedState.isDehydrated)try{ga(g.containerInfo)}catch(nn){Vi(p,p.return,nn)}break;case 4:Yo(g,p),wa(p);break;case 13:Yo(g,p),wa(p),U=p.child,U.flags&8192&&(H=U.memoizedState!==null,U.stateNode.isHidden=H,!H||U.alternate!==null&&U.alternate.memoizedState!==null||(ov=$r())),O&4&&eA(p);break;case 22:if(At=C!==null&&C.memoizedState!==null,p.mode&1?(To=(st=To)||At,Yo(g,p),To=st):Yo(g,p),wa(p),O&8192){if(st=p.memoizedState!==null,(p.stateNode.isHidden=st)&&!At&&(p.mode&1)!==0)for(Zt=p,At=p.child;At!==null;){for(Pt=Zt=At;Zt!==null;){switch(It=Zt,Kt=It.child,It.tag){case 0:case 11:case 14:case 15:I_(4,It,It.return);break;case 1:km(It,It.return);var tn=It.stateNode;if(typeof tn.componentWillUnmount=="function"){O=It,C=It.return;try{g=O,tn.props=g.memoizedProps,tn.state=g.memoizedState,tn.componentWillUnmount()}catch(nn){Vi(O,C,nn)}}break;case 5:km(It,It.return);break;case 22:if(It.memoizedState!==null){P_(Pt);continue}}Kt!==null?(Kt.return=It,Zt=Kt):P_(Pt)}At=At.sibling}e:for(At=null,Pt=p;;){if(Pt.tag===5){if(At===null){At=Pt;try{U=Pt.stateNode,st?(H=U.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ae=Pt.stateNode,Le=Pt.memoizedProps.style,ce=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Ae.style.display=Fs("display",ce))}catch(nn){Vi(p,p.return,nn)}}}else if(Pt.tag===6){if(At===null)try{Pt.stateNode.nodeValue=st?"":Pt.memoizedProps}catch(nn){Vi(p,p.return,nn)}}else if((Pt.tag!==22&&Pt.tag!==23||Pt.memoizedState===null||Pt===p)&&Pt.child!==null){Pt.child.return=Pt,Pt=Pt.child;continue}if(Pt===p)break e;for(;Pt.sibling===null;){if(Pt.return===null||Pt.return===p)break e;At===Pt&&(At=null),Pt=Pt.return}At===Pt&&(At=null),Pt.sibling.return=Pt.return,Pt=Pt.sibling}}break;case 19:Yo(g,p),wa(p),O&4&&eA(p);break;case 21:break;default:Yo(g,p),wa(p)}}function wa(p){var g=p.flags;if(g&2){try{e:{for(var C=p.return;C!==null;){if(Gb(C)){var O=C;break e}C=C.return}throw Error(i(160))}switch(O.tag){case 5:var U=O.stateNode;O.flags&32&&(Bt(U,""),O.flags&=-33);var H=QI(p);ev(p,H,U);break;case 3:case 4:var ce=O.stateNode.containerInfo,Ae=QI(p);Hb(p,Ae,ce);break;default:throw Error(i(161))}}catch(Le){Vi(p,p.return,Le)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Nm(p,g,C){Zt=p,Kb(p)}function Kb(p,g,C){for(var O=(p.mode&1)!==0;Zt!==null;){var U=Zt,H=U.child;if(U.tag===22&&O){var ce=U.memoizedState!==null||ZE;if(!ce){var Ae=U.alternate,Le=Ae!==null&&Ae.memoizedState!==null||To;Ae=ZE;var st=To;if(ZE=ce,(To=Le)&&!st)for(Zt=U;Zt!==null;)ce=Zt,Le=ce.child,ce.tag===22&&ce.memoizedState!==null?tA(U):Le!==null?(Le.return=ce,Zt=Le):tA(U);for(;H!==null;)Zt=H,Kb(H),H=H.sibling;Zt=U,ZE=Ae,To=st}tv(p)}else(U.subtreeFlags&8772)!==0&&H!==null?(H.return=U,Zt=H):tv(p)}}function tv(p){for(;Zt!==null;){var g=Zt;if((g.flags&8772)!==0){var C=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:To||A_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!To)if(C===null)O.componentDidMount();else{var U=g.elementType===g.type?C.memoizedProps:tc(g.type,C.memoizedProps);O.componentDidUpdate(U,C.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&vI(g,H,O);break;case 3:var ce=g.updateQueue;if(ce!==null){if(C=null,g.child!==null)switch(g.child.tag){case 5:C=g.child.stateNode;break;case 1:C=g.child.stateNode}vI(g,ce,C)}break;case 5:var Ae=g.stateNode;if(C===null&&g.flags&4){C=Ae;var Le=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&C.focus();break;case"img":Le.src&&(C.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var st=g.alternate;if(st!==null){var At=st.memoizedState;if(At!==null){var Pt=At.dehydrated;Pt!==null&&ga(Pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}To||g.flags&512&&zb(g)}catch(It){Vi(g,g.return,It)}}if(g===p){Zt=null;break}if(C=g.sibling,C!==null){C.return=g.return,Zt=C;break}Zt=g.return}}function P_(p){for(;Zt!==null;){var g=Zt;if(g===p){Zt=null;break}var C=g.sibling;if(C!==null){C.return=g.return,Zt=C;break}Zt=g.return}}function tA(p){for(;Zt!==null;){var g=Zt;try{switch(g.tag){case 0:case 11:case 15:var C=g.return;try{A_(4,g)}catch(Le){Vi(g,C,Le)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var U=g.return;try{O.componentDidMount()}catch(Le){Vi(g,U,Le)}}var H=g.return;try{zb(g)}catch(Le){Vi(g,H,Le)}break;case 5:var ce=g.return;try{zb(g)}catch(Le){Vi(g,ce,Le)}}}catch(Le){Vi(g,g.return,Le)}if(g===p){Zt=null;break}var Ae=g.sibling;if(Ae!==null){Ae.return=g.return,Zt=Ae;break}Zt=g.return}}var _D=Math.ceil,nv=ae.ReactCurrentDispatcher,rv=ae.ReactCurrentOwner,Dc=ae.ReactCurrentBatchConfig,Or=0,Gs=null,Qi=null,gs=0,nc=0,Sl=Ic(0),_s=0,to=null,Kp=0,iv=0,sv=0,O_=null,Xo=null,ov=0,Dm=1/0,lu=null,av=!1,qb=null,Eh=null,xm=!1,uu=null,cv=0,qp=0,Yb=null,k_=-1,lv=0;function no(){return(Or&6)!==0?$r():k_!==-1?k_:k_=$r()}function xc(p){return(p.mode&1)===0?1:(Or&2)!==0&&gs!==0?gs&-gs:cD.transition!==null?(lv===0&&(lv=ed()),lv):(p=lr,p!==0||(p=window.event,p=p===void 0?16:Kr(p.type)),p)}function Lc(p,g,C,O){if(50<qp)throw qp=0,Yb=null,Error(i(185));Ql(p,C,O),((Or&2)===0||p!==Gs)&&(p===Gs&&((Or&2)===0&&(iv|=C),_s===4&&gd(p,gs)),wo(p,O),C===1&&Or===0&&(g.mode&1)===0&&(Dm=$r()+500,AE&&hh()))}function wo(p,g){var C=p.callbackNode;Ya(p,g);var O=Jl(p,p===Gs?gs:0);if(O===0)C!==null&&Qu(C),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(C!=null&&Qu(C),g===1)p.tag===0?aD(Yp.bind(null,p)):dI(Yp.bind(null,p)),rD(function(){(Or&6)===0&&hh()}),C=null;else{switch(Sc(O)){case 1:C=vc;break;case 4:C=fl;break;case 16:C=fa;break;case 536870912:C=rh;break;default:C=fa}C=x_(C,uv.bind(null,p))}p.callbackPriority=g,p.callbackNode=C}}function uv(p,g){if(k_=-1,lv=0,(Or&6)!==0)throw Error(i(327));var C=p.callbackNode;if(Lm()&&p.callbackNode!==C)return null;var O=Jl(p,p===Gs?gs:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=du(p,O);else{g=O;var U=Or;Or|=2;var H=nA();(Gs!==p||gs!==g)&&(lu=null,Dm=$r()+500,vh(p,g));do try{yD();break}catch(Ae){Xb(p,Ae)}while(!0);_b(),nv.current=H,Or=U,Qi!==null?g=0:(Gs=null,gs=0,g=_s)}if(g!==0){if(g===2&&(U=Lo(p),U!==0&&(O=U,g=dv(p,U))),g===1)throw C=to,vh(p,0),gd(p,O),wo(p,$r()),C;if(g===6)gd(p,O);else{if(U=p.current.alternate,(O&30)===0&&!pv(U)&&(g=du(p,O),g===2&&(H=Lo(p),H!==0&&(O=H,g=dv(p,H))),g===1))throw C=to,vh(p,0),gd(p,O),wo(p,$r()),C;switch(p.finishedWork=U,p.finishedLanes=O,g){case 0:case 1:throw Error(i(345));case 2:Xp(p,Xo,lu);break;case 3:if(gd(p,O),(O&130023424)===O&&(g=ov+500-$r(),10<g)){if(Jl(p,0)!==0)break;if(U=p.suspendedLanes,(U&O)!==O){no(),p.pingedLanes|=p.suspendedLanes&U;break}p.timeoutHandle=u_(Xp.bind(null,p,Xo,lu),g);break}Xp(p,Xo,lu);break;case 4:if(gd(p,O),(O&4194240)===O)break;for(g=p.eventTimes,U=-1;0<O;){var ce=31-Zs(O);H=1<<ce,ce=g[ce],ce>U&&(U=ce),O&=~H}if(O=U,O=$r()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*_D(O/1960))-O,10<O){p.timeoutHandle=u_(Xp.bind(null,p,Xo,lu),O);break}Xp(p,Xo,lu);break;case 5:Xp(p,Xo,lu);break;default:throw Error(i(329))}}}return wo(p,$r()),p.callbackNode===C?uv.bind(null,p):null}function dv(p,g){var C=O_;return p.current.memoizedState.isDehydrated&&(vh(p,g).flags|=256),p=du(p,g),p!==2&&(g=Xo,Xo=C,g!==null&&hv(g)),p}function hv(p){Xo===null?Xo=p:Xo.push.apply(Xo,p)}function pv(p){for(var g=p;;){if(g.flags&16384){var C=g.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var O=0;O<C.length;O++){var U=C[O],H=U.getSnapshot;U=U.value;try{if(!vl(H(),U))return!1}catch{return!1}}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function gd(p,g){for(g&=~sv,g&=~iv,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var C=31-Zs(g),O=1<<C;p[C]=-1,g&=~O}}function Yp(p){if((Or&6)!==0)throw Error(i(327));Lm();var g=Jl(p,0);if((g&1)===0)return wo(p,$r()),null;var C=du(p,g);if(p.tag!==0&&C===2){var O=Lo(p);O!==0&&(g=O,C=dv(p,O))}if(C===1)throw C=to,vh(p,0),gd(p,g),wo(p,$r()),C;if(C===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Xp(p,Xo,lu),wo(p,$r()),null}function N_(p,g){var C=Or;Or|=1;try{return p(g)}finally{Or=C,Or===0&&(Dm=$r()+500,AE&&hh())}}function _d(p){uu!==null&&uu.tag===0&&(Or&6)===0&&Lm();var g=Or;Or|=1;var C=Dc.transition,O=lr;try{if(Dc.transition=null,lr=1,p)return p()}finally{lr=O,Dc.transition=C,Or=g,(Or&6)===0&&hh()}}function D_(){nc=Sl.current,Pi(Sl)}function vh(p,g){p.finishedWork=null,p.finishedLanes=0;var C=p.timeoutHandle;if(C!==-1&&(p.timeoutHandle=-1,nD(C)),Qi!==null)for(C=Qi.return;C!==null;){var O=C;switch(p_(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&CE();break;case 3:zp(),Pi(ya),Pi(vo),Tb();break;case 5:wm(O);break;case 4:zp();break;case 13:Pi(Di);break;case 19:Pi(Di);break;case 10:yb(O.type._context);break;case 22:case 23:D_()}C=C.return}if(Gs=p,Qi=p=yd(p.current,null),gs=nc=g,_s=0,to=null,sv=iv=Kp=0,Xo=O_=null,Bp!==null){for(g=0;g<Bp.length;g++)if(C=Bp[g],O=C.interleaved,O!==null){C.interleaved=null;var U=O.next,H=C.pending;if(H!==null){var ce=H.next;H.next=U,O.next=ce}C.pending=O}Bp=null}return p}function Xb(p,g){do{var C=Qi;try{if(_b(),UE.current=BE,Cm){for(var O=Ui.memoizedState;O!==null;){var U=O.queue;U!==null&&(U.pending=null),O=O.next}Cm=!1}if(ou=0,ms=fs=Ui=null,S_=!1,b_=0,rv.current=null,C===null||C.return===null){_s=1,to=g,Qi=null;break}e:{var H=p,ce=C.return,Ae=C,Le=g;if(g=gs,Ae.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var st=Le,At=Ae,Pt=At.tag;if((At.mode&1)===0&&(Pt===0||Pt===11||Pt===15)){var It=At.alternate;It?(At.updateQueue=It.updateQueue,At.memoizedState=It.memoizedState,At.lanes=It.lanes):(At.updateQueue=null,At.memoizedState=null)}var Kt=MI(ce);if(Kt!==null){Kt.flags&=-257,UI(Kt,ce,Ae,H,g),Kt.mode&1&&LI(H,st,g),g=Kt,Le=st;var tn=g.updateQueue;if(tn===null){var nn=new Set;nn.add(Le),g.updateQueue=nn}else tn.add(Le);break e}else{if((g&1)===0){LI(H,st,g),Jb();break e}Le=Error(i(426))}}else if(pi&&Ae.mode&1){var Zi=MI(ce);if(Zi!==null){(Zi.flags&65536)===0&&(Zi.flags|=256),UI(Zi,ce,Ae,H,g),mb(Pm(Le,Ae));break e}}H=Le=Pm(Le,Ae),_s!==4&&(_s=2),O_===null?O_=[H]:O_.push(H),H=ce;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Ze=Ub(H,Le,g);EI(H,Ze);break e;case 1:Ae=Le;var je=H.type,nt=H.stateNode;if((H.flags&128)===0&&(typeof je.getDerivedStateFromError=="function"||nt!==null&&typeof nt.componentDidCatch=="function"&&(Eh===null||!Eh.has(nt)))){H.flags|=65536,g&=-g,H.lanes|=g;var xt=md(H,Ae,g);EI(H,xt);break e}}H=H.return}while(H!==null)}iA(C)}catch(rn){g=rn,Qi===C&&C!==null&&(Qi=C=C.return);continue}break}while(!0)}function nA(){var p=nv.current;return nv.current=BE,p===null?BE:p}function Jb(){(_s===0||_s===3||_s===2)&&(_s=4),Gs===null||(Kp&268435455)===0&&(iv&268435455)===0||gd(Gs,gs)}function du(p,g){var C=Or;Or|=2;var O=nA();(Gs!==p||gs!==g)&&(lu=null,vh(p,g));do try{rA();break}catch(U){Xb(p,U)}while(!0);if(_b(),Or=C,nv.current=O,Qi!==null)throw Error(i(261));return Gs=null,gs=0,_s}function rA(){for(;Qi!==null;)fv(Qi)}function yD(){for(;Qi!==null&&!xo();)fv(Qi)}function fv(p){var g=_v(p.alternate,p,nc);p.memoizedProps=p.pendingProps,g===null?iA(p):Qi=g,rv.current=null}function iA(p){var g=p;do{var C=g.alternate;if(p=g.return,(g.flags&32768)===0){if(C=QE(C,g,nc),C!==null){Qi=C;return}}else{if(C=gD(C,g),C!==null){C.flags&=32767,Qi=C;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{_s=6,Qi=null;return}}if(g=g.sibling,g!==null){Qi=g;return}Qi=g=p}while(g!==null);_s===0&&(_s=5)}function Xp(p,g,C){var O=lr,U=Dc.transition;try{Dc.transition=null,lr=1,ED(p,g,C,O)}finally{Dc.transition=U,lr=O}return null}function ED(p,g,C,O){do Lm();while(uu!==null);if((Or&6)!==0)throw Error(i(327));C=p.finishedWork;var U=p.finishedLanes;if(C===null)return null;if(p.finishedWork=null,p.finishedLanes=0,C===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var H=C.lanes|C.childLanes;if(Xr(p,H),p===Gs&&(Qi=Gs=null,gs=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||xm||(xm=!0,x_(fa,function(){return Lm(),null})),H=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||H){H=Dc.transition,Dc.transition=null;var ce=lr;lr=1;var Ae=Or;Or|=4,rv.current=null,Wb(p,C),$b(C,p),ib(l_),be=!!wE,l_=wE=null,p.current=C,Nm(C),nh(),Or=Ae,lr=ce,Dc.transition=H}else p.current=C;if(xm&&(xm=!1,uu=p,cv=U),H=p.pendingLanes,H===0&&(Eh=null),tm(C.stateNode),wo(p,$r()),g!==null)for(O=p.onRecoverableError,C=0;C<g.length;C++)U=g[C],O(U.value,{componentStack:U.stack,digest:U.digest});if(av)throw av=!1,p=qb,qb=null,p;return(cv&1)!==0&&p.tag!==0&&Lm(),H=p.pendingLanes,(H&1)!==0?p===Yb?qp++:(qp=0,Yb=p):qp=0,hh(),null}function Lm(){if(uu!==null){var p=Sc(cv),g=Dc.transition,C=lr;try{if(Dc.transition=null,lr=16>p?16:p,uu===null)var O=!1;else{if(p=uu,uu=null,cv=0,(Or&6)!==0)throw Error(i(331));var U=Or;for(Or|=4,Zt=p.current;Zt!==null;){var H=Zt,ce=H.child;if((Zt.flags&16)!==0){var Ae=H.deletions;if(Ae!==null){for(var Le=0;Le<Ae.length;Le++){var st=Ae[Le];for(Zt=st;Zt!==null;){var At=Zt;switch(At.tag){case 0:case 11:case 15:I_(8,At,H)}var Pt=At.child;if(Pt!==null)Pt.return=At,Zt=Pt;else for(;Zt!==null;){At=Zt;var It=At.sibling,Kt=At.return;if(JI(At),At===st){Zt=null;break}if(It!==null){It.return=Kt,Zt=It;break}Zt=Kt}}}var tn=H.alternate;if(tn!==null){var nn=tn.child;if(nn!==null){tn.child=null;do{var Zi=nn.sibling;nn.sibling=null,nn=Zi}while(nn!==null)}}Zt=H}}if((H.subtreeFlags&2064)!==0&&ce!==null)ce.return=H,Zt=ce;else e:for(;Zt!==null;){if(H=Zt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:I_(9,H,H.return)}var Ze=H.sibling;if(Ze!==null){Ze.return=H.return,Zt=Ze;break e}Zt=H.return}}var je=p.current;for(Zt=je;Zt!==null;){ce=Zt;var nt=ce.child;if((ce.subtreeFlags&2064)!==0&&nt!==null)nt.return=ce,Zt=nt;else e:for(ce=je;Zt!==null;){if(Ae=Zt,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:A_(9,Ae)}}catch(rn){Vi(Ae,Ae.return,rn)}if(Ae===ce){Zt=null;break e}var xt=Ae.sibling;if(xt!==null){xt.return=Ae.return,Zt=xt;break e}Zt=Ae.return}}if(Or=U,hh(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(Yl,p)}catch{}O=!0}return O}finally{lr=C,Dc.transition=g}}return!1}function mv(p,g,C){g=Pm(C,g),g=Ub(p,g,1),p=mh(p,g,1),g=no(),p!==null&&(Ql(p,1,g),wo(p,g))}function Vi(p,g,C){if(p.tag===3)mv(p,p,C);else for(;g!==null;){if(g.tag===3){mv(g,p,C);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Eh===null||!Eh.has(O))){p=Pm(C,p),p=md(g,p,1),g=mh(g,p,1),p=no(),g!==null&&(Ql(g,1,p),wo(g,p));break}}g=g.return}}function sA(p,g,C){var O=p.pingCache;O!==null&&O.delete(g),g=no(),p.pingedLanes|=p.suspendedLanes&C,Gs===p&&(gs&C)===C&&(_s===4||_s===3&&(gs&130023424)===gs&&500>$r()-ov?vh(p,0):sv|=C),wo(p,g)}function Qb(p,g){g===0&&((p.mode&1)===0?g=1:(g=yr,yr<<=1,(yr&130023424)===0&&(yr=4194304)));var C=no();p=hd(p,g),p!==null&&(Ql(p,g,C),wo(p,C))}function gv(p){var g=p.memoizedState,C=0;g!==null&&(C=g.retryLane),Qb(p,C)}function oA(p,g){var C=0;switch(p.tag){case 13:var O=p.stateNode,U=p.memoizedState;U!==null&&(C=U.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(i(314))}O!==null&&O.delete(g),Qb(p,C)}var _v;_v=function(p,g,C){if(p!==null)if(p.memoizedProps!==g.pendingProps||ya.current)Ta=!0;else{if((p.lanes&C)===0&&(g.flags&128)===0)return Ta=!1,$I(p,g,C);Ta=(p.flags&131072)!==0}else Ta=!1,pi&&(g.flags&1048576)!==0&&OE(g,PE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;XE(p,g),p=g.pendingProps;var U=jp(g,vo.current);dd(g,C),U=Rm(null,g,O,p,U,C);var H=Rb();return g.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ea(O)?(H=!0,IE(g)):H=!1,g.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,__(g),U.updater=zE,g.stateNode=U,U._reactInternals=g,xb(g,O,p,C),g=HE(null,g,O,!0,H,C)):(g.tag=0,pi&&H&&kE(g),qo(null,g,U,C),g=g.child),g;case 16:O=g.elementType;e:{switch(XE(p,g),p=g.pendingProps,U=O._init,O=U(O._payload),g.type=O,U=g.tag=Jp(O),p=tc(O,p),U){case 0:g=Vb(null,g,O,p,C);break e;case 1:g=WI(null,g,O,p,C);break e;case 11:g=GE(null,g,O,p,C);break e;case 14:g=VI(null,g,O,tc(O.type,p),C);break e}throw Error(i(306,O,""))}return g;case 0:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:tc(O,U),Vb(p,g,O,U,C);case 1:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:tc(O,U),WI(p,g,O,U,C);case 3:e:{if(jb(g),p===null)throw Error(i(387));O=g.pendingProps,H=g.memoizedState,U=H.element,yI(p,g),ME(g,O,null,C);var ce=g.memoizedState;if(O=ce.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){U=Pm(Error(i(423)),g),g=zI(p,g,O,C,U);break e}else if(O!==U){U=Pm(Error(i(424)),g),g=zI(p,g,O,C,U);break e}else for(Sa=lh(g.stateNode.containerInfo.firstChild),va=g,pi=!0,$o=null,C=gI(g,null,O,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(vm(),O===U){g=au(p,g,C);break e}qo(p,g,O,C)}g=g.child}return g;case 5:return SI(g),p===null&&fb(g),O=g.type,U=g.pendingProps,H=p!==null?p.memoizedProps:null,ce=U.children,ub(O,U)?ce=null:H!==null&&ub(O,H)&&(g.flags|=32),BI(p,g),qo(p,g,ce,C),g.child;case 6:return p===null&&fb(g),null;case 13:return $E(p,g,C);case 4:return Sb(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=Sm(g,null,O,C):qo(p,g,O,C),g.child;case 11:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:tc(O,U),GE(p,g,O,U,C);case 7:return qo(p,g,g.pendingProps,C),g.child;case 8:return qo(p,g,g.pendingProps.children,C),g.child;case 12:return qo(p,g,g.pendingProps.children,C),g.child;case 10:e:{if(O=g.type._context,U=g.pendingProps,H=g.memoizedProps,ce=U.value,bi(xE,O._currentValue),O._currentValue=ce,H!==null)if(vl(H.value,ce)){if(H.children===U.children&&!ya.current){g=au(p,g,C);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ae=H.dependencies;if(Ae!==null){ce=H.child;for(var Le=Ae.firstContext;Le!==null;){if(Le.context===O){if(H.tag===1){Le=iu(-1,C&-C),Le.tag=2;var st=H.updateQueue;if(st!==null){st=st.shared;var At=st.pending;At===null?Le.next=Le:(Le.next=At.next,At.next=Le),st.pending=Le}}H.lanes|=C,Le=H.alternate,Le!==null&&(Le.lanes|=C),Eb(H.return,C,g),Ae.lanes|=C;break}Le=Le.next}}else if(H.tag===10)ce=H.type===g.type?null:H.child;else if(H.tag===18){if(ce=H.return,ce===null)throw Error(i(341));ce.lanes|=C,Ae=ce.alternate,Ae!==null&&(Ae.lanes|=C),Eb(ce,C,g),ce=H.sibling}else ce=H.child;if(ce!==null)ce.return=H;else for(ce=H;ce!==null;){if(ce===g){ce=null;break}if(H=ce.sibling,H!==null){H.return=ce.return,ce=H;break}ce=ce.return}H=ce}qo(p,g,U.children,C),g=g.child}return g;case 9:return U=g.type,O=g.pendingProps.children,dd(g,C),U=Oc(U),O=O(U),g.flags|=1,qo(p,g,O,C),g.child;case 14:return O=g.type,U=tc(O,g.pendingProps),U=tc(O.type,U),VI(p,g,O,U,C);case 15:return jI(p,g,g.type,g.pendingProps,C);case 17:return O=g.type,U=g.pendingProps,U=g.elementType===O?U:tc(O,U),XE(p,g),g.tag=1,Ea(O)?(p=!0,IE(g)):p=!1,dd(g,C),DI(g,O,U),xb(g,O,U,C),HE(null,g,O,!0,p,C);case 19:return YE(p,g,C);case 22:return FI(p,g,C)}throw Error(i(156,g.tag))};function x_(p,g){return th(p,g)}function yv(p,g,C,O){this.tag=p,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rc(p,g,C,O){return new yv(p,g,C,O)}function Sh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Jp(p){if(typeof p=="function")return Sh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===pe)return 11;if(p===He)return 14}return 2}function yd(p,g){var C=p.alternate;return C===null?(C=rc(p.tag,g,p.key,p.mode),C.elementType=p.elementType,C.type=p.type,C.stateNode=p.stateNode,C.alternate=p,p.alternate=C):(C.pendingProps=g,C.type=p.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=p.flags&14680064,C.childLanes=p.childLanes,C.lanes=p.lanes,C.child=p.child,C.memoizedProps=p.memoizedProps,C.memoizedState=p.memoizedState,C.updateQueue=p.updateQueue,g=p.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=p.sibling,C.index=p.index,C.ref=p.ref,C}function Ev(p,g,C,O,U,H){var ce=2;if(O=p,typeof p=="function")Sh(p)&&(ce=1);else if(typeof p=="string")ce=5;else e:switch(p){case Z:return Qp(C.children,U,H,g);case ee:ce=8,U|=8;break;case ne:return p=rc(12,C,g,U|2),p.elementType=ne,p.lanes=H,p;case le:return p=rc(13,C,g,U),p.elementType=le,p.lanes=H,p;case Me:return p=rc(19,C,g,U),p.elementType=Me,p.lanes=H,p;case Ee:return bh(C,U,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case oe:ce=10;break e;case ge:ce=9;break e;case pe:ce=11;break e;case He:ce=14;break e;case tt:ce=16,O=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return g=rc(ce,C,g,U),g.elementType=p,g.type=O,g.lanes=H,g}function Qp(p,g,C,O){return p=rc(7,p,O,g),p.lanes=C,p}function bh(p,g,C,O){return p=rc(22,p,O,g),p.elementType=Ee,p.lanes=C,p.stateNode={isHidden:!1},p}function Zb(p,g,C){return p=rc(6,p,null,g),p.lanes=C,p}function eT(p,g,C){return g=rc(4,p.children!==null?p.children:[],p.key,g),g.lanes=C,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function vD(p,g,C,O,U){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gl(0),this.expirationTimes=gl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gl(0),this.identifierPrefix=O,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function tT(p,g,C,O,U,H,ce,Ae,Le){return p=new vD(p,g,C,Ae,Le),g===1?(g=1,H===!0&&(g|=8)):g=0,H=rc(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:O,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},__(H),p}function SD(p,g,C){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fe,key:O==null?null:""+O,children:p,containerInfo:g,implementation:C}}function aA(p){if(!p)return dh;p=p._reactInternals;e:{if(Ws(p)!==p||p.tag!==1)throw Error(i(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ea(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(p.tag===1){var C=p.type;if(Ea(C))return RE(p,C,g)}return g}function vv(p,g,C,O,U,H,ce,Ae,Le){return p=tT(C,O,!0,p,U,H,ce,Ae,Le),p.context=aA(null),C=p.current,O=no(),U=xc(C),H=iu(O,U),H.callback=g??null,mh(C,H,U),p.current.lanes=U,Ql(p,U,O),wo(p,O),p}function L_(p,g,C,O){var U=g.current,H=no(),ce=xc(U);return C=aA(C),g.context===null?g.context=C:g.pendingContext=C,g=iu(H,ce),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=mh(U,g,ce),p!==null&&(Lc(p,U,ce,H),y_(p,U,ce)),ce}function Sv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function nT(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var C=p.retryLane;p.retryLane=C!==0&&C<g?C:g}}function rT(p,g){nT(p,g),(p=p.alternate)&&nT(p,g)}function M_(){return null}var bl=typeof reportError=="function"?reportError:function(p){console.error(p)};function bv(p){this._internalRoot=p}Tv.prototype.render=bv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(i(409));L_(p,g,null,null)},Tv.prototype.unmount=bv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;_d(function(){L_(null,p,null,null)}),g[Rc]=null}};function Tv(p){this._internalRoot=p}Tv.prototype.unstable_scheduleHydration=function(p){if(p){var g=Rp();p={blockedOn:null,target:p,priority:g};for(var C=0;C<Fo.length&&g!==0&&g<Fo[C].priority;C++);Fo.splice(C,0,p),C===0&&Ap(p)}};function iT(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Mm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function sT(){}function bD(p,g,C,O,U){if(U){if(typeof O=="function"){var H=O;O=function(){var st=Sv(ce);H.call(st)}}var ce=vv(g,O,p,0,null,!1,!1,"",sT);return p._reactRootContainer=ce,p[Rc]=ce.current,xp(p.nodeType===8?p.parentNode:p),_d(),ce}for(;U=p.lastChild;)p.removeChild(U);if(typeof O=="function"){var Ae=O;O=function(){var st=Sv(Le);Ae.call(st)}}var Le=tT(p,0,!1,null,null,!1,!1,"",sT);return p._reactRootContainer=Le,p[Rc]=Le.current,xp(p.nodeType===8?p.parentNode:p),_d(function(){L_(g,Le,C,O)}),Le}function Zp(p,g,C,O,U){var H=C._reactRootContainer;if(H){var ce=H;if(typeof U=="function"){var Ae=U;U=function(){var Le=Sv(ce);Ae.call(Le)}}L_(g,ce,p,U)}else ce=bD(C,g,p,U,O);return Sv(ce)}nm=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var C=Xl(g.pendingLanes);C!==0&&(Xa(g,C|1),wo(g,$r()),(Or&6)===0&&(Dm=$r()+500,hh()))}break;case 13:_d(function(){var O=hd(p,1);if(O!==null){var U=no();Lc(O,p,1,U)}}),rT(p,1)}},Zl=function(p){if(p.tag===13){var g=hd(p,134217728);if(g!==null){var C=no();Lc(g,p,134217728,C)}rT(p,134217728)}},oh=function(p){if(p.tag===13){var g=xc(p),C=hd(p,g);if(C!==null){var O=no();Lc(C,p,g,O)}rT(p,g)}},Rp=function(){return lr},rm=function(p,g){var C=lr;try{return lr=p,g()}finally{lr=C}},ql=function(p,g,C){switch(g){case"input":if(Lt(p,C),g=C.name,C.type==="radio"&&g!=null){for(C=p;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<C.length;g++){var O=C[g];if(O!==p&&O.form===p.form){var U=_m(O);if(!U)throw Error(i(90));Dt(O),Lt(O,U)}}}break;case"textarea":Ht(p,C);break;case"select":g=C.value,g!=null&&_t(p,!!C.multiple,g,!1)}},qu=N_,yc=_d;var Th={usingClientEntryPoint:!1,Events:[gm,Up,_m,_c,hl,N_]},Ed={findFiberByHostInstance:Mp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},TD={bundleType:Ed.bundleType,version:Ed.version,rendererPackageName:Ed.rendererPackageName,rendererConfig:Ed.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=eh(p),p===null?null:p.stateNode},findFiberByHostInstance:Ed.findFiberByHostInstance||M_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wv.isDisabled&&wv.supportsFiber)try{Yl=wv.inject(TD),Eo=wv}catch{}}return Yc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Th,Yc.createPortal=function(p,g){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iT(g))throw Error(i(200));return SD(p,g,null,C)},Yc.createRoot=function(p,g){if(!iT(p))throw Error(i(299));var C=!1,O="",U=bl;return g!=null&&(g.unstable_strictMode===!0&&(C=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(U=g.onRecoverableError)),g=tT(p,1,!1,null,null,C,!1,O,U),p[Rc]=g.current,xp(p.nodeType===8?p.parentNode:p),new bv(g)},Yc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=eh(g),p=p===null?null:p.stateNode,p},Yc.flushSync=function(p){return _d(p)},Yc.hydrate=function(p,g,C){if(!Mm(g))throw Error(i(200));return Zp(null,p,g,!0,C)},Yc.hydrateRoot=function(p,g,C){if(!iT(p))throw Error(i(405));var O=C!=null&&C.hydratedSources||null,U=!1,H="",ce=bl;if(C!=null&&(C.unstable_strictMode===!0&&(U=!0),C.identifierPrefix!==void 0&&(H=C.identifierPrefix),C.onRecoverableError!==void 0&&(ce=C.onRecoverableError)),g=vv(g,null,p,1,C??null,U,!1,H,ce),p[Rc]=g.current,xp(p),O)for(p=0;p<O.length;p++)C=O[p],U=C._getVersion,U=U(C._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[C,U]:g.mutableSourceEagerHydrationData.push(C,U);return new Tv(g)},Yc.render=function(p,g,C){if(!Mm(g))throw Error(i(200));return Zp(null,p,g,!1,C)},Yc.unmountComponentAtNode=function(p){if(!Mm(p))throw Error(i(40));return p._reactRootContainer?(_d(function(){Zp(null,null,p,!1,function(){p._reactRootContainer=null,p[Rc]=null})}),!0):!1},Yc.unstable_batchedUpdates=N_,Yc.unstable_renderSubtreeIntoContainer=function(p,g,C,O){if(!Mm(C))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return Zp(p,g,C,!1,O)},Yc.version="18.3.1-next-f1338f8080-20240426",Yc}var NK;function vZ(){if(NK)return gM.exports;NK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),gM.exports=wEe(),gM.exports}var DK;function CEe(){if(DK)return R1;DK=1;var n=vZ();return R1.createRoot=n.createRoot,R1.hydrateRoot=n.hydrateRoot,R1}var REe=CEe();const SZ=Xf(REe);var bZ=vZ();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function RC(){return RC=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},RC.apply(this,arguments)}var Sg;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Sg||(Sg={}));const xK="popstate";function IEe(n){n===void 0&&(n={});function e(a,l){let{pathname:d,search:f,hash:_}=a.location;return JU("",{pathname:d,search:f,hash:_},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function i(a,l){return typeof l=="string"?l:GO(l)}return PEe(e,i,null,n)}function Vs(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function TZ(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function AEe(){return Math.random().toString(36).substr(2,8)}function LK(n,e){return{usr:n.state,key:n.key,idx:e}}function JU(n,e,i,a){return i===void 0&&(i=null),RC({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?F0(e):e,{state:i,key:e&&e.key||a||AEe()})}function GO(n){let{pathname:e="/",search:i="",hash:a=""}=n;return i&&i!=="?"&&(e+=i.charAt(0)==="?"?i:"?"+i),a&&a!=="#"&&(e+=a.charAt(0)==="#"?a:"#"+a),e}function F0(n){let e={};if(n){let i=n.indexOf("#");i>=0&&(e.hash=n.substr(i),n=n.substr(0,i));let a=n.indexOf("?");a>=0&&(e.search=n.substr(a),n=n.substr(0,a)),n&&(e.pathname=n)}return e}function PEe(n,e,i,a){a===void 0&&(a={});let{window:l=document.defaultView,v5Compat:d=!1}=a,f=l.history,_=Sg.Pop,E=null,b=w();b==null&&(b=0,f.replaceState(RC({},f.state,{idx:b}),""));function w(){return(f.state||{idx:null}).idx}function I(){_=Sg.Pop;let B=w(),q=B==null?null:B-b;b=B,E&&E({action:_,location:F.location,delta:q})}function k(B,q){_=Sg.Push;let $=JU(F.location,B,q);b=w()+1;let Q=LK($,b),ae=F.createHref($);try{f.pushState(Q,"",ae)}catch(re){if(re instanceof DOMException&&re.name==="DataCloneError")throw re;l.location.assign(ae)}d&&E&&E({action:_,location:F.location,delta:1})}function V(B,q){_=Sg.Replace;let $=JU(F.location,B,q);b=w();let Q=LK($,b),ae=F.createHref($);f.replaceState(Q,"",ae),d&&E&&E({action:_,location:F.location,delta:0})}function L(B){let q=l.location.origin!=="null"?l.location.origin:l.location.href,$=typeof B=="string"?B:GO(B);return $=$.replace(/ $/,"%20"),Vs(q,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,q)}let F={get action(){return _},get location(){return n(l,f)},listen(B){if(E)throw new Error("A history only accepts one active listener");return l.addEventListener(xK,I),E=B,()=>{l.removeEventListener(xK,I),E=null}},createHref(B){return e(l,B)},createURL:L,encodeLocation(B){let q=L(B);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:k,replace:V,go(B){return f.go(B)}};return F}var MK;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(MK||(MK={}));function OEe(n,e,i){return i===void 0&&(i="/"),kEe(n,e,i)}function kEe(n,e,i,a){let l=typeof e=="string"?F0(e):e,d=Uj(l.pathname||"/",i);if(d==null)return null;let f=wZ(n);NEe(f);let _=null;for(let E=0;_==null&&E<f.length;++E){let b=GEe(d);_=BEe(f[E],b)}return _}function wZ(n,e,i,a){e===void 0&&(e=[]),i===void 0&&(i=[]),a===void 0&&(a="");let l=(d,f,_)=>{let E={relativePath:_===void 0?d.path||"":_,caseSensitive:d.caseSensitive===!0,childrenIndex:f,route:d};E.relativePath.startsWith("/")&&(Vs(E.relativePath.startsWith(a),'Absolute route path "'+E.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),E.relativePath=E.relativePath.slice(a.length));let b=wg([a,E.relativePath]),w=i.concat(E);d.children&&d.children.length>0&&(Vs(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+b+'".')),wZ(d.children,e,w,b)),!(d.path==null&&!d.index)&&e.push({path:b,score:jEe(b,d.index),routesMeta:w})};return n.forEach((d,f)=>{var _;if(d.path===""||!((_=d.path)!=null&&_.includes("?")))l(d,f);else for(let E of CZ(d.path))l(d,f,E)}),e}function CZ(n){let e=n.split("/");if(e.length===0)return[];let[i,...a]=e,l=i.endsWith("?"),d=i.replace(/\?$/,"");if(a.length===0)return l?[d,""]:[d];let f=CZ(a.join("/")),_=[];return _.push(...f.map(E=>E===""?d:[d,E].join("/"))),l&&_.push(...f),_.map(E=>n.startsWith("/")&&E===""?"/":E)}function NEe(n){n.sort((e,i)=>e.score!==i.score?i.score-e.score:FEe(e.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}const DEe=/^:[\w-]+$/,xEe=3,LEe=2,MEe=1,UEe=10,VEe=-2,UK=n=>n==="*";function jEe(n,e){let i=n.split("/"),a=i.length;return i.some(UK)&&(a+=VEe),e&&(a+=LEe),i.filter(l=>!UK(l)).reduce((l,d)=>l+(DEe.test(d)?xEe:d===""?MEe:UEe),a)}function FEe(n,e){return n.length===e.length&&n.slice(0,-1).every((a,l)=>a===e[l])?n[n.length-1]-e[e.length-1]:0}function BEe(n,e,i){let{routesMeta:a}=n,l={},d="/",f=[];for(let _=0;_<a.length;++_){let E=a[_],b=_===a.length-1,w=d==="/"?e:e.slice(d.length)||"/",I=WEe({path:E.relativePath,caseSensitive:E.caseSensitive,end:b},w),k=E.route;if(!I)return null;Object.assign(l,I.params),f.push({params:l,pathname:wg([d,I.pathname]),pathnameBase:qEe(wg([d,I.pathnameBase])),route:k}),I.pathnameBase!=="/"&&(d=wg([d,I.pathnameBase]))}return f}function WEe(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[i,a]=zEe(n.path,n.caseSensitive,n.end),l=e.match(i);if(!l)return null;let d=l[0],f=d.replace(/(.)\/+$/,"$1"),_=l.slice(1);return{params:a.reduce((b,w,I)=>{let{paramName:k,isOptional:V}=w;if(k==="*"){let F=_[I]||"";f=d.slice(0,d.length-F.length).replace(/(.)\/+$/,"$1")}const L=_[I];return V&&!L?b[k]=void 0:b[k]=(L||"").replace(/%2F/g,"/"),b},{}),pathname:d,pathnameBase:f,pattern:n}}function zEe(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!0),TZ(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let a=[],l="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,_,E)=>(a.push({paramName:_,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(a.push({paramName:"*"}),l+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?l+="\\/*$":n!==""&&n!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,e?void 0:"i"),a]}function GEe(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return TZ(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function Uj(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,a=n.charAt(i);return a&&a!=="/"?null:n.slice(i)||"/"}function HEe(n,e){e===void 0&&(e="/");let{pathname:i,search:a="",hash:l=""}=typeof n=="string"?F0(n):n;return{pathname:i?i.startsWith("/")?i:$Ee(i,e):e,search:YEe(a),hash:XEe(l)}}function $Ee(n,e){let i=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(l=>{l===".."?i.length>1&&i.pop():l!=="."&&i.push(l)}),i.length>1?i.join("/"):"/"}function EM(n,e,i,a){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function KEe(n){return n.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function Vj(n,e){let i=KEe(n);return e?i.map((a,l)=>l===i.length-1?a.pathname:a.pathnameBase):i.map(a=>a.pathnameBase)}function jj(n,e,i,a){a===void 0&&(a=!1);let l;typeof n=="string"?l=F0(n):(l=RC({},n),Vs(!l.pathname||!l.pathname.includes("?"),EM("?","pathname","search",l)),Vs(!l.pathname||!l.pathname.includes("#"),EM("#","pathname","hash",l)),Vs(!l.search||!l.search.includes("#"),EM("#","search","hash",l)));let d=n===""||l.pathname==="",f=d?"/":l.pathname,_;if(f==null)_=i;else{let I=e.length-1;if(!a&&f.startsWith("..")){let k=f.split("/");for(;k[0]==="..";)k.shift(),I-=1;l.pathname=k.join("/")}_=I>=0?e[I]:"/"}let E=HEe(l,_),b=f&&f!=="/"&&f.endsWith("/"),w=(d||f===".")&&i.endsWith("/");return!E.pathname.endsWith("/")&&(b||w)&&(E.pathname+="/"),E}const wg=n=>n.join("/").replace(/\/\/+/g,"/"),qEe=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),YEe=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,XEe=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function JEe(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const RZ=["post","put","patch","delete"];new Set(RZ);const QEe=["get",...RZ];new Set(QEe);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function IC(){return IC=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},IC.apply(this,arguments)}const Fj=D.createContext(null),ZEe=D.createContext(null),Gg=D.createContext(null),kk=D.createContext(null),Ep=D.createContext({outlet:null,matches:[],isDataRoute:!1}),IZ=D.createContext(null);function eve(n,e){let{relative:i}=e===void 0?{}:e;B0()||Vs(!1);let{basename:a,navigator:l}=D.useContext(Gg),{hash:d,pathname:f,search:_}=OZ(n,{relative:i}),E=f;return a!=="/"&&(E=f==="/"?a:wg([a,f])),l.createHref({pathname:E,search:_,hash:d})}function B0(){return D.useContext(kk)!=null}function W0(){return B0()||Vs(!1),D.useContext(kk).location}function AZ(n){D.useContext(Gg).static||D.useLayoutEffect(n)}function Bj(){let{isDataRoute:n}=D.useContext(Ep);return n?mve():tve()}function tve(){B0()||Vs(!1);let n=D.useContext(Fj),{basename:e,future:i,navigator:a}=D.useContext(Gg),{matches:l}=D.useContext(Ep),{pathname:d}=W0(),f=JSON.stringify(Vj(l,i.v7_relativeSplatPath)),_=D.useRef(!1);return AZ(()=>{_.current=!0}),D.useCallback(function(b,w){if(w===void 0&&(w={}),!_.current)return;if(typeof b=="number"){a.go(b);return}let I=jj(b,JSON.parse(f),d,w.relative==="path");n==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:wg([e,I.pathname])),(w.replace?a.replace:a.push)(I,w.state,w)},[e,a,f,d,n])}const nve=D.createContext(null);function rve(n){let e=D.useContext(Ep).outlet;return e&&D.createElement(nve.Provider,{value:n},e)}function PZ(){let{matches:n}=D.useContext(Ep),e=n[n.length-1];return e?e.params:{}}function OZ(n,e){let{relative:i}=e===void 0?{}:e,{future:a}=D.useContext(Gg),{matches:l}=D.useContext(Ep),{pathname:d}=W0(),f=JSON.stringify(Vj(l,a.v7_relativeSplatPath));return D.useMemo(()=>jj(n,JSON.parse(f),d,i==="path"),[n,f,d,i])}function ive(n,e){return sve(n,e)}function sve(n,e,i,a){B0()||Vs(!1);let{navigator:l,static:d}=D.useContext(Gg),{matches:f}=D.useContext(Ep),_=f[f.length-1],E=_?_.params:{};_&&_.pathname;let b=_?_.pathnameBase:"/";_&&_.route;let w=W0(),I;if(e){var k;let q=typeof e=="string"?F0(e):e;b==="/"||(k=q.pathname)!=null&&k.startsWith(b)||Vs(!1),I=q}else I=w;let V=I.pathname||"/",L=V;if(b!=="/"){let q=b.replace(/^\//,"").split("/");L="/"+V.replace(/^\//,"").split("/").slice(q.length).join("/")}let F=OEe(n,{pathname:L}),B=uve(F&&F.map(q=>Object.assign({},q,{params:Object.assign({},E,q.params),pathname:wg([b,l.encodeLocation?l.encodeLocation(q.pathname).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?b:wg([b,l.encodeLocation?l.encodeLocation(q.pathnameBase).pathname:q.pathnameBase])})),f,i,a);return e&&B?D.createElement(kk.Provider,{value:{location:IC({pathname:"/",search:"",hash:"",state:null,key:"default"},I),navigationType:Sg.Pop}},B):B}function ove(){let n=fve(),e=JEe(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),i=n instanceof Error?n.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),i?D.createElement("pre",{style:l},i):null,null)}const ave=D.createElement(ove,null);class cve extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,i){return i.location!==e.location||i.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:i.error,location:i.location,revalidation:e.revalidation||i.revalidation}}componentDidCatch(e,i){console.error("React Router caught the following error during render",e,i)}render(){return this.state.error!==void 0?D.createElement(Ep.Provider,{value:this.props.routeContext},D.createElement(IZ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function lve(n){let{routeContext:e,match:i,children:a}=n,l=D.useContext(Fj);return l&&l.static&&l.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=i.route.id),D.createElement(Ep.Provider,{value:e},a)}function uve(n,e,i,a){var l;if(e===void 0&&(e=[]),i===void 0&&(i=null),a===void 0&&(a=null),n==null){var d;if(!i)return null;if(i.errors)n=i.matches;else if((d=a)!=null&&d.v7_partialHydration&&e.length===0&&!i.initialized&&i.matches.length>0)n=i.matches;else return null}let f=n,_=(l=i)==null?void 0:l.errors;if(_!=null){let w=f.findIndex(I=>I.route.id&&(_==null?void 0:_[I.route.id])!==void 0);w>=0||Vs(!1),f=f.slice(0,Math.min(f.length,w+1))}let E=!1,b=-1;if(i&&a&&a.v7_partialHydration)for(let w=0;w<f.length;w++){let I=f[w];if((I.route.HydrateFallback||I.route.hydrateFallbackElement)&&(b=w),I.route.id){let{loaderData:k,errors:V}=i,L=I.route.loader&&k[I.route.id]===void 0&&(!V||V[I.route.id]===void 0);if(I.route.lazy||L){E=!0,b>=0?f=f.slice(0,b+1):f=[f[0]];break}}}return f.reduceRight((w,I,k)=>{let V,L=!1,F=null,B=null;i&&(V=_&&I.route.id?_[I.route.id]:void 0,F=I.route.errorElement||ave,E&&(b<0&&k===0?(gve("route-fallback"),L=!0,B=null):b===k&&(L=!0,B=I.route.hydrateFallbackElement||null)));let q=e.concat(f.slice(0,k+1)),$=()=>{let Q;return V?Q=F:L?Q=B:I.route.Component?Q=D.createElement(I.route.Component,null):I.route.element?Q=I.route.element:Q=w,D.createElement(lve,{match:I,routeContext:{outlet:w,matches:q,isDataRoute:i!=null},children:Q})};return i&&(I.route.ErrorBoundary||I.route.errorElement||k===0)?D.createElement(cve,{location:i.location,revalidation:i.revalidation,component:F,error:V,children:$(),routeContext:{outlet:null,matches:q,isDataRoute:!0}}):$()},null)}var kZ=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(kZ||{}),NZ=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(NZ||{});function dve(n){let e=D.useContext(Fj);return e||Vs(!1),e}function hve(n){let e=D.useContext(ZEe);return e||Vs(!1),e}function pve(n){let e=D.useContext(Ep);return e||Vs(!1),e}function DZ(n){let e=pve(),i=e.matches[e.matches.length-1];return i.route.id||Vs(!1),i.route.id}function fve(){var n;let e=D.useContext(IZ),i=hve(),a=DZ();return e!==void 0?e:(n=i.errors)==null?void 0:n[a]}function mve(){let{router:n}=dve(kZ.UseNavigateStable),e=DZ(NZ.UseNavigateStable),i=D.useRef(!1);return AZ(()=>{i.current=!0}),D.useCallback(function(l,d){d===void 0&&(d={}),i.current&&(typeof l=="number"?n.navigate(l):n.navigate(l,IC({fromRouteId:e},d)))},[n,e])}const VK={};function gve(n,e,i){VK[n]||(VK[n]=!0)}function _ve(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function yve(n){let{to:e,replace:i,state:a,relative:l}=n;B0()||Vs(!1);let{future:d,static:f}=D.useContext(Gg),{matches:_}=D.useContext(Ep),{pathname:E}=W0(),b=Bj(),w=jj(e,Vj(_,d.v7_relativeSplatPath),E,l==="path"),I=JSON.stringify(w);return D.useEffect(()=>b(JSON.parse(I),{replace:i,state:a,relative:l}),[b,I,l,i,a]),null}function Eve(n){return rve(n.context)}function qh(n){Vs(!1)}function vve(n){let{basename:e="/",children:i=null,location:a,navigationType:l=Sg.Pop,navigator:d,static:f=!1,future:_}=n;B0()&&Vs(!1);let E=e.replace(/^\/*/,"/"),b=D.useMemo(()=>({basename:E,navigator:d,static:f,future:IC({v7_relativeSplatPath:!1},_)}),[E,_,d,f]);typeof a=="string"&&(a=F0(a));let{pathname:w="/",search:I="",hash:k="",state:V=null,key:L="default"}=a,F=D.useMemo(()=>{let B=Uj(w,E);return B==null?null:{location:{pathname:B,search:I,hash:k,state:V,key:L},navigationType:l}},[E,w,I,k,V,L,l]);return F==null?null:D.createElement(Gg.Provider,{value:b},D.createElement(kk.Provider,{children:i,value:F}))}function Sve(n){let{children:e,location:i}=n;return ive(QU(e),i)}new Promise(()=>{});function QU(n,e){e===void 0&&(e=[]);let i=[];return D.Children.forEach(n,(a,l)=>{if(!D.isValidElement(a))return;let d=[...e,l];if(a.type===D.Fragment){i.push.apply(i,QU(a.props.children,d));return}a.type!==qh&&Vs(!1),!a.props.index||!a.props.children||Vs(!1);let f={id:a.props.id||d.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(f.children=QU(a.props.children,d)),i.push(f)}),i}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ZU(){return ZU=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},ZU.apply(this,arguments)}function bve(n,e){if(n==null)return{};var i={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function Tve(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function wve(n,e){return n.button===0&&(!e||e==="_self")&&!Tve(n)}const Cve=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Rve="6";try{window.__reactRouterVersion=Rve}catch{}const Ive="startTransition",jK=XU[Ive];function Ave(n){let{basename:e,children:i,future:a,window:l}=n,d=D.useRef();d.current==null&&(d.current=IEe({window:l,v5Compat:!0}));let f=d.current,[_,E]=D.useState({action:f.action,location:f.location}),{v7_startTransition:b}=a||{},w=D.useCallback(I=>{b&&jK?jK(()=>E(I)):E(I)},[E,b]);return D.useLayoutEffect(()=>f.listen(w),[f,w]),D.useEffect(()=>_ve(a),[a]),D.createElement(vve,{basename:e,children:i,location:_.location,navigationType:_.action,navigator:f,future:a})}const Pve=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Ove=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Uu=D.forwardRef(function(e,i){let{onClick:a,relative:l,reloadDocument:d,replace:f,state:_,target:E,to:b,preventScrollReset:w,viewTransition:I}=e,k=bve(e,Cve),{basename:V}=D.useContext(Gg),L,F=!1;if(typeof b=="string"&&Ove.test(b)&&(L=b,Pve))try{let Q=new URL(window.location.href),ae=b.startsWith("//")?new URL(Q.protocol+b):new URL(b),re=Uj(ae.pathname,V);ae.origin===Q.origin&&re!=null?b=re+ae.search+ae.hash:F=!0}catch{}let B=eve(b,{relative:l}),q=kve(b,{replace:f,state:_,target:E,preventScrollReset:w,relative:l,viewTransition:I});function $(Q){a&&a(Q),Q.defaultPrevented||q(Q)}return D.createElement("a",ZU({},k,{href:L||B,onClick:F||d?a:$,ref:i,target:E}))});var FK;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(FK||(FK={}));var BK;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(BK||(BK={}));function kve(n,e){let{target:i,replace:a,state:l,preventScrollReset:d,relative:f,viewTransition:_}=e===void 0?{}:e,E=Bj(),b=W0(),w=OZ(n,{relative:f});return D.useCallback(I=>{if(wve(I,i)){I.preventDefault();let k=a!==void 0?a:GO(b)===GO(w);E(n,{replace:k,state:l,preventScrollReset:d,relative:f,viewTransition:_})}},[b,E,w,a,l,i,n,d,f,_])}function Nve(n,e,i,a){return n.addEventListener(e,i,a),()=>{n.removeEventListener(e,i,a)}}function Nk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Dve(){return!!(globalThis!=null&&globalThis.document)}function xZ(n){return n.parentElement&&xZ(n.parentElement)?!0:n.hidden}function xve(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function Lve(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function Mve(n){var e;return((e=LZ(n))==null?void 0:e.defaultView)??window}function LZ(n){return Nk(n)?n.ownerDocument:document}function Uve(n){return n.view??window}function Vve(n){return LZ(n).activeElement}function jve(n){const e=Uve(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function MZ(n){return!!n.touches}function Fve(n){return MZ(n)&&n.touches.length>1}function Bve(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function Wve(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function UZ(n,e="page"){return MZ(n)?Bve(n,e):Wve(n,e)}function zve(n){return e=>{const i=jve(e);(!i||i&&e.button===0)&&n(e)}}function Gve(n,e=!1){function i(l){n(l,{point:UZ(l)})}return e?zve(i):i}function lO(n,e,i,a){return Nve(n,e,Gve(i,e==="pointerdown"),a)}function Hve(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of e)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const pn=n=>n?"":void 0,xf=n=>n?!0:void 0;function eV(n){return Array.isArray(n)}function po(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!eV(n)}function $ve(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function Kve(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function tV(n){if(n==null)return n;const{unitless:e}=Kve(n);return e||typeof n=="number"?`${n}px`:n}const VZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,Wj=n=>Object.fromEntries(Object.entries(n).sort(VZ));function WK(n){const e=Wj(n);return Object.assign(Object.values(e),e)}function qve(n){const e=Object.keys(Wj(n));return new Set(e)}function zK(n){if(!n)return n;n=tV(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function Fw(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${tV(n)})`),e&&i.push("and",`(max-width: ${tV(e)})`),i.join(" ")}function Yve(n){if(!n)return null;n.base=n.base??"0px";const e=WK(n),i=Object.entries(n).sort(VZ).map(([d,f],_,E)=>{let[,b]=E[_+1]??[];return b=parseFloat(b)>0?zK(b):void 0,{_minW:zK(f),breakpoint:d,minW:f,maxW:b,maxWQuery:Fw(null,b),minWQuery:Fw(f),minMaxQuery:Fw(f,b)}}),a=qve(n),l=Array.from(a.values());return{keys:a,normalized:e,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(_=>a.has(_))},asObject:Wj(n),asArray:WK(n),details:i,get(d){return i.find(f=>f.breakpoint===d)},media:[null,...e.map(d=>Fw(d)).slice(1)],toArrayValue(d){if(!po(d))throw new Error("toArrayValue: value must be an object");const f=l.map(_=>d[_]??null);for(;$ve(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,_,E)=>{const b=l[E];return b!=null&&_!=null&&(f[b]=_),f},{})}}}function zj(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Rn(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function Gj(n){return D.Children.toArray(n).filter(e=>D.isValidElement(e))}function lR(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function Xve(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ni(n={}){const{name:e,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,_=D.createContext(f);_.displayName=e;function E(){var w;const b=D.useContext(_);if(!b&&i){const I=new Error(d??Xve(a,l));throw I.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,I,E),I}return b}return[_.Provider,E,_]}const ln=(...n)=>n.filter(Boolean).join(" "),jZ=n=>n.hasAttribute("tabindex"),Jve=n=>jZ(n)&&n.tabIndex===-1;function HO(n){if(!Nk(n)||xZ(n)||Lve(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in a?a[e]():xve(n)?!0:jZ(n)}function Qve(n){return n?Nk(n)&&HO(n)&&!Jve(n):!1}const Zve=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],eSe=Zve.join(),tSe=n=>n.offsetWidth>0&&n.offsetHeight>0;function FZ(n){const e=Array.from(n.querySelectorAll(eSe));return e.unshift(n),e.filter(i=>HO(i)&&tSe(i))}function nSe(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const rSe=n=>{const e=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);e.has(a)||e.set(a,new Map);const _=e.get(a);if(_.has(l))return _.get(l);const E=n(a,l,d,f);return _.set(l,E),E}},BZ=rSe(nSe),iSe=n=>n.default||n;function Hj(n){const{wasSelected:e,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&e)}function sSe(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function oSe(n,e){let i=sSe(n);const a=10**(e??10);return i=Math.round(i*a)/a,e?i.toFixed(e):i.toString()}function aSe(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function GK(n,e,i){return(n-e)*100/(i-e)}function cSe(n,e,i){return(i-e)*n+e}function HK(n,e,i){const a=Math.round((n-e)/i)*i+e,l=aSe(i);return oSe(a,l)}function vM(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function z0(n,e=[]){const i=Object.assign({},n);for(const a of e)a in i&&delete i[a];return i}function WZ(n,e){const i={};for(const a of e)a in n&&(i[a]=n[a]);return i}const zZ=Object.freeze(["base","sm","md","lg","xl","2xl"]);function Dk(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):po(n)?Object.keys(n).reduce((i,a)=>(i[a]=e(n[a]),i),{}):n!=null?e(n):null}function lSe(n,e=zZ){const i={};return n.forEach((a,l)=>{const d=e[l];a!=null&&(i[d]=a)}),i}const uSe=n=>typeof n=="function";function tl(n,...e){return uSe(n)?n(...e):n}function dSe(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function hSe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function GZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Nk(n)&&dSe(n)?n:GZ(hSe(n))}function HZ(n,e){const i={},a={};for(const[l,d]of Object.entries(n))e.includes(l)?i[l]=d:a[l]=d;return[i,a]}function pSe(n,...e){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=f=>{const _={};for(let E=0;E<f.length;E++){const b=f[E];i[b]&&(Object.defineProperty(_,b,i[b]),delete i[b])}return _},d=f=>l(Array.isArray(f)?f:a.filter(f));return e.map(d).concat(l(a))}function $K(n,e,i={}){const{stop:a,getKey:l}=i;function d(f,_=[]){if(po(f)||Array.isArray(f)){const E={};for(const[b,w]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,k=[..._,I];if(a!=null&&a(f,k))return e(f,_);E[I]=d(w,k)}return E}return e(f,_)}return d(n)}var Bw={exports:{}};Bw.exports;var KK;function fSe(){return KK||(KK=1,function(n,e){var i=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,_="[object Arguments]",E="[object Array]",b="[object AsyncFunction]",w="[object Boolean]",I="[object Date]",k="[object Error]",V="[object Function]",L="[object GeneratorFunction]",F="[object Map]",B="[object Number]",q="[object Null]",$="[object Object]",Q="[object Proxy]",ae="[object RegExp]",re="[object Set]",fe="[object String]",Z="[object Undefined]",ee="[object WeakMap]",ne="[object ArrayBuffer]",oe="[object DataView]",ge="[object Float32Array]",pe="[object Float64Array]",le="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",tt="[object Uint8Array]",Ee="[object Uint8ClampedArray]",Ie="[object Uint16Array]",ve="[object Uint32Array]",Be=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Re=/^(?:0|[1-9]\d*)$/,he={};he[ge]=he[pe]=he[le]=he[Me]=he[He]=he[tt]=he[Ee]=he[Ie]=he[ve]=!0,he[_]=he[E]=he[ne]=he[w]=he[oe]=he[I]=he[k]=he[V]=he[F]=he[B]=he[$]=he[ae]=he[re]=he[fe]=he[ee]=!1;var we=typeof Iy=="object"&&Iy&&Iy.Object===Object&&Iy,Ue=typeof self=="object"&&self&&self.Object===Object&&self,Fe=we||Ue||Function("return this")(),$e=e&&!e.nodeType&&e,ct=$e&&!0&&n&&!n.nodeType&&n,it=ct&&ct.exports===$e,Ct=it&&we.process,Vt=function(){try{var be=ct&&ct.require&&ct.require("util").types;return be||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),Dt=Vt&&Vt.isTypedArray;function an(be,De,rt){switch(rt.length){case 0:return be.call(De);case 1:return be.call(De,rt[0]);case 2:return be.call(De,rt[0],rt[1]);case 3:return be.call(De,rt[0],rt[1],rt[2])}return be.apply(De,rt)}function jn(be,De){for(var rt=-1,Yt=Array(be);++rt<be;)Yt[rt]=De(rt);return Yt}function Qt(be){return function(De){return be(De)}}function Ot(be,De){return be==null?void 0:be[De]}function Lt(be,De){return function(rt){return be(De(rt))}}var Ce=Array.prototype,Ve=Function.prototype,Ye=Object.prototype,_t=Fe["__core-js_shared__"],vt=Ve.toString,St=Ye.hasOwnProperty,Ht=function(){var be=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return be?"Symbol(src)_1."+be:""}(),fn=Ye.toString,mn=vt.call(Object),Jt=RegExp("^"+vt.call(St).replace(Be,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hn=it?Fe.Buffer:void 0,mc=Fe.Symbol,Bt=Fe.Uint8Array;Hn&&Hn.allocUnsafe;var un=Lt(Object.getPrototypeOf,Object),rs=Object.create,Fs=Ye.propertyIsEnumerable,Qs=Ce.splice,Ei=mc?mc.toStringTag:void 0,$a=function(){try{var be=Ya(Object,"defineProperty");return be({},"",{}),be}catch{}}(),dl=Hn?Hn.isBuffer:void 0,_o=Math.max,yo=Date.now,ql=Ya(Fe,"Map"),Bs=Ya(Object,"create"),gc=function(){function be(){}return function(De){if(!bc(De))return{};if(rs)return rs(De);be.prototype=De;var rt=new be;return be.prototype=void 0,rt}}();function ua(be){var De=-1,rt=be==null?0:be.length;for(this.clear();++De<rt;){var Yt=be[De];this.set(Yt[0],Yt[1])}}function _c(){this.__data__=Bs?Bs(null):{},this.size=0}function hl(be){var De=this.has(be)&&delete this.__data__[be];return this.size-=De?1:0,De}function qu(be){var De=this.__data__;if(Bs){var rt=De[be];return rt===a?void 0:rt}return St.call(De,be)?De[be]:void 0}function yc(be){var De=this.__data__;return Bs?De[be]!==void 0:St.call(De,be)}function pl(be,De){var rt=this.__data__;return this.size+=this.has(be)?0:1,rt[be]=Bs&&De===void 0?a:De,this}ua.prototype.clear=_c,ua.prototype.delete=hl,ua.prototype.get=qu,ua.prototype.has=yc,ua.prototype.set=pl;function Do(be){var De=-1,rt=be==null?0:be.length;for(this.clear();++De<rt;){var Yt=be[De];this.set(Yt[0],Yt[1])}}function Mi(){this.__data__=[],this.size=0}function ds(be){var De=this.__data__,rt=nh(De,be);if(rt<0)return!1;var Yt=De.length-1;return rt==Yt?De.pop():Qs.call(De,rt,1),--this.size,!0}function Ka(be){var De=this.__data__,rt=nh(De,be);return rt<0?void 0:De[rt][1]}function Yu(be){return nh(this.__data__,be)>-1}function Ec(be,De){var rt=this.__data__,Yt=nh(rt,be);return Yt<0?(++this.size,rt.push([be,De])):rt[Yt][1]=De,this}Do.prototype.clear=Mi,Do.prototype.delete=ds,Do.prototype.get=Ka,Do.prototype.has=Yu,Do.prototype.set=Ec;function da(be){var De=-1,rt=be==null?0:be.length;for(this.clear();++De<rt;){var Yt=be[De];this.set(Yt[0],Yt[1])}}function ha(){this.size=0,this.__data__={hash:new ua,map:new(ql||Do),string:new ua}}function Qd(be){var De=Zu(this,be).delete(be);return this.size-=De?1:0,De}function Qg(be){return Zu(this,be).get(be)}function Xu(be){return Zu(this,be).has(be)}function Tp(be,De){var rt=Zu(this,be),Yt=rt.size;return rt.set(be,De),this.size+=rt.size==Yt?0:1,this}da.prototype.clear=ha,da.prototype.delete=Qd,da.prototype.get=Qg,da.prototype.has=Xu,da.prototype.set=Tp;function Ws(be){var De=this.__data__=new Do(be);this.size=De.size}function Ju(){this.__data__=new Do,this.size=0}function pa(be){var De=this.__data__,rt=De.delete(be);return this.size=De.size,rt}function Zd(be){return this.__data__.get(be)}function eh(be){return this.__data__.has(be)}function qa(be,De){var rt=this.__data__;if(rt instanceof Do){var Yt=rt.__data__;if(!ql||Yt.length<i-1)return Yt.push([be,De]),this.size=++rt.size,this;rt=this.__data__=new da(Yt)}return rt.set(be,De),this.size=rt.size,this}Ws.prototype.clear=Ju,Ws.prototype.delete=pa,Ws.prototype.get=Zd,Ws.prototype.has=eh,Ws.prototype.set=qa;function th(be,De){var rt=Uo(be),Yt=!rt&&is(be),Xn=!rt&&!Yt&&jo(be),wr=!rt&&!Yt&&!Xn&&Ap(be),Kr=rt||Yt||Xn||wr,dn=Kr?jn(be.length,String):[],jr=dn.length;for(var Si in be)Kr&&(Si=="length"||Xn&&(Si=="offset"||Si=="parent")||wr&&(Si=="buffer"||Si=="byteLength"||Si=="byteOffset")||gl(Si,jr))||dn.push(Si);return dn}function Qu(be,De,rt){(rt!==void 0&&!Mo(be[De],rt)||rt===void 0&&!(De in be))&&$r(be,De,rt)}function xo(be,De,rt){var Yt=be[De];(!(St.call(be,De)&&Mo(Yt,rt))||rt===void 0&&!(De in be))&&$r(be,De,rt)}function nh(be,De){for(var rt=be.length;rt--;)if(Mo(be[rt][0],De))return rt;return-1}function $r(be,De,rt){De=="__proto__"&&$a?$a(be,De,{configurable:!0,enumerable:!0,value:rt,writable:!0}):be[De]=rt}var vi=Jl();function vc(be){return be==null?be===void 0?Z:q:Ei&&Ei in Object(be)?Lo(be):nm(be)}function fl(be){return hs(be)&&vc(be)==_}function fa(be){if(!bc(be)||Xa(be))return!1;var De=Fo(be)?Jt:ke;return De.test(Ip(be))}function wp(be){return hs(be)&&im(be.length)&&!!he[vc(be)]}function rh(be){if(!bc(be))return Sc(be);var De=lr(be),rt=[];for(var Yt in be)Yt=="constructor"&&(De||!St.call(be,Yt))||rt.push(Yt);return rt}function Yl(be,De,rt,Yt,Xn){be!==De&&vi(De,function(wr,Kr){if(Xn||(Xn=new Ws),bc(wr))Eo(be,De,Kr,rt,Yl,Yt,Xn);else{var dn=Yt?Yt(oh(be,Kr),wr,Kr+"",be,De,Xn):void 0;dn===void 0&&(dn=wr),Qu(be,Kr,dn)}},tu)}function Eo(be,De,rt,Yt,Xn,wr,Kr){var dn=oh(be,rt),jr=oh(De,rt),Si=Kr.get(jr);if(Si){Qu(be,rt,Si);return}var Ps=wr?wr(dn,jr,rt+"",be,De,Kr):void 0,Bo=Ps===void 0;if(Bo){var Wo=Uo(jr),nd=!Wo&&jo(jr),Ji=!Wo&&!nd&&Ap(jr);Ps=jr,Wo||nd||Ji?Uo(dn)?Ps=dn:eu(dn)?Ps=sh(dn):nd?(Bo=!1,Ps=Cp(jr)):Ji?(Bo=!1,Ps=ih(jr)):Ps=[]:td(jr)||is(jr)?(Ps=dn,is(dn)?Ps=_l(dn):(!bc(dn)||Fo(dn))&&(Ps=ed(jr))):Bo=!1}Bo&&(Kr.set(jr,Ps),Xn(Ps,jr,Yt,wr,Kr),Kr.delete(jr)),Qu(be,rt,Ps)}function tm(be,De){return Rp(Zl(be,De,ga),be+"")}var Zs=$a?function(be,De){return $a(be,"toString",{configurable:!0,enumerable:!1,value:ma(De),writable:!0})}:ga;function Cp(be,De){return be.slice()}function ml(be){var De=new be.constructor(be.byteLength);return new Bt(De).set(new Bt(be)),De}function ih(be,De){var rt=ml(be.buffer);return new be.constructor(rt,be.byteOffset,be.length)}function sh(be,De){var rt=-1,Yt=be.length;for(De||(De=Array(Yt));++rt<Yt;)De[rt]=be[rt];return De}function yr(be,De,rt,Yt){var Xn=!rt;rt||(rt={});for(var wr=-1,Kr=De.length;++wr<Kr;){var dn=De[wr],jr=void 0;jr===void 0&&(jr=be[dn]),Xn?$r(rt,dn,jr):xo(rt,dn,jr)}return rt}function Xl(be){return tm(function(De,rt){var Yt=-1,Xn=rt.length,wr=Xn>1?rt[Xn-1]:void 0,Kr=Xn>2?rt[2]:void 0;for(wr=be.length>3&&typeof wr=="function"?(Xn--,wr):void 0,Kr&&Ql(rt[0],rt[1],Kr)&&(wr=Xn<3?void 0:wr,Xn=1),De=Object(De);++Yt<Xn;){var dn=rt[Yt];dn&&be(De,dn,Yt,wr)}return De})}function Jl(be){return function(De,rt,Yt){for(var Xn=-1,wr=Object(De),Kr=Yt(De),dn=Kr.length;dn--;){var jr=Kr[++Xn];if(rt(wr[jr],jr,wr)===!1)break}return De}}function Zu(be,De){var rt=be.__data__;return Xr(De)?rt[typeof De=="string"?"string":"hash"]:rt.map}function Ya(be,De){var rt=Ot(be,De);return fa(rt)?rt:void 0}function Lo(be){var De=St.call(be,Ei),rt=be[Ei];try{be[Ei]=void 0;var Yt=!0}catch{}var Xn=fn.call(be);return Yt&&(De?be[Ei]=rt:delete be[Ei]),Xn}function ed(be){return typeof be.constructor=="function"&&!lr(be)?gc(un(be)):{}}function gl(be,De){var rt=typeof be;return De=De??f,!!De&&(rt=="number"||rt!="symbol"&&Re.test(be))&&be>-1&&be%1==0&&be<De}function Ql(be,De,rt){if(!bc(rt))return!1;var Yt=typeof De;return(Yt=="number"?Vo(rt)&&gl(De,rt.length):Yt=="string"&&De in rt)?Mo(rt[De],be):!1}function Xr(be){var De=typeof be;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?be!=="__proto__":be===null}function Xa(be){return!!Ht&&Ht in be}function lr(be){var De=be&&be.constructor,rt=typeof De=="function"&&De.prototype||Ye;return be===rt}function Sc(be){var De=[];if(be!=null)for(var rt in Object(be))De.push(rt);return De}function nm(be){return fn.call(be)}function Zl(be,De,rt){return De=_o(De===void 0?be.length-1:De,0),function(){for(var Yt=arguments,Xn=-1,wr=_o(Yt.length-De,0),Kr=Array(wr);++Xn<wr;)Kr[Xn]=Yt[De+Xn];Xn=-1;for(var dn=Array(De+1);++Xn<De;)dn[Xn]=Yt[Xn];return dn[De]=rt(Kr),an(be,this,dn)}}function oh(be,De){if(!(De==="constructor"&&typeof be[De]=="function")&&De!="__proto__")return be[De]}var Rp=rm(Zs);function rm(be){var De=0,rt=0;return function(){var Yt=yo(),Xn=d-(Yt-rt);if(rt=Yt,Xn>0){if(++De>=l)return arguments[0]}else De=0;return be.apply(void 0,arguments)}}function Ip(be){if(be!=null){try{return vt.call(be)}catch{}try{return be+""}catch{}}return""}function Mo(be,De){return be===De||be!==be&&De!==De}var is=fl(function(){return arguments}())?fl:function(be){return hs(be)&&St.call(be,"callee")&&!Fs.call(be,"callee")},Uo=Array.isArray;function Vo(be){return be!=null&&im(be.length)&&!Fo(be)}function eu(be){return hs(be)&&Vo(be)}var jo=dl||yl;function Fo(be){if(!bc(be))return!1;var De=vc(be);return De==V||De==L||De==b||De==Q}function im(be){return typeof be=="number"&&be>-1&&be%1==0&&be<=f}function bc(be){var De=typeof be;return be!=null&&(De=="object"||De=="function")}function hs(be){return be!=null&&typeof be=="object"}function td(be){if(!hs(be)||vc(be)!=$)return!1;var De=un(be);if(De===null)return!0;var rt=St.call(De,"constructor")&&De.constructor;return typeof rt=="function"&&rt instanceof rt&&vt.call(rt)==mn}var Ap=Dt?Qt(Dt):wp;function _l(be){return yr(be,tu(be))}function tu(be){return Vo(be)?th(be):rh(be)}var sm=Xl(function(be,De,rt,Yt){Yl(be,De,rt,Yt)});function ma(be){return function(){return be}}function ga(be){return be}function yl(){return!1}n.exports=sm}(Bw,Bw.exports)),Bw.exports}var mSe=fSe();const ju=Xf(mSe);function rl(n,e=[]){const i=D.useRef(n);return D.useEffect(()=>{i.current=n}),D.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},e)}function t0(n,e,i,a){const l=rl(i);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(e,l,a),()=>{d.removeEventListener(e,l,a)}},[e,n,a,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(e,l,a)}}function $Z(n){const{isOpen:e,ref:i}=n,[a,l]=D.useState(e),[d,f]=D.useState(!1);return D.useEffect(()=>{d||(l(e),f(!0))},[e,d,a]),t0(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!a),onComplete(){var w;const E=Mve(i.current),b=new E.CustomEvent("animationend",{bubbles:!0});(w=i.current)==null||w.dispatchEvent(b)}}}var SM,qK;function gSe(){return qK||(qK=1,SM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],a=0;a<n.rangeCount;a++)i.push(n.getRangeAt(a));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),SM}var bM,YK;function _Se(){if(YK)return bM;YK=1;var n=gSe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function a(d){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,f)}function l(d,f){var _,E,b,w,I,k,V=!1;f||(f={}),_=f.debug||!1;try{b=n(),w=document.createRange(),I=document.getSelection(),k=document.createElement("span"),k.textContent=d,k.ariaHidden="true",k.style.all="unset",k.style.position="fixed",k.style.top=0,k.style.clip="rect(0, 0, 0, 0)",k.style.whiteSpace="pre",k.style.webkitUserSelect="text",k.style.MozUserSelect="text",k.style.msUserSelect="text",k.style.userSelect="text",k.addEventListener("copy",function(F){if(F.stopPropagation(),f.format)if(F.preventDefault(),typeof F.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var B=e[f.format]||e.default;window.clipboardData.setData(B,d)}else F.clipboardData.clearData(),F.clipboardData.setData(f.format,d);f.onCopy&&(F.preventDefault(),f.onCopy(F.clipboardData))}),document.body.appendChild(k),w.selectNodeContents(k),I.addRange(w);var L=document.execCommand("copy");if(!L)throw new Error("copy command was unsuccessful");V=!0}catch(F){_&&console.error("unable to copy using execCommand: ",F),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",d),f.onCopy&&f.onCopy(window.clipboardData),V=!0}catch(B){_&&console.error("unable to copy using clipboardData: ",B),_&&console.error("falling back to prompt"),E=a("message"in f?f.message:i),window.prompt(E,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(w):I.removeAllRanges()),k&&document.body.removeChild(k),b()}return V}return bM=l,bM}var ySe=_Se();const XK=Xf(ySe);function ESe(n,e={}){const[i,a]=D.useState(!1),[l,d]=D.useState(n);D.useEffect(()=>d(n),[n]);const{timeout:f=1500,..._}=typeof e=="number"?{timeout:e}:e,E=D.useCallback(b=>{const w=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(w).then(()=>a(!0)).catch(()=>a(XK(w,_))):a(XK(w,_))},[l,_]);return D.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,i]),{value:l,setValue:d,onCopy:E,hasCopied:i}}function KZ(n){const{value:e,defaultValue:i,onChange:a,shouldUpdate:l=(k,V)=>k!==V}=n,d=rl(a),f=rl(l),[_,E]=D.useState(i),b=e!==void 0,w=b?e:_,I=rl(k=>{const L=typeof k=="function"?k(w):k;f(w,L)&&(b||E(L),d(L))},[b,d,w,f]);return[w,I]}function qd(n={}){const{onClose:e,onOpen:i,isOpen:a,id:l}=n,d=rl(i),f=rl(e),[_,E]=D.useState(n.defaultIsOpen||!1),b=a!==void 0?a:_,w=a!==void 0,I=D.useId(),k=l??`disclosure-${I}`,V=D.useCallback(()=>{w||E(!1),f==null||f()},[w,f]),L=D.useCallback(()=>{w||E(!0),d==null||d()},[w,d]),F=D.useCallback(()=>{b?V():L()},[b,L,V]);function B($={}){return{...$,"aria-expanded":b,"aria-controls":k,onClick(Q){var ae;(ae=$.onClick)==null||ae.call($,Q),F()}}}function q($={}){return{...$,hidden:!b,id:k}}return{isOpen:b,onOpen:L,onClose:V,onToggle:F,isControlled:w,getButtonProps:B,getDisclosureProps:q}}const Lf=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,Ng=(n,e)=>{const i=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},e),D.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function vSe(n){const e=n.current;if(!e)return!1;const i=Vve(e);return!i||e.contains(i)?!1:!!Qve(i)}function qZ(n,e){const{shouldFocus:i,visible:a,focusRef:l}=e,d=i&&!a;Ng(()=>{if(!d||vSe(n))return;const f=(l==null?void 0:l.current)||n.current;let _;if(f)return _=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[d,n,l])}const SSe={preventScroll:!0,shouldFocus:!1};function bSe(n,e=SSe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:d}=e,f=TSe(n)?n.current:n,_=l&&d,E=D.useRef(_),b=D.useRef(d);Lf(()=>{!b.current&&d&&(E.current=_),b.current=d},[d,_]);const w=D.useCallback(()=>{if(!(!d||!f||!E.current)&&(E.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:a})});else{const I=FZ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,i]);Ng(()=>{w()},[w]),t0(f,"transitionend",w)}function TSe(n){return"current"in n}function wSe(n){return"current"in n}const YZ=()=>typeof window<"u";function CSe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const RSe=n=>YZ()&&n.test(navigator.vendor),ISe=n=>YZ()&&n.test(CSe()),ASe=()=>ISe(/mac|iphone|ipad|ipod/i),PSe=()=>ASe()&&RSe(/apple/i);function OSe(n){const{ref:e,elements:i,enabled:a}=n,l=()=>{var d;return((d=e.current)==null?void 0:d.ownerDocument)??document};t0(l,"pointerdown",d=>{var b,w;if(!PSe()||!a)return;const f=((w=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:w[0])??d.target,E=(i??[e]).some(I=>{const k=wSe(I)?I.current:I;return(k==null?void 0:k.contains(f))||k===f});l().activeElement!==f&&E&&(d.preventDefault(),f.focus())})}function kSe(n,e){const i=D.useId();return D.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function NSe(n,...e){const i=kSe(n);return D.useMemo(()=>e.map(a=>`${a}-${i}`),[i,e])}function XZ(n){const e=D.useRef(null);return e.current=n,e}function DSe(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Ki(...n){return e=>{n.forEach(i=>{DSe(i,e)})}}function xSe(...n){return D.useMemo(()=>Ki(...n),n)}function JZ(n){const{ref:e,handler:i,enabled:a=!0}=n,l=rl(i),f=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const _=I=>{TM(I,e)&&(f.isPointerDown=!0)},E=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&TM(I,e)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&TM(I,e)&&(f.isPointerDown=!1,l(I))},w=QZ(e.current);return w.addEventListener("mousedown",_,!0),w.addEventListener("mouseup",E,!0),w.addEventListener("touchstart",_,!0),w.addEventListener("touchend",b,!0),()=>{w.removeEventListener("mousedown",_,!0),w.removeEventListener("mouseup",E,!0),w.removeEventListener("touchstart",_,!0),w.removeEventListener("touchend",b,!0)}},[i,e,l,f,a])}function TM(n,e){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!QZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function QZ(n){return(n==null?void 0:n.ownerDocument)??document}function LSe(n,e){const i=rl(n);D.useEffect(()=>{if(e==null)return;let a=null;return a=window.setTimeout(()=>{i()},e),()=>{a&&window.clearTimeout(a)}},[e,i])}const ZZ=1/60*1e3,MSe=typeof performance<"u"?()=>performance.now():()=>Date.now(),eee=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(MSe()),ZZ);function USe(n){let e=[],i=[],a=0,l=!1,d=!1;const f=new WeakSet,_={schedule:(E,b=!1,w=!1)=>{const I=w&&l,k=I?e:i;return b&&f.add(E),k.indexOf(E)===-1&&(k.push(E),I&&l&&(a=e.length)),E},cancel:E=>{const b=i.indexOf(E);b!==-1&&i.splice(b,1),f.delete(E)},process:E=>{if(l){d=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,a=e.length,a)for(let b=0;b<a;b++){const w=e[b];w(E),f.has(w)&&(_.schedule(w),n())}l=!1,d&&(d=!1,_.process(E))}};return _}const VSe=40;let nV=!0,AC=!1,rV=!1;const n0={delta:0,timestamp:0},uR=["read","update","preRender","render","postRender"],xk=uR.reduce((n,e)=>(n[e]=USe(()=>AC=!0),n),{}),jSe=uR.reduce((n,e)=>{const i=xk[e];return n[e]=(a,l=!1,d=!1)=>(AC||WSe(),i.schedule(a,l,d)),n},{}),FSe=uR.reduce((n,e)=>(n[e]=xk[e].cancel,n),{});uR.reduce((n,e)=>(n[e]=()=>xk[e].process(n0),n),{});const BSe=n=>xk[n].process(n0),tee=n=>{AC=!1,n0.delta=nV?ZZ:Math.max(Math.min(n-n0.timestamp,VSe),1),n0.timestamp=n,rV=!0,uR.forEach(BSe),rV=!1,AC&&(nV=!1,eee(tee))},WSe=()=>{AC=!0,nV=!0,rV||eee(tee)},JK=()=>n0;var zSe=Object.defineProperty,GSe=(n,e,i)=>e in n?zSe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Md=(n,e,i)=>(GSe(n,typeof e!="symbol"?e+"":e,i),i);class HSe{constructor(e,i,a){if(Md(this,"history",[]),Md(this,"startEvent",null),Md(this,"lastEvent",null),Md(this,"lastEventInfo",null),Md(this,"handlers",{}),Md(this,"removeListeners",()=>{}),Md(this,"threshold",3),Md(this,"win"),Md(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=wM(this.lastEventInfo,this.history),E=this.startEvent!==null,b=YSe(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!b)return;const{timestamp:w}=JK();this.history.push({..._.point,timestamp:w});const{onStart:I,onMove:k}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),k==null||k(this.lastEvent,_)}),Md(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,jSe.update(this.updatePoint,!0)}),Md(this,"onPointerUp",(_,E)=>{const b=wM(E,this.history),{onEnd:w,onSessionEnd:I}=this.handlers;I==null||I(_,b),this.end(),!(!w||!this.startEvent)&&(w==null||w(_,b))}),this.win=e.view??window,Fve(e))return;this.handlers=i,a&&(this.threshold=a),e.stopPropagation(),e.preventDefault();const l={point:UZ(e)},{timestamp:d}=JK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=i;f==null||f(e,wM(l,this.history)),this.removeListeners=qSe(lO(this.win,"pointermove",this.onPointerMove),lO(this.win,"pointerup",this.onPointerUp),lO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),FSe.update(this.updatePoint)}}function QK(n,e){return{x:n.x-e.x,y:n.y-e.y}}function wM(n,e){return{point:n.point,delta:QK(n.point,e[e.length-1]),offset:QK(n.point,e[0]),velocity:KSe(e,.1)}}const $Se=n=>n*1e3;function KSe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>$Se(e)));)i--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function qSe(...n){return e=>n.reduce((i,a)=>a(i),e)}function CM(n,e){return Math.abs(n-e)}function ZK(n){return"x"in n&&"y"in n}function YSe(n,e){if(typeof n=="number"&&typeof e=="number")return CM(n,e);if(ZK(n)&&ZK(e)){const i=CM(n.x,e.x),a=CM(n.y,e.y);return Math.sqrt(i**2+a**2)}return 0}function XSe(n,e){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:_}=e,E=!!(i||a||l||d||f),b=D.useRef(null),w=XZ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:i,onEnd(I,k){b.current=null,l==null||l(I,k)}});D.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(w.current)}),D.useEffect(()=>{const I=n.current;if(!I||!E)return;function k(V){b.current=new HSe(V,w.current,_)}return lO(I,"pointerdown",k)},[n,E,w,_]),D.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const co={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},$h=n=>nee(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Sf=n=>nee(e=>n(e,"~ &"),"[data-peer]",".peer"),nee=(n,...e)=>e.map(n).join(", "),r0={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:$h(co.open),_groupClosed:$h(co.closed),_groupHover:$h(co.hover),_peerHover:Sf(co.hover),_groupFocus:$h(co.focus),_peerFocus:Sf(co.focus),_groupFocusVisible:$h(co.focusVisible),_peerFocusVisible:Sf(co.focusVisible),_groupActive:$h(co.active),_peerActive:Sf(co.active),_groupDisabled:$h(co.disabled),_peerDisabled:Sf(co.disabled),_groupInvalid:$h(co.invalid),_peerInvalid:Sf(co.invalid),_groupChecked:$h(co.checked),_peerChecked:Sf(co.checked),_groupFocusWithin:$h(co.focusWithin),_peerFocusWithin:Sf(co.focusWithin),_peerPlaceholderShown:Sf(co.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},ree=Object.keys(r0),JSe=n=>/!(important)?$/.test(n),eq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,QSe=(n,e)=>i=>{const a=String(e),l=JSe(a),d=eq(a),f=n?`${n}.${d}`:d;let _=po(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:e;return _=eq(_),l?`${_} !important`:_};function $j(n){const{scale:e,transform:i,compose:a}=n;return(d,f)=>{const _=QSe(e,d)(f);let E=(i==null?void 0:i(_,f))??_;return a&&(E=a(E,f)),E}}const I1=(...n)=>e=>n.reduce((i,a)=>a(i),e);function Ou(n,e){return i=>{const a={property:i,scale:n};return a.transform=$j({scale:n,transform:e}),a}}const ZSe=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function e0e(n){const{property:e,scale:i,transform:a}=n;return{scale:i,property:ZSe(e),transform:i?$j({scale:i,compose:a}):a}}const iee=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function t0e(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...iee].join(" ")}function n0e(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...iee].join(" ")}const r0e={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},i0e={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function s0e(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const o0e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},iV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},a0e=new Set(Object.values(iV)),sV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),c0e=n=>n.trim();function l0e(n,e){if(n==null||sV.has(n))return n;if(!(oV(n)||sV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const _=d.includes("-gradient")?d:`${d}-gradient`,[E,...b]=f.split(",").map(c0e).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const w=E in iV?iV[E]:E;b.unshift(w);const I=b.map(k=>{if(a0e.has(k))return k;const V=k.indexOf(" "),[L,F]=V!==-1?[k.substr(0,V),k.substr(V+1)]:[k],B=oV(F)?F:F&&F.split(" "),q=`colors.${L}`,$=q in e.__cssMap?e.__cssMap[q].varRef:L;return B?[$,...Array.isArray(B)?B:[B]].join(" "):$});return`${_}(${I.join(", ")})`}const oV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),u0e=(n,e)=>l0e(n,e??{});function d0e(n){return/^var\(--.+\)$/.test(n)}const h0e=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Kh=n=>e=>`${n}(${e})`,xr={filter(n){return n!=="auto"?n:r0e},backdropFilter(n){return n!=="auto"?n:i0e},ring(n){return s0e(xr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?t0e():n==="auto-gpu"?n0e():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=h0e(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(d0e(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:u0e,blur:Kh("blur"),opacity:Kh("opacity"),brightness:Kh("brightness"),contrast:Kh("contrast"),dropShadow:Kh("drop-shadow"),grayscale:Kh("grayscale"),hueRotate:n=>Kh("hue-rotate")(xr.degree(n)),invert:Kh("invert"),saturate:Kh("saturate"),sepia:Kh("sepia"),bgImage(n){return n==null||oV(n)||sV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=o0e[n]??{},a={flexDirection:n};return e&&(a[e]=1),i&&(a[i]=1),a}},ze={borderWidths:Ou("borderWidths"),borderStyles:Ou("borderStyles"),colors:Ou("colors"),borders:Ou("borders"),gradients:Ou("gradients",xr.gradient),radii:Ou("radii",xr.px),space:Ou("space",I1(xr.vh,xr.px)),spaceT:Ou("space",I1(xr.vh,xr.px)),degreeT(n){return{property:n,transform:xr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:$j({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Ou("sizes",I1(xr.vh,xr.px)),sizesT:Ou("sizes",I1(xr.vh,xr.fraction)),shadows:Ou("shadows"),logical:e0e,blur:Ou("blur",xr.blur)},uO={background:ze.colors("background"),backgroundColor:ze.colors("backgroundColor"),backgroundImage:ze.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:xr.bgClip},bgSize:ze.prop("backgroundSize"),bgPosition:ze.prop("backgroundPosition"),bg:ze.colors("background"),bgColor:ze.colors("backgroundColor"),bgPos:ze.prop("backgroundPosition"),bgRepeat:ze.prop("backgroundRepeat"),bgAttachment:ze.prop("backgroundAttachment"),bgGradient:ze.gradients("backgroundImage"),bgClip:{transform:xr.bgClip}};Object.assign(uO,{bgImage:uO.backgroundImage,bgImg:uO.backgroundImage});const Zr={border:ze.borders("border"),borderWidth:ze.borderWidths("borderWidth"),borderStyle:ze.borderStyles("borderStyle"),borderColor:ze.colors("borderColor"),borderRadius:ze.radii("borderRadius"),borderTop:ze.borders("borderTop"),borderBlockStart:ze.borders("borderBlockStart"),borderTopLeftRadius:ze.radii("borderTopLeftRadius"),borderStartStartRadius:ze.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:ze.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:ze.radii("borderTopRightRadius"),borderStartEndRadius:ze.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:ze.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:ze.borders("borderRight"),borderInlineEnd:ze.borders("borderInlineEnd"),borderBottom:ze.borders("borderBottom"),borderBlockEnd:ze.borders("borderBlockEnd"),borderBottomLeftRadius:ze.radii("borderBottomLeftRadius"),borderBottomRightRadius:ze.radii("borderBottomRightRadius"),borderLeft:ze.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:ze.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:ze.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:ze.borders(["borderLeft","borderRight"]),borderInline:ze.borders("borderInline"),borderY:ze.borders(["borderTop","borderBottom"]),borderBlock:ze.borders("borderBlock"),borderTopWidth:ze.borderWidths("borderTopWidth"),borderBlockStartWidth:ze.borderWidths("borderBlockStartWidth"),borderTopColor:ze.colors("borderTopColor"),borderBlockStartColor:ze.colors("borderBlockStartColor"),borderTopStyle:ze.borderStyles("borderTopStyle"),borderBlockStartStyle:ze.borderStyles("borderBlockStartStyle"),borderBottomWidth:ze.borderWidths("borderBottomWidth"),borderBlockEndWidth:ze.borderWidths("borderBlockEndWidth"),borderBottomColor:ze.colors("borderBottomColor"),borderBlockEndColor:ze.colors("borderBlockEndColor"),borderBottomStyle:ze.borderStyles("borderBottomStyle"),borderBlockEndStyle:ze.borderStyles("borderBlockEndStyle"),borderLeftWidth:ze.borderWidths("borderLeftWidth"),borderInlineStartWidth:ze.borderWidths("borderInlineStartWidth"),borderLeftColor:ze.colors("borderLeftColor"),borderInlineStartColor:ze.colors("borderInlineStartColor"),borderLeftStyle:ze.borderStyles("borderLeftStyle"),borderInlineStartStyle:ze.borderStyles("borderInlineStartStyle"),borderRightWidth:ze.borderWidths("borderRightWidth"),borderInlineEndWidth:ze.borderWidths("borderInlineEndWidth"),borderRightColor:ze.colors("borderRightColor"),borderInlineEndColor:ze.colors("borderInlineEndColor"),borderRightStyle:ze.borderStyles("borderRightStyle"),borderInlineEndStyle:ze.borderStyles("borderInlineEndStyle"),borderTopRadius:ze.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:ze.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:ze.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:ze.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Zr,{rounded:Zr.borderRadius,roundedTop:Zr.borderTopRadius,roundedTopLeft:Zr.borderTopLeftRadius,roundedTopRight:Zr.borderTopRightRadius,roundedTopStart:Zr.borderStartStartRadius,roundedTopEnd:Zr.borderStartEndRadius,roundedBottom:Zr.borderBottomRadius,roundedBottomLeft:Zr.borderBottomLeftRadius,roundedBottomRight:Zr.borderBottomRightRadius,roundedBottomStart:Zr.borderEndStartRadius,roundedBottomEnd:Zr.borderEndEndRadius,roundedLeft:Zr.borderLeftRadius,roundedRight:Zr.borderRightRadius,roundedStart:Zr.borderInlineStartRadius,roundedEnd:Zr.borderInlineEndRadius,borderStart:Zr.borderInlineStart,borderEnd:Zr.borderInlineEnd,borderTopStartRadius:Zr.borderStartStartRadius,borderTopEndRadius:Zr.borderStartEndRadius,borderBottomStartRadius:Zr.borderEndStartRadius,borderBottomEndRadius:Zr.borderEndEndRadius,borderStartRadius:Zr.borderInlineStartRadius,borderEndRadius:Zr.borderInlineEndRadius,borderStartWidth:Zr.borderInlineStartWidth,borderEndWidth:Zr.borderInlineEndWidth,borderStartColor:Zr.borderInlineStartColor,borderEndColor:Zr.borderInlineEndColor,borderStartStyle:Zr.borderInlineStartStyle,borderEndStyle:Zr.borderInlineEndStyle});const p0e={color:ze.colors("color"),textColor:ze.colors("color"),fill:ze.colors("fill"),stroke:ze.colors("stroke"),accentColor:ze.colors("accentColor"),textFillColor:ze.colors("textFillColor")},$O={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:xr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:ze.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:ze.space("gap"),rowGap:ze.space("rowGap"),columnGap:ze.space("columnGap")};Object.assign($O,{flexDir:$O.flexDirection});const Du={width:ze.sizesT("width"),inlineSize:ze.sizesT("inlineSize"),height:ze.sizes("height"),blockSize:ze.sizes("blockSize"),boxSize:ze.sizes(["width","height"]),minWidth:ze.sizes("minWidth"),minInlineSize:ze.sizes("minInlineSize"),minHeight:ze.sizes("minHeight"),minBlockSize:ze.sizes("minBlockSize"),maxWidth:ze.sizes("maxWidth"),maxInlineSize:ze.sizes("maxInlineSize"),maxHeight:ze.sizes("maxHeight"),maxBlockSize:ze.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:ze.propT("float",xr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Du,{w:Du.width,h:Du.height,minW:Du.minWidth,maxW:Du.maxWidth,minH:Du.minHeight,maxH:Du.maxHeight,overscroll:Du.overscrollBehavior,overscrollX:Du.overscrollBehaviorX,overscrollY:Du.overscrollBehaviorY});const f0e={filter:{transform:xr.filter},blur:ze.blur("--chakra-blur"),brightness:ze.propT("--chakra-brightness",xr.brightness),contrast:ze.propT("--chakra-contrast",xr.contrast),hueRotate:ze.propT("--chakra-hue-rotate",xr.hueRotate),invert:ze.propT("--chakra-invert",xr.invert),saturate:ze.propT("--chakra-saturate",xr.saturate),dropShadow:ze.propT("--chakra-drop-shadow",xr.dropShadow),backdropFilter:{transform:xr.backdropFilter},backdropBlur:ze.blur("--chakra-backdrop-blur"),backdropBrightness:ze.propT("--chakra-backdrop-brightness",xr.brightness),backdropContrast:ze.propT("--chakra-backdrop-contrast",xr.contrast),backdropHueRotate:ze.propT("--chakra-backdrop-hue-rotate",xr.hueRotate),backdropInvert:ze.propT("--chakra-backdrop-invert",xr.invert),backdropSaturate:ze.propT("--chakra-backdrop-saturate",xr.saturate)},m0e={ring:{transform:xr.ring},ringColor:ze.colors("--chakra-ring-color"),ringOffset:ze.prop("--chakra-ring-offset-width"),ringOffsetColor:ze.colors("--chakra-ring-offset-color"),ringInset:ze.prop("--chakra-ring-inset")},g0e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:xr.outline},outlineOffset:!0,outlineColor:ze.colors("outlineColor")},see={gridGap:ze.space("gridGap"),gridColumnGap:ze.space("gridColumnGap"),gridRowGap:ze.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function _0e(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const y0e=n=>{const e=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);e.has(a)||e.set(a,new Map);const _=e.get(a);if(_.has(l))return _.get(l);const E=n(a,l,d,f);return _.set(l,E),E}},E0e=y0e(_0e),v0e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},S0e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},RM=(n,e,i)=>{const a={},l=E0e(n,e,{});for(const d in l)d in i&&i[d]!=null||(a[d]=l[d]);return a},b0e={srOnly:{transform(n){return n===!0?v0e:n==="focusable"?S0e:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>RM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>RM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>RM(e,n,i)}},oC={position:!0,pos:ze.prop("position"),zIndex:ze.prop("zIndex","zIndices"),inset:ze.spaceT("inset"),insetX:ze.spaceT(["left","right"]),insetInline:ze.spaceT("insetInline"),insetY:ze.spaceT(["top","bottom"]),insetBlock:ze.spaceT("insetBlock"),top:ze.spaceT("top"),insetBlockStart:ze.spaceT("insetBlockStart"),bottom:ze.spaceT("bottom"),insetBlockEnd:ze.spaceT("insetBlockEnd"),left:ze.spaceT("left"),insetInlineStart:ze.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:ze.spaceT("right"),insetInlineEnd:ze.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(oC,{insetStart:oC.insetInlineStart,insetEnd:oC.insetInlineEnd});const aV={boxShadow:ze.shadows("boxShadow"),mixBlendMode:!0,blendMode:ze.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:ze.prop("backgroundBlendMode"),opacity:!0};Object.assign(aV,{shadow:aV.boxShadow});const Gi={margin:ze.spaceT("margin"),marginTop:ze.spaceT("marginTop"),marginBlockStart:ze.spaceT("marginBlockStart"),marginRight:ze.spaceT("marginRight"),marginInlineEnd:ze.spaceT("marginInlineEnd"),marginBottom:ze.spaceT("marginBottom"),marginBlockEnd:ze.spaceT("marginBlockEnd"),marginLeft:ze.spaceT("marginLeft"),marginInlineStart:ze.spaceT("marginInlineStart"),marginX:ze.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:ze.spaceT("marginInline"),marginY:ze.spaceT(["marginTop","marginBottom"]),marginBlock:ze.spaceT("marginBlock"),padding:ze.space("padding"),paddingTop:ze.space("paddingTop"),paddingBlockStart:ze.space("paddingBlockStart"),paddingRight:ze.space("paddingRight"),paddingBottom:ze.space("paddingBottom"),paddingBlockEnd:ze.space("paddingBlockEnd"),paddingLeft:ze.space("paddingLeft"),paddingInlineStart:ze.space("paddingInlineStart"),paddingInlineEnd:ze.space("paddingInlineEnd"),paddingX:ze.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:ze.space("paddingInline"),paddingY:ze.space(["paddingTop","paddingBottom"]),paddingBlock:ze.space("paddingBlock")};Object.assign(Gi,{m:Gi.margin,mt:Gi.marginTop,mr:Gi.marginRight,me:Gi.marginInlineEnd,marginEnd:Gi.marginInlineEnd,mb:Gi.marginBottom,ml:Gi.marginLeft,ms:Gi.marginInlineStart,marginStart:Gi.marginInlineStart,mx:Gi.marginX,my:Gi.marginY,p:Gi.padding,pt:Gi.paddingTop,py:Gi.paddingY,px:Gi.paddingX,pb:Gi.paddingBottom,pl:Gi.paddingLeft,ps:Gi.paddingInlineStart,paddingStart:Gi.paddingInlineStart,pr:Gi.paddingRight,pe:Gi.paddingInlineEnd,paddingEnd:Gi.paddingInlineEnd});const T0e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:ze.spaceT("scrollMargin"),scrollMarginTop:ze.spaceT("scrollMarginTop"),scrollMarginBottom:ze.spaceT("scrollMarginBottom"),scrollMarginLeft:ze.spaceT("scrollMarginLeft"),scrollMarginRight:ze.spaceT("scrollMarginRight"),scrollMarginX:ze.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:ze.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:ze.spaceT("scrollPadding"),scrollPaddingTop:ze.spaceT("scrollPaddingTop"),scrollPaddingBottom:ze.spaceT("scrollPaddingBottom"),scrollPaddingLeft:ze.spaceT("scrollPaddingLeft"),scrollPaddingRight:ze.spaceT("scrollPaddingRight"),scrollPaddingX:ze.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:ze.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},w0e={fontFamily:ze.prop("fontFamily","fonts"),fontSize:ze.prop("fontSize","fontSizes",xr.px),fontWeight:ze.prop("fontWeight","fontWeights"),lineHeight:ze.prop("lineHeight","lineHeights"),letterSpacing:ze.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},C0e={textDecorationColor:ze.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:ze.shadows("textShadow")},R0e={clipPath:!0,transform:ze.propT("transform",xr.transform),transformOrigin:!0,translateX:ze.spaceT("--chakra-translate-x"),translateY:ze.spaceT("--chakra-translate-y"),skewX:ze.degreeT("--chakra-skew-x"),skewY:ze.degreeT("--chakra-skew-y"),scaleX:ze.prop("--chakra-scale-x"),scaleY:ze.prop("--chakra-scale-y"),scale:ze.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:ze.degreeT("--chakra-rotate")},I0e={listStyleType:!0,listStylePosition:!0,listStylePos:ze.prop("listStylePosition"),listStyleImage:!0,listStyleImg:ze.prop("listStyleImage")},A0e={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:ze.prop("transitionDuration","transition.duration"),transitionProperty:ze.prop("transitionProperty","transition.property"),transitionTimingFunction:ze.prop("transitionTimingFunction","transition.easing")},Kj=ju({},uO,Zr,p0e,$O,Du,f0e,m0e,g0e,see,b0e,oC,aV,Gi,T0e,w0e,C0e,R0e,I0e,A0e),P0e=Object.assign({},Gi,Du,$O,see,oC),oee=Object.keys(P0e),O0e=[...Object.keys(Kj),...ree],k0e={...Kj,...r0},N0e=n=>n in k0e,D0e=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=e.__breakpoints,d={};for(const f in n){let _=tl(n[f],e);if(_==null)continue;if(_=po(_)&&i(_)?a(_):_,!Array.isArray(_)){d[f]=_;continue}const E=_.slice(0,l.length).length;for(let b=0;b<E;b+=1){const w=l==null?void 0:l[b];if(!w){d[f]=_[b];continue}d[w]=d[w]||{},_[b]!=null&&(d[w][f]=_[b])}}return d};function x0e(n){const e=[];let i="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,i+=d):d===")"?(a=!1,i+=d):d===","&&!a?(e.push(i),i=""):i+=d}return i=i.trim(),i&&e.push(i),e}function L0e(n){return/^var\(--.+\)$/.test(n)}const M0e=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!L0e(e),U0e=(n,e)=>{if(e==null)return e;const i=f=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[f])==null?void 0:E.varRef},a=f=>i(f)??f,[l,d]=x0e(e);return e=i(l)??a(d)??a(e),e};function V0e(n){const{configs:e={},pseudos:i={},theme:a}=n,l=(d,f=!1)=>{var w;const _=tl(d,a),E=D0e(_)(a);let b={};for(let I in E){const k=E[I];let V=tl(k,a);I in i&&(I=i[I]),M0e(I,V)&&(V=U0e(a,V));let L=e[I];if(L===!0&&(L={property:I}),po(V)){b[I]=b[I]??{},b[I]=ju({},b[I],l(V,!0));continue}let F=((w=L==null?void 0:L.transform)==null?void 0:w.call(L,V,a,_))??V;F=L!=null&&L.processResult?l(F,!0):F;const B=tl(L==null?void 0:L.property,a);if(!f&&(L!=null&&L.static)){const q=tl(L.static,a);b=ju({},b,q)}if(B&&Array.isArray(B)){for(const q of B)b[q]=F;continue}if(B){B==="&"&&po(F)?b=ju({},b,F):b[B]=F;continue}if(po(F)){b=ju({},b,F);continue}b[I]=F}return b};return l}const aee=n=>e=>V0e({theme:e,pseudos:r0,configs:Kj})(n);function uGe(n){return n}function dGe(n){return n}function Li(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function j0e(n,e,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${e}.${i}`])==null?void 0:l.varRef)??i}function F0e(n,e){if(Array.isArray(n))return n;if(po(n))return e(n);if(n!=null)return[n]}function B0e(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function W0e(n){const e=n.__breakpoints;return function(a,l,d,f){var k,V;if(!e)return;const _={},E=F0e(d,e.toArrayValue);if(!E)return _;const b=E.length,w=b===1,I=!!a.parts;for(let L=0;L<b;L++){const F=e.details[L],B=e.details[B0e(E,L)],q=Fw(F.minW,B==null?void 0:B._minW),$=tl((k=a[l])==null?void 0:k[E[L]],f);if($){if(I){(V=a.parts)==null||V.forEach(Q=>{ju(_,{[Q]:w?$[Q]:{[q]:$[Q]}})});continue}if(!I){w?ju(_,$):_[q]=$;continue}_[q]=$}}return _}}function z0e(n){return e=>{const{variant:i,size:a,theme:l}=e,d=W0e(l);return ju({},tl(n.baseStyle??{},e),d(n,"sizes",a,e),d(n,"variants",i,e))}}function Ii(n){return z0(n,["styleConfig","size","variant","colorScheme"])}function cee(n){return po(n)&&n.reference?n.reference:String(n)}const Lk=(n,...e)=>e.map(cee).join(` ${n} `).replace(/calc/g,""),tq=(...n)=>`calc(${Lk("+",...n)})`,nq=(...n)=>`calc(${Lk("-",...n)})`,cV=(...n)=>`calc(${Lk("*",...n)})`,rq=(...n)=>`calc(${Lk("/",...n)})`,iq=n=>{const e=cee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:cV(e,-1)},Cf=Object.assign(n=>({add:(...e)=>Cf(tq(n,...e)),subtract:(...e)=>Cf(nq(n,...e)),multiply:(...e)=>Cf(cV(n,...e)),divide:(...e)=>Cf(rq(n,...e)),negate:()=>Cf(iq(n)),toString:()=>n.toString()}),{add:tq,subtract:nq,multiply:cV,divide:rq,negate:iq});function G0e(n,e="-"){return n.replace(/\s+/g,e)}function H0e(n){const e=G0e(n.toString());return K0e($0e(e))}function $0e(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function K0e(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function q0e(n,e=""){return[e,n].filter(Boolean).join("-")}function Y0e(n,e){return`var(${n}${e?`, ${e}`:""})`}function X0e(n,e=""){return H0e(`--${q0e(n,e)}`)}function xn(n,e,i){const a=X0e(n,i);return{variable:a,reference:Y0e(a,e)}}function J0e(n,e){const i={};for(const a of e){if(Array.isArray(a)){const[l,d]=a;i[l]=xn(`${n}-${l}`,d);continue}i[a]=xn(`${n}-${a}`)}return i}const Q0e=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Z0e(n){return WZ(n,Q0e)}function ebe(n){return n.semanticTokens}function tbe(n){const{__cssMap:e,__cssVars:i,__breakpoints:a,...l}=n;return l}function nbe(n){const e=Z0e(n),i=ebe(n),a=d=>ree.includes(d)||d==="default",l={};return $K(e,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),$K(i,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function sq(n,e){return xn(String(n).replace(/\./g,"-"),void 0,e)}function rbe(n){var f;const e=nbe(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(_,E){const w=[String(_).split(".")[0],E].join(".");if(!e[w])return E;const{reference:k}=sq(w,i);return k}for(const[_,E]of Object.entries(e)){const{isSemantic:b,value:w}=E,{variable:I,reference:k}=sq(_,i);if(!b){if(_.startsWith("space")){const L=_.split("."),[F,...B]=L,q=`${F}.-${B.join(".")}`,$=Cf.negate(w),Q=Cf.negate(k);l[q]={value:$,var:I,varRef:Q}}a[I]=w,l[_]={value:w,var:I,varRef:k};continue}const V=po(w)?w:{default:w};a=ju(a,Object.entries(V).reduce((L,[F,B])=>{if(!B)return L;const q=d(_,`${B}`);if(F==="default")return L[I]=q,L;const $=(r0==null?void 0:r0[F])??F;return L[$]={[I]:q},L},{})),l[_]={value:k,var:I,varRef:k}}return{cssVars:a,cssMap:l}}function ibe(n){const e=tbe(n),{cssMap:i,cssVars:a}=rbe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:Yve(e.breakpoints)}),e}function si(n,e={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const I of w)e[I]=E(I);return si(n,e)}function d(...w){for(const I of w)I in e||(e[I]=E(I));return si(n,e)}function f(){return Object.fromEntries(Object.entries(e).map(([I,k])=>[I,k.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,k])=>[I,k.className]))}function E(w){const V=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:V,selector:`.${V}`,toString:()=>w}}return{parts:l,toPart:E,extend:d,selectors:f,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const sbe=si("accordion").parts("root","container","button","panel","icon"),obe=si("alert").parts("title","description","container","icon","spinner"),abe=si("avatar").parts("label","badge","container","excessLabel","group"),cbe=si("breadcrumb").parts("link","item","container","separator");si("button").parts();const lbe=si("checkbox").parts("control","icon","container","label");si("progress").parts("track","filledTrack","label");const ube=si("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),dbe=si("editable").parts("preview","input","textarea"),hbe=si("form").parts("container","requiredIndicator","helperText"),pbe=si("formError").parts("text","icon"),fbe=si("input").parts("addon","field","element","group"),mbe=si("list").parts("container","item","icon"),gbe=si("menu").parts("button","list","item","groupTitle","icon","command","divider"),_be=si("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),ybe=si("numberinput").parts("root","field","stepperGroup","stepper");si("pininput").parts("field");const Ebe=si("popover").parts("content","header","body","footer","popper","arrow","closeButton"),vbe=si("progress").parts("label","filledTrack","track"),Sbe=si("radio").parts("container","control","label"),bbe=si("select").parts("field","icon"),Tbe=si("slider").parts("container","track","thumb","filledTrack","mark"),wbe=si("stat").parts("container","label","helpText","number","icon"),Cbe=si("switch").parts("container","track","thumb","label"),Rbe=si("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Ibe=si("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Abe=si("tag").parts("container","label","closeButton"),Pbe=si("card").parts("container","header","body","footer");si("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Obe,defineMultiStyleConfig:kbe}=Li(sbe.keys),Nbe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Dbe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},xbe={pt:"2",px:"4",pb:"5"},Lbe={fontSize:"1.25em"},Mbe=Obe({container:Nbe,button:Dbe,panel:xbe,icon:Lbe}),Ube=kbe({baseStyle:Mbe});function Ay(n,e,i){return Math.min(Math.max(n,i),e)}class Vbe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Ww=Vbe;function qj(n){if(typeof n!="string")throw new Ww(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=$be.test(n)?Bbe(n):n;const i=Wbe.exec(e);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(_=>parseInt(PC(_,2),16)),parseInt(PC(f[3]||"f",2),16)/255]}const a=zbe.exec(e);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,16)),parseInt(f[3]||"ff",16)/255]}const l=Gbe.exec(e);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,10)),parseFloat(f[3]||"1")]}const d=Hbe.exec(e);if(d){const[f,_,E,b]=Array.from(d).slice(1).map(parseFloat);if(Ay(0,100,_)!==_)throw new Ww(n);if(Ay(0,100,E)!==E)throw new Ww(n);return[...Kbe(f,_,E),Number.isNaN(b)?1:b]}throw new Ww(n)}function jbe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const oq=n=>parseInt(n.replace(/_/g,""),36),Fbe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=oq(e.substring(0,3)),a=oq(e.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[i]=`${l}${a}`,n},{});function Bbe(n){const e=n.toLowerCase().trim(),i=Fbe[jbe(e)];if(!i)throw new Ww(n);return`#${i}`}const PC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),Wbe=new RegExp(`^#${PC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),zbe=new RegExp(`^#${PC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Gbe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${PC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Hbe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,$be=/^[a-z]+$/i,aq=n=>Math.round(n*255),Kbe=(n,e,i)=>{let a=i/100;if(e===0)return[a,a,a].map(aq);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(e/100),f=d*(1-Math.abs(l%2-1));let _=0,E=0,b=0;l>=0&&l<1?(_=d,E=f):l>=1&&l<2?(_=f,E=d):l>=2&&l<3?(E=d,b=f):l>=3&&l<4?(E=f,b=d):l>=4&&l<5?(_=f,b=d):l>=5&&l<6&&(_=d,b=f);const w=a-d/2,I=_+w,k=E+w,V=b+w;return[I,k,V].map(aq)};function qbe(n,e,i,a){return`rgba(${Ay(0,255,n).toFixed()}, ${Ay(0,255,e).toFixed()}, ${Ay(0,255,i).toFixed()}, ${parseFloat(Ay(0,1,a).toFixed(3))})`}function Ybe(n,e){const[i,a,l,d]=qj(n);return qbe(i,a,l,d-e)}function Xbe(n){const[e,i,a,l]=qj(n);let d=f=>{const _=Ay(0,255,f).toString(16);return _.length===1?`0${_}`:_};return`#${d(e)}${d(i)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const Jbe=n=>Object.keys(n).length===0;function Qbe(n,e,i,a,l){for(e=e.split?e.split("."):e,a=0;a<e.length;a++)n=n?n[e[a]]:l;return n===l?i:n}const dc=(n,e,i)=>{const a=Qbe(n,`colors.${e}`,e);try{return Xbe(a),a}catch{return i??"#000000"}},Zbe=n=>{const[e,i,a]=qj(n);return(e*299+i*587+a*114)/1e3},eTe=n=>e=>{const i=dc(e,n);return Zbe(i)<128?"dark":"light"},tTe=n=>e=>eTe(n)(e)==="dark",E0=(n,e)=>i=>{const a=dc(i,n);return Ybe(a,1-e)};function cq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const nTe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function rTe(n){const e=nTe();return!n||Jbe(n)?e:n.string&&n.colors?sTe(n.string,n.colors):n.string&&!n.colors?iTe(n.string):n.colors&&!n.string?oTe(n.colors):e}function iTe(n){let e=0;if(n.length===0)return e.toString();for(let a=0;a<n.length;a+=1)e=n.charCodeAt(a)+((e<<5)-e),e=e&e;let i="#";for(let a=0;a<3;a+=1){const l=e>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function sTe(n,e){let i=0;if(n.length===0)return e[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function oTe(n){return n[Math.floor(Math.random()*n.length)]}function Nn(n,e){return i=>i.colorMode==="dark"?e:n}function Yj(n){const{orientation:e,vertical:i,horizontal:a}=n;return e?e==="vertical"?i:a:{}}function lee(n){return po(n)&&n.reference?n.reference:String(n)}const Mk=(n,...e)=>e.map(lee).join(` ${n} `).replace(/calc/g,""),lq=(...n)=>`calc(${Mk("+",...n)})`,uq=(...n)=>`calc(${Mk("-",...n)})`,lV=(...n)=>`calc(${Mk("*",...n)})`,dq=(...n)=>`calc(${Mk("/",...n)})`,hq=n=>{const e=lee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:lV(e,-1)},Rf=Object.assign(n=>({add:(...e)=>Rf(lq(n,...e)),subtract:(...e)=>Rf(uq(n,...e)),multiply:(...e)=>Rf(lV(n,...e)),divide:(...e)=>Rf(dq(n,...e)),negate:()=>Rf(hq(n)),toString:()=>n.toString()}),{add:lq,subtract:uq,multiply:lV,divide:dq,negate:hq});function aTe(n){return!Number.isInteger(parseFloat(n.toString()))}function cTe(n,e="-"){return n.replace(/\s+/g,e)}function uee(n){const e=cTe(n.toString());return e.includes("\\.")?n:aTe(n)?e.replace(".","\\."):n}function lTe(n,e=""){return[e,uee(n)].filter(Boolean).join("-")}function uTe(n,e){return`var(${uee(n)}${e?`, ${e}`:""})`}function dTe(n,e=""){return`--${lTe(n,e)}`}function go(n,e){const i=dTe(n,e==null?void 0:e.prefix);return{variable:i,reference:uTe(i,hTe(e==null?void 0:e.fallback))}}function hTe(n){return n==null?void 0:n.reference}const{definePartsStyle:dR,defineMultiStyleConfig:pTe}=Li(obe.keys),jl=xn("alert-fg"),Wf=xn("alert-bg"),fTe=dR({container:{bg:Wf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:jl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:jl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function Xj(n){const{theme:e,colorScheme:i}=n,a=E0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:a}}const mTe=dR(n=>{const{colorScheme:e}=n,i=Xj(n);return{container:{[jl.variable]:`colors.${e}.600`,[Wf.variable]:i.light,_dark:{[jl.variable]:`colors.${e}.200`,[Wf.variable]:i.dark}}}}),gTe=dR(n=>{const{colorScheme:e}=n,i=Xj(n);return{container:{[jl.variable]:`colors.${e}.600`,[Wf.variable]:i.light,_dark:{[jl.variable]:`colors.${e}.200`,[Wf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:jl.reference}}}),_Te=dR(n=>{const{colorScheme:e}=n,i=Xj(n);return{container:{[jl.variable]:`colors.${e}.600`,[Wf.variable]:i.light,_dark:{[jl.variable]:`colors.${e}.200`,[Wf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:jl.reference}}}),yTe=dR(n=>{const{colorScheme:e}=n;return{container:{[jl.variable]:"colors.white",[Wf.variable]:`colors.${e}.600`,_dark:{[jl.variable]:"colors.gray.900",[Wf.variable]:`colors.${e}.200`},color:jl.reference}}}),ETe={subtle:mTe,"left-accent":gTe,"top-accent":_Te,solid:yTe},vTe=pTe({baseStyle:fTe,variants:ETe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),dee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},STe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},bTe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},hee={...dee,...STe,container:bTe},TTe=n=>typeof n=="function";function pc(n,...e){return TTe(n)?n(...e):n}const{definePartsStyle:pee,defineMultiStyleConfig:wTe}=Li(abe.keys),i0=xn("avatar-border-color"),aC=xn("avatar-bg"),OC=xn("avatar-font-size"),v0=xn("avatar-size"),CTe={borderRadius:"full",border:"0.2em solid",borderColor:i0.reference,[i0.variable]:"white",_dark:{[i0.variable]:"colors.gray.800"}},RTe={bg:aC.reference,fontSize:OC.reference,width:v0.reference,height:v0.reference,lineHeight:"1",[aC.variable]:"colors.gray.200",_dark:{[aC.variable]:"colors.whiteAlpha.400"}},ITe=n=>{const{name:e,theme:i}=n,a=e?rTe({string:e}):"colors.gray.400",l=tTe(a)(i);let d="white";return l||(d="gray.800"),{bg:aC.reference,fontSize:OC.reference,color:d,borderColor:i0.reference,verticalAlign:"top",width:v0.reference,height:v0.reference,"&:not([data-loaded])":{[aC.variable]:a},[i0.variable]:"colors.white",_dark:{[i0.variable]:"colors.gray.800"}}},ATe={fontSize:OC.reference,lineHeight:"1"},PTe=pee(n=>({badge:pc(CTe,n),excessLabel:pc(RTe,n),container:pc(ITe,n),label:ATe}));function cg(n){const e=n!=="100%"?hee[n]:void 0;return pee({container:{[v0.variable]:e??n,[OC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[v0.variable]:e??n,[OC.variable]:`calc(${e??n} / 2.5)`}})}const OTe={"2xs":cg(4),xs:cg(6),sm:cg(8),md:cg(12),lg:cg(16),xl:cg(24),"2xl":cg(32),full:cg("100%")},kTe=wTe({baseStyle:PTe,sizes:OTe,defaultProps:{size:"md"}}),Us=J0e("badge",["bg","color","shadow"]),NTe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Us.bg.reference,color:Us.color.reference,boxShadow:Us.shadow.reference},DTe=n=>{const{colorScheme:e,theme:i}=n,a=E0(`${e}.500`,.6)(i);return{[Us.bg.variable]:`colors.${e}.500`,[Us.color.variable]:"colors.white",_dark:{[Us.bg.variable]:a,[Us.color.variable]:"colors.whiteAlpha.800"}}},xTe=n=>{const{colorScheme:e,theme:i}=n,a=E0(`${e}.200`,.16)(i);return{[Us.bg.variable]:`colors.${e}.100`,[Us.color.variable]:`colors.${e}.800`,_dark:{[Us.bg.variable]:a,[Us.color.variable]:`colors.${e}.200`}}},LTe=n=>{const{colorScheme:e,theme:i}=n,a=E0(`${e}.200`,.8)(i);return{[Us.color.variable]:`colors.${e}.500`,_dark:{[Us.color.variable]:a},[Us.shadow.variable]:`inset 0 0 0px 1px ${Us.color.reference}`}},MTe={solid:DTe,subtle:xTe,outline:LTe},cC={baseStyle:NTe,variants:MTe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:UTe,definePartsStyle:VTe}=Li(cbe.keys),IM=xn("breadcrumb-link-decor"),jTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:IM.reference,[IM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[IM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},FTe=VTe({link:jTe}),BTe=UTe({baseStyle:FTe}),WTe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},fee=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Nn("gray.800","whiteAlpha.900")(n),_hover:{bg:Nn("gray.100","whiteAlpha.200")(n)},_active:{bg:Nn("gray.200","whiteAlpha.300")(n)}};const a=E0(`${e}.200`,.12)(i),l=E0(`${e}.200`,.24)(i);return{color:Nn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Nn(`${e}.50`,a)(n)},_active:{bg:Nn(`${e}.100`,l)(n)}}},zTe=n=>{const{colorScheme:e}=n,i=Nn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...pc(fee,n)}},GTe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},HTe=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Nn("gray.100","whiteAlpha.200")(n);return{bg:_,color:Nn("gray.800","whiteAlpha.900")(n),_hover:{bg:Nn("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Nn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:a="white",hoverBg:l=`${e}.600`,activeBg:d=`${e}.700`}=GTe[e]??{},f=Nn(i,`${e}.200`)(n);return{bg:f,color:Nn(a,"gray.800")(n),_hover:{bg:Nn(l,`${e}.300`)(n),_disabled:{bg:f}},_active:{bg:Nn(d,`${e}.400`)(n)}}},$Te=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Nn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Nn(`${e}.700`,`${e}.500`)(n)}}},KTe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},qTe={ghost:fee,outline:zTe,solid:HTe,link:$Te,unstyled:KTe},YTe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},XTe={baseStyle:WTe,variants:qTe,sizes:YTe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Dy,defineMultiStyleConfig:JTe}=Li(Pbe.keys),KO=xn("card-bg"),Mf=xn("card-padding"),mee=xn("card-shadow"),dO=xn("card-radius"),gee=xn("card-border-width","0"),_ee=xn("card-border-color"),QTe=Dy({container:{[KO.variable]:"colors.chakra-body-bg",backgroundColor:KO.reference,boxShadow:mee.reference,borderRadius:dO.reference,color:"chakra-body-text",borderWidth:gee.reference,borderColor:_ee.reference},body:{padding:Mf.reference,flex:"1 1 0%"},header:{padding:Mf.reference},footer:{padding:Mf.reference}}),ZTe={sm:Dy({container:{[dO.variable]:"radii.base",[Mf.variable]:"space.3"}}),md:Dy({container:{[dO.variable]:"radii.md",[Mf.variable]:"space.5"}}),lg:Dy({container:{[dO.variable]:"radii.xl",[Mf.variable]:"space.7"}})},ewe={elevated:Dy({container:{[mee.variable]:"shadows.base",_dark:{[KO.variable]:"colors.gray.700"}}}),outline:Dy({container:{[gee.variable]:"1px",[_ee.variable]:"colors.chakra-border-color"}}),filled:Dy({container:{[KO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Mf.variable]:0},header:{[Mf.variable]:0},footer:{[Mf.variable]:0}}},twe=JTe({baseStyle:QTe,variants:ewe,sizes:ZTe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:hO,defineMultiStyleConfig:nwe}=Li(lbe.keys),lC=xn("checkbox-size"),rwe=n=>{const{colorScheme:e}=n;return{w:lC.reference,h:lC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Nn(`${e}.500`,`${e}.200`)(n),borderColor:Nn(`${e}.500`,`${e}.200`)(n),color:Nn("white","gray.900")(n),_hover:{bg:Nn(`${e}.600`,`${e}.300`)(n),borderColor:Nn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Nn("gray.200","transparent")(n),bg:Nn("gray.200","whiteAlpha.300")(n),color:Nn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Nn(`${e}.500`,`${e}.200`)(n),borderColor:Nn(`${e}.500`,`${e}.200`)(n),color:Nn("white","gray.900")(n)},_disabled:{bg:Nn("gray.100","whiteAlpha.100")(n),borderColor:Nn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Nn("red.500","red.300")(n)}}},iwe={_disabled:{cursor:"not-allowed"}},swe={userSelect:"none",_disabled:{opacity:.4}},owe={transitionProperty:"transform",transitionDuration:"normal"},awe=hO(n=>({icon:owe,container:iwe,control:pc(rwe,n),label:swe})),cwe={sm:hO({control:{[lC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:hO({control:{[lC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:hO({control:{[lC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},pg=nwe({baseStyle:awe,sizes:cwe,defaultProps:{size:"md",colorScheme:"blue"}}),uC=go("close-button-size"),yw=go("close-button-bg"),lwe={w:[uC.reference],h:[uC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[yw.variable]:"colors.blackAlpha.100",_dark:{[yw.variable]:"colors.whiteAlpha.100"}},_active:{[yw.variable]:"colors.blackAlpha.200",_dark:{[yw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:yw.reference},uwe={lg:{[uC.variable]:"sizes.10",fontSize:"md"},md:{[uC.variable]:"sizes.8",fontSize:"xs"},sm:{[uC.variable]:"sizes.6",fontSize:"2xs"}},dwe={baseStyle:lwe,sizes:uwe,defaultProps:{size:"md"}},{variants:hwe,defaultProps:pwe}=cC,fwe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Us.bg.reference,color:Us.color.reference,boxShadow:Us.shadow.reference},mwe={baseStyle:fwe,variants:hwe,defaultProps:pwe},gwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},_we={baseStyle:gwe},ywe={opacity:.6,borderColor:"inherit"},Ewe={borderStyle:"solid"},vwe={borderStyle:"dashed"},Swe={solid:Ewe,dashed:vwe},bwe={baseStyle:ywe,variants:Swe,defaultProps:{variant:"solid"}},{definePartsStyle:uV,defineMultiStyleConfig:Twe}=Li(ube.keys),AM=xn("drawer-bg"),PM=xn("drawer-box-shadow");function AS(n){return uV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const wwe={bg:"blackAlpha.600",zIndex:"modal"},Cwe={display:"flex",zIndex:"modal",justifyContent:"center"},Rwe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[AM.variable]:"colors.white",[PM.variable]:"shadows.lg",_dark:{[AM.variable]:"colors.gray.700",[PM.variable]:"shadows.dark-lg"},bg:AM.reference,boxShadow:PM.reference}},Iwe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Awe={position:"absolute",top:"2",insetEnd:"3"},Pwe={px:"6",py:"2",flex:"1",overflow:"auto"},Owe={px:"6",py:"4"},kwe=uV(n=>({overlay:wwe,dialogContainer:Cwe,dialog:pc(Rwe,n),header:Iwe,closeButton:Awe,body:Pwe,footer:Owe})),Nwe={xs:AS("xs"),sm:AS("md"),md:AS("lg"),lg:AS("2xl"),xl:AS("4xl"),full:AS("full")},Dwe=Twe({baseStyle:kwe,sizes:Nwe,defaultProps:{size:"xs"}}),{definePartsStyle:xwe,defineMultiStyleConfig:Lwe}=Li(dbe.keys),Mwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Uwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Vwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},jwe=xwe({preview:Mwe,input:Uwe,textarea:Vwe}),Fwe=Lwe({baseStyle:jwe}),{definePartsStyle:Bwe,defineMultiStyleConfig:Wwe}=Li(hbe.keys),s0=xn("form-control-color"),zwe={marginStart:"1",[s0.variable]:"colors.red.500",_dark:{[s0.variable]:"colors.red.300"},color:s0.reference},Gwe={mt:"2",[s0.variable]:"colors.gray.600",_dark:{[s0.variable]:"colors.whiteAlpha.600"},color:s0.reference,lineHeight:"normal",fontSize:"sm"},Hwe=Bwe({container:{width:"100%",position:"relative"},requiredIndicator:zwe,helperText:Gwe}),$we=Wwe({baseStyle:Hwe}),{definePartsStyle:Kwe,defineMultiStyleConfig:qwe}=Li(pbe.keys),o0=xn("form-error-color"),Ywe={[o0.variable]:"colors.red.500",_dark:{[o0.variable]:"colors.red.300"},color:o0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Xwe={marginEnd:"0.5em",[o0.variable]:"colors.red.500",_dark:{[o0.variable]:"colors.red.300"},color:o0.reference},Jwe=Kwe({text:Ywe,icon:Xwe}),Qwe=qwe({baseStyle:Jwe}),Zwe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},eCe={baseStyle:Zwe},tCe={fontFamily:"heading",fontWeight:"bold"},nCe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},rCe={baseStyle:tCe,sizes:nCe,defaultProps:{size:"xl"}},{definePartsStyle:Af,defineMultiStyleConfig:iCe}=Li(fbe.keys),WS=xn("input-height"),zS=xn("input-font-size"),GS=xn("input-padding"),HS=xn("input-border-radius"),sCe=Af({addon:{height:WS.reference,fontSize:zS.reference,px:GS.reference,borderRadius:HS.reference},field:{width:"100%",height:WS.reference,fontSize:zS.reference,px:GS.reference,borderRadius:HS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),lg={lg:{[zS.variable]:"fontSizes.lg",[GS.variable]:"space.4",[HS.variable]:"radii.md",[WS.variable]:"sizes.12"},md:{[zS.variable]:"fontSizes.md",[GS.variable]:"space.4",[HS.variable]:"radii.md",[WS.variable]:"sizes.10"},sm:{[zS.variable]:"fontSizes.sm",[GS.variable]:"space.3",[HS.variable]:"radii.sm",[WS.variable]:"sizes.8"},xs:{[zS.variable]:"fontSizes.xs",[GS.variable]:"space.2",[HS.variable]:"radii.sm",[WS.variable]:"sizes.6"}},oCe={lg:Af({field:lg.lg,group:lg.lg}),md:Af({field:lg.md,group:lg.md}),sm:Af({field:lg.sm,group:lg.sm}),xs:Af({field:lg.xs,group:lg.xs})};function Jj(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Nn("blue.500","blue.300")(n),errorBorderColor:i||Nn("red.500","red.300")(n)}}const aCe=Af(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=Jj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Nn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:dc(e,a),boxShadow:`0 0 0 1px ${dc(e,a)}`},_focusVisible:{zIndex:1,borderColor:dc(e,i),boxShadow:`0 0 0 1px ${dc(e,i)}`}},addon:{border:"1px solid",borderColor:Nn("inherit","whiteAlpha.50")(n),bg:Nn("gray.100","whiteAlpha.300")(n)}}}),cCe=Af(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=Jj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Nn("gray.100","whiteAlpha.50")(n),_hover:{bg:Nn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:dc(e,a)},_focusVisible:{bg:"transparent",borderColor:dc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Nn("gray.100","whiteAlpha.50")(n)}}}),lCe=Af(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=Jj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:dc(e,a),boxShadow:`0px 1px 0px 0px ${dc(e,a)}`},_focusVisible:{borderColor:dc(e,i),boxShadow:`0px 1px 0px 0px ${dc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),uCe=Af({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),dCe={outline:aCe,filled:cCe,flushed:lCe,unstyled:uCe},ri=iCe({baseStyle:sCe,sizes:oCe,variants:dCe,defaultProps:{size:"md",variant:"outline"}}),OM=xn("kbd-bg"),hCe={[OM.variable]:"colors.gray.100",_dark:{[OM.variable]:"colors.whiteAlpha.100"},bg:OM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},pCe={baseStyle:hCe},fCe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},mCe={baseStyle:fCe},{defineMultiStyleConfig:gCe,definePartsStyle:_Ce}=Li(mbe.keys),yCe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},ECe=_Ce({icon:yCe}),vCe=gCe({baseStyle:ECe}),{defineMultiStyleConfig:SCe,definePartsStyle:bCe}=Li(gbe.keys),Yh=xn("menu-bg"),kM=xn("menu-shadow"),TCe={[Yh.variable]:"#fff",[kM.variable]:"shadows.sm",_dark:{[Yh.variable]:"colors.gray.700",[kM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Yh.reference,boxShadow:kM.reference},wCe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Yh.variable]:"colors.gray.100",_dark:{[Yh.variable]:"colors.whiteAlpha.100"}},_active:{[Yh.variable]:"colors.gray.200",_dark:{[Yh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Yh.variable]:"colors.gray.100",_dark:{[Yh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Yh.reference},CCe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},RCe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},ICe={opacity:.6},ACe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},PCe={transitionProperty:"common",transitionDuration:"normal"},OCe=bCe({button:PCe,list:TCe,item:wCe,groupTitle:CCe,icon:RCe,command:ICe,divider:ACe}),kCe=SCe({baseStyle:OCe}),{defineMultiStyleConfig:NCe,definePartsStyle:dV}=Li(_be.keys),NM=xn("modal-bg"),DM=xn("modal-shadow"),DCe={bg:"blackAlpha.600",zIndex:"modal"},xCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},LCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[NM.variable]:"colors.white",[DM.variable]:"shadows.lg",_dark:{[NM.variable]:"colors.gray.700",[DM.variable]:"shadows.dark-lg"},bg:NM.reference,boxShadow:DM.reference}},MCe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},UCe={position:"absolute",top:"2",insetEnd:"3"},VCe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},jCe={px:"6",py:"4"},FCe=dV(n=>({overlay:DCe,dialogContainer:pc(xCe,n),dialog:pc(LCe,n),header:MCe,closeButton:UCe,body:pc(VCe,n),footer:jCe}));function Ud(n){return dV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const BCe={xs:Ud("xs"),sm:Ud("sm"),md:Ud("md"),lg:Ud("lg"),xl:Ud("xl"),"2xl":Ud("2xl"),"3xl":Ud("3xl"),"4xl":Ud("4xl"),"5xl":Ud("5xl"),"6xl":Ud("6xl"),full:Ud("full")},WCe=NCe({baseStyle:FCe,sizes:BCe,defaultProps:{size:"md"}}),yee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:zCe,definePartsStyle:Eee}=Li(ybe.keys),Qj=go("number-input-stepper-width"),vee=go("number-input-input-padding"),GCe=Rf(Qj).add("0.5rem").toString(),xM=go("number-input-bg"),LM=go("number-input-color"),MM=go("number-input-border-color"),HCe={[Qj.variable]:"sizes.6",[vee.variable]:GCe},$Ce=n=>{var e;return((e=pc(ri.baseStyle,n))==null?void 0:e.field)??{}},KCe={width:Qj.reference},qCe={borderStart:"1px solid",borderStartColor:MM.reference,color:LM.reference,bg:xM.reference,[LM.variable]:"colors.chakra-body-text",[MM.variable]:"colors.chakra-border-color",_dark:{[LM.variable]:"colors.whiteAlpha.800",[MM.variable]:"colors.whiteAlpha.300"},_active:{[xM.variable]:"colors.gray.200",_dark:{[xM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},YCe=Eee(n=>({root:HCe,field:pc($Ce,n)??{},stepperGroup:KCe,stepper:qCe}));function A1(n){var d,f;const e=(d=ri.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=e.field)==null?void 0:f.fontSize)??"md",l=yee.fontSizes[a];return Eee({field:{...e.field,paddingInlineEnd:vee.reference,verticalAlign:"top"},stepper:{fontSize:Rf(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const XCe={xs:A1("xs"),sm:A1("sm"),md:A1("md"),lg:A1("lg")},JCe=zCe({baseStyle:YCe,sizes:XCe,variants:ri.variants,defaultProps:ri.defaultProps});var rZ;const QCe={...(rZ=ri.baseStyle)==null?void 0:rZ.field,textAlign:"center"},ZCe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var iZ;const eRe={outline:n=>{var e,i;return((i=pc((e=ri.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=pc((e=ri.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=pc((e=ri.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((iZ=ri.variants)==null?void 0:iZ.unstyled.field)??{}},tRe={baseStyle:QCe,sizes:ZCe,variants:eRe,defaultProps:ri.defaultProps},{defineMultiStyleConfig:nRe,definePartsStyle:rRe}=Li(Ebe.keys),P1=go("popper-bg"),iRe=go("popper-arrow-bg"),pq=go("popper-arrow-shadow-color"),sRe={zIndex:"popover"},oRe={[P1.variable]:"colors.white",bg:P1.reference,[iRe.variable]:P1.reference,[pq.variable]:"colors.gray.200",_dark:{[P1.variable]:"colors.gray.700",[pq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},aRe={px:3,py:2,borderBottomWidth:"1px"},cRe={px:3,py:2},lRe={px:3,py:2,borderTopWidth:"1px"},uRe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},dRe=rRe({popper:sRe,content:oRe,header:aRe,body:cRe,footer:lRe,closeButton:uRe}),hRe=nRe({baseStyle:dRe}),{defineMultiStyleConfig:pRe,definePartsStyle:zw}=Li(vbe.keys),fRe=n=>{const{colorScheme:e,theme:i,isIndeterminate:a,hasStripe:l}=n,d=Nn(cq(),cq("1rem","rgba(0,0,0,0.1)"))(n),f=Nn(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${dc(i,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:_}:{bgColor:f}}},mRe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},gRe=n=>({bg:Nn("gray.100","whiteAlpha.300")(n)}),_Re=n=>({transitionProperty:"common",transitionDuration:"slow",...fRe(n)}),yRe=zw(n=>({label:mRe,filledTrack:_Re(n),track:gRe(n)})),ERe={xs:zw({track:{h:"1"}}),sm:zw({track:{h:"2"}}),md:zw({track:{h:"3"}}),lg:zw({track:{h:"4"}})},vRe=pRe({sizes:ERe,baseStyle:yRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:SRe,definePartsStyle:pO}=Li(Sbe.keys),bRe=n=>{var i;const e=(i=pc(pg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},TRe=pO(n=>{var e,i;return{label:(e=pg.baseStyle)==null?void 0:e.call(pg,n).label,container:(i=pg.baseStyle)==null?void 0:i.call(pg,n).container,control:bRe(n)}}),wRe={md:pO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:pO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:pO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},CRe=SRe({baseStyle:TRe,sizes:wRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:RRe,definePartsStyle:IRe}=Li(bbe.keys),O1=xn("select-bg");var sZ;const ARe={...(sZ=ri.baseStyle)==null?void 0:sZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:O1.reference,[O1.variable]:"colors.white",_dark:{[O1.variable]:"colors.gray.700"},"> option, > optgroup":{bg:O1.reference}},PRe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},ORe=IRe({field:ARe,icon:PRe}),k1={paddingInlineEnd:"8"};var oZ,aZ,cZ,lZ,uZ,dZ,hZ,pZ;const kRe={lg:{...(oZ=ri.sizes)==null?void 0:oZ.lg,field:{...(aZ=ri.sizes)==null?void 0:aZ.lg.field,...k1}},md:{...(cZ=ri.sizes)==null?void 0:cZ.md,field:{...(lZ=ri.sizes)==null?void 0:lZ.md.field,...k1}},sm:{...(uZ=ri.sizes)==null?void 0:uZ.sm,field:{...(dZ=ri.sizes)==null?void 0:dZ.sm.field,...k1}},xs:{...(hZ=ri.sizes)==null?void 0:hZ.xs,field:{...(pZ=ri.sizes)==null?void 0:pZ.xs.field,...k1},icon:{insetEnd:"1"}}},NRe=RRe({baseStyle:ORe,sizes:kRe,variants:ri.variants,defaultProps:ri.defaultProps}),UM=xn("skeleton-start-color"),VM=xn("skeleton-end-color"),DRe={[UM.variable]:"colors.gray.100",[VM.variable]:"colors.gray.400",_dark:{[UM.variable]:"colors.gray.800",[VM.variable]:"colors.gray.600"},background:UM.reference,borderColor:VM.reference,opacity:.7,borderRadius:"sm"},xRe={baseStyle:DRe},jM=xn("skip-link-bg"),LRe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[jM.variable]:"colors.white",_dark:{[jM.variable]:"colors.gray.700"},bg:jM.reference}},MRe={baseStyle:LRe},{defineMultiStyleConfig:URe,definePartsStyle:Uk}=Li(Tbe.keys),By=xn("slider-thumb-size"),kC=xn("slider-track-size"),fg=xn("slider-bg"),VRe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...Yj({orientation:e,vertical:{h:"100%",px:Cf(By.reference).divide(2).toString()},horizontal:{w:"100%",py:Cf(By.reference).divide(2).toString()}})}},jRe=n=>({...Yj({orientation:n.orientation,horizontal:{h:kC.reference},vertical:{w:kC.reference}}),overflow:"hidden",borderRadius:"sm",[fg.variable]:"colors.gray.200",_dark:{[fg.variable]:"colors.whiteAlpha.200"},_disabled:{[fg.variable]:"colors.gray.300",_dark:{[fg.variable]:"colors.whiteAlpha.300"}},bg:fg.reference}),FRe=n=>{const{orientation:e}=n;return{...Yj({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:By.reference,h:By.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},BRe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[fg.variable]:`colors.${e}.500`,_dark:{[fg.variable]:`colors.${e}.200`},bg:fg.reference}},WRe=Uk(n=>({container:VRe(n),track:jRe(n),thumb:FRe(n),filledTrack:BRe(n)})),zRe=Uk({container:{[By.variable]:"sizes.4",[kC.variable]:"sizes.1"}}),GRe=Uk({container:{[By.variable]:"sizes.3.5",[kC.variable]:"sizes.1"}}),HRe=Uk({container:{[By.variable]:"sizes.2.5",[kC.variable]:"sizes.0.5"}}),$Re={lg:zRe,md:GRe,sm:HRe},KRe=URe({baseStyle:WRe,sizes:$Re,defaultProps:{size:"md",colorScheme:"blue"}}),Ry=go("spinner-size"),qRe={width:[Ry.reference],height:[Ry.reference]},YRe={xs:{[Ry.variable]:"sizes.3"},sm:{[Ry.variable]:"sizes.4"},md:{[Ry.variable]:"sizes.6"},lg:{[Ry.variable]:"sizes.8"},xl:{[Ry.variable]:"sizes.12"}},XRe={baseStyle:qRe,sizes:YRe,defaultProps:{size:"md"}},{defineMultiStyleConfig:JRe,definePartsStyle:See}=Li(wbe.keys),QRe={fontWeight:"medium"},ZRe={opacity:.8,marginBottom:"2"},eIe={verticalAlign:"baseline",fontWeight:"semibold"},tIe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},nIe=See({container:{},label:QRe,helpText:ZRe,number:eIe,icon:tIe}),rIe={md:See({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},iIe=JRe({baseStyle:nIe,sizes:rIe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:sIe,definePartsStyle:Gw}=Li(["stepper","step","title","description","indicator","separator","icon","number"]),If=xn("stepper-indicator-size"),$S=xn("stepper-icon-size"),KS=xn("stepper-title-font-size"),Hw=xn("stepper-description-font-size"),Ew=xn("stepper-accent-color"),oIe=Gw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[Ew.variable]:`colors.${n}.500`,_dark:{[Ew.variable]:`colors.${n}.200`}},title:{fontSize:KS.reference,fontWeight:"medium"},description:{fontSize:Hw.reference,color:"chakra-subtle-text"},number:{fontSize:KS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:$S.reference,height:$S.reference},indicator:{flexShrink:0,borderRadius:"full",width:If.reference,height:If.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:Ew.reference},"&[data-status=complete]":{bg:Ew.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:Ew.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${If.reference} - 8px)`,top:`calc(${If.reference} + 4px)`,insetStart:`calc(${If.reference} / 2 - 1px)`}}})),aIe=sIe({baseStyle:oIe,sizes:{xs:Gw({stepper:{[If.variable]:"sizes.4",[$S.variable]:"sizes.3",[KS.variable]:"fontSizes.xs",[Hw.variable]:"fontSizes.xs"}}),sm:Gw({stepper:{[If.variable]:"sizes.6",[$S.variable]:"sizes.4",[KS.variable]:"fontSizes.sm",[Hw.variable]:"fontSizes.xs"}}),md:Gw({stepper:{[If.variable]:"sizes.8",[$S.variable]:"sizes.5",[KS.variable]:"fontSizes.md",[Hw.variable]:"fontSizes.sm"}}),lg:Gw({stepper:{[If.variable]:"sizes.10",[$S.variable]:"sizes.6",[KS.variable]:"fontSizes.lg",[Hw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:cIe,definePartsStyle:fO}=Li(Cbe.keys),dC=go("switch-track-width"),xy=go("switch-track-height"),FM=go("switch-track-diff"),lIe=Rf.subtract(dC,xy),hV=go("switch-thumb-x"),vw=go("switch-bg"),uIe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[dC.reference],height:[xy.reference],transitionProperty:"common",transitionDuration:"fast",[vw.variable]:"colors.gray.300",_dark:{[vw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[vw.variable]:`colors.${e}.500`,_dark:{[vw.variable]:`colors.${e}.200`}},bg:vw.reference}},dIe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[xy.reference],height:[xy.reference],_checked:{transform:`translateX(${hV.reference})`}},hIe=fO(n=>({container:{[FM.variable]:lIe,[hV.variable]:FM.reference,_rtl:{[hV.variable]:Rf(FM).negate().toString()}},track:uIe(n),thumb:dIe})),pIe={sm:fO({container:{[dC.variable]:"1.375rem",[xy.variable]:"sizes.3"}}),md:fO({container:{[dC.variable]:"1.875rem",[xy.variable]:"sizes.4"}}),lg:fO({container:{[dC.variable]:"2.875rem",[xy.variable]:"sizes.6"}})},fIe=cIe({baseStyle:hIe,sizes:pIe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:mIe,definePartsStyle:a0}=Li(Rbe.keys),gIe=a0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),qO={"&[data-is-numeric=true]":{textAlign:"end"}},_Ie=a0(n=>{const{colorScheme:e}=n;return{th:{color:Nn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...qO},td:{borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...qO},caption:{color:Nn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),yIe=a0(n=>{const{colorScheme:e}=n;return{th:{color:Nn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...qO},td:{borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...qO},caption:{color:Nn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n)},td:{background:Nn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),EIe={simple:_Ie,striped:yIe,unstyled:{}},vIe={sm:a0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:a0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:a0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},SIe=mIe({baseStyle:gIe,variants:EIe,sizes:vIe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Zc=xn("tabs-color"),Fd=xn("tabs-bg"),N1=xn("tabs-border-color"),{defineMultiStyleConfig:bIe,definePartsStyle:sp}=Li(Ibe.keys),TIe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},wIe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},CIe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},RIe={p:4},IIe=sp(n=>({root:TIe(n),tab:wIe(n),tablist:CIe(n),tabpanel:RIe})),AIe={sm:sp({tab:{py:1,px:4,fontSize:"sm"}}),md:sp({tab:{fontSize:"md",py:2,px:4}}),lg:sp({tab:{fontSize:"lg",py:3,px:4}})},PIe=sp(n=>{const{colorScheme:e,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Zc.variable]:`colors.${e}.600`,_dark:{[Zc.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Fd.variable]:"colors.gray.200",_dark:{[Fd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Zc.reference,bg:Fd.reference}}}),OIe=sp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[N1.variable]:"transparent",_selected:{[Zc.variable]:`colors.${e}.600`,[N1.variable]:"colors.white",_dark:{[Zc.variable]:`colors.${e}.300`,[N1.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:N1.reference},color:Zc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),kIe=sp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Fd.variable]:"colors.gray.50",_dark:{[Fd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Fd.variable]:"colors.white",[Zc.variable]:`colors.${e}.600`,_dark:{[Fd.variable]:"colors.gray.800",[Zc.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Zc.reference,bg:Fd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),NIe=sp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:dc(i,`${e}.700`),bg:dc(i,`${e}.100`)}}}}),DIe=sp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[Zc.variable]:"colors.gray.600",_dark:{[Zc.variable]:"inherit"},_selected:{[Zc.variable]:"colors.white",[Fd.variable]:`colors.${e}.600`,_dark:{[Zc.variable]:"colors.gray.800",[Fd.variable]:`colors.${e}.300`}},color:Zc.reference,bg:Fd.reference}}}),xIe=sp({}),LIe={line:PIe,enclosed:OIe,"enclosed-colored":kIe,"soft-rounded":NIe,"solid-rounded":DIe,unstyled:xIe},MIe=bIe({baseStyle:IIe,sizes:AIe,variants:LIe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:UIe,definePartsStyle:Ly}=Li(Abe.keys),fq=xn("tag-bg"),mq=xn("tag-color"),BM=xn("tag-shadow"),mO=xn("tag-min-height"),gO=xn("tag-min-width"),_O=xn("tag-font-size"),yO=xn("tag-padding-inline"),VIe={fontWeight:"medium",lineHeight:1.2,outline:0,[mq.variable]:Us.color.reference,[fq.variable]:Us.bg.reference,[BM.variable]:Us.shadow.reference,color:mq.reference,bg:fq.reference,boxShadow:BM.reference,borderRadius:"md",minH:mO.reference,minW:gO.reference,fontSize:_O.reference,px:yO.reference,_focusVisible:{[BM.variable]:"shadows.outline"}},jIe={lineHeight:1.2,overflow:"visible"},FIe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},BIe=Ly({container:VIe,label:jIe,closeButton:FIe}),WIe={sm:Ly({container:{[mO.variable]:"sizes.5",[gO.variable]:"sizes.5",[_O.variable]:"fontSizes.xs",[yO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Ly({container:{[mO.variable]:"sizes.6",[gO.variable]:"sizes.6",[_O.variable]:"fontSizes.sm",[yO.variable]:"space.2"}}),lg:Ly({container:{[mO.variable]:"sizes.8",[gO.variable]:"sizes.8",[_O.variable]:"fontSizes.md",[yO.variable]:"space.3"}})},zIe={subtle:Ly(n=>{var e;return{container:(e=cC.variants)==null?void 0:e.subtle(n)}}),solid:Ly(n=>{var e;return{container:(e=cC.variants)==null?void 0:e.solid(n)}}),outline:Ly(n=>{var e;return{container:(e=cC.variants)==null?void 0:e.outline(n)}})},GIe=UIe({variants:zIe,baseStyle:BIe,sizes:WIe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var fZ;const HIe={...(fZ=ri.baseStyle)==null?void 0:fZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var mZ;const $Ie={outline:n=>{var e;return((e=ri.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=ri.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=ri.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((mZ=ri.variants)==null?void 0:mZ.unstyled.field)??{}};var gZ,_Z,yZ,EZ;const KIe={xs:((gZ=ri.sizes)==null?void 0:gZ.xs.field)??{},sm:((_Z=ri.sizes)==null?void 0:_Z.sm.field)??{},md:((yZ=ri.sizes)==null?void 0:yZ.md.field)??{},lg:((EZ=ri.sizes)==null?void 0:EZ.lg.field)??{}},qIe={baseStyle:HIe,sizes:KIe,variants:$Ie,defaultProps:{size:"md",variant:"outline"}},D1=go("tooltip-bg"),WM=go("tooltip-fg"),YIe=go("popper-arrow-bg"),XIe={bg:D1.reference,color:WM.reference,[D1.variable]:"colors.gray.700",[WM.variable]:"colors.whiteAlpha.900",_dark:{[D1.variable]:"colors.gray.300",[WM.variable]:"colors.gray.900"},[YIe.variable]:D1.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},JIe={baseStyle:XIe},QIe={Accordion:Ube,Alert:vTe,Avatar:kTe,Badge:cC,Breadcrumb:BTe,Button:XTe,Checkbox:pg,CloseButton:dwe,Code:mwe,Container:_we,Divider:bwe,Drawer:Dwe,Editable:Fwe,Form:$we,FormError:Qwe,FormLabel:eCe,Heading:rCe,Input:ri,Kbd:pCe,Link:mCe,List:vCe,Menu:kCe,Modal:WCe,NumberInput:JCe,PinInput:tRe,Popover:hRe,Progress:vRe,Radio:CRe,Select:NRe,Skeleton:xRe,SkipLink:MRe,Slider:KRe,Spinner:XRe,Stat:iIe,Switch:fIe,Table:SIe,Tabs:MIe,Tag:GIe,Textarea:qIe,Tooltip:JIe,Card:twe,Stepper:aIe},ZIe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},eAe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},tAe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},nAe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},rAe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},iAe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},sAe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},oAe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},aAe={property:iAe,easing:sAe,duration:oAe},cAe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},lAe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},uAe={breakpoints:eAe,zIndices:cAe,radii:nAe,blur:lAe,colors:tAe,...yee,sizes:hee,shadows:rAe,space:dee,borders:ZIe,transition:aAe},dAe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},hAe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},pAe=["borders","breakpoints","colors","components","config","direction","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","shadows","sizes","space","styles","transition","zIndices"];function fAe(n){return po(n)?pAe.every(e=>Object.prototype.hasOwnProperty.call(n,e)):!1}const mAe="ltr",gAe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},bee={semanticTokens:dAe,direction:mAe,...uAe,components:QIe,styles:hAe,config:gAe};function _Ae(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function yAe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var EAe=function(){function n(i){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(a){a.forEach(this._insertTag)},e.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(yAe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=_Ae(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},e.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Da="-ms-",YO="-moz-",ei="-webkit-",Tee="comm",Zj="rule",eF="decl",vAe="@import",wee="@keyframes",SAe="@layer",bAe=Math.abs,Vk=String.fromCharCode,TAe=Object.assign;function wAe(n,e){return oa(n,0)^45?(((e<<2^oa(n,0))<<2^oa(n,1))<<2^oa(n,2))<<2^oa(n,3):0}function Cee(n){return n.trim()}function CAe(n,e){return(n=e.exec(n))?n[0]:n}function ti(n,e,i){return n.replace(e,i)}function pV(n,e){return n.indexOf(e)}function oa(n,e){return n.charCodeAt(e)|0}function NC(n,e,i){return n.slice(e,i)}function Qh(n){return n.length}function tF(n){return n.length}function x1(n,e){return e.push(n),n}function RAe(n,e){return n.map(e).join("")}var jk=1,S0=1,Ree=0,ol=0,qs=0,G0="";function Fk(n,e,i,a,l,d,f){return{value:n,root:e,parent:i,type:a,props:l,children:d,line:jk,column:S0,length:f,return:""}}function Sw(n,e){return TAe(Fk("",null,null,"",null,null,0),n,{length:-n.length},e)}function IAe(){return qs}function AAe(){return qs=ol>0?oa(G0,--ol):0,S0--,qs===10&&(S0=1,jk--),qs}function Fl(){return qs=ol<Ree?oa(G0,ol++):0,S0++,qs===10&&(S0=1,jk++),qs}function op(){return oa(G0,ol)}function EO(){return ol}function hR(n,e){return NC(G0,n,e)}function DC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Iee(n){return jk=S0=1,Ree=Qh(G0=n),ol=0,[]}function Aee(n){return G0="",n}function vO(n){return Cee(hR(ol-1,fV(n===91?n+2:n===40?n+1:n)))}function PAe(n){for(;(qs=op())&&qs<33;)Fl();return DC(n)>2||DC(qs)>3?"":" "}function OAe(n,e){for(;--e&&Fl()&&!(qs<48||qs>102||qs>57&&qs<65||qs>70&&qs<97););return hR(n,EO()+(e<6&&op()==32&&Fl()==32))}function fV(n){for(;Fl();)switch(qs){case n:return ol;case 34:case 39:n!==34&&n!==39&&fV(qs);break;case 40:n===41&&fV(n);break;case 92:Fl();break}return ol}function kAe(n,e){for(;Fl()&&n+qs!==57;)if(n+qs===84&&op()===47)break;return"/*"+hR(e,ol-1)+"*"+Vk(n===47?n:Fl())}function NAe(n){for(;!DC(op());)Fl();return hR(n,ol)}function DAe(n){return Aee(SO("",null,null,null,[""],n=Iee(n),0,[0],n))}function SO(n,e,i,a,l,d,f,_,E){for(var b=0,w=0,I=f,k=0,V=0,L=0,F=1,B=1,q=1,$=0,Q="",ae=l,re=d,fe=a,Z=Q;B;)switch(L=$,$=Fl()){case 40:if(L!=108&&oa(Z,I-1)==58){pV(Z+=ti(vO($),"&","&\f"),"&\f")!=-1&&(q=-1);break}case 34:case 39:case 91:Z+=vO($);break;case 9:case 10:case 13:case 32:Z+=PAe(L);break;case 92:Z+=OAe(EO()-1,7);continue;case 47:switch(op()){case 42:case 47:x1(xAe(kAe(Fl(),EO()),e,i),E);break;default:Z+="/"}break;case 123*F:_[b++]=Qh(Z)*q;case 125*F:case 59:case 0:switch($){case 0:case 125:B=0;case 59+w:q==-1&&(Z=ti(Z,/\f/g,"")),V>0&&Qh(Z)-I&&x1(V>32?_q(Z+";",a,i,I-1):_q(ti(Z," ","")+";",a,i,I-2),E);break;case 59:Z+=";";default:if(x1(fe=gq(Z,e,i,b,w,l,_,Q,ae=[],re=[],I),d),$===123)if(w===0)SO(Z,e,fe,fe,ae,d,I,_,re);else switch(k===99&&oa(Z,3)===110?100:k){case 100:case 108:case 109:case 115:SO(n,fe,fe,a&&x1(gq(n,fe,fe,0,0,l,_,Q,l,ae=[],I),re),l,re,I,_,a?ae:re);break;default:SO(Z,fe,fe,fe,[""],re,0,_,re)}}b=w=V=0,F=q=1,Q=Z="",I=f;break;case 58:I=1+Qh(Z),V=L;default:if(F<1){if($==123)--F;else if($==125&&F++==0&&AAe()==125)continue}switch(Z+=Vk($),$*F){case 38:q=w>0?1:(Z+="\f",-1);break;case 44:_[b++]=(Qh(Z)-1)*q,q=1;break;case 64:op()===45&&(Z+=vO(Fl())),k=op(),w=I=Qh(Q=Z+=NAe(EO())),$++;break;case 45:L===45&&Qh(Z)==2&&(F=0)}}return d}function gq(n,e,i,a,l,d,f,_,E,b,w){for(var I=l-1,k=l===0?d:[""],V=tF(k),L=0,F=0,B=0;L<a;++L)for(var q=0,$=NC(n,I+1,I=bAe(F=f[L])),Q=n;q<V;++q)(Q=Cee(F>0?k[q]+" "+$:ti($,/&\f/g,k[q])))&&(E[B++]=Q);return Fk(n,e,i,l===0?Zj:_,E,b,w)}function xAe(n,e,i){return Fk(n,e,i,Tee,Vk(IAe()),NC(n,2,-2),0)}function _q(n,e,i,a){return Fk(n,e,i,eF,NC(n,0,a),NC(n,a+1,-1),a)}function c0(n,e){for(var i="",a=tF(n),l=0;l<a;l++)i+=e(n[l],l,n,e)||"";return i}function LAe(n,e,i,a){switch(n.type){case SAe:if(n.children.length)break;case vAe:case eF:return n.return=n.return||n.value;case Tee:return"";case wee:return n.return=n.value+"{"+c0(n.children,a)+"}";case Zj:n.value=n.props.join(",")}return Qh(i=c0(n.children,a))?n.return=n.value+"{"+i+"}":""}function MAe(n){var e=tF(n);return function(i,a,l,d){for(var f="",_=0;_<e;_++)f+=n[_](i,a,l,d)||"";return f}}function UAe(n){return function(e){e.root||(e=e.return)&&n(e)}}var yq=function(e){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=e(a);return i.set(a,l),l}};function Pee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var VAe=function(e,i,a){for(var l=0,d=0;l=d,d=op(),l===38&&d===12&&(i[a]=1),!DC(d);)Fl();return hR(e,ol)},jAe=function(e,i){var a=-1,l=44;do switch(DC(l)){case 0:l===38&&op()===12&&(i[a]=1),e[a]+=VAe(ol-1,i,a);break;case 2:e[a]+=vO(l);break;case 4:if(l===44){e[++a]=op()===58?"&\f":"",i[a]=e[a].length;break}default:e[a]+=Vk(l)}while(l=Fl());return e},FAe=function(e,i){return Aee(jAe(Iee(e),i))},Eq=new WeakMap,BAe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,a=e.parent,l=e.column===a.column&&e.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!Eq.get(a))&&!l){Eq.set(e,!0);for(var d=[],f=FAe(i,d),_=a.props,E=0,b=0;E<f.length;E++)for(var w=0;w<_.length;w++,b++)e.props[b]=d[E]?f[E].replace(/&\f/g,_[w]):_[w]+" "+f[E]}}},WAe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Oee(n,e){switch(wAe(n,e)){case 5103:return ei+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ei+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ei+n+YO+n+Da+n+n;case 6828:case 4268:return ei+n+Da+n+n;case 6165:return ei+n+Da+"flex-"+n+n;case 5187:return ei+n+ti(n,/(\w+).+(:[^]+)/,ei+"box-$1$2"+Da+"flex-$1$2")+n;case 5443:return ei+n+Da+"flex-item-"+ti(n,/flex-|-self/,"")+n;case 4675:return ei+n+Da+"flex-line-pack"+ti(n,/align-content|flex-|-self/,"")+n;case 5548:return ei+n+Da+ti(n,"shrink","negative")+n;case 5292:return ei+n+Da+ti(n,"basis","preferred-size")+n;case 6060:return ei+"box-"+ti(n,"-grow","")+ei+n+Da+ti(n,"grow","positive")+n;case 4554:return ei+ti(n,/([^-])(transform)/g,"$1"+ei+"$2")+n;case 6187:return ti(ti(ti(n,/(zoom-|grab)/,ei+"$1"),/(image-set)/,ei+"$1"),n,"")+n;case 5495:case 3959:return ti(n,/(image-set\([^]*)/,ei+"$1$`$1");case 4968:return ti(ti(n,/(.+:)(flex-)?(.*)/,ei+"box-pack:$3"+Da+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ei+n+n;case 4095:case 3583:case 4068:case 2532:return ti(n,/(.+)-inline(.+)/,ei+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Qh(n)-1-e>6)switch(oa(n,e+1)){case 109:if(oa(n,e+4)!==45)break;case 102:return ti(n,/(.+:)(.+)-([^]+)/,"$1"+ei+"$2-$3$1"+YO+(oa(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~pV(n,"stretch")?Oee(ti(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(oa(n,e+1)!==115)break;case 6444:switch(oa(n,Qh(n)-3-(~pV(n,"!important")&&10))){case 107:return ti(n,":",":"+ei)+n;case 101:return ti(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ei+(oa(n,14)===45?"inline-":"")+"box$3$1"+ei+"$2$3$1"+Da+"$2box$3")+n}break;case 5936:switch(oa(n,e+11)){case 114:return ei+n+Da+ti(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ei+n+Da+ti(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ei+n+Da+ti(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ei+n+Da+n+n}return n}var zAe=function(e,i,a,l){if(e.length>-1&&!e.return)switch(e.type){case eF:e.return=Oee(e.value,e.length);break;case wee:return c0([Sw(e,{value:ti(e.value,"@","@"+ei)})],l);case Zj:if(e.length)return RAe(e.props,function(d){switch(CAe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return c0([Sw(e,{props:[ti(d,/:(read-\w+)/,":"+YO+"$1")]})],l);case"::placeholder":return c0([Sw(e,{props:[ti(d,/:(plac\w+)/,":"+ei+"input-$1")]}),Sw(e,{props:[ti(d,/:(plac\w+)/,":"+YO+"$1")]}),Sw(e,{props:[ti(d,/:(plac\w+)/,Da+"input-$1")]})],l)}return""})}},GAe=[zAe],HAe=function(e){var i=e.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(F){var B=F.getAttribute("data-emotion");B.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var l=e.stylisPlugins||GAe,d={},f,_=[];f=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(F){for(var B=F.getAttribute("data-emotion").split(" "),q=1;q<B.length;q++)d[B[q]]=!0;_.push(F)});var E,b=[BAe,WAe];{var w,I=[LAe,UAe(function(F){w.insert(F)})],k=MAe(b.concat(l,I)),V=function(B){return c0(DAe(B),k)};E=function(B,q,$,Q){w=$,V(B?B+"{"+q.styles+"}":q.styles),Q&&(L.inserted[q.name]=!0)}}var L={key:i,sheet:new EAe({key:i,container:f,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:d,registered:{},insert:E};return L.sheet.hydrate(_),L};function Wy(){return Wy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Wy.apply(null,arguments)}var zM={exports:{}},ui={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vq;function $Ae(){if(vq)return ui;vq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,k=n?Symbol.for("react.suspense_list"):60120,V=n?Symbol.for("react.memo"):60115,L=n?Symbol.for("react.lazy"):60116,F=n?Symbol.for("react.block"):60121,B=n?Symbol.for("react.fundamental"):60117,q=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function Q(re){if(typeof re=="object"&&re!==null){var fe=re.$$typeof;switch(fe){case e:switch(re=re.type,re){case E:case b:case a:case d:case l:case I:return re;default:switch(re=re&&re.$$typeof,re){case _:case w:case L:case V:case f:return re;default:return fe}}case i:return fe}}}function ae(re){return Q(re)===b}return ui.AsyncMode=E,ui.ConcurrentMode=b,ui.ContextConsumer=_,ui.ContextProvider=f,ui.Element=e,ui.ForwardRef=w,ui.Fragment=a,ui.Lazy=L,ui.Memo=V,ui.Portal=i,ui.Profiler=d,ui.StrictMode=l,ui.Suspense=I,ui.isAsyncMode=function(re){return ae(re)||Q(re)===E},ui.isConcurrentMode=ae,ui.isContextConsumer=function(re){return Q(re)===_},ui.isContextProvider=function(re){return Q(re)===f},ui.isElement=function(re){return typeof re=="object"&&re!==null&&re.$$typeof===e},ui.isForwardRef=function(re){return Q(re)===w},ui.isFragment=function(re){return Q(re)===a},ui.isLazy=function(re){return Q(re)===L},ui.isMemo=function(re){return Q(re)===V},ui.isPortal=function(re){return Q(re)===i},ui.isProfiler=function(re){return Q(re)===d},ui.isStrictMode=function(re){return Q(re)===l},ui.isSuspense=function(re){return Q(re)===I},ui.isValidElementType=function(re){return typeof re=="string"||typeof re=="function"||re===a||re===b||re===d||re===l||re===I||re===k||typeof re=="object"&&re!==null&&(re.$$typeof===L||re.$$typeof===V||re.$$typeof===f||re.$$typeof===_||re.$$typeof===w||re.$$typeof===B||re.$$typeof===q||re.$$typeof===$||re.$$typeof===F)},ui.typeOf=Q,ui}var Sq;function KAe(){return Sq||(Sq=1,zM.exports=$Ae()),zM.exports}var GM,bq;function qAe(){if(bq)return GM;bq=1;var n=KAe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(L){return n.isMemo(L)?l:d[L.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,k=Object.prototype;function V(L,F,B){if(typeof F!="string"){if(k){var q=I(F);q&&q!==k&&V(L,q,B)}var $=E(F);b&&($=$.concat(b(F)));for(var Q=f(L),ae=f(F),re=0;re<$.length;++re){var fe=$[re];if(!i[fe]&&!(B&&B[fe])&&!(ae&&ae[fe])&&!(Q&&Q[fe])){var Z=w(F,fe);try{_(L,fe,Z)}catch{}}}}return L}return GM=V,GM}qAe();var YAe=!0;function kee(n,e,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(a+=l+" ")}),a}var nF=function(e,i,a){var l=e.key+"-"+i.name;(a===!1||YAe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},rF=function(e,i,a){nF(e,i,a);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var d=i;do e.insert(i===d?"."+l:"",d,e.sheet,!0),d=d.next;while(d!==void 0)}};function XAe(n){for(var e=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(a+2)&255)<<16;case 2:e^=(n.charCodeAt(a+1)&255)<<8;case 1:e^=n.charCodeAt(a)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var JAe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},QAe=/[A-Z]|^ms/g,ZAe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Nee=function(e){return e.charCodeAt(1)===45},Tq=function(e){return e!=null&&typeof e!="boolean"},HM=Pee(function(n){return Nee(n)?n:n.replace(QAe,"-$&").toLowerCase()}),wq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(ZAe,function(a,l,d){return Zh={name:l,styles:d,next:Zh},l})}return JAe[e]!==1&&!Nee(e)&&typeof i=="number"&&i!==0?i+"px":i};function xC(n,e,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Zh={name:l.name,styles:l.styles,next:Zh},l.name;var d=i;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Zh={name:f.name,styles:f.styles,next:Zh},f=f.next;var _=d.styles+";";return _}return ePe(n,e,i)}case"function":{if(n!==void 0){var E=Zh,b=i(n);return Zh=E,xC(n,e,b)}break}}var w=i;if(e==null)return w;var I=e[w];return I!==void 0?I:w}function ePe(n,e,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=xC(n,e,i[l])+";";else for(var d in i){var f=i[d];if(typeof f!="object"){var _=f;e!=null&&e[_]!==void 0?a+=d+"{"+e[_]+"}":Tq(_)&&(a+=HM(d)+":"+wq(d,_)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(e==null||e[f[0]]===void 0))for(var E=0;E<f.length;E++)Tq(f[E])&&(a+=HM(d)+":"+wq(d,f[E])+";");else{var b=xC(n,e,f);switch(d){case"animation":case"animationName":{a+=HM(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var Cq=/label:\s*([^\s;{]+)\s*(;|$)/g,Zh;function Bk(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Zh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=xC(i,e,d);else{var f=d;l+=f[0]}for(var _=1;_<n.length;_++)if(l+=xC(i,e,n[_]),a){var E=d;l+=E[_]}Cq.lastIndex=0;for(var b="",w;(w=Cq.exec(l))!==null;)b+="-"+w[1];var I=XAe(l)+b;return{name:I,styles:l,next:Zh}}var tPe=function(e){return e()},Dee=XU.useInsertionEffect?XU.useInsertionEffect:!1,xee=Dee||tPe,Rq=Dee||D.useLayoutEffect,iF=D.createContext(typeof HTMLElement<"u"?HAe({key:"css"}):null);iF.Provider;var nPe=function(){return D.useContext(iF)},sF=function(e){return D.forwardRef(function(i,a){var l=D.useContext(iF);return e(i,l,a)})},b0=D.createContext({}),rPe=function(e,i){if(typeof i=="function"){var a=i(e);return a}return Wy({},e,i)},iPe=yq(function(n){return yq(function(e){return rPe(n,e)})}),sPe=function(e){var i=D.useContext(b0);return e.theme!==i&&(i=iPe(i)(e.theme)),D.createElement(b0.Provider,{value:i},e.children)},oF={}.hasOwnProperty,mV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",oPe=function(e,i){var a={};for(var l in i)oF.call(i,l)&&(a[l]=i[l]);return a[mV]=e,a},aPe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return nF(i,a,l),xee(function(){return rF(i,a,l)}),null},cPe=sF(function(n,e,i){var a=n.css;typeof a=="string"&&e.registered[a]!==void 0&&(a=e.registered[a]);var l=n[mV],d=[a],f="";typeof n.className=="string"?f=kee(e.registered,d,n.className):n.className!=null&&(f=n.className+" ");var _=Bk(d,void 0,D.useContext(b0));f+=e.key+"-"+_.name;var E={};for(var b in n)oF.call(n,b)&&b!=="css"&&b!==mV&&(E[b]=n[b]);return E.className=f,i&&(E.ref=i),D.createElement(D.Fragment,null,D.createElement(aPe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),D.createElement(l,E))}),lPe=cPe,Iq=function(e,i){var a=arguments;if(i==null||!oF.call(i,"css"))return D.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=lPe,d[1]=oPe(e,i);for(var f=2;f<l;f++)d[f]=a[f];return D.createElement.apply(null,d)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(Iq||(Iq={}));var Wk=sF(function(n,e){var i=n.styles,a=Bk([i],void 0,D.useContext(b0)),l=D.useRef();return Rq(function(){var d=e.key+"-global",f=new e.sheet.constructor({key:d,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return e.sheet.tags.length&&(f.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",d),f.hydrate([E])),l.current=[f,_],function(){f.flush()}},[e]),Rq(function(){var d=l.current,f=d[0],_=d[1];if(_){d[1]=!1;return}if(a.next!==void 0&&rF(e,a.next,!0),f.tags.length){var E=f.tags[f.tags.length-1].nextElementSibling;f.before=E,f.flush()}e.insert("",a,f,!1)},[e,a.name]),null});function uPe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return Bk(e)}function pR(){var n=uPe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const aF=D.createContext({});aF.displayName="ColorModeContext";function zk(){const n=D.useContext(aF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Pf(n,e){const{colorMode:i}=zk();return i==="dark"?e:n}const L1={light:"chakra-ui-light",dark:"chakra-ui-dark"};function dPe(n={}){const{preventTransition:e=!0,nonce:i}=n,a={setDataset:l=>{const d=e?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?L1.dark:L1.light),document.body.classList.remove(l?L1.light:L1.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=_=>{l(_.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const hPe="chakra-ui-color-mode";function pPe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const fPe=pPe(hPe),Aq=()=>{},mPe=Dve()?D.useLayoutEffect:D.useEffect;function Pq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Lee=function(e){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:_=fPe}=e,E=nPe(),b=d==="dark"?"dark":"light",[w,I]=D.useState(()=>Pq(_,b)),[k,V]=D.useState(()=>Pq(_)),{getSystemTheme:L,setClassName:F,setDataset:B,addListener:q}=D.useMemo(()=>dPe({preventTransition:f,nonce:E==null?void 0:E.nonce}),[f,E==null?void 0:E.nonce]),$=d==="system"&&!w?k:w,Q=D.useCallback(fe=>{const Z=fe==="system"?L():fe;I(Z),F(Z==="dark"),B(Z),_.set(Z)},[_,L,F,B]);mPe(()=>{d==="system"&&V(L())},[]),D.useEffect(()=>{const fe=_.get();if(fe){Q(fe);return}if(d==="system"){Q("system");return}Q(b)},[_,b,d,Q]);const ae=D.useCallback(()=>{Q($==="dark"?"light":"dark")},[$,Q]);D.useEffect(()=>{if(l)return q(Q)},[l,q,Q]);const re=D.useMemo(()=>({colorMode:i??$,toggleColorMode:i?Aq:ae,setColorMode:i?Aq:Q,forced:i!==void 0}),[$,ae,Q,i]);return S.jsx(aF.Provider,{value:re,children:a})};Lee.displayName="ColorModeProvider";const Mee=String.raw,Uee=Mee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,gPe=()=>S.jsx(Wk,{styles:Uee}),_Pe=({scope:n=""})=>S.jsx(Wk,{styles:Mee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${Uee}
    `});function yPe(n){const{cssVarsRoot:e,theme:i,children:a}=n,l=D.useMemo(()=>ibe(i),[i]);return S.jsxs(sPe,{theme:l,children:[S.jsx(EPe,{root:e}),a]})}function EPe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return S.jsx(Wk,{styles:i=>({[e]:i.__cssVars})})}Ni({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function vPe(n){return Ni({name:`${n}StylesContext`,errorMessage:`useStyles: "styles" is undefined. Seems you forgot to wrap the components in "<${n} />" `})}function SPe(){const{colorMode:n}=zk();return S.jsx(Wk,{styles:e=>{const i=BZ(e,"styles.global"),a=tl(i,{theme:e,colorMode:n});return a?aee(a)(e):void 0}})}const[bPe,TPe]=Ni({strict:!1,name:"PortalManagerContext"});function cF(n){const{children:e,zIndex:i}=n;return S.jsx(bPe,{value:{zIndex:i},children:e})}cF.displayName="PortalManager";const lF=D.createContext({getDocument(){return document},getWindow(){return window}});lF.displayName="EnvironmentContext";function wPe({defer:n}={}){const[,e]=D.useReducer(i=>i+1,0);return Lf(()=>{n&&e()},[n]),D.useContext(lF)}function Vee(n){const{children:e,environment:i,disabled:a}=n,l=D.useRef(null),d=D.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),f=!a||!i;return S.jsxs(lF.Provider,{value:d,children:[e,f&&S.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Vee.displayName="EnvironmentProvider";const CPe=n=>{const{children:e,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:_,cssVarsRoot:E,disableEnvironment:b,disableGlobalStyle:w}=n,I=S.jsx(Vee,{environment:_,disabled:b,children:e});return S.jsx(yPe,{theme:f,cssVarsRoot:E,children:S.jsxs(Lee,{colorModeManager:i,options:f.config,children:[d?S.jsx(_Pe,{scope:l}):S.jsx(gPe,{}),!w&&S.jsx(SPe,{}),a?S.jsx(cF,{zIndex:a,children:I}):I]})})},uF=D.createContext({});function dF(n){const e=D.useRef(null);return e.current===null&&(e.current=n()),e.current}const fR=D.createContext(null),hF=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class RPe extends D.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function IPe({children:n,isPresent:e}){const i=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(hF);return D.useInsertionEffect(()=>{const{width:f,height:_,top:E,left:b}=l.current;if(e||!a.current||!f||!_)return;a.current.dataset.motionPopId=i;const w=document.createElement("style");return d&&(w.nonce=d),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[e]),S.jsx(RPe,{isPresent:e,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const APe=({children:n,initial:e,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const _=dF(PPe),E=D.useId(),b=D.useCallback(I=>{_.set(I,!0);for(const k of _.values())if(!k)return;a&&a()},[_,a]),w=D.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:b,register:I=>(_.set(I,!1),()=>_.delete(I))}),d?[Math.random(),b]:[i,b]);return D.useMemo(()=>{_.forEach((I,k)=>_.set(k,!1))},[i]),D.useEffect(()=>{!i&&!_.size&&a&&a()},[i]),f==="popLayout"&&(n=S.jsx(IPe,{isPresent:i,children:n})),S.jsx(fR.Provider,{value:w,children:n})};function PPe(){return new Map}function pF(n=!0){const e=D.useContext(fR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=e,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const f=D.useCallback(()=>n&&a&&a(d),[d,a,n]);return!i&&a?[!1,f]:[!0]}function OPe(){return kPe(D.useContext(fR))}function kPe(n){return n===null?!0:n.isPresent}const M1=n=>n.key||"";function Oq(n){const e=[];return D.Children.forEach(n,i=>{D.isValidElement(i)&&e.push(i)}),e}const fF=typeof window<"u",jee=fF?D.useLayoutEffect:D.useEffect,rE=({children:n,custom:e,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[_,E]=pF(f),b=D.useMemo(()=>Oq(n),[n]),w=f&&!_?[]:b.map(M1),I=D.useRef(!0),k=D.useRef(b),V=dF(()=>new Map),[L,F]=D.useState(b),[B,q]=D.useState(b);jee(()=>{I.current=!1,k.current=b;for(let ae=0;ae<B.length;ae++){const re=M1(B[ae]);w.includes(re)?V.delete(re):V.get(re)!==!0&&V.set(re,!1)}},[B,w.length,w.join("-")]);const $=[];if(b!==L){let ae=[...b];for(let re=0;re<B.length;re++){const fe=B[re],Z=M1(fe);w.includes(Z)||(ae.splice(re,0,fe),$.push(fe))}d==="wait"&&$.length&&(ae=$),q(Oq(ae)),F(b);return}const{forceRender:Q}=D.useContext(uF);return S.jsx(S.Fragment,{children:B.map(ae=>{const re=M1(ae),fe=f&&!_?!1:b===B||w.includes(re),Z=()=>{if(V.has(re))V.set(re,!0);else return;let ee=!0;V.forEach(ne=>{ne||(ee=!1)}),ee&&(Q==null||Q(),q(k.current),f&&(E==null||E()),a&&a())};return S.jsx(APe,{isPresent:fe,initial:!I.current||i?void 0:!1,custom:fe?void 0:e,presenceAffectsLayout:l,mode:d,onExitComplete:fe?void 0:Z,children:ae},re)})})},Bl=n=>n;let Fee=Bl;function mF(n){let e;return()=>(e===void 0&&(e=n()),e)}const T0=(n,e,i)=>{const a=e-n;return a===0?1:(i-n)/a},Uf=n=>n*1e3,Vf=n=>n/1e3,NPe={useManualTiming:!1};function DPe(n){let e=new Set,i=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function _(b){d.has(b)&&(E.schedule(b),n()),b(f)}const E={schedule:(b,w=!1,I=!1)=>{const V=I&&a?e:i;return w&&d.add(b),V.has(b)||V.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[e,i]=[i,e],e.forEach(_),e.clear(),a=!1,l&&(l=!1,E.process(b))}};return E}const U1=["read","resolveKeyframes","update","preRender","render","postRender"],xPe=40;function Bee(n,e){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,f=U1.reduce((q,$)=>(q[$]=DPe(d),q),{}),{read:_,resolveKeyframes:E,update:b,preRender:w,render:I,postRender:k}=f,V=()=>{const q=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(q-l.timestamp,xPe),1),l.timestamp=q,l.isProcessing=!0,_.process(l),E.process(l),b.process(l),w.process(l),I.process(l),k.process(l),l.isProcessing=!1,i&&e&&(a=!1,n(V))},L=()=>{i=!0,a=!0,l.isProcessing||n(V)};return{schedule:U1.reduce((q,$)=>{const Q=f[$];return q[$]=(ae,re=!1,fe=!1)=>(i||L(),Q.schedule(ae,re,fe)),q},{}),cancel:q=>{for(let $=0;$<U1.length;$++)f[U1[$]].cancel(q)},state:l,steps:f}}const{schedule:Yi,cancel:Dg,state:ia,steps:$M}=Bee(typeof requestAnimationFrame<"u"?requestAnimationFrame:Bl,!0),Wee=D.createContext({strict:!1}),kq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},w0={};for(const n in kq)w0[n]={isEnabled:e=>kq[n].some(i=>!!e[i])};function LPe(n){for(const e in n)w0[e]={...w0[e],...n[e]}}const MPe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function XO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||MPe.has(n)}let zee=n=>!XO(n);function UPe(n){n&&(zee=e=>e.startsWith("on")?!XO(e):n(e))}try{UPe(require("@emotion/is-prop-valid").default)}catch{}function VPe(n,e,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(zee(l)||i===!0&&XO(l)||!e&&!XO(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function jPe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const Gk=D.createContext({});function LC(n){return typeof n=="string"||Array.isArray(n)}function Hk(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const gF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],_F=["initial",...gF];function $k(n){return Hk(n.animate)||_F.some(e=>LC(n[e]))}function Gee(n){return!!($k(n)||n.variants)}function FPe(n,e){if($k(n)){const{initial:i,animate:a}=n;return{initial:i===!1||LC(i)?i:void 0,animate:LC(a)?a:void 0}}return n.inherit!==!1?e:{}}function BPe(n){const{initial:e,animate:i}=FPe(n,D.useContext(Gk));return D.useMemo(()=>({initial:e,animate:i}),[Nq(e),Nq(i)])}function Nq(n){return Array.isArray(n)?n.join(" "):n}const WPe=Symbol.for("motionComponentSymbol");function qS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function zPe(n,e,i){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),e&&(a?e.mount(a):e.unmount()),i&&(typeof i=="function"?i(a):qS(i)&&(i.current=a))},[e])}const yF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),GPe="framerAppearId",Hee="data-"+yF(GPe),{schedule:EF}=Bee(queueMicrotask,!1),$ee=D.createContext({});function HPe(n,e,i,a,l){var d,f;const{visualElement:_}=D.useContext(Gk),E=D.useContext(Wee),b=D.useContext(fR),w=D.useContext(hF).reducedMotion,I=D.useRef(null);a=a||E.renderer,!I.current&&a&&(I.current=a(n,{visualState:e,parent:_,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:w}));const k=I.current,V=D.useContext($ee);k&&!k.projection&&l&&(k.type==="html"||k.type==="svg")&&$Pe(I.current,i,l,V);const L=D.useRef(!1);D.useInsertionEffect(()=>{k&&L.current&&k.update(i,b)});const F=i[Hee],B=D.useRef(!!F&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,F))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,F)));return jee(()=>{k&&(L.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),EF.render(k.render),B.current&&k.animationState&&k.animationState.animateChanges())}),D.useEffect(()=>{k&&(!B.current&&k.animationState&&k.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{var q;(q=window.MotionHandoffMarkAsComplete)===null||q===void 0||q.call(window,F)}),B.current=!1))}),k}function $Pe(n,e,i,a){const{layoutId:l,layout:d,drag:f,dragConstraints:_,layoutScroll:E,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:Kee(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||_&&qS(_),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:E,layoutRoot:b})}function Kee(n){if(n)return n.options.allowProjection!==!1?n.projection:Kee(n.parent)}function KPe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:a,Component:l}){var d,f;n&&LPe(n);function _(b,w){let I;const k={...D.useContext(hF),...b,layoutId:qPe(b)},{isStatic:V}=k,L=BPe(b),F=a(b,V);if(!V&&fF){YPe();const B=XPe(k);I=B.MeasureLayout,L.visualElement=HPe(l,F,k,e,B.ProjectionNode)}return S.jsxs(Gk.Provider,{value:L,children:[I&&L.visualElement?S.jsx(I,{visualElement:L.visualElement,...k}):null,i(l,b,zPe(F,L.visualElement,w),F,V,L.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const E=D.forwardRef(_);return E[WPe]=l,E}function qPe({layoutId:n}){const e=D.useContext(uF).id;return e&&n!==void 0?e+"-"+n:n}function YPe(n,e){D.useContext(Wee).strict}function XPe(n){const{drag:e,layout:i}=w0;if(!e&&!i)return{};const a={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const JPe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function vF(n){return typeof n!="string"||n.includes("-")?!1:!!(JPe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Dq(n){const e=[{},{}];return n==null||n.values.forEach((i,a)=>{e[0][a]=i.get(),e[1][a]=i.getVelocity()}),e}function SF(n,e,i,a){if(typeof e=="function"){const[l,d]=Dq(a);e=e(i!==void 0?i:n.custom,l,d)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,d]=Dq(a);e=e(i!==void 0?i:n.custom,l,d)}return e}const gV=n=>Array.isArray(n),QPe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),ZPe=n=>gV(n)?n[n.length-1]||0:n,Ua=n=>!!(n&&n.getVelocity);function bO(n){const e=Ua(n)?n.get():n;return QPe(e)?e.toValue():e}function e1e({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},a,l,d){const f={latestValues:t1e(a,l,d,n),renderState:e()};return i&&(f.onMount=_=>i({props:a,current:_,...f}),f.onUpdate=_=>i(_)),f}const qee=n=>(e,i)=>{const a=D.useContext(Gk),l=D.useContext(fR),d=()=>e1e(n,e,a,l);return i?d():dF(d)};function t1e(n,e,i,a){const l={},d=a(n,{});for(const k in d)l[k]=bO(d[k]);let{initial:f,animate:_}=n;const E=$k(n),b=Gee(n);e&&b&&!E&&n.inherit!==!1&&(f===void 0&&(f=e.initial),_===void 0&&(_=e.animate));let w=i?i.initial===!1:!1;w=w||f===!1;const I=w?_:f;if(I&&typeof I!="boolean"&&!Hk(I)){const k=Array.isArray(I)?I:[I];for(let V=0;V<k.length;V++){const L=SF(n,k[V]);if(L){const{transitionEnd:F,transition:B,...q}=L;for(const $ in q){let Q=q[$];if(Array.isArray(Q)){const ae=w?Q.length-1:0;Q=Q[ae]}Q!==null&&(l[$]=Q)}for(const $ in F)l[$]=F[$]}}}return l}const H0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],iE=new Set(H0),Yee=n=>e=>typeof e=="string"&&e.startsWith(n),Xee=Yee("--"),n1e=Yee("var(--"),bF=n=>n1e(n)?r1e.test(n.split("/*")[0].trim()):!1,r1e=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Jee=(n,e)=>e&&typeof n=="number"?e.transform(n):n,zf=(n,e,i)=>i>e?e:i<n?n:i,$0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},MC={...$0,transform:n=>zf(0,1,n)},V1={...$0,default:1},mR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),dg=mR("deg"),ap=mR("%"),Un=mR("px"),i1e=mR("vh"),s1e=mR("vw"),xq={...ap,parse:n=>ap.parse(n)/100,transform:n=>ap.transform(n*100)},o1e={borderWidth:Un,borderTopWidth:Un,borderRightWidth:Un,borderBottomWidth:Un,borderLeftWidth:Un,borderRadius:Un,radius:Un,borderTopLeftRadius:Un,borderTopRightRadius:Un,borderBottomRightRadius:Un,borderBottomLeftRadius:Un,width:Un,maxWidth:Un,height:Un,maxHeight:Un,top:Un,right:Un,bottom:Un,left:Un,padding:Un,paddingTop:Un,paddingRight:Un,paddingBottom:Un,paddingLeft:Un,margin:Un,marginTop:Un,marginRight:Un,marginBottom:Un,marginLeft:Un,backgroundPositionX:Un,backgroundPositionY:Un},a1e={rotate:dg,rotateX:dg,rotateY:dg,rotateZ:dg,scale:V1,scaleX:V1,scaleY:V1,scaleZ:V1,skew:dg,skewX:dg,skewY:dg,distance:Un,translateX:Un,translateY:Un,translateZ:Un,x:Un,y:Un,z:Un,perspective:Un,transformPerspective:Un,opacity:MC,originX:xq,originY:xq,originZ:Un},Lq={...$0,transform:Math.round},TF={...o1e,...a1e,zIndex:Lq,size:Un,fillOpacity:MC,strokeOpacity:MC,numOctaves:Lq},c1e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},l1e=H0.length;function u1e(n,e,i){let a="",l=!0;for(let d=0;d<l1e;d++){const f=H0[d],_=n[f];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(f.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const b=Jee(_,TF[f]);if(!E){l=!1;const w=c1e[f]||f;a+=`${w}(${b}) `}i&&(e[f]=b)}}return a=a.trim(),i?a=i(e,l?"":a):l&&(a="none"),a}function wF(n,e,i){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,_=!1;for(const E in e){const b=e[E];if(iE.has(E)){f=!0;continue}else if(Xee(E)){l[E]=b;continue}else{const w=Jee(b,TF[E]);E.startsWith("origin")?(_=!0,d[E]=w):a[E]=w}}if(e.transform||(f||i?a.transform=u1e(e,n.transform,i):a.transform&&(a.transform="none")),_){const{originX:E="50%",originY:b="50%",originZ:w=0}=d;a.transformOrigin=`${E} ${b} ${w}`}}const d1e={offset:"stroke-dashoffset",array:"stroke-dasharray"},h1e={offset:"strokeDashoffset",array:"strokeDasharray"};function p1e(n,e,i=1,a=0,l=!0){n.pathLength=1;const d=l?d1e:h1e;n[d.offset]=Un.transform(-a);const f=Un.transform(e),_=Un.transform(i);n[d.array]=`${f} ${_}`}function Mq(n,e,i){return typeof n=="string"?n:Un.transform(e+i*n)}function f1e(n,e,i){const a=Mq(e,n.x,n.width),l=Mq(i,n.y,n.height);return`${a} ${l}`}function CF(n,{attrX:e,attrY:i,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:_=1,pathOffset:E=0,...b},w,I){if(wF(n,b,I),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:V,dimensions:L}=n;k.transform&&(L&&(V.transform=k.transform),delete k.transform),L&&(l!==void 0||d!==void 0||V.transform)&&(V.transformOrigin=f1e(L,l!==void 0?l:.5,d!==void 0?d:.5)),e!==void 0&&(k.x=e),i!==void 0&&(k.y=i),a!==void 0&&(k.scale=a),f!==void 0&&p1e(k,f,_,E,!1)}const RF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Qee=()=>({...RF(),attrs:{}}),IF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Zee(n,{style:e,vars:i},a,l){Object.assign(n.style,e,l&&l.getProjectionStyles(a));for(const d in i)n.style.setProperty(d,i[d])}const ete=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function tte(n,e,i,a){Zee(n,e,void 0,a);for(const l in e.attrs)n.setAttribute(ete.has(l)?l:yF(l),e.attrs[l])}const JO={};function m1e(n){Object.assign(JO,n)}function nte(n,{layout:e,layoutId:i}){return iE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!JO[n]||n==="opacity")}function AF(n,e,i){var a;const{style:l}=n,d={};for(const f in l)(Ua(l[f])||e.style&&Ua(e.style[f])||nte(f,n)||((a=i==null?void 0:i.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function rte(n,e,i){const a=AF(n,e,i);for(const l in n)if(Ua(n[l])||Ua(e[l])){const d=H0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function g1e(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const Uq=["x","y","width","height","cx","cy","r"],_1e={useVisualState:qee({scrapeMotionValuesFromProps:rte,createRenderState:Qee,onUpdate:({props:n,prevProps:e,current:i,renderState:a,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const _ in l)if(iE.has(_)){d=!0;break}}if(!d)return;let f=!e;if(e)for(let _=0;_<Uq.length;_++){const E=Uq[_];n[E]!==e[E]&&(f=!0)}f&&Yi.read(()=>{g1e(i,a),Yi.render(()=>{CF(a,l,IF(i.tagName),n.transformTemplate),tte(i,a)})})}})},y1e={useVisualState:qee({scrapeMotionValuesFromProps:AF,createRenderState:RF})};function ite(n,e,i){for(const a in e)!Ua(e[a])&&!nte(a,i)&&(n[a]=e[a])}function E1e({transformTemplate:n},e){return D.useMemo(()=>{const i=RF();return wF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function v1e(n,e){const i=n.style||{},a={};return ite(a,i,n),Object.assign(a,E1e(n,e)),a}function S1e(n,e){const i={},a=v1e(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function b1e(n,e,i,a){const l=D.useMemo(()=>{const d=Qee();return CF(d,e,IF(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[e]);if(n.style){const d={};ite(d,n.style,n),l.style={...d,...l.style}}return l}function T1e(n=!1){return(i,a,l,{latestValues:d},f)=>{const E=(vF(i)?b1e:S1e)(a,d,f,i),b=VPe(a,typeof i=="string",n),w=i!==D.Fragment?{...b,...E,ref:l}:{},{children:I}=a,k=D.useMemo(()=>Ua(I)?I.get():I,[I]);return D.createElement(i,{...w,children:k})}}function w1e(n,e){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...vF(a)?_1e:y1e,preloadedFeatures:n,useRender:T1e(l),createVisualElement:e,Component:a};return KPe(f)}}function ste(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}function Kk(n,e,i){const a=n.getProps();return SF(a,e,i!==void 0?i:a.custom,n)}const C1e=mF(()=>window.ScrollTimeline!==void 0);class R1e{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let a=0;a<this.animations.length;a++)this.animations[a][e]=i}attachTimeline(e,i){const a=this.animations.map(l=>{if(C1e()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class I1e extends R1e{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function PF(n,e){return n?n[e]||n.default||n:void 0}const _V=2e4;function ote(n){let e=0;const i=50;let a=n.next(e);for(;!a.done&&e<_V;)e+=i,a=n.next(e);return e>=_V?1/0:e}function OF(n){return typeof n=="function"}function Vq(n,e){n.timeline=e,n.onfinish=null}const kF=n=>Array.isArray(n)&&typeof n[0]=="number",A1e={linearEasing:void 0};function P1e(n,e){const i=mF(n);return()=>{var a;return(a=A1e[e])!==null&&a!==void 0?a:i()}}const QO=P1e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ate=(n,e,i=10)=>{let a="";const l=Math.max(Math.round(e/i),2);for(let d=0;d<l;d++)a+=n(T0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function cte(n){return!!(typeof n=="function"&&QO()||!n||typeof n=="string"&&(n in yV||QO())||kF(n)||Array.isArray(n)&&n.every(cte))}const $w=([n,e,i,a])=>`cubic-bezier(${n}, ${e}, ${i}, ${a})`,yV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:$w([0,.65,.55,1]),circOut:$w([.55,0,1,.45]),backIn:$w([.31,.01,.66,-.59]),backOut:$w([.33,1.53,.69,.99])};function lte(n,e){if(n)return typeof n=="function"&&QO()?ate(n,e):kF(n)?$w(n):Array.isArray(n)?n.map(i=>lte(i,e)||yV.easeOut):yV[n]}const jd={x:!1,y:!1};function ute(){return jd.x||jd.y}function O1e(n,e,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function dte(n,e){const i=O1e(n),a=new AbortController,l={passive:!0,...e,signal:a.signal};return[i,l,()=>a.abort()]}function jq(n){return e=>{e.pointerType==="touch"||ute()||n(e)}}function k1e(n,e,i={}){const[a,l,d]=dte(n,i),f=jq(_=>{const{target:E}=_,b=e(_);if(typeof b!="function"||!E)return;const w=jq(I=>{b(I),E.removeEventListener("pointerleave",w)});E.addEventListener("pointerleave",w,l)});return a.forEach(_=>{_.addEventListener("pointerenter",f,l)}),d}const hte=(n,e)=>e?n===e?!0:hte(n,e.parentElement):!1,NF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,N1e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function D1e(n){return N1e.has(n.tagName)||n.tabIndex!==-1}const Kw=new WeakSet;function Fq(n){return e=>{e.key==="Enter"&&n(e)}}function KM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const x1e=(n,e)=>{const i=n.currentTarget;if(!i)return;const a=Fq(()=>{if(Kw.has(i))return;KM(i,"down");const l=Fq(()=>{KM(i,"up")}),d=()=>KM(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",d,e)});i.addEventListener("keydown",a,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),e)};function Bq(n){return NF(n)&&!ute()}function L1e(n,e,i={}){const[a,l,d]=dte(n,i),f=_=>{const E=_.currentTarget;if(!Bq(_)||Kw.has(E))return;Kw.add(E);const b=e(_),w=(V,L)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",k),!(!Bq(V)||!Kw.has(E))&&(Kw.delete(E),typeof b=="function"&&b(V,{success:L}))},I=V=>{w(V,i.useGlobalTarget||hte(E,V.target))},k=V=>{w(V,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",k,l)};return a.forEach(_=>{!D1e(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",f,l),_.addEventListener("focus",b=>x1e(b,l),l)}),d}function M1e(n){return n==="x"||n==="y"?jd[n]?null:(jd[n]=!0,()=>{jd[n]=!1}):jd.x||jd.y?null:(jd.x=jd.y=!0,()=>{jd.x=jd.y=!1})}const pte=new Set(["width","height","top","left","right","bottom",...H0]);let TO;function U1e(){TO=void 0}const cp={now:()=>(TO===void 0&&cp.set(ia.isProcessing||NPe.useManualTiming?ia.timestamp:performance.now()),TO),set:n=>{TO=n,queueMicrotask(U1e)}};function DF(n,e){n.indexOf(e)===-1&&n.push(e)}function xF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class LF{constructor(){this.subscriptions=[]}add(e){return DF(this.subscriptions,e),()=>xF(this.subscriptions,e)}notify(e,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(e,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function fte(n,e){return e?n*(1e3/e):0}const Wq=30,V1e=n=>!isNaN(parseFloat(n));class j1e{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=cp.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=cp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=V1e(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new LF);const a=this.events[e].add(i);return e==="change"?()=>{a(),Yi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=cp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Wq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Wq);return fte(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function UC(n,e){return new j1e(n,e)}function F1e(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,UC(i))}function B1e(n,e){const i=Kk(n,e);let{transitionEnd:a={},transition:l={},...d}=i||{};d={...d,...a};for(const f in d){const _=ZPe(d[f]);F1e(n,f,_)}}function W1e(n){return!!(Ua(n)&&n.add)}function EV(n,e){const i=n.getValue("willChange");if(W1e(i))return i.add(e)}function mte(n){return n.props[Hee]}const gte=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,z1e=1e-7,G1e=12;function H1e(n,e,i,a,l){let d,f,_=0;do f=e+(i-e)/2,d=gte(f,a,l)-n,d>0?i=f:e=f;while(Math.abs(d)>z1e&&++_<G1e);return f}function gR(n,e,i,a){if(n===e&&i===a)return Bl;const l=d=>H1e(d,0,1,n,i);return d=>d===0||d===1?d:gte(l(d),e,a)}const _te=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,yte=n=>e=>1-n(1-e),Ete=gR(.33,1.53,.69,.99),MF=yte(Ete),vte=_te(MF),Ste=n=>(n*=2)<1?.5*MF(n):.5*(2-Math.pow(2,-10*(n-1))),UF=n=>1-Math.sin(Math.acos(n)),bte=yte(UF),Tte=_te(UF),wte=n=>/^0[^.\s]+$/u.test(n);function $1e(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||wte(n):!0}const hC=n=>Math.round(n*1e5)/1e5,VF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function K1e(n){return n==null}const q1e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,jF=(n,e)=>i=>!!(typeof i=="string"&&q1e.test(i)&&i.startsWith(n)||e&&!K1e(i)&&Object.prototype.hasOwnProperty.call(i,e)),Cte=(n,e,i)=>a=>{if(typeof a!="string")return a;const[l,d,f,_]=a.match(VF);return{[n]:parseFloat(l),[e]:parseFloat(d),[i]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},Y1e=n=>zf(0,255,n),qM={...$0,transform:n=>Math.round(Y1e(n))},Py={test:jF("rgb","red"),parse:Cte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:a=1})=>"rgba("+qM.transform(n)+", "+qM.transform(e)+", "+qM.transform(i)+", "+hC(MC.transform(a))+")"};function X1e(n){let e="",i="",a="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,a+=a,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const vV={test:jF("#"),parse:X1e,transform:Py.transform},YS={test:jF("hsl","hue"),parse:Cte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+ap.transform(hC(e))+", "+ap.transform(hC(i))+", "+hC(MC.transform(a))+")"},xa={test:n=>Py.test(n)||vV.test(n)||YS.test(n),parse:n=>Py.test(n)?Py.parse(n):YS.test(n)?YS.parse(n):vV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Py.transform(n):YS.transform(n)},J1e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Q1e(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(VF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(J1e))===null||i===void 0?void 0:i.length)||0)>0}const Rte="number",Ite="color",Z1e="var",eOe="var(",zq="${}",tOe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function VC(n){const e=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let d=0;const _=e.replace(tOe,E=>(xa.test(E)?(a.color.push(d),l.push(Ite),i.push(xa.parse(E))):E.startsWith(eOe)?(a.var.push(d),l.push(Z1e),i.push(E)):(a.number.push(d),l.push(Rte),i.push(parseFloat(E))),++d,zq)).split(zq);return{values:i,split:_,indexes:a,types:l}}function Ate(n){return VC(n).values}function Pte(n){const{split:e,types:i}=VC(n),a=e.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=e[f],l[f]!==void 0){const _=i[f];_===Rte?d+=hC(l[f]):_===Ite?d+=xa.transform(l[f]):d+=l[f]}return d}}const nOe=n=>typeof n=="number"?0:n;function rOe(n){const e=Ate(n);return Pte(n)(e.map(nOe))}const xg={test:Q1e,parse:Ate,createTransformer:Pte,getAnimatableNone:rOe},iOe=new Set(["brightness","contrast","saturate","opacity"]);function sOe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[a]=i.match(VF)||[];if(!a)return n;const l=i.replace(a,"");let d=iOe.has(e)?1:0;return a!==i&&(d*=100),e+"("+d+l+")"}const oOe=/\b([a-z-]*)\(.*?\)/gu,SV={...xg,getAnimatableNone:n=>{const e=n.match(oOe);return e?e.map(sOe).join(" "):n}},aOe={...TF,color:xa,backgroundColor:xa,outlineColor:xa,fill:xa,stroke:xa,borderColor:xa,borderTopColor:xa,borderRightColor:xa,borderBottomColor:xa,borderLeftColor:xa,filter:SV,WebkitFilter:SV},FF=n=>aOe[n];function Ote(n,e){let i=FF(n);return i!==SV&&(i=xg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const cOe=new Set(["auto","none","0"]);function lOe(n,e,i){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!cOe.has(d)&&VC(d).values.length&&(l=n[a]),a++}if(l&&i)for(const d of e)n[d]=Ote(i,l)}const Gq=n=>n===$0||n===Un,Hq=(n,e)=>parseFloat(n.split(", ")[e]),$q=(n,e)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return Hq(l[1],e);{const d=a.match(/^matrix\((.+)\)$/u);return d?Hq(d[1],n):0}},uOe=new Set(["x","y","z"]),dOe=H0.filter(n=>!uOe.has(n));function hOe(n){const e=[];return dOe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(e.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),e}const C0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:$q(4,13),y:$q(5,14)};C0.translateX=C0.x;C0.translateY=C0.y;const My=new Set;let bV=!1,TV=!1;function kte(){if(TV){const n=Array.from(My).filter(a=>a.needsMeasurement),e=new Set(n.map(a=>a.element)),i=new Map;e.forEach(a=>{const l=hOe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([d,f])=>{var _;(_=a.getValue(d))===null||_===void 0||_.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}TV=!1,bV=!1,My.forEach(n=>n.complete()),My.clear()}function Nte(){My.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(TV=!0)})}function pOe(){Nte(),kte()}class BF{constructor(e,i,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(My.add(this),bV||(bV=!0,Yi.read(Nte),Yi.resolveKeyframes(kte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:a,motionValue:l}=this;for(let d=0;d<e.length;d++)if(e[d]===null)if(d===0){const f=l==null?void 0:l.get(),_=e[e.length-1];if(f!==void 0)e[0]=f;else if(a&&i){const E=a.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&f===void 0&&l.set(e[0])}else e[d]=e[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),My.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,My.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Dte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),fOe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function mOe(n){const e=fOe.exec(n);if(!e)return[,];const[,i,a,l]=e;return[`--${i??a}`,l]}function xte(n,e,i=1){const[a,l]=mOe(n);if(!a)return;const d=window.getComputedStyle(e).getPropertyValue(a);if(d){const f=d.trim();return Dte(f)?parseFloat(f):f}return bF(l)?xte(l,e,i+1):l}const Lte=n=>e=>e.test(n),gOe={test:n=>n==="auto",parse:n=>n},Mte=[$0,Un,ap,dg,s1e,i1e,gOe],Kq=n=>Mte.find(Lte(n));class Ute extends BF{constructor(e,i,a,l,d){super(e,i,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let b=e[E];if(typeof b=="string"&&(b=b.trim(),bF(b))){const w=xte(b,i.current);w!==void 0&&(e[E]=w),E===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!pte.has(a)||e.length!==2)return;const[l,d]=e,f=Kq(l),_=Kq(d);if(f!==_)if(Gq(f)&&Gq(_))for(let E=0;E<e.length;E++){const b=e[E];typeof b=="string"&&(e[E]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,a=[];for(let l=0;l<e.length;l++)$1e(e[l])&&a.push(l);a.length&&lOe(e,a,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=C0[a](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(a,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,_=l[f];l[f]=C0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,b])=>{i.getValue(E).set(b)}),this.resolveNoneKeyframes()}}const qq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(xg.test(n)||n==="0")&&!n.startsWith("url("));function _Oe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function yOe(n,e,i,a){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const d=n[n.length-1],f=qq(l,e),_=qq(d,e);return!f||!_?!1:_Oe(n)||(i==="spring"||OF(i))&&a}const EOe=n=>n!==null;function qk(n,{repeat:e,repeatType:i="loop"},a){const l=n.filter(EOe),d=e&&i!=="loop"&&e%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const vOe=40;class Vte{constructor({autoplay:e=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=cp.now(),this.options={autoplay:e,delay:i,type:a,repeat:l,repeatDelay:d,repeatType:f,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>vOe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&pOe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=cp.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:_,onUpdate:E,isGenerator:b}=this.options;if(!b&&!yOe(e,a,l,d))if(f)this.options.duration=0;else{E&&E(qk(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const w=this.initPlayback(e,i);w!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...w},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const ls=(n,e,i)=>n+(e-n)*i;function YM(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function SOe({hue:n,saturation:e,lightness:i,alpha:a}){n/=360,e/=100,i/=100;let l=0,d=0,f=0;if(!e)l=d=f=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=YM(E,_,n+1/3),d=YM(E,_,n),f=YM(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function ZO(n,e){return i=>i>0?e:n}const XM=(n,e,i)=>{const a=n*n,l=i*(e*e-a)+a;return l<0?0:Math.sqrt(l)},bOe=[vV,Py,YS],TOe=n=>bOe.find(e=>e.test(n));function Yq(n){const e=TOe(n);if(!e)return!1;let i=e.parse(n);return e===YS&&(i=SOe(i)),i}const Xq=(n,e)=>{const i=Yq(n),a=Yq(e);if(!i||!a)return ZO(n,e);const l={...i};return d=>(l.red=XM(i.red,a.red,d),l.green=XM(i.green,a.green,d),l.blue=XM(i.blue,a.blue,d),l.alpha=ls(i.alpha,a.alpha,d),Py.transform(l))},wOe=(n,e)=>i=>e(n(i)),_R=(...n)=>n.reduce(wOe),wV=new Set(["none","hidden"]);function COe(n,e){return wV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function ROe(n,e){return i=>ls(n,e,i)}function WF(n){return typeof n=="number"?ROe:typeof n=="string"?bF(n)?ZO:xa.test(n)?Xq:POe:Array.isArray(n)?jte:typeof n=="object"?xa.test(n)?Xq:IOe:ZO}function jte(n,e){const i=[...n],a=i.length,l=n.map((d,f)=>WF(d)(d,e[f]));return d=>{for(let f=0;f<a;f++)i[f]=l[f](d);return i}}function IOe(n,e){const i={...n,...e},a={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(a[l]=WF(n[l])(n[l],e[l]));return l=>{for(const d in a)i[d]=a[d](l);return i}}function AOe(n,e){var i;const a=[],l={color:0,var:0,number:0};for(let d=0;d<e.values.length;d++){const f=e.types[d],_=n.indexes[f][l[f]],E=(i=n.values[_])!==null&&i!==void 0?i:0;a[d]=E,l[f]++}return a}const POe=(n,e)=>{const i=xg.createTransformer(e),a=VC(n),l=VC(e);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?wV.has(n)&&!l.values.length||wV.has(e)&&!a.values.length?COe(n,e):_R(jte(AOe(a,l),l.values),i):ZO(n,e)};function Fte(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?ls(n,e,i):WF(n)(n,e)}const OOe=5;function Bte(n,e,i){const a=Math.max(e-OOe,0);return fte(i-n(a),e-a)}const Rs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Jq=.001;function kOe({duration:n=Rs.duration,bounce:e=Rs.bounce,velocity:i=Rs.velocity,mass:a=Rs.mass}){let l,d,f=1-e;f=zf(Rs.minDamping,Rs.maxDamping,f),n=zf(Rs.minDuration,Rs.maxDuration,Vf(n)),f<1?(l=b=>{const w=b*f,I=w*n,k=w-i,V=CV(b,f),L=Math.exp(-I);return Jq-k/V*L},d=b=>{const I=b*f*n,k=I*i+i,V=Math.pow(f,2)*Math.pow(b,2)*n,L=Math.exp(-I),F=CV(Math.pow(b,2),f);return(-l(b)+Jq>0?-1:1)*((k-V)*L)/F}):(l=b=>{const w=Math.exp(-b*n),I=(b-i)*n+1;return-.001+w*I},d=b=>{const w=Math.exp(-b*n),I=(i-b)*(n*n);return w*I});const _=5/n,E=DOe(l,d,_);if(n=Uf(n),isNaN(E))return{stiffness:Rs.stiffness,damping:Rs.damping,duration:n};{const b=Math.pow(E,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const NOe=12;function DOe(n,e,i){let a=i;for(let l=1;l<NOe;l++)a=a-n(a)/e(a);return a}function CV(n,e){return n*Math.sqrt(1-e*e)}const xOe=["duration","bounce"],LOe=["stiffness","damping","mass"];function Qq(n,e){return e.some(i=>n[i]!==void 0)}function MOe(n){let e={velocity:Rs.velocity,stiffness:Rs.stiffness,damping:Rs.damping,mass:Rs.mass,isResolvedFromDuration:!1,...n};if(!Qq(n,LOe)&&Qq(n,xOe))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,d=2*zf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Rs.mass,stiffness:l,damping:d}}else{const i=kOe(n);e={...e,...i,mass:Rs.mass},e.isResolvedFromDuration=!0}return e}function Wte(n=Rs.visualDuration,e=Rs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:a,restDelta:l}=i;const d=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],_={done:!1,value:d},{stiffness:E,damping:b,mass:w,duration:I,velocity:k,isResolvedFromDuration:V}=MOe({...i,velocity:-Vf(i.velocity||0)}),L=k||0,F=b/(2*Math.sqrt(E*w)),B=f-d,q=Vf(Math.sqrt(E/w)),$=Math.abs(B)<5;a||(a=$?Rs.restSpeed.granular:Rs.restSpeed.default),l||(l=$?Rs.restDelta.granular:Rs.restDelta.default);let Q;if(F<1){const re=CV(q,F);Q=fe=>{const Z=Math.exp(-F*q*fe);return f-Z*((L+F*q*B)/re*Math.sin(re*fe)+B*Math.cos(re*fe))}}else if(F===1)Q=re=>f-Math.exp(-q*re)*(B+(L+q*B)*re);else{const re=q*Math.sqrt(F*F-1);Q=fe=>{const Z=Math.exp(-F*q*fe),ee=Math.min(re*fe,300);return f-Z*((L+F*q*B)*Math.sinh(ee)+re*B*Math.cosh(ee))/re}}const ae={calculatedDuration:V&&I||null,next:re=>{const fe=Q(re);if(V)_.done=re>=I;else{let Z=0;F<1&&(Z=re===0?Uf(L):Bte(Q,re,fe));const ee=Math.abs(Z)<=a,ne=Math.abs(f-fe)<=l;_.done=ee&&ne}return _.value=_.done?f:fe,_},toString:()=>{const re=Math.min(ote(ae),_V),fe=ate(Z=>ae.next(re*Z).value,re,30);return re+"ms "+fe}};return ae}function Zq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:_,max:E,restDelta:b=.5,restSpeed:w}){const I=n[0],k={done:!1,value:I},V=ee=>_!==void 0&&ee<_||E!==void 0&&ee>E,L=ee=>_===void 0?E:E===void 0||Math.abs(_-ee)<Math.abs(E-ee)?_:E;let F=i*e;const B=I+F,q=f===void 0?B:f(B);q!==B&&(F=q-I);const $=ee=>-F*Math.exp(-ee/a),Q=ee=>q+$(ee),ae=ee=>{const ne=$(ee),oe=Q(ee);k.done=Math.abs(ne)<=b,k.value=k.done?q:oe};let re,fe;const Z=ee=>{V(k.value)&&(re=ee,fe=Wte({keyframes:[k.value,L(k.value)],velocity:Bte(Q,ee,k.value),damping:l,stiffness:d,restDelta:b,restSpeed:w}))};return Z(0),{calculatedDuration:null,next:ee=>{let ne=!1;return!fe&&re===void 0&&(ne=!0,ae(ee),Z(ee)),re!==void 0&&ee>=re?fe.next(ee-re):(!ne&&ae(ee),k)}}}const UOe=gR(.42,0,1,1),VOe=gR(0,0,.58,1),zte=gR(.42,0,.58,1),jOe=n=>Array.isArray(n)&&typeof n[0]!="number",FOe={linear:Bl,easeIn:UOe,easeInOut:zte,easeOut:VOe,circIn:UF,circInOut:Tte,circOut:bte,backIn:MF,backInOut:vte,backOut:Ete,anticipate:Ste},eY=n=>{if(kF(n)){Fee(n.length===4);const[e,i,a,l]=n;return gR(e,i,a,l)}else if(typeof n=="string")return FOe[n];return n};function BOe(n,e,i){const a=[],l=i||Fte,d=n.length-1;for(let f=0;f<d;f++){let _=l(n[f],n[f+1]);if(e){const E=Array.isArray(e)?e[f]||Bl:e;_=_R(E,_)}a.push(_)}return a}function WOe(n,e,{clamp:i=!0,ease:a,mixer:l}={}){const d=n.length;if(Fee(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=BOe(e,a,l),E=_.length,b=w=>{if(f&&w<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(w<n[I+1]);I++);const k=T0(n[I],n[I+1],w);return _[I](k)};return i?w=>b(zf(n[0],n[d-1],w)):b}function zOe(n,e){const i=n[n.length-1];for(let a=1;a<=e;a++){const l=T0(0,e,a);n.push(ls(i,1,l))}}function GOe(n){const e=[0];return zOe(e,n.length-1),e}function HOe(n,e){return n.map(i=>i*e)}function $Oe(n,e){return n.map(()=>e||zte).splice(0,n.length-1)}function ek({duration:n=300,keyframes:e,times:i,ease:a="easeInOut"}){const l=jOe(a)?a.map(eY):eY(a),d={done:!1,value:e[0]},f=HOe(i&&i.length===e.length?i:GOe(e),n),_=WOe(f,e,{ease:Array.isArray(l)?l:$Oe(e,l)});return{calculatedDuration:n,next:E=>(d.value=_(E),d.done=E>=n,d)}}const KOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>Yi.update(e,!0),stop:()=>Dg(e),now:()=>ia.isProcessing?ia.timestamp:cp.now()}},qOe={decay:Zq,inertia:Zq,tween:ek,keyframes:ek,spring:Wte},YOe=n=>n/100;class zF extends Vte{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||BF,_=(E,b)=>this.onKeyframesResolved(E,b);this.resolver=new f(d,_,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,_=OF(i)?i:qOe[i]||ek;let E,b;_!==ek&&typeof e[0]!="number"&&(E=_R(YOe,Fte(e[0],e[1])),e=[0,100]);const w=_({...this.options,keyframes:e});d==="mirror"&&(b=_({...this.options,keyframes:[...e].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=ote(w));const{calculatedDuration:I}=w,k=I+l,V=k*(a+1)-l;return{generator:w,mirroredGenerator:b,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:k,totalDuration:V}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:a}=this;if(!a){const{keyframes:ee}=this.options;return{done:!0,value:ee[ee.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:b,totalDuration:w,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:k,repeat:V,repeatType:L,repeatDelay:F,onUpdate:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-w/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const q=this.currentTime-k*(this.speed>=0?1:-1),$=this.speed>=0?q<0:q>w;this.currentTime=Math.max(q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let Q=this.currentTime,ae=d;if(V){const ee=Math.min(this.currentTime,w)/I;let ne=Math.floor(ee),oe=ee%1;!oe&&ee>=1&&(oe=1),oe===1&&ne--,ne=Math.min(ne,V+1),!!(ne%2)&&(L==="reverse"?(oe=1-oe,F&&(oe-=F/I)):L==="mirror"&&(ae=f)),Q=zf(0,1,oe)*I}const re=$?{done:!1,value:E[0]}:ae.next(Q);_&&(re.value=_(re.value));let{done:fe}=re;!$&&b!==null&&(fe=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const Z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&fe);return Z&&l!==void 0&&(re.value=qk(E,this.options,l)),B&&B(re.value),Z&&this.finish(),re}get duration(){const{resolved:e}=this;return e?Vf(e.calculatedDuration):0}get time(){return Vf(this.currentTime)}set time(e){e=Uf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Vf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=KOe,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=e(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const XOe=new Set(["opacity","clipPath","filter","transform"]);function JOe(n,e,i,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:_="easeInOut",times:E}={}){const b={[e]:i};E&&(b.offset=E);const w=lte(_,l);return Array.isArray(w)&&(b.easing=w),n.animate(b,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const QOe=mF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),tk=10,ZOe=2e4;function eke(n){return OF(n.type)||n.type==="spring"||!cte(n.ease)}function tke(n,e){const i=new zF({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<ZOe;)a=i.sample(d),l.push(a.value),d+=tk;return{times:void 0,keyframes:l,duration:d-tk,ease:"linear"}}const Gte={anticipate:Ste,backInOut:vte,circInOut:Tte};function nke(n){return n in Gte}class tY extends Vte{constructor(e){super(e);const{name:i,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new Ute(d,(f,_)=>this.onKeyframesResolved(f,_),i,a,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:a=300,times:l,ease:d,type:f,motionValue:_,name:E,startTime:b}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof d=="string"&&QO()&&nke(d)&&(d=Gte[d]),eke(this.options)){const{onComplete:I,onUpdate:k,motionValue:V,element:L,...F}=this.options,B=tke(e,F);e=B.keyframes,e.length===1&&(e[1]=e[0]),a=B.duration,l=B.times,d=B.ease,f="keyframes"}const w=JOe(_.owner.current,E,e,{...this.options,duration:a,times:l,ease:d});return w.startTime=b??this.calcStartTime(),this.pendingTimeline?(Vq(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:I}=this.options;_.set(qk(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Vf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Vf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Uf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Bl;const{animation:a}=i;Vq(a,e)}return Bl}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:a,duration:l,type:d,ease:f,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:w,onComplete:I,element:k,...V}=this.options,L=new zF({...V,keyframes:a,duration:l,type:d,ease:f,times:_,isGenerator:!0}),F=Uf(this.time);b.setWithVelocity(L.sample(F-tk).value,L.sample(F).value,tk)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:a,repeatDelay:l,repeatType:d,damping:f,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:b}=i.owner.getProps();return QOe()&&a&&XOe.has(a)&&!E&&!b&&!l&&d!=="mirror"&&f!==0&&_!=="inertia"}}const rke={type:"spring",stiffness:500,damping:25,restSpeed:10},ike=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),ske={type:"keyframes",duration:.8},oke={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ake=(n,{keyframes:e})=>e.length>2?ske:iE.has(n)?n.startsWith("scale")?ike(e[1]):rke:oke;function cke({when:n,delay:e,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:_,from:E,elapsed:b,...w}){return!!Object.keys(w).length}const GF=(n,e,i,a={},l,d)=>f=>{const _=PF(a,n)||{},E=_.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Uf(E);let w={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-b,onUpdate:k=>{e.set(k),_.onUpdate&&_.onUpdate(k)},onComplete:()=>{f(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:d?void 0:l};cke(_)||(w={...w,...ake(n,w)}),w.duration&&(w.duration=Uf(w.duration)),w.repeatDelay&&(w.repeatDelay=Uf(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let I=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(I=!0)),I&&!d&&e.get()!==void 0){const k=qk(w.keyframes,_);if(k!==void 0)return Yi.update(()=>{w.onUpdate(k),w.onComplete()}),new I1e([])}return!d&&tY.supports(w)?new tY(w):new zF(w)};function lke({protectedKeys:n,needsAnimating:e},i){const a=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,a}function Hte(n,e,{delay:i=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:_,...E}=e;a&&(f=a);const b=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const k=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),V=E[I];if(V===void 0||w&&lke(w,I))continue;const L={delay:i,...PF(f||{},I)};let F=!1;if(window.MotionHandoffAnimation){const q=mte(n);if(q){const $=window.MotionHandoffAnimation(q,I,Yi);$!==null&&(L.startTime=$,F=!0)}}EV(n,I),k.start(GF(I,k,V,n.shouldReduceMotion&&pte.has(I)?{type:!1}:L,n,F));const B=k.animation;B&&b.push(B)}return _&&Promise.all(b).then(()=>{Yi.update(()=>{_&&B1e(n,_)})}),b}function RV(n,e,i={}){var a;const l=Kk(n,e,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const f=l?()=>Promise.all(Hte(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:w=0,staggerChildren:I,staggerDirection:k}=d;return uke(n,e,w+b,I,k,i)}:()=>Promise.resolve(),{when:E}=d;if(E){const[b,w]=E==="beforeChildren"?[f,_]:[_,f];return b().then(()=>w())}else return Promise.all([f(),_(i.delay)])}function uke(n,e,i=0,a=0,l=1,d){const f=[],_=(n.variantChildren.size-1)*a,E=l===1?(b=0)=>b*a:(b=0)=>_-b*a;return Array.from(n.variantChildren).sort(dke).forEach((b,w)=>{b.notify("AnimationStart",e),f.push(RV(b,e,{...d,delay:i+E(w)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(f)}function dke(n,e){return n.sortNodePosition(e)}function hke(n,e,i={}){n.notify("AnimationStart",e);let a;if(Array.isArray(e)){const l=e.map(d=>RV(n,d,i));a=Promise.all(l)}else if(typeof e=="string")a=RV(n,e,i);else{const l=typeof e=="function"?Kk(n,e,i.custom):e;a=Promise.all(Hte(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",e)})}const pke=_F.length;function $te(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?$te(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<pke;i++){const a=_F[i],l=n.props[a];(LC(l)||l===!1)&&(e[a]=l)}return e}const fke=[...gF].reverse(),mke=gF.length;function gke(n){return e=>Promise.all(e.map(({animation:i,options:a})=>hke(n,i,a)))}function _ke(n){let e=gke(n),i=nY(),a=!0;const l=E=>(b,w)=>{var I;const k=Kk(n,w,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(k){const{transition:V,transitionEnd:L,...F}=k;b={...b,...F,...L}}return b};function d(E){e=E(n)}function f(E){const{props:b}=n,w=$te(n.parent)||{},I=[],k=new Set;let V={},L=1/0;for(let B=0;B<mke;B++){const q=fke[B],$=i[q],Q=b[q]!==void 0?b[q]:w[q],ae=LC(Q),re=q===E?$.isActive:null;re===!1&&(L=B);let fe=Q===w[q]&&Q!==b[q]&&ae;if(fe&&a&&n.manuallyAnimateOnMount&&(fe=!1),$.protectedKeys={...V},!$.isActive&&re===null||!Q&&!$.prevProp||Hk(Q)||typeof Q=="boolean")continue;const Z=yke($.prevProp,Q);let ee=Z||q===E&&$.isActive&&!fe&&ae||B>L&&ae,ne=!1;const oe=Array.isArray(Q)?Q:[Q];let ge=oe.reduce(l(q),{});re===!1&&(ge={});const{prevResolvedValues:pe={}}=$,le={...pe,...ge},Me=Ee=>{ee=!0,k.has(Ee)&&(ne=!0,k.delete(Ee)),$.needsAnimating[Ee]=!0;const Ie=n.getValue(Ee);Ie&&(Ie.liveStyle=!1)};for(const Ee in le){const Ie=ge[Ee],ve=pe[Ee];if(V.hasOwnProperty(Ee))continue;let Be=!1;gV(Ie)&&gV(ve)?Be=!ste(Ie,ve):Be=Ie!==ve,Be?Ie!=null?Me(Ee):k.add(Ee):Ie!==void 0&&k.has(Ee)?Me(Ee):$.protectedKeys[Ee]=!0}$.prevProp=Q,$.prevResolvedValues=ge,$.isActive&&(V={...V,...ge}),a&&n.blockInitialAnimation&&(ee=!1),ee&&(!(fe&&Z)||ne)&&I.push(...oe.map(Ee=>({animation:Ee,options:{type:q}})))}if(k.size){const B={};k.forEach(q=>{const $=n.getBaseTarget(q),Q=n.getValue(q);Q&&(Q.liveStyle=!0),B[q]=$??null}),I.push({animation:B})}let F=!!I.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(F=!1),a=!1,F?e(I):Promise.resolve()}function _(E,b){var w;if(i[E].isActive===b)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(k=>{var V;return(V=k.animationState)===null||V===void 0?void 0:V.setActive(E,b)}),i[E].isActive=b;const I=f(E);for(const k in i)i[k].protectedKeys={};return I}return{animateChanges:f,setActive:_,setAnimateFunction:d,getState:()=>i,reset:()=>{i=nY(),a=!0}}}function yke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!ste(e,n):!1}function vy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function nY(){return{animate:vy(!0),whileInView:vy(),whileHover:vy(),whileTap:vy(),whileDrag:vy(),whileFocus:vy(),exit:vy()}}class Hg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Eke extends Hg{constructor(e){super(e),e.animationState||(e.animationState=_ke(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Hk(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let vke=0;class Ske extends Hg{constructor(){super(...arguments),this.id=vke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const bke={animation:{Feature:Eke},exit:{Feature:Ske}};function jC(n,e,i,a={passive:!0}){return n.addEventListener(e,i,a),()=>n.removeEventListener(e,i)}function yR(n){return{point:{x:n.pageX,y:n.pageY}}}const Tke=n=>e=>NF(e)&&n(e,yR(e));function pC(n,e,i,a){return jC(n,e,Tke(i),a)}const rY=(n,e)=>Math.abs(n-e);function wke(n,e){const i=rY(n.x,e.x),a=rY(n.y,e.y);return Math.sqrt(i**2+a**2)}class Kte{constructor(e,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=QM(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,V=wke(I.offset,{x:0,y:0})>=3;if(!k&&!V)return;const{point:L}=I,{timestamp:F}=ia;this.history.push({...L,timestamp:F});const{onStart:B,onMove:q}=this.handlers;k||(B&&B(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),q&&q(this.lastMoveEvent,I)},this.handlePointerMove=(I,k)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=JM(k,this.transformPagePoint),Yi.update(this.updatePoint,!0)},this.handlePointerUp=(I,k)=>{this.end();const{onEnd:V,onSessionEnd:L,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const B=QM(I.type==="pointercancel"?this.lastMoveEventInfo:JM(k,this.transformPagePoint),this.history);this.startEvent&&V&&V(I,B),L&&L(I,B)},!NF(e))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const f=yR(e),_=JM(f,this.transformPagePoint),{point:E}=_,{timestamp:b}=ia;this.history=[{...E,timestamp:b}];const{onSessionStart:w}=i;w&&w(e,QM(_,this.history)),this.removeListeners=_R(pC(this.contextWindow,"pointermove",this.handlePointerMove),pC(this.contextWindow,"pointerup",this.handlePointerUp),pC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Dg(this.updatePoint)}}function JM(n,e){return e?{point:e(n.point)}:n}function iY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function QM({point:n},e){return{point:n,delta:iY(n,qte(e)),offset:iY(n,Cke(e)),velocity:Rke(e,.1)}}function Cke(n){return n[0]}function qte(n){return n[n.length-1]}function Rke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=qte(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Uf(e)));)i--;if(!a)return{x:0,y:0};const d=Vf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const Yte=1e-4,Ike=1-Yte,Ake=1+Yte,Xte=.01,Pke=0-Xte,Oke=0+Xte;function Gl(n){return n.max-n.min}function kke(n,e,i){return Math.abs(n-e)<=i}function sY(n,e,i,a=.5){n.origin=a,n.originPoint=ls(e.min,e.max,n.origin),n.scale=Gl(i)/Gl(e),n.translate=ls(i.min,i.max,n.origin)-n.originPoint,(n.scale>=Ike&&n.scale<=Ake||isNaN(n.scale))&&(n.scale=1),(n.translate>=Pke&&n.translate<=Oke||isNaN(n.translate))&&(n.translate=0)}function fC(n,e,i,a){sY(n.x,e.x,i.x,a?a.originX:void 0),sY(n.y,e.y,i.y,a?a.originY:void 0)}function oY(n,e,i){n.min=i.min+e.min,n.max=n.min+Gl(e)}function Nke(n,e,i){oY(n.x,e.x,i.x),oY(n.y,e.y,i.y)}function aY(n,e,i){n.min=e.min-i.min,n.max=n.min+Gl(e)}function mC(n,e,i){aY(n.x,e.x,i.x),aY(n.y,e.y,i.y)}function Dke(n,{min:e,max:i},a){return e!==void 0&&n<e?n=a?ls(e,n,a.min):Math.max(n,e):i!==void 0&&n>i&&(n=a?ls(i,n,a.max):Math.min(n,i)),n}function cY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function xke(n,{top:e,left:i,bottom:a,right:l}){return{x:cY(n.x,i,l),y:cY(n.y,e,a)}}function lY(n,e){let i=e.min-n.min,a=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function Lke(n,e){return{x:lY(n.x,e.x),y:lY(n.y,e.y)}}function Mke(n,e){let i=.5;const a=Gl(n),l=Gl(e);return l>a?i=T0(e.min,e.max-a,n.min):a>l&&(i=T0(n.min,n.max-l,e.min)),zf(0,1,i)}function Uke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const IV=.35;function Vke(n=IV){return n===!1?n=0:n===!0&&(n=IV),{x:uY(n,"left","right"),y:uY(n,"top","bottom")}}function uY(n,e,i){return{min:dY(n,e),max:dY(n,i)}}function dY(n,e){return typeof n=="number"?n:n[e]||0}const hY=()=>({translate:0,scale:1,origin:0,originPoint:0}),XS=()=>({x:hY(),y:hY()}),pY=()=>({min:0,max:0}),Ls=()=>({x:pY(),y:pY()});function xu(n){return[n("x"),n("y")]}function Jte({top:n,left:e,right:i,bottom:a}){return{x:{min:e,max:i},y:{min:n,max:a}}}function jke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function Fke(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),a=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function ZM(n){return n===void 0||n===1}function AV({scale:n,scaleX:e,scaleY:i}){return!ZM(n)||!ZM(e)||!ZM(i)}function by(n){return AV(n)||Qte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Qte(n){return fY(n.x)||fY(n.y)}function fY(n){return n&&n!=="0%"}function nk(n,e,i){const a=n-i,l=e*a;return i+l}function mY(n,e,i,a,l){return l!==void 0&&(n=nk(n,l,a)),nk(n,i,a)+e}function PV(n,e=0,i=1,a,l){n.min=mY(n.min,e,i,a,l),n.max=mY(n.max,e,i,a,l)}function Zte(n,{x:e,y:i}){PV(n.x,e.translate,e.scale,e.originPoint),PV(n.y,i.translate,i.scale,i.originPoint)}const gY=.999999999999,_Y=1.0000000000001;function Bke(n,e,i,a=!1){const l=i.length;if(!l)return;e.x=e.y=1;let d,f;for(let _=0;_<l;_++){d=i[_],f=d.projectionDelta;const{visualElement:E}=d.options;E&&E.props.style&&E.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&QS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(e.x*=f.x.scale,e.y*=f.y.scale,Zte(n,f)),a&&by(d.latestValues)&&QS(n,d.latestValues))}e.x<_Y&&e.x>gY&&(e.x=1),e.y<_Y&&e.y>gY&&(e.y=1)}function JS(n,e){n.min=n.min+e,n.max=n.max+e}function yY(n,e,i,a,l=.5){const d=ls(n.min,n.max,l);PV(n,e,i,d,a)}function QS(n,e){yY(n.x,e.x,e.scaleX,e.scale,e.originX),yY(n.y,e.y,e.scaleY,e.scale,e.originY)}function ene(n,e){return Jte(Fke(n.getBoundingClientRect(),e))}function Wke(n,e,i){const a=ene(n,i),{scroll:l}=e;return l&&(JS(a.x,l.offset.x),JS(a.y,l.offset.y)),a}const tne=({current:n})=>n?n.ownerDocument.defaultView:null,zke=new WeakMap;class Gke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ls(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(yR(w).point)},d=(w,I)=>{const{drag:k,dragPropagation:V,onDragStart:L}=this.getProps();if(k&&!V&&(this.openDragLock&&this.openDragLock(),this.openDragLock=M1e(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),xu(B=>{let q=this.getAxisMotionValue(B).get()||0;if(ap.test(q)){const{projection:$}=this.visualElement;if($&&$.layout){const Q=$.layout.layoutBox[B];Q&&(q=Gl(Q)*(parseFloat(q)/100))}}this.originPoint[B]=q}),L&&Yi.postRender(()=>L(w,I)),EV(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},f=(w,I)=>{const{dragPropagation:k,dragDirectionLock:V,onDirectionLock:L,onDrag:F}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:B}=I;if(V&&this.currentDirection===null){this.currentDirection=Hke(B),this.currentDirection!==null&&L&&L(this.currentDirection);return}this.updateAxis("x",I.point,B),this.updateAxis("y",I.point,B),this.visualElement.render(),F&&F(w,I)},_=(w,I)=>this.stop(w,I),E=()=>xu(w=>{var I;return this.getAnimationState(w)==="paused"&&((I=this.getAxisMotionValue(w).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Kte(e,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:tne(this.visualElement)})}stop(e,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Yi.postRender(()=>d(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,a){const{drag:l}=this.getProps();if(!a||!j1(e,l,this.currentDirection))return;const d=this.getAxisMotionValue(e);let f=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(f=Dke(f,this.constraints[e],this.elastic[e])),d.set(f)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,d=this.constraints;i&&qS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=xke(l.layoutBox,i):this.constraints=!1,this.elastic=Vke(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&xu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=Uke(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!qS(e))return!1;const a=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=Wke(a,l.root,this.visualElement.getTransformPagePoint());let f=Lke(l.layout.layoutBox,d);if(i){const _=i(jke(f));this.hasMutatedConstraints=!!_,_&&(f=Jte(_))}return f}startAnimation(e){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},b=xu(w=>{if(!j1(w,i,this.currentDirection))return;let I=E&&E[w]||{};f&&(I={min:0,max:0});const k=l?200:1e6,V=l?40:1e7,L={type:"inertia",velocity:a?e[w]:0,bounceStiffness:k,bounceDamping:V,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(w,L)});return Promise.all(b).then(_)}startAxisValueAnimation(e,i){const a=this.getAxisMotionValue(e);return EV(this.visualElement,e),a.start(GF(e,a,0,i,this.visualElement,!1))}stopAnimation(){xu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){xu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){xu(i=>{const{drag:a}=this.getProps();if(!j1(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:_}=l.layout.layoutBox[i];d.set(e[i]-ls(f,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!qS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};xu(f=>{const _=this.getAxisMotionValue(f);if(_&&this.constraints!==!1){const E=_.get();l[f]=Mke({min:E,max:E},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),xu(f=>{if(!j1(f,e,null))return;const _=this.getAxisMotionValue(f),{min:E,max:b}=this.constraints[f];_.set(ls(E,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;zke.set(this.visualElement,this);const e=this.visualElement.current,i=pC(e,"pointerdown",E=>{const{drag:b,dragListener:w=!0}=this.getProps();b&&w&&this.start(E)}),a=()=>{const{dragConstraints:E}=this.getProps();qS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Yi.read(a);const f=jC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:b})=>{this.isDragging&&b&&(xu(w=>{const I=this.getAxisMotionValue(w);I&&(this.originPoint[w]+=E[w].translate,I.set(I.get()+E[w].translate))}),this.visualElement.render())});return()=>{f(),i(),d(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=IV,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:_}}}function j1(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function Hke(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class $ke extends Hg{constructor(e){super(e),this.removeGroupControls=Bl,this.removeListeners=Bl,this.controls=new Gke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Bl}unmount(){this.removeGroupControls(),this.removeListeners()}}const EY=n=>(e,i)=>{n&&Yi.postRender(()=>n(e,i))};class Kke extends Hg{constructor(){super(...arguments),this.removePointerDownListener=Bl}onPointerDown(e){this.session=new Kte(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:tne(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:EY(e),onStart:EY(i),onMove:a,onEnd:(d,f)=>{delete this.session,l&&Yi.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=pC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const wO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function vY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const bw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Un.test(n))n=parseFloat(n);else return n;const i=vY(n,e.target.x),a=vY(n,e.target.y);return`${i}% ${a}%`}},qke={correct:(n,{treeScale:e,projectionDelta:i})=>{const a=n,l=xg.parse(n);if(l.length>5)return a;const d=xg.createTransformer(n),f=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+f]/=_,l[1+f]/=E;const b=ls(_,E,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),d(l)}};class Yke extends D.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=e;m1e(Xke),d&&(i.group&&i.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),wO.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||e.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?f.promote():f.relegate()||Yi.postRender(()=>{const _=f.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),EF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function nne(n){const[e,i]=pF(),a=D.useContext(uF);return S.jsx(Yke,{...n,layoutGroup:a,switchLayoutGroup:D.useContext($ee),isPresent:e,safeToRemove:i})}const Xke={borderRadius:{...bw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:bw,borderTopRightRadius:bw,borderBottomLeftRadius:bw,borderBottomRightRadius:bw,boxShadow:qke};function Jke(n,e,i){const a=Ua(n)?n:UC(n);return a.start(GF("",a,e,i)),a.animation}function Qke(n){return n instanceof SVGElement&&n.tagName!=="svg"}const Zke=(n,e)=>n.depth-e.depth;class eNe{constructor(){this.children=[],this.isDirty=!1}add(e){DF(this.children,e),this.isDirty=!0}remove(e){xF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Zke),this.isDirty=!1,this.children.forEach(e)}}function tNe(n,e){const i=cp.now(),a=({timestamp:l})=>{const d=l-i;d>=e&&(Dg(a),n(d-e))};return Yi.read(a,!0),()=>Dg(a)}const rne=["TopLeft","TopRight","BottomLeft","BottomRight"],nNe=rne.length,SY=n=>typeof n=="string"?parseFloat(n):n,bY=n=>typeof n=="number"||Un.test(n);function rNe(n,e,i,a,l,d){l?(n.opacity=ls(0,i.opacity!==void 0?i.opacity:1,iNe(a)),n.opacityExit=ls(e.opacity!==void 0?e.opacity:1,0,sNe(a))):d&&(n.opacity=ls(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let f=0;f<nNe;f++){const _=`border${rne[f]}Radius`;let E=TY(e,_),b=TY(i,_);if(E===void 0&&b===void 0)continue;E||(E=0),b||(b=0),E===0||b===0||bY(E)===bY(b)?(n[_]=Math.max(ls(SY(E),SY(b),a),0),(ap.test(b)||ap.test(E))&&(n[_]+="%")):n[_]=b}(e.rotate||i.rotate)&&(n.rotate=ls(e.rotate||0,i.rotate||0,a))}function TY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const iNe=ine(0,.5,bte),sNe=ine(.5,.95,Bl);function ine(n,e,i){return a=>a<n?0:a>e?1:i(T0(n,e,a))}function wY(n,e){n.min=e.min,n.max=e.max}function ku(n,e){wY(n.x,e.x),wY(n.y,e.y)}function CY(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function RY(n,e,i,a,l){return n-=e,n=nk(n,1/i,a),l!==void 0&&(n=nk(n,1/l,a)),n}function oNe(n,e=0,i=1,a=.5,l,d=n,f=n){if(ap.test(e)&&(e=parseFloat(e),e=ls(f.min,f.max,e/100)-f.min),typeof e!="number")return;let _=ls(d.min,d.max,a);n===d&&(_-=e),n.min=RY(n.min,e,i,_,l),n.max=RY(n.max,e,i,_,l)}function IY(n,e,[i,a,l],d,f){oNe(n,e[i],e[a],e[l],e.scale,d,f)}const aNe=["x","scaleX","originX"],cNe=["y","scaleY","originY"];function AY(n,e,i,a){IY(n.x,e,aNe,i?i.x:void 0,a?a.x:void 0),IY(n.y,e,cNe,i?i.y:void 0,a?a.y:void 0)}function PY(n){return n.translate===0&&n.scale===1}function sne(n){return PY(n.x)&&PY(n.y)}function OY(n,e){return n.min===e.min&&n.max===e.max}function lNe(n,e){return OY(n.x,e.x)&&OY(n.y,e.y)}function kY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function one(n,e){return kY(n.x,e.x)&&kY(n.y,e.y)}function NY(n){return Gl(n.x)/Gl(n.y)}function DY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class uNe{constructor(){this.members=[]}add(e){DF(this.members,e),e.scheduleRender()}remove(e){if(xF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(e,i){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,i&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:a}=e;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function dNe(n,e,i){let a="";const l=n.x.translate/e.x,d=n.y.translate/e.y,f=(i==null?void 0:i.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:w,rotateX:I,rotateY:k,skewX:V,skewY:L}=i;b&&(a=`perspective(${b}px) ${a}`),w&&(a+=`rotate(${w}deg) `),I&&(a+=`rotateX(${I}deg) `),k&&(a+=`rotateY(${k}deg) `),V&&(a+=`skewX(${V}deg) `),L&&(a+=`skewY(${L}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(a+=`scale(${_}, ${E})`),a||"none"}const Ty={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},qw=typeof window<"u"&&window.MotionDebug!==void 0,eU=["","X","Y","Z"],hNe={visibility:"hidden"},xY=1e3;let pNe=0;function tU(n,e,i,a){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),a&&(a[n]=0))}function ane(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=mte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",Yi,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&ane(a)}function cne({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},_=e==null?void 0:e()){this.id=pNe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,qw&&(Ty.totalNodes=Ty.resolvedTargetDeltas=Ty.recalculatedProjection=0),this.nodes.forEach(gNe),this.nodes.forEach(SNe),this.nodes.forEach(bNe),this.nodes.forEach(_Ne),qw&&window.MotionDebug.record(Ty)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new eNe)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new LF),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const E=this.eventHandlers.get(f);E&&E.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Qke(f),this.instance=f;const{layoutId:E,layout:b,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(b||E)&&(this.isLayoutDirty=!0),n){let I;const k=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=tNe(k,250),wO.hasAnimatedSinceResize&&(wO.hasAnimatedSinceResize=!1,this.nodes.forEach(MY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&w&&(E||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:k,hasRelativeTargetChanged:V,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||w.getDefaultTransition()||INe,{onLayoutAnimationStart:B,onLayoutAnimationComplete:q}=w.getProps(),$=!this.targetLayout||!one(this.targetLayout,L)||V,Q=!k&&V;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Q||k&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,Q);const ae={...PF(F,"layout"),onPlay:B,onComplete:q};(w.shouldReduceMotion||this.options.layoutRoot)&&(ae.delay=0,ae.type=!1),this.startAnimation(ae)}else k||MY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Dg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(TNe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&ane(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const I=this.path[w];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(LY);return}this.isUpdating||this.nodes.forEach(ENe),this.isUpdating=!1,this.nodes.forEach(vNe),this.nodes.forEach(fNe),this.nodes.forEach(mNe),this.clearAllSnapshots();const _=cp.now();ia.delta=zf(0,1e3/60,_-ia.timestamp),ia.timestamp=_,ia.isProcessing=!0,$M.update.process(ia),$M.preRender.process(ia),$M.render.process(ia),ia.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,EF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(yNe),this.sharedNodes.forEach(wNe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Yi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Yi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ls(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_){const E=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!sne(this.projectionDelta),E=this.getTransformTemplate(),b=E?E(this.latestValues,""):void 0,w=b!==this.prevTransformTemplateValue;f&&(_||by(this.latestValues)||w)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return f&&(E=this.removeTransform(E)),ANe(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:_}=this.options;if(!_)return Ls();const E=_.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(PNe))){const{scroll:w}=this.root;w&&(JS(E.x,w.offset.x),JS(E.y,w.offset.y))}return E}removeElementScroll(f){var _;const E=Ls();if(ku(E,f),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let b=0;b<this.path.length;b++){const w=this.path[b],{scroll:I,options:k}=w;w!==this.root&&I&&k.layoutScroll&&(I.wasRoot&&ku(E,f),JS(E.x,I.offset.x),JS(E.y,I.offset.y))}return E}applyTransform(f,_=!1){const E=Ls();ku(E,f);for(let b=0;b<this.path.length;b++){const w=this.path[b];!_&&w.options.layoutScroll&&w.scroll&&w!==w.root&&QS(E,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),by(w.latestValues)&&QS(E,w.latestValues)}return by(this.latestValues)&&QS(E,this.latestValues),E}removeTransform(f){const _=Ls();ku(_,f);for(let E=0;E<this.path.length;E++){const b=this.path[E];if(!b.instance||!by(b.latestValues))continue;AV(b.latestValues)&&b.updateSnapshot();const w=Ls(),I=b.measurePageBox();ku(w,I),AY(_,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,w)}return by(this.latestValues)&&AY(_,this.latestValues),_}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ia.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==E;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:k}=this.options;if(!(!this.layout||!(I||k))){if(this.resolvedRelativeTargetAt=ia.timestamp,!this.targetDelta&&!this.relativeTarget){const V=this.getClosestProjectingParent();V&&V.layout&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ls(),this.relativeTargetOrigin=Ls(),mC(this.relativeTargetOrigin,this.layout.layoutBox,V.layout.layoutBox),ku(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ls(),this.targetWithTransforms=Ls()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Nke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ku(this.target,this.layout.layoutBox),Zte(this.target,this.targetDelta)):ku(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const V=this.getClosestProjectingParent();V&&!!V.resumingFrom==!!this.resumingFrom&&!V.options.layoutScroll&&V.target&&this.animationProgress!==1?(this.relativeParent=V,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ls(),this.relativeTargetOrigin=Ls(),mC(this.relativeTargetOrigin,this.target,V.target),ku(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}qw&&Ty.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||AV(this.parent.latestValues)||Qte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===ia.timestamp&&(b=!1),b)return;const{layout:w,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||I))return;ku(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,V=this.treeScale.y;Bke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=Ls());const{target:L}=_;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(CY(this.prevProjectionDelta.x,this.projectionDelta.x),CY(this.prevProjectionDelta.y,this.projectionDelta.y)),fC(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==V||!DY(this.projectionDelta.x,this.prevProjectionDelta.x)||!DY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L)),qw&&Ty.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=XS(),this.projectionDelta=XS(),this.projectionDeltaWithTransform=XS()}setAnimationOrigin(f,_=!1){const E=this.snapshot,b=E?E.latestValues:{},w={...this.latestValues},I=XS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const k=Ls(),V=E?E.source:void 0,L=this.layout?this.layout.source:void 0,F=V!==L,B=this.getStack(),q=!B||B.members.length<=1,$=!!(F&&!q&&this.options.crossfade===!0&&!this.path.some(RNe));this.animationProgress=0;let Q;this.mixTargetDelta=ae=>{const re=ae/1e3;UY(I.x,f.x,re),UY(I.y,f.y,re),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(mC(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),CNe(this.relativeTarget,this.relativeTargetOrigin,k,re),Q&&lNe(this.relativeTarget,Q)&&(this.isProjectionDirty=!1),Q||(Q=Ls()),ku(Q,this.relativeTarget)),F&&(this.animationValues=w,rNe(w,b,this.latestValues,re,$,q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Dg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Yi.update(()=>{wO.hasAnimatedSinceResize=!0,this.currentAnimation=Jke(0,xY,{...f,onUpdate:_=>{this.mixTargetDelta(_),f.onUpdate&&f.onUpdate(_)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(xY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:E,layout:b,latestValues:w}=f;if(!(!_||!E||!b)){if(this!==f&&this.layout&&b&&lne(this.options.animationType,this.layout.layoutBox,b.layoutBox)){E=this.target||Ls();const I=Gl(this.layout.layoutBox.x);E.x.min=f.target.x.min,E.x.max=E.x.min+I;const k=Gl(this.layout.layoutBox.y);E.y.min=f.target.y.min,E.y.max=E.y.min+k}ku(_,E),QS(_,w),fC(this.projectionDeltaWithTransform,this.layoutCorrected,_,w)}}registerSharedNode(f,_){this.sharedNodes.has(f)||this.sharedNodes.set(f,new uNe),this.sharedNodes.get(f).add(_);const b=_.options.initialPromotionConfig;_.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(_):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:E}={}){const b=this.getStack();b&&b.promote(this,E),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:E}=f;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const b={};E.z&&tU("z",f,b,this.animationValues);for(let w=0;w<eU.length;w++)tU(`rotate${eU[w]}`,f,b,this.animationValues),tU(`skew${eU[w]}`,f,b,this.animationValues);f.render();for(const w in b)f.setStaticValue(w,b[w]),this.animationValues&&(this.animationValues[w]=b[w]);f.scheduleRender()}getProjectionStyles(f){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hNe;const b={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=bO(f==null?void 0:f.pointerEvents)||"",b.transform=w?w(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=bO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!by(this.latestValues)&&(F.transform=w?w({},""):"none",this.hasProjected=!1),F}const k=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=dNe(this.projectionDeltaWithTransform,this.treeScale,k),w&&(b.transform=w(k,b.transform));const{x:V,y:L}=this.projectionDelta;b.transformOrigin=`${V.origin*100}% ${L.origin*100}% 0`,I.animationValues?b.opacity=I===this?(E=(_=k.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:b.opacity=I===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const F in JO){if(k[F]===void 0)continue;const{correct:B,applyTo:q}=JO[F],$=b.transform==="none"?k[F]:B(k[F],I);if(q){const Q=q.length;for(let ae=0;ae<Q;ae++)b[q[ae]]=$}else b[F]=$}return this.options.layoutId&&(b.pointerEvents=I===this?bO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(LY),this.root.sharedNodes.clear()}}}function fNe(n){n.updateLayout()}function mNe(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=i.source!==n.layout.source;d==="size"?xu(I=>{const k=f?i.measuredBox[I]:i.layoutBox[I],V=Gl(k);k.min=a[I].min,k.max=k.min+V}):lne(d,i.layoutBox,a)&&xu(I=>{const k=f?i.measuredBox[I]:i.layoutBox[I],V=Gl(a[I]);k.max=k.min+V,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+V)});const _=XS();fC(_,a,i.layoutBox);const E=XS();f?fC(E,n.applyTransform(l,!0),i.measuredBox):fC(E,a,i.layoutBox);const b=!sne(_);let w=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:k,layout:V}=I;if(k&&V){const L=Ls();mC(L,i.layoutBox,k.layoutBox);const F=Ls();mC(F,a,V.layoutBox),one(L,F)||(w=!0),I.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=L,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:b,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function gNe(n){qw&&Ty.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function _Ne(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function yNe(n){n.clearSnapshot()}function LY(n){n.clearMeasurements()}function ENe(n){n.isLayoutDirty=!1}function vNe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function MY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function SNe(n){n.resolveTargetDelta()}function bNe(n){n.calcProjection()}function TNe(n){n.resetSkewAndRotation()}function wNe(n){n.removeLeadSnapshot()}function UY(n,e,i){n.translate=ls(e.translate,0,i),n.scale=ls(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function VY(n,e,i,a){n.min=ls(e.min,i.min,a),n.max=ls(e.max,i.max,a)}function CNe(n,e,i,a){VY(n.x,e.x,i.x,a),VY(n.y,e.y,i.y,a)}function RNe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const INe={duration:.45,ease:[.4,0,.1,1]},jY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),FY=jY("applewebkit/")&&!jY("chrome/")?Math.round:Bl;function BY(n){n.min=FY(n.min),n.max=FY(n.max)}function ANe(n){BY(n.x),BY(n.y)}function lne(n,e,i){return n==="position"||n==="preserve-aspect"&&!kke(NY(e),NY(i),.2)}function PNe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const ONe=cne({attachResizeListener:(n,e)=>jC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),nU={current:void 0},une=cne({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!nU.current){const n=new ONe({});n.mount(window),n.setOptions({layoutScroll:!0}),nU.current=n}return nU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),kNe={pan:{Feature:Kke},drag:{Feature:$ke,ProjectionNode:une,MeasureLayout:nne}};function WY(n,e,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=a[l];d&&Yi.postRender(()=>d(e,yR(e)))}class NNe extends Hg{mount(){const{current:e}=this.node;e&&(this.unmount=k1e(e,i=>(WY(this.node,i,"Start"),a=>WY(this.node,a,"End"))))}unmount(){}}class DNe extends Hg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=_R(jC(this.node.current,"focus",()=>this.onFocus()),jC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function zY(n,e,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=a[l];d&&Yi.postRender(()=>d(e,yR(e)))}class xNe extends Hg{mount(){const{current:e}=this.node;e&&(this.unmount=L1e(e,i=>(zY(this.node,i,"Start"),(a,{success:l})=>zY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const OV=new WeakMap,rU=new WeakMap,LNe=n=>{const e=OV.get(n.target);e&&e(n)},MNe=n=>{n.forEach(LNe)};function UNe({root:n,...e}){const i=n||document;rU.has(i)||rU.set(i,{});const a=rU.get(i),l=JSON.stringify(e);return a[l]||(a[l]=new IntersectionObserver(MNe,{root:n,...e})),a[l]}function VNe(n,e,i){const a=UNe(e);return OV.set(n,i),a.observe(n),()=>{OV.delete(n),a.unobserve(n)}}const jNe={some:0,all:1};class FNe extends Hg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:d}=e,f={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:jNe[l]},_=E=>{const{isIntersecting:b}=E;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:w,onViewportLeave:I}=this.node.getProps(),k=b?w:I;k&&k(E)};return VNe(this.node.current,f,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(BNe(e,i))&&this.startObserver()}unmount(){}}function BNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const WNe={inView:{Feature:FNe},tap:{Feature:xNe},focus:{Feature:DNe},hover:{Feature:NNe}},zNe={layout:{ProjectionNode:une,MeasureLayout:nne}},kV={current:null},dne={current:!1};function GNe(){if(dne.current=!0,!!fF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>kV.current=n.matches;n.addListener(e),e()}else kV.current=!1}const HNe=[...Mte,xa,xg],$Ne=n=>HNe.find(Lte(n)),GY=new WeakMap;function KNe(n,e,i){for(const a in e){const l=e[a],d=i[a];if(Ua(l))n.addValue(a,l);else if(Ua(d))n.addValue(a,UC(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,UC(f!==void 0?f:l,{owner:n}))}}for(const a in i)e[a]===void 0&&n.removeValue(a);return e}const HY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class qNe{scrapeMotionValuesFromProps(e,i,a){return{}}constructor({parent:e,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=BF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const V=cp.now();this.renderScheduledAt<V&&(this.renderScheduledAt=V,Yi.render(this.render,!1,!0))};const{latestValues:E,renderState:b,onUpdate:w}=f;this.onUpdate=w,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!d,this.isControllingVariants=$k(i),this.isVariantNode=Gee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...k}=this.scrapeMotionValuesFromProps(i,{},this);for(const V in k){const L=k[V];E[V]!==void 0&&Ua(L)&&L.set(E[V],!1)}}mount(e){this.current=e,GY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),dne.current||GNe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:kV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){GY.delete(this.current),this.projection&&this.projection.unmount(),Dg(this.notifyUpdate),Dg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=iE.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&Yi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),d(),f&&f(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in w0){const i=w0[e];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[e]&&l&&a(this.props)&&(this.features[e]=new l(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ls()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<HY.length;a++){const l=HY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=e[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=KNe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const a=this.values.get(e);i!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&i!==void 0&&(a=UC(i===null?void 0:i,{owner:this}),this.addValue(e,a)),a}readValue(e,i){var a;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(a=this.getBaseTargetFromProps(this.props,e))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Dte(l)||wte(l))?l=parseFloat(l):!$Ne(l)&&xg.test(i)&&(l=Ote(e,i)),this.setBaseTarget(e,Ua(l)?l.get():l)),Ua(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=SF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[e])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,e);return d!==void 0&&!Ua(d)?d:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new LF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class hne extends qNe{constructor(){super(...arguments),this.KeyframeResolver=Ute}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:a}){delete i[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ua(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function YNe(n){return window.getComputedStyle(n)}class XNe extends hne{constructor(){super(...arguments),this.type="html",this.renderInstance=Zee}readValueFromInstance(e,i){if(iE.has(i)){const a=FF(i);return a&&a.default||0}else{const a=YNe(e),l=(Xee(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return ene(e,i)}build(e,i,a){wF(e,i,a.transformTemplate)}scrapeMotionValuesFromProps(e,i,a){return AF(e,i,a)}}class JNe extends hne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ls}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(iE.has(i)){const a=FF(i);return a&&a.default||0}return i=ete.has(i)?i:yF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,a){return rte(e,i,a)}build(e,i,a){CF(e,i,this.isSVGTag,a.transformTemplate)}renderInstance(e,i,a,l){tte(e,i,a,l)}mount(e){this.isSVGTag=IF(e.tagName),super.mount(e)}}const QNe=(n,e)=>vF(n)?new JNe(e):new XNe(e,{allowProjection:n!==D.Fragment}),ZNe=w1e({...bke,...WNe,...kNe,...zNe},QNe),vp=jPe(ZNe),eDe=(n,e)=>n.find(i=>i.id===e);function $Y(n,e){const i=pne(n,e),a=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:a}}function pne(n,e){for(const[i,a]of Object.entries(n))if(eDe(a,e))return i}function tDe(n){const e=n.includes("right"),i=n.includes("left");let a="center";return e&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function nDe(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:d,left:f}}var rDe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,iDe=Pee(function(n){return rDe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),sDe=iDe,oDe=function(e){return e!=="theme"},KY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?sDe:oDe},qY=function(e,i,a){var l;if(i){var d=i.shouldForwardProp;l=e.__emotion_forwardProp&&d?function(f){return e.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=e.__emotion_forwardProp),l},aDe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return nF(i,a,l),xee(function(){return rF(i,a,l)}),null},cDe=function n(e,i){var a=e.__emotion_real===e,l=a&&e.__emotion_base||e,d,f;i!==void 0&&(d=i.label,f=i.target);var _=qY(e,i,a),E=_||KY(l),b=!E("as");return function(){var w=arguments,I=a&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),w[0]==null||w[0].raw===void 0)I.push.apply(I,w);else{var k=w[0];I.push(k[0]);for(var V=w.length,L=1;L<V;L++)I.push(w[L],k[L])}var F=sF(function(B,q,$){var Q=b&&B.as||l,ae="",re=[],fe=B;if(B.theme==null){fe={};for(var Z in B)fe[Z]=B[Z];fe.theme=D.useContext(b0)}typeof B.className=="string"?ae=kee(q.registered,re,B.className):B.className!=null&&(ae=B.className+" ");var ee=Bk(I.concat(re),q.registered,fe);ae+=q.key+"-"+ee.name,f!==void 0&&(ae+=" "+f);var ne=b&&_===void 0?KY(Q):E,oe={};for(var ge in B)b&&ge==="as"||ne(ge)&&(oe[ge]=B[ge]);return oe.className=ae,$&&(oe.ref=$),D.createElement(D.Fragment,null,D.createElement(aDe,{cache:q,serialized:ee,isStringTag:typeof Q=="string"}),D.createElement(Q,oe))});return F.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",F.defaultProps=e.defaultProps,F.__emotion_real=F,F.__emotion_base=l,F.__emotion_styles=I,F.__emotion_forwardProp=_,Object.defineProperty(F,"toString",{value:function(){return"."+f}}),F.withComponent=function(B,q){var $=n(B,Wy({},i,q,{shouldForwardProp:qY(F,q,!0)}));return $.apply(void 0,I)},F}},lDe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],NV=cDe.bind(null);lDe.forEach(function(n){NV[n]=NV(n)});const uDe=new Set([...O0e,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),dDe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function hDe(n){return(dDe.has(n)||!uDe.has(n))&&n[0]!=="_"}const pDe=iSe(NV),fDe=({baseStyle:n})=>e=>{const{theme:i,css:a,__css:l,sx:d,...f}=e,[_]=pSe(f,N0e),E=tl(n,e),b=Hve({},l,E,lR(_),d),w=aee(b)(e.theme);return a?[w,a]:w};function iU(n,e){const{baseStyle:i,...a}=e??{};a.shouldForwardProp||(a.shouldForwardProp=hDe);const l=fDe({baseStyle:i}),d=pDe(n,a)(l);return D.forwardRef(function(E,b){const{children:w,...I}=E,{colorMode:k,forced:V}=zk(),L=V?k:void 0;return D.createElement(d,{ref:b,"data-theme":L,...I},w)})}function mDe(){const n=new Map;return new Proxy(iU,{apply(e,i,a){return iU(...a)},get(e,i){return n.has(i)||n.set(i,iU(i)),n.get(i)}})}const kt=mDe(),gDe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let a=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},fne=D.memo(n=>{const{id:e,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:_=5e3,containerStyle:E,motionVariants:b=gDe,toastSpacing:w="0.5rem"}=n,[I,k]=D.useState(_),V=OPe();Ng(()=>{V||a==null||a()},[V]),Ng(()=>{k(_)},[_]);const L=()=>k(null),F=()=>k(_),B=()=>{V&&l()};D.useEffect(()=>{V&&d&&l()},[V,d,l]),LSe(B,I);const q=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...E}),[E,w]),$=D.useMemo(()=>tDe(f),[f]);return S.jsx(vp.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:L,onHoverEnd:F,custom:{position:f},style:$,children:S.jsx(kt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:q,children:tl(i,{id:e,onClose:B})})})});fne.displayName="ToastComponent";function Gt(n){return D.forwardRef(n)}var sU,YY;function _De(){if(YY)return sU;YY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var _,E,b;if(Array.isArray(d)){if(_=d.length,_!=f.length)return!1;for(E=_;E--!==0;)if(!l(d[E],f[E]))return!1;return!0}var w;if(e&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(w=d.entries();!(E=w.next()).done;)if(!f.has(E.value[0]))return!1;for(w=d.entries();!(E=w.next()).done;)if(!l(E.value[1],f.get(E.value[0])))return!1;return!0}if(i&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(w=d.entries();!(E=w.next()).done;)if(!f.has(E.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(_=d.length,_!=f.length)return!1;for(E=_;E--!==0;)if(d[E]!==f[E])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(b=Object.keys(d),_=b.length,_!==Object.keys(f).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[E]))return!1;if(n&&d instanceof Element)return!1;for(E=_;E--!==0;)if(!((b[E]==="_owner"||b[E]==="__v"||b[E]==="__o")&&d.$$typeof)&&!l(d[b[E]],f[b[E]]))return!1;return!0}return d!==d&&f!==f}return sU=function(f,_){try{return l(f,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},sU}var yDe=_De();const mne=Xf(yDe);function $g(){const n=D.useContext(b0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function gne(){const n=zk(),e=$g();return{...n,theme:e}}function EDe(n,e,i){if(e==null)return e;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(e)??a(i)??i}function vDe(n,e,i){const a=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return d=>{const f=l.filter(Boolean),_=a.map((E,b)=>{const w=`${n}.${E}`;return EDe(d,w,f[b]??E)});return Array.isArray(e)?_:_[0]}}function _ne(n,e={}){const{styleConfig:i,...a}=e,{theme:l,colorMode:d}=gne(),f=n?BZ(l,`components.${n}`):void 0,_=i||f,E=ju({theme:l,colorMode:d},(_==null?void 0:_.defaultProps)??{},lR(z0(a,["children"])),(w,I)=>w?void 0:I),b=D.useRef({});if(_){const I=z0e(_)(E);mne(b.current,I)||(b.current=I)}return b.current}function cl(n,e={}){return _ne(n,e)}function za(n,e={}){return _ne(n,e)}const XY={path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Dn=Gt((n,e)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:_,__css:E,...b}=n,w=ln("chakra-icon",_),I=cl("Icon",n),k={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},V={ref:e,focusable:d,className:w,__css:k},L=a??XY.viewBox;if(i&&typeof i!="string")return S.jsx(kt.svg,{as:i,...V,...b});const F=f??XY.path;return S.jsx(kt.svg,{verticalAlign:"middle",viewBox:L,...V,...b,children:F})});Dn.displayName="Icon";function SDe(n){return S.jsx(Dn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function bDe(n){return S.jsx(Dn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function JY(n){return S.jsx(Dn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const TDe=pR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),la=Gt((n,e)=>{const i=cl("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:_,...E}=Ii(n),b=ln("chakra-spinner",_),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${TDe} ${d} linear infinite`,...i};return S.jsx(kt.div,{ref:e,__css:w,className:b,...E,children:a&&S.jsx(kt.span,{srOnly:!0,children:a})})});la.displayName="Spinner";const[wDe,HF]=Ni({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[CDe,$F]=Ni({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),yne={info:{icon:bDe,colorScheme:"blue"},warning:{icon:JY,colorScheme:"orange"},success:{icon:SDe,colorScheme:"green"},error:{icon:JY,colorScheme:"red"},loading:{icon:la,colorScheme:"blue"}};function RDe(n){return yne[n].colorScheme}function IDe(n){return yne[n].icon}const Fu=Gt(function(e,i){const{status:a="info",addRole:l=!0,...d}=Ii(e),f=e.colorScheme??RDe(a),_=za("Alert",{...e,colorScheme:f}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return S.jsx(wDe,{value:{status:a},children:S.jsx(CDe,{value:_,children:S.jsx(kt.div,{"data-status":a,role:l?"alert":void 0,ref:i,...d,className:ln("chakra-alert",e.className),__css:E})})})});Fu.displayName="Alert";function Bu(n){const{status:e}=HF(),i=IDe(e),a=$F(),l=e==="loading"?a.spinner:a.icon;return S.jsx(kt.span,{display:"inherit","data-status":e,...n,className:ln("chakra-alert__icon",n.className),__css:l,children:n.children||S.jsx(i,{h:"100%",w:"100%"})})}Bu.displayName="AlertIcon";const FC=Gt(function(e,i){const a=$F(),{status:l}=HF();return S.jsx(kt.div,{ref:i,"data-status":l,...e,className:ln("chakra-alert__title",e.className),__css:a.title})});FC.displayName="AlertTitle";const BC=Gt(function(e,i){const{status:a}=HF(),l=$F(),d={display:"inline",...l.description};return S.jsx(kt.div,{ref:i,"data-status":a,...e,className:ln("chakra-alert__desc",e.className),__css:d})});BC.displayName="AlertDescription";function ADe(n){return S.jsx(Dn,{focusable:"false","aria-hidden":!0,...n,children:S.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const KF=Gt(function(e,i){const a=cl("CloseButton",e),{children:l,isDisabled:d,__css:f,..._}=Ii(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return S.jsx(kt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...E,...a,...f},..._,children:l||S.jsx(ADe,{width:"1em",height:"1em"})})});KF.displayName="CloseButton";const PDe=n=>{const{status:e,variant:i="solid",id:a,title:l,isClosable:d,onClose:f,description:_,colorScheme:E,icon:b}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return S.jsxs(Fu,{addRole:!1,status:e,variant:i,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[S.jsx(Bu,{children:b}),S.jsxs(kt.div,{flex:"1",maxWidth:"100%",children:[l&&S.jsx(FC,{id:w==null?void 0:w.title,children:l}),_&&S.jsx(BC,{id:w==null?void 0:w.description,display:"block",children:_})]}),d&&S.jsx(KF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function Ene(n={}){const{render:e,toastComponent:i=PDe}=n;return l=>typeof e=="function"?e({...l,...n}):S.jsx(i,{...l,...n})}const ODe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},ep=kDe(ODe);function kDe(n){let e=n;const i=new Set,a=l=>{e=l(e),i.forEach(d=>d())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(_=>_.id!=l)}))},notify:(l,d)=>{const f=NDe(l,d),{position:_,id:E}=f;return a(b=>{const I=_.includes("top")?[f,...b[_]??[]]:[...b[_]??[],f];return{...b,[_]:I}}),E},update:(l,d)=>{l&&a(f=>{const _={...f},{position:E,index:b}=$Y(_,l);return E&&b!==-1&&(_[E][b]={..._[E][b],...d,message:Ene(d)}),_})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,b)=>(E[b]=d[b].map(w=>({...w,requestClose:!0})),E),{...d}))},close:l=>{a(d=>{const f=pne(d,l);return f?{...d,[f]:d[f].map(_=>_.id==l?{..._,requestClose:!0}:_)}:d})},isActive:l=>!!$Y(ep.getState(),l).position}}let QY=0;function NDe(n,e={}){QY+=1;const i=e.id??QY,a=e.position??"bottom";return{id:i,message:n,position:a,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>ep.removeToast(String(i),a),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}const[vne,DDe]=Ni({strict:!1,name:"PortalContext"}),qF="chakra-portal",xDe=".chakra-portal",LDe=n=>S.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),MDe=n=>{const{appendToParentPortal:e,children:i}=n,[a,l]=D.useState(null),d=D.useRef(null),[,f]=D.useState({});D.useEffect(()=>f({}),[]);const _=DDe(),E=TPe();Lf(()=>{if(!a)return;const w=a.ownerDocument,I=e?_??w.body:w.body;if(!I)return;d.current=w.createElement("div"),d.current.className=qF,I.appendChild(d.current),f({});const k=d.current;return()=>{I.contains(k)&&I.removeChild(k)}},[a]);const b=E!=null&&E.zIndex?S.jsx(LDe,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return d.current?bZ.createPortal(S.jsx(vne,{value:d.current,children:b}),d.current):S.jsx("span",{ref:w=>{w&&l(w)}})},UDe=n=>{const{children:e,containerRef:i,appendToParentPortal:a}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),f=D.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=qF),E},[l]),[,_]=D.useState({});return Lf(()=>_({}),[]),Lf(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?bZ.createPortal(S.jsx(vne,{value:a?f:null,children:e}),f):null};function Kl(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...a}=e;return i?S.jsx(UDe,{containerRef:i,...a}):S.jsx(MDe,{...a})}Kl.className=qF;Kl.selector=xDe;Kl.displayName="Portal";const[VDe,jDe]=Ni({name:"ToastOptionsContext",strict:!1}),FDe=n=>{const e=D.useSyncExternalStore(ep.subscribe,ep.getState,ep.getState),{motionVariants:i,component:a=fne,portalProps:l,animatePresenceProps:d}=n,_=Object.keys(e).map(E=>{const b=e[E];return S.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:nDe(E),children:S.jsx(rE,{...d,initial:!1,children:b.map(w=>S.jsx(a,{motionVariants:i,...w},w.id))})},E)});return S.jsx(Kl,{...l,children:_})},BDe=n=>function({children:i,theme:a=n,toastOptions:l,...d}){return S.jsxs(CPe,{theme:a,...d,children:[S.jsx(VDe,{value:l==null?void 0:l.defaultOptions,children:i}),S.jsx(FDe,{...l})]})},Sne=BDe(bee);function ZY(n){return n.sort((e,i)=>{const a=e.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const WDe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function eX(n,e,i){let a=n+1;return i&&a>=e&&(a=0),a}function tX(n,e,i){let a=n-1;return i&&a<0&&(a=e),a}const oU=typeof window<"u"?D.useLayoutEffect:D.useEffect,nX=n=>n;var zDe=Object.defineProperty,GDe=(n,e,i)=>e in n?zDe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Cs=(n,e,i)=>(GDe(n,typeof e!="symbol"?e+"":e,i),i);class HDe{constructor(){Cs(this,"descendants",new Map),Cs(this,"register",e=>{if(e!=null)return WDe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Cs(this,"unregister",e=>{this.descendants.delete(e);const i=ZY(Array.from(this.descendants.keys()));this.assignIndex(i)}),Cs(this,"destroy",()=>{this.descendants.clear()}),Cs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const a=e.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),Cs(this,"count",()=>this.descendants.size),Cs(this,"enabledCount",()=>this.enabledValues().length),Cs(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),Cs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Cs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Cs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Cs(this,"first",()=>this.item(0)),Cs(this,"firstEnabled",()=>this.enabledItem(0)),Cs(this,"last",()=>this.item(this.descendants.size-1)),Cs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Cs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Cs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Cs(this,"next",(e,i=!0)=>{const a=eX(e,this.count(),i);return this.item(a)}),Cs(this,"nextEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),d=eX(l,this.enabledCount(),i);return this.enabledItem(d)}),Cs(this,"prev",(e,i=!0)=>{const a=tX(e,this.count()-1,i);return this.item(a)}),Cs(this,"prevEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),d=tX(l,this.enabledCount()-1,i);return this.enabledItem(d)}),Cs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const a=Array.from(this.descendants.keys()).concat(e),l=ZY(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:e,index:-1,...i};this.descendants.set(e,d),this.assignIndex(l)})}}function bne(){const[n,e]=Ni({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=D.useRef(new HDe);return oU(()=>()=>l.current.destroy()),l.current},l=>{const d=e(),[f,_]=D.useState(-1),E=D.useRef(null);oU(()=>()=>{E.current&&d.unregister(E.current)},[]),oU(()=>{if(!E.current)return;const w=Number(E.current.dataset.index);f!=w&&!Number.isNaN(w)&&_(w)});const b=nX(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(E.current),register:Ki(b,E)}}]}const ZS={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Uy={enter:{duration:.2,ease:ZS.easeOut},exit:{duration:.1,ease:ZS.easeIn}},jf={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},$De=n=>n!=null&&parseInt(n.toString(),10)>0,rX={exit:{height:{duration:.2,ease:ZS.ease},opacity:{duration:.3,ease:ZS.ease}},enter:{height:{duration:.3,ease:ZS.ease},opacity:{duration:.4,ease:ZS.ease}}},KDe={exit:({animateOpacity:n,startingHeight:e,transition:i,transitionEnd:a,delay:l})=>({...n&&{opacity:$De(e)?1:0},height:e,transitionEnd:a==null?void 0:a.exit,transition:(i==null?void 0:i.exit)??jf.exit(rX.exit,l)}),enter:({animateOpacity:n,endingHeight:e,transition:i,transitionEnd:a,delay:l})=>({...n&&{opacity:1},height:e,transitionEnd:a==null?void 0:a.enter,transition:(i==null?void 0:i.enter)??jf.enter(rX.enter,l)})},Tne=D.forwardRef((n,e)=>{const{in:i,unmountOnExit:a,animateOpacity:l=!0,startingHeight:d=0,endingHeight:f="auto",style:_,className:E,transition:b,transitionEnd:w,animatePresenceProps:I,...k}=n,[V,L]=D.useState(!1);D.useEffect(()=>{const Q=setTimeout(()=>{L(!0)});return()=>clearTimeout(Q)},[]);const F=parseFloat(d.toString())>0,B={startingHeight:d,endingHeight:f,animateOpacity:l,transition:V?b:{enter:{duration:0}},transitionEnd:{enter:w==null?void 0:w.enter,exit:a?w==null?void 0:w.exit:{...w==null?void 0:w.exit,display:F?"block":"none"}}},q=a?i:!0,$=i||a?"enter":"exit";return S.jsx(rE,{...I,initial:!1,custom:B,children:q&&S.jsx(vp.div,{ref:e,...k,className:ln("chakra-collapse",E),style:{overflow:"hidden",display:"block",..._},custom:B,variants:KDe,initial:a?"exit":!1,animate:$,exit:"exit"})})});Tne.displayName="Collapse";const[qDe,YDe]=Ni({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function XDe(n){const e=n.trim().split(" "),i=e[0]??"",a=e.length>1?e[e.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function wne(n){const{name:e,getInitials:i,...a}=n,l=YDe();return S.jsx(kt.div,{role:"img","aria-label":e,...a,__css:l.label,children:e?i==null?void 0:i(e):null})}wne.displayName="AvatarName";const Cne=n=>S.jsxs(kt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[S.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),S.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Rne(n){const{loading:e,src:i,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:_,ignoreFallback:E}=n,[b,w]=D.useState("pending");D.useEffect(()=>{w(i?"loading":"pending")},[i]);const I=D.useRef(null),k=D.useCallback(()=>{if(!i)return;V();const L=new Image;L.src=i,f&&(L.crossOrigin=f),a&&(L.srcset=a),_&&(L.sizes=_),e&&(L.loading=e),L.onload=F=>{V(),w("loaded"),l==null||l(F)},L.onerror=F=>{V(),w("failed"),d==null||d(F)},I.current=L},[i,f,a,_,l,d,e]),V=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return Lf(()=>{if(!E)return b==="loading"&&k(),()=>{V()}},[b,k,E]),E?"loaded":b}const JDe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Ine(n){const{src:e,srcSet:i,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:_,loading:E,iconLabel:b,icon:w=S.jsx(Cne,{}),ignoreFallback:I,referrerPolicy:k,crossOrigin:V}=n,F=Rne({src:e,onError:a,crossOrigin:V,ignoreFallback:I})==="loaded";return!e||!F?f?S.jsx(wne,{className:"chakra-avatar__initials",getInitials:d,name:f}):D.cloneElement(w,{role:"img","aria-label":b}):S.jsx(kt.img,{src:e,srcSet:i,alt:f??b,onLoad:l,referrerPolicy:k,crossOrigin:V??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}Ine.displayName="AvatarImage";const QDe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Gu=Gt((n,e)=>{const i=za("Avatar",n),[a,l]=D.useState(!1),{src:d,srcSet:f,name:_,showBorder:E,borderRadius:b="full",onError:w,onLoad:I,getInitials:k=XDe,icon:V=S.jsx(Cne,{}),iconLabel:L=" avatar",loading:F,children:B,borderColor:q,ignoreFallback:$,crossOrigin:Q,referrerPolicy:ae,...re}=Ii(n),fe={borderRadius:b,borderWidth:E?"2px":void 0,...QDe,...i.container};return q&&(fe.borderColor=q),S.jsx(kt.span,{ref:e,...re,className:ln("chakra-avatar",n.className),"data-loaded":pn(a),__css:fe,children:S.jsxs(qDe,{value:i,children:[S.jsx(Ine,{src:d,srcSet:f,loading:F,onLoad:Rn(I,()=>{l(!0)}),onError:w,getInitials:k,name:_,borderRadius:b,icon:V,iconLabel:L,ignoreFallback:$,crossOrigin:Q,referrerPolicy:ae}),B]})})});Gu.displayName="Avatar";const Wd=Gt(function(e,i){const a=cl("Badge",e),{className:l,...d}=Ii(e);return S.jsx(kt.span,{ref:i,className:ln("chakra-badge",e.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});Wd.displayName="Badge";const qe=kt("div");qe.displayName="Box";const[pGe,ZDe]=Ni({strict:!1,name:"ButtonGroupContext"});function Yw(n){const{children:e,className:i,...a}=n,l=D.isValidElement(e)?D.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,d=ln("chakra-button__icon",i);return S.jsx(kt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}Yw.displayName="ButtonIcon";function DV(n){const{label:e,placement:i,spacing:a="0.5rem",children:l=S.jsx(la,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,..._}=n,E=ln("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,e,b,a]);return S.jsx(kt.div,{className:E,..._,__css:w,children:l})}DV.displayName="ButtonSpinner";function exe(n){const[e,i]=D.useState(!n);return{ref:D.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:e?"button":void 0}}const Zn=Gt((n,e)=>{const i=ZDe(),a=cl("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:f,children:_,leftIcon:E,rightIcon:b,loadingText:w,iconSpacing:I="0.5rem",type:k,spinner:V,spinnerPlacement:L="start",className:F,as:B,shouldWrapChildren:q,...$}=Ii(n),Q=D.useMemo(()=>{const Z={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:Z}}},[a,i]),{ref:ae,type:re}=exe(B),fe={rightIcon:b,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:q};return S.jsxs(kt.button,{disabled:l||d,ref:xSe(e,ae),as:B,type:k??re,"data-active":pn(f),"data-loading":pn(d),__css:Q,className:ln("chakra-button",F),...$,children:[d&&L==="start"&&S.jsx(DV,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:I,children:V}),d?w||S.jsx(kt.span,{opacity:0,children:S.jsx(iX,{...fe})}):S.jsx(iX,{...fe}),d&&L==="end"&&S.jsx(DV,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:I,children:V})]})});Zn.displayName="Button";function iX(n){const{leftIcon:e,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?S.jsxs("span",{style:{display:"contents"},children:[e&&S.jsx(Yw,{marginEnd:l,children:e}),a,i&&S.jsx(Yw,{marginStart:l,children:i})]}):S.jsxs(S.Fragment,{children:[e&&S.jsx(Yw,{marginEnd:l,children:e}),a,i&&S.jsx(Yw,{marginStart:l,children:i})]})}const Ys=Gt((n,e)=>{const{icon:i,children:a,isRound:l,"aria-label":d,...f}=n,_=i||a,E=D.isValidElement(_)?D.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return S.jsx(Zn,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":d,...f,children:E})});Ys.displayName="IconButton";const[txe,Ane]=vPe("Card"),F1=Gt(function(e,i){const{className:a,children:l,direction:d="column",justify:f,align:_,...E}=Ii(e),b=za("Card",e);return S.jsx(kt.div,{ref:i,className:ln("chakra-card",a),__css:{display:"flex",flexDirection:d,justifyContent:f,alignItems:_,position:"relative",minWidth:0,wordWrap:"break-word",...b.container},...E,children:S.jsx(txe,{value:b,children:l})})}),B1=Gt(function(e,i){const{className:a,...l}=e,d=Ane();return S.jsx(kt.div,{ref:i,className:ln("chakra-card__body",a),__css:d.body,...l})}),sX=Gt(function(e,i){const{className:a,justify:l,...d}=e,f=Ane();return S.jsx(kt.div,{ref:i,className:ln("chakra-card__footer",a),__css:{display:"flex",justifyContent:l,...f.footer},...d})}),Yk=kt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Yk.displayName="Center";const nxe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Gt(function(e,i){const{axis:a="both",...l}=e;return S.jsx(kt.div,{ref:i,__css:nxe[a],...l,position:"absolute"})});var rxe=()=>typeof document<"u",oX=!1,ER=null,zy=!1,xV=!1,LV=new Set;function YF(n,e){LV.forEach(i=>i(n,e))}var ixe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function sxe(n){return!(n.metaKey||!ixe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function aX(n){zy=!0,sxe(n)&&(ER="keyboard",YF("keyboard",n))}function PS(n){if(ER="pointer",n.type==="mousedown"||n.type==="pointerdown"){zy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;YF("pointer",n)}}function oxe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function axe(n){oxe(n)&&(zy=!0,ER="virtual")}function cxe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!zy&&!xV&&(ER="virtual",YF("virtual",n)),zy=!1,xV=!1)}function lxe(){zy=!1,xV=!0}function cX(){return ER!=="pointer"}function uxe(){if(!rxe()||oX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){zy=!0,n.apply(this,i)},document.addEventListener("keydown",aX,!0),document.addEventListener("keyup",aX,!0),document.addEventListener("click",axe,!0),window.addEventListener("focus",cxe,!0),window.addEventListener("blur",lxe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",PS,!0),document.addEventListener("pointermove",PS,!0),document.addEventListener("pointerup",PS,!0)):(document.addEventListener("mousedown",PS,!0),document.addEventListener("mousemove",PS,!0),document.addEventListener("mouseup",PS,!0)),oX=!0}function Pne(n){uxe(),n(cX());const e=()=>n(cX());return LV.add(e),()=>{LV.delete(e)}}const[dxe,One]=Ni({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[hxe,sE]=Ni({strict:!1,name:"FormControlContext"});function pxe(n){const{id:e,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,_=D.useId(),E=e||`field-${_}`,b=`${E}-label`,w=`${E}-feedback`,I=`${E}-helptext`,[k,V]=D.useState(!1),[L,F]=D.useState(!1),[B,q]=D.useState(!1),$=D.useCallback((Z={},ee=null)=>({id:I,...Z,ref:Ki(ee,ne=>{ne&&F(!0)})}),[I]),Q=D.useCallback((Z={},ee=null)=>({...Z,ref:ee,"data-focus":pn(B),"data-disabled":pn(l),"data-invalid":pn(a),"data-readonly":pn(d),id:Z.id!==void 0?Z.id:b,htmlFor:Z.htmlFor!==void 0?Z.htmlFor:E}),[E,l,B,a,d,b]),ae=D.useCallback((Z={},ee=null)=>({id:w,...Z,ref:Ki(ee,ne=>{ne&&V(!0)}),"aria-live":"polite"}),[w]),re=D.useCallback((Z={},ee=null)=>({...Z,...f,ref:ee,role:"group","data-focus":pn(B),"data-disabled":pn(l),"data-invalid":pn(a),"data-readonly":pn(d)}),[f,l,B,a,d]),fe=D.useCallback((Z={},ee=null)=>({...Z,ref:ee,role:"presentation","aria-hidden":!0,children:Z.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!B,onFocus:()=>q(!0),onBlur:()=>q(!1),hasFeedbackText:k,setHasFeedbackText:V,hasHelpText:L,setHasHelpText:F,id:E,labelId:b,feedbackId:w,helpTextId:I,htmlProps:f,getHelpTextProps:$,getErrorMessageProps:ae,getRootProps:re,getLabelProps:Q,getRequiredIndicatorProps:fe}}const kn=Gt(function(e,i){const a=za("Form",e),l=Ii(e),{getRootProps:d,htmlProps:f,..._}=pxe(l),E=ln("chakra-form-control",e.className);return S.jsx(hxe,{value:_,children:S.jsx(dxe,{value:a,children:S.jsx(kt.div,{...d({},i),className:E,__css:a.container})})})});kn.displayName="FormControl";const WC=Gt(function(e,i){const a=sE(),l=One(),d=ln("chakra-form__helper-text",e.className);return S.jsx(kt.div,{...a==null?void 0:a.getHelpTextProps(e,i),__css:l.helperText,className:d})});WC.displayName="FormHelperText";function XF(n){const{isDisabled:e,isInvalid:i,isReadOnly:a,isRequired:l,...d}=kne(n);return{...d,disabled:e,readOnly:a,required:l,"aria-invalid":xf(i),"aria-required":xf(l),"aria-readonly":xf(a)}}function kne(n){const e=sE(),{id:i,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:_,isReadOnly:E,isDisabled:b,onFocus:w,onBlur:I,...k}=n,V=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&V.push(e.feedbackId),e!=null&&e.hasHelpText&&V.push(e.helpTextId),{...k,"aria-describedby":V.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:a??b??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:d??f??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:Rn(e==null?void 0:e.onFocus,w),onBlur:Rn(e==null?void 0:e.onBlur,I)}}const Nne={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function fxe(n={}){const e=kne(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:_,onFocus:E,"aria-describedby":b}=e,{defaultChecked:w,isChecked:I,isFocusable:k,onChange:V,isIndeterminate:L,name:F,value:B,tabIndex:q=void 0,"aria-label":$,"aria-labelledby":Q,"aria-invalid":ae,...re}=n,fe=z0(re,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Z=rl(V),ee=rl(_),ne=rl(E),[oe,ge]=D.useState(!1),[pe,le]=D.useState(!1),[Me,He]=D.useState(!1),[tt,Ee]=D.useState(!1);D.useEffect(()=>Pne(ge),[]);const Ie=D.useRef(null),[ve,Be]=D.useState(!0),[ke,Re]=D.useState(!!w),he=I!==void 0,we=he?I:ke,Ue=D.useCallback(Qt=>{if(a||i){Qt.preventDefault();return}he||Re(we?Qt.currentTarget.checked:L?!0:Qt.currentTarget.checked),Z==null||Z(Qt)},[a,i,we,he,L,Z]);Lf(()=>{Ie.current&&(Ie.current.indeterminate=!!L)},[L]),Ng(()=>{i&&le(!1)},[i,le]),Lf(()=>{const Qt=Ie.current;if(!(Qt!=null&&Qt.form))return;const Ot=()=>{Re(!!w)};return Qt.form.addEventListener("reset",Ot),()=>{var Lt;return(Lt=Qt.form)==null?void 0:Lt.removeEventListener("reset",Ot)}},[]);const Fe=i&&!k,$e=D.useCallback(Qt=>{Qt.key===" "&&Ee(!0)},[Ee]),ct=D.useCallback(Qt=>{Qt.key===" "&&Ee(!1)},[Ee]);Lf(()=>{if(!Ie.current)return;Ie.current.checked!==we&&Re(Ie.current.checked)},[Ie.current]);const it=D.useCallback((Qt={},Ot=null)=>{const Lt=Ce=>{pe&&Ce.preventDefault(),Ee(!0)};return{...Qt,ref:Ot,"data-active":pn(tt),"data-hover":pn(Me),"data-checked":pn(we),"data-focus":pn(pe),"data-focus-visible":pn(pe&&oe),"data-indeterminate":pn(L),"data-disabled":pn(i),"data-invalid":pn(d),"data-readonly":pn(a),"aria-hidden":!0,onMouseDown:Rn(Qt.onMouseDown,Lt),onMouseUp:Rn(Qt.onMouseUp,()=>Ee(!1)),onMouseEnter:Rn(Qt.onMouseEnter,()=>He(!0)),onMouseLeave:Rn(Qt.onMouseLeave,()=>He(!1))}},[tt,we,i,pe,oe,Me,L,d,a]),Ct=D.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ot,"data-active":pn(tt),"data-hover":pn(Me),"data-checked":pn(we),"data-focus":pn(pe),"data-focus-visible":pn(pe&&oe),"data-indeterminate":pn(L),"data-disabled":pn(i),"data-invalid":pn(d),"data-readonly":pn(a)}),[tt,we,i,pe,oe,Me,L,d,a]),Vt=D.useCallback((Qt={},Ot=null)=>({...fe,htmlFor:ve?f:void 0,...Qt,ref:Ki(Ot,Lt=>{Lt&&Be(Lt.tagName==="LABEL")}),onClick:Rn(Qt.onClick,()=>{var Lt;ve||((Lt=Ie.current)==null||Lt.click(),requestAnimationFrame(()=>{var Ce;(Ce=Ie.current)==null||Ce.focus({preventScroll:!0})}))}),"data-disabled":pn(i),"data-checked":pn(we),"data-invalid":pn(d)}),[fe,i,we,d,ve,f]),Dt=D.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ki(Ie,Ot),type:"checkbox",name:F,value:B,id:f,tabIndex:q,onChange:Rn(Qt.onChange,Ue),onBlur:Rn(Qt.onBlur,ee,()=>le(!1)),onFocus:Rn(Qt.onFocus,ne,()=>le(!0)),onKeyDown:Rn(Qt.onKeyDown,$e),onKeyUp:Rn(Qt.onKeyUp,ct),required:l,checked:we,disabled:Fe,readOnly:a,"aria-label":$,"aria-labelledby":Q,"aria-invalid":ae?!!ae:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":L?"mixed":we,style:Nne}),[F,B,f,q,Ue,ee,ne,$e,ct,l,we,Fe,a,$,Q,ae,d,b,i,L]),an=D.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ot,onMouseDown:Rn(Qt.onMouseDown,mxe),"data-disabled":pn(i),"data-checked":pn(we),"data-invalid":pn(d)}),[we,i,d]);return{state:{isInvalid:d,isFocused:pe,isChecked:we,isActive:tt,isHovered:Me,isIndeterminate:L,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:Vt,getCheckboxProps:it,getIndicatorProps:Ct,getInputProps:Dt,getLabelProps:an,htmlProps:fe}}function mxe(n){n.preventDefault(),n.stopPropagation()}const Xw=Gt(function(e,i){const a=cl("Code",e),{className:l,...d}=Ii(e);return S.jsx(kt.code,{ref:i,className:ln("chakra-code",e.className),...d,__css:{display:"inline-block",...a}})});Xw.displayName="Code";const Wl=Gt(function(e,i){const{className:a,centerContent:l,...d}=Ii(e),f=cl("Container",e);return S.jsx(kt.div,{ref:i,className:ln("chakra-container",a),...d,__css:{...f,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});Wl.displayName="Container";const uo=Gt(function(e,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:_,borderStyle:E,borderColor:b,...w}=cl("Divider",e),{className:I,orientation:k="horizontal",__css:V,...L}=Ii(e),F={vertical:{borderLeftWidth:a||f||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||_||"1px",width:"100%"}};return S.jsx(kt.hr,{ref:i,"aria-orientation":k,...L,__css:{...w,border:"0",borderColor:b,borderStyle:E,...F[k],...V},className:ln("chakra-divider",I)})});uo.displayName="Divider";function Jw(n){return typeof n=="function"}function gxe(...n){return e=>n.reduce((i,a)=>a(i),e)}const _xe=n=>function(...i){let a=[...i],l=i[i.length-1];return fAe(l)&&a.length>1?a=a.slice(0,a.length-1):l=n,gxe(...a.map(d=>f=>Jw(d)?d(f):Exe(f,d)))(l)},yxe=_xe(bee);function Exe(...n){return ju({},...n,Dne)}function Dne(n,e,i,a){if((Jw(n)||Jw(e))&&Object.prototype.hasOwnProperty.call(a,i))return(...l)=>{const d=Jw(n)?n(...l):n,f=Jw(e)?e(...l):e;return ju({},d,f,Dne)};if(po(n)&&eV(e)||eV(n)&&po(e))return e}const ar=Gt(function(e,i){const{direction:a,align:l,justify:d,wrap:f,basis:_,grow:E,shrink:b,...w}=e,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:_,flexGrow:E,flexShrink:b};return S.jsx(kt.div,{ref:i,__css:I,...w})});ar.displayName="Flex";function vxe(n,e){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(e.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var aU={exports:{}},cU,lX;function Sxe(){if(lX)return cU;lX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return cU=n,cU}var lU,uX;function bxe(){if(uX)return lU;uX=1;var n=Sxe();function e(){}function i(){}return i.resetWarningCache=e,lU=function(){function a(f,_,E,b,w,I){if(I!==n){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return d.PropTypes=d,d},lU}var dX;function Txe(){return dX||(dX=1,aU.exports=bxe()()),aU.exports}var wxe=Txe();const Hr=Xf(wxe);var MV="data-focus-lock",xne="data-focus-lock-disabled",Cxe="data-no-focus-lock",Rxe="data-autofocus-inside",Ixe="data-no-autofocus";function uU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Axe(n,e){var i=D.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=e,i.facade}var Pxe=typeof window<"u"?D.useLayoutEffect:D.useEffect,hX=new WeakMap;function Lne(n,e){var i=Axe(null,function(a){return n.forEach(function(l){return uU(l,a)})});return Pxe(function(){var a=hX.get(i);if(a){var l=new Set(a),d=new Set(n),f=i.current;l.forEach(function(_){d.has(_)||uU(_,null)}),d.forEach(function(_){l.has(_)||uU(_,f)})}hX.set(i,n)},[n]),i}var dU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},tp=function(){return tp=Object.assign||function(e){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e[d]=i[d])}return e},tp.apply(this,arguments)};function vR(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function Oxe(n,e,i){if(i||arguments.length===2)for(var a=0,l=e.length,d;a<l;a++)(d||!(a in e))&&(d||(d=Array.prototype.slice.call(e,0,a)),d[a]=e[a]);return n.concat(d||Array.prototype.slice.call(e))}function Mne(n){return n}function Une(n,e){e===void 0&&(e=Mne);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var f=e(d,a);return i.push(f),function(){i=i.filter(function(_){return _!==f})}},assignSyncMedium:function(d){for(a=!0;i.length;){var f=i;i=[],f.forEach(d)}i={push:function(_){return d(_)},filter:function(){return i}}},assignMedium:function(d){a=!0;var f=[];if(i.length){var _=i;i=[],_.forEach(d),f=i}var E=function(){var w=f;f=[],w.forEach(d)},b=function(){return Promise.resolve().then(E)};b(),i={push:function(w){f.push(w),b()},filter:function(w){return f=f.filter(w),i}}}};return l}function JF(n,e){return e===void 0&&(e=Mne),Une(n,e)}function Vne(n){n===void 0&&(n={});var e=Une(null);return e.options=tp({async:!0,ssr:!1},n),e}var jne=function(n){var e=n.sideCar,i=vR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=e.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,tp({},i))};jne.isSideCarExport=!0;function kxe(n,e){return n.useMedium(e),jne}var Fne=JF({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Bne=JF(),Nxe=JF(),Dxe=Vne({async:!0,ssr:typeof document<"u"}),xxe=D.createContext(void 0),Lxe=[],QF=D.forwardRef(function(e,i){var a,l=D.useState(),d=l[0],f=l[1],_=D.useRef(),E=D.useRef(!1),b=D.useRef(null),w=D.useState({}),I=w[1],k=e.children,V=e.disabled,L=V===void 0?!1:V,F=e.noFocusGuards,B=F===void 0?!1:F,q=e.persistentFocus,$=q===void 0?!1:q,Q=e.crossFrame,ae=Q===void 0?!0:Q,re=e.autoFocus,fe=re===void 0?!0:re;e.allowTextSelection;var Z=e.group,ee=e.className,ne=e.whiteList,oe=e.hasPositiveIndices,ge=e.shards,pe=ge===void 0?Lxe:ge,le=e.as,Me=le===void 0?"div":le,He=e.lockProps,tt=He===void 0?{}:He,Ee=e.sideCar,Ie=e.returnFocus,ve=Ie===void 0?!1:Ie,Be=e.focusOptions,ke=e.onActivation,Re=e.onDeactivation,he=D.useState({}),we=he[0],Ue=D.useCallback(function(Ot){var Lt=Ot.captureFocusRestore;if(!b.current){var Ce,Ve=(Ce=document)==null?void 0:Ce.activeElement;b.current=Ve,Ve!==document.body&&(b.current=Lt(Ve))}_.current&&ke&&ke(_.current),E.current=!0,I()},[ke]),Fe=D.useCallback(function(){E.current=!1,Re&&Re(_.current),I()},[Re]),$e=D.useCallback(function(Ot){var Lt=b.current;if(Lt){var Ce=(typeof Lt=="function"?Lt():Lt)||document.body,Ve=typeof ve=="function"?ve(Ce):ve;if(Ve){var Ye=typeof Ve=="object"?Ve:void 0;b.current=null,Ot?Promise.resolve().then(function(){return Ce.focus(Ye)}):Ce.focus(Ye)}}},[ve]),ct=D.useCallback(function(Ot){E.current&&Fne.useMedium(Ot)},[]),it=Bne.useMedium,Ct=D.useCallback(function(Ot){_.current!==Ot&&(_.current=Ot,f(Ot))},[]),Vt=Wy((a={},a[xne]=L&&"disabled",a[MV]=Z,a),tt),Dt=B!==!0,an=Dt&&B!=="tail",jn=Lne([i,Ct]),Qt=D.useMemo(function(){return{observed:_,shards:pe,enabled:!L,active:E.current}},[L,E.current,pe,d]);return _r.createElement(D.Fragment,null,Dt&&[_r.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:L?-1:0,style:dU}),oe?_r.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:L?-1:1,style:dU}):null],!L&&_r.createElement(Ee,{id:we,sideCar:Dxe,observed:d,disabled:L,persistentFocus:$,crossFrame:ae,autoFocus:fe,whiteList:ne,shards:pe,onActivation:Ue,onDeactivation:Fe,returnFocus:$e,focusOptions:Be,noFocusGuards:B}),_r.createElement(Me,Wy({ref:jn},Vt,{className:ee,onBlur:it,onFocus:ct}),_r.createElement(xxe.Provider,{value:Qt},k)),an&&_r.createElement("div",{"data-focus-guard":!0,tabIndex:L?-1:0,style:dU}))});QF.propTypes={};function UV(n,e){return UV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},UV(n,e)}function Mxe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,UV(n,e)}function zC(n){"@babel/helpers - typeof";return zC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zC(n)}function Uxe(n,e){if(zC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,e);if(zC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Vxe(n){var e=Uxe(n,"string");return zC(e)=="symbol"?e:e+""}function jxe(n,e,i){return(e=Vxe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function Fxe(n,e){function i(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function _(){f=n(d.map(function(b){return b.props})),e(f)}var E=function(b){Mxe(w,b);function w(){return b.apply(this,arguments)||this}w.peek=function(){return f};var I=w.prototype;return I.componentDidMount=function(){d.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var V=d.indexOf(this);d.splice(V,1),_()},I.render=function(){return _r.createElement(l,this.props)},w}(D.PureComponent);return jxe(E,"displayName","SideEffect("+i(l)+")"),E}}var Sp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Gy=function(n){return Array.isArray(n)?n:[n]},Wne=function(n){return Array.isArray(n)?n[0]:n},Bxe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},zne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Gne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},Wxe=function(n){return n.hasAttribute("inert")},zxe=function(n,e){return!n||Gne(n)||!Bxe(n)&&!Wxe(n)&&e(zne(n))},Hne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=zxe(e,Hne.bind(void 0,n));return n.set(e,a),a},Gxe=function(n,e){return n&&!Gne(n)?Kxe(n)?e(zne(n)):!1:!0},$ne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=Gxe(e,$ne.bind(void 0,n));return n.set(e,a),a},Kne=function(n){return n.dataset},Hxe=function(n){return n.tagName==="BUTTON"},qne=function(n){return n.tagName==="INPUT"},Yne=function(n){return qne(n)&&n.type==="radio"},$xe=function(n){return!((qne(n)||Hxe(n))&&(n.type==="hidden"||n.disabled))},Kxe=function(n){var e=n.getAttribute(Ixe);return![!0,"true",""].includes(e)},ZF=function(n){var e;return!!(n&&(!((e=Kne(n))===null||e===void 0)&&e.focusGuard))},VV=function(n){return!ZF(n)},qxe=function(n){return!!n},Yxe=function(n,e){var i=Math.max(0,n.tabIndex),a=Math.max(0,e.tabIndex),l=i-a,d=n.index-e.index;if(l){if(!i)return 1;if(!a)return-1}return l||d},Xxe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},e5=function(n,e,i){return Sp(n).map(function(a,l){var d=Xxe(a);return{node:a,index:l,tabIndex:i&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!e||a.tabIndex>=0}).sort(Yxe)},Jxe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],t5=Jxe.join(","),Qxe="".concat(t5,", [data-focus-guard]"),Xne=function(n,e){return Sp((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(e?Qxe:t5)?[a]:[],Xne(a))},[])},Zxe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?R0([n.contentDocument.body],e):[n]},R0=function(n,e){return n.reduce(function(i,a){var l,d=Xne(a,e),f=(l=[]).concat.apply(l,d.map(function(_){return Zxe(_,e)}));return i.concat(f,a.parentNode?Sp(a.parentNode.querySelectorAll(t5)).filter(function(_){return _===a}):[])},[])},eLe=function(n){var e=n.querySelectorAll("[".concat(Rxe,"]"));return Sp(e).map(function(i){return R0([i])}).reduce(function(i,a){return i.concat(a)},[])},n5=function(n,e){return Sp(n).filter(function(i){return Hne(e,i)}).filter(function(i){return $xe(i)})},pX=function(n,e){return e===void 0&&(e=new Map),Sp(n).filter(function(i){return $ne(e,i)})},r5=function(n,e,i){return e5(n5(R0(n,i),e),!0,i)},GC=function(n,e){return e5(n5(R0(n),e),!1)},tLe=function(n,e){return n5(eLe(n),e)},Vy=function(n,e){return n.shadowRoot?Vy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:Sp(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?Vy(l,e):!1}return Vy(i,e)})},nLe=function(n){for(var e=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(a)}return n.filter(function(f,_){return!e.has(_)})},Jne=function(n){return n.parentNode?Jne(n.parentNode):n},i5=function(n){var e=Gy(n);return e.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(MV);return i.push.apply(i,l?nLe(Sp(Jne(a).querySelectorAll("[".concat(MV,'="').concat(l,'"]:not([').concat(xne,'="disabled"])')))):[a]),i},[])},rLe=function(n){try{return n()}catch{return}},HC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?HC(e.shadowRoot):e instanceof HTMLIFrameElement&&rLe(function(){return e.contentWindow.document})?HC(e.contentWindow.document):e}},iLe=function(n,e){return n===e},sLe=function(n,e){return!!Sp(n.querySelectorAll("iframe")).some(function(i){return iLe(i,e)})},Qne=function(n,e){return e===void 0&&(e=HC(Wne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:i5(n).some(function(i){return Vy(i,e)||sLe(i,e)})},oLe=function(n){n===void 0&&(n=document);var e=HC(n);return e?Sp(n.querySelectorAll("[".concat(Cxe,"]"))).some(function(i){return Vy(i,e)}):!1},aLe=function(n,e){return e.filter(Yne).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},s5=function(n,e){return Yne(n)&&n.name?aLe(n,e):n},cLe=function(n){var e=new Set;return n.forEach(function(i){return e.add(s5(i,n))}),n.filter(function(i){return e.has(i)})},fX=function(n){return n[0]&&n.length>1?s5(n[0],n):n[0]},mX=function(n,e){return n.indexOf(s5(e,n))},jV="NEW_FOCUS",lLe=function(n,e,i,a,l){var d=n.length,f=n[0],_=n[d-1],E=ZF(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,w=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:jV;if(I===-1)return jV;var k=b-w,V=i.indexOf(f),L=i.indexOf(_),F=cLe(i),B=a!==void 0?F.indexOf(a):-1,q=l?F.indexOf(l):B,$=F.filter(function(ee){return ee.tabIndex>=0}),Q=a!==void 0?$.indexOf(a):-1,ae=l?$.indexOf(l):Q,re=Q>=0&&ae>=0?ae-Q:q-B;if(!k&&I>=0||e.length===0)return I;var fe=mX(n,e[0]),Z=mX(n,e[e.length-1]);if(b<=V&&E&&Math.abs(k)>1)return Z;if(b>=L&&E&&Math.abs(k)>1)return fe;if(k&&Math.abs(re)>1)return I;if(b<=V)return Z;if(b>L)return fe;if(k)return Math.abs(k)>1?I:(d+I+k)%d}},uLe=function(n){return function(e){var i,a=(i=Kne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||a!==void 0&&a!=="false"||n.indexOf(e)>=0}},gX=function(n,e,i){var a=n.map(function(d){var f=d.node;return f}),l=pX(a.filter(uLe(i)));return l&&l.length?fX(l):fX(pX(e))},FV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&FV(n.parentNode.host||n.parentNode,e),e},hU=function(n,e){for(var i=FV(n),a=FV(e),l=0;l<i.length;l+=1){var d=i[l];if(a.indexOf(d)>=0)return d}return!1},Zne=function(n,e,i){var a=Gy(n),l=Gy(e),d=a[0],f=!1;return l.filter(Boolean).forEach(function(_){f=hU(f||_,_)||f,i.filter(Boolean).forEach(function(E){var b=hU(d,E);b&&(!f||Vy(b,f)?f=b:f=hU(b,f))})}),f},_X=function(n,e){return n.reduce(function(i,a){return i.concat(tLe(a,e))},[])},dLe=function(n,e){var i=new Map;return e.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(qxe)},hLe=function(n,e){var i=HC(Gy(n).length>0?document:Wne(n).ownerDocument),a=i5(n).filter(VV),l=Zne(i||n,n,a),d=new Map,f=GC(a,d),_=f.filter(function(L){var F=L.node;return VV(F)});if(_[0]){var E=GC([l],d).map(function(L){var F=L.node;return F}),b=dLe(E,_),w=b.map(function(L){var F=L.node;return F}),I=b.filter(function(L){var F=L.tabIndex;return F>=0}).map(function(L){var F=L.node;return F}),k=lLe(w,I,E,i,e);if(k===jV){var V=gX(f,I,_X(a,d))||gX(f,w,_X(a,d));if(V)return{node:V};console.warn("focus-lock: cannot find any node to move focus into");return}return k===void 0?k:b[k]}},pLe=function(n){var e=i5(n).filter(VV),i=Zne(n,n,e),a=e5(R0([i],!0),!0,!0),l=R0(e,!1);return a.map(function(d){var f=d.node,_=d.index;return{node:f,index:_,lockItem:l.indexOf(f)>=0,guard:ZF(f)}})},o5=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},pU=0,fU=!1,ere=function(n,e,i){i===void 0&&(i={});var a=hLe(n,e);if(!fU&&a){if(pU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),fU=!0,setTimeout(function(){fU=!1},1);return}pU++,o5(a.node,i.focusOptions),pU--}};function Tw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var fLe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:Tw(i),parent:Tw(i.parentElement),left:Tw(i.previousElementSibling),right:Tw(i.nextElementSibling)}),i=i.parentElement;return{element:Tw(n),stack:e,ownerDocument:n.ownerDocument}},mLe=function(n){var e,i,a,l,d;if(n)for(var f=n.stack,_=n.ownerDocument,E=new Map,b=0,w=f;b<w.length;b++){var I=w[b],k=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(k&&_.contains(k)){for(var V=(i=I.left)===null||i===void 0?void 0:i.call(I),L=I.current(),F=k.contains(L)?L:void 0,B=(a=I.right)===null||a===void 0?void 0:a.call(I),q=r5([k],E),$=(d=(l=F??(V==null?void 0:V.nextElementSibling))!==null&&l!==void 0?l:B)!==null&&d!==void 0?d:V;$;){for(var Q=0,ae=q;Q<ae.length;Q++){var re=ae[Q];if($!=null&&$.contains(re.node))return re.node}$=$.nextElementSibling}if(q.length)return q[0].node}}},tre=function(n){var e=fLe(n);return function(){return mLe(e)}},gLe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var a=Gy(e);if(a.every(function(f){return!Vy(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?r5(a,new Map):GC(a,new Map),d=l.findIndex(function(f){var _=f.node;return _===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},_Le=function(n,e){var i=e?r5(Gy(n),new Map):GC(Gy(n),new Map);return{first:i[0],last:i[i.length-1]}},yLe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},nre=function(n,e,i){e===void 0&&(e={});var a=yLe(e),l=gLe(n,a.scope,a.onlyTabbable);if(l){var d=i(l,a.cycle);d&&o5(d.node,a.focusOptions)}},ELe=function(n,e){e===void 0&&(e={}),nre(n,e,function(i,a){var l=i.next,d=i.first;return l||a&&d})},vLe=function(n,e){e===void 0&&(e={}),nre(n,e,function(i,a){var l=i.prev,d=i.last;return l||a&&d})},rre=function(n,e,i){var a,l=_Le(n,(a=e.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[i];d&&o5(d.node,e.focusOptions)},SLe=function(n,e){e===void 0&&(e={}),rre(n,e,"first")},bLe=function(n,e){e===void 0&&(e={}),rre(n,e,"last")};function a5(n){setTimeout(n,1)}var TLe=function(e){return e&&"current"in e?e.current:e},ire=function(){return document&&document.activeElement===document.body},wLe=function(){return ire()||oLe()},l0=null,Xc=null,yX=function(){return null},u0=null,$C=!1,c5=!1,CLe=function(){return!0},RLe=function(e){return(l0.whiteList||CLe)(e)},ILe=function(e,i){u0={observerNode:e,portaledElement:i}},ALe=function(e){return u0&&u0.portaledElement===e};function EX(n,e,i,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==e);l&&(l.node.tabIndex=0)}var PLe=function(e){return e?!!$C:$C==="meanwhile"},OLe=function n(e,i,a){return i&&(i.host===e&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,a))},kLe=function(e,i){return i.some(function(a){return OLe(e,a,a)})},sre=function(e){return GC(e,new Map)},NLe=function(e){return!sre([e.parentNode]).some(function(i){return i.node===e})},rk=function(){var e=!1;if(l0){var i=l0,a=i.observed,l=i.persistentFocus,d=i.autoFocus,f=i.shards,_=i.crossFrame,E=i.focusOptions,b=i.noFocusGuards,w=a||u0&&u0.portaledElement;if(ire()&&Xc&&Xc!==document.body&&(!document.body.contains(Xc)||NLe(Xc))){var I=yX();I&&I.focus()}var k=document&&document.activeElement;if(w){var V=[w].concat(f.map(TLe).filter(Boolean)),L=function(){if(!PLe(_)||!b||!Xc||c5)return!1;var Q=sre(V),ae=Q.findIndex(function(re){var fe=re.node;return fe===Xc});return ae===0||ae===Q.length-1};if((!k||RLe(k))&&(l||L()||!wLe()||!Xc&&d)&&(w&&!(Qne(V)||k&&kLe(k,V)||ALe(k))&&(document&&!Xc&&k&&!d?(k.blur&&k.blur(),document.body.focus()):(e=ere(V,Xc,{focusOptions:E}),u0={})),Xc=document&&document.activeElement,Xc!==document.body&&(yX=tre(Xc)),$C=!1),document&&k!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var F=document&&document.activeElement,B=pLe(V),q=B.map(function($){var Q=$.node;return Q}).indexOf(F);q>-1&&(B.filter(function($){var Q=$.guard,ae=$.node;return Q&&ae.dataset.focusAutoGuard}).forEach(function($){var Q=$.node;return Q.removeAttribute("tabIndex")}),EX(q,B.length,1,B),EX(q,-1,-1,B))}}}return e},ore=function(e){rk()&&e&&(e.stopPropagation(),e.preventDefault())},l5=function(){return a5(rk)},DLe=function(e){var i=e.target,a=e.currentTarget;a.contains(i)||ILe(a,i)},xLe=function(){return null},are=function(){c5=!0},cre=function(){c5=!1,$C="just",a5(function(){$C="meanwhile"})},LLe=function(){document.addEventListener("focusin",ore),document.addEventListener("focusout",l5),window.addEventListener("focus",are),window.addEventListener("blur",cre)},MLe=function(){document.removeEventListener("focusin",ore),document.removeEventListener("focusout",l5),window.removeEventListener("focus",are),window.removeEventListener("blur",cre)};function ULe(n){return n.filter(function(e){var i=e.disabled;return!i})}var lre={moveFocusInside:ere,focusInside:Qne,focusNextElement:ELe,focusPrevElement:vLe,focusFirstElement:SLe,focusLastElement:bLe,captureFocusRestore:tre};function VLe(n){var e=n.slice(-1)[0];e&&!l0&&LLe();var i=l0,a=i&&e&&e.id===i.id;l0=e,i&&!a&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!e)),e?(Xc=null,(!a||i.observed!==e.observed)&&e.onActivation(lre),rk(),a5(rk)):(MLe(),Xc=null)}Fne.assignSyncMedium(DLe);Bne.assignMedium(l5);Nxe.assignMedium(function(n){return n(lre)});const jLe=Fxe(ULe,VLe)(xLe);var BV=D.forwardRef(function(e,i){return _r.createElement(QF,Wy({sideCar:jLe,ref:i},e))}),ure=QF.propTypes||{};ure.sideCar;vxe(ure,["sideCar"]);BV.propTypes={};const FLe=BV.default??BV,dre=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:b}=n,w=D.useCallback(()=>{e!=null&&e.current?e.current.focus():a!=null&&a.current&&FZ(a.current).length===0&&requestAnimationFrame(()=>{var L;(L=a.current)==null||L.focus()})},[e,a]),I=D.useCallback(()=>{var V;(V=i==null?void 0:i.current)==null||V.focus()},[i]),k=l&&!i;return S.jsx(FLe,{crossFrame:b,persistentFocus:E,autoFocus:_,disabled:f,onActivation:w,onDeactivation:I,returnFocus:k,children:d})};dre.displayName="FocusLock";const[BLe,WLe]=Ni({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Vu=Gt((n,e)=>{const i=za("FormError",n),a=Ii(n),l=sE();return l!=null&&l.isInvalid?S.jsx(BLe,{value:i,children:S.jsx(kt.div,{...l==null?void 0:l.getErrorMessageProps(a,e),className:ln("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});Vu.displayName="FormErrorMessage";const zLe=Gt((n,e)=>{const i=WLe(),a=sE();if(!(a!=null&&a.isInvalid))return null;const l=ln("chakra-form__error-icon",n.className);return S.jsx(Dn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});zLe.displayName="FormErrorIcon";const Qn=Gt(function(e,i){const a=cl("FormLabel",e),l=Ii(e),{className:d,children:f,requiredIndicator:_=S.jsx(hre,{}),optionalIndicator:E=null,...b}=l,w=sE(),I=(w==null?void 0:w.getLabelProps(b,i))??{ref:i,...b};return S.jsxs(kt.label,{...I,className:ln("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?_:E]})});Qn.displayName="FormLabel";const hre=Gt(function(e,i){const a=sE(),l=One();if(!(a!=null&&a.isRequired))return null;const d=ln("chakra-form__required-indicator",e.className);return S.jsx(kt.span,{...a==null?void 0:a.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:d})});hre.displayName="RequiredIndicator";const Xk=Gt(function(e,i){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:_,row:E,autoFlow:b,autoRows:w,templateRows:I,autoColumns:k,templateColumns:V,...L}=e,F={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:k,gridColumn:_,gridRow:E,gridAutoFlow:b,gridAutoRows:w,gridTemplateRows:I,gridTemplateColumns:V};return S.jsx(kt.div,{ref:i,__css:F,...L})});Xk.displayName="Grid";function vX(n){return Dk(n,e=>e==="auto"?"auto":`span ${e}/span ${e}`)}const KC=Gt(function(e,i){const{area:a,colSpan:l,colStart:d,colEnd:f,rowEnd:_,rowSpan:E,rowStart:b,...w}=e,I=lR({gridArea:a,gridColumn:vX(l),gridRow:vX(E),gridColumnStart:d,gridColumnEnd:f,gridRowStart:b,gridRowEnd:_});return S.jsx(kt.div,{ref:i,__css:I,...w})});KC.displayName="GridItem";const Hy=Gt(function(e,i){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:_,...E}=e,b=$g(),w=_?HLe(_,b):$Le(a);return S.jsx(Xk,{ref:i,gap:f,columnGap:l,rowGap:d,templateColumns:w,...E})});Hy.displayName="SimpleGrid";function GLe(n){return typeof n=="number"?`${n}px`:n}function HLe(n,e){return Dk(n,i=>{const a=vDe("sizes",i,GLe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function $Le(n){return Dk(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Jf(n){const{viewBox:e="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,d=D.Children.toArray(n.path),f=Gt((_,E)=>S.jsx(Dn,{ref:E,viewBox:e,...l,..._,children:d.length?d:S.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=a,f}const WV=Gt(function(e,i){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=e;return S.jsx("img",{width:a,height:l,ref:i,alt:d,...f})});WV.displayName="NativeImage";const Va=Gt(function(e,i){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:_,fit:E,loading:b,ignoreFallback:w,crossOrigin:I,fallbackStrategy:k="beforeLoadOrError",referrerPolicy:V,...L}=e,F=a!==void 0||l!==void 0,B=b!=null||w||!F,q=Rne({...e,crossOrigin:I,ignoreFallback:B}),$=JDe(q,k),Q={ref:i,objectFit:E,objectPosition:_,...B?L:z0(L,["onError","onLoad"])};return $?l||S.jsx(kt.img,{as:WV,className:"chakra-image__placeholder",src:a,...Q}):S.jsx(kt.img,{as:WV,src:d,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:V,className:"chakra-image",...Q})});Va.displayName="Image";const or=Gt(function(e,i){const{htmlSize:a,...l}=e,d=za("Input",l),f=Ii(l),_=XF(f),E=ln("chakra-input",e.className);return S.jsx(kt.input,{size:a,..._,__css:d.field,ref:i,className:E})});or.displayName="Input";or.id="Input";const[KLe,qLe]=Ni({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),I0=Gt(function(e,i){const a=za("Input",e),{children:l,className:d,...f}=Ii(e),_=ln("chakra-input__group",d),E={},b=Gj(l),w=a.field;b.forEach(k=>{a&&(w&&k.type.id==="InputLeftElement"&&(E.paddingStart=w.height??w.h),w&&k.type.id==="InputRightElement"&&(E.paddingEnd=w.height??w.h),k.type.id==="InputRightAddon"&&(E.borderEndRadius=0),k.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=b.map(k=>{var L,F;const V=lR({size:((L=k.props)==null?void 0:L.size)||e.size,variant:((F=k.props)==null?void 0:F.variant)||e.variant});return k.type.id!=="Input"?D.cloneElement(k,V):D.cloneElement(k,Object.assign(V,E,k.props))});return S.jsx(kt.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:S.jsx(KLe,{value:a,children:I})})});I0.displayName="InputGroup";const YLe=kt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),Jk=Gt(function(e,i){const{placement:a="left",...l}=e,d=qLe(),f=d.field,E={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return S.jsx(YLe,{ref:i,__css:E,...l})});Jk.id="InputElement";Jk.displayName="InputElement";const $y=Gt(function(e,i){const{className:a,...l}=e,d=ln("chakra-input__left-element",a);return S.jsx(Jk,{ref:i,placement:"left",className:d,...l})});$y.id="InputLeftElement";$y.displayName="InputLeftElement";const pre=Gt(function(e,i){const{className:a,...l}=e,d=ln("chakra-input__right-element",a);return S.jsx(Jk,{ref:i,placement:"right",className:d,...l})});pre.id="InputRightElement";pre.displayName="InputRightElement";const ho=Gt(function(e,i){const a=cl("Link",e),{className:l,isExternal:d,...f}=Ii(e);return S.jsx(kt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:ln("chakra-link",l),...f,__css:a})});ho.displayName="Link";function fre(n,e={}){const{ssr:i=!0,fallback:a}=e,{getWindow:l}=wPe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[_,E]=D.useState(()=>d.map((b,w)=>({media:b,matches:i?!!f[w]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();E(d.map(k=>({media:k,matches:b.matchMedia(k).matches})));const w=d.map(k=>b.matchMedia(k)),I=k=>{E(V=>V.slice().map(L=>L.media===k.media?{...L,matches:k.matches}:L))};return w.forEach(k=>{typeof k.addListener=="function"?k.addListener(I):k.addEventListener("change",I)}),()=>{w.forEach(k=>{typeof k.removeListener=="function"?k.removeListener(I):k.removeEventListener("change",I)})}},[l]),_.map(b=>b.matches)}function XLe(n){var _;const e=po(n)?n:{fallback:n??"base"},a=$g().__breakpoints.details.map(({minMaxQuery:E,breakpoint:b})=>({breakpoint:b,query:E.replace("@media screen and ","")})),l=a.map(E=>E.breakpoint===e.fallback),f=fre(a.map(E=>E.query),{fallback:l,ssr:e.ssr}).findIndex(E=>E==!0);return((_=a[f])==null?void 0:_.breakpoint)??e.fallback}function JLe(n,e,i=zZ){let a=Object.keys(n).indexOf(e);if(a!==-1)return n[e];let l=i.indexOf(e);for(;l>=0;){const d=i[l];if(n.hasOwnProperty(d)){a=l;break}l-=1}if(a!==-1){const d=i[a];return n[d]}}function QLe(n,e){var _;const i=po(e)?e:{fallback:"base"},a=XLe(i),l=$g();if(!a)return;const d=Array.from(((_=l.__breakpoints)==null?void 0:_.keys)||[]),f=Array.isArray(n)?Object.fromEntries(Object.entries(lSe(n,d)).map(([E,b])=>[E,b])):n;return JLe(f,a,d)}function ZLe(n,e,i,a){if(e==null)return a;if(!a)return n.find(f=>i(f).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function e2e(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function t2e(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[a,l]=D.useState([]),d=D.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},_=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},e)};D.useEffect(()=>f,[]);function E(b){return w=>{if(w.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(e2e(w)){const I=a.concat(w.key);i(w)&&(w.preventDefault(),w.stopPropagation()),l(I),b(I.join("")),_()}}}return E}var il="top",Hu="bottom",$u="right",sl="left",u5="auto",SR=[il,Hu,$u,sl],A0="start",qC="end",n2e="clippingParents",mre="viewport",ww="popper",r2e="reference",SX=SR.reduce(function(n,e){return n.concat([e+"-"+A0,e+"-"+qC])},[]),gre=[].concat(SR,[u5]).reduce(function(n,e){return n.concat([e,e+"-"+A0,e+"-"+qC])},[]),i2e="beforeRead",s2e="read",o2e="afterRead",a2e="beforeMain",c2e="main",l2e="afterMain",u2e="beforeWrite",d2e="write",h2e="afterWrite",p2e=[i2e,s2e,o2e,a2e,c2e,l2e,u2e,d2e,h2e];function gp(n){return n?(n.nodeName||"").toLowerCase():null}function Hl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Ky(n){var e=Hl(n).Element;return n instanceof e||n instanceof Element}function Wu(n){var e=Hl(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function d5(n){if(typeof ShadowRoot>"u")return!1;var e=Hl(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function f2e(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var a=e.styles[i]||{},l=e.attributes[i]||{},d=e.elements[i];!Wu(d)||!gp(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var _=l[f];_===!1?d.removeAttribute(f):d.setAttribute(f,_===!0?"":_)}))})}function m2e(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(a){var l=e.elements[a],d=e.attributes[a]||{},f=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:i[a]),_=f.reduce(function(E,b){return E[b]="",E},{});!Wu(l)||!gp(l)||(Object.assign(l.style,_),Object.keys(d).forEach(function(E){l.removeAttribute(E)}))})}}const g2e={name:"applyStyles",enabled:!0,phase:"write",fn:f2e,effect:m2e,requires:["computeStyles"]};function lp(n){return n.split("-")[0]}var jy=Math.max,ik=Math.min,P0=Math.round;function zV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function _re(){return!/^((?!chrome|android).)*safari/i.test(zV())}function O0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,d=1;e&&Wu(n)&&(l=n.offsetWidth>0&&P0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&P0(a.height)/n.offsetHeight||1);var f=Ky(n)?Hl(n):window,_=f.visualViewport,E=!_re()&&i,b=(a.left+(E&&_?_.offsetLeft:0))/l,w=(a.top+(E&&_?_.offsetTop:0))/d,I=a.width/l,k=a.height/d;return{width:I,height:k,top:w,right:b+I,bottom:w+k,left:b,x:b,y:w}}function h5(n){var e=O0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function yre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&d5(i)){var a=e;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Gf(n){return Hl(n).getComputedStyle(n)}function _2e(n){return["table","td","th"].indexOf(gp(n))>=0}function Kg(n){return((Ky(n)?n.ownerDocument:n.document)||window.document).documentElement}function Qk(n){return gp(n)==="html"?n:n.assignedSlot||n.parentNode||(d5(n)?n.host:null)||Kg(n)}function bX(n){return!Wu(n)||Gf(n).position==="fixed"?null:n.offsetParent}function y2e(n){var e=/firefox/i.test(zV()),i=/Trident/i.test(zV());if(i&&Wu(n)){var a=Gf(n);if(a.position==="fixed")return null}var l=Qk(n);for(d5(l)&&(l=l.host);Wu(l)&&["html","body"].indexOf(gp(l))<0;){var d=Gf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function bR(n){for(var e=Hl(n),i=bX(n);i&&_2e(i)&&Gf(i).position==="static";)i=bX(i);return i&&(gp(i)==="html"||gp(i)==="body"&&Gf(i).position==="static")?e:i||y2e(n)||e}function p5(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function gC(n,e,i){return jy(n,ik(e,i))}function E2e(n,e,i){var a=gC(n,e,i);return a>i?i:a}function Ere(){return{top:0,right:0,bottom:0,left:0}}function vre(n){return Object.assign({},Ere(),n)}function Sre(n,e){return e.reduce(function(i,a){return i[a]=n,i},{})}var v2e=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,vre(typeof e!="number"?e:Sre(e,SR))};function S2e(n){var e,i=n.state,a=n.name,l=n.options,d=i.elements.arrow,f=i.modifiersData.popperOffsets,_=lp(i.placement),E=p5(_),b=[sl,$u].indexOf(_)>=0,w=b?"height":"width";if(!(!d||!f)){var I=v2e(l.padding,i),k=h5(d),V=E==="y"?il:sl,L=E==="y"?Hu:$u,F=i.rects.reference[w]+i.rects.reference[E]-f[E]-i.rects.popper[w],B=f[E]-i.rects.reference[E],q=bR(d),$=q?E==="y"?q.clientHeight||0:q.clientWidth||0:0,Q=F/2-B/2,ae=I[V],re=$-k[w]-I[L],fe=$/2-k[w]/2+Q,Z=gC(ae,fe,re),ee=E;i.modifiersData[a]=(e={},e[ee]=Z,e.centerOffset=Z-fe,e)}}function b2e(n){var e=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||yre(e.elements.popper,l)&&(e.elements.arrow=l))}const T2e={name:"arrow",enabled:!0,phase:"main",fn:S2e,effect:b2e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function k0(n){return n.split("-")[1]}var w2e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function C2e(n,e){var i=n.x,a=n.y,l=e.devicePixelRatio||1;return{x:P0(i*l)/l||0,y:P0(a*l)/l||0}}function TX(n){var e,i=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,_=n.position,E=n.gpuAcceleration,b=n.adaptive,w=n.roundOffsets,I=n.isFixed,k=f.x,V=k===void 0?0:k,L=f.y,F=L===void 0?0:L,B=typeof w=="function"?w({x:V,y:F}):{x:V,y:F};V=B.x,F=B.y;var q=f.hasOwnProperty("x"),$=f.hasOwnProperty("y"),Q=sl,ae=il,re=window;if(b){var fe=bR(i),Z="clientHeight",ee="clientWidth";if(fe===Hl(i)&&(fe=Kg(i),Gf(fe).position!=="static"&&_==="absolute"&&(Z="scrollHeight",ee="scrollWidth")),fe=fe,l===il||(l===sl||l===$u)&&d===qC){ae=Hu;var ne=I&&fe===re&&re.visualViewport?re.visualViewport.height:fe[Z];F-=ne-a.height,F*=E?1:-1}if(l===sl||(l===il||l===Hu)&&d===qC){Q=$u;var oe=I&&fe===re&&re.visualViewport?re.visualViewport.width:fe[ee];V-=oe-a.width,V*=E?1:-1}}var ge=Object.assign({position:_},b&&w2e),pe=w===!0?C2e({x:V,y:F},Hl(i)):{x:V,y:F};if(V=pe.x,F=pe.y,E){var le;return Object.assign({},ge,(le={},le[ae]=$?"0":"",le[Q]=q?"0":"",le.transform=(re.devicePixelRatio||1)<=1?"translate("+V+"px, "+F+"px)":"translate3d("+V+"px, "+F+"px, 0)",le))}return Object.assign({},ge,(e={},e[ae]=$?F+"px":"",e[Q]=q?V+"px":"",e.transform="",e))}function R2e(n){var e=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,d=i.adaptive,f=d===void 0?!0:d,_=i.roundOffsets,E=_===void 0?!0:_,b={placement:lp(e.placement),variation:k0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,TX(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,TX(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const I2e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:R2e,data:{}};var W1={passive:!0};function A2e(n){var e=n.state,i=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,_=f===void 0?!0:f,E=Hl(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&b.forEach(function(w){w.addEventListener("scroll",i.update,W1)}),_&&E.addEventListener("resize",i.update,W1),function(){d&&b.forEach(function(w){w.removeEventListener("scroll",i.update,W1)}),_&&E.removeEventListener("resize",i.update,W1)}}const P2e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:A2e,data:{}};var O2e={left:"right",right:"left",bottom:"top",top:"bottom"};function CO(n){return n.replace(/left|right|bottom|top/g,function(e){return O2e[e]})}var k2e={start:"end",end:"start"};function wX(n){return n.replace(/start|end/g,function(e){return k2e[e]})}function f5(n){var e=Hl(n),i=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:i,scrollTop:a}}function m5(n){return O0(Kg(n)).left+f5(n).scrollLeft}function N2e(n,e){var i=Hl(n),a=Kg(n),l=i.visualViewport,d=a.clientWidth,f=a.clientHeight,_=0,E=0;if(l){d=l.width,f=l.height;var b=_re();(b||!b&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:d,height:f,x:_+m5(n),y:E}}function D2e(n){var e,i=Kg(n),a=f5(n),l=(e=n.ownerDocument)==null?void 0:e.body,d=jy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=jy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-a.scrollLeft+m5(n),E=-a.scrollTop;return Gf(l||i).direction==="rtl"&&(_+=jy(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:_,y:E}}function g5(n){var e=Gf(n),i=e.overflow,a=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function bre(n){return["html","body","#document"].indexOf(gp(n))>=0?n.ownerDocument.body:Wu(n)&&g5(n)?n:bre(Qk(n))}function _C(n,e){var i;e===void 0&&(e=[]);var a=bre(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),d=Hl(a),f=l?[d].concat(d.visualViewport||[],g5(a)?a:[]):a,_=e.concat(f);return l?_:_.concat(_C(Qk(f)))}function GV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function x2e(n,e){var i=O0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function CX(n,e,i){return e===mre?GV(N2e(n,i)):Ky(e)?x2e(e,i):GV(D2e(Kg(n)))}function L2e(n){var e=_C(Qk(n)),i=["absolute","fixed"].indexOf(Gf(n).position)>=0,a=i&&Wu(n)?bR(n):n;return Ky(a)?e.filter(function(l){return Ky(l)&&yre(l,a)&&gp(l)!=="body"}):[]}function M2e(n,e,i,a){var l=e==="clippingParents"?L2e(n):[].concat(e),d=[].concat(l,[i]),f=d[0],_=d.reduce(function(E,b){var w=CX(n,b,a);return E.top=jy(w.top,E.top),E.right=ik(w.right,E.right),E.bottom=ik(w.bottom,E.bottom),E.left=jy(w.left,E.left),E},CX(n,f,a));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function Tre(n){var e=n.reference,i=n.element,a=n.placement,l=a?lp(a):null,d=a?k0(a):null,f=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case il:E={x:f,y:e.y-i.height};break;case Hu:E={x:f,y:e.y+e.height};break;case $u:E={x:e.x+e.width,y:_};break;case sl:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var b=l?p5(l):null;if(b!=null){var w=b==="y"?"height":"width";switch(d){case A0:E[b]=E[b]-(e[w]/2-i[w]/2);break;case qC:E[b]=E[b]+(e[w]/2-i[w]/2);break}}return E}function YC(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=a===void 0?n.placement:a,d=i.strategy,f=d===void 0?n.strategy:d,_=i.boundary,E=_===void 0?n2e:_,b=i.rootBoundary,w=b===void 0?mre:b,I=i.elementContext,k=I===void 0?ww:I,V=i.altBoundary,L=V===void 0?!1:V,F=i.padding,B=F===void 0?0:F,q=vre(typeof B!="number"?B:Sre(B,SR)),$=k===ww?r2e:ww,Q=n.rects.popper,ae=n.elements[L?$:k],re=M2e(Ky(ae)?ae:ae.contextElement||Kg(n.elements.popper),E,w,f),fe=O0(n.elements.reference),Z=Tre({reference:fe,element:Q,placement:l}),ee=GV(Object.assign({},Q,Z)),ne=k===ww?ee:fe,oe={top:re.top-ne.top+q.top,bottom:ne.bottom-re.bottom+q.bottom,left:re.left-ne.left+q.left,right:ne.right-re.right+q.right},ge=n.modifiersData.offset;if(k===ww&&ge){var pe=ge[l];Object.keys(oe).forEach(function(le){var Me=[$u,Hu].indexOf(le)>=0?1:-1,He=[il,Hu].indexOf(le)>=0?"y":"x";oe[le]+=pe[He]*Me})}return oe}function U2e(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=i.boundary,d=i.rootBoundary,f=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,b=E===void 0?gre:E,w=k0(a),I=w?_?SX:SX.filter(function(L){return k0(L)===w}):SR,k=I.filter(function(L){return b.indexOf(L)>=0});k.length===0&&(k=I);var V=k.reduce(function(L,F){return L[F]=YC(n,{placement:F,boundary:l,rootBoundary:d,padding:f})[lp(F)],L},{});return Object.keys(V).sort(function(L,F){return V[L]-V[F]})}function V2e(n){if(lp(n)===u5)return[];var e=CO(n);return[wX(n),e,wX(e)]}function j2e(n){var e=n.state,i=n.options,a=n.name;if(!e.modifiersData[a]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!0:f,E=i.fallbackPlacements,b=i.padding,w=i.boundary,I=i.rootBoundary,k=i.altBoundary,V=i.flipVariations,L=V===void 0?!0:V,F=i.allowedAutoPlacements,B=e.options.placement,q=lp(B),$=q===B,Q=E||($||!L?[CO(B)]:V2e(B)),ae=[B].concat(Q).reduce(function(we,Ue){return we.concat(lp(Ue)===u5?U2e(e,{placement:Ue,boundary:w,rootBoundary:I,padding:b,flipVariations:L,allowedAutoPlacements:F}):Ue)},[]),re=e.rects.reference,fe=e.rects.popper,Z=new Map,ee=!0,ne=ae[0],oe=0;oe<ae.length;oe++){var ge=ae[oe],pe=lp(ge),le=k0(ge)===A0,Me=[il,Hu].indexOf(pe)>=0,He=Me?"width":"height",tt=YC(e,{placement:ge,boundary:w,rootBoundary:I,altBoundary:k,padding:b}),Ee=Me?le?$u:sl:le?Hu:il;re[He]>fe[He]&&(Ee=CO(Ee));var Ie=CO(Ee),ve=[];if(d&&ve.push(tt[pe]<=0),_&&ve.push(tt[Ee]<=0,tt[Ie]<=0),ve.every(function(we){return we})){ne=ge,ee=!1;break}Z.set(ge,ve)}if(ee)for(var Be=L?3:1,ke=function(Ue){var Fe=ae.find(function($e){var ct=Z.get($e);if(ct)return ct.slice(0,Ue).every(function(it){return it})});if(Fe)return ne=Fe,"break"},Re=Be;Re>0;Re--){var he=ke(Re);if(he==="break")break}e.placement!==ne&&(e.modifiersData[a]._skip=!0,e.placement=ne,e.reset=!0)}}const F2e={name:"flip",enabled:!0,phase:"main",fn:j2e,requiresIfExists:["offset"],data:{_skip:!1}};function RX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function IX(n){return[il,$u,Hu,sl].some(function(e){return n[e]>=0})}function B2e(n){var e=n.state,i=n.name,a=e.rects.reference,l=e.rects.popper,d=e.modifiersData.preventOverflow,f=YC(e,{elementContext:"reference"}),_=YC(e,{altBoundary:!0}),E=RX(f,a),b=RX(_,l,d),w=IX(E),I=IX(b);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:b,isReferenceHidden:w,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":I})}const W2e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:B2e};function z2e(n,e,i){var a=lp(n),l=[sl,il].indexOf(a)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,f=d[0],_=d[1];return f=f||0,_=(_||0)*l,[sl,$u].indexOf(a)>=0?{x:_,y:f}:{x:f,y:_}}function G2e(n){var e=n.state,i=n.options,a=n.name,l=i.offset,d=l===void 0?[0,0]:l,f=gre.reduce(function(w,I){return w[I]=z2e(I,e.rects,d),w},{}),_=f[e.placement],E=_.x,b=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=b),e.modifiersData[a]=f}const H2e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:G2e};function $2e(n){var e=n.state,i=n.name;e.modifiersData[i]=Tre({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const K2e={name:"popperOffsets",enabled:!0,phase:"read",fn:$2e,data:{}};function q2e(n){return n==="x"?"y":"x"}function Y2e(n){var e=n.state,i=n.options,a=n.name,l=i.mainAxis,d=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!1:f,E=i.boundary,b=i.rootBoundary,w=i.altBoundary,I=i.padding,k=i.tether,V=k===void 0?!0:k,L=i.tetherOffset,F=L===void 0?0:L,B=YC(e,{boundary:E,rootBoundary:b,padding:I,altBoundary:w}),q=lp(e.placement),$=k0(e.placement),Q=!$,ae=p5(q),re=q2e(ae),fe=e.modifiersData.popperOffsets,Z=e.rects.reference,ee=e.rects.popper,ne=typeof F=="function"?F(Object.assign({},e.rects,{placement:e.placement})):F,oe=typeof ne=="number"?{mainAxis:ne,altAxis:ne}:Object.assign({mainAxis:0,altAxis:0},ne),ge=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,pe={x:0,y:0};if(fe){if(d){var le,Me=ae==="y"?il:sl,He=ae==="y"?Hu:$u,tt=ae==="y"?"height":"width",Ee=fe[ae],Ie=Ee+B[Me],ve=Ee-B[He],Be=V?-ee[tt]/2:0,ke=$===A0?Z[tt]:ee[tt],Re=$===A0?-ee[tt]:-Z[tt],he=e.elements.arrow,we=V&&he?h5(he):{width:0,height:0},Ue=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ere(),Fe=Ue[Me],$e=Ue[He],ct=gC(0,Z[tt],we[tt]),it=Q?Z[tt]/2-Be-ct-Fe-oe.mainAxis:ke-ct-Fe-oe.mainAxis,Ct=Q?-Z[tt]/2+Be+ct+$e+oe.mainAxis:Re+ct+$e+oe.mainAxis,Vt=e.elements.arrow&&bR(e.elements.arrow),Dt=Vt?ae==="y"?Vt.clientTop||0:Vt.clientLeft||0:0,an=(le=ge==null?void 0:ge[ae])!=null?le:0,jn=Ee+it-an-Dt,Qt=Ee+Ct-an,Ot=gC(V?ik(Ie,jn):Ie,Ee,V?jy(ve,Qt):ve);fe[ae]=Ot,pe[ae]=Ot-Ee}if(_){var Lt,Ce=ae==="x"?il:sl,Ve=ae==="x"?Hu:$u,Ye=fe[re],_t=re==="y"?"height":"width",vt=Ye+B[Ce],St=Ye-B[Ve],Ht=[il,sl].indexOf(q)!==-1,fn=(Lt=ge==null?void 0:ge[re])!=null?Lt:0,mn=Ht?vt:Ye-Z[_t]-ee[_t]-fn+oe.altAxis,Jt=Ht?Ye+Z[_t]+ee[_t]-fn-oe.altAxis:St,Hn=V&&Ht?E2e(mn,Ye,Jt):gC(V?mn:vt,Ye,V?Jt:St);fe[re]=Hn,pe[re]=Hn-Ye}e.modifiersData[a]=pe}}const X2e={name:"preventOverflow",enabled:!0,phase:"main",fn:Y2e,requiresIfExists:["offset"]};function J2e(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function Q2e(n){return n===Hl(n)||!Wu(n)?f5(n):J2e(n)}function Z2e(n){var e=n.getBoundingClientRect(),i=P0(e.width)/n.offsetWidth||1,a=P0(e.height)/n.offsetHeight||1;return i!==1||a!==1}function eMe(n,e,i){i===void 0&&(i=!1);var a=Wu(e),l=Wu(e)&&Z2e(e),d=Kg(e),f=O0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(a||!a&&!i)&&((gp(e)!=="body"||g5(d))&&(_=Q2e(e)),Wu(e)?(E=O0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):d&&(E.x=m5(d))),{x:f.left+_.scrollLeft-E.x,y:f.top+_.scrollTop-E.y,width:f.width,height:f.height}}function tMe(n){var e=new Map,i=new Set,a=[];n.forEach(function(d){e.set(d.name,d)});function l(d){i.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),a.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),a}function nMe(n){var e=tMe(n);return p2e.reduce(function(i,a){return i.concat(e.filter(function(l){return l.phase===a}))},[])}function rMe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function iMe(n){var e=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(e).map(function(i){return e[i]})}var AX={placement:"bottom",modifiers:[],strategy:"absolute"};function PX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function sMe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,a=i===void 0?[]:i,l=e.defaultOptions,d=l===void 0?AX:l;return function(_,E,b){b===void 0&&(b=d);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},AX,d),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],k=!1,V={state:w,setOptions:function(q){var $=typeof q=="function"?q(w.options):q;F(),w.options=Object.assign({},d,w.options,$),w.scrollParents={reference:Ky(_)?_C(_):_.contextElement?_C(_.contextElement):[],popper:_C(E)};var Q=nMe(iMe([].concat(a,w.options.modifiers)));return w.orderedModifiers=Q.filter(function(ae){return ae.enabled}),L(),V.update()},forceUpdate:function(){if(!k){var q=w.elements,$=q.reference,Q=q.popper;if(PX($,Q)){w.rects={reference:eMe($,bR(Q),w.options.strategy==="fixed"),popper:h5(Q)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(oe){return w.modifiersData[oe.name]=Object.assign({},oe.data)});for(var ae=0;ae<w.orderedModifiers.length;ae++){if(w.reset===!0){w.reset=!1,ae=-1;continue}var re=w.orderedModifiers[ae],fe=re.fn,Z=re.options,ee=Z===void 0?{}:Z,ne=re.name;typeof fe=="function"&&(w=fe({state:w,options:ee,name:ne,instance:V})||w)}}}},update:rMe(function(){return new Promise(function(B){V.forceUpdate(),B(w)})}),destroy:function(){F(),k=!0}};if(!PX(_,E))return V;V.setOptions(b).then(function(B){!k&&b.onFirstUpdate&&b.onFirstUpdate(B)});function L(){w.orderedModifiers.forEach(function(B){var q=B.name,$=B.options,Q=$===void 0?{}:$,ae=B.effect;if(typeof ae=="function"){var re=ae({state:w,name:q,instance:V,options:Q}),fe=function(){};I.push(re||fe)}})}function F(){I.forEach(function(B){return B()}),I=[]}return V}}var oMe=[P2e,K2e,I2e,g2e,H2e,F2e,X2e,T2e,W2e],aMe=sMe({defaultModifiers:oMe});const OS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),Xs={arrowShadowColor:OS("--popper-arrow-shadow-color"),arrowSize:OS("--popper-arrow-size","8px"),arrowSizeHalf:OS("--popper-arrow-size-half"),arrowBg:OS("--popper-arrow-bg"),transformOrigin:OS("--popper-transform-origin"),arrowOffset:OS("--popper-arrow-offset")};function cMe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const lMe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},uMe=n=>lMe[n],OX={scroll:!0,resize:!0};function dMe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...OX,...n}}:e={enabled:n,options:OX},e}const hMe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},pMe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{kX(n)},effect:({state:n})=>()=>{kX(n)}},kX=n=>{n.elements.popper.style.setProperty(Xs.transformOrigin.var,uMe(n.placement))},fMe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{mMe(n)}},mMe=n=>{var i;if(!n.placement)return;const e=gMe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:Xs.arrowSize.varRef,height:Xs.arrowSize.varRef,zIndex:-1});const a={[Xs.arrowSizeHalf.var]:`calc(${Xs.arrowSize.varRef} / 2 - 1px)`,[Xs.arrowOffset.var]:`calc(${Xs.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},gMe=n=>{if(n.startsWith("top"))return{property:"bottom",value:Xs.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Xs.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Xs.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Xs.arrowOffset.varRef}},_Me={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{NX(n)},effect:({state:n})=>()=>{NX(n)}},NX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=cMe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:Xs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},yMe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},EMe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function vMe(n,e="ltr"){var a;const i=((a=yMe[n])==null?void 0:a[e])||n;return e==="ltr"?i:EMe[n]??i}function _5(n={}){const{enabled:e=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:_,gutter:E=8,flip:b=!0,boundary:w="clippingParents",preventOverflow:I=!0,matchWidth:k,direction:V="ltr"}=n,L=D.useRef(null),F=D.useRef(null),B=D.useRef(null),q=vMe(a,V),$=D.useRef(()=>{}),Q=D.useCallback(()=>{var oe;!e||!L.current||!F.current||((oe=$.current)==null||oe.call($),B.current=aMe(L.current,F.current,{placement:q,modifiers:[_Me,fMe,pMe,{...hMe,enabled:!!k},{name:"eventListeners",...dMe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:w}},...i??[]],strategy:l}),B.current.forceUpdate(),$.current=B.current.destroy)},[q,e,i,k,f,d,_,E,b,I,w,l]);D.useEffect(()=>()=>{var oe;!L.current&&!F.current&&((oe=B.current)==null||oe.destroy(),B.current=null)},[]);const ae=D.useCallback(oe=>{L.current=oe,Q()},[Q]),re=D.useCallback((oe={},ge=null)=>({...oe,ref:Ki(ae,ge)}),[ae]),fe=D.useCallback(oe=>{F.current=oe,Q()},[Q]),Z=D.useCallback((oe={},ge=null)=>({...oe,ref:Ki(fe,ge),style:{...oe.style,position:l,minWidth:k?void 0:"max-content",inset:"0 auto auto 0"}}),[l,fe,k]),ee=D.useCallback((oe={},ge=null)=>{const{size:pe,shadowColor:le,bg:Me,style:He,...tt}=oe;return{...tt,ref:ge,"data-popper-arrow":"",style:SMe(oe)}},[]),ne=D.useCallback((oe={},ge=null)=>({...oe,ref:ge,"data-popper-arrow-inner":""}),[]);return{update(){var oe;(oe=B.current)==null||oe.update()},forceUpdate(){var oe;(oe=B.current)==null||oe.forceUpdate()},transformOrigin:Xs.transformOrigin.varRef,referenceRef:ae,popperRef:fe,getPopperProps:Z,getArrowProps:ee,getArrowInnerProps:ne,getReferenceProps:re}}function SMe(n){const{size:e,shadowColor:i,bg:a,style:l}=n,d={...l,position:"absolute"};return e&&(d["--popper-arrow-size"]=e),i&&(d["--popper-arrow-shadow-color"]=i),a&&(d["--popper-arrow-bg"]=a),d}function bMe(){const n=D.useRef(new Map),e=n.current,i=D.useCallback((l,d,f,_)=>{n.current.set(f,{type:d,el:l,options:_}),l.addEventListener(d,f,_)},[]),a=D.useCallback((l,d,f,_)=>{l.removeEventListener(d,f,_),n.current.delete(f)},[]);return D.useEffect(()=>()=>{e.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,e]),{add:i,remove:a}}function mU(n){var l,d;const e=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:a}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function wre(n={}){const{ref:e,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:_,onClick:E,onKeyDown:b,onKeyUp:w,tabIndex:I,onMouseOver:k,onMouseLeave:V,...L}=n,[F,B]=D.useState(!0),[q,$]=D.useState(!1),Q=bMe(),ae=Ee=>{Ee&&Ee.tagName!=="BUTTON"&&B(!1)},re=F?I:I||0,fe=i&&!a,Z=D.useCallback(Ee=>{if(i){Ee.stopPropagation(),Ee.preventDefault();return}Ee.currentTarget.focus(),E==null||E(Ee)},[i,E]),ee=D.useCallback(Ee=>{q&&mU(Ee)&&(Ee.preventDefault(),Ee.stopPropagation(),$(!1),Q.remove(document,"keyup",ee,!1))},[q,Q]),ne=D.useCallback(Ee=>{if(b==null||b(Ee),i||Ee.defaultPrevented||Ee.metaKey||!mU(Ee.nativeEvent)||F)return;const Ie=l&&Ee.key==="Enter";d&&Ee.key===" "&&(Ee.preventDefault(),$(!0)),Ie&&(Ee.preventDefault(),Ee.currentTarget.click()),Q.add(document,"keyup",ee,!1)},[i,F,b,l,d,Q,ee]),oe=D.useCallback(Ee=>{if(w==null||w(Ee),i||Ee.defaultPrevented||Ee.metaKey||!mU(Ee.nativeEvent)||F)return;d&&Ee.key===" "&&(Ee.preventDefault(),$(!1),Ee.currentTarget.click())},[d,F,i,w]),ge=D.useCallback(Ee=>{Ee.button===0&&($(!1),Q.remove(document,"mouseup",ge,!1))},[Q]),pe=D.useCallback(Ee=>{if(Ee.button!==0)return;if(i){Ee.stopPropagation(),Ee.preventDefault();return}F||$(!0),Ee.currentTarget.focus({preventScroll:!0}),Q.add(document,"mouseup",ge,!1),f==null||f(Ee)},[i,F,f,Q,ge]),le=D.useCallback(Ee=>{Ee.button===0&&(F||$(!1),_==null||_(Ee))},[_,F]),Me=D.useCallback(Ee=>{if(i){Ee.preventDefault();return}k==null||k(Ee)},[i,k]),He=D.useCallback(Ee=>{q&&(Ee.preventDefault(),$(!1)),V==null||V(Ee)},[q,V]),tt=Ki(e,ae);return F?{...L,ref:tt,type:"button","aria-disabled":fe?void 0:i,disabled:fe,onClick:Z,onMouseDown:f,onMouseUp:_,onKeyUp:w,onKeyDown:b,onMouseOver:k,onMouseLeave:V}:{...L,ref:tt,role:"button","data-active":pn(q),"aria-disabled":i?"true":void 0,tabIndex:fe?void 0:re,onClick:Z,onMouseDown:pe,onMouseUp:le,onKeyUp:oe,onKeyDown:ne,onMouseOver:Me,onMouseLeave:He}}const[TMe,wMe,CMe,RMe]=bne(),[IMe,TR]=Ni({strict:!1,name:"MenuContext"});function Cre(n){return(n==null?void 0:n.ownerDocument)??document}function AMe(n){return Cre(n).activeElement===n}function PMe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:_,defaultIsOpen:E,onClose:b,onOpen:w,placement:I="bottom-start",lazyBehavior:k="unmount",direction:V,computePositionOnMount:L=!1,...F}=n,B=D.useRef(null),q=D.useRef(null),$=D.useRef(!0),Q=CMe(),ae=D.useCallback(()=>{requestAnimationFrame(()=>{var he;(he=B.current)==null||he.focus({preventScroll:!1})})},[]),re=D.useCallback(()=>{const he=setTimeout(()=>{var we,Ue;if(l)(we=l.current)==null||we.focus();else if(!Q.count())(Ue=B.current)==null||Ue.focus({preventScroll:!1});else{const Fe=Q.firstEnabled();Fe&&Me(Fe.index)}});ve.current.add(he)},[Q,l]),fe=D.useCallback(()=>{const he=setTimeout(()=>{var we;if(!Q.count())(we=B.current)==null||we.focus({preventScroll:!1});else{const Ue=Q.lastEnabled();Ue&&Me(Ue.index)}});ve.current.add(he)},[Q]),Z=D.useCallback(()=>{w==null||w(),d?re():ae()},[d,re,ae,w]),{isOpen:ee,onOpen:ne,onClose:oe,onToggle:ge}=qd({isOpen:_,defaultIsOpen:E,onClose:b,onOpen:Z});JZ({enabled:ee&&a,ref:B,handler:he=>{var Ue,Fe,$e;const we=((Fe=(Ue=he.composedPath)==null?void 0:Ue.call(he))==null?void 0:Fe[0])??he.target;($e=q.current)!=null&&$e.contains(we)||oe()}});const pe=_5({...F,enabled:ee||L,placement:I,direction:V}),[le,Me]=D.useState(-1);qZ(B,{focusRef:q,visible:ee,shouldFocus:!0});const He=$Z({isOpen:ee,ref:B}),[tt,Ee]=NSe(e,"menu-button","menu-list"),Ie=D.useCallback(()=>{ne(),ae()},[ne,ae]),ve=D.useRef(new Set([]));D.useEffect(()=>{const he=ve.current;return()=>{he.forEach(we=>clearTimeout(we)),he.clear()}},[]),Ng(()=>{var he;ee||(Me(-1),(he=B.current)==null||he.scrollTo(0,0))},[ee]),Ng(()=>{ee&&le===-1&&ae()},[le,ee]),D.useEffect(()=>{var we;if(!ee)return;const he=Q.item(le);(we=he==null?void 0:he.node)==null||we.focus({preventScroll:!$.current})},[Q,le,ee]);const Be=D.useCallback(()=>{ne(),re()},[re,ne]),ke=D.useCallback(()=>{$.current=!0,ne(),fe()},[ne,fe]),Re=D.useCallback(()=>{var $e,ct;const he=Cre(B.current),we=($e=B.current)==null?void 0:$e.contains(he.activeElement);if(!(ee&&!we))return;const Fe=(ct=Q.item(le))==null?void 0:ct.node;Fe==null||Fe.focus({preventScroll:!$.current})},[ee,le,Q]);return{openAndFocusMenu:Ie,openAndFocusFirstItem:Be,openAndFocusLastItem:ke,onTransitionEnd:Re,unstable__animationState:He,descendants:Q,popper:pe,buttonId:tt,menuId:Ee,forceUpdate:pe.forceUpdate,orientation:"vertical",isOpen:ee,onToggle:ge,onOpen:ne,onClose:oe,menuRef:B,buttonRef:q,focusedIndex:le,closeOnSelect:i,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:f,lazyBehavior:k,initialFocusRef:l,scrollIntoViewRef:$}}function OMe(n={},e=null){const i=TR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:_}=i,E=D.useCallback(b=>{const w=b.key,k={Enter:d,ArrowDown:d,ArrowUp:f}[w];k&&(_.current=!0,b.preventDefault(),b.stopPropagation(),k(b))},[d,f,_]);return{...n,ref:Ki(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":pn(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Rn(n.onClick,a),onKeyDown:Rn(n.onKeyDown,E)}}function HV(n){var e;return xMe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function kMe(n={},e=null){const i=TR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:_,menuId:E,isLazy:b,lazyBehavior:w,scrollIntoViewRef:I,unstable__animationState:k}=i,V=wMe(),L=t2e({preventDefault:$=>$.key!==" "&&HV($.target)}),F=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const Q=$.key,re={Tab:Z=>Z.preventDefault(),Escape:Z=>{Z.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const Z=V.nextEnabled(a)??V.firstEnabled();Z&&l(Z.index)},ArrowUp:()=>{I.current=!0;const Z=V.prevEnabled(a)??V.firstEnabled();Z&&l(Z.index)}}[Q];if(re){$.preventDefault(),re($);return}const fe=L(Z=>{const ee=ZLe(V.values(),Z,ne=>{var oe;return((oe=ne==null?void 0:ne.node)==null?void 0:oe.textContent)??""},V.item(a));if(ee){const ne=V.indexOf(ee.node);l(ne)}});HV($.target)&&fe($)},[V,a,L,_,l,I]),B=D.useRef(!1);f&&(B.current=!0);const q=Hj({wasSelected:B.current,enabled:b,mode:w,isSelected:k.present});return{...n,ref:Ki(d,e),children:q?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Rn(n.onKeyDown,F)}}function NMe(n={}){const{popper:e,isOpen:i}=TR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function DMe(n={},e=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:_,isFocusable:E,closeOnSelect:b,type:w,...I}=n,k=TR(),{setFocusedIndex:V,focusedIndex:L,closeOnSelect:F,onClose:B,menuId:q,scrollIntoViewRef:$}=k,Q=D.useRef(null),ae=`${q}-menuitem-${D.useId()}`,{index:re,register:fe}=RMe({disabled:_&&!E}),Z=D.useCallback(Me=>{i==null||i(Me),!_&&($.current=!1,V(re))},[V,re,_,i,$]),ee=D.useCallback(Me=>{a==null||a(Me),Q.current&&!AMe(Q.current)&&Z(Me)},[Z,a]),ne=D.useCallback(Me=>{l==null||l(Me),!_&&V(-1)},[V,_,l]),oe=D.useCallback(Me=>{d==null||d(Me),HV(Me.currentTarget)&&(b??F)&&B()},[B,d,F,b]),ge=D.useCallback(Me=>{f==null||f(Me),V(re)},[V,f,re]),pe=re===L,le=wre({onClick:oe,onFocus:ge,onMouseEnter:Z,onMouseMove:ee,onMouseLeave:ne,ref:Ki(fe,Q,e),isDisabled:_,isFocusable:E});return{...I,...le,type:w??le.type,id:ae,role:"menuitem",tabIndex:pe?0:-1}}function xMe(n){if(!LMe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function LMe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[MMe,K0]=Ni({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),Zk=n=>{const{children:e}=n,i=za("Menu",n),a=Ii(n),{direction:l}=$g(),{descendants:d,...f}=PMe({...a,direction:l}),_=D.useMemo(()=>f,[f]),{isOpen:E,onClose:b,forceUpdate:w}=_;return S.jsx(TMe,{value:d,children:S.jsx(IMe,{value:_,children:S.jsx(MMe,{value:i,children:tl(e,{isOpen:E,onClose:b,forceUpdate:w})})})})};Zk.displayName="Menu";const UMe=Gt((n,e)=>{const i=K0();return S.jsx(kt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),eN=Gt((n,e)=>{const{children:i,as:a,...l}=n,d=OMe(l,e),f=a||UMe;return S.jsx(f,{...d,className:ln("chakra-menu__menu-button",n.className),children:S.jsx(kt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});eN.displayName="MenuButton";const Rre=Gt((n,e)=>{const i=K0();return S.jsx(kt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});Rre.displayName="MenuCommand";const Ire=n=>{const{className:e,...i}=n,a=K0();return S.jsx(kt.hr,{"aria-orientation":"horizontal",className:ln("chakra-menu__divider",e),...i,__css:a.divider})};Ire.displayName="MenuDivider";const Are=n=>{const{className:e,children:i,...a}=n,l=K0(),d=D.Children.only(i),f=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:ln("chakra-menu__icon",d.props.className)}):null,_=ln("chakra-menu__icon-wrapper",e);return S.jsx(kt.span,{className:_,...a,__css:l.icon,children:f})};Are.displayName="MenuIcon";const VMe=Gt((n,e)=>{const{type:i,...a}=n,l=K0(),d=a.as||i?i??void 0:"button",f=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return S.jsx(kt.button,{ref:e,type:d,...a,__css:f})}),bg=Gt((n,e)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,..._}=n,E=DMe(_,e),w=i||l?S.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return S.jsxs(VMe,{...E,className:ln("chakra-menu__menuitem",E.className),children:[i&&S.jsx(Are,{fontSize:"0.8em",marginEnd:a,children:i}),w,l&&S.jsx(Rre,{marginStart:d,children:l})]})});bg.displayName="MenuItem";const jMe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},FMe=kt(vp.div),tN=Gt(function(e,i){var k;const{rootProps:a,motionProps:l,...d}=e,{isOpen:f,onTransitionEnd:_,unstable__animationState:E}=TR(),b=kMe(d,i),w=NMe(a),I=K0();return S.jsx(kt.div,{...w,__css:{zIndex:e.zIndex??((k=I.list)==null?void 0:k.zIndex)},children:S.jsx(FMe,{variants:jMe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:ln("chakra-menu__menu-list",b.className),onUpdate:_,onAnimationComplete:zj(E.onComplete,b.onAnimationComplete)})})});tN.displayName="MenuList";var BMe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},kS=new WeakMap,z1=new WeakMap,G1={},gU=0,Pre=function(n){return n&&(n.host||Pre(n.parentNode))},WMe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var a=Pre(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},zMe=function(n,e,i,a){var l=WMe(e,Array.isArray(n)?n:[n]);G1[i]||(G1[i]=new WeakMap);var d=G1[i],f=[],_=new Set,E=new Set(l),b=function(I){!I||_.has(I)||(_.add(I),b(I.parentNode))};l.forEach(b);var w=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(k){if(_.has(k))w(k);else try{var V=k.getAttribute(a),L=V!==null&&V!=="false",F=(kS.get(k)||0)+1,B=(d.get(k)||0)+1;kS.set(k,F),d.set(k,B),f.push(k),F===1&&L&&z1.set(k,!0),B===1&&k.setAttribute(i,"true"),L||k.setAttribute(a,"true")}catch(q){console.error("aria-hidden: cannot operate on ",k,q)}})};return w(e),_.clear(),gU++,function(){f.forEach(function(I){var k=kS.get(I)-1,V=d.get(I)-1;kS.set(I,k),d.set(I,V),k||(z1.has(I)||I.removeAttribute(a),z1.delete(I)),V||I.removeAttribute(i)}),gU--,gU||(kS=new WeakMap,kS=new WeakMap,z1=new WeakMap,G1={})}},GMe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=BMe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),zMe(a,l,i,"aria-hidden")):function(){return null}},HMe=Object.defineProperty,$Me=(n,e,i)=>e in n?HMe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,KMe=(n,e,i)=>($Me(n,e+"",i),i);class qMe{constructor(){KMe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const $V=new qMe;function Ore(n,e){const[i,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(e){const d=$V.add(l);a(d)}return()=>{$V.remove(l),a(0)}}},[e,n]),i}function YMe(n){const{isOpen:e,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:_,onEsc:E}=n,b=D.useRef(null),w=D.useRef(null),[I,k,V]=JMe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");XMe(b,e&&f);const L=Ore(b,e),F=D.useRef(null),B=D.useCallback(ne=>{F.current=ne.target},[]),q=D.useCallback(ne=>{ne.key==="Escape"&&(ne.stopPropagation(),d&&(i==null||i()),E==null||E())},[d,i,E]),[$,Q]=D.useState(!1),[ae,re]=D.useState(!1),fe=D.useCallback((ne={},oe=null)=>({role:"dialog",...ne,ref:Ki(oe,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?k:void 0,"aria-describedby":ae?V:void 0,onClick:Rn(ne.onClick,ge=>ge.stopPropagation())}),[V,ae,I,k,$]),Z=D.useCallback(ne=>{ne.stopPropagation(),F.current===ne.target&&$V.isTopModal(b.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),ee=D.useCallback((ne={},oe=null)=>({...ne,ref:Ki(oe,w),onClick:Rn(ne.onClick,Z),onKeyDown:Rn(ne.onKeyDown,q),onMouseDown:Rn(ne.onMouseDown,B)}),[q,B,Z]);return{isOpen:e,onClose:i,headerId:k,bodyId:V,setBodyMounted:re,setHeaderMounted:Q,dialogRef:b,overlayRef:w,getDialogProps:fe,getDialogContainerProps:ee,index:L}}function XMe(n,e){const i=n.current;D.useEffect(()=>{if(!(!n.current||!e))return GMe(n.current)},[e,n,i])}function JMe(n,...e){const i=D.useId(),a=n||i;return D.useMemo(()=>e.map(l=>`${l}-${a}`),[a,e])}const[QMe,q0]=Ni({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[ZMe,qy]=Ni({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Ga=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:V,animatePresenceProps:L,onCloseComplete:F}=e,B=za("Modal",e),$={...YMe(e),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:V};return S.jsx(ZMe,{value:$,children:S.jsx(QMe,{value:B,children:S.jsx(rE,{...L,onExitComplete:F,children:$.isOpen&&S.jsx(Kl,{...i,children:a})})})})};Ga.displayName="Modal";var RO="right-scroll-bar-position",IO="width-before-scroll-bar",eUe="with-scroll-bars-hidden",tUe="--removed-body-scroll-bar-size",kre=Vne(),_U=function(){},nN=D.forwardRef(function(n,e){var i=D.useRef(null),a=D.useState({onScrollCapture:_U,onWheelCapture:_U,onTouchMoveCapture:_U}),l=a[0],d=a[1],f=n.forwardProps,_=n.children,E=n.className,b=n.removeScrollBar,w=n.enabled,I=n.shards,k=n.sideCar,V=n.noIsolation,L=n.inert,F=n.allowPinchZoom,B=n.as,q=B===void 0?"div":B,$=n.gapMode,Q=vR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ae=k,re=Lne([i,e]),fe=tp(tp({},Q),l);return D.createElement(D.Fragment,null,w&&D.createElement(ae,{sideCar:kre,removeScrollBar:b,shards:I,noIsolation:V,inert:L,setCallbacks:d,allowPinchZoom:!!F,lockRef:i,gapMode:$}),f?D.cloneElement(D.Children.only(_),tp(tp({},fe),{ref:re})):D.createElement(q,tp({},fe,{className:E,ref:re}),_))});nN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nN.classNames={fullWidth:IO,zeroRight:RO};var nUe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function rUe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=nUe();return e&&n.setAttribute("nonce",e),n}function iUe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function sUe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var oUe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=rUe())&&(iUe(e,i),sUe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},aUe=function(){var n=oUe();return function(e,i){D.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},Nre=function(){var n=aUe(),e=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return e},cUe={left:0,top:0,right:0,gap:0},yU=function(n){return parseInt(n||"",10)||0},lUe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],a=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[yU(i),yU(a),yU(l)]},uUe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return cUe;var e=lUe(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,a-i+e[2]-e[0])}},dUe=Nre(),d0="data-scroll-locked",hUe=function(n,e,i,a){var l=n.left,d=n.top,f=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(eUe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(_,"px ").concat(a,`;
  }
  body[`).concat(d0,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(RO,` {
    right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(IO,` {
    margin-right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(RO," .").concat(RO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(IO," .").concat(IO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(d0,`] {
    `).concat(tUe,": ").concat(_,`px;
  }
`)},DX=function(){var n=parseInt(document.body.getAttribute(d0)||"0",10);return isFinite(n)?n:0},pUe=function(){D.useEffect(function(){return document.body.setAttribute(d0,(DX()+1).toString()),function(){var n=DX()-1;n<=0?document.body.removeAttribute(d0):document.body.setAttribute(d0,n.toString())}},[])},fUe=function(n){var e=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;pUe();var d=D.useMemo(function(){return uUe(l)},[l]);return D.createElement(dUe,{styles:hUe(d,!e,l,i?"":"!important")})},KV=!1;if(typeof window<"u")try{var H1=Object.defineProperty({},"passive",{get:function(){return KV=!0,!0}});window.addEventListener("test",H1,H1),window.removeEventListener("test",H1,H1)}catch{KV=!1}var NS=KV?{passive:!1}:!1,mUe=function(n){return n.tagName==="TEXTAREA"},Dre=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!mUe(n)&&i[e]==="visible")},gUe=function(n){return Dre(n,"overflowY")},_Ue=function(n){return Dre(n,"overflowX")},xX=function(n,e){var i=e.ownerDocument,a=e;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=xre(n,a);if(l){var d=Lre(n,a),f=d[1],_=d[2];if(f>_)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},yUe=function(n){var e=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[e,i,a]},EUe=function(n){var e=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[e,i,a]},xre=function(n,e){return n==="v"?gUe(e):_Ue(e)},Lre=function(n,e){return n==="v"?yUe(e):EUe(e)},vUe=function(n,e){return n==="h"&&e==="rtl"?-1:1},SUe=function(n,e,i,a,l){var d=vUe(n,window.getComputedStyle(e).direction),f=d*a,_=i.target,E=e.contains(_),b=!1,w=f>0,I=0,k=0;do{var V=Lre(n,_),L=V[0],F=V[1],B=V[2],q=F-B-d*L;(L||q)&&xre(n,_)&&(I+=q,k+=L),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(w&&Math.abs(I)<1||!w&&Math.abs(k)<1)&&(b=!0),b},$1=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},LX=function(n){return[n.deltaX,n.deltaY]},MX=function(n){return n&&"current"in n?n.current:n},bUe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},TUe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},wUe=0,DS=[];function CUe(n){var e=D.useRef([]),i=D.useRef([0,0]),a=D.useRef(),l=D.useState(wUe++)[0],d=D.useState(Nre)[0],f=D.useRef(n);D.useEffect(function(){f.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var F=Oxe([n.lockRef.current],(n.shards||[]).map(MX),!0).filter(Boolean);return F.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),F.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=D.useCallback(function(F,B){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!f.current.allowPinchZoom;var q=$1(F),$=i.current,Q="deltaX"in F?F.deltaX:$[0]-q[0],ae="deltaY"in F?F.deltaY:$[1]-q[1],re,fe=F.target,Z=Math.abs(Q)>Math.abs(ae)?"h":"v";if("touches"in F&&Z==="h"&&fe.type==="range")return!1;var ee=xX(Z,fe);if(!ee)return!0;if(ee?re=Z:(re=Z==="v"?"h":"v",ee=xX(Z,fe)),!ee)return!1;if(!a.current&&"changedTouches"in F&&(Q||ae)&&(a.current=re),!re)return!0;var ne=a.current||re;return SUe(ne,B,F,ne==="h"?Q:ae)},[]),E=D.useCallback(function(F){var B=F;if(!(!DS.length||DS[DS.length-1]!==d)){var q="deltaY"in B?LX(B):$1(B),$=e.current.filter(function(re){return re.name===B.type&&(re.target===B.target||B.target===re.shadowParent)&&bUe(re.delta,q)})[0];if($&&$.should){B.cancelable&&B.preventDefault();return}if(!$){var Q=(f.current.shards||[]).map(MX).filter(Boolean).filter(function(re){return re.contains(B.target)}),ae=Q.length>0?_(B,Q[0]):!f.current.noIsolation;ae&&B.cancelable&&B.preventDefault()}}},[]),b=D.useCallback(function(F,B,q,$){var Q={name:F,delta:B,target:q,should:$,shadowParent:RUe(q)};e.current.push(Q),setTimeout(function(){e.current=e.current.filter(function(ae){return ae!==Q})},1)},[]),w=D.useCallback(function(F){i.current=$1(F),a.current=void 0},[]),I=D.useCallback(function(F){b(F.type,LX(F),F.target,_(F,n.lockRef.current))},[]),k=D.useCallback(function(F){b(F.type,$1(F),F.target,_(F,n.lockRef.current))},[]);D.useEffect(function(){return DS.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:k}),document.addEventListener("wheel",E,NS),document.addEventListener("touchmove",E,NS),document.addEventListener("touchstart",w,NS),function(){DS=DS.filter(function(F){return F!==d}),document.removeEventListener("wheel",E,NS),document.removeEventListener("touchmove",E,NS),document.removeEventListener("touchstart",w,NS)}},[]);var V=n.removeScrollBar,L=n.inert;return D.createElement(D.Fragment,null,L?D.createElement(d,{styles:TUe(l)}):null,V?D.createElement(fUe,{gapMode:n.gapMode}):null)}function RUe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const IUe=kxe(kre,CUe);var Mre=D.forwardRef(function(n,e){return D.createElement(nN,tp({},n,{ref:e,sideCar:IUe}))});Mre.classNames=nN.classNames;function AUe(n){const{autoFocus:e,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:b,lockFocusAcrossFrames:w,isOpen:I}=qy(),[k,V]=pF();D.useEffect(()=>{!k&&V&&setTimeout(V)},[k,V]);const L=Ore(a,I);return S.jsx(dre,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:a,lockFocusAcrossFrames:w,children:S.jsx(Mre,{removeScrollBar:!b,allowPinchZoom:f,enabled:L===1&&d,forwardProps:!0,children:n.children})})}const PUe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??jf.exit(Uy.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??jf.enter(Uy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:a,reverse:l,delay:d})=>{const f={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??jf.exit(Uy.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Qw={initial:"initial",animate:"enter",exit:"exit",variants:PUe},OUe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:_=0,offsetY:E=8,transition:b,transitionEnd:w,delay:I,animatePresenceProps:k,...V}=e,L=a?l&&a:!0,F=l||a?"enter":"exit",B={offsetX:_,offsetY:E,reverse:d,transition:b,transitionEnd:w,delay:I};return S.jsx(rE,{...k,custom:B,children:L&&S.jsx(vp.div,{ref:i,className:ln("chakra-offset-slide",f),custom:B,...Qw,animate:F,...V})})});OUe.displayName="SlideFade";const kUe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:e,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??jf.exit(Uy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??jf.enter(Uy.enter,i),transitionEnd:n==null?void 0:n.enter})},Ure={initial:"exit",animate:"enter",exit:"exit",variants:kUe},NUe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:_,transition:E,transitionEnd:b,delay:w,animatePresenceProps:I,...k}=e,V=a?l&&a:!0,L=l||a?"enter":"exit",F={initialScale:f,reverse:d,transition:E,transitionEnd:b,delay:w};return S.jsx(rE,{...I,custom:F,children:V&&S.jsx(vp.div,{ref:i,className:ln("chakra-offset-slide",_),...Ure,animate:L,custom:F,...k})})});NUe.displayName="ScaleFade";const DUe={slideInBottom:{...Qw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Qw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Qw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Qw,custom:{offsetX:-16,reverse:!0}},scale:{...Ure,custom:{initialScale:.95,reverse:!0}},none:{}},xUe=kt(vp.section),LUe=n=>DUe[n||"none"],Vre=D.forwardRef((n,e)=>{const{preset:i,motionProps:a=LUe(i),...l}=n;return S.jsx(xUe,{ref:e,...a,...l})});Vre.displayName="ModalTransition";const Ha=Gt((n,e)=>{const{className:i,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:_,getDialogContainerProps:E}=qy(),b=_(f,e),w=E(l),I=ln("chakra-modal__content",i),k=q0(),V={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...k.dialog},L={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...k.dialogContainer},{motionPreset:F}=qy();return S.jsx(AUe,{children:S.jsx(kt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:L,children:S.jsx(Vre,{preset:F,motionProps:d,className:I,...b,__css:V,children:a})})})});Ha.displayName="ModalContent";const Fa=Gt((n,e)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:d}=qy();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=ln("chakra-modal__body",i),_=q0();return S.jsx(kt.div,{ref:e,className:f,id:l,...a,__css:_.body})});Fa.displayName="ModalBody";const fc=Gt((n,e)=>{const{onClick:i,className:a,...l}=n,{onClose:d}=qy(),f=ln("chakra-modal__close-btn",a),_=q0();return S.jsx(KF,{ref:e,__css:_.closeButton,className:f,onClick:Rn(i,E=>{E.stopPropagation(),d()}),...l})});fc.displayName="ModalCloseButton";const Yy=Gt((n,e)=>{const{className:i,...a}=n,l=ln("chakra-modal__footer",i),d=q0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return S.jsx(kt.footer,{ref:e,...a,__css:f,className:l})});Yy.displayName="ModalFooter";const $l=Gt((n,e)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:d}=qy();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=ln("chakra-modal__header",i),_=q0(),E={flex:0,..._.header};return S.jsx(kt.header,{ref:e,className:f,id:l,...a,__css:E})});$l.displayName="ModalHeader";const MUe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??jf.enter(Uy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??jf.exit(Uy.exit,i),transitionEnd:e==null?void 0:e.exit})},jre={initial:"exit",animate:"enter",exit:"exit",variants:MUe},UUe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:_,delay:E,animatePresenceProps:b,...w}=e,I=l||a?"enter":"exit",k=a?l&&a:!0,V={transition:f,transitionEnd:_,delay:E};return S.jsx(rE,{...b,custom:V,children:k&&S.jsx(vp.div,{ref:i,className:ln("chakra-fade",d),custom:V,...jre,animate:I,...w})})});UUe.displayName="Fade";const VUe=kt(vp.div),Ba=Gt((n,e)=>{const{className:i,transition:a,motionProps:l,...d}=n,f=ln("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...q0().overlay},{motionPreset:b}=qy(),I=l||(b==="none"?{}:jre);return S.jsx(VUe,{...I,__css:E,ref:e,className:f,...d})});Ba.displayName="ModalOverlay";function jUe(n){const{leastDestructiveRef:e,...i}=n;return S.jsx(Ga,{...i,initialFocusRef:e})}const FUe=Gt((n,e)=>S.jsx(Ha,{ref:e,role:"alertdialog",...n})),[BUe,rN]=Ni({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[WUe,Fre]=Ni({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),xS={click:"click",hover:"hover"};function zUe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:_,arrowShadowColor:E,trigger:b=xS.click,openDelay:w=200,closeDelay:I=200,isLazy:k,lazyBehavior:V="unmount",computePositionOnMount:L,...F}=n,{isOpen:B,onClose:q,onOpen:$,onToggle:Q}=qd(n),[ae,re]=D.useState(d);D.useEffect(()=>re(d),[d]);const fe=D.useRef(null),Z=D.useRef(null),ee=D.useRef(null),ne=D.useRef(!1),oe=D.useRef(!1);B&&(oe.current=!0);const[ge,pe]=D.useState(!1),[le,Me]=D.useState(!1),He=D.useId(),tt=l??He,[Ee,Ie,ve,Be]=["popover-trigger","popover-content","popover-header","popover-body"].map(Lt=>`${Lt}-${tt}`),{referenceRef:ke,getArrowProps:Re,getPopperProps:he,getArrowInnerProps:we,forceUpdate:Ue}=_5({...F,enabled:B||!!L}),Fe=$Z({isOpen:B,ref:ee});OSe({enabled:B,ref:Z}),qZ(ee,{focusRef:Z,visible:B,shouldFocus:ae&&b===xS.click}),bSe(ee,{focusRef:a,visible:B,shouldFocus:f&&b===xS.click}),JZ({enabled:B&&e,ref:ee,handler(Lt){var Ve;const Ce=((Ve=Lt.composedPath)==null?void 0:Ve.call(Lt)[0])??[Lt.target];K1(Z.current,Ce)||(Ce&&re(!HO(Ce)),q())}});const $e=Hj({wasSelected:oe.current,enabled:k,mode:V,isSelected:Fe.present}),ct=D.useCallback((Lt={},Ce=null)=>{const Ve={...Lt,style:{...Lt.style,transformOrigin:Xs.transformOrigin.varRef,[Xs.arrowSize.var]:_?`${_}px`:void 0,[Xs.arrowShadowColor.var]:E},ref:Ki(ee,Ce),children:$e?Lt.children:null,id:Ie,tabIndex:-1,role:"dialog",onKeyDown:Rn(Lt.onKeyDown,Ye=>{Ye.nativeEvent.isComposing||i&&Ye.key==="Escape"&&(Ye.preventDefault(),Ye.stopPropagation(),q())}),onBlur:Rn(Lt.onBlur,Ye=>{const _t=UX(Ye),vt=K1(ee.current,_t),St=K1(Z.current,_t),Ht=!vt&&!St;_t&&re(!HO(_t)),B&&e&&Ht&&q()}),"aria-labelledby":ge?ve:void 0,"aria-describedby":le?Be:void 0};return b===xS.hover&&(Ve.role="tooltip",Ve.onMouseEnter=Rn(Lt.onMouseEnter,()=>{ne.current=!0}),Ve.onMouseLeave=Rn(Lt.onMouseLeave,Ye=>{Ye.nativeEvent.relatedTarget!==null&&(ne.current=!1,setTimeout(()=>q(),I))})),Ve},[$e,Ie,ge,ve,le,Be,b,i,q,B,e,I,E,_]),it=D.useCallback((Lt={},Ce=null)=>he({...Lt,style:{visibility:B?"visible":"hidden",...Lt.style}},Ce),[B,he]),Ct=D.useCallback((Lt,Ce=null)=>({...Lt,ref:Ki(Ce,fe,ke)}),[fe,ke]),Vt=D.useRef(void 0),Dt=D.useRef(void 0),an=D.useCallback(Lt=>{fe.current==null&&ke(Lt)},[ke]),jn=D.useCallback((Lt={},Ce=null)=>{const Ve={...Lt,ref:Ki(Z,Ce,an),id:Ee,"aria-haspopup":"dialog","aria-expanded":B,"aria-controls":Ie};return b===xS.click&&(Ve.onClick=Rn(Lt.onClick,Q)),b===xS.hover&&(Ve.onFocus=Rn(Lt.onFocus,()=>{Vt.current===void 0&&$()}),Ve.onBlur=Rn(Lt.onBlur,Ye=>{const _t=UX(Ye),vt=!K1(ee.current,_t);B&&e&&vt&&q()}),Ve.onKeyDown=Rn(Lt.onKeyDown,Ye=>{Ye.key==="Escape"&&q()}),Ve.onMouseEnter=Rn(Lt.onMouseEnter,()=>{ne.current=!0,Vt.current=window.setTimeout(()=>$(),w)}),Ve.onMouseLeave=Rn(Lt.onMouseLeave,()=>{ne.current=!1,Vt.current&&(clearTimeout(Vt.current),Vt.current=void 0),Dt.current=window.setTimeout(()=>{ne.current===!1&&q()},I)})),Ve},[Ee,B,Ie,b,an,Q,$,e,q,w,I]);D.useEffect(()=>()=>{Vt.current&&clearTimeout(Vt.current),Dt.current&&clearTimeout(Dt.current)},[]);const Qt=D.useCallback((Lt={},Ce=null)=>({...Lt,id:ve,ref:Ki(Ce,Ve=>{pe(!!Ve)})}),[ve]),Ot=D.useCallback((Lt={},Ce=null)=>({...Lt,id:Be,ref:Ki(Ce,Ve=>{Me(!!Ve)})}),[Be]);return{forceUpdate:Ue,isOpen:B,onAnimationComplete:Fe.onComplete,onClose:q,getAnchorProps:Ct,getArrowProps:Re,getArrowInnerProps:we,getPopoverPositionerProps:it,getPopoverProps:ct,getTriggerProps:jn,getHeaderProps:Qt,getBodyProps:Ot}}function K1(n,e){return n===e||(n==null?void 0:n.contains(e))}function UX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Bre(n){const e=za("Popover",n),{children:i,...a}=Ii(n),l=$g(),d=zUe({...a,direction:l.direction});return S.jsx(BUe,{value:d,children:S.jsx(WUe,{value:e,children:tl(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Bre.displayName="Popover";function Wre(n){var i;const e=D.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const zre=Gt(function(e,i){const{getBodyProps:a}=rN(),l=Fre();return S.jsx(kt.div,{...a(e,i),className:ln("chakra-popover__body",e.className),__css:l.body})});zre.displayName="PopoverBody";function GUe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const HUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},$Ue=kt(vp.section),Gre=Gt(function(e,i){const{variants:a=HUe,...l}=e,{isOpen:d}=rN();return S.jsx($Ue,{ref:i,variants:GUe(a),initial:!1,animate:d?"enter":"exit",...l})});Gre.displayName="PopoverTransition";const Hre=Gt(function(e,i){const{rootProps:a,motionProps:l,...d}=e,{getPopoverProps:f,getPopoverPositionerProps:_,onAnimationComplete:E}=rN(),b=Fre(),w={position:"relative",display:"flex",flexDirection:"column",...b.content};return S.jsx(kt.div,{..._(a),__css:b.popper,className:"chakra-popover__popper",children:S.jsx(Gre,{...l,...f(d,i),onAnimationComplete:zj(E,d.onAnimationComplete),className:ln("chakra-popover__content",e.className),__css:w})})});Hre.displayName="PopoverContent";function $re(n){const e=D.Children.only(n.children),{getTriggerProps:i}=rN();return S.jsx(S.Fragment,{children:D.cloneElement(e,i(e.props,Wre(e)))})}$re.displayName="PopoverTrigger";function KUe(n,e,i){return(n-e)*100/(i-e)}pR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});pR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const qUe=pR({"0%":{left:"-40%"},"100%":{left:"100%"}}),YUe=pR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function XUe(n){const{value:e=0,min:i,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:_="progressbar"}=n,E=KUe(e,i,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":f?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof d=="function"?d(e,E):l})(),role:_},percent:E,value:e}}const[JUe,QUe]=Ni({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),ZUe=Gt((n,e)=>{const{min:i,max:a,value:l,isIndeterminate:d,role:f,..._}=n,E=XUe({value:l,min:i,max:a,isIndeterminate:d,role:f}),w={height:"100%",...QUe().filledTrack};return S.jsx(kt.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:w})}),N0=Gt((n,e)=>{var Z;const{value:i,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:_,borderRadius:E,isIndeterminate:b,"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,title:V,role:L,...F}=Ii(n),B=za("Progress",n),q=E??((Z=B.track)==null?void 0:Z.borderRadius),$={animation:`${YUe} 1s linear infinite`},re={...!b&&d&&f&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${qUe} 1s ease infinite normal none running`}},fe={overflow:"hidden",position:"relative",...B.track};return S.jsx(kt.div,{ref:e,borderRadius:q,__css:fe,...F,children:S.jsxs(JUe,{value:B,children:[S.jsx(ZUe,{"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,min:a,max:l,value:i,isIndeterminate:b,css:re,borderRadius:q,title:V,role:L}),_]})})});N0.displayName="Progress";function eVe(n){return n&&po(n)&&po(n.target)}function tVe(n={}){const{onChange:e,value:i,defaultValue:a,name:l,isDisabled:d,isFocusable:f,isNative:_,...E}=n,[b,w]=D.useState(a||""),I=typeof i<"u",k=I?i:b,V=D.useRef(null),L=D.useCallback(()=>{const re=V.current;if(!re)return;let fe="input:not(:disabled):checked";const Z=re.querySelector(fe);if(Z){Z.focus();return}fe="input:not(:disabled)";const ee=re.querySelector(fe);ee==null||ee.focus()},[]),B=`radio-${D.useId()}`,q=l||B,$=D.useCallback(re=>{const fe=eVe(re)?re.target.value:re;I||w(fe),e==null||e(String(fe))},[e,I]),Q=D.useCallback((re={},fe=null)=>({...re,ref:Ki(fe,V),role:"radiogroup"}),[]),ae=D.useCallback((re={},fe=null)=>({...re,ref:fe,name:q,[_?"checked":"isChecked"]:k!=null?re.value===k:void 0,onChange(ee){$(ee)},"data-radiogroup":!0}),[_,q,$,k]);return{getRootProps:Q,getRadioProps:ae,name:q,ref:V,focus:L,setValue:w,value:k,onChange:$,isDisabled:d,isFocusable:f,htmlProps:E}}const[nVe,Kre]=Ni({name:"RadioGroupContext",strict:!1}),qre=Gt((n,e)=>{const{colorScheme:i,size:a,variant:l,children:d,className:f,isDisabled:_,isFocusable:E,...b}=n,{value:w,onChange:I,getRootProps:k,name:V,htmlProps:L}=tVe(b),F=D.useMemo(()=>({name:V,size:a,onChange:I,colorScheme:i,value:w,variant:l,isDisabled:_,isFocusable:E}),[V,a,I,i,w,l,_,E]);return S.jsx(nVe,{value:F,children:S.jsx(kt.div,{...k(L,e),className:ln("chakra-radio-group",f),children:d})})});qre.displayName="RadioGroup";function rVe(n={}){const{defaultChecked:e,isChecked:i,isFocusable:a,isDisabled:l,isReadOnly:d,isRequired:f,onChange:_,isInvalid:E,name:b,value:w,id:I,"data-radiogroup":k,"aria-describedby":V,...L}=n,F=`radio-${D.useId()}`,B=sE(),$=!!Kre()||!!k;let ae=!!B&&!$?B.id:F;ae=I??ae;const re=l??(B==null?void 0:B.isDisabled),fe=d??(B==null?void 0:B.isReadOnly),Z=f??(B==null?void 0:B.isRequired),ee=E??(B==null?void 0:B.isInvalid),[ne,oe]=D.useState(!1),[ge,pe]=D.useState(!1),[le,Me]=D.useState(!1),[He,tt]=D.useState(!1),[Ee,Ie]=D.useState(!!e),ve=typeof i<"u",Be=ve?i:Ee;D.useEffect(()=>Pne(oe),[]);const ke=D.useCallback(Vt=>{if(fe||re){Vt.preventDefault();return}ve||Ie(Vt.currentTarget.checked),_==null||_(Vt)},[ve,re,fe,_]),Re=D.useCallback(Vt=>{Vt.key===" "&&tt(!0)},[tt]),he=D.useCallback(Vt=>{Vt.key===" "&&tt(!1)},[tt]),we=D.useCallback((Vt={},Dt=null)=>({...Vt,ref:Dt,"data-active":pn(He),"data-hover":pn(le),"data-disabled":pn(re),"data-invalid":pn(ee),"data-checked":pn(Be),"data-focus":pn(ge),"data-focus-visible":pn(ge&&ne),"data-readonly":pn(fe),"aria-hidden":!0,onMouseDown:Rn(Vt.onMouseDown,()=>tt(!0)),onMouseUp:Rn(Vt.onMouseUp,()=>tt(!1)),onMouseEnter:Rn(Vt.onMouseEnter,()=>Me(!0)),onMouseLeave:Rn(Vt.onMouseLeave,()=>Me(!1))}),[He,le,re,ee,Be,ge,fe,ne]),{onFocus:Ue,onBlur:Fe}=B??{},$e=D.useCallback((Vt={},Dt=null)=>{const an=re&&!a;return{...Vt,id:ae,ref:Dt,type:"radio",name:b,value:w,onChange:Rn(Vt.onChange,ke),onBlur:Rn(Fe,Vt.onBlur,()=>pe(!1)),onFocus:Rn(Ue,Vt.onFocus,()=>pe(!0)),onKeyDown:Rn(Vt.onKeyDown,Re),onKeyUp:Rn(Vt.onKeyUp,he),checked:Be,disabled:an,readOnly:fe,required:Z,"aria-invalid":xf(ee),"aria-disabled":xf(an),"aria-required":xf(Z),"data-readonly":pn(fe),"aria-describedby":V,style:Nne}},[re,a,ae,b,w,ke,Fe,Ue,Re,he,Be,fe,Z,ee,V]);return{state:{isInvalid:ee,isFocused:ge,isChecked:Be,isActive:He,isHovered:le,isDisabled:re,isReadOnly:fe,isRequired:Z},getRadioProps:we,getInputProps:$e,getLabelProps:(Vt={},Dt=null)=>({...Vt,ref:Dt,onMouseDown:Rn(Vt.onMouseDown,iVe),"data-disabled":pn(re),"data-checked":pn(Be),"data-invalid":pn(ee)}),getRootProps:(Vt,Dt=null)=>({htmlFor:ae,...Vt,ref:Dt,"data-disabled":pn(re),"data-checked":pn(Be),"data-invalid":pn(ee)}),htmlProps:L}}function iVe(n){n.preventDefault(),n.stopPropagation()}const qV=Gt((n,e)=>{const i=Kre(),{onChange:a,value:l}=n,d=za("Radio",{...i,...n}),f=Ii(n),{spacing:_="0.5rem",children:E,isDisabled:b=i==null?void 0:i.isDisabled,isFocusable:w=i==null?void 0:i.isFocusable,inputProps:I,...k}=f;let V=n.isChecked;(i==null?void 0:i.value)!=null&&l!=null&&(V=i.value===l);let L=a;i!=null&&i.onChange&&l!=null&&(L=zj(i.onChange,a));const F=(n==null?void 0:n.name)??(i==null?void 0:i.name),{getInputProps:B,getRadioProps:q,getLabelProps:$,getRootProps:Q,htmlProps:ae}=rVe({...k,isChecked:V,isFocusable:w,isDisabled:b,onChange:L,name:F}),[re,fe]=HZ(ae,oee),Z=q(fe),ee=B(I,e),ne=$(),oe=Object.assign({},re,Q()),ge={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...d.container},pe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...d.control},le={userSelect:"none",marginStart:_,...d.label};return S.jsxs(kt.label,{className:"chakra-radio",...oe,__css:ge,children:[S.jsx("input",{className:"chakra-radio__input",...ee}),S.jsx(kt.span,{className:"chakra-radio__control",...Z,__css:pe}),E&&S.jsx(kt.span,{className:"chakra-radio__label",...ne,__css:le,children:E})]})});qV.displayName="Radio";const Yre=Gt(function(e,i){const{children:a,placeholder:l,className:d,...f}=e;return S.jsxs(kt.select,{...f,ref:i,className:ln("chakra-select",d),children:[l&&S.jsx("option",{value:"",children:l}),a]})});Yre.displayName="SelectField";const Xre=Gt((n,e)=>{var Q;const i=za("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:_,h:E,minH:b,minHeight:w,iconColor:I,iconSize:k,...V}=Ii(n),[L,F]=HZ(V,oee),B=XF(F),q={width:"100%",height:"fit-content",position:"relative",color:f},$={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(Q=i.field)==null?void 0:Q._focus}};return S.jsxs(kt.div,{className:"chakra-select__wrapper",__css:q,...L,...a,children:[S.jsx(Yre,{ref:e,height:E??_,minH:b??w,placeholder:l,...B,__css:$,children:n.children}),S.jsx(Jre,{"data-disabled":pn(B.disabled),...(I||f)&&{color:I||f},__css:i.icon,...k&&{fontSize:k},children:d})]})});Xre.displayName="Select";const sVe=n=>S.jsx("svg",{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),oVe=kt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Jre=n=>{const{children:e=S.jsx(sVe,{}),...i}=n,a=D.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return S.jsx(oVe,{...i,className:"chakra-select__icon-wrapper",children:D.isValidElement(e)?a:null})};Jre.displayName="SelectIcon";function EU(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function aVe(n){const{orientation:e,thumbPercents:i,isReversed:a}=n,l=V=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...EU({orientation:e,vertical:{bottom:`calc(${i[V]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[V]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...EU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,a?100-i[0]:i[0]],b=_?E:i;let w=b[0];!_&&a&&(w=100-w);const I=Math.abs(b[b.length-1]-b[0]),k={...f,...EU({orientation:e,vertical:a?{height:`${I}%`,top:`${w}%`}:{height:`${I}%`,bottom:`${w}%`},horizontal:a?{width:`${I}%`,right:`${w}%`}:{width:`${I}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:k,rootStyle:d,getThumbStyle:l}}function cVe(n){const{isReversed:e,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?e:!e}function lVe(n){const{min:e=0,max:i=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:_="ltr",orientation:E="horizontal",id:b,isDisabled:w,isReadOnly:I,onChangeStart:k,onChangeEnd:V,step:L=1,getAriaValueText:F,"aria-valuetext":B,"aria-label":q,"aria-labelledby":$,name:Q,focusThumbOnChange:ae=!0,...re}=n,fe=rl(k),Z=rl(V),ee=rl(F),ne=cVe({isReversed:f,direction:_,orientation:E}),[oe,ge]=KZ({value:l,defaultValue:d??dVe(e,i),onChange:a}),[pe,le]=D.useState(!1),[Me,He]=D.useState(!1),tt=!(w||I),Ee=(i-e)/10,Ie=L||(i-e)/100,ve=vM(oe,e,i),Be=i-ve+e,Re=GK(ne?Be:ve,e,i),he=E==="vertical",we=XZ({min:e,max:i,step:L,isDisabled:w,value:ve,isInteractive:tt,isReversed:ne,isVertical:he,eventSource:null,focusThumbOnChange:ae,orientation:E}),Ue=D.useRef(null),Fe=D.useRef(null),$e=D.useRef(null),ct=D.useId(),it=b??ct,[Ct,Vt]=[`slider-thumb-${it}`,`slider-track-${it}`],Dt=D.useCallback(Bt=>{var yo;if(!Ue.current)return;const un=we.current;un.eventSource="pointer";const rs=Ue.current.getBoundingClientRect(),{clientX:Fs,clientY:Qs}=((yo=Bt.touches)==null?void 0:yo[0])??Bt,Ei=he?rs.bottom-Qs:Fs-rs.left,$a=he?rs.height:rs.width;let dl=Ei/$a;ne&&(dl=1-dl);let _o=cSe(dl,un.min,un.max);return un.step&&(_o=parseFloat(HK(_o,un.min,un.step))),_o=vM(_o,un.min,un.max),_o},[he,ne,we]),an=D.useCallback(Bt=>{const un=we.current;un.isInteractive&&(Bt=parseFloat(HK(Bt,un.min,Ie)),Bt=vM(Bt,un.min,un.max),ge(Bt))},[Ie,ge,we]),jn=D.useMemo(()=>({stepUp(Bt=Ie){const un=ne?ve-Bt:ve+Bt;an(un)},stepDown(Bt=Ie){const un=ne?ve+Bt:ve-Bt;an(un)},reset(){an(d||0)},stepTo(Bt){an(Bt)}}),[an,ne,ve,Ie,d]),Qt=D.useCallback(Bt=>{const un=we.current,Fs={ArrowRight:()=>jn.stepUp(),ArrowUp:()=>jn.stepUp(),ArrowLeft:()=>jn.stepDown(),ArrowDown:()=>jn.stepDown(),PageUp:()=>jn.stepUp(Ee),PageDown:()=>jn.stepDown(Ee),Home:()=>an(un.min),End:()=>an(un.max)}[Bt.key];Fs&&(Bt.preventDefault(),Bt.stopPropagation(),Fs(Bt),un.eventSource="keyboard")},[jn,an,Ee,we]),Ot=(ee==null?void 0:ee(ve))??B,{getThumbStyle:Lt,rootStyle:Ce,trackStyle:Ve,innerTrackStyle:Ye}=D.useMemo(()=>{const Bt=we.current;return aVe({isReversed:ne,orientation:Bt.orientation,thumbPercents:[Re]})},[ne,Re,we]),_t=D.useCallback(()=>{we.current.focusThumbOnChange&&setTimeout(()=>{var un;return(un=Fe.current)==null?void 0:un.focus()})},[we]);Ng(()=>{const Bt=we.current;_t(),Bt.eventSource==="keyboard"&&(Z==null||Z(Bt.value))},[ve,Z]);function vt(Bt){const un=Dt(Bt);un!=null&&un!==we.current.value&&ge(un)}XSe($e,{onPanSessionStart(Bt){const un=we.current;un.isInteractive&&(le(!0),_t(),vt(Bt),fe==null||fe(un.value))},onPanSessionEnd(){const Bt=we.current;Bt.isInteractive&&(le(!1),Z==null||Z(Bt.value))},onPan(Bt){we.current.isInteractive&&vt(Bt)}});const St=D.useCallback((Bt={},un=null)=>({...Bt,...re,ref:Ki(un,$e),tabIndex:-1,"aria-disabled":xf(w),"data-focused":pn(Me),style:{...Bt.style,...Ce}}),[re,w,Me,Ce]),Ht=D.useCallback((Bt={},un=null)=>({...Bt,ref:Ki(un,Ue),id:Vt,"data-disabled":pn(w),style:{...Bt.style,...Ve}}),[w,Vt,Ve]),fn=D.useCallback((Bt={},un=null)=>({...Bt,ref:un,style:{...Bt.style,...Ye}}),[Ye]),mn=D.useCallback((Bt={},un=null)=>({...Bt,ref:Ki(un,Fe),role:"slider",tabIndex:tt?0:void 0,id:Ct,"data-active":pn(pe),"aria-valuetext":Ot,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":ve,"aria-orientation":E,"aria-disabled":xf(w),"aria-readonly":xf(I),"aria-label":q,"aria-labelledby":q?void 0:$,style:{...Bt.style,...Lt(0)},onKeyDown:Rn(Bt.onKeyDown,Qt),onFocus:Rn(Bt.onFocus,()=>He(!0)),onBlur:Rn(Bt.onBlur,()=>He(!1))}),[tt,Ct,pe,Ot,e,i,ve,E,w,I,q,$,Lt,Qt]),Jt=D.useCallback((Bt,un=null)=>{const rs=!(Bt.value<e||Bt.value>i),Fs=ve>=Bt.value,Qs=GK(Bt.value,e,i),Ei={position:"absolute",pointerEvents:"none",...uVe({orientation:E,vertical:{bottom:ne?`${100-Qs}%`:`${Qs}%`},horizontal:{left:ne?`${100-Qs}%`:`${Qs}%`}})};return{...Bt,ref:un,role:"presentation","aria-hidden":!0,"data-disabled":pn(w),"data-invalid":pn(!rs),"data-highlighted":pn(Fs),style:{...Bt.style,...Ei}}},[w,ne,i,e,E,ve]),Hn=D.useCallback((Bt={},un=null)=>({...Bt,ref:un,type:"hidden",value:ve,name:Q}),[Q,ve]);return{state:{value:ve,isFocused:Me,isDragging:pe},actions:jn,getRootProps:St,getTrackProps:Ht,getInnerTrackProps:fn,getThumbProps:mn,getMarkerProps:Jt,getInputProps:Hn}}function uVe(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function dVe(n,e){return e<n?n:n+(e-n)/2}const[hVe,iN]=Ni({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[pVe,sN]=Ni({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),YV=Gt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=za("Slider",i),l=Ii(i),{direction:d}=$g();l.direction=d;const{getInputProps:f,getRootProps:_,...E}=lVe(l),b=_(),w=f({},e);return S.jsx(hVe,{value:E,children:S.jsx(pVe,{value:a,children:S.jsxs(kt.div,{...b,className:ln("chakra-slider",i.className),__css:a.container,children:[i.children,S.jsx("input",{...w})]})})})});YV.displayName="Slider";const XV=Gt((n,e)=>{const{getThumbProps:i}=iN(),a=sN(),l=i(n,e);return S.jsx(kt.div,{...l,className:ln("chakra-slider__thumb",n.className),__css:a.thumb})});XV.displayName="SliderThumb";const JV=Gt((n,e)=>{const{getTrackProps:i}=iN(),a=sN(),l=i(n,e);return S.jsx(kt.div,{...l,className:ln("chakra-slider__track",n.className),__css:a.track})});JV.displayName="SliderTrack";const QV=Gt((n,e)=>{const{getInnerTrackProps:i}=iN(),a=sN(),l=i(n,e);return S.jsx(kt.div,{...l,className:ln("chakra-slider__filled-track",n.className),__css:a.filledTrack})});QV.displayName="SliderFilledTrack";const fVe=Gt((n,e)=>{const{getMarkerProps:i}=iN(),a=sN(),l=i(n,e);return S.jsx(kt.div,{...l,className:ln("chakra-slider__marker",n.className),__css:a.mark})});fVe.displayName="SliderMark";const sk=kt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});sk.displayName="Spacer";const Qre=n=>S.jsx(kt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Qre.displayName="StackItem";function mVe(n){const{spacing:e,direction:i}=n,a={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":Dk(i,l=>a[l])}}const nl=Gt((n,e)=>{const{isInline:i,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:_,children:E,divider:b,className:w,shouldWrapChildren:I,...k}=n,V=i?"row":a??"column",L=D.useMemo(()=>mVe({spacing:f,direction:V}),[f,V]),F=!!b,B=!I&&!F,q=D.useMemo(()=>{const Q=Gj(E);return B?Q:Q.map((ae,re)=>{const fe=typeof ae.key<"u"?ae.key:re,Z=re+1===Q.length,ne=I?S.jsx(Qre,{children:ae},fe):ae;if(!F)return ne;const oe=D.cloneElement(b,{__css:L}),ge=Z?null:oe;return S.jsxs(D.Fragment,{children:[ne,ge]},fe)})},[b,L,F,B,I,E]),$=ln("chakra-stack",w);return S.jsx(kt.div,{ref:e,display:"flex",alignItems:l,justifyContent:d,flexDirection:V,flexWrap:_,gap:F?void 0:f,className:$,...k,children:q})});nl.displayName="Stack";const ni=Gt((n,e)=>S.jsx(nl,{align:"center",...n,direction:"row",ref:e}));ni.displayName="HStack";const mr=Gt((n,e)=>S.jsx(nl,{align:"center",...n,direction:"column",ref:e}));mr.displayName="VStack";const Cg=Gt(function(e,i){const a=za("Switch",e),{spacing:l="0.5rem",children:d,...f}=Ii(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:b,getRootProps:w,getLabelProps:I}=fxe(f),k=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),V=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),L=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return S.jsxs(kt.label,{...w(),className:ln("chakra-switch",e.className),__css:k,children:[S.jsx("input",{className:"chakra-switch__input",...E({},i)}),S.jsx(kt.span,{...b(),className:"chakra-switch__track",__css:V,children:S.jsx(kt.span,{__css:a.thumb,className:"chakra-switch__thumb",..._()})}),d&&S.jsx(kt.span,{className:"chakra-switch__label",...I(),__css:L,children:d})]})});Cg.displayName="Switch";const[gVe,_Ve,yVe,EVe]=bne();function vVe(n){const{defaultIndex:e,onChange:i,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:_="horizontal",direction:E="ltr",...b}=n,[w,I]=D.useState(e??0),[k,V]=KZ({defaultValue:e??0,value:a,onChange:i});D.useEffect(()=>{a!=null&&I(a)},[a]);const L=yVe(),F=D.useId();return{id:`tabs-${n.id??F}`,selectedIndex:k,focusedIndex:w,setSelectedIndex:V,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:_,descendants:L,direction:E,htmlProps:b}}const[SVe,oN]=Ni({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function bVe(n){const{focusedIndex:e,orientation:i,direction:a}=oN(),l=_Ve(),d=D.useCallback(f=>{const _=()=>{var Q;const $=l.nextEnabled(e);$&&((Q=$.node)==null||Q.focus())},E=()=>{var Q;const $=l.prevEnabled(e);$&&((Q=$.node)==null||Q.focus())},b=()=>{var Q;const $=l.firstEnabled();$&&((Q=$.node)==null||Q.focus())},w=()=>{var Q;const $=l.lastEnabled();$&&((Q=$.node)==null||Q.focus())},I=i==="horizontal",k=i==="vertical",V=f.key,L=a==="ltr"?"ArrowLeft":"ArrowRight",F=a==="ltr"?"ArrowRight":"ArrowLeft",q={[L]:()=>I&&E(),[F]:()=>I&&_(),ArrowDown:()=>k&&_(),ArrowUp:()=>k&&E(),Home:b,End:w}[V];q&&(f.preventDefault(),q(f))},[l,e,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Rn(n.onKeyDown,d)}}function TVe(n){const{isDisabled:e=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:_,selectedIndex:E}=oN(),{index:b,register:w}=EVe({disabled:e&&!i}),I=b===E,k=()=>{l(b)},V=()=>{_(b),!d&&!(e&&i)&&l(b)};return{...wre({...a,ref:Ki(w,n.ref),isDisabled:e,isFocusable:i,onClick:Rn(n.onClick,k)}),id:Zre(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":eie(f,b),onFocus:e?void 0:Rn(n.onFocus,V)}}const[wVe,CVe]=Ni({});function RVe(n){const e=oN(),{id:i,selectedIndex:a}=e,d=Gj(n.children).map((f,_)=>D.createElement(wVe,{key:f.key??_,value:{isSelected:_===a,id:eie(i,_),tabId:Zre(i,_),selectedIndex:a}},f));return{...n,children:d}}function IVe(n){const{children:e,...i}=n,{isLazy:a,lazyBehavior:l}=oN(),{isSelected:d,id:f,tabId:_}=CVe(),E=D.useRef(!1);d&&(E.current=!0);const b=Hj({wasSelected:E.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":_,hidden:!d,id:f}}function Zre(n,e){return`${n}--tab-${e}`}function eie(n,e){return`${n}--tabpanel-${e}`}const[AVe,aN]=Ni({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),wR=Gt(function(e,i){const a=za("Tabs",e),{children:l,className:d,...f}=Ii(e),{htmlProps:_,descendants:E,...b}=vVe(f),w=D.useMemo(()=>b,[b]),{isFitted:I,...k}=_,V={position:"relative",...a.root};return S.jsx(gVe,{value:E,children:S.jsx(SVe,{value:w,children:S.jsx(AVe,{value:a,children:S.jsx(kt.div,{className:ln("chakra-tabs",d),ref:i,...k,__css:V,children:l})})})})});wR.displayName="Tabs";const Ml=Gt(function(e,i){const a=aN(),l=TVe({...e,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return S.jsx(kt.button,{...l,className:ln("chakra-tabs__tab",e.className),__css:d})});Ml.displayName="Tab";const CR=Gt(function(e,i){const a=bVe({...e,ref:i}),l=aN(),d={display:"flex",...l.tablist};return S.jsx(kt.div,{...a,className:ln("chakra-tabs__tablist",e.className),__css:d})});CR.displayName="TabList";const zd=Gt(function(e,i){const a=IVe({...e,ref:i}),l=aN();return S.jsx(kt.div,{outline:"0",...a,className:ln("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});zd.displayName="TabPanel";const cN=Gt(function(e,i){const a=RVe(e),l=aN();return S.jsx(kt.div,{...a,width:"100%",ref:i,className:ln("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});cN.displayName="TabPanels";const PVe=["h","minH","height","minHeight"],Mu=Gt((n,e)=>{const i=cl("Textarea",n),{className:a,rows:l,...d}=Ii(n),f=XF(d),_=l?z0(i,PVe):i;return S.jsx(kt.textarea,{ref:e,rows:l,...f,className:ln("chakra-textarea",a),__css:_})});Mu.displayName="Textarea";function OVe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function kVe(n,e){const i=l=>({...e,...l,position:OVe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),a=l=>{const d=i(l),f=Ene(d);return ep.notify(f,d)};return a.update=(l,d)=>{ep.update(l,i(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(_=>a.update(f,{status:"success",duration:5e3,...tl(d.success,_)})).catch(_=>a.update(f,{status:"error",duration:5e3,...tl(d.error,_)}))},a.closeAll=ep.closeAll,a.close=ep.close,a.isActive=ep.isActive,a}function ll(n){const{theme:e}=gne(),i=jDe();return D.useMemo(()=>kVe(e.direction,{...i,...n}),[n,e.direction,i])}const NVe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},ZV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},AO=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function DVe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:_=!0,onOpen:E,onClose:b,placement:w,id:I,isOpen:k,defaultIsOpen:V,arrowSize:L=10,arrowShadowColor:F,arrowPadding:B,modifiers:q,isDisabled:$,gutter:Q,offset:ae,direction:re,...fe}=n,{isOpen:Z,onOpen:ee,onClose:ne}=qd({isOpen:k,defaultIsOpen:V,onOpen:E,onClose:b}),{referenceRef:oe,getPopperProps:ge,getArrowInnerProps:pe,getArrowProps:le}=_5({enabled:Z,placement:w,arrowPadding:B,modifiers:q,gutter:Q,offset:ae,direction:re}),Me=D.useId(),tt=`tooltip-${I??Me}`,Ee=D.useRef(null),Ie=D.useRef(void 0),ve=D.useCallback(()=>{Ie.current&&(clearTimeout(Ie.current),Ie.current=void 0)},[]),Be=D.useRef(void 0),ke=D.useCallback(()=>{Be.current&&(clearTimeout(Be.current),Be.current=void 0)},[]),Re=D.useCallback(()=>{ke(),ne()},[ne,ke]),he=xVe(Ee,Re),we=D.useCallback(()=>{if(!$&&!Ie.current){Z&&he();const Dt=AO(Ee);Ie.current=Dt.setTimeout(ee,e)}},[he,$,Z,ee,e]),Ue=D.useCallback(()=>{ve();const Dt=AO(Ee);Be.current=Dt.setTimeout(Re,i)},[i,Re,ve]),Fe=D.useCallback(()=>{Z&&a&&Ue()},[a,Ue,Z]),$e=D.useCallback(()=>{Z&&f&&Ue()},[f,Ue,Z]),ct=D.useCallback(Dt=>{Z&&Dt.key==="Escape"&&Ue()},[Z,Ue]);t0(()=>ZV(Ee),"keydown",_?ct:void 0),t0(()=>{if(!d)return null;const Dt=Ee.current;if(!Dt)return null;const an=GZ(Dt);return an.localName==="body"?AO(Ee):an},"scroll",()=>{Z&&d&&Re()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(ve(),Z&&ne())},[$,Z,ne,ve]),D.useEffect(()=>()=>{ve(),ke()},[ve,ke]),t0(()=>Ee.current,"pointerleave",Ue);const it=D.useCallback((Dt={},an=null)=>({...Dt,ref:Ki(Ee,an,oe),onPointerEnter:Rn(Dt.onPointerEnter,Qt=>{Qt.pointerType!=="touch"&&we()}),onClick:Rn(Dt.onClick,Fe),onPointerDown:Rn(Dt.onPointerDown,$e),onFocus:Rn(Dt.onFocus,we),onBlur:Rn(Dt.onBlur,Ue),"aria-describedby":Z?tt:void 0}),[we,Ue,$e,Z,tt,Fe,oe]),Ct=D.useCallback((Dt={},an=null)=>ge({...Dt,style:{...Dt.style,[Xs.arrowSize.var]:L?`${L}px`:void 0,[Xs.arrowShadowColor.var]:F}},an),[ge,L,F]),Vt=D.useCallback((Dt={},an=null)=>{const jn={...Dt.style,position:"relative",transformOrigin:Xs.transformOrigin.varRef};return{ref:an,...fe,...Dt,id:tt,role:"tooltip",style:jn}},[fe,tt]);return{isOpen:Z,show:we,hide:Ue,getTriggerProps:it,getTooltipProps:Vt,getTooltipPositionerProps:Ct,getArrowProps:le,getArrowInnerProps:pe}}const vU="chakra-ui:close-tooltip";function xVe(n,e){return D.useEffect(()=>{const i=ZV(n);return i.addEventListener(vU,e),()=>i.removeEventListener(vU,e)},[e,n]),()=>{const i=ZV(n),a=AO(n);i.dispatchEvent(new a.CustomEvent(vU))}}const LVe=kt(vp.div),up=Gt((n,e)=>{const i=cl("Tooltip",n),a=Ii(n),l=$g(),{children:d,label:f,shouldWrapChildren:_,"aria-label":E,hasArrow:b,bg:w,portalProps:I,background:k,backgroundColor:V,bgColor:L,motionProps:F,animatePresenceProps:B,...q}=a,$=k??V??w??L;if($){i.bg=$;const oe=j0e(l,"colors",$);i[Xs.arrowBg.var]=oe}const Q=DVe({...q,direction:l.direction}),ae=!D.isValidElement(d)||_;let re;if(ae)re=S.jsx(kt.span,{display:"inline-block",tabIndex:0,...Q.getTriggerProps(),children:d});else{const oe=D.Children.only(d);re=D.cloneElement(oe,Q.getTriggerProps(oe.props,Wre(oe)))}const fe=!!E,Z=Q.getTooltipProps({},e),ee=fe?z0(Z,["role","id"]):Z,ne=WZ(Z,["role","id"]);return f?S.jsxs(S.Fragment,{children:[re,S.jsx(rE,{...B,children:Q.isOpen&&S.jsx(Kl,{...I,children:S.jsx(kt.div,{...Q.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:S.jsxs(LVe,{variants:NVe,initial:"exit",animate:"enter",exit:"exit",...F,...ee,__css:i,children:[f,fe&&S.jsx(kt.span,{srOnly:!0,...ne,children:E}),b&&S.jsx(kt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:S.jsx(kt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):S.jsx(S.Fragment,{children:d})});up.displayName="Tooltip";const Sr=Gt(function(e,i){const a=cl("Heading",e),{className:l,...d}=Ii(e);return S.jsx(kt.h2,{ref:i,className:ln("chakra-heading",e.className),...d,__css:a})});Sr.displayName="Heading";const Qe=Gt(function(e,i){const a=cl("Text",e),{className:l,align:d,decoration:f,casing:_,...E}=Ii(e),b=lR({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return S.jsx(kt.p,{ref:i,className:ln("chakra-text",e.className),...b,...E,__css:a})});Qe.displayName="Text";var SU,VX;function MVe(){if(VX)return SU;VX=1;var n=function(e,i,a,l,d,f,_,E){if(!e){var b;if(i===void 0)b=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var w=[a,l,d,f,_,E],I=0;b=new Error(i.replace(/%s/g,function(){return w[I++]})),b.name="Invariant Violation"}throw b.framesToPop=1,b}};return SU=n,SU}var UVe=MVe();const jX=Xf(UVe);var bU,FX;function VVe(){return FX||(FX=1,bU=function(e,i,a,l){var d=a?a.call(l,e,i):void 0;if(d!==void 0)return!!d;if(e===i)return!0;if(typeof e!="object"||!e||typeof i!="object"||!i)return!1;var f=Object.keys(e),_=Object.keys(i);if(f.length!==_.length)return!1;for(var E=Object.prototype.hasOwnProperty.bind(i),b=0;b<f.length;b++){var w=f[b];if(!E(w))return!1;var I=e[w],k=i[w];if(d=a?a.call(l,I,k,w):void 0,d===!1||d===void 0&&I!==k)return!1}return!0}),bU}var jVe=VVe();const FVe=Xf(jVe);var tie=(n=>(n.BASE="base",n.BODY="body",n.HEAD="head",n.HTML="html",n.LINK="link",n.META="meta",n.NOSCRIPT="noscript",n.SCRIPT="script",n.STYLE="style",n.TITLE="title",n.FRAGMENT="Symbol(react.fragment)",n))(tie||{}),TU={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},BX=Object.values(tie),y5={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},BVe=Object.entries(y5).reduce((n,[e,i])=>(n[i]=e,n),{}),Gd="data-rh",h0={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},p0=(n,e)=>{for(let i=n.length-1;i>=0;i-=1){const a=n[i];if(Object.prototype.hasOwnProperty.call(a,e))return a[e]}return null},WVe=n=>{let e=p0(n,"title");const i=p0(n,h0.TITLE_TEMPLATE);if(Array.isArray(e)&&(e=e.join("")),i&&e)return i.replace(/%s/g,()=>e);const a=p0(n,h0.DEFAULT_TITLE);return e||a||void 0},zVe=n=>p0(n,h0.ON_CHANGE_CLIENT_STATE)||(()=>{}),wU=(n,e)=>e.filter(i=>typeof i[n]<"u").map(i=>i[n]).reduce((i,a)=>({...i,...a}),{}),GVe=(n,e)=>e.filter(i=>typeof i.base<"u").map(i=>i.base).reverse().reduce((i,a)=>{if(!i.length){const l=Object.keys(a);for(let d=0;d<l.length;d+=1){const _=l[d].toLowerCase();if(n.indexOf(_)!==-1&&a[_])return i.concat(a)}}return i},[]),HVe=n=>console&&typeof console.warn=="function"&&console.warn(n),Cw=(n,e,i)=>{const a={};return i.filter(l=>Array.isArray(l[n])?!0:(typeof l[n]<"u"&&HVe(`Helmet: ${n} should be of type "Array". Instead found type "${typeof l[n]}"`),!1)).map(l=>l[n]).reverse().reduce((l,d)=>{const f={};d.filter(E=>{let b;const w=Object.keys(E);for(let k=0;k<w.length;k+=1){const V=w[k],L=V.toLowerCase();e.indexOf(L)!==-1&&!(b==="rel"&&E[b].toLowerCase()==="canonical")&&!(L==="rel"&&E[L].toLowerCase()==="stylesheet")&&(b=L),e.indexOf(V)!==-1&&(V==="innerHTML"||V==="cssText"||V==="itemprop")&&(b=V)}if(!b||!E[b])return!1;const I=E[b].toLowerCase();return a[b]||(a[b]={}),f[b]||(f[b]={}),a[b][I]?!1:(f[b][I]=!0,!0)}).reverse().forEach(E=>l.push(E));const _=Object.keys(f);for(let E=0;E<_.length;E+=1){const b=_[E],w={...a[b],...f[b]};a[b]=w}return l},[]).reverse()},$Ve=(n,e)=>{if(Array.isArray(n)&&n.length){for(let i=0;i<n.length;i+=1)if(n[i][e])return!0}return!1},KVe=n=>({baseTag:GVe(["href"],n),bodyAttributes:wU("bodyAttributes",n),defer:p0(n,h0.DEFER),encode:p0(n,h0.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:wU("htmlAttributes",n),linkTags:Cw("link",["rel","href"],n),metaTags:Cw("meta",["name","charset","http-equiv","property","itemprop"],n),noscriptTags:Cw("noscript",["innerHTML"],n),onChangeClientState:zVe(n),scriptTags:Cw("script",["src","innerHTML"],n),styleTags:Cw("style",["cssText"],n),title:WVe(n),titleAttributes:wU("titleAttributes",n),prioritizeSeoTags:$Ve(n,h0.PRIORITIZE_SEO_TAGS)}),nie=n=>Array.isArray(n)?n.join(""):n,qVe=(n,e)=>{const i=Object.keys(n);for(let a=0;a<i.length;a+=1)if(e[i[a]]&&e[i[a]].includes(n[i[a]]))return!0;return!1},CU=(n,e)=>Array.isArray(n)?n.reduce((i,a)=>(qVe(a,e)?i.priority.push(a):i.default.push(a),i),{priority:[],default:[]}):{default:n,priority:[]},WX=(n,e)=>({...n,[e]:void 0}),YVe=["noscript","script","style"],ej=(n,e=!0)=>e===!1?String(n):String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),rie=n=>Object.keys(n).reduce((e,i)=>{const a=typeof n[i]<"u"?`${i}="${n[i]}"`:`${i}`;return e?`${e} ${a}`:a},""),XVe=(n,e,i,a)=>{const l=rie(i),d=nie(e);return l?`<${n} ${Gd}="true" ${l}>${ej(d,a)}</${n}>`:`<${n} ${Gd}="true">${ej(d,a)}</${n}>`},JVe=(n,e,i=!0)=>e.reduce((a,l)=>{const d=l,f=Object.keys(d).filter(b=>!(b==="innerHTML"||b==="cssText")).reduce((b,w)=>{const I=typeof d[w]>"u"?w:`${w}="${ej(d[w],i)}"`;return b?`${b} ${I}`:I},""),_=d.innerHTML||d.cssText||"",E=YVe.indexOf(n)===-1;return`${a}<${n} ${Gd}="true" ${f}${E?"/>":`>${_}</${n}>`}`},""),iie=(n,e={})=>Object.keys(n).reduce((i,a)=>{const l=y5[a];return i[l||a]=n[a],i},e),QVe=(n,e,i)=>{const a={key:e,[Gd]:!0},l=iie(i,a);return[_r.createElement("title",l,e)]},PO=(n,e)=>e.map((i,a)=>{const l={key:a,[Gd]:!0};return Object.keys(i).forEach(d=>{const _=y5[d]||d;if(_==="innerHTML"||_==="cssText"){const E=i.innerHTML||i.cssText;l.dangerouslySetInnerHTML={__html:E}}else l[_]=i[d]}),_r.createElement(n,l)}),Lu=(n,e,i=!0)=>{switch(n){case"title":return{toComponent:()=>QVe(n,e.title,e.titleAttributes),toString:()=>XVe(n,e.title,e.titleAttributes,i)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>iie(e),toString:()=>rie(e)};default:return{toComponent:()=>PO(n,e),toString:()=>JVe(n,e,i)}}},ZVe=({metaTags:n,linkTags:e,scriptTags:i,encode:a})=>{const l=CU(n,TU.meta),d=CU(e,TU.link),f=CU(i,TU.script);return{priorityMethods:{toComponent:()=>[...PO("meta",l.priority),...PO("link",d.priority),...PO("script",f.priority)],toString:()=>`${Lu("meta",l.priority,a)} ${Lu("link",d.priority,a)} ${Lu("script",f.priority,a)}`},metaTags:l.default,linkTags:d.default,scriptTags:f.default}},eje=n=>{const{baseTag:e,bodyAttributes:i,encode:a=!0,htmlAttributes:l,noscriptTags:d,styleTags:f,title:_="",titleAttributes:E,prioritizeSeoTags:b}=n;let{linkTags:w,metaTags:I,scriptTags:k}=n,V={toComponent:()=>{},toString:()=>""};return b&&({priorityMethods:V,linkTags:w,metaTags:I,scriptTags:k}=ZVe(n)),{priority:V,base:Lu("base",e,a),bodyAttributes:Lu("bodyAttributes",i,a),htmlAttributes:Lu("htmlAttributes",l,a),link:Lu("link",w,a),meta:Lu("meta",I,a),noscript:Lu("noscript",d,a),script:Lu("script",k,a),style:Lu("style",f,a),title:Lu("title",{title:_,titleAttributes:E},a)}},tj=eje,q1=[],sie=!!(typeof window<"u"&&window.document&&window.document.createElement),nj=class{constructor(n,e){vf(this,"instances",[]);vf(this,"canUseDOM",sie);vf(this,"context");vf(this,"value",{setHelmet:n=>{this.context.helmet=n},helmetInstances:{get:()=>this.canUseDOM?q1:this.instances,add:n=>{(this.canUseDOM?q1:this.instances).push(n)},remove:n=>{const e=(this.canUseDOM?q1:this.instances).indexOf(n);(this.canUseDOM?q1:this.instances).splice(e,1)}}});this.context=n,this.canUseDOM=e||!1,e||(n.helmet=tj({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},tje={},oie=_r.createContext(tje),Ny,aie=(Ny=class extends D.Component{constructor(i){super(i);vf(this,"helmetData");this.helmetData=new nj(this.props.context||{},Ny.canUseDOM)}render(){return _r.createElement(oie.Provider,{value:this.helmetData.value},this.props.children)}},vf(Ny,"canUseDOM",sie),Ny),LS=(n,e)=>{const i=document.head||document.querySelector("head"),a=i.querySelectorAll(`${n}[${Gd}]`),l=[].slice.call(a),d=[];let f;return e&&e.length&&e.forEach(_=>{const E=document.createElement(n);for(const b in _)if(Object.prototype.hasOwnProperty.call(_,b))if(b==="innerHTML")E.innerHTML=_.innerHTML;else if(b==="cssText")E.styleSheet?E.styleSheet.cssText=_.cssText:E.appendChild(document.createTextNode(_.cssText));else{const w=b,I=typeof _[w]>"u"?"":_[w];E.setAttribute(b,I)}E.setAttribute(Gd,"true"),l.some((b,w)=>(f=w,E.isEqualNode(b)))?l.splice(f,1):d.push(E)}),l.forEach(_=>{var E;return(E=_.parentNode)==null?void 0:E.removeChild(_)}),d.forEach(_=>i.appendChild(_)),{oldTags:l,newTags:d}},rj=(n,e)=>{const i=document.getElementsByTagName(n)[0];if(!i)return;const a=i.getAttribute(Gd),l=a?a.split(","):[],d=[...l],f=Object.keys(e);for(const _ of f){const E=e[_]||"";i.getAttribute(_)!==E&&i.setAttribute(_,E),l.indexOf(_)===-1&&l.push(_);const b=d.indexOf(_);b!==-1&&d.splice(b,1)}for(let _=d.length-1;_>=0;_-=1)i.removeAttribute(d[_]);l.length===d.length?i.removeAttribute(Gd):i.getAttribute(Gd)!==f.join(",")&&i.setAttribute(Gd,f.join(","))},nje=(n,e)=>{typeof n<"u"&&document.title!==n&&(document.title=nie(n)),rj("title",e)},zX=(n,e)=>{const{baseTag:i,bodyAttributes:a,htmlAttributes:l,linkTags:d,metaTags:f,noscriptTags:_,onChangeClientState:E,scriptTags:b,styleTags:w,title:I,titleAttributes:k}=n;rj("body",a),rj("html",l),nje(I,k);const V={baseTag:LS("base",i),linkTags:LS("link",d),metaTags:LS("meta",f),noscriptTags:LS("noscript",_),scriptTags:LS("script",b),styleTags:LS("style",w)},L={},F={};Object.keys(V).forEach(B=>{const{newTags:q,oldTags:$}=V[B];q.length&&(L[B]=q),$.length&&(F[B]=V[B].oldTags)}),e&&e(),E(n,L,F)},Rw=null,rje=n=>{Rw&&cancelAnimationFrame(Rw),n.defer?Rw=requestAnimationFrame(()=>{zX(n,()=>{Rw=null})}):(zX(n),Rw=null)},ije=rje,GX=class extends D.Component{constructor(){super(...arguments);vf(this,"rendered",!1)}shouldComponentUpdate(e){return!FVe(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:i}=this.props.context;let a=null;const l=KVe(e.get().map(d=>{const f={...d.props};return delete f.context,f}));aie.canUseDOM?ije(l):tj&&(a=tj(l)),i(a)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},YU,Y0=(YU=class extends D.Component{shouldComponentUpdate(n){return!mne(WX(this.props,"helmetData"),WX(n,"helmetData"))}mapNestedChildrenToProps(n,e){if(!e)return null;switch(n.type){case"script":case"noscript":return{innerHTML:e};case"style":return{cssText:e};default:throw new Error(`<${n.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(n,e,i,a){return{...e,[n.type]:[...e[n.type]||[],{...i,...this.mapNestedChildrenToProps(n,a)}]}}mapObjectTypeChildren(n,e,i,a){switch(n.type){case"title":return{...e,[n.type]:a,titleAttributes:{...i}};case"body":return{...e,bodyAttributes:{...i}};case"html":return{...e,htmlAttributes:{...i}};default:return{...e,[n.type]:{...i}}}}mapArrayTypeChildrenToProps(n,e){let i={...e};return Object.keys(n).forEach(a=>{i={...i,[a]:n[a]}}),i}warnOnInvalidChildren(n,e){return jX(BX.some(i=>n.type===i),typeof n.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${BX.join(", ")} are allowed. Helmet does not support rendering <${n.type}> elements. Refer to our API for more information.`),jX(!e||typeof e=="string"||Array.isArray(e)&&!e.some(i=>typeof i!="string"),`Helmet expects a string as a child of <${n.type}>. Did you forget to wrap your children in braces? ( <${n.type}>{\`\`}</${n.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(n,e){let i={};return _r.Children.forEach(n,a=>{if(!a||!a.props)return;const{children:l,...d}=a.props,f=Object.keys(d).reduce((E,b)=>(E[BVe[b]||b]=d[b],E),{});let{type:_}=a;switch(typeof _=="symbol"?_=_.toString():this.warnOnInvalidChildren(a,l),_){case"Symbol(react.fragment)":e=this.mapChildrenToProps(l,e);break;case"link":case"meta":case"noscript":case"script":case"style":i=this.flattenArrayTypeChildren(a,i,f,l);break;default:e=this.mapObjectTypeChildren(a,e,f,l);break}}),this.mapArrayTypeChildrenToProps(i,e)}render(){const{children:n,...e}=this.props;let i={...e},{helmetData:a}=e;if(n&&(i=this.mapChildrenToProps(n,i)),a&&!(a instanceof nj)){const l=a;a=new nj(l.context,!0),delete i.helmetData}return a?_r.createElement(GX,{...i,context:a.value}):_r.createElement(oie.Consumer,null,l=>_r.createElement(GX,{...i,context:l}))}},vf(YU,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),YU);const sje=()=>{};var HX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cie=function(n){const e=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},oje=function(n){const e=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)e[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];e[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],f=n[i++],_=n[i++],E=((l&7)<<18|(d&63)<<12|(f&63)<<6|_&63)-65536;e[a++]=String.fromCharCode(55296+(E>>10)),e[a++]=String.fromCharCode(56320+(E&1023))}else{const d=n[i++],f=n[i++];e[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return e.join("")},lie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,_=f?n[l+1]:0,E=l+2<n.length,b=E?n[l+2]:0,w=d>>2,I=(d&3)<<4|_>>4;let k=(_&15)<<2|b>>6,V=b&63;E||(V=64,f||(k=64)),a.push(i[w],i[I],i[k],i[V])}return a.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(cie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):oje(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||_==null||b==null||I==null)throw new aje;const k=d<<2|_>>4;if(a.push(k),b!==64){const V=_<<4&240|b>>2;if(a.push(V),I!==64){const L=b<<6&192|I;a.push(L)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class aje extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cje=function(n){const e=cie(n);return lie.encodeByteArray(e,!0)},ok=function(n){return cje(n).replace(/\./g,"")},uie=function(n){try{return lie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lje(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uje=()=>lje().__FIREBASE_DEFAULTS__,dje=()=>{if(typeof process>"u"||typeof HX>"u")return;const n=HX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},hje=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&uie(n[1]);return e&&JSON.parse(e)},lN=()=>{try{return sje()||uje()||dje()||hje()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},die=n=>{var e,i;return(i=(e=lN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},hie=n=>{const e=die(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),a]:[e.substring(0,i),a]},pie=()=>{var n;return(n=lN())===null||n===void 0?void 0:n.config},fie=n=>{var e;return(e=lN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pje{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=e||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ok(JSON.stringify(i)),ok(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function fje(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wa())}function mje(){var n;const e=(n=lN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function gje(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function _je(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function yje(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Eje(){const n=Wa();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function vje(){return!mje()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Sje(){try{return typeof indexedDB=="object"}catch{return!1}}function bje(){return new Promise((n,e)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;e(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tje="FirebaseError";class bp extends Error{constructor(e,i,a){super(i),this.code=e,this.customData=a,this.name=Tje,Object.setPrototypeOf(this,bp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,RR.prototype.create)}}class RR{constructor(e,i,a){this.service=e,this.serviceName=i,this.errors=a}create(e,...i){const a=i[0]||{},l=`${this.service}/${e}`,d=this.errors[e],f=d?wje(d,a):"Error",_=`${this.serviceName}: ${f} (${l}).`;return new bp(l,_,a)}}function wje(n,e){return n.replace(Cje,(i,a)=>{const l=e[a];return l!=null?String(l):`<${a}?>`})}const Cje=/\{\$([^}]+)}/g;function Rje(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Xy(n,e){if(n===e)return!0;const i=Object.keys(n),a=Object.keys(e);for(const l of i){if(!a.includes(l))return!1;const d=n[l],f=e[l];if($X(d)&&$X(f)){if(!Xy(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function $X(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(n){const e=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function Zw(n){const e={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");e[decodeURIComponent(l)]=decodeURIComponent(d)}}),e}function eC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function Ije(n,e){const i=new Aje(n,e);return i.subscribe.bind(i)}class Aje{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,a){let l;if(e===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");Pje(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:a},l.next===void 0&&(l.next=RU),l.error===void 0&&(l.error=RU),l.complete===void 0&&(l.complete=RU);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Pje(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function RU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xi(n){return n&&n._delegate?n._delegate:n}class Lg{constructor(e,i,a){this.name=e,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oje{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const a=new pje;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Nje(e))try{this.getOrInitializeService({instanceIdentifier:wy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(e=wy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=wy){return this.instances.has(e)}getOptions(e=wy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[d,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(d);a===_&&f.resolve(l)}return l}onInit(e,i){var a;const l=this.normalizeInstanceIdentifier(i),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(e),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&e(f,l),()=>{d.delete(e)}}invokeOnInitCallbacks(e,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:kje(e),options:i}),this.instances.set(e,a),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=wy){return this.component?this.component.multipleInstances?e:wy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function kje(n){return n===wy?void 0:n}function Nje(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dje{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new Oje(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ar;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ar||(Ar={}));const xje={debug:Ar.DEBUG,verbose:Ar.VERBOSE,info:Ar.INFO,warn:Ar.WARN,error:Ar.ERROR,silent:Ar.SILENT},Lje=Ar.INFO,Mje={[Ar.DEBUG]:"log",[Ar.VERBOSE]:"log",[Ar.INFO]:"info",[Ar.WARN]:"warn",[Ar.ERROR]:"error"},Uje=(n,e,...i)=>{if(e<n.logLevel)return;const a=new Date().toISOString(),l=Mje[e];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let E5=class{constructor(e){this.name=e,this._logLevel=Lje,this._logHandler=Uje,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ar))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?xje[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ar.DEBUG,...e),this._logHandler(this,Ar.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ar.VERBOSE,...e),this._logHandler(this,Ar.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ar.INFO,...e),this._logHandler(this,Ar.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ar.WARN,...e),this._logHandler(this,Ar.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ar.ERROR,...e),this._logHandler(this,Ar.ERROR,...e)}};const Vje=(n,e)=>e.some(i=>n instanceof i);let KX,qX;function jje(){return KX||(KX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fje(){return qX||(qX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const gie=new WeakMap,ij=new WeakMap,_ie=new WeakMap,IU=new WeakMap,v5=new WeakMap;function Bje(n){const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{i(Rg(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return e.then(i=>{i instanceof IDBCursor&&gie.set(i,n)}).catch(()=>{}),v5.set(e,n),e}function Wje(n){if(ij.has(n))return;const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{i(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});ij.set(n,e)}let sj={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return ij.get(n);if(e==="objectStoreNames")return n.objectStoreNames||_ie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Rg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function zje(n){sj=n(sj)}function Gje(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const a=n.call(AU(this),e,...i);return _ie.set(a,e.sort?e.sort():[e]),Rg(a)}:Fje().includes(n)?function(...e){return n.apply(AU(this),e),Rg(gie.get(this))}:function(...e){return Rg(n.apply(AU(this),e))}}function Hje(n){return typeof n=="function"?Gje(n):(n instanceof IDBTransaction&&Wje(n),Vje(n,jje())?new Proxy(n,sj):n)}function Rg(n){if(n instanceof IDBRequest)return Bje(n);if(IU.has(n))return IU.get(n);const e=Hje(n);return e!==n&&(IU.set(n,e),v5.set(e,n)),e}const AU=n=>v5.get(n);function $je(n,e,{blocked:i,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,e),_=Rg(f);return a&&f.addEventListener("upgradeneeded",E=>{a(Rg(f.result),E.oldVersion,E.newVersion,Rg(f.transaction),E)}),i&&f.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{d&&E.addEventListener("close",()=>d()),l&&E.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const Kje=["get","getKey","getAll","getAllKeys","count"],qje=["put","add","delete","clear"],PU=new Map;function YX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(PU.get(e))return PU.get(e);const i=e.replace(/FromIndex$/,""),a=e!==i,l=qje.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||Kje.includes(i)))return;const d=async function(f,..._){const E=this.transaction(f,l?"readwrite":"readonly");let b=E.store;return a&&(b=b.index(_.shift())),(await Promise.all([b[i](..._),l&&E.done]))[0]};return PU.set(e,d),d}zje(n=>({...n,get:(e,i,a)=>YX(e,i)||n.get(e,i,a),has:(e,i)=>!!YX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yje{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(Xje(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function Xje(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const oj="@firebase/app",XX="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hf=new E5("@firebase/app"),Jje="@firebase/app-compat",Qje="@firebase/analytics-compat",Zje="@firebase/analytics",eFe="@firebase/app-check-compat",tFe="@firebase/app-check",nFe="@firebase/auth",rFe="@firebase/auth-compat",iFe="@firebase/database",sFe="@firebase/data-connect",oFe="@firebase/database-compat",aFe="@firebase/functions",cFe="@firebase/functions-compat",lFe="@firebase/installations",uFe="@firebase/installations-compat",dFe="@firebase/messaging",hFe="@firebase/messaging-compat",pFe="@firebase/performance",fFe="@firebase/performance-compat",mFe="@firebase/remote-config",gFe="@firebase/remote-config-compat",_Fe="@firebase/storage",yFe="@firebase/storage-compat",EFe="@firebase/firestore",vFe="@firebase/vertexai",SFe="@firebase/firestore-compat",bFe="firebase",TFe="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aj="[DEFAULT]",wFe={[oj]:"fire-core",[Jje]:"fire-core-compat",[Zje]:"fire-analytics",[Qje]:"fire-analytics-compat",[tFe]:"fire-app-check",[eFe]:"fire-app-check-compat",[nFe]:"fire-auth",[rFe]:"fire-auth-compat",[iFe]:"fire-rtdb",[sFe]:"fire-data-connect",[oFe]:"fire-rtdb-compat",[aFe]:"fire-fn",[cFe]:"fire-fn-compat",[lFe]:"fire-iid",[uFe]:"fire-iid-compat",[dFe]:"fire-fcm",[hFe]:"fire-fcm-compat",[pFe]:"fire-perf",[fFe]:"fire-perf-compat",[mFe]:"fire-rc",[gFe]:"fire-rc-compat",[_Fe]:"fire-gcs",[yFe]:"fire-gcs-compat",[EFe]:"fire-fst",[SFe]:"fire-fst-compat",[vFe]:"fire-vertex","fire-js":"fire-js",[bFe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ak=new Map,CFe=new Map,cj=new Map;function JX(n,e){try{n.container.addComponent(e)}catch(i){Hf.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Jy(n){const e=n.name;if(cj.has(e))return Hf.debug(`There were multiple attempts to register component ${e}.`),!1;cj.set(e,n);for(const i of ak.values())JX(i,n);for(const i of CFe.values())JX(i,n);return!0}function uN(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function Ll(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RFe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ig=new RR("app","Firebase",RFe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IFe{constructor(e,i,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Lg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ig.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE=TFe;function yie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const a=Object.assign({name:aj,automaticDataCollectionEnabled:!1},e),l=a.name;if(typeof l!="string"||!l)throw Ig.create("bad-app-name",{appName:String(l)});if(i||(i=pie()),!i)throw Ig.create("no-options");const d=ak.get(l);if(d){if(Xy(i,d.options)&&Xy(a,d.config))return d;throw Ig.create("duplicate-app",{appName:l})}const f=new Dje(l);for(const E of cj.values())f.addComponent(E);const _=new IFe(i,a,f);return ak.set(l,_),_}function S5(n=aj){const e=ak.get(n);if(!e&&n===aj&&pie())return yie();if(!e)throw Ig.create("no-app",{appName:n});return e}function dp(n,e,i){var a;let l=(a=wFe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),f=e.match(/\s|\//);if(d||f){const _=[`Unable to register library "${l}" with version "${e}":`];d&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&_.push("and"),f&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hf.warn(_.join(" "));return}Jy(new Lg(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AFe="firebase-heartbeat-database",PFe=1,XC="firebase-heartbeat-store";let OU=null;function Eie(){return OU||(OU=$je(AFe,PFe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(XC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Ig.create("idb-open",{originalErrorMessage:n.message})})),OU}async function OFe(n){try{const i=(await Eie()).transaction(XC),a=await i.objectStore(XC).get(vie(n));return await i.done,a}catch(e){if(e instanceof bp)Hf.warn(e.message);else{const i=Ig.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Hf.warn(i.message)}}}async function QX(n,e){try{const a=(await Eie()).transaction(XC,"readwrite");await a.objectStore(XC).put(e,vie(n)),await a.done}catch(i){if(i instanceof bp)Hf.warn(i.message);else{const a=Ig.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Hf.warn(a.message)}}}function vie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kFe=1024,NFe=30;class DFe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new LFe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=ZX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>NFe){const f=MFe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Hf.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=ZX(),{heartbeatsToSend:a,unsentEntries:l}=xFe(this._heartbeatsCache.heartbeats),d=ok(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Hf.warn(i),""}}}function ZX(){return new Date().toISOString().substring(0,10)}function xFe(n,e=kFe){const i=[];let a=n.slice();for(const l of n){const d=i.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),eJ(i)>e){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),eJ(i)>e){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class LFe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Sje()?bje().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await OFe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return QX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return QX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function eJ(n){return ok(JSON.stringify({version:2,heartbeats:n})).length}function MFe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UFe(n){Jy(new Lg("platform-logger",e=>new Yje(e),"PRIVATE")),Jy(new Lg("heartbeat",e=>new DFe(e),"PRIVATE")),dp(oj,XX,n),dp(oj,XX,"esm2017"),dp("fire-js","")}UFe("");function Sie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const VFe=Sie,bie=new RR("auth","Firebase",Sie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ck=new E5("@firebase/auth");function jFe(n,...e){ck.logLevel<=Ar.WARN&&ck.warn(`Auth (${oE}): ${n}`,...e)}function OO(n,...e){ck.logLevel<=Ar.ERROR&&ck.error(`Auth (${oE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yd(n,...e){throw b5(n,...e)}function hp(n,...e){return b5(n,...e)}function Tie(n,e,i){const a=Object.assign(Object.assign({},VFe()),{[e]:i});return new RR("auth","Firebase",a).create(e,{appName:n.name})}function Ff(n){return Tie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function b5(n,...e){if(typeof n!="string"){const i=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return bie.create(n,...e)}function Vn(n,e,...i){if(!n)throw b5(e,...i)}function Of(n){const e="INTERNAL ASSERTION FAILED: "+n;throw OO(e),new Error(e)}function $f(n,e){n||Of(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lj(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function FFe(){return tJ()==="http:"||tJ()==="https:"}function tJ(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BFe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(FFe()||_je()||"connection"in navigator)?navigator.onLine:!0}function WFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,i){this.shortDelay=e,this.longDelay=i,$f(i>e,"Short delay should be less than long delay!"),this.isMobile=fje()||yje()}get(){return BFe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T5(n,e){$f(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wie{static initialize(e,i,a){this.fetchImpl=e,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Of("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Of("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Of("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GFe=new AR(3e4,6e4);function Qf(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Zf(n,e,i,a,l={}){return Cie(n,l,async()=>{let d={},f={};a&&(e==="GET"?f=a:d={body:JSON.stringify(a)});const _=IR(Object.assign({key:n.config.apiKey},f)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:E},d);return gje()||(b.referrerPolicy="no-referrer"),wie.fetch()(Rie(n,n.config.apiHost,i,_),b)})}async function Cie(n,e,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},zFe),e);try{const l=new $Fe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw Y1(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const _=d.ok?f.errorMessage:f.error.message,[E,b]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw Y1(n,"credential-already-in-use",f);if(E==="EMAIL_EXISTS")throw Y1(n,"email-already-in-use",f);if(E==="USER_DISABLED")throw Y1(n,"user-disabled",f);const w=a[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw Tie(n,w,b);Yd(n,w)}}catch(l){if(l instanceof bp)throw l;Yd(n,"network-request-failed",{message:String(l)})}}async function PR(n,e,i,a,l={}){const d=await Zf(n,e,i,a,l);return"mfaPendingCredential"in d&&Yd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function Rie(n,e,i,a){const l=`${e}${i}?${a}`;return n.config.emulator?T5(n.config,l):`${n.config.apiScheme}://${l}`}function HFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class $Fe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(hp(this.auth,"network-request-failed")),GFe.get())})}}function Y1(n,e,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=hp(n,e,a);return l.customData._tokenResponse=i,l}function nJ(n){return n!==void 0&&n.enterprise!==void 0}class KFe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return HFe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function qFe(n,e){return Zf(n,"GET","/v2/recaptchaConfig",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YFe(n,e){return Zf(n,"POST","/v1/accounts:delete",e)}async function Iie(n,e){return Zf(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function XFe(n,e=!1){const i=Xi(n),a=await i.getIdToken(e),l=w5(a);Vn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:yC(kU(l.auth_time)),issuedAtTime:yC(kU(l.iat)),expirationTime:yC(kU(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function kU(n){return Number(n)*1e3}function w5(n){const[e,i,a]=n.split(".");if(e===void 0||i===void 0||a===void 0)return OO("JWT malformed, contained fewer than 3 sections"),null;try{const l=uie(i);return l?JSON.parse(l):(OO("Failed to decode base64 JWT payload"),null)}catch(l){return OO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function rJ(n){const e=w5(n);return Vn(e,"internal-error"),Vn(typeof e.exp<"u","internal-error"),Vn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JC(n,e,i=!1){if(i)return e;try{return await e}catch(a){throw a instanceof bp&&JFe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function JFe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QFe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=yC(this.lastLoginAt),this.creationTime=yC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lk(n){var e;const i=n.auth,a=await n.getIdToken(),l=await JC(n,Iie(i,{idToken:a}));Vn(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?Aie(d.providerUserInfo):[],_=e5e(n.providerData,f),E=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(_!=null&&_.length),w=E?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:_,metadata:new uj(d.createdAt,d.lastLoginAt),isAnonymous:w};Object.assign(n,I)}async function ZFe(n){const e=Xi(n);await lk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function e5e(n,e){return[...n.filter(a=>!e.some(l=>l.providerId===a.providerId)),...e]}function Aie(n){return n.map(e=>{var{providerId:i}=e,a=vR(e,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t5e(n,e){const i=await Cie(n,{},async()=>{const a=IR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=Rie(n,l,"/v1/token",`key=${d}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",wie.fetch()(f,{method:"POST",headers:_,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function n5e(n,e){return Zf(n,"POST","/v2/accounts:revokeToken",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Vn(e.idToken,"internal-error"),Vn(typeof e.idToken<"u","internal-error"),Vn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):rJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Vn(e.length!==0,"internal-error");const i=rJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Vn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:a,refreshToken:l,expiresIn:d}=await t5e(e,i);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(e,i,a){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,i){const{refreshToken:a,accessToken:l,expirationTime:d}=i,f=new f0;return a&&(Vn(typeof a=="string","internal-error",{appName:e}),f.refreshToken=a),l&&(Vn(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),d&&(Vn(typeof d=="number","internal-error",{appName:e}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new f0,this.toJSON())}_performRefresh(){return Of("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ug(n,e){Vn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class kf{constructor(e){var{uid:i,auth:a,stsTokenManager:l}=e,d=vR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new QFe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new uj(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const i=await JC(this,this.stsTokenManager.getToken(this.auth,e));return Vn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return XFe(this,e)}reload(){return ZFe(this)}_assign(e){this!==e&&(Vn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new kf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Vn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),i&&await lk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ll(this.auth.app))return Promise.reject(Ff(this.auth));const e=await this.getIdToken();return await JC(this,YFe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var a,l,d,f,_,E,b,w;const I=(a=i.displayName)!==null&&a!==void 0?a:void 0,k=(l=i.email)!==null&&l!==void 0?l:void 0,V=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,L=(f=i.photoURL)!==null&&f!==void 0?f:void 0,F=(_=i.tenantId)!==null&&_!==void 0?_:void 0,B=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,q=(b=i.createdAt)!==null&&b!==void 0?b:void 0,$=(w=i.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:Q,emailVerified:ae,isAnonymous:re,providerData:fe,stsTokenManager:Z}=i;Vn(Q&&Z,e,"internal-error");const ee=f0.fromJSON(this.name,Z);Vn(typeof Q=="string",e,"internal-error"),ug(I,e.name),ug(k,e.name),Vn(typeof ae=="boolean",e,"internal-error"),Vn(typeof re=="boolean",e,"internal-error"),ug(V,e.name),ug(L,e.name),ug(F,e.name),ug(B,e.name),ug(q,e.name),ug($,e.name);const ne=new kf({uid:Q,auth:e,email:k,emailVerified:ae,displayName:I,isAnonymous:re,photoURL:L,phoneNumber:V,tenantId:F,stsTokenManager:ee,createdAt:q,lastLoginAt:$});return fe&&Array.isArray(fe)&&(ne.providerData=fe.map(oe=>Object.assign({},oe))),B&&(ne._redirectEventId=B),ne}static async _fromIdTokenResponse(e,i,a=!1){const l=new f0;l.updateFromServerResponse(i);const d=new kf({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a});return await lk(d),d}static async _fromGetAccountInfoResponse(e,i,a){const l=i.users[0];Vn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Aie(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),_=new f0;_.updateFromIdToken(a);const E=new kf({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new uj(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(E,b),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iJ=new Map;function Nf(n){$f(n instanceof Function,"Expected a class definition");let e=iJ.get(n);return e?($f(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,iJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Pie.type="NONE";const sJ=Pie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kO(n,e,i){return`firebase:${n}:${e}:${i}`}class m0{constructor(e,i,a){this.persistence=e,this.auth=i,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=kO(this.userKey,l.apiKey,d),this.fullPersistenceKey=kO("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?kf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,a="authUser"){if(!i.length)return new m0(Nf(sJ),e,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Nf(sJ);const f=kO(a,e.config.apiKey,e.name);let _=null;for(const b of i)try{const w=await b._get(f);if(w){const I=kf._fromJSON(e,w);b!==d&&(_=I),d=b;break}}catch{}const E=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!E.length?new m0(d,e,a):(d=E[0],_&&await d._set(f,_.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(f)}catch{}})),new m0(d,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Die(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Oie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Lie(e))return"Blackberry";if(Mie(e))return"Webos";if(kie(e))return"Safari";if((e.includes("chrome/")||Nie(e))&&!e.includes("edge/"))return"Chrome";if(xie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Oie(n=Wa()){return/firefox\//i.test(n)}function kie(n=Wa()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Nie(n=Wa()){return/crios\//i.test(n)}function Die(n=Wa()){return/iemobile/i.test(n)}function xie(n=Wa()){return/android/i.test(n)}function Lie(n=Wa()){return/blackberry/i.test(n)}function Mie(n=Wa()){return/webos/i.test(n)}function C5(n=Wa()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function r5e(n=Wa()){var e;return C5(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function i5e(){return Eje()&&document.documentMode===10}function Uie(n=Wa()){return C5(n)||xie(n)||Mie(n)||Lie(n)||/windows phone/i.test(n)||Die(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vie(n,e=[]){let i;switch(n){case"Browser":i=oJ(Wa());break;case"Worker":i=`${oJ(Wa())}-${n}`;break;default:i=n}const a=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${oE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s5e{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const a=d=>new Promise((f,_)=>{try{const E=e(d);f(E)}catch(E){_(E)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const a of this.queue)await a(e),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o5e(n,e={}){return Zf(n,"GET","/v2/passwordPolicy",Qf(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a5e=6;class c5e{constructor(e){var i,a,l,d;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:a5e,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,a,l,d,f,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(a=E.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(d=E.containsUppercaseLetter)!==null&&d!==void 0?d:!0),E.isValid&&(E.isValid=(f=E.containsNumericCharacter)!==null&&f!==void 0?f:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=e.length>=a),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<e.length;l++)a=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,i,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5e{constructor(e,i,a,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new aJ(this),this.idTokenSubscription=new aJ(this),this.beforeStateQueue=new s5e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=bie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Nf(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await m0.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await Iie(this,{idToken:e}),a=await kf._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Ll(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(_,_))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!f||f===_)&&(E!=null&&E.user)&&(l=E.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Vn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await lk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=WFe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ll(this.app))return Promise.reject(Ff(this));const i=e?Xi(e):null;return i&&Vn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Vn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ll(this.app)?Promise.reject(Ff(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ll(this.app)?Promise.reject(Ff(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Nf(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await o5e(this),i=new c5e(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new RR("auth","Firebase",e())}onAuthStateChanged(e,i,a){return this.registerStateListener(this.authStateSubscription,e,i,a)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,a){return this.registerStateListener(this.idTokenSubscription,e,i,a)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await n5e(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const a=await this.getOrInitRedirectPersistenceManager(i);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Nf(e)||this._popupRedirectResolver;Vn(i,this,"argument-error"),this.redirectPersistenceManager=await m0.create(this,[Nf(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,a,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let f=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Vn(_,this,"internal-error"),_.then(()=>{f||d(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,a,l);return()=>{f=!0,E()}}else{const E=e.addObserver(i);return()=>{f=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Vn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(Ll(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&jFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function aE(n){return Xi(n)}class aJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=Ije(i=>this.observer=i)}get next(){return Vn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function u5e(n){dN=n}function jie(n){return dN.loadJS(n)}function d5e(){return dN.recaptchaEnterpriseScript}function h5e(){return dN.gapiScript}function p5e(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class f5e{constructor(){this.enterprise=new m5e}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class m5e{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const g5e="recaptcha-enterprise",Fie="NO_RECAPTCHA";class _5e{constructor(e){this.type=g5e,this.auth=aE(e)}async verify(e="verify",i=!1){async function a(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,_)=>{qFe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const b=new KFe(E);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,f(b.siteKey)}}).catch(E=>{_(E)})})}function l(d,f,_){const E=window.grecaptcha;nJ(E)?E.enterprise.ready(()=>{E.enterprise.execute(d,{action:e}).then(b=>{f(b)}).catch(()=>{f(Fie)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new f5e().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(_=>{if(!i&&nJ(window.grecaptcha))l(_,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let E=d5e();E.length!==0&&(E+=_),jie(E).then(()=>{l(_,d,f)}).catch(b=>{f(b)})}}).catch(_=>{f(_)})})}}async function cJ(n,e,i,a=!1,l=!1){const d=new _5e(n);let f;if(l)f=Fie;else try{f=await d.verify(i)}catch{f=await d.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,b=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return a?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function dj(n,e,i,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await cJ(n,e,i,i==="getOobCode");return a(n,f)}else return a(n,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await cJ(n,e,i,i==="getOobCode");return a(n,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y5e(n,e){const i=uN(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(Xy(d,e??{}))return l;Yd(l,"already-initialized")}return i.initialize({options:e})}function E5e(n,e){const i=(e==null?void 0:e.persistence)||[],a=(Array.isArray(i)?i:[i]).map(Nf);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function v5e(n,e,i){const a=aE(n);Vn(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const l=!1,d=Bie(e),{host:f,port:_}=S5e(e),E=_===null?"":`:${_}`,b={url:`${d}//${f}${E}/`},w=Object.freeze({host:f,port:_,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Vn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Vn(Xy(b,a.config.emulator)&&Xy(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,b5e()}function Bie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function S5e(n){const e=Bie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:lJ(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:lJ(f)}}}function lJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function b5e(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R5{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Of("not implemented")}_getIdTokenResponse(e){return Of("not implemented")}_linkToIdToken(e,i){return Of("not implemented")}_getReauthenticationResolver(e){return Of("not implemented")}}async function T5e(n,e){return Zf(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w5e(n,e){return PR(n,"POST","/v1/accounts:signInWithPassword",Qf(n,e))}async function C5e(n,e){return Zf(n,"POST","/v1/accounts:sendOobCode",Qf(n,e))}async function R5e(n,e){return C5e(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I5e(n,e){return PR(n,"POST","/v1/accounts:signInWithEmailLink",Qf(n,e))}async function A5e(n,e){return PR(n,"POST","/v1/accounts:signInWithEmailLink",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC extends R5{constructor(e,i,a,l=null){super("password",a),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new QC(e,i,"password")}static _fromEmailAndCode(e,i,a=null){return new QC(e,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return dj(e,i,"signInWithPassword",w5e);case"emailLink":return I5e(e,{email:this._email,oobCode:this._password});default:Yd(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return dj(e,a,"signUpPassword",T5e);case"emailLink":return A5e(e,{idToken:i,email:this._email,oobCode:this._password});default:Yd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function g0(n,e){return PR(n,"POST","/v1/accounts:signInWithIdp",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P5e="http://localhost";class Qy extends R5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new Qy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Yd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:l}=i,d=vR(i,["providerId","signInMethod"]);if(!a||!l)return null;const f=new Qy(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(e){const i=this.buildRequest();return g0(e,i)}_linkToIdToken(e,i){const a=this.buildRequest();return a.idToken=i,g0(e,a)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,g0(e,i)}buildRequest(){const e={requestUri:P5e,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=IR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O5e(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function k5e(n){const e=Zw(eC(n)).link,i=e?Zw(eC(e)).deep_link_id:null,a=Zw(eC(n)).deep_link_id;return(a?Zw(eC(a)).link:null)||a||i||e||n}class I5{constructor(e){var i,a,l,d,f,_;const E=Zw(eC(e)),b=(i=E.apiKey)!==null&&i!==void 0?i:null,w=(a=E.oobCode)!==null&&a!==void 0?a:null,I=O5e((l=E.mode)!==null&&l!==void 0?l:null);Vn(b&&w&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=w,this.continueUrl=(d=E.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=E.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=k5e(e);try{return new I5(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(){this.providerId=X0.PROVIDER_ID}static credential(e,i){return QC._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const a=I5.parseLink(i);return Vn(a,"argument-error"),QC._fromEmailAndCode(e,a.code,a.tenantId)}}X0.PROVIDER_ID="password";X0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";X0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR extends Wie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg extends OR{constructor(){super("facebook.com")}static credential(e){return Qy._fromParams({providerId:mg.PROVIDER_ID,signInMethod:mg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return mg.credentialFromTaggedObject(e)}static credentialFromError(e){return mg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return mg.credential(e.oauthAccessToken)}catch{return null}}}mg.FACEBOOK_SIGN_IN_METHOD="facebook.com";mg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg extends OR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return Qy._fromParams({providerId:gg.PROVIDER_ID,signInMethod:gg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return gg.credentialFromTaggedObject(e)}static credentialFromError(e){return gg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:a}=e;if(!i&&!a)return null;try{return gg.credential(i,a)}catch{return null}}}gg.GOOGLE_SIGN_IN_METHOD="google.com";gg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g extends OR{constructor(){super("github.com")}static credential(e){return Qy._fromParams({providerId:_g.PROVIDER_ID,signInMethod:_g.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _g.credentialFromTaggedObject(e)}static credentialFromError(e){return _g.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return _g.credential(e.oauthAccessToken)}catch{return null}}}_g.GITHUB_SIGN_IN_METHOD="github.com";_g.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg extends OR{constructor(){super("twitter.com")}static credential(e,i){return Qy._fromParams({providerId:yg.PROVIDER_ID,signInMethod:yg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return yg.credentialFromTaggedObject(e)}static credentialFromError(e){return yg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=e;if(!i||!a)return null;try{return yg.credential(i,a)}catch{return null}}}yg.TWITTER_SIGN_IN_METHOD="twitter.com";yg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N5e(n,e){return PR(n,"POST","/v1/accounts:signUp",Qf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,a,l=!1){const d=await kf._fromIdTokenResponse(e,a,l),f=uJ(a);return new Zy({user:d,providerId:f,_tokenResponse:a,operationType:i})}static async _forOperation(e,i,a){await e._updateTokensIfNecessary(a,!0);const l=uJ(a);return new Zy({user:e,providerId:l,_tokenResponse:a,operationType:i})}}function uJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uk extends bp{constructor(e,i,a,l){var d;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,uk.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,i,a,l){return new uk(e,i,a,l)}}function zie(n,e,i,a){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?uk._fromErrorAndOperation(n,d,e,a):d})}async function D5e(n,e,i=!1){const a=await JC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return Zy._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x5e(n,e,i=!1){const{auth:a}=n;if(Ll(a.app))return Promise.reject(Ff(a));const l="reauthenticate";try{const d=await JC(n,zie(a,l,e,n),i);Vn(d.idToken,a,"internal-error");const f=w5(d.idToken);Vn(f,a,"internal-error");const{sub:_}=f;return Vn(n.uid===_,a,"user-mismatch"),Zy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Yd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gie(n,e,i=!1){if(Ll(n.app))return Promise.reject(Ff(n));const a="signIn",l=await zie(n,a,e),d=await Zy._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(d.user),d}async function L5e(n,e){return Gie(aE(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hie(n){const e=aE(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function M5e(n,e,i){if(Ll(n.app))return Promise.reject(Ff(n));const a=aE(n),f=await dj(a,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",N5e).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&Hie(n),E}),_=await Zy._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(_.user),_}function U5e(n,e,i){return Ll(n.app)?Promise.reject(Ff(n)):L5e(Xi(n),X0.credential(e,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Hie(n),a})}async function V5e(n,e){const i=Xi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await R5e(i.auth,l);d!==n.email&&await n.reload()}function j5e(n,e,i,a){return Xi(n).onIdTokenChanged(e,i,a)}function F5e(n,e,i){return Xi(n).beforeAuthStateChanged(e,i)}function $ie(n,e,i,a){return Xi(n).onAuthStateChanged(e,i,a)}function B5e(n){return Xi(n).signOut()}const dk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kie{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(dk,"1"),this.storage.removeItem(dk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W5e=1e3,z5e=10;class qie extends Kie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Uie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&e(i,l,a)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((f,_,E)=>{this.notifyListeners(f,E)});return}const a=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!i&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);i5e()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,z5e):l()}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:a}),!0)})},W5e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}qie.type="LOCAL";const G5e=qie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie extends Kie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Yie.type="SESSION";const Xie=Yie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H5e(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const a=new hN(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:a,eventType:l,data:d}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const _=Array.from(f).map(async b=>b(i.origin,d)),E=await H5e(_);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}hN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A5(n="",e=10){let i="";for(let a=0;a<e;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $5e{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((_,E)=>{const b=A5("",20);l.port1.start();const w=setTimeout(()=>{E(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const k=I;if(k.data.eventId===b)switch(k.data.status){case"ack":clearTimeout(w),d=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),_(k.data.response);break;default:clearTimeout(w),clearTimeout(d),E(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pp(){return window}function K5e(n){pp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jie(){return typeof pp().WorkerGlobalScope<"u"&&typeof pp().importScripts=="function"}async function q5e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Y5e(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function X5e(){return Jie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qie="firebaseLocalStorageDb",J5e=1,hk="firebaseLocalStorage",Zie="fbase_key";class kR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function pN(n,e){return n.transaction([hk],e?"readwrite":"readonly").objectStore(hk)}function Q5e(){const n=indexedDB.deleteDatabase(Qie);return new kR(n).toPromise()}function hj(){const n=indexedDB.open(Qie,J5e);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(hk,{keyPath:Zie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(hk)?e(a):(a.close(),await Q5e(),e(await hj()))})})}async function dJ(n,e,i){const a=pN(n,!0).put({[Zie]:e,value:i});return new kR(a).toPromise()}async function Z5e(n,e){const i=pN(n,!1).get(e),a=await new kR(i).toPromise();return a===void 0?null:a.value}function hJ(n,e){const i=pN(n,!0).delete(e);return new kR(i).toPromise()}const e3e=800,t3e=3;class ese{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hj(),this.db)}async _withRetries(e){let i=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(i++>t3e)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Jie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hN._getInstance(X5e()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await q5e(),!this.activeServiceWorker)return;this.sender=new $5e(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Y5e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hj();return await dJ(e,dk,"1"),await hJ(e,dk),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>dJ(a,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(a=>Z5e(a,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>hJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const d=pN(l,!1).getAll();return new kR(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(e.length!==0)for(const{fbase_key:l,value:d}of e)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),e3e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ese.type="LOCAL";const n3e=ese;new AR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r3e(n,e){return e?Nf(e):(Vn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5 extends R5{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return g0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return g0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return g0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function i3e(n){return Gie(n.auth,new P5(n),n.bypassAuthState)}function s3e(n){const{auth:e,user:i}=n;return Vn(i,e,"internal-error"),x5e(i,new P5(n),n.bypassAuthState)}async function o3e(n){const{auth:e,user:i}=n;return Vn(i,e,"internal-error"),D5e(i,new P5(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tse{constructor(e,i,a,l,d=!1){this.auth=e,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:a,postBody:l,tenantId:d,error:f,type:_}=e;if(f){this.reject(f);return}const E={auth:this.auth,requestUri:i,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return i3e;case"linkViaPopup":case"linkViaRedirect":return o3e;case"reauthViaPopup":case"reauthViaRedirect":return s3e;default:Yd(this.auth,"internal-error")}}resolve(e){$f(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$f(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a3e=new AR(2e3,1e4);class e0 extends tse{constructor(e,i,a,l,d){super(e,i,l,d),this.provider=a,this.authWindow=null,this.pollId=null,e0.currentPopupAction&&e0.currentPopupAction.cancel(),e0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Vn(e,this.auth,"internal-error"),e}async onExecution(){$f(this.filter.length===1,"Popup operations only handle one event");const e=A5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(hp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(hp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,e0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(hp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,a3e.get())};e()}}e0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c3e="pendingRedirect",NO=new Map;class l3e extends tse{constructor(e,i,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let e=NO.get(this.auth._key());if(!e){try{const a=await u3e(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(i){e=()=>Promise.reject(i)}NO.set(this.auth._key(),e)}return this.bypassAuthState||NO.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function u3e(n,e){const i=p3e(e),a=h3e(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function d3e(n,e){NO.set(n._key(),e)}function h3e(n){return Nf(n._redirectPersistence)}function p3e(n){return kO(c3e,n.config.apiKey,n.name)}async function f3e(n,e,i=!1){if(Ll(n.app))return Promise.reject(Ff(n));const a=aE(n),l=r3e(a,e),f=await new l3e(a,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m3e=10*60*1e3;class g3e{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(i=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!_3e(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var a;if(e.error&&!nse(e)){const l=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(hp(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const a=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=m3e&&this.cachedEventUids.clear(),this.cachedEventUids.has(pJ(e))}saveEventToCache(e){this.cachedEventUids.add(pJ(e)),this.lastProcessedEventTime=Date.now()}}function pJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function nse({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function _3e(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nse(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y3e(n,e={}){return Zf(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,v3e=/^https?/;async function S3e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await y3e(n);for(const i of e)try{if(b3e(i))return}catch{}Yd(n,"unauthorized-domain")}function b3e(n){const e=lj(),{protocol:i,hostname:a}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===a}if(!v3e.test(i))return!1;if(E3e.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T3e=new AR(3e4,6e4);function fJ(){const n=pp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function w3e(n){return new Promise((e,i)=>{var a,l,d;function f(){fJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fJ(),i(hp(n,"network-request-failed"))},timeout:T3e.get()})}if(!((l=(a=pp().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((d=pp().gapi)===null||d===void 0)&&d.load)f();else{const _=p5e("iframefcb");return pp()[_]=()=>{gapi.load?f():i(hp(n,"network-request-failed"))},jie(`${h5e()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw DO=null,e})}let DO=null;function C3e(n){return DO=DO||w3e(n),DO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R3e=new AR(5e3,15e3),I3e="__/auth/iframe",A3e="emulator/auth/iframe",P3e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},O3e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function k3e(n){const e=n.config;Vn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?T5(e,A3e):`https://${n.config.authDomain}/${I3e}`,a={apiKey:e.apiKey,appName:n.name,v:oE},l=O3e.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${i}?${IR(a).slice(1)}`}async function N3e(n){const e=await C3e(n),i=pp().gapi;return Vn(i,n,"internal-error"),e.open({where:document.body,url:k3e(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:P3e,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=hp(n,"network-request-failed"),_=pp().setTimeout(()=>{d(f)},R3e.get());function E(){pp().clearTimeout(_),l(a)}a.ping(E).then(E,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D3e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},x3e=500,L3e=600,M3e="_blank",U3e="http://localhost";class mJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function V3e(n,e,i,a=x3e,l=L3e){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let _="";const E=Object.assign(Object.assign({},D3e),{width:a.toString(),height:l.toString(),top:d,left:f}),b=Wa().toLowerCase();i&&(_=Nie(b)?M3e:i),Oie(b)&&(e=e||U3e,E.scrollbars="yes");const w=Object.entries(E).reduce((k,[V,L])=>`${k}${V}=${L},`,"");if(r5e(b)&&_!=="_self")return j3e(e||"",_),new mJ(null);const I=window.open(e||"",_,w);Vn(I,n,"popup-blocked");try{I.focus()}catch{}return new mJ(I)}function j3e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F3e="__/auth/handler",B3e="emulator/auth/handler",W3e=encodeURIComponent("fac");async function gJ(n,e,i,a,l,d){Vn(n.config.authDomain,n,"auth-domain-config-required"),Vn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:oE,eventId:l};if(e instanceof Wie){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",Rje(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[w,I]of Object.entries({}))f[w]=I}if(e instanceof OR){const w=e.getScopes().filter(I=>I!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const _=f;for(const w of Object.keys(_))_[w]===void 0&&delete _[w];const E=await n._getAppCheckToken(),b=E?`#${W3e}=${encodeURIComponent(E)}`:"";return`${z3e(n)}?${IR(_).slice(1)}${b}`}function z3e({config:n}){return n.emulator?T5(n,B3e):`https://${n.authDomain}/${F3e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NU="webStorageSupport";class G3e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xie,this._completeRedirectFn=f3e,this._overrideRedirectResult=d3e}async _openPopup(e,i,a,l){var d;$f((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await gJ(e,i,a,lj(),l);return V3e(e,f,A5())}async _openRedirect(e,i,a,l){await this._originValidation(e);const d=await gJ(e,i,a,lj(),l);return K5e(d),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):($f(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(e);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(e){const i=await N3e(e),a=new g3e(e);return i.register("authEvent",l=>(Vn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=i,a}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(NU,{type:NU},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[NU];f!==void 0&&i(!!f),Yd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=S3e(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Uie()||kie()||C5()}}const H3e=G3e;var _J="@firebase/auth",yJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $3e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Vn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K3e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function q3e(n){Jy(new Lg("auth",(e,{options:i})=>{const a=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:f,authDomain:_}=a.options;Vn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const E={apiKey:f,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vie(n)},b=new l5e(a,l,d,E);return E5e(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,a)=>{e.getProvider("auth-internal").initialize()})),Jy(new Lg("auth-internal",e=>{const i=aE(e.getProvider("auth").getImmediate());return(a=>new $3e(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),dp(_J,yJ,K3e(n)),dp(_J,yJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y3e=5*60,X3e=fie("authIdTokenMaxAge")||Y3e;let EJ=null;const J3e=n=>async e=>{const i=e&&await e.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>X3e)return;const l=i==null?void 0:i.token;EJ!==l&&(EJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function fN(n=S5()){const e=uN(n,"auth");if(e.isInitialized())return e.getImmediate();const i=y5e(n,{popupRedirectResolver:H3e,persistence:[n3e,G5e,Xie]}),a=fie("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=J3e(d.toString());F5e(i,f,()=>f(i.currentUser)),j5e(i,_=>f(_))}}const l=die("auth");return l&&v5e(i,`http://${l}`),i}function Q3e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}u5e({loadJS(n){return new Promise((e,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=e,a.onerror=l=>{const d=hp("internal-error");d.customData=l,i(d)},a.type="text/javascript",a.charset="UTF-8",Q3e().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});q3e("Browser");var vJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ag,rse;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Z,ee){function ne(){}ne.prototype=ee.prototype,Z.D=ee.prototype,Z.prototype=new ne,Z.prototype.constructor=Z,Z.C=function(oe,ge,pe){for(var le=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)le[Me-2]=arguments[Me];return ee.prototype[ge].apply(oe,le)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Z,ee,ne){ne||(ne=0);var oe=Array(16);if(typeof ee=="string")for(var ge=0;16>ge;++ge)oe[ge]=ee.charCodeAt(ne++)|ee.charCodeAt(ne++)<<8|ee.charCodeAt(ne++)<<16|ee.charCodeAt(ne++)<<24;else for(ge=0;16>ge;++ge)oe[ge]=ee[ne++]|ee[ne++]<<8|ee[ne++]<<16|ee[ne++]<<24;ee=Z.g[0],ne=Z.g[1],ge=Z.g[2];var pe=Z.g[3],le=ee+(pe^ne&(ge^pe))+oe[0]+3614090360&4294967295;ee=ne+(le<<7&4294967295|le>>>25),le=pe+(ge^ee&(ne^ge))+oe[1]+3905402710&4294967295,pe=ee+(le<<12&4294967295|le>>>20),le=ge+(ne^pe&(ee^ne))+oe[2]+606105819&4294967295,ge=pe+(le<<17&4294967295|le>>>15),le=ne+(ee^ge&(pe^ee))+oe[3]+3250441966&4294967295,ne=ge+(le<<22&4294967295|le>>>10),le=ee+(pe^ne&(ge^pe))+oe[4]+4118548399&4294967295,ee=ne+(le<<7&4294967295|le>>>25),le=pe+(ge^ee&(ne^ge))+oe[5]+1200080426&4294967295,pe=ee+(le<<12&4294967295|le>>>20),le=ge+(ne^pe&(ee^ne))+oe[6]+2821735955&4294967295,ge=pe+(le<<17&4294967295|le>>>15),le=ne+(ee^ge&(pe^ee))+oe[7]+4249261313&4294967295,ne=ge+(le<<22&4294967295|le>>>10),le=ee+(pe^ne&(ge^pe))+oe[8]+1770035416&4294967295,ee=ne+(le<<7&4294967295|le>>>25),le=pe+(ge^ee&(ne^ge))+oe[9]+2336552879&4294967295,pe=ee+(le<<12&4294967295|le>>>20),le=ge+(ne^pe&(ee^ne))+oe[10]+4294925233&4294967295,ge=pe+(le<<17&4294967295|le>>>15),le=ne+(ee^ge&(pe^ee))+oe[11]+2304563134&4294967295,ne=ge+(le<<22&4294967295|le>>>10),le=ee+(pe^ne&(ge^pe))+oe[12]+1804603682&4294967295,ee=ne+(le<<7&4294967295|le>>>25),le=pe+(ge^ee&(ne^ge))+oe[13]+4254626195&4294967295,pe=ee+(le<<12&4294967295|le>>>20),le=ge+(ne^pe&(ee^ne))+oe[14]+2792965006&4294967295,ge=pe+(le<<17&4294967295|le>>>15),le=ne+(ee^ge&(pe^ee))+oe[15]+1236535329&4294967295,ne=ge+(le<<22&4294967295|le>>>10),le=ee+(ge^pe&(ne^ge))+oe[1]+4129170786&4294967295,ee=ne+(le<<5&4294967295|le>>>27),le=pe+(ne^ge&(ee^ne))+oe[6]+3225465664&4294967295,pe=ee+(le<<9&4294967295|le>>>23),le=ge+(ee^ne&(pe^ee))+oe[11]+643717713&4294967295,ge=pe+(le<<14&4294967295|le>>>18),le=ne+(pe^ee&(ge^pe))+oe[0]+3921069994&4294967295,ne=ge+(le<<20&4294967295|le>>>12),le=ee+(ge^pe&(ne^ge))+oe[5]+3593408605&4294967295,ee=ne+(le<<5&4294967295|le>>>27),le=pe+(ne^ge&(ee^ne))+oe[10]+38016083&4294967295,pe=ee+(le<<9&4294967295|le>>>23),le=ge+(ee^ne&(pe^ee))+oe[15]+3634488961&4294967295,ge=pe+(le<<14&4294967295|le>>>18),le=ne+(pe^ee&(ge^pe))+oe[4]+3889429448&4294967295,ne=ge+(le<<20&4294967295|le>>>12),le=ee+(ge^pe&(ne^ge))+oe[9]+568446438&4294967295,ee=ne+(le<<5&4294967295|le>>>27),le=pe+(ne^ge&(ee^ne))+oe[14]+3275163606&4294967295,pe=ee+(le<<9&4294967295|le>>>23),le=ge+(ee^ne&(pe^ee))+oe[3]+4107603335&4294967295,ge=pe+(le<<14&4294967295|le>>>18),le=ne+(pe^ee&(ge^pe))+oe[8]+1163531501&4294967295,ne=ge+(le<<20&4294967295|le>>>12),le=ee+(ge^pe&(ne^ge))+oe[13]+2850285829&4294967295,ee=ne+(le<<5&4294967295|le>>>27),le=pe+(ne^ge&(ee^ne))+oe[2]+4243563512&4294967295,pe=ee+(le<<9&4294967295|le>>>23),le=ge+(ee^ne&(pe^ee))+oe[7]+1735328473&4294967295,ge=pe+(le<<14&4294967295|le>>>18),le=ne+(pe^ee&(ge^pe))+oe[12]+2368359562&4294967295,ne=ge+(le<<20&4294967295|le>>>12),le=ee+(ne^ge^pe)+oe[5]+4294588738&4294967295,ee=ne+(le<<4&4294967295|le>>>28),le=pe+(ee^ne^ge)+oe[8]+2272392833&4294967295,pe=ee+(le<<11&4294967295|le>>>21),le=ge+(pe^ee^ne)+oe[11]+1839030562&4294967295,ge=pe+(le<<16&4294967295|le>>>16),le=ne+(ge^pe^ee)+oe[14]+4259657740&4294967295,ne=ge+(le<<23&4294967295|le>>>9),le=ee+(ne^ge^pe)+oe[1]+2763975236&4294967295,ee=ne+(le<<4&4294967295|le>>>28),le=pe+(ee^ne^ge)+oe[4]+1272893353&4294967295,pe=ee+(le<<11&4294967295|le>>>21),le=ge+(pe^ee^ne)+oe[7]+4139469664&4294967295,ge=pe+(le<<16&4294967295|le>>>16),le=ne+(ge^pe^ee)+oe[10]+3200236656&4294967295,ne=ge+(le<<23&4294967295|le>>>9),le=ee+(ne^ge^pe)+oe[13]+681279174&4294967295,ee=ne+(le<<4&4294967295|le>>>28),le=pe+(ee^ne^ge)+oe[0]+3936430074&4294967295,pe=ee+(le<<11&4294967295|le>>>21),le=ge+(pe^ee^ne)+oe[3]+3572445317&4294967295,ge=pe+(le<<16&4294967295|le>>>16),le=ne+(ge^pe^ee)+oe[6]+76029189&4294967295,ne=ge+(le<<23&4294967295|le>>>9),le=ee+(ne^ge^pe)+oe[9]+3654602809&4294967295,ee=ne+(le<<4&4294967295|le>>>28),le=pe+(ee^ne^ge)+oe[12]+3873151461&4294967295,pe=ee+(le<<11&4294967295|le>>>21),le=ge+(pe^ee^ne)+oe[15]+530742520&4294967295,ge=pe+(le<<16&4294967295|le>>>16),le=ne+(ge^pe^ee)+oe[2]+3299628645&4294967295,ne=ge+(le<<23&4294967295|le>>>9),le=ee+(ge^(ne|~pe))+oe[0]+4096336452&4294967295,ee=ne+(le<<6&4294967295|le>>>26),le=pe+(ne^(ee|~ge))+oe[7]+1126891415&4294967295,pe=ee+(le<<10&4294967295|le>>>22),le=ge+(ee^(pe|~ne))+oe[14]+2878612391&4294967295,ge=pe+(le<<15&4294967295|le>>>17),le=ne+(pe^(ge|~ee))+oe[5]+4237533241&4294967295,ne=ge+(le<<21&4294967295|le>>>11),le=ee+(ge^(ne|~pe))+oe[12]+1700485571&4294967295,ee=ne+(le<<6&4294967295|le>>>26),le=pe+(ne^(ee|~ge))+oe[3]+2399980690&4294967295,pe=ee+(le<<10&4294967295|le>>>22),le=ge+(ee^(pe|~ne))+oe[10]+4293915773&4294967295,ge=pe+(le<<15&4294967295|le>>>17),le=ne+(pe^(ge|~ee))+oe[1]+2240044497&4294967295,ne=ge+(le<<21&4294967295|le>>>11),le=ee+(ge^(ne|~pe))+oe[8]+1873313359&4294967295,ee=ne+(le<<6&4294967295|le>>>26),le=pe+(ne^(ee|~ge))+oe[15]+4264355552&4294967295,pe=ee+(le<<10&4294967295|le>>>22),le=ge+(ee^(pe|~ne))+oe[6]+2734768916&4294967295,ge=pe+(le<<15&4294967295|le>>>17),le=ne+(pe^(ge|~ee))+oe[13]+1309151649&4294967295,ne=ge+(le<<21&4294967295|le>>>11),le=ee+(ge^(ne|~pe))+oe[4]+4149444226&4294967295,ee=ne+(le<<6&4294967295|le>>>26),le=pe+(ne^(ee|~ge))+oe[11]+3174756917&4294967295,pe=ee+(le<<10&4294967295|le>>>22),le=ge+(ee^(pe|~ne))+oe[2]+718787259&4294967295,ge=pe+(le<<15&4294967295|le>>>17),le=ne+(pe^(ge|~ee))+oe[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+ee&4294967295,Z.g[1]=Z.g[1]+(ge+(le<<21&4294967295|le>>>11))&4294967295,Z.g[2]=Z.g[2]+ge&4294967295,Z.g[3]=Z.g[3]+pe&4294967295}a.prototype.u=function(Z,ee){ee===void 0&&(ee=Z.length);for(var ne=ee-this.blockSize,oe=this.B,ge=this.h,pe=0;pe<ee;){if(ge==0)for(;pe<=ne;)l(this,Z,pe),pe+=this.blockSize;if(typeof Z=="string"){for(;pe<ee;)if(oe[ge++]=Z.charCodeAt(pe++),ge==this.blockSize){l(this,oe),ge=0;break}}else for(;pe<ee;)if(oe[ge++]=Z[pe++],ge==this.blockSize){l(this,oe),ge=0;break}}this.h=ge,this.o+=ee},a.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var ee=1;ee<Z.length-8;++ee)Z[ee]=0;var ne=8*this.o;for(ee=Z.length-8;ee<Z.length;++ee)Z[ee]=ne&255,ne/=256;for(this.u(Z),Z=Array(16),ee=ne=0;4>ee;++ee)for(var oe=0;32>oe;oe+=8)Z[ne++]=this.g[ee]>>>oe&255;return Z};function d(Z,ee){var ne=_;return Object.prototype.hasOwnProperty.call(ne,Z)?ne[Z]:ne[Z]=ee(Z)}function f(Z,ee){this.h=ee;for(var ne=[],oe=!0,ge=Z.length-1;0<=ge;ge--){var pe=Z[ge]|0;oe&&pe==ee||(ne[ge]=pe,oe=!1)}this.g=ne}var _={};function E(Z){return-128<=Z&&128>Z?d(Z,function(ee){return new f([ee|0],0>ee?-1:0)}):new f([Z|0],0>Z?-1:0)}function b(Z){if(isNaN(Z)||!isFinite(Z))return I;if(0>Z)return B(b(-Z));for(var ee=[],ne=1,oe=0;Z>=ne;oe++)ee[oe]=Z/ne|0,ne*=4294967296;return new f(ee,0)}function w(Z,ee){if(Z.length==0)throw Error("number format error: empty string");if(ee=ee||10,2>ee||36<ee)throw Error("radix out of range: "+ee);if(Z.charAt(0)=="-")return B(w(Z.substring(1),ee));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var ne=b(Math.pow(ee,8)),oe=I,ge=0;ge<Z.length;ge+=8){var pe=Math.min(8,Z.length-ge),le=parseInt(Z.substring(ge,ge+pe),ee);8>pe?(pe=b(Math.pow(ee,pe)),oe=oe.j(pe).add(b(le))):(oe=oe.j(ne),oe=oe.add(b(le)))}return oe}var I=E(0),k=E(1),V=E(16777216);n=f.prototype,n.m=function(){if(F(this))return-B(this).m();for(var Z=0,ee=1,ne=0;ne<this.g.length;ne++){var oe=this.i(ne);Z+=(0<=oe?oe:4294967296+oe)*ee,ee*=4294967296}return Z},n.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(L(this))return"0";if(F(this))return"-"+B(this).toString(Z);for(var ee=b(Math.pow(Z,6)),ne=this,oe="";;){var ge=ae(ne,ee).g;ne=q(ne,ge.j(ee));var pe=((0<ne.g.length?ne.g[0]:ne.h)>>>0).toString(Z);if(ne=ge,L(ne))return pe+oe;for(;6>pe.length;)pe="0"+pe;oe=pe+oe}},n.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function L(Z){if(Z.h!=0)return!1;for(var ee=0;ee<Z.g.length;ee++)if(Z.g[ee]!=0)return!1;return!0}function F(Z){return Z.h==-1}n.l=function(Z){return Z=q(this,Z),F(Z)?-1:L(Z)?0:1};function B(Z){for(var ee=Z.g.length,ne=[],oe=0;oe<ee;oe++)ne[oe]=~Z.g[oe];return new f(ne,~Z.h).add(k)}n.abs=function(){return F(this)?B(this):this},n.add=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),ne=[],oe=0,ge=0;ge<=ee;ge++){var pe=oe+(this.i(ge)&65535)+(Z.i(ge)&65535),le=(pe>>>16)+(this.i(ge)>>>16)+(Z.i(ge)>>>16);oe=le>>>16,pe&=65535,le&=65535,ne[ge]=le<<16|pe}return new f(ne,ne[ne.length-1]&-2147483648?-1:0)};function q(Z,ee){return Z.add(B(ee))}n.j=function(Z){if(L(this)||L(Z))return I;if(F(this))return F(Z)?B(this).j(B(Z)):B(B(this).j(Z));if(F(Z))return B(this.j(B(Z)));if(0>this.l(V)&&0>Z.l(V))return b(this.m()*Z.m());for(var ee=this.g.length+Z.g.length,ne=[],oe=0;oe<2*ee;oe++)ne[oe]=0;for(oe=0;oe<this.g.length;oe++)for(var ge=0;ge<Z.g.length;ge++){var pe=this.i(oe)>>>16,le=this.i(oe)&65535,Me=Z.i(ge)>>>16,He=Z.i(ge)&65535;ne[2*oe+2*ge]+=le*He,$(ne,2*oe+2*ge),ne[2*oe+2*ge+1]+=pe*He,$(ne,2*oe+2*ge+1),ne[2*oe+2*ge+1]+=le*Me,$(ne,2*oe+2*ge+1),ne[2*oe+2*ge+2]+=pe*Me,$(ne,2*oe+2*ge+2)}for(oe=0;oe<ee;oe++)ne[oe]=ne[2*oe+1]<<16|ne[2*oe];for(oe=ee;oe<2*ee;oe++)ne[oe]=0;return new f(ne,0)};function $(Z,ee){for(;(Z[ee]&65535)!=Z[ee];)Z[ee+1]+=Z[ee]>>>16,Z[ee]&=65535,ee++}function Q(Z,ee){this.g=Z,this.h=ee}function ae(Z,ee){if(L(ee))throw Error("division by zero");if(L(Z))return new Q(I,I);if(F(Z))return ee=ae(B(Z),ee),new Q(B(ee.g),B(ee.h));if(F(ee))return ee=ae(Z,B(ee)),new Q(B(ee.g),ee.h);if(30<Z.g.length){if(F(Z)||F(ee))throw Error("slowDivide_ only works with positive integers.");for(var ne=k,oe=ee;0>=oe.l(Z);)ne=re(ne),oe=re(oe);var ge=fe(ne,1),pe=fe(oe,1);for(oe=fe(oe,2),ne=fe(ne,2);!L(oe);){var le=pe.add(oe);0>=le.l(Z)&&(ge=ge.add(ne),pe=le),oe=fe(oe,1),ne=fe(ne,1)}return ee=q(Z,ge.j(ee)),new Q(ge,ee)}for(ge=I;0<=Z.l(ee);){for(ne=Math.max(1,Math.floor(Z.m()/ee.m())),oe=Math.ceil(Math.log(ne)/Math.LN2),oe=48>=oe?1:Math.pow(2,oe-48),pe=b(ne),le=pe.j(ee);F(le)||0<le.l(Z);)ne-=oe,pe=b(ne),le=pe.j(ee);L(pe)&&(pe=k),ge=ge.add(pe),Z=q(Z,le)}return new Q(ge,Z)}n.A=function(Z){return ae(this,Z).h},n.and=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),ne=[],oe=0;oe<ee;oe++)ne[oe]=this.i(oe)&Z.i(oe);return new f(ne,this.h&Z.h)},n.or=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),ne=[],oe=0;oe<ee;oe++)ne[oe]=this.i(oe)|Z.i(oe);return new f(ne,this.h|Z.h)},n.xor=function(Z){for(var ee=Math.max(this.g.length,Z.g.length),ne=[],oe=0;oe<ee;oe++)ne[oe]=this.i(oe)^Z.i(oe);return new f(ne,this.h^Z.h)};function re(Z){for(var ee=Z.g.length+1,ne=[],oe=0;oe<ee;oe++)ne[oe]=Z.i(oe)<<1|Z.i(oe-1)>>>31;return new f(ne,Z.h)}function fe(Z,ee){var ne=ee>>5;ee%=32;for(var oe=Z.g.length-ne,ge=[],pe=0;pe<oe;pe++)ge[pe]=0<ee?Z.i(pe+ne)>>>ee|Z.i(pe+ne+1)<<32-ee:Z.i(pe+ne);return new f(ge,Z.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,rse=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=w,Ag=f}).apply(typeof vJ<"u"?vJ:typeof self<"u"?self:typeof window<"u"?window:{});var X1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ise,tC,sse,xO,pj,ose,ase,cse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,te){return A==Array.prototype||A==Object.prototype||(A[z]=te.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof X1=="object"&&X1];for(var z=0;z<A.length;++z){var te=A[z];if(te&&te.Math==Math)return te}throw Error("Cannot find global object")}var a=i(this);function l(A,z){if(z)e:{var te=a;A=A.split(".");for(var me=0;me<A.length-1;me++){var Xe=A[me];if(!(Xe in te))break e;te=te[Xe]}A=A[A.length-1],me=te[A],z=z(me),z!=me&&z!=null&&e(te,A,{configurable:!0,writable:!0,value:z})}}function d(A,z){A instanceof String&&(A+="");var te=0,me=!1,Xe={next:function(){if(!me&&te<A.length){var lt=te++;return{value:z(lt,A[lt]),done:!1}}return me=!0,{done:!0,value:void 0}}};return Xe[Symbol.iterator]=function(){return Xe},Xe}l("Array.prototype.values",function(A){return A||function(){return d(this,function(z,te){return te})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},_=this||self;function E(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function b(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function w(A,z,te){return A.call.apply(A.bind,arguments)}function I(A,z,te){if(!A)throw Error();if(2<arguments.length){var me=Array.prototype.slice.call(arguments,2);return function(){var Xe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Xe,me),A.apply(z,Xe)}}return function(){return A.apply(z,arguments)}}function k(A,z,te){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:I,k.apply(null,arguments)}function V(A,z){var te=Array.prototype.slice.call(arguments,1);return function(){var me=te.slice();return me.push.apply(me,arguments),A.apply(this,me)}}function L(A,z){function te(){}te.prototype=z.prototype,A.aa=z.prototype,A.prototype=new te,A.prototype.constructor=A,A.Qb=function(me,Xe,lt){for(var Ut=Array(arguments.length-2),Jr=2;Jr<arguments.length;Jr++)Ut[Jr-2]=arguments[Jr];return z.prototype[Xe].apply(me,Ut)}}function F(A){const z=A.length;if(0<z){const te=Array(z);for(let me=0;me<z;me++)te[me]=A[me];return te}return[]}function B(A,z){for(let te=1;te<arguments.length;te++){const me=arguments[te];if(E(me)){const Xe=A.length||0,lt=me.length||0;A.length=Xe+lt;for(let Ut=0;Ut<lt;Ut++)A[Xe+Ut]=me[Ut]}else A.push(me)}}class q{constructor(z,te){this.i=z,this.j=te,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function $(A){return/^[\s\xa0]*$/.test(A)}function Q(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function ae(A){return ae[" "](A),A}ae[" "]=function(){};var re=Q().indexOf("Gecko")!=-1&&!(Q().toLowerCase().indexOf("webkit")!=-1&&Q().indexOf("Edge")==-1)&&!(Q().indexOf("Trident")!=-1||Q().indexOf("MSIE")!=-1)&&Q().indexOf("Edge")==-1;function fe(A,z,te){for(const me in A)z.call(te,A[me],me,A)}function Z(A,z){for(const te in A)z.call(void 0,A[te],te,A)}function ee(A){const z={};for(const te in A)z[te]=A[te];return z}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(A,z){let te,me;for(let Xe=1;Xe<arguments.length;Xe++){me=arguments[Xe];for(te in me)A[te]=me[te];for(let lt=0;lt<ne.length;lt++)te=ne[lt],Object.prototype.hasOwnProperty.call(me,te)&&(A[te]=me[te])}}function ge(A){var z=1;A=A.split(":");const te=[];for(;0<z&&A.length;)te.push(A.shift()),z--;return A.length&&te.push(A.join(":")),te}function pe(A){_.setTimeout(()=>{throw A},0)}function le(){var A=ve;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class Me{constructor(){this.h=this.g=null}add(z,te){const me=He.get();me.set(z,te),this.h?this.h.next=me:this.g=me,this.h=me}}var He=new q(()=>new tt,A=>A.reset());class tt{constructor(){this.next=this.g=this.h=null}set(z,te){this.h=z,this.g=te,this.next=null}reset(){this.next=this.g=this.h=null}}let Ee,Ie=!1,ve=new Me,Be=()=>{const A=_.Promise.resolve(void 0);Ee=()=>{A.then(ke)}};var ke=()=>{for(var A;A=le();){try{A.h.call(A.g)}catch(te){pe(te)}var z=He;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}Ie=!1};function Re(){this.s=this.s,this.C=this.C}Re.prototype.s=!1,Re.prototype.ma=function(){this.s||(this.s=!0,this.N())},Re.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function he(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}he.prototype.h=function(){this.defaultPrevented=!0};var we=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const te=()=>{};_.addEventListener("test",te,z),_.removeEventListener("test",te,z)}catch{}return A}();function Ue(A,z){if(he.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var te=this.type=A.type,me=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(re){e:{try{ae(z.nodeName);var Xe=!0;break e}catch{}Xe=!1}Xe||(z=null)}}else te=="mouseover"?z=A.fromElement:te=="mouseout"&&(z=A.toElement);this.relatedTarget=z,me?(this.clientX=me.clientX!==void 0?me.clientX:me.pageX,this.clientY=me.clientY!==void 0?me.clientY:me.pageY,this.screenX=me.screenX||0,this.screenY=me.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:Fe[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&Ue.aa.h.call(this)}}L(Ue,he);var Fe={2:"touch",3:"pen",4:"mouse"};Ue.prototype.h=function(){Ue.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var $e="closure_listenable_"+(1e6*Math.random()|0),ct=0;function it(A,z,te,me,Xe){this.listener=A,this.proxy=null,this.src=z,this.type=te,this.capture=!!me,this.ha=Xe,this.key=++ct,this.da=this.fa=!1}function Ct(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function Vt(A){this.src=A,this.g={},this.h=0}Vt.prototype.add=function(A,z,te,me,Xe){var lt=A.toString();A=this.g[lt],A||(A=this.g[lt]=[],this.h++);var Ut=an(A,z,me,Xe);return-1<Ut?(z=A[Ut],te||(z.fa=!1)):(z=new it(z,this.src,lt,!!me,Xe),z.fa=te,A.push(z)),z};function Dt(A,z){var te=z.type;if(te in A.g){var me=A.g[te],Xe=Array.prototype.indexOf.call(me,z,void 0),lt;(lt=0<=Xe)&&Array.prototype.splice.call(me,Xe,1),lt&&(Ct(z),A.g[te].length==0&&(delete A.g[te],A.h--))}}function an(A,z,te,me){for(var Xe=0;Xe<A.length;++Xe){var lt=A[Xe];if(!lt.da&&lt.listener==z&&lt.capture==!!te&&lt.ha==me)return Xe}return-1}var jn="closure_lm_"+(1e6*Math.random()|0),Qt={};function Ot(A,z,te,me,Xe){if(Array.isArray(z)){for(var lt=0;lt<z.length;lt++)Ot(A,z[lt],te,me,Xe);return null}return te=fn(te),A&&A[$e]?A.K(z,te,b(me)?!!me.capture:!1,Xe):Lt(A,z,te,!1,me,Xe)}function Lt(A,z,te,me,Xe,lt){if(!z)throw Error("Invalid event type");var Ut=b(Xe)?!!Xe.capture:!!Xe,Jr=St(A);if(Jr||(A[jn]=Jr=new Vt(A)),te=Jr.add(z,te,me,Ut,lt),te.proxy)return te;if(me=Ce(),te.proxy=me,me.src=A,me.listener=te,A.addEventListener)we||(Xe=Ut),Xe===void 0&&(Xe=!1),A.addEventListener(z.toString(),me,Xe);else if(A.attachEvent)A.attachEvent(_t(z.toString()),me);else if(A.addListener&&A.removeListener)A.addListener(me);else throw Error("addEventListener and attachEvent are unavailable.");return te}function Ce(){function A(te){return z.call(A.src,A.listener,te)}const z=vt;return A}function Ve(A,z,te,me,Xe){if(Array.isArray(z))for(var lt=0;lt<z.length;lt++)Ve(A,z[lt],te,me,Xe);else me=b(me)?!!me.capture:!!me,te=fn(te),A&&A[$e]?(A=A.i,z=String(z).toString(),z in A.g&&(lt=A.g[z],te=an(lt,te,me,Xe),-1<te&&(Ct(lt[te]),Array.prototype.splice.call(lt,te,1),lt.length==0&&(delete A.g[z],A.h--)))):A&&(A=St(A))&&(z=A.g[z.toString()],A=-1,z&&(A=an(z,te,me,Xe)),(te=-1<A?z[A]:null)&&Ye(te))}function Ye(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[$e])Dt(z.i,A);else{var te=A.type,me=A.proxy;z.removeEventListener?z.removeEventListener(te,me,A.capture):z.detachEvent?z.detachEvent(_t(te),me):z.addListener&&z.removeListener&&z.removeListener(me),(te=St(z))?(Dt(te,A),te.h==0&&(te.src=null,z[jn]=null)):Ct(A)}}}function _t(A){return A in Qt?Qt[A]:Qt[A]="on"+A}function vt(A,z){if(A.da)A=!0;else{z=new Ue(z,this);var te=A.listener,me=A.ha||A.src;A.fa&&Ye(A),A=te.call(me,z)}return A}function St(A){return A=A[jn],A instanceof Vt?A:null}var Ht="__closure_events_fn_"+(1e9*Math.random()>>>0);function fn(A){return typeof A=="function"?A:(A[Ht]||(A[Ht]=function(z){return A.handleEvent(z)}),A[Ht])}function mn(){Re.call(this),this.i=new Vt(this),this.M=this,this.F=null}L(mn,Re),mn.prototype[$e]=!0,mn.prototype.removeEventListener=function(A,z,te,me){Ve(this,A,z,te,me)};function Jt(A,z){var te,me=A.F;if(me)for(te=[];me;me=me.F)te.push(me);if(A=A.M,me=z.type||z,typeof z=="string")z=new he(z,A);else if(z instanceof he)z.target=z.target||A;else{var Xe=z;z=new he(me,A),oe(z,Xe)}if(Xe=!0,te)for(var lt=te.length-1;0<=lt;lt--){var Ut=z.g=te[lt];Xe=Hn(Ut,me,!0,z)&&Xe}if(Ut=z.g=A,Xe=Hn(Ut,me,!0,z)&&Xe,Xe=Hn(Ut,me,!1,z)&&Xe,te)for(lt=0;lt<te.length;lt++)Ut=z.g=te[lt],Xe=Hn(Ut,me,!1,z)&&Xe}mn.prototype.N=function(){if(mn.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var te=A.g[z],me=0;me<te.length;me++)Ct(te[me]);delete A.g[z],A.h--}}this.F=null},mn.prototype.K=function(A,z,te,me){return this.i.add(String(A),z,!1,te,me)},mn.prototype.L=function(A,z,te,me){return this.i.add(String(A),z,!0,te,me)};function Hn(A,z,te,me){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var Xe=!0,lt=0;lt<z.length;++lt){var Ut=z[lt];if(Ut&&!Ut.da&&Ut.capture==te){var Jr=Ut.listener,hi=Ut.ha||Ut.src;Ut.fa&&Dt(A.i,Ut),Xe=Jr.call(hi,me)!==!1&&Xe}}return Xe&&!me.defaultPrevented}function mc(A,z,te){if(typeof A=="function")te&&(A=k(A,te));else if(A&&typeof A.handleEvent=="function")A=k(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:_.setTimeout(A,z||0)}function Bt(A){A.g=mc(()=>{A.g=null,A.i&&(A.i=!1,Bt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class un extends Re{constructor(z,te){super(),this.m=z,this.l=te,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rs(A){Re.call(this),this.h=A,this.g={}}L(rs,Re);var Fs=[];function Qs(A){fe(A.g,function(z,te){this.g.hasOwnProperty(te)&&Ye(z)},A),A.g={}}rs.prototype.N=function(){rs.aa.N.call(this),Qs(this)},rs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ei=_.JSON.stringify,$a=_.JSON.parse,dl=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function _o(){}_o.prototype.h=null;function yo(A){return A.h||(A.h=A.i())}function ql(){}var Bs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function gc(){he.call(this,"d")}L(gc,he);function ua(){he.call(this,"c")}L(ua,he);var _c={},hl=null;function qu(){return hl=hl||new mn}_c.La="serverreachability";function yc(A){he.call(this,_c.La,A)}L(yc,he);function pl(A){const z=qu();Jt(z,new yc(z))}_c.STAT_EVENT="statevent";function Do(A,z){he.call(this,_c.STAT_EVENT,A),this.stat=z}L(Do,he);function Mi(A){const z=qu();Jt(z,new Do(z,A))}_c.Ma="timingevent";function ds(A,z){he.call(this,_c.Ma,A),this.size=z}L(ds,he);function Ka(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},z)}function Yu(){this.g=!0}Yu.prototype.xa=function(){this.g=!1};function Ec(A,z,te,me,Xe,lt){A.info(function(){if(A.g)if(lt)for(var Ut="",Jr=lt.split("&"),hi=0;hi<Jr.length;hi++){var Cr=Jr[hi].split("=");if(1<Cr.length){var zs=Cr[0];Cr=Cr[1];var ps=zs.split("_");Ut=2<=ps.length&&ps[1]=="type"?Ut+(zs+"="+Cr+"&"):Ut+(zs+"=redacted&")}}else Ut=null;else Ut=lt;return"XMLHTTP REQ ("+me+") [attempt "+Xe+"]: "+z+`
`+te+`
`+Ut})}function da(A,z,te,me,Xe,lt,Ut){A.info(function(){return"XMLHTTP RESP ("+me+") [ attempt "+Xe+"]: "+z+`
`+te+`
`+lt+" "+Ut})}function ha(A,z,te,me){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+Qg(A,te)+(me?" "+me:"")})}function Qd(A,z){A.info(function(){return"TIMEOUT: "+z})}Yu.prototype.info=function(){};function Qg(A,z){if(!A.g)return z;if(!z)return null;try{var te=JSON.parse(z);if(te){for(A=0;A<te.length;A++)if(Array.isArray(te[A])){var me=te[A];if(!(2>me.length)){var Xe=me[1];if(Array.isArray(Xe)&&!(1>Xe.length)){var lt=Xe[0];if(lt!="noop"&&lt!="stop"&&lt!="close")for(var Ut=1;Ut<Xe.length;Ut++)Xe[Ut]=""}}}}return Ei(te)}catch{return z}}var Xu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Tp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ws;function Ju(){}L(Ju,_o),Ju.prototype.g=function(){return new XMLHttpRequest},Ju.prototype.i=function(){return{}},Ws=new Ju;function pa(A,z,te,me){this.j=A,this.i=z,this.l=te,this.R=me||1,this.U=new rs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}var eh={},qa={};function th(A,z,te){A.L=1,A.v=Xa(Lo(z)),A.m=te,A.P=!0,Qu(A,null)}function Qu(A,z){A.F=Date.now(),$r(A),A.A=Lo(A.v);var te=A.A,me=A.R;Array.isArray(me)||(me=[String(me)]),eu(te.i,"t",me),A.C=0,te=A.j.J,A.h=new Zd,A.g=pE(A.j,te?z:null,!A.m),0<A.O&&(A.M=new un(k(A.Y,A,A.g),A.O)),z=A.U,te=A.g,me=A.ca;var Xe="readystatechange";Array.isArray(Xe)||(Xe&&(Fs[0]=Xe.toString()),Xe=Fs);for(var lt=0;lt<Xe.length;lt++){var Ut=Ot(te,Xe[lt],me||z.handleEvent,!1,z.h||z);if(!Ut)break;z.g[Ut.key]=Ut}z=A.H?ee(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),pl(),Ec(A.i,A.u,A.A,A.l,A.R,A.m)}pa.prototype.ca=function(A){A=A.target;const z=this.M;z&&Si(A)==3?z.j():this.Y(A)},pa.prototype.Y=function(A){try{if(A==this.g)e:{const ps=Si(this.g);var z=this.g.Ba();const Ja=this.g.Z();if(!(3>ps)&&(ps!=3||this.g&&(this.h.h||this.g.oa()||Ps(this.g)))){this.J||ps!=4||z==7||(z==8||0>=Ja?pl(3):pl(2)),vc(this);var te=this.g.Z();this.X=te;t:if(xo(this)){var me=Ps(this.g);A="";var Xe=me.length,lt=Si(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fa(this),fl(this);var Ut="";break t}this.h.i=new _.TextDecoder}for(z=0;z<Xe;z++)this.h.h=!0,A+=this.h.i.decode(me[z],{stream:!(lt&&z==Xe-1)});me.length=0,this.h.g+=A,this.C=0,Ut=this.h.g}else Ut=this.g.oa();if(this.o=te==200,da(this.i,this.u,this.A,this.l,this.R,ps,te),this.o){if(this.T&&!this.K){t:{if(this.g){var Jr,hi=this.g;if((Jr=hi.g?hi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(Jr)){var Cr=Jr;break t}}Cr=null}if(te=Cr)ha(this.i,this.l,te,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wp(this,te);else{this.o=!1,this.s=3,Mi(12),fa(this),fl(this);break e}}if(this.P){te=!0;let Ho;for(;!this.J&&this.C<Ut.length;)if(Ho=nh(this,Ut),Ho==qa){ps==4&&(this.s=4,Mi(14),te=!1),ha(this.i,this.l,null,"[Incomplete Response]");break}else if(Ho==eh){this.s=4,Mi(15),ha(this.i,this.l,Ut,"[Invalid Chunk]"),te=!1;break}else ha(this.i,this.l,Ho,null),wp(this,Ho);if(xo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ps!=4||Ut.length!=0||this.h.h||(this.s=1,Mi(16),te=!1),this.o=this.o&&te,!te)ha(this.i,this.l,Ut,"[Invalid Chunked Response]"),fa(this),fl(this);else if(0<Ut.length&&!this.W){this.W=!0;var zs=this.j;zs.g==this&&zs.ba&&!zs.M&&(zs.j.info("Great, no buffering proxy detected. Bytes received: "+Ut.length),e_(zs),zs.M=!0,Mi(11))}}else ha(this.i,this.l,Ut,null),wp(this,Ut);ps==4&&fa(this),this.o&&!this.J&&(ps==4?lm(this.j,this):(this.o=!1,$r(this)))}else Bo(this.g),te==400&&0<Ut.indexOf("Unknown SID")?(this.s=3,Mi(12)):(this.s=0,Mi(13)),fa(this),fl(this)}}}catch{}finally{}};function xo(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function nh(A,z){var te=A.C,me=z.indexOf(`
`,te);return me==-1?qa:(te=Number(z.substring(te,me)),isNaN(te)?eh:(me+=1,me+te>z.length?qa:(z=z.slice(me,me+te),A.C=me+te,z)))}pa.prototype.cancel=function(){this.J=!0,fa(this)};function $r(A){A.S=Date.now()+A.I,vi(A,A.I)}function vi(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=Ka(k(A.ba,A),z)}function vc(A){A.B&&(_.clearTimeout(A.B),A.B=null)}pa.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Qd(this.i,this.A),this.L!=2&&(pl(),Mi(17)),fa(this),this.s=2,fl(this)):vi(this,this.S-A)};function fl(A){A.j.G==0||A.J||lm(A.j,A)}function fa(A){vc(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,Qs(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function wp(A,z){try{var te=A.j;if(te.G!=0&&(te.g==A||Zs(te.h,A))){if(!A.K&&Zs(te.h,A)&&te.G==3){try{var me=te.Da.g.parse(z)}catch{me=null}if(Array.isArray(me)&&me.length==3){var Xe=me;if(Xe[0]==0){e:if(!te.u){if(te.g)if(te.g.F+3e3<A.F)cm(te),El(te);else break e;am(te),Mi(18)}}else te.za=Xe[1],0<te.za-te.T&&37500>Xe[2]&&te.F&&te.v==0&&!te.C&&(te.C=Ka(k(te.Za,te),6e3));if(1>=tm(te.h)&&te.ca){try{te.ca()}catch{}te.ca=void 0}}else sd(te,11)}else if((A.K||te.g==A)&&cm(te),!$(z))for(Xe=te.Da.g.parse(z),z=0;z<Xe.length;z++){let Cr=Xe[z];if(te.T=Cr[0],Cr=Cr[1],te.G==2)if(Cr[0]=="c"){te.K=Cr[1],te.ia=Cr[2];const zs=Cr[3];zs!=null&&(te.la=zs,te.j.info("VER="+te.la));const ps=Cr[4];ps!=null&&(te.Aa=ps,te.j.info("SVER="+te.Aa));const Ja=Cr[5];Ja!=null&&typeof Ja=="number"&&0<Ja&&(me=1.5*Ja,te.L=me,te.j.info("backChannelRequestTimeoutMs_="+me)),me=te;const Ho=A.g;if(Ho){const Pp=Ho.g?Ho.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pp){var lt=me.h;lt.g||Pp.indexOf("spdy")==-1&&Pp.indexOf("quic")==-1&&Pp.indexOf("h2")==-1||(lt.j=lt.l,lt.g=new Set,lt.h&&(Cp(lt,lt.h),lt.h=null))}if(me.D){const dm=Ho.g?Ho.g.getResponseHeader("X-HTTP-Session-Id"):null;dm&&(me.ya=dm,Xr(me.I,me.D,dm))}}te.G=3,te.l&&te.l.ua(),te.ba&&(te.R=Date.now()-A.F,te.j.info("Handshake RTT: "+te.R+"ms")),me=te;var Ut=A;if(me.qa=t_(me,me.J?me.ia:null,me.W),Ut.K){ml(me.h,Ut);var Jr=Ut,hi=me.L;hi&&(Jr.I=hi),Jr.B&&(vc(Jr),$r(Jr)),me.g=Ut}else nu(me);0<te.i.length&&Tc(te)}else Cr[0]!="stop"&&Cr[0]!="close"||sd(te,7);else te.G==3&&(Cr[0]=="stop"||Cr[0]=="close"?Cr[0]=="stop"?sd(te,7):Ji(te):Cr[0]!="noop"&&te.l&&te.l.ta(Cr),te.v=0)}}pl(4)}catch{}}var rh=class{constructor(A,z){this.g=A,this.map=z}};function Yl(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Eo(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function tm(A){return A.h?1:A.g?A.g.size:0}function Zs(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function Cp(A,z){A.g?A.g.add(z):A.h=z}function ml(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}Yl.prototype.cancel=function(){if(this.i=ih(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function ih(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const te of A.g.values())z=z.concat(te.D);return z}return F(A.i)}function sh(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var z=[],te=A.length,me=0;me<te;me++)z.push(A[me]);return z}z=[],te=0;for(me in A)z[te++]=A[me];return z}function yr(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var z=[];A=A.length;for(var te=0;te<A;te++)z.push(te);return z}z=[],te=0;for(const me in A)z[te++]=me;return z}}}function Xl(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var te=yr(A),me=sh(A),Xe=me.length,lt=0;lt<Xe;lt++)z.call(void 0,me[lt],te&&te[lt],A)}var Jl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zu(A,z){if(A){A=A.split("&");for(var te=0;te<A.length;te++){var me=A[te].indexOf("="),Xe=null;if(0<=me){var lt=A[te].substring(0,me);Xe=A[te].substring(me+1)}else lt=A[te];z(lt,Xe?decodeURIComponent(Xe.replace(/\+/g," ")):"")}}}function Ya(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof Ya){this.h=A.h,ed(this,A.j),this.o=A.o,this.g=A.g,gl(this,A.s),this.l=A.l;var z=A.i,te=new Mo;te.i=z.i,z.g&&(te.g=new Map(z.g),te.h=z.h),Ql(this,te),this.m=A.m}else A&&(z=String(A).match(Jl))?(this.h=!1,ed(this,z[1]||"",!0),this.o=lr(z[2]||""),this.g=lr(z[3]||"",!0),gl(this,z[4]),this.l=lr(z[5]||"",!0),Ql(this,z[6]||"",!0),this.m=lr(z[7]||"")):(this.h=!1,this.i=new Mo(null,this.h))}Ya.prototype.toString=function(){var A=[],z=this.j;z&&A.push(Sc(z,Zl,!0),":");var te=this.g;return(te||z=="file")&&(A.push("//"),(z=this.o)&&A.push(Sc(z,Zl,!0),"@"),A.push(encodeURIComponent(String(te)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),te=this.s,te!=null&&A.push(":",String(te))),(te=this.l)&&(this.g&&te.charAt(0)!="/"&&A.push("/"),A.push(Sc(te,te.charAt(0)=="/"?Rp:oh,!0))),(te=this.i.toString())&&A.push("?",te),(te=this.m)&&A.push("#",Sc(te,Ip)),A.join("")};function Lo(A){return new Ya(A)}function ed(A,z,te){A.j=te?lr(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function gl(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function Ql(A,z,te){z instanceof Mo?(A.i=z,Fo(A.i,A.h)):(te||(z=Sc(z,rm)),A.i=new Mo(z,A.h))}function Xr(A,z,te){A.i.set(z,te)}function Xa(A){return Xr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function lr(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Sc(A,z,te){return typeof A=="string"?(A=encodeURI(A).replace(z,nm),te&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function nm(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var Zl=/[#\/\?@]/g,oh=/[#\?:]/g,Rp=/[#\?]/g,rm=/[#\?@]/g,Ip=/#/g;function Mo(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function is(A){A.g||(A.g=new Map,A.h=0,A.i&&Zu(A.i,function(z,te){A.add(decodeURIComponent(z.replace(/\+/g," ")),te)}))}n=Mo.prototype,n.add=function(A,z){is(this),this.i=null,A=jo(this,A);var te=this.g.get(A);return te||this.g.set(A,te=[]),te.push(z),this.h+=1,this};function Uo(A,z){is(A),z=jo(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function Vo(A,z){return is(A),z=jo(A,z),A.g.has(z)}n.forEach=function(A,z){is(this),this.g.forEach(function(te,me){te.forEach(function(Xe){A.call(z,Xe,me,this)},this)},this)},n.na=function(){is(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),te=[];for(let me=0;me<z.length;me++){const Xe=A[me];for(let lt=0;lt<Xe.length;lt++)te.push(z[me])}return te},n.V=function(A){is(this);let z=[];if(typeof A=="string")Vo(this,A)&&(z=z.concat(this.g.get(jo(this,A))));else{A=Array.from(this.g.values());for(let te=0;te<A.length;te++)z=z.concat(A[te])}return z},n.set=function(A,z){return is(this),this.i=null,A=jo(this,A),Vo(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function eu(A,z,te){Uo(A,z),0<te.length&&(A.i=null,A.g.set(jo(A,z),F(te)),A.h+=te.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var te=0;te<z.length;te++){var me=z[te];const lt=encodeURIComponent(String(me)),Ut=this.V(me);for(me=0;me<Ut.length;me++){var Xe=lt;Ut[me]!==""&&(Xe+="="+encodeURIComponent(String(Ut[me]))),A.push(Xe)}}return this.i=A.join("&")};function jo(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function Fo(A,z){z&&!A.j&&(is(A),A.i=null,A.g.forEach(function(te,me){var Xe=me.toLowerCase();me!=Xe&&(Uo(this,me),eu(this,Xe,te))},A)),A.j=z}function im(A,z){const te=new Yu;if(_.Image){const me=new Image;me.onload=V(hs,te,"TestLoadImage: loaded",!0,z,me),me.onerror=V(hs,te,"TestLoadImage: error",!1,z,me),me.onabort=V(hs,te,"TestLoadImage: abort",!1,z,me),me.ontimeout=V(hs,te,"TestLoadImage: timeout",!1,z,me),_.setTimeout(function(){me.ontimeout&&me.ontimeout()},1e4),me.src=A}else z(!1)}function bc(A,z){const te=new Yu,me=new AbortController,Xe=setTimeout(()=>{me.abort(),hs(te,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:me.signal}).then(lt=>{clearTimeout(Xe),lt.ok?hs(te,"TestPingServer: ok",!0,z):hs(te,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(Xe),hs(te,"TestPingServer: error",!1,z)})}function hs(A,z,te,me,Xe){try{Xe&&(Xe.onload=null,Xe.onerror=null,Xe.onabort=null,Xe.ontimeout=null),me(te)}catch{}}function td(){this.g=new dl}function Ap(A,z,te){const me=te||"";try{Xl(A,function(Xe,lt){let Ut=Xe;b(Xe)&&(Ut=Ei(Xe)),z.push(me+lt+"="+encodeURIComponent(Ut))})}catch(Xe){throw z.push(me+"type="+encodeURIComponent("_badmap")),Xe}}function _l(A){this.l=A.Ub||null,this.j=A.eb||!1}L(_l,_o),_l.prototype.g=function(){return new tu(this.l,this.j)},_l.prototype.i=function(A){return function(){return A}}({});function tu(A,z){mn.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(tu,mn),n=tu.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,ga(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||_).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ma(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,ga(this)),this.g&&(this.readyState=3,ga(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;sm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function sm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?ma(this):ga(this),this.readyState==3&&sm(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,ma(this))},n.Qa=function(A){this.g&&(this.response=A,ma(this))},n.ga=function(){this.g&&ma(this)};function ma(A){A.readyState=4,A.l=null,A.j=null,A.v=null,ga(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var te=z.next();!te.done;)te=te.value,A.push(te[0]+": "+te[1]),te=z.next();return A.join(`\r
`)};function ga(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(tu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function yl(A){let z="";return fe(A,function(te,me){z+=me,z+=":",z+=te,z+=`\r
`}),z}function be(A,z,te){e:{for(me in te){var me=!1;break e}me=!0}me||(te=yl(te),typeof A=="string"?te!=null&&encodeURIComponent(String(te)):Xr(A,z,te))}function De(A){mn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(De,mn);var rt=/^https?$/i,Yt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,te,me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ws.g(),this.v=this.o?yo(this.o):yo(Ws),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(lt){Xn(this,lt);return}if(A=te||"",te=new Map(this.headers),me)if(Object.getPrototypeOf(me)===Object.prototype)for(var Xe in me)te.set(Xe,me[Xe]);else if(typeof me.keys=="function"&&typeof me.get=="function")for(const lt of me.keys())te.set(lt,me.get(lt));else throw Error("Unknown input type for opt_headers: "+String(me));me=Array.from(te.keys()).find(lt=>lt.toLowerCase()=="content-type"),Xe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Yt,z,void 0))||me||Xe||te.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[lt,Ut]of te)this.g.setRequestHeader(lt,Ut);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{jr(this),this.u=!0,this.g.send(A),this.u=!1}catch(lt){Xn(this,lt)}};function Xn(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,wr(A),dn(A)}function wr(A){A.A||(A.A=!0,Jt(A,"complete"),Jt(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,Jt(this,"complete"),Jt(this,"abort"),dn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),dn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Kr(this):this.bb())},n.bb=function(){Kr(this)};function Kr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||Si(A)!=4||A.Z()!=2)){if(A.u&&Si(A)==4)mc(A.Ea,0,A);else if(Jt(A,"readystatechange"),Si(A)==4){A.h=!1;try{const Ut=A.Z();e:switch(Ut){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var te;if(!(te=z)){var me;if(me=Ut===0){var Xe=String(A.D).match(Jl)[1]||null;!Xe&&_.self&&_.self.location&&(Xe=_.self.location.protocol.slice(0,-1)),me=!rt.test(Xe?Xe.toLowerCase():"")}te=me}if(te)Jt(A,"complete"),Jt(A,"success");else{A.m=6;try{var lt=2<Si(A)?A.g.statusText:""}catch{lt=""}A.l=lt+" ["+A.Z()+"]",wr(A)}}finally{dn(A)}}}}function dn(A,z){if(A.g){jr(A);const te=A.g,me=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||Jt(A,"ready");try{te.onreadystatechange=me}catch{}}}function jr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Si(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Si(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),$a(z)}};function Ps(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function Bo(A){const z={};A=(A.g&&2<=Si(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let me=0;me<A.length;me++){if($(A[me]))continue;var te=ge(A[me]);const Xe=te[0];if(te=te[1],typeof te!="string")continue;te=te.trim();const lt=z[Xe]||[];z[Xe]=lt,lt.push(te)}Z(z,function(me){return me.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wo(A,z,te){return te&&te.internalChannelParams&&te.internalChannelParams[A]||z}function nd(A){this.Aa=0,this.i=[],this.j=new Yu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wo("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wo("baseRetryDelayMs",5e3,A),this.cb=Wo("retryDelaySeedMs",1e4,A),this.Wa=Wo("forwardChannelMaxRetries",2,A),this.wa=Wo("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new Yl(A&&A.concurrentRequestLimit),this.Da=new td,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=nd.prototype,n.la=8,n.G=1,n.connect=function(A,z,te,me){Mi(0),this.W=A,this.H=z||{},te&&me!==void 0&&(this.H.OSID=te,this.H.OAID=me),this.F=this.X,this.I=t_(this,null,this.W),Tc(this)};function Ji(A){if(ah(A),A.G==3){var z=A.U++,te=Lo(A.I);if(Xr(te,"SID",A.K),Xr(te,"RID",z),Xr(te,"TYPE","terminate"),rd(A,te),z=new pa(A,A.j,z),z.L=2,z.v=Xa(Lo(te)),te=!1,_.navigator&&_.navigator.sendBeacon)try{te=_.navigator.sendBeacon(z.v.toString(),"")}catch{}!te&&_.Image&&(new Image().src=z.v,te=!0),te||(z.g=pE(z.j,null),z.g.ea(z.v)),z.F=Date.now(),$r(z)}od(A)}function El(A){A.g&&(e_(A),A.g.cancel(),A.g=null)}function ah(A){El(A),A.u&&(_.clearTimeout(A.u),A.u=null),cm(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function Tc(A){if(!Eo(A.h)&&!A.s){A.s=!0;var z=A.Ga;Ee||Be(),Ie||(Ee(),Ie=!0),ve.add(z,A),A.B=0}}function Zg(A,z){return tm(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=Ka(k(A.Ga,A,z),id(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Xe=new pa(this,this.j,A);let lt=this.o;if(this.S&&(lt?(lt=ee(lt),oe(lt,this.S)):lt=this.S),this.m!==null||this.O||(Xe.H=lt,lt=null),this.P)e:{for(var z=0,te=0;te<this.i.length;te++){t:{var me=this.i[te];if("__data__"in me.map&&(me=me.map.__data__,typeof me=="string")){me=me.length;break t}me=void 0}if(me===void 0)break;if(z+=me,4096<z){z=te;break e}if(z===4096||te===this.i.length-1){z=te+1;break e}}z=1e3}else z=1e3;z=zo(this,Xe,z),te=Lo(this.I),Xr(te,"RID",A),Xr(te,"CVER",22),this.D&&Xr(te,"X-HTTP-Session-Id",this.D),rd(this,te),lt&&(this.O?z="headers="+encodeURIComponent(String(yl(lt)))+"&"+z:this.m&&be(te,this.m,lt)),Cp(this.h,Xe),this.Ua&&Xr(te,"TYPE","init"),this.P?(Xr(te,"$req",z),Xr(te,"SID","null"),Xe.T=!0,th(Xe,te,null)):th(Xe,te,z),this.G=2}}else this.G==3&&(A?om(this,A):this.i.length==0||Eo(this.h)||om(this))};function om(A,z){var te;z?te=z.l:te=A.U++;const me=Lo(A.I);Xr(me,"SID",A.K),Xr(me,"RID",te),Xr(me,"AID",A.T),rd(A,me),A.m&&A.o&&be(me,A.m,A.o),te=new pa(A,A.j,te,A.B+1),A.m===null&&(te.H=A.o),z&&(A.i=z.D.concat(A.i)),z=zo(A,te,1e3),te.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Cp(A.h,te),th(te,me,z)}function rd(A,z){A.H&&fe(A.H,function(te,me){Xr(z,me,te)}),A.l&&Xl({},function(te,me){Xr(z,me,te)})}function zo(A,z,te){te=Math.min(A.i.length,te);var me=A.l?k(A.l.Na,A.l,A):null;e:{var Xe=A.i;let lt=-1;for(;;){const Ut=["count="+te];lt==-1?0<te?(lt=Xe[0].g,Ut.push("ofs="+lt)):lt=0:Ut.push("ofs="+lt);let Jr=!0;for(let hi=0;hi<te;hi++){let Cr=Xe[hi].g;const zs=Xe[hi].map;if(Cr-=lt,0>Cr)lt=Math.max(0,Xe[hi].g-100),Jr=!1;else try{Ap(zs,Ut,"req"+Cr+"_")}catch{me&&me(zs)}}if(Jr){me=Ut.join("&");break e}}}return A=A.i.splice(0,te),z.D=A,me}function nu(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;Ee||Be(),Ie||(Ee(),Ie=!0),ve.add(z,A),A.v=0}}function am(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=Ka(k(A.Fa,A),id(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,hE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=Ka(k(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mi(10),El(this),hE(this))};function e_(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function hE(A){A.g=new pa(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=Lo(A.qa);Xr(z,"RID","rpc"),Xr(z,"SID",A.K),Xr(z,"AID",A.T),Xr(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&Xr(z,"TO",A.ja),Xr(z,"TYPE","xmlhttp"),rd(A,z),A.m&&A.o&&be(z,A.m,A.o),A.L&&(A.g.I=A.L);var te=A.g;A=A.ia,te.L=1,te.v=Xa(Lo(z)),te.m=null,te.P=!0,Qu(te,A)}n.Za=function(){this.C!=null&&(this.C=null,El(this),am(this),Mi(19))};function cm(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function lm(A,z){var te=null;if(A.g==z){cm(A),e_(A),A.g=null;var me=2}else if(Zs(A.h,z))te=z.D,ml(A.h,z),me=1;else return;if(A.G!=0){if(z.o)if(me==1){te=z.m?z.m.length:0,z=Date.now()-z.F;var Xe=A.B;me=qu(),Jt(me,new ds(me,te)),Tc(A)}else nu(A);else if(Xe=z.s,Xe==3||Xe==0&&0<z.X||!(me==1&&Zg(A,z)||me==2&&am(A)))switch(te&&0<te.length&&(z=A.h,z.i=z.i.concat(te)),Xe){case 1:sd(A,5);break;case 4:sd(A,10);break;case 3:sd(A,6);break;default:sd(A,2)}}}function id(A,z){let te=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(te*=2),te*z}function sd(A,z){if(A.j.info("Error code "+z),z==2){var te=k(A.fb,A),me=A.Xa;const Xe=!me;me=new Ya(me||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||ed(me,"https"),Xa(me),Xe?im(me.toString(),te):bc(me.toString(),te)}else Mi(2);A.G=0,A.l&&A.l.sa(z),od(A),ah(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Mi(2)):(this.j.info("Failed to ping google.com"),Mi(1))};function od(A){if(A.G=0,A.ka=[],A.l){const z=ih(A.h);(z.length!=0||A.i.length!=0)&&(B(A.ka,z),B(A.ka,A.i),A.h.i.length=0,F(A.i),A.i.length=0),A.l.ra()}}function t_(A,z,te){var me=te instanceof Ya?Lo(te):new Ya(te);if(me.g!="")z&&(me.g=z+"."+me.g),gl(me,me.s);else{var Xe=_.location;me=Xe.protocol,z=z?z+"."+Xe.hostname:Xe.hostname,Xe=+Xe.port;var lt=new Ya(null);me&&ed(lt,me),z&&(lt.g=z),Xe&&gl(lt,Xe),te&&(lt.l=te),me=lt}return te=A.D,z=A.ya,te&&z&&Xr(me,te,z),Xr(me,"VER",A.la),rd(A,me),me}function pE(A,z,te){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new _l({eb:te})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Fn(){}n=Fn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function um(){}um.prototype.g=function(A,z){return new Go(A,z)};function Go(A,z){mn.call(this),this.g=new nd(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!$(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!$(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new wc(this)}L(Go,mn),Go.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Go.prototype.close=function(){Ji(this.g)},Go.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var te={};te.__data__=A,A=te}else this.u&&(te={},te.__data__=Ei(A),A=te);z.i.push(new rh(z.Ya++,A)),z.G==3&&Tc(z)},Go.prototype.N=function(){this.g.l=null,delete this.j,Ji(this.g),delete this.g,Go.aa.N.call(this)};function fE(A){gc.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const te in z){A=te;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}L(fE,gc);function mE(){ua.call(this),this.status=1}L(mE,ua);function wc(A){this.g=A}L(wc,Fn),wc.prototype.ua=function(){Jt(this.g,"a")},wc.prototype.ta=function(A){Jt(this.g,new fE(A))},wc.prototype.sa=function(A){Jt(this.g,new mE)},wc.prototype.ra=function(){Jt(this.g,"b")},um.prototype.createWebChannel=um.prototype.g,Go.prototype.send=Go.prototype.o,Go.prototype.open=Go.prototype.m,Go.prototype.close=Go.prototype.close,cse=function(){return new um},ase=function(){return qu()},ose=_c,pj={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xu.NO_ERROR=0,Xu.TIMEOUT=8,Xu.HTTP_ERROR=6,xO=Xu,Tp.COMPLETE="complete",sse=Tp,ql.EventType=Bs,Bs.OPEN="a",Bs.CLOSE="b",Bs.ERROR="c",Bs.MESSAGE="d",mn.prototype.listen=mn.prototype.K,tC=ql,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,ise=De}).apply(typeof X1<"u"?X1:typeof self<"u"?self:typeof window<"u"?window:{});const SJ="@firebase/firestore",bJ="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}La.UNAUTHENTICATED=new La(null),La.GOOGLE_CREDENTIALS=new La("google-credentials-uid"),La.FIRST_PARTY=new La("first-party-uid"),La.MOCK_USER=new La("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let J0="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eE=new E5("@firebase/firestore");function US(){return eE.logLevel}function en(n,...e){if(eE.logLevel<=Ar.DEBUG){const i=e.map(O5);eE.debug(`Firestore (${J0}): ${n}`,...i)}}function Kf(n,...e){if(eE.logLevel<=Ar.ERROR){const i=e.map(O5);eE.error(`Firestore (${J0}): ${n}`,...i)}}function D0(n,...e){if(eE.logLevel<=Ar.WARN){const i=e.map(O5);eE.warn(`Firestore (${J0}): ${n}`,...i)}}function O5(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gn(n="Unexpected state"){const e=`FIRESTORE (${J0}) INTERNAL ASSERTION FAILED: `+n;throw Kf(e),new Error(e)}function di(n,e){n||Gn()}function er(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class on extends bp{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lse{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Z3e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(La.UNAUTHENTICATED))}shutdown(){}}class e4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class t4e{constructor(e){this.t=e,this.currentUser=La.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){di(this.o===void 0);let a=this.i;const l=E=>this.i!==a?(a=this.i,i(E)):Promise.resolve();let d=new Bf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Bf,e.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const E=d;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{en("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(en("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Bf)}},0),f()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==e?(en("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(di(typeof a.accessToken=="string"),new lse(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return di(e===null||typeof e=="string"),new La(e)}}class n4e{constructor(e,i,a){this.l=e,this.h=i,this.P=a,this.type="FirstParty",this.user=La.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class r4e{constructor(e,i,a){this.l=e,this.h=i,this.P=a}getToken(){return Promise.resolve(new n4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(La.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class TJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ll(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){di(this.o===void 0);const a=d=>{d.error!=null&&en("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,en("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>a(d))};const l=d=>{en("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):en("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new TJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(di(typeof i.token=="string"),this.R=i.token,new TJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class use{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=s4e(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<i&&(a+=e.charAt(l[d]%62))}return a}}function Lr(n,e){return n<e?-1:n>e?1:0}function x0(n,e,i){return n.length===e.length&&n.every((a,l)=>i(a,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wJ=-62135596800,CJ=1e6;class fo{static now(){return fo.fromMillis(Date.now())}static fromDate(e){return fo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),a=Math.floor((e-1e3*i)*CJ);return new fo(i,a)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new on(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new on(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<wJ)throw new on(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new on(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/CJ}_compareTo(e){return this.seconds===e.seconds?Lr(this.nanoseconds,e.nanoseconds):Lr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-wJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{static fromTimestamp(e){return new Yn(e)}static min(){return new Yn(new fo(0,0))}static max(){return new Yn(new fo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RJ="__name__";class Xh{constructor(e,i,a){i===void 0?i=0:i>e.length&&Gn(),a===void 0?a=e.length-i:a>e.length-i&&Gn(),this.segments=e,this.offset=i,this.len=a}get length(){return this.len}isEqual(e){return Xh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Xh?e.forEach(a=>{i.push(a)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,a=this.limit();i<a;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const a=Math.min(e.length,i.length);for(let l=0;l<a;l++){const d=Xh.compareSegments(e.get(l),i.get(l));if(d!==0)return d}return Math.sign(e.length-i.length)}static compareSegments(e,i){const a=Xh.isNumericId(e),l=Xh.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?Xh.extractNumericId(e).compare(Xh.extractNumericId(i)):e<i?-1:e>i?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ag.fromString(e.substring(4,e.length-2))}}class $i extends Xh{construct(e,i,a){return new $i(e,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const a of e){if(a.indexOf("//")>=0)throw new on(wt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new $i(i)}static emptyPath(){return new $i([])}}const o4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class aa extends Xh{construct(e,i,a){return new aa(e,i,a)}static isValidIdentifier(e){return o4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),aa.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===RJ}static keyField(){return new aa([RJ])}static fromServerFormat(e){const i=[];let a="",l=0;const d=()=>{if(a.length===0)throw new on(wt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let f=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new on(wt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new on(wt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=E,l+=2}else _==="`"?(f=!f,l++):_!=="."||f?(a+=_,l++):(d(),l++)}if(d(),f)throw new on(wt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new aa(i)}static emptyPath(){return new aa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.path=e}static fromPath(e){return new Tn($i.fromString(e))}static fromName(e){return new Tn($i.fromString(e).popFirst(5))}static empty(){return new Tn($i.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$i.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return $i.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Tn(new $i(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZC=-1;function a4e(n,e){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Yn.fromTimestamp(a===1e9?new fo(i+1,0):new fo(i,a));return new Mg(l,Tn.empty(),e)}function c4e(n){return new Mg(n.readTime,n.key,ZC)}class Mg{constructor(e,i,a){this.readTime=e,this.documentKey=i,this.largestBatchId=a}static min(){return new Mg(Yn.min(),Tn.empty(),ZC)}static max(){return new Mg(Yn.max(),Tn.empty(),ZC)}}function l4e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Tn.comparator(n.documentKey,e.documentKey),i!==0?i:Lr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u4e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class d4e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q0(n){if(n.code!==wt.FAILED_PRECONDITION||n.message!==u4e)throw n;en("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Gn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Tt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(a,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Tt?i:Tt.resolve(i)}catch(i){return Tt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Tt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Tt.reject(i)}static resolve(e){return new Tt((i,a)=>{i(e)})}static reject(e){return new Tt((i,a)=>{a(e)})}static waitFor(e){return new Tt((i,a)=>{let l=0,d=0,f=!1;e.forEach(_=>{++l,_.next(()=>{++d,f&&d===l&&i()},E=>a(E))}),f=!0,d===l&&i()})}static or(e){let i=Tt.resolve(!1);for(const a of e)i=i.next(l=>l?Tt.resolve(l):a());return i}static forEach(e,i){const a=[];return e.forEach((l,d)=>{a.push(i.call(this,l,d))}),this.waitFor(a)}static mapArray(e,i){return new Tt((a,l)=>{const d=e.length,f=new Array(d);let _=0;for(let E=0;E<d;E++){const b=E;i(e[b]).next(w=>{f[b]=w,++_,_===d&&a(f)},w=>l(w))}})}static doWhile(e,i){return new Tt((a,l)=>{const d=()=>{e()===!0?i().next(()=>{d()},l):a()};d()})}}function h4e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function Z0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}mN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5=-1;function gN(n){return n==null}function pk(n){return n===0&&1/n==-1/0}function p4e(n){return typeof n=="number"&&Number.isInteger(n)&&!pk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dse="";function f4e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=IJ(e)),e=m4e(n.get(i),e);return IJ(e)}function m4e(n,e){let i=e;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case dse:i+="";break;default:i+=d}}return i}function IJ(n){return n+dse+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function qg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function hse(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e,i){this.comparator=e,this.root=i||sa.EMPTY}insert(e,i){return new us(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,sa.BLACK,null,null))}remove(e){return new us(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sa.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(e){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(e,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,a)=>(e(i,a),!1))}toString(){const e=[];return this.inorderTraversal((i,a)=>(e.push(`${i}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new J1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new J1(this.root,e,this.comparator,!1)}getReverseIterator(){return new J1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new J1(this.root,e,this.comparator,!0)}}class J1{constructor(e,i,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=i?a(e.key,i):1,i&&l&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sa{constructor(e,i,a,l,d){this.key=e,this.value=i,this.color=a??sa.RED,this.left=l??sa.EMPTY,this.right=d??sa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,a,l,d){return new sa(e??this.key,i??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,a){let l=this;const d=a(e,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(e,i,a),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return sa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let a,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return sa.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,sa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,sa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Gn();const e=this.left.check();if(e!==this.right.check())throw Gn();return e+(this.isRed()?0:1)}}sa.EMPTY=null,sa.RED=!0,sa.BLACK=!1;sa.EMPTY=new class{constructor(){this.size=0}get key(){throw Gn()}get value(){throw Gn()}get color(){throw Gn()}get left(){throw Gn()}get right(){throw Gn()}copy(e,i,a,l,d){return this}insert(e,i,a){return new sa(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e){this.comparator=e,this.data=new us(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,a)=>(e(i),!1))}forEachInRange(e,i){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new PJ(this.data.getIterator())}getIteratorFrom(e){return new PJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(a=>{i=i.add(a)}),i}isEqual(e){if(!(e instanceof mo)||this.size!==e.size)return!1;const i=this.data.getIterator(),a=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new mo(this.comparator);return i.data=e,i}}class PJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e){this.fields=e,e.sort(aa.comparator)}static empty(){return new Ul([])}unionWith(e){let i=new mo(aa.comparator);for(const a of this.fields)i=i.add(a);for(const a of e)i=i.add(a);return new Ul(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return x0(this.fields,e.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pse extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new pse("Invalid base64 string: "+d):d}}(e);return new ca(i)}static fromUint8Array(e){const i=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(e);return new ca(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Lr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ca.EMPTY_BYTE_STRING=new ca("");const g4e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ug(n){if(di(!!n),typeof n=="string"){let e=0;const i=g4e.exec(n);if(di(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Ms(n.seconds),nanos:Ms(n.nanos)}}function Ms(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Vg(n){return typeof n=="string"?ca.fromBase64String(n):ca.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fse="server_timestamp",mse="__type__",gse="__previous_value__",_se="__local_write_time__";function N5(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[mse])===null||i===void 0?void 0:i.stringValue)===fse}function _N(n){const e=n.mapValue.fields[gse];return N5(e)?_N(e):e}function eR(n){const e=Ug(n.mapValue.fields[_se].timestampValue);return new fo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4e{constructor(e,i,a,l,d,f,_,E,b){this.databaseId=e,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=b}}const fk="(default)";class tR{constructor(e,i){this.projectId=e,this.database=i||fk}static empty(){return new tR("","")}get isDefaultDatabase(){return this.database===fk}isEqual(e){return e instanceof tR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yse="__type__",y4e="__max__",Q1={mapValue:{}},Ese="__vector__",mk="value";function jg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?N5(n)?4:v4e(n)?9007199254740991:E4e(n)?10:11:Gn()}function _p(n,e){if(n===e)return!0;const i=jg(n);if(i!==jg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return eR(n).isEqual(eR(e));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=Ug(l.timestampValue),_=Ug(d.timestampValue);return f.seconds===_.seconds&&f.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,d){return Vg(l.bytesValue).isEqual(Vg(d.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,d){return Ms(l.geoPointValue.latitude)===Ms(d.geoPointValue.latitude)&&Ms(l.geoPointValue.longitude)===Ms(d.geoPointValue.longitude)}(n,e);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Ms(l.integerValue)===Ms(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=Ms(l.doubleValue),_=Ms(d.doubleValue);return f===_?pk(f)===pk(_):isNaN(f)&&isNaN(_)}return!1}(n,e);case 9:return x0(n.arrayValue.values||[],e.arrayValue.values||[],_p);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},_=d.mapValue.fields||{};if(AJ(f)!==AJ(_))return!1;for(const E in f)if(f.hasOwnProperty(E)&&(_[E]===void 0||!_p(f[E],_[E])))return!1;return!0}(n,e);default:return Gn()}}function nR(n,e){return(n.values||[]).find(i=>_p(i,e))!==void 0}function L0(n,e){if(n===e)return 0;const i=jg(n),a=jg(e);if(i!==a)return Lr(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return Lr(n.booleanValue,e.booleanValue);case 2:return function(d,f){const _=Ms(d.integerValue||d.doubleValue),E=Ms(f.integerValue||f.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return OJ(n.timestampValue,e.timestampValue);case 4:return OJ(eR(n),eR(e));case 5:return Lr(n.stringValue,e.stringValue);case 6:return function(d,f){const _=Vg(d),E=Vg(f);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(d,f){const _=d.split("/"),E=f.split("/");for(let b=0;b<_.length&&b<E.length;b++){const w=Lr(_[b],E[b]);if(w!==0)return w}return Lr(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(d,f){const _=Lr(Ms(d.latitude),Ms(f.latitude));return _!==0?_:Lr(Ms(d.longitude),Ms(f.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return kJ(n.arrayValue,e.arrayValue);case 10:return function(d,f){var _,E,b,w;const I=d.fields||{},k=f.fields||{},V=(_=I[mk])===null||_===void 0?void 0:_.arrayValue,L=(E=k[mk])===null||E===void 0?void 0:E.arrayValue,F=Lr(((b=V==null?void 0:V.values)===null||b===void 0?void 0:b.length)||0,((w=L==null?void 0:L.values)===null||w===void 0?void 0:w.length)||0);return F!==0?F:kJ(V,L)}(n.mapValue,e.mapValue);case 11:return function(d,f){if(d===Q1.mapValue&&f===Q1.mapValue)return 0;if(d===Q1.mapValue)return 1;if(f===Q1.mapValue)return-1;const _=d.fields||{},E=Object.keys(_),b=f.fields||{},w=Object.keys(b);E.sort(),w.sort();for(let I=0;I<E.length&&I<w.length;++I){const k=Lr(E[I],w[I]);if(k!==0)return k;const V=L0(_[E[I]],b[w[I]]);if(V!==0)return V}return Lr(E.length,w.length)}(n.mapValue,e.mapValue);default:throw Gn()}}function OJ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Lr(n,e);const i=Ug(n),a=Ug(e),l=Lr(i.seconds,a.seconds);return l!==0?l:Lr(i.nanos,a.nanos)}function kJ(n,e){const i=n.values||[],a=e.values||[];for(let l=0;l<i.length&&l<a.length;++l){const d=L0(i[l],a[l]);if(d)return d}return Lr(i.length,a.length)}function M0(n){return fj(n)}function fj(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=Ug(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Vg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Tn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const d of i.values||[])l?l=!1:a+=",",a+=fj(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${fj(i.fields[f])}`;return l+"}"}(n.mapValue):Gn()}function LO(n){switch(jg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=_N(n);return e?16+LO(e):16;case 5:return 2*n.stringValue.length;case 6:return Vg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+LO(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return qg(a.fields,(d,f)=>{l+=d.length+LO(f)}),l}(n.mapValue);default:throw Gn()}}function NJ(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function mj(n){return!!n&&"integerValue"in n}function D5(n){return!!n&&"arrayValue"in n}function DJ(n){return!!n&&"nullValue"in n}function xJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function MO(n){return!!n&&"mapValue"in n}function E4e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[yse])===null||i===void 0?void 0:i.stringValue)===Ese}function EC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return qg(n.mapValue.fields,(i,a)=>e.mapValue.fields[i]=EC(a)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=EC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function v4e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===y4e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class el{constructor(e){this.value=e}static empty(){return new el({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let a=0;a<e.length-1;++a)if(i=(i.mapValue.fields||{})[e.get(a)],!MO(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=EC(i)}setAll(e){let i=aa.emptyPath(),a={},l=[];e.forEach((f,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,a,l),a={},l=[],i=_.popLast()}f?a[_.lastSegment()]=EC(f):l.push(_.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,a,l)}delete(e){const i=this.field(e.popLast());MO(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return _p(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<e.length;++a){let l=i.mapValue.fields[e.get(a)];MO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,a){qg(i,(l,d)=>e[l]=d);for(const l of a)delete e[l]}clone(){return new el(EC(this.value))}}function vse(n){const e=[];return qg(n.fields,(i,a)=>{const l=new aa([i]);if(MO(a)){const d=vse(a.mapValue).fields;if(d.length===0)e.push(l);else for(const f of d)e.push(l.child(f))}else e.push(l)}),new Ul(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,i,a,l,d,f,_){this.key=e,this.documentType=i,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=_}static newInvalidDocument(e){return new Ma(e,0,Yn.min(),Yn.min(),Yn.min(),el.empty(),0)}static newFoundDocument(e,i,a,l){return new Ma(e,1,i,Yn.min(),a,l,0)}static newNoDocument(e,i){return new Ma(e,2,i,Yn.min(),Yn.min(),el.empty(),0)}static newUnknownDocument(e,i){return new Ma(e,3,i,Yn.min(),Yn.min(),el.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Yn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=el.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=el.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Yn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ma&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ma(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk{constructor(e,i){this.position=e,this.inclusive=i}}function LJ(n,e,i){let a=0;for(let l=0;l<n.position.length;l++){const d=e[l],f=n.position[l];if(d.field.isKeyField()?a=Tn.comparator(Tn.fromName(f.referenceValue),i.key):a=L0(f,i.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function MJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!_p(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _k{constructor(e,i="asc"){this.field=e,this.dir=i}}function S4e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sse{}class Js extends Sse{constructor(e,i,a){super(),this.field=e,this.op=i,this.value=a}static create(e,i,a){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,a):new T4e(e,i,a):i==="array-contains"?new R4e(e,a):i==="in"?new I4e(e,a):i==="not-in"?new A4e(e,a):i==="array-contains-any"?new P4e(e,a):new Js(e,i,a)}static createKeyFieldInFilter(e,i,a){return i==="in"?new w4e(e,a):new C4e(e,a)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(L0(i,this.value)):i!==null&&jg(this.value)===jg(i)&&this.matchesComparison(L0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Gn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xd extends Sse{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Xd(e,i)}matches(e){return bse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function bse(n){return n.op==="and"}function Tse(n){return b4e(n)&&bse(n)}function b4e(n){for(const e of n.filters)if(e instanceof Xd)return!1;return!0}function gj(n){if(n instanceof Js)return n.field.canonicalString()+n.op.toString()+M0(n.value);if(Tse(n))return n.filters.map(e=>gj(e)).join(",");{const e=n.filters.map(i=>gj(i)).join(",");return`${n.op}(${e})`}}function wse(n,e){return n instanceof Js?function(a,l){return l instanceof Js&&a.op===l.op&&a.field.isEqual(l.field)&&_p(a.value,l.value)}(n,e):n instanceof Xd?function(a,l){return l instanceof Xd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,_)=>d&&wse(f,l.filters[_]),!0):!1}(n,e):void Gn()}function Cse(n){return n instanceof Js?function(i){return`${i.field.canonicalString()} ${i.op} ${M0(i.value)}`}(n):n instanceof Xd?function(i){return i.op.toString()+" {"+i.getFilters().map(Cse).join(" ,")+"}"}(n):"Filter"}class T4e extends Js{constructor(e,i,a){super(e,i,a),this.key=Tn.fromName(a.referenceValue)}matches(e){const i=Tn.comparator(e.key,this.key);return this.matchesComparison(i)}}class w4e extends Js{constructor(e,i){super(e,"in",i),this.keys=Rse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class C4e extends Js{constructor(e,i){super(e,"not-in",i),this.keys=Rse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function Rse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>Tn.fromName(a.referenceValue))}class R4e extends Js{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return D5(i)&&nR(i.arrayValue,this.value)}}class I4e extends Js{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&nR(this.value.arrayValue,i)}}class A4e extends Js{constructor(e,i){super(e,"not-in",i)}matches(e){if(nR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!nR(this.value.arrayValue,i)}}class P4e extends Js{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!D5(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>nR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O4e{constructor(e,i=null,a=[],l=[],d=null,f=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=_,this.le=null}}function UJ(n,e=null,i=[],a=[],l=null,d=null,f=null){return new O4e(n,e,i,a,l,d,f)}function x5(n){const e=er(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(a=>gj(a)).join(","),i+="|ob:",i+=e.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),gN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(a=>M0(a)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(a=>M0(a)).join(",")),e.le=i}return e.le}function L5(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!S4e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!wse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!MJ(n.startAt,e.startAt)&&MJ(n.endAt,e.endAt)}function _j(n){return Tn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR{constructor(e,i=null,a=[],l=[],d=null,f="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function k4e(n,e,i,a,l,d,f,_){return new NR(n,e,i,a,l,d,f,_)}function yN(n){return new NR(n)}function VJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ise(n){return n.collectionGroup!==null}function vC(n){const e=er(n);if(e.he===null){e.he=[];const i=new Set;for(const d of e.explicitOrderBy)e.he.push(d),i.add(d.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let _=new mo(aa.comparator);return f.filters.forEach(E=>{E.getFlattenedFilters().forEach(b=>{b.isInequality()&&(_=_.add(b.field))})}),_})(e).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||e.he.push(new _k(d,a))}),i.has(aa.keyField().canonicalString())||e.he.push(new _k(aa.keyField(),a))}return e.he}function fp(n){const e=er(n);return e.Pe||(e.Pe=N4e(e,vC(n))),e.Pe}function N4e(n,e){if(n.limitType==="F")return UJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new _k(l.field,d)});const i=n.endAt?new gk(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new gk(n.startAt.position,n.startAt.inclusive):null;return UJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,a)}}function yj(n,e){const i=n.filters.concat([e]);return new NR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function yk(n,e,i){return new NR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function EN(n,e){return L5(fp(n),fp(e))&&n.limitType===e.limitType}function Ase(n){return`${x5(fp(n))}|lt:${n.limitType}`}function VS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>Cse(l)).join(", ")}]`),gN(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>M0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>M0(l)).join(",")),`Target(${a})`}(fp(n))}; limitType=${n.limitType})`}function vN(n,e){return e.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):Tn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,e)&&function(a,l){for(const d of vC(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,e)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,e)&&function(a,l){return!(a.startAt&&!function(f,_,E){const b=LJ(f,_,E);return f.inclusive?b<=0:b<0}(a.startAt,vC(a),l)||a.endAt&&!function(f,_,E){const b=LJ(f,_,E);return f.inclusive?b>=0:b>0}(a.endAt,vC(a),l))}(n,e)}function D4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Pse(n){return(e,i)=>{let a=!1;for(const l of vC(n)){const d=x4e(l,e,i);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function x4e(n,e,i){const a=n.field.isKeyField()?Tn.comparator(e.key,i.key):function(d,f,_){const E=f.data.field(d),b=_.data.field(d);return E!==null&&b!==null?L0(E,b):Gn()}(n.field,e,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Gn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,e))return d}}has(e){return this.get(e)!==void 0}set(e,i){const a=this.mapKeyFn(e),l=this.inner[a];if(l===void 0)return this.inner[a]=[[e,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],e))return void(l[d]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(e){qg(this.inner,(i,a)=>{for(const[l,d]of a)e(l,d)})}isEmpty(){return hse(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L4e=new us(Tn.comparator);function qf(){return L4e}const Ose=new us(Tn.comparator);function nC(...n){let e=Ose;for(const i of n)e=e.insert(i.key,i);return e}function kse(n){let e=Ose;return n.forEach((i,a)=>e=e.insert(i,a.overlayedDocument)),e}function Oy(){return SC()}function Nse(){return SC()}function SC(){return new cE(n=>n.toString(),(n,e)=>n.isEqual(e))}const M4e=new us(Tn.comparator),U4e=new mo(Tn.comparator);function Pr(...n){let e=U4e;for(const i of n)e=e.add(i);return e}const V4e=new mo(Lr);function j4e(){return V4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M5(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pk(e)?"-0":e}}function Dse(n){return{integerValue:""+n}}function F4e(n,e){return p4e(e)?Dse(e):M5(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SN{constructor(){this._=void 0}}function B4e(n,e,i){return n instanceof rR?function(l,d){const f={fields:{[mse]:{stringValue:fse},[_se]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&N5(d)&&(d=_N(d)),d&&(f.fields[gse]=d),{mapValue:f}}(i,e):n instanceof iR?Lse(n,e):n instanceof sR?Mse(n,e):function(l,d){const f=xse(l,d),_=jJ(f)+jJ(l.Ie);return mj(f)&&mj(l.Ie)?Dse(_):M5(l.serializer,_)}(n,e)}function W4e(n,e,i){return n instanceof iR?Lse(n,e):n instanceof sR?Mse(n,e):i}function xse(n,e){return n instanceof Ek?function(a){return mj(a)||function(d){return!!d&&"doubleValue"in d}(a)}(e)?e:{integerValue:0}:null}class rR extends SN{}class iR extends SN{constructor(e){super(),this.elements=e}}function Lse(n,e){const i=Use(e);for(const a of n.elements)i.some(l=>_p(l,a))||i.push(a);return{arrayValue:{values:i}}}class sR extends SN{constructor(e){super(),this.elements=e}}function Mse(n,e){let i=Use(e);for(const a of n.elements)i=i.filter(l=>!_p(l,a));return{arrayValue:{values:i}}}class Ek extends SN{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function jJ(n){return Ms(n.integerValue||n.doubleValue)}function Use(n){return D5(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z4e{constructor(e,i){this.field=e,this.transform=i}}function G4e(n,e){return n.field.isEqual(e.field)&&function(a,l){return a instanceof iR&&l instanceof iR||a instanceof sR&&l instanceof sR?x0(a.elements,l.elements,_p):a instanceof Ek&&l instanceof Ek?_p(a.Ie,l.Ie):a instanceof rR&&l instanceof rR}(n.transform,e.transform)}class H4e{constructor(e,i){this.version=e,this.transformResults=i}}class Kd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Kd}static exists(e){return new Kd(void 0,e)}static updateTime(e){return new Kd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function UO(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class bN{}function Vse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Fse(n.key,Kd.none()):new DR(n.key,n.data,Kd.none());{const i=n.data,a=el.empty();let l=new mo(aa.comparator);for(let d of e.fields)if(!l.has(d)){let f=i.field(d);f===null&&d.length>1&&(d=d.popLast(),f=i.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new Yg(n.key,a,new Ul(l.toArray()),Kd.none())}}function $4e(n,e,i){n instanceof DR?function(l,d,f){const _=l.value.clone(),E=BJ(l.fieldTransforms,d,f.transformResults);_.setAll(E),d.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,e,i):n instanceof Yg?function(l,d,f){if(!UO(l.precondition,d))return void d.convertToUnknownDocument(f.version);const _=BJ(l.fieldTransforms,d,f.transformResults),E=d.data;E.setAll(jse(l)),E.setAll(_),d.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,e,i):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,i)}function bC(n,e,i,a){return n instanceof DR?function(d,f,_,E){if(!UO(d.precondition,f))return _;const b=d.value.clone(),w=WJ(d.fieldTransforms,E,f);return b.setAll(w),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,e,i,a):n instanceof Yg?function(d,f,_,E){if(!UO(d.precondition,f))return _;const b=WJ(d.fieldTransforms,E,f),w=f.data;return w.setAll(jse(d)),w.setAll(b),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),_===null?null:_.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,e,i,a):function(d,f,_){return UO(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):_}(n,e,i)}function K4e(n,e){let i=null;for(const a of n.fieldTransforms){const l=e.data.field(a.field),d=xse(a.transform,l||null);d!=null&&(i===null&&(i=el.empty()),i.set(a.field,d))}return i||null}function FJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&x0(a,l,(d,f)=>G4e(d,f))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class DR extends bN{constructor(e,i,a,l=[]){super(),this.key=e,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Yg extends bN{constructor(e,i,a,l,d=[]){super(),this.key=e,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function jse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);e.set(i,a)}}),e}function BJ(n,e,i){const a=new Map;di(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],f=d.transform,_=e.data.field(d.field);a.set(d.field,W4e(f,_,i[l]))}return a}function WJ(n,e,i){const a=new Map;for(const l of n){const d=l.transform,f=i.data.field(l.field);a.set(l.field,B4e(d,f,e))}return a}class Fse extends bN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class q4e extends bN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4e{constructor(e,i,a,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(e,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(e.key)&&$4e(d,e,a[l])}}applyToLocalView(e,i){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(i=bC(a,e,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(i=bC(a,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const a=Nse();return this.mutations.forEach(l=>{const d=e.get(l.key),f=d.overlayedDocument;let _=this.applyToLocalView(f,d.mutatedFields);_=i.has(l.key)?null:_;const E=Vse(f,_);E!==null&&a.set(l.key,E),f.isValidDocument()||f.convertToNoDocument(Yn.min())}),a}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Pr())}isEqual(e){return this.batchId===e.batchId&&x0(this.mutations,e.mutations,(i,a)=>FJ(i,a))&&x0(this.baseMutations,e.baseMutations,(i,a)=>FJ(i,a))}}class U5{constructor(e,i,a,l){this.batch=e,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(e,i,a){di(e.mutations.length===a.length);let l=function(){return M4e}();const d=e.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new U5(e,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $s,Vr;function Q4e(n){switch(n){case wt.OK:return Gn();case wt.CANCELLED:case wt.UNKNOWN:case wt.DEADLINE_EXCEEDED:case wt.RESOURCE_EXHAUSTED:case wt.INTERNAL:case wt.UNAVAILABLE:case wt.UNAUTHENTICATED:return!1;case wt.INVALID_ARGUMENT:case wt.NOT_FOUND:case wt.ALREADY_EXISTS:case wt.PERMISSION_DENIED:case wt.FAILED_PRECONDITION:case wt.ABORTED:case wt.OUT_OF_RANGE:case wt.UNIMPLEMENTED:case wt.DATA_LOSS:return!0;default:return Gn()}}function Bse(n){if(n===void 0)return Kf("GRPC error has no .code"),wt.UNKNOWN;switch(n){case $s.OK:return wt.OK;case $s.CANCELLED:return wt.CANCELLED;case $s.UNKNOWN:return wt.UNKNOWN;case $s.DEADLINE_EXCEEDED:return wt.DEADLINE_EXCEEDED;case $s.RESOURCE_EXHAUSTED:return wt.RESOURCE_EXHAUSTED;case $s.INTERNAL:return wt.INTERNAL;case $s.UNAVAILABLE:return wt.UNAVAILABLE;case $s.UNAUTHENTICATED:return wt.UNAUTHENTICATED;case $s.INVALID_ARGUMENT:return wt.INVALID_ARGUMENT;case $s.NOT_FOUND:return wt.NOT_FOUND;case $s.ALREADY_EXISTS:return wt.ALREADY_EXISTS;case $s.PERMISSION_DENIED:return wt.PERMISSION_DENIED;case $s.FAILED_PRECONDITION:return wt.FAILED_PRECONDITION;case $s.ABORTED:return wt.ABORTED;case $s.OUT_OF_RANGE:return wt.OUT_OF_RANGE;case $s.UNIMPLEMENTED:return wt.UNIMPLEMENTED;case $s.DATA_LOSS:return wt.DATA_LOSS;default:return Gn()}}(Vr=$s||($s={}))[Vr.OK=0]="OK",Vr[Vr.CANCELLED=1]="CANCELLED",Vr[Vr.UNKNOWN=2]="UNKNOWN",Vr[Vr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vr[Vr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vr[Vr.NOT_FOUND=5]="NOT_FOUND",Vr[Vr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vr[Vr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vr[Vr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vr[Vr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vr[Vr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vr[Vr.ABORTED=10]="ABORTED",Vr[Vr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vr[Vr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vr[Vr.INTERNAL=13]="INTERNAL",Vr[Vr.UNAVAILABLE=14]="UNAVAILABLE",Vr[Vr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z4e(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eBe=new Ag([4294967295,4294967295],0);function zJ(n){const e=Z4e().encode(n),i=new rse;return i.update(e),new Uint8Array(i.digest())}function GJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),a=e.getUint32(4,!0),l=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new Ag([i,a],0),new Ag([l,d],0)]}class V5{constructor(e,i,a){if(this.bitmap=e,this.padding=i,this.hashCount=a,i<0||i>=8)throw new rC(`Invalid padding: ${i}`);if(a<0)throw new rC(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new rC(`Invalid hash count: ${a}`);if(e.length===0&&i!==0)throw new rC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Ag.fromNumber(this.Ee)}Ae(e,i,a){let l=e.add(i.multiply(Ag.fromNumber(a)));return l.compare(eBe)===1&&(l=new Ag([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=zJ(e),[a,l]=GJ(i);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(e,i,a){const l=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),f=new V5(d,l,i);return a.forEach(_=>f.insert(_)),f}insert(e){if(this.Ee===0)return;const i=zJ(e),[a,l]=GJ(i);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(e){const i=Math.floor(e/8),a=e%8;this.bitmap[i]|=1<<a}}class rC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(e,i,a,l,d){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,i,a){const l=new Map;return l.set(e,xR.createSynthesizedTargetChangeForCurrentChange(e,i,a)),new TN(Yn.min(),l,new us(Lr),qf(),Pr())}}class xR{constructor(e,i,a,l,d){this.resumeToken=e,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,i,a){return new xR(a,i,Pr(),Pr(),Pr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VO{constructor(e,i,a,l){this.me=e,this.removedTargetIds=i,this.key=a,this.fe=l}}class Wse{constructor(e,i){this.targetId=e,this.ge=i}}class zse{constructor(e,i,a=ca.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=a,this.cause=l}}class HJ{constructor(){this.pe=0,this.ye=$J(),this.we=ca.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=Pr(),i=Pr(),a=Pr();return this.ye.forEach((l,d)=>{switch(d){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:Gn()}}),new xR(this.we,this.be,e,i,a)}Me(){this.Se=!1,this.ye=$J()}xe(e,i){this.Se=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,di(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class tBe{constructor(e){this.ke=e,this.qe=new Map,this.Qe=qf(),this.$e=Z1(),this.Ke=Z1(),this.Ue=new us(Lr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const a=this.He(i);switch(e.state){case 0:this.Je(i)&&a.Ce(e.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(e.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(e.resumeToken));break;default:Gn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,a=e.ge.count,l=this.Xe(i);if(l){const d=l.target;if(_j(d))if(a===0){const f=new Tn(d.path);this.ze(i,f,Ma.newNoDocument(f,Yn.min()))}else di(a===1);else{const f=this.et(i);if(f!==a){const _=this.tt(e),E=_?this.nt(_,e,f):1;if(E!==0){this.Ye(i);const b=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=i;let f,_;try{f=Vg(a).toUint8Array()}catch(E){if(E instanceof pse)return D0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new V5(f,l,d)}catch(E){return D0(E instanceof rC?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,a){return i.ge.count===a-this.st(e,i.targetId)?0:2}st(e,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(d=>{const f=this.ke.it(),_=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,d,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((d,f)=>{const _=this.Xe(f);if(_){if(d.current&&_j(_.target)){const E=new Tn(_.target.path);this._t(E).has(f)||this.ut(f,E)||this.ze(f,E,Ma.newNoDocument(E,e))}d.ve&&(i.set(f,d.Fe()),d.Me())}});let a=Pr();this.Ke.forEach((d,f)=>{let _=!0;f.forEachWhile(E=>{const b=this.Xe(E);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(e));const l=new TN(e,i,this.Ue,this.Qe,a);return this.Qe=qf(),this.$e=Z1(),this.Ke=Z1(),this.Ue=new us(Lr),l}Ge(e,i){if(!this.Je(e))return;const a=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ke=this.Ke.insert(i.key,this.ct(i.key).add(e))}ze(e,i,a){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ke=this.Ke.insert(i,this.ct(i).delete(e)),this.Ke=this.Ke.insert(i,this.ct(i).add(e)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new HJ,this.qe.set(e,i)),i}ct(e){let i=this.Ke.get(e);return i||(i=new mo(Lr),this.Ke=this.Ke.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new mo(Lr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||en("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new HJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function Z1(){return new us(Tn.comparator)}function $J(){return new us(Tn.comparator)}const nBe={asc:"ASCENDING",desc:"DESCENDING"},rBe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},iBe={and:"AND",or:"OR"};class sBe{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function Ej(n,e){return n.useProto3Json||gN(e)?e:{value:e}}function vk(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Gse(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function oBe(n,e){return vk(n,e.toTimestamp())}function mp(n){return di(!!n),Yn.fromTimestamp(function(i){const a=Ug(i);return new fo(a.seconds,a.nanos)}(n))}function j5(n,e){return vj(n,e).canonicalString()}function vj(n,e){const i=function(l){return new $i(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Hse(n){const e=$i.fromString(n);return di(Xse(e)),e}function Sj(n,e){return j5(n.databaseId,e.path)}function DU(n,e){const i=Hse(e);if(i.get(1)!==n.databaseId.projectId)throw new on(wt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new on(wt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Tn(Kse(i))}function $se(n,e){return j5(n.databaseId,e)}function aBe(n){const e=Hse(n);return e.length===4?$i.emptyPath():Kse(e)}function bj(n){return new $i(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Kse(n){return di(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function KJ(n,e,i){return{name:Sj(n,e),fields:i.value.mapValue.fields}}function cBe(n,e){let i;if("targetChange"in e){e.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Gn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],d=function(b,w){return b.useProto3Json?(di(w===void 0||typeof w=="string"),ca.fromBase64String(w||"")):(di(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ca.fromUint8Array(w||new Uint8Array))}(n,e.targetChange.resumeToken),f=e.targetChange.cause,_=f&&function(b){const w=b.code===void 0?wt.UNKNOWN:Bse(b.code);return new on(w,b.message||"")}(f);i=new zse(a,l,d,_||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const l=DU(n,a.document.name),d=mp(a.document.updateTime),f=a.document.createTime?mp(a.document.createTime):Yn.min(),_=new el({mapValue:{fields:a.document.fields}}),E=Ma.newFoundDocument(l,d,f,_),b=a.targetIds||[],w=a.removedTargetIds||[];i=new VO(b,w,E.key,E)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const l=DU(n,a.document),d=a.readTime?mp(a.readTime):Yn.min(),f=Ma.newNoDocument(l,d),_=a.removedTargetIds||[];i=new VO([],_,f.key,f)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const l=DU(n,a.document),d=a.removedTargetIds||[];i=new VO([],d,l,null)}else{if(!("filter"in e))return Gn();{e.filter;const a=e.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new J4e(l,d),_=a.targetId;i=new Wse(_,f)}}return i}function lBe(n,e){let i;if(e instanceof DR)i={update:KJ(n,e.key,e.value)};else if(e instanceof Fse)i={delete:Sj(n,e.key)};else if(e instanceof Yg)i={update:KJ(n,e.key,e.data),updateMask:yBe(e.fieldMask)};else{if(!(e instanceof q4e))return Gn();i={verify:Sj(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(a=>function(d,f){const _=f.transform;if(_ instanceof rR)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof iR)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof sR)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof Ek)return{fieldPath:f.field.canonicalString(),increment:_.Ie};throw Gn()}(0,a))),e.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:oBe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Gn()}(n,e.precondition)),i}function uBe(n,e){return n&&n.length>0?(di(e!==void 0),n.map(i=>function(l,d){let f=l.updateTime?mp(l.updateTime):mp(d);return f.isEqual(Yn.min())&&(f=mp(d)),new H4e(f,l.transformResults||[])}(i,e))):[]}function dBe(n,e){return{documents:[$se(n,e.path)]}}function hBe(n,e){const i={structuredQuery:{}},a=e.path;let l;e.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=$se(n,l);const d=function(b){if(b.length!==0)return Yse(Xd.create(b,"and"))}(e.filters);d&&(i.structuredQuery.where=d);const f=function(b){if(b.length!==0)return b.map(w=>function(k){return{field:jS(k.field),direction:mBe(k.dir)}}(w))}(e.orderBy);f&&(i.structuredQuery.orderBy=f);const _=Ej(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function pBe(n){let e=aBe(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){di(a===1);const w=i.from[0];w.allDescendants?l=w.collectionId:e=e.child(w.collectionId)}let d=[];i.where&&(d=function(I){const k=qse(I);return k instanceof Xd&&Tse(k)?k.getFilters():[k]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(k=>function(L){return new _k(FS(L.field),function(B){switch(B){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(k))}(i.orderBy));let _=null;i.limit&&(_=function(I){let k;return k=typeof I=="object"?I.value:I,gN(k)?null:k}(i.limit));let E=null;i.startAt&&(E=function(I){const k=!!I.before,V=I.values||[];return new gk(V,k)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const k=!I.before,V=I.values||[];return new gk(V,k)}(i.endAt)),k4e(e,l,f,d,_,"F",E,b)}function fBe(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Gn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function qse(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=FS(i.unaryFilter.field);return Js.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=FS(i.unaryFilter.field);return Js.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=FS(i.unaryFilter.field);return Js.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=FS(i.unaryFilter.field);return Js.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Gn()}}(n):n.fieldFilter!==void 0?function(i){return Js.create(FS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Gn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Xd.create(i.compositeFilter.filters.map(a=>qse(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Gn()}}(i.compositeFilter.op))}(n):Gn()}function mBe(n){return nBe[n]}function gBe(n){return rBe[n]}function _Be(n){return iBe[n]}function jS(n){return{fieldPath:n.canonicalString()}}function FS(n){return aa.fromServerFormat(n.fieldPath)}function Yse(n){return n instanceof Js?function(i){if(i.op==="=="){if(xJ(i.value))return{unaryFilter:{field:jS(i.field),op:"IS_NAN"}};if(DJ(i.value))return{unaryFilter:{field:jS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(xJ(i.value))return{unaryFilter:{field:jS(i.field),op:"IS_NOT_NAN"}};if(DJ(i.value))return{unaryFilter:{field:jS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jS(i.field),op:gBe(i.op),value:i.value}}}(n):n instanceof Xd?function(i){const a=i.getFilters().map(l=>Yse(l));return a.length===1?a[0]:{compositeFilter:{op:_Be(i.op),filters:a}}}(n):Gn()}function yBe(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function Xse(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,i,a,l,d=Yn.min(),f=Yn.min(),_=ca.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new Tg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Tg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Tg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Tg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EBe{constructor(e){this.Tt=e}}function vBe(n){const e=pBe({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yk(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SBe{constructor(){this.Tn=new bBe}addToCollectionParentIndex(e,i){return this.Tn.add(i),Tt.resolve()}getCollectionParents(e,i){return Tt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Tt.resolve()}deleteFieldIndex(e,i){return Tt.resolve()}deleteAllFieldIndexes(e){return Tt.resolve()}createTargetIndexes(e,i){return Tt.resolve()}getDocumentsMatchingTarget(e,i){return Tt.resolve(null)}getIndexType(e,i){return Tt.resolve(0)}getFieldIndexes(e,i){return Tt.resolve([])}getNextCollectionGroupToUpdate(e){return Tt.resolve(null)}getMinOffset(e,i){return Tt.resolve(Mg.min())}getMinOffsetFromCollectionGroup(e,i){return Tt.resolve(Mg.min())}updateCollectionGroup(e,i,a){return Tt.resolve()}updateIndexEntries(e,i){return Tt.resolve()}}class bBe{constructor(){this.index={}}add(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i]||new mo($i.comparator),d=!l.has(a);return this.index[i]=l.add(a),d}has(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(e){return(this.index[e]||new mo($i.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Jse=41943040;class Qc{static withCacheSize(e){return new Qc(e,Qc.DEFAULT_COLLECTION_PERCENTILE,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qc.DEFAULT_COLLECTION_PERCENTILE=10,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qc.DEFAULT=new Qc(Jse,Qc.DEFAULT_COLLECTION_PERCENTILE,Qc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qc.DISABLED=new Qc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new U0(0)}static Un(){return new U0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YJ="LruGarbageCollector",TBe=1048576;function XJ([n,e],[i,a]){const l=Lr(n,i);return l===0?Lr(e,a):l}class wBe{constructor(e){this.Hn=e,this.buffer=new mo(XJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();XJ(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class CBe{constructor(e,i,a){this.garbageCollector=e,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){en(YJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){Z0(i)?en(YJ,"Ignoring IndexedDB error during garbage collection: ",i):await Q0(i)}await this.er(3e5)})}}class RBe{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(a=>Math.floor(i/100*a))}nthSequenceNumber(e,i){if(i===0)return Tt.resolve(mN.ae);const a=new wBe(i);return this.tr.forEachTarget(e,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(e,i,a){return this.tr.removeTargets(e,i,a)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(en("LruGarbageCollector","Garbage collection skipped; disabled"),Tt.resolve(qJ)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(en("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qJ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let a,l,d,f,_,E,b;const w=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(en("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(a=I,_=Date.now(),this.removeTargets(e,a,i))).next(I=>(d=I,E=Date.now(),this.removeOrphanedDocuments(e,a))).next(I=>(b=Date.now(),US()<=Ar.DEBUG&&en("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(_-f)+`ms
	Removed ${d} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(b-E)+`ms
Total Duration: ${b-w}ms`),Tt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function IBe(n,e){return new RBe(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ABe{constructor(){this.changes=new cE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Ma.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?Tt.resolve(a):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PBe{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OBe{constructor(e,i,a,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(e,i){let a=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(a!==null&&bC(a.mutation,l,Ul.empty(),fo.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.getLocalViewOfDocuments(e,a,Pr()).next(()=>a))}getLocalViewOfDocuments(e,i,a=Pr()){const l=Oy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,a).next(d=>{let f=nC();return d.forEach((_,E)=>{f=f.insert(_,E.overlayedDocument)}),f}))}getOverlayedDocuments(e,i){const a=Oy();return this.populateOverlays(e,a,i).next(()=>this.computeViews(e,i,a,Pr()))}populateOverlays(e,i,a){const l=[];return a.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(e,l).next(d=>{d.forEach((f,_)=>{i.set(f,_)})})}computeViews(e,i,a,l){let d=qf();const f=SC(),_=function(){return SC()}();return i.forEach((E,b)=>{const w=a.get(b.key);l.has(b.key)&&(w===void 0||w.mutation instanceof Yg)?d=d.insert(b.key,b):w!==void 0?(f.set(b.key,w.mutation.getFieldMask()),bC(w.mutation,b,w.mutation.getFieldMask(),fo.now())):f.set(b.key,Ul.empty())}),this.recalculateAndSaveOverlays(e,d).next(E=>(E.forEach((b,w)=>f.set(b,w)),i.forEach((b,w)=>{var I;return _.set(b,new PBe(w,(I=f.get(b))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const a=SC();let l=new us((f,_)=>f-_),d=Pr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(f=>{for(const _ of f)_.keys().forEach(E=>{const b=i.get(E);if(b===null)return;let w=a.get(E)||Ul.empty();w=_.applyToLocalView(b,w),a.set(E,w);const I=(l.get(_.batchId)||Pr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const f=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),b=E.key,w=E.value,I=Nse();w.forEach(k=>{if(!d.has(k)){const V=Vse(i.get(k),a.get(k));V!==null&&I.set(k,V),d=d.add(k)}}),f.push(this.documentOverlayCache.saveOverlays(e,b,I))}return Tt.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,i,a,l){return function(f){return Tn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):Ise(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,a,l):this.getDocumentsMatchingCollectionQuery(e,i,a,l)}getNextDocuments(e,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,a.largestBatchId,l-d.size):Tt.resolve(Oy());let _=ZC,E=d;return f.next(b=>Tt.forEach(b,(w,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),d.get(w)?Tt.resolve():this.remoteDocumentCache.getEntry(e,w).next(k=>{E=E.insert(w,k)}))).next(()=>this.populateOverlays(e,b,d)).next(()=>this.computeViews(e,E,b,Pr())).next(w=>({batchId:_,changes:kse(w)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Tn(i)).next(a=>{let l=nC();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,a,l){const d=i.collectionGroup;let f=nC();return this.indexManager.getCollectionParents(e,d).next(_=>Tt.forEach(_,E=>{const b=function(I,k){return new NR(k,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(d));return this.getDocumentsMatchingCollectionQuery(e,b,a,l).next(w=>{w.forEach((I,k)=>{f=f.insert(I,k)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,i,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,a,d,l))).next(f=>{d.forEach((E,b)=>{const w=b.getKey();f.get(w)===null&&(f=f.insert(w,Ma.newInvalidDocument(w)))});let _=nC();return f.forEach((E,b)=>{const w=d.get(E);w!==void 0&&bC(w.mutation,b,Ul.empty(),fo.now()),vN(i,b)&&(_=_.insert(E,b))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kBe{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Tt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:mp(l.createTime)}}(i)),Tt.resolve()}getNamedQuery(e,i){return Tt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:vBe(l.bundledQuery),readTime:mp(l.readTime)}}(i)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NBe{constructor(){this.overlays=new us(Tn.comparator),this.Rr=new Map}getOverlay(e,i){return Tt.resolve(this.overlays.get(i))}getOverlays(e,i){const a=Oy();return Tt.forEach(i,l=>this.getOverlay(e,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(e,i,a){return a.forEach((l,d)=>{this.Et(e,i,d)}),Tt.resolve()}removeOverlaysForBatchId(e,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Tt.resolve()}getOverlaysForCollection(e,i,a){const l=Oy(),d=i.length+1,f=new Tn(i.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const E=_.getNext().value,b=E.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&E.largestBatchId>a&&l.set(E.getKey(),E)}return Tt.resolve(l)}getOverlaysForCollectionGroup(e,i,a,l){let d=new us((b,w)=>b-w);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let w=d.get(b.largestBatchId);w===null&&(w=Oy(),d=d.insert(b.largestBatchId,w)),w.set(b.getKey(),b)}}const _=Oy(),E=d.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((b,w)=>_.set(b,w)),!(_.size()>=l)););return Tt.resolve(_)}Et(e,i,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new X4e(i,a));let d=this.Rr.get(i);d===void 0&&(d=Pr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DBe{constructor(){this.sessionToken=ca.EMPTY_BYTE_STRING}getSessionToken(e){return Tt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F5{constructor(){this.Vr=new mo(No.mr),this.gr=new mo(No.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const a=new No(e,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(e,i){e.forEach(a=>this.addReference(a,i))}removeReference(e,i){this.wr(new No(e,i))}br(e,i){e.forEach(a=>this.removeReference(a,i))}Sr(e){const i=new Tn(new $i([])),a=new No(i,e),l=new No(i,e+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Tn(new $i([])),a=new No(i,e),l=new No(i,e+1);let d=Pr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(e){const i=new No(e,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&e.isEqual(a.key)}}class No{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Tn.comparator(e.key,i.key)||Lr(e.Cr,i.Cr)}static pr(e,i){return Lr(e.Cr,i.Cr)||Tn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xBe{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new mo(No.mr)}checkEmpty(e){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new Y4e(d,i,a,l);this.mutationQueue.push(f);for(const _ of l)this.Mr=this.Mr.add(new No(_.key,d)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Tt.resolve(f)}lookupMutationBatch(e,i){return Tt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const a=i+1,l=this.Nr(a),d=l<0?0:l;return Tt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?k5:this.Fr-1)}getAllMutationBatches(e){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const a=new No(i,0),l=new No(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const _=this.Or(f.Cr);d.push(_)}),Tt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new mo(Lr);return i.forEach(l=>{const d=new No(l,0),f=new No(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],_=>{a=a.add(_.Cr)})}),Tt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,l=a.length+1;let d=a;Tn.isDocumentKey(d)||(d=d.child(""));const f=new No(new Tn(d),0);let _=new mo(Lr);return this.Mr.forEachWhile(E=>{const b=E.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(_=_.add(E.Cr)),!0)},f),Tt.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){di(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Tt.forEach(i.mutations,l=>{const d=new No(l.key,i.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=a})}qn(e){}containsKey(e,i){const a=new No(i,0),l=this.Mr.firstAfterOrEqual(a);return Tt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Tt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LBe{constructor(e){this.kr=e,this.docs=function(){return new us(Tn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const a=i.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const a=this.docs.get(i);return Tt.resolve(a?a.document.mutableCopy():Ma.newInvalidDocument(i))}getEntries(e,i){let a=qf();return i.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Ma.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(e,i,a,l){let d=qf();const f=i.path,_=new Tn(f.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:b,value:{document:w}}=E.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||l4e(c4e(w),a)<=0||(l.has(w.key)||vN(i,w))&&(d=d.insert(w.key,w.mutableCopy()))}return Tt.resolve(d)}getAllFromCollectionGroup(e,i,a,l){Gn()}qr(e,i){return Tt.forEach(this.docs,a=>i(a))}newChangeBuffer(e){return new MBe(this)}getSize(e){return Tt.resolve(this.size)}}class MBe extends ABe{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(a)}),Tt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UBe{constructor(e){this.persistence=e,this.Qr=new cE(i=>x5(i),L5),this.lastRemoteSnapshotVersion=Yn.min(),this.highestTargetId=0,this.$r=0,this.Kr=new F5,this.targetCount=0,this.Ur=U0.Kn()}forEachTarget(e,i){return this.Qr.forEach((a,l)=>i(l)),Tt.resolve()}getLastRemoteSnapshotVersion(e){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Tt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),Tt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Ur=new U0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Tt.resolve()}updateTargetData(e,i){return this.zn(i),Tt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Kr.Sr(i.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(e,i,a){let l=0;const d=[];return this.Qr.forEach((f,_)=>{_.sequenceNumber<=i&&a.get(_.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),Tt.waitFor(d).next(()=>l)}getTargetCount(e){return Tt.resolve(this.targetCount)}getTargetData(e,i){const a=this.Qr.get(i)||null;return Tt.resolve(a)}addMatchingKeys(e,i,a){return this.Kr.yr(i,a),Tt.resolve()}removeMatchingKeys(e,i,a){this.Kr.br(i,a);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(f=>{d.push(l.markPotentiallyOrphaned(e,f))}),Tt.waitFor(d)}removeMatchingKeysForTargetId(e,i){return this.Kr.Sr(i),Tt.resolve()}getMatchingKeysForTargetId(e,i){const a=this.Kr.vr(i);return Tt.resolve(a)}containsKey(e,i){return Tt.resolve(this.Kr.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qse{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new mN(0),this.zr=!1,this.zr=!0,this.jr=new DBe,this.referenceDelegate=e(this),this.Hr=new UBe(this),this.indexManager=new SBe,this.remoteDocumentCache=function(l){return new LBe(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new EBe(i),this.Yr=new kBe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new NBe,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let a=this.Wr[e.toKey()];return a||(a=new xBe(i,this.referenceDelegate),this.Wr[e.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,a){en("MemoryPersistence","Starting transaction:",e);const l=new VBe(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(e,i){return Tt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(e,i)))}}class VBe extends d4e{constructor(e){super(),this.currentSequenceNumber=e}}class B5{constructor(e){this.persistence=e,this.ti=new F5,this.ni=null}static ri(e){return new B5(e)}get ii(){if(this.ni)return this.ni;throw Gn()}addReference(e,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),Tt.resolve()}removeReference(e,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Tt.resolve()}removeTarget(e,i){this.ti.Sr(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.ii,a=>{const l=Tn.fromPath(a);return this.si(e,l).next(d=>{d||i.removeEntry(l,Yn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Tt.or([()=>Tt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class Sk{constructor(e,i){this.persistence=e,this.oi=new cE(a=>f4e(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=IBe(this,i)}static ri(e,i){return new Sk(e,i)}Zr(){}Xr(e){return Tt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>i.next(l=>a+l))}sr(e){let i=0;return this.rr(e,a=>{i++}).next(()=>i)}rr(e,i){return Tt.forEach(this.oi,(a,l)=>this.ar(e,a,l).next(d=>d?Tt.resolve():i(l)))}removeTargets(e,i,a){return this.persistence.getTargetCache().removeTargets(e,i,a)}removeOrphanedDocuments(e,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(e,f=>this.ar(e,f,i).next(_=>{_||(a++,d.removeEntry(f,Yn.min()))})).next(()=>d.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Tt.resolve()}removeTarget(e,i){const a=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),Tt.resolve()}removeReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),Tt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Tt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=LO(e.data.value)),i}ar(e,i,a){return Tt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Tt.resolve(l!==void 0&&l>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W5{constructor(e,i,a,l){this.targetId=e,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(e,i){let a=Pr(),l=Pr();for(const d of i.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new W5(e,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jBe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FBe{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return vje()?8:h4e(Wa())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,a,l){const d={result:null};return this.rs(e,i).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(e,i,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new jBe;return this._s(e,i,f).next(_=>{if(d.result=_,this.Xi)return this.us(e,i,f,_.size)})}).next(()=>d.result)}us(e,i,a,l){return a.documentReadCount<this.es?(US()<=Ar.DEBUG&&en("QueryEngine","SDK will not create cache indexes for query:",VS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Tt.resolve()):(US()<=Ar.DEBUG&&en("QueryEngine","Query:",VS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(US()<=Ar.DEBUG&&en("QueryEngine","The SDK decides to create cache indexes for query:",VS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,fp(i))):Tt.resolve())}rs(e,i){if(VJ(i))return Tt.resolve(null);let a=fp(i);return this.indexManager.getIndexType(e,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=yk(i,null,"F"),a=fp(i)),this.indexManager.getDocumentsMatchingTarget(e,a).next(d=>{const f=Pr(...d);return this.ns.getDocuments(e,f).next(_=>this.indexManager.getMinOffset(e,a).next(E=>{const b=this.cs(i,_);return this.ls(i,b,f,E.readTime)?this.rs(e,yk(i,null,"F")):this.hs(e,b,i,E)}))})))}ss(e,i,a,l){return VJ(i)||l.isEqual(Yn.min())?Tt.resolve(null):this.ns.getDocuments(e,a).next(d=>{const f=this.cs(i,d);return this.ls(i,f,a,l)?Tt.resolve(null):(US()<=Ar.DEBUG&&en("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),VS(i)),this.hs(e,f,i,a4e(l,ZC)).next(_=>_))})}cs(e,i){let a=new mo(Pse(e));return i.forEach((l,d)=>{vN(e,d)&&(a=a.add(d))}),a}ls(e,i,a,l){if(e.limit===null)return!1;if(a.size!==i.size)return!0;const d=e.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(e,i,a){return US()<=Ar.DEBUG&&en("QueryEngine","Using full collection scan to execute query:",VS(i)),this.ns.getDocumentsMatchingQuery(e,i,Mg.min(),a)}hs(e,i,a,l){return this.ns.getDocumentsMatchingQuery(e,a,l).next(d=>(i.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z5="LocalStore",BBe=3e8;class WBe{constructor(e,i,a,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new us(Lr),this.Is=new cE(d=>x5(d),L5),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(a)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new OBe(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function zBe(n,e,i,a){return new WBe(n,e,i,a)}async function Zse(n,e){const i=er(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,i.As(e),i.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],_=[];let E=Pr();for(const b of l){f.push(b.batchId);for(const w of b.mutations)E=E.add(w.key)}for(const b of d){_.push(b.batchId);for(const w of b.mutations)E=E.add(w.key)}return i.localDocuments.getDocuments(a,E).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:_}))})})}function GBe(n,e){const i=er(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=e.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,b,w){const I=b.batch,k=I.keys();let V=Tt.resolve();return k.forEach(L=>{V=V.next(()=>w.getEntry(E,L)).next(F=>{const B=b.docVersions.get(L);di(B!==null),F.version.compareTo(B)<0&&(I.applyToRemoteDocument(F,b),F.isValidDocument()&&(F.setReadTime(b.commitVersion),w.addEntry(F)))})}),V.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,a,e,d).next(()=>d.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(_){let E=Pr();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(E=E.add(_.batch.mutations[b].key));return E}(e))).next(()=>i.localDocuments.getDocuments(a,l))})}function eoe(n){const e=er(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function HBe(n,e){const i=er(n),a=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((w,I)=>{const k=l.get(I);if(!k)return;_.push(i.Hr.removeMatchingKeys(d,w.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(d,w.addedDocuments,I)));let V=k.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(I)!==null?V=V.withResumeToken(ca.EMPTY_BYTE_STRING,Yn.min()).withLastLimboFreeSnapshotVersion(Yn.min()):w.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(w.resumeToken,a)),l=l.insert(I,V),function(F,B,q){return F.resumeToken.approximateByteSize()===0||B.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=BBe?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(k,V,w)&&_.push(i.Hr.updateTargetData(d,V))});let E=qf(),b=Pr();if(e.documentUpdates.forEach(w=>{e.resolvedLimboDocuments.has(w)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(d,w))}),_.push($Be(d,f,e.documentUpdates).next(w=>{E=w.Vs,b=w.fs})),!a.isEqual(Yn.min())){const w=i.Hr.getLastRemoteSnapshotVersion(d).next(I=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));_.push(w)}return Tt.waitFor(_).next(()=>f.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,E,b)).next(()=>E)}).then(d=>(i.Ts=l,d))}function $Be(n,e,i){let a=Pr(),l=Pr();return i.forEach(d=>a=a.add(d)),e.getEntries(n,a).next(d=>{let f=qf();return i.forEach((_,E)=>{const b=d.get(_);E.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(Yn.min())?(e.removeEntry(_,E.readTime),f=f.insert(_,E)):!b.isValidDocument()||E.version.compareTo(b.version)>0||E.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(E),f=f.insert(_,E)):en(z5,"Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",E.version)}),{Vs:f,fs:l}})}function KBe(n,e){const i=er(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=k5),i.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function qBe(n,e){const i=er(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,e).next(d=>d?(l=d,Tt.resolve(l)):i.Hr.allocateTargetId(a).next(f=>(l=new Tg(e,f,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(e,a.targetId)),a})}async function Tj(n,e,i){const a=er(n),l=a.Ts.get(e),d=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!Z0(f))throw f;en(z5,`Failed to update sequence numbers for target ${e}: ${f}`)}a.Ts=a.Ts.remove(e),a.Is.delete(l.target)}function JJ(n,e,i){const a=er(n);let l=Yn.min(),d=Pr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(E,b,w){const I=er(E),k=I.Is.get(w);return k!==void 0?Tt.resolve(I.Ts.get(k)):I.Hr.getTargetData(b,w)}(a,f,fp(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,_.targetId).next(E=>{d=E})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,e,i?l:Yn.min(),i?d:Pr())).next(_=>(YBe(a,D4e(e),_),{documents:_,gs:d})))}function YBe(n,e,i){let a=n.Es.get(e)||Yn.min();i.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(e,a)}class QJ{constructor(){this.activeTargetIds=j4e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class XBe{constructor(){this.ho=new QJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,a){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,a){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new QJ,Promise.resolve()}handleUserChange(e,i,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JBe{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZJ="ConnectivityMonitor";class eQ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){en(ZJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){en(ZJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eO=null;function wj(){return eO===null?eO=function(){return 268435456+Math.round(2147483648*Math.random())}():eO++,"0x"+eO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xU="RestConnection",QBe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ZBe{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===fk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(e,i,a,l,d){const f=wj(),_=this.So(e,i.toUriEncodedString());en(xU,`Sending RPC '${e}' ${f}:`,_,a);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,d),this.vo(e,_,E,a).then(b=>(en(xU,`Received RPC '${e}' ${f}: `,b),b),b=>{throw D0(xU,`RPC '${e}' ${f} failed with error: `,b,"url: ",_,"request:",a),b})}Co(e,i,a,l,d,f){return this.bo(e,i,a,l,d)}Do(e,i,a){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+J0}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>e[d]=l),a&&a.headers.forEach((l,d)=>e[d]=l)}So(e,i){const a=QBe[e];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e6e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na="WebChannelConnection";class t6e extends ZBe{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,a,l){const d=wj();return new Promise((f,_)=>{const E=new ise;E.setWithCredentials(!0),E.listenOnce(sse.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case xO.NO_ERROR:const w=E.getResponseJson();en(Na,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(w)),f(w);break;case xO.TIMEOUT:en(Na,`RPC '${e}' ${d} timed out`),_(new on(wt.DEADLINE_EXCEEDED,"Request time out"));break;case xO.HTTP_ERROR:const I=E.getStatus();if(en(Na,`RPC '${e}' ${d} failed with status:`,I,"response text:",E.getResponseText()),I>0){let k=E.getResponseJson();Array.isArray(k)&&(k=k[0]);const V=k==null?void 0:k.error;if(V&&V.status&&V.message){const L=function(B){const q=B.toLowerCase().replace(/_/g,"-");return Object.values(wt).indexOf(q)>=0?q:wt.UNKNOWN}(V.status);_(new on(L,V.message))}else _(new on(wt.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new on(wt.UNAVAILABLE,"Connection failed."));break;default:Gn()}}finally{en(Na,`RPC '${e}' ${d} completed.`)}});const b=JSON.stringify(l);en(Na,`RPC '${e}' ${d} sending request:`,l),E.send(i,"POST",b,a,15)})}Wo(e,i,a){const l=wj(),d=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=cse(),_=ase(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(E.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,a),E.encodeInitMessageHeaders=!0;const w=d.join("");en(Na,`Creating RPC '${e}' stream ${l}: ${w}`,E);const I=f.createWebChannel(w,E);let k=!1,V=!1;const L=new e6e({Fo:B=>{V?en(Na,`Not sending because RPC '${e}' stream ${l} is closed:`,B):(k||(en(Na,`Opening RPC '${e}' stream ${l} transport.`),I.open(),k=!0),en(Na,`RPC '${e}' stream ${l} sending:`,B),I.send(B))},Mo:()=>I.close()}),F=(B,q,$)=>{B.listen(q,Q=>{try{$(Q)}catch(ae){setTimeout(()=>{throw ae},0)}})};return F(I,tC.EventType.OPEN,()=>{V||(en(Na,`RPC '${e}' stream ${l} transport opened.`),L.Qo())}),F(I,tC.EventType.CLOSE,()=>{V||(V=!0,en(Na,`RPC '${e}' stream ${l} transport closed`),L.Ko())}),F(I,tC.EventType.ERROR,B=>{V||(V=!0,D0(Na,`RPC '${e}' stream ${l} transport errored:`,B),L.Ko(new on(wt.UNAVAILABLE,"The operation could not be completed")))}),F(I,tC.EventType.MESSAGE,B=>{var q;if(!V){const $=B.data[0];di(!!$);const Q=$,ae=(Q==null?void 0:Q.error)||((q=Q[0])===null||q===void 0?void 0:q.error);if(ae){en(Na,`RPC '${e}' stream ${l} received error:`,ae);const re=ae.status;let fe=function(ne){const oe=$s[ne];if(oe!==void 0)return Bse(oe)}(re),Z=ae.message;fe===void 0&&(fe=wt.INTERNAL,Z="Unknown error status: "+re+" with message "+ae.message),V=!0,L.Ko(new on(fe,Z)),I.close()}else en(Na,`RPC '${e}' stream ${l} received:`,$),L.Uo($)}}),F(_,ose.STAT_EVENT,B=>{B.stat===pj.PROXY?en(Na,`RPC '${e}' stream ${l} detected buffering proxy`):B.stat===pj.NOPROXY&&en(Na,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{L.$o()},0),L}}function LU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(n){return new sBe(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class toe{constructor(e,i,a=1e3,l=1.5,d=6e4){this.Ti=e,this.timerId=i,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&en("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tQ="PersistentStream";class noe{constructor(e,i,a,l,d,f,_,E){this.Ti=e,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new toe(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===wt.RESOURCE_EXHAUSTED?(Kf(i.toString()),Kf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===wt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{e(()=>{const l=new on(wt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(e,i){const a=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return en(tQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(en(tQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class n6e extends noe{constructor(e,i,a,l,d,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,f),this.serializer=d}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=cBe(this.serializer,e),a=function(d){if(!("targetChange"in d))return Yn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Yn.min():f.readTime?mp(f.readTime):Yn.min()}(e);return this.listener.p_(i,a)}y_(e){const i={};i.database=bj(this.serializer),i.addTarget=function(d,f){let _;const E=f.target;if(_=_j(E)?{documents:dBe(d,E)}:{query:hBe(d,E).ht},_.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){_.resumeToken=Gse(d,f.resumeToken);const b=Ej(d,f.expectedCount);b!==null&&(_.expectedCount=b)}else if(f.snapshotVersion.compareTo(Yn.min())>0){_.readTime=vk(d,f.snapshotVersion.toTimestamp());const b=Ej(d,f.expectedCount);b!==null&&(_.expectedCount=b)}return _}(this.serializer,e);const a=fBe(this.serializer,e);a&&(i.labels=a),this.I_(i)}w_(e){const i={};i.database=bj(this.serializer),i.removeTarget=e,this.I_(i)}}class r6e extends noe{constructor(e,i,a,l,d,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,f),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return di(!!e.streamToken),this.lastStreamToken=e.streamToken,di(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){di(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=uBe(e.writeResults,e.commitTime),a=mp(e.commitTime);return this.listener.v_(a,i)}C_(){const e={};e.database=bj(this.serializer),this.I_(e)}S_(e){const i={streamToken:this.lastStreamToken,writes:e.map(a=>lBe(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i6e{}class s6e extends i6e{constructor(e,i,a,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new on(wt.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.bo(e,vj(i,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new on(wt.UNKNOWN,d.toString())})}Co(e,i,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Co(e,vj(i,a),l,f,_,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new on(wt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class o6e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Kf(i),this.N_=!1):en("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE="RemoteStore";class a6e{constructor(e,i,a,l,d){this.localStore=e,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{lE(this)&&(en(tE,"Restarting streams for network reachability change."),await async function(E){const b=er(E);b.W_.add(4),await LR(b),b.j_.set("Unknown"),b.W_.delete(4),await CN(b)}(this))})}),this.j_=new o6e(a,l)}}async function CN(n){if(lE(n))for(const e of n.G_)await e(!0)}async function LR(n){for(const e of n.G_)await e(!1)}function roe(n,e){const i=er(n);i.U_.has(e.targetId)||(i.U_.set(e.targetId,e),K5(i)?$5(i):eb(i).c_()&&H5(i,e))}function G5(n,e){const i=er(n),a=eb(i);i.U_.delete(e),a.c_()&&ioe(i,e),i.U_.size===0&&(a.c_()?a.P_():lE(i)&&i.j_.set("Unknown"))}function H5(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Yn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}eb(n).y_(e)}function ioe(n,e){n.H_.Ne(e),eb(n).w_(e)}function $5(n){n.H_=new tBe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.U_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),eb(n).start(),n.j_.B_()}function K5(n){return lE(n)&&!eb(n).u_()&&n.U_.size>0}function lE(n){return er(n).W_.size===0}function soe(n){n.H_=void 0}async function c6e(n){n.j_.set("Online")}async function l6e(n){n.U_.forEach((e,i)=>{H5(n,e)})}async function u6e(n,e){soe(n),K5(n)?(n.j_.q_(e),$5(n)):n.j_.set("Unknown")}async function d6e(n,e,i){if(n.j_.set("Online"),e instanceof zse&&e.state===2&&e.cause)try{await async function(l,d){const f=d.cause;for(const _ of d.targetIds)l.U_.has(_)&&(await l.remoteSyncer.rejectListen(_,f),l.U_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(a){en(tE,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await bk(n,a)}else if(e instanceof VO?n.H_.We(e):e instanceof Wse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Yn.min()))try{const a=await eoe(n.localStore);i.compareTo(a)>=0&&await function(d,f){const _=d.H_.ot(f);return _.targetChanges.forEach((E,b)=>{if(E.resumeToken.approximateByteSize()>0){const w=d.U_.get(b);w&&d.U_.set(b,w.withResumeToken(E.resumeToken,f))}}),_.targetMismatches.forEach((E,b)=>{const w=d.U_.get(E);if(!w)return;d.U_.set(E,w.withResumeToken(ca.EMPTY_BYTE_STRING,w.snapshotVersion)),ioe(d,E);const I=new Tg(w.target,E,b,w.sequenceNumber);H5(d,I)}),d.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(a){en(tE,"Failed to raise snapshot:",a),await bk(n,a)}}async function bk(n,e,i){if(!Z0(e))throw e;n.W_.add(1),await LR(n),n.j_.set("Offline"),i||(i=()=>eoe(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{en(tE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await CN(n)})}function ooe(n,e){return e().catch(i=>bk(n,i,e))}async function RN(n){const e=er(n),i=Fg(e);let a=e.K_.length>0?e.K_[e.K_.length-1].batchId:k5;for(;h6e(e);)try{const l=await KBe(e.localStore,a);if(l===null){e.K_.length===0&&i.P_();break}a=l.batchId,p6e(e,l)}catch(l){await bk(e,l)}aoe(e)&&coe(e)}function h6e(n){return lE(n)&&n.K_.length<10}function p6e(n,e){n.K_.push(e);const i=Fg(n);i.c_()&&i.b_&&i.S_(e.mutations)}function aoe(n){return lE(n)&&!Fg(n).u_()&&n.K_.length>0}function coe(n){Fg(n).start()}async function f6e(n){Fg(n).C_()}async function m6e(n){const e=Fg(n);for(const i of n.K_)e.S_(i.mutations)}async function g6e(n,e,i){const a=n.K_.shift(),l=U5.from(a,e,i);await ooe(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await RN(n)}async function _6e(n,e){e&&Fg(n).b_&&await async function(a,l){if(function(f){return Q4e(f)&&f!==wt.ABORTED}(l.code)){const d=a.K_.shift();Fg(a).h_(),await ooe(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await RN(a)}}(n,e),aoe(n)&&coe(n)}async function nQ(n,e){const i=er(n);i.asyncQueue.verifyOperationInProgress(),en(tE,"RemoteStore received new credentials");const a=lE(i);i.W_.add(3),await LR(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await CN(i)}async function y6e(n,e){const i=er(n);e?(i.W_.delete(2),await CN(i)):e||(i.W_.add(2),await LR(i),i.j_.set("Unknown"))}function eb(n){return n.J_||(n.J_=function(i,a,l){const d=er(i);return d.M_(),new n6e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:c6e.bind(null,n),No:l6e.bind(null,n),Lo:u6e.bind(null,n),p_:d6e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),K5(n)?$5(n):n.j_.set("Unknown")):(await n.J_.stop(),soe(n))})),n.J_}function Fg(n){return n.Y_||(n.Y_=function(i,a,l){const d=er(i);return d.M_(),new r6e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:f6e.bind(null,n),Lo:_6e.bind(null,n),D_:m6e.bind(null,n),v_:g6e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await RN(n)):(await n.Y_.stop(),n.K_.length>0&&(en(tE,`Stopping write stream with ${n.K_.length} pending writes`),n.K_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q5{constructor(e,i,a,l,d){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Bf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,a,l,d){const f=Date.now()+a,_=new q5(e,i,f,l,d);return _.start(a),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new on(wt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Y5(n,e){if(Kf("AsyncQueue",`${e}: ${n}`),Z0(n))return new on(wt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{static emptySet(e){return new _0(e.comparator)}constructor(e){this.comparator=e?(i,a)=>e(i,a)||Tn.comparator(i.key,a.key):(i,a)=>Tn.comparator(i.key,a.key),this.keyedMap=nC(),this.sortedSet=new us(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,a)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof _0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const a=new _0;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rQ{constructor(){this.Z_=new us(Tn.comparator)}track(e){const i=e.doc.key,a=this.Z_.get(i);a?e.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.Z_=this.Z_.remove(i):e.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Gn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,a)=>{e.push(a)}),e}}class V0{constructor(e,i,a,l,d,f,_,E,b){this.query=e,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=b}static fromInitialDocuments(e,i,a,l,d){const f=[];return i.forEach(_=>{f.push({type:0,doc:_})}),new V0(e,i,_0.emptySet(i),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&EN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,a=e.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E6e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class v6e{constructor(){this.queries=iQ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=er(i),d=l.queries;l.queries=iQ(),d.forEach((f,_)=>{for(const E of _.ta)E.onError(a)})})(this,new on(wt.ABORTED,"Firestore shutting down"))}}function iQ(){return new cE(n=>Ase(n),EN)}async function X5(n,e){const i=er(n);let a=3;const l=e.query;let d=i.queries.get(l);d?!d.na()&&e.ra()&&(a=2):(d=new E6e,a=e.ra()?0:1);try{switch(a){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const _=Y5(f,`Initialization of query '${VS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,d),d.ta.push(e),e.sa(i.onlineState),d.ea&&e.oa(d.ea)&&Q5(i)}async function J5(n,e){const i=er(n),a=e.query;let l=3;const d=i.queries.get(a);if(d){const f=d.ta.indexOf(e);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=e.ra()?0:1:!d.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function S6e(n,e){const i=er(n);let a=!1;for(const l of e){const d=l.query,f=i.queries.get(d);if(f){for(const _ of f.ta)_.oa(l)&&(a=!0);f.ea=l}}a&&Q5(i)}function b6e(n,e,i){const a=er(n),l=a.queries.get(e);if(l)for(const d of l.ta)d.onError(i);a.queries.delete(e)}function Q5(n){n.ia.forEach(e=>{e.next()})}var Cj,sQ;(sQ=Cj||(Cj={}))._a="default",sQ.Cache="cache";class Z5{constructor(e,i,a){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(e){if(!this.options.includeMetadataChanges){const a=[];for(const l of e.docChanges)l.type!==3&&a.push(l);e=new V0(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=V0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Cj.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class loe{constructor(e){this.key=e}}class uoe{constructor(e){this.key=e}}class T6e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Pr(),this.mutatedKeys=Pr(),this.ya=Pse(e),this.wa=new _0(this.ya)}get ba(){return this.fa}Sa(e,i){const a=i?i.Da:new rQ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,f=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((w,I)=>{const k=l.get(w),V=vN(this.query,I)?I:null,L=!!k&&this.mutatedKeys.has(k.key),F=!!V&&(V.hasLocalMutations||this.mutatedKeys.has(V.key)&&V.hasCommittedMutations);let B=!1;k&&V?k.data.isEqual(V.data)?L!==F&&(a.track({type:3,doc:V}),B=!0):this.va(k,V)||(a.track({type:2,doc:V}),B=!0,(E&&this.ya(V,E)>0||b&&this.ya(V,b)<0)&&(_=!0)):!k&&V?(a.track({type:0,doc:V}),B=!0):k&&!V&&(a.track({type:1,doc:k}),B=!0,(E||b)&&(_=!0)),B&&(V?(f=f.add(V),d=F?d.add(w):d.delete(w)):(f=f.delete(w),d=d.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),d=d.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:_,mutatedKeys:d}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,a,l){const d=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const f=e.Da.X_();f.sort((w,I)=>function(V,L){const F=B=>{switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gn()}};return F(V)-F(L)}(w.type,I.type)||this.ya(w.doc,I.doc)),this.Ca(a),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,b=E!==this.ga;return this.ga=E,f.length!==0||b?{snapshot:new V0(this.query,e.wa,d,f,e.mutatedKeys,E===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new rQ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Pr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return e.forEach(a=>{this.pa.has(a)||i.push(new uoe(a))}),this.pa.forEach(a=>{e.has(a)||i.push(new loe(a))}),i}Oa(e){this.fa=e.gs,this.pa=Pr();const i=this.Sa(e.documents);return this.applyChanges(i,!0)}Na(){return V0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const e3="SyncEngine";class w6e{constructor(e,i,a){this.query=e,this.targetId=i,this.view=a}}class C6e{constructor(e){this.key=e,this.Ba=!1}}class R6e{constructor(e,i,a,l,d,f){this.localStore=e,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new cE(_=>Ase(_),EN),this.qa=new Map,this.Qa=new Set,this.$a=new us(Tn.comparator),this.Ka=new Map,this.Ua=new F5,this.Wa={},this.Ga=new Map,this.za=U0.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function I6e(n,e,i=!0){const a=goe(n);let l;const d=a.ka.get(e);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await doe(a,e,i,!0),l}async function A6e(n,e){const i=goe(n);await doe(i,e,!0,!1)}async function doe(n,e,i,a){const l=await qBe(n.localStore,fp(e)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,i);let _;return a&&(_=await P6e(n,e,d,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&roe(n.remoteStore,l),_}async function P6e(n,e,i,a,l){n.Ha=(I,k,V)=>async function(F,B,q,$){let Q=B.view.Sa(q);Q.ls&&(Q=await JJ(F.localStore,B.query,!1).then(({documents:Z})=>B.view.Sa(Z,Q)));const ae=$&&$.targetChanges.get(B.targetId),re=$&&$.targetMismatches.get(B.targetId)!=null,fe=B.view.applyChanges(Q,F.isPrimaryClient,ae,re);return aQ(F,B.targetId,fe.Ma),fe.snapshot}(n,I,k,V);const d=await JJ(n.localStore,e,!0),f=new T6e(e,d.gs),_=f.Sa(d.documents),E=xR.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=f.applyChanges(_,n.isPrimaryClient,E);aQ(n,i,b.Ma);const w=new w6e(e,i,f);return n.ka.set(e,w),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function O6e(n,e,i){const a=er(n),l=a.ka.get(e),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!EN(f,e))),void a.ka.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await Tj(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&G5(a.remoteStore,l.targetId),Rj(a,l.targetId)}).catch(Q0)):(Rj(a,l.targetId),await Tj(a.localStore,l.targetId,!0))}async function k6e(n,e){const i=er(n),a=i.ka.get(e),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),G5(i.remoteStore,a.targetId))}async function N6e(n,e,i){const a=j6e(n);try{const l=await function(f,_){const E=er(f),b=fo.now(),w=_.reduce((V,L)=>V.add(L.key),Pr());let I,k;return E.persistence.runTransaction("Locally write mutations","readwrite",V=>{let L=qf(),F=Pr();return E.ds.getEntries(V,w).next(B=>{L=B,L.forEach((q,$)=>{$.isValidDocument()||(F=F.add(q))})}).next(()=>E.localDocuments.getOverlayedDocuments(V,L)).next(B=>{I=B;const q=[];for(const $ of _){const Q=K4e($,I.get($.key).overlayedDocument);Q!=null&&q.push(new Yg($.key,Q,vse(Q.value.mapValue),Kd.exists(!0)))}return E.mutationQueue.addMutationBatch(V,b,q,_)}).next(B=>{k=B;const q=B.applyToLocalDocumentSet(I,F);return E.documentOverlayCache.saveOverlays(V,B.batchId,q)})}).then(()=>({batchId:k.batchId,changes:kse(I)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(l.batchId),function(f,_,E){let b=f.Wa[f.currentUser.toKey()];b||(b=new us(Lr)),b=b.insert(_,E),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,i),await MR(a,l.changes),await RN(a.remoteStore)}catch(l){const d=Y5(l,"Failed to persist write");i.reject(d)}}async function hoe(n,e){const i=er(n);try{const a=await HBe(i.localStore,e);e.targetChanges.forEach((l,d)=>{const f=i.Ka.get(d);f&&(di(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?di(f.Ba):l.removedDocuments.size>0&&(di(f.Ba),f.Ba=!1))}),await MR(i,a,e)}catch(a){await Q0(a)}}function oQ(n,e,i){const a=er(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((d,f)=>{const _=f.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(f,_){const E=er(f);E.onlineState=_;let b=!1;E.queries.forEach((w,I)=>{for(const k of I.ta)k.sa(_)&&(b=!0)}),b&&Q5(E)}(a.eventManager,e),l.length&&a.La.p_(l),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function D6e(n,e,i){const a=er(n);a.sharedClientState.updateQueryState(e,"rejected",i);const l=a.Ka.get(e),d=l&&l.key;if(d){let f=new us(Tn.comparator);f=f.insert(d,Ma.newNoDocument(d,Yn.min()));const _=Pr().add(d),E=new TN(Yn.min(),new Map,new us(Lr),f,_);await hoe(a,E),a.$a=a.$a.remove(d),a.Ka.delete(e),t3(a)}else await Tj(a.localStore,e,!1).then(()=>Rj(a,e,i)).catch(Q0)}async function x6e(n,e){const i=er(n),a=e.batch.batchId;try{const l=await GBe(i.localStore,e);foe(i,a,null),poe(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await MR(i,l)}catch(l){await Q0(l)}}async function L6e(n,e,i){const a=er(n);try{const l=await function(f,_){const E=er(f);return E.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let w;return E.mutationQueue.lookupMutationBatch(b,_).next(I=>(di(I!==null),w=I.keys(),E.mutationQueue.removeMutationBatch(b,I))).next(()=>E.mutationQueue.performConsistencyCheck(b)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(b,w,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,w)).next(()=>E.localDocuments.getDocuments(b,w))})}(a.localStore,e);foe(a,e,i),poe(a,e),a.sharedClientState.updateMutationState(e,"rejected",i),await MR(a,l)}catch(l){await Q0(l)}}function poe(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function foe(n,e,i){const a=er(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(e);d&&(i?d.reject(i):d.resolve(),l=l.remove(e)),a.Wa[a.currentUser.toKey()]=l}}function Rj(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const a of n.qa.get(e))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(e),n.isPrimaryClient&&n.Ua.Sr(e).forEach(a=>{n.Ua.containsKey(a)||moe(n,a)})}function moe(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(G5(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ka.delete(i),t3(n))}function aQ(n,e,i){for(const a of i)a instanceof loe?(n.Ua.addReference(a.key,e),M6e(n,a)):a instanceof uoe?(en(e3,"Document no longer in limbo: "+a.key),n.Ua.removeReference(a.key,e),n.Ua.containsKey(a.key)||moe(n,a.key)):Gn()}function M6e(n,e){const i=e.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(en(e3,"New document in limbo: "+i),n.Qa.add(a),t3(n))}function t3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Tn($i.fromString(e)),a=n.za.next();n.Ka.set(a,new C6e(i)),n.$a=n.$a.insert(i,a),roe(n.remoteStore,new Tg(fp(yN(i.path)),a,"TargetPurposeLimboResolution",mN.ae))}}async function MR(n,e,i){const a=er(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((_,E)=>{f.push(a.Ha(E,e,i).then(b=>{var w;if((b||i)&&a.isPrimaryClient){const I=b?!b.fromCache:(w=i==null?void 0:i.targetChanges.get(E.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(b){l.push(b);const I=W5.Yi(E.targetId,b);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(E,b){const w=er(E);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Tt.forEach(b,k=>Tt.forEach(k.Hi,V=>w.persistence.referenceDelegate.addReference(I,k.targetId,V)).next(()=>Tt.forEach(k.Ji,V=>w.persistence.referenceDelegate.removeReference(I,k.targetId,V)))))}catch(I){if(!Z0(I))throw I;en(z5,"Failed to update sequence numbers: "+I)}for(const I of b){const k=I.targetId;if(!I.fromCache){const V=w.Ts.get(k),L=V.snapshotVersion,F=V.withLastLimboFreeSnapshotVersion(L);w.Ts=w.Ts.insert(k,F)}}}(a.localStore,d))}async function U6e(n,e){const i=er(n);if(!i.currentUser.isEqual(e)){en(e3,"User change. New user:",e.toKey());const a=await Zse(i.localStore,e);i.currentUser=e,function(d,f){d.Ga.forEach(_=>{_.forEach(E=>{E.reject(new on(wt.CANCELLED,f))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await MR(i,a.Rs)}}function V6e(n,e){const i=er(n),a=i.Ka.get(e);if(a&&a.Ba)return Pr().add(a.key);{let l=Pr();const d=i.qa.get(e);if(!d)return l;for(const f of d){const _=i.ka.get(f);l=l.unionWith(_.view.ba)}return l}}function goe(n){const e=er(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=hoe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=V6e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=D6e.bind(null,e),e.La.p_=S6e.bind(null,e.eventManager),e.La.Ja=b6e.bind(null,e.eventManager),e}function j6e(n){const e=er(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=x6e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=L6e.bind(null,e),e}class Tk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=wN(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return zBe(this.persistence,new FBe,e.initialUser,this.serializer)}Xa(e){return new Qse(B5.ri,this.serializer)}Za(e){return new XBe}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Tk.provider={build:()=>new Tk};class F6e extends Tk{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){di(this.persistence.referenceDelegate instanceof Sk);const a=this.persistence.referenceDelegate.garbageCollector;return new CBe(a,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?Qc.withCacheSize(this.cacheSizeBytes):Qc.DEFAULT;return new Qse(a=>Sk.ri(a,i),this.serializer)}}class Ij{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>oQ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=U6e.bind(null,this.syncEngine),await y6e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new v6e}()}createDatastore(e){const i=wN(e.databaseInfo.databaseId),a=function(d){return new t6e(d)}(e.databaseInfo);return function(d,f,_,E){return new s6e(d,f,_,E)}(e.authCredentials,e.appCheckCredentials,a,i)}createRemoteStore(e){return function(a,l,d,f,_){return new a6e(a,l,d,f,_)}(this.localStore,this.datastore,e.asyncQueue,i=>oQ(this.syncEngine,i,0),function(){return eQ.D()?new eQ:new JBe}())}createSyncEngine(e,i){return function(l,d,f,_,E,b,w){const I=new R6e(l,d,f,_,E,b);return w&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const d=er(l);en(tE,"RemoteStore shutting down."),d.W_.add(5),await LR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}Ij.provider={build:()=>new Ij};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Kf("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bg="FirestoreClient";class B6e{constructor(e,i,a,l,d){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=La.UNAUTHENTICATED,this.clientId=use.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{en(Bg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(en(Bg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Bf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const a=Y5(i,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function MU(n,e){n.asyncQueue.verifyOperationInProgress(),en(Bg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Zse(e.localStore,l),a=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function cQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await W6e(n);en(Bg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(a=>nQ(e.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>nQ(e.remoteStore,l)),n._onlineComponents=e}async function W6e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){en(Bg,"Using user provided OfflineComponentProvider");try{await MU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===wt.FAILED_PRECONDITION||l.code===wt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;D0("Error using user provided cache. Falling back to memory cache: "+i),await MU(n,new Tk)}}else en(Bg,"Using default OfflineComponentProvider"),await MU(n,new F6e(void 0));return n._offlineComponents}async function _oe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(en(Bg,"Using user provided OnlineComponentProvider"),await cQ(n,n._uninitializedComponentsProvider._online)):(en(Bg,"Using default OnlineComponentProvider"),await cQ(n,new Ij))),n._onlineComponents}function z6e(n){return _oe(n).then(e=>e.syncEngine)}async function wk(n){const e=await _oe(n),i=e.eventManager;return i.onListen=I6e.bind(null,e.syncEngine),i.onUnlisten=O6e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=A6e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=k6e.bind(null,e.syncEngine),i}function G6e(n,e,i={}){const a=new Bf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,_,E,b){const w=new n3({next:k=>{w.su(),f.enqueueAndForget(()=>J5(d,I));const V=k.docs.has(_);!V&&k.fromCache?b.reject(new on(wt.UNAVAILABLE,"Failed to get document because the client is offline.")):V&&k.fromCache&&E&&E.source==="server"?b.reject(new on(wt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new Z5(yN(_.path),w,{includeMetadataChanges:!0,Ta:!0});return X5(d,I)}(await wk(n),n.asyncQueue,e,i,a)),a.promise}function H6e(n,e,i={}){const a=new Bf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,_,E,b){const w=new n3({next:k=>{w.su(),f.enqueueAndForget(()=>J5(d,I)),k.fromCache&&E.source==="server"?b.reject(new on(wt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(k)},error:k=>b.reject(k)}),I=new Z5(_,w,{includeMetadataChanges:!0,Ta:!0});return X5(d,I)}(await wk(n),n.asyncQueue,e,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yoe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eoe(n,e,i){if(!i)throw new on(wt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $6e(n,e,i,a){if(e===!0&&a===!0)throw new on(wt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function uQ(n){if(!Tn.isDocumentKey(n))throw new on(wt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function dQ(n){if(Tn.isDocumentKey(n))throw new on(wt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function IN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Gn()}function zl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new on(wt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=IN(n);throw new on(wt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const voe="firestore.googleapis.com",hQ=!0;class pQ{constructor(e){var i,a;if(e.host===void 0){if(e.ssl!==void 0)throw new on(wt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=voe,this.ssl=hQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:hQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Jse;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<TBe)throw new on(wt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}$6e("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=yoe((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new on(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new on(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new on(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class AN{constructor(e,i,a,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new on(wt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new on(wt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new Z3e;switch(a.type){case"firstParty":return new r4e(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new on(wt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=lQ.get(i);a&&(en("ComponentProvider","Removing Datastore"),lQ.delete(i),a.terminate())}(this),Promise.resolve()}}function K6e(n,e,i,a={}){var l;const d=(n=zl(n,AN))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;d.host!==voe&&d.host!==_&&D0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},d),{host:_,ssl:!1,emulatorOptions:a});if(!Xy(E,f)&&(n._setSettings(E),a.mockUserToken)){let b,w;if(typeof a.mockUserToken=="string")b=a.mockUserToken,w=La.MOCK_USER;else{b=mie(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new on(wt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new La(I)}n._authCredentials=new e4e(new lse(b,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(e,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Xg(this.firestore,e,this._query)}}class ja{constructor(e,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ja(this.firestore,e,this._key)}}class Pg extends Xg{constructor(e,i,a){super(e,i,yN(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ja(this.firestore,null,new Tn(e))}withConverter(e){return new Pg(this.firestore,e,this._path)}}function Yf(n,e,...i){if(n=Xi(n),Eoe("collection","path",e),n instanceof AN){const a=$i.fromString(e,...i);return dQ(a),new Pg(n,null,a)}{if(!(n instanceof ja||n instanceof Pg))throw new on(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child($i.fromString(e,...i));return dQ(a),new Pg(n.firestore,null,a)}}function qi(n,e,...i){if(n=Xi(n),arguments.length===1&&(e=use.newId()),Eoe("doc","path",e),n instanceof AN){const a=$i.fromString(e,...i);return uQ(a),new ja(n,null,new Tn(a))}{if(!(n instanceof ja||n instanceof Pg))throw new on(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child($i.fromString(e,...i));return uQ(a),new ja(n.firestore,n instanceof Pg?n.converter:null,new Tn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fQ="AsyncQueue";class mQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new toe(this,"async_queue_retry"),this.bu=()=>{const a=LU();a&&en(fQ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=e;const i=LU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=LU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Bf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!Z0(e))throw e;en(fQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.Su.then(()=>(this.pu=!0,e().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let _=f.message||"";return f.stack&&(_=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),_}(a);throw Kf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=i,i}enqueueAfterDelay(e,i,a){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=q5.createAndSchedule(this,e,i,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Gn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.Su,await e;while(e!==this.Su)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function gQ(n){return function(i,a){if(typeof i!="object"||i===null)return!1;const l=i;for(const d of a)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class Wg extends AN{constructor(e,i,a,l){super(e,i,a,l),this.type="firestore",this._queue=new mQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new mQ(e),this._firestoreClient=void 0,await e}}}function Soe(n,e){const i=typeof n=="object"?n:S5(),a=typeof n=="string"?n:fk,l=uN(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=hie("firestore");d&&K6e(l,...d)}return l}function PN(n){if(n._terminated)throw new on(wt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||q6e(n),n._firestoreClient}function q6e(n){var e,i,a;const l=n._freezeSettings(),d=function(_,E,b,w){return new _4e(_,E,b,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,yoe(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new B6e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new j0(ca.fromBase64String(e))}catch(i){throw new on(wt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new j0(ca.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new on(wt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new aa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r3{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new on(wt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new on(wt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Lr(this._lat,e._lat)||Lr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y6e=/^__.*__$/;class X6e{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return this.fieldMask!==null?new Yg(e,this.data,this.fieldMask,i,this.fieldTransforms):new DR(e,this.data,i,this.fieldTransforms)}}class boe{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return new Yg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function Toe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Gn()}}class s3{constructor(e,i,a,l,d,f){this.settings=e,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new s3(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.$u(e),l}Ku(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Ck(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(Toe(this.Lu)&&Y6e.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class J6e{constructor(e,i,a){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=a||wN(e)}ju(e,i,a,l=!1){return new s3({Lu:e,methodName:i,zu:a,path:aa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function NN(n){const e=n._freezeSettings(),i=wN(n._databaseId);return new J6e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function woe(n,e,i,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,e,i,l);a3("Data must be an object, but it was:",f,a);const _=Coe(a,f);let E,b;if(d.merge)E=new Ul(f.fieldMask),b=f.fieldTransforms;else if(d.mergeFields){const w=[];for(const I of d.mergeFields){const k=Aj(e,I,i);if(!f.contains(k))throw new on(wt.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);Ioe(w,k)||w.push(k)}E=new Ul(w),b=f.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,b=f.fieldTransforms;return new X6e(new el(_),E,b)}class DN extends kN{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof DN}}class o3 extends kN{_toFieldTransform(e){return new z4e(e.path,new rR)}isEqual(e){return e instanceof o3}}function Q6e(n,e,i,a){const l=n.ju(1,e,i);a3("Data must be an object, but it was:",l,a);const d=[],f=el.empty();qg(a,(E,b)=>{const w=c3(e,E,i);b=Xi(b);const I=l.Ku(w);if(b instanceof DN)d.push(w);else{const k=UR(b,I);k!=null&&(d.push(w),f.set(w,k))}});const _=new Ul(d);return new boe(f,_,l.fieldTransforms)}function Z6e(n,e,i,a,l,d){const f=n.ju(1,e,i),_=[Aj(e,a,i)],E=[l];if(d.length%2!=0)throw new on(wt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<d.length;k+=2)_.push(Aj(e,d[k])),E.push(d[k+1]);const b=[],w=el.empty();for(let k=_.length-1;k>=0;--k)if(!Ioe(b,_[k])){const V=_[k];let L=E[k];L=Xi(L);const F=f.Ku(V);if(L instanceof DN)b.push(V);else{const B=UR(L,F);B!=null&&(b.push(V),w.set(V,B))}}const I=new Ul(b);return new boe(w,I,f.fieldTransforms)}function e8e(n,e,i,a=!1){return UR(i,n.ju(a?4:3,e))}function UR(n,e){if(Roe(n=Xi(n)))return a3("Unsupported field value:",e,n),Coe(n,e);if(n instanceof kN)return function(a,l){if(!Toe(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const _ of a){let E=UR(_,l.Uu(f));E==null&&(E={nullValue:"NULL_VALUE"}),d.push(E),f++}return{arrayValue:{values:d}}}(n,e)}return function(a,l){if((a=Xi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return F4e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=fo.fromDate(a);return{timestampValue:vk(l.serializer,d)}}if(a instanceof fo){const d=new fo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:vk(l.serializer,d)}}if(a instanceof r3)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof j0)return{bytesValue:Gse(l.serializer,a._byteString)};if(a instanceof ja){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:j5(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof i3)return function(f,_){return{mapValue:{fields:{[yse]:{stringValue:Ese},[mk]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw _.Wu("VectorValues must only contain numeric values.");return M5(_.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${IN(a)}`)}(n,e)}function Coe(n,e){const i={};return hse(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qg(n,(a,l)=>{const d=UR(l,e.qu(a));d!=null&&(i[a]=d)}),{mapValue:{fields:i}}}function Roe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof fo||n instanceof r3||n instanceof j0||n instanceof ja||n instanceof kN||n instanceof i3)}function a3(n,e,i){if(!Roe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=IN(i);throw a==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+a)}}function Aj(n,e,i){if((e=Xi(e))instanceof ON)return e._internalPath;if(typeof e=="string")return c3(n,e);throw Ck("Field path arguments must be of type string or ",n,!1,void 0,i)}const t8e=new RegExp("[~\\*/\\[\\]]");function c3(n,e,i){if(e.search(t8e)>=0)throw Ck(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new ON(...e.split("."))._internalPath}catch{throw Ck(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function Ck(n,e,i,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(d||f)&&(E+=" (found",d&&(E+=` in field ${a}`),f&&(E+=` in document ${l}`),E+=")"),new on(wt.INVALID_ARGUMENT,_+n+E)}function Ioe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aoe{constructor(e,i,a,l,d){this._firestore=e,this._userDataWriter=i,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new ja(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new n8e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(l3("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class n8e extends Aoe{data(){return super.data()}}function l3(n,e){return typeof e=="string"?c3(n,e):e instanceof ON?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Poe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new on(wt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class u3{}class Ooe extends u3{}function oR(n,e,...i){let a=[];e instanceof u3&&a.push(e),a=a.concat(i),function(d){const f=d.filter(E=>E instanceof d3).length,_=d.filter(E=>E instanceof xN).length;if(f>1||f>0&&_>0)throw new on(wt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class xN extends Ooe{constructor(e,i,a){super(),this._field=e,this._op=i,this._value=a,this.type="where"}static _create(e,i,a){return new xN(e,i,a)}_apply(e){const i=this._parse(e);return koe(e._query,i),new Xg(e.firestore,e.converter,yj(e._query,i))}_parse(e){const i=NN(e.firestore);return function(d,f,_,E,b,w,I){let k;if(b.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new on(wt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){yQ(I,w);const L=[];for(const F of I)L.push(_Q(E,d,F));k={arrayValue:{values:L}}}else k=_Q(E,d,I)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||yQ(I,w),k=e8e(_,f,I,w==="in"||w==="not-in");return Js.create(b,w,k)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function Rk(n,e,i){const a=e,l=l3("where",n);return xN._create(l,a,i)}class d3 extends u3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new d3(e,i)}_parse(e){const i=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:Xd.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,d){let f=l;const _=d.getFlattenedFilters();for(const E of _)koe(f,E),f=yj(f,E)}(e._query,i),new Xg(e.firestore,e.converter,yj(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class h3 extends Ooe{constructor(e,i,a){super(),this.type=e,this._limit=i,this._limitType=a}static _create(e,i,a){return new h3(e,i,a)}_apply(e){return new Xg(e.firestore,e.converter,yk(e._query,this._limit,this._limitType))}}function r8e(n){return h3._create("limit",n,"F")}function _Q(n,e,i){if(typeof(i=Xi(i))=="string"){if(i==="")throw new on(wt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ise(e)&&i.indexOf("/")!==-1)throw new on(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=e.path.child($i.fromString(i));if(!Tn.isDocumentKey(a))throw new on(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return NJ(n,new Tn(a))}if(i instanceof ja)return NJ(n,i._key);throw new on(wt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${IN(i)}.`)}function yQ(n,e){if(!Array.isArray(n)||n.length===0)throw new on(wt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function koe(n,e){const i=function(l,d){for(const f of l)for(const _ of f.getFlattenedFilters())if(d.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new on(wt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new on(wt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class i8e{convertValue(e,i="none"){switch(jg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ms(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Vg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Gn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const a={};return qg(e,(l,d)=>{a[l]=this.convertValue(d,i)}),a}convertVectorValue(e){var i,a,l;const d=(l=(a=(i=e.fields)===null||i===void 0?void 0:i[mk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Ms(f.doubleValue));return new i3(d)}convertGeoPoint(e){return new r3(Ms(e.latitude),Ms(e.longitude))}convertArray(e,i){return(e.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(e,i){switch(i){case"previous":const a=_N(e);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(eR(e));default:return null}}convertTimestamp(e){const i=Ug(e);return new fo(i.seconds,i.nanos)}convertDocumentKey(e,i){const a=$i.fromString(e);di(Xse(a));const l=new tR(a.get(1),a.get(3)),d=new Tn(a.popFirst(5));return l.isEqual(i)||Kf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Noe(n,e,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Doe extends Aoe{constructor(e,i,a,l,d,f){super(e,i,a,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new jO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const a=this._document.data.field(l3("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class jO extends Doe{data(e={}){return super.data(e)}}class xoe{constructor(e,i,a,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new iC(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(a=>{e.call(i,new jO(this._firestore,this._userDataWriter,a.key,a,new iC(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new on(wt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(_=>{const E=new jO(l._firestore,l._userDataWriter,_.doc.key,_.doc,new iC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>d||_.type!==3).map(_=>{const E=new jO(l._firestore,l._userDataWriter,_.doc.key,_.doc,new iC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,w=-1;return _.type!==0&&(b=f.indexOf(_.doc.key),f=f.delete(_.doc.key)),_.type!==1&&(f=f.add(_.doc),w=f.indexOf(_.doc.key)),{type:s8e(_.type),doc:E,oldIndex:b,newIndex:w}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function s8e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hc(n){n=zl(n,ja);const e=zl(n.firestore,Wg);return G6e(PN(e),n._key).then(i=>Loe(e,n,i))}class p3 extends i8e{constructor(e){super(),this.firestore=e}convertBytes(e){return new j0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new ja(this.firestore,null,i)}}function zg(n){n=zl(n,Xg);const e=zl(n.firestore,Wg),i=PN(e),a=new p3(e);return Poe(n._query),H6e(i,n._query).then(l=>new xoe(e,a,n,l))}function Ik(n,e,i){n=zl(n,ja);const a=zl(n.firestore,Wg),l=Noe(n.converter,e,i);return f3(a,[woe(NN(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Kd.none())])}function Ku(n,e,i,...a){n=zl(n,ja);const l=zl(n.firestore,Wg),d=NN(l);let f;return f=typeof(e=Xi(e))=="string"||e instanceof ON?Z6e(d,"updateDoc",n._key,e,i,a):Q6e(d,"updateDoc",n._key,e),f3(l,[f.toMutation(n._key,Kd.exists(!0))])}function o8e(n,e){const i=zl(n.firestore,Wg),a=qi(n),l=Noe(n.converter,e);return f3(i,[woe(NN(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Kd.exists(!1))]).then(()=>a)}function a8e(n,...e){var i,a,l;n=Xi(n);let d={includeMetadataChanges:!1,source:"default"},f=0;typeof e[f]!="object"||gQ(e[f])||(d=e[f],f++);const _={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(gQ(e[f])){const I=e[f];e[f]=(i=I.next)===null||i===void 0?void 0:i.bind(I),e[f+1]=(a=I.error)===null||a===void 0?void 0:a.bind(I),e[f+2]=(l=I.complete)===null||l===void 0?void 0:l.bind(I)}let E,b,w;if(n instanceof ja)b=zl(n.firestore,Wg),w=yN(n._key.path),E={next:I=>{e[f]&&e[f](Loe(b,n,I))},error:e[f+1],complete:e[f+2]};else{const I=zl(n,Xg);b=zl(I.firestore,Wg),w=I._query;const k=new p3(b);E={next:V=>{e[f]&&e[f](new xoe(b,k,I,V))},error:e[f+1],complete:e[f+2]},Poe(n._query)}return function(k,V,L,F){const B=new n3(F),q=new Z5(V,B,L);return k.asyncQueue.enqueueAndForget(async()=>X5(await wk(k),q)),()=>{B.su(),k.asyncQueue.enqueueAndForget(async()=>J5(await wk(k),q))}}(PN(b),w,_,E)}function f3(n,e){return function(a,l){const d=new Bf;return a.asyncQueue.enqueueAndForget(async()=>N6e(await z6e(a),l,d)),d.promise}(PN(n),e)}function Loe(n,e,i){const a=i.docs.get(e._key),l=new p3(n);return new Doe(n,l,e._key,a,new iC(i.hasPendingWrites,i.fromCache),e.converter)}function c8e(){return new o3("serverTimestamp")}(function(e,i=!0){(function(l){J0=l})(oE),Jy(new Lg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),_=new Wg(new t4e(a.getProvider("auth-internal")),new i4e(f,a.getProvider("app-check-internal")),function(b,w){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new on(wt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tR(b.options.projectId,w)}(f,l),f);return d=Object.assign({useFetchStreams:i},d),_._setSettings(d),_},"PUBLIC").setMultipleInstances(!0)),dp(SJ,bJ,e),dp(SJ,bJ,"esm2017")})();var l8e="firebase",u8e="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */dp(l8e,u8e,"app");const d8e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!0);console.log("import.meta.env:",d8e);const hg={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:hg.apiKey?`${hg.apiKey.substring(0,5)}...`:"missing",authDomain:hg.authDomain,projectId:hg.projectId,storageBucket:hg.storageBucket,messagingSenderId:hg.messagingSenderId?"present":"missing",appId:hg.appId?"present":"missing"});const Moe=yie(hg),h8e=fN(Moe),ii=Soe(Moe),tO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${a}.${l}`},Te={log:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${tO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${tO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${tO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${tO()}] ${n}`)}},yp=async n=>{try{Te.log("userFirestore: Get user Profile data for user ID: "+n);const e=qi(ii,"users",n),i=await hc(e);return i.exists()?(Te.log("userFirestore: Found Profile for : "+i.data().Nickname),i.data()):(Te.error("userFirestore: user profile document not found"),null)}catch(e){throw Te.error("userFirestore: Error fetching user profile data:",e),e}},p8e=async(n,e,i)=>{try{Te.log("userFirestore: Registering new user with email:",n);const l=(await M5e(h8e,n,e)).user,d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!0,...i};Te.log("userFirestore: Creating user document with data:",d);const f=qi(ii,"users",l.uid);return await Ik(f,d),Te.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw Te.error("userFirestore: Error creating user:",a),a}},Uoe=async(n,e)=>{try{Te.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=qi(ii,"users",n);await Ku(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),Te.log("userFirestore: rpmURL updated successfully.")}catch(i){throw Te.error("userFirestore: Error updating rpmURL:",i),i}},f8e=(n,e)=>{if(e==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning true`),!0;if(e==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${e} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning false`),!1},Voe=async(n,e)=>f8e(n,e),m8e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Hd={sendUserToUnity:"sendUserToUnity"};class g8e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const a=this.events[e];a?(a.forEach(l=>{l(i)}),Te.log(`EventBus: Published event '${e}'`)):Te.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const a=(l=this.events[e])==null?void 0:l.indexOf(i);a>-1&&this.events[e].splice(a,1)}}const $d=new g8e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const joe="firebasestorage.googleapis.com",Foe="storageBucket",_8e=2*60*1e3,y8e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As extends bp{constructor(e,i,a=0){super(UU(e),`Firebase Storage: ${i} (${UU(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,As.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return UU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Is;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Is||(Is={}));function UU(n){return"storage/"+n}function m3(){const n="An unknown error occurred, please check the error payload for server response.";return new As(Is.UNKNOWN,n)}function E8e(n){return new As(Is.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function v8e(n){return new As(Is.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function S8e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new As(Is.UNAUTHENTICATED,n)}function b8e(){return new As(Is.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function T8e(n){return new As(Is.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function w8e(){return new As(Is.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function C8e(){return new As(Is.CANCELED,"User canceled the upload/download.")}function R8e(n){return new As(Is.INVALID_URL,"Invalid URL '"+n+"'.")}function I8e(n){return new As(Is.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function A8e(){return new As(Is.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Foe+"' property when initializing the app?")}function P8e(){return new As(Is.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function O8e(){return new As(Is.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function k8e(n){return new As(Is.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Pj(n){return new As(Is.INVALID_ARGUMENT,n)}function Boe(){return new As(Is.APP_DELETED,"The Firebase app was deleted.")}function N8e(n){return new As(Is.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function TC(n,e){return new As(Is.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Iw(n){throw new As(Is.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let a;try{a=Vl.makeFromUrl(e,i)}catch{return new Vl(e,"")}if(a.path==="")return a;throw I8e(e)}static makeFromUrl(e,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ae){ae.path.charAt(ae.path.length-1)==="/"&&(ae.path_=ae.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+l+f,"i"),E={bucket:1,path:3};function b(ae){ae.path_=decodeURIComponent(ae.path)}const w="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),k="(/([^?#]*).*)?$",V=new RegExp(`^https?://${I}/${w}/b/${l}/o${k}`,"i"),L={bucket:1,path:3},F=i===joe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,B="([^?#]*)",q=new RegExp(`^https?://${F}/${l}/${B}`,"i"),Q=[{regex:_,indices:E,postModify:d},{regex:V,indices:L,postModify:b},{regex:q,indices:{bucket:1,path:2},postModify:b}];for(let ae=0;ae<Q.length;ae++){const re=Q[ae],fe=re.regex.exec(e);if(fe){const Z=fe[re.indices.bucket];let ee=fe[re.indices.path];ee||(ee=""),a=new Vl(Z,ee),re.postModify(a);break}}if(a==null)throw R8e(e);return a}}class D8e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x8e(n,e,i){let a=1,l=null,d=null,f=!1,_=0;function E(){return _===2}let b=!1;function w(...B){b||(b=!0,e.apply(null,B))}function I(B){l=setTimeout(()=>{l=null,n(V,E())},B)}function k(){d&&clearTimeout(d)}function V(B,...q){if(b){k();return}if(B){k(),w.call(null,B,...q);return}if(E()||f){k(),w.call(null,B,...q);return}a<64&&(a*=2);let Q;_===1?(_=2,Q=0):Q=(a+Math.random())*1e3,I(Q)}let L=!1;function F(B){L||(L=!0,k(),!b&&(l!==null?(B||(_=2),clearTimeout(l),I(0)):B||(_=1)))}return I(0),d=setTimeout(()=>{f=!0,F(!0)},i),F}function L8e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M8e(n){return n!==void 0}function U8e(n){return typeof n=="object"&&!Array.isArray(n)}function g3(n){return typeof n=="string"||n instanceof String}function EQ(n){return _3()&&n instanceof Blob}function _3(){return typeof Blob<"u"}function vQ(n,e,i,a){if(a<e)throw Pj(`Invalid value for '${n}'. Expected ${e} or greater.`);if(a>i)throw Pj(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(n,e,i){let a=e;return i==null&&(a=`https://${e}`),`${i}://${a}/v0${n}`}function Woe(n){const e=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=e(a)+"="+e(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Fy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Fy||(Fy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V8e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=e.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j8e{constructor(e,i,a,l,d,f,_,E,b,w,I,k=!0){this.url_=e,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=E,this.timeout_=b,this.progressCallback_=w,this.connectionFactory_=I,this.retry=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((V,L)=>{this.resolve_=V,this.reject_=L,this.start_()})}start_(){const e=(a,l)=>{if(l){a(!1,new nO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=_=>{const E=_.loaded,b=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,b)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const _=d.getErrorCode()===Fy.NO_ERROR,E=d.getStatus();if(!_||V8e(E,this.additionalRetryCodes_)&&this.retry){const w=d.getErrorCode()===Fy.ABORT;a(!1,new nO(!1,null,w));return}const b=this.successCodes_.indexOf(E)!==-1;a(!0,new nO(b,d))})},i=(a,l)=>{const d=this.resolve_,f=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());M8e(E)?d(E):d()}catch(E){f(E)}else if(_!==null){const E=m3();E.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,E)):f(E)}else if(l.canceled){const E=this.appDelete_?Boe():C8e();f(E)}else{const E=w8e();f(E)}};this.canceled_?i(!1,new nO(!1,null,!0)):this.backoffId_=x8e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&L8e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class nO{constructor(e,i,a){this.wasSuccessCode=e,this.connection=i,this.canceled=!!a}}function F8e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function B8e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function W8e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function z8e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function G8e(n,e,i,a,l,d,f=!0){const _=Woe(n.urlParams),E=n.url+_,b=Object.assign({},n.headers);return W8e(b,e),F8e(b,i),B8e(b,d),z8e(b,a),new j8e(E,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H8e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function $8e(...n){const e=H8e();if(e!==void 0){const i=new e;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(_3())return new Blob(n);throw new As(Is.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function K8e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q8e(n){if(typeof atob>"u")throw k8e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class VU{constructor(e,i){this.data=e,this.contentType=i||null}}function Y8e(n,e){switch(n){case rp.RAW:return new VU(zoe(e));case rp.BASE64:case rp.BASE64URL:return new VU(Goe(n,e));case rp.DATA_URL:return new VU(J8e(e),Q8e(e))}throw m3()}function zoe(n){const e=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const d=a,f=n.charCodeAt(++i);a=65536|(d&1023)<<10|f&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function X8e(n){let e;try{e=decodeURIComponent(n)}catch{throw TC(rp.DATA_URL,"Malformed data URL.")}return zoe(e)}function Goe(n,e){switch(n){case rp.BASE64:{const l=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(l||d)throw TC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case rp.BASE64URL:{const l=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(l||d)throw TC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=q8e(e)}catch(l){throw l.message.includes("polyfill")?l:TC(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class Hoe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw TC(rp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=Z8e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function J8e(n){const e=new Hoe(n);return e.base64?Goe(rp.BASE64,e.rest):X8e(e.rest)}function Q8e(n){return new Hoe(n).contentType}function Z8e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e,i){let a=0,l="";EQ(e)?(this.data_=e,a=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(EQ(this.data_)){const a=this.data_,l=K8e(a,e,i);return l===null?null:new Eg(l)}else{const a=new Uint8Array(this.data_.buffer,e,i-e);return new Eg(a,!0)}}static getBlob(...e){if(_3()){const i=e.map(a=>a instanceof Eg?a.data_:a);return new Eg($8e.apply(null,i))}else{const i=e.map(f=>g3(f)?Y8e(rp.RAW,f).data:f.data_);let a=0;i.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return i.forEach(f=>{for(let _=0;_<f.length;_++)l[d++]=f[_]}),new Eg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $oe(n){let e;try{e=JSON.parse(n)}catch{return null}return U8e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eWe(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function tWe(n,e){const i=e.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function Koe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nWe(n,e){return e}class lc{constructor(e,i,a,l){this.server=e,this.local=i||e,this.writable=!!a,this.xform=l||nWe}}let rO=null;function rWe(n){return!g3(n)||n.length<2?n:Koe(n)}function qoe(){if(rO)return rO;const n=[];n.push(new lc("bucket")),n.push(new lc("generation")),n.push(new lc("metageneration")),n.push(new lc("name","fullPath",!0));function e(d,f){return rWe(f)}const i=new lc("name");i.xform=e,n.push(i);function a(d,f){return f!==void 0?Number(f):f}const l=new lc("size");return l.xform=a,n.push(l),n.push(new lc("timeCreated")),n.push(new lc("updated")),n.push(new lc("md5Hash",null,!0)),n.push(new lc("cacheControl",null,!0)),n.push(new lc("contentDisposition",null,!0)),n.push(new lc("contentEncoding",null,!0)),n.push(new lc("contentLanguage",null,!0)),n.push(new lc("contentType",null,!0)),n.push(new lc("metadata","customMetadata",!0)),rO=n,rO}function iWe(n,e){function i(){const a=n.bucket,l=n.fullPath,d=new Vl(a,l);return e._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function sWe(n,e,i){const a={};a.type="file";const l=i.length;for(let d=0;d<l;d++){const f=i[d];a[f.local]=f.xform(a,e[f.server])}return iWe(a,n),a}function Yoe(n,e,i){const a=$oe(e);return a===null?null:sWe(n,a,i)}function oWe(n,e,i,a){const l=$oe(e);if(l===null||!g3(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(b=>{const w=n.bucket,I=n.fullPath,k="/b/"+f(w)+"/o/"+f(I),V=LN(k,i,a),L=Woe({alt:"media",token:b});return V+L})[0]}function aWe(n,e){const i={},a=e.length;for(let l=0;l<a;l++){const d=e[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class y3{constructor(e,i,a,l){this.url=e,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xoe(n){if(!n)throw m3()}function cWe(n,e){function i(a,l){const d=Yoe(n,l,e);return Xoe(d!==null),d}return i}function lWe(n,e){function i(a,l){const d=Yoe(n,l,e);return Xoe(d!==null),oWe(d,l,n.host,n._protocol)}return i}function Joe(n){function e(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=b8e():l=S8e():i.getStatus()===402?l=v8e(n.bucket):i.getStatus()===403?l=T8e(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return e}function Qoe(n){const e=Joe(n);function i(a,l){let d=e(a,l);return a.getStatus()===404&&(d=E8e(n.path)),d.serverResponse=l.serverResponse,d}return i}function uWe(n,e,i){const a=e.fullServerUrl(),l=LN(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,_=new y3(l,d,lWe(n,i),f);return _.errorHandler=Qoe(e),_}function dWe(n,e){const i=e.fullServerUrl(),a=LN(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(E,b){}const _=new y3(a,l,f,d);return _.successCodes=[200,204],_.errorHandler=Qoe(e),_}function hWe(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function pWe(n,e,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=e.size(),a.contentType||(a.contentType=hWe(null,e)),a}function fWe(n,e,i,a,l){const d=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function _(){let Q="";for(let ae=0;ae<2;ae++)Q=Q+Math.random().toString().slice(2);return Q}const E=_();f["Content-Type"]="multipart/related; boundary="+E;const b=pWe(e,a,l),w=aWe(b,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+E+`\r
Content-Type: `+b.contentType+`\r
\r
`,k=`\r
--`+E+"--",V=Eg.getBlob(I,a,k);if(V===null)throw P8e();const L={name:b.fullPath},F=LN(d,n.host,n._protocol),B="POST",q=n.maxUploadRetryTime,$=new y3(F,B,cWe(n,i),q);return $.urlParams=L,$.headers=f,$.body=V.uploadData(),$.errorHandler=Joe(e),$}class mWe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Fy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Fy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Fy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,a,l){if(this.sent_)throw Iw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Iw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Iw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Iw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Iw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class gWe extends mWe{initXhr(){this.xhr_.responseType="text"}}function E3(){return new gWe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(e,i){this._service=e,i instanceof Vl?this._location=i:this._location=Vl.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new nE(e,i)}get root(){const e=new Vl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Koe(this._location.path)}get storage(){return this._service}get parent(){const e=eWe(this._location.path);if(e===null)return null;const i=new Vl(this._location.bucket,e);return new nE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw N8e(e)}}function _We(n,e,i){n._throwIfRoot("uploadBytes");const a=fWe(n.storage,n._location,qoe(),new Eg(e,!0),i);return n.storage.makeRequestWithTokens(a,E3).then(l=>({metadata:l,ref:n}))}function yWe(n){n._throwIfRoot("getDownloadURL");const e=uWe(n.storage,n._location,qoe());return n.storage.makeRequestWithTokens(e,E3).then(i=>{if(i===null)throw O8e();return i})}function EWe(n){n._throwIfRoot("deleteObject");const e=dWe(n.storage,n._location);return n.storage.makeRequestWithTokens(e,E3)}function vWe(n,e){const i=tWe(n._location.path,e),a=new Vl(n._location.bucket,i);return new nE(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SWe(n){return/^[A-Za-z]+:\/\//.test(n)}function bWe(n,e){return new nE(n,e)}function Zoe(n,e){if(n instanceof v3){const i=n;if(i._bucket==null)throw A8e();const a=new nE(i,i._bucket);return e!=null?Zoe(a,e):a}else return e!==void 0?vWe(n,e):n}function TWe(n,e){if(e&&SWe(e)){if(n instanceof v3)return bWe(n,e);throw Pj("To use ref(service, url), the first argument must be a Storage instance.")}else return Zoe(n,e)}function SQ(n,e){const i=e==null?void 0:e[Foe];return i==null?null:Vl.makeFromBucketSpec(i,n)}function wWe(n,e,i,a={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:mie(l,n.app.options.projectId))}class v3{constructor(e,i,a,l,d){this.app=e,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=joe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=_8e,this._maxUploadRetryTime=y8e,this._requests=new Set,l!=null?this._bucket=Vl.makeFromBucketSpec(l,this._host):this._bucket=SQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Vl.makeFromBucketSpec(this._url,e):this._bucket=SQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){vQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){vQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Ll(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new nE(this,e)}_makeRequest(e,i,a,l,d=!0){if(this._deleted)return new D8e(Boe());{const f=G8e(e,this._appId,a,l,i,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,a,l).getPromise()}}const bQ="@firebase/storage",TQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eae="storage";function S3(n,e,i){return n=Xi(n),_We(n,e,i)}function MN(n){return n=Xi(n),yWe(n)}function b3(n){return n=Xi(n),EWe(n)}function uE(n,e){return n=Xi(n),TWe(n,e)}function dE(n=S5(),e){n=Xi(n);const a=uN(n,eae).getImmediate({identifier:e}),l=hie("storage");return l&&CWe(a,...l),a}function CWe(n,e,i,a={}){wWe(n,e,i,a)}function RWe(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new v3(i,a,l,e,oE)}function IWe(){Jy(new Lg(eae,RWe,"PUBLIC").setMultipleInstances(!0)),dp(bQ,TQ,""),dp(bQ,TQ,"esm2017")}IWe();const FO=async n=>{const e=dE(),i=uE(e,n);try{return await MN(i)}catch(a){throw Te.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let aR={};const Og=async n=>{try{const e=qi(ii,"spaces",n),i=await hc(e);if(i.exists()){let a=i.data();if(a.webglBuildId){const l=qi(ii,"webglBuilds",a.webglBuildId),d=await hc(l);if(d.exists()){const f=d.data();a={...a,...f}}else Te.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await AWe(a),a=PWe(a),console.log("Space data:",a),Te.log(`spacesFirestore: Caching space data for: ${n}`),aR[n]=a,a}else return Te.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw Te.error("spacesFirestore: Error fetching item data:",e),e}},AWe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await FO(l))});return await Promise.all(i),n},PWe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:e,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let jU={};const tae=async n=>{Te.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(jU[n])return Te.log("spacesFirestore: Returning cached videos for space:",n),jU[n];const e=Yf(ii,`spaces/${n}/videos`),i=await zg(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),jU[n]=a,a}catch(e){throw Te.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},OWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=dE(),a=Date.now(),l=e.name.split(".").pop(),d=`logo_${a}.${l}`,f=uE(i,`spaces/${n}/logo/${d}`);Te.log(`Uploading logo for space ${n}`);const _=await S3(f,e),E=await MN(_.ref),b=qi(ii,"spaces",n);return await Ku(b,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),Te.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw Te.error("Error uploading space logo:",i),i}},kWe=async n=>{try{const e=qi(ii,"spaces",n),i=await hc(e);if(!i.exists())return Te.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=dE(),d=uE(l,a.logoGsUrl);try{await b3(d),Te.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){Te.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Ku(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),Te.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw Te.error("Error deleting space logo:",e),e}},NWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=dE(),a=Date.now(),l=e.name.split(".").pop(),d=`background_${a}.${l}`,f=uE(i,`spaces/${n}/background/${d}`);Te.log(`Uploading background for space ${n}`);const _=await S3(f,e),E=await MN(_.ref),b=qi(ii,"spaces",n);return await Ku(b,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),Te.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw Te.error("Error uploading space background:",i),i}},DWe=async n=>{try{const e=qi(ii,"spaces",n),i=await hc(e);if(!i.exists())return Te.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=dE(),d=uE(l,a.backgroundGsUrl);try{await b3(d),Te.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){Te.warn(`Could not delete background file from storage: ${f.message}`)}}return await Ku(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),Te.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw Te.error("Error deleting space background:",e),e}},xWe=async(n,e)=>{try{Te.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=qi(ii,"spaces",n),a=await hc(i);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Ku(i,d),aR[n]&&delete aR[n],Te.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw Te.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},LWe=async(n,e)=>{try{Te.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=qi(ii,"spaces",n);if(!(await hc(i)).exists())throw new Error(`Space with ID ${n} not found`);await Ku(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),aR[n]&&delete aR[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),Te.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw Te.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},ul=D.createContext(null),VR=({children:n})=>{const[e,i]=D.useState(null),a=D.useRef(null),[l,d]=D.useState(!0),f=fN(),_=$=>$?$.Nickname?$.Nickname:`${$.firstName} ${$.lastName}`:"Anon";D.useEffect(()=>{const $=$ie(f,async Q=>{if(Te.log("UserProvider: Firebase onAuthStateChanged() fired"),Q)try{const ae=await yp(Q.uid),re=_(ae),fe={uid:Q.uid,email:Q.email,emailVerified:Q.emailVerified,...ae,displayName:re};console.log(fe),i(fe),a.current=fe,I(fe)}catch(ae){Te.error("UserProvider: Error fetching user profile data:",ae)}else i(null),a.current=null;d(!1)});return()=>{$&&$()}},[]);const E=async($,Q,ae)=>{try{const{firstName:re,lastName:fe}=ae,Z=`${re}${fe.charAt(0).toUpperCase()}`,ee={...ae,Nickname:Z,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},ne=await p8e($,Q,ee),oe=_(ee),ge={uid:ne.uid,email:ne.email,...ee,displayName:oe};return i(ge),a.current=ge,Te.log("UserProvider: User registered successfully with groups:",ee.groups),ge}catch(re){throw Te.error("UserProvider: Error creating user:",re),re}},b=async($,Q)=>{try{const ae=await U5e(f,$,Q),re=await yp(ae.user.uid),fe=_(re),Z={uid:ae.user.uid,email:ae.user.email,emailVerified:ae.user.emailVerified,...re,displayName:fe};i(Z),I(Z)}catch(ae){throw Te.error("UserProvider: Error signing in:",ae),ae}},w=async()=>{try{await B5e(f),i(null),Te.log("UserProvider: User signed out.")}catch($){throw Te.error("UserProvider: Error signing out:",$),$}},I=()=>{const $=a.current;if($){const Q=k($);Te.log("UserProvider: sendUserToUnity() using the eventBus",Q),$d.publish(Hd.sendUserToUnity,Q)}else Te.log("UserProvider: No current user to send to Unity.")},k=$=>{const Q={};return[...m8e,"uid"].forEach(re=>{$.hasOwnProperty(re)&&(Q[re]=$[re])}),Q},V=async $=>!e||!e.uid?!1:await Voe(e.uid,$),L=async $=>{if(!e||!e.uid)return!1;try{const Q=await Og($);if(Q.usersAllowed.includes(e.uid)||Q.userAdmin.includes(e.uid)||Q.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const re=`space_${$}_owners`,fe=`space_${$}_hosts`;if(e.groups.includes(re)||e.groups.includes(fe))return Te.log(`UserProvider: User ${e.uid} has access to space ${$} as owner/host`),!0}return Q.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(Q){return Te.error("UserProvider: Error verifying user access to space:",Q),!1}},F=async $=>{if(!e||!e.uid)return!1;try{return(await Og($)).userAdmin.includes(e.uid)}catch(Q){return Te.error("UserProvider: Error verifying user admin status for space:",Q),!1}},B=async $=>{if(!e||!e.uid)return!1;try{return(await Og($)).usersModerators.includes(e.uid)}catch(Q){return Te.error("UserProvider: Error verifying user moderator status for space:",Q),!1}},q=async()=>{try{const $=f.currentUser;return $&&!$.emailVerified?(await V5e($),Te.log("UserProvider: Verification email resent to:",$.email),!0):!1}catch($){throw Te.error("UserProvider: Error resending verification email:",$),$}};return S.jsx(ul.Provider,{value:{user:e,loading:l,register:E,signIn:b,signOut:w,sendUserToUnity:I,isUserInGroup:V,userHasAccessToSpace:L,userIsAdminOfSpace:F,userIsModeratorOfSpace:B,resendVerificationEmail:q},children:n})},nae=D.createContext(),Jd=()=>D.useContext(nae),jR=({children:n})=>{const[e,i]=D.useState(!1),a=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const E=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const f=D.useCallback(E=>{a.current=E},[]),_=D.useCallback(()=>{const E=a.current;if(!E)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const E=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),S.jsx(nae.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:S.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},MWe=Yf(ii,"website"),UWe=async()=>{const n=await zg(MWe),e={};return n.forEach(i=>{e[i.id]=i.data()}),e},T3=async n=>{const e=qi(ii,"website",n),i=await hc(e);return i.exists()?i.data():null},rae=async(n,e)=>{const i=qi(ii,"website",n);return(await hc(i)).exists()?await Ku(i,e):await Ik(i,e),!0},iae=D.createContext(),sae=()=>D.useContext(iae),VWe=({children:n})=>{const[e,i]=D.useState({}),[a,l]=D.useState(!0),[d,f]=D.useState(null);D.useEffect(()=>{(async()=>{try{l(!0);const w=await UWe();i(w),f(null)}catch(w){console.error("Error loading website content:",w),f(w.message)}finally{l(!1)}})()},[]);const E={content:e,loading:a,error:d,getContent:async b=>{if(e[b])return e[b];try{const w=await T3(b);return w&&i(I=>({...I,[b]:w})),w}catch(w){return console.error(`Error fetching content for ${b}:`,w),f(w.message),null}}};return S.jsx(iae.Provider,{value:E,children:n})},jWe=yxe({colors:{brand:{50:"#e0f2ff",100:"#b0d5ff",200:"#80b9ff",300:"#509eff",400:"#2084ff",500:"#0080ff",600:"#0059b3",700:"#003d80",800:"#00264d",900:"#00101f"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"}},fonts:{heading:"'Montserrat', sans-serif",body:"'Lato', sans-serif"},styles:{global:{body:{bg:"white",color:"gray.800"}}},components:{Button:{baseStyle:{fontWeight:"medium"},variants:{solid:{bg:"brand.500",color:"white",_hover:{bg:"brand.600"}}}},Link:{baseStyle:{_hover:{textDecoration:"none",color:"brand.500"}}}}}),FWe=({videoSrc:n})=>(n==null?void 0:n.includes("vimeo.com"))?S.jsx(qe,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",children:S.jsx(qe,{as:"iframe",src:`${n}&background=1&autoplay=1&loop=1&byline=0&title=0&muted=1`,frameBorder:"0",allow:"autoplay; fullscreen",loading:"lazy",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:"100%",minHeight:"100%",width:"auto",height:"auto",objectFit:"cover",overflow:"hidden","@media (max-width: 768px)":{width:"250%",height:"250%"},"@media (min-width: 769px) and (max-width: 1200px)":{width:"150%",height:"150%"},"@media (min-width: 1201px)":{width:"100%",height:"120%"}}})}):S.jsx(qe,{as:"video",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,position:"absolute",top:"0",left:"0",width:"100%",height:"100%",sx:{objectFit:"cover",objectPosition:"center center",minWidth:"100%",minHeight:"100%"},src:n}),BWe=()=>{var d;const{content:n,loading:e,getContent:i}=sae(),[a,l]=D.useState(null);return D.useEffect(()=>{(async()=>{let _=n==null?void 0:n.homepage;_||(_=await i("homepage")),l(_)})()},[n,i]),e||!a?S.jsx(Yk,{h:"100vh",children:S.jsx(la,{size:"xl"})}):S.jsxs(S.Fragment,{children:[S.jsxs(Y0,{children:[S.jsx("title",{children:a.title}),S.jsx("meta",{name:"description",content:a.description})]}),S.jsxs(qe,{position:"relative",height:{base:"100vh",md:"100vh"},width:"100%",overflow:"hidden",children:[S.jsx(FWe,{videoSrc:a.videoSrc}),S.jsx(qe,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.5)",zIndex:"1"}),S.jsx(ar,{height:"100%",width:"100%",position:"relative",zIndex:"2",align:"center",justify:"center",px:4,children:S.jsx(Sr,{as:"h1",color:"white",fontSize:{base:"4xl",sm:"5xl",md:"6xl"},fontWeight:"bold",textAlign:"center",children:a.heroHeading})})]}),S.jsx(qe,{as:"section",py:16,children:S.jsx(Wl,{maxW:"container.xl",children:S.jsxs(Xk,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:10,children:[S.jsxs(KC,{children:[S.jsx(Sr,{as:"h2",fontSize:"2xl",fontWeight:"normal",color:"gray.500",mb:3,children:a.missionHeading}),S.jsx(Sr,{as:"h1",fontSize:{base:"4xl",md:"5xl"},fontWeight:"bold",children:a.missionTitle})]}),S.jsxs(KC,{children:[S.jsx(qe,{mb:8,children:(d=a.missionPoints)==null?void 0:d.map((f,_)=>S.jsx(Qe,{fontSize:"xl",mb:3,children:f},_))}),S.jsxs(ar,{align:"center",children:[S.jsx(Uu,{to:"/about",style:{color:"#0080ff",fontWeight:500,marginRight:"10px"},children:a.learnMoreText}),S.jsx(qe,{as:"svg",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#0080ff",children:S.jsx("path",{d:"M10 20A10 10 0 1 0 0 10a10 10 0 0 0 10 10zM8.711 4.3l5.7 5.766L8.7 15.711l-1.4-1.422 4.289-4.242-4.3-4.347z"})})]})]})]})})})]})},WWe=()=>{const{content:n,loading:e,getContent:i}=sae(),[a,l]=D.useState(null);D.useEffect(()=>{(async()=>{let E=n==null?void 0:n.aboutpage;E||(E=await i("aboutpage")),l(E)})()},[n,i]);const f=a||{title:"About Spaces",description:"Learn about the Spaces platform, our vision, and how we empower virtual collaboration and connection.",tagline:"A platform for creating virtual spaces that bring people together.",whoWeAre:{title:"Who We Are",content:"We create metaverses that are simple, accessible, and limitless. Our platform is focused on ease of use, designed for everyone, and built for creativity and connection."},ourVision:{title:"Our Vision",content:"To empower everyone to build their own virtual spaces, tailored to their needs. Whether you need public or private options, fully customizable environments, our platform offers limitless possibilities."},whatWeOffer:{title:"What We Offer",content:"Open spaces for exploration, exclusive environments for privacy, and powerful tools to shape your world exactly as you imagine it."},howItWorks:{title:"How It Works",content:"Accessible on any device, our metaverses are easy to customize and share. No downloads required - everything runs seamlessly in web browsers with simple tools for building and sharing."},contactSection:{title:"Reach Out",intro:"Interested in learning more about our spaces? Have questions about how it works? We'd love to hear from you and help you get started on your journey.",callToAction:"Fill out the form and we'll get back to you as soon as possible."},images:{topImage:"/images/Space-office-example-2-min.jpg",bottomImage:"/images/Spaces-Office-example-min.jpg"}};return e&&!a?S.jsx(Yk,{h:"100vh",children:S.jsx(la,{size:"xl"})}):S.jsxs(S.Fragment,{children:[S.jsxs(Y0,{children:[S.jsx("title",{children:f.title}),S.jsx("meta",{name:"description",content:f.description})]}),S.jsx(Wl,{maxW:"container.xl",py:10,children:S.jsxs(mr,{spacing:10,align:"stretch",children:[S.jsxs(qe,{textAlign:"center",children:[S.jsx(Sr,{as:"h1",size:"2xl",mb:6,children:f.title}),S.jsx(Qe,{fontSize:"xl",children:f.tagline})]}),S.jsxs(Hy,{columns:{base:1,md:2},spacing:10,children:[S.jsx(qe,{children:S.jsx(Va,{src:f.images.topImage,alt:"Office Space Example",borderRadius:"md",width:"100%"})}),S.jsxs(mr,{align:"start",spacing:6,children:[S.jsxs(qe,{children:[S.jsx(Sr,{as:"h2",size:"xl",mb:4,children:f.whoWeAre.title}),S.jsx(Qe,{children:f.whoWeAre.content})]}),S.jsxs(qe,{children:[S.jsx(Sr,{as:"h2",size:"xl",mb:4,children:f.ourVision.title}),S.jsx(Qe,{children:f.ourVision.content})]})]})]}),S.jsxs(Hy,{columns:{base:1,md:2},spacing:10,pt:10,children:[S.jsxs(mr,{align:"start",spacing:6,children:[S.jsxs(qe,{children:[S.jsx(Sr,{as:"h2",size:"xl",mb:4,children:f.whatWeOffer.title}),S.jsx(Qe,{children:f.whatWeOffer.content})]}),S.jsxs(qe,{children:[S.jsx(Sr,{as:"h2",size:"xl",mb:4,children:f.howItWorks.title}),S.jsx(Qe,{children:f.howItWorks.content})]})]}),S.jsx(qe,{children:S.jsx(Va,{src:f.images.bottomImage,alt:"Another Office Space Example",borderRadius:"md",width:"100%"})})]}),S.jsxs(qe,{bg:"blue.50",p:10,borderRadius:"md",mt:10,children:[S.jsx(Sr,{as:"h2",size:"xl",mb:6,textAlign:"center",children:f.contactSection.title}),S.jsxs(ar,{direction:{base:"column",md:"row"},justify:"space-between",gap:8,children:[S.jsxs(mr,{align:"start",spacing:4,flex:1,children:[S.jsx(Qe,{fontSize:"lg",children:f.contactSection.intro}),S.jsx(Qe,{fontSize:"lg",children:f.contactSection.callToAction})]}),S.jsx(qe,{flex:1,bg:"white",p:6,borderRadius:"md",children:S.jsx(mr,{spacing:4,children:S.jsx(Qe,{children:"Contact form placeholder"})})})]})]})]})})]})},zWe=Jf({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"}),GWe=Jf({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),HWe=Jf({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),$We=Jf({displayName:"DeleteIcon",path:S.jsx("g",{fill:"currentColor",children:S.jsx("path",{d:"M19.452 7.5H4.547a.5.5 0 00-.5.545l1.287 14.136A2 2 0 007.326 24h9.347a2 2 0 001.992-1.819L19.95 8.045a.5.5 0 00-.129-.382.5.5 0 00-.369-.163zm-9.2 13a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zm5 0a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zM22 4h-4.75a.25.25 0 01-.25-.25V2.5A2.5 2.5 0 0014.5 0h-5A2.5 2.5 0 007 2.5v1.25a.25.25 0 01-.25.25H2a1 1 0 000 2h20a1 1 0 000-2zM9 3.75V2.5a.5.5 0 01.5-.5h5a.5.5 0 01.5.5v1.25a.25.25 0 01-.25.25h-5.5A.25.25 0 019 3.75z"})})}),KWe=Jf({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),qWe=Jf({displayName:"EmailIcon",path:S.jsxs("g",{fill:"currentColor",children:[S.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),S.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),oae=Jf({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),YWe=Jf({displayName:"QuestionOutlineIcon",path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),aae=Jf({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),XWe=[{id:"sample1",name:"Conference Room",description:"Professional virtual meeting space for team collaboration.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}},{id:"sample2",name:"Art Gallery",description:"Immersive gallery for showcasing digital art and exhibitions.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}},{id:"sample3",name:"Social Lounge",description:"Casual environment for social gatherings and networking events.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}}],FU={id:"thepotato",name:"Spaces Metaverse",description:"Welcome to the Spaces Metaverse! This is our first test space where you can explore and interact with the virtual environment. We plan to add more functionality as we go. Please check back soon for updates.",visibility:"public",createdAt:{toDate:()=>new Date("2025-03-15")},createdBy:{displayName:"Disruptive Live"},category:"development",thumbnailUrl:"https://placehold.co/400x200?text=Spaces+Metaverse"};function JWe(){const[n,e]=D.useState([]),[i,a]=D.useState(!0),[l,d]=D.useState(null),[f,_]=D.useState(""),[E,b]=D.useState(null);D.useEffect(()=>{async function L(){try{a(!0),console.log("Fetching spaces from Firebase...");const F=oR(Yf(ii,"spaces"),r8e(50));console.log("Executing Firebase query:",F);const B=await zg(F);console.log("Query snapshot size:",B.size),B.forEach(Q=>{console.log("Found space document:",Q.id,Q.data())});const q=[];B.forEach(Q=>{const ae=Q.data();if(ae){const re={id:Q.id,...ae,name:ae.name||`Space ${Q.id}`,description:ae.description||"No description available",visibility:ae.visibility||"public"};q.push(re)}}),console.log(`Found ${q.length} spaces in Firebase:`,q),q.sort((Q,ae)=>{var Z,ee,ne,oe;const re=((ee=(Z=Q.createdAt)==null?void 0:Z.toDate)==null?void 0:ee.call(Z))||new Date(0);return(((oe=(ne=ae.createdAt)==null?void 0:ne.toDate)==null?void 0:oe.call(ne))||new Date(0))-re}),q.some(Q=>Q.id==="thepotato")||(console.log("Adding potato space data to the list"),q.push(FU)),e(q),b({spacesCount:q.length,firstSpace:q.length>0?q[0].id:"none",allSpaceIds:q.map(Q=>Q.id),firebaseQuerySize:B.size})}catch(F){console.error("Error fetching spaces:",F),b({error:F.message,code:F.code,stack:F.stack}),F.code==="permission-denied"||F.message.includes("requires an index")?(console.log("Using sample spaces data due to Firebase error:",F.message),e([...XWe,FU])):(d(`Failed to load spaces: ${F.message}`),e([FU]))}finally{a(!1)}}L()},[]);const w=n.filter(L=>L&&L.name&&L.name.toLowerCase().includes(f.toLowerCase())||L&&L.description&&L.description.toLowerCase().includes(f.toLowerCase())),I=(L,F)=>!L||!F?"unknown-space":F==="thepotato"?"the-potato-website":`${L.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}_${F}`,k=w.map(L=>L?{...L,calculatedSlug:L.slug||I(L.name,L.id)}:null).filter(Boolean),V=k.filter(L=>L&&L.slug);return i?S.jsx(qe,{height:"50vh",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(la,{size:"xl",color:"brand.500",thickness:"4px"})}):S.jsxs(S.Fragment,{children:[S.jsxs(Y0,{children:[S.jsx("title",{children:"Explore Spaces | Disruptive Spaces"}),S.jsx("meta",{name:"description",content:"Explore virtual spaces created by our community"})]}),S.jsx(qe,{py:10,children:S.jsx(Wl,{maxW:"container.xl",children:S.jsxs(nl,{spacing:8,children:[S.jsx(Sr,{as:"h1",size:"xl",children:"Explore Spaces"}),S.jsxs(I0,{children:[S.jsx($y,{pointerEvents:"none",children:S.jsx(zWe,{color:"gray.400"})}),S.jsx(or,{placeholder:"Search spaces...",value:f,onChange:L=>_(L.target.value),bg:"white",borderRadius:"md",boxShadow:"sm"})]}),l&&S.jsxs(Fu,{status:"error",borderRadius:"md",children:[S.jsx(Bu,{}),S.jsx(Qe,{children:l})]}),E&&S.jsxs(Fu,{status:"info",borderRadius:"md",variant:"subtle",children:[S.jsx(Bu,{}),S.jsxs(qe,{children:[S.jsx(Qe,{fontWeight:"bold",children:"Debug Info:"}),S.jsx(Xw,{children:JSON.stringify(E,null,2)})]})]}),S.jsxs(F1,{overflow:"hidden",variant:"outline",boxShadow:"md",children:[S.jsx(qe,{p:4,bg:"blue.50",children:S.jsx(Sr,{size:"md",children:"Spaces with Defined Slugs"})}),S.jsx(B1,{children:V.length===0?S.jsxs(Fu,{status:"info",borderRadius:"md",children:[S.jsx(Bu,{}),S.jsx(Qe,{children:"No spaces with defined slugs found. Add a 'slug' property to your spaces in Firebase."})]}):S.jsx(nl,{spacing:3,children:V.map(L=>S.jsx(qe,{p:3,borderWidth:"1px",borderRadius:"md",children:S.jsxs(ar,{justify:"space-between",wrap:"wrap",gap:2,children:[S.jsxs(qe,{children:[S.jsx(Qe,{fontWeight:"bold",children:L.name}),S.jsxs(Qe,{fontSize:"sm",color:"gray.500",children:["ID: ",L.id]})]}),S.jsxs(qe,{children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"bold",children:"Slug:"}),S.jsx(Xw,{p:1,children:L.slug})]}),S.jsx(Zn,{as:Uu,to:`/w/${L.slug}`,size:"sm",colorScheme:"blue",children:"Visit"})]})},L.id))})})]}),S.jsxs(F1,{overflow:"hidden",variant:"outline",boxShadow:"md",children:[S.jsx(qe,{p:4,bg:"gray.50",children:S.jsx(Sr,{size:"md",children:"All Spaces (with calculated slugs)"})}),S.jsx(B1,{children:S.jsx(nl,{spacing:3,children:k.map(L=>S.jsx(qe,{p:3,borderWidth:"1px",borderRadius:"md",children:S.jsxs(ar,{justify:"space-between",wrap:"wrap",gap:2,children:[S.jsxs(qe,{children:[S.jsx(Qe,{fontWeight:"bold",children:L.name}),S.jsxs(Qe,{fontSize:"sm",color:"gray.500",children:["ID: ",L.id]})]}),S.jsxs(qe,{children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"bold",children:L.slug?"Defined Slug:":"Calculated Slug:"}),S.jsx(Xw,{p:1,bg:L.slug?"green.50":"gray.50",children:L.calculatedSlug})]}),S.jsx(Zn,{as:Uu,to:`/w/${L.calculatedSlug}`,size:"sm",colorScheme:L.slug?"green":"blue",children:"Visit"})]})},L.id))})})]}),S.jsxs(F1,{overflow:"hidden",variant:"outline",boxShadow:"md",bg:"yellow.50",children:[S.jsx(qe,{p:4,bg:"yellow.100",children:S.jsx(Sr,{size:"md",children:"Test Space: The Potato Website"})}),S.jsx(B1,{children:S.jsx(Qe,{color:"gray.600",mb:4,children:'This is a special test space with ID "thepotato" and slug "the-potato-website".'})}),S.jsx(sX,{children:S.jsx(Zn,{as:Uu,to:"/w/the-potato-website",colorScheme:"yellow",width:"100%",children:"Enter Test Space"})})]}),w.length===0?S.jsxs(Fu,{status:"info",borderRadius:"md",children:[S.jsx(Bu,{}),S.jsx(Qe,{children:"No spaces found. Try a different search term or check back later."})]}):S.jsx(Hy,{columns:{base:1,md:2,lg:3},spacing:6,children:w.map(L=>S.jsxs(F1,{overflow:"hidden",variant:"outline",boxShadow:"md",children:[S.jsx(Va,{src:L.backgroundUrl||L.thumbnailUrl||`https://placehold.co/400x200?text=${encodeURIComponent(L.name)}`,alt:L.name,height:"200px",objectFit:"cover"}),S.jsx(B1,{children:S.jsxs(nl,{spacing:2,children:[S.jsxs(ar,{justify:"space-between",align:"center",children:[S.jsx(Sr,{size:"md",children:L.name}),S.jsx(Wd,{colorScheme:"green",children:"Public"})]}),S.jsx(Qe,{color:"gray.600",noOfLines:2,children:L.description||"No description available"}),S.jsxs(Qe,{fontSize:"sm",color:"gray.500",children:["ID: ",L.id]}),S.jsxs(Qe,{fontSize:"sm",color:"gray.500",children:["Slug: ",S.jsx(Xw,{p:1,children:L.calculatedSlug})]})]})}),S.jsx(sX,{children:S.jsx(Zn,{as:Uu,to:`/w/${L.calculatedSlug}`,colorScheme:"blue",width:"100%",children:"Enter Space"})})]},L.id))})]})})})]})}var BU={},Aw={},Pw={},wQ;function QWe(){if(wQ)return Pw;wQ=1,Object.defineProperty(Pw,"__esModule",{value:!0}),Pw.useUnityCanvasId=void 0;var n=zu(),e=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return d};return Pw.useUnityCanvasId=a,Pw}var bf={},Ow={},CQ;function cae(){if(CQ)return Ow;CQ=1,Object.defineProperty(Ow,"__esModule",{value:!0}),Ow.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(Ow.UnityLoaderStatus=n={})),Ow}var kw={},RQ;function w3(){return RQ||(RQ=1,Object.defineProperty(kw,"__esModule",{value:!0}),kw.isBrowserEnvironment=void 0,kw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),kw}var IQ;function ZWe(){if(IQ)return bf;IQ=1;var n=bf&&bf.__awaiter||function(f,_,E,b){function w(I){return I instanceof E?I:new E(function(k){k(I)})}return new(E||(E=Promise))(function(I,k){function V(B){try{F(b.next(B))}catch(q){k(q)}}function L(B){try{F(b.throw(B))}catch(q){k(q)}}function F(B){B.done?I(B.value):w(B.value).then(V,L)}F((b=b.apply(f,_||[])).next())})},e=bf&&bf.__generator||function(f,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,w,I,k=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return k.next=V(0),k.throw=V(1),k.return=V(2),typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function V(F){return function(B){return L([F,B])}}function L(F){if(b)throw new TypeError("Generator is already executing.");for(;k&&(k=0,F[0]&&(E=0)),E;)try{if(b=1,w&&(I=F[0]&2?w.return:F[0]?w.throw||((I=w.return)&&I.call(w),0):w.next)&&!(I=I.call(w,F[1])).done)return I;switch(w=0,I&&(F=[F[0]&2,I.value]),F[0]){case 0:case 1:I=F;break;case 4:return E.label++,{value:F[1],done:!1};case 5:E.label++,w=F[1],F=[0];continue;case 7:F=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(F[0]===6||F[0]===2)){E=0;continue}if(F[0]===3&&(!I||F[1]>I[0]&&F[1]<I[3])){E.label=F[1];break}if(F[0]===6&&E.label<I[1]){E.label=I[1],I=F;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(F);break}I[2]&&E.ops.pop(),E.trys.pop();continue}F=_.call(f,E)}catch(B){F=[6,B],w=0}finally{b=I=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(bf,"__esModule",{value:!0}),bf.useUnityInstance=void 0;var i=zu(),a=cae(),l=w3(),d=function(f,_,E,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,I;return e(this,function(k){switch(k.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||_===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];k.label=1;case 1:return k.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,b.setLoadingProgression)];case 2:return w=k.sent(),b.setUnityInstance(w),b.setInitialisationError(null),[3,4];case 3:return I=k.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,_,E,b])};return bf.useUnityInstance=d,bf}var Nw={},AQ;function eze(){if(AQ)return Nw;AQ=1,Object.defineProperty(Nw,"__esModule",{value:!0}),Nw.useUnityArguments=void 0;var n=zu(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Nw.useUnityArguments=e,Nw}var Dw={},PQ;function tze(){if(PQ)return Dw;PQ=1,Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.useUnityLoader=void 0;var n=zu(),e=w3(),i=cae(),a=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),f=d[0],_=d[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(w){return _(w.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",b),E.addEventListener("error",b),function(){E!==null&&(E.removeEventListener("load",b),E.removeEventListener("error",b),window.document.body.removeChild(E))}}},[l.loaderUrl]),f};return Dw.useUnityLoader=a,Dw}var OQ;function nze(){if(OQ)return Aw;OQ=1,Object.defineProperty(Aw,"__esModule",{value:!0}),Aw.Unity=void 0;var n=zu(),e=zu(),i=QWe(),a=ZWe(),l=eze(),d=tze(),f=(0,e.forwardRef)(function(_,E){var b=(0,e.useRef)(null),w=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),k=(0,d.useUnityLoader)(_.unityProvider.unityConfig);return(0,a.useUnityInstance)(k,b.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:w,style:_.style,className:_.className,tabIndex:_.tabIndex})});return Aw.Unity=f,Aw}var Tf={},xw={},kQ;function lae(){if(kQ)return xw;kQ=1,Object.defineProperty(xw,"__esModule",{value:!0}),xw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return xw.errorMessages=n,xw}var Sy={},NQ;function rze(){if(NQ)return Sy;NQ=1;var n=Sy&&Sy.__spreadArray||function(_,E,b){if(b||arguments.length===2)for(var w=0,I=E.length,k;w<I;w++)(k||!(w in E))&&(k||(k=Array.prototype.slice.call(E,0,w)),k[w]=E[w]);return _.concat(k||Array.prototype.slice.call(E))};Object.defineProperty(Sy,"__esModule",{value:!0}),Sy.useEventSystem=void 0;var e=zu(),i=lae(),a=w3(),l=[],d=function(_){for(var E=[],b=1;b<arguments.length;b++)E[b-1]=arguments[b];var w=void 0;return l.forEach(function(I){w=I.apply(void 0,n([_],E,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,k){_.current=n(n([],_.current,!0),[{eventName:I,callback:k}],!1)},[_]),b=(0,e.useCallback)(function(I,k){_.current=_.current.filter(function(V){return V.eventName!==I&&V.callback!==k})},[_]),w=(0,e.useCallback)(function(I){for(var k=[],V=1;V<arguments.length;V++)k[V-1]=arguments[V];var L=_.current.find(function(F){return F.eventName===I});if(typeof L>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return L.callback.apply(L,k)},[_]);return(0,e.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:E,removeEventListener:b}};return Sy.useEventSystem=f,Sy}var Lw={},DQ;function ize(){if(DQ)return Lw;DQ=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.useNullableState=void 0;var n=zu(),e=function(i){return(0,n.useState)(i||null)};return Lw.useNullableState=e,Lw}var xQ;function sze(){if(xQ)return Tf;xQ=1;var n=Tf&&Tf.__awaiter||function(_,E,b,w){function I(k){return k instanceof b?k:new b(function(V){V(k)})}return new(b||(b=Promise))(function(k,V){function L(q){try{B(w.next(q))}catch($){V($)}}function F(q){try{B(w.throw(q))}catch($){V($)}}function B(q){q.done?k(q.value):I(q.value).then(L,F)}B((w=w.apply(_,E||[])).next())})},e=Tf&&Tf.__generator||function(_,E){var b={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},w,I,k,V=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return V.next=L(0),V.throw=L(1),V.return=L(2),typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function L(B){return function(q){return F([B,q])}}function F(B){if(w)throw new TypeError("Generator is already executing.");for(;V&&(V=0,B[0]&&(b=0)),b;)try{if(w=1,I&&(k=B[0]&2?I.return:B[0]?I.throw||((k=I.return)&&k.call(I),0):I.next)&&!(k=k.call(I,B[1])).done)return k;switch(I=0,k&&(B=[B[0]&2,k.value]),B[0]){case 0:case 1:k=B;break;case 4:return b.label++,{value:B[1],done:!1};case 5:b.label++,I=B[1],B=[0];continue;case 7:B=b.ops.pop(),b.trys.pop();continue;default:if(k=b.trys,!(k=k.length>0&&k[k.length-1])&&(B[0]===6||B[0]===2)){b=0;continue}if(B[0]===3&&(!k||B[1]>k[0]&&B[1]<k[3])){b.label=B[1];break}if(B[0]===6&&b.label<k[1]){b.label=k[1],k=B;break}if(k&&b.label<k[2]){b.label=k[2],b.ops.push(B);break}k[2]&&b.ops.pop(),b.trys.pop();continue}B=E.call(_,b)}catch(q){B=[6,q],I=0}finally{w=k=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.useUnityContext=void 0;var i=zu(),a=lae(),l=rze(),d=ize(),f=function(_){var E=(0,d.useNullableState)(),b=E[0],w=E[1],I=(0,i.useState)(0),k=I[0],V=I[1],L=(0,i.useState)(!1),F=L[0],B=L[1],q=(0,d.useNullableState)(),$=q[0],Q=q[1],ae=(0,l.useEventSystem)(),re=(0,i.useRef)({setLoadingProgression:V,setInitialisationError:Q,setUnityInstance:w,setIsLoaded:B,unityConfig:_}),fe=(0,i.useCallback)(function(pe){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(pe===!0?1:0)},[b]),Z=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),ee=(0,i.useCallback)(function(pe,le,Me){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(pe,le,Me)},[b]),ne=(0,i.useCallback)(function(pe,le){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(pe,le)},[b]),oe=(0,i.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),ge=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var pe;return e(this,function(le){switch(le.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(pe=b.Module.canvas,document.body.appendChild(pe),pe.style.display="none",[4,oe()]);case 1:return le.sent(),pe.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){B(k===1)},[k]),{unityProvider:re.current,loadingProgression:k,initialisationError:$,isLoaded:F,UNSAFE__unityInstance:b,requestFullscreen:fe,requestPointerLock:Z,sendMessage:ee,takeScreenshot:ne,unload:oe,UNSAFE__detachAndUnloadImmediate:ge,addEventListener:ae.addEventListener,removeEventListener:ae.removeEventListener}};return Tf.useUnityContext=f,Tf}var LQ;function oze(){return LQ||(LQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=nze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=sze();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(BU)),BU}var uae=oze();const Vd="[UnityProvider]",Oj=D.createContext(),aze=({spaceID:n,children:e,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:_,showDisruptiveLogo:E})=>{Te.log(`${Vd} Initializing with spaceID:`,n),Te.log(`${Vd} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:V,removeEventListener:L,error:F}=uae.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d}),B={unityProvider:b,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:V,removeEventListener:L,error:F,spaceID:n},q=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const fe=()=>{document.hidden?(Te.log(`${Vd} Page hidden, starting keep-alive`),Q()):(Te.log(`${Vd} Page visible, stopping keep-alive`),ae())};return document.addEventListener("visibilitychange",fe),()=>{document.removeEventListener("visibilitychange",fe),ae()}},[]),D.useEffect(()=>{const fe=()=>{$.current=Date.now(),document.hidden&&k("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",fe),window.addEventListener("keydown",fe),window.addEventListener("touchstart",fe),()=>{window.removeEventListener("mousemove",fe),window.removeEventListener("keydown",fe),window.removeEventListener("touchstart",fe)}},[k]);const Q=()=>{q.current||(q.current=setInterval(()=>{I&&document.hidden&&(k("WebGLInputManager","KeepAlive"),Te.debug(`${Vd} Sent keep-alive message`))},1e4))},ae=()=>{q.current&&(clearInterval(q.current),q.current=null)};D.useEffect(()=>(Te.log(`${Vd} Component mounted`),()=>{Te.log(`${Vd} Component unmounting`),ae()}),[]),D.useEffect(()=>{Te.log(`${Vd} Loading progress:`,w)},[w]),D.useEffect(()=>{I&&(Te.log(`${Vd} Unity instance loaded for:`,n),document.hidden&&Q())},[I,n]),D.useEffect(()=>{F&&Te.error(`${Vd} Unity error:`,F)},[F]),Te.log(`${Vd} Rendering provider with instance:`,B),D.useEffect(()=>{Te.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d})},[i,a,l,d]);const re=[];if(i||re.push("loaderUrl"),a||re.push("dataUrl"),l||re.push("frameworkUrl"),d||re.push("codeUrl"),re.length>0)return Te.error(`UnityProvider: Missing required Unity build URLs: ${re.join(", ")}`),S.jsx(Oj.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${re.join(", ")}`),spaceID:n},children:e});try{return D.useEffect(()=>{Te.log("UnityProvider: Unity context created:",b),b?Te.log("UnityProvider: Unity provider is available"):Te.error("UnityProvider: Unity provider is not available"),I?Te.log("UnityProvider: Unity is loaded"):Te.log("UnityProvider: Unity is not loaded yet")},[b,I]),S.jsx(Oj.Provider,{value:B,children:e})}catch(fe){return Te.error("UnityProvider: Error creating Unity context:",fe),S.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[S.jsx("h3",{children:"Unity Error"}),S.jsxs("p",{children:["Error creating Unity context: ",fe.message]}),S.jsx("p",{children:"Please check the console for more details."})]})}},al=()=>D.useContext(Oj),Jg=()=>{const{sendMessage:n,isLoaded:e}=al(),i=D.useRef([]),a=D.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:d,data:f}=i.current.shift();Te.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(_){Te.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:d,data:f});break}}},[n,e]);return D.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),D.useCallback((d,f)=>{Te.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:f}),a()},[a])},em=()=>{const{addEventListener:n,removeEventListener:e}=al();return D.useCallback((i,a)=>{const l=d=>{Te.log(i+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(_){Te.warn("Failed to parse JSON data from Unity message:",_)}a(f)};return n(i,l),()=>{e(i,l)}},[n,e])},cze=()=>{const[n,e]=D.useState(!1),i=em();return D.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{Te.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},lze=n=>{const[e,i]=D.useState(null),a=em(),{spaceID:l}=al();return D.useEffect(()=>{let f=!0;const E=a("PlayVideo",async b=>{try{const{gameObjectName:w}=b;if(!w){Te.error("Game object name is missing in Unity event data.");return}const I=await tae(l);Te.log("SPACES VIDEOS",I);const k=I.find(V=>V.id===w);k&&f?(i(k.url),Te.log("Video URL set to:",k.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,E()}},[a,l,n]),[e,()=>{i(null)}]},uze=()=>{const n=em(),{sendUserToUnity:e}=D.useContext(ul);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{Te.log("React: Request from Unity to send user data"),e()});return()=>{a()}},[n,e]),!0},dze=()=>{const{spaceID:n}=al(),e=Jg(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Te.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Te.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){Te.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}Te.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await tae(n),f=async b=>{const w=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const k=await I.json(),V=k.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let F=null;for(let B of L){const q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(q,{method:"HEAD"})).ok){F=q;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${q}`,$)}}return F||k.thumbnail_url},_=d.map(async b=>{const w=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:w}}),E=await Promise.all(_);Te.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:b,thumbnailUrl:w})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:w})})}catch(d){Te.error("Error fetching thumbnails:",d)}})()},[e,n,i])},hze=()=>{const[n,e]=D.useState(null),i=em();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof f=="string"?JSON.parse(f):f;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},dae=()=>{const[n,e]=D.useState([]),i=em();return D.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(Te.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=V=>{if(a){Te.log("UpdatePlayerList unity message received.");try{let L=[];if(typeof V=="object"&&V!==null?L=V.players||[]:L=JSON.parse(V).players||[],Array.isArray(L)){const F=Array.from(new Map(L.map(B=>[B.playerId,B])).values());e(F),l&&(clearTimeout(l),l=null)}}catch(L){Te.error("Error handling player list data:",L),l||(l=setTimeout(d,1e3))}}},_=()=>{Te.log("Player disconnected, requesting fresh player list"),d()},E=()=>{Te.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",f),w=i("PlayerDisconnected",_),I=i("PlayerLeft",E),k=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof w=="function"&&w(),typeof I=="function"&&I(),clearInterval(k)}},[i]),n},MQ=async(n,e,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=dE(),b=Date.now(),w=i.name.split(".").pop(),I=`${e}_${b}.${w}`,k=uE(E,`spaces/${n}/mediaScreens/${I}`);Te.log(`Uploading image for media screen ${e} in space ${n}`);const V=await S3(k,i);_=await MN(V.ref);const L=qi(ii,`spaces/${n}/mediaScreens`,e);await Ik(L,{imageUrl:_,gsUrl:`gs://${V.ref.bucket}/${V.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){_=f;const E=qi(ii,`spaces/${n}/mediaScreens`,e);await Ik(E,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return Te.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${d})`),_}catch(l){throw Te.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},C3=async n=>{Te.log(`Getting media screen images for space: ${n}`);try{const e=Yf(ii,`spaces/${n}/mediaScreens`),i=await zg(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(e){throw Te.error("Error fetching media screen images from Firestore:",e),e}},Df=async(n,e)=>{try{const i=qi(ii,`spaces/${n}/mediaScreens`,e),a=await hc(i);return a.exists()?{id:a.id,...a.data()}:(Te.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw Te.error("Error fetching media screen image:",i),i}},pze=async(n,e)=>{try{const i=await Df(n,e);if(!i)return Te.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=dE(),d=uE(l,i.gsUrl);try{await b3(d),Te.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){Te.warn(`Could not delete file from storage: ${f.message}`)}}const a=qi(ii,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await Ku(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Te.log(`Successfully removed video for media screen ${e}`)):(await Ku(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Te.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw Te.error("Error deleting media screen image:",i),i}},fze=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await Df(n,e);if(!a||!a.imageUrl&&!a.videoUrl)return Te.warn(`No media screen content found with ID: ${e} to update`),!1;const l=qi(ii,`spaces/${n}/mediaScreens`,e);return await Ku(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),Te.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(a){throw Te.error("Error updating media screen display mode:",a),a}},mze=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},hae=()=>{const{spaceID:n}=al(),e=Jg(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Te.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{Te.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){Te.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}Te.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await C3(n);Te.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:_,imageUrl:E,displayAsVideo:b,videoUrl:w}=f;let I=null;(!b||!w)&&(I=E?mze(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:w||null,displayAsVideo:b||!1,timestamp:Date.now()}),Te.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${b})`),b&&w&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),Te.log(`Set display mode to video for screen ${_}`))})}catch(d){Te.error("Error fetching media screen images:",d)}})()},[e,n,i])},gze=n=>({opacity:1});var FR=n=>n.type==="checkbox",ky=n=>n instanceof Date,uc=n=>n==null;const pae=n=>typeof n=="object";var js=n=>!uc(n)&&!Array.isArray(n)&&pae(n)&&!ky(n),_ze=n=>js(n)&&n.target?FR(n.target)?n.target.checked:n.target.value:n,yze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,Eze=(n,e)=>n.has(yze(e)),vze=n=>{const e=n.constructor&&n.constructor.prototype;return js(e)&&e.hasOwnProperty("isPrototypeOf")},R3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Nu(n){let e;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(R3&&(n instanceof Blob||a))&&(i||js(n)))if(e=i?[]:{},!i&&!vze(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Nu(n[l]));else return n;return e}var UN=n=>Array.isArray(n)?n.filter(Boolean):[],Ks=n=>n===void 0,cn=(n,e,i)=>{if(!e||!js(n))return i;const a=UN(e.split(/[,[\].]+?/)).reduce((l,d)=>uc(l)?l:l[d],n);return Ks(a)||a===n?Ks(n[e])?i:n[e]:a},Jh=n=>typeof n=="boolean",I3=n=>/^\w*$/.test(n),fae=n=>UN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Hi=(n,e,i)=>{let a=-1;const l=I3(e)?[e]:fae(e),d=l.length,f=d-1;for(;++a<d;){const _=l[a];let E=i;if(a!==f){const b=n[_];E=js(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const UQ={BLUR:"blur",FOCUS_OUT:"focusout"},Bd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},wf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};_r.createContext(null);var Sze=(n,e,i,a=!0)=>{const l={defaultValues:e._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return e._proxyFormState[f]!==Bd.all&&(e._proxyFormState[f]=!a||Bd.all),n[f]}});return l},Jc=n=>js(n)&&!Object.keys(n).length,bze=(n,e,i,a)=>{i(n);const{name:l,...d}=n;return Jc(d)||Object.keys(d).length>=Object.keys(e).length||Object.keys(d).find(f=>e[f]===Bd.all)},BO=n=>Array.isArray(n)?n:[n];function Tze(n){const e=_r.useRef(n);e.current=n,_r.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var ip=n=>typeof n=="string",wze=(n,e,i,a,l)=>ip(n)?(a&&e.watch.add(n),cn(i,n,l)):Array.isArray(n)?n.map(d=>(a&&e.watch.add(d),cn(i,d))):(a&&(e.watchAll=!0),i),Cze=(n,e,i,a,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},VQ=n=>({isOnSubmit:!n||n===Bd.onSubmit,isOnBlur:n===Bd.onBlur,isOnChange:n===Bd.onChange,isOnAll:n===Bd.all,isOnTouch:n===Bd.onTouched}),jQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const wC=(n,e,i,a)=>{for(const l of i||Object.keys(n)){const d=cn(n,l);if(d){const{_f:f,..._}=d;if(f){if(f.refs&&f.refs[0]&&e(f.refs[0],l)&&!a)return!0;if(f.ref&&e(f.ref,f.name)&&!a)return!0;if(wC(_,e))break}else if(js(_)&&wC(_,e))break}}};var Rze=(n,e,i)=>{const a=BO(cn(n,i));return Hi(a,"root",e[i]),Hi(n,i,a),n},A3=n=>n.type==="file",np=n=>typeof n=="function",Ak=n=>{if(!R3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},WO=n=>ip(n),P3=n=>n.type==="radio",Pk=n=>n instanceof RegExp;const FQ={value:!1,isValid:!1},BQ={value:!0,isValid:!0};var mae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Ks(n[0].attributes.value)?Ks(n[0].value)||n[0].value===""?BQ:{value:n[0].value,isValid:!0}:BQ:FQ}return FQ};const WQ={isValid:!1,value:null};var gae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,WQ):WQ;function zQ(n,e,i="validate"){if(WO(n)||Array.isArray(n)&&n.every(WO)||Jh(n)&&!n)return{type:i,message:WO(n)?n:"",ref:e}}var MS=n=>js(n)&&!Pk(n)?n:{value:n,message:""},GQ=async(n,e,i,a,l,d)=>{const{ref:f,refs:_,required:E,maxLength:b,minLength:w,min:I,max:k,pattern:V,validate:L,name:F,valueAsNumber:B,mount:q}=n._f,$=cn(i,F);if(!q||e.has(F))return{};const Q=_?_[0]:f,ae=pe=>{l&&Q.reportValidity&&(Q.setCustomValidity(Jh(pe)?"":pe||""),Q.reportValidity())},re={},fe=P3(f),Z=FR(f),ee=fe||Z,ne=(B||A3(f))&&Ks(f.value)&&Ks($)||Ak(f)&&f.value===""||$===""||Array.isArray($)&&!$.length,oe=Cze.bind(null,F,a,re),ge=(pe,le,Me,He=wf.maxLength,tt=wf.minLength)=>{const Ee=pe?le:Me;re[F]={type:pe?He:tt,message:Ee,ref:f,...oe(pe?He:tt,Ee)}};if(d?!Array.isArray($)||!$.length:E&&(!ee&&(ne||uc($))||Jh($)&&!$||Z&&!mae(_).isValid||fe&&!gae(_).isValid)){const{value:pe,message:le}=WO(E)?{value:!!E,message:E}:MS(E);if(pe&&(re[F]={type:wf.required,message:le,ref:Q,...oe(wf.required,le)},!a))return ae(le),re}if(!ne&&(!uc(I)||!uc(k))){let pe,le;const Me=MS(k),He=MS(I);if(!uc($)&&!isNaN($)){const tt=f.valueAsNumber||$&&+$;uc(Me.value)||(pe=tt>Me.value),uc(He.value)||(le=tt<He.value)}else{const tt=f.valueAsDate||new Date($),Ee=Be=>new Date(new Date().toDateString()+" "+Be),Ie=f.type=="time",ve=f.type=="week";ip(Me.value)&&$&&(pe=Ie?Ee($)>Ee(Me.value):ve?$>Me.value:tt>new Date(Me.value)),ip(He.value)&&$&&(le=Ie?Ee($)<Ee(He.value):ve?$<He.value:tt<new Date(He.value))}if((pe||le)&&(ge(!!pe,Me.message,He.message,wf.max,wf.min),!a))return ae(re[F].message),re}if((b||w)&&!ne&&(ip($)||d&&Array.isArray($))){const pe=MS(b),le=MS(w),Me=!uc(pe.value)&&$.length>+pe.value,He=!uc(le.value)&&$.length<+le.value;if((Me||He)&&(ge(Me,pe.message,le.message),!a))return ae(re[F].message),re}if(V&&!ne&&ip($)){const{value:pe,message:le}=MS(V);if(Pk(pe)&&!$.match(pe)&&(re[F]={type:wf.pattern,message:le,ref:f,...oe(wf.pattern,le)},!a))return ae(le),re}if(L){if(np(L)){const pe=await L($,i),le=zQ(pe,Q);if(le&&(re[F]={...le,...oe(wf.validate,le.message)},!a))return ae(le.message),re}else if(js(L)){let pe={};for(const le in L){if(!Jc(pe)&&!a)break;const Me=zQ(await L[le]($,i),Q,le);Me&&(pe={...Me,...oe(le,Me.message)},ae(Me.message),a&&(re[F]=pe))}if(!Jc(pe)&&(re[F]={ref:Q,...pe},!a))return re}}return ae(!0),re};function Ize(n,e){const i=e.slice(0,-1).length;let a=0;for(;a<i;)n=Ks(n)?a++:n[e[a++]];return n}function Aze(n){for(const e in n)if(n.hasOwnProperty(e)&&!Ks(n[e]))return!1;return!0}function lo(n,e){const i=Array.isArray(e)?e:I3(e)?[e]:fae(e),a=i.length===1?n:Ize(n,i),l=i.length-1,d=i[l];return a&&delete a[d],l!==0&&(js(a)&&Jc(a)||Array.isArray(a)&&Aze(a))&&lo(n,i.slice(0,-1)),n}var WU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},kj=n=>uc(n)||!pae(n);function vg(n,e){if(kj(n)||kj(e))return n===e;if(ky(n)&&ky(e))return n.getTime()===e.getTime();const i=Object.keys(n),a=Object.keys(e);if(i.length!==a.length)return!1;for(const l of i){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=e[l];if(ky(d)&&ky(f)||js(d)&&js(f)||Array.isArray(d)&&Array.isArray(f)?!vg(d,f):d!==f)return!1}}return!0}var _ae=n=>n.type==="select-multiple",Pze=n=>P3(n)||FR(n),zU=n=>Ak(n)&&n.isConnected,yae=n=>{for(const e in n)if(np(n[e]))return!0;return!1};function Ok(n,e={}){const i=Array.isArray(n);if(js(n)||i)for(const a in n)Array.isArray(n[a])||js(n[a])&&!yae(n[a])?(e[a]=Array.isArray(n[a])?[]:{},Ok(n[a],e[a])):uc(n[a])||(e[a]=!0);return e}function Eae(n,e,i){const a=Array.isArray(n);if(js(n)||a)for(const l in n)Array.isArray(n[l])||js(n[l])&&!yae(n[l])?Ks(e)||kj(i[l])?i[l]=Array.isArray(n[l])?Ok(n[l],[]):{...Ok(n[l])}:Eae(n[l],uc(e)?{}:e[l],i[l]):i[l]=!vg(n[l],e[l]);return i}var Mw=(n,e)=>Eae(n,e,Ok(e)),vae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:a})=>Ks(n)?n:e?n===""?NaN:n&&+n:i&&ip(n)?new Date(n):a?a(n):n;function GU(n){const e=n.ref;return A3(e)?e.files:P3(e)?gae(n.refs).value:_ae(e)?[...e.selectedOptions].map(({value:i})=>i):FR(e)?mae(n.refs).value:vae(Ks(e.value)?n.ref.value:e.value,n)}var Oze=(n,e,i,a)=>{const l={};for(const d of n){const f=cn(e,d);f&&Hi(l,d,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},Uw=n=>Ks(n)?n:Pk(n)?n.source:js(n)?Pk(n.value)?n.value.source:n.value:n;const HQ="AsyncFunction";var kze=n=>!!n&&!!n.validate&&!!(np(n.validate)&&n.validate.constructor.name===HQ||js(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===HQ)),Nze=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function $Q(n,e,i){const a=cn(n,i);if(a||I3(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),f=cn(e,d),_=cn(n,d);if(f&&!Array.isArray(f)&&i!==d)return{name:i};if(_&&_.type)return{name:d,error:_};l.pop()}return{name:i}}var Dze=(n,e,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,xze=(n,e)=>!UN(cn(n,e)).length&&lo(n,e);const Lze={mode:Bd.onSubmit,reValidateMode:Bd.onChange,shouldFocusError:!0};function Mze(n={}){let e={...Lze,...n},i={submitCount:0,isDirty:!1,isLoading:np(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},a={},l=js(e.defaultValues)||js(e.values)?Nu(e.defaultValues||e.values)||{}:{},d=e.shouldUnregister?{}:Nu(l),f={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,b=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:WU(),array:WU(),state:WU()},k=VQ(e.mode),V=VQ(e.reValidateMode),L=e.criteriaMode===Bd.all,F=Ce=>Ve=>{clearTimeout(b),b=setTimeout(Ce,Ve)},B=async Ce=>{if(!e.disabled&&(w.isValid||Ce)){const Ve=e.resolver?Jc((await ee()).errors):await oe(a,!0);Ve!==i.isValid&&I.state.next({isValid:Ve})}},q=(Ce,Ve)=>{!e.disabled&&(w.isValidating||w.validatingFields)&&((Ce||Array.from(_.mount)).forEach(Ye=>{Ye&&(Ve?Hi(i.validatingFields,Ye,Ve):lo(i.validatingFields,Ye))}),I.state.next({validatingFields:i.validatingFields,isValidating:!Jc(i.validatingFields)}))},$=(Ce,Ve=[],Ye,_t,vt=!0,St=!0)=>{if(_t&&Ye&&!e.disabled){if(f.action=!0,St&&Array.isArray(cn(a,Ce))){const Ht=Ye(cn(a,Ce),_t.argA,_t.argB);vt&&Hi(a,Ce,Ht)}if(St&&Array.isArray(cn(i.errors,Ce))){const Ht=Ye(cn(i.errors,Ce),_t.argA,_t.argB);vt&&Hi(i.errors,Ce,Ht),xze(i.errors,Ce)}if(w.touchedFields&&St&&Array.isArray(cn(i.touchedFields,Ce))){const Ht=Ye(cn(i.touchedFields,Ce),_t.argA,_t.argB);vt&&Hi(i.touchedFields,Ce,Ht)}w.dirtyFields&&(i.dirtyFields=Mw(l,d)),I.state.next({name:Ce,isDirty:pe(Ce,Ve),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else Hi(d,Ce,Ve)},Q=(Ce,Ve)=>{Hi(i.errors,Ce,Ve),I.state.next({errors:i.errors})},ae=Ce=>{i.errors=Ce,I.state.next({errors:i.errors,isValid:!1})},re=(Ce,Ve,Ye,_t)=>{const vt=cn(a,Ce);if(vt){const St=cn(d,Ce,Ks(Ye)?cn(l,Ce):Ye);Ks(St)||_t&&_t.defaultChecked||Ve?Hi(d,Ce,Ve?St:GU(vt._f)):He(Ce,St),f.mount&&B()}},fe=(Ce,Ve,Ye,_t,vt)=>{let St=!1,Ht=!1;const fn={name:Ce};if(!e.disabled){const mn=!!(cn(a,Ce)&&cn(a,Ce)._f&&cn(a,Ce)._f.disabled);if(!Ye||_t){w.isDirty&&(Ht=i.isDirty,i.isDirty=fn.isDirty=pe(),St=Ht!==fn.isDirty);const Jt=mn||vg(cn(l,Ce),Ve);Ht=!!(!mn&&cn(i.dirtyFields,Ce)),Jt||mn?lo(i.dirtyFields,Ce):Hi(i.dirtyFields,Ce,!0),fn.dirtyFields=i.dirtyFields,St=St||w.dirtyFields&&Ht!==!Jt}if(Ye){const Jt=cn(i.touchedFields,Ce);Jt||(Hi(i.touchedFields,Ce,Ye),fn.touchedFields=i.touchedFields,St=St||w.touchedFields&&Jt!==Ye)}St&&vt&&I.state.next(fn)}return St?fn:{}},Z=(Ce,Ve,Ye,_t)=>{const vt=cn(i.errors,Ce),St=w.isValid&&Jh(Ve)&&i.isValid!==Ve;if(e.delayError&&Ye?(E=F(()=>Q(Ce,Ye)),E(e.delayError)):(clearTimeout(b),E=null,Ye?Hi(i.errors,Ce,Ye):lo(i.errors,Ce)),(Ye?!vg(vt,Ye):vt)||!Jc(_t)||St){const Ht={..._t,...St&&Jh(Ve)?{isValid:Ve}:{},errors:i.errors,name:Ce};i={...i,...Ht},I.state.next(Ht)}},ee=async Ce=>{q(Ce,!0);const Ve=await e.resolver(d,e.context,Oze(Ce||_.mount,a,e.criteriaMode,e.shouldUseNativeValidation));return q(Ce),Ve},ne=async Ce=>{const{errors:Ve}=await ee(Ce);if(Ce)for(const Ye of Ce){const _t=cn(Ve,Ye);_t?Hi(i.errors,Ye,_t):lo(i.errors,Ye)}else i.errors=Ve;return Ve},oe=async(Ce,Ve,Ye={valid:!0})=>{for(const _t in Ce){const vt=Ce[_t];if(vt){const{_f:St,...Ht}=vt;if(St){const fn=_.array.has(St.name),mn=vt._f&&kze(vt._f);mn&&w.validatingFields&&q([_t],!0);const Jt=await GQ(vt,_.disabled,d,L,e.shouldUseNativeValidation&&!Ve,fn);if(mn&&w.validatingFields&&q([_t]),Jt[St.name]&&(Ye.valid=!1,Ve))break;!Ve&&(cn(Jt,St.name)?fn?Rze(i.errors,Jt,St.name):Hi(i.errors,St.name,Jt[St.name]):lo(i.errors,St.name))}!Jc(Ht)&&await oe(Ht,Ve,Ye)}}return Ye.valid},ge=()=>{for(const Ce of _.unMount){const Ve=cn(a,Ce);Ve&&(Ve._f.refs?Ve._f.refs.every(Ye=>!zU(Ye)):!zU(Ve._f.ref))&&Fe(Ce)}_.unMount=new Set},pe=(Ce,Ve)=>!e.disabled&&(Ce&&Ve&&Hi(d,Ce,Ve),!vg(ke(),l)),le=(Ce,Ve,Ye)=>wze(Ce,_,{...f.mount?d:Ks(Ve)?l:ip(Ce)?{[Ce]:Ve}:Ve},Ye,Ve),Me=Ce=>UN(cn(f.mount?d:l,Ce,e.shouldUnregister?cn(l,Ce,[]):[])),He=(Ce,Ve,Ye={})=>{const _t=cn(a,Ce);let vt=Ve;if(_t){const St=_t._f;St&&(!St.disabled&&Hi(d,Ce,vae(Ve,St)),vt=Ak(St.ref)&&uc(Ve)?"":Ve,_ae(St.ref)?[...St.ref.options].forEach(Ht=>Ht.selected=vt.includes(Ht.value)):St.refs?FR(St.ref)?St.refs.length>1?St.refs.forEach(Ht=>(!Ht.defaultChecked||!Ht.disabled)&&(Ht.checked=Array.isArray(vt)?!!vt.find(fn=>fn===Ht.value):vt===Ht.value)):St.refs[0]&&(St.refs[0].checked=!!vt):St.refs.forEach(Ht=>Ht.checked=Ht.value===vt):A3(St.ref)?St.ref.value="":(St.ref.value=vt,St.ref.type||I.values.next({name:Ce,values:{...d}})))}(Ye.shouldDirty||Ye.shouldTouch)&&fe(Ce,vt,Ye.shouldTouch,Ye.shouldDirty,!0),Ye.shouldValidate&&Be(Ce)},tt=(Ce,Ve,Ye)=>{for(const _t in Ve){const vt=Ve[_t],St=`${Ce}.${_t}`,Ht=cn(a,St);(_.array.has(Ce)||js(vt)||Ht&&!Ht._f)&&!ky(vt)?tt(St,vt,Ye):He(St,vt,Ye)}},Ee=(Ce,Ve,Ye={})=>{const _t=cn(a,Ce),vt=_.array.has(Ce),St=Nu(Ve);Hi(d,Ce,St),vt?(I.array.next({name:Ce,values:{...d}}),(w.isDirty||w.dirtyFields)&&Ye.shouldDirty&&I.state.next({name:Ce,dirtyFields:Mw(l,d),isDirty:pe(Ce,St)})):_t&&!_t._f&&!uc(St)?tt(Ce,St,Ye):He(Ce,St,Ye),jQ(Ce,_)&&I.state.next({...i}),I.values.next({name:f.mount?Ce:void 0,values:{...d}})},Ie=async Ce=>{f.mount=!0;const Ve=Ce.target;let Ye=Ve.name,_t=!0;const vt=cn(a,Ye),St=()=>Ve.type?GU(vt._f):_ze(Ce),Ht=fn=>{_t=Number.isNaN(fn)||ky(fn)&&isNaN(fn.getTime())||vg(fn,cn(d,Ye,fn))};if(vt){let fn,mn;const Jt=St(),Hn=Ce.type===UQ.BLUR||Ce.type===UQ.FOCUS_OUT,mc=!Nze(vt._f)&&!e.resolver&&!cn(i.errors,Ye)&&!vt._f.deps||Dze(Hn,cn(i.touchedFields,Ye),i.isSubmitted,V,k),Bt=jQ(Ye,_,Hn);Hi(d,Ye,Jt),Hn?(vt._f.onBlur&&vt._f.onBlur(Ce),E&&E(0)):vt._f.onChange&&vt._f.onChange(Ce);const un=fe(Ye,Jt,Hn,!1),rs=!Jc(un)||Bt;if(!Hn&&I.values.next({name:Ye,type:Ce.type,values:{...d}}),mc)return w.isValid&&(e.mode==="onBlur"&&Hn?B():Hn||B()),rs&&I.state.next({name:Ye,...Bt?{}:un});if(!Hn&&Bt&&I.state.next({...i}),e.resolver){const{errors:Fs}=await ee([Ye]);if(Ht(Jt),_t){const Qs=$Q(i.errors,a,Ye),Ei=$Q(Fs,a,Qs.name||Ye);fn=Ei.error,Ye=Ei.name,mn=Jc(Fs)}}else q([Ye],!0),fn=(await GQ(vt,_.disabled,d,L,e.shouldUseNativeValidation))[Ye],q([Ye]),Ht(Jt),_t&&(fn?mn=!1:w.isValid&&(mn=await oe(a,!0)));_t&&(vt._f.deps&&Be(vt._f.deps),Z(Ye,mn,fn,un))}},ve=(Ce,Ve)=>{if(cn(i.errors,Ve)&&Ce.focus)return Ce.focus(),1},Be=async(Ce,Ve={})=>{let Ye,_t;const vt=BO(Ce);if(e.resolver){const St=await ne(Ks(Ce)?Ce:vt);Ye=Jc(St),_t=Ce?!vt.some(Ht=>cn(St,Ht)):Ye}else Ce?(_t=(await Promise.all(vt.map(async St=>{const Ht=cn(a,St);return await oe(Ht&&Ht._f?{[St]:Ht}:Ht)}))).every(Boolean),!(!_t&&!i.isValid)&&B()):_t=Ye=await oe(a);return I.state.next({...!ip(Ce)||w.isValid&&Ye!==i.isValid?{}:{name:Ce},...e.resolver||!Ce?{isValid:Ye}:{},errors:i.errors}),Ve.shouldFocus&&!_t&&wC(a,ve,Ce?vt:_.mount),_t},ke=Ce=>{const Ve={...f.mount?d:l};return Ks(Ce)?Ve:ip(Ce)?cn(Ve,Ce):Ce.map(Ye=>cn(Ve,Ye))},Re=(Ce,Ve)=>({invalid:!!cn((Ve||i).errors,Ce),isDirty:!!cn((Ve||i).dirtyFields,Ce),error:cn((Ve||i).errors,Ce),isValidating:!!cn(i.validatingFields,Ce),isTouched:!!cn((Ve||i).touchedFields,Ce)}),he=Ce=>{Ce&&BO(Ce).forEach(Ve=>lo(i.errors,Ve)),I.state.next({errors:Ce?i.errors:{}})},we=(Ce,Ve,Ye)=>{const _t=(cn(a,Ce,{_f:{}})._f||{}).ref,vt=cn(i.errors,Ce)||{},{ref:St,message:Ht,type:fn,...mn}=vt;Hi(i.errors,Ce,{...mn,...Ve,ref:_t}),I.state.next({name:Ce,errors:i.errors,isValid:!1}),Ye&&Ye.shouldFocus&&_t&&_t.focus&&_t.focus()},Ue=(Ce,Ve)=>np(Ce)?I.values.subscribe({next:Ye=>Ce(le(void 0,Ve),Ye)}):le(Ce,Ve,!0),Fe=(Ce,Ve={})=>{for(const Ye of Ce?BO(Ce):_.mount)_.mount.delete(Ye),_.array.delete(Ye),Ve.keepValue||(lo(a,Ye),lo(d,Ye)),!Ve.keepError&&lo(i.errors,Ye),!Ve.keepDirty&&lo(i.dirtyFields,Ye),!Ve.keepTouched&&lo(i.touchedFields,Ye),!Ve.keepIsValidating&&lo(i.validatingFields,Ye),!e.shouldUnregister&&!Ve.keepDefaultValue&&lo(l,Ye);I.values.next({values:{...d}}),I.state.next({...i,...Ve.keepDirty?{isDirty:pe()}:{}}),!Ve.keepIsValid&&B()},$e=({disabled:Ce,name:Ve,field:Ye,fields:_t})=>{(Jh(Ce)&&f.mount||Ce||_.disabled.has(Ve))&&(Ce?_.disabled.add(Ve):_.disabled.delete(Ve),fe(Ve,GU(Ye?Ye._f:cn(_t,Ve)._f),!1,!1,!0))},ct=(Ce,Ve={})=>{let Ye=cn(a,Ce);const _t=Jh(Ve.disabled)||Jh(e.disabled);return Hi(a,Ce,{...Ye||{},_f:{...Ye&&Ye._f?Ye._f:{ref:{name:Ce}},name:Ce,mount:!0,...Ve}}),_.mount.add(Ce),Ye?$e({field:Ye,disabled:Jh(Ve.disabled)?Ve.disabled:e.disabled,name:Ce}):re(Ce,!0,Ve.value),{..._t?{disabled:Ve.disabled||e.disabled}:{},...e.progressive?{required:!!Ve.required,min:Uw(Ve.min),max:Uw(Ve.max),minLength:Uw(Ve.minLength),maxLength:Uw(Ve.maxLength),pattern:Uw(Ve.pattern)}:{},name:Ce,onChange:Ie,onBlur:Ie,ref:vt=>{if(vt){ct(Ce,Ve),Ye=cn(a,Ce);const St=Ks(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Ht=Pze(St),fn=Ye._f.refs||[];if(Ht?fn.find(mn=>mn===St):St===Ye._f.ref)return;Hi(a,Ce,{_f:{...Ye._f,...Ht?{refs:[...fn.filter(zU),St,...Array.isArray(cn(l,Ce))?[{}]:[]],ref:{type:St.type,name:Ce}}:{ref:St}}}),re(Ce,!1,void 0,St)}else Ye=cn(a,Ce,{}),Ye._f&&(Ye._f.mount=!1),(e.shouldUnregister||Ve.shouldUnregister)&&!(Eze(_.array,Ce)&&f.action)&&_.unMount.add(Ce)}}},it=()=>e.shouldFocusError&&wC(a,ve,_.mount),Ct=Ce=>{Jh(Ce)&&(I.state.next({disabled:Ce}),wC(a,(Ve,Ye)=>{const _t=cn(a,Ye);_t&&(Ve.disabled=_t._f.disabled||Ce,Array.isArray(_t._f.refs)&&_t._f.refs.forEach(vt=>{vt.disabled=_t._f.disabled||Ce}))},0,!1))},Vt=(Ce,Ve)=>async Ye=>{let _t;Ye&&(Ye.preventDefault&&Ye.preventDefault(),Ye.persist&&Ye.persist());let vt=Nu(d);if(_.disabled.size)for(const St of _.disabled)Hi(vt,St,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:St,values:Ht}=await ee();i.errors=St,vt=Ht}else await oe(a);if(lo(i.errors,"root"),Jc(i.errors)){I.state.next({errors:{}});try{await Ce(vt,Ye)}catch(St){_t=St}}else Ve&&await Ve({...i.errors},Ye),it(),setTimeout(it);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Jc(i.errors)&&!_t,submitCount:i.submitCount+1,errors:i.errors}),_t)throw _t},Dt=(Ce,Ve={})=>{cn(a,Ce)&&(Ks(Ve.defaultValue)?Ee(Ce,Nu(cn(l,Ce))):(Ee(Ce,Ve.defaultValue),Hi(l,Ce,Nu(Ve.defaultValue))),Ve.keepTouched||lo(i.touchedFields,Ce),Ve.keepDirty||(lo(i.dirtyFields,Ce),i.isDirty=Ve.defaultValue?pe(Ce,Nu(cn(l,Ce))):pe()),Ve.keepError||(lo(i.errors,Ce),w.isValid&&B()),I.state.next({...i}))},an=(Ce,Ve={})=>{const Ye=Ce?Nu(Ce):l,_t=Nu(Ye),vt=Jc(Ce),St=vt?l:_t;if(Ve.keepDefaultValues||(l=Ye),!Ve.keepValues){if(Ve.keepDirtyValues){const Ht=new Set([..._.mount,...Object.keys(Mw(l,d))]);for(const fn of Array.from(Ht))cn(i.dirtyFields,fn)?Hi(St,fn,cn(d,fn)):Ee(fn,cn(St,fn))}else{if(R3&&Ks(Ce))for(const Ht of _.mount){const fn=cn(a,Ht);if(fn&&fn._f){const mn=Array.isArray(fn._f.refs)?fn._f.refs[0]:fn._f.ref;if(Ak(mn)){const Jt=mn.closest("form");if(Jt){Jt.reset();break}}}}a={}}d=e.shouldUnregister?Ve.keepDefaultValues?Nu(l):{}:Nu(St),I.array.next({values:{...St}}),I.values.next({values:{...St}})}_={mount:Ve.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Ve.keepIsValid||!!Ve.keepDirtyValues,f.watch=!!e.shouldUnregister,I.state.next({submitCount:Ve.keepSubmitCount?i.submitCount:0,isDirty:vt?!1:Ve.keepDirty?i.isDirty:!!(Ve.keepDefaultValues&&!vg(Ce,l)),isSubmitted:Ve.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:vt?{}:Ve.keepDirtyValues?Ve.keepDefaultValues&&d?Mw(l,d):i.dirtyFields:Ve.keepDefaultValues&&Ce?Mw(l,Ce):Ve.keepDirty?i.dirtyFields:{},touchedFields:Ve.keepTouched?i.touchedFields:{},errors:Ve.keepErrors?i.errors:{},isSubmitSuccessful:Ve.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},jn=(Ce,Ve)=>an(np(Ce)?Ce(d):Ce,Ve);return{control:{register:ct,unregister:Fe,getFieldState:Re,handleSubmit:Vt,setError:we,_executeSchema:ee,_getWatch:le,_getDirty:pe,_updateValid:B,_removeUnmounted:ge,_updateFieldArray:$,_updateDisabledField:$e,_getFieldArray:Me,_reset:an,_resetDefaultValues:()=>np(e.defaultValues)&&e.defaultValues().then(Ce=>{jn(Ce,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Ce=>{i={...i,...Ce}},_disableForm:Ct,_subjects:I,_proxyFormState:w,_setErrors:ae,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Ce){f=Ce},get _defaultValues(){return l},get _names(){return _},set _names(Ce){_=Ce},get _formState(){return i},set _formState(Ce){i=Ce},get _options(){return e},set _options(Ce){e={...e,...Ce}}},trigger:Be,register:ct,handleSubmit:Vt,watch:Ue,setValue:Ee,getValues:ke,reset:jn,resetField:Dt,clearErrors:he,unregister:Fe,setError:we,setFocus:(Ce,Ve={})=>{const Ye=cn(a,Ce),_t=Ye&&Ye._f;if(_t){const vt=_t.refs?_t.refs[0]:_t.ref;vt.focus&&(vt.focus(),Ve.shouldSelect&&np(vt.select)&&vt.select())}},getFieldState:Re}}function Sae(n={}){const e=_r.useRef(void 0),i=_r.useRef(void 0),[a,l]=_r.useState({isDirty:!1,isValidating:!1,isLoading:np(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:np(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...Mze(n),formState:a});const d=e.current.control;return d._options=n,Tze({subject:d._subjects.state,next:f=>{bze(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),_r.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),_r.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),_r.useEffect(()=>{n.values&&!vg(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),_r.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),_r.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),_r.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),e.current.formState=Sze(a,d),e.current}const VN=(n,e="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Te.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){Te.error(`Failed to disable Unity input for ${e}:`,l)}},a=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),Te.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):Te.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){Te.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,e])};function jN({mode:n,label:e,buttonProps:i={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:_}}=Sae(),{register:E}=D.useContext(ul),b=ll(),{fullscreenRef:w}=Jd(),[I,k]=D.useState(!1),[V,L]=D.useState(!1),F=a!==void 0?a:I,B=l||(()=>k(!1));VN(F);const q=async ae=>{const{email:re,password:fe,confirmPassword:Z,...ee}=ae;if(fe!==Z){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}L(!0);try{const ne=await E(re,fe,ee);Te.log("User: Registration process complete."),B(),b({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(ne){Te.error("User: Registration Error:",ne),b({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{L(!1)}},$=()=>{l?l():k(!I)},Q=n==="link"?S.jsx(ho,{variant:"header",onClick:$,children:e}):S.jsx(Zn,{onClick:$,...i,children:e});return S.jsxs(S.Fragment,{children:[!a&&Q,S.jsxs(Ga,{isOpen:F,onClose:B,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(Ba,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(Ha,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:ae=>{ae.stopPropagation()},children:[S.jsxs($l,{p:8,textAlign:"center",children:[S.jsx(Sr,{size:"lg",mb:2,children:"Create Account"}),S.jsx(Qe,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),S.jsx(fc,{color:"gray.400"}),S.jsx(Fa,{px:8,children:S.jsx("form",{onSubmit:f(q),children:S.jsxs(mr,{spacing:4,children:[S.jsxs(kn,{isInvalid:_.companyName,isRequired:!0,children:[S.jsx(or,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),S.jsx(Vu,{children:_.companyName&&_.companyName.message})]}),S.jsxs(ar,{gap:4,w:"100%",children:[S.jsxs(kn,{isInvalid:_.firstName,isRequired:!0,children:[S.jsx(or,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),S.jsx(Vu,{children:_.firstName&&_.firstName.message})]}),S.jsxs(kn,{isInvalid:_.lastName,isRequired:!0,children:[S.jsx(or,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),S.jsx(Vu,{children:_.lastName&&_.lastName.message})]})]}),S.jsxs(kn,{isInvalid:_.email,isRequired:!0,children:[S.jsx(or,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),S.jsx(Vu,{children:_.email&&_.email.message})]}),S.jsxs(ar,{gap:4,w:"100%",children:[S.jsxs(kn,{isInvalid:_.password,isRequired:!0,children:[S.jsx(or,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),S.jsx(Vu,{children:_.password&&_.password.message})]}),S.jsxs(kn,{isInvalid:_.confirmPassword,isRequired:!0,children:[S.jsx(or,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),S.jsx(Vu,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),S.jsx(kn,{children:S.jsx(or,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),S.jsx(kn,{children:S.jsx(or,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),S.jsxs(Yy,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(Zn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(q),isLoading:V,loadingText:"Creating Account",children:"Create Account"}),S.jsxs(Qe,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",S.jsx(ho,{color:"blue.400",onClick:()=>{B(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}jN.propTypes={mode:Hr.oneOf(["button","link"]),label:Hr.string,buttonProps:Hr.object,isOpen:Hr.bool,onClose:Hr.func};function FN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(ul),{fullscreenRef:d}=Jd(),f=ll(),{register:_,handleSubmit:E,formState:{errors:b,isSubmitting:w}}=Sae({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[I,k]=D.useState(a),[V,L]=D.useState(!1);VN(I),D.useEffect(()=>{const Q=()=>{k(!0)};return window.addEventListener("openSignInModal",Q),()=>{window.removeEventListener("openSignInModal",Q)}},[]);const F=async Q=>{try{await l(Q.email,Q.password),Te.log("User: Sign-in process complete."),k(!1),window.location.reload()}catch(ae){Te.error("User: SignIn Error:",ae);const re=ae.message||"An error occurred while logging in. Please check your credentials.",fe=re.includes("verify your email");f({title:fe?"Email Verification Required":"Error",description:re,status:fe?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},B=()=>k(Q=>!Q),q=()=>{k(!1),L(!0)},$=n==="link"?S.jsx(ho,{variant:"header",onClick:B,children:e}):S.jsx(Zn,{onClick:B,...i,children:e});return S.jsxs(S.Fragment,{children:[$,S.jsxs(Ga,{isOpen:I,onClose:B,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(Ba,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsx("form",{onSubmit:E(F),children:S.jsxs(Ha,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Q=>{Q.stopPropagation()},children:[S.jsxs($l,{p:8,textAlign:"center",children:[S.jsx(Sr,{size:"lg",mb:2,children:"Welcome Back"}),S.jsx(Qe,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),S.jsx(fc,{color:"gray.400"}),S.jsx(Fa,{px:8,pb:8,children:S.jsxs(mr,{spacing:4,children:[S.jsxs(kn,{isInvalid:b.email,children:[S.jsxs(I0,{children:[S.jsx($y,{pointerEvents:"none",children:S.jsx(qWe,{color:"gray.500"})}),S.jsx(or,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),S.jsx(Vu,{children:b.email&&b.email.message})]}),S.jsxs(kn,{isInvalid:b.password,children:[S.jsxs(I0,{children:[S.jsx($y,{pointerEvents:"none",children:S.jsx(HWe,{color:"gray.500"})}),S.jsx(or,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),S.jsx(Vu,{children:b.password&&b.password.message})]})]})}),S.jsxs(Yy,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(Zn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),S.jsxs(Qe,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",S.jsx(ho,{color:"blue.400",onClick:q,children:"Sign Up"})]})]})]})})]}),S.jsx(jN,{mode:"link",isOpen:V,onClose:()=>L(!1)})]})}FN.propTypes={mode:Hr.oneOf(["button","link"]),label:Hr.string,buttonProps:Hr.object,initialIsOpen:Hr.bool};function Uze(){const{loadingProgression:n,isLoaded:e,error:i}=al(),{user:a}=D.useContext(ul),[l,d]=D.useState(!1),[f,_]=D.useState(!1),[E,b]=D.useState(!1),[w,I]=D.useState(!1),k=D.useRef(!1),V=D.useRef(!1),L=D.useRef(null),F=D.useRef(null),B=D.useRef(null),q=em(),$=D.useRef(null),Q=D.useRef(null),ae=D.useRef(null),re=D.useRef(null);D.useEffect(()=>{d(!a&&n===0)},[a,n]),D.useEffect(()=>{const ee=document.createElement("style");return ee.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(ee),$.current=ee,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const ee=()=>{const ne=document.getElementById("unity-canvas"),oe=document.getElementById("unity-container");ne&&(L.current=ne,console.log("LoaderProgress: Found Unity canvas"),ne.style.zIndex="1"),oe&&(F.current=oe,console.log("LoaderProgress: Found Unity container"),oe.style.zIndex="1"),ne&&oe&&ae.current&&(clearInterval(ae.current),ae.current=null)};return ee(),ae.current=setInterval(ee,100),()=>{ae.current&&(clearInterval(ae.current),ae.current=null)}},[]),D.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),V.current=!0,I(!0));const ne=q("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),V.current=!0,I(!0),window.isFirstSceneLoaded=!0}),oe=setTimeout(()=>{V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),V.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{ne(),clearTimeout(oe)}},[q]),D.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),k.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),V.current=!0,I(!0),window.isFirstSceneLoaded=!0));const ee=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),k.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),V.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",ee);const ne=q("PlayerInstantiated",ee),oe=setTimeout(()=>{k.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),k.current=!0,b(!0),V.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),V.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",ee),ne(),clearTimeout(oe)}},[q]),D.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:E}),w&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),L.current&&(L.current.style.opacity="1",L.current.style.removeProperty("opacity")),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="0",B.current.style.pointerEvents="none",setTimeout(()=>{B.current&&(B.current.style.display="none")},1500))},2e3)),()=>{Q.current&&clearTimeout(Q.current)}),[w,E]),D.useEffect(()=>(re.current=setInterval(()=>{var ee,ne;console.log("LoaderProgress: Debug interval",{isLoaded:e,isFirstSceneLoaded:V.current,isPlayerInstantiated:k.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(ee=L.current)==null?void 0:ee.style.zIndex,loaderZIndex:(ne=B.current)==null?void 0:ne.style.zIndex})},5e3),()=>{re.current&&clearInterval(re.current)}),[e]),D.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:e,isFirstSceneLoaded:w,isPlayerInstantiated:E,loadingProgression:n})},[e,w,E,n]);const fe=()=>e?e&&!w&&!E?"Scene initializing":w&&!E?"Player initializing":"Ready":"World loading",Z=()=>e?e&&!w&&!E?85:w&&!E?95:100:n*80;return S.jsx(S.Fragment,{children:l?S.jsx(qe,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:S.jsxs(mr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[S.jsx(Qe,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),S.jsx(Qe,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),S.jsx(Zn,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):S.jsx(qe,{ref:B,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:S.jsxs(ar,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[S.jsx(Qe,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),S.jsx(Qe,{fontSize:"sm",children:fe()}),S.jsx(N0,{value:Z(),size:"lg",width:"100%",marginY:2})]})})})}function O3({mode:n="button",label:e="Sign Out"}){const i=ll(),{signOut:a}=D.useContext(ul),{fullscreenRef:l}=Jd(),d=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?S.jsx(ho,{variant:"header",onClick:d,style:{cursor:"pointer"},children:e}):null;return S.jsx(S.Fragment,{children:f})}O3.propTypes={mode:Hr.oneOf(["button","link"]),label:Hr.string};function Vze(){const{user:n}=D.useContext(ul);return S.jsx("div",{children:n!==null?S.jsx("div",{children:S.jsx(O3,{})}):S.jsxs("div",{children:[S.jsx(jN,{}),S.jsx(FN,{})]})})}function jze(){const{fullscreenRef:n}=Jd(),[e,i]=D.useState(!1),a=()=>{i(!e)};return S.jsxs(S.Fragment,{children:[S.jsx(up,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:S.jsx(Ys,{"aria-label":"Controller Help",icon:S.jsx(YWe,{}),onClick:a,variant:"iconButton"})}),S.jsxs(Ga,{isOpen:e,onClose:a,size:"md",portalProps:{containerRef:n},children:[S.jsx(Ba,{}),S.jsxs(Ha,{children:[S.jsx($l,{children:"Notes"}),S.jsx(fc,{}),S.jsx(Fa,{children:S.jsx(Qe,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),S.jsx(Yy,{children:S.jsx(Zn,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var bae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},KQ=_r.createContext&&_r.createContext(bae),kg=function(){return kg=Object.assign||function(n){for(var e,i=1,a=arguments.length;i<a;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},kg.apply(this,arguments)},Fze=function(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function Tae(n){return n&&n.map(function(e,i){return _r.createElement(e.tag,kg({key:i},e.attr),Tae(e.child))})}function cr(n){return function(e){return _r.createElement(Bze,kg({attr:kg({},n.attr)},e),Tae(n.child))}}function Bze(n){var e=function(i){var a=n.attr,l=n.size,d=n.title,f=Fze(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),_r.createElement("svg",kg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,f,{className:E,style:kg(kg({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),d&&_r.createElement("title",null,d),n.children)};return KQ!==void 0?_r.createElement(KQ.Consumer,null,function(i){return e(i)}):e(bae)}function wae(n){return cr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"}}]})(n)}function BN(n){return cr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function Cae(n){return cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"}}]})(n)}function Wze(n){return cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function Nj(n){return cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function zze(n){return cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function Gze(n){return cr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function Hze(n){return cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Rae(n){return cr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function $ze(n){return cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function Kze(n){return cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Dj(n){return cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function xj(n){return cr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function qze(n){return cr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function Yze(n){return cr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function Xze(n){return cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function Lj(n){return cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function Jze(n){return cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function Qze(n){return cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function Zze(n){return cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function e9e(n){return cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function Iae({open:n,onClose:e}){const i=D.useRef(null),a=Jg(),{user:l}=D.useContext(ul),d=E=>{i.current&&!i.current.contains(E.target)&&e()},f=async E=>{const b=_(E);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const w=b.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Uoe(l.uid,w),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&S.jsx(Kl,{children:S.jsx(qe,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:S.jsx(qe,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:S.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function t9e({isOpen:n,onClose:e}){const[i,a]=D.useState(!1),[l,d]=D.useState(null),{user:f}=D.useContext(ul),_=Jg(),E=L=>{L.stopPropagation(),a(!0)},b=()=>{a(!1),e()},w=async L=>{if(d(L),f&&f.uid)try{await Uoe(f.uid,L.url),_("AvatarUrlFromReact",{url:L.url}),e()}catch(F){console.error("Error updating RPM URL:",F)}else console.error("No authenticated user found to update rpmURL.")},I=Pf("gray.200","whiteAlpha.300"),k="rgba(0, 0, 0, 0.3)",V=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return S.jsxs(S.Fragment,{children:[S.jsx(Kl,{children:S.jsxs(Ga,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[S.jsx(Ba,{bg:"rgba(0, 0, 0, 0.7)"}),S.jsxs(Ha,{bg:"gray.800",color:"white",maxW:"900px",children:[S.jsx($l,{fontSize:"lg",children:"Customise Your Avatar"}),S.jsx(fc,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),S.jsx(Fa,{pb:4,children:S.jsxs(mr,{spacing:4,align:"stretch",children:[S.jsx(Qe,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),S.jsxs(Hy,{columns:5,spacing:2,children:[S.jsx(qe,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:k},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:S.jsxs(mr,{spacing:1,children:[S.jsx(Dn,{as:Yze,boxSize:4}),S.jsx(Qe,{fontSize:"xs",children:"Create Custom Avatar"})]})}),V.map(L=>S.jsxs(qe,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===L.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>w(L),_hover:{bg:k},transition:"all 0.2s",aspectRatio:"1",children:[S.jsx(Va,{src:L.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:L.name,width:"100%",height:"100%",objectFit:"cover"}),S.jsx(qe,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:S.jsx(Qe,{fontSize:"xs",children:L.name})})]},L.id))]})]})})]})]})}),i&&S.jsx(Iae,{open:i,onClose:b})]})}function n9e(){const{fullscreenRef:n}=Jd(),[e,i]=D.useState(!1),[a,l]=D.useState(!1),[d,f]=D.useState(!1),[_,E]=D.useState(!1),{user:b}=D.useContext(ul),[w,I]=D.useState(null),[k,V]=D.useState(!0),L=($,Q)=>!$||!Q?"?":`${$.charAt(0)}${Q.charAt(0)}`.toUpperCase(),F=async()=>{if(b!=null&&b.uid){V(!0);try{const $=await yp(b.uid);I({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{V(!1)}}};D.useEffect(()=>{F()},[b==null?void 0:b.uid]),D.useEffect(()=>{const $=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const B=()=>l(!a),q=()=>{l(!1),F()};return e?S.jsxs(S.Fragment,{children:[S.jsx(up,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:S.jsxs(qe,{position:"relative",onMouseEnter:()=>{f(!0),E(!0)},onMouseLeave:()=>{f(!1),E(!1)},cursor:"pointer",onClick:B,children:[S.jsx(Gu,{src:k||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:k?L(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&S.jsx(qe,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:S.jsx(Qe,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),S.jsx(t9e,{isOpen:a,onClose:q})]}):null}function r9e(n){return cr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function i9e(n){return cr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function s9e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:a}=Jd(),l=ll();D.useEffect(()=>{const f=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return S.jsx(up,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:S.jsx(Ys,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?S.jsx(r9e,{}):S.jsx(i9e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const qQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function o9e(){const{isOpen:n,onOpen:e,onClose:i}=qd(),{fullscreenRef:a}=Jd(),[l,d]=lze(!1);D.useEffect(()=>{Te.log("VideoPlayer: Current video URL:",l),l&&(Te.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const f=()=>{Te.log("VideoPlayer: Closing modal"),d(),i()};return S.jsx(Kl,{containerRef:a,children:S.jsxs(Ga,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[S.jsx(Ba,{bg:"rgba(0, 0, 0, 0.8)"}),S.jsxs(Ha,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[S.jsx(fc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Fa,{p:0,width:"100%",children:l&&S.jsx(qe,{style:qQ.iframeContainer,children:S.jsx("iframe",{src:l,style:qQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function a9e({isOpen:n,onClose:e,playerName:i,playerId:a,uid:l}){const[d,f]=D.useState(null),[_,E]=D.useState(!0),[b,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(E(!0),w(null),!l){Te.warn("NameplateModal: No UID provided for player:",i),w("No user ID available for this player"),E(!1);return}try{Te.log("NameplateModal: Fetching profile for UID:",l);const k=await yp(l);k?f({firstName:k.firstName,lastName:k.lastName,linkedinUrl:k.linkedinUrl,websiteUrl:k.websiteUrl,rpmURL:k.rpmURL?k.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(k){Te.error("Error fetching profile data:",k),w("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),S.jsxs(Ga,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[S.jsx(Ba,{backdropFilter:"blur(10px)"}),S.jsxs(Ha,{bg:"gray.900",color:"white",borderRadius:"xl",children:[S.jsx($l,{children:"Player Info"}),S.jsx(fc,{}),S.jsx(Fa,{pb:6,children:_?S.jsx(Yk,{py:8,children:S.jsx(la,{size:"xl",color:"blue.400"})}):b?S.jsxs(Fu,{status:"warning",variant:"solid",borderRadius:"md",children:[S.jsx(Bu,{}),b]}):S.jsxs(mr,{spacing:4,align:"center",children:[S.jsx(Gu,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),S.jsxs(mr,{spacing:1,children:[S.jsx(Qe,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&S.jsxs(Qe,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),S.jsxs(Qe,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&S.jsxs(S.Fragment,{children:[S.jsx(uo,{borderColor:"whiteAlpha.300"}),S.jsxs(ni,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&S.jsx(ho,{href:d.linkedinUrl,isExternal:!0,children:S.jsx(Ys,{icon:S.jsx(BN,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&S.jsx(ho,{href:d.websiteUrl,isExternal:!0,children:S.jsx(Ys,{icon:S.jsx(Rae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const c9e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[a]=fre("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const Ie=navigator.userAgent||navigator.vendor||window.opera,Be=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ie);d(Be),Be&&Te.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,_=dae(),[E,b]=D.useState(!1),[w,I]=D.useState([]),[k,V]=D.useState(!1),[L,F]=D.useState({}),[B,q]=D.useState({}),[$,Q]=D.useState(null),[ae,re]=D.useState(!1),fe=ll(),Z=window.currentUser||{},ne=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const Ie=(window.location.pathname||"").split("/"),ve=Ie[Ie.length-1];if(ve&&ve.length>5)return ve;const Be=document.body.getAttribute("data-space-id");if(Be)return Be;const ke=localStorage.getItem("currentSpaceId");return ke||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const ve=await Og(ne);ve&&ve.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),re(!0)):re(!1)}catch(ve){console.error("UnityPlayerList: Error checking if voice is disabled:",ve)}})();const Ie=ve=>{ve.detail&&typeof ve.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ve.detail.voiceDisabled),re(ve.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ie),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ie)}},[ne]),D.useEffect(()=>{const Ee={};_.forEach(Ie=>{if(Ie.uid){if(Ie.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)Ee[Ie.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,Be=ve.find(ke=>String(ke.uid)===String(Ie.uid));if(Be)Ee[Ie.uid]=Be.uid;else{const ke=ve.find(Re=>typeof Re.uid=="string"&&Re.uid.includes(Ie.uid));if(ke)Ee[Ie.uid]=ke.uid;else{const Re=ve.find(he=>typeof Ie.uid=="string"&&Ie.uid.includes(String(he.uid)));if(Re)Ee[Ie.uid]=Re.uid;else{const he=ve.filter(we=>!(typeof we.uid=="string"&&we.uid.startsWith("screen-")));he.length===1&&!Ie.isLocalPlayer&&(Ee[Ie.uid]=he[0].uid)}}}}}}),q(Ee)},[_]);const oe=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const Ee=window.agoraClient.isVoiceEnabled;Ee!==k&&V(Ee)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ee=window.agoraClient.client.remoteUsers,Ie={};Ee.forEach(ve=>{typeof ve.uid=="string"&&ve.uid.startsWith("screen-")||(Ie[ve.uid]=!!ve.audioTrack&&!ve.audioTrack.muted)}),JSON.stringify(Ie)!==JSON.stringify(L)&&F(Ie)}};D.useEffect(()=>{const Ee=setInterval(oe,500),Ie=ve=>{ve.detail&&typeof ve.detail.enabled=="boolean"&&V(ve.detail.enabled)};return window.addEventListener("VoiceToggled",Ie),oe(),()=>{clearInterval(Ee),window.removeEventListener("VoiceToggled",Ie)}},[]),D.useEffect(()=>{const Ee=()=>{Te.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",Ee),window.isPlayerInstantiated&&(Te.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",Ee)}},[]),D.useEffect(()=>{(async()=>{const Ie=await Promise.all(_.map(async ve=>{if(ve.uid)try{const Be=await yp(ve.uid);let ke=null;if(Be.groups){const Re=`space_${ne}_owners`,he=`space_${ne}_hosts`;Be.groups.includes(Re)?ke="owner":Be.groups.includes(he)&&(ke="host")}return le({uid:ve.uid})&&Q(ke),{...ve,firstName:Be.firstName,lastName:Be.lastName,linkedInProfile:Be.linkedInProfile,websiteUrl:Be.websiteUrl,rpmURL:Be.rpmURL?Be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:ke}}catch(Be){return Te.error(`Error fetching data for player ${ve.playerName}:`,Be),ve}return ve}));I(Ie)})()},[_,ne]);const ge=[...w].sort((Ee,Ie)=>Ee.isLocalPlayer?-1:Ie.isLocalPlayer?1:0),pe=()=>{Te.log("UnityPlayerList: Toggling visibility"),e&&e()},le=Ee=>!!(Ee.isLocalPlayer||Z&&Z.uid&&Ee.uid===Z.uid),Me=Ee=>{try{if(le(Ee))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:k;if(Ee.uid){if(L[Ee.uid])return!0;const Ie=B[Ee.uid];if(Ie&&L[Ie])return!0;const ve=parseInt(Ee.uid);if(!isNaN(ve)&&L[ve])return!0}return!1}catch(Ie){return console.error("Error in hasActiveMic:",Ie),!1}},He=({player:Ee})=>{const Ie=Ee.role;return Ie==="owner"?S.jsxs(ni,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[S.jsx(Dn,{as:Nj,color:"green.400",boxSize:5}),S.jsx(Wd,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ie==="host"?S.jsxs(ni,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[S.jsx(Dn,{as:Lj,color:"purple.400",boxSize:5}),S.jsx(Wd,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},tt=(Ee,Ie)=>{switch(console.log(`Action "${Ee}" performed on player: ${Ie.playerName}`),Ee){case"mute":fe({title:"Player Muted",description:`${Ie.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":fe({title:"Player Kicked",description:`${Ie.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":fe({title:"Player Promoted",description:`${Ie.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return S.jsxs(qe,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!f?"visible":"hidden",role:"group",children:[S.jsx(qe,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:S.jsx(Ys,{icon:S.jsx(oae,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:pe,_hover:{opacity:.8}})}),S.jsxs(Qe,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),S.jsx(qe,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:S.jsx(mr,{align:"stretch",spacing:1,width:"100%",children:ge.map((Ee,Ie)=>{const ve=le(Ee),Be=!ae&&Me(Ee);return S.jsx(qe,{children:S.jsxs(Bre,{placement:"left",trigger:"hover",children:[S.jsx($re,{children:S.jsxs(ni,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[S.jsx(Gu,{size:"xs",src:Ee.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsx(Qe,{fontSize:"xs",children:Ee.playerName}),Ee.role==="owner"&&S.jsx(Dn,{as:Nj,color:"green.400",boxSize:2.5}),Ee.role==="host"&&S.jsx(Dn,{as:Lj,color:"purple.400",boxSize:2.5}),S.jsx(sk,{}),$==="owner"&&S.jsxs(Zk,{closeOnSelect:!0,placement:"bottom-end",children:[S.jsx(eN,{as:Ys,"aria-label":"Options",icon:S.jsx(Gze,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:ke=>ke.stopPropagation()}),S.jsxs(tN,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[S.jsx(bg,{icon:S.jsx(e9e,{}),onClick:()=>tt("mute",Ee),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ae,children:"Mute Player"}),S.jsx(bg,{icon:S.jsx(Jze,{}),onClick:()=>tt("promote",Ee),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),S.jsx(Ire,{borderColor:"whiteAlpha.300"}),S.jsx(bg,{icon:S.jsx(Wze,{}),onClick:()=>tt("kick",Ee),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ae&&(Be?S.jsx(qe,{color:"green.400",children:S.jsx(xj,{})}):S.jsx(qe,{color:"red.400",children:S.jsx(Dj,{})})),ve&&S.jsx(Qe,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),S.jsx(Hre,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:S.jsx(zre,{children:S.jsxs(mr,{align:"center",spacing:3,children:[S.jsx(Gu,{size:"xl",src:Ee.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),S.jsx(Qe,{fontSize:"xl",fontWeight:"bold",children:Ee.playerName}),S.jsx(He,{player:Ee}),Ee.firstName&&S.jsxs(Qe,{fontSize:"sm",color:"gray.300",children:[Ee.firstName," ",Ee.lastName]}),S.jsxs(ni,{spacing:4,pt:2,children:[Ee.linkedInProfile&&S.jsx(ho,{href:Ee.linkedInProfile,isExternal:!0,children:S.jsx(Ys,{icon:S.jsx(BN,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),Ee.websiteUrl&&S.jsx(ho,{href:Ee.websiteUrl,isExternal:!0,children:S.jsx(Ys,{icon:S.jsx(Rae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ae&&S.jsx(Ys,{icon:Be?S.jsx(xj,{}):S.jsx(Dj,{}),variant:"ghost",colorScheme:Be?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ae&&S.jsx(Ys,{icon:S.jsx(Zze,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ie)})})})]})};var zO={exports:{}},l9e=zO.exports,YQ;function u9e(){return YQ||(YQ=1,function(n,e){(function(i,a){n.exports=a()})(l9e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in t)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(t,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(t)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Iy<"u"?Iy:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=function(t){try{return!!t()}catch{return!0}},f=!d(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=f,E=Function.prototype,b=E.call,w=_&&E.bind.bind(b,b),I=_?w:function(t){return function(){return b.apply(t,arguments)}},k=I({}.isPrototypeOf),V=function(t){return t&&t.Math==Math&&t},L=V(typeof globalThis=="object"&&globalThis)||V(typeof window=="object"&&window)||V(typeof self=="object"&&self)||V(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),F=f,B=Function.prototype,q=B.apply,$=B.call,Q=typeof Reflect=="object"&&Reflect.apply||(F?$.bind(q):function(){return $.apply(q,arguments)}),ae=I,re=ae({}.toString),fe=ae("".slice),Z=function(t){return fe(re(t),8,-1)},ee=Z,ne=I,oe=function(t){if(ee(t)==="Function")return ne(t)},ge=typeof document=="object"&&document.all,pe={all:ge,IS_HTMLDDA:ge===void 0&&ge!==void 0},le=pe.all,Me=pe.IS_HTMLDDA?function(t){return typeof t=="function"||t===le}:function(t){return typeof t=="function"},He={},tt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ee=f,Ie=Function.prototype.call,ve=Ee?Ie.bind(Ie):function(){return Ie.apply(Ie,arguments)},Be={},ke={}.propertyIsEnumerable,Re=Object.getOwnPropertyDescriptor,he=Re&&!ke.call({1:2},1);Be.f=he?function(t){var r=Re(this,t);return!!r&&r.enumerable}:ke;var we,Ue,Fe=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},$e=d,ct=Z,it=Object,Ct=I("".split),Vt=$e(function(){return!it("z").propertyIsEnumerable(0)})?function(t){return ct(t)=="String"?Ct(t,""):it(t)}:it,Dt=function(t){return t==null},an=Dt,jn=TypeError,Qt=function(t){if(an(t))throw jn("Can't call method on "+t);return t},Ot=Vt,Lt=Qt,Ce=function(t){return Ot(Lt(t))},Ve=Me,Ye=pe.all,_t=pe.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Ve(t)||t===Ye}:function(t){return typeof t=="object"?t!==null:Ve(t)},vt={},St=vt,Ht=L,fn=Me,mn=function(t){return fn(t)?t:void 0},Jt=function(t,r){return arguments.length<2?mn(St[t])||mn(Ht[t]):St[t]&&St[t][r]||Ht[t]&&Ht[t][r]},Hn=typeof navigator<"u"&&String(navigator.userAgent)||"",mc=L,Bt=Hn,un=mc.process,rs=mc.Deno,Fs=un&&un.versions||rs&&rs.version,Qs=Fs&&Fs.v8;Qs&&(Ue=(we=Qs.split("."))[0]>0&&we[0]<4?1:+(we[0]+we[1])),!Ue&&Bt&&(!(we=Bt.match(/Edge\/(\d+)/))||we[1]>=74)&&(we=Bt.match(/Chrome\/(\d+)/))&&(Ue=+we[1]);var Ei=Ue,$a=Ei,dl=d,_o=L.String,yo=!!Object.getOwnPropertySymbols&&!dl(function(){var t=Symbol();return!_o(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&$a&&$a<41}),ql=yo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Bs=Jt,gc=Me,ua=k,_c=Object,hl=ql?function(t){return typeof t=="symbol"}:function(t){var r=Bs("Symbol");return gc(r)&&ua(r.prototype,_c(t))},qu=String,yc=function(t){try{return qu(t)}catch{return"Object"}},pl=Me,Do=yc,Mi=TypeError,ds=function(t){if(pl(t))return t;throw Mi(Do(t)+" is not a function")},Ka=ds,Yu=Dt,Ec=function(t,r){var s=t[r];return Yu(s)?void 0:Ka(s)},da=ve,ha=Me,Qd=_t,Qg=TypeError,Xu={exports:{}},Tp=L,Ws=Object.defineProperty,Ju=function(t,r){try{Ws(Tp,t,{value:r,configurable:!0,writable:!0})}catch{Tp[t]=r}return r},pa="__core-js_shared__",Zd=L[pa]||Ju(pa,{}),eh=Zd;(Xu.exports=function(t,r){return eh[t]||(eh[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var qa=Xu.exports,th=Qt,Qu=Object,xo=function(t){return Qu(th(t))},nh=xo,$r=I({}.hasOwnProperty),vi=Object.hasOwn||function(t,r){return $r(nh(t),r)},vc=I,fl=0,fa=Math.random(),wp=vc(1 .toString),rh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+wp(++fl+fa,36)},Yl=qa,Eo=vi,tm=rh,Zs=yo,Cp=ql,ml=L.Symbol,ih=Yl("wks"),sh=Cp?ml.for||ml:ml&&ml.withoutSetter||tm,yr=function(t){return Eo(ih,t)||(ih[t]=Zs&&Eo(ml,t)?ml[t]:sh("Symbol."+t)),ih[t]},Xl=ve,Jl=_t,Zu=hl,Ya=Ec,Lo=function(t,r){var s,o;if(ha(s=t.toString)&&!Qd(o=da(s,t))||ha(s=t.valueOf)&&!Qd(o=da(s,t)))return o;throw Qg("Can't convert object to primitive value")},ed=TypeError,gl=yr("toPrimitive"),Ql=function(t,r){if(!Jl(t)||Zu(t))return t;var s,o=Ya(t,gl);if(o){if(s=Xl(o,t,r),!Jl(s)||Zu(s))return s;throw ed("Can't convert object to primitive value")}return Lo(t)},Xr=hl,Xa=function(t){var r=Ql(t,"string");return Xr(r)?r:r+""},lr=_t,Sc=L.document,nm=lr(Sc)&&lr(Sc.createElement),Zl=function(t){return nm?Sc.createElement(t):{}},oh=Zl,Rp=!tt&&!d(function(){return Object.defineProperty(oh("div"),"a",{get:function(){return 7}}).a!=7}),rm=tt,Ip=ve,Mo=Be,is=Fe,Uo=Ce,Vo=Xa,eu=vi,jo=Rp,Fo=Object.getOwnPropertyDescriptor;He.f=rm?Fo:function(t,r){if(t=Uo(t),r=Vo(r),jo)try{return Fo(t,r)}catch{}if(eu(t,r))return is(!Ip(Mo.f,t,r),t[r])};var im=d,bc=Me,hs=/#|\.prototype\./,td=function(t,r){var s=_l[Ap(t)];return s==sm||s!=tu&&(bc(r)?im(r):!!r)},Ap=td.normalize=function(t){return String(t).replace(hs,".").toLowerCase()},_l=td.data={},tu=td.NATIVE="N",sm=td.POLYFILL="P",ma=td,ga=ds,yl=f,be=oe(oe.bind),De=function(t,r){return ga(t),r===void 0?t:yl?be(t,r):function(){return t.apply(r,arguments)}},rt={},Yt=tt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Xn=_t,wr=String,Kr=TypeError,dn=function(t){if(Xn(t))return t;throw Kr(wr(t)+" is not an object")},jr=tt,Si=Rp,Ps=Yt,Bo=dn,Wo=Xa,nd=TypeError,Ji=Object.defineProperty,El=Object.getOwnPropertyDescriptor,ah="enumerable",Tc="configurable",Zg="writable";rt.f=jr?Ps?function(t,r,s){if(Bo(t),r=Wo(r),Bo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Zg in s&&!s[Zg]){var o=El(t,r);o&&o[Zg]&&(t[r]=s.value,s={configurable:Tc in s?s[Tc]:o[Tc],enumerable:ah in s?s[ah]:o[ah],writable:!1})}return Ji(t,r,s)}:Ji:function(t,r,s){if(Bo(t),r=Wo(r),Bo(s),Si)try{return Ji(t,r,s)}catch{}if("get"in s||"set"in s)throw nd("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var om=rt,rd=Fe,zo=tt?function(t,r,s){return om.f(t,r,rd(1,s))}:function(t,r,s){return t[r]=s,t},nu=L,am=Q,e_=oe,hE=Me,cm=He.f,lm=ma,id=vt,sd=De,od=zo,t_=vi,pE=function(t){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,o)}return new t(s,o,c)}return am(t,this,arguments)};return r.prototype=t.prototype,r},Fn=function(t,r){var s,o,c,u,h,m,y,v,T,R=t.target,P=t.global,N=t.stat,G=t.proto,j=P?nu:N?nu[R]:(nu[R]||{}).prototype,W=P?id:id[R]||od(id,R,{})[R],Y=W.prototype;for(u in r)o=!(s=lm(P?u:R+(N?".":"#")+u,t.forced))&&j&&t_(j,u),m=W[u],o&&(y=t.dontCallGetSet?(T=cm(j,u))&&T.value:j[u]),h=o&&y?y:r[u],o&&typeof m==typeof h||(v=t.bind&&o?sd(h,nu):t.wrap&&o?pE(h):G&&hE(h)?e_(h):h,(t.sham||h&&h.sham||m&&m.sham)&&od(v,"sham",!0),od(W,u,v),G&&(t_(id,c=R+"Prototype")||od(id,c,{}),od(id[c],u,h),t.real&&Y&&(s||!Y[u])&&od(Y,u,h)))},um=Math.ceil,Go=Math.floor,fE=Math.trunc||function(t){var r=+t;return(r>0?Go:um)(r)},mE=fE,wc=function(t){var r=+t;return r!=r||r===0?0:mE(r)},A=wc,z=Math.max,te=Math.min,me=function(t,r){var s=A(t);return s<0?z(s+r,0):te(s,r)},Xe=wc,lt=Math.min,Ut=function(t){return t>0?lt(Xe(t),9007199254740991):0},Jr=Ut,hi=function(t){return Jr(t.length)},Cr=Ce,zs=me,ps=hi,Ja=function(t){return function(r,s,o){var c,u=Cr(r),h=ps(u),m=zs(o,h);if(t&&s!=s){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((t||m in u)&&u[m]===s)return t||m||0;return!t&&-1}},Ho={includes:Ja(!0),indexOf:Ja(!1)},Pp=Ho.includes;Fn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(t){return Pp(this,t,arguments.length>1?arguments[1]:void 0)}});var dm=vt,Qa=function(t){return dm[t+"Prototype"]},BR=Qa("Array").includes,WR=_t,hm=Z,zN=yr("match"),zR=function(t){var r;return WR(t)&&((r=t[zN])!==void 0?!!r:hm(t)=="RegExp")},GN=zR,GR=TypeError,tb={};tb[yr("toStringTag")]="z";var Op=String(tb)==="[object z]",n_=Op,HN=Me,kp=Z,$N=yr("toStringTag"),HR=Object,nb=kp(function(){return arguments}())=="Arguments",Cc=n_?kp:function(t){var r,s,o;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=HR(t),$N))=="string"?s:nb?kp(r):(o=kp(r))=="Object"&&HN(r.callee)?"Arguments":o},$R=Cc,KR=String,_a=function(t){if($R(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return KR(t)},KN=yr("match"),qN=Fn,YN=function(t){if(GN(t))throw GR("The method doesn't accept regular expressions");return t},XN=Qt,qR=_a,vl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[KN]=!1,"/./"[t](r)}catch{}}return!1},r_=I("".indexOf);qN({target:"String",proto:!0,forced:!vl("includes")},{includes:function(t){return!!~r_(qR(XN(this)),qR(YN(t)),arguments.length>1?arguments[1]:void 0)}});var YR=Qa("String").includes,rb=k,XR=BR,JR=YR,i_=Array.prototype,ib=String.prototype,JN=function(t){var r=t.includes;return t===i_||rb(i_,t)&&r===i_.includes?XR:typeof t=="string"||t===ib||rb(ib,t)&&r===ib.includes?JR:r},at=l(JN),sb=ds,s_=xo,ob=Vt,QR=hi,gE=TypeError,pm=function(t){return function(r,s,o,c){sb(s);var u=s_(r),h=ob(u),m=QR(u),y=t?m-1:0,v=t?-1:1;if(o<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw gE("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,u));return c}},ab={left:pm(!1)},ZR=d,Np=function(t,r){var s=[][t];return!!s&&ZR(function(){s.call(null,r||function(){return 1},1)})},Dp=typeof process<"u"&&Z(process)=="process",eI=ab.left;Fn({target:"Array",proto:!0,forced:!Dp&&Ei>79&&Ei<83||!Np("reduce")},{reduce:function(t){var r=arguments.length;return eI(this,t,r,r>1?arguments[1]:void 0)}});var tI=Qa("Array").reduce,nI=k,rI=tI,_E=Array.prototype,ch=function(t){var r=t.reduce;return t===_E||nI(_E,t)&&r===_E.reduce?rI:r},yE=ch,Za=l(yE),QN=Z,o_=Array.isArray||function(t){return QN(t)=="Array"},a_=Fn,ZN=o_,iI=I([].reverse),cb=[1,2];a_({target:"Array",proto:!0,forced:String(cb)===String(cb.reverse())},{reverse:function(){return ZN(this)&&(this.length=this.length),iI(this)}});var Ai=Qa("Array").reverse,lb=k,EE=Ai,xp=Array.prototype,sI=function(t){var r=t.reverse;return t===xp||lb(xp,t)&&r===xp.reverse?EE:r},vE=sI,fm=l(vE),SE=rh,Lp=qa("keys"),c_=function(t){return Lp[t]||(Lp[t]=SE(t))},eD=!d(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),tD=vi,oI=Me,bE=xo,TE=eD,wE=c_("IE_PROTO"),l_=Object,ub=l_.prototype,u_=TE?l_.getPrototypeOf:function(t){var r=bE(t);if(tD(r,wE))return r[wE];var s=r.constructor;return oI(s)&&r instanceof s?s.prototype:r instanceof l_?ub:null},nD=I,aI=ds,rD=Me,iD=String,db=TypeError,lh=function(t,r,s){try{return nD(aI(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},cI=dn,mm=function(t){if(typeof t=="object"||rD(t))return t;throw db("Can't set "+iD(t)+" as a prototype")},ru=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=lh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return cI(o),mm(c),r?t(o,c):o.__proto__=c,o}}():void 0),uh={},Rc={},d_=vi,sD=Ce,oD=Ho.indexOf,Mp=Rc,gm=I([].push),Up=function(t,r){var s,o=sD(t),c=0,u=[];for(s in o)!d_(Mp,s)&&d_(o,s)&&gm(u,s);for(;r.length>c;)d_(o,s=r[c++])&&(~oD(u,s)||gm(u,s));return u},_m=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hb=Up,ym=_m.concat("length","prototype");uh.f=Object.getOwnPropertyNames||function(t){return hb(t,ym)};var Ic={};Ic.f=Object.getOwnPropertySymbols;var Pi=Jt,bi=uh,dh=Ic,vo=dn,ya=I([].concat),Vp=Pi("Reflect","ownKeys")||function(t){var r=bi.f(vo(t)),s=dh.f;return s?ya(r,s(t)):r},jp=vi,Ea=Vp,CE=He,lI=rt,RE={},IE=Up,uI=_m,Ac=Object.keys||function(t){return IE(t,uI)},AE=tt,pb=Yt,dI=rt,aD=dn,hh=Ce,Em=Ac;RE.f=AE&&!pb?Object.defineProperties:function(t,r){aD(t);for(var s,o=hh(r),c=Em(r),u=c.length,h=0;u>h;)dI.f(t,s=c[h++],o[s]);return t};var ad,h_=Jt("document","documentElement"),PE=dn,Pc=RE,ec=_m,Fp=Rc,cd=h_,ld=Zl,ud="prototype",OE="script",kE=c_("IE_PROTO"),p_=function(){},va=function(t){return"<"+OE+">"+t+"</"+OE+">"},Sa=function(t){t.write(va("")),t.close();var r=t.parentWindow.Object;return t=null,r},pi=function(){try{ad=new ActiveXObject("htmlfile")}catch{}var t,r,s;pi=typeof document<"u"?document.domain&&ad?Sa(ad):(r=ld("iframe"),s="java"+OE+":",r.style.display="none",cd.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(va("document.F=Object")),t.close(),t.F):Sa(ad);for(var o=ec.length;o--;)delete pi[ud][ec[o]];return pi()};Fp[kE]=!0;var $o=Object.create||function(t,r){var s;return t!==null?(p_[ud]=PE(t),s=new p_,p_[ud]=null,s[kE]=t):s=pi(),r===void 0?s:Pc.f(s,r)},hI=_t,pI=zo,NE=Error,fb=I("".replace),fI=String(NE("zxcasd").stack),f_=/\n\s*at [^:]*:[^\n]*/,mI=f_.test(fI),vm=Fe,mb=!d(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",vm(1,7)),t.stack!==7)}),cD=zo,m_=function(t,r){if(mI&&typeof t=="string"&&!NE.prepareStackTrace)for(;r--;)t=fb(t,f_,"");return t},DE=mb,gb=Error.captureStackTrace,ph={},Sm=ph,gI=yr("iterator"),xE=Array.prototype,g_=function(t){return t!==void 0&&(Sm.Array===t||xE[gI]===t)},bm=Cc,LE=Ec,_b=Dt,yb=ph,Eb=yr("iterator"),dd=function(t){if(!_b(t))return LE(t,Eb)||LE(t,"@@iterator")||yb[bm(t)]},Oc=ve,Bp=ds,vb=dn,_I=yc,hd=dd,fh=TypeError,__=function(t,r){var s=arguments.length<2?hd(t):r;if(Bp(s))return vb(Oc(s,t));throw fh(_I(t)+" is not iterable")},yI=ve,iu=dn,mh=Ec,y_=function(t,r,s){var o,c;iu(t);try{if(!(o=mh(t,"return"))){if(r==="throw")throw s;return s}o=yI(o,t)}catch(u){c=!0,o=u}if(r==="throw")throw s;if(c)throw o;return iu(o),s},EI=De,ME=ve,vI=dn,E_=yc,su=g_,v_=hi,Tm=k,Wp=__,Sb=dd,zp=y_,SI=TypeError,wm=function(t,r){this.stopped=t,this.result=r},Di=wm.prototype,gh=function(t,r,s){var o,c,u,h,m,y,v,T=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),N=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),j=EI(r,T),W=function(X){return o&&zp(o,"normal",X),new wm(!0,X)},Y=function(X){return R?(vI(X),G?j(X[0],X[1],W):j(X[0],X[1])):G?j(X,W):j(X)};if(P)o=t.iterator;else if(N)o=t;else{if(!(c=Sb(t)))throw SI(E_(t)+" is not iterable");if(su(c)){for(u=0,h=v_(t);h>u;u++)if((m=Y(t[u]))&&Tm(Di,m))return m;return new wm(!1)}o=Wp(t,c)}for(y=P?t.next:o.next;!(v=ME(y,o)).done;){try{m=Y(v.value)}catch(X){zp(o,"throw",X)}if(typeof m=="object"&&m&&Tm(Di,m))return m}return new wm(!1)},bb=_a,Tb=Fn,UE=k,wb=u_,ou=ru,Ui=function(t,r,s){for(var o=Ea(r),c=lI.f,u=CE.f,h=0;h<o.length;h++){var m=o[h];jp(t,m)||s&&jp(s,m)||c(t,m,u(r,m))}},fs=$o,ms=zo,Cm=Fe,S_=function(t,r){hI(r)&&"cause"in r&&pI(t,"cause",r.cause)},b_=function(t,r,s,o){DE&&(gb?gb(t,r):cD(t,"stack",m_(s,o)))},lD=gh,So=function(t,r){return t===void 0?arguments.length<2?"":r:bb(t)},Cb=yr("toStringTag"),Rm=Error,Rb=[].push,Ko=function(t,r){var s,o=UE(ba,this);ou?s=ou(Rm(),o?wb(this):ba):(s=o?this:fs(ba),ms(s,Cb,"Error")),r!==void 0&&ms(s,"message",So(r)),b_(s,Ko,s.stack,1),arguments.length>2&&S_(s,arguments[2]);var c=[];return lD(t,Rb,{that:c}),ms(s,"errors",c),s};ou?ou(Ko,Rm):Ui(Ko,Rm,{name:!0});var ba=Ko.prototype=fs(Rm.prototype,{constructor:Cm(1,Ko),message:Cm(1,""),name:Cm(1,"AggregateError")});Tb({global:!0},{AggregateError:Ko});var _h,Gp,Im,bI=Me,Ib=L.WeakMap,TI=bI(Ib)&&/native code/.test(String(Ib)),Ab=L,wI=_t,CI=zo,VE=vi,jE=Zd,T_=c_,RI=Rc,w_="Object already initialized",Am=Ab.TypeError,II=Ab.WeakMap;if(TI||jE.state){var kc=jE.state||(jE.state=new II);kc.get=kc.get,kc.has=kc.has,kc.set=kc.set,_h=function(t,r){if(kc.has(t))throw Am(w_);return r.facade=t,kc.set(t,r),r},Gp=function(t){return kc.get(t)||{}},Im=function(t){return kc.has(t)}}else{var Hp=T_("state");RI[Hp]=!0,_h=function(t,r){if(VE(t,Hp))throw Am(w_);return r.facade=t,CI(t,Hp,r),r},Gp=function(t){return VE(t,Hp)?t[Hp]:{}},Im=function(t){return VE(t,Hp)}}var yh,Pb,Ob,pd={set:_h,get:Gp,has:Im,enforce:function(t){return Im(t)?Gp(t):_h(t,{})},getterFor:function(t){return function(r){var s;if(!wI(r)||(s=Gp(r)).type!==t)throw Am("Incompatible receiver, "+t+" required");return s}}},FE=tt,AI=vi,kb=Function.prototype,uD=FE&&Object.getOwnPropertyDescriptor,Nb=AI(kb,"name"),PI={PROPER:Nb&&(function(){}).name==="something",CONFIGURABLE:Nb&&(!FE||FE&&uD(kb,"name").configurable)},dD=zo,fd=function(t,r,s,o){return o&&o.enumerable?t[r]=s:dD(t,r,s),t},OI=d,kI=Me,BE=_t,hD=$o,NI=u_,pD=fd,tc=yr("iterator"),WE=!1;[].keys&&("next"in(Ob=[].keys())?(Pb=NI(NI(Ob)))!==Object.prototype&&(yh=Pb):WE=!0);var zE=!BE(yh)||OI(function(){var t={};return yh[tc].call(t)!==t});kI((yh=zE?{}:hD(yh))[tc])||pD(yh,tc,function(){return this});var Db={IteratorPrototype:yh,BUGGY_SAFARI_ITERATORS:WE},DI=Cc,xI=Op?{}.toString:function(){return"[object "+DI(this)+"]"},xb=Op,Pm=rt.f,Lb=zo,Mb=vi,fD=xI,Ub=yr("toStringTag"),md=function(t,r,s,o){if(t){var c=s?t:t.prototype;Mb(c,Ub)||Pm(c,Ub,{configurable:!0,value:r}),o&&!xb&&Lb(c,"toString",fD)}},LI=Db.IteratorPrototype,MI=$o,UI=Fe,mD=md,Ta=ph,qo=function(){return this},GE=function(t,r,s,o){var c=r+" Iterator";return t.prototype=MI(LI,{next:UI(+!o,s)}),mD(t,c,!1,!0),Ta[c]=qo,t},VI=Fn,jI=ve,FI=PI,BI=GE,Vb=u_,WI=md,HE=fd,jb=ph,zI=Db,Fb=FI.PROPER,Om=zI.BUGGY_SAFARI_ITERATORS,$E=yr("iterator"),KE="keys",$p="values",GI="entries",HI=function(){return this},qE=function(t,r,s,o,c,u,h){BI(s,r,o);var m,y,v,T=function(Y){if(Y===c&&j)return j;if(!Om&&Y in N)return N[Y];switch(Y){case KE:case $p:case GI:return function(){return new s(this,Y)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,N=t.prototype,G=N[$E]||N["@@iterator"]||c&&N[c],j=!Om&&G||T(c),W=r=="Array"&&N.entries||G;if(W&&(m=Vb(W.call(new t)))!==Object.prototype&&m.next&&(WI(m,R,!0,!0),jb[R]=HI),Fb&&c==$p&&G&&G.name!==$p&&(P=!0,j=function(){return jI(G,this)}),c)if(y={values:T($p),keys:u?j:T(KE),entries:T(GI)},h)for(v in y)(Om||P||!(v in N))&&HE(N,v,y[v]);else VI({target:r,proto:!0,forced:Om||P},y);return h&&N[$E]!==j&&HE(N,$E,j,{}),jb[r]=j,y},YE=function(t,r){return{value:t,done:r}},XE=Ce,au=ph,$I=pd;rt.f;var KI=qE,JE=YE,Bb="Array Iterator",qI=$I.set,C_=$I.getterFor(Bb);KI(Array,"Array",function(t,r){qI(this,{type:Bb,target:XE(t),index:0,kind:r})},function(){var t=C_(this),r=t.target,s=t.kind,o=t.index++;return!r||o>=r.length?(t.target=void 0,JE(void 0,!0)):JE(s=="keys"?o:s=="values"?r[o]:[o,r[o]],!1)},"values"),au.Arguments=au.Array;var bo=rt,QE=function(t,r,s){return bo.f(t,r,s)},gD=Jt,ZE=QE,To=tt,YI=yr("species"),Zt=k,km=TypeError,R_=function(t,r){if(Zt(r,t))return t;throw km("Incorrect invocation")},XI=Me,Wb=Zd,I_=I(Function.toString);XI(Wb.inspectSource)||(Wb.inspectSource=function(t){return I_(t)});var A_=Wb.inspectSource,zb=I,JI=d,Gb=Me,QI=Cc,Hb=A_,ev=function(){},eo=[],Nc=Jt("Reflect","construct"),cu=/^\s*(?:class|function)\b/,ZI=zb(cu.exec),eA=!cu.exec(ev),Yo=function(t){if(!Gb(t))return!1;try{return Nc(ev,eo,t),!0}catch{return!1}},$b=function(t){if(!Gb(t))return!1;switch(QI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return eA||!!ZI(cu,Hb(t))}catch{return!0}};$b.sham=!0;var wa,Nm,Kb,tv,P_=!Nc||JI(function(){var t;return Yo(Yo.call)||!Yo(Object)||!Yo(function(){t=!0})||t})?$b:Yo,tA=P_,_D=yc,nv=TypeError,rv=dn,Dc=function(t){if(tA(t))return t;throw nv(_D(t)+" is not a constructor")},Or=Dt,Gs=yr("species"),Qi=function(t,r){var s,o=rv(t).constructor;return o===void 0||Or(s=rv(o)[Gs])?r:Dc(s)},gs=I([].slice),nc=TypeError,Sl=function(t,r){if(t<r)throw nc("Not enough arguments");return t},_s=/(?:ipad|iphone|ipod).*applewebkit/i.test(Hn),to=L,Kp=Q,iv=De,sv=Me,O_=vi,Xo=d,ov=h_,Dm=gs,lu=Zl,av=Sl,qb=_s,Eh=Dp,xm=to.setImmediate,uu=to.clearImmediate,cv=to.process,qp=to.Dispatch,Yb=to.Function,k_=to.MessageChannel,lv=to.String,no=0,xc={},Lc="onreadystatechange";Xo(function(){wa=to.location});var wo=function(t){if(O_(xc,t)){var r=xc[t];delete xc[t],r()}},uv=function(t){return function(){wo(t)}},dv=function(t){wo(t.data)},hv=function(t){to.postMessage(lv(t),wa.protocol+"//"+wa.host)};xm&&uu||(xm=function(t){av(arguments.length,1);var r=sv(t)?t:Yb(t),s=Dm(arguments,1);return xc[++no]=function(){Kp(r,void 0,s)},Nm(no),no},uu=function(t){delete xc[t]},Eh?Nm=function(t){cv.nextTick(uv(t))}:qp&&qp.now?Nm=function(t){qp.now(uv(t))}:k_&&!qb?(tv=(Kb=new k_).port2,Kb.port1.onmessage=dv,Nm=iv(tv.postMessage,tv)):to.addEventListener&&sv(to.postMessage)&&!to.importScripts&&wa&&wa.protocol!=="file:"&&!Xo(hv)?(Nm=hv,to.addEventListener("message",dv,!1)):Nm=Lc in lu("script")?function(t){ov.appendChild(lu("script"))[Lc]=function(){ov.removeChild(this),wo(t)}}:function(t){setTimeout(uv(t),0)});var pv={set:xm,clear:uu},gd=function(){this.head=null,this.tail=null};gd.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Yp,N_,_d,D_,vh,Xb=gd,nA=/ipad|iphone|ipod/i.test(Hn)&&typeof Pebble<"u",Jb=/web0s(?!.*chrome)/i.test(Hn),du=L,rA=De,yD=He.f,fv=pv.set,iA=Xb,Xp=_s,ED=nA,Lm=Jb,mv=Dp,Vi=du.MutationObserver||du.WebKitMutationObserver,sA=du.document,Qb=du.process,gv=du.Promise,oA=yD(du,"queueMicrotask"),_v=oA&&oA.value;if(!_v){var x_=new iA,yv=function(){var t,r;for(mv&&(t=Qb.domain)&&t.exit();r=x_.get();)try{r()}catch(s){throw x_.head&&Yp(),s}t&&t.enter()};Xp||mv||Lm||!Vi||!sA?!ED&&gv&&gv.resolve?((D_=gv.resolve(void 0)).constructor=gv,vh=rA(D_.then,D_),Yp=function(){vh(yv)}):mv?Yp=function(){Qb.nextTick(yv)}:(fv=rA(fv,du),Yp=function(){fv(yv)}):(N_=!0,_d=sA.createTextNode(""),new Vi(yv).observe(_d,{characterData:!0}),Yp=function(){_d.data=N_=!N_}),_v=function(t){x_.head||Yp(),x_.add(t)}}var rc=_v,Sh=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Jp=L.Promise,yd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Ev=!yd&&!Dp&&typeof window=="object"&&typeof document=="object",Qp=L,bh=Jp,Zb=Me,eT=ma,vD=A_,tT=yr,SD=Ev,aA=yd,vv=Ei,L_=bh&&bh.prototype,Sv=tT("species"),nT=Zb(Qp.PromiseRejectionEvent),rT=eT("Promise",function(){var t=vD(bh),r=t!==String(bh);if(!r&&vv===66||!L_.catch||!L_.finally)return!0;if(!vv||vv<51||!/native code/.test(t)){var s=new bh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[Sv]=o,!(s.then(function(){})instanceof o))return!0}return!r&&(SD||aA)&&!nT}),M_={CONSTRUCTOR:rT,REJECTION_EVENT:nT},bl={},bv=ds,Tv=TypeError,iT=function(t){var r,s;this.promise=new t(function(o,c){if(r!==void 0||s!==void 0)throw Tv("Bad Promise constructor");r=o,s=c}),this.resolve=bv(r),this.reject=bv(s)};bl.f=function(t){return new iT(t)};var Mm,sT,bD=Fn,Zp=Dp,Th=L,Ed=ve,TD=fd,wv=md,p=function(t){var r=gD(t);To&&r&&!r[YI]&&ZE(r,YI,{configurable:!0,get:function(){return this}})},g=ds,C=Me,O=_t,U=R_,H=Qi,ce=pv.set,Ae=rc,Le=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},st=Sh,At=Xb,Pt=pd,It=Jp,Kt=M_,tn=bl,nn="Promise",Zi=Kt.CONSTRUCTOR,Ze=Kt.REJECTION_EVENT,je=Pt.getterFor(nn),nt=Pt.set,xt=It&&It.prototype,rn=It,gn=xt,vn=Th.TypeError,Ln=Th.document,ys=Th.process,Rr=tn.f,wh=Rr,wD=!!(Ln&&Ln.createEvent&&Th.dispatchEvent),N3="unhandledrejection",D3=function(t){var r;return!(!O(t)||!C(r=t.then))&&r},x3=function(t,r){var s,o,c,u=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,T=t.domain;try{m?(h||(r.rejection===2&&jae(r),r.rejection=1),m===!0?s=u:(T&&T.enter(),s=m(u),T&&(T.exit(),c=!0)),s===t.promise?v(vn("Promise-chain cycle")):(o=D3(s))?Ed(o,s,y,v):y(s)):v(u)}catch(R){T&&!c&&T.exit(),v(R)}},L3=function(t,r){t.notified||(t.notified=!0,Ae(function(){for(var s,o=t.reactions;s=o.get();)x3(s,t);t.notified=!1,r&&!t.rejection&&Vae(t)}))},M3=function(t,r,s){var o,c;wD?((o=Ln.createEvent("Event")).promise=r,o.reason=s,o.initEvent(t,!1,!0),Th.dispatchEvent(o)):o={promise:r,reason:s},!Ze&&(c=Th["on"+t])?c(o):t===N3&&Le("Unhandled promise rejection",s)},Vae=function(t){Ed(ce,Th,function(){var r,s=t.facade,o=t.value;if(U3(t)&&(r=st(function(){Zp?ys.emit("unhandledRejection",o,s):M3(N3,s,o)}),t.rejection=Zp||U3(t)?2:1,r.error))throw r.value})},U3=function(t){return t.rejection!==1&&!t.parent},jae=function(t){Ed(ce,Th,function(){var r=t.facade;Zp?ys.emit("rejectionHandled",r):M3("rejectionhandled",r,t.value)})},Cv=function(t,r,s){return function(o){t(r,o,s)}},Rv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,L3(t,!0))},CD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw vn("Promise can't be resolved itself");var o=D3(r);o?Ae(function(){var c={done:!1};try{Ed(o,r,Cv(CD,c,t),Cv(Rv,c,t))}catch(u){Rv(c,u,t)}}):(t.value=r,t.state=1,L3(t,!1))}catch(c){Rv({done:!1},c,t)}}};Zi&&(gn=(rn=function(t){U(this,gn),g(t),Ed(Mm,this);var r=je(this);try{t(Cv(CD,r),Cv(Rv,r))}catch(s){Rv(r,s)}}).prototype,(Mm=function(t){nt(this,{type:nn,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=TD(gn,"then",function(t,r){var s=je(this),o=Rr(H(this,rn));return s.parent=!0,o.ok=!C(t)||t,o.fail=C(r)&&r,o.domain=Zp?ys.domain:void 0,s.state==0?s.reactions.add(o):Ae(function(){x3(o,s)}),o.promise}),sT=function(){var t=new Mm,r=je(t);this.promise=t,this.resolve=Cv(CD,r),this.reject=Cv(Rv,r)},tn.f=Rr=function(t){return t===rn||t===void 0?new sT(t):wh(t)}),bD({global:!0,wrap:!0,forced:Zi},{Promise:rn}),wv(rn,nn,!1,!0),p(nn);var V3=yr("iterator"),j3=!1;try{var Fae=0,F3={next:function(){return{done:!!Fae++}},return:function(){j3=!0}};F3[V3]=function(){return this},Array.from(F3,function(){throw 2})}catch{}var Bae=Jp,Wae=function(t,r){if(!j3)return!1;var s=!1;try{var o={};o[V3]=function(){return{next:function(){return{done:s=!0}}}},t(o)}catch{}return s},cA=M_.CONSTRUCTOR||!Wae(function(t){Bae.all(t).then(void 0,function(){})}),zae=ve,Gae=ds,Hae=bl,$ae=Sh,Kae=gh;Fn({target:"Promise",stat:!0,forced:cA},{all:function(t){var r=this,s=Hae.f(r),o=s.resolve,c=s.reject,u=$ae(function(){var h=Gae(r.resolve),m=[],y=0,v=1;Kae(t,function(T){var R=y++,P=!1;v++,zae(h,r,T).then(function(N){P||(P=!0,m[R]=N,--v||o(m))},c)}),--v||o(m)});return u.error&&c(u.value),s.promise}});var qae=Fn,Yae=M_.CONSTRUCTOR;Jp&&Jp.prototype,qae({target:"Promise",proto:!0,forced:Yae,real:!0},{catch:function(t){return this.then(void 0,t)}});var Xae=ve,Jae=ds,Qae=bl,Zae=Sh,ece=gh;Fn({target:"Promise",stat:!0,forced:cA},{race:function(t){var r=this,s=Qae.f(r),o=s.reject,c=Zae(function(){var u=Jae(r.resolve);ece(t,function(h){Xae(u,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var tce=ve,nce=bl;Fn({target:"Promise",stat:!0,forced:M_.CONSTRUCTOR},{reject:function(t){var r=nce.f(this);return tce(r.reject,void 0,t),r.promise}});var rce=dn,ice=_t,sce=bl,B3=function(t,r){if(rce(t),ice(r)&&r.constructor===t)return r;var s=sce.f(t);return(0,s.resolve)(r),s.promise},oce=Fn,ace=Jp,cce=M_.CONSTRUCTOR,lce=B3,uce=Jt("Promise"),dce=!cce;oce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return lce(dce&&this===uce?ace:this,t)}});var hce=ve,pce=ds,fce=bl,mce=Sh,gce=gh;Fn({target:"Promise",stat:!0,forced:cA},{allSettled:function(t){var r=this,s=fce.f(r),o=s.resolve,c=s.reject,u=mce(function(){var h=pce(r.resolve),m=[],y=0,v=1;gce(t,function(T){var R=y++,P=!1;v++,hce(h,r,T).then(function(N){P||(P=!0,m[R]={status:"fulfilled",value:N},--v||o(m))},function(N){P||(P=!0,m[R]={status:"rejected",reason:N},--v||o(m))})}),--v||o(m)});return u.error&&c(u.value),s.promise}});var _ce=ve,yce=ds,Ece=Jt,vce=bl,Sce=Sh,bce=gh,W3="No one promise resolved";Fn({target:"Promise",stat:!0,forced:cA},{any:function(t){var r=this,s=Ece("AggregateError"),o=vce.f(r),c=o.resolve,u=o.reject,h=Sce(function(){var m=yce(r.resolve),y=[],v=0,T=1,R=!1;bce(t,function(P){var N=v++,G=!1;T++,_ce(m,r,P).then(function(j){G||R||(R=!0,c(j))},function(j){G||R||(G=!0,y[N]=j,--T||u(new s(y,W3)))})}),--T||u(new s(y,W3))});return h.error&&u(h.value),o.promise}});var Tce=Fn,RD=Jp,wce=d,Cce=Jt,Rce=Me,Ice=Qi,z3=B3,Ace=RD&&RD.prototype;Tce({target:"Promise",proto:!0,real:!0,forced:!!RD&&wce(function(){Ace.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Ice(this,Cce("Promise")),s=Rce(t);return this.then(s?function(o){return z3(r,t()).then(function(){return o})}:t,s?function(o){return z3(r,t()).then(function(){throw o})}:t)}});var ID=I,Pce=wc,Oce=_a,kce=Qt,Nce=ID("".charAt),G3=ID("".charCodeAt),Dce=ID("".slice),H3=function(t){return function(r,s){var o,c,u=Oce(kce(r)),h=Pce(s),m=u.length;return h<0||h>=m?t?"":void 0:(o=G3(u,h))<55296||o>56319||h+1===m||(c=G3(u,h+1))<56320||c>57343?t?Nce(u,h):o:t?Dce(u,h,h+2):c-56320+(o-55296<<10)+65536}},AD={codeAt:H3(!1),charAt:H3(!0)},xce=AD.charAt,Lce=_a,$3=pd,Mce=qE,K3=YE,q3="String Iterator",Uce=$3.set,Vce=$3.getterFor(q3);Mce(String,"String",function(t){Uce(this,{type:q3,string:Lce(t),index:0})},function(){var t,r=Vce(this),s=r.string,o=r.index;return o>=s.length?K3(void 0,!0):(t=xce(s,o),r.index+=t.length,K3(t,!1))});var jce=vt.Promise,Fce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Bce=L,Wce=Cc,zce=zo,Y3=ph,X3=yr("toStringTag");for(var PD in Fce){var J3=Bce[PD],OD=J3&&J3.prototype;OD&&Wce(OD)!==X3&&zce(OD,X3,PD),Y3[PD]=Y3.Array}var Q3=jce,dt=l(Q3),Gce=Qa("Array").values,Hce=Cc,$ce=vi,Kce=k,qce=Gce,kD=Array.prototype,Yce={DOMTokenList:!0,NodeList:!0},Xce=function(t){var r=t.values;return t===kD||Kce(kD,t)&&r===kD.values||$ce(Yce,Hce(t))?qce:r},Mc=l(Xce),Jce=d,Qce=yr("iterator"),ND=!Jce(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),o="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Qce]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Zce=fd,ele=Xa,tle=rt,nle=Fe,lA=function(t,r,s){var o=ele(r);o in t?tle.f(t,o,nle(0,s)):t[o]=s},Z3=me,rle=hi,ile=lA,sle=Array,ole=Math.max,DD=function(t,r,s){for(var o=rle(t),c=Z3(r,o),u=Z3(s===void 0?o:s,o),h=sle(ole(u-c,0)),m=0;c<u;c++,m++)ile(h,m,t[c]);return h.length=m,h},e4=DD,ale=Math.floor,xD=function(t,r){var s=t.length,o=ale(s/2);return s<8?cle(t,r):lle(t,xD(e4(t,0,o),r),xD(e4(t,o),r),r)},cle=function(t,r){for(var s,o,c=t.length,u=1;u<c;){for(o=u,s=t[u];o&&r(t[o-1],s)>0;)t[o]=t[--o];o!==u++&&(t[o]=s)}return t},lle=function(t,r,s,o){for(var c=r.length,u=s.length,h=0,m=0;h<c||m<u;)t[h+m]=h<c&&m<u?o(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},t4=xD,LD=Fn,Iv=L,uA=ve,Ch=I,Av=tt,n4=ND,r4=fd,ule=QE,dle=function(t,r,s){for(var o in r)s&&s.unsafe&&t[o]?t[o]=r[o]:Zce(t,o,r[o],s);return t},hle=md,ple=GE,MD=pd,i4=R_,UD=Me,fle=vi,mle=De,gle=Cc,_le=dn,s4=_t,ic=_a,yle=$o,o4=Fe,VD=__,Ele=dd,Pv=Sl,vle=t4,Sle=yr("iterator"),oT="URLSearchParams",a4=oT+"Iterator",c4=MD.set,hu=MD.getterFor(oT),ble=MD.getterFor(a4),Tle=Object.getOwnPropertyDescriptor,jD=function(t){if(!Av)return Iv[t];var r=Tle(Iv,t);return r&&r.value},l4=jD("fetch"),dA=jD("Request"),aT=jD("Headers"),FD=dA&&dA.prototype,u4=aT&&aT.prototype,wle=Iv.RegExp,Cle=Iv.TypeError,d4=Iv.decodeURIComponent,Rle=Iv.encodeURIComponent,Ile=Ch("".charAt),h4=Ch([].join),U_=Ch([].push),BD=Ch("".replace),Ale=Ch([].shift),p4=Ch([].splice),f4=Ch("".split),Ple=Ch("".slice),Ole=/\+/g,m4=Array(4),kle=function(t){return m4[t-1]||(m4[t-1]=wle("((?:%[\\da-f]{2}){"+t+"})","gi"))},Nle=function(t){try{return d4(t)}catch{return t}},g4=function(t){var r=BD(t,Ole," "),s=4;try{return d4(r)}catch{for(;s;)r=BD(r,kle(s--),Nle);return r}},Dle=/[!'()~]|%20/g,xle={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Lle=function(t){return xle[t]},_4=function(t){return BD(Rle(t),Dle,Lle)},WD=ple(function(t,r){c4(this,{type:a4,iterator:VD(hu(t).entries),kind:r})},"Iterator",function(){var t=ble(this),r=t.kind,s=t.iterator.next(),o=s.value;return s.done||(s.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),s},!0),y4=function(t){this.entries=[],this.url=null,t!==void 0&&(s4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Ile(t,0)==="?"?Ple(t,1):t:ic(t)))};y4.prototype={type:oT,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,o,c,u,h,m,y=Ele(t);if(y)for(s=(r=VD(t,y)).next;!(o=uA(s,r)).done;){if(u=(c=VD(_le(o.value))).next,(h=uA(u,c)).done||(m=uA(u,c)).done||!uA(u,c).done)throw Cle("Expected sequence with length 2");U_(this.entries,{key:ic(h.value),value:ic(m.value)})}else for(var v in t)fle(t,v)&&U_(this.entries,{key:v,value:ic(t[v])})},parseQuery:function(t){if(t)for(var r,s,o=f4(t,"&"),c=0;c<o.length;)(r=o[c++]).length&&(s=f4(r,"="),U_(this.entries,{key:g4(Ale(s)),value:g4(h4(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],o=0;o<r.length;)t=r[o++],U_(s,_4(t.key)+"="+_4(t.value));return h4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var hA=function(){i4(this,Ov);var t=c4(this,new y4(arguments.length>0?arguments[0]:void 0));Av||(this.size=t.entries.length)},Ov=hA.prototype;if(dle(Ov,{append:function(t,r){var s=hu(this);Pv(arguments.length,2),U_(s.entries,{key:ic(t),value:ic(r)}),Av||this.length++,s.updateURL()},delete:function(t){for(var r=hu(this),s=Pv(arguments.length,1),o=r.entries,c=ic(t),u=s<2?void 0:arguments[1],h=u===void 0?u:ic(u),m=0;m<o.length;){var y=o[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(p4(o,m,1),h!==void 0)break}Av||(this.size=o.length),r.updateURL()},get:function(t){var r=hu(this).entries;Pv(arguments.length,1);for(var s=ic(t),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(t){var r=hu(this).entries;Pv(arguments.length,1);for(var s=ic(t),o=[],c=0;c<r.length;c++)r[c].key===s&&U_(o,r[c].value);return o},has:function(t){for(var r=hu(this).entries,s=Pv(arguments.length,1),o=ic(t),c=s<2?void 0:arguments[1],u=c===void 0?c:ic(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var s=hu(this);Pv(arguments.length,1);for(var o,c=s.entries,u=!1,h=ic(t),m=ic(r),y=0;y<c.length;y++)(o=c[y]).key===h&&(u?p4(c,y--,1):(u=!0,o.value=m));u||U_(c,{key:h,value:m}),Av||(this.size=c.length),s.updateURL()},sort:function(){var t=hu(this);vle(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=hu(this).entries,o=mle(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new WD(this,"keys")},values:function(){return new WD(this,"values")},entries:function(){return new WD(this,"entries")}},{enumerable:!0}),r4(Ov,Sle,Ov.entries,{}),r4(Ov,"toString",function(){return hu(this).serialize()},{enumerable:!0}),Av&&ule(Ov,"size",{get:function(){return hu(this).entries.length},configurable:!0,enumerable:!0}),hle(hA,oT),LD({global:!0,forced:!n4},{URLSearchParams:hA}),!n4&&UD(aT)){var Mle=Ch(u4.has),Ule=Ch(u4.set),E4=function(t){if(s4(t)){var r,s=t.body;if(gle(s)===oT)return r=t.headers?new aT(t.headers):new aT,Mle(r,"content-type")||Ule(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),yle(t,{body:o4(0,ic(s)),headers:o4(0,r)})}return t};if(UD(l4)&&LD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return l4(t,arguments.length>1?E4(arguments[1]):{})}}),UD(dA)){var zD=function(t){return i4(this,FD),new dA(t,arguments.length>1?E4(arguments[1]):{})};FD.constructor=zD,zD.prototype=FD,LD({global:!0,dontCallGetSet:!0,forced:!0},{Request:zD})}}var pu,Vle={URLSearchParams:hA,getState:hu},jle=vt.URLSearchParams,v4=tt,Fle=I,Ble=ve,Wle=d,GD=Ac,zle=Ic,Gle=Be,Hle=xo,$le=Vt,kv=Object.assign,S4=Object.defineProperty,Kle=Fle([].concat),qle=!kv||Wle(function(){if(v4&&kv({b:1},kv(S4({},"a",{enumerable:!0,get:function(){S4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),o="abcdefghijklmnopqrst";return t[s]=7,o.split("").forEach(function(c){r[c]=c}),kv({},t)[s]!=7||GD(kv({},r)).join("")!=o})?function(t,r){for(var s=Hle(t),o=arguments.length,c=1,u=zle.f,h=Gle.f;o>c;)for(var m,y=$le(arguments[c++]),v=u?Kle(GD(y),u(y)):GD(y),T=v.length,R=0;T>R;)m=v[R++],v4&&!Ble(h,y,m)||(s[m]=y[m]);return s}:kv,Yle=dn,Xle=y_,Jle=De,Qle=ve,Zle=xo,eue=function(t,r,s,o){try{return o?r(Yle(s)[0],s[1]):r(s)}catch(c){Xle(t,"throw",c)}},tue=g_,nue=P_,rue=hi,b4=lA,iue=__,sue=dd,T4=Array,V_=I,HD=2147483647,oue=/[^\0-\u007E]/,w4=/[.\u3002\uFF0E\uFF61]/g,C4="Overflow: input needs wider integers to process",R4=RangeError,aue=V_(w4.exec),Nv=Math.floor,$D=String.fromCharCode,I4=V_("".charCodeAt),A4=V_([].join),Um=V_([].push),cue=V_("".replace),lue=V_("".split),uue=V_("".toLowerCase),P4=function(t){return t+22+75*(t<26)},due=function(t,r,s){var o=0;for(t=s?Nv(t/700):t>>1,t+=Nv(t/r);t>455;)t=Nv(t/35),o+=36;return Nv(o+36*t/(t+38))},hue=function(t){var r=[];t=function(Y){for(var X=[],ue=0,ye=Y.length;ue<ye;){var Se=I4(Y,ue++);if(Se>=55296&&Se<=56319&&ue<ye){var _e=I4(Y,ue++);(64512&_e)==56320?Um(X,((1023&Se)<<10)+(1023&_e)+65536):(Um(X,Se),ue--)}else Um(X,Se)}return X}(t);var s,o,c=t.length,u=128,h=0,m=72;for(s=0;s<t.length;s++)(o=t[s])<128&&Um(r,$D(o));var y=r.length,v=y;for(y&&Um(r,"-");v<c;){var T=HD;for(s=0;s<t.length;s++)(o=t[s])>=u&&o<T&&(T=o);var R=v+1;if(T-u>Nv((HD-h)/R))throw R4(C4);for(h+=(T-u)*R,u=T,s=0;s<t.length;s++){if((o=t[s])<u&&++h>HD)throw R4(C4);if(o==u){for(var P=h,N=36;;){var G=N<=m?1:N>=m+26?26:N-m;if(P<G)break;var j=P-G,W=36-G;Um(r,$D(P4(G+j%W))),P=Nv(j/W),N+=36}Um(r,$D(P4(P))),m=due(h,R,v==y),h=0,v++}}h++,u++}return A4(r,"")},pue=Fn,KD=tt,fue=ND,qD=L,O4=De,fu=I,pA=fd,mu=QE,mue=R_,YD=vi,XD=qle,Dv=function(t){var r=Zle(t),s=nue(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Jle(c,o>2?arguments[2]:void 0));var h,m,y,v,T,R,P=sue(r),N=0;if(!P||this===T4&&tue(P))for(h=rue(r),m=s?new this(h):T4(h);h>N;N++)R=u?c(r[N],N):r[N],b4(m,N,R);else for(T=(v=iue(r,P)).next,m=s?new this:[];!(y=Qle(T,v)).done;N++)R=u?eue(v,c,[y.value,N],!0):y.value,b4(m,N,R);return m.length=N,m},vd=DD,gue=AD.codeAt,_ue=function(t){var r,s,o=[],c=lue(cue(uue(t),w4,"."),".");for(r=0;r<c.length;r++)s=c[r],Um(o,aue(oue,s)?"xn--"+hue(s):s);return A4(o,".")},ef=_a,yue=md,Eue=Sl,k4=Vle,N4=pd,vue=N4.set,fA=N4.getterFor("URL"),Sue=k4.URLSearchParams,bue=k4.getState,cT=qD.URL,JD=qD.TypeError,mA=qD.parseInt,Tue=Math.floor,D4=Math.pow,gu=fu("".charAt),Sd=fu(/./.exec),lT=fu([].join),wue=fu(1 .toString),Cue=fu([].pop),xv=fu([].push),QD=fu("".replace),Rue=fu([].shift),Iue=fu("".split),uT=fu("".slice),gA=fu("".toLowerCase),Aue=fu([].unshift),ZD="Invalid scheme",j_="Invalid host",x4="Invalid port",L4=/[a-z]/i,Pue=/[\d+-.a-z]/i,ex=/\d/,Oue=/^0x/i,kue=/^[0-7]+$/,Nue=/^\d+$/,M4=/^[\da-f]+$/i,Due=/[\0\t\n\r #%/:<>?@[\\\]^|]/,xue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Lue=/^[\u0000-\u0020]+/,Mue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Uue=/[\t\n\r]/g,dT=function(t){var r,s,o,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Aue(r,t%256),t=Tue(t/256);return lT(r,".")}if(typeof t=="object"){for(r="",o=function(u){for(var h=null,m=1,y=null,v=0,T=0;T<8;T++)u[T]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=T),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=wue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},_A={},U4=XD({},_A,{" ":1,'"':1,"<":1,">":1,"`":1}),V4=XD({},U4,{"#":1,"?":1,"{":1,"}":1}),tx=XD({},V4,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Vm=function(t,r){var s=gue(t,0);return s>32&&s<127&&!YD(r,t)?t:encodeURIComponent(t)},yA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hT=function(t,r){var s;return t.length==2&&Sd(L4,gu(t,0))&&((s=gu(t,1))==":"||!r&&s=="|")},j4=function(t){var r;return t.length>1&&hT(uT(t,0,2))&&(t.length==2||(r=gu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Vue=function(t){return t==="."||gA(t)==="%2e"},nx={},F4={},rx={},B4={},W4={},ix={},z4={},G4={},EA={},vA={},sx={},ox={},ax={},cx={},H4={},lx={},Lv={},Rh={},$4={},F_={},tf={},ux=function(t,r,s){var o,c,u,h=ef(t);if(r){if(c=this.parse(h))throw JD(c);this.searchParams=null}else{if(s!==void 0&&(o=new ux(s,!0)),c=this.parse(h,null,o))throw JD(c);(u=bue(new Sue)).bindURL(this),this.searchParams=u}};ux.prototype={type:"URL",parse:function(t,r,s){var o,c,u,h,m,y=this,v=r||nx,T=0,R="",P=!1,N=!1,G=!1;for(t=ef(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=QD(t,Lue,""),t=QD(t,Mue,"$1")),t=QD(t,Uue,""),o=Dv(t);T<=o.length;){switch(c=o[T],v){case nx:if(!c||!Sd(L4,c)){if(r)return ZD;v=rx;continue}R+=gA(c),v=F4;break;case F4:if(c&&(Sd(Pue,c)||c=="+"||c=="-"||c=="."))R+=gA(c);else{if(c!=":"){if(r)return ZD;R="",v=rx,T=0;continue}if(r&&(y.isSpecial()!=YD(yA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&yA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=cx:y.isSpecial()&&s&&s.scheme==y.scheme?v=B4:y.isSpecial()?v=G4:o[T+1]=="/"?(v=W4,T++):(y.cannotBeABaseURL=!0,xv(y.path,""),v=$4)}break;case rx:if(!s||s.cannotBeABaseURL&&c!="#")return ZD;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=vd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=tf;break}v=s.scheme=="file"?cx:ix;continue;case B4:if(c!="/"||o[T+1]!="/"){v=ix;continue}v=EA,T++;break;case W4:if(c=="/"){v=vA;break}v=Rh;continue;case ix:if(y.scheme=s.scheme,c==pu)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=z4;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.query="",v=F_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.path.length--,v=Rh;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.query=s.query,y.fragment="",v=tf}break;case z4:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=Rh;continue}v=vA}else v=EA;break;case G4:if(v=EA,c!="/"||gu(R,T+1)!="/")continue;T++;break;case EA:if(c!="/"&&c!="\\"){v=vA;continue}break;case vA:if(c=="@"){P&&(R="%40"+R),P=!0,u=Dv(R);for(var j=0;j<u.length;j++){var W=u[j];if(W!=":"||G){var Y=Vm(W,tx);G?y.password+=Y:y.username+=Y}else G=!0}R=""}else if(c==pu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";T-=Dv(R).length+1,R="",v=sx}else R+=c;break;case sx:case ox:if(r&&y.scheme=="file"){v=lx;continue}if(c!=":"||N){if(c==pu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return j_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=Lv,r)return;continue}c=="["?N=!0:c=="]"&&(N=!1),R+=c}else{if(R=="")return j_;if(h=y.parseHost(R))return h;if(R="",v=ax,r==ox)return}break;case ax:if(!Sd(ex,c)){if(c==pu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var X=mA(R,10);if(X>65535)return x4;y.port=y.isSpecial()&&X===yA[y.scheme]?null:X,R=""}if(r)return;v=Lv;continue}return x4}R+=c;break;case cx:if(y.scheme="file",c=="/"||c=="\\")v=H4;else{if(!s||s.scheme!="file"){v=Rh;continue}if(c==pu)y.host=s.host,y.path=vd(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=vd(s.path),y.query="",v=F_;else{if(c!="#"){j4(lT(vd(o,T),""))||(y.host=s.host,y.path=vd(s.path),y.shortenPath()),v=Rh;continue}y.host=s.host,y.path=vd(s.path),y.query=s.query,y.fragment="",v=tf}}break;case H4:if(c=="/"||c=="\\"){v=lx;break}s&&s.scheme=="file"&&!j4(lT(vd(o,T),""))&&(hT(s.path[0],!0)?xv(y.path,s.path[0]):y.host=s.host),v=Rh;continue;case lx:if(c==pu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&hT(R))v=Rh;else if(R==""){if(y.host="",r)return;v=Lv}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=Lv}continue}R+=c;break;case Lv:if(y.isSpecial()){if(v=Rh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=pu&&(v=Rh,c!="/"))continue}else y.fragment="",v=tf;else y.query="",v=F_;break;case Rh:if(c==pu||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=gA(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||xv(y.path,"")):Vue(R)?c=="/"||c=="\\"&&y.isSpecial()||xv(y.path,""):(y.scheme=="file"&&!y.path.length&&hT(R)&&(y.host&&(y.host=""),R=gu(R,0)+":"),xv(y.path,R)),R="",y.scheme=="file"&&(c==pu||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)Rue(y.path);c=="?"?(y.query="",v=F_):c=="#"&&(y.fragment="",v=tf)}else R+=Vm(c,V4);break;case $4:c=="?"?(y.query="",v=F_):c=="#"?(y.fragment="",v=tf):c!=pu&&(y.path[0]+=Vm(c,_A));break;case F_:r||c!="#"?c!=pu&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":Vm(c,_A)):(y.fragment="",v=tf);break;case tf:c!=pu&&(y.fragment+=Vm(c,U4))}T++}},parseHost:function(t){var r,s,o;if(gu(t,0)=="["){if(gu(t,t.length-1)!="]"||(r=function(c){var u,h,m,y,v,T,R,P=[0,0,0,0,0,0,0,0],N=0,G=null,j=0,W=function(){return gu(c,j)};if(W()==":"){if(gu(c,1)!=":")return;j+=2,G=++N}for(;W();){if(N==8)return;if(W()!=":"){for(u=h=0;h<4&&Sd(M4,W());)u=16*u+mA(W(),16),j++,h++;if(W()=="."){if(h==0||(j-=h,N>6))return;for(m=0;W();){if(y=null,m>0){if(!(W()=="."&&m<4))return;j++}if(!Sd(ex,W()))return;for(;Sd(ex,W());){if(v=mA(W(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;j++}P[N]=256*P[N]+y,++m!=2&&m!=4||N++}if(m!=4)return;break}if(W()==":"){if(j++,!W())return}else if(W())return;P[N++]=u}else{if(G!==null)return;j++,G=++N}}if(G!==null)for(T=N-G,N=7;N!=0&&T>0;)R=P[N],P[N--]=P[G+T-1],P[G+--T]=R;else if(N!=8)return;return P}(uT(t,1,-1)),!r))return j_;this.host=r}else if(this.isSpecial()){if(t=_ue(t),Sd(Due,t)||(r=function(c){var u,h,m,y,v,T,R,P=Iue(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((y=P[m])=="")return c;if(v=10,y.length>1&&gu(y,0)=="0"&&(v=Sd(Oue,y)?16:8,y=uT(y,v==8?1:2)),y==="")T=0;else{if(!Sd(v==10?Nue:v==8?kue:M4,y))return c;T=mA(y,v)}xv(h,T)}for(m=0;m<u;m++)if(T=h[m],m==u-1){if(T>=D4(256,5-u))return null}else if(T>255)return null;for(R=Cue(h),m=0;m<h.length;m++)R+=h[m]*D4(256,3-m);return R}(t),r===null))return j_;this.host=r}else{if(Sd(xue,t))return j_;for(r="",s=Dv(t),o=0;o<s.length;o++)r+=Vm(s[o],_A);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return YD(yA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&hT(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,o=t.password,c=t.host,u=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(o?":"+o:"")+"@"),v+=dT(c),u!==null&&(v+=":"+u)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+lT(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw JD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Mv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+dT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(ef(t)+":",nx)},getUsername:function(){return this.username},setUsername:function(t){var r=Dv(ef(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Vm(r[s],tx)}},getPassword:function(){return this.password},setPassword:function(t){var r=Dv(ef(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Vm(r[s],tx)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?dT(t):dT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,sx)},getHostname:function(){var t=this.host;return t===null?"":dT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,ox)},getPort:function(){var t=this.port;return t===null?"":ef(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=ef(t))==""?this.port=null:this.parse(t,ax))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+lT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Lv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=ef(t))==""?this.query=null:(gu(t,0)=="?"&&(t=uT(t,1)),this.query="",this.parse(t,F_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=ef(t))!=""?(gu(t,0)=="#"&&(t=uT(t,1)),this.fragment="",this.parse(t,tf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Mv=function(t){var r=mue(this,sc),s=Eue(arguments.length,1)>1?arguments[1]:void 0,o=vue(r,new ux(t,!1,s));KD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},sc=Mv.prototype,_u=function(t,r){return{get:function(){return fA(this)[t]()},set:r&&function(s){return fA(this)[r](s)},configurable:!0,enumerable:!0}};if(KD&&(mu(sc,"href",_u("serialize","setHref")),mu(sc,"origin",_u("getOrigin")),mu(sc,"protocol",_u("getProtocol","setProtocol")),mu(sc,"username",_u("getUsername","setUsername")),mu(sc,"password",_u("getPassword","setPassword")),mu(sc,"host",_u("getHost","setHost")),mu(sc,"hostname",_u("getHostname","setHostname")),mu(sc,"port",_u("getPort","setPort")),mu(sc,"pathname",_u("getPathname","setPathname")),mu(sc,"search",_u("getSearch","setSearch")),mu(sc,"searchParams",_u("getSearchParams")),mu(sc,"hash",_u("getHash","setHash"))),pA(sc,"toJSON",function(){return fA(this).serialize()},{enumerable:!0}),pA(sc,"toString",function(){return fA(this).serialize()},{enumerable:!0}),cT){var K4=cT.createObjectURL,q4=cT.revokeObjectURL;K4&&pA(Mv,"createObjectURL",O4(K4,cT)),q4&&pA(Mv,"revokeObjectURL",O4(q4,cT))}yue(Mv,"URL"),pue({global:!0,forced:!fue,sham:!KD},{URL:Mv});var jue=Fn,Fue=d,Bue=Sl,Y4=_a,Wue=ND,X4=Jt("URL");jue({target:"URL",stat:!0,forced:!(Wue&&Fue(function(){X4.canParse()}))},{canParse:function(t){var r=Bue(arguments.length,1),s=Y4(t),o=r<2||arguments[1]===void 0?void 0:Y4(arguments[1]);try{return!!new X4(s,o)}catch{return!1}}});var SA=l(vt.URL);let J4=!0,Q4=!0;function bA(t,r,s){const o=t.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function B_(t,r,s){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const T=s(v);T&&(m.handleEvent?m.handleEvent(T):m(T))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,y])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function zue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(J4=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Gue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Q4=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Z4(){if(typeof window=="object"){if(J4)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function dx(t,r){Q4&&console.warn(t+" is deprecated, please use "+r+" instead.")}function eB(t){return Object.prototype.toString.call(t)==="[object Object]"}function tB(t){var r;return eB(t)?Za(r=Object.keys(t)).call(r,function(s,o){const c=eB(t[o]),u=c?tB(t[o]):t[o],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[o]:u})},{}):t}function hx(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?hx(t,t.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{hx(t,t.get(c),s)})}))}function nB(t,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(m=>{m.type===o&&m.trackId===h.id&&hx(t,m,c)})}),c}const rB=Z4;function iB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const T=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[T("min",y)]=v.ideal,m.optional.push(R),R={},R[T("max",y)]=v.ideal,m.optional.push(R)):(R[T("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[T("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[T(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,T,R){T in v&&!(R in v)&&(v[R]=v[T],delete v[T])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let T;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?T=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(T=["front"]),T)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(N=>N.kind==="videoinput")).find(N=>T.some(G=>{var j;return at(j=N.label.toLowerCase()).call(j,G)}));return!P&&R.length&&at(T).call(T,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),rB("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return rB("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,T=>{y&&y(u(T))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(T=>{T.stop()}),new DOMException("","NotFoundError");return v},v=>dt.reject(u(v))))}}}function sB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function oB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else B_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function aB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function cB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const y={};return m.result().forEach(v=>{const T={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{T[R]=v.stat(R)}),y[T.id]=T}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){o(h(u(y)))};return r.apply(this,[m,s])}return new dt((m,y)=>{r.apply(this,[function(v){m(h(u(v)))},y])}).then(o,c)}}function lB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>nB(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),B_(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>nB(c,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===s&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||o&&c?dt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():dt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function uB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(y=>{if(this.getSenders().find(T=>T.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function dB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return uB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}o.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function u(y,v){let T=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],N=y._streams[P.id];T=T.replace(new RegExp(N.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:T})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const T=[].slice.call(arguments,1);if(T.length!==1||!T[0].getTracks().find(N=>N===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(N=>N.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(y),dt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const N=new t.MediaStream([y]);this._streams[v.id]=N,this._reverseStreams[N.id]=v,this.addStream(N)}return this.getSenders().find(N=>N.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],T={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[P=>{const N=u(this,P);R[0].apply(null,[N])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):v.apply(this,arguments).then(P=>u(this,P))}};t.RTCPeerConnection.prototype[y]=T[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let T=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],N=y._streams[P.id];T=T.replace(new RegExp(P.id,"g"),N.id)}),new RTCSessionDescription({type:v.type,sdp:T})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:u(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(R=>y.track===R)&&(v=this._streams[T])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function px(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function hB(t,r){B_(t,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var pB=Object.freeze({__proto__:null,fixNegotiationNeeded:hB,shimAddTrackRemoveTrack:dB,shimAddTrackRemoveTrackWithNative:uB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:aB,shimGetStats:cB,shimGetUserMedia:iB,shimMediaStream:sB,shimOnTrack:oB,shimPeerConnection:px,shimSenderReceiverGetStats:lB});function fB(t,r){const s=t&&t.navigator,o=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){dx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function mB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function fx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,T)=>{m.set(T,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(u,h)}}function gB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):dt.resolve(new Map)}}function _B(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),B_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function yB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){dx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&at(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function EB(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function vB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function SB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function bB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function TB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var wB=Object.freeze({__proto__:null,shimAddTransceiver:vB,shimCreateAnswer:TB,shimCreateOffer:bB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,dt.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:SB,shimGetUserMedia:fB,shimOnTrack:mB,shimPeerConnection:fx,shimRTCDataChannel:EB,shimReceiverGetStats:_B,shimRemoveStream:yB,shimSenderGetStats:gB});function CB(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),at(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?at(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{at(o).call(o,c.track)&&this.removeTrack(c)})})}}function RB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),at(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function IB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const T=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[T]);return v?(R.then(y,v),dt.resolve()):R},r.createAnswer=function(y,v){const T=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[T]);return v?(R.then(y,v),dt.resolve()):R};let m=function(y,v,T){const R=c.apply(this,[y]);return T?(R.then(v,T),dt.resolve()):R};r.setLocalDescription=m,m=function(y,v,T){const R=u.apply(this,[y]);return T?(R.then(v,T),dt.resolve()):R},r.setRemoteDescription=m,m=function(y,v,T){const R=h.apply(this,[y]);return T?(R.then(v,T),dt.resolve()):R},r.addIceCandidate=m}function AB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(PB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function PB(t){return t&&t.video!==void 0?Object.assign({},t,{video:tB(t.video)}):t}function OB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(dx("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function kB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function NB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function DB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var xB=Object.freeze({__proto__:null,shimAudioContext:DB,shimCallbacksAPI:IB,shimConstraints:PB,shimCreateOfferLegacy:NB,shimGetUserMedia:AB,shimLocalStreamsAPI:CB,shimRTCIceServerUrls:OB,shimRemoteStreamsAPI:RB,shimTrackEventTransceiver:kB}),LB=`	
\v\f\r \u2028\u2029\uFEFF`,Hue=Qt,$ue=_a,mx=LB,MB=I("".replace),Kue=RegExp("^["+mx+"]+"),que=RegExp("(^|[^"+mx+"])["+mx+"]+$"),Yue=function(t){return function(r){var s=$ue(Hue(r));return 1&t&&(s=MB(s,Kue,"")),2&t&&(s=MB(s,que,"$1")),s}},Xue={trim:Yue(3)},Jue=PI.PROPER,Que=d,UB=LB,Zue=Xue.trim;Fn({target:"String",proto:!0,forced:function(t){return Que(function(){return!!UB[t]()||""[t]()!==""||Jue&&UB[t].name!==t})}("trim")},{trim:function(){return Zue(this)}});var ede=Qa("String").trim,tde=k,nde=ede,gx=String.prototype,rde=function(t){var r=t.trim;return typeof t=="string"||t===gx||tde(gx,t)&&r===gx.trim?nde:r},ro=l(rde),VB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const u=s.type;return o.push("typ"),o.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},u=s.indexOf(":",o);return u>-1?(c.attribute=s.substring(o+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],u=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),T=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=T.length?r.parseFmtp(T[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const T=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(N=>parseInt(N,10)));T.length>0&&T[0].length>1&&T[0][0]===y&&(v=T[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let N={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&v&&(N.rtx={ssrc:v}),o.push(N),u&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},o.push(N))}}),o.length===0&&y&&o.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let u;const h=o!==void 0?o:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(VB);var jB=VB.exports,Uv=l(jB),ide=i({__proto__:null,default:Uv},[jB]);function TA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=Uv.parseCandidate(s.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,B_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function _x(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||B_(t,"icecandidate",r=>{if(r.candidate){const s=Uv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function wA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=Uv.splitSections(m.sdp);return y.shift(),y.some(v=>{const T=Uv.parseMLine(v);return T&&T.kind==="application"&&T.protocol.indexOf("SCTP")!==-1})},o=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},u=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const T=Uv.matchPrefix(m.sdp,"a=max-message-size:");return T.length>0?v=parseInt(T[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),y=c(m),v=u(arguments[0],m);let T;T=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>T}),this._sctp=R}return h.apply(this,arguments)}}function CA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},B_(t,"datachannel",o=>(r(o.channel,o.target),o))}function yx(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function Ex(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>ro(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function RA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?dt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dt.resolve())})}function IA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var sde=Object.freeze({__proto__:null,removeExtmapAllowMixed:Ex,shimAddIceCandidateNullOrEmpty:RA,shimConnectionState:yx,shimMaxMessageSize:wA,shimParameterlessSetLocalDescription:IA,shimRTCIceCandidate:TA,shimRTCIceCandidateRelayProtocol:_x,shimSendThrowTypeError:CA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=Z4,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=bA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=bA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=bA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:o,commonShim:sde,extractVersion:bA,disableLog:zue,disableWarnings:Gue,sdp:ide};switch(o.browser){case"chrome":if(!pB||!px||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=pB,RA(t,o),IA(t),iB(t,o),sB(t),px(t,o),oB(t),dB(t,o),aB(t),cB(t),lB(t),hB(t,o),TA(t),_x(t),yx(t),wA(t,o),CA(t),Ex(t,o);break;case"firefox":if(!wB||!fx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=wB,RA(t,o),IA(t),fB(t,o),fx(t,o),mB(t),yB(t),gB(t),_B(t),EB(t),vB(t),SB(t),bB(t),TB(t),TA(t),yx(t),wA(t,o),CA(t);break;case"safari":if(!xB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=xB,RA(t,o),IA(t),OB(t),NB(t),IB(t),CB(t),RB(t),kB(t),AB(t),DB(t),TA(t),_x(t),wA(t,o),CA(t),Ex(t,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var FB=yc,ode=TypeError,BB=Hn.match(/firefox\/(\d+)/i),ade=!!BB&&+BB[1],cde=/MSIE|Trident/.test(Hn),WB=Hn.match(/AppleWebKit\/(\d+)\./),lde=!!WB&&+WB[1],ude=Fn,zB=I,dde=ds,hde=xo,GB=hi,pde=function(t,r){if(!delete t[r])throw ode("Cannot delete property "+FB(r)+" of "+FB(t))},HB=_a,vx=d,fde=t4,mde=Np,$B=ade,gde=cde,KB=Ei,qB=lde,jm=[],YB=zB(jm.sort),_de=zB(jm.push),yde=vx(function(){jm.sort(void 0)}),Ede=vx(function(){jm.sort(null)}),vde=mde("sort"),XB=!vx(function(){if(KB)return KB<70;if(!($B&&$B>3)){if(gde)return!0;if(qB)return qB<603;var t,r,s,o,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)jm.push({k:r+o,v:s})}for(jm.sort(function(u,h){return h.v-u.v}),o=0;o<jm.length;o++)r=jm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});ude({target:"Array",proto:!0,forced:yde||!Ede||!vde||!XB},{sort:function(t){t!==void 0&&dde(t);var r=hde(this);if(XB)return t===void 0?YB(r):YB(r,t);var s,o,c=[],u=GB(r);for(o=0;o<u;o++)o in r&&_de(c,r[o]);for(fde(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:HB(m)>HB(y)?1:-1}}(t)),s=GB(c),o=0;o<s;)r[o]=c[o++];for(;o<u;)pde(r,o++);return r}});var Sde=Qa("Array").sort,bde=k,Tde=Sde,Sx=Array.prototype,wde=function(t){var r=t.sort;return t===Sx||bde(Sx,t)&&r===Sx.sort?Tde:r},pT=l(wde),bx=L;Fn({global:!0,forced:bx.globalThis!==bx},{globalThis:bx});var JB=l(L),Tx={exports:{}};(function(t,r){(function(s,o){var c="function",u="undefined",h="object",m="string",y="major",v="model",T="name",R="type",P="vendor",N="version",G="architecture",j="console",W="mobile",Y="tablet",X="smarttv",ue="wearable",ye="embedded",Se="Amazon",_e="Apple",Ne="ASUS",Je="BlackBerry",ht="Browser",ft="Chrome",Sn="Firefox",bn="Google",fr="Huawei",ci="LG",Yr="Microsoft",ra="Motorola",We="Opera",ot="Samsung",bt="Sharp",Ge="Sony",M="Xiaomi",se="Zebra",de="Facebook",et="Chromium OS",qt="Mac OS",sr=function(Ri){for(var zi={},Ir=0;Ir<Ri.length;Ir++)zi[Ri[Ir].toUpperCase()]=Ri[Ir];return zi},Wi=function(Ri,zi){return typeof Ri===m&&Oa(zi).indexOf(Oa(Ri))!==-1},Oa=function(Ri){return Ri.toLowerCase()},Ef=function(Ri,zi){if(typeof Ri===m)return Ri=Ri.replace(/^\s\s*/,""),typeof zi===u?Ri:Ri.substring(0,350)},yy=function(Ri,zi){for(var Ir,cc,Hh,li,zn,ka,ag=0;ag<zi.length&&!zn;){var Ld=zi[ag],wK=zi[ag+1];for(Ir=cc=0;Ir<Ld.length&&!zn&&Ld[Ir];)if(zn=Ld[Ir++].exec(Ri))for(Hh=0;Hh<wK.length;Hh++)ka=zn[++cc],typeof(li=wK[Hh])===h&&li.length>0?li.length===2?typeof li[1]==c?this[li[0]]=li[1].call(this,ka):this[li[0]]=li[1]:li.length===3?typeof li[1]!==c||li[1].exec&&li[1].test?this[li[0]]=ka?ka.replace(li[1],li[2]):o:this[li[0]]=ka?li[1].call(this,ka,li[2]):o:li.length===4&&(this[li[0]]=ka?li[3].call(this,ka.replace(li[1],li[2])):o):this[li]=ka||o;ag+=2}},gw=function(Ri,zi){for(var Ir in zi)if(typeof zi[Ir]===h&&zi[Ir].length>0){for(var cc=0;cc<zi[Ir].length;cc++)if(Wi(zi[Ir][cc],Ri))return Ir==="?"?o:Ir}else if(Wi(zi[Ir],Ri))return Ir==="?"?o:Ir;return Ri},w1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},C1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[T,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[T,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[T,N],[/opios[\/ ]+([\w\.]+)/i],[N,[T,We+" Mini"]],[/\bopr\/([\w\.]+)/i],[N,[T,We]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[T,N],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[T,"UC"+ht]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[N,[T,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[N,[T,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[T,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[T,"IE"]],[/yabrowser\/([\w\.]+)/i],[N,[T,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[T,/(.+)/,"$1 Secure "+ht],N],[/\bfocus\/([\w\.]+)/i],[N,[T,Sn+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[T,We+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[T,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[T,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[T,We+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[T,"MIUI "+ht]],[/fxios\/([-\w\.]+)/i],[N,[T,Sn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[T,"360 "+ht]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[T,/(.+)/,"$1 "+ht],N],[/(comodo_dragon)\/([\w\.]+)/i],[[T,/_/g," "],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[T,N],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[T],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[T,de],N],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[T,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[T,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[T,ft+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[T,ft+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[T,"Android "+ht]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[T,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[T,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,T],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[T,[N,gw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[T,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[T,"Netscape"],N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[T,Sn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[T,N],[/(cobalt)\/([\w\.]+)/i],[T,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Oa]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Oa]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Oa]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[P,ot],[R,Y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[P,ot],[R,W]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[P,_e],[R,W]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[P,_e],[R,Y]],[/(macintosh);/i],[v,[P,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[P,bt],[R,W]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[P,fr],[R,Y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[P,fr],[R,W]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,W]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,Y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[P,"OPPO"],[R,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[P,"Vivo"],[R,W]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[P,"Realme"],[R,W]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[P,ra],[R,W]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[P,ra],[R,Y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[P,ci],[R,Y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[P,ci],[R,W]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[P,"Lenovo"],[R,Y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[P,"Nokia"],[R,W]],[/(pixel c)\b/i],[v,[P,bn],[R,Y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[P,bn],[R,W]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[P,Ge],[R,W]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[P,Ge],[R,Y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[P,"OnePlus"],[R,W]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[P,Se],[R,Y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[P,Se],[R,W]],[/(playbook);[-\w\),; ]+(rim)/i],[v,P,[R,Y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[P,Je],[R,W]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[P,Ne],[R,Y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[P,Ne],[R,W]],[/(nexus 9)/i],[v,[P,"HTC"],[R,Y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[v,/_/g," "],[R,W]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[P,"Acer"],[R,Y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[P,"Meizu"],[R,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,v,[R,W]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,v,[R,Y]],[/(surface duo)/i],[v,[P,Yr],[R,Y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[P,"Fairphone"],[R,W]],[/(u304aa)/i],[v,[P,"AT&T"],[R,W]],[/\bsie-(\w*)/i],[v,[P,"Siemens"],[R,W]],[/\b(rct\w+) b/i],[v,[P,"RCA"],[R,Y]],[/\b(venue[\d ]{2,7}) b/i],[v,[P,"Dell"],[R,Y]],[/\b(q(?:mv|ta)\w+) b/i],[v,[P,"Verizon"],[R,Y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[P,"Barnes & Noble"],[R,Y]],[/\b(tm\d{3}\w+) b/i],[v,[P,"NuVision"],[R,Y]],[/\b(k88) b/i],[v,[P,"ZTE"],[R,Y]],[/\b(nx\d{3}j) b/i],[v,[P,"ZTE"],[R,W]],[/\b(gen\d{3}) b.+49h/i],[v,[P,"Swiss"],[R,W]],[/\b(zur\d{3}) b/i],[v,[P,"Swiss"],[R,Y]],[/\b((zeki)?tb.*\b) b/i],[v,[P,"Zeki"],[R,Y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],v,[R,Y]],[/\b(ns-?\w{0,9}) b/i],[v,[P,"Insignia"],[R,Y]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[P,"NextBook"],[R,Y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],v,[R,W]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],v,[R,W]],[/\b(ph-1) /i],[v,[P,"Essential"],[R,W]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[P,"Envizen"],[R,Y]],[/\b(trio[-\w\. ]+) b/i],[v,[P,"MachSpeed"],[R,Y]],[/\btu_(1491) b/i],[v,[P,"Rotor"],[R,Y]],[/(shield[\w ]+) b/i],[v,[P,"Nvidia"],[R,Y]],[/(sprint) (\w+)/i],[P,v,[R,W]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[P,Yr],[R,W]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[P,se],[R,Y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[P,se],[R,W]],[/smart-tv.+(samsung)/i],[P,[R,X]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[P,ot],[R,X]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ci],[R,X]],[/(apple) ?tv/i],[P,[v,_e+" TV"],[R,X]],[/crkey/i],[[v,ft+"cast"],[P,bn],[R,X]],[/droid.+aft(\w)( bui|\))/i],[v,[P,Se],[R,X]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[P,bt],[R,X]],[/(bravia[\w ]+)( bui|\))/i],[v,[P,Ge],[R,X]],[/(mitv-\w{5}) bui/i],[v,[P,M],[R,X]],[/Hbbtv.*(technisat) (.*);/i],[P,v,[R,X]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,Ef],[v,Ef],[R,X]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,X]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,v,[R,j]],[/droid.+; (shield) bui/i],[v,[P,"Nvidia"],[R,j]],[/(playstation [345portablevi]+)/i],[v,[P,Ge],[R,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[P,Yr],[R,j]],[/((pebble))app/i],[P,v,[R,ue]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[P,_e],[R,ue]],[/droid.+; (glass) \d/i],[v,[P,bn],[R,ue]],[/droid.+; (wt63?0{2,3})\)/i],[v,[P,se],[R,ue]],[/(quest( 2| pro)?)/i],[v,[P,de],[R,ue]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,Y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,Y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,W]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[T,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[T,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[T,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,T]],os:[[/microsoft (windows) (vista|xp)/i],[T,N],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[T,[N,gw,w1]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,"Windows"],[N,gw,w1]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[T,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[T,qt],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,T],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[T,N],[/\(bb(10);/i],[N,[T,Je]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[T,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[T,Sn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[T,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[T,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[T,ft+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[T,et],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[T,N],[/(sunos) ?([\w\.\d]*)/i],[[T,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[T,N]]},Dl=function(Ri,zi){if(typeof Ri===h&&(zi=Ri,Ri=o),!(this instanceof Dl))return new Dl(Ri,zi).getResult();var Ir=typeof s!==u&&s.navigator?s.navigator:o,cc=Ri||(Ir&&Ir.userAgent?Ir.userAgent:""),Hh=Ir&&Ir.userAgentData?Ir.userAgentData:o,li=zi?function(zn,ka){var ag={};for(var Ld in zn)ka[Ld]&&ka[Ld].length%2==0?ag[Ld]=ka[Ld].concat(zn[Ld]):ag[Ld]=zn[Ld];return ag}(C1,zi):C1;return this.getBrowser=function(){var zn={};return zn[T]=o,zn[N]=o,yy.call(zn,cc,li.browser),zn[y]=function(ka){return typeof ka===m?ka.replace(/[^\d\.]/g,"").split(".")[0]:o}(zn[N]),Ir&&Ir.brave&&typeof Ir.brave.isBrave==c&&(zn[T]="Brave"),zn},this.getCPU=function(){var zn={};return zn[G]=o,yy.call(zn,cc,li.cpu),zn},this.getDevice=function(){var zn={};return zn[P]=o,zn[v]=o,zn[R]=o,yy.call(zn,cc,li.device),!zn[R]&&Hh&&Hh.mobile&&(zn[R]=W),zn[v]=="Macintosh"&&Ir&&typeof Ir.standalone!==u&&Ir.maxTouchPoints&&Ir.maxTouchPoints>2&&(zn[v]="iPad",zn[R]=Y),zn},this.getEngine=function(){var zn={};return zn[T]=o,zn[N]=o,yy.call(zn,cc,li.engine),zn},this.getOS=function(){var zn={};return zn[T]=o,zn[N]=o,yy.call(zn,cc,li.os),!zn[T]&&Hh&&Hh.platform!="Unknown"&&(zn[T]=Hh.platform.replace(/chrome os/i,et).replace(/macos/i,qt)),zn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return cc},this.setUA=function(zn){return cc=typeof zn===m&&zn.length>350?Ef(zn,350):zn,this},this.setUA(cc),this};Dl.VERSION="0.7.34",Dl.BROWSER=sr([T,N,y]),Dl.CPU=sr([G]),Dl.DEVICE=sr([v,P,R,j,W,X,Y,ue,ye]),Dl.ENGINE=Dl.OS=sr([T,N]),t.exports&&(r=t.exports=Dl),r.UAParser=Dl;var og=typeof s!==u&&(s.jQuery||s.Zepto);if(og&&!og.ua){var Ey=new Dl;og.ua=Ey.getResult(),og.ua.get=function(){return Ey.getUA()},og.ua.set=function(Ri){Ey.setUA(Ri);var zi=Ey.getResult();for(var Ir in zi)og.ua[Ir]=zi[Ir]}}})(typeof window=="object"?window:a)})(Tx,Tx.exports);var Cde=l(Tx.exports),Rde=Cc,Ide=vi,Ade=Dt,Pde=ph,Ode=yr("iterator"),kde=Object,Nde=function(t){if(Ade(t))return!1;var r=kde(t);return r[Ode]!==void 0||"@@iterator"in r||Ide(Pde,Rde(r))},Dde=l(Nde),QB=pv.clear;Fn({global:!0,bind:!0,forced:L.clearImmediate!==QB},{clearImmediate:QB});var xde=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",ZB=L,Lde=Q,Mde=Me,Ude=xde,Vde=Hn,jde=gs,Fde=Sl,Bde=ZB.Function,Wde=/MSIE .\./.test(Vde)||Ude&&function(){var t=ZB.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),zde=Fn,e6=L,t6=pv.set,Gde=function(t,r){var s=1;return Wde?function(o,c){var u=Fde(arguments.length,1)>s,h=Mde(o)?o:Bde(o),m=u?jde(arguments,s):[],y=u?function(){Lde(h,this,m)}:h;return t(y)}:t},n6=e6.setImmediate?Gde(t6):t6;zde({global:!0,bind:!0,forced:e6.setImmediate!==n6},{setImmediate:n6});var r6=l(vt.setImmediate),Hde=Fn,$de=rc,Kde=ds,qde=Sl,Yde=Dp,Xde=L.process;Hde({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){qde(arguments.length,1),Kde(t);var r=Yde&&Xde.domain;$de(r?r.bind(t):t)}});var i6=l(vt.queueMicrotask);function s6(t,r){return function(){return t.apply(r,arguments)}}const{toString:Jde}=Object.prototype,{getPrototypeOf:wx}=Object,AA=(Cx=Object.create(null),t=>{const r=Jde.call(t);return Cx[r]||(Cx[r]=r.slice(8,-1).toLowerCase())});var Cx;const bd=t=>(t=t.toLowerCase(),r=>AA(r)===t),PA=t=>r=>typeof r===t,{isArray:Vv}=Array,fT=PA("undefined"),o6=bd("ArrayBuffer"),Qde=PA("string"),Tl=PA("function"),a6=PA("number"),OA=t=>t!==null&&typeof t=="object",kA=t=>{if(AA(t)!=="object")return!1;const r=wx(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Dde(t))},Zde=bd("Date"),ehe=bd("File"),the=bd("Blob"),nhe=bd("FileList"),rhe=bd("URLSearchParams"),[ihe,she,ohe,ahe]=["ReadableStream","Request","Response","Headers"].map(bd);function mT(t,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Vv(t))for(s=0,o=t.length;s<o;s++)r.call(null,t[s],s,t);else{const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,t[m],m,t)}}function c6(t,r){r=r.toLowerCase();const s=Object.keys(t);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const W_=JB!==void 0?JB:typeof self<"u"?self:typeof window<"u"?window:Iy,l6=t=>!fT(t)&&t!==W_,che=(Rx=typeof Uint8Array<"u"&&wx(Uint8Array),t=>Rx&&t instanceof Rx);var Rx;const lhe=bd("HTMLFormElement"),u6=(t=>{let{hasOwnProperty:r}=t;return(s,o)=>r.call(s,o)})(Object.prototype),uhe=bd("RegExp"),d6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),o={};mT(s,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(o[u]=h||c)}),Object.defineProperties(t,o)},Ix="abcdefghijklmnopqrstuvwxyz",h6="0123456789",p6={DIGIT:h6,ALPHA:Ix,ALPHA_DIGIT:Ix+Ix.toUpperCase()+h6},dhe=bd("AsyncFunction"),f6=(m6=typeof r6=="function",g6=Tl(W_.postMessage),m6?r6:g6?(Ax="axios@".concat(Math.random()),NA=[],W_.addEventListener("message",t=>{let{source:r,data:s}=t;r===W_&&s===Ax&&NA.length&&NA.shift()()},!1),t=>{NA.push(t),W_.postMessage(Ax,"*")}):t=>setTimeout(t));var m6,g6,Ax,NA;const hhe=i6!==void 0?i6.bind(W_):typeof process<"u"&&process.nextTick||f6;var ut={isArray:Vv,isArrayBuffer:o6,isBuffer:function(t){return t!==null&&!fT(t)&&t.constructor!==null&&!fT(t.constructor)&&Tl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Tl(t.append)&&((r=AA(t))==="formdata"||r==="object"&&Tl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&o6(t.buffer),r},isString:Qde,isNumber:a6,isBoolean:t=>t===!0||t===!1,isObject:OA,isPlainObject:kA,isReadableStream:ihe,isRequest:she,isResponse:ohe,isHeaders:ahe,isUndefined:fT,isDate:Zde,isFile:ehe,isBlob:the,isRegExp:uhe,isFunction:Tl,isStream:t=>OA(t)&&Tl(t.pipe),isURLSearchParams:rhe,isTypedArray:che,isFileList:nhe,forEach:mT,merge:function t(){const{caseless:r}=l6(this)&&this||{},s={},o=(c,u)=>{const h=r&&c6(s,u)||u;kA(s[h])&&kA(c)?s[h]=t(s[h],c):kA(c)?s[h]=t({},c):Vv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&mT(arguments[c],o);return s},extend:function(t,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return mT(r,(c,u)=>{s&&Tl(c)?t[u]=s6(c,s):t[u]=c},{allOwnKeys:o}),t},trim:t=>ro(t)?ro(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,o)=>{t.prototype=Object.create(r.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,o)=>{let c,u,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],o&&!o(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&wx(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:AA,kindOfTest:bd,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const o=t.indexOf(r,s);return o!==-1&&o===s},toArray:t=>{if(!t)return null;if(Vv(t))return t;let r=t.length;if(!a6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const o=[];for(;(s=t.exec(r))!==null;)o.push(s);return o},isHTMLForm:lhe,hasOwnProperty:u6,hasOwnProp:u6,reduceDescriptors:d6,freezeMethods:t=>{d6(t,(r,s)=>{if(Tl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=t[s];Tl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},o=c=>{c.forEach(u=>{s[u]=!0})};return Vv(t)?o(t):o(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:c6,global:W_,isContextDefined:l6,ALPHABET:p6,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p6.ALPHA_DIGIT,s="";const{length:o}=r;for(;t--;)s+=r[Math.random()*o|0];return s},isSpecCompliantForm:function(t){return!!(t&&Tl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(o,c)=>{if(OA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=Vv(o)?[]:{};return mT(o,(h,m)=>{const y=s(h,c+1);!fT(y)&&(u[m]=y)}),r[c]=void 0,u}}return o};return s(t,0)},isAsyncFn:dhe,isThenable:t=>t&&(OA(t)||Tl(t))&&Tl(t.then)&&Tl(t.catch),setImmediate:f6,asap:hhe};function rr(t,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ut.inherits(rr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ut.toJSONObject(this.config),code:this.code,status:this.status}}});const _6=rr.prototype,y6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{y6[t]={value:t}}),Object.defineProperties(rr,y6),Object.defineProperty(_6,"isAxiosError",{value:!0}),rr.from=(t,r,s,o,c,u)=>{const h=Object.create(_6);return ut.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),rr.call(h,t.message,r,s,o,c),h.cause=t,h.name=t.name,u&&Object.assign(h,u),h};function Px(t){return ut.isPlainObject(t)||ut.isArray(t)}function E6(t){return ut.endsWith(t,"[]")?t.slice(0,-2):t}function v6(t,r,s){return t?t.concat(r).map(function(o,c){return o=E6(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const phe=ut.toFlatObject(ut,{},null,function(t){return/^is[A-Z]/.test(t)});function DA(t,r,s){if(!ut.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=ut.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,N){return!ut.isUndefined(N[P])})).metaTokens,c=s.visitor||v,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ut.isSpecCompliantForm(r);if(!ut.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(ut.isDate(P))return P.toISOString();if(!m&&ut.isBlob(P))throw new rr("Blob is not supported. Use a Buffer instead.");return ut.isArrayBuffer(P)||ut.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function v(P,N,G){let j=P;if(P&&!G&&typeof P=="object"){if(ut.endsWith(N,"{}"))N=o?N:N.slice(0,-2),P=JSON.stringify(P);else if(ut.isArray(P)&&function(W){return ut.isArray(W)&&!W.some(Px)}(P)||(ut.isFileList(P)||ut.endsWith(N,"[]"))&&(j=ut.toArray(P)))return N=E6(N),j.forEach(function(W,Y){!ut.isUndefined(W)&&W!==null&&r.append(h===!0?v6([N],Y,u):h===null?N:N+"[]",y(W))}),!1}return!!Px(P)||(r.append(v6(G,N,u),y(P)),!1)}const T=[],R=Object.assign(phe,{defaultVisitor:v,convertValue:y,isVisitable:Px});if(!ut.isObject(t))throw new TypeError("data must be an object");return function P(N,G){if(!ut.isUndefined(N)){if(T.indexOf(N)!==-1)throw Error("Circular reference detected in "+G.join("."));T.push(N),ut.forEach(N,function(j,W){(!(ut.isUndefined(j)||j===null)&&c.call(r,j,ut.isString(W)?ro(W).call(W):W,G,R))===!0&&P(j,G?G.concat(W):[W])}),T.pop()}}(t),r}function S6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function Ox(t,r){this._pairs=[],t&&DA(t,this,r)}const b6=Ox.prototype;function fhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function T6(t,r,s){if(!r)return t;const o=s&&s.encode||fhe;ut.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):ut.isURLSearchParams(r)?r.toString():new Ox(r,s).toString(o),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}b6.append=function(t,r){this._pairs.push([t,r])},b6.toString=function(t){const r=t?function(s){return t.call(this,s,S6)}:S6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var w6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ut.forEach(this.handlers,function(r){r!==null&&t(r)})}},C6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},R6={exports:{}},mhe=Fn,ghe=tt,I6=rt.f;mhe({target:"Object",stat:!0,forced:Object.defineProperty!==I6,sham:!ghe},{defineProperty:I6});var A6=vt.Object,_he=R6.exports=function(t,r,s){return A6.defineProperty(t,r,s)};A6.defineProperty.sham&&(_he.sham=!0);var P6=l(R6.exports),yhe=TypeError,O6=o_,Ehe=P_,vhe=_t,She=yr("species"),k6=Array,bhe=function(t){var r;return O6(t)&&(r=t.constructor,(Ehe(r)&&(r===k6||O6(r.prototype))||vhe(r)&&(r=r[She])===null)&&(r=void 0)),r===void 0?k6:r},N6=function(t,r){return new(bhe(t))(r===0?0:r)},The=d,whe=Ei,Che=yr("species"),D6=function(t){return whe>=51||!The(function(){var r=[];return(r.constructor={})[Che]=function(){return{foo:1}},r[t](Boolean).foo!==1})},Rhe=Fn,Ihe=d,Ahe=o_,Phe=_t,Ohe=xo,khe=hi,x6=function(t){if(t>9007199254740991)throw yhe("Maximum allowed index exceeded");return t},L6=lA,Nhe=N6,Dhe=D6,xhe=Ei,M6=yr("isConcatSpreadable"),Lhe=xhe>=51||!Ihe(function(){var t=[];return t[M6]=!1,t.concat()[0]!==t}),Mhe=function(t){if(!Phe(t))return!1;var r=t[M6];return r!==void 0?!!r:Ahe(t)};Rhe({target:"Array",proto:!0,forced:!Lhe||!Dhe("concat")},{concat:function(t){var r,s,o,c,u,h=Ohe(this),m=Nhe(h,0),y=0;for(r=-1,o=arguments.length;r<o;r++)if(Mhe(u=r===-1?h:arguments[r]))for(c=khe(u),x6(y+c),s=0;s<c;s++,y++)s in u&&L6(m,y,u[s]);else x6(y+1),L6(m,y++,u);return m.length=y,m}});var U6={},Uhe=Z,Vhe=Ce,V6=uh.f,jhe=DD,j6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];U6.f=function(t){return j6&&Uhe(t)=="Window"?function(r){try{return V6(r)}catch{return jhe(j6)}}(t):V6(Vhe(t))};var jv={},Fhe=yr;jv.f=Fhe;var F6=vt,Bhe=vi,Whe=jv,zhe=rt.f,Es=function(t){var r=F6.Symbol||(F6.Symbol={});Bhe(r,t)||zhe(r,t,{value:Whe.f(t)})},Ghe=ve,Hhe=Jt,$he=yr,Khe=fd,B6=function(){var t=Hhe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,o=$he("toPrimitive");r&&!r[o]&&Khe(r,o,function(c){return Ghe(s,this)},{})},qhe=De,Yhe=Vt,Xhe=xo,Jhe=hi,Qhe=N6,W6=I([].push),Zhe=function(t){var r=t==1,s=t==2,o=t==3,c=t==4,u=t==6,h=t==7,m=t==5||u;return function(y,v,T,R){for(var P,N,G=Xhe(y),j=Yhe(G),W=qhe(v,T),Y=Jhe(j),X=0,ue=R||Qhe,ye=r?ue(y,Y):s||h?ue(y,0):void 0;Y>X;X++)if((m||X in j)&&(N=W(P=j[X],X,G),t))if(r)ye[X]=N;else if(N)switch(t){case 3:return!0;case 5:return P;case 6:return X;case 2:W6(ye,P)}else switch(t){case 4:return!1;case 7:W6(ye,P)}return u?-1:o||c?c:ye}},z6={forEach:Zhe(0)},xA=Fn,kx=L,Nx=ve,epe=I,Fv=tt,Bv=yo,tpe=d,Co=vi,npe=k,Dx=dn,LA=Ce,xx=Xa,rpe=_a,Lx=Fe,gT=$o,G6=Ac,ipe=uh,H6=U6,spe=Ic,$6=He,K6=rt,ope=RE,q6=Be,Y6=fd,ape=QE,Mx=qa,X6=Rc,J6=rh,cpe=yr,lpe=jv,upe=Es,dpe=B6,hpe=md,Q6=pd,MA=z6.forEach,Uc=c_("hidden"),UA="Symbol",_T="prototype",ppe=Q6.set,Z6=Q6.getterFor(UA),Td=Object[_T],z_=kx.Symbol,VA=z_&&z_[_T],fpe=kx.TypeError,Ux=kx.QObject,e8=$6.f,G_=K6.f,t8=H6.f,mpe=q6.f,n8=epe([].push),nf=Mx("symbols"),yT=Mx("op-symbols"),gpe=Mx("wks"),Vx=!Ux||!Ux[_T]||!Ux[_T].findChild,jx=Fv&&tpe(function(){return gT(G_({},"a",{get:function(){return G_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var o=e8(Td,r);o&&delete Td[r],G_(t,r,s),o&&t!==Td&&G_(Td,r,o)}:G_,Fx=function(t,r){var s=nf[t]=gT(VA);return ppe(s,{type:UA,tag:t,description:r}),Fv||(s.description=r),s},jA=function(t,r,s){t===Td&&jA(yT,r,s),Dx(t);var o=xx(r);return Dx(s),Co(nf,o)?(s.enumerable?(Co(t,Uc)&&t[Uc][o]&&(t[Uc][o]=!1),s=gT(s,{enumerable:Lx(0,!1)})):(Co(t,Uc)||G_(t,Uc,Lx(1,{})),t[Uc][o]=!0),jx(t,o,s)):G_(t,o,s)},Bx=function(t,r){Dx(t);var s=LA(r),o=G6(s).concat(o8(s));return MA(o,function(c){Fv&&!Nx(r8,s,c)||jA(t,c,s[c])}),t},r8=function(t){var r=xx(t),s=Nx(mpe,this,r);return!(this===Td&&Co(nf,r)&&!Co(yT,r))&&(!(s||!Co(this,r)||!Co(nf,r)||Co(this,Uc)&&this[Uc][r])||s)},i8=function(t,r){var s=LA(t),o=xx(r);if(s!==Td||!Co(nf,o)||Co(yT,o)){var c=e8(s,o);return!c||!Co(nf,o)||Co(s,Uc)&&s[Uc][o]||(c.enumerable=!0),c}},s8=function(t){var r=t8(LA(t)),s=[];return MA(r,function(o){Co(nf,o)||Co(X6,o)||n8(s,o)}),s},o8=function(t){var r=t===Td,s=t8(r?yT:LA(t)),o=[];return MA(s,function(c){!Co(nf,c)||r&&!Co(Td,c)||n8(o,nf[c])}),o};Bv||(z_=function(){if(npe(VA,this))throw fpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?rpe(arguments[0]):void 0,r=J6(t),s=function(o){this===Td&&Nx(s,yT,o),Co(this,Uc)&&Co(this[Uc],r)&&(this[Uc][r]=!1),jx(this,r,Lx(1,o))};return Fv&&Vx&&jx(Td,r,{configurable:!0,set:s}),Fx(r,t)},Y6(VA=z_[_T],"toString",function(){return Z6(this).tag}),Y6(z_,"withoutSetter",function(t){return Fx(J6(t),t)}),q6.f=r8,K6.f=jA,ope.f=Bx,$6.f=i8,ipe.f=H6.f=s8,spe.f=o8,lpe.f=function(t){return Fx(cpe(t),t)},Fv&&ape(VA,"description",{configurable:!0,get:function(){return Z6(this).description}})),xA({global:!0,wrap:!0,forced:!Bv,sham:!Bv},{Symbol:z_}),MA(G6(gpe),function(t){upe(t)}),xA({target:UA,stat:!0,forced:!Bv},{useSetter:function(){Vx=!0},useSimple:function(){Vx=!1}}),xA({target:"Object",stat:!0,forced:!Bv,sham:!Fv},{create:function(t,r){return r===void 0?gT(t):Bx(gT(t),r)},defineProperty:jA,defineProperties:Bx,getOwnPropertyDescriptor:i8}),xA({target:"Object",stat:!0,forced:!Bv},{getOwnPropertyNames:s8}),dpe(),hpe(z_,UA),X6[Uc]=!0;var a8=yo&&!!Symbol.for&&!!Symbol.keyFor,_pe=Fn,ype=Jt,Epe=vi,vpe=_a,c8=qa,Spe=a8,Wx=c8("string-to-symbol-registry"),bpe=c8("symbol-to-string-registry");_pe({target:"Symbol",stat:!0,forced:!Spe},{for:function(t){var r=vpe(t);if(Epe(Wx,r))return Wx[r];var s=ype("Symbol")(r);return Wx[r]=s,bpe[s]=r,s}});var Tpe=Fn,wpe=vi,Cpe=hl,Rpe=yc,Ipe=a8,l8=qa("symbol-to-string-registry");Tpe({target:"Symbol",stat:!0,forced:!Ipe},{keyFor:function(t){if(!Cpe(t))throw TypeError(Rpe(t)+" is not a symbol");if(wpe(l8,t))return l8[t]}});var u8=o_,Ape=Me,d8=Z,Ppe=_a,h8=I([].push),Ope=Fn,p8=Jt,f8=Q,kpe=ve,ET=I,m8=d,g8=Me,_8=hl,y8=gs,Npe=function(t){if(Ape(t))return t;if(u8(t)){for(var r=t.length,s=[],o=0;o<r;o++){var c=t[o];typeof c=="string"?h8(s,c):typeof c!="number"&&d8(c)!="Number"&&d8(c)!="String"||h8(s,Ppe(c))}var u=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(u8(this))return y;for(var v=0;v<u;v++)if(s[v]===m)return y}}},Dpe=yo,xpe=String,Fm=p8("JSON","stringify"),FA=ET(/./.exec),E8=ET("".charAt),Lpe=ET("".charCodeAt),Mpe=ET("".replace),Upe=ET(1 .toString),Vpe=/[\uD800-\uDFFF]/g,v8=/^[\uD800-\uDBFF]$/,S8=/^[\uDC00-\uDFFF]$/,b8=!Dpe||m8(function(){var t=p8("Symbol")();return Fm([t])!="[null]"||Fm({a:t})!="{}"||Fm(Object(t))!="{}"}),T8=m8(function(){return Fm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Fm("\uDEAD")!=='"\\udead"'}),jpe=function(t,r){var s=y8(arguments),o=Npe(r);if(g8(o)||t!==void 0&&!_8(t))return s[1]=function(c,u){if(g8(o)&&(u=kpe(o,this,xpe(c),u)),!_8(u))return u},f8(Fm,null,s)},Fpe=function(t,r,s){var o=E8(s,r-1),c=E8(s,r+1);return FA(v8,t)&&!FA(S8,c)||FA(S8,t)&&!FA(v8,o)?"\\u"+Upe(Lpe(t,0),16):t};Fm&&Ope({target:"JSON",stat:!0,forced:b8||T8},{stringify:function(t,r,s){var o=y8(arguments),c=f8(b8?jpe:Fm,null,o);return T8&&typeof c=="string"?Mpe(c,Vpe,Fpe):c}});var w8=Ic,Bpe=xo;Fn({target:"Object",stat:!0,forced:!yo||d(function(){w8.f(1)})},{getOwnPropertySymbols:function(t){var r=w8.f;return r?r(Bpe(t)):[]}}),Es("asyncIterator"),Es("hasInstance"),Es("isConcatSpreadable"),Es("iterator"),Es("match"),Es("matchAll"),Es("replace"),Es("search"),Es("species"),Es("split");var Wpe=B6;Es("toPrimitive"),Wpe();var zpe=Jt,Gpe=md;Es("toStringTag"),Gpe(zpe("Symbol"),"Symbol"),Es("unscopables"),md(L.JSON,"JSON",!0);var Hpe=vt.Symbol,$pe=yr,Kpe=rt.f,C8=$pe("metadata"),R8=Function.prototype;R8[C8]===void 0&&Kpe(R8,C8,{value:null}),Es("dispose"),Es("metadata");var qpe=Hpe;Es("asyncDispose");var Ype=I,zx=Jt("Symbol"),Xpe=zx.keyFor,Jpe=Ype(zx.prototype.valueOf),I8=zx.isRegisteredSymbol||function(t){try{return Xpe(Jpe(t))!==void 0}catch{return!1}};Fn({target:"Symbol",stat:!0},{isRegisteredSymbol:I8});for(var Qpe=qa,A8=Jt,Zpe=I,efe=hl,tfe=yr,BA=A8("Symbol"),P8=BA.isWellKnownSymbol,O8=A8("Object","getOwnPropertyNames"),nfe=Zpe(BA.prototype.valueOf),k8=Qpe("wks"),Gx=0,N8=O8(BA),rfe=N8.length;Gx<rfe;Gx++)try{var D8=N8[Gx];efe(BA[D8])&&tfe(D8)}catch{}var x8=function(t){if(P8&&P8(t))return!0;try{for(var r=nfe(t),s=0,o=O8(k8),c=o.length;s<c;s++)if(k8[o[s]]==r)return!0}catch{}return!1};Fn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:x8}),Es("matcher"),Es("observable"),Fn({target:"Symbol",stat:!0},{isRegistered:I8}),Fn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:x8}),Es("metadataKey"),Es("patternMatch"),Es("replaceAll");var Wv=l(qpe),L8=l(jv.f("iterator"));function vT(t){return vT=typeof Wv=="function"&&typeof L8=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Wv=="function"&&r.constructor===Wv&&r!==Wv.prototype?"symbol":typeof r},vT(t)}var ife=l(jv.f("toPrimitive"));function sfe(t){var r=function(s,o){if(vT(s)!=="object"||s===null)return s;var c=s[ife];if(c!==void 0){var u=c.call(s,o);if(vT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(t,"string");return vT(r)==="symbol"?r:String(r)}function K(t,r,s){return(r=sfe(r))in t?P6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var M8=l(jle),ofe={isBrowser:!0,classes:{URLSearchParams:M8!==void 0?M8:Ox,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Hx=typeof window<"u"&&typeof document<"u",$x=typeof navigator=="object"&&navigator||void 0,afe=Hx&&(!$x||["ReactNative","NativeScript","NS"].indexOf($x.product)<0),cfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lfe=Hx&&window.location.href||"http://localhost";function U8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function V8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?U8(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):U8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var Ca=V8(V8({},Object.freeze({__proto__:null,hasBrowserEnv:Hx,hasStandardBrowserEnv:afe,hasStandardBrowserWebWorkerEnv:cfe,navigator:$x,origin:lfe})),ofe),ufe=dn,dfe=ve,hfe=vi,pfe=k,ffe=function(){var t=ufe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},j8=RegExp.prototype,F8=function(t){var r=t.flags;return r!==void 0||"flags"in j8||hfe(t,"flags")||!pfe(j8,t)?r:dfe(ffe,t)},mfe=AD.charAt,B8=ve,gfe=dn,_fe=Me,yfe=Z,Efe=/./.exec,vfe=TypeError,Sfe=Fn,W8=ve,z8=oe,bfe=GE,WA=YE,G8=Qt,H8=Ut,ST=_a,Tfe=dn,wfe=Dt,Cfe=Z,Rfe=zR,$8=F8,Ife=Ec,Afe=d,Pfe=Qi,Ofe=function(t,r,s){return r+(s?mfe(t,r).length:1)},kfe=function(t,r){var s=t.exec;if(_fe(s)){var o=B8(s,t,r);return o!==null&&gfe(o),o}if(yfe(t)==="RegExp")return B8(Efe,t,r);throw vfe("RegExp#exec called on incompatible receiver")},K8=pd,Nfe=yr("matchAll"),q8="RegExp String",Y8=q8+" Iterator",Dfe=K8.set,xfe=K8.getterFor(Y8),Lfe=TypeError,Kx=z8("".indexOf),zA=z8("".matchAll),qx=!!zA&&!Afe(function(){zA("a",/./)}),Mfe=bfe(function(t,r,s,o){Dfe(this,{type:Y8,regexp:t,string:r,global:s,unicode:o,done:!1})},q8,function(){var t=xfe(this);if(t.done)return WA(void 0,!0);var r=t.regexp,s=t.string,o=kfe(r,s);return o===null?(t.done=!0,WA(void 0,!0)):t.global?(ST(o[0])===""&&(r.lastIndex=Ofe(s,H8(r.lastIndex),t.unicode)),WA(o,!1)):(t.done=!0,WA(o,!1))}),X8=function(t){var r,s,o,c=Tfe(this),u=ST(t),h=Pfe(c,RegExp),m=ST($8(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Kx(m,"g"),o=!!~Kx(m,"u"),r.lastIndex=H8(c.lastIndex),new Mfe(r,u,s,o)};Sfe({target:"String",proto:!0,forced:qx},{matchAll:function(t){var r,s,o,c,u=G8(this);if(wfe(t)){if(qx)return zA(u,t)}else{if(Rfe(t)&&(r=ST(G8($8(t))),!~Kx(r,"g")))throw Lfe("`.matchAll` does not allow non-global regexes");if(qx)return zA(u,t);if((o=Ife(t,Nfe))===void 0&&Cfe(t)=="RegExp"&&(o=X8),o)return W8(o,t,u)}return s=ST(u),c=new RegExp(t,"g"),W8(X8,c,s)}});var Ufe=Qa("String").matchAll,Vfe=k,jfe=Ufe,Yx=String.prototype,Ffe=function(t){var r=t.matchAll;return typeof t=="string"||t===Yx||Vfe(Yx,t)&&r===Yx.matchAll?jfe:r},Bfe=l(Ffe);function J8(t){function r(s,o,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=u>=s.length;return h=!h&&ut.isArray(c)?c.length:h,y?(ut.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ut.isObject(c[h])||(c[h]=[]),r(s,o,c[h],u)&&ut.isArray(c[h])&&(c[h]=function(v){const T={},R=Object.keys(v);let P;const N=R.length;let G;for(P=0;P<N;P++)G=R[P],T[G]=v[G];return T}(c[h])),!m)}if(ut.isFormData(t)&&ut.isFunction(t.entries)){const s={};return ut.forEachEntry(t,(o,c)=>{r(function(u){return Bfe(ut).call(ut,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const Xx={transitional:C6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=ut.isObject(t);if(c&&ut.isHTMLForm(t)&&(t=new FormData(t)),ut.isFormData(t))return o?JSON.stringify(J8(t)):t;if(ut.isArrayBuffer(t)||ut.isBuffer(t)||ut.isStream(t)||ut.isFile(t)||ut.isBlob(t)||ut.isReadableStream(t))return t;if(ut.isArrayBufferView(t))return t.buffer;if(ut.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return DA(h,new Ca.classes.URLSearchParams,Object.assign({visitor:function(y,v,T,R){return Ca.isNode&&ut.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((u=ut.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return DA(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,y){if(ut.isString(h))try{return(m||JSON.parse)(h),ro(ut).call(ut,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||Xx.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(ut.isResponse(t)||ut.isReadableStream(t))return t;if(t&&ut.isString(t)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(u){if(c)throw u.name==="SyntaxError"?rr.from(u,rr.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ca.classes.FormData,Blob:Ca.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ut.forEach(["delete","get","head","post","put","patch"],t=>{Xx.headers[t]={}});var Jx=Xx;const Wfe=ut.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Q8=Symbol("internals");function bT(t){var r;return t&&ro(r=String(t)).call(r).toLowerCase()}function GA(t){return t===!1||t==null?t:ut.isArray(t)?t.map(GA):String(t)}function Qx(t,r,s,o,c){return ut.isFunction(o)?o.call(this,r,s):(c&&(r=s),ut.isString(r)?ut.isString(o)?r.indexOf(o)!==-1:ut.isRegExp(o)?o.test(r):void 0:void 0)}class HA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function u(y,v,T){const R=bT(v);if(!R)throw new Error("header name must be a non-empty string");const P=ut.findKey(c,R);(!P||c[P]===void 0||T===!0||T===void 0&&c[P]!==!1)&&(c[P||v]=GA(y))}const h=(y,v)=>ut.forEach(y,(T,R)=>u(T,R,v));if(ut.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ut.isString(r)&&(r=ro(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ro(m=r).call(m)))h((y=>{const v={};let T,R,P;return y&&y.split(`
`).forEach(function(N){var G,j;P=N.indexOf(":"),T=ro(G=N.substring(0,P)).call(G).toLowerCase(),R=ro(j=N.substring(P+1)).call(j),!T||v[T]&&Wfe[T]||(T==="set-cookie"?v[T]?v[T].push(R):v[T]=[R]:v[T]=v[T]?v[T]+", "+R:R)}),v})(r),s);else if(ut.isHeaders(r))for(const[y,v]of r.entries())u(v,y,o);else r!=null&&u(s,r,o);var m;return this}get(r,s){if(r=bT(r)){const o=ut.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(u);)h[y[1]]=y[2];return h}(c);if(ut.isFunction(s))return s.call(this,c,o);if(ut.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=bT(r)){const o=ut.findKey(this,r);return!(!o||this[o]===void 0||s&&!Qx(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function u(h){if(h=bT(h)){const m=ut.findKey(o,h);!m||s&&!Qx(0,o[m],m,s)||(delete o[m],c=!0)}}return ut.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const u=s[o];r&&!Qx(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,o={};return ut.forEach(this,(c,u)=>{var h;const m=ut.findKey(o,u);if(m)return s[m]=GA(c),void delete s[u];const y=r?function(v){return ro(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(T,R,P)=>R.toUpperCase()+P)}(u):ro(h=String(u)).call(h);y!==u&&delete s[u],s[y]=GA(c),o[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ut.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&ut.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[Q8]=this[Q8]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=bT(u);s[h]||(function(m,y){const v=ut.toCamelCase(" "+y);["get","set","has"].forEach(T=>{Object.defineProperty(m,T+v,{value:function(R,P,N){return this[T].call(this,y,R,P,N)},configurable:!0})})}(o,u),s[h]=!0)}return ut.isArray(r)?r.forEach(c):c(r),this}}HA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ut.reduceDescriptors(HA.prototype,(t,r)=>{let{value:s}=t,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),ut.freezeMethods(HA);var wd=HA;function Zx(t,r){const s=this||Jx,o=r||s,c=wd.from(o.headers);let u=o.data;return ut.forEach(t,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function Z8(t){return!(!t||!t.__CANCEL__)}function zv(t,r,s){rr.call(this,t??"canceled",rr.ERR_CANCELED,r,s),this.name="CanceledError"}function eW(t,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new rr("Request failed with status code "+s.status,[rr.ERR_BAD_REQUEST,rr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ut.inherits(zv,rr,{__CANCEL__:!0});const $A=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),y=new Array(u);let v,T=0,R=0;return h=h!==void 0?h:1e3,function(P){const N=Date.now(),G=y[R];v||(v=N),m[T]=P,y[T]=N;let j=R,W=0;for(;j!==T;)W+=m[j++],j%=u;if(T=(T+1)%u,T===R&&(R=(R+1)%u),N-v<h)return;const Y=G&&N-G;return Y?Math.round(1e3*W/Y):void 0}}(50,250);return function(u,h){let m,y,v=0,T=1e3/h;const R=function(P){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),u.apply(null,P)};return[function(){const P=Date.now(),N=P-v;for(var G=arguments.length,j=new Array(G),W=0;W<G;W++)j[W]=arguments[W];N>=T?R(j,P):(m=j,y||(y=setTimeout(()=>{y=null,R(m)},T-N)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,y=h-o,v=c(y);o=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},tW=(t,r)=>{const s=t!=null;return[o=>r[0]({lengthComputable:s,total:t,loaded:o}),r[1]]},nW=t=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return ut.asap(()=>t(...s))};var zfe=Ca.hasStandardBrowserEnv?((t,r)=>s=>(s=new SA(s,Ca.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new SA(Ca.origin),Ca.navigator&&/(msie|trident)/i.test(Ca.navigator.userAgent)):()=>!0,Gfe=Ca.hasStandardBrowserEnv?{write(t,r,s,o,c,u){const h=[t+"="+encodeURIComponent(r)];ut.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ut.isString(o)&&h.push("path="+o),ut.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function rW(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s}(t,r):r}function iW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const sW=t=>t instanceof wd?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?iW(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):iW(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t):t;function H_(t,r){r=r||{};const s={};function o(v,T,R,P){return ut.isPlainObject(v)&&ut.isPlainObject(T)?ut.merge.call({caseless:P},v,T):ut.isPlainObject(T)?ut.merge({},T):ut.isArray(T)?T.slice():T}function c(v,T,R,P){return ut.isUndefined(T)?ut.isUndefined(v)?void 0:o(void 0,v,0,P):o(v,T,0,P)}function u(v,T){if(!ut.isUndefined(T))return o(void 0,T)}function h(v,T){return ut.isUndefined(T)?ut.isUndefined(v)?void 0:o(void 0,v):o(void 0,T)}function m(v,T,R){return R in r?o(v,T):R in t?o(void 0,v):void 0}const y={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,T,R)=>c(sW(v),sW(T),0,!0)};return ut.forEach(Object.keys(Object.assign({},t,r)),function(v){const T=y[v]||c,R=T(t[v],r[v],v);ut.isUndefined(R)&&T!==m||(s[v]=R)}),s}var oW=t=>{const r=H_({},t);let s,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=wd.from(m),r.url=T6(rW(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),ut.isFormData(o)){if(Ca.hasStandardBrowserEnv||Ca.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...T]=s?s.split(";").map(R=>ro(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...T].join("; "))}}if(Ca.hasStandardBrowserEnv&&(c&&ut.isFunction(c)&&(c=c(r)),c||c!==!1&&zfe(r.url))){const v=u&&h&&Gfe.read(h);v&&m.set(u,v)}return r},Hfe=typeof XMLHttpRequest<"u"&&function(t){return new dt(function(r,s){const o=oW(t);let c=o.data;const u=wd.from(o.headers).normalize();let h,m,y,v,T,{responseType:R,onUploadProgress:P,onDownloadProgress:N}=o;function G(){v&&v(),T&&T(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function W(){if(!j)return;const X=wd.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());eW(function(ue){r(ue),G()},function(ue){s(ue),G()},{data:R&&R!=="text"&&R!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:X,config:t,request:j}),j=null}j.open(o.method.toUpperCase(),o.url,!0),j.timeout=o.timeout,"onloadend"in j?j.onloadend=W:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(W)},j.onabort=function(){j&&(s(new rr("Request aborted",rr.ECONNABORTED,t,j)),j=null)},j.onerror=function(){s(new rr("Network Error",rr.ERR_NETWORK,t,j)),j=null},j.ontimeout=function(){let X=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ue=o.transitional||C6;o.timeoutErrorMessage&&(X=o.timeoutErrorMessage),s(new rr(X,ue.clarifyTimeoutError?rr.ETIMEDOUT:rr.ECONNABORTED,t,j)),j=null},c===void 0&&u.setContentType(null),"setRequestHeader"in j&&ut.forEach(u.toJSON(),function(X,ue){j.setRequestHeader(ue,X)}),ut.isUndefined(o.withCredentials)||(j.withCredentials=!!o.withCredentials),R&&R!=="json"&&(j.responseType=o.responseType),N&&([y,T]=$A(N,!0),j.addEventListener("progress",y)),P&&j.upload&&([m,v]=$A(P),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(h=X=>{j&&(s(!X||X.type?new zv(null,t,j):X),j.abort(),j=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const Y=function(X){const ue=/^([-+\w]{1,25})(:?\/\/|:)/.exec(X);return ue&&ue[1]||""}(o.url);Y&&Ca.protocols.indexOf(Y)===-1?s(new rr("Unsupported protocol "+Y+":",rr.ERR_BAD_REQUEST,t)):j.send(c||null)})},$fe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let o,c=new AbortController;const u=function(v){if(!o){o=!0,m();const T=v instanceof Error?v:this.reason;c.abort(T instanceof rr?T:new zv(T instanceof Error?T.message:T))}};let h=r&&setTimeout(()=>{h=null,u(new rr("timeout ".concat(r," of ms exceeded"),rr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),t=null)};t.forEach(v=>v.addEventListener("abort",u));const{signal:y}=c;return y.unsubscribe=()=>ut.asap(m),y}},Kfe=Q3,qfe=bl;Fn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=qfe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Yfe=bl,Xfe=Sh;Fn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=Yfe.f(this),s=Xfe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var eL=l(Kfe),aW=jv.f("asyncIterator"),Jfe=l(aW);function tL(t,r){this.v=t,this.k=r}function TT(t){var r,s;function o(u,h){try{var m=t[u](h),y=m.value,v=y instanceof tL;eL.resolve(v?y.v:y).then(function(T){if(v){var R=u==="return"?"return":"next";if(!y.k||T.done)return o(R,T);T=t[R](T).value}c(m.done?"return":"normal",T)},function(T){o("throw",T)})}catch(T){c("throw",T)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(u,h){return new eL(function(m,y){var v={key:u,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,o(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function wl(t){return function(){return new TT(t.apply(this,arguments))}}function In(t){return new tL(t,0)}function KA(t){var r={},s=!1;function o(c,u){return s=!0,{done:!1,value:new tL(u=new eL(function(h){h(t[c](u))}),1)}}return r[Wv!==void 0&&L8||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}TT.prototype[typeof Wv=="function"&&Jfe||"@@asyncIterator"]=function(){return this},TT.prototype.next=function(t){return this._invoke("next",t)},TT.prototype.throw=function(t){return this._invoke("throw",t)},TT.prototype.return=function(t){return this._invoke("return",t)};var nL=l(aW);function rL(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=nL,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new qA(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function qA(t){function r(s){if(Object(s)!==s)return dt.reject(new TypeError(s+" is not an object."));var o=s.done;return dt.resolve(s.value).then(function(c){return{value:c,done:o}})}return qA=function(s){this.s=s,this.n=s.next},qA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?dt.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?dt.reject(s):r(o.apply(this.s,arguments))}},new qA(t)}const Qfe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let o,c=0;for(;c<s;)o=c+r,yield t.slice(c,o),c=o},Zfe=function(){var t=wl(function*(r,s){var o,c=!1,u=!1;try{for(var h,m=rL(eme(r));c=!(h=yield In(m.next())).done;c=!1){const y=h.value;yield*KA(rL(Qfe(y,s)))}}catch(y){u=!0,o=y}finally{try{c&&m.return!=null&&(yield In(m.return()))}finally{if(u)throw o}}});return function(r,s){return t.apply(this,arguments)}}(),eme=function(){var t=wl(function*(r){if(r[nL])return void(yield*KA(rL(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield In(s.read());if(o)break;yield c}}finally{yield In(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),cW=(t,r,s,o)=>{const c=Zfe(t,r);let u,h=0,m=y=>{u||(u=!0,o&&o(y))};return new ReadableStream({async pull(y){try{const{done:v,value:T}=await c.next();if(v)return m(),void y.close();let R=T.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(T))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function lW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function uW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?lW(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):lW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const YA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",dW=YA&&typeof ReadableStream=="function",tme=YA&&(typeof TextEncoder=="function"?(hW=new TextEncoder,t=>hW.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var hW;const pW=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!t(...s)}catch{return!1}},nme=dW&&pW(()=>{let t=!1;const r=new Request(Ca.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),iL=dW&&pW(()=>ut.isReadableStream(new Response("").body)),XA={stream:iL&&(t=>t.body)};var fW;YA&&(fW=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!XA[t]&&(XA[t]=ut.isFunction(fW[t])?r=>r[t]():(r,s)=>{throw new rr("Response type '".concat(t,"' is not supported"),rr.ERR_NOT_SUPPORT,s)})}));const rme=async(t,r)=>{const s=ut.toFiniteNumber(t.getContentLength());return s??(async o=>o==null?0:ut.isBlob(o)?o.size:ut.isSpecCompliantForm(o)?(await new Request(Ca.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ut.isArrayBufferView(o)||ut.isArrayBuffer(o)?o.byteLength:(ut.isURLSearchParams(o)&&(o+=""),ut.isString(o)?(await tme(o)).byteLength:void 0))(r)};var ime=YA&&(async t=>{let{url:r,method:s,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:T,withCredentials:R="same-origin",fetchOptions:P}=oW(t);v=v?(v+"").toLowerCase():"text";let N,G=$fe([c,u&&u.toAbortSignal()],h);const j=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let W;try{if(y&&nme&&s!=="get"&&s!=="head"&&(W=await rme(T,o))!==0){let Se,_e=new Request(r,{method:"POST",body:o,duplex:"half"});if(ut.isFormData(o)&&(Se=_e.headers.get("content-type"))&&T.setContentType(Se),_e.body){const[Ne,Je]=tW(W,$A(nW(y)));o=cW(_e.body,65536,Ne,Je)}}ut.isString(R)||(R=R?"include":"omit");const Y="credentials"in Request.prototype;N=new Request(r,uW(uW({},P),{},{signal:G,method:s.toUpperCase(),headers:T.normalize().toJSON(),body:o,duplex:"half",credentials:Y?R:void 0}));let X=await fetch(N);const ue=iL&&(v==="stream"||v==="response");if(iL&&(m||ue&&j)){const Se={};["status","statusText","headers"].forEach(ht=>{Se[ht]=X[ht]});const _e=ut.toFiniteNumber(X.headers.get("content-length")),[Ne,Je]=m&&tW(_e,$A(nW(m),!0))||[];X=new Response(cW(X.body,65536,Ne,()=>{Je&&Je(),j&&j()}),Se)}v=v||"text";let ye=await XA[ut.findKey(XA,v)||"text"](X,t);return!ue&&j&&j(),await new dt((Se,_e)=>{eW(Se,_e,{data:ye,headers:wd.from(X.headers),status:X.status,statusText:X.statusText,config:t,request:N})})}catch(Y){throw j&&j(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new rr("Network Error",rr.ERR_NETWORK,t,N),{cause:Y.cause||Y}):rr.from(Y,Y&&Y.code,t,N)}});const sL={http:null,xhr:Hfe,fetch:ime};ut.forEach(sL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const mW=t=>"- ".concat(t),sme=t=>ut.isFunction(t)||t===null||t===!1;var gW={getAdapter:t=>{t=ut.isArray(t)?t:[t];const{length:r}=t;let s,o;const c={};for(let u=0;u<r;u++){let h;if(s=t[u],o=s,!sme(s)&&(o=sL[(h=String(s)).toLowerCase()],o===void 0))throw new rr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new rr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(mW).join(`
`):" "+mW(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:sL};function oL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new zv(null,t)}function _W(t){return oL(t),t.headers=wd.from(t.headers),t.data=Zx.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),gW.getAdapter(t.adapter||Jx.adapter)(t).then(function(r){return oL(t),r.data=Zx.call(t,t.transformResponse,r),r.headers=wd.from(r.headers),r},function(r){return Z8(r)||(oL(t),r&&r.response&&(r.response.data=Zx.call(t,t.transformResponse,r.response),r.response.headers=wd.from(r.response.headers))),dt.reject(r)})}const yW="1.7.9",JA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{JA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const EW={};JA.transitional=function(t,r,s){function o(c,u){return"[Axios v"+yW+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(t===!1)throw new rr(o(u," has been removed"+(r?" in "+r:"")),rr.ERR_DEPRECATED);return r&&!EW[u]&&(EW[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},JA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var QA={assertOptions:function(t,r,s){if(typeof t!="object")throw new rr("options must be an object",rr.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=t[u],y=m===void 0||h(m,u,t);if(y!==!0)throw new rr("option "+u+" must be "+y,rr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new rr("Unknown option "+u,rr.ERR_BAD_OPTION)}},validators:JA};const Ih=QA.validators;let ZA=class{constructor(t){this.defaults=t,this.interceptors={request:new w6,response:new w6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=H_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&QA.assertOptions(s,{silentJSONParsing:Ih.transitional(Ih.boolean),forcedJSONParsing:Ih.transitional(Ih.boolean),clarifyTimeoutError:Ih.transitional(Ih.boolean)},!1),o!=null&&(ut.isFunction(o)?r.paramsSerializer={serialize:o}:QA.assertOptions(o,{encode:Ih.function,serialize:Ih.function},!0)),QA.assertOptions(r,{baseUrl:Ih.spelling("baseURL"),withXsrfToken:Ih.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ut.merge(c.common,c[r.method]);c&&ut.forEach(["delete","get","head","post","put","patch","common"],N=>{delete c[N]}),r.headers=wd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))});const y=[];let v;this.interceptors.response.forEach(function(N){y.push(N.fulfilled,N.rejected)});let T,R=0;if(!m){const N=[_W.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,y),T=N.length,v=dt.resolve(r);R<T;)v=v.then(N[R++],N[R++]);return v}T=h.length;let P=r;for(R=0;R<T;){const N=h[R++],G=h[R++];try{P=N(P)}catch(j){G.call(this,j);break}}try{v=_W.call(this,P)}catch(N){return dt.reject(N)}for(R=0,T=y.length;R<T;)v=v.then(y[R++],y[R++]);return v}getUri(t){return T6(rW((t=H_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};ut.forEach(["delete","get","head","options"],function(t){ZA.prototype[t]=function(r,s){return this.request(H_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ut.forEach(["post","put","patch"],function(t){function r(s){return function(o,c,u){return this.request(H_(u||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}ZA.prototype[t]=r(),ZA.prototype[t+"Form"]=r(!0)});var eP=ZA;class aL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new dt(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new dt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new zv(c,u,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new aL(function(o){r=o}),cancel:r}}}var ome=aL;const cL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(cL).forEach(t=>{let[r,s]=t;cL[s]=r});var ame=cL;const Hs=function t(r){const s=new eP(r),o=s6(eP.prototype.request,s);return ut.extend(o,eP.prototype,s,{allOwnKeys:!0}),ut.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return t(H_(r,c))},o}(Jx);Hs.Axios=eP,Hs.CanceledError=zv,Hs.CancelToken=ome,Hs.isCancel=Z8,Hs.VERSION=yW,Hs.toFormData=DA,Hs.AxiosError=rr,Hs.Cancel=Hs.CanceledError,Hs.all=function(t){return dt.all(t)},Hs.spread=function(t){return function(r){return t.apply(null,r)}},Hs.isAxiosError=function(t){return ut.isObject(t)&&t.isAxiosError===!0},Hs.mergeConfig=H_,Hs.AxiosHeaders=wd,Hs.formToJSON=t=>J8(ut.isHTMLForm(t)?new FormData(t):t),Hs.getAdapter=gW.getAdapter,Hs.HttpStatusCode=ame,Hs.default=Hs;var Jo=Hs;const cme=()=>{};function wT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:cme};return t.promise=new dt((r,s)=>{t.resolve=o=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(o),t.value=o)},t.reject=o=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(o))}}),t}const tP=new Map,nP=new Map,Ah=new Map;let ji=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Bn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const vW=new Cde;let Cd=vW.getResult(),lL=null;function An(t){if(!lL){Cd=vW.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Bn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Bn.CHROME;case"Safari":case"Mobile Safari":return Bn.SAFARI;case"Edge":return Bn.EDGE;case"Firefox":return Bn.FIREFOX;case"QQ":case"QQBrowser":return Bn.QQ;case"Opera":return Bn.OPERA;case"WeChat":return Bn.WECHAT;default:return m.browser.name||""}}(Cd),s=SW(Cd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Cd),c=Cd.os.version,u=SW(Cd,!1),h=Cd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h};lL={name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h}}return lL}function SW(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function rP(){return An().os}function bW(){const t=An();return"".concat(t.os," ").concat(t.osVersion)}function iP(){const t=An();return!!(Cd.engine.name==="WebKit"&&t.os===ji.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Bn.SAFARI||Ro()&&t.name!==Bn.SAFARI)}function rf(){return An().name===Bn.CHROME}function vs(){return An().name===Bn.SAFARI}function TW(){return An().name===Bn.EDGE}function Fr(){return An().name===Bn.FIREFOX}function Ro(){return An().os===ji.IOS}function CT(t){const r=An();return!(r.name!==Bn.CHROME||!r.osVersion)&&Number(r.version)>=t}function wW(t){const r=An();return!(r.name!==Bn.CHROME||!r.osVersion)&&Number(r.version)<t}function uL(t,r,s){const o=An();return!(o.name!==t||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function dL(t){const r=An();return!(r.name!==Bn.EDGE||!r.osVersion)&&Number(r.version)>=t}function CW(t){const r=An();return!(r.name!==Bn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function RW(t,r,s){const o=An();if(o.os!==ji.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function IW(t,r,s){const o=An();if(o.name!==Bn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function hL(t){const r=An();return!(r.name!==Bn.OPERA||!r.osVersion)&&Number(r.version)>=t}function AW(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Gv(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function pL(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function PW(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function yu(){return vs()&&navigator.maxTouchPoints>0}function OW(){return An().name===Bn.WECHAT}function kW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function fL(){const t=rP();return function(){const{deviceType:r}=An();return r==="mobile"||r==="tablet"}()||t===ji.ANDROID||t===ji.IOS||t===ji.HARMONY_OS}function sf(){const t=An();return t.name!==Bn.EDGE&&t.name!==Bn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function sP(){return rP()===ji.ANDROID}function RT(){const t=An();return sP()&&(t.name===Bn.CHROME||t.name===Bn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function NW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?NW(Object(s),!0).forEach(function(o){$t(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):NW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function $t(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let J=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),xe=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),$t(this,"code",void 0),$t(this,"message",void 0),$t(this,"data",void 0),$t(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function of(t,r){if(typeof t!="boolean")throw new xe(J.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function xi(t,r,s){if(!at(s).call(s,t))throw new xe(J.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function ir(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new xe(J.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function mL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new xe(J.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&ir(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&ir(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&ir(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&ir(t.ideal,"".concat(r,".ideal"),1,1/0)}else ir(t,r,1,1/0)}function ss(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new xe(J.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!DW(t,s,o,c))throw new xe(J.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function af(t,r){if(!Array.isArray(t))throw new xe(J.INVALID_PARAMS,"".concat(r," should be an array"))}function Br(t){return t==null}function DW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}var IT=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(IT||{}),gL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(gL||{});const xW=new class{constructor(){$t(this,"_clientSize",null),$t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$t(this,"getStyle",t=>window.getComputedStyle(t,null)),$t(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const o=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||at(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const T=y.split("(")[0];return at(v=["brightness","blur","opacity"]).call(v,T)}).map(y=>{const[v,T]=y.split(/\(|\)/);return[v,Number(T.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,T]=y;switch(v){case"brightness":(T<.1||T>3)&&(s=!1);break;case"blur":T>3&&(s=!1);break;case"opacity":T<.1&&(s=!1)}}),s)}),$t(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,o=!0;const c=h=>r(h);let u=t;for(;u&&o;)c(u)||(s=!1,o=!1),u=u.parentElement,u||(o=!1);return s}),$t(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),$t(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:o,right:c,top:u,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),$t(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),$t(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),$t(this,"checkCoverForAPoint",(t,r,s)=>{const o=this.elementFromPoint(t,r);return o!==null&&o!==s}),$t(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:o}=this._clientSize,c=t/6,u=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const T=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(o*m+(v===0?.1:v===4?(u*v*m-1e5)/m:u*v)*m)/m;h.push({x:T,y:R})}return[...h]}),$t(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),$t(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),$t(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,y,v,T;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(y=r<u?r:u,s<0)v=0;else{if(!(s<c))return!1;v=s}if(o<0)return!1;T=o<c?o:c;const R=y-m,P=T-v;return this.checkSizeIsVisible(R,P,h)}),$t(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),$t(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(IT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(IT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(IT.SIZE)}}return this.returnHiddenResult(IT.STYLE)}return this.returnHiddenResult(gL.UNMOUNTED)}return this.returnHiddenResult(gL.INVALID_HTML_ELEMENT)}),$t(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function _L(t){return new TextEncoder().encode(t)}const LW=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},yL=async t=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",_L(t)),16);let Mr=class{constructor(){$t(this,"_events",{}),$t(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],o=this._indexOfListener(s,r);o!==-1&&s.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,o||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},AT=null;function MW(){if(AT)return AT;if(window.electron)return AT=window.electron;if(!window.require)return null;try{return AT=window.require("electron"),AT}catch{return null}}let Ti=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Wr=function(t){return t.TRACER="tracer",t}({});function UW(t){return ir(t.timeout,"config.timeout",0,1e5),ir(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ir(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ir(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let lme=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),$n=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function PT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function VW(t){return ss(t.turnServerURL,"turnServerURL"),ss(t.username,"username"),ss(t.password,"password"),t.udpport&&ir(t.udpport,"udpport",1,99999,!0),t.forceturn&&of(t.forceturn,"forceturn"),t.security&&of(t.security,"security"),t.tcpport&&ir(t.tcpport,"tcpport",1,99999,!0),!0}function EL(t){return t.level!==void 0&&xi(t.level,"level",[1,2,3]),t.delay!==void 0&&ir(t.delay,"delay",0,3e3,!0),!0}let _n=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Ss=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),oc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Hv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function bs(t,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return t.getListeners(r).length===0?dt.reject(new xe(J.UNEXPECTED_ERROR,"can not emit promise")):new dt((u,h)=>{t.emit(r,...o,u,h)})}function dr(t,r){if(t.getListeners(r).length===0)return dt.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return bs(t,r,...o)}function Vc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return OT(t,r,...o)}function OT(t,r){let s=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new xe(J.UNEXPECTED_ERROR,"handler is not sync");return s}const fi=new class extends Mr{set networkState(t){this.emit(Hv.NETWORK_STATE_CHANGE,t,this._networkState),t===oc.ONLINE?this.emit(Hv.ONLINE):t===oc.OFFLINE&&(this.onlineWaiter=new dt(r=>{this.once(Hv.ONLINE,()=>{this.onlineWaiter=void 0,r(oc.ONLINE)})}),this.emit(Hv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===oc.ONLINE}constructor(){super(),$t(this,"_moduleName","network-indicator"),$t(this,"_networkState",oc.ONLINE),$t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=oc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=oc.OFFLINE})}};function oP(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function $v(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function aP(t){dt!==void 0?dt.resolve().then(t):setTimeout(t,0)}function zr(t){return JSON.parse(JSON.stringify(t))}function $_(t){try{return zr(t)}catch{return t}}const jW={};function Bm(t,r){jW[r]||(jW[r]=!0,t())}function K_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function Wm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function FW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function BW(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=Za(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function Ph(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function WW(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?Ph(s):s.size}),r+138}function ume(t){const r=new xe(J.TIMEOUT,"timeout");return new dt((s,o)=>{window.setTimeout(()=>o(r),t)})}function os(t){return new dt(r=>{window.setTimeout(r,t)})}function hr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+hr(t-s.length,"")}function q_(){return hr(32,"").toUpperCase()}const cP=()=>{},zW=new class{constructor(){$t(this,"fnMap",new Map)}throttleByKey(t,r,s,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,mt(mt({},m),{},{fn:t,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:u,skipFn:o})}}},GW=zW.throttleByKey.bind(zW);function HW(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function vL(t,r){if(!HW(t)||!HW(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let o=0;o<r.length;o++)s[o]=vL(t[o],r[o]);return s}{const s=mt({},t);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(t,o)?s[o]=vL(t[o],r[o]):s[o]=r[o]);return s}}function $W(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let o=0;for(;t>0&&(s[o]=255&t,t>>=8,o++,o!==r););return s}function SL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function KW(t){const r="0123456789abcdef";function s(ue){let ye,Se="";for(ye=0;ye<=3;ye++)Se+=r.charAt(ue>>8*ye+4&15)+r.charAt(ue>>8*ye&15);return Se}function o(ue,ye){const Se=(65535&ue)+(65535&ye);return(ue>>16)+(ye>>16)+(Se>>16)<<16|65535&Se}function c(ue,ye,Se,_e,Ne,Je){return o(function(ht,ft){return ht<<ft|ht>>>32-ft}(o(o(ye,ue),o(_e,Je)),Ne),Se)}function u(ue,ye,Se,_e,Ne,Je,ht){return c(ye&Se|~ye&_e,ue,ye,Ne,Je,ht)}function h(ue,ye,Se,_e,Ne,Je,ht){return c(ye&_e|Se&~_e,ue,ye,Ne,Je,ht)}function m(ue,ye,Se,_e,Ne,Je,ht){return c(ye^Se^_e,ue,ye,Ne,Je,ht)}function y(ue,ye,Se,_e,Ne,Je,ht){return c(Se^(ye|~_e),ue,ye,Ne,Je,ht)}const v=function(ue){let ye;const Se=1+(ue.length+8>>6),_e=new Array(16*Se);for(ye=0;ye<16*Se;ye++)_e[ye]=0;for(ye=0;ye<ue.length;ye++)_e[ye>>2]|=ue.charCodeAt(ye)<<ye%4*8;return _e[ye>>2]|=128<<ye%4*8,_e[16*Se-2]=8*ue.length,_e}(t);let T,R,P,N,G,j=1732584193,W=-271733879,Y=-1732584194,X=271733878;for(T=0;T<v.length;T+=16)R=j,P=W,N=Y,G=X,j=u(j,W,Y,X,v[T+0],7,-680876936),X=u(X,j,W,Y,v[T+1],12,-389564586),Y=u(Y,X,j,W,v[T+2],17,606105819),W=u(W,Y,X,j,v[T+3],22,-1044525330),j=u(j,W,Y,X,v[T+4],7,-176418897),X=u(X,j,W,Y,v[T+5],12,1200080426),Y=u(Y,X,j,W,v[T+6],17,-1473231341),W=u(W,Y,X,j,v[T+7],22,-45705983),j=u(j,W,Y,X,v[T+8],7,1770035416),X=u(X,j,W,Y,v[T+9],12,-1958414417),Y=u(Y,X,j,W,v[T+10],17,-42063),W=u(W,Y,X,j,v[T+11],22,-1990404162),j=u(j,W,Y,X,v[T+12],7,1804603682),X=u(X,j,W,Y,v[T+13],12,-40341101),Y=u(Y,X,j,W,v[T+14],17,-1502002290),W=u(W,Y,X,j,v[T+15],22,1236535329),j=h(j,W,Y,X,v[T+1],5,-165796510),X=h(X,j,W,Y,v[T+6],9,-1069501632),Y=h(Y,X,j,W,v[T+11],14,643717713),W=h(W,Y,X,j,v[T+0],20,-373897302),j=h(j,W,Y,X,v[T+5],5,-701558691),X=h(X,j,W,Y,v[T+10],9,38016083),Y=h(Y,X,j,W,v[T+15],14,-660478335),W=h(W,Y,X,j,v[T+4],20,-405537848),j=h(j,W,Y,X,v[T+9],5,568446438),X=h(X,j,W,Y,v[T+14],9,-1019803690),Y=h(Y,X,j,W,v[T+3],14,-187363961),W=h(W,Y,X,j,v[T+8],20,1163531501),j=h(j,W,Y,X,v[T+13],5,-1444681467),X=h(X,j,W,Y,v[T+2],9,-51403784),Y=h(Y,X,j,W,v[T+7],14,1735328473),W=h(W,Y,X,j,v[T+12],20,-1926607734),j=m(j,W,Y,X,v[T+5],4,-378558),X=m(X,j,W,Y,v[T+8],11,-2022574463),Y=m(Y,X,j,W,v[T+11],16,1839030562),W=m(W,Y,X,j,v[T+14],23,-35309556),j=m(j,W,Y,X,v[T+1],4,-1530992060),X=m(X,j,W,Y,v[T+4],11,1272893353),Y=m(Y,X,j,W,v[T+7],16,-155497632),W=m(W,Y,X,j,v[T+10],23,-1094730640),j=m(j,W,Y,X,v[T+13],4,681279174),X=m(X,j,W,Y,v[T+0],11,-358537222),Y=m(Y,X,j,W,v[T+3],16,-722521979),W=m(W,Y,X,j,v[T+6],23,76029189),j=m(j,W,Y,X,v[T+9],4,-640364487),X=m(X,j,W,Y,v[T+12],11,-421815835),Y=m(Y,X,j,W,v[T+15],16,530742520),W=m(W,Y,X,j,v[T+2],23,-995338651),j=y(j,W,Y,X,v[T+0],6,-198630844),X=y(X,j,W,Y,v[T+7],10,1126891415),Y=y(Y,X,j,W,v[T+14],15,-1416354905),W=y(W,Y,X,j,v[T+5],21,-57434055),j=y(j,W,Y,X,v[T+12],6,1700485571),X=y(X,j,W,Y,v[T+3],10,-1894986606),Y=y(Y,X,j,W,v[T+10],15,-1051523),W=y(W,Y,X,j,v[T+1],21,-2054922799),j=y(j,W,Y,X,v[T+8],6,1873313359),X=y(X,j,W,Y,v[T+15],10,-30611744),Y=y(Y,X,j,W,v[T+6],15,-1560198380),W=y(W,Y,X,j,v[T+13],21,1309151649),j=y(j,W,Y,X,v[T+4],6,-145523070),X=y(X,j,W,Y,v[T+11],10,-1120210379),Y=y(Y,X,j,W,v[T+2],15,718787259),W=y(W,Y,X,j,v[T+9],21,-343485551),j=o(j,R),W=o(W,P),Y=o(Y,N),X=o(X,G);return s(j)+s(W)+s(Y)+s(X)}let dme=1,qW=console,Os=class{static setLogger(t){qW=t}constructor(t,r){$t(this,"id",void 0),$t(this,"lockingPromise",dt.resolve()),$t(this,"locks",0),$t(this,"name",""),$t(this,"lockId",void 0),this.lockId=dme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");qW.debug("".concat(s," ").concat(o))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new dt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function Kv(t,r){return function(s,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(o));try{for(var y=arguments.length,v=new Array(y),T=0;T<y;T++)v[T]=arguments[T];return await u.apply(this,v)}finally{m()}},c}}const wi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function bL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function Rd(t,r,s,o){const c=Object.assign({},wi,o);let u=c.timeout;const h=async()=>{await function(v){return new dt(T=>{window.setTimeout(T,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const y=new dt(async(v,T)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return T(new xe(J.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return v(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return T(P);await h()}}});return y.cancel=()=>m=!0,y}let lP,YW=class{constructor(t){$t(this,"input",[]),$t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Za(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},uP=0,TL=0;function wL(t,r,s,o){return new dt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),uP+=Ph(r.data)):s&&(r.data.size?uP+=r.data.size:r.data instanceof FormData?uP+=WW(r.data):uP+=Ph(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Jo.request(r).then(h=>{typeof h.data=="string"?TL+=Ph(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?TL+=h.data.byteLength:TL+=Ph(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Jo.isCancel(h)?u(new xe(J.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new xe(J.NETWORK_TIMEOUT,h.message)):h.response?u(new xe(J.NETWORK_RESPONSE_ERROR,h.response.status)):u(new xe(J.NETWORK_ERROR,h.message))})})}async function hme(t,r){const s=new Blob([r.data],{type:"buffer"});return await wL(t,mt(mt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const XW=()=>window.isSecureContext!==void 0;function Eu(t){if(Array.isArray(t))return t.map(s=>s);if(!JW(t))return t;const r={};for(const s in t){const o=t[s];JW(o)||Array.isArray(o)?r[s]=Eu(o):r[s]=o}return r}function JW(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let CL=class{constructor(t){$t(this,"input",[]),$t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Oh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},kT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Oh,remoteCandidate:Oh},updateInterval:0},QW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},ZW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},ez={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},tz={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let RL=class{constructor(t,r){$t(this,"onFirstVideoReceived",void 0),$t(this,"onFirstVideoDecoded",void 0),$t(this,"onFirstAudioReceived",void 0),$t(this,"onFirstVideoDecodedTimeout",void 0),$t(this,"onFirstAudioDecoded",void 0),$t(this,"onSelectedLocalCandidateChanged",void 0),$t(this,"onSelectedRemoteCandidateChanged",void 0),$t(this,"videoIsReady",!1),$t(this,"videoIsReady2",{}),$t(this,"pc",void 0),$t(this,"options",void 0),$t(this,"intervalTimer",void 0),$t(this,"stats",Eu(kT)),$t(this,"isFirstVideoReceived",{}),$t(this,"isFirstVideoDecoded",{}),$t(this,"isFirstAudioReceived",{}),$t(this,"isFirstAudioDecoded",{}),$t(this,"isFirstVideoDecodedTimeout",{}),$t(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new dt(t=>{t({local:mt({},Oh),remote:mt({},Oh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const T=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(o+=T,u+=R):(c+=T,h+=R),Number.isNaN(T)||Number.isNaN(T)?y.packetLostRate=0:y.packetLostRate=T<=0||R<=0?0:R/(T+R)});t.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},pme=class extends RL{constructor(){super(...arguments),$t(this,"_stats",kT),$t(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Eu(kT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const o=at(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=Eu(ZW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Eu(QW),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:mt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Eu(tz);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Eu(ez);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new dt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},NT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),dP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),IL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),jc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var qv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(qv||{});function DT(t,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:qv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[o]);if(typeof y!="number")return;const v=h-y;return v?(u-m)/v*c:void 0}let nz=class extends RL{constructor(){super(...arguments),$t(this,"_stats",kT),$t(this,"report",void 0),$t(this,"lastDecodeVideoReceiverStats",new Map),$t(this,"lastVideoFramesRecv",new Map),$t(this,"lastVideoFramesSent",new Map),$t(this,"lastVideoFramesDecode",new Map),$t(this,"lastVideoFramesOutput",new Map),$t(this,"lastVideoJBDelay",new Map),$t(this,"lastAudioJBDelay",new Map),$t(this,"mediaBytesSent",new Map),$t(this,"mediaBytesRetransmit",new Map),$t(this,"mediaBytesTargetEncode",new Map),$t(this,"lastDecodeAudioReceiverStats",new Map),$t(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Eu(kT),this.report.forEach(t=>{switch(t.type){case jc.OUTBOUND:case jc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,o=!r&&!("frameWidth"in t);t.type===jc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===jc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case jc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case jc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:mt({},Oh),remote:mt({},Oh)};return t.forEach(s=>{let o;if(s.type===jc.TRANSPORT&&(o=t.get(s.selectedCandidatePairId)),s.type===jc.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=t.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=t.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===jc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===jc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===jc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.localCandidate)),t.type===jc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(o=>o.ssrc===t.ssrc);r||(r=Eu(tz),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=DT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",qv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,mt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=Eu(QW),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=DT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=DT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",qv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=DT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",qv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=DT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",qv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:mt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);r||(r=Eu(ZW),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const o=new CL(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const c=new CL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const c=new CL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-o.lastFrameCount,u=t.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const o=this.findRemoteStatsId(t.ssrc,jc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=Eu(ez),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,jc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const o=Array.from(Mc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return o?o.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,y=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,T=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof T=="number"||(v=0,T=0),R==null){const P=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&P-N.lts>=800?(R=Math.round((y-N.count)/((P-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):N?R=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:v,height:T,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var o,c,u,h,m;const y=r?this.report.get(r):void 0,v=(o=y==null?void 0:y.framesReceived)!==null&&o!==void 0?o:t.framesReceived,T=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(u=y==null?void 0:y.frameHeight)!==null&&u!==void 0?u:t.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,N=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=v;let W=0;G&&j-G.lts>=800?(W=Math.round((v-G.count)/((j-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:W})):G?W=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:0}),s.receivedFrame={width:T||0,height:R||0,frameRate:W||0},s.decodedFrame={width:T||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:T||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&N){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=G.jitterBufferMs;const W=N-G.jitterBufferEmittedCount;W>0&&(j=1e3*(P-G.jitterBufferDelay)/W),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,y=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&o!==void 0?o:0,v=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var o,c,u,h,m,y,v;const T=r?this.report.get(r):void 0,R=(o=T==null?void 0:T.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,P=(c=T==null?void 0:T.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,N=(u=T==null?void 0:T.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,G=(h=T==null?void 0:T.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,j=(m=T==null?void 0:T.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,W=(y=T==null?void 0:T.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,Y=(v=T==null?void 0:T.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),N&&G){const ue=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=ue.jitterBufferMs;const Se=G-ue.jitterBufferEmittedCount;Se>0&&(ye=1e3*(N-ue.jitterBufferDelay)/Se),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=j;let X=1920;W&&P&&(X=P/W/50,s.receivedFrames=Math.round(P/X)),Y&&(s.droppedFrames=Math.round(Y/X))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},fme=class extends RL{updateStats(){return dt.resolve()}};function AL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new pme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new nz(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof dt||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new nz(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new fme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const rz="websdk_ng_install_id";function PL(){try{if(ie("INSTALL_ID"))return ie("INSTALL_ID");let t=window.localStorage.getItem(rz);return t||(t=q_(),window.localStorage.setItem(rz,t)),tr("INSTALL_ID",t),t}catch{return}}const Cl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.23.2"),OL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Y_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ts=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[t]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ts;const hP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},kL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},NL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",DL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},br=mt(mt(mt({},DL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:kL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},hP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function tr(t,r,s){var o,c,u;at(o=Object.keys(br)).call(o,t)&&(!s&&at(c=Object.keys(Id)).call(c,t)||(br[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(br.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(br.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,br.USE_NEW_NETWORK_CONFIG=u,u&&(br.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],br.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],br.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],br.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],br.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",br.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",br.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(br.ENABLE_INSTANT_VIDEO=!0,br.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(br.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(br.NEW_TURN_MODE||(br.NEW_TURN_MODE=4))))}function ie(t){return br[t]}OL||(br.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],br.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],br.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],br.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],br.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],br.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],br.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",br.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",br.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",br.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",br.AREAS=["NORTH_AMERICA","OVERSEA"]);let iz=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Id={};var yn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(yn||{});let pP=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const sz=128,mme=96,oz=1e3,Yv=10;let gme=0;var az=(()=>{var t={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>ht,Printer:()=>ci,parse:()=>ot,print:()=>bt});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function T(Ge){return Ge>="0"&&Ge<="9"}function R(Ge){return Ge>="!"&&Ge<="~"}function P(Ge){return R(Ge)||Ge>=""&&Ge<=""}function N(Ge){return Ge==="!"||Ge>="#"&&Ge<="'"||Ge>="*"&&Ge<="+"||Ge>="-"&&Ge<="."||Ge>="0"&&Ge<="9"||Ge>="A"&&Ge<="Z"||Ge>="^"&&Ge<="~"}function G(Ge){return Ge>="1"&&Ge<="9"}function j(Ge){return Ge>="A"&&Ge<="Z"||Ge>="a"&&Ge<="z"}function W(Ge){return Ge==="d"||Ge==="h"||Ge==="m"||Ge==="s"}function Y(Ge){return Ge>""&&Ge<"	"||Ge>"\v"&&Ge<"\f"||Ge>""&&Ge<""}function X(Ge){return j(Ge)||T(Ge)||Ge==="+"||Ge==="/"}function ue(Ge){return T(Ge)||j(Ge)||Ge==="+"||Ge==="/"||Ge==="-"||Ge==="_"}function ye(Ge){return j(Ge)||T(Ge)||Ge==="+"||Ge==="/"}function Se(Ge,M){var se=Object.keys(Ge);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(Ge);M&&(de=de.filter(function(et){return Object.getOwnPropertyDescriptor(Ge,et).enumerable})),se.push.apply(se,de)}return se}function _e(Ge){for(var M=1;M<arguments.length;M++){var se=arguments[M]!=null?arguments[M]:{};M%2?Se(Object(se),!0).forEach(function(de){Ne(Ge,de,se[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ge,Object.getOwnPropertyDescriptors(se)):Se(Object(se)).forEach(function(de){Object.defineProperty(Ge,de,Object.getOwnPropertyDescriptor(se,de))})}return Ge}function Ne(Ge,M,se){return M in Ge?Object.defineProperty(Ge,M,{value:se,enumerable:!0,configurable:!0,writable:!0}):Ge[M]=se,Ge}(function(Ge){Ge.VERSION="v",Ge.ORIGIN="o",Ge.SESSION_NAME="s",Ge.INFORMATION="i",Ge.URI="u",Ge.EMAIL="e",Ge.PHONE="p",Ge.CONNECTION="c",Ge.BANDWIDTH="b",Ge.TIME="t",Ge.REPEAT="r",Ge.ZONE_ADJUSTMENTS="z",Ge.KEY="k",Ge.ATTRIBUTE="a",Ge.MEDIA="m"})(v||(v={}));class Je{consumeText(M,se){let de=se;for(;de<M.length;){const et=M[de];if(et==="\0"||et==="\r"||et===h)break;de+=1}if(de-se==0)throw new Error("Invalid text, at ".concat(M));return de}consumeUnicastAddress(M,se,de){return this.consumeTill(M,se,y)}consumeOneOrMore(M,se,de){let et=se;for(;de(M[et]);)et++;if(et-se==0)throw new Error("Invalid rule at ".concat(se,"."));return et}consumeSpace(M,se){if(M[se]===y)return se+1;throw new Error("Invalid space at ".concat(se,"."))}consumeIP4Address(M,se){let de=se;for(let et=0;et<4;et++)if(de=this.consumeDecimalUChar(M,de),et!==3){if(M[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(M,se){let de=se;for(let qt=0;qt<3&&T(M[de]);qt++,de++);if(de-se==0)throw new Error("Invalid decimal uchar.");const et=parseInt(M.slice(se,de));if(et>=0&&et<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,se){let de=this.consumeHexpart(M,se);return M[de]===":"&&(de+=1,de=this.consumeIP4Address(M,de)),de}consumeHexpart(M,se){let de=se;if(M[de]===":"&&M[de+1]===":"){de+=2;try{de=this.consumeHexseq(M,de)}catch{}return de}if(de=this.consumeHexseq(M,de),M[de]===":"&&M[de+1]===":"){de+=2;try{de=this.consumeHexseq(M,de)}catch{}return de}return de}consumeHexseq(M,se){let de=se;for(;de=this.consumeHex4(M,de),M[de]===":"&&M[de+1]!==":";)de+=1;return de}consumeHex4(M,se){let de=0;for(;de<4;de++)if(!((et=M[se+de])>="0"&&et<="9"||et>="a"&&et<="f"||et>="A"&&et<="F")){if(de===0)throw new Error("Invalid hex 4");break}var et;return se+de}consumeFQDN(M,se){let de=se;for(;T(M[de])||j(M[de])||M[de]==="-"||M[de]===".";)de+=1;if(de-se<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(M,se){return this.consumeOneOrMore(M,se,P)}consumeMulticastAddress(M,se,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,se);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,se);default:try{return this.consumeFQDN(M,se)}catch{return this.consumeExtnAddr(M,se)}}}consumeIP6MulticastAddress(M,se){const de=this.consumeHexpart(M,se);return M[de]==="/"?this.consumeInteger(M,de+1):de}consumeIP4MulticastAddress(M,se){let de=se+3;const et=M.slice(se,de),qt=parseInt(et);if(qt<224||qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let sr=0;sr<3;sr++){if(M[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(M,de)}return M[de]==="/"&&(de+=1),de=this.consumeTTL(M,de),M[de]==="/"&&(de=this.consumeInteger(M,de)),de}consumeInteger(M,se){if(!G(M[se]))throw new Error("Invalid integer.");for(se+=1;T(M[se]);)se+=1;return se}consumeTTL(M,se){if(M[se]==="0")return se+1;if(!G(M[se]))throw new Error("Invalid TTL.");se+=1;for(let de=0;de<2&&T(M[se]);de++)se+=1;return se}consumeToken(M,se){return this.consumeOneOrMore(M,se,N)}consumeTime(M,se){let de=se;if(M[de]==="0")return de+1;for(G(M[de])&&(de+=1);T(M[de]);)de++;if(de-se<10)throw new Error("Invalid time");return de}consumeAddress(M,se){return this.consumeTill(M,se,y)}consumeTypedTime(M,se){let de=se;return de=this.consumeOneOrMore(M,de,T),W(M[de])?de+1:de}consumeRepeatInterval(M,se){if(!G(M[se]))throw new Error("Invalid repeat interval");for(se+=1;T(M[se]);)se+=1;return W(M[se])&&(se+=1),se}consumePort(M,se){return this.consumeOneOrMore(M,se,T)}consume(M,se,de){for(let et=0;et<de.length;et++){if(se+et>=M.length)throw new Error("consume exceeding value length");if(M[se+et]!==de[et])throw new Error("consume ".concat(de," failed at ").concat(et))}return se+de.length}consumeTill(M,se,de){let et=se;for(;et<M.length&&(typeof de!="string"||M[et]!==de)&&(typeof de!="function"||!de(M[et]));)et++;return et}}class ht extends Je{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(M){const se=this.probeEOL(M);this.records=M.split(se).filter(Ey=>!!ro(Ey).call(Ey)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),et=this.parseOrigin(),qt=this.parseSessionName(),sr=this.parseInformation(),Wi=this.parseUri(),Oa=this.parseEmail(),Ef=this.parsePhone(),yy=this.parseConnection(),gw=this.parseBandWidth(),w1=this.parseTimeFields(),C1=this.parseKey(),Dl=this.parseSessionAttribute(),og=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:et,sessionName:qt,information:sr,uri:Wi,emails:Oa,phones:Ef,connection:yy,bandwidths:gw,timeFields:w1,key:C1,attributes:Dl,mediaDescriptions:og}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let se=0;se<M.length;se++)if(M[se]===h)return M[se-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,se){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:M.slice(2),line:se,cur:0}}parseSessionAttribute(){const M=new Sn;for(;this.currentLine<this.records.length;){const se=this.getCurrentRecord();if(se.type!==v.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(se,et=>N(et)&&et!==":"),_cur:0};se.value[se.cur]===":"&&(se.cur+=1,de.attValue=this.extractOneOrMore(se,Y)),M.parse(de),this.currentLine++}return M.digest()}parseMediaAttributes(M){const se=new bn(M);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==v.ATTRIBUTE)break;const et={attField:this.extractOneOrMore(de,qt=>N(qt)&&qt!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,et.attValue=this.extractOneOrMore(de,Y)),se.parse(et),this.currentLine++}return se.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===v.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===v.ZONE_ADJUSTMENTS){const se=[];for(;;)try{const de=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let et=!1;M.value[M.cur]==="-"&&(et=!0,M.cur+=1);const qt=this.extract(M,this.consumeTypedTime);se.push({time:de,typedTime:qt,back:et})}catch{break}if(se.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,se}return[]}parseRepeat(){const M=[];for(;;){const se=this.getCurrentRecord();if(se.type!==v.REPEAT)break;{const de=this.extract(se,this.consumeRepeatInterval),et=this.parseTypedTime(se);M.push({repeatInterval:de,typedTimes:et}),this.currentLine++}}return M}parseTypedTime(M){const se=[];for(;;)try{this.consumeSpaceForRecord(M),se.push(this.extract(M,this.consumeTypedTime))}catch{break}if(se.length===0)throw new Error("Invalid typed time.");return se}parseTime(){const M=this.getCurrentRecord(),se=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const de=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:se,stopTime:de}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const se=this.getCurrentRecord();if(se.type!==v.BANDWIDTH)break;{const de=this.extractOneOrMore(se,N);if(se.value[se.cur]!==":")throw new Error("Invalid bandwidth field.");se.cur++;const et=this.extractOneOrMore(se,T);M.push({bwtype:de,bandwidth:et}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==v.VERSION)throw new Error("first sdp record must be version");const se=M.value.slice(0,this.consumeOneOrMore(M.value,0,T));if(se.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,se}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const se=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);const de=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);const et=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);const qt=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const sr=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Wi=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:se,sessId:de,sessVersion:et,nettype:qt,addrtype:sr,unicastAddress:Wi}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===v.SESSION_NAME){const se=this.extract(M,this.consumeText);return this.currentLine++,se}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==v.INFORMATION)return;const se=this.extract(M,this.consumeText);return this.currentLine++,se}parseUri(){const M=this.getCurrentRecord();if(M.type===v.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const se=this.getCurrentRecord();if(se.type!==v.EMAIL)break;M.push(se.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const se=this.getCurrentRecord();if(se.type!==v.PHONE)break;M.push(se.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===v.CONNECTION){const se=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const de=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const et=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:se,addrtype:de,address:et}}}parseMedia(){const M=this.getCurrentRecord(),se=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let de=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,de+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const et=[];for(et.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,et.push(this.extract(M,this.consumeToken));if(et.length===0)throw new Error("Invalid proto");const qt=this.parseFmt(M);return this.currentLine++,{mediaType:se,port:de,protos:et,fmts:qt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===v.TIME;){const se=this.parseTime(),de=this.parseRepeat(),et=this.parseZone();M.push({time:se,repeats:de,zones:et})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const se=this.parseMedia(),de=this.parseInformation(),et=this.parseConnections(),qt=this.parseBandWidth(),sr=this.parseKey(),Wi=this.parseMediaAttributes(se);M.push({media:se,information:de,connections:et,bandwidths:qt,key:sr,attributes:Wi})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const se=[];for(;;)try{this.consumeSpaceForRecord(M),se.push(this.extract(M,this.consumeToken))}catch{break}if(se.length===0)throw new Error("Invalid fmts");return se}extract(M,se){for(var de=arguments.length,et=new Array(de>2?de-2:0),qt=2;qt<de;qt++)et[qt-2]=arguments[qt];const sr=se.call(this,M.value,M.cur,...et),Wi=M.value.slice(M.cur,sr);return M.cur=sr,Wi}extractOneOrMore(M,se){const de=this.consumeOneOrMore(M.value,M.cur,se),et=M.value.slice(M.cur,de);return M.cur=de,et}consumeSpaceForRecord(M){if(M.value[M.cur]!==y)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class ft extends Je{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(M,se,de){const et=this.consumeOneOrMore(M.attValue,M._cur,se),qt=M.attValue.slice(M._cur,et),[sr,Wi]=de||[];if(typeof sr=="number"&&qt.length<sr)throw new Error("error in length, should be more or equal than ".concat(sr," characters."));if(typeof Wi=="number"&&qt.length>Wi)throw new Error("error in length, should be less or equal than ".concat(Wi," characters."));return M._cur=et,qt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==y)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,se){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,et=new Array(de>2?de-2:0),qt=2;qt<de;qt++)et[qt-2]=arguments[qt];const sr=se.call(this,M.attValue,M._cur,...et),Wi=M.attValue.slice(M._cur,sr);return M._cur=sr,Wi}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,se){if(!M.attValue)throw new Error;for(let de=0;de<se.length;de++)if(se[de]!==M.attValue[M._cur+de])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,X,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,X,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const se=[];for(;!this.atEnd(M);){se.push(this.extractOneOrMore(M,X));try{this.consumeAttributeSpace(M)}catch(de){if(this.atEnd(M))break;throw de}}this.attributes.iceOptions=se}parseFingerprint(M){const se=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:se,fingerprint:de})}parseExtmap(M){const se=this.extractOneOrMore(M,T);let de;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),de=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const et=this.extract(M,this.consumeTill,y),qt=_e(_e({entry:parseInt(se,10)},de&&{direction:de}),{},{extensionName:et});this.peekChar(M)===y&&(this.consumeAttributeSpace(M),qt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(qt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const se=this.extract(M,this.consumeTill);if(se!=="active"&&se!=="passive"&&se!=="actpass"&&se!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=se}}class Sn extends ft{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(se){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),se}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const se=this.extract(M,this.consumeToken),de=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;)this.consumeAttributeSpace(M),de.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:se,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,ue)}parseIdentity(M){const se=this.extractOneOrMore(M,ye),de=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;){this.consumeAttributeSpace(M);const et=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const qt=this.extractOneOrMore(M,sr=>sr!==y&&Y(sr));de.push({name:et,value:qt})}this.attributes.identities.push({assertionValue:se,extensions:de})}parseMsidSemantic(M){this.peekChar(M)===y&&this.consumeAttributeSpace(M);const se={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),se.applyForAll=!0;break}{const de=this.extract(M,this.consumeTill,y);se.identifierList.push(de)}}this.attributes.msidSemantic=se}}class bn extends ft{constructor(M){super(),Ne(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(se){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),se}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const se=this.extractOneOrMore(M,X,[1,32]);this.consumeAttributeSpace(M);const de=this.extractOneOrMore(M,T,[1,5]);this.consumeAttributeSpace(M);const et=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const qt=this.extractOneOrMore(M,T,[1,10]);this.consumeAttributeSpace(M);const sr=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Wi=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const Oa={foundation:se,componentId:de,transport:et,priority:qt,connectionAddress:sr,port:Wi,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),Oa.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),Oa.relPort=this.extract(M,this.consumePort));this.peekChar(M)===y;){this.consumeAttributeSpace(M);const Ef=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),Oa.extension[Ef]=this.extractOneOrMore(M,R)}this.attributes.candidates.push(Oa)}parseRemoteCandidate(M){const se=[];for(;;){const de=this.extractOneOrMore(M,T,[1,5]);this.consumeAttributeSpace(M);const et=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const qt=this.extract(M,this.consumePort);se.push({componentId:de,connectionAddress:et,port:qt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(se)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const se=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const et={encodingName:de,clockRate:this.extractOneOrMore(M,T)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),et.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const qt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(se,10));qt?qt.rtpMap=et:this.attributes.payloads.push({payloadType:parseInt(se,10),rtpMap:et,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const se=this.extractOneOrMore(M,T);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill,":");let et;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),et=this.extract(M,this.consumeTill));const qt=this.attributes.ssrcs.find(sr=>sr.ssrcId===parseInt(se,10));qt?qt.attributes[de]=et:this.attributes.ssrcs.push({ssrcId:parseInt(se,10),attributes:{[de]:et}})}parseFmtp(M){const se=this.extract(M,this.consumeTill,y);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill),et={};de.split(";").forEach(sr=>{let[Wi,Oa]=sr.split("=");Wi=ro(Wi).call(Wi);const Ef=typeof Oa=="string"?ro(Oa).call(Oa):null;typeof Wi=="string"&&Wi.length>0&&(et[Wi]=Ef)});const qt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(se,10));qt?qt.fmtp={parameters:et}:this.attributes.payloads.push({payloadType:parseInt(se,10),rtcpFeedbacks:[],fmtp:{parameters:et}})}parseFmtParameters(M){const se={},de=this.extract(M,this.consumeTill,"=");M._cur++;const et=this.extract(M,this.consumeTill,";");for(se[de]=et;M.attValue[M._cur]===";";){const qt=this.extract(M,this.consumeTill,"=");M._cur++;const sr=this.extract(M,this.consumeTill,";");se[qt]=sr}return se}parseRtcpFb(M){let se="";se=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,y),this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill,y);let et;if(de==="trr-int")et={type:de,interval:this.extract(M,this.consumeTill)};else{const qt={type:de};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),qt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===y&&(qt.additional=this.extract(M,this.consumeTill))),et=qt}if(se==="*")this.attributes.rtcpFeedbackWildcards.push(et);else{const qt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(se,10));qt?qt.rtcpFeedbacks.push(et):this.attributes.payloads.push({payloadType:parseInt(se,10),rtcpFeedbacks:[et]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const se={port:this.extract(M,this.consumePort)};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),se.netType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),se.addressType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),se.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=se}parseMsid(M){const se={id:this.extractOneOrMore(M,N,[1,64])};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),se.appdata=this.extractOneOrMore(M,N,[1,64])),this.attributes.msids.push(se)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const se=this.extractOneOrMore(M,et=>j(et)||T(et)||et==="_"||et==="-");this.consumeAttributeSpace(M);const de={id:se,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===y){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const et=[];for(;;){const qt=this.extract(M,this.consumeToken);et.push(qt);try{this.extract(M,this.consume,",")}catch{break}}de.payloads=et,this.peekChar(M)===y&&this.extract(M,this.consume,y)}for(;;){const et=this.extract(M,this.consumeToken);switch(et){case"depend":{const qt={type:et,rids:this.extract(M,this.consume,"=").split(",")};de.params.push(qt);break}default:{const qt={type:et};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),qt.val=this.extract(M,this.consumeTill,";")),de.params.push(qt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,T,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const se=this.extract(M,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(M);const et=this.extract(M,this.consumeInteger);de.push(parseInt(et,10))}catch{break}this.attributes.ssrcGroups.push({semantic:se,ssrcIds:de})}}function fr(Ge,M,se){return M in Ge?Object.defineProperty(Ge,M,{value:se,enumerable:!0,configurable:!0,writable:!0}):Ge[M]=se,Ge}class ci{constructor(){fr(this,"eol",m)}print(M,se){let de="";return se&&(this.eol=se),de+=this.printVersion(M.version),de+=this.printOrigin(M.origin),de+=this.printSessionName(M.sessionName),de+=this.printInformation(M.information),de+=this.printUri(M.uri),de+=this.printEmail(M.emails),de+=this.printPhone(M.phones),de+=this.printConnection(M.connection),de+=this.printBandwidth(M.bandwidths),de+=this.printTimeFields(M.timeFields),de+=this.printKey(M.key),de+=this.printSessionAttributes(M.attributes),de+=this.printMediaDescription(M.mediaDescriptions),de}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let se="";for(const de of M)se+="e=".concat(de).concat(this.eol);return se}printPhone(M){let se="";for(const de of M)se+="e=".concat(de).concat(this.eol);return se}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let se="";for(const de of M)se+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return se}printTimeFields(M){let se="";for(const de of M){se+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const et of de.repeats)se+="r=".concat(et.repeatInterval," ").concat(et.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(se+="z=",se+="z=".concat(de.zoneAdjustments.map(et=>"".concat(et.time," ").concat(et.back?"-":""," ").concat(et.typedTime)).join(" ")).concat(this.eol),se+=this.eol)}return se}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let se="";for(const de of M)se+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return se}printMediaDescription(M){let se="";for(const de of M)se+=this.printMedia(de.media),se+=this.printInformation(de.information),se+=this.printConnections(de.connections),se+=this.printBandwidth(de.bandwidths),se+=this.printKey(de.key),se+=this.printMediaAttributes(de);return se}printConnections(M){let se="";for(const de of M)se+=this.printConnection(de);return se}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new ra(this.eol).print(M)}printMediaAttributes(M){return new We(this.eol).print(M)}}class Yr{constructor(M){fr(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(y)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(se=>"a=fingerprint:".concat(se.hashFunction).concat(y).concat(se.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(se=>"a=extmap:".concat(se.entry).concat(se.direction?"/".concat(se.direction):"").concat(y).concat(se.extensionName).concat(se.extensionAttributes?"".concat(y).concat(se.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(se=>"a=".concat(se.attField).concat(se.attValue?":".concat(se.attValue):"").concat(this.eol)).join("")}}class ra extends Yr{print(M){let se="";return se+=this.printGroups(M.groups),se+=this.printMsidSemantic(M.msidSemantic),se+=this.printIceLite(M.iceLite),se+=this.printIceUfrag(M.iceUfrag),se+=this.printIcePwd(M.icePwd),se+=this.printIceOptions(M.iceOptions),se+=this.printFingerprints(M.fingerprints),se+=this.printSetup(M.setup),se+=this.printTlsId(M.tlsId),se+=this.printIdentity(M.identities),se+=this.printExtmap(M.extmaps),se+=this.printUnrecognized(M.unrecognized),se}printGroups(M){let se="";return M.length>0&&(se+=M.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(et=>"".concat(y).concat(et)).join("")).concat(this.eol)).join("")),se}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(se=>"a=identity:".concat(se.assertionValue).concat(se.extensions.map(de=>"".concat(y).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let se="a=msid-semantic:".concat(M.semantic);return M.applyForAll?se+="".concat(y,"*"):M.identifierList.length>0&&(se+=M.identifierList.map(de=>"".concat(y).concat(de))),se+this.eol}}class We extends Yr{print(M){const se=M.attributes;let de="";return de+=this.printRTCP(se.rtcp),de+=this.printIceUfrag(se.iceUfrag),de+=this.printIcePwd(se.icePwd),de+=this.printIceOptions(se.iceOptions),de+=this.printCandidates(se.candidates),de+=this.printRemoteCandidatesList(se.remoteCandidatesList),de+=this.printEndOfCandidates(se.endOfCandidates),de+=this.printFingerprints(se.fingerprints),de+=this.printSetup(se.setup),de+=this.printMid(se.mid),de+=this.printExtmap(se.extmaps),de+=this.printRTPRelated(se),de+=this.printPtime(se.ptime),de+=this.printMaxPtime(se.maxPtime),de+=this.printDirection(se.direction),de+=this.printSSRCGroups(se.ssrcGroups),de+=this.printSSRC(se.ssrcs),de+=this.printRTCPMux(se.rtcpMux),de+=this.printRTCPMuxOnly(se.rtcpMuxOnly),de+=this.printRTCPRsize(se.rtcpRsize),de+=this.printMSId(se.msids),de+=this.printImageattr(se.imageattr),de+=this.printRid(se.rids),de+=this.printSimulcast(se.simulcast),de+=this.printSCTPPort(se.sctpPort),de+=this.printMaxMessageSize(se.maxMessageSize),de+=this.printUnrecognized(se.unrecognized),de}printCandidates(M){return M.map(se=>"a=candidate:".concat(se.foundation).concat(y).concat(se.componentId).concat(y).concat(se.transport).concat(y).concat(se.priority).concat(y).concat(se.connectionAddress).concat(y).concat(se.port).concat(y,"typ").concat(y).concat(se.type).concat(se.relAddr?"".concat(y,"raddr").concat(y).concat(se.relAddr):"").concat(se.relPort?"".concat(y,"rport").concat(y).concat(se.relPort):"").concat(Object.keys(se.extension).map(de=>"".concat(y).concat(de).concat(y).concat(se.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(se=>"a=remote-candidates:".concat(se.join(y)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const se=M.payloads;let de="";de+=M.rtcpFeedbackWildcards.map(et=>this.printRTCPFeedback("*",et)).join("");for(const et of se)de+=this.printRtpMap(et.payloadType,et.rtpMap),de+=this.printFmtp(et.payloadType,et.fmtp),de+=et.rtcpFeedbacks.map(qt=>this.printRTCPFeedback(et.payloadType,qt)).join("");return de}printFmtp(M,se){if(!se)return"";const de=Object.keys(se.parameters);return de.length===1&&se.parameters[de[0]]===null?"a=fmtp:".concat(M).concat(y).concat(de[0]).concat(this.eol):"a=fmtp:".concat(M).concat(y).concat(Object.keys(se.parameters).map(et=>"".concat(et,"=").concat(se.parameters[et])).join(";")).concat(this.eol)}printRtpMap(M,se){return se?"a=rtpmap:".concat(M).concat(y).concat(se.encodingName,"/").concat(se.clockRate).concat(se.encodingParameters?"/".concat(se.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,se){let de="a=rtcp-fb:".concat(M).concat(y),et=se;return et.type==="trr-int"?de+="ttr-int".concat(y).concat(et.interval):(de+="".concat(et.type),et.parameter&&(de+="".concat(y).concat(et.parameter),et.additional&&(de+="".concat(y).concat(et.additional)))),de+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(se=>Object.keys(se.attributes).map(de=>"a=ssrc:".concat(se.ssrcId.toString(10)).concat(y).concat(de).concat(se.attributes[de]?":".concat(se.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let se="a=rtcp:".concat(M.port);return M.netType&&(se+="".concat(y).concat(M.netType)),M.addressType&&(se+="".concat(y).concat(M.addressType)),M.address&&(se+="".concat(y).concat(M.address)),se+this.eol}printMSId(M){return M.map(se=>"a=msid:".concat(se.id).concat(se.appdata?"".concat(y).concat(se.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(se=>"a=imageattr:".concat(se).concat(this.eol)).join("")}printRid(M){return M.map(se=>{let de="a=rid:".concat(se.id).concat(y).concat(se.direction);return se.payloads&&(de+="".concat(y,"pt=").concat(se.payloads.join(","))),se.params.length>0&&(de+="".concat(y).concat(se.params.map(et=>et.type==="depend"?"depend=".concat(et.rids.join(",")):"".concat(et.type,"=").concat(et.val)).join(";"))),de+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(se=>"a=ssrc-group:".concat(se.semantic).concat(se.ssrcIds.map(de=>"".concat(y).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function ot(Ge){return new ht().parse(Ge)}function bt(Ge,M){return new ci().print(Ge,M)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return t[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var u in c)s.o(c,u)&&!s.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Ra(t){return az.parse(t)}function zm(t,r){return az.print(t,r)}var _me=Qa("Array").keys,yme=Cc,Eme=vi,vme=k,Sme=_me,xL=Array.prototype,bme={DOMTokenList:!0,NodeList:!0},Tme=function(t){var r=t.keys;return t===xL||vme(xL,t)&&r===xL.keys||Eme(bme,yme(t))?Sme:r},Fc=l(Tme);function cz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?cz(Object(s),!0).forEach(function(o){Gr(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):cz(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Gr(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const lz=new class extends Mr{constructor(){super(...arguments),Gr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class wme{constructor(r){Gr(this,"logger",void 0),Gr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function LL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function uz(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Rl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},fP=Date.now(),xT=t=>{for(const r in Rl)if(Object.prototype.hasOwnProperty.call(Rl,r)&&Rl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Gr(this,"proxyServerURL",void 0),Gr(this,"logLevel",Rl.DEBUG),Gr(this,"uploadState","collecting"),Gr(this,"uploadLogWaitingList",[]),Gr(this,"uploadLogUploadingList",[]),Gr(this,"uploadErrorCount",0),Gr(this,"currentLogID",0),Gr(this,"url",void 0),Gr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){tr("UPLOAD_LOG",!0)}disableLogUpload(){tr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new wme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-fP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-fP);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=LL()+" Agora-SDK [".concat(xT(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=LL()+" %cAgora-SDK [".concat(xT(o),"]:");let u=[];if(!ie("USE_NEW_LOG"))switch(o){case Rl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Rl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Rl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Rl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-fP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-fP);const o=Math.max(0,Math.min(4,r[0]));r[0]=LL()+" Agora-SDK [".concat(xT(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(t){if(!ie("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=uz()+" Agora-SDK [".concat(xT(t),"]:"):s[0]=uz()+" Agora-SDK [".concat(xT(t),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Cl,process_id:ie("PROCESS_ID"),payload:JSON.stringify(t)};return Rd(async()=>{const s=await Jo.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(ie("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(ie("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),lz.reportLogUploadError(o),!0},{timeout:ie("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:ie("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,ie("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),ie("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),ie("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),ie("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var dz;function Cme(t){return ss(t.reportId,"params.reportId",0,100,!1),ss(t.category,"params.category",0,100,!1),ss(t.event,"params.event",0,100,!1),ss(t.label,"params.label",0,100,!1),ir(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(dz={}).FREE="free",dz.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Rme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Fi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),kr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Ime=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function jt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let T=y;if(t.argsMap)try{T=t.argsMap(this,...y)}catch(P){x.warning(P),T=[]}try{JSON.stringify(T)}catch{x.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),T=[]}const R=(t.report||Rt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:T,tag:Wr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,y);return P instanceof dt?P.then(N=>(R.onSuccess(t.reportResult&&N),N)).catch(N=>{throw R.onError(N),N}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Rt=new class{constructor(){Gr(this,"baseInfoMap",new Map),Gr(this,"proxyServer",void 0),Gr(this,"eventUploadTimer",void 0),Gr(this,"setSessionIdTimer",void 0),Gr(this,"url",void 0),Gr(this,"sids",new Set),Gr(this,"backupUrl",void 0),Gr(this,"_appId",void 0),Gr(this,"_aid",0),Gr(this,"keyEventUploadPendingItems",[]),Gr(this,"normalEventUploadPendingItems",[]),Gr(this,"apiInvokeUploadPendingItems",[]),Gr(this,"apiInvokeCount",0),Gr(this,"apiInvokeLoggedCount",0),Gr(this,"ltsList",[]),Gr(this,"lastSendNormalEventTime",Date.now()),Gr(this,"customReportCounterTimer",void 0),Gr(this,"customReportCount",0),Gr(this,"extApiInvoke",async t=>{for(const r of t){const s=sn(sn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Wr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),ie("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),ie("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!ie("SHOW_REPORT_INVOKER_LOG"),h=!!ie("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(N,G){if(m){let j="[apiInvoke-".concat(y,"]");r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]")),x.info("".concat(j," ").concat(N),N==="start"?r.options:G||"")}}const T=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});v("start");let R=!1;os(r.timeout).then(()=>{R||(this.sendApiInvoke(sn(sn({},T()),{},{error:J.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const P=new xe(J.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(sn(sn({},T()),{},{success:!0},r.reportResult&&{result:N})),v("onSuccess"),N};return s?GW(G,r.name+"Success",s,()=>R=!0):G()},onError:N=>{const G=()=>{if(R)throw N;R=!0,this.sendApiInvoke(sn(sn({},T()),{},{success:!1,error:N})),v("onFailure",N.toString())};return s?GW(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),o=this.createBaseInfo(t,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:ie("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:OL?"global":"oversea",areas:ie("AREAS")&&ie("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:T}=r,R=Date.now(),P=sn(sn({},o),{},{eventType:Fi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:NL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:ie("PROCESS_ID"),appType:ie("APP_TYPE"),success:!0,version:Cl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:at(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:T,serviceId:ie("PROCESS_ID"),extensionID:ie("PLUGIN_INFO").join(",")||""});var N;this.send({type:kr.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{role:r.role,eventType:Fi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:kr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Fi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:kr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(u&&h?h:s.startTime),T=sn(sn({},o),{},{eventType:Fi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:PL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=T.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:kr.JOIN_GATEWAY,data:T},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),j=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),j=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete T.success,delete T.eventType,delete T.firstSuccess,T.vid=Number(T.vid);const N=Object.assign({},T,P,{eventType:Fi.REJOIN_GATEWAY});this.send({type:kr.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=Date.now(),c=sn(sn({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:kr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Fi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:kr.PUBLISH,data:u},!0)}subscribe(t,r,s){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,u=Date.now(),h=sn(sn({},c),{},{eventType:Fi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:kr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...Fc(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn({},u),{},{eventType:Fi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:kr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Fi.AB_TEST,lts:c});this.send({type:kr.AB_TEST,data:u},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Fi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:kr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Fi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:kr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=sn(sn(sn({},u),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Fi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:kr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Fi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{eventType:Fi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:kr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now();(function(u,h,m){const y=u[h];if(!y||typeof y!="string")return[u];u[h]="";const v=Ph(JSON.stringify(u));let T=0;const R=[];let P=0;for(let N=0;N<y.length;N++)P+=y.charCodeAt(N)<=127?1:3,P<=m-v||(R[R.length]=mt(mt({},u),{},{[h]:y.substring(T,N)}),T=N,P=y.charCodeAt(N)<=127?1:3);return T!==y.length-1&&(R[R.length]=mt(mt({},u),{},{[h]:y.substring(T)})),R})(sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:kr.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:kr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:kr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),u=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:kr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>ie("CUSTOM_REPORT_LIMIT"))throw new xe(J.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:kr.USER_ANALYTICS,data:sn(sn({sid:t},c),{},{lts:s})}));try{ie("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new xe(J.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=ie("NOT_REPORT_EVENT");if(t.tag&&at(r)&&at(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:o,uid:c,cid:u}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof xe){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:o,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:kr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>ie("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],o=[];for(;t.length;){const u=t.shift();s.length<20?s.push(u):o.push(u)}t.push(...o);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),pT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),ie("ENABLE_EVENT_REPORT")&&s.length&&(ie("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{ie("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>ie("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-ie("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){fi.networkState===oc.OFFLINE&&await dt.race([fi.onlineWaiter,os(2*wi.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=_L(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let P=0;return Object.entries(kr).forEach(N=>{let[G,j]=N;j===R.type&&(P=Ime[G])}),P})(h),T=new DataView(y);T.setUint16(0,m.byteLength,!0),T.setUint8(2,255&v),T.setUint8(3,v>>>8&255),T.setUint8(4,v>>>16&255),u=LW(u,new Uint8Array(y)),u=LW(u,m)}),u},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(ie("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(ie("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await wL(o,{timeout:1e4,data:r(t),headers:sn(sn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:o};fi.networkState===oc.OFFLINE&&await dt.race([fi.onlineWaiter,os(2*wi.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("EVENT_REPORT_DOMAIN"),"&p=").concat(ie("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(ie("EVENT_REPORT_DOMAIN"),":").concat(ie("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(ie("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(ie("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(ie("STATS_COLLECTOR_PORT")).concat(u)));try{r?await hme(h,{timeout:1e4,data:c}):await wL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Rme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Wr.TRACER}).onSuccess()}};lz.on("REPORT_LOG_UPLOAD",t=>{t.networkState=fi.networkState,Rt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Wr.TRACER}).onSuccess("logUploadError")});class Oe extends xe{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Gr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const as={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Mn(){return as}function hz(){return"setSinkId"in HTMLAudioElement.prototype&&(!ie("RESTRICTION_SET_PLAYBACK_DEVICE")||(rf()||TW())&&!fL())}function pz(){return!as.supportUnifiedPlan||ie("CHROME_FORCE_PLAN_B")&&sf()}let cs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Xv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Pn(t,r,s,o,c){return{width:t,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function vu(t,r,s,o,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function ML(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Ame={"90p":Pn(160,90),"90p_1":Pn(160,90),"120p":Pn(160,120,15,30,65),"120p_1":Pn(160,120,15,30,65),"120p_3":Pn(120,120,15,30,50),"120p_4":Pn(212,120),"180p":Pn(320,180,15,30,140),"180p_1":Pn(320,180,15,30,140),"180p_3":Pn(180,180,15,30,100),"180p_4":Pn(240,180,15,30,120),"240p":Pn(320,240,15,40,200),"240p_1":Pn(320,240,15,40,200),"240p_3":Pn(240,240,15,40,140),"240p_4":Pn(424,240,15,40,220),"360p":Pn(640,360,15,80,400),"360p_1":Pn(640,360,15,80,400),"360p_3":Pn(360,360,15,80,260),"360p_4":Pn(640,360,30,80,600),"360p_6":Pn(360,360,30,80,400),"360p_7":Pn(480,360,15,80,320),"360p_8":Pn(480,360,30,80,490),"360p_9":Pn(640,360,15,80,800),"360p_10":Pn(640,360,24,80,800),"360p_11":Pn(640,360,24,80,1e3),"480p":Pn(640,480,15,100,500),"480p_1":Pn(640,480,15,100,500),"480p_2":Pn(640,480,30,100,1e3),"480p_3":Pn(480,480,15,100,400),"480p_4":Pn(640,480,30,100,750),"480p_6":Pn(480,480,30,100,600),"480p_8":Pn(848,480,15,100,610),"480p_9":Pn(848,480,30,100,930),"480p_10":Pn(640,480,10,100,400),"720p":Pn(1280,720,15,120,1130),"720p_auto":Pn(1280,720,30,900,3e3),"720p_1":Pn(1280,720,15,120,1130),"720p_2":Pn(1280,720,30,120,2e3),"720p_3":Pn(1280,720,30,120,1710),"720p_5":Pn(960,720,15,120,910),"720p_6":Pn(960,720,30,120,1380),"1080p":Pn(1920,1080,15,120,2080),"1080p_1":Pn(1920,1080,15,120,2080),"1080p_2":Pn(1920,1080,30,120,3e3),"1080p_3":Pn(1920,1080,30,120,3150),"1080p_5":Pn(1920,1080,60,120,4780),"1440p":Pn(2560,1440,30,120,4850),"1440p_1":Pn(2560,1440,30,120,4850),"1440p_2":Pn(2560,1440,60,120,7350),"4k":Pn(3840,2160,30,120,8910),"4k_1":Pn(3840,2160,30,120,8910),"4k_3":Pn(3840,2160,60,120,13500)},Pme={"480p":vu(640,480,5),"480p_1":vu(640,480,5),"480p_2":vu(640,480,30),"480p_3":vu(640,480,15),"720p":vu(1280,720,5),"720p_auto":Pn(1280,720,30,900,3e3),"720p_1":vu(1280,720,5),"720p_2":vu(1280,720,30),"720p_3":vu(1280,720,15),"1080p":vu(1920,1080,5),"1080p_1":vu(1920,1080,5),"1080p_2":vu(1920,1080,30),"1080p_3":vu(1920,1080,15)},Ome={"1SL1TL":ML(1,1),"3SL3TL":ML(3,3),"2SL3TL":ML(2,3)};function kh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Ame[t]):t}function UL(t){return typeof t=="string"?Object.assign({},Pme[t]):t}function mP(t){return typeof t=="string"?Object.assign({},Ome[t]):t}const kme={speech_low_quality:Xv(16e3,!1),speech_standard:Xv(32e3,!1,18),music_standard:Xv(48e3,!1),standard_stereo:Xv(48e3,!0,56),high_quality:Xv(48e3,!1,128),high_quality_stereo:Xv(48e3,!0,192)};function gP(t){return typeof t=="string"?Object.assign({},kme[t]):t}const Jv=[];function fz(t){return xi(t,"mediaSource",["screen","window","application"]),!0}let yt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),pr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Qv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Nme=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Dme=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),X_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Zv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),eS=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),tS=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Bc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const VL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},jL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},mz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},xme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},gz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Io=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Wc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),LT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),J_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),io=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Nh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const FL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let _P=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function _z(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Nr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_z(Object(s),!0).forEach(function(o){Pe(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_z(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Pe(t,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function On(t,r,s,o,c){var u,h,m={};return Object.keys(o).forEach(function(y){m[y]=o[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Za(u=fm(h=s.slice()).call(h)).call(u,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class yz extends Mr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(X_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||hr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){at(Jv).call(Jv,o)||Jv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Bm(()=>{var s;Rt.reportApiInvoke(null,{name:Ti.GET_MEDIA_STREAM_TRACK,options:[],tag:Wr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Qv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Jv.indexOf(r);s!==-1&&Jv.splice(s,1)}(this),this.emit(Zv.CLOSED),this.removeAllListeners(X_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Qv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(X_.TRANSCEIVER_UPDATED,r,s)}}class nS extends yz{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Os("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(yt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await dr(this,yt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Zv.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),of(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new xe(J.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new xe(J.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():dt.resolve([])}}const Ez=window.AudioContext||window.webkitAudioContext;let zc=null;const nr=new class extends Mr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(cs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(zc&&await zc.suspend(),this.emit(cs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function rS(){if(!zc){if(function(){if(!Ez)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Nr({},ie("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),zc=new Ez(t),nr.curState=zc.state,zc.onstatechange=()=>{nr.prevState=nr.curState,nr.curState=zc?zc.state:void 0;const{prevState:r,curState:s}=nr,o=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",y=An().osVersion;(Ro()||yu())&&u&&c&&(x.info("ios".concat(y,"-interruption-start")),nr.emit(cs.IOS_INTERRUPTION_START)),(Ro()||yu())&&(h||m)&&o&&(x.info("ios".concat(y,"-interruption-end")),nr.emit(cs.IOS_INTERRUPTION_END)),r!==s&&nr.emit(cs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=zc)===null||r===void 0?void 0:r.currentTime;nr.currentTime!==s?(nr.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),nr.currentTimeStuckAt=void 0),nr.currentTime=s):(s!==nr.currentTimeStuckAt&&(Rt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Wr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),nr.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(j){r.state==="running"?y(!1):Ro()||yu()?r.state==="suspended"&&(y(!0),j&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),j&&r.resume().then(v,v))}function y(j){if(c!==j){c=j;for(let W=0,Y=s;W<Y.length;W+=1){const X=Y[W];j?window.addEventListener(X,T,{capture:!0,passive:!0}):window.removeEventListener(X,T,{capture:!0,passive:!0})}}}function v(){m(!1)}function T(){m(!0)}function R(j){if(!h)if(o.paused)if(j){let W;P(!1),h=!0;try{W=o.play(),W?W.then(N,N):(o.addEventListener("playing",N),o.addEventListener("abort",N),o.addEventListener("error",N))}catch{N()}}else P(!0);else P(!1)}function P(j){if(u!==j){u=j;for(let W=0,Y=s;W<Y.length;W++){const X=Y[W];j?window.addEventListener(X,G,{capture:!0,passive:!0}):window.removeEventListener(X,G,{capture:!0,passive:!0})}}}function N(){o.removeEventListener("playing",N),o.removeEventListener("abort",N),o.removeEventListener("error",N),h=!1,R(!1)}function G(){R(!0)}if(Ro()){const j=r.createMediaStreamDestination(),W=document.createElement("div");W.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=W.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=j.stream,R(!0)}nr.on(cs.STATE_CHANGE,function(){m(!0)}),m(!1)}(zc)}(),!zc)throw new xe(J.NOT_SUPPORTED,"can not create audio context");return zc}return zc}function Q_(t){if(function(){if(BL!==null)return BL;const o=rS(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),BL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(o,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),at(h=t._inputNodes).call(h,o)||(o instanceof AudioNode?(t._inputNodes.push(o),r.call(t,o,c,u)):r.call(t,o,c)),t},t.disconnect=(o,c,u)=>{s.call(t),o?oP(t._inputNodes,o):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let BL=null;function WL(t,r){let s=!1;const o=1/r;if(ie("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*o)}else{const c=rS();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),t(c.currentTime)};h()}return()=>{s=!0}}class vz{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=rS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ro()||yu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=Za(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Sz extends Mr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=rS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Q_(this.outputNode),this.volumeLevelAnalyser=new vz}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Bc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Mn().webAudioMediaStreamDest)throw new xe(J.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&aP(()=>{nr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ro()||yu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await os(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bz extends Sz{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),Q_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Q_(this.outputNode),this.emit(Bc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new xe(J.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),Q_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));Q_(y),this.originVolumeLevelAnalyser=new vz,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=An();s&&h.os===ji.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(nr.on(cs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),Q_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Bc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),nr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));Q_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Tz(t,r,s){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Lme(t,r){const s=await wz(t.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new dt((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const T=document.createElement("div");T.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Y);const X=new Error("NotAllowedError");X.name="NotAllowedError",y(X)};let j=h;const W=document.createElement("div");if(h){const X=document.createElement("input");X.setAttribute("type","checkbox");const ue=document.createElement("span");X.setAttribute("style","margin-right: 6px;"),ue.innerText="Share audio",X.checked=j,X.onchange=()=>{j=X.checked},W.appendChild(X),W.appendChild(ue)}N.appendChild(W),N.appendChild(G),T.appendChild(R),T.appendChild(P),T.appendChild(N);const Y=document.createElement("div");Y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Y.appendChild(v),Y.appendChild(T),document.body.appendChild(Y),u.map(X=>{if(X.id){const ue=document.createElement("div");ue.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=X.thumbnail;try{const{width:Se}=ye.getSize();Se>1920&&(ye=ye.resize({width:1920}))}catch(Se){throw Se&&Se.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Se}ue.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+X.name.replace(/[\u00A0-\u9999<>\&]/g,function(Se){return"&#"+Se.charCodeAt(0)+";"})+"</span>",ue.onclick=()=>{document.body.removeChild(Y),m({sourceId:X.id,audio:j})},P.appendChild(ue)}})})}(s,r);return await Tz(o,t,c)}async function wz(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=MW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new xe(J.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new dt((u,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):u(y)})}));try{return await o}catch(u){throw new xe(J.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const zL=new Os("safari");let Cz=!1,Rz=!1;async function Gc(t,r){let s=0,o=null;for(;s<2;)try{o=await Mme(t,r,s>0);break}catch(c){if(c instanceof xe)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=yP(c.name||c.code||c,c.message);if(u.code===J.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await os(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new xe(J.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Mme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new xe(J.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=Mn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(MW())t.screen.sourceId?iS(c,await Tz(t.screen.sourceId,t.screen,!!t.screenAudio)):iS(c,await Lme(t.screen,!!t.screenAudio));else if(rf()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new xe(J.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new dt((N,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void G(new xe(J.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(j.streamId)})}catch(j){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),G(new xe(J.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,iS(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){var u;t.screen.mediaSource&&fz(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:G,systemAudio:j,preferCurrentTab:W}=t.screen,Y={selfBrowserSurface:N,surfaceSwitching:G,systemAudio:j,preferCurrentTab:W};!N&&delete Y.selfBrowserSurface,!G&&delete Y.surfaceSwitching,!j&&delete Y.systemAudio,!W&&delete Y.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:Y})),iS(c,await navigator.mediaDevices.getDisplayMedia(Nr({video:P,audio:t.screenAudio},Y)))}else{if(!Fr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new xe(J.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&fz(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),iS(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=ie("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=vL(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),An();let T,R=null;(vs()||Ro()||iP())&&(R=await zL.lock());try{T=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(Cz=!0),y.video&&(Rz=!0),iS(c,T),R&&R(),c}function yP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new xe(J.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new xe(J.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new xe(J.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new xe(J.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new xe(J.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new xe(J.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new xe(J.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function iS(t,r){const s=t.getVideoTracks()[0],o=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&t.removeTrack(o),t.addTrack(u)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const Hc=new class extends Mr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(J_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",LT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(ie("ENUMERATE_DEVICES_INTERVAL")||(sP()||rP()===ji.HARMONY_OS)&&sf())&&this.updateDevicesInfo()},ie("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new xe(J.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(u||h)){if(zL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await zL.lock())(),x.debug("[device manager] GUM unlock")),Cz&&(u=!1,this.isAccessMicrophonePermission=!0),Rz&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(T){const R=yP(T.name||T.code||T,T.message);if(R.code===J.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(T){const R=yP(T.name||T.code||T,T.message);if(R.code===J.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(T){const R=yP(T.name||T.code||T,T.message);if(R.code===J.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const T=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,T}catch(T){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new xe(J.ENUMERATE_DEVICES_FAILED,T.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new xe(J.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=LT.INITING;try{await this.updateDevicesInfo(),this.state=LT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=LT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new xe(J.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==LT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(J_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(J_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(J_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let GL=!1;const $c=new class extends Mr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function Iz(){if(An(),!GL){const t=r=>{r.preventDefault(),GL=!1,RT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};GL=!0,RT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),$c.onAutoplayFailed?$c.onAutoplayFailed():$c.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),$c.emit("autoplay-failed")}}function Az(t,r,s,o){if(!t)return;const c=Rt.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),m=Nr(Nr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:$c.onAutoplayFailed||$c.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});Rt.send({type:kr.AUTOPLAY_FAILED,data:m},!0)}const Ume=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qo=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return o.pause(),void o.play();if(nr.curState==="running")return Gv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),nr.on(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.on(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),nr.on(cs.STATE_CHANGE,()=>{Ro()&&nr.prevState==="suspended"&&nr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(o){throw new xe(J.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,io.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&Az(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),aP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Iz()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Ume.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(t),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new dt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{RT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function oi(){return function(t,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new xe(J.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof dt?new dt((y,v)=>{m.then(y).catch(v)}):m}),s}}class Pz extends Mr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new xe(J.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new xe(J.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Io.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Io.ON_TRACK,void 0)}}class Oz extends Mr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await bs(this,Wc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),dr(this,Wc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),dr(this,Wc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new xe(J.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof dt&&(o=await o),r.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class kz extends Mr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new xe(J.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new xe(J.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Io.ON_TRACK,void 0),this.emit(Io.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Io.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Io.ON_NODE,this.inputNode))}}class Nz extends Mr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return bs(this,Wc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),dr(this,Wc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),dr(this,Wc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Mc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new xe(J.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof dt&&(o=await o),r.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class HL extends Mr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new Vme}setVolume(){}createOutputTrack(){throw new xe(J.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Vme{disconnect(){}connect(){}}function Dz(t){return new dt((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Ro()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Fr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(cP),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function EP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=kh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!kW()&&s.frameRate&&(r.frameRate=s.frameRate),TW()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Fr()&&(r.frameRate={ideal:30,max:30}),r}function xz(t){const r={};return kW()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,rf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function Lz(t){const r=xz(t);if(t.encoderConfig){const s=gP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),sP()&&(r.sampleRate=void 0),r}const jme=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=SL(h),m=SL(m),u=SL(u);const{max:y,min:v}=function(N,G,j){const W=200*Math.pow(j/15,.6)*Math.pow(N*G/640/360,.75);return{min:Math.floor(W),max:Math.floor(4*W)}}(h,m,u),{bitrateMax:T,bitrateMin:R}=r||{};T||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(T,", brMin: ").concat(R,"]"));const{maxFramerate:P}=ie("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:T||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},Mz=async(t,r,s)=>await(async(o,c,u)=>{const h=function(v){const T=[];for(let R=0;R<v.length;R+=2)T.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(T)}(KW(""+c+u)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,o))})(t.buffer,r,s),$L=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new dt((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await Uz(c);s({buffer:u,width:r.width,height:r.height})}else o(new xe(J.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Uz=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var Vz,jz,Fz,Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,e9,t9,Ur,n9,r9,i9,s9,o9,a9,Dh,c9,l9,u9,d9,h9,p9,f9,m9,g9,_9,y9,E9,v9,ws;let qr=(Vz=jt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),jz=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),Fz=oi(),Bz=Kv("LocalAudioTrack","_enabledMutex"),Wz=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),zz=oi(),Gz=Kv("LocalAudioTrack","_enabledMutex"),Hz=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),$z=oi(),Kz=oi(),qz=oi(),Yz=jt({argsMap:t=>[t.getTrackId()]}),Xz=oi(),Jz=jt({argsMap:t=>[t.getTrackId()]}),Qz=oi(),Zz=jt({argsMap:t=>[t.getTrackId()]}),e9=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),t9=jt({argsMap:t=>[t.getTrackId()]}),On((Ur=class extends nS{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Qo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,o){super(t,s),Pe(this,"trackMediaType",tS.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new HL,ie("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),ie("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),vs()&&!zc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ir(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Qo.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,dr(this,yt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!hz())throw new xe(J.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qo.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await dr(this,yt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(o){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await dr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await dr(this,yt.NEED_MUTE_TRACK,this):await dr(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return Bm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Vc(this,yt.GET_STATS)||Nr({},VL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Bc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Bc.ON_AUDIO_BUFFER),this._source.on(Bc.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await dr(this,yt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return dt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new xe(J.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new xe(J.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Io.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await dr(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await dr(this,yt.NEED_REPLACE_TRACK,this))}),t.on(Io.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Io.ON_TRACK),t.removeAllListeners(Io.ON_NODE)}bindProcessorContextEvents(t){t.on(Wc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Wc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof HL&&(this._trackSource=new bz(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Nz(this._source.context,this.getTrackId(),"local"),r=new kz(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Bc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Qo.stop(this.getTrackId()),this._source.play()),dr(this,yt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[Vz],Object.getOwnPropertyDescriptor(Ur.prototype,"setVolume"),Ur.prototype),On(Ur.prototype,"setPlaybackDevice",[jz,Fz],Object.getOwnPropertyDescriptor(Ur.prototype,"setPlaybackDevice"),Ur.prototype),On(Ur.prototype,"setEnabled",[Bz,Wz,zz],Object.getOwnPropertyDescriptor(Ur.prototype,"setEnabled"),Ur.prototype),On(Ur.prototype,"setMuted",[Gz,Hz,$z],Object.getOwnPropertyDescriptor(Ur.prototype,"setMuted"),Ur.prototype),On(Ur.prototype,"getStats",[Kz],Object.getOwnPropertyDescriptor(Ur.prototype,"getStats"),Ur.prototype),On(Ur.prototype,"setAudioFrameCallback",[qz],Object.getOwnPropertyDescriptor(Ur.prototype,"setAudioFrameCallback"),Ur.prototype),On(Ur.prototype,"play",[Yz,Xz],Object.getOwnPropertyDescriptor(Ur.prototype,"play"),Ur.prototype),On(Ur.prototype,"stop",[Jz,Qz],Object.getOwnPropertyDescriptor(Ur.prototype,"stop"),Ur.prototype),On(Ur.prototype,"close",[Zz],Object.getOwnPropertyDescriptor(Ur.prototype,"close"),Ur.prototype),On(Ur.prototype,"pipe",[e9],Object.getOwnPropertyDescriptor(Ur.prototype,"pipe"),Ur.prototype),On(Ur.prototype,"unpipe",[t9],Object.getOwnPropertyDescriptor(Ur.prototype,"unpipe"),Ur.prototype),Ur),vP=(n9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),r9=oi(),i9=Kv("MicrophoneAudioTrack","_enabledMutex"),s9=jt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),o9=oi(),a9=jt({argsMap:t=>[t.getTrackId()]}),On((Dh=class extends qr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,o){super(t,r.encoderConfig?gP(r.encoderConfig):{},o,ie("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Gv()||pL())&&nr.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Hc.getDeviceById(t),s={};s.audio=Nr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=await Gc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Gc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Hc.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),ie("AUTO_RESET_AUDIO_ROUTE")&&(Ro()||yu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await dr(this,yt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Nr({},this._constraints),u=Hc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await Gc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await dr(this,yt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Gv()||pL())&&nr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ro()||yu())&&this._enabled&&!this._isClosed&&nr.duringInterruption){const t=async()=>{nr.off(cs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};nr.on(cs.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Zv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=Hc.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await Gc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Wc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Wc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[n9,r9],Object.getOwnPropertyDescriptor(Dh.prototype,"setDevice"),Dh.prototype),On(Dh.prototype,"setEnabled",[i9,s9,o9],Object.getOwnPropertyDescriptor(Dh.prototype,"setEnabled"),Dh.prototype),On(Dh.prototype,"close",[a9],Object.getOwnPropertyDescriptor(Dh.prototype,"close"),Dh.prototype),Dh),Fme=(c9=jt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),l9=oi(),u9=jt({argsMap:t=>[t.getTrackId()]}),d9=oi(),h9=jt({argsMap:t=>[t.getTrackId()]}),p9=oi(),f9=jt({argsMap:t=>[t.getTrackId()]}),m9=oi(),g9=jt({argsMap:t=>[t.getTrackId()]}),_9=oi(),y9=jt({argsMap:t=>[t.getTrackId()]}),E9=jt({argsMap:t=>[t.getTrackId()]}),v9=oi(),On((ws=class extends qr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,o){super(r.createOutputTrack(),s,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Bc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Zv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ir(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[c9,l9],Object.getOwnPropertyDescriptor(ws.prototype,"startProcessAudioBuffer"),ws.prototype),On(ws.prototype,"pauseProcessAudioBuffer",[u9,d9],Object.getOwnPropertyDescriptor(ws.prototype,"pauseProcessAudioBuffer"),ws.prototype),On(ws.prototype,"seekAudioBuffer",[h9,p9],Object.getOwnPropertyDescriptor(ws.prototype,"seekAudioBuffer"),ws.prototype),On(ws.prototype,"resumeProcessAudioBuffer",[f9,m9],Object.getOwnPropertyDescriptor(ws.prototype,"resumeProcessAudioBuffer"),ws.prototype),On(ws.prototype,"stopProcessAudioBuffer",[g9,_9],Object.getOwnPropertyDescriptor(ws.prototype,"stopProcessAudioBuffer"),ws.prototype),On(ws.prototype,"close",[y9],Object.getOwnPropertyDescriptor(ws.prototype,"close"),ws.prototype),On(ws.prototype,"setAudioBufferPlaybackSpeed",[E9,v9],Object.getOwnPropertyDescriptor(ws.prototype,"setAudioBufferPlaybackSpeed"),ws.prototype),ws);class Oi extends qr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=rS().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,hr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}oP(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Oi?s.emit(X_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Bme extends Sz{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Bc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const S9=new Map;class KL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",Nh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",io.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&nr.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(bW())),PW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=io.PLAYING;break;case"loadeddata":if(this.videoState=Nh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=io.CANPLAY;break;case"stalled":this.videoElementStatus=io.STALLED;break;case"suspend":this.videoElementStatus=io.SUSPEND;break;case"pause":this.videoElementStatus=io.PAUSED,Ro()||yu()||vs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=io.WAITING;break;case"abort":this.videoElementStatus=io.ABORT;break;case"ended":this.videoElementStatus=io.ENDED;break;case"emptied":this.videoElementStatus=io.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=io.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,cf.lastVisibleTime<cf.lastHiddenTime||u<cf.lastHiddenTime||u<cf.lastVisibleTime)return;for(c>ie("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(bW())),PW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),nr.on(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.on(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&Az(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=An();if((o.name==="Safari"&&Number(o.version)===15||Gv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new dt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const y=await Uz(m);u({buffer:y,width:o.width,height:o.height})}else h(new xe(J.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await $L(r)}destroy(){this.renderStats=void 0,nr.off(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.off(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Nh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=io.INIT,!this.videoElementCheckInterval&&(b9.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=io.DESTROYED)},1e3),ie("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,ie("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Nh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Nh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,T)=>{if(this.videoElementStatus===io.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=T.mediaTime):this.renderStats={lastTs:T.mediaTime,curTs:T.mediaTime,lastRenderNum:0,renderNum:0},u){const N=T.presentationTime-u.presentationTime;this.videoState===Nh.VideoStateStarting&&(this.videoState=Nh.VideoStateDecoding),this.videoState===Nh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,ie("VIDEO_FREEZE_DURATION"))),N<ie("VIDEO_FREEZE_DURATION")&&this.videoState===Nh.VideoStateFrozen&&(this.videoState=Nh.VideoStateDecoding),N>ie("VIDEO_FREEZE_DURATION")&&cf.lastVisibleTime>=cf.lastHiddenTime&&u.timestamp>cf.lastVisibleTime&&u.timestamp>cf.lastHiddenTime&&(this.renderFreezeAccTime+=N)}u=Nr(Nr({},T),{},{timestamp:v})}var R,P;ie("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),sP()&&!ie("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=An();o.name==="Safari"&&Number(o.version)===15||Gv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){b9.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=io.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,RT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};RT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),Iz()}}const b9=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class T9 extends KL{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await $L(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",ie("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var w9,C9,R9,I9,A9,P9,O9,k9,N9,D9,x9,L9,M9,U9,V9,j9,F9,B9,W9,z9,G9,H9,$9,K9,wn,q9,Y9,X9,J9,Q9,Z9,eG,tG,Kc;let Tr=(w9=jt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),C9=oi(),R9=jt({argsMap:t=>[t.getTrackId()]}),I9=Kv("LocalVideoTrack","_enabledMutex"),A9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),P9=oi(),O9=Kv("LocalVideoTrack","_enabledMutex"),k9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),N9=oi(),D9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),x9=oi(),L9=oi(),M9=jt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),U9=oi(),V9=oi(),j9=oi(),F9=oi(),B9=oi(),W9=oi(),z9=oi(),G9=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),H9=jt({argsMap:t=>[t.getTrackId()]}),$9=jt({argsMap:t=>[t.getTrackId()]}),K9=jt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),wn=class Aae extends nS{get videoHeight(){if(vs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(vs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==io.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,u,h){if(super(r,u),Pe(this,"trackMediaType",tS.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),vs()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(pr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(uL(Bn.CHROME,115)&&rP().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&Mn().supportWebRTCInsertableStream){const T=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,N,G=Date.now();const j=()=>{W&&(clearInterval(W),W=void 0),P&&(P.close(),P=void 0),y.stop(),N=void 0,R.removeEventListener("ended",j)};let W=window.setInterval(()=>{if(N&&P&&Date.now()-G>1e3)try{R.readyState==="live"?N.enqueue(P.clone()):j()}catch{j()}},1e3);const Y=new TransformStream({transform:(X,ue)=>{R.readyState==="live"?(N=ue,G=Date.now(),P===void 0?(P=X,ue.enqueue(X.clone())):(ue.enqueue(P),P=X)):X.close()}});return R.addEventListener("ended",j),T.readable.pipeThrough(Y).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(pr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Oz(this.getTrackId(),"local"),this._processorDestination=new Pz(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Nr(Nr(Nr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new KL(o):this._player=new T9(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Zv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},ie("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await dr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await dr(this,yt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await dr(this,yt.NEED_MUTE_TRACK,this):await dr(this,yt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new xe(J.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=kh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=EP({encoderConfig:r});(vs()||Ro()||yu())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new xe(J.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(pr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await dr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Bm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Vc(this,yt.GET_STATS)||Nr({},jL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await $L(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(J.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await dr(this,yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(J.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){Dz(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(cP)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new xe(J.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=kh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(pr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await dr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(y,v,T,R,P){const N=ie("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const W=Math.floor(200*Math.pow(T/15,.6)*Math.pow(y*v/640/360,.75));P=N==="STANDARD_BITRATE"?4*W:2*W,R=(G=R)!==null&&G!==void 0?G:W}else{var j;R=(j=R)!==null&&j!==void 0?j:Math.floor(P/10)}return{min:R,max:P}}(r,s,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=xW.checkOneElementVisible(u),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=Rt.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(o){throw new xe(J.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new xe(J.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Nr(Nr({},o),kh(r))),o=$_(o);const c=hr(8,"track-video-cloned-"),u=new Aae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,$_(this._scalabilityMode),this._optimizationMode,c,$_(this._hints));return r&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new xe(J.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new xe(J.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Bm(()=>{Rt.reportApiInvoke(null,{name:Ti.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Wr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!ie("ENABLE_VIDEO_SEI")||!ie("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new xe(J.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Io.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await dr(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await dr(this,yt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Io.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Wc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Wc.REQUEST_CONSTRAINTS)}},On(wn.prototype,"play",[w9,C9],Object.getOwnPropertyDescriptor(wn.prototype,"play"),wn.prototype),On(wn.prototype,"stop",[R9],Object.getOwnPropertyDescriptor(wn.prototype,"stop"),wn.prototype),On(wn.prototype,"setEnabled",[I9,A9,P9],Object.getOwnPropertyDescriptor(wn.prototype,"setEnabled"),wn.prototype),On(wn.prototype,"setMuted",[O9,k9,N9],Object.getOwnPropertyDescriptor(wn.prototype,"setMuted"),wn.prototype),On(wn.prototype,"setEncoderConfiguration",[D9,x9],Object.getOwnPropertyDescriptor(wn.prototype,"setEncoderConfiguration"),wn.prototype),On(wn.prototype,"getStats",[L9],Object.getOwnPropertyDescriptor(wn.prototype,"getStats"),wn.prototype),On(wn.prototype,"setBeautyEffect",[M9,U9],Object.getOwnPropertyDescriptor(wn.prototype,"setBeautyEffect"),wn.prototype),On(wn.prototype,"getCurrentFrameData",[V9],Object.getOwnPropertyDescriptor(wn.prototype,"getCurrentFrameData"),wn.prototype),On(wn.prototype,"getCurrentFrameImage",[j9],Object.getOwnPropertyDescriptor(wn.prototype,"getCurrentFrameImage"),wn.prototype),On(wn.prototype,"setBitrateLimit",[F9],Object.getOwnPropertyDescriptor(wn.prototype,"setBitrateLimit"),wn.prototype),On(wn.prototype,"setOptimizationMode",[B9],Object.getOwnPropertyDescriptor(wn.prototype,"setOptimizationMode"),wn.prototype),On(wn.prototype,"setScalabiltyMode",[W9],Object.getOwnPropertyDescriptor(wn.prototype,"setScalabiltyMode"),wn.prototype),On(wn.prototype,"updateMediaStreamTrackResolution",[z9],Object.getOwnPropertyDescriptor(wn.prototype,"updateMediaStreamTrackResolution"),wn.prototype),On(wn.prototype,"pipe",[G9],Object.getOwnPropertyDescriptor(wn.prototype,"pipe"),wn.prototype),On(wn.prototype,"unpipe",[H9],Object.getOwnPropertyDescriptor(wn.prototype,"unpipe"),wn.prototype),On(wn.prototype,"close",[$9],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),On(wn.prototype,"replaceTrack",[K9],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),wn),qL=(q9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),Y9=oi(),X9=Kv("CameraVideoTrack","_enabledMutex"),J9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),Q9=oi(),Z9=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),eG=oi(),tG=jt({argsMap:t=>[t.getTrackId()]}),Kc=class Pae extends Tr{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,u,h){super(r,kh(s.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Gv()||pL())&&!function(){const m=An();if(m.os!==ji.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&OW()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=kh(this._config.encoderConfig),nr.on(cs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),nr.on(cs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await Hc.getDeviceById(r),o={};o.video=Nr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Gc(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Gc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Hc.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Nr(Nr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Gc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Gc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Nr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Gc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await dr(this,yt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await dr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new xe(J.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=kh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=zr(this._config);o.encoderConfig=r;const c=EP(o);(vs()||Ro()||yu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new xe(J.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(pr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await dr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ro()||yu())&&this._enabled&&!this._isClosed&&nr.duringInterruption){const r=async()=>{nr.off(cs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};nr.on(cs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Zv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=Hc.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await Gc({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),nr.off(cs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),nr.off(cs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Nr(Nr({},o),kh(r))),o=$_(o);const c=hr(8,"track-cam-cloned-"),u=new Pae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,$_(Nr(Nr({},this._config),{},{encoderConfig:o})),$_(this._constraints),$_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(Wc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(Wc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},On(Kc.prototype,"setDevice",[q9,Y9],Object.getOwnPropertyDescriptor(Kc.prototype,"setDevice"),Kc.prototype),On(Kc.prototype,"setEnabled",[X9,J9,Q9],Object.getOwnPropertyDescriptor(Kc.prototype,"setEnabled"),Kc.prototype),On(Kc.prototype,"setEncoderConfiguration",[Z9,eG],Object.getOwnPropertyDescriptor(Kc.prototype,"setEncoderConfiguration"),Kc.prototype),On(Kc.prototype,"close",[tG],Object.getOwnPropertyDescriptor(Kc.prototype,"close"),Kc.prototype),Kc);function YL(t,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Nr(Nr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var nG,rG,iG,sG,Il,oG,aG,cG,lG,uG,dG,so;class hG extends yz{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(hr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let sS=(nG=jt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),rG=jt({argsMap:t=>[t.getTrackId()]}),iG=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),sG=jt({argsMap:t=>[t.getTrackId()]}),On((Il=class extends hG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==io.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",tS.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Oz(this.getTrackId(),"remote"),this.processorDestination=new Pz(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Bm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Vc(this,yt.GET_STATS)||Nr({},gz)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Nr(Nr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new KL(s):this._player=new T9(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(eS.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(eS.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(eS.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},ie("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Dz(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(cP)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=xW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=Rt.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new xe(J.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new xe(J.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Io.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Io.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(X_.SEI_RECEIVED,t)}}).prototype,"play",[nG],Object.getOwnPropertyDescriptor(Il.prototype,"play"),Il.prototype),On(Il.prototype,"stop",[rG],Object.getOwnPropertyDescriptor(Il.prototype,"stop"),Il.prototype),On(Il.prototype,"pipe",[iG],Object.getOwnPropertyDescriptor(Il.prototype,"pipe"),Il.prototype),On(Il.prototype,"unpipe",[sG],Object.getOwnPropertyDescriptor(Il.prototype,"unpipe"),Il.prototype),Il),oS=(oG=jt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),aG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),cG=jt({argsMap:t=>[t.getTrackId()]}),lG=jt({argsMap:t=>[t.getTrackId()]}),uG=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),dG=jt({argsMap:t=>[t.getTrackId()]}),On((so=class extends hG{get isPlaying(){return this._useAudioElement?Qo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"trackMediaType",tS.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),ie("DISABLE_WEBAUDIO")?(this._source=new HL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bz(t,!0),ie("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Bc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(eS.FIRST_FRAME_DECODED)}),this.processorContext=new Nz(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new kz(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Bc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Bc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Bc.ON_AUDIO_BUFFER),this._source.on(Bc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?Qo.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!hz())throw new xe(J.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qo.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Bm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Vc(this,yt.GET_STATS)||Nr({},mz)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new xe(J.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new xe(J.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new xe(J.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Io.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Io.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Io.ON_TRACK),this.processorDestination.removeAllListeners(Io.ON_NODE)}}).prototype,"setVolume",[oG],Object.getOwnPropertyDescriptor(so.prototype,"setVolume"),so.prototype),On(so.prototype,"setPlaybackDevice",[aG],Object.getOwnPropertyDescriptor(so.prototype,"setPlaybackDevice"),so.prototype),On(so.prototype,"play",[cG],Object.getOwnPropertyDescriptor(so.prototype,"play"),so.prototype),On(so.prototype,"stop",[lG],Object.getOwnPropertyDescriptor(so.prototype,"stop"),so.prototype),On(so.prototype,"pipe",[uG],Object.getOwnPropertyDescriptor(so.prototype,"pipe"),so.prototype),On(so.prototype,"unpipe",[dG],Object.getOwnPropertyDescriptor(so.prototype,"unpipe"),so.prototype),so);const cf=new class extends Mr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class pG extends Mr{constructor(r,s){super(),Pe(this,"trackMediaType",tS.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return ie("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new dt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new xe(J.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new xe(J.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new xe(J.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[_P.OPEN,_P.CLOSE,_P.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Wme extends pG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(ie("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(_P.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class zme extends pG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function SP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>SA.revokeObjectURL(t),0),new Worker(SA.createObjectURL(t))}const fG=71,XL=1,JL=2,QL=1,mG=2;var lf=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(lf||{});function gG(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==fG)return;const o=t.getUint16(1),c=XL+JL+o,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:u};let m=XL+JL;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+QL),T=QL+mG;if(y===lf.AUDIO_LEVEL){let R=t.getUint8(m+T);for(let P=1;P<v;P++)R=R<<8|t.getUint8(m+T+P);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===lf.METADATA||y===lf.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let P=0;P<v;P++)R[P]=t.getUint8(m+T+P);h.tlv.push({tag:y,length:v,value:R})}m+=T+v}return h}const bP=new Map,TP=127,Z_=1e-10,ZL=139/13,wP=new Map;function e2(t,r,s){const o="".concat(t,"-").concat(r,"-").concat(s);let c=0;return wP.has(o)?c=wP.get(o):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let T=h,R=1;T>m;T--,R++)v=v*T/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,wP.set(o,c)),c<Z_&&(c=Z_),c}function _G(t,r,s){const o=r.length,c=t.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,u=!0)}return u}window.cache=wP;let Gme=0;class yG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",Z_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",Z_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",Z_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Gme++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+ZL;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<o&&(h=0);const m=Math.floor(h/ZL);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return _G(this.mediums,this.longs,4)}computeMediums(){return _G(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=e2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=e2(this.longs[0],10,47),this.longSpeechActivityScore>Z_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=e2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(fm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>TP&&(o=TP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+ZL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>TP&&(s=TP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Hme{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class t2{constructor(r,s,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class $me extends Mr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(s,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new yG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new t2(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new t2(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new t2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Hme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Mc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const T=this.speakers.entries().next();T.value&&(u=T.value[0],m=T.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const T of this.speakers.entries()){const[R,P]=T;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let W=0;W<y.length;++W){const Y=m==null?Z_:m.getSpeechActivityScore(W);y[W]=Math.log(P.getSpeechActivityScore(W)/Y)}const N=y[0],G=y[1],j=y[2];N>3&&G>2&&j>0&&G>v&&(v=G,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of Mc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const aS=new Map;let Ad=null,CP=null;const EG=3;let ey=[];const Pd=new Map,RP=new Map;class Kme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(Pd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],u=[];return Array.from(Mc(Pd).call(Pd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(Mc(Pd).call(Pd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(Mc(Pd).call(Pd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let IP;function vG(t){const r=Pd.get(t);r&&(Pd.delete(t),r.clearTimer())}const AP=new Map,qme=new Map;function Yme(t,r,s){let o=new Uint8Array(t,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const PP=new Map,MT=new Map;(function(){const t=An();as.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),as.getStreamFromExtension=t.name===Bn.CHROME&&Number(t.version)>34,as.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),as.supportMinBitrate=t.name===Bn.CHROME||t.name===Bn.EDGE,as.supportSetRtpSenderParameters=function(){const r=An();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!sf()||!(!vs()&&!iP())||r.name===Bn.FIREFOX&&Number(r.version)>=64)}(),t.name===Bn.SAFARI&&(Number(t.version)>=14?as.supportDualStream=!0:as.supportDualStream=!1),as.webAudioMediaStreamDest=function(){const r=An();return!(r.name===Bn.SAFARI&&Number(r.version)<12)}(),as.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",as.supportWebGL=typeof WebGLRenderingContext<"u",as.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,sf()||(as.webAudioWithAEC=!0),as.supportShareAudio=function(){const r=An();return(r.os===ji.WIN_10||r.os===ji.WIN_81||r.os===ji.WIN_7||r.os===ji.LINUX||r.os===ji.MAC_OS||r.os===ji.CHROMIUM_OS)&&r.name===Bn.CHROME&&Number(r.version)>=74}(),as.supportDataChannel=!!(CT(76)||function(r){const s=An();return!(s.name!==Bn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||CW(14)),as.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Fr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),as.supportWebRTCEncodedTransform=function(){const r=An();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),as.supportWebRTCInsertableStream=function(){const r=An();return(r.name===Bn.CHROME||r.name===Bn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),as.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,as.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,aP(()=>{as.supportDualStreamEncoding=function(){const r=An();return!!ie("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&ie("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",as)})})();const Xme=["CHINA","GLOBAL"],SG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ty=[],cS=[];function ny(t,r){return!!r&&ty.some(s=>s.uid===t&&s.channelName===r)}function n2(){return cS.length>0}var Jme=z6.forEach,bG=Np("forEach")?[].forEach:function(t){return Jme(this,t,arguments.length>1?arguments[1]:void 0)};Fn({target:"Array",proto:!0,forced:[].forEach!=bG},{forEach:bG});var Qme=Qa("Array").forEach,Zme=Cc,ege=vi,tge=k,nge=Qme,r2=Array.prototype,rge={DOMTokenList:!0,NodeList:!0},ige=function(t){var r=t.forEach;return t===r2||tge(r2,t)&&r===r2.forEach||ege(rge,Zme(t))?nge:r},sge=l(ige),oge=xo,TG=Ac;Fn({target:"Object",stat:!0,forced:d(function(){TG(1)})},{keys:function(t){return TG(oge(t))}});var wG=l(vt.Object.keys),age=l(yE),cge=l(vE),lge=Fn,CG=o_,uge=P_,dge=_t,RG=me,hge=hi,pge=Ce,fge=lA,mge=yr,gge=gs,_ge=D6("slice"),yge=mge("species"),i2=Array,Ege=Math.max;lge({target:"Array",proto:!0,forced:!_ge},{slice:function(t,r){var s,o,c,u=pge(this),h=hge(u),m=RG(t,h),y=RG(r===void 0?h:r,h);if(CG(u)&&(s=u.constructor,(uge(s)&&(s===i2||CG(s.prototype))||dge(s)&&(s=s[yge])===null)&&(s=void 0),s===i2||s===void 0))return gge(u,m,y);for(o=new(s===void 0?i2:s)(Ege(y-m,0)),c=0;m<y;m++,c++)m in u&&fge(o,c,u[m]);return o.length=c,o}});var vge=Qa("Array").slice,Sge=k,bge=vge,s2=Array.prototype,Tge=function(t){var r=t.slice;return t===s2||Sge(s2,t)&&r===s2.slice?bge:r},wge=l(Tge);function Et(t,r,s,o,c){var u,h,m,y={};return sge(u=wG(o)).call(u,function(v){y[v]=o[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=age(h=cge(m=wge(s).call(s)).call(m)).call(h,function(v,T){return T(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(P6(t,r,y),y=null),y}let OP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),o2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Su=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ao=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Mt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),gr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),zt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Wt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),UT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),En=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Po=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Xt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function kP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Oe(J.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function NP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||DW(t,1,255)))throw new Oe(J.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let uf=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Cge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},a2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function c2(t,r){ss(t.url,"".concat(r,".url"),1,1e3,!1),Br(t.x)||ir(t.x,"".concat(r,".x"),0,1e4),Br(t.y)||ir(t.y,"".concat(r,".y"),0,1e4),Br(t.width)||ir(t.width,"".concat(r,".width"),0,1e4),Br(t.height)||ir(t.height,"".concat(r,".height"),0,1e4),Br(t.zOrder)||ir(t.zOrder,"".concat(r,".zOrder"),0,255),Br(t.alpha)||ir(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Rge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Gm=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),l2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),ki=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function IG(t){if(!t.channelName)throw new Oe(J.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(J.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ss(t.token,"info.token",1,2047),NP(t.uid),kP(t.channelName),!0}let Oo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),df=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ia=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),lS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),qn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),es=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),DP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Bi=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Wn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const AG=[Wn.AFRICA,Wn.ASIA,Wn.CHINA,Wn.EUROPE,Wn.GLOBAL,Wn.INDIA,Wn.JAPAN,Wn.NORTH_AMERICA,Wn.OCEANIA,Wn.OVERSEA,Wn.SOUTH_AMERICA];let ks=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const xP={CHINA:{},ASIA:{CODE:ks.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ks.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ks.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ks.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ks.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ks.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ks.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ks.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ks.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ks.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ks.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ks.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ks.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};OL&&(xP.CHINA={CODE:ks.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let VT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function PG(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class OG extends Mr{constructor(r,s){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class kG extends OG{constructor(r,s){super(r,s),K(this,"establishPromise",void 0)}}let gt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ns=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),hf=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const NG=["disconnected","failed"];let Ke=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Kn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Nt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),bu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Tu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ts=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),DG=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),xh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Al=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Od=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),uS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ai=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),dS=function(t){return t.ABORT="abort",t}({}),Hm=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Ige=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Age={[OP.ACCESS_POINT]:{[Ao.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ao.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ao.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ao.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ao.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ao.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[OP.UNILBS]:{[Su.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Su.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Su.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Su.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Su.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Su.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Su.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Su.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Su.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Su.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Su.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Su.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[OP.STRING_UID_ALLOCATOR]:{[o2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[o2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[o2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function hS(t){const r=Age[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===OP.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Pge={[Mt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Mt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Mt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Mt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Mt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Mt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Mt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Mt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Mt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Mt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Mt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Mt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Mt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Mt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Mt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Mt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Mt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Mt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Mt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Mt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Mt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Mt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Mt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Mt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Mt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Mt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Mt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Mt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Mt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Mt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Mt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Mt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Mt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Mt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Mt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Mt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Mt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Mt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Mt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Mt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Mt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Mt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Mt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Mt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Mt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Mt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Mt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Mt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Mt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Mt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Mt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Mt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Mt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Mt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Mt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Mt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function jT(t){return Pge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function xG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function u2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?xG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):xG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function LG(t,r){if(typeof t=="string")return t;const{proxy:s,host:o,port:c}=t;if(r){const u=ie("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Oge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,kge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Nge=/wss:\/\/(.+):([0-9]+)\/?/,Dge=/wss:\/\/(.[^\/]+)\/?/;let xge=0;class Lge{constructor(r,s){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++xge,this.try443PortDuration=ie("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=ie("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var N;return at(N=r.host).call(N,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(LG(u2(u2({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=u2({},r);if(s&&m){const N=c.find(G=>G!==m);N&&(P.host=P.host.replace(m,N))}y.push(LG(P,s))}try{y.forEach(P=>{const N=new WebSocket(P);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(N=>N.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(J.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const v=wT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(N=>{N!==P&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))}),this.websockets.length=0,v.resolve(P)},P.onclose=N=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),v.reject({code:N.code,reason:DP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=N=>this.logger("".concat(P.url," onmessage: ").concat(N.data))}),this.websockets.push(...h);const T=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(v.isResolved)return T();An().os===ji.MAC_OS&&Fr()&&T(),this.createWebSocket(r,!0,!0).then(P=>{v.resolve(P)}).catch(P=>{this.isNormalPortFailed&&v.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,T()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,T()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,y;return[,h,m,y]=u.match(Oge)||[],h||([,m,y]=u.match(kge)||[]),m&&y||([,m,y]=u.match(Nge)||[]),m&&y||([,m]=u.match(Dge)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function MG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class UG extends Mr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;at(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Xt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Xt.CONNECTED):this._state==="closed"?this.emit(Xt.CLOSED):this._state==="failed"&&this.emit(Xt.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var N=arguments[P]!=null?arguments[P]:{};P%2?MG(Object(N),!0).forEach(function(G){K(R,G,N[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(N)):MG(Object(N)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(N,G))})}return R}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Os("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),T=Math.max(1.2,Math.floor(8*y)/10);oc.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=T),fi.on(Hv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===oc.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=T):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=wT(),u=this.urls[this.currentURLIndex];ie("ENABLE_PREALLOC_PC")&&this.emit(DG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Xt.CLOSED,()=>{c.reject(new xe(J.WS_DISCONNECT))}),this.once(Xt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new xe(J.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new xe(J.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=wT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=T=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),T),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async T=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(T.code,", reason: ").concat(T.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new xe(J.WS_DISCONNECT,"websocket close: ".concat(T.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=T.reason,this.state="reconnecting");const P=Vc(this,Xt.WILL_RECONNECT,this.reconnectMode,T.reason)||this.reconnectMode,N=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return o.reject(new xe(J.WS_DISCONNECT,"websocket reconnect failed: ".concat(T.code))),this.close(!0);o.resolve()}},h=T=>{this.emit(Xt.ON_MESSAGE,T)},m=T=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(T))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),ie("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=ie("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const T=await this.chooseBestWebsocketConnection(r);this.websocket=T,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(T){const R=this.state==="closed",P=T instanceof xe,N=P&&T.code===J.WS_ABORT,G=P&&T.code===J.WS_ERR,j=P?T.message:T&&(T.reason||T.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[T]},y),R||G?(o.reject(R?new xe(J.WS_DISCONNECT,"websocket is closed: ".concat(j)):new xe(J.WS_ERR,"init websocket failed: ".concat(j))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(j))):u&&u(T)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||fi.isOnline||!fi.onlineWaiter||(this.onlineReconnectListener=fi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=bL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await dt.race([os(h),this.onlineReconnectListener||new dt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Xt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await bs(this,Xt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&at(m).call(m,"dynamic key expired")?(this.emit(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class d2 extends UG{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=wT(),c=function(h,m){return new Lge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new xe(J.WS_ABORT,"choose best websocket aborted"))};const u=ie("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class FT extends UG{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new dt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new xe(J.WS_ABORT,"choose best websocket aborted"))};const m=ie("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),T=m.find(G=>v!==-1?at(r).call(r,G,v):at(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",T,", domains: ",m);let R=!this.tryDoubleDomain||!T;if(!R&&T){var P;const G=Date.now();try{m.forEach(j=>{const W=v===-1?r.replace(T,j):r.substr(0,v)+r.substr(v).replace(T,j),Y=new WebSocket(W);Y.binaryType="arraybuffer",h.push(Y),x.debug("[choose-best-ws] ws is connecting:",Y.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(W=>W.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(u)return;const W=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(W,"ms")),h.filter(Y=>Y!==j).forEach(Y=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Y.url)),Y.close()}),u=!0,o(j)},j.onclose=W=>{y=W,!u&&(h.find(Y=>!(Y.readyState===WebSocket.CLOSED||Y.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(y)))},j.onmessage=W=>{x.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(W.data))}}),os(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(R){var N;let G;x.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(j){const W=new xe(J.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return x.error("[".concat(this.name,"]").concat(W)),void c(W)}G.onopen=()=>{o(G)},G.onclose=j=>{c(j)},G.onmessage=j=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(j.data))},os(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Mge extends Mr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===gr.CONNECTED?this.emit(zt.WS_CONNECTED):r===gr.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):r===gr.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",gr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new YW(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close($n.UID_BANNED);break;case 15:this.close($n.IP_BANNED);break;case 16:this.close($n.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close($n.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close($n.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close($n.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close($n.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($n.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close($n.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new d2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,ie("JOIN_GATEWAY_USE_DUAL_DOMAIN"),ie("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===gr.CONNECTED&&this.reconnect("retry",Ss.OFFLINE)})}async request(r,s,o,c){const u=hr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new dt((G,j)=>{if(this.connectionState===gr.CONNECTED)return G();const W=()=>{this.off(zt.WS_CLOSED,Y),G()},Y=()=>{this.off(zt.WS_CONNECTED,W),j(new Oe(J.WS_ABORT))};this.once(zt.WS_CONNECTED,W),this.once(zt.WS_CLOSED,Y),r!==Wt.PUBLISH&&r!==Wt.PUBLISH_DATASTREAM&&r!==Wt.SUBSCRIBE&&r!==Wt.SUBSCRIBE_DATASTREAM&&r!==Wt.UNSUBSCRIBE&&r!==Wt.UNSUBSCRIBE_DATASTREAM&&r!==Wt.UNPUBLISH&&r!==Wt.UNPUBLISH_DATASTREAM&&r!==Wt.CONTROL&&r!==Wt.RESTART_ICE||this.once(zt.DISCONNECT_P2P,()=>{j(new Oe(J.DISCONNECT_P2P))}),r!==Wt.PUBLISH&&r!==Wt.RESTART_ICE||this.once(zt.ABORT_P2P_EXECUTION,()=>{j(new Oe(J.DISCONNECT_P2P))})});if(this.connectionState!==gr.CONNECTING&&this.connectionState!==gr.RECONNECTING||r===Wt.JOIN||r===Wt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new dt((G,j)=>{let W=!1;const Y=(ue,ye)=>{W=!0,G({isSuccess:ue==="success",message:ye||{}}),this.off(zt.WS_CLOSED,X),this.off(zt.WS_RECONNECTING,X),this.emit(zt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Y);const X=()=>{j(new Oe(J.WS_ABORT,"type: ".concat(r))),this.off(zt.WS_CLOSED,X),this.off(zt.WS_RECONNECTING,X),this.off("res-@".concat(u),Y)};this.once(zt.WS_CLOSED,X),this.once(zt.WS_RECONNECTING,X),os(ie("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(zt.REQUEST_TIMEOUT,r,s))})});let T=null;try{T=await v}catch(G){if(this.connectionState===gr.CLOSED||r===Wt.LEAVE)throw new Oe(J.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Wt.JOIN||r===Wt.REJOIN?null:(await y(),await this.request(r,s))}if(T.isSuccess)return T.message;const R=Number(T.message.error_code||T.message.code),P=jT(R),N=new Oe(J.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(T.message.error_str),{code:R,data:T.message,desc:P.desc});return P.action==="success"?T.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Wt.JOIN||r===Wt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ss.MULTI_IP)):this.reconnect(P.action,Ss.SERVER_ERROR),r===Wt.JOIN||r===Wt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new dt(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(UT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=ie("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==gr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},ie("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((s,o)=>{this.once(zt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(zt.WS_CLOSED,c=>o(this.initError||new Oe(J.WS_ABORT,c))),this.connectionState=gr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||$n.LEAVE,this.connectionState=gr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const r=await bs(this,zt.REQUEST_JOIN_INFO),s=await this.request(Wt.JOIN,r);if(!s)return this.emit(zt.REPORT_JOIN_GATEWAY,DP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(J.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=OT(this,zt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Wt.REJOIN,r);return!!s&&(this.connectionState=gr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(En.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(En.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(En.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(En.MUTE_AUDIO,{uid:o.uid}):this.emit(En.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(En.MUTE_VIDEO,{uid:o.uid}):this.emit(En.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(En.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(En.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(En.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=jT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(zt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($n.UID_BANNED),void this.close()):void this.reconnect(s.action,Ss.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=ie("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ie("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ss.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),ie("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(UT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Xt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Xt.CLOSED,()=>{this.connectionState=gr.CLOSED}),this.websocket.on(Xt.FAILED,()=>{this._disconnectedReason=$n.NETWORK_ERROR,this.connectionState=gr.CLOSED}),this.websocket.on(Xt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===gr.CONNECTED?this.connectionState=gr.RECONNECTING:this.connectionState=gr.CONNECTING}),this.websocket.on(Xt.WILL_RECONNECT,(r,s,o)=>{const c=OT(this,zt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=DP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(zt.REPORT_JOIN_GATEWAY,s||DP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(zt.DISCONNECT_P2P)),o(r)}),this.websocket.on(Xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ss.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===J.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return this.initError=new Oe(J.TOKEN_EXPIRE,"dynamic key expired"),void this.close($n.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ss.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Xt.REQUEST_NEW_URLS,(r,s)=>{bs(this,zt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(DG.PRE_CONNECT_PC,()=>{this.emit(zt.PRE_CONNECT_PC)})}}let Uge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),mi=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function VG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function LP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function $m(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(ie("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function h2(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(ie("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:N}=R;return{address:"".concat(P,":").concat(N)}});const v=ie("GATEWAY_DOMAINS");let T=v[1]&&at(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:N,ip:G}=R;if(P)return{address:"".concat(P,".").concat(v[T++%v.length],":").concat(N)};const j=/^[\.\:\d]+$/.test(G),W=j?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[T++%v.length],":").concat(N):"".concat(G,":").concat(N);return j||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:N,address:W}})}(t.addresses,r),o=Array.isArray(t.detail)&&t.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let y=0;y<m.length;y++){var c;const v=ro(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[m,y]=u.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function ac(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function jG(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(ac(r.width),"x").concat(ac(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function FG(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function BT(t,r){let s,o,c;switch(r){case mi.CHOOSE_SERVER:o=4096,c="choose server";break;case mi.CLOUD_PROXY:o=1048576,c="proxy";break;case mi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case mi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(J.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>LP(LP({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:LP(LP({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!s)throw new Oe(J.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function BG(t,r){return await dt.all(t.addresses.map(async s=>({address:ie("USE_TURN_IP")?s.ip:$m(s.ip),tcpport:s.port,udpport:s.port,username:r&&ie("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ts.username,password:r&&ie("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await yL(r.toString()):Ts.password})))}function p2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(ac(t.height),ac(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Km(t){let{candidateType:r,relayProtocol:s,type:o,address:c,port:u,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=u}return m}function MP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ie("SVC_MODE");if(ie("ENABLE_SVC"))return function(r){return r in dP}(t)?t:dP.L1T3}const WG={[gt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[gt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function UP(t,r,s){r.forEach(o=>{var c;const u=WG[t].find(m=>{var y;let{key:v}=m;return at(y=o.extensionName).call(y,v)});if(!u)return;const h=s.find(m=>{let{extensionName:y}=m;return at(y).call(y,u.key)});h&&at(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function pS(t,r){r.forEach(s=>{var o;const c=WG[t].find(u=>{var h;let{key:m}=u;return at(h=s.extensionName).call(h,m)});at(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function zG(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||at(t).call(t,"abs-send-time")}function VP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||at(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function GG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function HG(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?GG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):GG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function WT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let T=[],R=[],P=[],N=[],G=!1,j=!1;if(Ra(t).mediaDescriptions.forEach(Y=>{o&&o!==Y.attributes.direction||(Y.media.mediaType!=="video"||G||(R=Y.attributes.payloads,N=Y.attributes.extmaps,G=!0),Y.media.mediaType!=="audio"||j||(T=Y.attributes.payloads,P=Y.attributes.extmaps,j=!0))}),!N||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||T.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(Y=>{var X;(X=Y.rtpMap)!==null&&X!==void 0&&X.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),v&&Y.rtcpFeedbacks.push({type:"rrtr"})}),T.forEach(Y=>{var X;(X=Y.rtpMap)!==null&&X!==void 0&&X.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),v&&Y.rtcpFeedbacks.push({type:"rrtr"})}),c&&(T=T.filter(Y=>{var X;return((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())!=="rtx"}),R=R.filter(Y=>{var X;return((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(Y=>{var X;return!/(red)|(ulpfec)|(flexfec)/i.test(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName)||"")})),h&&(T=T.filter(Y=>{var X;return!/(red)|(ulpfec)|(flexfec)/i.test(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(T=T.filter(Y=>{var X;return at(m).call(m,((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const Y=R.filter(X=>{var ue;return at(y).call(y,((ue=X.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())||"")});R=Y.concat(c?[]:g2(Y,R))}const W=ie("UNSUPPORTED_VIDEO_CODEC");return W&&W.length>0&&(R=R.filter(Y=>!(Y.rtpMap&&at(W).call(W,Y.rtpMap.encodingName.toLowerCase())))),{audioCodecs:T,videoCodecs:R,audioExtensions:P,videoExtensions:N}}function qm(t){const r=Ra(t);let s,o;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function $G(t,r){const s=[],o=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=o.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function KG(t,r,s){const{cname:o}=t;let c=[];r&&(c=qG(r)),c.length===0&&(c=t.iceParameters.candidates.map(T=>({foundation:T.foundation,componentId:"1",transport:T.protocol,priority:T.priority.toString(),connectionAddress:T.ip,port:T.port.toString(),type:T.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(T=>({hashFunction:T.algorithm,fingerprint:T.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=FP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(T=>{v.push({kind:gt.VIDEO,ssrcId:T.v,rtx:T.v_rtx,mslabel:"".concat(T.v,"_").concat(T.a)},{kind:gt.AUDIO,ssrcId:T.a,mslabel:"".concat(T.v,"_").concat(T.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:o,preSSRCs:v}}function qG(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function ry(t,r,s){const o=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:m}=u;const y=hr(8,"track-"),v={ssrcId:h,attributes:HG({label:y,mslabel:s=s||hr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(o.push(v),m!==void 0){const T={ssrcId:m,attributes:HG({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};o.push(T),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function fS(t,r){r instanceof qr&&t.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Fr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function f2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function m2(t,r){var s;if(!(r instanceof Tr&&r._encoderConfig&&r._hints.indexOf(pr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Mn().supportMinBitrate&&o.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;at(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Mn().supportMinBitrate&&!at(s=r._hints).call(s,pr.LOW_STREAM)&&o.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;at(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(ie("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function YG(t){if(t.media.mediaType!=="video")return;const r=An();if(r.name!==Bn.SAFARI&&r.os!==ji.IOS)return;const s=t.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function jP(t,r,s){if(!r)return;let o,c;if(t.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=o.find(h=>VP(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(y=>VP(y.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,v){return v.filter(T=>!!y.find(R=>R.payloadType===T.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>VP(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>zG(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,v){return v.filter(T=>!!y.find(R=>R.payloadType===T.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>zG(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function XG(t,r,s){if(Fr()||t.media.mediaType!=="video"||!(r instanceof Tr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!ie("SIMULCAST")||s==="vp9"&&ie("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:zr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:zr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function JG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const T=WT(v,m,y,"sendonly"),R=WT(v,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(wu(T,R,"videoExtensions",P,N,G),wu(T,R,"videoCodecs",P,N,G),wu(T,R,"audioExtensions",P,N,G),wu(T,R,"audioCodecs",P,N,G),ie("RAISE_H264_BASELINE_PRIORITY")){const j=[],W=[];G.videoCodecs.forEach((Y,X)=>{var ue;if(((ue=Y.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLocaleLowerCase())==="h264"){var ye,Se;const _e=G.videoCodecs[X+1],Ne=_e&&nH(Y,_e),Je=(ye=Y.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],ht=(Se=Y.fmtp)===null||Se===void 0?void 0:Se.parameters["packetization-mode"];!Je||Je!==ie("FIRST_H264_PROFILE_LEVEL_ID")||ie("FIRST_PACKETIZATION_MODE")&&ht!==ie("FIRST_PACKETIZATION_MODE")?Ne?W.push([Y,_e]):W.push([Y]):Ne?j.push([Y,_e]):j.push([Y])}}),j.length>0&&W.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Y,X)=>{var ue;if(((ue=Y.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLocaleLowerCase())==="h264"){const ye=nH(Y,G.videoCodecs[X+1]),Se=j.shift()||W.shift()||[];Se.length>0&&(ye?G.videoCodecs.splice(X,2,...Se):G.videoCodecs.splice(X,1,...Se))}}),N.videoCodecs=N.videoCodecs.filter(Y=>{var X,ue;return!(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((ue=Y.fmtp)===null||ue===void 0?void 0:ue.parameters["profile-level-id"])!==ie("FIRST_H264_PROFILE_LEVEL_ID"))}),ie("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>{var X,ue;return!(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((ue=Y.fmtp)===null||ue===void 0?void 0:ue.parameters["profile-level-id"])!==ie("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:N,sendrecv:G}}(t,r,o);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function QG(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=WT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(wu(t,r,"videoExtensions",s,o,c),wu(t,r,"videoCodecs",s,o,c),wu(t,r,"audioExtensions",s,o,c),wu(t,r,"audioCodecs",s,o,c),ie("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function wu(t,r,s,o,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function FP(t){const{send:r,recv:s,sendrecv:o}=t;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...o.audioCodecs],u.videoCodecs=[...s.videoCodecs,...o.videoCodecs],u.audioExtensions=[...s.audioExtensions,...o.audioExtensions],u.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function mS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function zT(t,r,s,o){let c=[];if(t===gt.VIDEO){if(ie("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return at(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===ie("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const T=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";at(T).call(T,o)?u.push(v):at(T).call(T,"vp9")?h.push(v):at(T).call(T,"vp8")?m.push(v):at(T).call(T,"h264")&&y.push(v)}),u.length===0){let v="";h.length!==0?(u=h,v="vp9"):m.length!==0?(u=m,v="vp8"):y.length!==0&&(u=y,v="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=r.videoCodecs.filter(v=>u.some(T=>T.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),ie("USE_PUB_RTX")||ie("USE_SUB_RTX")){const u=g2(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return at(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return at(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function g2(t,r){const s=t.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&at(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function GT(t,r,s){const o=r.toString(),c=eH(o,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:o});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=ZG(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function ZG(t,r,s){const o=Ra(t),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!at(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&mS(u),c&&at(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),zm(o)}function eH(t,r,s,o){if(ie("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?c=>{eH(c,"answer",s==="local"?"remote":"local",o)}:void 0}function tH(t){const r=ie("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>at(t).call(t,s))}function nH(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function rH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Pl(t,r){return typeof ie(t)===r?ie(t):void 0}function Vge(){try{const t=ie("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?rH(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):rH(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const iH={};function Ym(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),iH[t.name]=t}function pf(t){const r=iH[t];if(!r)throw new xe(J.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function sH(t,r){return pf("DataStream").create(t,r)}function BP(){return pf("InterceptFrame").create()}function oH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function ff(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const _2=new Map;class jge extends Mr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(es.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(es.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:ff(ff({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=pf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new Mge(ff(ff({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=_2.get(r.cname);if(u||(u=new Map,_2.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const v=new Oe(J.UID_CONFLICT);throw Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(T=>{let{address:R}=T;const[P,N]=R.split(":"),G={host:P,port:N};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Rt.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(es.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(es.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(es.NETWORK_QUALITY,{uplinkNetworkQuality:FG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:FG(this._statsCollector.trafficStats.B_dnq)}):this.emit(es.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==$n.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==gr.CONNECTED||await function(o,c){return c===1/0?o:dt.race([o,ume(c)])}(this.signal.request(Wt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==$n.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:ie("PUB_EXTEND"),twcc:!!ie("PUBLISH_TWCC"),rtx:!!ie("USE_PUB_RTX")};try{return(await this.signal.request(Wt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Wt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Wt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(s=>this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!ie("SUBSCRIBE_TWCC"),rtx:!!ie("USE_SUB_RTX")||void 0,extend:ie("SUB_EXTEND"),svc:Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0};try{return await this.signal.request(Wt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!ie("SUBSCRIBE_TWCC"),rtx:!!ie("USE_SUB_RTX"),extend:ie("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0};try{return(await this.signal.request(Wt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Wt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!ie("USE_SUB_RTX"),twcc:!!ie("SUBSCRIBE_TWCC"),svc:Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0};try{return await this.signal.request(Wt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(Wt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(o=>this.signal.request(Wt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Wt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Wt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Wt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),ie("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(ie("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},ie("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),ie("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},ie("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(ie("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Wt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Wt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Wt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Wt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Wt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Wt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ff({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Wt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=_2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Ts.username,password:Ts.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ff(ff({},Ts),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Wt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&aP(()=>{this.emit(es.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(J.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=ie("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(es.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,at(cS).call(cS,c)||cS.push(c);const u=!(Fr()||wW(87)||pz())&&typeof ie("ENABLE_PRE_SUB")=="boolean"&&ie("ENABLE_PRE_SUB"),h=!pz()&&Pl("ENABLE_PREALLOC_PC","boolean"),m=Vge(),y=CT(87)||function(){const T=An();if(T.name!==Bn.SAFARI||!T.browserVersion)return!1;const R=T.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=ff({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Cl,browser:navigator.userAgent,process_id:ie("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:ie("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:ff({enableEncodedTransform:!!ie("ENABLE_AUDIO_METADATA")&&y||!!ie("ENABLE_AUDIO_TOPN")&&uL(Bn.CHROME,87,116)||void 0,enableAudioMetadata:!!ie("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!ie("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:ie("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:ie("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:ie("TOPN_SWITCH_HOLD_MS"),topnAudioGain:ie("TOPN_AUDIO_GAIN"),enablePublishedUserList:ie("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:ie("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Pl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Pl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Pl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:ie("USE_PUB_RTX")===!0||ie("USE_SUB_RTX")===!0||void 0,disableFEC:ie("DISABLE_FEC"),enableNTPReport:!!ie("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!ie("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!ie("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Pl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!ie("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!ie("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Pl("USE_XR","boolean"),enableLossbasedBwe:Pl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!ie("ENABLE_AUT_CC")||void 0,enableCCFallback:Pl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Pl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Pl("PUBLISH_TWCC","boolean"),enableSubTWCC:Pl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Pl("USE_PUB_RTX","boolean"),enableSubRTX:Pl("USE_SUB_RTX","boolean"),enableSubSVC:ie("ENABLE_SVC")?ie("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0,enableSvcExtended:ie("ENABLE_SVC")&&Array.isArray(ie("SVC_EXTENDED"))&&ie("SVC_EXTENDED").length!==0?ie("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,ie("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Oe(J.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(zt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(zt.WS_RECONNECTING,r=>{this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ss.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Rt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(zt.WS_CLOSED,r=>{let s;switch(r){case $n.LEAVE:s=Ss.LEAVE;break;case $n.UID_BANNED:case $n.IP_BANNED:case $n.CHANNEL_BANNED:case $n.SERVER_ERROR:s=Ss.SERVER_ERROR;break;case $n.FALLBACK:s=Ss.FALLBACK;break;case $n.LICENSE_MISSING:case $n.LICENSE_EXPIRED:case $n.LICENSE_MINUTES_EXCEEDED:case $n.LICENSE_PERIOD_INVALID:case $n.LICENSE_MULTIPLE_SDK_SERVICE:case $n.LICENSE_ILLEGAL:case $n.TOKEN_EXPIRE:s=r;break;default:s=Ss.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ss.NETWORK_ERROR)),this.joinInfo&&Rt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===$n.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==$n.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(zt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=ie("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));tr("EVENT_REPORT_DOMAIN",r[1]),tr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),tr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(En.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(zt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new Oe(J.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,bs(this,es.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(zt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=zr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(ie("NEW_TURN_MODE")&&u){let v=u.servers,T=u.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],u.servers=v),Array.isArray(T)&&T.length>0&&(T=[T[0]],u.serversFromGateway=T),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await bs(this,es.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on(zt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(zt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Oe?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,Rt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(zt.IS_P2P_DISCONNECTED,r=>{r(OT(this,es.IS_P2P_DISCONNECTED))}),this.signal.on(zt.DISCONNECT_P2P,()=>{this.emit(es.DISCONNECT_P2P)}),this.signal.on(zt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(zt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(zt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(es.JOIN_RESPONSE,r,s)}),this.signal.on(zt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=ie("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const o=qG(r);this.emit(es.PRE_CONNECT_PC,{candidates:o,fingerprint:s})}}}),this.signal.on(zt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof ie("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(ie("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Wt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Wt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===qn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===qn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===gt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===gt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Wt.RESTART_ICE,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ss.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!ie("GATEWAY_WSS_ADDRESS"))return ie("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Wt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let WP=0,y2=0;function kd(t,r,s,o){return new dt((c,u)=>{r.timeout=r.timeout||ie("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),WP+=Ph(r.data)):s&&(r.data.size?WP+=r.data.size:r.data instanceof FormData?WP+=WW(r.data):WP+=Ph(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Jo.request(r).then(h=>{typeof h.data=="string"?y2+=Ph(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?y2+=h.data.byteLength:y2+=Ph(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Jo.isCancel(h)?u(new Oe(J.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(J.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(J.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(J.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(We){var ot=0;return function(){return ot<We.length?{done:!1,value:We[ot++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(We,ot,bt){return We==Array.prototype||We==Object.prototype||(We[ot]=bt.value),We},o,c=function(We){We=[typeof globalThis=="object"&&globalThis,We,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var ot=0;ot<We.length;++ot){var bt=We[ot];if(bt&&bt.Math==Math)return bt}throw Error("Cannot find global object")}(this);function u(We,ot){if(ot)e:{var bt=c;We=We.split(".");for(var Ge=0;Ge<We.length-1;Ge++){var M=We[Ge];if(!(M in bt))break e;bt=bt[M]}(ot=ot(Ge=bt[We=We[We.length-1]]))!=Ge&&ot!=null&&s(bt,We,{configurable:!0,writable:!0,value:ot})}}function h(We){return(We={next:We})[Symbol.iterator]=function(){return this},We}function m(We){var ot=typeof Symbol<"u"&&Symbol.iterator&&We[Symbol.iterator];return ot?ot.call(We):{next:r(We)}}if(u("Symbol",function(We){function ot(M,se){this.A=M,s(this,"description",{configurable:!0,writable:!0,value:se})}if(We)return We;ot.prototype.toString=function(){return this.A};var bt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ge=0;return function M(se){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new ot(bt+(se||"")+"_"+Ge++,se)}}),u("Symbol.iterator",function(We){if(We)return We;We=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),bt=0;bt<ot.length;bt++){var Ge=c[ot[bt]];typeof Ge=="function"&&typeof Ge.prototype[We]!="function"&&s(Ge.prototype,We,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return We}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}o=y?function(We,ot){if(We.__proto__=ot,We.__proto__!==ot)throw new TypeError(We+" is not extensible");return We}:null}var T=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(We){if(We.m)throw new TypeError("Generator is already running");We.m=!0}function N(We,ot){return We.h=3,{value:ot}}function G(We){this.g=new R,this.G=We}function j(We,ot,bt,Ge){try{var M=ot.call(We.g.j,bt);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return We.g.m=!1,M;var se=M.value}catch(de){return We.g.j=null,We.g.s(de),W(We)}return We.g.j=null,Ge.call(We.g,se),W(We)}function W(We){for(;We.g.h;)try{var ot=We.G(We.g);if(ot)return We.g.m=!1,{value:ot.value,done:!1}}catch(bt){We.g.v=void 0,We.g.s(bt)}if(We.g.m=!1,We.g.l){if(ot=We.g.l,We.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function Y(We){this.next=function(ot){return We.o(ot)},this.throw=function(ot){return We.s(ot)},this.return=function(ot){return function(bt,Ge){P(bt.g);var M=bt.g.j;return M?j(bt,"return"in M?M.return:function(se){return{value:se,done:!0}},Ge,bt.g.return):(bt.g.return(Ge),W(bt))}(We,ot)},this[Symbol.iterator]=function(){return this}}function X(We,ot){return ot=new Y(new G(ot)),T&&We.prototype&&T(ot,We.prototype),ot}if(R.prototype.o=function(We){this.v=We},R.prototype.s=function(We){this.l={D:We,F:!0},this.h=this.C||this.u},R.prototype.return=function(We){this.l={return:We},this.h=this.u},G.prototype.o=function(We){return P(this.g),this.g.j?j(this,this.g.j.next,We,this.g.o):(this.g.o(We),W(this))},G.prototype.s=function(We){return P(this.g),this.g.j?j(this,this.g.j.throw,We,this.g.o):(this.g.s(We),W(this))},u("Array.prototype.entries",function(We){return We||function(){return function(ot,bt){ot instanceof String&&(ot+="");var Ge=0,M=!1,se={next:function(){if(!M&&Ge<ot.length){var de=Ge++;return{value:bt(de,ot[de]),done:!1}}return M=!0,{done:!0,value:void 0}}};return se[Symbol.iterator]=function(){return se},se}(this,function(ot,bt){return[ot,bt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ue=function(We,ot){for(var bt=0;bt<We.length;bt++)ot(We[bt])},ye=function(We){return We.replace(/\r?\n|\r/g,`\r
`)},Se=function(We,ot,bt){return ot instanceof Blob?(bt=bt!==void 0?bt+"":typeof ot.name=="string"?ot.name:"blob",ot.name===bt&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],bt)),[String(We),ot]):[String(We),String(ot)]},_e=function(We,ot){if(We.length<ot)throw new TypeError(ot+" argument required, but only "+We.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Je=Ne.FormData,ht=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,ft=Ne.Request&&Ne.fetch,Sn=Ne.navigator&&Ne.navigator.sendBeacon,bn=Ne.Element&&Ne.Element.prototype,fr=Ne.Symbol&&Symbol.toStringTag;fr&&(Blob.prototype[fr]||(Blob.prototype[fr]="Blob"),"File"in Ne&&!File.prototype[fr]&&(File.prototype[fr]="File"));try{new File([],"")}catch{Ne.File=function(ot,bt,Ge){return ot=new Blob(ot,Ge||{}),Object.defineProperties(ot,{name:{value:bt},lastModified:{value:+(Ge&&Ge.lastModified!==void 0?new Date(Ge.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),fr&&Object.defineProperty(ot,fr,{value:"File"}),ot}}var ci=function(We){return We.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yr=function(We){this.i=[];var ot=this;We&&ue(We.elements,function(bt){if(bt.name&&!bt.disabled&&bt.type!=="submit"&&bt.type!=="button"&&!bt.matches("form fieldset[disabled] *"))if(bt.type==="file"){var Ge=bt.files&&bt.files.length?bt.files:[new File([],"",{type:"application/octet-stream"})];ue(Ge,function(M){ot.append(bt.name,M)})}else bt.type==="select-multiple"||bt.type==="select-one"?ue(bt.options,function(M){!M.disabled&&M.selected&&ot.append(bt.name,M.value)}):bt.type==="checkbox"||bt.type==="radio"?bt.checked&&ot.append(bt.name,bt.value):(Ge=bt.type==="textarea"?ye(bt.value):bt.value,ot.append(bt.name,Ge))})};if((t=Yr.prototype).append=function(We,ot,bt){_e(arguments,2),this.i.push(Se(We,ot,bt))},t.delete=function(We){_e(arguments,1);var ot=[];We=String(We),ue(this.i,function(bt){bt[0]!==We&&ot.push(bt)}),this.i=ot},t.entries=function We(){var ot,bt=this;return X(We,function(Ge){if(Ge.h==1&&(ot=0),Ge.h!=3)return ot<bt.i.length?Ge=N(Ge,bt.i[ot]):(Ge.h=0,Ge=void 0),Ge;ot++,Ge.h=2})},t.forEach=function(We,ot){_e(arguments,1);for(var bt=m(this),Ge=bt.next();!Ge.done;Ge=bt.next()){var M=m(Ge.value);Ge=M.next().value,M=M.next().value,We.call(ot,M,Ge,this)}},t.get=function(We){_e(arguments,1);var ot=this.i;We=String(We);for(var bt=0;bt<ot.length;bt++)if(ot[bt][0]===We)return ot[bt][1];return null},t.getAll=function(We){_e(arguments,1);var ot=[];return We=String(We),ue(this.i,function(bt){bt[0]===We&&ot.push(bt[1])}),ot},t.has=function(We){_e(arguments,1),We=String(We);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===We)return!0;return!1},t.keys=function We(){var ot,bt,Ge,M,se=this;return X(We,function(de){if(de.h==1&&(ot=m(se),bt=ot.next()),de.h!=3)return bt.done?void(de.h=0):(Ge=bt.value,M=m(Ge),N(de,M.next().value));bt=ot.next(),de.h=2})},t.set=function(We,ot,bt){_e(arguments,2),We=String(We);var Ge=[],M=Se(We,ot,bt),se=!0;ue(this.i,function(de){de[0]===We?se&&(se=!Ge.push(M)):Ge.push(de)}),se&&Ge.push(M),this.i=Ge},t.values=function We(){var ot,bt,Ge,M,se=this;return X(We,function(de){if(de.h==1&&(ot=m(se),bt=ot.next()),de.h!=3)return bt.done?void(de.h=0):(Ge=bt.value,(M=m(Ge)).next(),N(de,M.next().value));bt=ot.next(),de.h=2})},Yr.prototype._asNative=function(){for(var We=new Je,ot=m(this),bt=ot.next();!bt.done;bt=ot.next()){var Ge=m(bt.value);bt=Ge.next().value,Ge=Ge.next().value,We.append(bt,Ge)}return We},Yr.prototype._blob=function(){var We="----formdata-polyfill-"+Math.random(),ot=[],bt="--"+We+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ge,M){return typeof Ge=="string"?ot.push(bt+ci(ye(M))+`"\r
\r
`+ye(Ge)+`\r
`):ot.push(bt+ci(ye(M))+'"; filename="'+ci(Ge.name)+`"\r
Content-Type: `+(Ge.type||"application/octet-stream")+`\r
\r
`,Ge,`\r
`)}),ot.push("--"+We+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+We})},Yr.prototype[Symbol.iterator]=function(){return this.entries()},Yr.prototype.toString=function(){return"[object FormData]"},bn&&!bn.matches&&(bn.matches=bn.matchesSelector||bn.mozMatchesSelector||bn.msMatchesSelector||bn.oMatchesSelector||bn.webkitMatchesSelector||function(We){for(var ot=(We=(this.document||this.ownerDocument).querySelectorAll(We)).length;0<=--ot&&We.item(ot)!==this;);return-1<ot}),fr&&(Yr.prototype[fr]="FormData"),ht){var ra=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(We,ot){ra.call(this,We,ot),We.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(We){We instanceof Yr?(We=We._blob(),this.B||this.setRequestHeader("Content-Type",We.type),ht.call(this,We)):ht.call(this,We)}}ft&&(Ne.fetch=function(We,ot){return ot&&ot.body&&ot.body instanceof Yr&&(ot.body=ot.body._blob()),ft.call(this,We,ot)}),Sn&&(Ne.navigator.sendBeacon=function(We,ot){return ot instanceof Yr&&(ot=ot._asNative()),Sn.call(this,We,ot)}),Ne.FormData=Yr}})();const HT=()=>{const t=ie("AREAS");return t.length===0&&t.push(Wn.GLOBAL),Za(t).call(t,(r,s,o)=>{const c=aH(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},aH=t=>t===Wn.OVERSEA?"".concat(ks.ASIA,",").concat(ks.EUROPE,",").concat(ks.AFRICA,",").concat(ks.NORTH_AMERICA,",").concat(ks.SOUTH_AMERICA,",").concat(ks.OCEANIA):ks[t],Fge=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const o=xP[s],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},zP={GLOBAL:{ASIA:[Wn.CHINA,Wn.JAPAN,Wn.INDIA,Wn.KOREA,Wn.HKMC],EUROPE:[],NORTH_AMERICA:[Wn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},GP=Object.keys(zP[Wn.GLOBAL]),E2=[Wn.CHINA,Wn.NORTH_AMERICA,Wn.EUROPE,Wn.ASIA,Wn.JAPAN,Wn.INDIA,Wn.OCEANIA,Wn.SOUTH_AMERICA,Wn.AFRICA,Wn.KOREA,Wn.HKMC,Wn.US],Bge=function(t,r){let s=[];if(at(t).call(t,Wn.GLOBAL)){const u=[Wn.GLOBAL,Wn.OVERSEA],h=Object.keys(xP);if(r===Wn.GLOBAL)throw new Oe(J.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Wn.CHINA)s=[Wn.OVERSEA];else if(c=r,at(GP).call(GP,c)){const m=(o=r,zP[Wn.GLOBAL][o]||[]),y=[...u,r,...m];s=h.filter(v=>!at(y).call(y,v))}else if(function(m){let y=!1;return GP.forEach(v=>{var T;at(T=zP[Wn.GLOBAL][v]).call(T,m)&&(y=!0)}),y}(r)){const m=function(v){let T;return GP.forEach(R=>{var P;at(P=zP[Wn.GLOBAL][R]).call(P,v)&&(T=R)}),T}(r),y=[...u,m,r];s=h.filter(v=>!at(y).call(y,v))}else s=t;s=function(m){const y=[];return E2.forEach(v=>{at(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!at(E2).call(E2,v)))}(s)}else s=t;var o,c;return s};function cH(t){var r,s;if(!t&&at(r=ie("AREAS")).call(r,Wn.EXTENSIONS))return x.debug("update area from ap : reset"),void v2(Xme,!0);if(!at(s=ie("AREAS")).call(s,Wn.GLOBAL)||!t)return;let o=xP.EXTENSIONS;o&&(o={CODE:aH(Wn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),o),tr("AREAS",[Wn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?tr(c,o[c][0]):tr(c,o[c])}))}function v2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Rt.reportApiInvoke(null,{name:Ti.SET_AREA,options:t,tag:Wr.TRACER});try{let o=[];if(typeof t=="string"&&(o=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!at(AG).call(AG,u))throw new Oe(J.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new Oe(J.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Bge(m,h):m}if(!r){if(Id.AREAS){const u=new Oe(J.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(at(o).call(o,Wn.GLOBAL)&&ie("AREAS")===Wn.EXTENSIONS){const u=new Oe(J.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}tr("AREAS",o,r);const c=Fge(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?tr(u,c[u][0]):tr(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function lH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Lh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?lH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):lH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let S2=1;function Wge(t,r,s,o,c){S2+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:S2,requestId:S2,version:Cl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,y,v=t[0];return Rd(async()=>{m=Date.now();const T=await kd(v,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,T.code!==0){const N=new Oe(J.UNEXPECTED_RESPONSE,"live streaming ap error, code"+T.code,{retry:!0,responseTime:y});throw x.error(N.toString()),N}const R=JSON.parse(T.json_body);if(R.code!==200){const N=new Oe(J.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(N.toString()),N}if(!R.servers||R.servers.length===0){const N=new Oe(J.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(N.toString()),N}const P=function(N,G){return{addressList:N.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(ie("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:N.workerToken,vid:N.vid}}(R,r);return ie("LIVE_STREAMING_ADDRESS")&&(P.addressList=ie("LIVE_STREAMING_ADDRESS")instanceof Array?ie("LIVE_STREAMING_ADDRESS"):[ie("LIVE_STREAMING_ADDRESS")]),Lh(Lh({},P),{},{responseTime:y})},(T,R)=>(Rt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(T.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(T,R)=>(Rt.apworkerEvent(s.sid,{success:!1,sc:T.data&&T.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(T.code!==J.OPERATION_ABORTED&&T.code!==J.UNEXPECTED_RESPONSE||T.data&&T.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let b2=1;function uH(t,r,s,o){let{url:c,areaCode:u}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const T=r.role,[R,P]=w2(r,u,[mi.CHOOSE_SERVER]);let N=fi.networkState;return Rd(async()=>{N&&fi.networkState===oc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,os(o&&o.maxRetryTimeout||wi.maxRetryTimeout)]),N=fi.networkState;const{data:G,headers:j}=await kd(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=j.http3==="1"?1:-1,Rt.reportResourceTiming(c,m),hH(G,c,r,y,[mi.CHOOSE_SERVER],v);const W=BT(G,mi.CHOOSE_SERVER);return T2(W),h2(W,c)},G=>(G&&Rt.joinChooseServer(m,{role:T,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(j=>j.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==J.OPERATION_ABORTED&&(G.code===J.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Rt.joinChooseServer(m,{role:T,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function dH(t,r,s,o){let c,{url:u,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[T,R]=w2(r,h,m);let P;return Rd(async()=>{P&&fi.networkState===oc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,os(o&&o.maxRetryTimeout||wi.maxRetryTimeout)]),P=fi.networkState;const{data:N,headers:G}=await kd(u,{data:T,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Rt.reportResourceTiming(u,r.sid),hH(N,u,r,y,m,c);const j=BT(N,mi.CHOOSE_SERVER),W=BT(N,r.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK);return T2(j),{gatewayInfo:h2(j,u),proxyInfo:W,url:u}},N=>(N.gatewayInfo&&Rt.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:u,serverList:N.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38]}),N.proxyInfo&&Rt.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:u,turnServerAddrList:N.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),N=>N.code!==J.OPERATION_ABORTED&&(N.code===J.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(Rt.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0)),o)}const hH=(t,r,s,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],T=R=>{R.flag===4096?Rt.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Rt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const N={error:new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(N),T(N)}if(P!==0){const N=hS(P),G={error:new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),T(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},T2=t=>{var r,s,o,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(ie("AP_AREA")&&((o=t.detail)!==null&&o!==void 0&&o[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?cH(t.detail[23].toLowerCase()):cH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var u;const v=ro(u=m[y]).call(u);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(ie("GATEWAY_ADDRESS")&&ie("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",ie("GATEWAY_ADDRESS"));const h=ie("GATEWAY_ADDRESS").map(m=>{var y,v;const T=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:T}});t.addresses=h}},zge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const o=hS(s.buffer.code);throw new Oe(J.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Oe(J.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},w2=(t,r,s)=>{const o=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:o,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Lh(Lh(Lh({6:t.stringUid,11:r,12:ie("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Gge=(t,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let gS=0;function _S(t){return dt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const $T=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=t,h=0;const m=r;let y,v=0;const T=async()=>{const R=(()=>{const P=h*m,N=P+m;return s.slice(P,N).map(o)})();u&&u.push(...R);try{y=await _S(R)}catch(P){if(v+=m,h++,!(v>=s.length))return void await T();c(P)}R.forEach(P=>P.cancel())};return await T(),y},pH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=t;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(u++,u>=c||o!=null&&o(y))throw y;return h()}};return h()};async function C2(t,r,s,o){return{gatewayInfo:await async function(u,h,m,y){let v=null;const T=[],R=async()=>{const N=ie("WEBCS_DOMAIN").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(W=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:HT()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await $T({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),W.url),uH(W,u,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:T});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},P=async()=>{if(await os(1e3),v!==null)return v;const N=ie("WEBCS_DOMAIN_BACKUP_LIST").map(W=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:HT()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await $T({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),W.url),uH(W,u,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:T});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};try{return v=await _S([R(),P()]),T.length&&T.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),v}catch(N){throw N[0]}}(t,r,s,o)}}async function fH(t,r,s,o,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await C2(t,r,s,c);if(ie("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:N}=await _H(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=N.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Ts.tcpport,udpport:j.udpport||Ts.udpport,username:j.username||Ts.username,password:j.password||Ts.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=t.uid)!==null&&h!==void 0?h:P.uid,W="glb:".concat(j.toString()),Y=await yL(W),X=N.map(ue=>({turnServerURL:ue.address,tcpport:ue.tcpport||Ts.tcpport,udpport:ue.udpport||Ts.udpport,username:W,password:Y,forceturn:!1,security:!0}));G.push(...X)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await C2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await _H(t,r,s,c),v={gatewayInfo:y},T=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Ts.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Ts.udpport,username:P.username||Ts.username,password:P.password||Ts.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:y.uid,N="glb:".concat(P.toString()),G=await yL(N),j=m.map(W=>({turnServerURL:W.address,tcpport:u==="proxy3"?void 0:W.tcpport||Ts.tcpport,udpport:u==="proxy4"?void 0:W.udpport||Ts.udpport,username:N,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));T.push(...j)}return t.turnServer={mode:"manual",servers:T},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),v}async function mH(t,r,s,o,c){const u=ie("ACCOUNT_REGISTER").slice(0,ie("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):u.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,T,R,P,N){const G=Date.now(),j={sid:R.sid,opid:10,appid:R.appId,string_uid:T};let W=v[0];const Y=await Rd(()=>kd(W+"".concat(W.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(X,ue)=>{if(X.code===0){if(X.uid<=0||X.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(T," => ").concat(X.uid),X),Rt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:X.uid,errorCode:J.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Oe(J.INVALID_UINT_UID_FROM_STRING_UID);return Rt.reqUserAccount(j.sid,{lts:G,success:!0,serverAddr:W,stringUid:j.string_uid,uid:X.uid,errorCode:null,extend:j}),!1}const ye=hS(X.code);return ye.retry&&(W=v[(ue+1)%v.length]),Rt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:X.uid,errorCode:ye.desc,extend:j}),ye.retry},(X,ue)=>X.code!==J.OPERATION_ABORTED&&(Rt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:null,errorCode:X.code,extend:j}),W=v[(ue+1)%v.length],!0),N);if(Y.code!==0){const X=hS(Y.code);throw new Oe(J.UNEXPECTED_RESPONSE,X.desc)}return Y}(h,t,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function Hge(t,r,s){const o=ie("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await pH({referenceList:c,asyncMapHandler:h=>async function(m,y,v,T){const R=Date.now(),P={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const N=await kd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const G=hS(N.code);throw new Oe(J.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new Oe(J.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:N.uid,elapse:Date.now()-R}}catch(N){throw N}}(h,t,r,s),closeFn:h=>h.code===J.OPERATION_ABORTED||h.code===J.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function $ge(t,r,s){const o=ie("CDS_AP").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=o.map(y=>function(v,T,R,P){const N=An(),G={flag:64,cipher_method:0,features:Lh(Lh(Lh(Lh(Lh({install_id:PL(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:T.appId,version:Cl,cname:T.cname,session_id:T.sid,proxyServer:T.proxyServer,sdk_type:Uge.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:T.cname},T.stringUid&&{string_uid:T.stringUid}),T.uid&&{uid:T.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return Rd(()=>kd(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==J.OPERATION_ABORTED,P)}(y,t,r,s));let u=null,h=null,m={};try{u=await _S(c)}catch(y){if(y.code===J.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),Rt.reportApiInvoke(t.sid,{name:Ti.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,T=Object.keys(v),R={};return T.forEach(P=>{var N;const G=ro(N=P.slice(4)).call(N),j=JSON.parse(v[P]),W=j[1];R[G]={tag:j[0]||"",value:W}}),R}(u)}catch{}return m}async function gH(t,r){const s=ie("WEBCS_DOMAIN").concat(ie("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:HT(),serviceIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK]}));try{return await pH({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let y,{url:v,areaCode:T,serviceIds:R}=u;const P=Date.now(),[N,G]=w2(h,T,R);let j=fi.networkState;try{j&&fi.networkState===oc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,os(wi.maxRetryTimeout)]),j=fi.networkState;const{data:W,headers:Y}=await kd(v,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=Y.http3==="1"?1:-1,(Se=>{const _e=[];if(Se.response_body.forEach(Ne=>{const Je=Ne.buffer.code;if(Ne.uri===23&&Je===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const ht={error:new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Se.detail[502]}),flag:Ne.buffer.flag};_e.push(ht)}if(Je!==0){const ht=hS(Je),ft={error:new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,ht.desc,{desc:ht.desc,retry:ht.retry,csIp:Se.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(ft.error.toString()):_e.push(ft)}}),_e.length)throw new Oe(J.CAN_NOT_GET_GATEWAY_SERVER,_e.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!_e.find(Ne=>Ne.error.data.retry),csIp:Se.detail[502],desc:[...new Set(_e.map(Ne=>{var Je;return Ne==null||(Je=Ne.error)===null||Je===void 0||(Je=Je.data)===null||Je===void 0?void 0:Je.desc}).filter(Ne=>!!Ne))]})})(W);const ue=BT(W,mi.CHOOSE_SERVER),ye=BT(W,mi.CLOUD_PROXY_FALLBACK);return T2(ue),{gatewayInfo:h2(ue,v),proxyInfo:ye,opid:G,requestTime:P,url:v,isHttp3:y,elapse:Date.now()-P}}catch(W){throw W}}(c,t,r),closeFn:c=>c.code===J.OPERATION_ABORTED||c.code===J.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function _H(t,r,s,o){const c=ie("PROXY_SERVER_TYPE3"),u=(N,G,j)=>{let W=j||c;return Array.isArray(W)&&(W=G%2==0?c[1]:c[0]),"https://".concat(W,"/ap/?url=").concat(N)};let h=null;const m=[],y=async()=>{const N=ie("WEBCS_DOMAIN").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map((W,Y)=>{let X;return X=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):u("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y),{url:X,areaCode:HT(),serviceIds:[mi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await $T({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),W.url),dH(W,t,r,s)),allFailedhandler:W=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},v=async()=>{if(await os(1e3),h!==null)return h;const N=ie("WEBCS_DOMAIN_BACKUP_LIST").map((W,Y)=>{let X;return X=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):u("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y),{url:X,areaCode:HT(),serviceIds:[mi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await $T({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),W.url),dH(W,t,r,s)),allFailedhandler:W=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};let T,R,P;try{({gatewayInfo:T,proxyInfo:R,url:P}=await _S([y(),v()]))}catch(N){throw N[0]}if(m.length&&m.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),!T||!R)throw new Oe(J.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];at(c).call(c,N)&&(t.proxyServer=N,x.setProxyServer(N),Rt.setProxyServer(N))}return h={gatewayInfo:T,proxyInfo:await BG(R,T.uid)},h}async function Kge(t,r,s){const o=ie("UAP_AP").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,y,v){const T={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Cl,cname:m.cname,uid:m.uid.toString(),requestId:b2,seq:b2};b2+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(T)};return Rd(async()=>{const P=await kd(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(J.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const N=JSON.parse(P.json_body);if(N.code!==200){const G=new Oe(J.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw x.error(G.toString()),G}if(!N.servers||N.servers.length===0){const G=new Oe(J.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:N.vid,workerToken:N.workerToken,addressList:(ie("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(ie("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==J.OPERATION_ABORTED&&P.code!==J.UNEXPECTED_RESPONSE||P.data&&P.data.retry),v)}(u,t,r,s));try{const u=await _S(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function qge(t,r,s){let o=null;const c=[],u=async h=>{const m=ie(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await os(1e3),o!==null)?o:await $T({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,T,R,P){const[N]=Gge(T,[mi.CHOOSE_SERVER]);let G=fi.networkState;return Rd(async()=>{G&&fi.networkState===oc.OFFLINE&&fi.onlineWaiter&&await dt.race([fi.onlineWaiter,os(P&&P.maxRetryTimeout||wi.maxRetryTimeout)]),G=fi.networkState;const j=await kd(v,{data:N,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return zge(j,v)},()=>!1,j=>j.code!==J.OPERATION_ABORTED&&(j.code===J.UPDATE_TICKET_FAILED?j.data.retry:(x.warning("[".concat(T.clientId,"] update ticket network error, retry"),j),!0)),P)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return o=await _S([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function yH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function R2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?yH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):yH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class Yge extends Mr{get isSuccess(){return!!this.configs}constructor(r,s){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Os("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),ie("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},ie("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Rt.reportApiInvoke(null,{options:void 0,name:Ti.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Wr.TRACER}).onSuccess(JSON.stringify(Id))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await $ge(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=pT(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<h.length;v++)for(let T=h.length-1;T>v;T--){const R=h[T],P=c[R].value;if(typeof P.__priority=="number"){const N=P.__priority,G=h[T-1],j=c[G].value;if(typeof j.__priority=="number"){if(!(N>j.__priority))continue;{const W=R;h[T]=h[T-1],h[T-1]=W}}else{const W=R;h[T]=h[T-1],h[T-1]=W}}}const m=Date.now();let y={};return h.forEach(v=>{const T=c[v].value.__expires;T&&T<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(J.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){PG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(VT.UPDATE_BITRATE_LIMIT,r):this.emit(VT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&R2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const y=h.__type,v=r[u].value,T=r[u].tag;let R=0;y?y===iz.REALTIME&&(R=1):Object.keys(v).some(P=>Object.prototype.hasOwnProperty.call(DL,P)||!n2()&&Object.prototype.hasOwnProperty.call(hP,P)?(R=1,!0):void 0),c.push({tag:T,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:y,isApplied:v}=u;this.store.sessionId&&Rt.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(T=>{T==="__id"||T==="__type"||T==="__priority"||T==="__expires"||Object.prototype.hasOwnProperty.call(u,T)||(u[T]=R2(R2({value:m[T]},y&&{expires:y}),v&&{type:v}))})}),u}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&PG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:T,type:R,expires:P}=m[v];P&&P<=y||((R===iz.REALTIME||Object.prototype.hasOwnProperty.call(DL,v))&&(Id[v]=T,br[v]=T,x.debug("Update realtime parameters from config distribute",v,T)),R||n2()||!Object.prototype.hasOwnProperty.call(hP,v)||(Id[v]=T,br[v]=T,x.debug("Update gateway parameters from config distribute",v,T)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(br,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(br[o],c)||(Id[o]=c,br[o]=c,this.emit(VT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class Xge extends Mr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(ie("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=at(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",EH[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",EH[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Oi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=ac(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Oi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const EH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ds=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function vH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function iy(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class KT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",dP.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Xge,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ke.LocalAudioTrack)||iy({},VL)}getLocalVideoTrackStats(){return this.localStats.get(Ke.LocalVideoTrack)||iy({},jL)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const u=this.localStats.get(Ke.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get(Ke.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Ke.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:T,videoStats:R}=v;T&&(o+=T.receiveBytes,c+=T.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?Ds.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ds.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case Ke.LocalVideoTrack:case Ke.LocalVideoLowTrack:{const h=c,m=iy({},jL),y=r.getStats(),v=r.getLocalMedia(o);if(y){const T=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ke.LocalVideoTrack);T.codec!=="H264"&&T.codec!=="H265"&&T.codec!=="VP8"&&T.codec!=="VP9"&&T.codec!=="AV1X"&&T.codec!=="AV1"||(m.codecType=T.codec),m.sendBytes=T.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,T.inputFrame?(m.captureFrameRate=T.inputFrame.frameRate,m.captureResolutionHeight=T.inputFrame.height,m.captureResolutionWidth=T.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),T.sentFrame?(m.sendFrameRate=T.sentFrame.frameRate,m.sendResolutionHeight=T.sentFrame.height,m.sendResolutionWidth=T.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),T.avgEncodeMs&&(m.encodeDelay=T.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(m.totalFreezeTime+=1),T.scalabilityMode&&this.scalabilityMode!==T.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(T.scalabilityMode)),this.scalabilityMode=T.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Ke.LocalAudioTrack:{const h=c,m=iy({},VL),y=r.getStats(),v=r.getLocalMedia(o);if(y){const T=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){if(T.codec!=="opus"&&T.codec!=="aac"&&T.codec!=="PCMU"&&T.codec!=="PCMA"&&T.codec!=="G722"||(m.codecType=T.codec),T.inputLevel)m.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=T.bytes,m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ke.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,T=h,R=y,P=iy({},mz),N=iy({},gz),G=iy({},xme),{audioTrack:j,videoTrack:W,audioSSRC:Y,videoSSRC:X}=r.getRemoteMedia(u);let ue;ue=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(o=ue)===null||o===void 0?void 0:o.audioRecv.find(Je=>Je.ssrc===Y),Se=(c=ue)===null||c===void 0?void 0:c.videoRecv.find(Je=>Je.ssrc===X),_e=this.trafficStats&&this.trafficStats.peer_delay.find(Je=>Je.peer_uid===u);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(P.codecType=ye.codec),ye.outputLevel?P.receiveLevel=Math.round(32767*ye.outputLevel):j&&(P.receiveLevel=Math.round(32767*j.getVolumeLevel())),P.receiveBytes=ye.bytes,P.receivePackets=ye.packets,P.receivePacketsLost=ye.packetsLost,P.receivePacketsDiscarded=ye.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=v?8*Math.max(0,P.receiveBytes-v.receiveBytes):0,P.totalDuration=v?v.totalDuration+1:1,P.totalFreezeTime=v?v.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ye.jitterBufferMs,P.totalDuration>10&&KT.isRemoteAudioFreeze(j)&&(P.totalFreezeTime+=1)),Se){var Ne;Se.codec!=="H264"&&Se.codec!=="H265"&&Se.codec!=="VP8"&&Se.codec!=="VP9"&&Se.codec!=="AV1X"&&Se.codec!=="AV1"||(N.codecType=Se.codec),N.receiveBytes=Se.bytes,N.receiveBitrate=T?8*Math.max(0,N.receiveBytes-T.receiveBytes):0,N.decodeFrameRate=Se.decodeFrameRate<0?0:Se.decodeFrameRate,N.renderFrameRate=Se.decodeFrameRate<0?0:Se.decodeFrameRate,Se.outputFrame&&(N.renderFrameRate=Se.outputFrame.frameRate),Se.receivedFrame?(N.receiveFrameRate=Se.receivedFrame.frameRate,N.receiveResolutionHeight=Se.receivedFrame.height,N.receiveResolutionWidth=Se.receivedFrame.width):W&&(N.receiveResolutionHeight=W._videoHeight||0,N.receiveResolutionWidth=W._videoWidth||0),Se.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(Se.framesRateFirefox)),N.receivePackets=Se.packets,N.receivePacketsLost=Se.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const Je=T?T.totalFreezeTime:0,ht=T?T.totalDuration:0;N.totalDuration=T?T.totalDuration+1:1,N.totalFreezeTime=(Ne=Se.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Je||0,N.receiveDelay=Se.jitterBufferMs||0;const ft=!!X&&r.getRemoteVideoIsReady(X);Se.totalFreezesDuration===void 0&&W&&ft&&KT.isRemoteVideoFreeze(W,Se,R)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-Je)/(N.totalDuration-ht),1))}_e&&(P.end2EndDelay=_e.B_ad,N.end2EndDelay=_e.B_vd,P.transportDelay=_e.B_ed,N.transportDelay=_e.B_ed,P.currentPacketLossRate=_e.B_ealr4/100,N.currentPacketLossRate=_e.B_evlr4/100,G.uplinkNetworkQuality=_e.B_punq?_e.B_punq:0,G.downlinkNetworkQuality=_e.B_pdnq?_e.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:N,videoPcStats:Se,networkStats:G}),j&&this.exceptionMonitor.setRemoteAudioStats(j,P),W&&this.exceptionMonitor.setRemoteVideoStats(W,N)})}}class SH{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){IG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){IG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){kP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function bH(t){if(!(t instanceof SH))return new Oe(J.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(J.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(J.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Xm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function TH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function wH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?TH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):TH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const qT="9",CH=4e4;function RH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?RH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):RH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var yS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(yS||{});const HP=new Map;function IH(t,r,s,o){let{scale:c}=t;if(c===0&&o===yS.UP||c>=r.length-1&&o===yS.DOWN)return t;let u=mf(mf({},t),{},{scale:o===yS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=mf(mf({},u),r[c].motion);break;case"maintain-resolution":u=mf(mf({},u),r[c].detail);break;case"balanced":u=mf(mf({},u),r[c].balanced)}return u}function AH(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:PH(r)};HP.set(t,s)}else HP.delete(t)}function PH(t){const r=mf({},t),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:T,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:W,BALANCE_RESOLUTION_FACTOR:Y,MOTION_RESOLUTION_FACTOR:X,MOTION_BITRATE_FACTOR:ue,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:Se}=kL,_e=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(N,1)*_e),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u}}];for(let Je=1;Je<=y;Je++){const ht={bwe_up:Math.round(Math.pow(R,Je)*s),bwe_down:Math.round(Math.pow(P,Je+1)*s),fps_up:Math.round(Math.pow(G,Je)*_e),fps_down:Math.round(Math.pow(N,Je+1)*_e)},ft={scaleResolutionDownBy:c/Math.pow(Y,Je),frameRate:Math.max(Math.round(Math.pow(W,Je)*o),h),bitrateMax:Math.max(Math.round(Math.pow(j,Je)*s),T),bitrateMin:Math.max(Math.round(Math.pow(j,Je)*u),v)},Sn={scaleResolutionDownBy:c/Math.pow(X,Je),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ue,Je)*s),T),bitrateMin:Math.max(Math.round(Math.pow(ue,Je)*u),v)},bn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Je)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Se,Je)*s),T),bitrateMin:Math.max(Math.round(Math.pow(Se,Je)*u),v)};Ne.push({scale:Je,threshold:ht,balanced:ft,motion:Sn,detail:bn})}return Ne}function Jge(t,r,s,o,c,u){const h=HP.get(t)||{overUse:0,underUse:0,adaptationList:PH(c)},{adaptationList:m}=h;HP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=kL,{scale:T}=o;let R,P;return typeof r=="number"&&r>0&&function(N,G,j,W){if(G>=j.length)return!1;let{threshold:{fps_down:Y}}=j[G];return ie("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Y=j[0].threshold.fps_down),N<Y}(r,T,m,u)&&(h.overUse++,P=NT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(N,G,j){if(G>=j.length)return!1;const{threshold:{bwe_down:W}}=j[G];return N<W}(s,T,m)&&(h.overUse++,P=NT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=IH(o,m,u,yS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(N,G,j,W){if(G===0)return;let{threshold:{fps_up:Y}}=j[G];return ie("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Y=j[1].threshold.fps_up),N>Y}(r,T,m,u)&&function(N,G,j){if(G===0)return;const{threshold:{bwe_up:W}}=j[G];return N>W}(s,T,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=IH(o,m,u,yS.UP),R.scale===0&&(P=NT.NONE))),[R,P])}function OH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function I2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?OH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):OH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Qge(t){var r;return!!ie("ENABLE_AG_ADAPTATION")&&!!(t instanceof qL||at(r=t._hints).call(r,pr.CUSTOM_TRACK))&&(!!ie("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const o=An();if(o.os!==ji.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=s}(14)&&RW(17,4)||CW(14)&&IW(17,4,!0)))}const $P=new Map;function KP(t,r){const s=$P.get(t);if(s){const{timer:o}=s;window.clearTimeout(o),$P.delete(t)}r.qualityLimitationReason=NT.NONE,AH(t)}function Zge(t,r){var s;let o;switch(r){case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoTrack:o=at(s=t._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalVideoLowTrack:o=qn.Low}return o}function A2(t){const r=Mn();if(t.some(s=>s._bypassWebAudio))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function P2(t,r){A2(t);const s=new Oi;return t.forEach(o=>s.addAudioTrack(o)),s}const e_e=!Mn().supportUnifiedPlan||ie("CHROME_FORCE_PLAN_B")&&sf();function qP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return e_e?(s={spec:r,store:t},pf("PlanBConnection").create(s)):new Mh(r,t)}function O2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function kH(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(PT(t.turnServer.servers))return!1;if(ie("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Cn;function NH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Nd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?NH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):NH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Mh=(Cn=class Cy extends kG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return at(s=Object.keys(pP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"id",hr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:ie("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",NT.NONE),K(this,"isFirstConnected",!1),this.store=s,this.forceTurn=kH(r),this.mutex=new Os("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Cy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=AL(this.peerConnection,ie("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(o)return{transceiver:o,track:o.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=qm(o.sdp),u=await JG({filterRTX:!ie("USE_PUB_RTX")&&!ie("USE_SUB_RTX"),filterVideoFec:ie("FILTER_VIDEO_FEC"),filterAudioFec:ie("FILTER_AUDIO_FEC"),filterVideoCodec:ie("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=FP(u),this.initialOffer=o,ie("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:dP.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const T=Ra(v.sdp).mediaDescriptions[0];if(!T)return;const R=T.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&tH(o.sdp)&&(h=zr(u),(s=h).send&&(pS(gt.VIDEO,s.send.videoExtensions),pS(gt.AUDIO,s.send.audioExtensions)),s.recv&&(pS(gt.VIDEO,s.recv.videoExtensions),pS(gt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(pS(gt.VIDEO,s.sendrecv.videoExtensions),pS(gt.AUDIO,s.sendrecv.audioExtensions))),Nd(Nd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new xe(J.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&tH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(UP(gt.VIDEO,s.send.videoExtensions,o.send.videoExtensions),UP(gt.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(UP(gt.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),UP(gt.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return zr(this._localCapabilities)}get rtpCapabilities(){return zr(this._rtpCapabilities)}get candidates(){return zr(this._candidates)}get iceParameters(){return zr(this._iceParameters)}get dtlsParameters(){return zr(this._dtlsParameters)}constructor(v){let T=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=T,v=zr(v);const{iceParameters:R,dtlsParameters:P,candidates:N,rtpCapabilities:G,setup:j,localCapabilities:W,cname:Y}=v;this._rtpCapabilities=G,this._candidates=N,this._originCandidates=zr(N),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=W,this.setup=j,this.cname=Y,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const T=this.candidates,R=this.dtlsParameters,P=this.iceParameters,N=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let j=1;j<v;j++){const W=2*j+2e4,Y=2*j+CH,{ssrcs:X,ssrcGroups:ue}=ry([{ssrcId:W}],this.cname),{ssrcs:ye,ssrcGroups:Se}=ry([{ssrcId:Y,rtx:ie("USE_SUB_RTX")?Y+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:qT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:T,extmaps:N.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:Se,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:qT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:T,extmaps:N.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:X,ssrcGroups:ue,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zm(this.sessionDesc)}send(v,T,R,P){const{ssrcs:N,ssrcGroups:G}=ry(T,this.cname,ie("SYNC_GROUP")?R:void 0),j=this.findPreloadMediaDesc(N);if(j){if(Fr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,j.attributes.mid),P&&(P.twcc||P.remb)){const W=this.sessionDesc.mediaDescriptions.indexOf(j);return this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(j,P),{mid:j.attributes.mid,needExchangeSDP:!0}}return{mid:j.attributes.mid,needExchangeSDP:!1}}{const W=this.findAvailableMediaIndex(v,N);let Y;return W===-1||W===1&&(vs()||function(){const X=An();return!(X.name!==Bn.CHROME||!X.osVersion)&&Number(X.version)<=90}()||ie("ENABLE_ENCODED_TRANSFORM")&&rf())||W===0&&ie("USE_SUB_RTX")||AW()?(Y=this.createOrRecycleSendMedia(v,N,G,"sendonly",P),this.updateBundleMids()):(Y=zr(this.sessionDesc.mediaDescriptions[W]),Y.attributes.direction="sendonly",Y.attributes.ssrcs=N,Y.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(Y,P)),Fr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,Y.attributes.mid),{mid:Y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:T}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:T}}batchSend(v){const T=v.map(N=>{let{kind:G,ssrcMsg:j,mslabel:W}=N;return this.send(G,j,W)}),R=[];let P=!1;return T.forEach(N=>{let{mid:G,needExchangeSDP:j}=N;j&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");T.forEach(R=>{R.attributes.mid==="0"||Fr()||AW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!T)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));T.attributes.direction="inactive"}unmute(v){const T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!T)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));T.attributes.direction="sendonly"}muteRemote(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>at(v).call(v,R.attributes.mid||""));if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>at(v).call(v,R.attributes.mid||""));if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,T,R,P){v.forEach((N,G)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",T,R,P[G])}),this.updateBundleMids()}stopReceiving(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(T.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");T.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const T=this.sessionDesc||Ra((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const P=this.rtpCapabilities.send,N=this.localCapabilities.send;for(const G of T.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const j=N.videoCodecs.filter(W=>{var Y,X;return(Y=W.rtpMap)===null||Y===void 0?void 0:at(X=Y.encodingName.toLowerCase()).call(X,"vp8")})||[N.videoCodecs[0]];G.media.fmts=j.map(W=>W.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,ie("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:W}=ry([{ssrcId:CH,rtx:ie("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=W}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const j=N.audioCodecs.filter(W=>{var Y,X;return(Y=W.rtpMap)===null||Y===void 0?void 0:at(X=Y.encodingName.toLowerCase()).call(X,"opus")})||[N.audioCodecs[0]];G.media.fmts=j.map(W=>W.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,mS(G),ie("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:W}=ry([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=W}}}return this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const T=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(T.forEach(P=>{R.push(wH(wH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),T.length!==0){switch(v){case Ns.TCP_RELAY:this._candidates=R;break;case Ns.UDP_TCP_RELAY:case Ns.RELAY:this._candidates=[...T,...R];break;default:this._candidates=T}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(v){v=zr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.iceUfrag=v.iceUfrag,T.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const T=[];for(let R=0;R<v;R++)T.push((this.currentMidIndex+R+1).toString(10));return T}findAvailableMediaIndex(v,T){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Fr()){if(P){const N=this.firefoxSsrcMidMap.get(T[0].ssrcId);return!(N||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!N||N!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),T={media:{mediaType:"application",port:qT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(T),{mediaDesc:T,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,T,R,P,N,G){const j=v._mediaStreamTrack.kind,W=this.rtpCapabilities.recv,Y=zT(j,W,this.localCapabilities.send,j===gt.VIDEO?P:N),X=j===gt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const ue="".concat(this.currentMidIndex);let ye={media:{mediaType:j,port:qT,protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:X,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ue)}};ye=this.mungRecvMediaDsec(ye,v,G);const Se=this.findFirstClosedMedia(j);if(Se){const _e=this.sessionDesc.mediaDescriptions.indexOf(Se);this.sessionDesc.mediaDescriptions[_e]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(v,T,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Se;return at(Se=Object.keys(pP)).call(Se,ye)}))],N=new Set(T);if(P.every(ye=>N.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(T)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(ye=>T.some(Se=>{var _e;return at(_e=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(_e,Se)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(T)),!1;const j=[...new Set(G.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let W;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(j)),v.length===0)W=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(W=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&at(v).call(v,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),W.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(T)),!1;if(ie("USE_PUB_RTX")||ie("USE_SUB_RTX")){const ye=g2(G,this.rtpCapabilities.recv.videoCodecs);G.push(...ye)}this._rtpCapabilities.recv.videoCodecs=G;const Y=this.localCapabilities.send,X=this.rtpCapabilities.recv,ue=zT(gt.VIDEO,X,Y,R);return W.forEach(ye=>{const Se=ue.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",ue),ye.attributes.payloads=ue,ye.media.fmts=Se}),!0}createOrRecycleSendMedia(v,T,R,P,N){const G=this.rtpCapabilities.send,j=v===gt.VIDEO?G.videoCodecs:G.audioCodecs,W=v===gt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let X={media:{mediaType:v,port:qT,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:W,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};X=this.mungSendMediaDesc(X,N);const ue=this.findFirstClosedMedia(v);if(ue){const ye=this.sessionDesc.mediaDescriptions.indexOf(ue);this.sessionDesc.mediaDescriptions[ye]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,T,R){const P=zr(v);return f2(P),fS(P,T),m2(P,T),YG(P),jP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(v,T){const R=zr(v);return jP(R,T,this.localCapabilities.recv),mS(R),R}updateRecvMedia(v,T){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===v);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],T);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(T=>Fr()?T.media.port==="0"&&T.media.mediaType===v:T.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(T=>{var R;return((R=T.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var T;return(T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||T===void 0?void 0:T.attributes.ssrcs}}(Nd(Nd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=ZG(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),ie("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(ie("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const T=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(T)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(T=>({kind:T.kind,ssrcMsg:[{ssrcId:T.ssrcId,rtx:T.rtx}],mslabel:T.mslabel})));v.forEach((T,R)=>{this.preSSRCMap.set(y[R].ssrcId,T)}),await GT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await GT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return wl(function*(){const u=yield In(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=MP();r.forEach(W=>{const Y=c.peerConnection.addTransceiver(W._mediaStreamTrack,Nd({direction:"sendonly"},W.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Y),W._updateRtpTransceiver(Y)}),Fr()&&ie("SIMULCAST")===!0&&(yield In(c.applySimulcastForFirefox(h,r)));const y=yield In(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),T=c.mungSendOfferSDP(y.sdp,r,v),R=Ra(T),P=v.map(W=>{const Y=R.mediaDescriptions.find(X=>X.attributes.mid===W);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return $G(Y,ie("USE_PUB_RTX"))});let N;try{N=yield P}catch(W){N=[],c.remoteSDP.receive(r,s,o,N);const Y=c.remoteSDP.toString();throw yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield In(c.stopSending(v,!0)),W}c.remoteSDP.receive(r,s,o,N);const G=c.remoteSDP.toString(),j=c.logSDPExchange(T,"offer","local","send");return yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(c.applySimulcastEncodings(h,r)),yield In(c.applySendEncodings(h,r)),j==null||j(G),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Y)=>{const X=v[Y];return{localSSRC:P[Y],id:X,transceiver:W}})}catch(h){throw h instanceof xe?h:new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:ie("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof xe?o:new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof xe?s:new xe(J.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;KP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await GT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await GT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return wl(function*(){const o=yield In(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Mn().supportPCSetConfiguration,u=ie("FORCE_TURN_TCP")||s.forceTurn;if(r===Ns.RELAY&&!c)return;if(c&&!u){const R=r===Ns.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield In(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=qm(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),T=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield In(s.peerConnection.setLocalDescription(h)),T==null||T(v),yield In(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ns.TCP_RELAY),await GT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{KP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Nd(Nd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(J.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Fr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:Nd(Nd({},Oh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Nd(Nd({},Oh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ie("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(PT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:ie("NEW_TURN_MODE")&&s.iceServers?(ie("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Cy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Cy.newTurnServerConfigToIceServers(r.turnServer.servers)),ie("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Cy.turnServerConfigToIceServers(r.turnServer.servers)),ie("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Cy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),ie("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),ie("ENABLE_ENCODED_TRANSFORM")&&Mn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat($m(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!ie("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=ie("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat($m(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat($m(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(W=>W.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Mn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(j,W){return j.getTransceivers().find(Y=>Y.sender.track===W||Y.receiver.track===W)}(this.peerConnection,r._mediaStreamTrack),y=jme(r);if(Qge(r)&&m&&s&&y&&this.getLocalVideoStats&&at(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const j=u.degradationPreference||(at(v=r._hints).call(v,pr.CUSTOM_TRACK)?ie("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(W,Y,X,ue,ye,Se){if(KP(W,X),ye(Y),ue!=="balanced"&&ue!=="maintain-framerate"&&ue!=="maintain-resolution")return;let _e=-1;AH(W,Y);const Ne=window.setInterval(()=>{const ht=$P.get(W);if(!ie("ENABLE_AG_ADAPTATION")||!ht)return KP(W,X),void ye(Y);const ft=Se();if(ft.sendPackets>0&&ft.OutgoingAvailableBandwidth>0){if(_e===-1)return void(_e=Date.now());if(Date.now()-_e<1e3)return;const Sn=ft.sendFrameRate,bn=ft.OutgoingAvailableBandwidth,[fr,ci]=Jge(W,Sn,bn,ht.adaptationConfig,Y,ue);ci&&(X.qualityLimitationReason=ci),fr&&ht.adaptationConfig.scale!==fr.scale&&(x.debug("[".concat(W,"] applyAdaptation: ").concat(X.qualityLimitationReason,`
           sendFps `).concat(Sn,", bwe ").concat(bn,", switch from ").concat(ht.adaptationConfig.scale," to ").concat(fr.scale," ")),ht.adaptationConfig=I2(I2({},ht.adaptationConfig),fr),ye(fr))}},ie("CHECK_LOCAL_STATS_INTERVAL")),Je=I2({},Y);$P.set(W,{timer:Ne,adaptationConfig:Je,originConfig:Y,adaptationFunc:ye}),x.debug("[".concat(W,"] start adaptation, originConfig: ").concat(JSON.stringify(Y),", degradationPreference: ").concat(ue))})(this.id+m.mid,y,this,j,W=>{s&&this.updateAdaptation(s,W)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var T;const{bitrateMax:j,frameRate:W,scaleResolutionDownBy:Y}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(at(T=r._hints).call(T,pr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(W&&(h.maxFramerate=ac(W)),Y&&Y>=1&&(h.scaleResolutionDownBy=Y))}const{maxFramerate:R}=ie("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),ie("DSCP_TYPE")&&sf()){var P;const j=ie("DSCP_TYPE");at(P=["very-low","low","medium","high"]).call(P,j)&&(h.networkPriority=j)}const N=s.getParameters(),G=(c=N.encodings)===null||c===void 0?void 0:c[0];Fr()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(N,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await s.setParameters(N),await async function(j,W,Y){try{var X;if(!Mn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(j)||!ie("ENABLE_SVC"))return;const ue={},ye={},Se=W.getParameters(),_e=(X=Se.encodings)===null||X===void 0?void 0:X[0];ye.scalabilityMode=MP(Y),_e&&Object.assign(_e,ye),Object.assign(Se,ue),await W.setParameters(Se),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Se.encodings)))}catch(ue){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ue)}}(this.store.codec,s,ie("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Mn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=ac(m)),y&&y>=1&&at(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=y);const v=r.getParameters(),T=(c=v.encodings)===null||c===void 0?void 0:c[0];T&&Object.assign(T,u),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Mn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Tr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ra(r);return s.forEach((u,h)=>{const m=o[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(fS(y,u),XG(y,u,this.store.codec))}),zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,u,h,m;const v=r[y],T=s[y];if(T instanceof Tr&&!at(o=T._hints).call(o,pr.LOW_STREAM)&&(c=T._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=T._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=T._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,s){if(!Fr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Tr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Tr&&ie("SIMULCAST")&&this.store.codec==="vp8"&&!at(s=r._hints).call(s,pr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(ie("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Mn().supportPCSetConfiguration){const s=Cy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Et(Cn.prototype,"updateRemoteRTPCapabilities",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateRemoteRTPCapabilities"),Cn.prototype),Et(Cn.prototype,"connect",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"connect"),Cn.prototype),Et(Cn.prototype,"updateRemoteConnect",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateRemoteConnect"),Cn.prototype),Et(Cn.prototype,"createDataChannels",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"createDataChannels"),Cn.prototype),Et(Cn.prototype,"receive",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"receive"),Cn.prototype),Et(Cn.prototype,"batchReceive",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"batchReceive"),Cn.prototype),Et(Cn.prototype,"stopReceiving",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"stopReceiving"),Cn.prototype),Et(Cn.prototype,"muteRemote",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"muteRemote"),Cn.prototype),Et(Cn.prototype,"unmuteRemote",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"unmuteRemote"),Cn.prototype),Et(Cn.prototype,"muteLocal",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"muteLocal"),Cn.prototype),Et(Cn.prototype,"unmuteLocal",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"unmuteLocal"),Cn.prototype),Et(Cn.prototype,"close",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"close"),Cn.prototype),Et(Cn.prototype,"updateEncoderConfig",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateEncoderConfig"),Cn.prototype),Et(Cn.prototype,"updateSendParameters",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateSendParameters"),Cn.prototype),Et(Cn.prototype,"replaceTrack",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"replaceTrack"),Cn.prototype),Et(Cn.prototype,"updateAdaptation",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateAdaptation"),Cn.prototype),Et(Cn.prototype,"getRemoteSSRC",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"getRemoteSSRC"),Cn.prototype),Cn);function Zo(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}function k2(t,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=ac(r.width),o.height=ac(r.height);const c=ac(r.framerate||15);document.body.append(s),document.body.append(o);let u=t._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=o.getContext("2d");if(!h)throw new Oe(J.UNEXPECTED_ERROR,"can not get canvas context");const m=Mn(),y=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const T=s.videoWidth,R=s.videoHeight/T,P=o.width*R;Math.abs(P-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(s,0,0,o.width,o.height),y.requestFrame&&y.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,s.srcObject=new MediaStream([u]))},o.stopCapture=WL(()=>o.startCapture&&o.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},y}var YP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(YP||{}),gi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(gi||{}),sy=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(sy||{}),_i=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(_i||{}),oy=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(oy||{}),DH=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(DH||{}),Uh=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Uh||{}),ea=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(ea||{}),xH=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(xH||{}),ta=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ta||{}),XP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(XP||{});const ay=1e3,cy=6,JP=3,t_e=Math.max(cy,JP);function Ft(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function LH(t){const r={[ta.CONN_TYPE]:0,[ta.RTT]:t.rtt,[ta.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[ta.CONN_TYPE]=1),s==="tcp"&&(r[ta.CONN_TYPE]=3),s==="tls"&&(r[ta.CONN_TYPE]=4);break}case"srflx":r[ta.CONN_TYPE]=2;break;case"unknown":r[ta.CONN_TYPE]=5;break;default:r[ta.CONN_TYPE]=0}return r}function MH(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class UH extends Mr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%JP==0,o=r%cy==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,o);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&u){const v=this.getInboundStats(u,o?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,o);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[XP.RTC_PEER_CONNECTION_STATE]=IL[y]):m.misc=[{addition:{[XP.RTC_PEER_CONNECTION_STATE]:IL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[XP.RTC_PEER_CONNECTION_STATE]:IL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===t_e+1&&(r=1)},ay)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[ta.RTT]:r.rtt,[ta.CONN_TYPE]:void 0,[ta.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=LH(r);if(this.store.useP2P){if(s){const u=LH(s);c[ta.CONN_TYPE]+=u[ta.CONN_TYPE]<<3}c[ta.CONN_TYPE]+=110}else c[ta.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,y;return u.forEach(v=>{let[T,{track:R,ssrcs:P}]=v;switch(T){case Ke.LocalVideoLowTrack:case Ke.LocalVideoTrack:if(T===Ke.LocalVideoTrack){const N=function(W,Y,X,ue,ye,Se){const _e=Y.videoSend.find(ft=>ft.ssrc===W);if(!_e)return;const Ne={},{sentFrame:Je,inputFrame:ht}=_e;if(Se&&(Ft(Ne,gi.QP_SUM,_e.qpSumPerFrame),ht&&Je)){const ft=ht.frameRate,Sn=Je.frameRate;Ne[gi.FREEZE]=function(bn,fr){let ci=!0;return ci=!(bn<=5)&&(bn<=10?fr<3:bn<=20?fr<4:fr<5),ci}(ft,Sn)?1:0}if(ye){switch(Je&&(Ft(Ne,gi.HEIGHT,Je.height),Ft(Ne,gi.WIDTH,Je.width),Ft(Ne,gi.FRAME_RATE,Je.frameRate)),Ne[gi.DISABLED]=ue._originMediaStreamTrack&&!ue._originMediaStreamTrack.enabled||ue._mediaStreamTrack&&!ue._mediaStreamTrack.enabled?1:0,_e.adaptionChangeReason){case"none":Ne[gi.ADAPTATION]=0;break;case"cpu":Ne[gi.ADAPTATION]=1;break;case"bandwidth":Ne[gi.ADAPTATION]=2;break;case"other":Ne[gi.ADAPTATION]=3}let ft=0;_e.adaptionChangeReason&&(ft+=MH(_e.adaptionChangeReason)),Y.qualityLimitationReason&&(ft+=MH(Y.qualityLimitationReason)<<3),Ne[gi.ADAPTATION]=ft,Ne[gi.PLAYER_STATUS]=FL[ue._player?ue._player.videoElementStatus:"uninit"],Ft(Ne,gi.NACKS,_e.nacksCount),Ft(Ne,gi.PLIS,_e.plisCount),Ft(Ne,gi.FIRS,_e.firsCount),Ft(Ne,gi.AVG_ENCODE,_e.avgEncodeMs),Ft(Ne,gi.HUGE_FRAME_SENT,_e.hugeFramesSent),Ft(Ne,gi.BYTES_RETRANSMIT,_e.retransmittedBytesSent),Ft(Ne,gi.PACKAGES_RETRANSMIT,_e.retransmittedPacketsSent),Ft(Ne,gi.KEY_FRAMES_ENCODED,_e.keyFramesEncoded);const Sn=X&&X.videoSend.find(bn=>bn.ssrc===W);if(Sn){let bn=ye?ay:ay*cy;Sn.timestamp&&_e.timestamp&&(bn=_e.timestamp-Sn.timestamp),Sn.packets!=null&&_e.packets!=null&&Ft(Ne,gi.PACKAGE_RATE,1e3*(_e.packets-Sn.packets)/bn),_e.packetsLost!=null&&Sn.packetsLost!=null&&Ft(Ne,gi.PACKAGE_LOST,_e.packetsLost-Sn.packetsLost),Sn.bytes!=null&&_e.bytes!=null&&Ft(Ne,gi.BITRATE,8*(_e.bytes-Sn.bytes)/bn)}}return Ne}(P[0].ssrcId,r,s,R,o,c),G=R&&function(W,Y,X,ue){const ye=Y.videoSend.find(_e=>_e.ssrc===W);if(!ye)return null;const Se={};if(ue){const _e=ye.inputFrame,Ne=_e&&_e.height||X.videoHeight||0,Je=_e&&_e.width||X.videoWidth||0,ht=_e&&_e.frameRate||0;Ft(Se,YP.HEIGHT,Ne),Ft(Se,YP.WIDTH,Je),Ft(Se,YP.FRAME_RATE,ht)}return Se}(P[0].ssrcId,r,R,o),j=function(W,Y){const X={};return Y&&(Ft(X,gi.RETRANSMIT,W.bitrate.retransmit),Ft(X,gi.TARGET_ENCODED,W.bitrate.targetEncoded),Ft(X,gi.ACTUAL_ENCODED,W.bitrate.actualEncoded),Ft(X,gi.TRANSMIT,W.bitrate.transmit),Ft(X,gi.BANDWIDTH,W.sendBandwidth)),X}(r,o);m=Object.assign({},N,G,j)}else y=function(N,G,j,W){const Y=G.videoSend.find(ue=>ue.ssrc===N);if(!Y)return;const X={};if(W){const ue=Y.sentFrame;if(ue&&(Ft(X,sy.HEIGHT,ue.height),Ft(X,sy.WIDTH,ue.width),Ft(X,sy.FRAME_RATE,ue.frameRate)),j){const ye=j.videoSend.find(Se=>Se.ssrc===N);if(ye){let Se=ay*cy;ye.timestamp&&Y.timestamp&&(Se=Y.timestamp-ye.timestamp),ye.packets!=null&&Y.packets!=null&&Ft(X,sy.PACKAGE_RATE,1e3*(Y.packets-ye.packets)/Se),Y.packetsLost!=null&&ye.packetsLost!=null&&Ft(X,sy.PACKAGE_LOST,Y.packetsLost-ye.packetsLost),ye.bytes!=null&&Y.bytes!=null&&Ft(X,sy.BITRATE,8*(Y.bytes-ye.bytes)/Se)}}}return X}(P[0].ssrcId,r,s,o);break;case Ke.LocalAudioTrack:h=R&&function(N,G,j,W,Y){const X=G.audioSend.find(ye=>ye.ssrc===N);if(!X)return;const ue={};if(Y){ue[Uh.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const ye=100*W._source.getAccurateVolumeLevel(),Se=X.inputLevel;if(Se!=null){const Ne=Math.ceil(50*Math.log10(100*Se+1));Ft(ue,Uh.LEVEL,Ne)}Ft(ue,DH.PCM_LEVEL,ye),Ft(ue,Uh.AEC_RETURN_LOSS,X.aecReturnLoss),Ft(ue,Uh.AEC_RETURN_LOSS_ENH,X.aecReturnLossEnhancement),Ft(ue,Uh.BYTES_RETRANSMIT,X.retransmittedBytesSent),Ft(ue,Uh.PACKAGES_RETRANSMIT,X.retransmittedPacketsSent),ue[Uh.FREEZE]=0;const _e=j&&j.audioSend.find(Ne=>Ne.ssrc===N);if(_e){let Ne=ay*cy;_e.timestamp&&X.timestamp&&(Ne=X.timestamp-_e.timestamp),_e.bytes!=null&&X.bytes!=null&&Ft(ue,Uh.BITRATE,8*(X.bytes-_e.bytes)/Ne),_e.packets!=null&&X.packets!=null&&Ft(ue,Uh.PACKAGE_RATE,1e3*(X.packets-_e.packets)/Ne)}}return ue}(P[0].ssrcId,r,s,R,o)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[y,v]=m;const T={peer:y.uid};if(v.has(gt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(N,G,j,W,Y,X,ue,ye){const Se=G.videoRecv.find(bn=>bn.ssrc===N);if(!Se)return;const _e={},{receivedFrame:Ne,outputFrame:Je,decodeFrameRate:ht}=Se,ft=j&&j.videoRecv.find(bn=>bn.ssrc===N);if(Ft(_e,oy.FRAME_RATE_DECODE,ht),Se.framesRateFirefox&&Ft(_e,_i.FRAME_RATE,Se.framesRateFirefox),Ne&&Ft(_e,_i.FRAME_RATE,Ne.frameRate),Ft(_e,_i.FRAMES_DROPPED,Se.framesDroppedCount),Ft(_e,_i.BYTES_RETRANSMIT,Se.retransmittedBytesReceived),Ft(_e,_i.PACKAGES_RETRANSMIT,Se.retransmittedPacketsReceived),Ft(_e,_i.PACKAGES_DISCARDED,Se.packetsDiscarded),Ft(_e,_i.AVG_DECODE,Se.avgDecodeMs),Ft(_e,_i.AVG_PROCESSING_DELAY,Se.avgProcessingDelayMs),Ft(_e,_i.AVG_ASSEMBLY_TIME,Se.avgFramesAssembledFromMultiplePacketsMs),Ft(_e,_i.AVG_INTER_FRAME_DELAY,Se.avgInterFrameDelayMs),Ft(_e,_i.KEY_FRAMES_DECODED,Se.keyFramesDecoded),ft){const bn=G.timestamp-j.timestamp||ay*(ye?cy:ue?JP:1);Se.packetsLost!=null&&ft.packetsLost!=null&&Ft(_e,_i.PACKAGE_LOST,Se.packetsLost-ft.packetsLost),ft.bytes!=null&&Se.bytes!=null&&Ft(_e,_i.BITRATE,8*(Se.bytes-ft.bytes)/bn),ft.packets!=null&&Se.packets!=null&&Ft(_e,_i.PACKAGE_RATE,1e3*(Se.packets-ft.packets)/bn)}if(ye&&(Ft(_e,_i.QP_SUM,Se.qpSumPerFrame),_e[_i.FREEZE]=Y&&KT.isRemoteVideoFreeze(W,Se,ft)?1:0),ue){var Sn;Ne?(Ft(_e,_i.HEIGHT,Ne.height),Ft(_e,_i.WIDTH,Ne.width)):W&&(Ft(_e,_i.HEIGHT,W._videoHeight||0),Ft(_e,_i.WIDTH,W._videoWidth||0)),Je&&Ft(_e,oy.FRAME_RATE_OUTPUT,Je.frameRate);const bn=(Sn=W._player)===null||Sn===void 0?void 0:Sn.rendFrameRate.toFixed(0);if(bn&&Ft(_e,oy.FRAME_RATE_RENDER,+bn),Ft(_e,_i.JITTER_BUFFER,Se.jitterBufferMs),Ft(_e,_i.CURRENT_DELAY,Se.currentDelayMs),Ft(_e,_i.FIRS,Se.firsCount),Ft(_e,_i.NACKS,Se.nacksCount),Ft(_e,_i.PLIS,Se.plisCount),W){_e[_i.DISABLED]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1;const fr=W._player;if(fr){const{freezeTimeCounterList:ci,renderFreezeAccTime:Yr,videoElementStatus:ra}=fr;if(ci&&ci.length>0&&Ft(_e,oy.FREEZE_TIME,ci.splice(0,1)[0]),X&&cf.visibility==="visible"&&ra===io.PLAYING&&Mn().supportRequestVideoFrameCallback){const We=Math.min(6e3,Yr);fr.renderFreezeAccTime=Math.max(0,Yr-We),Ft(_e,oy.FREEZE_TIME_RENDER,We)}if(typeof Se.totalFreezesDuration=="number"){const We=ft&&ft.totalFreezesDuration?Se.totalFreezesDuration-ft.totalFreezesDuration:Se.totalFreezesDuration;Ft(_e,oy.FREEZE_DURATION,1e3*We)}}}if(_e[_i.PLAYER_STATUS]=FL[W._player?W._player.videoElementStatus:"uninit"],ft&&Se.totalInterFrameDelay!==void 0&&Se.totalSquaredInterFrameDelay!==void 0&&ft.totalInterFrameDelay!==void 0&&ft.totalSquaredInterFrameDelay!==void 0){const fr=Se.totalInterFrameDelay-ft.totalInterFrameDelay,ci=Se.totalSquaredInterFrameDelay-ft.totalSquaredInterFrameDelay,Yr=Se.framesDecodeCount-ft.framesDecodeCount,ra=fr/Yr*1e3,We=Math.round(1e3*Math.sqrt((ci-Math.pow(fr,2)/Yr)/Yr));!isNaN(We)&&ra+We>Math.max(3*ra,ra+150)&&(_e[_i.I_FRAME_DELAY]=We)}}return _e}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(T.video=P)}if(v.has(gt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,N,G,j,W,Y){const X=N.audioRecv.find(_e=>_e.ssrc===P);if(!X)return;const ue={},ye=G&&G.audioRecv.find(_e=>_e.ssrc===P);if(Ft(ue,ea.JITTER,X.jitterMs),Ft(ue,ea.BYTES_RETRANSMIT,X.retransmittedBytesReceived),Ft(ue,ea.PACKAGES_RETRANSMIT,X.retransmittedPacketsReceived),Ft(ue,ea.PACKAGES_DISCARDED,X.packetsDiscarded),Ft(ue,ea.AVG_PROCESSING_DELAY,X.avgProcessingDelayMs),ye){const _e=N.timestamp-G.timestamp||ay*(Y?cy:W?JP:1);X.packets!=null&&ye.packets!=null&&Ft(ue,ea.PACKAGE_RATE,1e3*(X.packets-ye.packets)/_e),W&&ye.bytes!=null&&X.bytes!=null&&Ft(ue,ea.BITRATE,8*(X.bytes-ye.bytes)/_e),X.packetsLost!=null&&ye.packetsLost!=null&&Ft(ue,ea.PACKAGE_LOST,X.packetsLost-ye.packetsLost)}if(Y){const{receivedFrames:_e,droppedFrames:Ne}=X;_e!=null&&Ne!=null&&(ue[ea.FREEZE]=(Se=_e)===0||100*Ne/Se>20?1:0)}var Se;if(W){const _e=100*j._source.getAccurateVolumeLevel(),Ne=X.outputLevel;if(Ne!=null){const Je=Math.ceil(50*Math.log10(100*Ne+1));Ft(ue,xH.LEVEL,Je)}if(Ft(ue,ea.PCM_LEVEL,_e),j&&(ue[ea.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1),Ft(ue,ea.JITTER_BUFFER,X.jitterBufferMs),Ft(ue,ea.CURRENT_DELAY,X.jitterBufferMs),ue[ea.PLAYER_STATUS]=FL[Qo.getPlayerState(j.getTrackId())],ye){const Je=X.concealedSamples-ye.concealedSamples;Je>0&&Ft(ue,ea.CONCEALED_SAMPLES,Je);const ht=X.totalSamplesReceived-ye.totalSamplesReceived;ht>0&&Ft(ue,ea.TOTAL_SAMPLES_RECEIVED,ht)}}return ue}(y._audioSSRC,r,s,y.audioTrack,o,c):void 0;R&&(T.audio=R)}(T.video||T.audio)&&h.push(T)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof vP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(UT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(gt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(gt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:ie("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,T]of h)T.has(gt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),T.has(gt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,T){const R={};for(const{id:j,value:W,level:Y,direction:X}of v){var P;const ue=(P=T.get(j))!==null&&P!==void 0?P:0,ye=W===2?ue+ie("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ue;var N,G;T.set(j,ye),R[j]?(W===2&&(R[j].value=W),Y>R[j].level&&(R[j].level=Y),X==="remote"&&(R[j].remoteUidCount+=1),R[j].totalTs=(N=T.get(j))!==null&&N!==void 0?N:0):R[j]={value:W,level:Y,remoteUidCount:X==="local"?0:1,totalTs:(G=T.get(j))!==null&&G!==void 0?G:0}}return Object.keys(R).map(j=>{const{level:W,value:Y,totalTs:X}=R[j];return{id:j,level:W,value:Y,totalTs:X}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(UT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:y})},ie("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const n_e=ie("ICE_RESTART_INTERVAL");let QP=new Map,ES=new Map,Jm=[Ns.UDP_TCP_RELAY,Ns.TCP_RELAY,Ns.RELAY],N2=ie("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Mn().supportPCSetConfiguration;function VH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=QP.get(t.id);s&&(window.clearTimeout(s),QP.delete(t.id));const o=ES.get(t.id);r&&o&&o.index===Jm.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),ES.delete(t.id))}function jH(t,r,s){if(QP.size===0&&ES.size===0&&(Array.isArray(ie("RESTART_SEQUENCE"))&&ie("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const T=m[v];if(m.filter(R=>R===T).length!==y.filter(R=>R===T).length)return!1}return!0}(Jm,ie("RESTART_SEQUENCE"))&&(Jm=ie("RESTART_SEQUENCE").filter(m=>{var y;if(at(y=Object.values(Ns)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Jm.join(" => ")))),N2=ie("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Mn().supportPCSetConfiguration),Jm.length===0)return void s();let o,{index:c=0,type:u}=ES.get(t.id)||{};if(N2&&u===Ns.RELAY)return void s();let h=u&&c>=Jm.length-1;if(N2)u=Ns.RELAY;else{if(h)return void s();u?(c++,u=Jm[c]):(u=Jm[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),ES.set(t.id,{index:c,type:u}),o=window.setTimeout(()=>jH(t,r,s),n_e),QP.set(t.id,o)}var hn;function FH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Vh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?FH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):FH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function BH(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=nL,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new ZP(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function ZP(t){function r(s){if(Object(s)!==s)return dt.reject(new TypeError(s+" is not an object."));var o=s.done;return dt.resolve(s.value).then(function(c){return{value:c,done:o}})}return ZP=function(s){this.s=s,this.n=s.next},ZP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?dt.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?dt.reject(s):r(o.apply(this.s,arguments))}},new ZP(t)}let YT=(hn=class extends Mr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Nt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Kn.Disconnected),K(this,"_pcStatsUploadType",ie("NEW_ICE_RESTART")?hf.FIRST_CONNECTION:hf.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Kn.Connected)return void c(new xe(J.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const y=this.createMuteMessage(h);await dr(this,Nt.RequestMuteLocal,y),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Kn.Connected)return void c(new xe(J.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding){const T=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T}else{const T=k2(s,OT(this,Nt.RequestLowStreamParameter));v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T}await new dt((T,R)=>{this.handleReplaceTrack(v.track,T,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const y=this.createUnmuteMessage(h);await dr(this,Nt.RequestUnmuteLocal,y),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Kn.Connected)return void o();const{id:v,track:T}=y;await this.connection.updateSendParameters(v,T),await this.connection.updateEncoderConfig(v,T),this.emit(Nt.UpdateVideoEncoder,T),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Kn.Connected)return void o();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(s,o,c,u)=>{if(!this.connection||this.state!==Kn.Connected)return void o();const h=P2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),K(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:R}]=T;return s===R});if(!this.connection||!v||this.state!==Kn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const T=v[1];T.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],T)}if(v[0]===Ke.LocalVideoTrack&&!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding){const T=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(T){const R=s._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=R,T.track._originMediaStreamTrack=R,await new dt((P,N)=>{this.handleReplaceTrack(T.track,P,N,!0)})}}o()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new UH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Os("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Mn().supportUnifiedPlan||ie("CHROME_FORCE_PLAN_B")&&sf(),this.shouldForwardP2PCreation=ie("FORWARD_P2P_CREATION")&&Mn().supportPCSetConfiguration&&fL(),this.shouldForwardP2PCreation&&(this.connection=qP(this.store),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Kn.New,this._forceTurn=kH(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=qP(this.store,t),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new xe(J.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=ie("NEW_ICE_RESTART")?hf.FIRST_CONNECTION:hf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new xe(J.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");ie("ENABLE_PREALLOC_PC")&&this.state===Kn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Kn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return at(u=[Ke.LocalVideoLowTrack,Ke.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Mh){if(Rt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!at(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>at(t).call(t,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Mh&&this.connection.peerConnectionState!=="closed"&&at(t=[Kn.New,Kn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Kn.Connected){if(this.state===Kn.Disconnected)throw new xe(J.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var o;at(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var o=this;return wl(function*(){const c=yield In(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&at(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Kn.Connected||h){if(o.state===Kn.Disconnected)throw new xe(J.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(y),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ds.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield In(o.tryToUnmuteAudio(t)));yield*KA(BH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return wl(function*(){r.forEach(P=>{let{track:N,type:G}=P;const j=Date.now();s.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:N}=P;return N}),c=yield In(t.send(o,s.store.codec,s.store.audioCodec)),u=(yield In(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===J.WS_ABORT&&r.forEach(N=>{let{track:G}=N;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,o),v=(yield In(c.next(y))).value;if(s.state===Kn.Disconnected)throw new xe(J.UNEXPECTED_ERROR,"PeerConnection already disconnected.");ie("ENABLE_VIDEO_SEI");const T=ie("ENABLE_ENCODED_TRANSFORM"),R=ie("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const N=P.getRTCRtpTransceiver();if(!N||!T)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:j}=BP();P.trackMediaType===gt.VIDEO?await G(N.sender,P):P.trackMediaType===gt.AUDIO&&await j(N.sender,{metadata:R?()=>{const W=P.metadata.shift();return W&&W.value}:void 0})}),r.forEach(P=>{let{type:N}=P;s.statsCollector.addLocalStats(N)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:N,type:G}=P;const j=Date.now();s.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Tr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=p2(u,h)),m.maxFramerate=u.framerate?ac(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Ke.LocalVideoLowTrack||!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=ac(m.width)),m.height&&(y.height=ac(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=WL(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},ac(m.framerate)))})(u,t)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(t){var r=this;return wl(function*(){if(!r.connection||r.state!==Kn.Connected)return;const s=yield In(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ke.LocalVideoTrack);if(!c)throw new xe(J.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ke.LocalVideoLowTrack))throw new xe(J.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:Ke.LocalVideoLowTrack}];if(yield*KA(BH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Ke.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield In(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await bs(this,Nt.RequestRePublish,this.pendingLocalTracks),this.emit(Nt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await bs(this,Nt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==gt.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==gt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await bs(this,Nt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===gt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Nt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Kn.Connected)return void t.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Kn.Connected)return void t.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Kn.Connected)return;const t=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ke.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Kn.Connected)throw new xe(J.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(t,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(o=>o.id)}async subscribe(t,r,s,o,c){var u;if(!this.connection||this.state!==Kn.Connected)throw new xe(J.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const P=c.find(G=>{let{stream_type:j}=G;return j===r});if(!P)throw new xe(J.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof Mh&&(y=N.transceiver),h=N.track,m=N.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(t._uintid),void 0);this.connection instanceof Mh&&(y=P.transceiver),h=P.track,m=P.id}if(r===gt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new oS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new sS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&ie("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:N}=BP();r==gt.VIDEO?await P(y.receiver,{onSei:ie("ENABLE_VIDEO_SEI")&&(G=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(G)})}):r==gt.AUDIO&&await N(y.receiver,{enableTopn:!!ie("ENABLE_AUDIO_TOPN"),enableMetadata:!!ie("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(Nt.AudioMetadata,G)}})}const T=this.remoteUserMap.get(t);T?T.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:N,kind:G}=P;return N.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Nt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Kn.Connected)throw new xe(J.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?s.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:y,id:v,transceiver:T}=m;if(T&&ie("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=BP();u==gt.VIDEO?await N(T.receiver,{onSei:ie("ENABLE_VIDEO_SEI")&&(j=>{var W;return(W=c._videoTrack)===null||W===void 0?void 0:W._onSei(j)})}):u==gt.AUDIO&&await G(T.receiver,{enableTopn:!!ie("ENABLE_AUDIO_TOPN"),enableMetadata:!!ie("ENABLE_AUDIO_METADATA"),onMetadata:j=>{this.safeEmit(Nt.AudioMetadata,j)}})}if(u===gt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new oS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),T&&c._audioTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new sS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),T&&c._videoTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(c,c._videoTrack)),ie("ENABLE_VIDEO_SEI")&&T){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=BP();u==gt.VIDEO?await N(T.receiver,{onSei:j=>{var W;(W=c._videoTrack)===null||W===void 0||W._onSei(j)}}):u==gt.AUDIO&&await G(T.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(N=>{let{user:G,kind:j}=N;return G.uid===c.uid&&u===j});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(Nt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Kn.Connected||s||o.forEach(h=>{let{kind:m}=h;var y;if(m===gt.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===gt.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Kn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,T;if(y===gt.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===gt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((T=m._videoTrack)===null||T===void 0||T._destroy(),m._videoTrack=void 0);else if(y===gt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(t);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return u!==void 0?y.uid===c.uid&&u===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Kn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===gt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===gt.VIDEO){var y;(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0}});const s=Za(t).call(t,(c,u)=>{let{user:h,mediaType:m}=u;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,y;if(h===gt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===gt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0;else if(h===gt.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(t){return!this.connection||this.state!==Kn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Oi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ke.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===Ke.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===Ke.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=o?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof qr),m=o?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Tr);Rt.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===gt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ds.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Os("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=qP(this.store),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ke.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Oi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Kn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ke.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ke.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Tr||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Fc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=pT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Kn.Reconnecting,ie("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=qP(this.store),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case Ke.LocalVideoTrack:at(r=o._hints).call(r,pr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ke.LocalAudioTrack:o instanceof Oi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ke.LocalVideoLowTrack:}}),this.emit(Nt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Fc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Nt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Fc(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((t instanceof Xm?t.uid:t)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Xm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return wl(function*(){if(!r.connection||r.state!==Kn.Connected)return;const s=yield In(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield In(r.connection.restartICE(t));const u=yield In(o.next());if(u.done)return;const h=u.value,m=yield h;switch(O2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ns.UDP_TCP_RELAY:r._pcStatsUploadType=hf.UDP_TCP_RESTART;break;case Ns.TCP_RELAY:r._pcStatsUploadType=hf.TCP_RESTART;break;case Ns.RELAY:r._pcStatsUploadType=hf.RELAY_RESTART;break;default:r._pcStatsUploadType=hf.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalAudioTrack),o=t.videoSend.find(N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(N=>N.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Vc(this,Nt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&u?(y+u)/2:y||u)||0,T=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(pr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const j=(1e3*N-G)/(1e3*N);return SG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Vc(this,Nt.NeedSignalRTT),v=t.rtt,T=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let N=.7*P*100/50+.3*T/1500;R&&(N=.6*P*100/50+.2*T/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new dt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Kn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!o)return;const c=o[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ke.LocalVideoTrack&&!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new dt((m,y)=>{this.handleReplaceTrack(u.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const o=[],c=this.getAllTracks();t=$v(t=t.filter(y=>c.indexOf(y)===-1));let u,h=!1;const m=this.localTrackMap.get(Ke.LocalAudioTrack);for(const y of t){if(y instanceof Tr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new xe(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:Ke.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);o.push({track:v,type:Ke.LocalVideoLowTrack})}if(y instanceof qr)if(m){const v=m.track;if(v instanceof Oi)A2([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const T=P2([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(T.getTrackId(),"]")),this.replaceTrack(v,T)}}else u instanceof Oi?(A2([y]),u.addAudioTrack(y)):u||!y._useAudioElement&&Mn().webAudioMediaStreamDest&&!y._bypassWebAudio?u=P2(u?[y,u]:[y]):u=y}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Ke.LocalAudioTrack})),o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=$v(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof qr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Oi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(o instanceof Tr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=$v(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=$v(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ke.LocalVideoTrack:s.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(yt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Oi?t.trackList.forEach(s=>{s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ke.LocalVideoTrack:s.off(yt.GET_STATS,this.handleGetLocalVideoStats),s.off(yt.GET_RTC_STATS,this.handleGetRTCStats),s.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Oi?t.trackList.forEach(r=>{r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof sS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof oS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let u,h,{track:m,type:y}=s;switch(y){case Ke.LocalAudioTrack:u=qn.Audio,h={dtx:m instanceof vP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ke.LocalVideoTrack:u=at(c=m._hints).call(c,pr.SCREEN_TRACK)?qn.Screen:qn.High,h=Vh(Vh({},jG(m)),{},{codec:this.store.codec,svc_mode:MP()});break;case Ke.LocalVideoLowTrack:u=qn.Low,h=Vh(Vh({},jG(m)),{},{codec:this.store.codec,svc_mode:MP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:o=at(s=u._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Nt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Mh&&!Fr()&&ie("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},ie("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Mh&&VH(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=hf.DISCONNECTED_OR_FAILED,Vc(this,Nt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Rt.reportApiInvoke(this.store.sessionId,{name:Ti.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:Wr.TRACER}).onSuccess(),this.republish()}if(ie("NEW_ICE_RESTART")&&t instanceof Mh&&!Fr()&&!this._forceTurn){if(at(NG).call(NG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{O2(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Vc(this,Nt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Nt.RequestRestartICE,c))},o=()=>{O2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Nt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{jH(t,s,o)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&ie("ICE_RESTART")&&Vc(this,Nt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Nt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Nt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Nt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(Nt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(Fc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(eS.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(Fc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(Fc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Fi.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Nt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Km(s))," -> ").concat(JSON.stringify(Km(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Km(s))," -> ").concat(JSON.stringify(Km(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Vh(Vh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Mh&&function(r){ES.delete(r.id),VH(r)}(t),t.close(),this.emit(Nt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive||r.push([Ke.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o&&(r.push(o),o[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive&&r.push([Ke.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o)if(o[0]===Ke.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoTrack:o=at(s=u._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoTrack:o=at(s=u._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let u=r.get(o);c===gt.VIDEO?u|=Bi.Video:u|=Bi.Audio,r.set(o,u)}else c===gt.VIDEO?r.set(o,Bi.Video):r.set(o,Bi.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new dt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new dt((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||u===void 0?void 0:u.attributes;if(m&&ie("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(at(y).call(y,pr.SCREEN_TRACK)||at(y).call(y,pr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof qr){var r;const o=this.filterTobeUnmutedTracks(t[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await dr(this,Nt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Nt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Nt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await os(bL(this.dtlsFailedCount,wi)),this.emit(Nt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await bs(this,Nt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Nt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Tr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Tr).length>1)throw new xe(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof qr).length>1&&(t.some(r=>r instanceof qr&&r._bypassWebAudio)||!Mn().webAudioMediaStreamDest))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Tr&&this.pendingLocalTracks.some(s=>s instanceof Tr))throw new xe(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof qr&&this.pendingLocalTracks.some(s=>s instanceof qr)&&(!Mn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof qr&&s._bypassWebAudio)))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const o=!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding,c=Vh(Vh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?t._mediaStreamTrack.clone():k2(t,c);const h=hr(8,"track-low-"),m=new Tr(u,Vh(Vh({},o&&{scaleResolutionDownBy:p2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(X_.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,Qv.LOW_STREAM)}),m._hints.push(pr.LOW_STREAM),at(s=t._hints).call(s,pr.SCREEN_TRACK)&&m._hints.push(pr.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(yt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Mh){var c,u,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:T,peerConnectionState:R}=this.connection,{local:P,remote:N}=await this.connection.getSelectedCandidatePair();Rt.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:T,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,o){var c;const u=Array.from(Fc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Fi.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ke.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Qv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Et(hn.prototype,"startP2PConnection",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"startP2PConnection"),hn.prototype),Et(hn.prototype,"connect",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"connect"),hn.prototype),Et(hn.prototype,"updateRemoteRTPCapabilities",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"updateRemoteRTPCapabilities"),hn.prototype),Et(hn.prototype,"publishDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"publishDataChannel"),hn.prototype),Et(hn.prototype,"unpublish",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unpublish"),hn.prototype),Et(hn.prototype,"unpublishDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishDataChannel"),hn.prototype),Et(hn.prototype,"unpublishLowStream",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishLowStream"),hn.prototype),Et(hn.prototype,"subscribeDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"subscribeDataChannel"),hn.prototype),Et(hn.prototype,"subscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"subscribe"),hn.prototype),Et(hn.prototype,"massSubscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"massSubscribe"),hn.prototype),Et(hn.prototype,"unsubscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribe"),hn.prototype),Et(hn.prototype,"unsubscribeDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribeDataChannel"),hn.prototype),Et(hn.prototype,"massUnsubscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"massUnsubscribe"),hn.prototype),Et(hn.prototype,"muteRemote",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"muteRemote"),hn.prototype),Et(hn.prototype,"unmuteRemote",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteRemote"),hn.prototype),Et(hn.prototype,"hasRemoteMediaWithLock",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"hasRemoteMediaWithLock"),hn.prototype),Et(hn.prototype,"disconnectForReconnect",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"disconnectForReconnect"),hn.prototype),Et(hn.prototype,"updateBitrateLimit",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"updateBitrateLimit"),hn.prototype),Et(hn.prototype,"remoteMediaSsrcChanged",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"remoteMediaSsrcChanged"),hn.prototype),hn);function oo(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}function WH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function zH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?WH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):WH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const r_e=Date.now(),i_e=20,D2=new Map,e1=new Map;async function GH(t){const r=D2.get(t),s=Array.isArray(r)&&r[r.length-1],o=e1.get(t);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const u=s.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),HH(s.context,c),m=0):m=Math.min(m,i_e),setTimeout(()=>r.length&&GH(t),m)}function HH(t,r){t.safeEmit(_n.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function s_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return HH(s,{uid:t.uid,payload:t.payload});const o="".concat(s.id,"-").concat(t.uid),c=D2.get(o)||[],u=c.findIndex(v=>t.sendTs>=v.sendTs),h=zH(zH({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),D2.set(o,c);let m=!1;var y;e1.has(o)?m=!((y=e1.get(o))===null||y===void 0||!y.isSyncing):e1.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||GH(o)}const o_e=An().name;function $H(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function KH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$H(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$H(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const vS="websdk_ng_cache_parameter",a_e=ie("MAX_PRELOAD_ASYNC_LENGTH"),c_e=1e4,ly=new Map,uy=[];let x2=null,L2=0,M2=0;const t1=new Map,l_e=function(t,r){const s=[];let o=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new dt(async(y,v)=>{s.push(async()=>{try{const T=await t(...h);y(T)}catch(T){v(T)}}),o<r&&(o++,c())})}}(qH,a_e),U2=Jo.CancelToken.source();async function qH(t,r,s,o,c,u){try{if(!ie("ENABLE_PRELOAD"))return;if(!Mn().supportWebCrypto)return void Bm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new xe(J.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ss(s,"token",1,2047),ss(t,"appid",1,2047),kP(r),o&&NP(o);const h=q_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:t,cname:r,token:s||t,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let y,v;typeof o=="string"?(m.stringUid=o,[v,y]=await dt.all([Hge(o,{sid:h,appId:t},U2.token),gH(KH(KH({},m),{},{token:s||t,uid:0}),U2.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),y=await gH(m,U2.token));const T={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||o,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let P;try{R.uid&&XH({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const N=e7(R),G=await async function(W,Y){try{const X=await window.crypto.subtle.importKey("raw",FW(Y),"AES-GCM",!1,["encrypt"]),ue=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},X,K_(window.btoa(JSON.stringify(W))));return Wm(new Uint8Array(ue))}catch{return}}(R,R.token||R.appId);if(!G)return;P=ZH(vS);const j=P?JSON.parse(P):[];j.push({[N]:G}),j.length>ie("AP_CACHE_NUM")&&j.shift(),n1(vS,JSON.stringify(j))}catch(N){x.warn("Error caching server parameters:",N.message),n1(vS,"")}}(T),L2++}catch(h){throw M2++,function(m){x2||(x2=window.setTimeout(()=>{let v="";t1.forEach((T,R)=>{v+="".concat(R,": ").concat(T," ;")}),Rt.reportApiInvoke(null,{name:Ti.PRELOAD,options:{success:L2,failed:M2,err:v}}).onError(m),L2=0,M2=0,t1.clear(),x2=null},c_e));const y=t1.get(m.code)||0;t1.set(m.code,y+1)}(h),h}}async function YH(t){try{if(ie("AP_REQUEST_DETAIL")||ie("ENABLE_ROLE_SELECT_EDGE"))return;const r=XH(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",FW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,K_(o));return JSON.parse(window.atob(Wm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<ie("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function XH(t){let r;try{if(r=ZH(vS),!r)return;const s=JSON.parse(r),o=e7(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>o in h);if(c===-1)return;const u=s.splice(c,1)[0];return n1(vS,JSON.stringify(s)),u[o]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),n1(vS,"")}}function V2(t){if(t){let r=ly.get(t);r&&(window.clearTimeout(r),r=null,ly.delete(t)),at(uy).call(uy,t)||t.cloudProxyServer!=="disabled"||uy.push(t)}if(ly.size<ie("AP_CACHE_NUM")&&uy.length>0){const r=uy.shift();ly.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await l_e(s,o,c,h,m,u),ly.has(r)&&V2(r)}catch(y){x.warn("update preload failed",y.message),JH(r)}},ie("AP_UPDATE_INTERVAL")))}}function JH(t){const r=uy.indexOf(t);r!==-1&&uy.splice(r,1);let s=ly.get(t);s&&(window.clearTimeout(s),s=null,ly.delete(t),V2())}function QH(t,r){const s=t.sua,o=t.ap;r&&s&&Rt.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Rt.reportResourceTiming(t.ap.url,t.sid),Rt.joinWebProxyAP(t.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK].toString()}),Rt.joinChooseServer(t.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function ZH(t){return window.atob(window.localStorage.getItem(t)||"")}function n1(t,r){window.localStorage.setItem(t,window.btoa(r))}function e7(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),KW(r)}function u_e(t){let r=function(){const s=p_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(yi(o,10),Qm(o,c));let u=s.cid;u!==void 0&&(yi(o,16),yi(o,u));let h=s.cname;h!==void 0&&(yi(o,26),Qm(o,h));let m=s.deviceId;m!==void 0&&(yi(o,34),Qm(o,m));let y=s.elapse;y!==void 0&&(yi(o,40),Zm(o,y));let v=s.fileSize;v!==void 0&&(yi(o,48),Zm(o,SS(v)));let T=s.height;T!==void 0&&(yi(o,56),Zm(o,SS(T)));let R=s.jpg;R!==void 0&&(yi(o,66),yi(o,R.length),n7(o,R));let P=s.networkType;P!==void 0&&(yi(o,72),Zm(o,SS(P)));let N=s.osType;N!==void 0&&(yi(o,80),Zm(o,SS(N)));let G=s.requestId;G!==void 0&&(yi(o,90),Qm(o,G));let j=s.sdkVersion;j!==void 0&&(yi(o,98),Qm(o,j));let W=s.sequence;W!==void 0&&(yi(o,104),Zm(o,SS(W)));let Y=s.sid;Y!==void 0&&(yi(o,114),Qm(o,Y));let X=s.timestamp;X!==void 0&&(yi(o,120),Zm(o,X));let ue=s.uid;ue!==void 0&&(yi(o,128),yi(o,ue));let ye=s.vid;ye!==void 0&&(yi(o,136),yi(o,ye));let Se=s.width;Se!==void 0&&(yi(o,144),Zm(o,SS(Se)));let _e=s.service;_e!==void 0&&(yi(o,152),yi(o,_e));let Ne=s.callbackData;Ne!==void 0&&(yi(o,162),yi(o,Ne.length),n7(o,Ne));let Je=s.ticket;Je!==void 0&&(yi(o,170),Qm(o,Je));let ht=s.vendorConfigs;ht!==void 0&&(yi(o,178),Qm(o,ht))}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function d_e(t){return function(s){let o={};e:for(;!f_e(s);){let c=XT(s);switch(c>>>3){case 0:break e;case 1:o.code=XT(s);break;case 2:o.msg=r7(s,XT(s));break;case 3:o.requestId=r7(s,XT(s));break;case 4:o.timestamp=m_e(s,!1);break;default:h_e(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function h_e(t,r){switch(r){case 0:for(;128&Cu(t););break;case 2:j2(t,XT(t));break;case 5:j2(t,4);break;case 1:j2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function SS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let p_e=[];function j2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function f_e(t){return t.offset>=t.limit}function r1(t,r){let s=t.bytes,o=t.offset,c=t.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),o}function t7(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function n7(t,r){let s=r1(t,r.length);t.bytes.set(r,s)}function r7(t,r){let s=t7(t,r),o=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let y,v,T,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],T=c[m+s+3],(12632256&(y|v<<8|T<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&T,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Qm(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}yi(t,o);let c=r1(t,o),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Cu(t){return t.bytes[t7(t,1)]}function i7(t,r){let s=r1(t,1);t.bytes[s]=r}function XT(t){let r,s=0,o=0;do r=Cu(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function yi(t,r){for(r>>>=0;r>=128;)i7(t,127&r|128),r>>>=7;i7(t,r)}function m_e(t,r){let s,o=0,c=0,u=0;return s=Cu(t),o=127&s,128&s&&(s=Cu(t),o|=(127&s)<<7,128&s&&(s=Cu(t),o|=(127&s)<<14,128&s&&(s=Cu(t),o|=(127&s)<<21,128&s&&(s=Cu(t),c=127&s,128&s&&(s=Cu(t),c|=(127&s)<<7,128&s&&(s=Cu(t),c|=(127&s)<<14,128&s&&(s=Cu(t),c|=(127&s)<<21,128&s&&(s=Cu(t),u=127&s,128&s&&(s=Cu(t),u|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function Zm(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=r1(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const s7={},o7={},i1=4294967296,g_e=i1*i1,__e=g_e/2;c7(0,!0);const a7=c7(0),y_e=JT(0,-2147483648,!1),E_e=JT(-1,2147483647,!1);function c7(t,r){let s,o,c;return r?(c=0<=(t>>>=0)&&t<256)&&(o=o7[t],o)?o:(s=JT(t,0,!0),c&&(o7[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(o=s7[t],o)?o:(s=JT(t,t<0?-1:0,!1),c&&(s7[t]=s),s)}function JT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function l7(t,r){if(isNaN(t))return a7;{if(t<=-9223372036854776e3)return y_e;if(t+1>=__e)return E_e}return t<0?a7:JT(t%i1|0,t/i1|0,r)}function u7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class F2 extends Mr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Od.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",Al.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Jo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==Al.CONNECTED)throw new Oe(J.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Al.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=hr(5,"image-moderation-"),this._workerMessageLengthLimit=ie("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=ie("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=ie("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new FT("worker-"+this._moderationId,wi),this.on(Od.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(uS[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Od.STATE_CHANGE,uS.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new dt((c,u)=>{this.on(Od.CONNECTION_STATE_CHANGE,(h,m)=>{h===Al.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Al.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=ie("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),u=await function(y,v,T,R){let{appId:P,areaCode:N,cname:G,sid:j,token:W,uid:Y}=v;gS++;const X="moderation_plugin",ue={service_name:X,json_body:JSON.stringify({appId:P,areaCode:N,cname:G,command:"allocateEdge",requestId:gS,seq:gS,sid:j,appToken:W,ts:Date.now(),uid:Y+""})};let ye,Se,_e=y[0];return Rd(async()=>{ye=Date.now();const Ne=await kd(_e,{data:ue,cancelToken:T,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Se=Date.now()-ye,Ne.code!==0){const ft=new Oe(J.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:Se});throw x.error(ft.toString()),ft}const Je=JSON.parse(Ne.json_body);if(Je.code!==200){const ft=new Oe(J.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Je.code,", reason: ").concat(Je.reason),{code:Je.code,responseTime:Se});throw x.error(ft.toString()),ft}if(!Je.servers||!Array.isArray(Je.servers)||Je.servers.length===0){const ft=new Oe(J.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Je.code,responseTime:Se});throw x.error(ft.toString()),ft}if(!Je.servers.some(ft=>!!ft.wss)){const ft=new Oe(J.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Je.code,responseTime:Se});throw x.error(ft.toString()),ft}const ht=ie("IMAGE_MODERATION_WORKER_HOST");return{addressList:Je.servers.map(ft=>{let{address:Sn,wss:bn}=ft;if(Sn&&bn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(ht,":").concat(bn,"/moderation")}).filter(ft=>!!ft),workerToken:Je.workerToken,vid:Je.vid,ticket:Je.appTicket,responseTime:Se}},(Ne,Je)=>(Rt.apworkerEvent(j,{success:!0,sc:200,serviceName:X,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Je===0,responseTime:Se,serverIp:y[Je%y.length]}),!1),(Ne,Je)=>(Rt.apworkerEvent(j,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:X,responseTime:Se,serverIp:y[Je%y.length]}),!!(Ne.code!==J.OPERATION_ABORTED&&Ne.code!==J.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(_e=y[(Je+1)%y.length],!0)),R)}(c,r,s,o);this.emit(Od.STATE_CHANGE,uS.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(Od.STATE_CHANGE,uS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Xt.CONNECTED,async()=>{this.emit(Od.STATE_CHANGE,uS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Al.CONNECTED}),this._workerConnection.on(Xt.CLOSED,()=>{this.connectionState=Al.CLOSED}),this._workerConnection.on(Xt.FAILED,()=>{this.connectionState=Al.CLOSED}),this._workerConnection.on(Xt.RECONNECTING,()=>{this.connectionState=this.connectionState===Al.CONNECTED?Al.RECONNECTING:Al.CONNECTING}),this._workerConnection.on(Xt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=d_e(new Uint8Array(r.data));ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Rt.reportApiInvoke(this._connectInfo.sid||null,{name:Ti.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Wr.TRACER}).onError(new Oe(J.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},ie("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Xt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Xt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Vc(this,Od.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const v=Date.now(),T=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await Mz(T,o,c),P=this._sequence+"-"+u+"-"+y+"-"+v+"-"+hr(12,""),N={appId:o,cid:u,cname:c,deviceId:"",elapse:F2.intToLong(Number(v-this._moderationStartTime)),fileSize:T.buffer.byteLength,height:T.height,width:T.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:l7(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const G=u_e(N);if(G.byteLength<this._workerMessageLengthLimit){if(ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(W){for(var Y=1;Y<arguments.length;Y++){var X=arguments[Y]!=null?arguments[Y]:{};Y%2?u7(Object(X),!0).forEach(function(ue){K(W,ue,X[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(X)):u7(Object(X)).forEach(function(ue){Object.defineProperty(W,ue,Object.getOwnPropertyDescriptor(X,ue))})}return W}({},N);delete j.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return G}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Jo.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Al.CLOSED,this.emit(Od.STATE_CHANGE,uS.CLOSED)}}function d7(t){if(ir(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(J.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(J.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const v_e={name:"ImageModeration",create:function(t){let{config:r}=t;return d7(r),new F2(r)}};var h7,p7,f7,m7,g7,_7,y7,E7,v7,S7,b7,T7,w7,C7,R7,I7,A7,P7,O7,k7,N7,D7,x7,L7,M7,U7,V7,j7,F7,B7,W7,z7,G7,H7,$7,K7,q7,Y7,X7,J7,Q7,pt;function Z7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Ru(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Z7(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Z7(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}Os.setLogger(x);let S_e=(h7=jt(),p7=jt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof nS))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),f7=jt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==tS.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),m7=jt({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),g7=jt({argsMap:(t,r,s)=>[r,s]}),_7=jt({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),y7=jt({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),E7=jt({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),v7=jt(),S7=jt(),b7=jt(),T7=jt(),w7=jt(),C7=jt(),R7=jt(),I7=jt(),A7=jt(),P7=jt(),O7=jt(),k7=jt(),N7=jt(),D7=jt(),x7=jt(),L7=jt({argsMap:(t,r)=>[r]}),M7=jt(),U7=jt(),V7=jt(),j7=jt(),F7=jt(),B7=jt(),W7=jt(),z7=jt(),G7=jt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),H7=jt(),$7=jt(),K7=jt(),q7=jt(),Y7=jt(),X7=jt(),J7=jt({reportResult:!0}),Q7=jt(),pt=class extends Mr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",Jo.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(ie("BLOCK_LOCAL_CLIENT")&&ny(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(_n.USER_JOINED,u));else{const h=new Xm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(_n.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(ie("BLOCK_LOCAL_CLIENT")&&ny(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:oP(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(_n.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,y,v,T)=>{if(ie("BLOCK_LOCAL_CLIENT")&&ny(u,this.channelName))return;const R=this._users.find(N=>N.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),T!==void 0&&(R._rtxSsrcId=T),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(_n.USER_PUBLISHED,R,c)),c==="video"?Rt.onGatewayStream(this._sessionId,Fi.ON_ADD_VIDEO_STREAM,kr.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:R._videoSSRC}):Rt.onGatewayStream(this._sessionId,Fi.ON_ADD_AUDIO_STREAM,kr.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(N=>{if(N&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof YT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(N=>{x.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),K(this,"_handleRemoveStream",c=>{if(ie("BLOCK_LOCAL_CLIENT")&&ny(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(_n.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof YT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),Rt.onGatewayStream(this._sessionId,Fi.ON_REMOVE_STREAM,kr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(ie("BLOCK_LOCAL_CLIENT")&&ny(u,this.channelName))return;const m=this._users.find(T=>T.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const T=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===T)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const T=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===T)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,u,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(_n.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(_n.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(ie("BLOCK_LOCAL_CLIENT")&&ny(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(T=>T.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const T=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===T)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const T=m._video_muted_;if(m._video_muted_=h,m._video_muted_===T)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,c,R)}}const v=u==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(_n.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(_n.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(_n.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(_n.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const y=this._users.find(T=>T.uid===u);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(_n.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(T=>{x.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._config=t,this._clientId=r||hr(5,"client-"),this.store=new class{constructor(c,u,h,m){$t(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Y_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case yn.SET_SESSION_ID:return mt(mt({},u),{},{sessionId:h.sessionId});case yn.SET_P2P_ID:return mt(mt({},u),{},{p2pId:h.p2pId});case yn.SET_UID:return mt(mt({},u),{},{uid:h.uid});case yn.SET_INT_UID:return mt(mt({},u),{},{intUid:h.intUid});case yn.SET_PUB_ID:return mt(mt({},u),{},{pubId:h.pubId});case yn.KEY_METRIC_CLIENT_CREATED:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{clientCreated:h.metric})});case yn.KEY_METRIC_JOIN_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinStart:h.metric})});case yn.AVOID_JOIN_START:return mt(mt({},u),{},{avoidJoinStart:h.avoidJoinStart});case yn.KEY_METRIC_JOIN_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinEnd:h.metric})});case yn.KEY_METRIC_REQUEST_AP_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPStart:h.metric})});case yn.KEY_METRIC_REQUEST_AP_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case yn.KEY_METRIC_JOIN_GATEWAY_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case yn.KEY_METRIC_JOIN_GATEWAY_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case yn.KEY_METRIC_PEER_CONNECTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case yn.KEY_METRIC_PEER_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case yn.KEY_METRIC_DESCRIPTION_START:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{descriptionStart:h.metric})});case yn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case yn.KEY_METRIC_ICE_CONNECTION_END:return mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case yn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=mt(mt({},m[y]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case yn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=mt(mt({},m[y]),h.metric),mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...m]})})):mt(mt({},u),{},{keyMetrics:mt(mt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case yn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case yn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=mt(mt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case yn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case yn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case yn.SET_USE_P2P:return mt(mt({},u),{},{useP2P:h.val});case yn.SET_TRANSPORT_TYPE:return mt(mt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:yn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:yn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:yn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:yn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:yn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:yn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:yn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:yn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:yn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:yn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:yn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:yn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:yn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:yn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:yn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:yn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:yn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:yn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:yn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:yn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:yn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:yn.KEY_METRIC_PUBLISH,metric:mt(mt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,y,v,T){this.dispatch({type:yn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt(mt(mt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),T&&{firstDecoded:T})})}massSubscribe(c,u,h,m){c.forEach(y=>{this.dispatch({type:yn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt({userId:y.userId,type:y.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:yn.RECORD_JOIN_CHANNEL_SERVICE,record:mt(mt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:yn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:yn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:yn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:yn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Os("client-leave",this._clientId),this._publishMutex=new Os("client-publish",this._clientId),this._renewTokenMutex=new Os("client-renewtoken",this._clientId),this._subscribeMutex=new Os("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Cl," build: ").concat(NL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{EL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new KT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(_n.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&Rt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new jge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||wi,httpRetryConfig:t.httpRetryConfig||wi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new Yge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},pf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new YT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];tr("JOIN_GATEWAY_USE_443PORT_ONLY",u),tr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof d2&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(y,v,T){tP.get(y)||tP.set(y,[]),nP.get(y)||nP.set(y,v),Ah.get(y)||Ah.set(y,0);const R=tP.get(y),P=nP.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ah.get(y)===P){const Y=wT();R.push(Y),await Y.promise}Ah.set(y,Ah.get(y)+1);for(var N=arguments.length,G=new Array(N>3?N-3:0),j=3;j<N;j++)G[j-3]=arguments[j];const W=await T(...G);return Ah.set(y,Ah.get(y)-1),Ah.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),Ah.get(y)===0&&(tP.set(y,[]),nP.set(y,0),Ah.set(y,0)),W}("client.join",ie("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,o,c)}async join(t,r,s,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(lP||lP||(lP=(window.location.protocol.split(":")[0]||"").toUpperCase(),lP))==="HTTPS",m=XW()?window.isSecureContext:"Browser Not Support";(!XW()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Rt.setAppId(t);try{if(!s&&s!==null)throw new Oe(J.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ss(s,"token",1,2047),ss(t,"appid",1,2047),kP(r),o&&NP(o),c&&ss(c,"optionalInfo",1,2047)}catch(j){throw Rt.reportApiInvoke(q_(),{name:Ti.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Rt.reportApiInvoke(q_(),{name:Ti.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(j),j}this._gateway.state="CONNECTING";const y=await YH({appId:t,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||q_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const T=Rt.reportApiInvoke(v,{id:this._clientId,name:Ti.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}),R=Ru(Ru(Ru({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:ie("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async j=>{const W=function(ye){const Se=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_e=new Uint8Array(new ArrayBuffer(Se.length));for(let Ne=0;Ne<Se.length;Ne+=1)_e[Ne]=Se.charCodeAt(Ne);return _e}(),Y=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),X=_L(j),ue=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,X);return function(ye){let Se="";for(let _e=0;_e<ye.length;_e+=1)Se+=String.fromCharCode(ye[_e]);return window.btoa(Se)}(new Uint8Array(ue))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,W=ie("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(R.appId+this._encryptionSecret+this._encryptionSecret):j.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,X,ue){const ye=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Se=Y==="aes-128-gcm2"?128:256,_e=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:oz,hash:"SHA-256",salt:ue},ye,Se+mme);return new Uint8Array(_e).subarray(Se/8)}(this._encryptionMode,W,K_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,X,ue){const ye=await window.crypto.subtle.importKey("raw",X,"PBKDF2",!1,["deriveBits","deriveKey"]),Se=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:oz,hash:"SHA-256",salt:ue},ye,{name:"AES-GCM",length:Se},!0,["encrypt","decrypt"])}(this._encryptionMode,W,K_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Rt.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let j;const W=R.cloudProxyServer;if(at(N=["proxy3","proxy4","proxy5"]).call(N,W)){const Se=ie("PROXY_SERVER_TYPE3");Array.isArray(Se)?R.proxyServer=Se[0]:R.proxyServer=Se}if(Rt.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},ie("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Se=(await BG(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(_e=>({turnServerURL:_e.address,tcpport:_e.tcpport||Ts.tcpport,udpport:_e.udpport||Ts.udpport,username:_e.username||Ts.username,password:_e.password||Ts.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Se}}QH(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let Se;[Se,j]=await dt.all([mH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,this.store),fH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Se)),R.uid=Se,j.gatewayInfo.uid=Se,j.gatewayInfo.res.uid=Se}else j=await fH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(VT.UPDATE_BITRATE_LIMIT,Se=>{this._p2pChannel.updateBitrateLimit(Se)}),this._configDistribute.on(VT.UPDATE_CLIENT_ROLE_OPTIONS,Se=>{this._setClientRoleOptions(Se)})},0),this._key=s||t;const Y=j.gatewayInfo,X=R.uid?R.uid:Y.uid;this._joinInfo=Ru(Ru({},R),{},{cid:Y.cid,uid:X,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=X,this.store.cid=Y.cid;const ue=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));T.onSuccess(ue),this._appId=t,this._channelName=R.cname,this._uid=ue,this.store.uid=ue,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,at(ty).call(ty,G)||ty.push(G),this._cloudProxyServerMode==="disabled"&&Mn().supportWebCrypto&&ie("ENABLE_PRELOAD")&&V2(this._joinInfo),ue}catch(j){const W=Array.isArray(j)?j[0]:j;throw W&&W.code===J.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),W):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),W),W.code!==J.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),T.onError(W),W}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(J.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!ie("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=ty.indexOf(r);s!==-1&&ty.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",$n.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof nS))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(J.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(J.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof nS))throw new Oe(J.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(J.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Tr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(t){ir(t.id,"id",0,65535,!0),of(t.ordered,"ordered"),ss(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(J.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(J.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ie("FORCE_TURN")&&!ie("TURN_ENABLE_TCP")&&!ie("TURN_ENABLE_UDP"))throw new Oe(J.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return sH(c,!1)}(t),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(J.CREATE_DATACHANNEL_ERROR);try{await dt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==J.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(J.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof nS))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(ai.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(o=>"".concat(o.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof Xm)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");t=o}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(xi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(J.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===gt.AUDIO,o=r===gt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new Oe(J.UNEXPECTED_RESPONSE,"no ssrc id");let T=this._users.find(P=>P.uid===t);T||(T=new Xm(t,v||t),T._is_pre_created=!0,this._users.push(T)),y&&(T._cname=y),T._uintid||(T._uintid=v||t),s&&(T._audioSSRC=u,T._audio_pre_subscribed=!0,h&&(T._audioOrtc=h)),o&&(T._videoSSRC=u,T._video_pre_subscribed=!0,h&&(T._videoOrtc=h),m!=null&&(T._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(T,r,u,m,h);const R=s?T._audioTrack:T._videoTrack;if(!R)throw new Oe(J.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(T._trust_audio_stream_added_state_=!0,T._audio_added_=!0),o&&(T._trust_video_stream_added_state_=!0,T._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var s;if(ir(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(J.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(J.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&at(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(J.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==J.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,s){if(xi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new Oe(J.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new Oe(J.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new Oe(J.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(xi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Oe(J.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Oe(J.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const T=r==="audio"?t._audioSSRC:t._videoSSRC;T!==void 0&&T!==c&&(c=T,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c}),Ds.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==J.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(T){throw this._p2pChannel.reportSubscribeEvent(!1,T==null?void 0:T.code,t,r),T}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(T=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),T)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Oe(J.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(af(t,"subscribeList"),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:T,mediaType:R}=v;if(xi(R,"mediaType",["audio","video"]),!T){const j=new Oe(J.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===T)){const j=new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(T.uid,", this user is not in the channel")),c[y].error=j,t.splice(y,1);continue}if(R==="audio"&&(!T.hasAudio||T._audioSSRC===void 0)||R==="video"&&(!T.hasVideo||T._videoSSRC===void 0)){const j=new Oe(J.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(T.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=j,t.splice(y,1);continue}const N=Bi.Video|Bi.LwoVideo,G=s.get(T);if(G){if(R==="video"?G&N:G&Bi.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(T.uid,", mediaType:").concat(R," twice"));continue}s.set(T,G|(R==="video"?N:Bi.Audio))}else s.set(T,R==="video"?N:Bi.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:T,mediaType:R}=v,P=Bi.Video|Bi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(T,R)){await this._p2pChannel.unmuteRemoteNoLock(T,R);const N=s.get(T);s.set(T,R==="video"?N^P:N^Bi.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=Za(h=Array.from(s.entries())).call(h,(y,v)=>{let[T,R]=v;if(R===0)return y;const P={stream_id:T.uid,stream_type:R};return R&Bi.Audio&&(P.audio_ssrc=T._audioSSRC),R&Bi.Video&&(P.video_ssrc=T._videoSSRC),y.push(P),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:T,mediaType:R}=v;return{user:T,mediaType:R,ssrcId:R===gt.VIDEO?T._videoSSRC:T._audioSSRC,rtxSsrcId:R===gt.VIDEO?T._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(T=>{let{stream_id:R,video_error_code:P,audio_error_code:N,error_code:G}=T;(P||N||G)&&y.set(R,{video_error_code:P,audio_error_code:N,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(T=>{let[R,P]=T;const N=this.remoteUsers.find(G=>G.uid===R);if(N){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=gt.VIDEO:P.audio_error_code&&(G=gt.AUDIO),v.push({user:N,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const T=y.get(v.user.uid);if(T){const R=T.error_code||v.mediaType==="audio"&&T.audio_error_code||v.mediaType==="video"&&T.video_error_code;if(R){const P=jT(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(P.desc)),v.error=new Oe(J.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var T;Rt.subscribe(this.store.sessionId,{succ:!!v.error,ec:((T=v.error)===null||T===void 0?void 0:T.code)||null,video:v.mediaType===gt.VIDEO,audio:v.mediaType===gt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===gt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:T,mediaType:R}=v;return"user: ".concat(T==null?void 0:T.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{u(),o()}}async unsubscribe(t,r,s){if(!(t instanceof Xm)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&xi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&oP(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===J.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&ir(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(J.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=t._dataChannels;if(o===void 0){const c=new Oe(J.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,o);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===J.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(af(t,"unsubscribeList"),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:o,mediaType:c}=t[s];if(!o){const m=new Oe(J.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(xi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(s,1);continue}const h=Bi.Video|Bi.LwoVideo;if(r.has(o)){const m=r.get(o);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&Bi.Audio;break;default:y=m&(Bi.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(o,m|Bi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Bi.Audio|h)}else c?c==="audio"?r.set(o,Bi.Audio):c==="video"&&r.set(o,h):r.set(o,Bi.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===J.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new xe(J.INVALID_PARAMS);Br(s.width)||mL(s.width,"streamParameter.width"),Br(s.height)||mL(s.height,"streamParameter.height"),Br(s.framerate)||mL(s.framerate,"streamParameter.framerate"),Br(s.bitrate)||ir(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ke.LocalVideoLowTrack)}async enableDualStream(){if(!Mn().supportDualStream)throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(J.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(J.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ke.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Rt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(o){xi(o,"role",["audience","host"])}(t),r&&EL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(J.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(J.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(J.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&ie("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Ss.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&EL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(ss(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(J.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(J.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Rt.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(J.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(J.INVALID_OPERATION,"You have already set the proxy")}if(PT(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>VW(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(J.INVALID_OPERATION,"you should set license before join channel");if(ss(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(J.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(J.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(J.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(J.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(J.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(J.INVALID_OPERATION,"Stop proxy server after leave channel");Rt.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(J.INVALID_PARAMS,"accessPoints is required.");af(t.accessPoints.serverList,"accessPoints.serverList"),ss(t.accessPoints.domain,"accessPoints.domain");const r=(P,N)=>{ir(P,N,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(J.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");ie("CLOSE_AFB_FOR_LOCAL_AP")&&(tr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),tr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,tr("WEBCS_DOMAIN",h),tr("WEBCS_DOMAIN_BACKUP_LIST",h),tr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(af(t.report.hostname,"report.hostname"),tr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(tr("EVENT_REPORT_DOMAIN",u[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),tr("STATS_COLLECTOR_PORT",m),t.report?tr("ENABLE_EVENT_REPORT",!0):tr("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(af(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=u[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),tr("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let T=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(af(t.cds.hostname,"cds.hostname"),T=t.cds.hostname):T=u;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),tr("CDS_AP",T.map(P=>"".concat(P,":").concat(R))),t.cds?tr("ENABLE_CONFIG_DISTRIBUTE",!0):tr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(af(t,"serverList"),ss(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(J.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,tr("WEBCS_DOMAIN",t),tr("WEBCS_DOMAIN_BACKUP_LIST",t),tr("GATEWAY_DOMAINS",[r]),tr("EVENT_REPORT_DOMAIN",t[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),tr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(xi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){xi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){xi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,o){(function(u){xi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ss(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(at(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(J.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(J.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(of(o,"encryptDataStream"),!at(c).call(c,t))throw new Oe(J.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Wm(s))}async renewToken(t){if(ss(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(ie("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await qge(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wi);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(_n.VOLUME_INDICATOR,t)},ie("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(J.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(J.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(J.LIVE_STREAMING_TASK_CONFLICT);const s=r?uf.TRANSCODE:uf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(uf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(J.INVALID_PARAMS,"can not find live streaming url to stop");await dt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){bH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){bH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof YT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&at(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,t.payload=await async function(c,u,h){var m;const y=Za(m=Array.from(h)).call(m,(j,W)=>j+W,0),v={serverTs:0,seq:gme++,length:h.length,checkSum:y},T=new Uint8Array($W(y,2)),R=new ArrayBuffer(Yv),P=new DataView(R);P.setUint32(0,v.serverTs),P.setUint16(4,v.seq),P.setUint16(6,v.length),P.setUint16(8,v.checkSum);const N=16-h.length%16;h=BW(h,new Uint8Array(N));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:sz,additionalData:T},u,h);return BW(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(J.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Wt.DATA_STREAM,{payload:Wm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-r_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(J.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Wt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Wm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Cme),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"can not send custom report, not joined");await Rt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){xi(r.spatialLayer,"spatialLayer",[0,1,2,3]),xi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(of(r,"apRTM"),ir(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=cS.indexOf(t);r!==-1&&cS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Jo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&JH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Rt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Os("client-publish",this._clientId),this._subscribeMutex=new Os("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const o=t||q_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=t?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Rt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Rt.sessionInit(this._sessionId,Ru({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(J.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ie("FORCE_TURN")&&!ie("TURN_ENABLE_TCP")&&!ie("TURN_ENABLE_UDP"))throw new Oe(J.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(ai.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==J.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Tr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===J.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(J.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(J.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==J.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===J.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(J.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},pf("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:Ti.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Wr.TRACER}).onSuccess(),this.safeEmit(_n.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{Rt.reportApiInvoke(this._sessionId,{name:Ti.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Wr.TRACER}).onSuccess(),this.safeEmit(_n.LIVE_STREAMING_WARNING,c,u)},s.on(l2.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(J.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,T){const R=ie("UAP_AP").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Wge(R,m,y,v,T)})(c,this._joinInfo,this._axiosCancelSource.token,wi).then(u).catch(h)}),s};return t===uf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(J.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},pf("ChannelMediaRelay").create(t));o.on("state",c=>{c===Ia.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(_n.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(_n.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:o}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:T}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),at(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:v,metadata:T},N=function(G){return sH(G,!0)}(P);R._dataChannels.push(N),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(_n.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(_n.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,y=this._users.find(T=>T._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(T=>T.id===u.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(T=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),T)return this._gateway.unsubscribeDataChannel(T,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(_n.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(_n.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(es.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=s||u||n2()||!Object.prototype.hasOwnProperty.call(hP,o)||(Id[o]=c,br[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(es.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(es.CONNECTION_STATE_CHANGE,(t,r,s)=>{var o;if(s===$n.FALLBACK)return;const c=()=>{this.safeEmit(_n.CONNECTION_STATE_CHANGE,t,r,s)};if(Rt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Ti.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Wr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(es.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(J.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await YH(Ru(Ru({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,QH(o),this._joinInfo.preload=!0):(s=await C2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(es.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(_n.NETWORK_QUALITY,t)}),this._gateway.on(es.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(_n.STREAM_TYPE_CHANGED,t,r),Rt.reportApiInvoke(this._sessionId,{name:Ti.STREAM_TYPE_CHANGE,options:[t,r],tag:Wr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(es.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(es.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();ie("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(t)),r(o)}catch(o){s(o)}}),this._gateway.on(es.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=KG(t.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(es.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=ie("FINGERPRINT"))!==null&&o!==void 0?o:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(En.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(En.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(En.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(En.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(En.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(En.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(En.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(En.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(En.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,gt.AUDIO,!0)),this._gateway.signal.on(En.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,gt.AUDIO,!1)),this._gateway.signal.on(En.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,gt.VIDEO,!0)),this._gateway.signal.on(En.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,gt.VIDEO,!1)),this._gateway.signal.on(En.RECEIVE_METADATA,t=>{const r=K_(t.metadata);this.safeEmit(_n.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(En.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=K_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&at(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Yv)throw new Oe(J.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Yv));s=await async function(u,h,m){const y=m.subarray(0,Yv),v=y.slice(8,Yv),T=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:sz,additionalData:new Uint8Array($W(T,2))},h,m.subarray(Yv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),s_e(Ru(Ru({},t),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(En.ON_CRYPT_ERROR,()=>{Bm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(_n.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,$n.TOKEN_EXPIRE),this.safeEmit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(En.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(_n.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(En.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(En.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(En.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(zt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Wt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const u=c.some(y=>{let{stream_type:v}=y;return v===qn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==qn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===qn.Screen||v===qn.ScreenLow});r.state==="offer"&&Rt.publish(this._joinInfo.sid,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:J.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(y=>{let{stream_type:v}=y;return v===qn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(y=>{let{stream_type:v}=y;return v!==qn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Wt.SUBSCRIBE:r&&Rt.subscribe(this._joinInfo.sid,{succ:!1,ec:J.TIMEOUT,audio:r.stream_type===gt.AUDIO,video:r.stream_type===gt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Ds.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(En.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(En.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;ie("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(o=>!ny(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of t.users){let c=this._users.find(T=>T._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Xm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(_n.USER_JOINED,c)));const u=Bi.Audio&o.stream_type,h=(Bi.Video|Bi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,y=u&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!y&&this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(_n.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(_n.USER_PUBLISHED,c,"video")),(u&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(_n.PUBLISHED_USER_LIST).length>0?ie("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(_n.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(En.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof YT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return at(o=Object.keys(pP)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(En.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ai.PUBLISH,(t,r,s)=>{const{uid:o}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const v=this._users.find(T=>T.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,u,!!y)})}),this._gateway.signal.on(ai.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(zt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(ai.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const y=m===qn.Audio?gt.AUDIO:gt.VIDEO;await this._p2pChannel.unsubscribe(u,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(ai.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case Hm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,gt.VIDEO,!0);break;case Hm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,gt.AUDIO,!0);break;case Hm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,gt.VIDEO,!1);break;case Hm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,gt.AUDIO,!1)}}),this._gateway.signal.on(ai.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=t;o!==Po.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(ai.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Nt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:o}=t;r(await this._gateway.sendExtensionMessage(ai.RESTART_ICE,t,o===Po.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(Nt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(ai.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Nt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(ai.CONTROL,t,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(Nt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===J.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===J.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.StateChange,(t,r)=>{r===Kn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Nt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(_n.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Nt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===J.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===J.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(Nt.RequestRePublishDataChannel,(t,r,s)=>{dt.all(t.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==J.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(Nt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:o,kind:c}of t)c===gt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(Nt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Nt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Nt.MediaReconnectStart,t=>{this.safeEmit(_n.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Nt.MediaReconnectEnd,t=>{this.safeEmit(_n.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Nt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Nt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(Nt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Nt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=KG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Nt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(Nt.P2PLost,()=>{this.safeEmit(_n.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Nt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Nt.ConnectionTypeChange,t=>{this.safeEmit(_n.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Nt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Nt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Nt.AudioMetadata,t=>{this.safeEmit(_n.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},pf("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:y,vid:v?Number(v):0},wi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(ts.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(_n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===bu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(_n.CONTENT_INSPECT_ERROR,new Oe(J.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(ts.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===J.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(_n.CONTENT_INSPECT_RESULT,r,s)}),t.on(ts.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(of(t,"enabled"),t){if(!r)throw new Oe(J.INVALID_PARAMS,"config is required");if(d7(r),!this._joinInfo)throw new Oe(J.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},pf("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:y,cid:v,vid:T}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:y,cid:v,vid:T?Number(T):0},wi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Oe(J.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(t){t.on(Od.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(_n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Al.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(J.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Od.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){xi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(J.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){of(t,"enabled"),tr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Et(pt.prototype,"leave",[h7],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),Et(pt.prototype,"publish",[p7],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),Et(pt.prototype,"unpublish",[f7],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),Et(pt.prototype,"subscribe",[m7],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),Et(pt.prototype,"presubscribe",[g7],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),Et(pt.prototype,"massSubscribe",[_7],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),Et(pt.prototype,"unsubscribe",[y7],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),Et(pt.prototype,"massUnsubscribe",[E7],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),Et(pt.prototype,"setLowStreamParameter",[v7],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),Et(pt.prototype,"enableDualStream",[S7],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),Et(pt.prototype,"disableDualStream",[b7],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),Et(pt.prototype,"setClientRole",[T7],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),Et(pt.prototype,"_setClientRoleOptions",[w7],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),Et(pt.prototype,"setProxyServer",[C7],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),Et(pt.prototype,"setTurnServer",[R7],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),Et(pt.prototype,"setLicense",[I7],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),Et(pt.prototype,"startProxyServer",[A7],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),Et(pt.prototype,"stopProxyServer",[P7],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),Et(pt.prototype,"setLocalAccessPointsV2",[O7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),Et(pt.prototype,"setLocalAccessPoints",[k7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),Et(pt.prototype,"setRemoteDefaultVideoStreamType",[N7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),Et(pt.prototype,"setRemoteVideoStreamType",[D7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),Et(pt.prototype,"setStreamFallbackOption",[x7],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),Et(pt.prototype,"setEncryptionConfig",[L7],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),Et(pt.prototype,"renewToken",[M7],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),Et(pt.prototype,"enableAudioVolumeIndicator",[U7],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),Et(pt.prototype,"startLiveStreaming",[V7],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),Et(pt.prototype,"setLiveTranscoding",[j7],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),Et(pt.prototype,"stopLiveStreaming",[F7],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),Et(pt.prototype,"startChannelMediaRelay",[B7],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),Et(pt.prototype,"updateChannelMediaRelay",[W7],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),Et(pt.prototype,"stopChannelMediaRelay",[z7],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),Et(pt.prototype,"sendCustomReportMessage",[G7],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),Et(pt.prototype,"pickSVCLayer",[H7],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),Et(pt.prototype,"setRTMConfig",[$7],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),Et(pt.prototype,"enableContentInspect",[K7],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),Et(pt.prototype,"disableContentInspect",[q7],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),Et(pt.prototype,"setImageModeration",[Y7],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),Et(pt.prototype,"setP2PTransport",[X7],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),Et(pt.prototype,"getJoinChannelServiceRecords",[J7],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),Et(pt.prototype,"setPublishAudioFilterEnabled",[Q7],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class QT{constructor(r,s){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),QT.count+=1,this.id=QT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new dt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new Oe(J.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(J.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(J.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var e$,s1;K(QT,"count",0);const b_e=window.AudioContext||window.webkitAudioContext,T_e=new(e$=jt({report:Rt}),Et((s1=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new b_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new QT(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return An().name!==Bn.SAFARI}}).prototype,"processExternalMediaAEC",[e$],Object.getOwnPropertyDescriptor(s1.prototype,"processExternalMediaAEC"),s1.prototype),s1);function t$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function n$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?t$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):t$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const B2=window||document;function r$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!B2)return;const s=Ci._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(Ci.onSecurityPolicyViolation||Ci.getListeners(xh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;ie("CSP_DETECTED_HOSTNAME_LIST").some(h=>at(u).call(u,h))&&(Ci.onSecurityPolicyViolation&&typeof Ci.onSecurityPolicyViolation=="function"&&Ci.onSecurityPolicyViolation(c),Ci.getListeners(xh.SECURITY_POLICY_VIOLATION).length>0&&Ci.safeEmit(xh.SECURITY_POLICY_VIOLATION,c))};s&&B2.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Ci.getListeners(xh.SECURITY_POLICY_VIOLATION).length>0)&&B2.addEventListener("securitypolicyviolation",o),Ci._cspEventHandlerPointer=o}var w_e=k,C_e=F8,i$=RegExp.prototype,R_e=function(t){return t===i$||w_e(i$,t)?C_e(t):t.flags},ao=l(R_e);function bS(t){let r=t.length;for(;--r>=0;)t[r]=0}const W2=256,s$=286,ZT=30,ew=15,z2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),I_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gf=new Array(576);bS(gf);const tw=new Array(60);bS(tw);const nw=new Array(512);bS(nw);const rw=new Array(256);bS(rw);const G2=new Array(29);bS(G2);const a1=new Array(ZT);function H2(t,r,s,o,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=t&&t.length}let a$,c$,l$;function $2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}bS(a1);const u$=t=>t<256?nw[t]:nw[256+(t>>>7)],iw=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},qc=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,iw(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},jh=(t,r,s)=>{qc(t,s[2*r],s[2*r+1])},d$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},h$=(t,r,s)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=ew;c++)h=h+s[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=d$(o[m]++,m))}},p$=t=>{let r;for(r=0;r<s$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<ZT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},f$=t=>{t.bi_valid>8?iw(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},m$=(t,r,s,o)=>{const c=2*r,u=2*s;return t[c]<t[u]||t[c]===t[u]&&o[r]<=o[s]},K2=(t,r,s)=>{const o=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&m$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!m$(r,o,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=o},g$=(t,r,s)=>{let o,c,u,h,m=0;if(t.sym_next!==0)do o=255&t.pending_buf[t.sym_buf+m++],o+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],o===0?jh(t,c,r):(u=rw[c],jh(t,u+W2+1,r),h=z2[u],h!==0&&(c-=G2[u],qc(t,c,h)),o--,u=u$(o),jh(t,u,s),h=o1[u],h!==0&&(o-=a1[u],qc(t,o,h)));while(m<t.sym_next);jh(t,256,r)},q2=(t,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=o[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)K2(t,s,h);y=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],K2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,K2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((T,R)=>{const P=R.dyn_tree,N=R.max_code,G=R.stat_desc.static_tree,j=R.stat_desc.has_stree,W=R.stat_desc.extra_bits,Y=R.stat_desc.extra_base,X=R.stat_desc.max_length;let ue,ye,Se,_e,Ne,Je,ht=0;for(_e=0;_e<=ew;_e++)T.bl_count[_e]=0;for(P[2*T.heap[T.heap_max]+1]=0,ue=T.heap_max+1;ue<573;ue++)ye=T.heap[ue],_e=P[2*P[2*ye+1]+1]+1,_e>X&&(_e=X,ht++),P[2*ye+1]=_e,ye>N||(T.bl_count[_e]++,Ne=0,ye>=Y&&(Ne=W[ye-Y]),Je=P[2*ye],T.opt_len+=Je*(_e+Ne),j&&(T.static_len+=Je*(G[2*ye+1]+Ne)));if(ht!==0){do{for(_e=X-1;T.bl_count[_e]===0;)_e--;T.bl_count[_e]--,T.bl_count[_e+1]+=2,T.bl_count[X]--,ht-=2}while(ht>0);for(_e=X;_e!==0;_e--)for(ye=T.bl_count[_e];ye!==0;)Se=T.heap[--ue],Se>N||(P[2*Se+1]!==_e&&(T.opt_len+=(_e-P[2*Se+1])*P[2*Se],P[2*Se+1]=_e),ye--)}})(t,r),h$(s,v,t.bl_count)},_$=(t,r,s)=>{let o,c,u=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},y$=(t,r,s)=>{let o,c,u=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<y&&c===h)){if(m<v)do jh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(jh(t,c,t.bl_tree),m--),jh(t,16,t.bl_tree),qc(t,m-3,2)):m<=10?(jh(t,17,t.bl_tree),qc(t,m-3,3)):(jh(t,18,t.bl_tree),qc(t,m-11,7));m=0,u=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let E$=!1;const v$=(t,r,s,o)=>{qc(t,0+(o?1:0),3),f$(t),iw(t,s),iw(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var A_e=t=>{E$||((()=>{let r,s,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(G2[c]=o,r=0;r<1<<z2[c];r++)rw[o++]=c;for(rw[o-1]=c,u=0,c=0;c<16;c++)for(a1[c]=u,r=0;r<1<<o1[c];r++)nw[u++]=c;for(u>>=7;c<ZT;c++)for(a1[c]=u<<7,r=0;r<1<<o1[c]-7;r++)nw[256+u++]=c;for(s=0;s<=ew;s++)h[s]=0;for(r=0;r<=143;)gf[2*r+1]=8,r++,h[8]++;for(;r<=255;)gf[2*r+1]=9,r++,h[9]++;for(;r<=279;)gf[2*r+1]=7,r++,h[7]++;for(;r<=287;)gf[2*r+1]=8,r++,h[8]++;for(h$(gf,287,h),r=0;r<ZT;r++)tw[2*r+1]=5,tw[2*r]=d$(r,5);a$=new H2(gf,z2,257,s$,ew),c$=new H2(tw,o1,0,ZT,ew),l$=new H2(new Array(0),I_e,0,19,7)})(),E$=!0),t.l_desc=new $2(t.dyn_ltree,a$),t.d_desc=new $2(t.dyn_dtree,c$),t.bl_desc=new $2(t.bl_tree,l$),t.bi_buf=0,t.bi_valid=0,p$(t)},P_e=(t,r,s,o)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<W2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),q2(t,t.l_desc),q2(t,t.d_desc),h=(m=>{let y;for(_$(m,m.dyn_ltree,m.l_desc.max_code),_$(m,m.dyn_dtree,m.d_desc.max_code),q2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*o$[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?v$(t,r,s,o):t.strategy===4||u===c?(qc(t,2+(o?1:0),3),g$(t,gf,tw)):(qc(t,4+(o?1:0),3),((m,y,v,T)=>{let R;for(qc(m,y-257,5),qc(m,v-1,5),qc(m,T-4,4),R=0;R<T;R++)qc(m,m.bl_tree[2*o$[R]+1],3);y$(m,m.dyn_ltree,y-1),y$(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),g$(t,t.dyn_ltree,t.dyn_dtree)),p$(t),o&&f$(t)},O_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(rw[s]+W2+1)]++,t.dyn_dtree[2*u$(r)]++),t.sym_next===t.sym_end),k_e=t=>{qc(t,2,3),jh(t,256,gf),(r=>{r.bi_valid===16?(iw(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},N_e={_tr_init:A_e,_tr_stored_block:v$,_tr_flush_block:P_e,_tr_tally:O_e,_tr_align:k_e},sw=(t,r,s,o)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const D_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ko=(t,r,s,o)=>{const c=D_e,u=o+s;t^=-1;for(let h=o;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},dy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},c1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:x_e,_tr_stored_block:Y2,_tr_flush_block:L_e,_tr_tally:eg,_tr_align:M_e}=N_e,{Z_NO_FLUSH:tg,Z_PARTIAL_FLUSH:U_e,Z_FULL_FLUSH:V_e,Z_FINISH:Iu,Z_BLOCK:S$,Z_OK:na,Z_STREAM_END:b$,Z_STREAM_ERROR:Fh,Z_DATA_ERROR:j_e,Z_BUF_ERROR:X2,Z_DEFAULT_COMPRESSION:F_e,Z_FILTERED:B_e,Z_HUFFMAN_ONLY:l1,Z_RLE:W_e,Z_FIXED:z_e,Z_DEFAULT_STRATEGY:G_e,Z_UNKNOWN:H_e,Z_DEFLATED:u1}=c1,J2=286,$_e=30,K_e=19,q_e=2*J2+1,Y_e=15,hy=258,Bh=262,TS=42,py=113,ow=666,fy=(t,r)=>(t.msg=dy[r],r),T$=t=>2*t-(t>4?9:0),ng=t=>{let r=t.length;for(;--r>=0;)t[r]=0},X_e=t=>{let r,s,o,c=t.w_size;r=t.hash_size,o=r;do s=t.head[--o],t.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=t.prev[--o],t.prev[o]=s>=c?s-c:0;while(--r)};let rg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Ol=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},kl=(t,r)=>{L_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Ol(t.strm)},Qr=(t,r)=>{t.pending_buf[t.pending++]=r},aw=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},Q2=(t,r,s,o)=>{let c=t.avail_in;return c>o&&(c=o),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=sw(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ko(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},w$=(t,r)=>{let s,o,c=t.max_chain_length,u=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-Bh?t.strstart-(t.w_size-Bh):0,v=t.window,T=t.w_mask,R=t.prev,P=t.strstart+hy;let N=v[u+h-1],G=v[u+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===N&&v[s]===v[u]&&v[++s]===v[u+1]){u+=2,s++;do;while(v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&u<P);if(o=hy-(P-u),u=P-hy,o>h){if(t.match_start=r,h=o,o>=m)break;N=v[u+h-1],G=v[u+h]}}while((r=R[r&T])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},wS=t=>{const r=t.w_size;let s,o,c;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Bh)&&(t.window.set(t.window.subarray(r,r+r-o),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),X_e(t),o+=r),t.strm.avail_in===0)break;if(s=Q2(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=rg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=rg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Bh&&t.strm.avail_in!==0)},C$=(t,r)=>{let s,o,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,o=t.strstart-t.block_start,s>o+t.strm.avail_in&&(s=o+t.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==Iu||r===tg||s!==o+t.strm.avail_in)))break;h=r===Iu&&s===o+t.strm.avail_in?1:0,Y2(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Ol(t.strm),o&&(o>s&&(o=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,s-=o),s&&(Q2(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==tg&&r!==Iu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(Q2(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,o=t.strstart-t.block_start,(o>=u||(o||r===Iu)&&r!==tg&&t.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===Iu&&t.strm.avail_in===0&&s===o?1:0,Y2(t,t.block_start,s,h),t.block_start+=s,Ol(t.strm)),h?3:1)},Z2=(t,r)=>{let s,o;for(;;){if(t.lookahead<Bh){if(wS(t),t.lookahead<Bh&&r===tg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=rg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Bh&&(t.match_length=w$(t,s)),t.match_length>=3)if(o=eg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=rg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=rg(t,t.ins_h,t.window[t.strstart+1]);else o=eg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(kl(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Iu?(kl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(kl(t,!1),t.strm.avail_out===0)?1:2},CS=(t,r)=>{let s,o,c;for(;;){if(t.lookahead<Bh){if(wS(t),t.lookahead<Bh&&r===tg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=rg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Bh&&(t.match_length=w$(t,s),t.match_length<=5&&(t.strategy===B_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,o=eg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=rg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(kl(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(o=eg(t,0,t.window[t.strstart-1]),o&&kl(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=eg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Iu?(kl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(kl(t,!1),t.strm.avail_out===0)?1:2};function Wh(t,r,s,o,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const cw=[new Wh(0,0,0,0,C$),new Wh(4,4,8,4,Z2),new Wh(4,5,16,8,Z2),new Wh(4,6,32,32,Z2),new Wh(4,4,16,16,CS),new Wh(8,16,32,32,CS),new Wh(8,16,128,128,CS),new Wh(8,32,128,256,CS),new Wh(32,128,258,1024,CS),new Wh(32,258,258,4096,CS)];function J_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=u1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*q_e),this.dyn_dtree=new Uint16Array(2*(2*$_e+1)),this.bl_tree=new Uint16Array(2*(2*K_e+1)),ng(this.dyn_ltree),ng(this.dyn_dtree),ng(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Y_e+1),this.heap=new Uint16Array(2*J2+1),ng(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*J2+1),ng(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const lw=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==TS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==py&&r.status!==ow?1:0},R$=t=>{if(lw(t))return fy(t,Fh);t.total_in=t.total_out=0,t.data_type=H_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?TS:py,t.adler=r.wrap===2?0:1,r.last_flush=-2,x_e(r),na},I$=t=>{const r=R$(t);return r===na&&(s=>{s.window_size=2*s.w_size,ng(s.head),s.max_lazy_match=cw[s.level].max_lazy,s.good_match=cw[s.level].good_length,s.nice_match=cw[s.level].nice_length,s.max_chain_length=cw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},A$=(t,r,s,o,c,u)=>{if(!t)return Fh;let h=1;if(r===F_e&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==u1||o<8||o>15||r<0||r>9||u<0||u>z_e||o===8&&h!==1)return fy(t,Fh);o===8&&(o=9);const m=new J_e;return t.state=m,m.strm=t,m.status=TS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,I$(t)};var Q_e=(t,r)=>{if(lw(t)||r>S$||r<0)return t?fy(t,Fh):Fh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===ow&&r!==Iu)return fy(t,t.avail_out===0?X2:Fh);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Ol(t),t.avail_out===0)return s.last_flush=-1,na}else if(t.avail_in===0&&T$(r)<=T$(o)&&r!==Iu)return fy(t,X2);if(s.status===ow&&t.avail_in!==0)return fy(t,X2);if(s.status===TS&&s.wrap===0&&(s.status=py),s.status===TS){let c=u1+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=l1||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,aw(s,c),s.strstart!==0&&(aw(s,t.adler>>>16),aw(s,65535&t.adler)),t.adler=1,s.status=py,Ol(t),s.pending!==0)return s.last_flush=-1,na}if(s.status===57){if(t.adler=0,Qr(s,31),Qr(s,139),Qr(s,8),s.gzhead)Qr(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Qr(s,255&s.gzhead.time),Qr(s,s.gzhead.time>>8&255),Qr(s,s.gzhead.time>>16&255),Qr(s,s.gzhead.time>>24&255),Qr(s,s.level===9?2:s.strategy>=l1||s.level<2?4:0),Qr(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Qr(s,255&s.gzhead.extra.length),Qr(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ko(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Qr(s,0),Qr(s,0),Qr(s,0),Qr(s,0),Qr(s,0),Qr(s,s.level===9?2:s.strategy>=l1||s.level<2?4:0),Qr(s,3),s.status=py,Ol(t),s.pending!==0)return s.last_flush=-1,na}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ko(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Ol(t),s.pending!==0)return s.last_flush=-1,na;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(t.adler=ko(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=ko(t.adler,s.pending_buf,s.pending-u,u)),Ol(t),s.pending!==0)return s.last_flush=-1,na;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Qr(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=ko(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=ko(t.adler,s.pending_buf,s.pending-u,u)),Ol(t),s.pending!==0)return s.last_flush=-1,na;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Qr(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=ko(t.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ol(t),s.pending!==0))return s.last_flush=-1,na;Qr(s,255&t.adler),Qr(s,t.adler>>8&255),t.adler=0}if(s.status=py,Ol(t),s.pending!==0)return s.last_flush=-1,na}if(t.avail_in!==0||s.lookahead!==0||r!==tg&&s.status!==ow){let c=s.level===0?C$(s,r):s.strategy===l1?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(wS(u),u.lookahead===0)){if(h===tg)return 1;break}if(u.match_length=0,m=eg(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(kl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Iu?(kl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(kl(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===W_e?((u,h)=>{let m,y,v,T;const R=u.window;for(;;){if(u.lookahead<=hy){if(wS(u),u.lookahead<=hy&&h===tg)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){T=u.strstart+hy;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<T);u.match_length=hy-(T-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=eg(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=eg(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(kl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Iu?(kl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(kl(u,!1),u.strm.avail_out===0)?1:2})(s,r):cw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=ow),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),na;if(c===2&&(r===U_e?M_e(s):r!==S$&&(Y2(s,0,0,!1),r===V_e&&(ng(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Ol(t),t.avail_out===0))return s.last_flush=-1,na}return r!==Iu?na:s.wrap<=0?b$:(s.wrap===2?(Qr(s,255&t.adler),Qr(s,t.adler>>8&255),Qr(s,t.adler>>16&255),Qr(s,t.adler>>24&255),Qr(s,255&t.total_in),Qr(s,t.total_in>>8&255),Qr(s,t.total_in>>16&255),Qr(s,t.total_in>>24&255)):(aw(s,t.adler>>>16),aw(s,65535&t.adler)),Ol(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?na:b$)},Z_e=(t,r)=>{let s=r.length;if(lw(t))return Fh;const o=t.state,c=o.wrap;if(c===2||c===1&&o.status!==TS||o.lookahead)return Fh;if(c===1&&(t.adler=sw(t.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(ng(o.head),o.strstart=0,o.block_start=0,o.insert=0);let y=new Uint8Array(o.w_size);y.set(r.subarray(s-o.w_size,s),0),r=y,s=o.w_size}const u=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,wS(o);o.lookahead>=3;){let y=o.strstart,v=o.lookahead-2;do o.ins_h=rg(o,o.ins_h,o.window[y+3-1]),o.prev[y&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=y,y++;while(--v);o.strstart=y,o.lookahead=2,wS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=h,t.input=m,t.avail_in=u,o.wrap=c,na},uw={deflateInit:(t,r)=>A$(t,r,u1,15,8,G_e),deflateInit2:A$,deflateReset:I$,deflateResetKeep:R$,deflateSetHeader:(t,r)=>lw(t)||t.state.wrap!==2?Fh:(t.state.gzhead=r,na),deflate:Q_e,deflateEnd:t=>{if(lw(t))return Fh;const r=t.state.status;return t.state=null,r===py?fy(t,j_e):na},deflateSetDictionary:Z_e,deflateInfo:"pako deflate (from Nodeca project)"};const eye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var d1={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)eye(s,o)&&(t[o]=s[o])}}return t},flattenChunks:t=>{let r=0;for(let o=0,c=t.length;o<c;o++)r+=t[o].length;const s=new Uint8Array(r);for(let o=0,c=0,u=t.length;o<u;o++){let h=t[o];s.set(h,c),c+=h.length}return s}};let P$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{P$=!1}const dw=new Uint8Array(256);for(let t=0;t<256;t++)dw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;dw[254]=dw[254]=1;var hw={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,o,c,u,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let o,c;const u=new Array(2*s);for(c=0,o=0;o<s;){let h=t[o++];if(h<128){u[c++]=h;continue}let m=dw[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&t[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&P$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+dw[t[s]]>r?s:r}},O$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const k$=Object.prototype.toString,{Z_NO_FLUSH:tye,Z_SYNC_FLUSH:nye,Z_FULL_FLUSH:rye,Z_FINISH:iye,Z_OK:h1,Z_STREAM_END:sye,Z_DEFAULT_COMPRESSION:oye,Z_DEFAULT_STRATEGY:aye,Z_DEFLATED:cye}=c1;function p1(t){this.options=d1.assign({level:oye,method:cye,chunkSize:16384,windowBits:15,memLevel:8,strategy:aye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O$,this.strm.avail_out=0;let s=uw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==h1)throw new Error(dy[s]);if(r.header&&uw.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?hw.string2buf(r.dictionary):k$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=uw.deflateSetDictionary(this.strm,o),s!==h1)throw new Error(dy[s]);this._dict_set=!0}}function lye(t,r){const s=new p1(r);if(s.push(t,!0),s.err)throw s.msg||dy[s.err];return s.result}p1.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?iye:tye,typeof t=="string"?s.input=hw.string2buf(t):k$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(u===nye||u===rye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=uw.deflate(s,u),c===sye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=uw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===h1;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},p1.prototype.onData=function(t){this.chunks.push(t)},p1.prototype.onEnd=function(t){t===h1&&(this.result=d1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var uye={deflate:lye};const f1=16209;var dye=function(t,r){let s,o,c,u,h,m,y,v,T,R,P,N,G,j,W,Y,X,ue,ye,Se,_e,Ne,Je,ht;const ft=t.state;s=t.next_in,Je=t.input,o=s+(t.avail_in-5),c=t.next_out,ht=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),m=ft.dmax,y=ft.wsize,v=ft.whave,T=ft.wnext,R=ft.window,P=ft.hold,N=ft.bits,G=ft.lencode,j=ft.distcode,W=(1<<ft.lenbits)-1,Y=(1<<ft.distbits)-1;e:do{N<15&&(P+=Je[s++]<<N,N+=8,P+=Je[s++]<<N,N+=8),X=G[P&W];t:for(;;){if(ue=X>>>24,P>>>=ue,N-=ue,ue=X>>>16&255,ue===0)ht[c++]=65535&X;else{if(!(16&ue)){if((64&ue)==0){X=G[(65535&X)+(P&(1<<ue)-1)];continue t}if(32&ue){ft.mode=16191;break e}t.msg="invalid literal/length code",ft.mode=f1;break e}ye=65535&X,ue&=15,ue&&(N<ue&&(P+=Je[s++]<<N,N+=8),ye+=P&(1<<ue)-1,P>>>=ue,N-=ue),N<15&&(P+=Je[s++]<<N,N+=8,P+=Je[s++]<<N,N+=8),X=j[P&Y];n:for(;;){if(ue=X>>>24,P>>>=ue,N-=ue,ue=X>>>16&255,!(16&ue)){if((64&ue)==0){X=j[(65535&X)+(P&(1<<ue)-1)];continue n}t.msg="invalid distance code",ft.mode=f1;break e}if(Se=65535&X,ue&=15,N<ue&&(P+=Je[s++]<<N,N+=8,N<ue&&(P+=Je[s++]<<N,N+=8)),Se+=P&(1<<ue)-1,Se>m){t.msg="invalid distance too far back",ft.mode=f1;break e}if(P>>>=ue,N-=ue,ue=c-u,Se>ue){if(ue=Se-ue,ue>v&&ft.sane){t.msg="invalid distance too far back",ft.mode=f1;break e}if(_e=0,Ne=R,T===0){if(_e+=y-ue,ue<ye){ye-=ue;do ht[c++]=R[_e++];while(--ue);_e=c-Se,Ne=ht}}else if(T<ue){if(_e+=y+T-ue,ue-=T,ue<ye){ye-=ue;do ht[c++]=R[_e++];while(--ue);if(_e=0,T<ye){ue=T,ye-=ue;do ht[c++]=R[_e++];while(--ue);_e=c-Se,Ne=ht}}}else if(_e+=T-ue,ue<ye){ye-=ue;do ht[c++]=R[_e++];while(--ue);_e=c-Se,Ne=ht}for(;ye>2;)ht[c++]=Ne[_e++],ht[c++]=Ne[_e++],ht[c++]=Ne[_e++],ye-=3;ye&&(ht[c++]=Ne[_e++],ye>1&&(ht[c++]=Ne[_e++]))}else{_e=c-Se;do ht[c++]=ht[_e++],ht[c++]=ht[_e++],ht[c++]=ht[_e++],ye-=3;while(ye>2);ye&&(ht[c++]=ht[_e++],ye>1&&(ht[c++]=ht[_e++]))}break}}break}}while(s<o&&c<h);ye=N>>3,s-=ye,N-=ye<<3,P&=(1<<N)-1,t.next_in=s,t.next_out=c,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=c<h?h-c+257:257-(c-h),ft.hold=P,ft.bits=N};const m1=15,hye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),pye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),fye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),mye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pw=(t,r,s,o,c,u,h,m)=>{const y=m.bits;let v,T,R,P,N,G,j=0,W=0,Y=0,X=0,ue=0,ye=0,Se=0,_e=0,Ne=0,Je=0,ht=null;const ft=new Uint16Array(16),Sn=new Uint16Array(16);let bn,fr,ci,Yr=null;for(j=0;j<=m1;j++)ft[j]=0;for(W=0;W<o;W++)ft[r[s+W]]++;for(ue=y,X=m1;X>=1&&ft[X]===0;X--);if(ue>X&&(ue=X),X===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(Y=1;Y<X&&ft[Y]===0;Y++);for(ue<Y&&(ue=Y),_e=1,j=1;j<=m1;j++)if(_e<<=1,_e-=ft[j],_e<0)return-1;if(_e>0&&(t===0||X!==1))return-1;for(Sn[1]=0,j=1;j<m1;j++)Sn[j+1]=Sn[j]+ft[j];for(W=0;W<o;W++)r[s+W]!==0&&(h[Sn[r[s+W]]++]=W);if(t===0?(ht=Yr=h,G=20):t===1?(ht=hye,Yr=pye,G=257):(ht=fye,Yr=mye,G=0),Je=0,W=0,j=Y,N=u,ye=ue,Se=0,R=-1,Ne=1<<ue,P=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){bn=j-Se,h[W]+1<G?(fr=0,ci=h[W]):h[W]>=G?(fr=Yr[h[W]-G],ci=ht[h[W]-G]):(fr=96,ci=0),v=1<<j-Se,T=1<<ye,Y=T;do T-=v,c[N+(Je>>Se)+T]=bn<<24|fr<<16|ci|0;while(T!==0);for(v=1<<j-1;Je&v;)v>>=1;if(v!==0?(Je&=v-1,Je+=v):Je=0,W++,--ft[j]==0){if(j===X)break;j=r[s+h[W]]}if(j>ue&&(Je&P)!==R){for(Se===0&&(Se=ue),N+=Y,ye=j-Se,_e=1<<ye;ye+Se<X&&(_e-=ft[ye+Se],!(_e<=0));)ye++,_e<<=1;if(Ne+=1<<ye,t===1&&Ne>852||t===2&&Ne>592)return 1;R=Je&P,c[R]=ue<<24|ye<<16|N-u|0}}return Je!==0&&(c[N+Je]=j-Se<<24|64<<16|0),m.bits=ue,0};const{Z_FINISH:N$,Z_BLOCK:gye,Z_TREES:g1,Z_OK:my,Z_STREAM_END:_ye,Z_NEED_DICT:yye,Z_STREAM_ERROR:Au,Z_DATA_ERROR:D$,Z_MEM_ERROR:x$,Z_BUF_ERROR:Eye,Z_DEFLATED:L$}=c1,_1=16180,y1=16190,_f=16191,eM=16192,tM=16194,E1=16199,v1=16200,nM=16206,ns=16209,M$=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function vye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const gy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<_1||r.mode>16211?1:0},U$=t=>{if(gy(t))return Au;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=_1,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,my},V$=t=>{if(gy(t))return Au;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,U$(t)},j$=(t,r)=>{let s;if(gy(t))return Au;const o=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Au:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,V$(t))},F$=(t,r)=>{if(!t)return Au;const s=new vye;t.state=s,s.strm=t,s.window=null,s.mode=_1;const o=j$(t,r);return o!==my&&(t.state=null),o};let rM,iM,B$=!0;const Sye=t=>{if(B$){rM=new Int32Array(512),iM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(pw(1,t.lens,0,288,rM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;pw(2,t.lens,0,32,iM,0,t.work,{bits:5}),B$=!1}t.lencode=rM,t.lenbits=9,t.distcode=iM,t.distbits=5},W$=(t,r,s,o)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(s-o,s-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(s-o,s),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var bye=(t,r)=>{let s,o,c,u,h,m,y,v,T,R,P,N,G,j,W,Y,X,ue,ye,Se,_e,Ne,Je=0;const ht=new Uint8Array(4);let ft,Sn;const bn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(gy(t)||!t.output||!t.input&&t.avail_in!==0)return Au;s=t.state,s.mode===_f&&(s.mode=eM),h=t.next_out,c=t.output,y=t.avail_out,u=t.next_in,o=t.input,m=t.avail_in,v=s.hold,T=s.bits,R=m,P=y,Ne=my;e:for(;;)switch(s.mode){case _1:if(s.wrap===0){s.mode=eM;break}for(;T<16;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,ht[0]=255&v,ht[1]=v>>>8&255,s.check=ko(s.check,ht,2,0),v=0,T=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ns;break}if((15&v)!==L$){t.msg="unknown compression method",s.mode=ns;break}if(v>>>=4,T-=4,_e=8+(15&v),s.wbits===0&&(s.wbits=_e),_e>15||_e>s.wbits){t.msg="invalid window size",s.mode=ns;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:_f,v=0,T=0;break;case 16181:for(;T<16;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(s.flags=v,(255&ao(s))!==L$){t.msg="unknown compression method",s.mode=ns;break}if(57344&ao(s)){t.msg="unknown header flags set",s.mode=ns;break}s.head&&(s.head.text=v>>8&1),512&ao(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=ko(s.check,ht,2,0)),v=0,T=0,s.mode=16182;case 16182:for(;T<32;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}s.head&&(s.head.time=v),512&ao(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,ht[2]=v>>>16&255,ht[3]=v>>>24&255,s.check=ko(s.check,ht,4,0)),v=0,T=0,s.mode=16183;case 16183:for(;T<16;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&ao(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=ko(s.check,ht,2,0)),v=0,T=0,s.mode=16184;case 16184:if(1024&ao(s)){for(;T<16;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}s.length=v,s.head&&(s.head.extra_len=v),512&ao(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=ko(s.check,ht,2,0)),v=0,T=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&ao(s)&&(N=s.length,N>m&&(N=m),N&&(s.head&&(_e=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(u,u+N),_e)),512&ao(s)&&4&s.wrap&&(s.check=ko(s.check,o,N,u)),m-=N,u+=N,s.length-=N),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&ao(s)){if(m===0)break e;N=0;do _e=o[u+N++],s.head&&_e&&s.length<65536&&(s.head.name+=String.fromCharCode(_e));while(_e&&N<m);if(512&ao(s)&&4&s.wrap&&(s.check=ko(s.check,o,N,u)),m-=N,u+=N,_e)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&ao(s)){if(m===0)break e;N=0;do _e=o[u+N++],s.head&&_e&&s.length<65536&&(s.head.comment+=String.fromCharCode(_e));while(_e&&N<m);if(512&ao(s)&&4&s.wrap&&(s.check=ko(s.check,o,N,u)),m-=N,u+=N,_e)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&ao(s)){for(;T<16;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ns;break}v=0,T=0}s.head&&(s.head.hcrc=ao(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=_f;break;case 16189:for(;T<32;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}t.adler=s.check=M$(v),v=0,T=0,s.mode=y1;case y1:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=T,yye;t.adler=s.check=1,s.mode=_f;case _f:if(r===gye||r===g1)break e;case eM:if(s.last){v>>>=7&T,T-=7&T,s.mode=nM;break}for(;T<3;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}switch(s.last=1&v,v>>>=1,T-=1,3&v){case 0:s.mode=16193;break;case 1:if(Sye(s),s.mode=E1,r===g1){v>>>=2,T-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ns}v>>>=2,T-=2;break;case 16193:for(v>>>=7&T,T-=7&T;T<32;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ns;break}if(s.length=65535&v,v=0,T=0,s.mode=tM,r===g1)break e;case tM:s.mode=16195;case 16195:if(N=s.length,N){if(N>m&&(N=m),N>y&&(N=y),N===0)break e;c.set(o.subarray(u,u+N),h),m-=N,u+=N,y-=N,h+=N,s.length-=N;break}s.mode=_f;break;case 16196:for(;T<14;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(s.nlen=257+(31&v),v>>>=5,T-=5,s.ndist=1+(31&v),v>>>=5,T-=5,s.ncode=4+(15&v),v>>>=4,T-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ns;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;T<3;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}s.lens[bn[s.have++]]=7&v,v>>>=3,T-=3}for(;s.have<19;)s.lens[bn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,ft={bits:s.lenbits},Ne=pw(0,s.lens,0,19,s.lencode,0,s.work,ft),s.lenbits=ft.bits,Ne){t.msg="invalid code lengths set",s.mode=ns;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Je=s.lencode[v&(1<<s.lenbits)-1],W=Je>>>24,Y=Je>>>16&255,X=65535&Je,!(W<=T);){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(X<16)v>>>=W,T-=W,s.lens[s.have++]=X;else{if(X===16){for(Sn=W+2;T<Sn;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(v>>>=W,T-=W,s.have===0){t.msg="invalid bit length repeat",s.mode=ns;break}_e=s.lens[s.have-1],N=3+(3&v),v>>>=2,T-=2}else if(X===17){for(Sn=W+3;T<Sn;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}v>>>=W,T-=W,_e=0,N=3+(7&v),v>>>=3,T-=3}else{for(Sn=W+7;T<Sn;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}v>>>=W,T-=W,_e=0,N=11+(127&v),v>>>=7,T-=7}if(s.have+N>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ns;break}for(;N--;)s.lens[s.have++]=_e}}if(s.mode===ns)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ns;break}if(s.lenbits=9,ft={bits:s.lenbits},Ne=pw(1,s.lens,0,s.nlen,s.lencode,0,s.work,ft),s.lenbits=ft.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ns;break}if(s.distbits=6,s.distcode=s.distdyn,ft={bits:s.distbits},Ne=pw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,ft),s.distbits=ft.bits,Ne){t.msg="invalid distances set",s.mode=ns;break}if(s.mode=E1,r===g1)break e;case E1:s.mode=v1;case v1:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=T,dye(t,P),h=t.next_out,c=t.output,y=t.avail_out,u=t.next_in,o=t.input,m=t.avail_in,v=s.hold,T=s.bits,s.mode===_f&&(s.back=-1);break}for(s.back=0;Je=s.lencode[v&(1<<s.lenbits)-1],W=Je>>>24,Y=Je>>>16&255,X=65535&Je,!(W<=T);){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(Y&&(240&Y)==0){for(ue=W,ye=Y,Se=X;Je=s.lencode[Se+((v&(1<<ue+ye)-1)>>ue)],W=Je>>>24,Y=Je>>>16&255,X=65535&Je,!(ue+W<=T);){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}v>>>=ue,T-=ue,s.back+=ue}if(v>>>=W,T-=W,s.back+=W,s.length=X,Y===0){s.mode=16205;break}if(32&Y){s.back=-1,s.mode=_f;break}if(64&Y){t.msg="invalid literal/length code",s.mode=ns;break}s.extra=15&Y,s.mode=16201;case 16201:if(s.extra){for(Sn=s.extra;T<Sn;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,T-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Je=s.distcode[v&(1<<s.distbits)-1],W=Je>>>24,Y=Je>>>16&255,X=65535&Je,!(W<=T);){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if((240&Y)==0){for(ue=W,ye=Y,Se=X;Je=s.distcode[Se+((v&(1<<ue+ye)-1)>>ue)],W=Je>>>24,Y=Je>>>16&255,X=65535&Je,!(ue+W<=T);){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}v>>>=ue,T-=ue,s.back+=ue}if(v>>>=W,T-=W,s.back+=W,64&Y){t.msg="invalid distance code",s.mode=ns;break}s.offset=X,s.extra=15&Y,s.mode=16203;case 16203:if(s.extra){for(Sn=s.extra;T<Sn;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,T-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ns;break}s.mode=16204;case 16204:if(y===0)break e;if(N=P-y,s.offset>N){if(N=s.offset-N,N>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ns;break}N>s.wnext?(N-=s.wnext,G=s.wsize-N):G=s.wnext-N,N>s.length&&(N=s.length),j=s.window}else j=c,G=h-s.offset,N=s.length;N>y&&(N=y),y-=N,s.length-=N;do c[h++]=j[G++];while(--N);s.length===0&&(s.mode=v1);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=v1;break;case nM:if(s.wrap){for(;T<32;){if(m===0)break e;m--,v|=o[u++]<<T,T+=8}if(P-=y,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=ao(s)?ko(s.check,c,P,h-P):sw(s.check,c,P,h-P)),P=y,4&s.wrap&&(ao(s)?v:M$(v))!==s.check){t.msg="incorrect data check",s.mode=ns;break}v=0,T=0}s.mode=16207;case 16207:if(s.wrap&&ao(s)){for(;T<32;){if(m===0)break e;m--,v+=o[u++]<<T,T+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ns;break}v=0,T=0}s.mode=16208;case 16208:Ne=_ye;break e;case ns:Ne=D$;break e;case 16210:return x$;default:return Au}return t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=T,(s.wsize||P!==t.avail_out&&s.mode<ns&&(s.mode<nM||r!==N$))&&W$(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=ao(s)?ko(s.check,c,P,t.next_out-P):sw(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===_f?128:0)+(s.mode===E1||s.mode===tM?256:0),(R===0&&P===0||r===N$)&&Ne===my&&(Ne=Eye),Ne},yf={inflateReset:V$,inflateReset2:j$,inflateResetKeep:U$,inflateInit:t=>F$(t,15),inflateInit2:F$,inflate:bye,inflateEnd:t=>{if(gy(t))return Au;let r=t.state;return r.window&&(r.window=null),t.state=null,my},inflateGetHeader:(t,r)=>{if(gy(t))return Au;const s=t.state;return(2&s.wrap)==0?Au:(s.head=r,r.done=!1,my)},inflateSetDictionary:(t,r)=>{const s=r.length;let o,c,u;return gy(t)?Au:(o=t.state,o.wrap!==0&&o.mode!==y1?Au:o.mode===y1&&(c=1,c=sw(c,r,s,0),c!==o.check)?D$:(u=W$(t,r,s,s),u?(o.mode=16210,x$):(o.havedict=1,my)))},inflateInfo:"pako inflate (from Nodeca project)"},Tye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const z$=Object.prototype.toString,{Z_NO_FLUSH:wye,Z_FINISH:Cye,Z_OK:fw,Z_STREAM_END:sM,Z_NEED_DICT:oM,Z_STREAM_ERROR:Rye,Z_DATA_ERROR:G$,Z_MEM_ERROR:Iye}=c1;function S1(t){this.options=d1.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O$,this.strm.avail_out=0;let s=yf.inflateInit2(this.strm,r.windowBits);if(s!==fw)throw new Error(dy[s]);if(this.header=new Tye,yf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=hw.string2buf(r.dictionary):z$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=yf.inflateSetDictionary(this.strm,r.dictionary),s!==fw)))throw new Error(dy[s])}function Aye(t,r){const s=new S1(r);if(s.push(t),s.err)throw s.msg||dy[s.err];return s.result}S1.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Cye:wye,z$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),u=yf.inflate(s,h),u===oM&&c&&(u=yf.inflateSetDictionary(s,c),u===fw?u=yf.inflate(s,h):u===G$&&(u=oM));s.avail_in>0&&u===sM&&s.state.wrap>0&&t[s.next_in]!==0;)yf.inflateReset(s),u=yf.inflate(s,h);switch(u){case Rye:case G$:case oM:case Iye:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===sM))if(this.options.to==="string"){let y=hw.utf8border(s.output,s.next_out),v=s.next_out-y,T=hw.buf2string(s.output,y);s.next_out=v,s.avail_out=o-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(T)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==fw||m!==0){if(u===sM)return u=yf.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},S1.prototype.onData=function(t){this.chunks.push(t)},S1.prototype.onEnd=function(t){t===fw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Pye={inflate:Aye};const{deflate:Oye}=uye,{inflate:kye}=Pye;var Nye=Oye,Dye=kye,H$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(H$||{});class xye{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;ie("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,ie("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let y=!1;if(m.datas.length>0){const v=m.datas.find(T=>T.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,o),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==o+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(o+2));return u}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const u=s.getUint8(o);o++;const h=c===H$.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<u;){let T=0,R=0,P=new ArrayBuffer(0);h?(T=y.getUint8(v),v++,R=y.getUint8(v),v++):(T=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(P=y.buffer.slice(v+2,v+2+R),v+=P.byteLength),m.push({id:T,length:R,data:P})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return Dye(new Uint8Array(r))}compress(r){return Nye(new Uint8Array(r))}}const Lye={name:"DataStream",create:(t,r)=>{const s=r?new Wme(t):new zme(t);return s.useDataStream(new xye),s}};class Mye extends Mr{constructor(r,s,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new FT("cross-channel-".concat(this.clientId),o),this.ws.on(Xt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Xt.CONNECTED,this.onOpen),this.ws.on(Xt.ON_MESSAGE,this.onMessage),this.ws.on(Xt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new dt((s,o)=>{const c=window.setTimeout(()=>{o(new Oe(J.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(J.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(J.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(J.WS_DISCONNECT);const s=()=>new dt((h,m)=>{this.ws.once(Xt.CLOSED,()=>m(new Oe(J.WS_ABORT))),this.ws.once(Xt.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new dt((h,m)=>{const y=()=>{m(new Oe(J.WS_ABORT))};this.ws.once(Xt.RECONNECTING,y),this.ws.once(Xt.CLOSED,y),this.once("req_".concat(o),h),os(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Xt.RECONNECTING,y),this.ws.off(Xt.CLOSED,y),m(new Oe(J.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(J.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Xt.REQUEST_NEW_URLS),this.ws.on(Xt.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Uye extends Mr{set state(r){r!==this._state&&(r!==Ia.RELAY_STATE_FAILURE&&(this.errorCode=lS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",Jo.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",Ia.RELAY_STATE_IDLE),K(this,"errorCode",lS.RELAY_OK),K(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",df.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",df.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=lS.SRC_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=lS.DEST_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",df.NETWORK_DISCONNECTED),this.state=Ia.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ia.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=lS.SERVER_CONNECTION_LOST,this.state=Ia.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=q_(),this.signal=new Mye(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Ia.RELAY_STATE_IDLE)throw new Oe(J.INVALID_OPERATION);this.state=Ia.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(J.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(J.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(J.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ia.RELAY_STATE_RUNNING)throw new Oe(J.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ia.RELAY_STATE_RUNNING)throw new Oe(J.INVALID_OPERATION);const s=this.genMessage(Oo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ia.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Jo.CancelToken.source(),this.state=Ia.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Kge(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",df.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Oo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Oo.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Oo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",df.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Oo.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Oo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",df.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Oo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",df.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ia.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Oo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",df.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Oo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Cl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Oo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Oo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(J.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Oo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(J.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Oo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(J.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case Oo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Oo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Oo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Oo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(J.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case Oo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Vye={name:"ChannelMediaRelay",create:function(t){return new Uye(t.joinInfo,t.clientId,t.websocketRetryConfig||wi,t.httpRetryConfig||wi,t.resolution)}};function $$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class jye extends Mr{constructor(r,s,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Rt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===uf.TRANSCODE?1:2}),this.emit(Gm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new FT("live-streaming",o),this.websocket.on(Xt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Xt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Xt.REQUEST_NEW_URLS,(u,h)=>{bs(this,Gm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Xt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(J.UNEXPECTED_ERROR);const m=mw({command:r,sdkVersion:Cl==="4.23.2"?"0.0.1":Cl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(J.WS_DISCONNECT);const y=()=>new dt((P,N)=>{this.websocket.once(Xt.CLOSED,()=>N(new Oe(J.WS_ABORT))),this.websocket.once(Xt.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new dt((P,N)=>{const G=()=>{N(new Oe(J.WS_ABORT))};this.websocket.once(Xt.RECONNECTING,G),this.websocket.once(Xt.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{P(j)})});c&&Rt.workerEvent(this.spec.sid,mw(mw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const T=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,o)}return c&&Rt.workerEvent(this.spec.sid,mw(mw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-T})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Cl==="4.23.2"?"0.0.1":Cl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case ki.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case ki.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ki.LIVE_STREAM_RESPONSE_BAD_STREAM:case ki.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(J.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ki.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(J.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(J.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Gm.WARNING,s,r.serverResponse.url)}case ki.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(J.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Gm.WARNING,s,r.serverResponse.url)}case ki.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ki.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(J.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(J.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Gm.WARNING,s,r.serverResponse.url)}case ki.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ki.LIVE_STREAM_RESPONSE_WORKER_LOST:case ki.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ki.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ki.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(J.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(cP)},6e3)}}function K$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Aa(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?K$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):K$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class Fye extends Mr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wi;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Os("live-streaming")),K(this,"cancelToken",Jo.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Aa(Aa({},Rge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Aa(Aa(Aa({},Cge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Br(h.width)||ir(h.width,"config.width",0,1e4),Br(h.height)||ir(h.height,"config.height",0,1e4),Br(h.videoBitrate)||ir(h.videoBitrate,"config.videoBitrate",1,1e6),Br(h.videoFrameRate)||ir(h.videoFrameRate,"config.videoFrameRate"),Br(h.lowLatency)||of(h.lowLatency,"config.lowLatency"),Br(h.audioSampleRate)||xi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Br(h.audioBitrate)||ir(h.audioBitrate,"config.audioBitrate",1,128),Br(h.audioChannels)||xi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Br(h.videoGop)||ir(h.videoGop,"config.videoGop"),Br(h.videoCodecProfile)||xi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Br(h.userCount)||ir(h.userCount,"config.userCount",0,17),Br(h.backgroundColor)||ir(h.backgroundColor,"config.backgroundColor",0,16777215),Br(h.userConfigExtraInfo)||ss(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Br(h.transcodingUsers)&&(af(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{NP(m.uid),Br(m.x)||ir(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Br(m.y)||ir(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Br(m.width)||ir(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Br(m.height)||ir(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Br(m.zOrder)||ir(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Br(m.alpha)||ir(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Br(h.watermark)||c2(h.watermark,"watermark"),Br(h.backgroundImage)||c2(h.backgroundImage,"backgroundImage"),h.images&&!Br(h.images)&&(af(h.images,"config.images"),h.images.forEach((m,y)=>{c2(m,"images[".concat(y,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>Aa(Aa(Aa({},a2),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(Aa(Aa(Aa({},a2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(Aa(Aa(Aa({},a2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Aa({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?dt.resolve(h.uid):mH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await dt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Mc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===uf.TRANSCODE)throw new Oe(J.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Oe(J.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case uf.TRANSCODE:c.transcodingConfig=Aa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new dt((v,T)=>{os(this.retryTimeout).then(()=>{if(o)return T(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),T(R)):void 0})}),y=await dt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===uf.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new dt((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(J.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===uf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(Mc(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Jo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(J.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await bs(this,l2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new jye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Gm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Gm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Gm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(J.UNEXPECTED_ERROR,"can not get new live streaming address list"));bs(this,l2.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case ki.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(J.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case ki.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(J.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case ki.LIVE_STREAM_RESPONSE_WORKER_LOST:case ki.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Mc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(J.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const Bye={name:"LiveStreaming",create:function(t){return new Fye(t.joinInfo,t.websocketRetryConfig||wi,t.httpRetryConfig||wi)}};function Wye(t){let r=X$();return function(s,o){let c=s.appId;c!==void 0&&(Jn(o,10),zh(o,c));let u=s.cid;u!==void 0&&(Jn(o,16),Jn(o,u));let h=s.cname;h!==void 0&&(Jn(o,26),zh(o,h));let m=s.deviceId;m!==void 0&&(Jn(o,34),zh(o,m));let y=s.elapse;y!==void 0&&(Jn(o,40),ig(o,y));let v=s.fileSize;v!==void 0&&(Jn(o,48),ig(o,RS(v)));let T=s.height;T!==void 0&&(Jn(o,56),ig(o,RS(T)));let R=s.jpg;R!==void 0&&(Jn(o,66),Jn(o,R.length),function(ra,We){let ot=IS(ra,We.length);ra.bytes.set(We,ot)}(o,R));let P=s.networkType;P!==void 0&&(Jn(o,72),ig(o,RS(P)));let N=s.osType;N!==void 0&&(Jn(o,80),ig(o,RS(N)));let G=s.requestId;G!==void 0&&(Jn(o,90),zh(o,G));let j=s.sdkVersion;j!==void 0&&(Jn(o,98),zh(o,j));let W=s.sequence;W!==void 0&&(Jn(o,104),ig(o,RS(W)));let Y=s.sid;Y!==void 0&&(Jn(o,114),zh(o,Y));let X=s.timestamp;X!==void 0&&(Jn(o,120),ig(o,X));let ue=s.uid;ue!==void 0&&(Jn(o,128),Jn(o,ue));let ye=s.vid;ye!==void 0&&(Jn(o,136),Jn(o,ye));let Se=s.width;Se!==void 0&&(Jn(o,144),ig(o,RS(Se)));let _e=s.service;_e!==void 0&&(Jn(o,152),Jn(o,_e));let Ne=s.callbackData;Ne!==void 0&&(Jn(o,162),zh(o,Ne));let Je=s.jpgEncryption;Je!==void 0&&(Jn(o,168),Jn(o,Je));let ht=s.requestType;ht!==void 0&&(Jn(o,176),Jn(o,ht));let ft=s.scorePorn;ft!==void 0&&(Jn(o,185),dM(o,ft));let Sn=s.scoreSexy;Sn!==void 0&&(Jn(o,193),dM(o,Sn));let bn=s.scoreNeutral;bn!==void 0&&(Jn(o,201),dM(o,bn));let fr=s.scene;fr!==void 0&&(Jn(o,208),Jn(o,fr));let ci=s.ossFilePrefix;ci!==void 0&&(Jn(o,218),zh(o,ci));let Yr=s.serviceVendor;if(Yr!==void 0)for(let ra of Yr){Jn(o,226);let We=X$();Hye(ra,We),Jn(o,We.limit),Yye(o,We),qye(We)}}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function zye(t){return function(s){let o={};e:for(;!J$(s);){let c=Gh(s);switch(c>>>3){case 0:break e;case 1:o.code=Gh(s);break;case 2:o.msg=Q$(s,Gh(s));break;case 3:{let u=$ye(s);o.data=Gye(s),s.limit=u;break}default:q$(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function Gye(t){let r={};e:for(;!J$(t);){let s=Gh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=Q$(t,Gh(t));break;case 2:r.requestType=Gh(t)>>>0;break;case 3:r.scorePorn=uM(t);break;case 4:r.scoreSexy=uM(t);break;case 5:r.scoreNeutral=uM(t);break;case 6:r.requestScene=Gh(t)>>>0;break;case 7:r.scene=Gh(t)>>>0;break;default:q$(t,7&s)}}return r}function Hye(t,r){let s=t.service;s!==void 0&&(Jn(r,8),Jn(r,s));let o=t.vendor;o!==void 0&&(Jn(r,16),Jn(r,o));let c=t.token;c!==void 0&&(Jn(r,26),zh(r,c));let u=t.callbackUrl;u!==void 0&&(Jn(r,34),zh(r,u))}function $ye(t){let r=Gh(t),s=t.limit;return t.limit=t.offset+r,s}function q$(t,r){switch(r){case 0:for(;128&Z$(t););break;case 2:cM(t,Gh(t));break;case 5:cM(t,4);break;case 1:cM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let Kye=new Float32Array(1);new Uint8Array(Kye.buffer);let aM=new Float64Array(1),Pa=new Uint8Array(aM.buffer);function RS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Y$=[];function X$(){const t=Y$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function qye(t){Y$.push(t)}function cM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function J$(t){return t.offset>=t.limit}function IS(t,r){let s=t.bytes,o=t.offset,c=t.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),o}function lM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function Q$(t,r){let s=lM(t,r),o=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let y,v,T,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],T=c[m+s+3],(12632256&(y|v<<8|T<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&T,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function zh(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Jn(t,o);let c=IS(t,o),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Yye(t,r){let s=IS(t,r.limit),o=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+s]=c[u]}function Z$(t){return t.bytes[lM(t,1)]}function eK(t,r){let s=IS(t,1);t.bytes[s]=r}function uM(t){let r=lM(t,8),s=t.bytes;return Pa[0]=s[r++],Pa[1]=s[r++],Pa[2]=s[r++],Pa[3]=s[r++],Pa[4]=s[r++],Pa[5]=s[r++],Pa[6]=s[r++],Pa[7]=s[r++],aM[0]}function dM(t,r){let s=IS(t,8),o=t.bytes;aM[0]=r,o[s++]=Pa[0],o[s++]=Pa[1],o[s++]=Pa[2],o[s++]=Pa[3],o[s++]=Pa[4],o[s++]=Pa[5],o[s++]=Pa[6],o[s++]=Pa[7]}function Gh(t){let r,s=0,o=0;do r=Z$(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function Jn(t,r){for(r>>>=0;r>=128;)eK(t,127&r|128),r>>>=7;eK(t,r)}function ig(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=IS(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function tK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const Xye=new Map([["moderation",1],["supervise",2]]);class Jye extends Mr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(ts.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Za(s=r.map(o=>Xye.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",bu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Jo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==bu.CONNECTED)throw new Oe(J.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===bu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=hr(5,"inspect-"),this.workerMessageLengthLimit=ie("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=ie("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=ie("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new FT("worker-manager-"+this._inspectId,wi),this.on(ts.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Tu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new FT("worker-"+this._inspectId,wi),this.handleWorkerEvents()}async init(r,s){this.emit(ts.STATE_CHANGE,Tu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new dt((c,u)=>{this.on(ts.CONNECTION_STATE_CHANGE,(h,m)=>{m===bu.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,o){const c=ie("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,y,v,T){let{appId:R,areaCode:P,cname:N,sid:G,token:j,uid:W}=y;gS++;const Y="image_moderation_api",X={service_name:Y,json_body:JSON.stringify({appId:R,areaCode:P,cname:N,command:"allocateEdge",requestId:gS,seq:gS,sid:G,token:j,ts:Date.now(),uid:W+""})};let ue,ye,Se=m[0];return Rd(async()=>{ue=Date.now();const _e=await kd(Se,{data:X,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-ue,_e.code!==0){const ft=new Oe(J.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_e.code,{retry:!0,responseTime:ye});throw x.error(ft.toString()),ft}const Ne=JSON.parse(_e.json_body);if(Ne.code!==200){const ft=new Oe(J.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:ye});throw x.error(ft.toString()),ft}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const ft=new Oe(J.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:ye});throw x.error(ft.toString()),ft}const Je=ie("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ht=ie("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(ft=>{let{address:Sn,wss:bn}=ft;if(Sn&&bn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(Je,":").concat(ht||bn)}).filter(ft=>!!ft),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:ye}},(_e,Ne)=>(Rt.apworkerEvent(G,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Ne===0,responseTime:ye,serverIp:m[Ne%m.length]}),!1),(_e,Ne)=>(Rt.apworkerEvent(G,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:Y,responseTime:ye,serverIp:m[Ne%m.length]}),!!(_e.code!==J.OPERATION_ABORTED&&_e.code!==J.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(Se=m[(Ne+1)%m.length],!0)),T)}(c,r,s,o);this.emit(ts.STATE_CHANGE,Tu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ts.STATE_CHANGE,Tu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Xt.CONNECTED,async()=>{this.emit(ts.STATE_CHANGE,Tu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Xt.CLOSED,()=>{this._innerConnectionState<Tu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Xt.FAILED,()=>{this._innerConnectionState<Tu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Xt.RECONNECTING,()=>{this._innerConnectionState<Tu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Xt.ON_MESSAGE,async r=>{this.emit(ts.STATE_CHANGE,Tu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(J.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(J.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=ie("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(ts.STATE_CHANGE,Tu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(ts.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Xt.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(Xt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(Xt.CONNECTED,async()=>{this.emit(ts.STATE_CHANGE,Tu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=bu.CONNECTED}),this.workerConnection.on(Xt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=zye(new Uint8Array(r.data));if(ie("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ts.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=Za(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(ts.INSPECT_RESULT,h)}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(J.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(J.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ts.INSPECT_RESULT,void 0,new Oe(J.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Xt.CLOSED,()=>{this.connectionState=bu.CLOSED}),this.workerConnection.on(Xt.FAILED,()=>{this.connectionState=bu.CLOSED}),this.workerConnection.on(Xt.RECONNECTING,()=>{this.connectionState=this.connectionState===bu.CONNECTED?bu.RECONNECTING:bu.CONNECTING}),this.workerConnection.on(Xt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Xt.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(ts.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=Vc(this,ts.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(ts.INSPECT_RESULT,void 0,new Oe(J.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(J.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const v=Date.now(),T=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await Mz(T,o,c),P=this.sequence+"-"+u+"-"+y+"-"+v+"-"+hr(12,""),N={appId:o,cid:u,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:T.height,width:T.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:l7(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const j=Wye(N);if(j.byteLength<this.workerMessageLengthLimit){if(ie("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const W=function(Y){for(var X=1;X<arguments.length;X++){var ue=arguments[X]!=null?arguments[X]:{};X%2?tK(Object(ue),!0).forEach(function(ye){K(Y,ye,ue[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(ue)):tK(Object(ue)).forEach(function(ye){Object.defineProperty(Y,ye,Object.getOwnPropertyDescriptor(ue,ye))})}return Y}({},N);delete W.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(W))}return j}{const W=this.quality*this.qualityRatio;return this.quality=W,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Jo.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=bu.CLOSED,this.emit(ts.STATE_CHANGE,Tu.CLOSED)}}const Qye={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(J.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(J.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var u;if(!at(u=["supervise","moderation"]).call(u,c))throw new Oe(J.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(J.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Jye(r)}};var nK=l(vt.Object.getOwnPropertySymbols),Zye=Fn,eEe=Ho.indexOf,tEe=Np,hM=oe([].indexOf),rK=!!hM&&1/hM([1],1,-0)<0;Zye({target:"Array",proto:!0,forced:rK||!tEe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return rK?hM(this,t,r)||0:eEe(this,t,r)}});var nEe=Qa("Array").indexOf,rEe=k,iEe=nEe,pM=Array.prototype,sEe=function(t){var r=t.indexOf;return t===pM||rEe(pM,t)&&r===pM.indexOf?iEe:r},iK=l(sEe);function oEe(t,r){if(t==null)return{};var s,o,c=function(h,m){if(h==null)return{};var y,v,T={},R=wG(h);for(v=0;v<R.length;v++)y=R[v],iK(m).call(m,y)>=0||(T[y]=h[y]);return T}(t,r);if(nK){var u=nK(t);for(o=0;o<u.length;o++)s=u[o],iK(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let sK=class{get localCapabilities(){return zr(this._localCapabilities)}get rtpCapabilities(){return zr(this._rtpCapabilities)}get candidates(){return zr(this._candidates)}get iceParameters(){return zr(this._iceParameters)}get dtlsParameters(){return zr(this._dtlsParameters)}constructor(t){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),t=zr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let T;this.setup=m,T=h===Po.RECEIVE_ONLY?Ra(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ra(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const R=h===Po.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Po.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===Po.RECEIVE_ONLY?c.send.videoCodecs:zT(gt.VIDEO,R,P,y),G=h===Po.RECEIVE_ONLY?c.send.audioCodecs:zT(gt.AUDIO,R,P,v);for(const j of T.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=o,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=N.map(W=>W.payloadType.toString(10)),j.attributes.payloads=N,j.attributes.extmaps=R.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=G.map(W=>W.payloadType.toString(10)),j.attributes.payloads=G,j.attributes.extmaps=R.audioExtensions,mS(j));this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return zm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=ry(r,this.cname,ie("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Fr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,u,o);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,u,h,"sendonly",o,c),this.updateBundleMids()):(v=zr(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),Fr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const o=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=zr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:y})}),o}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(T=>T.priority===v.priority&&T.connectionAddress===v.connectionAddress&&T.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,o,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=zT(u,h,this.localCapabilities.send,u===gt.AUDIO?c:o),y=u===gt.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let T={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};T=this.mungRecvMediaDsec(T,t);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=T}else this.sessionDesc.mediaDescriptions.push(T);return T}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>at(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>at(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Fr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=zr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,o,c,u){const h=this.rtpCapabilities.send,m=t===gt.VIDEO?h.videoCodecs:h.audioCodecs,y=t===gt.VIDEO?h.videoExtensions:h.audioExtensions;Fr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const T=this.findFirstClosedMedia(t);if(T){const R=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const o=zr(t);return f2(o),fS(o,r),m2(o,r),YG(o),jP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(t,r){const s=zr(t);return jP(s,r,this.localCapabilities.recv),mS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Fr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const aEe=["sdp"];var Er;function oK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let aK=(Er=class BS extends OG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Os("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(BS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Po.SEND_ONLY,this.name=this.direction===Po.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=AL(this.peerConnection,ie("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await JG();if(this.localCapabilities=FP(s),r){const{sdp:o}=r,c=oEe(r,aEe),u=function(){const T={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=WT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(wu(R,T,"videoExtensions",P,N,G),wu(R,T,"videoCodecs",P,N,G),wu(R,T,"audioExtensions",P,N,G),wu(R,T,"audioCodecs",P,N,G),ie("RAISE_H264_BASELINE_PRIORITY")){const j=G.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const W=G.videoCodecs.findIndex(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(W<j){x.debug("raising H264 baseline profile priority");const Y=G.videoCodecs[j];G.videoCodecs.splice(j,1),G.videoCodecs.splice(W,0,Y)}W!==-1&&ie("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>!(Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Y.fmtp&&Y.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:N,sendrecv:G}}({},{},o);this.remoteSDP=new sK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=qm(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await QG({},{},h.sdp);this.localCapabilities=FP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),sg(sg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=qm(o.sdp);return this.initialOffer=o,sg(sg({},c),{},{sdp:o.sdp})}}catch(s){throw new xe(J.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,u=await QG({},{},s);this.remoteSDP=new sK({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new xe(J.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return wl(function*(){const u=yield In(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((W,Y)=>{if(m[Y].needCreateTransceiver){const X=c.peerConnection.addTransceiver(W._mediaStreamTrack,{direction:"sendonly"});h.push(X),W._updateRtpTransceiver(X)}else{const X=c.peerConnection.getTransceivers().find(ue=>ue.mid===m[Y].mid);if(!X)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Y].mid));h.push(X),W._updateRtpTransceiver(X)}}),Fr()&&ie("SIMULCAST")===!0&&(yield In(c.applySimulcastForFirefox(h,r)));const y=m.map(W=>W.mid),v=yield In(c.peerConnection.createOffer()),T=c.mungSendOfferSDP(v.sdp,r,y),R=Ra(T),P=y.map(W=>{const Y=R.mediaDescriptions.find(X=>X.attributes.mid===W);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return $G(Y,ie("USE_PUB_RTX"))}),N=h.map((W,Y)=>{const X=y[Y];return{localSSRC:P[Y],id:X}});yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T}));try{yield N}catch(W){const Y=c.remoteSDP.toString();throw yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield In(c.stopSending(y,!0)),W}yield In(c.applySimulcastEncodings(h,r)),yield In(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),j=c.logSDPExchange(T,"offer","local","send");return j==null||j(G),yield In(c.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Y)=>{const X=y[Y];return{localSSRC:P[Y],id:X}})}catch(h){throw h instanceof xe?h:new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const T=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(T.sdp,u,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),T=this.mungReceiveAnswerSDP(v.sdp,u,r);y==null||y(T||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:T}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Y_.Auto&&(this.store.p2pTransport=Y_.SdRtn,Mn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(BS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Mn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(BS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=qm(s.sdp);return this.store.descriptionStart(),this.direction===Po.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Po.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=qm(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(J.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Fr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:sg(sg({},Oh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:sg(sg({},Oh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;at(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(PT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...BS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),ie("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...BS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),at(u=[Y_.Relay,Y_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),ie("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),ie("ENABLE_ENCODED_TRANSFORM")&&Mn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(s){case Y_.SdRtn:const m=r.filter(v=>{var T;return at(T=v.username).call(T,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>o?m[o]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat($m(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat($m(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case Y_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat($m(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat($m(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(T=>T.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Mn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:T,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;T&&(u.maxBitrate=1e3*T),at(h=r._hints).call(h,pr.LOW_STREAM)&&(R&&(u.maxFramerate=ac(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(ie("DSCP_TYPE")&&sf()){var m;const T=ie("DSCP_TYPE");at(m=["very-low","low","medium","high"]).call(m,T)&&(u.networkPriority=T)}const y=s.getParameters(),v=(o=y.encodings)===null||o===void 0?void 0:o[0];Fr()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!Mn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Tr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ra(r);return s.forEach((u,h)=>{const m=o[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(fS(y,u),XG(y,u,this.store.codec))}),zm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,u,h,m;const v=r[y],T=s[y];if(T instanceof Tr&&!at(o=T._hints).call(o,pr.LOW_STREAM)&&(c=T._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=T._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=T._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,s){if(!Fr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Tr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Tr&&ie("SIMULCAST")&&this.store.codec==="vp8"&&!at(s=r._hints).call(s,pr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(ie("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o,c;if(s=(o=s)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Ra(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),at(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=Ra(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&o===gt.AUDIO&&u.media.mediaType==="audio"&&mS(u),zm(c)}},Et(Er.prototype,"establish",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"establish"),Er.prototype),Et(Er.prototype,"connect",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"connect"),Er.prototype),Et(Er.prototype,"receive",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"receive"),Er.prototype),Et(Er.prototype,"mockReceive",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"mockReceive"),Er.prototype),Et(Er.prototype,"stopReceiving",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"stopReceiving"),Er.prototype),Et(Er.prototype,"restartICE",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"restartICE"),Er.prototype),Et(Er.prototype,"close",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"close"),Er.prototype),Et(Er.prototype,"updateEncoderConfig",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"updateEncoderConfig"),Er.prototype),Et(Er.prototype,"updateSendParameters",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"updateSendParameters"),Er.prototype),Et(Er.prototype,"replaceTrack",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"replaceTrack"),Er.prototype),Et(Er.prototype,"muteLocal",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"muteLocal"),Er.prototype),Et(Er.prototype,"unmuteLocal",[Pu],Object.getOwnPropertyDescriptor(Er.prototype,"unmuteLocal"),Er.prototype),Er);function Pu(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}let Dd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var cK,lK,uK,dK,hK,pK,fK,mK,gK,_K,yK,Dr;function EK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function b1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?EK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):EK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let cEe=(cK=xd(Dd.SEND_ONLY),lK=xd(Dd.SEND_ONLY),uK=xd(),dK=xd(Dd.RECEIVE_ONLY),hK=xd(Dd.RECEIVE_ONLY),pK=xd(Dd.RECEIVE_ONLY),fK=xd(Dd.RECEIVE_ONLY),mK=xd(Dd.RECEIVE_ONLY),gK=xd(Dd.RECEIVE_ONLY),_K=xd(),yK=xd(Dd.RECEIVE_ONLY),Dr=class extends Mr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Nt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Kn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Kn.Connected)return void c(new xe(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void o();const v=y.find(N=>N[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(N=>{let[,{id:G}]=N;return G}));let T=!1;var h,m;s.trackMediaType==="video"?T=!((h=this.localTrackMap.get(Ke.LocalAudioTrack))===null||h===void 0||!h.track._muted):T=((m=this.localTrackMap.get(Ke.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await dr(this,Nt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?Hm.MUTE_LOCAL_VIDEO:Hm.MUTE_LOCAL_AUDIO;await dr(this,Nt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:T}),o()}catch(y){c(y)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Kn.Connected)return void c(new xe(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?Hm.UNMUTE_LOCAL_VIDEO:Hm.UNMUTE_LOCAL_AUDIO;await dr(this,Nt.RequestP2PMuteLocal,{action:y,message:m}),o()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Kn.Connected)return void o();const{id:v,track:T}=y;v&&(await this.sendConnection.updateSendParameters(v,T),await this.sendConnection.updateEncoderConfig(v,T),this.emit(Nt.UpdateVideoEncoder,T)),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Kn.Connected)return void o();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:R}]=T;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Kn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Ke.LocalVideoTrack&&Mn().supportDualStreamEncoding){const T=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(T){const R=s._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=R,T.track._originMediaStreamTrack=R,await new dt((P,N)=>{this.handleReplaceTrack(T.track,P,N,!0)})}}o()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new UH(t),this.bindStatsUploaderEvents(),this.sendMutex=new Os("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Os("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},ie("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new aK(t,this.store,Po.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Kn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new aK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new xe(J.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Kn.Connected}async addRemoteCandidate(t,r){if(r===Po.RECEIVE_ONLY){if(!this.sendConnection)throw new xe(J.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new xe(J.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var o=this;return wl(function*(){const c=yield In(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Kn.Connected){o.throwIfTrackTypeNotMatch(t);const v=t.filter(T=>o.pendingLocalTracks.indexOf(T)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Ds.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(t,r,s);if(u.length===0)return void(yield In(o.tryToUnmuteAudio(t)));u.forEach(v=>{let{track:T,type:R}=v;const P=Date.now();o.store.publish(T.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield In(o.sendConnection.send(u.map(v=>{let{track:T}=v;return T}),o.store.codec,o.store.audioCodec)),m=(yield In(h.next())).value,y=o.createGatewayPublishMessage(u,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===J.WS_ABORT&&u.forEach(T=>{let{track:R}=T;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),v}yield In(h.next()),u.forEach(v=>{let{type:T}=v;o.statsCollector.addLocalStats(T)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(v=>{let{track:T,type:R}=v;const P=Date.now();o.store.publish(T.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Kn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!at(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Kn.Connected)return s&&s[1].track.close(),o;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Zge(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{dr(this,Nt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{dr(this,Nt.RequestUnmuteLocal,[o])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return wl(function*(){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await bs(this,Nt.RequestRePublish,this.pendingLocalTracks),this.emit(Nt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,o){var c;if(!this.recvConnection)throw new xe(J.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),o);r===gt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new oS(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new sS(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(T=>{let{user:R,kind:P}=T;return R.uid===t.uid&&r===P});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Nt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,o){if(!this.recvConnection)throw new xe(J.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),o)}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(u=>{let{kind:h}=u;var m;if(h===gt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===gt.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var y,v;if(m===gt.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===gt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===gt.AUDIO){var T;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((T=h._audioTrack)===null||T===void 0||T._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;dr(this,Nt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[gt.VIDEO,gt.AUDIO].forEach(o=>{s.has(o)?dr(this,Nt.RequestP2PUnmuteRemote,o):dr(this,Nt.RequestP2PMuteRemote,o)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new xe(J.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Oi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Ke.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===Ke.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===Ke.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=o?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);Rt.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof qr),m=o?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Tr);Rt.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===gt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Rt.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:s.uid,subscribeRequestid:o===gt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ds.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Os("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Os("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ke.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Oi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Kn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ke.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ke.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Tr||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Fc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=pT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Kn.Reconnecting,ie("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case Ke.LocalVideoTrack:at(r=o._hints).call(r,pr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Ke.LocalAudioTrack:o instanceof Oi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Ke.LocalVideoLowTrack:}}),this.emit(Nt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Fc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Nt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Xm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,o;if(t===Po.SEND_ONLY){if(!this.sendConnection)throw new xe(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new xe(J.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await bs(this,Nt.RequestP2PRestartICE,{direction:Po.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalAudioTrack),o=t.videoSend.find(N=>{var G;return N.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(N=>{var G;return N.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const u=Vc(this,Nt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&u?(y+u)/2:y||u)||0,T=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(pr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const j=(1e3*N-G)/(1e3*N);return SG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Vc(this,Nt.NeedSignalRTT),v=t.rtt,T=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let N=.7*P*100/50+.3*T/1500;R&&(N=.6*P*100/50+.2*T/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new dt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const o=[],c=Mn(),u=this.getAllTracks();t=$v(t=t.filter(y=>u.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Tr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new xe(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:Ke.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);o.push({track:v,type:Ke.LocalVideoLowTrack})}if(y instanceof qr){const v=this.localTrackMap.get(Ke.LocalAudioTrack);if(v){if(!(v.track instanceof Oi))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const T=o.find(R=>{let{type:P}=R;return P===Ke.LocalAudioTrack});if(!(T.track instanceof Oi))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");T.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Oi||y._bypassWebAudio)o.push({track:y,type:Ke.LocalAudioTrack});else{const T=new Oi;T.addAudioTrack(y),o.push({track:T,type:Ke.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=$v(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof qr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Oi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(o instanceof Tr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ke.LocalVideoTrack:s.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Oi?t.trackList.forEach(s=>{s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case Ke.LocalVideoTrack:s.off(yt.GET_STATS,this.handleGetLocalVideoStats),s.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Oi?t.trackList.forEach(r=>{r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof sS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof oS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let u,{track:h,type:m}=s;switch(m){case Ke.LocalAudioTrack:u=qn.Audio;break;case Ke.LocalVideoTrack:u=at(c=h._hints).call(c,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalVideoLowTrack:u=qn.Low}return{kind:m===Ke.LocalAudioTrack?gt.AUDIO:gt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:o=at(s=u._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Nt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),at(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await os(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Rt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(Nt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(Fc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(eS.FIRST_FRAME_DECODED),Rt.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(Fc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(Fc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Rt.firstRemoteFrame(this.store.sessionId,Fi.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Nt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Km(s))," -> ").concat(JSON.stringify(Km(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Km(s))," -> ").concat(JSON.stringify(Km(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Nt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Po.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Po.SEND_ONLY?this.restartICE(t):bs(this,Nt.RequestP2PRestartICE,{direction:Po.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive||r.push([Ke.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o&&(r.push(o),o[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive&&r.push([Ke.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(o)if(o[0]===Ke.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoTrack:o=at(s=u._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:o=qn.Audio;break;case Ke.LocalVideoTrack:o=at(s=u._hints).call(s,pr.SCREEN_TRACK)?qn.Screen:qn.High;break;case Ke.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new dt((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new dt((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof qr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await dr(this,Nt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Nt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Nt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await os(bL(this.dtlsFailedCount,wi)),this.emit(Nt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Tr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Tr).length>1)throw new xe(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof qr).length>1&&(t.some(r=>r instanceof qr&&r._bypassWebAudio)||!Mn().webAudioMediaStreamDest))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Tr&&this.pendingLocalTracks.some(s=>s instanceof Tr))throw new xe(J.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof qr&&this.pendingLocalTracks.some(s=>s instanceof qr)&&(!Mn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof qr&&s._bypassWebAudio)))throw new xe(J.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding,o=b1(b1({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():k2(t,o);const u=hr(8,"track-low-"),h=new Tr(c,b1(b1({},s&&{scaleResolutionDownBy:p2(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(X_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Qv.LOW_STREAM)}),h._hints.push(pr.LOW_STREAM),t.addListener(yt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,o){var c;const u=Array.from(Fc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");Rt.firstRemoteVideoDecode(this.store.sessionId,Fi.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new xe(J.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new xe(J.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new xe(J.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new xe(J.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new xe(J.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new xe(J.NOT_SUPPORTED)}async preConnect(t){throw new xe(J.NOT_SUPPORTED)}getEstablishParams(){throw new xe(J.NOT_SUPPORTED)}async reSubscribe(t){throw new xe(J.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new xe(J.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ke.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Qv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Et(Dr.prototype,"p2pConnect",[cK],Object.getOwnPropertyDescriptor(Dr.prototype,"p2pConnect"),Dr.prototype),Et(Dr.prototype,"unpublish",[lK],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublish"),Dr.prototype),Et(Dr.prototype,"unpublishLowStream",[uK],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublishLowStream"),Dr.prototype),Et(Dr.prototype,"subscribe",[dK],Object.getOwnPropertyDescriptor(Dr.prototype,"subscribe"),Dr.prototype),Et(Dr.prototype,"mockSubscribe",[hK],Object.getOwnPropertyDescriptor(Dr.prototype,"mockSubscribe"),Dr.prototype),Et(Dr.prototype,"unsubscribe",[pK],Object.getOwnPropertyDescriptor(Dr.prototype,"unsubscribe"),Dr.prototype),Et(Dr.prototype,"muteRemote",[fK],Object.getOwnPropertyDescriptor(Dr.prototype,"muteRemote"),Dr.prototype),Et(Dr.prototype,"unmuteRemote",[mK],Object.getOwnPropertyDescriptor(Dr.prototype,"unmuteRemote"),Dr.prototype),Et(Dr.prototype,"hasRemoteMediaWithLock",[gK],Object.getOwnPropertyDescriptor(Dr.prototype,"hasRemoteMediaWithLock"),Dr.prototype),Et(Dr.prototype,"disconnectForReconnect",[_K],Object.getOwnPropertyDescriptor(Dr.prototype,"disconnectForReconnect"),Dr.prototype),Et(Dr.prototype,"remoteMediaSsrcChanged",[yK],Object.getOwnPropertyDescriptor(Dr.prototype,"remoteMediaSsrcChanged"),Dr.prototype),Dr);function xd(t){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(t){case Dd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Dd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},o}}class _y extends Mr{constructor(r,s){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===gr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*ie("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,u){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(Mc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:hr(6,""),u=(y=u)!==null&&y!==void 0?y:this._sequence++;const T={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(v)};ie("SHOW_P2P_LOG")&&x.debug("send message",T,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(T)).forEach(P=>{this.signal.request(Wt.DATA_STREAM,{payload:Wm(this.encoder.encode(P))})});const R=new dt((P,N)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Y),this.off(dS.ABORT,W),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?N(new xe(J.INVALID_REMOTE_USER)):N(new xe(J.TIMEOUT))},ie("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),j=()=>{G&&window.clearTimeout(G),this.off(dS.ABORT,W),o&&P()},W=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Y),N(new xe(J.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(dS.ABORT,W),this.once("res-@".concat(c,"_ack"),j);const Y=(ue,ye)=>{X=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off(dS.ABORT,W),ue==="success"?P(ye):N(new xe(J.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let X=!1;o||(this.once("res-@".concat(c),Y),os(ie("SIGNAL_REQUEST_TIMEOUT")).then(()=>{X||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(T))}))});try{return await R}catch(P){if(P.code===J.TIMEOUT)return await this.send(r,s,o,c,u);throw P}}onMessage(r){var s;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==ai.CHECK)return;const{token:v}=r;c=new Map,u={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(En.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:T}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==T)return;{const P=pT(R).call(R,(N,G)=>N.index-G.index).map(N=>N.payload).join("");c.delete(v),(r=JSON.parse(P))._uid=o}}const{_type:m,token:y}=r;if(at(s=[ai.ACK,ai.CHECK]).call(s,m))return m===ai.CHECK&&this.handleCheckToken(u,y),void this.receiveMessage(r);y==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:hr(6,""),token:this.token,_type:ai.CHECK};ie("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Wt.DATA_STREAM,{payload:Wm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:ai.ACK,token:this.token};ie("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Wt.DATA_STREAM,{payload:Wm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(ai.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:T,nextExpectedSequenceNumber:R}=v;for(;T.has(R);){const P=T.get(R);T.delete(R),this.receiveMessage(P),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=u;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:u}=r;if(ie("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==ai.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case ai.CANDIDATE:case ai.CONTROL:this.signal.emit(o,h,u);break;case ai.PUBLISH:case ai.UNPUBLISH:case ai.RESTART_ICE:case ai.CALL:h.uid=u,bs(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case ai.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case ai.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<_y.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=hr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const y={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(y).length>_y.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},ie("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await bs(this.signal,ai.CALL,void 0),s=await this.send(ai.CALL,r);this.signal.emit(zt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(dS.ABORT),this.signal.emit(En.ON_USER_OFFLINE,{uid:o.uid,reason:Ige.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=hr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(dS.ABORT)}}K(_y,"MAX_SIZE",1),K(_y,"MAX_MESSAGE_SIZE",1024);class lEe extends Mr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===gr.CONNECTED?this.emit(zt.WS_CONNECTED):r===gr.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):r===gr.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",gr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new YW(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case En.ON_DATA_STREAM:return void this.handleDataStream(c._message);case En.MUTE_AUDIO:case En.MUTE_VIDEO:case En.ON_P2P_LOST:case En.ON_USER_ONLINE:return;case En.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close($n.UID_BANNED);break;case 15:this.close($n.IP_BANNED);break;case 16:this.close($n.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close($n.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close($n.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close($n.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close($n.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($n.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close($n.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new d2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,ie("JOIN_GATEWAY_USE_DUAL_DOMAIN"),ie("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===gr.CONNECTED&&this.reconnect("retry",Ss.OFFLINE)}),this.p2pToken=hr(6,""),this._external_signal=new _y(this,this.p2pToken)}async request(r,s,o,c){const u=hr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new dt((G,j)=>{if(this.connectionState===gr.CONNECTED)return G();const W=()=>{this.off(zt.WS_CLOSED,Y),G()},Y=()=>{this.off(zt.WS_CONNECTED,W),j(new xe(J.WS_ABORT))};this.once(zt.WS_CONNECTED,W),this.once(zt.WS_CLOSED,Y)});if(this.connectionState!==gr.CONNECTING&&this.connectionState!==gr.RECONNECTING||r===Wt.JOIN||r===Wt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new dt((G,j)=>{let W=!1;const Y=(ue,ye)=>{W=!0,G({isSuccess:ue==="success",message:ye||{}}),this.off(zt.WS_CLOSED,X),this.off(zt.WS_RECONNECTING,X),this.emit(zt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Y);const X=()=>{j(new xe(J.WS_ABORT,"type: ".concat(r))),this.off(zt.WS_CLOSED,X),this.off(zt.WS_RECONNECTING,X),this.off("res-@".concat(u),Y)};this.once(zt.WS_CLOSED,X),this.once(zt.WS_RECONNECTING,X),os(ie("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(zt.REQUEST_TIMEOUT,r,s))})});let T=null;try{T=await v}catch(G){if(this.connectionState===gr.CLOSED||r===Wt.LEAVE)throw new xe(J.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Wt.JOIN||r===Wt.REJOIN?null:(await y(),await this.request(r,s))}if(T.isSuccess)return T.message;const R=Number(T.message.error_code||T.message.code),P=jT(R),N=new xe(J.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(T.message.error_str),{code:R,data:T.message,desc:P.desc});return P.action==="success"?T.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Wt.JOIN||r===Wt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ss.MULTI_IP)):this.reconnect(P.action,Ss.SERVER_ERROR),r===Wt.JOIN||r===Wt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new dt(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(UT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=ie("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==gr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},ie("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((s,o)=>{this.once(zt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(zt.WS_CLOSED,()=>o(this.initError||new xe(J.WS_ABORT))),this.connectionState=gr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||$n.LEAVE,this.connectionState=gr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=hr(6,""),this._external_signal.clear(),this._external_signal=new _y(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const r=await bs(this,zt.REQUEST_JOIN_INFO),s=await this.request(Wt.JOIN,r);if(!s)return this.emit(zt.REPORT_JOIN_GATEWAY,J.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const o=K_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||at(s=Object.values(ai)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(En.ON_DATA_STREAM,r)}catch{this.emit(En.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=jT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($n.UID_BANNED),void this.close()):void this.reconnect(s.action,Ss.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=ie("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ie("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ss.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),ie("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Xt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Xt.CLOSED,()=>{this.connectionState=gr.CLOSED}),this.websocket.on(Xt.FAILED,()=>{this._disconnectedReason=$n.NETWORK_ERROR,this.connectionState=gr.CLOSED}),this.websocket.on(Xt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===gr.CONNECTED?this.connectionState=gr.RECONNECTING:this.connectionState=gr.CONNECTING}),this.websocket.on(Xt.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof xe&&r.code===J.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ss.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ss.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Xt.REQUEST_NEW_URLS,(r,s)=>{bs(this,zt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const uEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new cEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new lEe(s,r)}};function vK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function SK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class dEe{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=zr(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,T=Ra(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=zr(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<T.mediaDescriptions.length;R++){const P=T.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let N=u.videoCodecs.filter(G=>{var j,W;return(j=G.rtpMap)===null||j===void 0?void 0:at(W=j.encodingName.toLowerCase()).call(W,y)});N.length===0&&(N=u.videoCodecs),P.attributes.payloads=N,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(N=>N.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),T.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return zm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:u}=ry(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===gt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{at(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;at(m=u.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(SK(SK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Ns.TCP_RELAY:this.candidates=o;break;case Ns.UDP_TCP_RELAY:case Ns.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=zr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=zr(r);return fS(o,s),m2(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===gt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(s,o))}}mungMediaDesc(r){const s=zr(r);return f2(s),function(o){const c=o.attributes.extmaps.find(u=>VP(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var ur;function bK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function T1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let hEe=(ur=class sC extends kG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return at(s=Object.keys(pP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=s,this.mutex=new Os("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(sC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=AL(this.peerConnection,ie("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=qm(r.sdp),o=WT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:ie("FILTER_VIDEO_FEC"),filterAudioFec:ie("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,T1(T1({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new xe(J.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new dEe(T1(T1({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new xe(J.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return wl(function*(){const c=yield In(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield In(o.peerConnection.createOffer()),m=Ra(h.sdp),y=r.map(P=>{const N=P._mediaStreamTrack,G=m.mediaDescriptions.find(j=>j.attributes.mid===N.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,W,Y){const X=j.attributes.ssrcs.filter(ye=>ye.attributes.label===W),ue=j.attributes.ssrcGroups;if(X.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ue&&X.length>1){const ye=ue.find(Se=>Se.ssrcIds.indexOf(X[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:Y?ye.ssrcIds[1]:void 0}]:[{ssrcId:X[0].ssrcId}]}return[{ssrcId:X[0].ssrcId}]}(G,N.id,o.useRTX)});let v;try{v=yield y}catch(P){throw u.forEach(N=>{vs()&&N.replaceTrack(null),o.peerConnection.removeTrack(N)}),P}const T=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,v);const R=o.remoteSDP.toString();return yield In(o.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(o.applySendEncodings(u,r)),yield In(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,N)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[N],id:G}})}catch(u){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{vs()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new dt((T,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),N=G=>{const j=An();if((j.name==="Safari"&&Number(j.version)===11||Ro())&&G.track.id!==u&&G.streams[0].id===h){var W;const Y=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T(Y)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T(G.track)};this.peerConnection.addEventListener("track",N)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:u}}catch(u){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(vs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(vs()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return wl(function*(){const o=yield In(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Mn().supportPCSetConfiguration;if(r===Ns.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),T=r===Ns.RELAY?"relay":"all";v.iceTransportPolicy!==T&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(T,"]")),v.iceTransportPolicy=T,s.peerConnection.setConfiguration(v))}r!==Ns.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield In(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=qm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield In(s.peerConnection.setLocalDescription(u)),yield In(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new xe(J.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new xe(J.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new xe(J.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ie("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(PT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...sC.turnServerConfigToIceServers(r.turnServer.servers)),ie("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...sC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(v=>{var T;return((T=v.track)===null||T===void 0?void 0:T.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Mn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Tr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(ie("DSCP_TYPE")&&sf()){var h;const v=ie("DSCP_TYPE");at(h=["very-low","low","medium","high"]).call(h,v)&&(u.networkPriority=v)}const m=s.getParameters(),y=(o=m.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Mn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=Ra(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&fS(m,c)}),zm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:y}=u;const{kind:v}=r[h];return new dt((T,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=G=>{const j=An();if(j.name==="Safari"&&Number(j.version)===11&&G.track.id!==m&&G.streams[0].id===y){var W;const Y=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T({track:Y,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T({track:G.track,id:m})};this.peerConnection.addEventListener("track",N)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await dt.all(s)}catch(s){throw new xe(J.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Mn().supportPCSetConfiguration){const s=sC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Et(ur.prototype,"connect",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"connect"),ur.prototype),Et(ur.prototype,"stopSending",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"stopSending"),ur.prototype),Et(ur.prototype,"receive",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"receive"),ur.prototype),Et(ur.prototype,"stopReceiving",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"stopReceiving"),ur.prototype),Et(ur.prototype,"muteRemote",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"muteRemote"),ur.prototype),Et(ur.prototype,"unmuteRemote",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"unmuteRemote"),ur.prototype),Et(ur.prototype,"muteLocal",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"muteLocal"),ur.prototype),Et(ur.prototype,"unmuteLocal",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"unmuteLocal"),ur.prototype),Et(ur.prototype,"close",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"close"),ur.prototype),Et(ur.prototype,"updateEncoderConfig",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"updateEncoderConfig"),ur.prototype),Et(ur.prototype,"updateSendParameters",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"updateSendParameters"),ur.prototype),Et(ur.prototype,"replaceTrack",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"replaceTrack"),ur.prototype),Et(ur.prototype,"getRemoteSSRC",[Nl],Object.getOwnPropertyDescriptor(ur.prototype,"getRemoteSSRC"),ur.prototype),ur);function Nl(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}const pEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new hEe(s,r)}},fEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(bP.has(t)||!t.track)return;const s={track:t.track};if(rf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const y=r.metadata&&r.metadata();y?function(v,T){const{chunk:R,controller:P}=T,N=ie("ENABLE_AUDIO_PTS_METADATA")?lf.AUDIO_64_BIT_PTS:lf.METADATA;R.data=function(G,j,W){const Y=W.byteLength,X=Y+QL+mG,ue=XL+JL+X,ye=new ArrayBuffer(G.byteLength+ue),Se=new DataView(ye);Se.setUint8(0,fG),Se.setUint16(1,X),Se.setUint8(3,j),Se.setUint16(4,Y);for(let Ne=0;Ne<Y;Ne++)Se.setUint8(6+Ne,W[Ne]);const _e=new Uint8Array(Se.buffer);return _e.set(new Uint8Array(G),ue),_e.buffer}(R.data,N,v),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=SP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&u.port1.postMessage({metadata:v})}},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=bP.get(t);if(c){bP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}bP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(AP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(rf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");uL(Bn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)),r.enableTopn?function(y,v,T){var R;const P=gG(new DataView(v.data));if(!P)return T.enqueue(v);const N=y.track.id;qme.set(N,y.track);const G=(R=P.tlv.find(ye=>ye.tag===lf.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let j=0;typeof G=="number"&&(j=127-G);const W=Math.round(Math.pow(10,j/60)-1),{selected:Y,speaker:X}=function(ye,Se){let _e=aS.get(ye);if(_e||(_e=function(Ne){const Je=new yG;return aS.set(Ne,Je),Ad||(Ad=new $me(ie("TOPN_SILENCE_THRESHOLD")||500),Ad.on("ActiveSpeakerChanged",ht=>{ht!=null&&(CP=ht)})),Ad.addSpeakers([Je]),Je}(ye)),aS.size<=EG)return{selected:!0,speaker:_e};if(!Ad)throw new Error("no active speaker detector");return Ad.levelChanged(_e.id,Se),ey=Ad.loudest.map(Ne=>Ne.id),CP&&!at(ey).call(ey,CP)&&ey.length>=EG&&ey.pop(),{selected:at(ey).call(ey,_e.id)||_e.id===CP,speaker:_e}}(y,W),ue=function(ye,Se,_e){const Ne=Pd.get(ye)||new Kme(ye,Se);return Ne.score=_e,Pd.set(ye,Ne),function(Je){if(RP.set(Je,!0),!IP)return void(IP=Date.now());const ht=Date.now();ht-IP>1e3&&(RP.get(Je)?RP.set(Je,!1):(vG(Je),RP.delete(Je)),IP=ht)}(ye),Ne}(N,y.track,X.energyScore);ue.addSample(Y),ue.active&&(v.data=P.frame.buffer,T.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,T){const R=gG(new DataView(y.data));if(!R)return v.enqueue(y);const P=R.tlv.find(N=>N.tag===lf.METADATA||N.tag===lf.AUDIO_64_BIT_PTS);P&&T&&P.value instanceof Uint8Array&&T(P.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=SP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function o(){t.track.removeEventListener("ended",o),function(c){const u=AP.get(c);if(u){(function(y){const v=aS.get(y);v&&(aS.delete(y),Ad&&(Ad.removeSpeakers([v]),aS.size===0&&(Ad.destroy(),Ad=null)))})(c),vG(c.track.id),AP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}AP.set(t,s),t.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(t,r){if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(PP.has(t)||!t.track)return;const s={track:t.track};if(rf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const v=u.shift();v&&(m.data=function(T,R){const P=function(X){const ue=X.length;let ye=[],Se=0;for(;Se<ue;)Se+2<ue&&X[Se]===0&&X[Se+1]===0&&(X[Se+2]===0||X[Se+2]===1||X[Se+2]===2||X[Se+2]===3)?(ye.push(X[Se],X[Se+1],3,X[Se+2]),Se+=3):(ye.push(X[Se]),Se++);return new Uint8Array(ye)}(R),N=P.length,G=Math.floor(N/255),j=N%255,W=new Uint8Array(6+G+1+N+T.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=6,W[5]=101;let Y=0;for(;Y<G;)W[6+Y]=255,Y++;return W[6+Y]=j,Y++,W.set(P,6+Y),W.set(new Uint8Array(T),6+Y+N),W.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!vs())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=SP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=PP.get(t);if(c){PP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}PP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(MT.has(t)){const c=MT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(rf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const y=function(v){const T=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(T.getUint8(R+0)===0&&T.getUint8(R+1)===0&&T.getUint8(R+2)===0&&T.getUint8(R+3)===1&&T.getUint8(R+4)===6){let P=R+6,N=0,G=0;for(;(G=T.getUint8(P++))===255;)N+=255;N+=G;const j=Yme(v.data,P,N);return new Uint8Array(j)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=SP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}(function(c){const u=MT.get(c);if(u){MT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}MT.set(t,s),t.track.addEventListener("ended",o)}},mEe={name:"InterceptFrame",create:()=>fEe};PL(),tr("PROCESS_ID","process-".concat(hr(8,""),"-").concat(hr(4,""),"-").concat(hr(4,""),"-").concat(hr(4,""),"-").concat(hr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(br,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;Id[o]=c,br[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Id.AREAS)&&Id.AREAS.length>0&&v2(Id.AREAS,!0);const TK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),tr(t,r,s)};Ym(Vye,!1),Ym(Bye,!1),Ym(v_e,!1),Ym(Qye,!1),Ym(Lye,!1),Ym(uEe,!1),Ym(pEe,!1),Ym(mEe,!1);const Ci=function(t){const r=new Mr,s=t,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===xh.SECURITY_POLICY_VIOLATION&&r$(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return n$(n$({},s),o)}({__TRACK_LIST__:Jv,VERSION:Cl,BUILD:NL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:TK,getParameter:ie,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return Mn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(J.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Rt.reportApiInvoke(null,{name:Ti.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Wr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&fL()&&wW(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let s=!1;const o=An();o.name===Bn.CHROME&&Number(o.version)>=58&&(Cd.engine.name!=="WebKit"||function(){const u=An();if(iP()){if(u.os===ji.MAC_OS)return!0;if(u.os===ji.IOS){const h=Cd.os.version&&Cd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Bn.FIREFOX&&Number(o.version)>=56||o.name===Bn.OPERA&&Number(o.version)>=45||o.name===Bn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Ro()||yu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||OW()||An().name===Bn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return Hc.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Hc.getRecordingDevices(t)},getCameras:function(t){return Hc.getCamerasDevices(t)},getElectronScreenSources:wz,getPlaybackDevices:function(t){return Hc.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=hr(5,"client-"),o=Rt.reportApiInvoke(null,{id:s,name:Ti.CREATE_CLIENT,options:[r],tag:Wr.TRACER});try{(function(c){xi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),xi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&xi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ss(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&VW(c.turnServer),c.httpRetryConfig!==void 0&&UW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&UW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(RW(16,0)||IW(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),tr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new S_e(Ru(Ru({forceWaitGatewayResponse:!0},r),{},{role:at(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=ie("CAMERA_CAPTURE_CONFIG"),s=hr(8,"track-cam-"),o=Rt.reportApiInvoke(null,{id:s,tag:Wr.TRACER,name:Ti.CREATE_CAM_VIDEO_TRACK,options:[Nr({},t),r]});r&&(t.encoderConfig=r);const c=EP(t);let u=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{u=(await Gc({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new xe(J.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}t.optimizationMode&&YL(s,u,t,kh(t.encoderConfig));const h=new qL(u,t,c,t.scalabiltyMode?mP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=hr(8,"track-cus-"),s=Rt.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ti.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),o=new Tr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?mP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[pr.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),x.info("create custom video track success with config",t,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return xz(P)}(r):void 0;s&&(r="auto");const o=hr(8,"track-scr-v-"),c=Rt.reportApiInvoke(null,{id:o,tag:Wr.TRACER,name:Ti.CREATE_SCREEN_VIDEO_TRACK,options:[Nr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(P){const N={};P.screenSourceType&&(N.mediaSource=P.screenSourceType),P.extensionId&&rf()&&(N.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:j,surfaceSwitching:W,systemAudio:Y,preferCurrentTab:X}=P;(CT(107)||dL(107)||hL(93))&&(G&&(xi(G,"displaySurface",["browser","window","monitor"]),N.displaySurface=G),j?(xi(j,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=j):N.selfBrowserSurface="include",W&&(xi(W,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=W)),(CT(105)||dL(105)||hL(91))&&Y&&(xi(Y,"systemAudio",["exclude","include"]),N.systemAudio=Y),(CT(94)||dL(94)||hL(80))&&X&&(N.preferCurrentTab=!0),P.electronScreenSourceId&&(N.sourceId=P.electronScreenSourceId);const ue=P.encoderConfig?UL(P.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:ue?ue.width:void 0,maxHeight:ue?ue.height:void 0},ue&&(ue.frameRate&&(typeof ue.frameRate=="number"?(N.mandatory.maxFrameRate=ue.frameRate,N.mandatory.minFrameRate=ue.frameRate):(N.mandatory.maxFrameRate=ue.frameRate.max||ue.frameRate.ideal||ue.frameRate.exact||void 0,N.mandatory.minFrameRate=ue.frameRate.min||ue.frameRate.ideal||ue.frameRate.exact||void 0),N.frameRate=ue.frameRate),ue.width&&(N.width=ue.width),ue.height&&(N.height=ue.height)),N}(t);let h=null,m=null;const y=Mn();if(!y.supportShareAudio&&r==="enable"){const P=new xe(J.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",o);const v=y.supportShareAudio&&r!=="disable";try{const P=await Gc({screen:u,screenAudio:v?s||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new xe(J.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new xe(J.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(YL(o,h,t,t.encoderConfig&&UL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const T=new Tr(h,t.encoderConfig?UL(t.encoderConfig):{},t.scalabiltyMode?mP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[pr.SCREEN_TRACK]);if(!m)return c.onSuccess(T.getTrackId()),x.info("create screen video track success","video:",T.getTrackId()),T;const R=new qr(m,void 0,hr(8,"track-scr-a-"),!1);return c.onSuccess([T.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",T.getTrackId(),"audio:",R.getTrackId()),[T,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=ie("CAMERA_CAPTURE_CONFIG"),o=hr(8,"track-mic-"),c=hr(8,"track-cam-"),u=Rt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Wr.TRACER,name:Ti.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=EP(r),m=Lz(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await Gc({audio:m,video:h},"".concat(o,"-").concat(c));y=P.getAudioTracks()[0],v=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!y||!v){const P=new xe(J.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(x)}r.optimizationMode&&YL(c,v,r,kh(r.encoderConfig));const T=new vP(y,t,m,o),R=new qL(v,r,h,r.scalabiltyMode?mP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([T.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[T,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=hr(8,"track-mic-"),s=Rt.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ti.CREATE_MIC_AUDIO_TRACK,options:[t]}),o=Lz(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Gc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new xe(J.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const u=new vP(c,t,o,r);return s.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(t){const r=hr(8,"track-cus-"),s=Rt.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ti.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),o=new qr(t.mediaStreamTrack,t.encoderConfig?gP(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:o}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=hr(8,"track-buf-"),m=Rt.reportApiInvoke(null,{id:h,tag:Wr.TRACER,name:Ti.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(ie("DISABLE_WEBAUDIO"))throw new xe(J.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let N=null;if(typeof R=="string"){const j=S9.get(R);if(j)return x.debug("use cached audio resource: ",R),j;try{N=(await Rd(()=>Jo.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(W){throw new xe(J.FETCH_AUDIO_FILE_FAILED,W.toString())}}else N=await new dt((W,Y)=>{const X=new FileReader;X.onload=ue=>{ue.target?W(ue.target.result):Y(new xe(J.READ_LOCAL_AUDIO_FILE_ERROR))},X.onerror=()=>{Y(new xe(J.READ_LOCAL_AUDIO_FILE_ERROR))},X.readAsArrayBuffer(R)});const G=await function(j){const W=rS();return new dt((Y,X)=>{W.decodeAudioData(j,ue=>{Y(ue)},ue=>{X(new xe(J.DECODE_AUDIO_FILE_FAILED,ue.toString()))})})}(N);return typeof R=="string"&&P&&S9.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new Bme(c),T=new Fme(y,v,o?gP(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(T.getTrackId()),T},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Oe(J.INVALID_PARAMS,"invalid app type",t);tr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){ie("USE_NEW_LOG")?tr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){ie("USE_NEW_LOG")?tr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new SH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Rt.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof qr||t instanceof oS)){const y=new Oe(J.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof qr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const m=Date.now();return new dt(y=>{const v=setInterval(()=>{const T=t.getVolumeLevel();u=T>u?T:u,h=T<h?T:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(v);const N=R,G={duration:P,deviceLabel:o,maxVolumeLevel:u,result:N};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(N)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Rt.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Tr||t instanceof sS)){const R=new Oe(J.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Tr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(vs()||iP())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,N,G,j){let W,Y=0,X=null;return new dt((ue,ye)=>{function Se(){Y>j&&W&&(W(),ue(Y));const _e=G.getContext("2d");if(!_e){const ht=new Oe(J.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(ht.toString()),void ye(ht)}_e.drawImage(P,0,0,160,120);const Ne=_e.getImageData(0,0,G.width,G.height),Je=Math.floor(Ne.data.length/3);if(X){for(let ht=0;ht<Je;ht+=3)if(Ne.data[ht]!==X[ht])return Y+=1,void(X=Ne.data);X=Ne.data}else X=Ne.data}setTimeout(()=>{W&&(W(),ue(Y))},N),W=WL(()=>{Se()},30)})}(u,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}o_e===Bn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=m>4,T={duration:y,changedPicNum:m,deviceLabel:o,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(T))),s.onSuccess(T),v},setArea:v2,audioElementPlayCenter:Qo,resumeAudioContext:function(){Qo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){T_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=ie("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!at(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=Rt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=ie(c)})}),TK("PLUGIN_INFO",r)},ChannelMediaRelayError:lS,ChannelMediaRelayEvent:df,ChannelMediaRelayState:Ia,RemoteStreamFallbackType:Dme,RemoteStreamType:Nme,ConnectionDisconnectedReason:$n,AudienceLatencyLevelType:lme,AREAS:Wn,preload:async function(t,r,s,o){return qH(t,r,s,o)}});return Object.defineProperties(Ci,{onAudioAutoplayFailed:{get:()=>$c.onAudioAutoplayFailed,set:t=>{$c.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>$c.onAutoplayFailed,set:t=>{$c.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ci._onSecurityPolicyViolation,set(t){Ci._onSecurityPolicyViolation=t,r$(t)}},__CLIENT_LIST__:{get:()=>ie("SHOW_GLOBAL_CLIENT_LIST")?ty:[]}}),Hc.on(J_.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Ci.onCameraChanged&&Ci.onCameraChanged(t),Ci.safeEmit(xh.CAMERA_CHANGED,t)}),Hc.on(J_.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Ci.onMicrophoneChanged&&Ci.onMicrophoneChanged(t),Ci.safeEmit(xh.MICROPHONE_CHANGED,t)}),Hc.on(J_.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Ci.onPlaybackDeviceChanged&&Ci.onPlaybackDeviceChanged(t),Ci.safeEmit(xh.PLAYBACK_DEVICE_CHANGED,t)}),Qo.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),$c.onAudioAutoplayFailed&&$c.onAudioAutoplayFailed()},nr.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),$c.onAudioAutoplayFailed&&$c.onAudioAutoplayFailed(),Ci.safeEmit(xh.AUTOPLAY_FAILED)}),nr.on(cs.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Ci.onAudioContextStateChanged&&Ci.onAudioContextStateChanged(t,r),Ci.safeEmit(xh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),fi.on(Hv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Ci),Ci})}(zO)),zO.exports}var d9e=u9e();const cR=Xf(d9e),h9e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"a2a7f4eb05284449b1063eb71d8301dc",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"},Oae="a2a7f4eb05284449b1063eb71d8301dc";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Oae);console.log("AgoraProvider: import.meta.env:",h9e);const p9e=cR.createClient({mode:"rtc",codec:"vp8"});let Vw=null;const kae=D.createContext(null),Nae=({children:n,appId:e=Oae,channel:i=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:_=()=>{}})=>{console.log("AgoraProvider: appId prop:",e);const[E,b]=D.useState(!1),[w,I]=D.useState(!1),[k,V]=D.useState([]),[L,F]=D.useState(null),[B,q]=D.useState(null),[$,Q]=D.useState(null),[ae,re]=D.useState(!1),[fe,Z]=D.useState(!1),[ee,ne]=D.useState(!1),[oe,ge]=D.useState(null),[pe,le]=D.useState(!1),Me=ll(),He=D.useRef(p9e),tt=D.useRef({appId:e,channel:i,uid:l,enabled:d}),Ee=D.useRef(!1),Ie=D.useRef(null);D.useRef(null),D.useEffect(()=>{tt.current={appId:e,channel:i,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:e,channel:i,uid:l,enabled:d})},[e,i,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:e,channel:i,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[e,i,l,d]),D.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",i),q(i)},[i]),D.useEffect(()=>{if(!He.current)return;const $e=ct=>{console.log(`Connection state changed to: ${ct}`),ct==="DISCONNECTED"?(b(!1),console.log("Disconnected from Agora")):ct==="CONNECTED"&&(b(!0),F(null))};return He.current.on("connection-state-change",$e),()=>{He.current.off("connection-state-change",$e)}},[]),D.useEffect(()=>{if(!i||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:i,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",i,"with UID",l);const $e=async(Dt,an)=>{console.log("AgoraProvider: User published:",Dt.uid,an);try{await He.current.subscribe(Dt,an),console.log("AgoraProvider: Subscribed to user:",Dt.uid,"mediaType:",an),an==="audio"&&(Dt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Dt.uid)),V(jn=>jn.some(Qt=>Qt.uid===Dt.uid)?jn:[...jn,Dt])}catch(jn){console.error("AgoraProvider: Error subscribing to user:",jn)}},ct=(Dt,an)=>{console.log("AgoraProvider: User unpublished:",Dt.uid,an),an==="audio"&&Dt.audioTrack&&(Dt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Dt.uid))},it=Dt=>{console.log("AgoraProvider: User joined:",Dt.uid),V(an=>an.some(jn=>jn.uid===Dt.uid)?an:[...an,Dt])},Ct=Dt=>{console.log("AgoraProvider: User left:",Dt.uid),V(an=>an.filter(jn=>jn.uid!==Dt.uid))};He.current.on("user-published",$e),He.current.on("user-unpublished",ct),He.current.on("user-joined",it),He.current.on("user-left",Ct);const Vt=async()=>{if(Ee.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}Ee.current=!0;try{if(E&&Ie.current===i){console.log("AgoraProvider: Already joined to channel",i),re(!0),_(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Ie.current&&Ie.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await ke()}catch(Dt){console.error("AgoraProvider: Error leaving channel:",Dt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),b(!0),re(!0),Ie.current=i,Vw=i,_(He.current);return}console.log("AgoraProvider: Joining channel",i,"current joined channel:",Ie.current),await Be(),console.log("AgoraProvider: Join channel completed")}catch(Dt){console.error("AgoraProvider: Error during initialization:",Dt)}finally{Ee.current=!1}};return console.log("AgoraProvider: Running initialization"),Vt(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",$e),He.current.off("user-unpublished",ct),He.current.off("user-joined",it),He.current.off("user-left",Ct)}},[i,d,l,_,E]);const ve=async()=>{if(!d||$)return $;console.log("Initializing microphone");try{const $e=await cR.createMicrophoneAudioTrack();return await $e.setMuted(f),Q($e),console.log("Microphone initialized successfully"),$e}catch($e){return console.error("Error initializing microphone:",$e),F("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(i)try{const Ct=await Og(i);Ct&&Ct.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),le(!0),E&&await ke()):le(!1)}catch(it){console.error("AgoraProvider: Error checking if voice is disabled:",it)}})();const ct=it=>{it.detail&&typeof it.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",it.detail.voiceDisabled),le(it.detail.voiceDisabled),it.detail.voiceDisabled&&E?ke():!it.detail.voiceDisabled&&!E&&d&&i&&Be())};return window.addEventListener("SpaceVoiceSettingChanged",ct),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ct)}},[i,E,d]);const Be=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(pe)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),F("Voice chat is disabled for this space"),!1;if(!i)return console.error("AgoraProvider: No channel specified"),F("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",i,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:E,isJoining:fe,connectionState:He.current.connectionState,joinedChannel:Ie.current}),E&&Ie.current===i)return console.log("AgoraProvider: Already joined to channel:",i),!0;if(fe)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Ie.current&&Ie.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await ke()}catch($e){console.error("AgoraProvider: Error leaving channel:",$e)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),b(!0),re(!0),Ie.current=i,Vw=i,_(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Z(!0),new Promise($e=>{const ct=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(ct),b(!0),Z(!1),re(!0),Ie.current=i,Vw=i,_(He.current),$e(!0))},500);setTimeout(()=>{clearInterval(ct),console.log("AgoraProvider: Connection timeout, considering join failed"),Z(!1),$e(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",i,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",e,"Type:",typeof e,"Length:",e.length),!e||e.trim()===""){const ct="AgoraProvider: App ID is empty or invalid";return console.error(ct),F(ct),Z(!1),!1}Z(!0);const $e=l||Math.floor(Math.random()*1e6);return await He.current.join(e,i,a,$e),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),b(!0),Z(!1),re(!0),Ie.current=i,Vw=i,_(He.current),!0}catch($e){return console.error("AgoraProvider: Error joining channel:",$e),F(`Error joining channel: ${$e.toString()}`),Z(!1),!1}},ke=async()=>{if(E)try{$&&await He.current.unpublish($),await He.current.leave(),Vw=null,Ie.current=null,console.log("Left channel successfully"),b(!1),V([])}catch($e){console.error("Error leaving channel:",$e),F($e.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{d&&i&&(!E||Ie.current!==i)&&Be()},[d,i,E]);const Re=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch($e){return console.error("Error checking microphone status:",$e),!1}};D.useEffect(()=>{const $e=()=>{const it=Re();it!==w&&(console.log("Syncing microphone state:",{actualStatus:it,currentState:w}),I(it),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:it}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=it,window.agoraClient.microphoneTrack=$))};$&&$e();const ct=setInterval($e,1e3);return()=>{clearInterval(ct)}},[$,w]);const he=async()=>{var $e;if(pe)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ct=w!==void 0?w:$?!$.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:ct,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ve()))return console.error("AgoraProvider: Failed to initialize microphone"),ct;const it=!ct;if(console.log("AgoraProvider: New voice state will be:",it),ct){if($)try{console.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(Ct){return console.error("Error muting track:",Ct),ct}}else if($)try{He.current&&E&&!(($e=He.current.localTracks)!=null&&$e.includes($))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish($),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(Ct){return console.error("Error unmuting track:",Ct),ct}return I(it),it}catch(ct){return console.error("AgoraProvider: Error toggling voice:",ct),w}},we=async $e=>{try{Q($e),console.log("Microphone track updated successfully")}catch(ct){throw console.error("Error updating microphone track:",ct),ct}},Ue=async()=>{if(!He.current||!i)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(ee)return console.log("AgoraProvider: Stopping screen share"),oe&&(Array.isArray(oe)?(await He.current.unpublish(oe),oe.forEach($e=>$e.close())):(await He.current.unpublish(oe),oe.close()),ge(null)),ne(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const $e=await cR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",$e),$e.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish($e),$e.close(),ge(null),ne(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish($e),ge($e),ne(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=$e,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch($e){return console.error("AgoraProvider: Error creating screen track:",$e),ne(!1),ge(null),!1}}catch($e){return console.error("AgoraProvider: Error toggling screen share:",$e),ne(!1),ge(null),!1}};D.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const $e=it=>{console.log("AgoraProvider: Received ToggleScreenShare event"),Ue().then(Ct=>{it.detail&&it.detail.callback&&it.detail.callback(!0,Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),it.detail&&it.detail.callback&&it.detail.callback(!1,ee)})},ct=it=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Be().then(Ct=>{it.detail&&it.detail.callback&&it.detail.callback(Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),it.detail&&it.detail.callback&&it.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",$e),window.addEventListener("JoinVoiceChat",ct),()=>{window.removeEventListener("ToggleScreenShare",$e),window.removeEventListener("JoinVoiceChat",ct),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=$,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,$]);const Fe={client:He.current,isJoined:E,isVoiceEnabled:w,users:k,error:L,channel:B,appId:e,toggleVoice:he,leaveChannel:ke,joinChannel:Be,microphoneTrack:$,isReady:ae,createMicrophoneTrack:we,isScreenSharing:ee,screenTrack:oe,toggleScreenShare:Ue,voiceDisabled:pe};return S.jsx(kae.Provider,{value:Fe,children:n})},Dae=()=>{const n=D.useContext(kae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Nae.propTypes={children:Hr.node.isRequired,appId:Hr.string.isRequired,channel:Hr.string.isRequired,token:Hr.string,uid:Hr.oneOfType([Hr.string,Hr.number])};const f9e=()=>{var Ee,Ie;const{client:n,isVoiceEnabled:e,isJoined:i,users:a,error:l,microphoneTrack:d,isReady:f,channel:_,appId:E,toggleVoice:b,joinChannel:w,leaveChannel:I,createMicrophoneTrack:k,isScreenSharing:V,screenTrack:L,toggleScreenShare:F,voiceDisabled:B}=Dae(),[q,$]=D.useState(e!==void 0?e:((Ee=window.agoraClient)==null?void 0:Ee.isVoiceEnabled)||!1),[Q,ae]=D.useState(V!==void 0?V:((Ie=window.agoraClient)==null?void 0:Ie.isScreenSharing)||!1),[re,fe]=D.useState(B!==void 0?B:!1),[Z,ee]=D.useState(!0);D.useEffect(()=>{var ve;e!==void 0?$(e):((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[e,d]),D.useEffect(()=>{var ve;V!==void 0?ae(V):((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)!==void 0&&ae(window.agoraClient.isScreenSharing)},[V]),D.useEffect(()=>{B!==void 0&&fe(B)},[B]);const ne=D.useRef({isVoiceEnabled:q,isScreenSharing:Q,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:E,voiceDisabled:re});D.useEffect(()=>{ne.current={isVoiceEnabled:q,isScreenSharing:Q,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:E,voiceDisabled:re}},[q,Q,i,a,l,f,_,E,re]),D.useEffect(()=>{const ve=setTimeout(()=>{ee(!1)},5e3);return()=>clearTimeout(ve)},[]),D.useEffect(()=>{f&&ee(!1)},[f]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:q,contextIsScreenSharing:V,localScreenSharing:Q,isJoined:i,users:a.length,error:l,isReady:f,channel:_,appId:E,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!L})},[e,q,V,Q,i,a,l,f,_,E,d,L]);const oe=async()=>{try{console.log("useVoiceChat: Toggling voice from:",q);const ve=await b();if(console.log("useVoiceChat: Toggle result:",ve),ve!==void 0)$(ve);else{const Be=!q;$(Be),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Be)}return ve!==void 0?ve:!q}catch(ve){return console.error("useVoiceChat: Error toggling voice:",ve),q}},ge=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",Q);const ve=await F();if(console.log("useVoiceChat: Screen share toggle result:",ve),ve!==void 0)ae(ve);else{const Be=!Q;ae(Be),window.agoraClient&&(window.agoraClient.isScreenSharing=Be)}return ve!==void 0?ve:!Q}catch(ve){return console.error("useVoiceChat: Error toggling screen share:",ve),Q}},pe=async()=>{q&&d&&await oe()},le=async()=>{!q&&d&&await oe()},Me=ve=>a.some(Be=>{var ke;return Be.uid===ve&&((ke=Be.audioTrack)==null?void 0:ke.isPlaying)}),He=D.useCallback(()=>{if(!d||!q)return 0;try{return d.getVolumeLevel()}catch(ve){return console.error("Error getting volume level:",ve),0}},[d,q]);return{isVoiceEnabled:q,isScreenSharing:Q,isJoined:i,users:a,error:l,toggleVoice:oe,toggleScreenShare:ge,mute:pe,unmute:le,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:L,isLoading:Z,channel:_,appId:E,joinChannel:w,leaveChannel:I,client:n,setMicrophoneDevice:async ve=>{try{if(!ve){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(q&&await n.unpublish(d),await d.close());const Be=await cR.createMicrophoneAudioTrack({microphoneId:ve,encoderConfig:"music_standard"});k&&await k(Be),q&&await n.publish(Be),console.log("Microphone device changed successfully")}catch(Be){throw console.error("Error changing microphone device:",Be),Be}},voiceDisabled:re}},m9e=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:_,joinChannel:E,channel:b,client:w,voiceDisabled:I}=f9e(),[k,V]=D.useState(!1),[L,F]=D.useState(!1);D.useEffect(()=>{const $=()=>{Te.log("VoiceButton: Player instantiated, showing button"),F(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(Te.log("VoiceButton: Player was already instantiated"),F(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:_,channel:b,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:L,voiceDisabled:I})},[d,_,b,w,L,I]);const B=async()=>{if(!(k||I)){V(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:_});try{if(!_&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(Q){Q.message&&Q.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",Q)}console.log("VoiceButton: Toggling voice state from:",d);const $=await f();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{V(!1)}}},q=()=>I?"Voice chat is disabled for this space":L?k?"Processing...":_?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!L||I?null:S.jsx(up,{label:q(),placement:e,hasArrow:!0,children:S.jsxs(qe,{position:"relative",cursor:"pointer",onClick:B,children:[S.jsx(Gu,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?S.jsx(xj,{color:"white"}):S.jsx(Dj,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),k&&S.jsx(qe,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:S.jsx(la,{size:"sm",color:"white"})})]})})},g9e=_r.createContext({user:null}),_9e=({userNickname:n})=>{const{client:e,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=Dae(),[f,_]=D.useState([]),[E,b]=D.useState(!1),[w,I]=D.useState(!0);D.useRef({});const k=D.useRef(null);D.useRef(null);const{user:V}=D.useContext(g9e)||{user:null},[L,F]=D.useState({}),B=D.useRef(a),[q,$]=D.useState(null),{isOpen:Q,onOpen:ae,onClose:re}=qd(),[fe,Z]=D.useState(!1),ee=D.useRef(null),ne=D.useRef(null);D.useEffect(()=>{B.current=a},[a]),D.useEffect(()=>{if(!e||!i){b(!1);return}const Me=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const He=e.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")b(!0),I(!1);else{b(!1);const tt=Ee=>{console.log("Connection state changed:",Ee),Ee==="CONNECTED"?(b(!0),I(!1)):b(!1)};return e.on("connection-state-change",tt),()=>{e.off("connection-state-change",tt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[e,i]),D.useEffect(()=>{const Me=async()=>{const He={...L};let tt=!1;for(const Ee of f){if(L[Ee.uid])continue;let Ie=null,ve=Ee.uid;if(typeof ve=="string"&&(ve.includes("-")?(Ie=ve.split("-")[0],ve=ve.split("-")[1]):ve.includes("_")&&(Ie=ve.split("_")[0],ve=ve.split("_")[1])),ve)try{console.log("Trying to fetch nickname for user ID:",ve);const Be=await yp(ve);Be&&Be.Nickname?(console.log("Found nickname in Firebase for user ID:",ve,"Nickname:",Be.Nickname),He[Ee.uid]=Be.Nickname,tt=!0):Ie?(console.log("Using extracted name for user ID:",ve,"Name:",Ie),He[Ee.uid]=Ie,tt=!0):(He[Ee.uid]="User",tt=!0)}catch(Be){console.error("Error fetching user profile:",Be),Ie?(He[Ee.uid]=Ie,tt=!0):(He[Ee.uid]="User",tt=!0)}else Ie?(He[Ee.uid]=Ie,tt=!0):(He[Ee.uid]="User",tt=!0)}tt&&F(He)};f.length>0&&Me()},[f,L]),D.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const Me=async(Ee,Ie)=>{if(console.log("User published:",Ee.uid,Ie,Ee),Ie==="video"){console.log("Remote video track detected:",Ee.uid);try{await e.subscribe(Ee,Ie),console.log("Subscribed to remote video track:",Ee.uid),_(ve=>ve.some(Be=>Be.uid===Ee.uid)?ve:[...ve,Ee])}catch(ve){console.error("Error subscribing to remote video track:",ve)}}},He=(Ee,Ie)=>{if(console.log("User unpublished:",Ee.uid,Ie),Ie==="video"){if(console.log("Remote video track unpublished:",Ee.uid),Ee.videoTrack)try{Ee.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(_(ve=>ve.filter(Be=>Be.uid!==Ee.uid)),l&&B.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),B.current.play(k.current)}catch(ve){console.error("Error replaying local screen track:",ve)}}},tt=Ee=>{console.log("User left:",Ee.uid);const Ie=f.find(ve=>ve.uid===Ee.uid);if(Ie&&Ie.videoTrack)try{Ie.videoTrack.stop()}catch(ve){console.error("Error stopping video track:",ve)}if(_(ve=>ve.filter(Be=>Be.uid!==Ee.uid)),l&&B.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user left"),B.current.play(k.current)}catch(ve){console.error("Error replaying local screen track:",ve)}};return e.on("user-published",Me),e.on("user-unpublished",He),e.on("user-left",tt),()=>{e.off("user-published",Me),e.off("user-unpublished",He),e.off("user-left",tt)}},[e,i,E,f,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&B.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),B.current.play(k.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[f,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&k.current)try{console.log("Playing local screen track"),a.play(k.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),D.useEffect(()=>()=>{if(f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[f,a]);const oe=()=>{console.log("Stopping local screen share"),d()},ge=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&V&&(Me===V.uid||Me===(e==null?void 0:e.uid))?n||"You":L[Me]?L[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),pe=Me=>{console.log("Opening modal for remote screen",Me),$(Me),ae()},le=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ae()};return D.useEffect(()=>{Q&&q?(console.log("Modal opened, activeScreen:",q),setTimeout(()=>{if(q.isLocal&&B.current)try{console.log("Playing local screen in modal"),B.current.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(q.videoTrack)try{console.log("Playing remote screen in modal"),q.videoTrack.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):Q||(Z(!1),$(null),setTimeout(()=>{if(l&&B.current)try{B.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[Q,q,l,f]),!E||w&&f.length===0&&!l||f.length===0&&!l?null:S.jsxs(S.Fragment,{children:[!Q&&S.jsxs(qe,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:ee,children:[l&&a&&S.jsxs(qe,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[S.jsx(qe,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),S.jsx(qe,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Me=>{const He=L[Me.uid]||ge(Me.uid);return S.jsxs(qe,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>pe(Me),children:[S.jsx(qe,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),S.jsx(qe,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),Q&&S.jsx(qe,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:re,children:S.jsxs(qe,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!fe&&S.jsxs(qe,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[S.jsx(la,{size:"xl"}),S.jsx(Qe,{mt:4,children:"Loading screen share..."})]}),S.jsx(qe,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:ne}),S.jsx(qe,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:re,children:""}),S.jsx(qe,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:q!=null&&q.isLocal?n?`${n}'s Screen`:"Your Screen":`${L[q==null?void 0:q.uid]||ge(q==null?void 0:q.uid)}'s Screen`}),(q==null?void 0:q.isLocal)&&S.jsx(qe,{position:"absolute",bottom:4,right:4,children:S.jsx(Zn,{colorScheme:"red",size:"sm",onClick:oe,children:"Stop Sharing"})})]})})]})},y9e=({onClose:n})=>{const e=ll(),[i,a]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const E=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};E();const b=setInterval(E,1e3),w=()=>{E()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}_()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,w)=>{a(!1),b?(d(w),e(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),a(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return S.jsx(Qe,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function E9e({open:n,onClose:e}){const[i,a]=D.useState(0);return S.jsxs(Ga,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(Ba,{backdropFilter:"blur(4px)"}),S.jsxs(Ha,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[S.jsx($l,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),S.jsx(fc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(Fa,{p:0,display:"flex",children:S.jsxs(wR,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[S.jsxs(CR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:Kze,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Movement"})]}),S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:qze,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Camera"})]}),S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:Hze,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Actions"})]}),S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:$ze,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Tips"})]})]}),S.jsxs(cN,{flexGrow:1,display:"flex",flexDirection:"column",children:[S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),S.jsxs(ar,{wrap:"wrap",gap:3,children:[S.jsx(xl,{keyLabel:"W",description:"Move Forward"}),S.jsx(xl,{keyLabel:"A",description:"Move Left"}),S.jsx(xl,{keyLabel:"S",description:"Move Backward"}),S.jsx(xl,{keyLabel:"D",description:"Move Right"}),S.jsx(xl,{keyLabel:"Shift",description:"Run"}),S.jsx(xl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),S.jsxs(ar,{wrap:"wrap",gap:3,children:[S.jsx(xl,{keyLabel:"Mouse",description:"Look Around"}),S.jsx(xl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),S.jsx(xl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),S.jsxs(ar,{wrap:"wrap",gap:3,children:[S.jsx(xl,{keyLabel:"E",description:"Interact"}),S.jsx(xl,{keyLabel:"F",description:"Emote Menu"}),S.jsx(xl,{keyLabel:"T",description:"Chat"}),S.jsx(xl,{keyLabel:"M",description:"Mute Mic"})]})]}),S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),S.jsxs(mr,{align:"stretch",spacing:2,children:[S.jsx(Qe,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),S.jsx(Qe,{fontSize:"xs",children:" Press ESC to access settings"}),S.jsx(Qe,{fontSize:"xs",children:" Click on players to view their profile"}),S.jsx(Qe,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const xl=({keyLabel:n,description:e})=>S.jsx(qe,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:S.jsxs(ni,{spacing:2,children:[S.jsx(qe,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),S.jsx(Qe,{fontSize:"xs",children:e})]})}),v9e=()=>{const[n,e]=D.useState([]),[i,a]=D.useState(""),[l,d]=D.useState(0),[f,_]=D.useState(100),[E,b]=D.useState(100),[w,I]=D.useState(!0),[k,V]=D.useState(!0),[L,F]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const re=await cR.getMicrophones();e(re),re.length>0&&a(re[0].deviceId)}catch(re){console.error("Error getting audio devices:",re)}})()},[]),D.useEffect(()=>{const ae=setInterval(()=>{d(L?Math.random()*50:0)},100);return()=>clearInterval(ae)},[L]);const B=ae=>{const re=ae.target.value;a(re),console.log("Microphone changed to:",re)},q=ae=>{_(ae),console.log("Microphone volume set to:",ae)},$=ae=>{b(ae),console.log("Speaker volume set to:",ae)},Q=()=>{F(!L)};return S.jsxs(mr,{spacing:6,align:"stretch",children:[S.jsxs(kn,{children:[S.jsxs(Qn,{children:["Microphone",S.jsx(Wd,{ml:2,colorScheme:L?"green":"red",children:L?"Enabled":"Muted"})]}),S.jsxs(Xre,{value:i,onChange:B,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ae=>S.jsx("option",{value:ae.deviceId,children:ae.label||`Microphone ${ae.deviceId.slice(0,5)}...`},ae.deviceId)),n.length===0&&S.jsx("option",{value:"",children:"No microphones found"})]})]}),S.jsxs(qe,{children:[S.jsx(Qe,{mb:2,children:"Microphone Level"}),S.jsx(N0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),S.jsxs(kn,{children:[S.jsxs(Qn,{children:["Microphone Volume: ",f,"%"]}),S.jsxs(YV,{value:f,onChange:q,min:0,max:100,step:1,colorScheme:"blue",children:[S.jsx(JV,{bg:"gray.700",children:S.jsx(QV,{})}),S.jsx(XV,{boxSize:6})]})]}),S.jsxs(kn,{children:[S.jsxs(Qn,{children:["Speaker Volume: ",E,"%"]}),S.jsxs(YV,{value:E,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[S.jsx(JV,{bg:"gray.700",children:S.jsx(QV,{})}),S.jsx(XV,{boxSize:6})]})]}),S.jsxs(kn,{display:"flex",alignItems:"center",children:[S.jsx(Qn,{mb:"0",children:"Microphone Enabled"}),S.jsx(Cg,{isChecked:L,onChange:Q,colorScheme:"green",size:"lg"})]}),S.jsxs(kn,{display:"flex",alignItems:"center",children:[S.jsx(Qn,{mb:"0",children:"Echo Cancellation"}),S.jsx(Cg,{isChecked:w,onChange:()=>I(!w),colorScheme:"green",size:"lg"})]}),S.jsxs(kn,{display:"flex",alignItems:"center",children:[S.jsx(Qn,{mb:"0",children:"Noise Suppression"}),S.jsx(Cg,{isChecked:k,onChange:()=>V(!k),colorScheme:"green",size:"lg"})]}),S.jsxs(Fu,{status:"info",borderRadius:"md",children:[S.jsx(Bu,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function S9e({open:n,onClose:e,containerRef:i}){return S.jsx(Kl,{containerRef:i,children:S.jsxs(Ga,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(Ba,{}),S.jsxs(Ha,{bg:"gray.900",color:"white",borderRadius:"lg",children:[S.jsx($l,{children:"Settings"}),S.jsx(fc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),S.jsx(Fa,{children:S.jsxs(wR,{variant:"enclosed",children:[S.jsxs(CR,{mb:4,children:[S.jsx(Ml,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),S.jsx(Ml,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),S.jsxs(cN,{children:[S.jsx(zd,{children:S.jsx(qe,{p:4,bg:"gray.800",borderRadius:"md",children:S.jsx(v9e,{})})}),S.jsx(zd,{children:S.jsx(qe,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function b9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function T9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function y0(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function w9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function C9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function R9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function I9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function CC(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function Mj(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function XQ(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function iO(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function A9e(n){return cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const P9e=({isOpen:n,onClose:e})=>{const{spaceID:i}=al(),[a,l]=D.useState(0),[d,f]=D.useState(null),[_,E]=D.useState(null),[b,w]=D.useState(!1),[I,k]=D.useState(0),[V,L]=D.useState(null),F=D.useRef(null),[B,q]=D.useState(null),[$,Q]=D.useState(null),[ae,re]=D.useState(!1),[fe,Z]=D.useState(0),[ee,ne]=D.useState(null),oe=D.useRef(null),[ge,pe]=D.useState([]),[le,Me]=D.useState([]),[He,tt]=D.useState(!1),[Ee,Ie]=D.useState(!1),[ve,Be]=D.useState(!0),[ke,Re]=D.useState(!1),he=ll();D.useEffect(()=>{n&&i&&Ue()},[n,i]);const we=async Ot=>{if(i&&n){tt(!0);try{const Lt=Soe(),Ce=`space_${i}_owners`,Ve=oR(Yf(Lt,"users"),Rk("groups","array-contains",Ce)),Ye=await zg(Ve),_t=[];for(const mn of Ye.docs){const Jt=mn.data(),Hn=await yp(mn.id);_t.push({uid:mn.id,email:Jt.email,displayName:Jt.displayName||Hn.Nickname||"Unknown User",photoURL:Jt.photoURL||Hn.photoURL,firstName:Hn.firstName,lastName:Hn.lastName})}pe(_t);const vt=`space_${i}_hosts`,St=oR(Yf(Lt,"users"),Rk("groups","array-contains",vt)),Ht=await zg(St),fn=[];for(const mn of Ht.docs){const Jt=mn.data(),Hn=await yp(mn.id);fn.push({uid:mn.id,email:Jt.email,displayName:Jt.displayName||Hn.Nickname||"Unknown User",photoURL:Jt.photoURL||Hn.photoURL,firstName:Hn.firstName,lastName:Hn.lastName})}Me(fn)}catch(Lt){Te.error("Error fetching space users:",Lt),he({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{tt(!1)}}},Ue=async()=>{try{const Ot=await Og(i);Ot.logoUrl&&L(Ot.logoUrl),Ot.backgroundUrl&&ne(Ot.backgroundUrl),Ot.voiceDisabled!==void 0&&Ie(Ot.voiceDisabled),Ot.accessibleToAllUsers!==void 0&&Be(Ot.accessibleToAllUsers),we(Ot)}catch(Ot){Te.error("Error fetching space data:",Ot),he({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{i&&n&&a===3&&we()},[i,n,a]);const Fe=Ot=>{const Lt=Ot.target.files[0];if(Lt){if(!Lt.type.startsWith("image/")){he({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}f(Lt);const Ce=new FileReader;Ce.onloadend=()=>{E(Ce.result)},Ce.readAsDataURL(Lt)}},$e=Ot=>{const Lt=Ot.target.files[0];if(Lt){if(!Lt.type.startsWith("image/")){he({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}q(Lt);const Ce=new FileReader;Ce.onloadend=()=>{Q(Ce.result)},Ce.readAsDataURL(Lt)}},ct=async()=>{if(!d){he({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{w(!0);const Ot=setInterval(()=>{k(Ce=>{const Ve=Ce+10;return Ve>=90?90:Ve})},300),Lt=await OWe(i,d);clearInterval(Ot),k(100),L(Lt),he({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{f(null),E(null),k(0),w(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Lt}}))}catch(Ot){console.error("Error uploading logo:",Ot),he({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),w(!1),k(0)}},it=async()=>{if(!B){he({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{re(!0);const Ot=setInterval(()=>{Z(Ce=>{const Ve=Ce+10;return Ve>=90?90:Ve})},300),Lt=await NWe(i,B);clearInterval(Ot),Z(100),ne(Lt),he({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{q(null),Q(null),Z(0),re(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Lt}}))}catch(Ot){console.error("Error uploading background:",Ot),he({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),re(!1),Z(0)}},Ct=async()=>{if(V)try{w(!0),await kWe(i),L(null),he({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),w(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ot){console.error("Error deleting logo:",Ot),he({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),w(!1)}},Vt=async()=>{if(ee)try{re(!0),await DWe(i),ne(null),he({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),re(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ot){console.error("Error deleting background:",Ot),he({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),re(!1)}},Dt=()=>{F.current&&F.current.click()},an=()=>{oe.current&&oe.current.click()},jn=async()=>{Re(!0);try{await xWe(i,{voiceDisabled:!Ee}),Ie(!Ee),he({title:"Settings Updated",description:`Voice chat has been ${Ee?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){Te.error("Error updating voice settings:",Ot),he({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1)}},Qt=async()=>{Re(!0);try{await LWe(i,!ve),Be(!ve),he({title:"Settings Updated",description:`Space is now ${ve?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){Te.error("Error updating accessibility settings:",Ot),he({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1)}};return S.jsxs(Ga,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(Ba,{backdropFilter:"blur(4px)"}),S.jsxs(Ha,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[S.jsx($l,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),S.jsx(fc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(Fa,{p:0,display:"flex",children:S.jsxs(wR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[S.jsxs(CR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:y0,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Logo"})]}),S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:T9e,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Background"})]}),S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:R9e,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Settings"})]}),S.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Dn,{as:XQ,mb:1}),S.jsx(Qe,{fontSize:"xs",children:"Users"})]})]}),S.jsxs(cN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),S.jsx(Qe,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(V||_)&&S.jsxs(ar,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[V&&S.jsxs(qe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),S.jsx(Va,{src:V,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(Zn,{mt:3,colorScheme:"red",leftIcon:S.jsx(Dn,{as:CC}),onClick:Ct,isLoading:b,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),_&&S.jsxs(qe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(Va,{src:_,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(kn,{children:[S.jsx(Qn,{fontSize:"xs",children:"Upload New Logo"}),S.jsx(or,{type:"file",accept:"image/*",onChange:Fe,ref:F,display:"none"}),b&&S.jsxs(qe,{mt:3,mb:3,children:[S.jsxs(Qe,{fontSize:"xs",mb:1,children:["Uploading... ",I,"%"]}),S.jsx(N0,{value:I,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(ni,{mt:3,spacing:3,children:[S.jsx(Zn,{colorScheme:"blue",leftIcon:S.jsx(Dn,{as:y0}),onClick:Dt,isDisabled:b,size:"sm",variant:"outline",children:"Browse"}),S.jsx(Zn,{colorScheme:"green",leftIcon:S.jsx(Dn,{as:Mj}),onClick:ct,isLoading:b,loadingText:"Uploading...",isDisabled:!d||b,size:"sm",children:"Upload"})]}),S.jsx(WC,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),S.jsx(Qe,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(ee||$)&&S.jsxs(ar,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ee&&S.jsxs(qe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),S.jsx(Va,{src:ee,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(Zn,{mt:3,colorScheme:"red",leftIcon:S.jsx(Dn,{as:CC}),onClick:Vt,isLoading:ae,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),$&&S.jsxs(qe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(Qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(Va,{src:$,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(kn,{children:[S.jsx(Qn,{fontSize:"xs",children:"Upload New Background"}),S.jsx(or,{type:"file",accept:"image/*",onChange:$e,ref:oe,display:"none"}),ae&&S.jsxs(qe,{mt:3,mb:3,children:[S.jsxs(Qe,{fontSize:"xs",mb:1,children:["Uploading... ",fe,"%"]}),S.jsx(N0,{value:fe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(ni,{mt:3,spacing:3,children:[S.jsx(Zn,{colorScheme:"blue",leftIcon:S.jsx(Dn,{as:y0}),onClick:an,isDisabled:ae,size:"sm",variant:"outline",children:"Browse"}),S.jsx(Zn,{colorScheme:"green",leftIcon:S.jsx(Dn,{as:Mj}),onClick:it,isLoading:ae,loadingText:"Uploading...",isDisabled:!B||ae,size:"sm",children:"Upload"})]}),S.jsx(WC,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),S.jsx(Qe,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),S.jsxs(mr,{spacing:4,align:"stretch",children:[S.jsx(qe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(ni,{justify:"space-between",align:"center",children:[S.jsxs(qe,{children:[S.jsxs(ni,{mb:1,spacing:2,children:[S.jsxs(qe,{position:"relative",w:"16px",h:"16px",children:[S.jsx(Dn,{as:A9e,color:Ee?"red.400":"green.400"}),Ee&&S.jsx(qe,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx(Qe,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),S.jsx(Qe,{fontSize:"xs",color:"whiteAlpha.800",children:Ee?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),S.jsx(Cg,{isChecked:!Ee,onChange:jn,colorScheme:"green",size:"md",isDisabled:ke})]})}),S.jsx(qe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(ni,{justify:"space-between",align:"center",children:[S.jsxs(qe,{children:[S.jsxs(ni,{mb:1,spacing:2,children:[S.jsx(qe,{position:"relative",w:"16px",h:"16px",children:S.jsx(Dn,{as:XQ,color:ve?"green.400":"red.400"})}),S.jsx(Qe,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),S.jsx(Qe,{fontSize:"xs",color:"whiteAlpha.800",children:ve?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),S.jsx(Qe,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),S.jsx(Cg,{isChecked:ve,onChange:Qt,colorScheme:"green",size:"md",isDisabled:ke})]})}),S.jsxs(Fu,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[S.jsx(Bu,{color:"blue.300"}),S.jsxs(qe,{children:[S.jsx(FC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),S.jsx(BC,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),S.jsxs(zd,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(Qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),S.jsx(Qe,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),He?S.jsx(ar,{justify:"center",align:"center",h:"200px",children:S.jsx(la,{color:"blue.300"})}):S.jsxs(mr,{spacing:4,align:"stretch",children:[S.jsxs(qe,{children:[S.jsxs(ni,{mb:2,children:[S.jsx(Dn,{as:b9e,color:"green.400"}),S.jsx(Qe,{fontSize:"sm",fontWeight:"600",children:"Owners"}),S.jsx(Wd,{colorScheme:"green",ml:2,children:ge.length})]}),S.jsx(qe,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ge.length===0?S.jsx(Qe,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):S.jsx(mr,{spacing:1,align:"stretch",children:ge.map(Ot=>S.jsxs(ni,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(Gu,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),S.jsxs(qe,{children:[S.jsx(Qe,{fontSize:"xs",children:Ot.displayName}),S.jsx(Qe,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),S.jsx(sk,{}),S.jsx(Wd,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ot.uid))})})]}),S.jsxs(qe,{children:[S.jsxs(ni,{mb:2,children:[S.jsx(Dn,{as:I9e,color:"purple.400"}),S.jsx(Qe,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),S.jsx(Wd,{colorScheme:"purple",ml:2,children:le.length})]}),S.jsx(qe,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:le.length===0?S.jsx(Qe,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):S.jsx(mr,{spacing:1,align:"stretch",children:le.map(Ot=>S.jsxs(ni,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(Gu,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),S.jsxs(qe,{children:[S.jsx(Qe,{fontSize:"xs",children:Ot.displayName}),S.jsx(Qe,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),S.jsx(sk,{}),S.jsx(Wd,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ot.uid))})})]}),S.jsx(uo,{borderColor:"whiteAlpha.200"}),S.jsxs(Fu,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[S.jsx(Bu,{color:"blue.300",boxSize:4}),S.jsxs(qe,{children:[S.jsx(FC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),S.jsx(BC,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},O9e=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Jd(),[a,l]=D.useState(!0),[d,f]=D.useState(!1),[_,E]=D.useState(!1),[b,w]=D.useState(!1),[I,k]=D.useState(!1),[V,L]=D.useState(!1),[F,B]=D.useState(null),[q,$]=D.useState(!1),[Q,ae]=D.useState(!1),[re,fe]=D.useState(!1),[Z,ee]=D.useState(!1),ne=ll(),{user:oe}=D.useContext(ul),ge=(oe==null?void 0:oe.Nickname)||"Unknown",[pe,le]=D.useState(!1),Me=async()=>{if(oe!=null&&oe.uid&&e)try{const Re=await yp(oe.uid);let he=!1,we=!1;if(Re.groups){const Fe=`space_${e}_owners`,$e=`space_${e}_hosts`;he=Re.groups.includes(Fe),we=Re.groups.includes($e)}const Ue=await Voe(oe.uid,"disruptiveAdmin");if(ee(Ue),B({rpmURL:Re.rpmURL?Re.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ae(he||Ue),fe(we),!he&&!Ue&&q){$(!1);const Fe=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Fe),ne({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(Re){console.error("Error fetching profile data:",Re),ae(!1),fe(!1),ee(!1)}else ae(!1),fe(!1),ee(!1)};D.useEffect(()=>{Me()},[oe==null?void 0:oe.uid,e,q]),D.useEffect(()=>{const Re=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Re),()=>{window.removeEventListener("PlayerInstantiated",Re)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&le(window.agoraClient.voiceDisabled)}catch(we){console.error("Error checking if voice is disabled:",we)}})();const he=we=>{we.detail&&typeof we.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",we.detail.voiceDisabled),le(we.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",he),()=>{window.removeEventListener("SpaceVoiceSettingChanged",he)}},[]);const He=()=>E(!_),tt=()=>w(!b),Ee=()=>{L(!V),Be()},Ie=()=>{k(!1),Me()},ve=Re=>{Re.stopPropagation(),typeof n=="function"&&(Te.log("CanvasMainMenu: Toggling player list"),n())},Be=()=>{f(!1)},ke=Re=>{if(Re.stopPropagation(),!Q){ne({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const he=!q;$(he);const we=new CustomEvent("editModeChanged",{detail:{enabled:he}});window.dispatchEvent(we),ne({title:he?"Edit Mode Enabled":"Edit Mode Disabled",description:he?"You can now make changes to the scene.":"Scene editing is now disabled.",status:he?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return S.jsxs(S.Fragment,{children:[S.jsxs(Zk,{isOpen:d,onClose:()=>f(!1),children:[S.jsx(eN,{as:Ys,icon:S.jsx(aae,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),S.jsx(Kl,{containerRef:i,children:S.jsx(tN,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:S.jsxs(mr,{align:"stretch",spacing:4,children:[S.jsxs(ni,{children:[S.jsx(Gu,{size:"md",src:F==null?void 0:F.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsxs(mr,{align:"start",spacing:0,children:[S.jsxs(ni,{children:[S.jsx(Qe,{fontWeight:"bold",children:ge}),Q&&!Z&&S.jsx(up,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:S.jsx(qe,{display:"inline-block",children:S.jsx(Dn,{as:Nj,color:"green.400",boxSize:3})})}),!Q&&re&&!Z&&S.jsx(up,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:S.jsx(qe,{display:"inline-block",children:S.jsx(Dn,{as:Lj,color:"purple.400",boxSize:3})})}),Z&&S.jsx(up,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:S.jsx(qe,{display:"inline-block",children:S.jsx(Dn,{as:Xze,color:"blue.400",boxSize:3})})})]}),S.jsx(Qe,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),S.jsxs(ni,{spacing:4,justify:"center",children:[S.jsx(Ys,{icon:S.jsx(Qze,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ve}),Q&&S.jsx(Ys,{icon:S.jsx(zze,{}),variant:"ghost",colorScheme:q?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:ke}),S.jsx(Ys,{icon:S.jsx(qe,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),S.jsx(Ys,{icon:S.jsx(qe,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),S.jsx(uo,{borderColor:"whiteAlpha.300"}),S.jsxs(mr,{align:"stretch",spacing:2,children:[Q&&S.jsxs(ni,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:Re=>Re.stopPropagation(),justify:"space-between",children:[S.jsx(Qe,{fontSize:"md",children:"Edit Mode"}),S.jsx(Cg,{id:"edit-mode-toggle",isChecked:q,onChange:ke,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:q?"green.500":"black"}}})]}),Q&&S.jsx(Qe,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Ee,children:"Manage Space"}),oe&&e&&!pe&&S.jsx(y9e,{onClose:Be}),S.jsx(Qe,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),S.jsx(Qe,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:tt,children:"Controls"}),S.jsx(Qe,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),S.jsx(Qe,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&S.jsx(E9e,{open:b,onClose:tt}),_&&S.jsx(S9e,{open:_,onClose:He}),I&&S.jsx(Iae,{open:I,onClose:Ie}),S.jsx(P9e,{isOpen:V,onClose:Ee})]})},k9e=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=al(),d=Jg(),f=ll(),_=D.useRef(null),E=D.useRef(null),b=D.useRef(),[w,I]=D.useState(null),[k,V]=D.useState(""),[L,F]=D.useState(!1),[B,q]=D.useState(0),[$,Q]=D.useState(null),[ae,re]=D.useState(!0),[fe,Z]=D.useState(!1),[ee,ne]=D.useState(!1),[oe,ge]=D.useState(0),[pe,le]=D.useState("image"),[Me,He]=D.useState(""),[tt,Ee]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&i&&l){re(!0);try{const Ct=await Df(l,i);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){Q(Ct);const Vt=Ct.mediaType==="video";le(Vt?"video":"image"),Ee(Ct.displayAsVideo||!1),Vt&&Ct.videoUrl&&(He(Ct.videoUrl),ge(1))}else Q(null)}catch(Ct){Te.error("Error fetching existing image:",Ct),Q(null)}finally{re(!1)}}})()},[n,i,l]),D.useEffect(()=>{n||(I(null),V(""),q(0),He(""))},[n]);const Ie=D.useCallback(it=>{it.preventDefault(),it.stopPropagation(),ne(!0)},[]),ve=D.useCallback(it=>{it.preventDefault(),it.stopPropagation(),ne(!1)},[]),Be=D.useCallback(it=>{it.preventDefault(),it.stopPropagation()},[]),ke=D.useCallback(it=>{if(it.preventDefault(),it.stopPropagation(),ne(!1),it.dataTransfer.files&&it.dataTransfer.files.length>0){const Ct=it.dataTransfer.files[0];Re(Ct)}},[]);D.useEffect(()=>{const it=E.current;if(it)return it.addEventListener("dragenter",Ie),it.addEventListener("dragleave",ve),it.addEventListener("dragover",Be),it.addEventListener("drop",ke),()=>{it.removeEventListener("dragenter",Ie),it.removeEventListener("dragleave",ve),it.removeEventListener("dragover",Be),it.removeEventListener("drop",ke)}},[Ie,ve,Be,ke]);const Re=it=>{if(!it)return;if(!it.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(it);const Ct=new FileReader;Ct.onloadend=()=>{V(Ct.result)},Ct.readAsDataURL(it)},he=it=>{const Ct=it.target.files[0];Re(Ct)},we=async it=>{const Ct=it.target.checked;if(Ee(Ct),$)try{await fze(l,i,Ct),Ct?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),Q({...$,displayAsVideo:Ct}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),Te.log(`Updated display mode for media screen ${i} to ${Ct?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:Ct})}catch(Vt){Te.error("Error updating display mode:",Vt),f({title:"Update failed",description:Vt.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Ee(!Ct)}},Ue=async()=>{if(pe==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(pe==="video"&&!Me){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const it=setInterval(()=>{q(an=>{const jn=an+10;return jn>=90?90:jn})},300);let Ct;pe==="image"?Ct=await MQ(l,i,w,{mediaType:pe,displayAsVideo:tt}):(Ct=Me,await MQ(l,i,null,{mediaType:"video",directUrl:Me,displayAsVideo:tt})),clearInterval(it),q(100);let Vt=null,Dt=null;pe==="image"?(Vt=tt?null:Ct,Dt=($==null?void 0:$.videoUrl)||null):(Vt=!tt&&($!=null&&$.imageUrl)?$.imageUrl:null,Dt=Ct),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:Vt,videoUrl:Dt,mediaType:pe,displayAsVideo:tt}),Te.log(`Uploaded and sent ${pe} for media screen ${i} (display as video: ${tt})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:pe==="image"?Ct:$==null?void 0:$.imageUrl,videoUrl:pe==="video"?Ct:$==null?void 0:$.videoUrl,mediaType:pe,displayAsVideo:tt}),f({title:"Upload successful",description:`The ${pe} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),V(""),F(!1),q(0),e()},1e3)}catch(it){Te.error(`Error uploading ${pe}:`,it),f({title:"Upload failed",description:it.message||`An error occurred while uploading the ${pe}`,status:"error",duration:5e3,isClosable:!0}),F(!1),q(0)}},Fe=async()=>{Z(!1);try{F(!0),await pze(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:pe==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:pe==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),Te.log(`Deleted ${pe} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),f({title:`${pe==="image"?"Image":"Video"} deleted`,description:`The ${pe} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),Q(null),F(!1),He(""),Ee(!1),setTimeout(()=>{e()},500)}catch(it){Te.error(`Error deleting ${pe}:`,it),f({title:"Deletion failed",description:it.message||`An error occurred while deleting the ${pe}`,status:"error",duration:5e3,isClosable:!0}),F(!1)}},$e=()=>{L||(I(null),V(""),q(0),e())},ct=it=>{ge(it),le(it===0?"image":"video")};return S.jsxs(S.Fragment,{children:[S.jsxs(Ga,{isOpen:n,onClose:$e,size:"xl",children:[S.jsx(Ba,{backdropFilter:"blur(10px)"}),S.jsxs(Ha,{bg:"gray.800",color:"white",maxW:"900px",children:[S.jsx($l,{children:"Media Screen Content"}),S.jsx(fc,{isDisabled:L}),S.jsxs(qe,{px:6,pb:2,children:[S.jsxs(ar,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[S.jsxs(ni,{spacing:4,children:[S.jsx(Qe,{fontWeight:"medium",children:"Display as:"}),S.jsxs(ni,{spacing:2,children:[S.jsx(Dn,{as:y0,color:tt?"gray.400":"green.300"}),S.jsx(Cg,{colorScheme:"purple",size:"md",isChecked:tt,onChange:we}),S.jsx(Dn,{as:iO,color:tt?"purple.300":"gray.400"})]})]}),S.jsx(Wd,{colorScheme:tt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:tt?"Video Output":"Image Output"})]}),S.jsxs(Qe,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",S.jsx("strong",{children:i})]}),S.jsx(Qe,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),S.jsx(uo,{mb:4})]}),S.jsx(Fa,{children:S.jsxs(ar,{children:[S.jsx(wR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:oe,onChange:ct,h:"100%",minW:"120px",mr:4,children:S.jsxs(CR,{children:[S.jsxs(Ml,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[S.jsx(Dn,{as:y0,mr:2})," Image"]}),S.jsxs(Ml,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[S.jsx(Dn,{as:iO,mr:2})," Video"]})]})}),S.jsx(qe,{flex:"1",children:ae?S.jsx(ar,{justify:"center",align:"center",h:"150px",children:S.jsx(la,{size:"xl",color:"blue.400"})}):S.jsxs(S.Fragment,{children:[S.jsx(qe,{children:oe===0?S.jsxs(mr,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&pe==="image"&&S.jsxs(qe,{children:[S.jsx(Qe,{fontWeight:"semibold",mb:2,children:"Current Image:"}),S.jsxs(ar,{children:[S.jsx(qe,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:S.jsx(Va,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),S.jsxs(mr,{align:"flex-start",spacing:2,children:[S.jsxs(Qe,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),S.jsxs(Qe,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),S.jsx(Zn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(Dn,{as:CC}),onClick:()=>Z(!0),isDisabled:L,children:"Delete"})]})]}),S.jsx(uo,{my:4})]}),S.jsx(Qe,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&pe==="image"?"Replace with new image:":"Upload new image:"}),S.jsxs(qe,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:ee?"blue.400":"gray.500",bg:ee?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[k?S.jsx(qe,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:S.jsx(Va,{src:k,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):S.jsxs(mr,{spacing:2,children:[S.jsx(Dn,{as:Mj,boxSize:"24px",color:"gray.400"}),S.jsx(Qe,{children:"Drag and drop an image here, or click to browse"}),S.jsx(Qe,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),S.jsx(or,{type:"file",accept:"image/*",onChange:he,ref:_,display:"none"})]}),w&&S.jsxs(Qe,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):S.jsxs(mr,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&pe==="video"&&S.jsxs(qe,{children:[S.jsx(Qe,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),S.jsxs(ar,{children:[S.jsx(qe,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:S.jsx(Qe,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),S.jsxs(mr,{align:"flex-start",spacing:2,children:[S.jsxs(Qe,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),S.jsxs(Qe,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),S.jsx(Zn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(Dn,{as:CC}),onClick:()=>Z(!0),isDisabled:L,children:"Delete"})]})]}),S.jsx(uo,{my:4})]}),S.jsx(Qe,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&pe==="video"?"Replace with new video:":"Add video URL:"}),S.jsx(qe,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:S.jsxs(ni,{children:[S.jsx(Dn,{as:w9e,color:"blue.300"}),S.jsx(Qe,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),S.jsxs(kn,{children:[S.jsx(Qn,{fontSize:"sm",children:"Video URL"}),S.jsx(or,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:it=>He(it.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),S.jsx(Qe,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),S.jsxs(qe,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[S.jsxs(ni,{children:[S.jsx(Dn,{as:iO,color:"blue.300"}),S.jsx(Qe,{fontWeight:"medium",children:"Video Support"})]}),S.jsx(Qe,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),S.jsx(Qe,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&S.jsxs(qe,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[S.jsxs(ni,{mb:2,children:[S.jsx(Dn,{as:C9e,color:"blue.300"}),S.jsx(Qe,{fontWeight:"medium",children:"URL Preview"})]}),S.jsx(Qe,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),S.jsx(Qe,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),L&&S.jsxs(qe,{mt:4,children:[S.jsxs(Qe,{mb:2,children:["Uploading: ",B,"%"]}),S.jsx(N0,{value:B,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),S.jsxs(Yy,{children:[S.jsx(Zn,{variant:"ghost",mr:3,onClick:$e,isDisabled:L,children:"Cancel"}),S.jsx(Zn,{colorScheme:"blue",onClick:Ue,isLoading:L,loadingText:"Uploading",isDisabled:pe==="image"&&!w||pe==="video"&&!Me||L||ae,leftIcon:S.jsx(Dn,{as:pe==="image"?y0:iO}),size:"lg",px:6,children:pe==="image"?"Upload Image":"Save Video URL"})]})]})]}),S.jsx(jUe,{isOpen:fe,leastDestructiveRef:b,onClose:()=>Z(!1),children:S.jsx(Ba,{children:S.jsxs(FUe,{bg:"gray.800",color:"white",children:[S.jsxs($l,{fontSize:"lg",fontWeight:"bold",children:["Delete ",pe==="video"?"Video":"Image"]}),S.jsxs(Fa,{children:["Are you sure you want to delete this ",pe,"? This will revert the media screen to its blank state."]}),S.jsxs(Yy,{children:[S.jsx(Zn,{ref:b,onClick:()=>Z(!1),children:"Cancel"}),S.jsx(Zn,{colorScheme:"red",onClick:Fe,ml:3,leftIcon:S.jsx(Dn,{as:CC}),children:"Delete"})]})]})})})]})},N9e=n=>{const[e,i]=D.useState(null),[a,l]=D.useState(""),[d,f]=D.useState(null),[_,E]=D.useState(!1),b=em(),{spaceID:w}=al(),I=D.useCallback(L=>{var F,B;try{if(!L)return null;if(L.includes("youtube.com")||L.includes("youtu.be")){let q="";return L.includes("youtube.com/watch")?q=new URLSearchParams(new URL(L).search).get("v"):L.includes("youtu.be/")&&(q=L.split("youtu.be/")[1].split("?")[0]),q?`https://www.youtube.com/embed/${q}?autoplay=1`:L}if(L.includes("vimeo.com")){if(L.includes("player.vimeo.com/video"))return L;const q=(B=(F=L.split("vimeo.com/")[1])==null?void 0:F.split("?")[0])==null?void 0:B.split("/")[0];return q?`https://player.vimeo.com/video/${q}?autoplay=1`:L}return L}catch(q){return Te.error("Error converting to embed URL:",q),L}},[]),k=D.useCallback(()=>{setTimeout(()=>{E(!1),Te.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let L=!0,F=null;const q=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:Q,videoUrl:ae}=$||{};if(!Q){Te.error("Media screen ID is missing in Unity event data."),k();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${Q}, setting ID but not playing video`),Te.log("Edit mode is active, setting media screen ID but not playing video"),f(Q);return}if(E(!0),F=setTimeout(()=>{L&&(Te.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),ae){if(console.log(`Using direct video URL from event: ${ae}`),L)try{const re=I(ae);console.log(`Setting video URL to: ${re} (original: ${ae})`),i(re),l(`Media Screen ${Q}`),f(Q),Te.log("Media screen video URL set directly from event:",re)}catch(re){Te.error("Error setting video URL from direct URL:",re)}finally{k(),clearTimeout(F)}return}console.log(`Fetching media screen data for ID: ${Q}`);try{const re=await Df(w,Q);if(console.log("Media screen data from Firestore:",re),!re||!re.videoUrl){Te.error("No video URL found for media screen:",Q),k(),clearTimeout(F);return}if(!re.displayAsVideo){Te.log("Media screen is not set to display as video:",Q),console.log("displayAsVideo flag is false for this media screen"),k(),clearTimeout(F);return}if(L)try{const fe=I(re.videoUrl);console.log(`Setting video URL to: ${fe} (original: ${re.videoUrl})`),i(fe),l(re.title||`Media Screen ${Q}`),f(Q),Te.log("Media screen video URL set to:",fe)}catch(fe){Te.error("Error setting video URL from Firestore:",fe)}finally{k(),clearTimeout(F)}}catch(re){Te.error(`Error fetching media screen data for ${Q}:`,re),k(),clearTimeout(F)}}catch(Q){Te.error("Error handling media screen video play:",Q),console.error("Error handling media screen video play:",Q),k(),clearTimeout(F)}});return()=>{L=!1,F&&clearTimeout(F),q()}},[b,w,n,I,k]);const V=D.useCallback(()=>{i(null),l(""),f(null),E(!1),Te.log("Video player state reset")},[]);return[e,a,d,V,_]},D9e=()=>{const{spaceID:n}=al(),e=Jg(),i=em(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Te.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{Te.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await _(b):"https://via.placeholder.com/640x360?text=Video"}catch(w){return Te.error(`Error fetching thumbnail for ${b}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const k=await I.json(),V=k.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let F=null;for(let B of L){const q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${V}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(q,{method:"HEAD"})).ok){F=q;break}}catch($){Te.warn(`Failed to validate thumbnail URL: ${q}`,$)}}return F||k.thumbnail_url}catch(w){return Te.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async b=>{let w="";if(b.includes("youtube.com/watch")?w=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(w=b.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(k){Te.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,k)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},E=D.useCallback(async b=>{try{if(!n||!b)return;Te.log(`Refreshing thumbnail for media screen ${b}`);const w=await Df(n,b);if(!w){Te.log(`No media screen found with ID ${b}`);return}if(Te.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){Te.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(w.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),Te.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(w){Te.error(`Error refreshing thumbnail for media screen ${b}:`,w)}},[n,d,e]);D.useEffect(()=>{if(!a){Te.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}Te.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:k,thumbnailUrl:V}=I;V==="refresh"&&k&&(console.log(`Received request to refresh thumbnail for media screen ${k}`),await E(k))}catch(k){console.error("Error handling SetMediaScreenThumbnail event:",k)}});return()=>{w()}},[i,E,a]),D.useEffect(()=>{if(!a){Te.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}Te.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");Te.log("Fetching media screens for thumbnails...");const I=await C3(n);Te.log("All media screens:",I);const k=I.filter(F=>F.displayAsVideo&&F.videoUrl);if(Te.log("Media screens set to display as videos:",k),k.length===0){Te.log("No media screens set to display as videos found.");return}Te.log(`Found ${k.length} media screens set to display as videos.`);const V=k.map(async F=>{try{const B=await d(F.videoUrl);return Te.log(`Fetched thumbnail for ${F.id}: ${B}`),{mediaScreenId:F.id,thumbnailUrl:B}}catch(B){return Te.error(`Error processing thumbnail for media screen ${F.id}:`,B),{mediaScreenId:F.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),L=await Promise.all(V);Te.log("Fetched Media Screen Thumbnails",L),L.forEach(({mediaScreenId:F,thumbnailUrl:B})=>{e("SetMediaScreenThumbnail",{mediaScreenId:F,thumbnailUrl:B}),Te.log(`Sent thumbnail to Unity for media screen ${F}: ${B}`)})}catch(I){Te.error("Error fetching media screen thumbnails:",I)}};b();const w=setInterval(b,5*60*1e3);return()=>{clearInterval(w)}},[e,n,d,a])},JQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},x9e=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),L9e=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Jd();return VN(a,`video-modal-${i}`),D.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),S.jsxs(S.Fragment,{children:[S.jsx(x9e,{}),S.jsxs(Ga,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[S.jsx(Ba,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),S.jsxs(Ha,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[S.jsx(fc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Fa,{p:0,width:"100%",children:n?S.jsx(qe,{className:"iframe-container",style:JQ.iframeContainer,children:S.jsx("iframe",{className:"video-iframe",src:n,style:JQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):S.jsxs(ar,{direction:"column",align:"center",justify:"center",h:"400px",children:[S.jsx(la,{size:"xl",mb:4}),S.jsx(Qe,{children:"Unable to load video"}),S.jsx(Qe,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},xs=(...n)=>{},M9e=()=>{const{isOpen:n,onOpen:e,onClose:i}=qd(),[a,l]=D.useState(null),[d,f]=D.useState("image"),_=D.useRef(null);VN(n,"image-viewer-modal");const E=D.useCallback(I=>{I.stopPropagation()},[]);return D.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const k=document.getElementById("unity-canvas");return k&&(k.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),k&&(k.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,k="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${k}`);const V=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),L=V?"image":k;console.log(`[DEBUG] Detected URL as ${V?"image":"non-image"}, using media type: ${L}`),l(I),f(L),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:_,preventPropagation:E}},U9e=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),HU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),xs(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},V9e=()=>{const{spaceID:n}=al(),[e,i]=D.useState(!1),[a,l]=D.useState([]),[d,f]=D.useState(null),{isOpen:_,onOpen:E,onClose:b}=qd(),[w,I]=D.useState({}),[k,V]=D.useState(0);D.useRef(null);const L=Jg(),{fullscreenRef:F}=Jd(),B=em(),[q,$]=D.useState(!1),{isOpen:Q,currentImageUrl:ae,currentMediaType:re,openImageViewer:fe,closeImageViewer:Z,modalContentRef:ee,preventPropagation:ne}=M9e(),[oe,ge,pe,le,Me]=N9e(e),{isOpen:He,onOpen:tt,onClose:Ee}=qd();D9e(),hae(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const Re=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",Re),()=>{window.removeEventListener("PlayerInstantiated",Re)}},[]);const Ie=D.useCallback(Re=>{if(Array.isArray(a)&&a.length>0){const he=a.find(we=>we.mediaScreenId===Re);if(he){const we=he.imageUrl,Ue=he.videoUrl;return{screen:he,imageUrl:we,videoUrl:Ue,mediaType:he.mediaType||"image",displayAsVideo:he.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ae){let he=null;return Array.isArray(a)&&(he=a.find(we=>we.mediaScreenId===Re)),{screen:he||{mediaScreenId:Re},imageUrl:ae,videoUrl:null,mediaType:(he==null?void 0:he.mediaType)||"image",displayAsVideo:(he==null?void 0:he.displayAsVideo)||!1}}return n&&Re&&Df(n,Re).then(he=>{he&&l(we=>Array.isArray(we)&&we.some(Fe=>Fe.mediaScreenId===Re)?we.map(Fe=>Fe.mediaScreenId===Re?{...Fe,imageUrl:he.imageUrl,videoUrl:he.videoUrl,mediaType:he.mediaType||"image",displayAsVideo:he.displayAsVideo||!1,hasImage:!!he.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Fe):[...Array.isArray(we)?we:[],{mediaScreenId:Re,imageUrl:he.imageUrl,videoUrl:he.videoUrl,mediaType:he.mediaType||"image",displayAsVideo:he.displayAsVideo||!1,hasImage:!!he.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(he=>{console.error(`Error fetching media screen data for ${Re}:`,he)}),console.warn("No screen data found for:",Re),null},[a,ae,n,l]),ve=D.useCallback(Re=>{if(console.log(`[DEBUG] Processing click on screen: ${Re}, isEditMode: ${e}`),f(Re),e)console.log(`[DEBUG] Opening upload modal for screen: ${Re} in edit mode`),E();else{const he=Ie(Re);if(he){if(console.log(`[DEBUG] Screen data for ${Re}:`,he),xs("Screen data details:",{mediaScreenId:Re,imageUrl:he.imageUrl,videoUrl:he.videoUrl,mediaType:he.mediaType,displayAsVideo:he.displayAsVideo}),He&&pe===Re)return;if(he.displayAsVideo&&he.videoUrl)xs(`Opening video player for: ${he.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:Re,videoUrl:he.videoUrl});else if(he.imageUrl){xs(`Opening viewer modal with ${he.mediaType}: ${he.imageUrl}`);const Ue=HU(he.imageUrl);fe(Ue,he.mediaType||"image")}else n&&Df(n,Re).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)xs(`Opening video player for: ${Ue.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:Re,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){xs(`Opening viewer modal with image: ${Ue.imageUrl}`);const Fe=HU(Ue.imageUrl);fe(Fe,Ue.mediaType||"image")}l(Fe=>Array.isArray(Fe)&&Fe.some(ct=>ct.mediaScreenId===Re)?Fe.map(ct=>ct.mediaScreenId===Re?{...ct,...Ue,mediaScreenId:Re,source:"firestore-click",lastUpdated:new Date().toISOString()}:ct):[...Array.isArray(Fe)?Fe:[],{...Ue,mediaScreenId:Re,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${Re}:`,Ue)})}else n&&Df(n,Re).then(we=>{if(we){if(we.displayAsVideo&&we.videoUrl)xs(`Opening video player for: ${we.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:Re,videoUrl:we.videoUrl});else if(we.imageUrl){xs(`Opening viewer modal with image: ${we.imageUrl}`);const Ue=HU(we.imageUrl);fe(Ue,we.mediaType||"image")}l(Ue=>Array.isArray(Ue)&&Ue.some($e=>$e.mediaScreenId===Re)?Ue.map($e=>$e.mediaScreenId===Re?{...$e,...we,mediaScreenId:Re,source:"firestore-click",lastUpdated:new Date().toISOString()}:$e):[...Array.isArray(Ue)?Ue:[],{...we,mediaScreenId:Re,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(we=>{console.error(`Error fetching media screen data for ${Re}:`,we)})}},[e,E,Ie,He,pe,L,fe,n]);D.useEffect(()=>{if(!q)return;const Re=async()=>{if(n)try{const we=await C3(n),Ue={};we.forEach(Fe=>{Fe.id&&Fe.imageUrl&&(Ue[Fe.id]=Fe.imageUrl)}),l(Fe=>Fe.map($e=>{const ct=!!Ue[$e.mediaScreenId],it=Ue[$e.mediaScreenId],Ct=$e.mediaType||"image";return{...$e,hasImage:ct,imageUrl:it,mediaType:Ct}}))}catch(we){console.error("Error fetching media screen images:",we)}};Re();let he=null;return e&&(he=setInterval(Re,5e3)),()=>{he&&clearInterval(he)}},[n,e,k,q]);const Be=Re=>{l(he=>he.map(we=>{if(we.mediaScreenId===Re.mediaScreenId){if(Re.type==="upload")return{...we,hasImage:!0,imageUrl:Re.imageUrl,mediaType:Re.mediaType||"image"};if(Re.type==="delete")return{...we,hasImage:!1,imageUrl:null,mediaType:null}}return we})),Re.type==="delete"?(setTimeout(()=>{l(he=>he.filter(we=>we.mediaScreenId!==Re.mediaScreenId))},100),setTimeout(()=>{l(he=>he.filter(we=>we.mediaScreenId!==Re.mediaScreenId))},1500)):setTimeout(()=>{l(he=>he.some(Ue=>Ue.mediaScreenId===Re.mediaScreenId)?he.map(Ue=>Ue.mediaScreenId===Re.mediaScreenId?{...Ue,imageUrl:Re.imageUrl,hasImage:!0,mediaType:Re.mediaType||"image"}:Ue):[...he,{mediaScreenId:Re.mediaScreenId,imageUrl:Re.imageUrl,hasImage:!0,mediaType:Re.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const Re=he=>{const we=he.detail.enabled;i(we),we?L("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):L("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Re),()=>{window.removeEventListener("editModeChanged",Re)}},[L]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(Re){console.log("Unity: MediaScreenClick received with data:",Re);try{const he=JSON.parse(Re),we=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(he)});window.dispatchEvent(we)}catch(he){console.error("Error processing MediaScreenClick data:",he)}},window.handleMediaScreenClick=function(Re){console.log("Direct call to handleMediaScreenClick with ID:",Re),ve(Re)},window.TestJavaScriptFromUnity=function(Re){console.log("Unity called TestJavaScriptFromUnity with:",Re),alert("Unity called JavaScript: "+Re)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ve]),D.useEffect(()=>{const Re=Ue=>{try{const Fe=JSON.parse(Ue.detail);Te.log(`MediaScreen registered: ${Fe.mediaScreenId}`),xs("MediaScreen registered from Unity:",Fe),l(ct=>ct.some(Ct=>Ct.mediaScreenId===Fe.mediaScreenId)?ct.map(Ct=>Ct.mediaScreenId===Fe.mediaScreenId?{...Ct,...Fe,source:"event",lastUpdated:new Date().toISOString()}:Ct):[...ct,{...Fe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&L("SetMediaScreenEditMode",{mediaScreenId:Fe.mediaScreenId,enabled:!0,showUploadIcon:!0});const $e=Fe.mediaScreenId;$e&&Df(n,$e).then(ct=>{ct&&(xs(`Media screen data for ${$e}:`,ct),ct.displayAsVideo&&ct.videoUrl&&(xs(`Media screen ${$e} should display as video, sending null imageUrl`),L("SetMediaScreenImage",{mediaScreenId:$e,imageUrl:null,displayAsVideo:!0})))}).catch(ct=>{console.error(`Error fetching media screen data for ${$e}:`,ct)})}catch(Fe){console.error("Error handling MediaScreen registration:",Fe)}},he=Ue=>{try{xs("MediaScreenClick event received:",Ue);let Fe;if(typeof Ue=="string")Fe=Ue,xs("MediaScreenClick: Direct call with ID:",Fe);else{xs("MediaScreenClick: Event from Unity:",Ue),xs("MediaScreenClick: Event detail:",Ue.detail);try{Fe=JSON.parse(Ue.detail).mediaScreenId,xs("MediaScreenClick: Parsed mediaScreenId:",Fe)}catch($e){if(console.error("MediaScreenClick: Error parsing event detail:",$e),Ue.detail&&Ue.detail.mediaScreenId)Fe=Ue.detail.mediaScreenId,xs("MediaScreenClick: Using direct mediaScreenId from detail:",Fe);else throw new Error("Could not extract mediaScreenId from event")}}Te.log(`MediaScreen clicked: ${Fe}`),xs("MediaScreen clicked:",Fe),ve(Fe)}catch(Fe){console.error("Error handling MediaScreen click:",Fe)}},we=Ue=>{if(Ue.detail&&Ue.detail.eventName==="RegisterMediaScreen")Re({detail:Ue.detail.eventData});else if(Ue.detail&&Ue.detail.eventName==="MediaScreenClick")he({detail:Ue.detail.eventData});else if(Ue.detail&&Ue.detail.eventName==="SetMediaScreenImage")try{const Fe=JSON.parse(Ue.detail.eventData);Fe.mediaScreenId&&(xs("SetMediaScreenImage event received:",Fe),l($e=>Array.isArray($e)&&$e.some(it=>it.mediaScreenId===Fe.mediaScreenId)?$e.map(it=>it.mediaScreenId===Fe.mediaScreenId?{...it,imageUrl:Fe.imageUrl,hasImage:!!Fe.imageUrl,displayAsVideo:Fe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:it):[...Array.isArray($e)?$e:[],{mediaScreenId:Fe.mediaScreenId,imageUrl:Fe.imageUrl,hasImage:!!Fe.imageUrl,displayAsVideo:Fe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Fe){console.error("Error handling SetMediaScreenImage event:",Fe)}};return window.addEventListener("RegisterMediaScreen",Re),window.addEventListener("MediaScreenClick",he),window.addEventListener("reactUnityEvent",we),()=>{window.removeEventListener("RegisterMediaScreen",Re),window.removeEventListener("MediaScreenClick",he),window.removeEventListener("reactUnityEvent",we)}},[e,E,L,a,Q,He,fe,ve,n]),D.useEffect(()=>{const Re=he=>{try{xs("Direct MediaScreenClick event received:",he);let we;if(he.detail)try{we=JSON.parse(he.detail).mediaScreenId}catch(Ue){console.error("Error parsing MediaScreenClick event detail:",Ue);return}if(!we){console.error("No mediaScreenId found in MediaScreenClick event");return}xs(`Direct handler: Processing click for media screen ${we}`),ve(we)}catch(we){console.error("Error in direct MediaScreenClick handler:",we)}};return window.addEventListener("MediaScreenClick",Re),()=>{window.removeEventListener("MediaScreenClick",Re)}},[ve]),D.useEffect(()=>{oe&&tt()},[oe,tt]);const ke=()=>{le(),Ee()};return D.useEffect(()=>{const he=B("RegisterMediaScreen",we=>{try{if(Te.log("Direct RegisterMediaScreen event received with data:",we),!we||!we.mediaScreenId){Te.warn("RegisterMediaScreen event received with invalid data");return}const Ue=we.mediaScreenId;Te.log(`Media screen registered directly: ${Ue}`),l(Fe=>Fe.some(ct=>ct.mediaScreenId===Ue)?Fe.map(ct=>ct.mediaScreenId===Ue?{...ct,...we,source:"direct-event",lastUpdated:new Date().toISOString()}:ct):[...Fe,{...we,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&L("SetMediaScreenEditMode",{mediaScreenId:Ue,enabled:!0,showUploadIcon:!0})}catch(Ue){console.error("Error handling direct RegisterMediaScreen event:",Ue)}});return()=>{he()}},[B,e,L]),D.useEffect(()=>{const he=B("MediaScreenClick",we=>{try{if(Te.log("Direct MediaScreenClick event received with data:",we),!we||!we.mediaScreenId){Te.warn("MediaScreenClick event received with invalid data");return}const Ue=we.mediaScreenId;Te.log(`Media screen clicked directly: ${Ue}`),ve(Ue)}catch(Ue){console.error("Error handling direct MediaScreenClick event:",Ue)}});return()=>{he()}},[B,ve]),D.useEffect(()=>{e&&pe&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${pe}`),f(pe),E(),le())},[e,pe,E,le]),S.jsxs(S.Fragment,{children:[S.jsx(k9e,{isOpen:_,onClose:b,mediaScreenId:d,onImageChange:Be}),S.jsx(U9e,{}),S.jsx(Kl,{containerRef:F,children:S.jsxs(Ga,{isOpen:Q,onClose:Z,size:"lg",isCentered:!0,portalProps:{containerRef:F},id:"image-viewer-modal",blockScrollOnMount:!0,children:[S.jsx(Ba,{bg:"rgba(0, 0, 0, 0.8)",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne}),S.jsxs(Ha,{ref:ee,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[S.jsx(fc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Fa,{p:0,width:"100%",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:ae?S.jsx(qe,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:re==="image"?S.jsx(Va,{src:ae,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ae),onError:Re=>console.error("Error loading image:",Re,ae),onClick:ne}):S.jsxs(qe,{width:"100%",textAlign:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[S.jsx(Qe,{mb:4,fontSize:"lg",children:"Video URL:"}),S.jsx(Qe,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ae}),S.jsx(Qe,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):S.jsx(ar,{direction:"column",align:"center",justify:"center",h:"400px",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:S.jsx(Qe,{children:"No image available"})})})]})]})}),S.jsx(L9e,{videoUrl:oe,videoTitle:ge,mediaScreenId:pe,isOpen:He,onClose:ke})]})},xae=({backgroundUrl:n=null,containerRef:e})=>{const[i,a]=D.useState(!1),[l,d]=D.useState(n),f=D.useRef(null),_=D.useRef(null);return D.useEffect(()=>{const E=b=>{const{backgroundUrl:w}=b.detail;d(w),f.current&&(w?(f.current.style.backgroundImage=`url('${w}')`,f.current.style.display="block",_.current&&(_.current.style.display="block")):(f.current.style.display="none",_.current&&(_.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",E),()=>{window.removeEventListener("SpaceBackgroundUpdated",E)}},[]),D.useEffect(()=>{d(n),f.current&&n!==l&&(f.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!e||!e.current)return;const E=document.createElement("div");f.current=E,Object.assign(E.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");_.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),e.current.appendChild(E),e.current.appendChild(b);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),E.style.opacity="0",b.style.opacity="0",setTimeout(()=>{e.current&&e.current.contains(E)&&e.current.removeChild(E),e.current&&e.current.contains(b)&&e.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{$d.subscribe(Hd.playerInstantiated,w);const I=()=>w();window.addEventListener("PlayerInstantiated",I);const k=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{$d.unsubscribe(Hd.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",I),clearTimeout(k),e.current&&e.current.contains(E)&&e.current.removeChild(E),e.current&&e.current.contains(b)&&e.current.removeChild(b)}}},[l,e]),null};xae.propTypes={backgroundUrl:Hr.string,containerRef:Hr.shape({current:Hr.instanceOf(Element)})};const Lae=({containerRef:n})=>{const{spaceID:e}=al(),[i,a]=D.useState(!1),[l,d]=D.useState(!1),[f,_]=D.useState(0),[E,b]=D.useState("Initialising World"),[w,I]=D.useState(null),k=D.useRef(null),V=D.useRef(null),L=D.useRef(null),F=D.useRef(null);D.useEffect(()=>(Te.log("PersistentLoader: Component mounted with spaceID:",e),Te.log("PersistentLoader: Container ref:",n),()=>{Te.log("PersistentLoader: Component unmounting")}),[]);const{error:B}=al(),[q,$]=D.useState(!1);return D.useEffect(()=>{B&&(Te.error("PersistentLoader: Unity error detected:",B),$(!0),setTimeout(()=>{if(k.current){const Q=k.current.querySelector("div:first-child");Q&&(Q.textContent="Reconnecting...")}},3e3))},[B]),D.useEffect(()=>{(async()=>{if(e){Te.log(`PersistentLoader: Fetching logo for space ${e}`);try{const ae=await Og(e);ae&&ae.logoUrl?(Te.log(`PersistentLoader: Found logo URL: ${ae.logoUrl}`),I(ae.logoUrl)):Te.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(ae){Te.error("PersistentLoader: Error fetching space logo:",ae)}}else Te.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),D.useEffect(()=>{const Q=ae=>{const{logoUrl:re}=ae.detail;Te.log(`PersistentLoader: Logo update event received with URL: ${re}`),I(re),V.current?re?(Te.log("PersistentLoader: Updating logo element with new URL"),V.current.src=re,L.current.style.display="flex"):(Te.log("PersistentLoader: Hiding logo element (no URL)"),L.current.style.display="none"):Te.warn("PersistentLoader: Logo ref is null during update")};return Te.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",Q),()=>{Te.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",Q)}},[]),D.useEffect(()=>{if(!n||!n.current){Te.error("PersistentLoader: Container ref is null or has no current property");return}Te.log("PersistentLoader: Creating loader elements");const Q=document.createElement("div");if(k.current=Q,Object.assign(Q.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){Te.log(`PersistentLoader: Creating logo element with URL: ${w}`);const He=document.createElement("div");L.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const tt=document.createElement("img");V.current=tt,tt.src=w,tt.alt="Space Logo",tt.style.maxHeight="100px",tt.style.maxWidth="100%",tt.style.objectFit="contain",tt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(tt),n.current.appendChild(He),Te.log("PersistentLoader: Logo container added to main container")}else Te.log("PersistentLoader: No logo URL available, skipping logo creation");const ae=document.createElement("style");ae.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(ae),Te.log("PersistentLoader: Animation styles added to document head");const re=document.createElement("div");re.style.fontSize="16px",re.style.fontWeight="bold",re.style.textAlign="center",re.style.marginBottom="16px",re.style.color="#ffffff",re.textContent="Initialising World";const fe=document.createElement("div");fe.style.width="100%",fe.style.height="12px",fe.style.backgroundColor="rgba(255, 255, 255, 0.2)",fe.style.borderRadius="6px",fe.style.overflow="hidden",fe.style.position="relative",fe.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const Z=document.createElement("div");Z.style.height="100%",Z.style.width="0%",Z.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",Z.style.backgroundSize="200% 200%",Z.style.animation="progress-glow 2s ease infinite",Z.style.transition="width 0.5s ease-out",Z.style.borderRadius="6px",Z.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",fe.appendChild(Z);const ee=document.createElement("div");ee.style.marginTop="8px",ee.style.fontSize="14px",ee.style.fontWeight="bold",ee.style.color="#ffffff",ee.textContent="0%",Q.appendChild(re),Q.appendChild(fe),Q.appendChild(ee),n.current.appendChild(Q),Te.log("PersistentLoader: Loader element added to container");const ne=He=>{_(He),Z.style.width=`${Math.round(He*100)}%`,ee.textContent=`${Math.round(He*100)}%`,Te.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},oe=He=>{b(He),re.textContent=He,Te.log(`PersistentLoader: Loading stage updated to "${He}"`)},ge=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];q&&(ge[0].stage="Connecting to Space",ge[1].stage="Reconnecting...",ge[2].stage="Please Wait"),oe(ge[0].stage),ne(.05);const pe=He=>{const tt=He.detail.progress;Te.log(`PersistentLoader: Progress event received with value: ${tt}`),ne(tt),tt<.33?oe(ge[0].stage):tt<.66?oe(ge[1].stage):oe(ge[2].stage)},le=()=>{Te.log("PersistentLoader: First scene loaded event received"),a(!0),oe(ge[1].stage),ne(.66)},Me=()=>{if(Te.log("PersistentLoader: Player instantiated event received"),F.current&&(clearInterval(F.current),Te.log("PersistentLoader: Progress interval cleared")),d(!0),oe(ge[2].stage),ne(1),q){Te.log("PersistentLoader: Keeping loader visible due to Unity error");return}Q.style.opacity="0",L.current&&(L.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(Q)?(n.current.removeChild(Q),Te.log("PersistentLoader: Loader element removed after fade")):Te.warn("PersistentLoader: Could not remove loader element (not found in container)"),L.current&&n.current&&n.current.contains(L.current)?(n.current.removeChild(L.current),Te.log("PersistentLoader: Logo container removed after fade")):L.current&&Te.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)Te.log("PersistentLoader: Player was already instantiated"),Me();else{Te.log("PersistentLoader: Subscribing to playerInstantiated event"),$d.subscribe(Hd.playerInstantiated,Me);const He=()=>Me();Te.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),Te.log("PersistentLoader: Adding firstSceneLoaded event listener"),$d.subscribe(Hd.firstSceneLoaded,le),Te.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",pe),F.current=setInterval(()=>{l||_(Ee=>{const Ie=Math.min(Ee+.01,.95);return Z.style.width=`${Math.round(Ie*100)}%`,ee.textContent=`${Math.round(Ie*100)}%`,Ie<.33&&E!==ge[0].stage?oe(ge[0].stage):Ie>=.33&&Ie<.66&&E!==ge[1].stage?oe(ge[1].stage):Ie>=.66&&E!==ge[2].stage&&oe(ge[2].stage),Ie})},500);const tt=setTimeout(()=>{Te.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{Te.log("PersistentLoader: Cleaning up event listeners"),$d.unsubscribe(Hd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),$d.unsubscribe(Hd.firstSceneLoaded,le),window.removeEventListener("UnityProgress",pe),clearInterval(F.current),clearTimeout(tt),n.current&&n.current.contains(Q)&&(n.current.removeChild(Q),Te.log("PersistentLoader: Loader element removed during cleanup")),L.current&&n.current&&n.current.contains(L.current)&&(n.current.removeChild(L.current),Te.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Lae.propTypes={containerRef:Hr.shape({current:Hr.instanceOf(Element)})};const j9e="a2a7f4eb05284449b1063eb71d8301dc",k3=D.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:a,error:l}=al(),d=cze();uze();const f=Jg(),_=gze(d),{user:E}=D.useContext(ul),[b,w]=D.useState(!1),[I,k]=D.useState(window.devicePixelRatio),[V,L]=hze();dae().find(Ee=>Ee.isLocalPlayer);const[B,q]=D.useState(!0),[$,Q]=D.useState(!0),[ae,re]=D.useState(!1),[fe,Z]=D.useState(!1),ee=n.spaceID||"default",ne=D.useMemo(()=>{const ve=new URLSearchParams(window.location.search).get("sessionId")||ee;return console.log("WebGLRenderer: Using session ID:",ve),ve},[ee]),[oe,ge]=D.useState(null);D.useEffect(()=>{E!=null&&E.uid&&yp(E.uid).then(Ee=>{ge(Ee),console.log("WebGLRenderer: User profile loaded:",(Ee==null?void 0:Ee.Nickname)||"Unknown")}).catch(Ee=>{console.error("Error fetching user profile:",Ee)})},[E==null?void 0:E.uid]),D.useEffect(()=>{if(l||!E){Te.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ee=setTimeout(()=>{Z(!0)},1e3);return()=>clearTimeout(Ee)}else Z(!1)},[l,E]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ee=()=>{console.log("WebGLRenderer: Player instantiated event received"),Q(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),Q(!0)),$d.subscribe(Hd.playerInstantiated,Ee);const Ie=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),Q(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{$d.unsubscribe(Hd.playerInstantiated,Ee),clearTimeout(Ie)}},[$]),D.useEffect(()=>{a||d?setTimeout(()=>{w(!0),Te.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Te.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),D.useEffect(()=>{const Ee=Ie=>{Te.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",Ie)};return $d.subscribe(Hd.sendUserToUnity,Ee),()=>$d.unsubscribe(Hd.sendUserToUnity,Ee)},[f]);const{setFullscreenRef:pe,fullscreenRef:le}=Jd();D.useEffect(()=>{pe(e.current)},[e,pe]);const Me=()=>{q(!B)},He=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:$,showVoiceChat:He,sessionId:ne}),D.useEffect(()=>{const Ee=Ie=>{re(Ie.detail.enabled)};return window.addEventListener("editModeChanged",Ee),()=>{window.removeEventListener("editModeChanged",Ee)}},[]),hae(),dze();const tt=D.useRef(null);return S.jsxs(qe,{className:"webgl-renderer",children:[n.urlLoadingBackground&&S.jsx(xae,{backgroundUrl:n.urlLoadingBackground,containerRef:tt}),!fe&&S.jsx(Lae,{containerRef:tt}),fe&&S.jsx(qe,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:S.jsx(FN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),S.jsx(cF,{containerRef:le.current?le:document.body,children:S.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[S.jsxs(qe,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&S.jsx(Vze,{}),He&&S.jsxs(Nae,{appId:j9e,channel:ne,uid:E==null?void 0:E.uid,enabled:!0,children:[S.jsx(m9e,{size:"md",defaultMuted:!0,joinOnClick:!0}),S.jsx(_9e,{userNickname:oe==null?void 0:oe.Nickname})]}),S.jsx(n9e,{}),S.jsx(qe,{position:"relative",zIndex:"9999",children:S.jsx(O9e,{onTogglePlayerList:Me,spaceID:ee})})]}),S.jsxs(qe,{ref:tt,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[S.jsx(qe,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),S.jsx(qe,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?S.jsx(uae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I}):S.jsx(qe,{width:"100%",height:"100%"})}),S.jsx(qe,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:S.jsx(Uze,{})})]}),S.jsx(qe,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&S.jsx(Va,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),S.jsx(qe,{..._,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),S.jsxs(qe,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&S.jsx(jze,{}),S.jsx(s9e,{})]}),S.jsx(o9e,{}),S.jsx(a9e,{isOpen:V!==null,onClose:()=>{console.log(" Closing nameplate modal"),L()},playerName:(V==null?void 0:V.playerName)||"Unknown Player",playerId:(V==null?void 0:V.playerId)||"Unknown ID"}),S.jsx(c9e,{isVisible:B,onToggleVisibility:q,spaceID:ee}),S.jsx(V9e,{})]})})]})});k3.displayName="WebGLRenderer";k3.propTypes={settings:Hr.shape({urlLoadingBackground:Hr.string,showAuthButton:Hr.bool,showDisruptiveLogo:Hr.bool,urlDisruptiveLogo:Hr.string,showHelpButton:Hr.bool,enableVoiceChat:Hr.bool,spaceID:Hr.string})};const WN=({spaceID:n,overrideSettings:e})=>{const i=D.useRef(null),[a,l]=D.useState(!0),[d,f]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[_,E]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await Og(n);if(w){f(V=>({...V,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const I=await FO(_.urlDisruptiveLogo);let k="";if(w.backgroundUrl)k=w.backgroundUrl;else if(w.backgroundGsUrl)try{k=await FO(w.backgroundGsUrl)}catch(V){Te.warn("WebGLLoader: Error fetching background from GS URL:",V)}else if(w.gsUrlLoadingBackground)try{k=await FO(w.gsUrlLoadingBackground)}catch(V){Te.warn("WebGLLoader: Error fetching background from legacy GS URL:",V)}E(V=>({...V,urlLoadingBackground:k,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...e||{}})),l(!1)}else Te.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){Te.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,_.urlDisruptiveLogo,e]),D.useEffect(()=>{a||(Te.log("WebGLLoader: Unity config from Firebase",d),Te.log("WebGLLoader: Space settings from Firebase",_))},[a]),S.jsx(S.Fragment,{children:a?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):S.jsx(aze,{...d,children:S.jsx(k3,{ref:i,settings:_})})})};WN.propTypes={spaceID:Hr.string.isRequired,overrideSettings:Hr.object};const F9e=()=>{const[n,e]=D.useState(!1);return D.useEffect(()=>{var i,a,l;if(n){const d=document.querySelector("#unity-canvas");d&&(d.blur(),d.style.pointerEvents="none");const f=(a=(i=window.unityInstance)==null?void 0:i.Module)==null?void 0:a.WebGLInputHandler;(l=window.unityInstance)!=null&&l.Module&&(window.unityInstance.Module.WebGLInputHandler=null);const _=E=>{E.stopImmediatePropagation(),E.stopPropagation()};return document.addEventListener("keydown",_,!0),document.addEventListener("keyup",_,!0),document.addEventListener("keypress",_,!0),document.addEventListener("keydown",_,!1),document.addEventListener("keyup",_,!1),document.addEventListener("keypress",_,!1),()=>{var E;(E=window.unityInstance)!=null&&E.Module&&f&&(window.unityInstance.Module.WebGLInputHandler=f),d&&(d.style.pointerEvents="auto"),document.removeEventListener("keydown",_,!0),document.removeEventListener("keyup",_,!0),document.removeEventListener("keypress",_,!0),document.removeEventListener("keydown",_,!1),document.removeEventListener("keyup",_,!1),document.removeEventListener("keypress",_,!1)}}},[n]),[n,e]},B9e=({isOpen:n,onClose:e,user:i,profileImageUrl:a})=>{const[l,d]=D.useState(!1),[f,_]=D.useState({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,b]=D.useState(!1),[w,I]=F9e(),k=ll(),{sendUserToUnity:V}=D.useContext(ul),L=D.useRef(null);D.useEffect(()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),D.useEffect(()=>{if(l&&L.current){const ae=()=>{L.current.focus(),I(!0);const Z=document.querySelector("#unity-canvas");Z&&Z.blur()};ae();const re=setTimeout(ae,100),fe=setTimeout(ae,300);return()=>{clearTimeout(re),clearTimeout(fe)}}else I(!1)},[l,I]);const F=()=>{d(!1),I(!1),e()},B=ae=>{const{name:re,value:fe}=ae.target;_(Z=>({...Z,[re]:fe}))},q=async()=>{if(f.Nickname.trim()===""){k({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}b(!0);try{const ae=qi(ii,"users",i.uid),re=a8e(ae,fe=>{fe.exists()&&fe.data().Nickname===f.Nickname&&(V(),re())});await Ku(ae,{...f,lastUpdated:new Date().toISOString()}),await updateUser(),_({Nickname:f.Nickname,companyName:f.companyName,firstName:f.firstName,lastName:f.lastName,linkedInProfile:f.linkedInProfile}),k({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(ae){k({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",ae)}finally{b(!1)}},$=()=>S.jsxs(mr,{spacing:4,align:"stretch",w:"100%",children:[S.jsx(ar,{direction:"column",align:"center",gap:2,children:S.jsx(Qe,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname})}),S.jsxs(mr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[S.jsxs(ar,{direction:"column",children:[S.jsx(Qe,{color:"gray.400",fontSize:"sm",children:"Company"}),S.jsx(Qe,{children:i.companyName||"Not specified"})]}),S.jsxs(ar,{direction:"column",children:[S.jsx(Qe,{color:"gray.400",fontSize:"sm",children:"Full Name"}),S.jsx(Qe,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),S.jsxs(ar,{direction:"column",children:[S.jsx(Qe,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),S.jsx(Qe,{children:i.linkedInProfile||"Not specified"})]})]}),S.jsx(Zn,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),Q=()=>S.jsxs(mr,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(kn,{children:[S.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"Nickname"}),S.jsx(or,{ref:L,name:"Nickname",value:f.Nickname,onChange:B,onFocus:()=>{I(!0);const ae=document.querySelector("#unity-canvas");ae&&ae.blur()},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(kn,{children:[S.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"Company Name"}),S.jsx(or,{name:"companyName",value:f.companyName,onChange:B,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(ar,{gap:4,children:[S.jsxs(kn,{children:[S.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"First Name"}),S.jsx(or,{name:"firstName",value:f.firstName,onChange:B,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(kn,{children:[S.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"Last Name"}),S.jsx(or,{name:"lastName",value:f.lastName,onChange:B,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),S.jsxs(kn,{children:[S.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),S.jsx(or,{name:"linkedInProfile",value:f.linkedInProfile,onChange:B,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(ar,{gap:2,justify:"flex-end",mt:2,children:[S.jsx(Zn,{onClick:()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),d(!1)},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),S.jsx(Zn,{onClick:q,colorScheme:"blue",size:"sm",isLoading:E,children:"Save Changes"})]})]});return S.jsxs(Ga,{isOpen:n,onClose:F,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[S.jsx(Ba,{backdropFilter:"blur(10px)"}),S.jsxs(Ha,{bg:"gray.800",color:"white",children:[S.jsx($l,{children:"Profile"}),S.jsx(fc,{}),S.jsx(Fa,{pb:6,children:S.jsxs(mr,{spacing:6,children:[S.jsx(Gu,{src:a,size:"2xl",borderRadius:"full"}),l?Q():$()]})})]})]})},sO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},W9e=()=>{const{user:n,updateUser:e}=D.useContext(ul),[i,a]=D.useState(!0),{isOpen:l,onOpen:d,onClose:f}=qd();D.useEffect(()=>{const b=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(b)},[]);const _=()=>{f(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null;return i?null:S.jsx(ar,{align:"center",gap:"4",children:n?S.jsxs(S.Fragment,{children:[S.jsx(B9e,{isOpen:l,onClose:_,user:n,profileImageUrl:E}),S.jsxs(Zk,{children:[S.jsx(eN,{as:qe,cursor:"pointer",children:S.jsx(ar,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:S.jsxs(ar,{align:"center",gap:"3",children:[S.jsx(qe,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(Gu,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),S.jsx(Qe,{color:"white",fontWeight:"medium",children:n.Nickname}),S.jsx(qe,{display:"flex",alignItems:"center",height:"28px",children:S.jsx(KWe,{color:"white",w:4,h:4})})]})})}),S.jsx(Kl,{children:S.jsxs(tN,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[S.jsxs(qe,{p:4,display:"flex",alignItems:"center",gap:3,children:[S.jsx(Gu,{src:E,size:"md",borderRadius:"full"}),S.jsx(Qe,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),S.jsx(uo,{borderColor:"gray.700"}),S.jsx(bg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),S.jsx(bg,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),S.jsx(uo,{borderColor:"gray.700"}),S.jsx(bg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),S.jsx(bg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:S.jsx(O3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):S.jsxs(S.Fragment,{children:[S.jsx(jN,{mode:"button",label:"Register",buttonProps:{...sO,width:["100%","auto"]},customButton:S.jsxs(Zn,{...sO,children:[S.jsx(qe,{as:"span",fontSize:"xl",children:""}),"Register"]})}),S.jsx(FN,{mode:"button",label:"Sign In",buttonProps:{...sO,width:["100%","auto"]},customButton:S.jsxs(Zn,{...sO,children:[S.jsx(qe,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},Mae=({transparent:n=!1})=>{const{isOpen:e,onToggle:i}=qd(),a=QLe({base:!0,md:!1});return S.jsx(qe,{as:"header",py:4,boxShadow:n?"none":"sm",bg:n?"rgba(26, 32, 44, 0.2)":"gray.800",backdropFilter:n?"blur(5px)":"none",position:n?"absolute":"relative",width:"100%",zIndex:"10",children:S.jsxs(Wl,{maxW:"container.xl",children:[S.jsxs(ar,{justify:"space-between",align:"center",children:[S.jsx(Uu,{to:"/",children:S.jsx(Va,{src:"/SpaceEmblem.png",alt:"Space Emblem",h:"40px",filter:"brightness(0) invert(1)",fallbackSrc:"https://placehold.co/150x40?text=Logo"})}),!a&&S.jsxs(ni,{spacing:8,color:"white",position:"absolute",left:"50%",transform:"translateX(-50%)",children:[S.jsx(ho,{as:Uu,to:"/",fontWeight:"medium",children:"Home"}),S.jsx(ho,{as:Uu,to:"/spaces",fontWeight:"medium",children:"Spaces"}),S.jsx(ho,{as:Uu,to:"/about",fontWeight:"medium",children:"About"})]}),a&&S.jsx(Ys,{onClick:i,icon:e?S.jsx(oae,{w:3,h:3}):S.jsx(aae,{w:5,h:5}),variant:"ghost",color:"white","aria-label":"Toggle Navigation"}),S.jsx(qe,{children:S.jsx(VR,{children:S.jsx(jR,{children:S.jsx(W9e,{})})})})]}),S.jsx(Tne,{in:e,animateOpacity:!0,children:S.jsx(qe,{pt:4,pb:4,display:{md:"none"},children:S.jsxs(nl,{spacing:4,color:"white",children:[S.jsx(ho,{as:Uu,to:"/",fontWeight:"medium",children:"Home"}),S.jsx(ho,{as:Uu,to:"/spaces",fontWeight:"medium",children:"Spaces"}),S.jsx(ho,{as:Uu,to:"/about",fontWeight:"medium",children:"About"})]})})})]})})},Uae=()=>{const n=new Date().getFullYear();return S.jsx(qe,{as:"footer",bg:"gray.50",py:10,children:S.jsx(Wl,{maxW:"container.xl",children:S.jsxs(nl,{direction:{base:"column",md:"row"},spacing:4,justify:"space-between",align:{base:"center",md:"center"},children:[S.jsxs(Qe,{children:[" ",n," Disruptive Spaces. All rights reserved."]}),S.jsxs(ni,{spacing:4,children:[S.jsx(ho,{href:"https://twitter.com/disruptivespaces",isExternal:!0,children:S.jsx(Dn,{as:Cae,boxSize:5})}),S.jsx(ho,{href:"https://linkedin.com/company/disruptive-spaces",isExternal:!0,children:S.jsx(Dn,{as:BN,boxSize:5})}),S.jsx(ho,{href:"https://github.com/disruptive-spaces",isExternal:!0,children:S.jsx(Dn,{as:wae,boxSize:5})})]})]})})})},jw="thepotato",QQ=n=>({id:n,name:n==="sample1"?"Conference Room":n==="sample2"?"Art Gallery":"Social Lounge",description:n==="sample1"?"Professional virtual meeting space for team collaboration.":n==="sample2"?"Immersive gallery for showcasing digital art and exhibitions.":"Casual environment for social gatherings and networking events.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}}),oO={id:"thepotato",name:"Spaces Metaverse",description:"Welcome to the Spaces Metaverse! This is our first test space where you can explore and interact with the virtual environment. We plan to add more functionality as we go. Please check back soon for updates.",visibility:"public",createdAt:{toDate:()=>new Date("2025-03-15")},createdBy:{displayName:"Disruptive Live"},category:"development"},ZQ="seoContent";function z9e(){const n=window.fetch;return window.fetch=function(e,i){if(typeof e=="string"&&e.includes("firebasestorage.googleapis.com")){console.log("Intercepting Firebase Storage URL:",e);const a=e.replace("https://firebasestorage.googleapis.com","/firebase-proxy");return console.log("Using proxy URL:",a),n(a,i)}return n(e,i)},()=>{window.fetch=n}}function G9e(){var ke,Re;console.log("SpacePage component rendering");const{spaceSlug:n}=PZ();console.log("Space slug from URL:",n);const[e,i]=D.useState(null),[a,l]=D.useState(!0),[d,f]=D.useState(null),[_,E]=D.useState(null),b=D.useRef(null),[w,I]=D.useState(null),[k,V]=D.useState(!1),[L,F]=D.useState(""),[B,q]=D.useState(""),[$,Q]=D.useState([]),[ae,re]=D.useState(!1),fe=D.useRef(null),Z=D.useRef(null),{isOpen:ee,onOpen:ne,onClose:oe}=qd(),[ge,pe]=D.useState("");D.useEffect(()=>{async function he(){try{if(l(!0),console.log("Fetching space with slug:",n),n==="the-potato-website"){console.log("Using hardcoded potato space data"),i(oO),E(jw),l(!1);return}const we=qi(ii,"spaces",n),Ue=await hc(we);if(Ue.exists()){console.log("Found space by ID:",Ue.id);const Fe={id:Ue.id,...Ue.data()};i(Fe),E(Ue.id)}else{console.log("Space not found by ID, checking by slug...");try{const Fe=oR(Yf(ii,"spaces"),Rk("slug","==",n)),$e=await zg(Fe);if($e.empty)if(n.startsWith("sample")){console.log("Using sample space data");const ct=QQ(n);i(ct),E(n)}else console.log("Space not found by slug either"),f("Space not found");else{const ct=$e.docs[0];console.log("Found space by slug:",ct.id);const it={id:ct.id,...ct.data()};i(it),E(ct.id)}}catch(Fe){console.error("Error querying by slug:",Fe),f("Failed to load space")}}}catch(we){if(console.error("Error fetching space:",we),we.code==="permission-denied")if(n.startsWith("sample")){console.log("Using sample space data due to Firebase permissions issue");const Ue=QQ(n);i(Ue),E(n)}else n==="the-potato-website"?(console.log("Using special potato space data due to permissions issue"),i(oO),E(jw)):f("Failed to load space - Permission denied");else f("Failed to load space")}finally{l(!1)}}n?he():(f("Invalid space URL"),l(!1))},[n]),D.useEffect(()=>{let he=document.getElementById("webgl-root");he||(console.log("Creating webgl-root element as it does not exist"),he=document.createElement("div"),he.id="webgl-root",he.style.display="block",he.style.width="100%",he.style.height="100%",he.style.position="relative",document.body.appendChild(he));const we=b.current;if(he&&we){const Ue=he.parentElement,Fe={display:he.style.display,width:he.style.width,height:he.style.height,position:he.style.position};we.appendChild(he);const $e=n==="the-potato-website"?jw:_||n;return console.log("Setting data-space-id to:",$e),he.setAttribute("data-space-id",$e),()=>{he.parentElement===we&&(Ue?Ue.appendChild(he):document.body.appendChild(he),he.style.display=Fe.display,he.style.width=Fe.width,he.style.height=Fe.height,he.style.position=Fe.position)}}},[_,n]),D.useEffect(()=>(console.log("Setting up Firebase Storage proxy"),z9e()),[]),D.useEffect(()=>{async function he(){if(n)try{if(console.log("Fetching SEO data for:",n),n==="the-potato-website"){console.log("Using hardcoded data for SEO (potato website)"),I({title:oO.name,description:oO.description,image:""});try{const Fe=qi(ii,ZQ,n),$e=await hc(Fe);if($e.exists())console.log("Found SEO data from collection:",$e.data()),I(ct=>({title:$e.data().title||ct.title,description:$e.data().description||ct.description,image:$e.data().image||ct.image}));else{const ct=qi(ii,"spaces",jw),it=await hc(ct);if(it.exists()){const Ct=it.data();console.log("Found space data for SEO:",Ct),I(Vt=>({title:Ct.name||Vt.title,description:Ct.description||Vt.description,image:Ct.imageUrl||Vt.image}))}}}catch(Fe){console.error("Error fetching additional SEO data:",Fe)}return}const we=qi(ii,ZQ,n),Ue=await hc(we);Ue.exists()&&(console.log("Found SEO data:",Ue.data()),I(Ue.data()))}catch(we){console.error("Error fetching SEO data:",we)}}he()},[n]),D.useEffect(()=>{if(!k)return;const he=we=>{const Ue={type:we.type,key:we.key,target:we.target.tagName,timestamp:new Date().toISOString().split("T")[1].split(".")[0]};if(console.log("Key event:",Ue),Q(Fe=>[...Fe.slice(-9),Ue]),we.target.tagName!=="INPUT"&&we.target.tagName!=="TEXTAREA")return we.stopPropagation(),we.preventDefault(),fe.current===document.activeElement?we.key.length===1?F(Fe=>Fe+we.key):we.key==="Backspace"&&F(Fe=>Fe.slice(0,-1)):Z.current===document.activeElement&&(we.key.length===1?q(Fe=>Fe+we.key):we.key==="Backspace"&&q(Fe=>Fe.slice(0,-1))),!1};return document.addEventListener("keydown",he,!0),document.addEventListener("keyup",we=>{if(we.target.tagName!=="INPUT"&&we.target.tagName!=="TEXTAREA")return we.stopPropagation(),we.preventDefault(),!1},!0),document.addEventListener("keypress",we=>{if(we.target.tagName!=="INPUT"&&we.target.tagName!=="TEXTAREA")return we.stopPropagation(),we.preventDefault(),!1},!0),()=>{document.removeEventListener("keydown",he,!0),document.removeEventListener("keyup",we=>{if(we.target.tagName!=="INPUT"&&we.target.tagName!=="TEXTAREA")return we.stopPropagation(),we.preventDefault(),!1},!0),document.removeEventListener("keypress",we=>{if(we.target.tagName!=="INPUT"&&we.target.tagName!=="TEXTAREA")return we.stopPropagation(),we.preventDefault(),!1},!0)}},[k]);const le=he=>{he.stopPropagation(),console.log("Input changed:",he.target.value),F(he.target.value)},Me=he=>{he.stopPropagation(),console.log("Textarea changed:",he.target.value),q(he.target.value)},He=()=>{fe.current&&fe.current.focus()},tt=()=>{Z.current&&Z.current.focus()},Ee=()=>{console.log("Disabling Unity input handlers - NUCLEAR OPTION"),re(!0);try{const he=document.getElementById("unity-canvas"),we=document.getElementById("webgl-root");if(he){const Fe=he.parentElement,$e=he.nextSibling;window._removedUnityCanvas={element:he,parent:Fe,nextSibling:$e},Fe&&(Fe.removeChild(he),console.log("Removed Unity canvas from the DOM"))}we&&(window._originalWebglRootStyle={display:we.style.display,visibility:we.style.visibility,opacity:we.style.opacity},we.style.display="none",we.style.visibility="hidden",we.style.opacity="0",console.log("Hidden webgl-root element"));const Ue=document.createElement("style");Ue.id="unity-nuclear-style",Ue.textContent=`
        #unity-container, #unity-canvas, #webgl-root, #unity-loading-bar, 
        #unity-logo, #unity-progress-bar, #unity-footer, iframe {
          display: none !important;
          visibility: hidden !important;
          opacity: 0 !important;
          pointer-events: none !important;
        }
      `,document.head.appendChild(Ue),window._unityNuclearStyle=Ue,console.log("Unity completely disabled (nuclear option)")}catch(he){console.error("Error disabling Unity (nuclear option):",he)}},Ie=()=>{console.log("Restoring Unity input handlers - NUCLEAR OPTION"),re(!1);try{if(window._removedUnityCanvas){const{element:Ue,parent:Fe,nextSibling:$e}=window._removedUnityCanvas;Fe&&($e?Fe.insertBefore(Ue,$e):Fe.appendChild(Ue),console.log("Restored Unity canvas to the DOM")),delete window._removedUnityCanvas}const he=document.getElementById("webgl-root");he&&window._originalWebglRootStyle&&(he.style.display=window._originalWebglRootStyle.display,he.style.visibility=window._originalWebglRootStyle.visibility,he.style.opacity=window._originalWebglRootStyle.opacity,console.log("Restored webgl-root element"),delete window._originalWebglRootStyle);const we=document.getElementById("unity-nuclear-style");we&&(document.head.removeChild(we),delete window._unityNuclearStyle),console.log("Unity completely restored (nuclear option)")}catch(he){console.error("Error enabling Unity (nuclear option):",he)}},ve=()=>{V(he=>!he)};if(D.useEffect(()=>{const he=document.createElement("script");return he.textContent=`
      // Function to disable Unity keyboard capture
      function disableUnityKeyboardCapture() {
        console.log('Injected script: Attempting to disable Unity keyboard capture');
        
        // Try different methods to access and disable Unity keyboard capture
        if (window.unityInstance) {
          try {
            // Method 1: Try to set the property directly on the Unity instance
            if (window.unityInstance.Module && window.unityInstance.Module.WebGLInput) {
              window.unityInstance.Module.WebGLInput.captureAllKeyboardInput = false;
              console.log('Injected script: Set WebGLInput.captureAllKeyboardInput = false directly');
            }
            
            // Method 2: Try to send a message to Unity
            if (window.unityInstance.SendMessage) {
              window.unityInstance.SendMessage('WebGLInput', 'captureAllKeyboardInput', 'false');
              console.log('Injected script: Sent captureAllKeyboardInput message to Unity');
            }
            
            // Method 3: Try to override the keyboard functions
            if (window.unityInstance.Module) {
              const originalKeyboardListenerFunc = window.unityInstance.Module.keyboardListenerFunc;
              window.unityInstance.Module.keyboardListenerFunc = function(target, eventTypeId, ctrlKey, altKey, shiftKey, keyCode, charCode) {
                // Only allow keyboard events for input elements
                if (target && (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA')) {
                  return originalKeyboardListenerFunc(target, eventTypeId, ctrlKey, altKey, shiftKey, keyCode, charCode);
                }
                // Block other keyboard events
                return false;
              };
              console.log('Injected script: Overrode keyboardListenerFunc');
            }
          } catch (error) {
            console.error('Injected script: Error disabling Unity keyboard capture:', error);
          }
        }
      }
      
      // Run immediately if Unity is already loaded
      if (window.unityInstance) {
        disableUnityKeyboardCapture();
      }
      
      // Set up a MutationObserver to watch for Unity canvas being added to the DOM
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.addedNodes.length) {
            for (let i = 0; i < mutation.addedNodes.length; i++) {
              const node = mutation.addedNodes[i];
              if (node.id === 'unity-canvas' || (node.querySelector && node.querySelector('#unity-canvas'))) {
                console.log('Injected script: Unity canvas detected in DOM');
                
                // Wait a bit for Unity to initialize
                setTimeout(disableUnityKeyboardCapture, 1000);
                
                // Also set tabIndex on the canvas
                const canvas = node.id === 'unity-canvas' ? node : node.querySelector('#unity-canvas');
                if (canvas) {
                  canvas.tabIndex = -1;
                  console.log('Injected script: Set Unity canvas tabIndex to -1');
                }
              }
            }
          }
        });
      });
      
      // Start observing the document body for changes
      observer.observe(document.body, { childList: true, subtree: true });
      
      // Also check periodically
      const checkInterval = setInterval(function() {
        if (window.unityInstance) {
          disableUnityKeyboardCapture();
          
          // Also check for the canvas
          const canvas = document.getElementById('unity-canvas');
          if (canvas) {
            canvas.tabIndex = -1;
            console.log('Injected script: Set Unity canvas tabIndex to -1 (interval check)');
          }
        }
      }, 2000);
      
      // Clean up after 30 seconds
      setTimeout(function() {
        clearInterval(checkInterval);
      }, 30000);
    `,document.head.appendChild(he),()=>{document.head.removeChild(he)}},[]),a)return S.jsx(qe,{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(la,{size:"xl",color:"brand.500",thickness:"4px"})});if(d)return S.jsx(Wl,{maxW:"container.xl",py:10,children:S.jsxs(Fu,{status:"error",borderRadius:"md",children:[S.jsx(Bu,{}),S.jsx(FC,{mr:2,children:"Error!"}),S.jsx(BC,{children:d})]})});const Be=n==="the-potato-website"?jw:_;return S.jsxs(qe,{bg:"#1a1a1a",color:"white",minH:"100vh",children:[S.jsxs(Y0,{children:[S.jsxs("title",{children:[(w==null?void 0:w.title)||(e==null?void 0:e.name)||"Space"," | Disruptive Spaces"]}),S.jsx("meta",{name:"description",content:(w==null?void 0:w.description)||(e==null?void 0:e.description)||"Explore this virtual space"}),(w==null?void 0:w.image)&&S.jsx("meta",{property:"og:image",content:w.image})]}),S.jsx(Mae,{}),S.jsxs(Wl,{maxW:"container.xl",py:8,mt:"60px",children:[S.jsxs(qe,{position:"absolute",top:"70px",right:"20px",zIndex:"1000",children:[S.jsx(Zn,{colorScheme:"blue",onClick:ve,size:"sm",mr:2,children:k?"Hide Keyboard Test":"Show Keyboard Test"}),S.jsx(Zn,{colorScheme:"purple",onClick:ne,size:"sm",children:"Open Test Modal"})]}),S.jsx(qe,{borderRadius:"md",overflow:"hidden",mb:8,height:"70vh",position:"relative",border:"1px solid rgba(255, 255, 255, 0.1)",ref:b,opacity:ae?.7:1,pointerEvents:ae?"none":"auto",children:Be&&S.jsx(VR,{children:S.jsx(jR,{children:S.jsx(WN,{spaceID:Be})})})}),k&&S.jsxs(qe,{position:"fixed",bottom:"20px",right:"20px",width:"400px",bg:"#2D2D2D",p:4,borderRadius:"md",boxShadow:"lg",zIndex:"1000",border:"1px solid rgba(255, 255, 255, 0.1)",children:[S.jsx(Sr,{size:"md",mb:4,children:"Keyboard Input Test"}),S.jsxs(mr,{spacing:4,align:"stretch",children:[S.jsx(Zn,{colorScheme:ae?"red":"green",onClick:ae?Ie:Ee,children:ae?"Enable Unity Input":"Disable Unity Input"}),S.jsxs(qe,{children:[S.jsx(Qe,{mb:1,fontSize:"sm",children:"Test Input:"}),S.jsx(or,{ref:fe,value:L,onChange:le,placeholder:"Type here to test",size:"sm",bg:"gray.700",className:"test-input",onKeyDown:he=>{he.stopPropagation(),console.log("Input keydown captured:",he.key)},onKeyUp:he=>he.stopPropagation(),onKeyPress:he=>he.stopPropagation(),onClick:he=>{he.stopPropagation(),he.currentTarget.focus()},autoFocus:!0}),S.jsxs(Qe,{mt:1,fontSize:"xs",children:['Value: "',L,'"']})]}),S.jsxs(qe,{children:[S.jsx(Qe,{mb:1,fontSize:"sm",children:"Test Textarea:"}),S.jsx(Mu,{ref:Z,value:B,onChange:Me,placeholder:"Type here to test",size:"sm",bg:"gray.700",rows:3,className:"test-input",onKeyDown:he=>{he.stopPropagation(),console.log("Textarea keydown captured:",he.key)},onKeyUp:he=>he.stopPropagation(),onKeyPress:he=>he.stopPropagation(),onClick:he=>{he.stopPropagation(),he.currentTarget.focus()}}),S.jsxs(Qe,{mt:1,fontSize:"xs",children:['Value: "',B,'"']})]}),S.jsxs(ni,{spacing:2,children:[S.jsx(Zn,{onClick:He,size:"xs",children:"Focus Input"}),S.jsx(Zn,{onClick:tt,size:"xs",children:"Focus Textarea"}),S.jsx(Zn,{onClick:()=>F(""),size:"xs",children:"Clear"})]}),S.jsxs(qe,{p:2,bg:"gray.800",borderRadius:"md",maxHeight:"150px",overflowY:"auto",children:[S.jsx(Qe,{fontSize:"xs",fontWeight:"bold",mb:1,children:"Key Event Log:"}),$.length===0?S.jsx(Qe,{fontSize:"xs",children:"No key events recorded yet."}):$.map((he,we)=>S.jsxs(Qe,{fontSize:"xs",children:[he.timestamp," - ",he.type,": ",he.key," (Target: ",he.target,")"]},we))]})]})]}),S.jsxs(qe,{mb:6,children:[S.jsx(Sr,{as:"h1",size:"2xl",mb:2,children:(w==null?void 0:w.title)||(e==null?void 0:e.name)||"Space"}),S.jsxs(ni,{spacing:2,children:[S.jsx(Qe,{color:"#4fd1c5",children:(ke=e==null?void 0:e.createdBy)==null?void 0:ke.displayName}),S.jsx(Qe,{color:"gray.500",children:"|"}),S.jsx(Qe,{color:"gray.500",children:"Public Space"})]})]}),S.jsxs(ar,{gap:8,direction:{base:"column",lg:"row"},children:[S.jsxs(qe,{flex:"2",children:[S.jsx(Qe,{fontSize:"lg",mb:6,children:(w==null?void 0:w.description)||(e==null?void 0:e.description)||"No description available."}),S.jsx(uo,{borderColor:"gray.700",mb:6})]}),S.jsxs(qe,{flex:"1",bg:"#2D2D2D",p:6,borderRadius:"md",border:"1px solid rgba(255, 255, 255, 0.1)",children:[S.jsx(Sr,{as:"h2",size:"lg",mb:6,children:"Information"}),S.jsxs(mr,{align:"stretch",spacing:4,children:[S.jsxs(qe,{children:[S.jsx(Qe,{color:"gray.400",children:"Released:"}),S.jsx(Qe,{children:e!=null&&e.createdAt?new Date(e.createdAt.toDate()).toLocaleDateString():"15/3/2025"})]}),S.jsxs(qe,{children:[S.jsx(Qe,{color:"gray.400",children:"Category:"}),S.jsx(qe,{mt:2,children:S.jsx(Wd,{bg:"#2D2D2D",color:"white",px:3,py:1,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.2)",children:(e==null?void 0:e.category)||"development"})})]}),S.jsxs(qe,{children:[S.jsx(Qe,{color:"gray.400",children:"Creators:"}),S.jsx(qe,{mt:2,children:S.jsx(Qe,{children:((Re=e==null?void 0:e.createdBy)==null?void 0:Re.displayName)||"Disruptive Live"})})]})]})]})]})]}),S.jsxs(Ga,{isOpen:ee,onClose:oe,size:"lg",children:[S.jsx(Ba,{}),S.jsxs(Ha,{bg:"#2D2D2D",color:"white",children:[S.jsx($l,{children:"Keyboard Input Test Modal"}),S.jsx(fc,{}),S.jsxs(Fa,{pb:6,children:[S.jsx(Qe,{mb:4,children:"This modal tests keyboard input over Unity. Type in the input field below:"}),S.jsx(or,{value:ge,onChange:he=>pe(he.target.value),placeholder:"Type here to test modal input",bg:"gray.700",mb:4,autoFocus:!0}),S.jsxs(Qe,{fontSize:"sm",children:['Current value: "',ge,'"']})]}),S.jsxs(Yy,{children:[S.jsx(Zn,{colorScheme:"blue",mr:3,onClick:oe,children:"Close"}),S.jsx(Zn,{onClick:()=>pe(""),children:"Clear"})]})]})]}),S.jsx(Uae,{})]})}const H9e="modulepreload",$9e=function(n,e){return new URL(n,e).href},eZ={},$U=function(e,i,a){let l=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=$9e(b,a),b in eZ)return;eZ[b]=!0;const w=b.endsWith(".css"),I=w?'[rel="stylesheet"]':"";if(!!a)for(let L=f.length-1;L>=0;L--){const F=f[L];if(F.href===b&&(!w||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const V=document.createElement("link");if(V.rel=w?"stylesheet":H9e,w||(V.as="script"),V.crossOrigin="",V.href=b,E&&V.setAttribute("nonce",E),document.head.appendChild(V),w)return new Promise((L,F)=>{V.addEventListener("load",L),V.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(f){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=f,window.dispatchEvent(_),!_.defaultPrevented)throw f}return l.then(f=>{for(const _ of f||[])_.status==="rejected"&&d(_.reason);return e().catch(d)})};async function K9e(n){let e;try{switch(n){case"default":e=await $U(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:e=await $U(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return e.default}catch(i){return Te.error("Failed to load theme:",i),e=await $U(()=>import("./index.v0.9.22.js"),[],import.meta.url),e.default}}const aO=document.getElementById("webgl-root");if(aO){const n=aO.getAttribute("data-space-id"),e=aO.getAttribute("data-theme")||"default",i=()=>{const[a,l]=D.useState(null);return D.useEffect(()=>{K9e(e).then(l)},[]),a?S.jsx(Sne,{theme:a,children:S.jsx(VR,{children:S.jsx(jR,{children:S.jsx(WN,{spaceID:n})})})}):S.jsx("div",{children:"Loading theme..."})};SZ.createRoot(aO).render(S.jsx(i,{}))}else console.error("Root element 'webgl-root' not found.");const KU="thepotato",tZ="SpacesMetaverse_SDK",cO={id:"thepotato",name:"Spaces Metaverse",description:"Welcome to the Spaces Metaverse! This is our first test space where you can explore and interact with the virtual environment.",visibility:"public",createdAt:{toDate:()=>new Date("2025-03-15")},createdBy:{displayName:"Disruptive Live"},category:"development",webglBuildId:"fassssss"},q9e=()=>{const{spaceSlug:n}=PZ(),[e,i]=D.useState(null),[a,l]=D.useState(!0),[d,f]=D.useState(null),[_,E]=D.useState(null),[b,w]=D.useState(null),I=D.useRef(null),k=n==="the-potato-website";D.useEffect(()=>{Te.log(`EmbedPage: Initializing with slug: ${n}`),I.current&&(I.current.style.width="100%",I.current.style.height="100vh",I.current.style.position="relative",I.current.style.overflow="hidden"),V()},[n]);const V=async()=>{try{if(Te.log(`EmbedPage: Fetching space data for slug: ${n}`),l(!0),k){Te.log("EmbedPage: Using hardcoded potato space data"),i(cO),w(KU),E(cO.webglBuildId||tZ),l(!1);return}const L=qi(ii,"spaces",n),F=await hc(L);if(F.exists()){Te.log(`EmbedPage: Found space by ID: ${F.id}`);const B={id:F.id,...F.data()};i(B),w(F.id),B.webglBuildId?(Te.log(`EmbedPage: Using webglBuildId from space: ${B.webglBuildId}`),E(B.webglBuildId)):(Te.log(`EmbedPage: No webglBuildId found, using space ID as fallback: ${B.id}`),E(B.id))}else{Te.log("EmbedPage: Space not found by ID, checking by slug...");try{const B=oR(Yf(ii,"spaces"),Rk("slug","==",n)),q=await zg(B);if(q.empty)Te.error(`EmbedPage: Space not found for slug: ${n}`),f("Space not found");else{const $=q.docs[0];Te.log(`EmbedPage: Found space by slug: ${$.id}`);const Q={id:$.id,...$.data()};i(Q),w($.id),Q.webglBuildId?(Te.log(`EmbedPage: Using webglBuildId from space: ${Q.webglBuildId}`),E(Q.webglBuildId)):(Te.log(`EmbedPage: No webglBuildId found, using space ID as fallback: ${Q.id}`),E(Q.id))}}catch(B){Te.error("EmbedPage: Error querying by slug:",B),f("Failed to load space")}}l(!1)}catch(L){Te.error("EmbedPage: Error fetching space:",L),L.code==="permission-denied"&&k?(Te.log("EmbedPage: Using special potato space data due to permissions issue"),i(cO),w(KU),E(cO.webglBuildId||tZ)):f(`Error loading space: ${L.message}`),l(!1)}};return D.useEffect(()=>{let L=document.getElementById("webgl-root");L||(Te.log("EmbedPage: Creating webgl-root element as it does not exist"),L=document.createElement("div"),L.id="webgl-root",L.style.display="block",L.style.width="100%",L.style.height="100%",L.style.position="relative",document.body.appendChild(L));const F=I.current;if(L&&F){const B=L.parentElement,q={display:L.style.display,width:L.style.width,height:L.style.height,position:L.style.position};F.appendChild(L);const $=k?KU:b||_;return Te.log(`EmbedPage: Setting data-space-id to: ${$}`),L.setAttribute("data-space-id",$),()=>{L.parentElement===F&&(B?B.appendChild(L):document.body.appendChild(L),L.style.display=q.display,L.style.width=q.width,L.style.height=q.height,L.style.position=q.position)}}},[b,_,k]),a?S.jsx(ar,{width:"100%",height:"100vh",justifyContent:"center",alignItems:"center",bg:"gray.900",children:S.jsx(la,{size:"xl",color:"blue.400"})}):d?S.jsxs(ar,{width:"100%",height:"100vh",justifyContent:"center",alignItems:"center",bg:"gray.900",color:"white",flexDirection:"column",p:4,children:[S.jsx(Qe,{fontSize:"xl",fontWeight:"bold",mb:4,children:d}),S.jsx(Qe,{children:"The requested space could not be loaded. Please check the URL and try again."})]}):S.jsx(qe,{width:"100%",height:"100vh",position:"relative",overflow:"hidden",ref:I,children:e&&_&&S.jsx(S.Fragment,{children:S.jsx(VR,{children:S.jsx(jR,{children:S.jsx(WN,{spaceID:_,containerRef:I,isEmbed:!0})})})})})};function Y9e(n){return cr({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1ZM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Z"}},{tag:"path",attr:{d:"M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V1Zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3V1Z"}}]})(n)}function X9e(n){return cr({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"}}]})(n)}function J9e(n){return cr({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"}}]})(n)}function Q9e(n){return cr({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"}}]})(n)}function Z9e(n){return cr({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h6zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z"}},{tag:"path",attr:{d:"M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"}}]})(n)}function eGe(n){return cr({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"}}]})(n)}function tGe(n){return cr({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"}}]})(n)}const nGe=()=>{const{hasCopied:n,onCopy:e}=ESe("hello@disruptivespaces.com"),i=ll(),[a,l]=D.useState({name:"",email:"",message:""}),[d,f]=D.useState(!1),[_,E]=D.useState({}),b=k=>{const{name:V,value:L}=k.target;l(F=>({...F,[V]:L})),_[V]&&E(F=>({...F,[V]:""}))},w=()=>{const k={};return a.name.trim()||(k.name="Name is required"),a.email.trim()?/\S+@\S+\.\S+/.test(a.email)||(k.email="Email is invalid"):k.email="Email is required",a.message.trim()||(k.message="Message is required"),E(k),Object.keys(k).length===0},I=async k=>{if(k.preventDefault(),!!w()){f(!0);try{await o8e(Yf(ii,"contactSubmissions"),{name:a.name,email:a.email,message:a.message,timestamp:c8e(),status:"new",recipient:"andrew@disruptive.live"}),i({title:"Message sent!",description:"We've received your message and will get back to you soon.",status:"success",duration:5e3,isClosable:!0}),l({name:"",email:"",message:""})}catch(V){console.error("Error submitting contact form:",V),i({title:"Error",description:"There was an error sending your message. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{f(!1)}}};return S.jsxs(S.Fragment,{children:[S.jsxs(Y0,{children:[S.jsx("title",{children:"Contact Us - Disruptive Spaces"}),S.jsx("meta",{name:"description",content:"Get in touch with the Disruptive Spaces team for inquiries, demos, or support."})]}),S.jsx(qe,{as:"section",py:20,children:S.jsxs(Wl,{maxW:"6xl",children:[S.jsxs(nl,{spacing:{base:8,md:10},children:[S.jsx(Sr,{fontWeight:600,fontSize:{base:"3xl",sm:"4xl",md:"5xl"},lineHeight:"110%",textAlign:"center",children:"Get in Touch"}),S.jsx(Qe,{color:"gray.500",maxW:"3xl",textAlign:"center",fontSize:"xl",mx:"auto",children:"Have questions about our platform? Want to schedule a demo? We'd love to hear from you."})]}),S.jsxs(Hy,{columns:{base:1,md:2},spacing:10,mt:10,children:[S.jsxs(nl,{spacing:8,children:[S.jsx(Sr,{fontSize:"2xl",fontWeight:"500",mb:5,children:"Contact Information"}),S.jsxs(nl,{spacing:4,children:[S.jsxs(ar,{align:"center",children:[S.jsx(Dn,{as:X9e,mr:2,color:"brand.500"}),S.jsx(Qe,{fontWeight:"medium",children:"andrew@disruptive.live"}),S.jsx(up,{label:n?"Email Copied!":"Copy Email",closeOnClick:!1,hasArrow:!0,children:S.jsx(Ys,{"aria-label":"Copy Email",variant:"ghost",size:"sm",fontSize:"lg",icon:S.jsx(tGe,{}),_hover:{bg:"brand.500",color:Pf("white","gray.700")},onClick:e,ml:2})})]}),S.jsxs(ar,{align:"center",children:[S.jsx(Dn,{as:Z9e,mr:2,color:"brand.500"}),S.jsx(Qe,{fontWeight:"medium",children:"+1 (555) 123-4567"})]}),S.jsxs(ar,{align:"center",children:[S.jsx(Dn,{as:Y9e,mr:2,color:"brand.500"}),S.jsxs(Qe,{fontWeight:"medium",children:["Disruptive Spaces HQ",S.jsx("br",{}),"London, UK"]})]}),S.jsxs(ar,{align:"center",children:[S.jsx(Dn,{as:J9e,mr:2,color:"brand.500"}),S.jsx(Qe,{fontWeight:"medium",children:"Operating Hours: Monday-Friday, 9AM-6PM GMT"})]})]}),S.jsxs(nl,{direction:"row",spacing:6,mt:8,children:[S.jsx(qU,{label:"Twitter",href:"#",children:S.jsx(Cae,{})}),S.jsx(qU,{label:"LinkedIn",href:"#",children:S.jsx(BN,{})}),S.jsx(qU,{label:"GitHub",href:"#",children:S.jsx(wae,{})})]})]}),S.jsx(qe,{bg:Pf("white","gray.700"),borderRadius:"lg",p:8,color:Pf("gray.700","whiteAlpha.900"),shadow:"base",children:S.jsxs(mr,{spacing:5,as:"form",onSubmit:I,children:[S.jsx(Sr,{fontSize:"2xl",fontWeight:"500",children:"Send us a message"}),S.jsxs(kn,{isRequired:!0,isInvalid:!!_.name,children:[S.jsx(Qn,{children:"Name"}),S.jsxs(I0,{children:[S.jsx($y,{children:S.jsx(Q9e,{})}),S.jsx(or,{type:"text",name:"name",placeholder:"Your Name",value:a.name,onChange:b})]}),_.name&&S.jsx(Vu,{children:_.name})]}),S.jsxs(kn,{isRequired:!0,isInvalid:!!_.email,children:[S.jsx(Qn,{children:"Email"}),S.jsxs(I0,{children:[S.jsx($y,{children:S.jsx(eGe,{})}),S.jsx(or,{type:"email",name:"email",placeholder:"Your Email",value:a.email,onChange:b})]}),_.email&&S.jsx(Vu,{children:_.email})]}),S.jsxs(kn,{isRequired:!0,isInvalid:!!_.message,children:[S.jsx(Qn,{children:"Message"}),S.jsx(Mu,{name:"message",placeholder:"Your Message",rows:6,resize:"none",value:a.message,onChange:b}),_.message&&S.jsx(Vu,{children:_.message})]}),S.jsx(Zn,{type:"submit",colorScheme:"brand",bg:"brand.500",color:"white",_hover:{bg:"brand.600"},width:"full",isLoading:d,loadingText:"Sending...",children:"Send Message"})]})})]})]})}),S.jsx(qe,{as:"section",py:10,bg:Pf("gray.50","gray.900"),children:S.jsxs(Wl,{maxW:"6xl",children:[S.jsx(Sr,{fontSize:"2xl",fontWeight:"500",mb:5,textAlign:"center",children:"Visit Our Office"}),S.jsx(qe,{borderRadius:"lg",overflow:"hidden",height:"400px",width:"100%",position:"relative",children:S.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d19868.687200276698!2d-0.1365972346495695!3d51.50701470841451!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x487604ce3941eb1f%3A0x1a5b0945da5764f0!2sCity%20of%20Westminster%2C%20London%2C%20UK!5e0!3m2!1sen!2sus!4v1710894636826!5m2!1sen!2sus",width:"100%",height:"100%",style:{border:0},allowFullScreen:"",loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Office Location"})})]})})]})},qU=({children:n,label:e,href:i})=>S.jsx(up,{label:e,children:S.jsx(Ys,{bg:Pf("blackAlpha.100","whiteAlpha.100"),borderRadius:"full",as:"a",href:i,target:"_blank","aria-label":e,icon:n,_hover:{bg:"brand.500",color:Pf("white","gray.700")}})}),rGe=()=>{const[n,e]=D.useState({title:"About Spaces",description:"Learn about the Spaces platform, our vision, and how we empower virtual collaboration and connection.",tagline:"A platform for creating virtual spaces that bring people together.",whoWeAre:{title:"Who We Are",content:"We create metaverses that are simple, accessible, and limitless. Our platform is focused on ease of use, designed for everyone, and built for creativity and connection."},ourVision:{title:"Our Vision",content:"To empower everyone to build their own virtual spaces, tailored to their needs. Whether you need public or private options, fully customizable environments, our platform offers limitless possibilities."},whatWeOffer:{title:"What We Offer",content:"Open spaces for exploration, exclusive environments for privacy, and powerful tools to shape your world exactly as you imagine it."},howItWorks:{title:"How It Works",content:"Accessible on any device, our metaverses are easy to customize and share. No downloads required - everything runs seamlessly in web browsers with simple tools for building and sharing."},contactSection:{title:"Reach Out",intro:"Interested in learning more about our spaces? Have questions about how it works? We'd love to hear from you and help you get started on your journey.",callToAction:"Fill out the form and we'll get back to you as soon as possible."},images:{topImage:"/images/Space-office-example-2-min.jpg",bottomImage:"/images/Spaces-Office-example-min.jpg"}}),[i,a]=D.useState(!0),[l,d]=D.useState(!1),f=ll();D.useEffect(()=>{(async()=>{try{a(!0);const I=await T3("aboutpage");I&&e(I)}catch(I){console.error("Error fetching about page content:",I),f({title:"Error",description:"Failed to load about page content",status:"error",duration:5e3,isClosable:!0})}finally{a(!1)}})()},[f]);const _=w=>{const{name:I,value:k}=w.target;e(V=>({...V,[I]:k}))},E=(w,I,k)=>{e(V=>({...V,[w]:{...V[w],[I]:k}}))},b=async()=>{try{d(!0),await rae("aboutpage",n),f({title:"Success",description:"About page content updated successfully",status:"success",duration:3e3,isClosable:!0})}catch(w){console.error("Error updating about page content:",w),f({title:"Error",description:"Failed to update about page content",status:"error",duration:5e3,isClosable:!0})}finally{d(!1)}};return i?S.jsx(qe,{p:4,textAlign:"center",children:S.jsx(la,{size:"xl"})}):S.jsx(qe,{p:4,children:S.jsxs(mr,{spacing:6,align:"stretch",children:[S.jsx(Sr,{size:"md",children:"About Page Content"}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"SEO Settings"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Page Title"}),S.jsx(or,{name:"title",value:n.title,onChange:_,placeholder:"Page title for SEO"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Description"}),S.jsx(Mu,{name:"description",value:n.description,onChange:_,placeholder:"Meta description for SEO"})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Header"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Tagline"}),S.jsx(Mu,{name:"tagline",value:n.tagline,onChange:_,placeholder:"Tagline that appears below the main heading"})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Images"}),S.jsxs(Hy,{columns:2,spacing:4,children:[S.jsxs(kn,{children:[S.jsx(Qn,{children:"Top Image Path"}),S.jsx(or,{value:n.images.topImage,onChange:w=>E("images","topImage",w.target.value),placeholder:"/images/example.jpg"}),n.images.topImage&&S.jsx(Va,{src:n.images.topImage,alt:"Top image preview",mt:2,maxH:"100px",objectFit:"cover"})]}),S.jsxs(kn,{children:[S.jsx(Qn,{children:"Bottom Image Path"}),S.jsx(or,{value:n.images.bottomImage,onChange:w=>E("images","bottomImage",w.target.value),placeholder:"/images/example.jpg"}),n.images.bottomImage&&S.jsx(Va,{src:n.images.bottomImage,alt:"Bottom image preview",mt:2,maxH:"100px",objectFit:"cover"})]})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Who We Are Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Title"}),S.jsx(or,{value:n.whoWeAre.title,onChange:w=>E("whoWeAre","title",w.target.value),placeholder:"Section title"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Content"}),S.jsx(Mu,{value:n.whoWeAre.content,onChange:w=>E("whoWeAre","content",w.target.value),placeholder:"Section content",rows:4})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Our Vision Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Title"}),S.jsx(or,{value:n.ourVision.title,onChange:w=>E("ourVision","title",w.target.value),placeholder:"Section title"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Content"}),S.jsx(Mu,{value:n.ourVision.content,onChange:w=>E("ourVision","content",w.target.value),placeholder:"Section content",rows:4})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"What We Offer Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Title"}),S.jsx(or,{value:n.whatWeOffer.title,onChange:w=>E("whatWeOffer","title",w.target.value),placeholder:"Section title"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Content"}),S.jsx(Mu,{value:n.whatWeOffer.content,onChange:w=>E("whatWeOffer","content",w.target.value),placeholder:"Section content",rows:4})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"How It Works Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Title"}),S.jsx(or,{value:n.howItWorks.title,onChange:w=>E("howItWorks","title",w.target.value),placeholder:"Section title"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Content"}),S.jsx(Mu,{value:n.howItWorks.content,onChange:w=>E("howItWorks","content",w.target.value),placeholder:"Section content",rows:4})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Contact Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Title"}),S.jsx(or,{value:n.contactSection.title,onChange:w=>E("contactSection","title",w.target.value),placeholder:"Section title"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Introduction"}),S.jsx(Mu,{value:n.contactSection.intro,onChange:w=>E("contactSection","intro",w.target.value),placeholder:"Introduction text",rows:3})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Call to Action"}),S.jsx(Mu,{value:n.contactSection.callToAction,onChange:w=>E("contactSection","callToAction",w.target.value),placeholder:"Call to action text",rows:2})]})]}),S.jsx(Zn,{colorScheme:"blue",onClick:b,isLoading:l,loadingText:"Saving",mt:4,children:"Save Changes"})]})})},nZ=()=>{const[n,e]=D.useState({title:"",description:"",heroHeading:"",videoSrc:"",videoType:"local",missionHeading:"",missionTitle:"",missionPoints:[],learnMoreText:""}),[i,a]=D.useState(!0),[l,d]=D.useState(!1),f=ll();D.useEffect(()=>{(async()=>{var B;try{a(!0);const q=await T3("homepage");if(q){const $={...q,videoType:(B=q.videoSrc)!=null&&B.includes("vimeo.com")?"vimeo":"local"};e($)}}catch(q){console.error("Error fetching homepage content:",q),f({title:"Error",description:"Failed to load homepage content",status:"error",duration:5e3,isClosable:!0})}finally{a(!1)}})()},[f]);const _=F=>{const{name:B,value:q}=F.target;e($=>({...$,[B]:q}))},E=F=>{e(B=>({...B,videoType:F,videoSrc:""}))},b=(F,B)=>{const q=[...n.missionPoints];q[F]=B,e($=>({...$,missionPoints:q}))},w=()=>{e(F=>({...F,missionPoints:[...F.missionPoints,""]}))},I=F=>{const B=[...n.missionPoints];B.splice(F,1),e(q=>({...q,missionPoints:B}))},k=async()=>{try{d(!0);const{videoType:F,...B}=n;await rae("homepage",B),f({title:"Success",description:"Homepage content updated successfully",status:"success",duration:3e3,isClosable:!0})}catch(F){console.error("Error updating homepage content:",F),f({title:"Error",description:"Failed to update homepage content",status:"error",duration:5e3,isClosable:!0})}finally{d(!1)}},L=(F=>{if(!F||!F.includes("vimeo.com"))return null;const B=/(?:vimeo\.com\/)(\d+)(?:\?.*)?$/,q=/(?:player\.vimeo\.com\/video\/)(\d+)(?:\?.*)?$/,$=F.match(B),Q=F.match(q);return $?$[1]:Q?Q[1]:null})(n.videoSrc);return i?S.jsx(qe,{p:4,textAlign:"center",children:S.jsx(la,{size:"xl"})}):S.jsx(qe,{p:4,children:S.jsxs(mr,{spacing:6,align:"stretch",children:[S.jsx(Sr,{size:"md",children:"Homepage Content"}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"SEO Settings"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Page Title"}),S.jsx(or,{name:"title",value:n.title,onChange:_,placeholder:"Page title for SEO"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Description"}),S.jsx(Mu,{name:"description",value:n.description,onChange:_,placeholder:"Meta description for SEO"})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Hero Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Heading"}),S.jsx(or,{name:"heroHeading",value:n.heroHeading,onChange:_,placeholder:"Main hero heading"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Video Type"}),S.jsx(qre,{onChange:E,value:n.videoType,mb:3,children:S.jsxs(nl,{direction:"row",children:[S.jsx(qV,{value:"local",children:"Local Video File"}),S.jsx(qV,{value:"vimeo",children:"Vimeo Video"})]})}),n.videoType==="local"?S.jsxs(S.Fragment,{children:[S.jsx(Qn,{children:"Local Video Path"}),S.jsx(or,{name:"videoSrc",value:n.videoSrc,onChange:_,placeholder:"/videos/example.mp4"}),S.jsx(WC,{children:"Path to video file in the public directory"})]}):S.jsxs(S.Fragment,{children:[S.jsx(Qn,{children:"Vimeo Video URL"}),S.jsx(or,{name:"videoSrc",value:n.videoSrc,onChange:_,placeholder:"https://player.vimeo.com/video/123456789?h=31a7abd0d0"}),S.jsx(WC,{children:"Full Vimeo video URL (e.g., https://player.vimeo.com/video/123456789?h=31a7abd0d0 or https://vimeo.com/123456789)"}),L&&S.jsxs(qe,{mt:2,p:2,borderWidth:"1px",borderRadius:"md",children:[S.jsxs(Qe,{fontSize:"sm",mb:1,children:["Preview Vimeo ID: ",L]}),S.jsx(Qe,{fontSize:"sm",color:"green.500",children:"Video recognized successfully. It will autoplay muted when viewed."})]})]})]})]}),S.jsx(uo,{}),S.jsxs(qe,{children:[S.jsx(Sr,{size:"sm",mb:3,children:"Mission Section"}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Subtitle"}),S.jsx(or,{name:"missionHeading",value:n.missionHeading,onChange:_,placeholder:"Mission subtitle"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Title"}),S.jsx(or,{name:"missionTitle",value:n.missionTitle,onChange:_,placeholder:"Mission title"})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Mission Points"}),S.jsxs(mr,{spacing:2,align:"stretch",children:[n.missionPoints.map((F,B)=>S.jsxs(ni,{children:[S.jsx(or,{value:F,onChange:q=>b(B,q.target.value),placeholder:`Point ${B+1}`}),S.jsx(Ys,{"aria-label":"Remove point",icon:S.jsx($We,{}),colorScheme:"red",onClick:()=>I(B)})]},B)),S.jsx(Zn,{leftIcon:S.jsx(GWe,{}),onClick:w,size:"sm",children:"Add Point"})]})]}),S.jsxs(kn,{mb:3,children:[S.jsx(Qn,{children:"Learn More Text"}),S.jsx(or,{name:"learnMoreText",value:n.learnMoreText,onChange:_,placeholder:"Text for learn more link"})]})]}),S.jsx(Zn,{colorScheme:"blue",onClick:k,isLoading:l,loadingText:"Saving",mt:4,children:"Save Changes"})]})})},iGe=()=>{const[n,e]=D.useState(!1),[i,a]=D.useState(!0),l=fN();return D.useEffect(()=>{(async()=>{try{if(!l.currentUser){e(!1),a(!1);return}const _=(await l.currentUser.getIdTokenResult()).claims.groups||[];e(_.includes("disruptiveAdmin"))}catch(f){console.error("Error checking admin status:",f),e(!1)}finally{a(!1)}})()},[l.currentUser]),{isAdmin:n,loading:i}},sGe=()=>{const[n,e]=D.useState("homepage"),{isAdmin:i,loading:a}=iGe(),l=Bj(),d=Pf("gray.50","gray.700"),f=Pf("gray.200","gray.600");if(D.useEffect(()=>{!a&&!i&&l("/")},[i,a,l]),a)return S.jsx(Wl,{maxW:"container.xl",py:10,children:S.jsx(ar,{justify:"center",align:"center",h:"50vh",children:S.jsx(la,{size:"xl"})})});if(!i)return S.jsx(Wl,{maxW:"container.xl",py:10,children:S.jsxs(Fu,{status:"error",children:[S.jsx(Bu,{}),"You don't have permission to access this page"]})});const _=()=>{switch(n){case"homepage":return S.jsx(nZ,{});case"about":return S.jsx(rGe,{});default:return S.jsx(nZ,{})}};return S.jsxs(S.Fragment,{children:[S.jsx(Y0,{children:S.jsx("title",{children:"Website Content Manager"})}),S.jsxs(Wl,{maxW:"container.xl",py:10,children:[S.jsx(Sr,{as:"h1",mb:6,children:"Website Content Manager"}),S.jsxs(Xk,{templateColumns:"250px 1fr",gap:6,children:[S.jsx(KC,{children:S.jsxs(mr,{align:"stretch",spacing:0,bg:d,borderRadius:"md",borderWidth:"1px",borderColor:f,overflow:"hidden",children:[S.jsx(Zn,{variant:"ghost",justifyContent:"flex-start",py:4,borderBottomWidth:"1px",borderRadius:"0",colorScheme:n==="homepage"?"blue":"gray",bg:n==="homepage"?"blue.50":"transparent",onClick:()=>e("homepage"),children:"Homepage"}),S.jsx(Zn,{variant:"ghost",justifyContent:"flex-start",py:4,borderRadius:"0",colorScheme:n==="about"?"blue":"gray",bg:n==="about"?"blue.50":"transparent",onClick:()=>e("about"),children:"About Page"})]})}),S.jsx(KC,{bg:"white",p:6,borderRadius:"md",borderWidth:"1px",borderColor:f,children:_()})]})]})]})};function oGe(){const e=W0().pathname==="/";return S.jsxs(ar,{direction:"column",minH:"100vh",children:[S.jsx(Mae,{transparent:e}),S.jsx(qe,{as:"main",flex:"1",children:S.jsx(Eve,{})}),S.jsx(Uae,{})]})}const aGe=({children:n})=>{const[e,i]=D.useState(!1),[a,l]=D.useState(!0),d=fN();return D.useEffect(()=>{const f=$ie(d,_=>{i(!!_),l(!1)});return()=>f()},[d]),a?null:e?n:S.jsx(yve,{to:"/",replace:!0})};function cGe(){return S.jsx(qe,{minH:"100vh",children:S.jsxs(Sve,{children:[S.jsxs(qh,{path:"/",element:S.jsx(oGe,{}),children:[S.jsx(qh,{index:!0,element:S.jsx(BWe,{})}),S.jsx(qh,{path:"about",element:S.jsx(WWe,{})}),S.jsx(qh,{path:"spaces",element:S.jsx(JWe,{})}),S.jsx(qh,{path:"contact",element:S.jsx(nGe,{})}),S.jsx(qh,{path:"admin",children:S.jsx(qh,{path:"website",element:S.jsx(aGe,{children:S.jsx(sGe,{})})})})]}),S.jsx(qh,{path:"/w/:spaceSlug",element:S.jsx(G9e,{})}),S.jsx(qh,{path:"/embed/:spaceSlug",element:S.jsx(q9e,{})})]})})}window.Webflow&&window.Webflow.destroy();window.Webflow&&window.Webflow.ready();window.Webflow&&window.Webflow.require("ix2").init();document.dispatchEvent(new Event("readystatechange"));SZ.createRoot(document.getElementById("root")).render(S.jsx(_r.StrictMode,{children:S.jsx(Sne,{theme:jWe,children:S.jsx(aie,{children:S.jsx(Ave,{children:S.jsx(VR,{children:S.jsx(jR,{children:S.jsx(VWe,{children:S.jsx(cGe,{})})})})})})})}));export{uGe as a,obe as b,Li as c,dGe as d,yxe as e,fbe as i,_be as m};
//# sourceMappingURL=main.v0.9.22.js.map
