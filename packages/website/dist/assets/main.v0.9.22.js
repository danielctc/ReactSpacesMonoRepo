var wEe=Object.defineProperty;var CEe=(n,e,i)=>e in n?wEe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i;var Sf=(n,e,i)=>CEe(n,typeof e!="symbol"?e+"":e,i);function REe(n,e){for(var i=0;i<e.length;i++){const a=e[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(a,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var yM={exports:{}},vw={},EM={exports:{}},Er={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kK;function IEe(){if(kK)return Er;kK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),S=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),I=Symbol.iterator;function k(Te){return Te===null||typeof Te!="object"?null:(Te=I&&Te[I]||Te["@@iterator"],typeof Te=="function"?Te:null)}var U={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,F={};function B(Te,ve,Re){this.props=Te,this.context=ve,this.refs=F,this.updater=Re||U}B.prototype.isReactComponent={},B.prototype.setState=function(Te,ve){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,ve,"setState")},B.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function q(){}q.prototype=B.prototype;function $(Te,ve,Re){this.props=Te,this.context=ve,this.refs=F,this.updater=Re||U}var X=$.prototype=new q;X.constructor=$,L(X,B.prototype),X.isPureReactComponent=!0;var oe=Array.isArray,re=Object.prototype.hasOwnProperty,pe={current:null},te={key:!0,ref:!0,__self:!0,__source:!0};function Z(Te,ve,Re){var Me,Ge={},Qe=null,nt=null;if(ve!=null)for(Me in ve.ref!==void 0&&(nt=ve.ref),ve.key!==void 0&&(Qe=""+ve.key),ve)re.call(ve,Me)&&!te.hasOwnProperty(Me)&&(Ge[Me]=ve[Me]);var ht=arguments.length-2;if(ht===1)Ge.children=Re;else if(1<ht){for(var it=Array(ht),It=0;It<ht;It++)it[It]=arguments[It+2];Ge.children=it}if(Te&&Te.defaultProps)for(Me in ht=Te.defaultProps,ht)Ge[Me]===void 0&&(Ge[Me]=ht[Me]);return{$$typeof:n,type:Te,key:Qe,ref:nt,props:Ge,_owner:pe.current}}function ne(Te,ve){return{$$typeof:n,type:Te.type,key:ve,ref:Te.ref,props:Te.props,_owner:Te._owner}}function ae(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===n}function me(Te){var ve={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Re){return ve[Re]})}var he=/\/+/g;function ue(Te,ve){return typeof Te=="object"&&Te!==null&&Te.key!=null?me(""+Te.key):ve.toString(36)}function Ue(Te,ve,Re,Me,Ge){var Qe=typeof Te;(Qe==="undefined"||Qe==="boolean")&&(Te=null);var nt=!1;if(Te===null)nt=!0;else switch(Qe){case"string":case"number":nt=!0;break;case"object":switch(Te.$$typeof){case n:case e:nt=!0}}if(nt)return nt=Te,Ge=Ge(nt),Te=Me===""?"."+ue(nt,0):Me,oe(Ge)?(Re="",Te!=null&&(Re=Te.replace(he,"$&/")+"/"),Ue(Ge,ve,Re,"",function(It){return It})):Ge!=null&&(ae(Ge)&&(Ge=ne(Ge,Re+(!Ge.key||nt&&nt.key===Ge.key?"":(""+Ge.key).replace(he,"$&/")+"/")+Te)),ve.push(Ge)),1;if(nt=0,Me=Me===""?".":Me+":",oe(Te))for(var ht=0;ht<Te.length;ht++){Qe=Te[ht];var it=Me+ue(Qe,ht);nt+=Ue(Qe,ve,Re,it,Ge)}else if(it=k(Te),typeof it=="function")for(Te=it.call(Te),ht=0;!(Qe=Te.next()).done;)Qe=Qe.value,it=Me+ue(Qe,ht++),nt+=Ue(Qe,ve,Re,it,Ge);else if(Qe==="object")throw ve=String(Te),Error("Objects are not valid as a React child (found: "+(ve==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":ve)+"). If you meant to render a collection of children, use an array instead.");return nt}function ze(Te,ve,Re){if(Te==null)return Te;var Me=[],Ge=0;return Ue(Te,Me,"","",function(Qe){return ve.call(Re,Qe,Ge++)}),Me}function tt(Te){if(Te._status===-1){var ve=Te._result;ve=ve(),ve.then(function(Re){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Re)},function(Re){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Re)}),Te._status===-1&&(Te._status=0,Te._result=ve)}if(Te._status===1)return Te._result.default;throw Te._result}var Ce={current:null},Ie={transition:null},ye={ReactCurrentDispatcher:Ce,ReactCurrentBatchConfig:Ie,ReactCurrentOwner:pe};function ke(){throw Error("act(...) is not supported in production builds of React.")}return Er.Children={map:ze,forEach:function(Te,ve,Re){ze(Te,function(){ve.apply(this,arguments)},Re)},count:function(Te){var ve=0;return ze(Te,function(){ve++}),ve},toArray:function(Te){return ze(Te,function(ve){return ve})||[]},only:function(Te){if(!ae(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},Er.Component=B,Er.Fragment=i,Er.Profiler=l,Er.PureComponent=$,Er.StrictMode=a,Er.Suspense=E,Er.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ye,Er.act=ke,Er.cloneElement=function(Te,ve,Re){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Me=L({},Te.props),Ge=Te.key,Qe=Te.ref,nt=Te._owner;if(ve!=null){if(ve.ref!==void 0&&(Qe=ve.ref,nt=pe.current),ve.key!==void 0&&(Ge=""+ve.key),Te.type&&Te.type.defaultProps)var ht=Te.type.defaultProps;for(it in ve)re.call(ve,it)&&!te.hasOwnProperty(it)&&(Me[it]=ve[it]===void 0&&ht!==void 0?ht[it]:ve[it])}var it=arguments.length-2;if(it===1)Me.children=Re;else if(1<it){ht=Array(it);for(var It=0;It<it;It++)ht[It]=arguments[It+2];Me.children=ht}return{$$typeof:n,type:Te.type,key:Ge,ref:Qe,props:Me,_owner:nt}},Er.createContext=function(Te){return Te={$$typeof:f,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:u,_context:Te},Te.Consumer=Te},Er.createElement=Z,Er.createFactory=function(Te){var ve=Z.bind(null,Te);return ve.type=Te,ve},Er.createRef=function(){return{current:null}},Er.forwardRef=function(Te){return{$$typeof:_,render:Te}},Er.isValidElement=ae,Er.lazy=function(Te){return{$$typeof:w,_payload:{_status:-1,_result:Te},_init:tt}},Er.memo=function(Te,ve){return{$$typeof:S,type:Te,compare:ve===void 0?null:ve}},Er.startTransition=function(Te){var ve=Ie.transition;Ie.transition={};try{Te()}finally{Ie.transition=ve}},Er.unstable_act=ke,Er.useCallback=function(Te,ve){return Ce.current.useCallback(Te,ve)},Er.useContext=function(Te){return Ce.current.useContext(Te)},Er.useDebugValue=function(){},Er.useDeferredValue=function(Te){return Ce.current.useDeferredValue(Te)},Er.useEffect=function(Te,ve){return Ce.current.useEffect(Te,ve)},Er.useId=function(){return Ce.current.useId()},Er.useImperativeHandle=function(Te,ve,Re){return Ce.current.useImperativeHandle(Te,ve,Re)},Er.useInsertionEffect=function(Te,ve){return Ce.current.useInsertionEffect(Te,ve)},Er.useLayoutEffect=function(Te,ve){return Ce.current.useLayoutEffect(Te,ve)},Er.useMemo=function(Te,ve){return Ce.current.useMemo(Te,ve)},Er.useReducer=function(Te,ve,Re){return Ce.current.useReducer(Te,ve,Re)},Er.useRef=function(Te){return Ce.current.useRef(Te)},Er.useState=function(Te){return Ce.current.useState(Te)},Er.useSyncExternalStore=function(Te,ve,Re){return Ce.current.useSyncExternalStore(Te,ve,Re)},Er.useTransition=function(){return Ce.current.useTransition()},Er.version="18.3.1",Er}var NK;function Bu(){return NK||(NK=1,EM.exports=IEe()),EM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DK;function AEe(){if(DK)return vw;DK=1;var n=Bu(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function f(_,E,S){var w,I={},k=null,U=null;S!==void 0&&(k=""+S),E.key!==void 0&&(k=""+E.key),E.ref!==void 0&&(U=E.ref);for(w in E)a.call(E,w)&&!u.hasOwnProperty(w)&&(I[w]=E[w]);if(_&&_.defaultProps)for(w in E=_.defaultProps,E)I[w]===void 0&&(I[w]=E[w]);return{$$typeof:e,type:_,key:k,ref:U,props:I,_owner:l.current}}return vw.Fragment=i,vw.jsx=f,vw.jsxs=f,vw}var xK;function PEe(){return xK||(xK=1,yM.exports=AEe()),yM.exports}var b=PEe(),D=Bu();const mr=Jf(D),eV=REe({__proto__:null,default:mr},[D]);var A1={},vM={exports:{}},qc={},SM={exports:{}},bM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LK;function OEe(){return LK||(LK=1,function(n){function e(Ie,ye){var ke=Ie.length;Ie.push(ye);e:for(;0<ke;){var Te=ke-1>>>1,ve=Ie[Te];if(0<l(ve,ye))Ie[Te]=ye,Ie[ke]=ve,ke=Te;else break e}}function i(Ie){return Ie.length===0?null:Ie[0]}function a(Ie){if(Ie.length===0)return null;var ye=Ie[0],ke=Ie.pop();if(ke!==ye){Ie[0]=ke;e:for(var Te=0,ve=Ie.length,Re=ve>>>1;Te<Re;){var Me=2*(Te+1)-1,Ge=Ie[Me],Qe=Me+1,nt=Ie[Qe];if(0>l(Ge,ke))Qe<ve&&0>l(nt,Ge)?(Ie[Te]=nt,Ie[Qe]=ke,Te=Qe):(Ie[Te]=Ge,Ie[Me]=ke,Te=Me);else if(Qe<ve&&0>l(nt,ke))Ie[Te]=nt,Ie[Qe]=ke,Te=Qe;else break e}}return ye}function l(Ie,ye){var ke=Ie.sortIndex-ye.sortIndex;return ke!==0?ke:Ie.id-ye.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,_=f.now();n.unstable_now=function(){return f.now()-_}}var E=[],S=[],w=1,I=null,k=3,U=!1,L=!1,F=!1,B=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(Ie){for(var ye=i(S);ye!==null;){if(ye.callback===null)a(S);else if(ye.startTime<=Ie)a(S),ye.sortIndex=ye.expirationTime,e(E,ye);else break;ye=i(S)}}function oe(Ie){if(F=!1,X(Ie),!L)if(i(E)!==null)L=!0,tt(re);else{var ye=i(S);ye!==null&&Ce(oe,ye.startTime-Ie)}}function re(Ie,ye){L=!1,F&&(F=!1,q(Z),Z=-1),U=!0;var ke=k;try{for(X(ye),I=i(E);I!==null&&(!(I.expirationTime>ye)||Ie&&!me());){var Te=I.callback;if(typeof Te=="function"){I.callback=null,k=I.priorityLevel;var ve=Te(I.expirationTime<=ye);ye=n.unstable_now(),typeof ve=="function"?I.callback=ve:I===i(E)&&a(E),X(ye)}else a(E);I=i(E)}if(I!==null)var Re=!0;else{var Me=i(S);Me!==null&&Ce(oe,Me.startTime-ye),Re=!1}return Re}finally{I=null,k=ke,U=!1}}var pe=!1,te=null,Z=-1,ne=5,ae=-1;function me(){return!(n.unstable_now()-ae<ne)}function he(){if(te!==null){var Ie=n.unstable_now();ae=Ie;var ye=!0;try{ye=te(!0,Ie)}finally{ye?ue():(pe=!1,te=null)}}else pe=!1}var ue;if(typeof $=="function")ue=function(){$(he)};else if(typeof MessageChannel<"u"){var Ue=new MessageChannel,ze=Ue.port2;Ue.port1.onmessage=he,ue=function(){ze.postMessage(null)}}else ue=function(){B(he,0)};function tt(Ie){te=Ie,pe||(pe=!0,ue())}function Ce(Ie,ye){Z=B(function(){Ie(n.unstable_now())},ye)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ie){Ie.callback=null},n.unstable_continueExecution=function(){L||U||(L=!0,tt(re))},n.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<Ie?Math.floor(1e3/Ie):5},n.unstable_getCurrentPriorityLevel=function(){return k},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(Ie){switch(k){case 1:case 2:case 3:var ye=3;break;default:ye=k}var ke=k;k=ye;try{return Ie()}finally{k=ke}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ie,ye){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var ke=k;k=Ie;try{return ye()}finally{k=ke}},n.unstable_scheduleCallback=function(Ie,ye,ke){var Te=n.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?Te+ke:Te):ke=Te,Ie){case 1:var ve=-1;break;case 2:ve=250;break;case 5:ve=1073741823;break;case 4:ve=1e4;break;default:ve=5e3}return ve=ke+ve,Ie={id:w++,callback:ye,priorityLevel:Ie,startTime:ke,expirationTime:ve,sortIndex:-1},ke>Te?(Ie.sortIndex=ke,e(S,Ie),i(E)===null&&Ie===i(S)&&(F?(q(Z),Z=-1):F=!0,Ce(oe,ke-Te))):(Ie.sortIndex=ve,e(E,Ie),L||U||(L=!0,tt(re))),Ie},n.unstable_shouldYield=me,n.unstable_wrapCallback=function(Ie){var ye=k;return function(){var ke=k;k=ye;try{return Ie.apply(this,arguments)}finally{k=ke}}}}(bM)),bM}var MK;function kEe(){return MK||(MK=1,SM.exports=OEe()),SM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UK;function NEe(){if(UK)return qc;UK=1;var n=Bu(),e=kEe();function i(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,C=1;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function u(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,S=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,w={},I={};function k(p){return E.call(I,p)?!0:E.call(w,p)?!1:S.test(p)?I[p]=!0:(w[p]=!0,!1)}function U(p,g,C,O){if(C!==null&&C.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:C!==null?!C.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function L(p,g,C,O){if(g===null||typeof g>"u"||U(p,g,C,O))return!0;if(O)return!1;if(C!==null)switch(C.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function F(p,g,C,O,V,H,ce){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=V,this.mustUseProperty=C,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ce}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new F(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];B[g]=new F(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new F(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new F(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new F(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new F(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new F(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new F(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new F(p,5,!1,p.toLowerCase(),null,!1,!1)});var q=/[\-:]([a-z])/g;function $(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(q,$);B[g]=new F(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(q,$);B[g]=new F(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(q,$);B[g]=new F(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new F(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new F(p,1,!1,p.toLowerCase(),null,!0,!0)});function X(p,g,C,O){var V=B.hasOwnProperty(g)?B[g]:null;(V!==null?V.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(L(g,C,V,O)&&(C=null),O||V===null?k(g)&&(C===null?p.removeAttribute(g):p.setAttribute(g,""+C)):V.mustUseProperty?p[V.propertyName]=C===null?V.type===3?!1:"":C:(g=V.attributeName,O=V.attributeNamespace,C===null?p.removeAttribute(g):(V=V.type,C=V===3||V===4&&C===!0?"":""+C,O?p.setAttributeNS(O,g,C):p.setAttribute(g,C))))}var oe=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,re=Symbol.for("react.element"),pe=Symbol.for("react.portal"),te=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),ne=Symbol.for("react.profiler"),ae=Symbol.for("react.provider"),me=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Ue=Symbol.for("react.suspense_list"),ze=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),Ce=Symbol.for("react.offscreen"),Ie=Symbol.iterator;function ye(p){return p===null||typeof p!="object"?null:(p=Ie&&p[Ie]||p["@@iterator"],typeof p=="function"?p:null)}var ke=Object.assign,Te;function ve(p){if(Te===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+p}var Re=!1;function Me(p,g){if(!p||Re)return"";Re=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(st){var O=st}Reflect.construct(p,[],g)}else{try{g.call()}catch(st){O=st}p.call(g.prototype)}else{try{throw Error()}catch(st){O=st}p()}}catch(st){if(st&&O&&typeof st.stack=="string"){for(var V=st.stack.split(`
`),H=O.stack.split(`
`),ce=V.length-1,Ae=H.length-1;1<=ce&&0<=Ae&&V[ce]!==H[Ae];)Ae--;for(;1<=ce&&0<=Ae;ce--,Ae--)if(V[ce]!==H[Ae]){if(ce!==1||Ae!==1)do if(ce--,Ae--,0>Ae||V[ce]!==H[Ae]){var Le=`
`+V[ce].replace(" at new "," at ");return p.displayName&&Le.includes("<anonymous>")&&(Le=Le.replace("<anonymous>",p.displayName)),Le}while(1<=ce&&0<=Ae);break}}}finally{Re=!1,Error.prepareStackTrace=C}return(p=p?p.displayName||p.name:"")?ve(p):""}function Ge(p){switch(p.tag){case 5:return ve(p.type);case 16:return ve("Lazy");case 13:return ve("Suspense");case 19:return ve("SuspenseList");case 0:case 2:case 15:return p=Me(p.type,!1),p;case 11:return p=Me(p.type.render,!1),p;case 1:return p=Me(p.type,!0),p;default:return""}}function Qe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case te:return"Fragment";case pe:return"Portal";case ne:return"Profiler";case Z:return"StrictMode";case ue:return"Suspense";case Ue:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case me:return(p.displayName||"Context")+".Consumer";case ae:return(p._context.displayName||"Context")+".Provider";case he:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case ze:return g=p.displayName||null,g!==null?g:Qe(p.type)||"Memo";case tt:g=p._payload,p=p._init;try{return Qe(p(g))}catch{}}return null}function nt(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qe(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ht(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function it(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function It(p){var g=it(p)?"checked":"value",C=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var V=C.get,H=C.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return V.call(this)},set:function(ce){O=""+ce,H.call(this,ce)}}),Object.defineProperty(p,g,{enumerable:C.enumerable}),{getValue:function(){return O},setValue:function(ce){O=""+ce},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function jt(p){p._valueTracker||(p._valueTracker=It(p))}function Dt(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var C=g.getValue(),O="";return p&&(O=it(p)?p.checked?"true":"false":p.value),p=O,p!==C?(g.setValue(p),!0):!1}function an(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function jn(p,g){var C=g.checked;return ke({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:C??p._wrapperState.initialChecked})}function Qt(p,g){var C=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;C=ht(g.value!=null?g.value:C),p._wrapperState={initialChecked:O,initialValue:C,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Ot(p,g){g=g.checked,g!=null&&X(p,"checked",g,!1)}function Lt(p,g){Ot(p,g);var C=ht(g.value),O=g.type;if(C!=null)O==="number"?(C===0&&p.value===""||p.value!=C)&&(p.value=""+C):p.value!==""+C&&(p.value=""+C);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Ve(p,g.type,C):g.hasOwnProperty("defaultValue")&&Ve(p,g.type,ht(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function we(p,g,C){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,C||g===p.value||(p.value=g),p.defaultValue=g}C=p.name,C!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,C!==""&&(p.name=C)}function Ve(p,g,C){(g!=="number"||an(p.ownerDocument)!==p)&&(C==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+C&&(p.defaultValue=""+C))}var $e=Array.isArray;function _t(p,g,C,O){if(p=p.options,g){g={};for(var V=0;V<C.length;V++)g["$"+C[V]]=!0;for(C=0;C<p.length;C++)V=g.hasOwnProperty("$"+p[C].value),p[C].selected!==V&&(p[C].selected=V),V&&O&&(p[C].defaultSelected=!0)}else{for(C=""+ht(C),g=null,V=0;V<p.length;V++){if(p[V].value===C){p[V].selected=!0,O&&(p[V].defaultSelected=!0);return}g!==null||p[V].disabled||(g=p[V])}g!==null&&(g.selected=!0)}}function vt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return ke({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function St(p,g){var C=g.value;if(C==null){if(C=g.children,g=g.defaultValue,C!=null){if(g!=null)throw Error(i(92));if($e(C)){if(1<C.length)throw Error(i(93));C=C[0]}g=C}g==null&&(g=""),C=g}p._wrapperState={initialValue:ht(C)}}function Ht(p,g){var C=ht(g.value),O=ht(g.defaultValue);C!=null&&(C=""+C,C!==p.value&&(p.value=C),g.defaultValue==null&&p.defaultValue!==C&&(p.defaultValue=C)),O!=null&&(p.defaultValue=""+O)}function fn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function mn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jt(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?mn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Hn,fc=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,C,O,V){MSApp.execUnsafeLocalFunction(function(){return p(g,C,O,V)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Hn=Hn||document.createElement("div"),Hn.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Hn.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Bt(p,g){if(g){var C=p.firstChild;if(C&&C===p.lastChild&&C.nodeType===3){C.nodeValue=g;return}}p.textContent=g}var un={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rs=["Webkit","ms","Moz","O"];Object.keys(un).forEach(function(p){rs.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),un[g]=un[p]})});function Fs(p,g,C){return g==null||typeof g=="boolean"||g===""?"":C||typeof g!="number"||g===0||un.hasOwnProperty(p)&&un[p]?(""+g).trim():g+"px"}function Qs(p,g){p=p.style;for(var C in g)if(g.hasOwnProperty(C)){var O=C.indexOf("--")===0,V=Fs(C,g[C],O);C==="float"&&(C="cssFloat"),O?p.setProperty(C,V):p[C]=V}}var Ei=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wa(p,g){if(g){if(Ei[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function dl(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _o=null;function yo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Kl=null,Bs=null,mc=null;function ua(p){if(p=_m(p)){if(typeof Kl!="function")throw Error(i(280));var g=p.stateNode;g&&(g=ym(g),Kl(p.stateNode,p.type,g))}}function gc(p){Bs?mc?mc.push(p):mc=[p]:Bs=p}function hl(){if(Bs){var p=Bs,g=mc;if(mc=Bs=null,ua(p),g)for(p=0;p<g.length;p++)ua(g[p])}}function Ku(p,g){return p(g)}function _c(){}var pl=!1;function Do(p,g,C){if(pl)return p(g,C);pl=!0;try{return Ku(p,g,C)}finally{pl=!1,(Bs!==null||mc!==null)&&(_c(),hl())}}function Mi(p,g){var C=p.stateNode;if(C===null)return null;var O=ym(C);if(O===null)return null;C=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(C&&typeof C!="function")throw Error(i(231,g,typeof C));return C}var ds=!1;if(_)try{var za={};Object.defineProperty(za,"passive",{get:function(){ds=!0}}),window.addEventListener("test",za,za),window.removeEventListener("test",za,za)}catch{ds=!1}function qu(p,g,C,O,V,H,ce,Ae,Le){var st=Array.prototype.slice.call(arguments,3);try{g.apply(C,st)}catch(At){this.onError(At)}}var yc=!1,da=null,ha=!1,Qd=null,Zg={onError:function(p){yc=!0,da=p}};function Yu(p,g,C,O,V,H,ce,Ae,Le){yc=!1,da=null,qu.apply(Zg,arguments)}function wp(p,g,C,O,V,H,ce,Ae,Le){if(Yu.apply(this,arguments),yc){if(yc){var st=da;yc=!1,da=null}else throw Error(i(198));ha||(ha=!0,Qd=st)}}function Ws(p){var g=p,C=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(C=g.return),p=g.return;while(p)}return g.tag===3?C:null}function Xu(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function pa(p){if(Ws(p)!==p)throw Error(i(188))}function Zd(p){var g=p.alternate;if(!g){if(g=Ws(p),g===null)throw Error(i(188));return g!==p?null:p}for(var C=p,O=g;;){var V=C.return;if(V===null)break;var H=V.alternate;if(H===null){if(O=V.return,O!==null){C=O;continue}break}if(V.child===H.child){for(H=V.child;H;){if(H===C)return pa(V),p;if(H===O)return pa(V),g;H=H.sibling}throw Error(i(188))}if(C.return!==O.return)C=V,O=H;else{for(var ce=!1,Ae=V.child;Ae;){if(Ae===C){ce=!0,C=V,O=H;break}if(Ae===O){ce=!0,O=V,C=H;break}Ae=Ae.sibling}if(!ce){for(Ae=H.child;Ae;){if(Ae===C){ce=!0,C=H,O=V;break}if(Ae===O){ce=!0,O=H,C=V;break}Ae=Ae.sibling}if(!ce)throw Error(i(189))}}if(C.alternate!==O)throw Error(i(190))}if(C.tag!==3)throw Error(i(188));return C.stateNode.current===C?p:g}function eh(p){return p=Zd(p),p!==null?Ga(p):null}function Ga(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=Ga(p);if(g!==null)return g;p=p.sibling}return null}var th=e.unstable_scheduleCallback,Ju=e.unstable_cancelCallback,xo=e.unstable_shouldYield,nh=e.unstable_requestPaint,$r=e.unstable_now,vi=e.unstable_getCurrentPriorityLevel,Ec=e.unstable_ImmediatePriority,fl=e.unstable_UserBlockingPriority,fa=e.unstable_NormalPriority,Cp=e.unstable_LowPriority,rh=e.unstable_IdlePriority,ql=null,Eo=null;function nm(p){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(ql,p,void 0,(p.current.flags&128)===128)}catch{}}var Zs=Math.clz32?Math.clz32:ih,Rp=Math.log,ml=Math.LN2;function ih(p){return p>>>=0,p===0?32:31-(Rp(p)/ml|0)|0}var sh=64,_r=4194304;function Yl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Xl(p,g){var C=p.pendingLanes;if(C===0)return 0;var O=0,V=p.suspendedLanes,H=p.pingedLanes,ce=C&268435455;if(ce!==0){var Ae=ce&~V;Ae!==0?O=Yl(Ae):(H&=ce,H!==0&&(O=Yl(H)))}else ce=C&~V,ce!==0?O=Yl(ce):H!==0&&(O=Yl(H));if(O===0)return 0;if(g!==0&&g!==O&&(g&V)===0&&(V=O&-O,H=g&-g,V>=H||V===16&&(H&4194240)!==0))return g;if((O&4)!==0&&(O|=C&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)C=31-Zs(g),V=1<<C,O|=p[C],g&=~V;return O}function Qu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ha(p,g){for(var C=p.suspendedLanes,O=p.pingedLanes,V=p.expirationTimes,H=p.pendingLanes;0<H;){var ce=31-Zs(H),Ae=1<<ce,Le=V[ce];Le===-1?((Ae&C)===0||(Ae&O)!==0)&&(V[ce]=Qu(Ae,g)):Le<=g&&(p.expiredLanes|=Ae),H&=~Ae}}function Lo(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Zu(){var p=sh;return sh<<=1,(sh&4194240)===0&&(sh=64),p}function gl(p){for(var g=[],C=0;31>C;C++)g.push(p);return g}function Jl(p,g,C){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-Zs(g),p[g]=C}function Xr(p,g){var C=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<C;){var V=31-Zs(C),H=1<<V;g[V]=0,O[V]=-1,p[V]=-1,C&=~H}}function $a(p,g){var C=p.entangledLanes|=g;for(p=p.entanglements;C;){var O=31-Zs(C),V=1<<O;V&g|p[O]&g&&(p[O]|=g),C&=~V}}var ar=0;function vc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var rm,Ql,oh,Ip,im,Ap=!1,Mo=[],is=null,Uo=null,Vo=null,Zl=new Map,jo=new Map,Fo=[],sm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(p,g){switch(p){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":Uo=null;break;case"mouseover":case"mouseout":Vo=null;break;case"pointerover":case"pointerout":Zl.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":jo.delete(g.pointerId)}}function hs(p,g,C,O,V,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:C,eventSystemFlags:O,nativeEvent:H,targetContainers:[V]},g!==null&&(g=_m(g),g!==null&&Ql(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),p)}function ed(p,g,C,O,V){switch(g){case"focusin":return is=hs(is,p,g,C,O,V),!0;case"dragenter":return Uo=hs(Uo,p,g,C,O,V),!0;case"mouseover":return Vo=hs(Vo,p,g,C,O,V),!0;case"pointerover":var H=V.pointerId;return Zl.set(H,hs(Zl.get(H)||null,p,g,C,O,V)),!0;case"gotpointercapture":return H=V.pointerId,jo.set(H,hs(jo.get(H)||null,p,g,C,O,V)),!0}return!1}function Pp(p){var g=Up(p.target);if(g!==null){var C=Ws(g);if(C!==null){if(g=C.tag,g===13){if(g=Xu(C),g!==null){p.blockedOn=g,im(p.priority,function(){oh(C)});return}}else if(g===3&&C.stateNode.current.memoizedState.isDehydrated){p.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}p.blockedOn=null}function _l(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var C=Tr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(C===null){C=p.nativeEvent;var O=new C.constructor(C.type,C);_o=O,C.target.dispatchEvent(O),_o=null}else return g=_m(C),g!==null&&Ql(g),p.blockedOn=C,!1;g.shift()}return!0}function eu(p,g,C){_l(p)&&C.delete(g)}function om(){Ap=!1,is!==null&&_l(is)&&(is=null),Uo!==null&&_l(Uo)&&(Uo=null),Vo!==null&&_l(Vo)&&(Vo=null),Zl.forEach(eu),jo.forEach(eu)}function ma(p,g){p.blockedOn===g&&(p.blockedOn=null,Ap||(Ap=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,om)))}function ga(p){function g(V){return ma(V,p)}if(0<Mo.length){ma(Mo[0],p);for(var C=1;C<Mo.length;C++){var O=Mo[C];O.blockedOn===p&&(O.blockedOn=null)}}for(is!==null&&ma(is,p),Uo!==null&&ma(Uo,p),Vo!==null&&ma(Vo,p),Zl.forEach(g),jo.forEach(g),C=0;C<Fo.length;C++)O=Fo[C],O.blockedOn===p&&(O.blockedOn=null);for(;0<Fo.length&&(C=Fo[0],C.blockedOn===null);)Pp(C),C.blockedOn===null&&Fo.shift()}var yl=oe.ReactCurrentBatchConfig,Se=!0;function De(p,g,C,O){var V=ar,H=yl.transition;yl.transition=null;try{ar=1,Yt(p,g,C,O)}finally{ar=V,yl.transition=H}}function rt(p,g,C,O){var V=ar,H=yl.transition;yl.transition=null;try{ar=4,Yt(p,g,C,O)}finally{ar=V,yl.transition=H}}function Yt(p,g,C,O){if(Se){var V=Tr(p,g,C,O);if(V===null)SE(p,g,O,Xn,C),Sc(p,O);else if(ed(V,p,g,C,O))O.stopPropagation();else if(Sc(p,O),g&4&&-1<sm.indexOf(p)){for(;V!==null;){var H=_m(V);if(H!==null&&rm(H),H=Tr(p,g,C,O),H===null&&SE(p,g,O,Xn,C),H===V)break;V=H}V!==null&&O.stopPropagation()}else SE(p,g,O,null,C)}}var Xn=null;function Tr(p,g,C,O){if(Xn=null,p=yo(O),p=Up(p),p!==null)if(g=Ws(p),g===null)p=null;else if(C=g.tag,C===13){if(p=Xu(g),p!==null)return p;p=null}else if(C===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Xn=p,null}function Kr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vi()){case Ec:return 1;case fl:return 4;case fa:case Cp:return 16;case rh:return 536870912;default:return 16}default:return 16}}var dn=null,jr=null,Si=null;function Ps(){if(Si)return Si;var p,g=jr,C=g.length,O,V="value"in dn?dn.value:dn.textContent,H=V.length;for(p=0;p<C&&g[p]===V[p];p++);var ce=C-p;for(O=1;O<=ce&&g[C-O]===V[H-O];O++);return Si=V.slice(p,1<O?1-O:void 0)}function Bo(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function Wo(){return!0}function td(){return!1}function Ji(p){function g(C,O,V,H,ce){this._reactName=C,this._targetInst=V,this.type=O,this.nativeEvent=H,this.target=ce,this.currentTarget=null;for(var Ae in p)p.hasOwnProperty(Ae)&&(C=p[Ae],this[Ae]=C?C(H):H[Ae]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?Wo:td,this.isPropagationStopped=td,this}return ke(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=Wo)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=Wo)},persist:function(){},isPersistent:Wo}),g}var El={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ah=Ji(El),bc=ke({},El,{view:0,detail:0}),e_=Ji(bc),am,nd,zo,tu=ke({},bc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==zo&&(zo&&p.type==="mousemove"?(am=p.screenX-zo.screenX,nd=p.screenY-zo.screenY):nd=am=0,zo=p),am)},movementY:function(p){return"movementY"in p?p.movementY:nd}}),cm=Ji(tu),t_=ke({},tu,{dataTransfer:0}),pE=Ji(t_),lm=ke({},bc,{relatedTarget:0}),um=Ji(lm),rd=ke({},El,{animationName:0,elapsedTime:0,pseudoElement:0}),id=Ji(rd),sd=ke({},El,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),n_=Ji(sd),fE=ke({},El,{data:0}),Fn=Ji(fE),dm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Go={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=mE[p])?!!g[p]:!1}function Tc(){return gE}var A=ke({},bc,{key:function(p){if(p.key){var g=dm[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=Bo(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Go[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tc,charCode:function(p){return p.type==="keypress"?Bo(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Bo(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),z=Ji(A),ee=ke({},tu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fe=Ji(ee),Ke=ke({},bc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tc}),ct=Ji(Ke),Ut=ke({},El,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jr=Ji(Ut),hi=ke({},tu,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),wr=Ji(hi),zs=[9,13,27,32],ps=_&&"CompositionEvent"in window,Ka=null;_&&"documentMode"in document&&(Ka=document.documentMode);var Ho=_&&"TextEvent"in window&&!Ka,Op=_&&(!ps||Ka&&8<Ka&&11>=Ka),hm=" ",qa=!1;function zR(p,g){switch(p){case"keyup":return zs.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function GR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var pm=!1;function KN(p,g){switch(p){case"compositionend":return GR(g);case"keypress":return g.which!==32?null:(qa=!0,hm);case"textInput":return p=g.data,p===hm&&qa?null:p;default:return null}}function HR(p,g){if(pm)return p==="compositionend"||!ps&&zR(p,g)?(p=Ps(),Si=jr=dn=null,pm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Op&&g.locale!=="ko"?null:g.data;default:return null}}var qN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $R(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!qN[p.type]:g==="textarea"}function ib(p,g,C,O){gc(O),g=bE(g,"onChange"),0<g.length&&(C=new ah("onChange","change",null,C,O),p.push({event:C,listeners:g}))}var kp=null,r_=null;function YN(p){db(p,0)}function Np(p){var g=Vp(p);if(Dt(g))return p}function XN(p,g){if(p==="change")return g}var KR=!1;if(_){var sb;if(_){var wc="oninput"in document;if(!wc){var qR=document.createElement("div");qR.setAttribute("oninput","return;"),wc=typeof qR.oninput=="function"}sb=wc}else sb=!1;KR=sb&&(!document.documentMode||9<document.documentMode)}function YR(){kp&&(kp.detachEvent("onpropertychange",_a),r_=kp=null)}function _a(p){if(p.propertyName==="value"&&Np(r_)){var g=[];ib(g,r_,p,yo(p)),Do(YN,g)}}function JN(p,g,C){p==="focusin"?(YR(),kp=g,r_=C,kp.attachEvent("onpropertychange",_a)):p==="focusout"&&YR()}function QN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Np(r_)}function ZN(p,g){if(p==="click")return Np(g)}function eD(p,g){if(p==="input"||p==="change")return Np(g)}function XR(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var vl=typeof Object.is=="function"?Object.is:XR;function i_(p,g){if(vl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var C=Object.keys(p),O=Object.keys(g);if(C.length!==O.length)return!1;for(O=0;O<C.length;O++){var V=C[O];if(!E.call(g,V)||!vl(p[V],g[V]))return!1}return!0}function JR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function ob(p,g){var C=JR(p);p=0;for(var O;C;){if(C.nodeType===3){if(O=p+C.textContent.length,p<=g&&O>=g)return{node:C,offset:g-p};p=O}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=JR(C)}}function QR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?QR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function ZR(){for(var p=window,g=an();g instanceof p.HTMLIFrameElement;){try{var C=typeof g.contentWindow.location.href=="string"}catch{C=!1}if(C)p=g.contentWindow;else break;g=an(p.document)}return g}function s_(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function ab(p){var g=ZR(),C=p.focusedElem,O=p.selectionRange;if(g!==C&&C&&C.ownerDocument&&QR(C.ownerDocument.documentElement,C)){if(O!==null&&s_(C)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in C)C.selectionStart=g,C.selectionEnd=Math.min(p,C.value.length);else if(p=(g=C.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var V=C.textContent.length,H=Math.min(O.start,V);O=O.end===void 0?H:Math.min(O.end,V),!p.extend&&H>O&&(V=O,O=H,H=V),V=ob(C,H);var ce=ob(C,O);V&&ce&&(p.rangeCount!==1||p.anchorNode!==V.node||p.anchorOffset!==V.offset||p.focusNode!==ce.node||p.focusOffset!==ce.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),p.removeAllRanges(),H>O?(p.addRange(g),p.extend(ce.node,ce.offset)):(g.setEnd(ce.node,ce.offset),p.addRange(g)))}}for(g=[],p=C;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<g.length;C++)p=g[C],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var tD=_&&"documentMode"in document&&11>=document.documentMode,at=null,cb=null,o_=null,lb=!1;function eI(p,g,C){var O=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;lb||at==null||at!==an(O)||(O=at,"selectionStart"in O&&s_(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),o_&&i_(o_,O)||(o_=O,O=bE(cb,"onSelect"),0<O.length&&(g=new ah("onSelect","select",null,g,C),p.push({event:g,listeners:O}),g.target=at)))}function _E(p,g){var C={};return C[p.toLowerCase()]=g.toLowerCase(),C["Webkit"+p]="webkit"+g,C["Moz"+p]="moz"+g,C}var fm={animationend:_E("Animation","AnimationEnd"),animationiteration:_E("Animation","AnimationIteration"),animationstart:_E("Animation","AnimationStart"),transitionend:_E("Transition","TransitionEnd")},ub={},tI={};_&&(tI=document.createElement("div").style,"AnimationEvent"in window||(delete fm.animationend.animation,delete fm.animationiteration.animation,delete fm.animationstart.animation),"TransitionEvent"in window||delete fm.transitionend.transition);function Dp(p){if(ub[p])return ub[p];if(!fm[p])return p;var g=fm[p],C;for(C in g)if(g.hasOwnProperty(C)&&C in tI)return ub[p]=g[C];return p}var xp=Dp("animationend"),nI=Dp("animationiteration"),rI=Dp("animationstart"),iI=Dp("transitionend"),sI=new Map,yE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ch(p,g){sI.set(p,g),u(g,[p])}for(var EE=0;EE<yE.length;EE++){var Ya=yE[EE],nD=Ya.toLowerCase(),a_=Ya[0].toUpperCase()+Ya.slice(1);ch(nD,"on"+a_)}ch(xp,"onAnimationEnd"),ch(nI,"onAnimationIteration"),ch(rI,"onAnimationStart"),ch("dblclick","onDoubleClick"),ch("focusin","onFocus"),ch("focusout","onBlur"),ch(iI,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var c_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rD=new Set("cancel close invalid load scroll toggle".split(" ").concat(c_));function oI(p,g,C){var O=p.type||"unknown-event";p.currentTarget=C,wp(O,g,void 0,p),p.currentTarget=null}function db(p,g){g=(g&4)!==0;for(var C=0;C<p.length;C++){var O=p[C],V=O.event;O=O.listeners;e:{var H=void 0;if(g)for(var ce=O.length-1;0<=ce;ce--){var Ae=O[ce],Le=Ae.instance,st=Ae.currentTarget;if(Ae=Ae.listener,Le!==H&&V.isPropagationStopped())break e;oI(V,Ae,st),H=Le}else for(ce=0;ce<O.length;ce++){if(Ae=O[ce],Le=Ae.instance,st=Ae.currentTarget,Ae=Ae.listener,Le!==H&&V.isPropagationStopped())break e;oI(V,Ae,st),H=Le}}}if(ha)throw p=Qd,ha=!1,Qd=null,p}function Ai(p,g){var C=g[h_];C===void 0&&(C=g[h_]=new Set);var O=p+"__bubble";C.has(O)||(aI(g,p,2,!1),C.add(O))}function hb(p,g,C){var O=0;g&&(O|=4),aI(C,p,O,g)}var vE="_reactListening"+Math.random().toString(36).slice(2);function Lp(p){if(!p[vE]){p[vE]=!0,a.forEach(function(C){C!=="selectionchange"&&(rD.has(C)||hb(C,!1,p),hb(C,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[vE]||(g[vE]=!0,hb("selectionchange",!1,g))}}function aI(p,g,C,O){switch(Kr(g)){case 1:var V=De;break;case 4:V=rt;break;default:V=Yt}C=V.bind(null,g,C,p),V=void 0,!ds||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),O?V!==void 0?p.addEventListener(g,C,{capture:!0,passive:V}):p.addEventListener(g,C,!0):V!==void 0?p.addEventListener(g,C,{passive:V}):p.addEventListener(g,C,!1)}function SE(p,g,C,O,V){var H=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ce=O.tag;if(ce===3||ce===4){var Ae=O.stateNode.containerInfo;if(Ae===V||Ae.nodeType===8&&Ae.parentNode===V)break;if(ce===4)for(ce=O.return;ce!==null;){var Le=ce.tag;if((Le===3||Le===4)&&(Le=ce.stateNode.containerInfo,Le===V||Le.nodeType===8&&Le.parentNode===V))return;ce=ce.return}for(;Ae!==null;){if(ce=Up(Ae),ce===null)return;if(Le=ce.tag,Le===5||Le===6){O=H=ce;continue e}Ae=Ae.parentNode}}O=O.return}Do(function(){var st=H,At=yo(C),Pt=[];e:{var Rt=sI.get(p);if(Rt!==void 0){var Kt=ah,tn=p;switch(p){case"keypress":if(Bo(C)===0)break e;case"keydown":case"keyup":Kt=z;break;case"focusin":tn="focus",Kt=um;break;case"focusout":tn="blur",Kt=um;break;case"beforeblur":case"afterblur":Kt=um;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Kt=cm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Kt=pE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Kt=ct;break;case xp:case nI:case rI:Kt=id;break;case iI:Kt=Jr;break;case"scroll":Kt=e_;break;case"wheel":Kt=wr;break;case"copy":case"cut":case"paste":Kt=n_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Kt=fe}var nn=(g&4)!==0,Zi=!nn&&p==="scroll",Ye=nn?Rt!==null?Rt+"Capture":null:Rt;nn=[];for(var je=st,Ze;je!==null;){Ze=je;var xt=Ze.stateNode;if(Ze.tag===5&&xt!==null&&(Ze=xt,Ye!==null&&(xt=Mi(je,Ye),xt!=null&&nn.push(mm(je,xt,Ze)))),Zi)break;je=je.return}0<nn.length&&(Rt=new Kt(Rt,tn,null,C,At),Pt.push({event:Rt,listeners:nn}))}}if((g&7)===0){e:{if(Rt=p==="mouseover"||p==="pointerover",Kt=p==="mouseout"||p==="pointerout",Rt&&C!==_o&&(tn=C.relatedTarget||C.fromElement)&&(Up(tn)||tn[Cc]))break e;if((Kt||Rt)&&(Rt=At.window===At?At:(Rt=At.ownerDocument)?Rt.defaultView||Rt.parentWindow:window,Kt?(tn=C.relatedTarget||C.toElement,Kt=st,tn=tn?Up(tn):null,tn!==null&&(Zi=Ws(tn),tn!==Zi||tn.tag!==5&&tn.tag!==6)&&(tn=null)):(Kt=null,tn=st),Kt!==tn)){if(nn=cm,xt="onMouseLeave",Ye="onMouseEnter",je="mouse",(p==="pointerout"||p==="pointerover")&&(nn=fe,xt="onPointerLeave",Ye="onPointerEnter",je="pointer"),Zi=Kt==null?Rt:Vp(Kt),Ze=tn==null?Rt:Vp(tn),Rt=new nn(xt,je+"leave",Kt,C,At),Rt.target=Zi,Rt.relatedTarget=Ze,xt=null,Up(At)===st&&(nn=new nn(Ye,je+"enter",tn,C,At),nn.target=Ze,nn.relatedTarget=Zi,xt=nn),Zi=xt,Kt&&tn)t:{for(nn=Kt,Ye=tn,je=0,Ze=nn;Ze;Ze=Mp(Ze))je++;for(Ze=0,xt=Ye;xt;xt=Mp(xt))Ze++;for(;0<je-Ze;)nn=Mp(nn),je--;for(;0<Ze-je;)Ye=Mp(Ye),Ze--;for(;je--;){if(nn===Ye||Ye!==null&&nn===Ye.alternate)break t;nn=Mp(nn),Ye=Mp(Ye)}nn=null}else nn=null;Kt!==null&&l_(Pt,Rt,Kt,nn,!1),tn!==null&&Zi!==null&&l_(Pt,Zi,tn,nn,!0)}}e:{if(Rt=st?Vp(st):window,Kt=Rt.nodeName&&Rt.nodeName.toLowerCase(),Kt==="select"||Kt==="input"&&Rt.type==="file")var rn=XN;else if($R(Rt))if(KR)rn=eD;else{rn=QN;var gn=JN}else(Kt=Rt.nodeName)&&Kt.toLowerCase()==="input"&&(Rt.type==="checkbox"||Rt.type==="radio")&&(rn=ZN);if(rn&&(rn=rn(p,st))){ib(Pt,rn,C,At);break e}gn&&gn(p,Rt,st),p==="focusout"&&(gn=Rt._wrapperState)&&gn.controlled&&Rt.type==="number"&&Ve(Rt,"number",Rt.value)}switch(gn=st?Vp(st):window,p){case"focusin":($R(gn)||gn.contentEditable==="true")&&(at=gn,cb=st,o_=null);break;case"focusout":o_=cb=at=null;break;case"mousedown":lb=!0;break;case"contextmenu":case"mouseup":case"dragend":lb=!1,eI(Pt,C,At);break;case"selectionchange":if(tD)break;case"keydown":case"keyup":eI(Pt,C,At)}var vn;if(ps)e:{switch(p){case"compositionstart":var Ln="onCompositionStart";break e;case"compositionend":Ln="onCompositionEnd";break e;case"compositionupdate":Ln="onCompositionUpdate";break e}Ln=void 0}else pm?zR(p,C)&&(Ln="onCompositionEnd"):p==="keydown"&&C.keyCode===229&&(Ln="onCompositionStart");Ln&&(Op&&C.locale!=="ko"&&(pm||Ln!=="onCompositionStart"?Ln==="onCompositionEnd"&&pm&&(vn=Ps()):(dn=At,jr="value"in dn?dn.value:dn.textContent,pm=!0)),gn=bE(st,Ln),0<gn.length&&(Ln=new Fn(Ln,p,null,C,At),Pt.push({event:Ln,listeners:gn}),vn?Ln.data=vn:(vn=GR(C),vn!==null&&(Ln.data=vn)))),(vn=Ho?KN(p,C):HR(p,C))&&(st=bE(st,"onBeforeInput"),0<st.length&&(At=new Fn("onBeforeInput","beforeinput",null,C,At),Pt.push({event:At,listeners:st}),At.data=vn))}db(Pt,g)})}function mm(p,g,C){return{instance:p,listener:g,currentTarget:C}}function bE(p,g){for(var C=g+"Capture",O=[];p!==null;){var V=p,H=V.stateNode;V.tag===5&&H!==null&&(V=H,H=Mi(p,C),H!=null&&O.unshift(mm(p,H,V)),H=Mi(p,g),H!=null&&O.push(mm(p,H,V))),p=p.return}return O}function Mp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function l_(p,g,C,O,V){for(var H=g._reactName,ce=[];C!==null&&C!==O;){var Ae=C,Le=Ae.alternate,st=Ae.stateNode;if(Le!==null&&Le===O)break;Ae.tag===5&&st!==null&&(Ae=st,V?(Le=Mi(C,H),Le!=null&&ce.unshift(mm(C,Le,Ae))):V||(Le=Mi(C,H),Le!=null&&ce.push(mm(C,Le,Ae)))),C=C.return}ce.length!==0&&p.push({event:g,listeners:ce})}var iD=/\r\n?/g,sD=/\u0000|\uFFFD/g;function cI(p){return(typeof p=="string"?p:""+p).replace(iD,`
`).replace(sD,"")}function TE(p,g,C){if(g=cI(g),cI(p)!==g&&C)throw Error(i(425))}function wE(){}var CE=null,u_=null;function pb(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var d_=typeof setTimeout=="function"?setTimeout:void 0,oD=typeof clearTimeout=="function"?clearTimeout:void 0,lI=typeof Promise=="function"?Promise:void 0,aD=typeof queueMicrotask=="function"?queueMicrotask:typeof lI<"u"?function(p){return lI.resolve(null).then(p).catch(cD)}:d_;function cD(p){setTimeout(function(){throw p})}function fb(p,g){var C=g,O=0;do{var V=C.nextSibling;if(p.removeChild(C),V&&V.nodeType===8)if(C=V.data,C==="/$"){if(O===0){p.removeChild(V),ga(g);return}O--}else C!=="$"&&C!=="$?"&&C!=="$!"||O++;C=V}while(C);ga(g)}function lh(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function uI(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var C=p.data;if(C==="$"||C==="$!"||C==="$?"){if(g===0)return p;g--}else C==="/$"&&g++}p=p.previousSibling}return null}var gm=Math.random().toString(36).slice(2),nu="__reactFiber$"+gm,uh="__reactProps$"+gm,Cc="__reactContainer$"+gm,h_="__reactEvents$"+gm,lD="__reactListeners$"+gm,uD="__reactHandles$"+gm;function Up(p){var g=p[nu];if(g)return g;for(var C=p.parentNode;C;){if(g=C[Cc]||C[nu]){if(C=g.alternate,g.child!==null||C!==null&&C.child!==null)for(p=uI(p);p!==null;){if(C=p[nu])return C;p=uI(p)}return g}p=C,C=p.parentNode}return null}function _m(p){return p=p[nu]||p[Cc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Vp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function ym(p){return p[uh]||null}var mb=[],Em=-1;function Rc(p){return{current:p}}function Pi(p){0>Em||(p.current=mb[Em],mb[Em]=null,Em--)}function bi(p,g){Em++,mb[Em]=p.current,p.current=g}var dh={},vo=Rc(dh),ya=Rc(!1),jp=dh;function Fp(p,g){var C=p.type.contextTypes;if(!C)return dh;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var V={},H;for(H in C)V[H]=g[H];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=V),V}function Ea(p){return p=p.childContextTypes,p!=null}function RE(){Pi(ya),Pi(vo)}function dI(p,g,C){if(vo.current!==dh)throw Error(i(168));bi(vo,g),bi(ya,C)}function IE(p,g,C){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return C;O=O.getChildContext();for(var V in O)if(!(V in g))throw Error(i(108,nt(p)||"Unknown",V));return ke({},C,O)}function AE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||dh,jp=vo.current,bi(vo,p),bi(ya,ya.current),!0}function hI(p,g,C){var O=p.stateNode;if(!O)throw Error(i(169));C?(p=IE(p,g,jp),O.__reactInternalMemoizedMergedChildContext=p,Pi(ya),Pi(vo),bi(vo,p)):Pi(ya),bi(ya,C)}var Ic=null,PE=!1,gb=!1;function pI(p){Ic===null?Ic=[p]:Ic.push(p)}function dD(p){PE=!0,pI(p)}function hh(){if(!gb&&Ic!==null){gb=!0;var p=0,g=ar;try{var C=Ic;for(ar=1;p<C.length;p++){var O=C[p];do O=O(!0);while(O!==null)}Ic=null,PE=!1}catch(V){throw Ic!==null&&(Ic=Ic.slice(p+1)),th(Ec,hh),V}finally{ar=g,gb=!1}}return null}var vm=[],od=0,p_=null,OE=0,Ac=[],Xa=0,Bp=null,ad=1,cd="";function ld(p,g){vm[od++]=OE,vm[od++]=p_,p_=p,OE=g}function kE(p,g,C){Ac[Xa++]=ad,Ac[Xa++]=cd,Ac[Xa++]=Bp,Bp=p;var O=ad;p=cd;var V=32-Zs(O)-1;O&=~(1<<V),C+=1;var H=32-Zs(g)+V;if(30<H){var ce=V-V%5;H=(O&(1<<ce)-1).toString(32),O>>=ce,V-=ce,ad=1<<32-Zs(g)+V|C<<V|O,cd=H+p}else ad=1<<H|C<<V|O,cd=p}function NE(p){p.return!==null&&(ld(p,1),kE(p,1,0))}function f_(p){for(;p===p_;)p_=vm[--od],vm[od]=null,OE=vm[--od],vm[od]=null;for(;p===Bp;)Bp=Ac[--Xa],Ac[Xa]=null,cd=Ac[--Xa],Ac[Xa]=null,ad=Ac[--Xa],Ac[Xa]=null}var va=null,Sa=null,pi=!1,$o=null;function fI(p,g){var C=Za(5,null,null,0);C.elementType="DELETED",C.stateNode=g,C.return=p,g=p.deletions,g===null?(p.deletions=[C],p.flags|=16):g.push(C)}function mI(p,g){switch(p.tag){case 5:var C=p.type;return g=g.nodeType!==1||C.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,va=p,Sa=lh(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,va=p,Sa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(C=Bp!==null?{id:ad,overflow:cd}:null,p.memoizedState={dehydrated:g,treeContext:C,retryLane:1073741824},C=Za(18,null,null,0),C.stateNode=g,C.return=p,p.child=C,va=p,Sa=null,!0):!1;default:return!1}}function DE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function _b(p){if(pi){var g=Sa;if(g){var C=g;if(!mI(p,g)){if(DE(p))throw Error(i(418));g=lh(C.nextSibling);var O=va;g&&mI(p,g)?fI(O,C):(p.flags=p.flags&-4097|2,pi=!1,va=p)}}else{if(DE(p))throw Error(i(418));p.flags=p.flags&-4097|2,pi=!1,va=p}}}function gI(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;va=p}function m_(p){if(p!==va)return!1;if(!pi)return gI(p),pi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!pb(p.type,p.memoizedProps)),g&&(g=Sa)){if(DE(p))throw _I(),Error(i(418));for(;g;)fI(p,g),g=lh(g.nextSibling)}if(gI(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var C=p.data;if(C==="/$"){if(g===0){Sa=lh(p.nextSibling);break e}g--}else C!=="$"&&C!=="$!"&&C!=="$?"||g++}p=p.nextSibling}Sa=null}}else Sa=va?lh(p.stateNode.nextSibling):null;return!0}function _I(){for(var p=Sa;p;)p=lh(p.nextSibling)}function Sm(){Sa=va=null,pi=!1}function yb(p){$o===null?$o=[p]:$o.push(p)}var hD=oe.ReactCurrentBatchConfig;function g_(p,g,C){if(p=C.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(i(309));var O=C.stateNode}if(!O)throw Error(i(147,p));var V=O,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ce){var Ae=V.refs;ce===null?delete Ae[H]:Ae[H]=ce},g._stringRef=H,g)}if(typeof p!="string")throw Error(i(284));if(!C._owner)throw Error(i(290,p))}return p}function xE(p,g){throw p=Object.prototype.toString.call(g),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function Eb(p){var g=p._init;return g(p._payload)}function ph(p){function g(Ye,je){if(p){var Ze=Ye.deletions;Ze===null?(Ye.deletions=[je],Ye.flags|=16):Ze.push(je)}}function C(Ye,je){if(!p)return null;for(;je!==null;)g(Ye,je),je=je.sibling;return null}function O(Ye,je){for(Ye=new Map;je!==null;)je.key!==null?Ye.set(je.key,je):Ye.set(je.index,je),je=je.sibling;return Ye}function V(Ye,je){return Ye=_d(Ye,je),Ye.index=0,Ye.sibling=null,Ye}function H(Ye,je,Ze){return Ye.index=Ze,p?(Ze=Ye.alternate,Ze!==null?(Ze=Ze.index,Ze<je?(Ye.flags|=2,je):Ze):(Ye.flags|=2,je)):(Ye.flags|=1048576,je)}function ce(Ye){return p&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Ae(Ye,je,Ze,xt){return je===null||je.tag!==6?(je=nT(Ze,Ye.mode,xt),je.return=Ye,je):(je=V(je,Ze),je.return=Ye,je)}function Le(Ye,je,Ze,xt){var rn=Ze.type;return rn===te?At(Ye,je,Ze.props.children,xt,Ze.key):je!==null&&(je.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===tt&&Eb(rn)===je.type)?(xt=V(je,Ze.props),xt.ref=g_(Ye,je,Ze),xt.return=Ye,xt):(xt=vv(Ze.type,Ze.key,Ze.props,null,Ye.mode,xt),xt.ref=g_(Ye,je,Ze),xt.return=Ye,xt)}function st(Ye,je,Ze,xt){return je===null||je.tag!==4||je.stateNode.containerInfo!==Ze.containerInfo||je.stateNode.implementation!==Ze.implementation?(je=rT(Ze,Ye.mode,xt),je.return=Ye,je):(je=V(je,Ze.children||[]),je.return=Ye,je)}function At(Ye,je,Ze,xt,rn){return je===null||je.tag!==7?(je=Zp(Ze,Ye.mode,xt,rn),je.return=Ye,je):(je=V(je,Ze),je.return=Ye,je)}function Pt(Ye,je,Ze){if(typeof je=="string"&&je!==""||typeof je=="number")return je=nT(""+je,Ye.mode,Ze),je.return=Ye,je;if(typeof je=="object"&&je!==null){switch(je.$$typeof){case re:return Ze=vv(je.type,je.key,je.props,null,Ye.mode,Ze),Ze.ref=g_(Ye,null,je),Ze.return=Ye,Ze;case pe:return je=rT(je,Ye.mode,Ze),je.return=Ye,je;case tt:var xt=je._init;return Pt(Ye,xt(je._payload),Ze)}if($e(je)||ye(je))return je=Zp(je,Ye.mode,Ze,null),je.return=Ye,je;xE(Ye,je)}return null}function Rt(Ye,je,Ze,xt){var rn=je!==null?je.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return rn!==null?null:Ae(Ye,je,""+Ze,xt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case re:return Ze.key===rn?Le(Ye,je,Ze,xt):null;case pe:return Ze.key===rn?st(Ye,je,Ze,xt):null;case tt:return rn=Ze._init,Rt(Ye,je,rn(Ze._payload),xt)}if($e(Ze)||ye(Ze))return rn!==null?null:At(Ye,je,Ze,xt,null);xE(Ye,Ze)}return null}function Kt(Ye,je,Ze,xt,rn){if(typeof xt=="string"&&xt!==""||typeof xt=="number")return Ye=Ye.get(Ze)||null,Ae(je,Ye,""+xt,rn);if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case re:return Ye=Ye.get(xt.key===null?Ze:xt.key)||null,Le(je,Ye,xt,rn);case pe:return Ye=Ye.get(xt.key===null?Ze:xt.key)||null,st(je,Ye,xt,rn);case tt:var gn=xt._init;return Kt(Ye,je,Ze,gn(xt._payload),rn)}if($e(xt)||ye(xt))return Ye=Ye.get(Ze)||null,At(je,Ye,xt,rn,null);xE(je,xt)}return null}function tn(Ye,je,Ze,xt){for(var rn=null,gn=null,vn=je,Ln=je=0,ys=null;vn!==null&&Ln<Ze.length;Ln++){vn.index>Ln?(ys=vn,vn=null):ys=vn.sibling;var Cr=Rt(Ye,vn,Ze[Ln],xt);if(Cr===null){vn===null&&(vn=ys);break}p&&vn&&Cr.alternate===null&&g(Ye,vn),je=H(Cr,je,Ln),gn===null?rn=Cr:gn.sibling=Cr,gn=Cr,vn=ys}if(Ln===Ze.length)return C(Ye,vn),pi&&ld(Ye,Ln),rn;if(vn===null){for(;Ln<Ze.length;Ln++)vn=Pt(Ye,Ze[Ln],xt),vn!==null&&(je=H(vn,je,Ln),gn===null?rn=vn:gn.sibling=vn,gn=vn);return pi&&ld(Ye,Ln),rn}for(vn=O(Ye,vn);Ln<Ze.length;Ln++)ys=Kt(vn,Ye,Ln,Ze[Ln],xt),ys!==null&&(p&&ys.alternate!==null&&vn.delete(ys.key===null?Ln:ys.key),je=H(ys,je,Ln),gn===null?rn=ys:gn.sibling=ys,gn=ys);return p&&vn.forEach(function(wh){return g(Ye,wh)}),pi&&ld(Ye,Ln),rn}function nn(Ye,je,Ze,xt){var rn=ye(Ze);if(typeof rn!="function")throw Error(i(150));if(Ze=rn.call(Ze),Ze==null)throw Error(i(151));for(var gn=rn=null,vn=je,Ln=je=0,ys=null,Cr=Ze.next();vn!==null&&!Cr.done;Ln++,Cr=Ze.next()){vn.index>Ln?(ys=vn,vn=null):ys=vn.sibling;var wh=Rt(Ye,vn,Cr.value,xt);if(wh===null){vn===null&&(vn=ys);break}p&&vn&&wh.alternate===null&&g(Ye,vn),je=H(wh,je,Ln),gn===null?rn=wh:gn.sibling=wh,gn=wh,vn=ys}if(Cr.done)return C(Ye,vn),pi&&ld(Ye,Ln),rn;if(vn===null){for(;!Cr.done;Ln++,Cr=Ze.next())Cr=Pt(Ye,Cr.value,xt),Cr!==null&&(je=H(Cr,je,Ln),gn===null?rn=Cr:gn.sibling=Cr,gn=Cr);return pi&&ld(Ye,Ln),rn}for(vn=O(Ye,vn);!Cr.done;Ln++,Cr=Ze.next())Cr=Kt(vn,Ye,Ln,Cr.value,xt),Cr!==null&&(p&&Cr.alternate!==null&&vn.delete(Cr.key===null?Ln:Cr.key),je=H(Cr,je,Ln),gn===null?rn=Cr:gn.sibling=Cr,gn=Cr);return p&&vn.forEach(function(AD){return g(Ye,AD)}),pi&&ld(Ye,Ln),rn}function Zi(Ye,je,Ze,xt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===te&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case re:e:{for(var rn=Ze.key,gn=je;gn!==null;){if(gn.key===rn){if(rn=Ze.type,rn===te){if(gn.tag===7){C(Ye,gn.sibling),je=V(gn,Ze.props.children),je.return=Ye,Ye=je;break e}}else if(gn.elementType===rn||typeof rn=="object"&&rn!==null&&rn.$$typeof===tt&&Eb(rn)===gn.type){C(Ye,gn.sibling),je=V(gn,Ze.props),je.ref=g_(Ye,gn,Ze),je.return=Ye,Ye=je;break e}C(Ye,gn);break}else g(Ye,gn);gn=gn.sibling}Ze.type===te?(je=Zp(Ze.props.children,Ye.mode,xt,Ze.key),je.return=Ye,Ye=je):(xt=vv(Ze.type,Ze.key,Ze.props,null,Ye.mode,xt),xt.ref=g_(Ye,je,Ze),xt.return=Ye,Ye=xt)}return ce(Ye);case pe:e:{for(gn=Ze.key;je!==null;){if(je.key===gn)if(je.tag===4&&je.stateNode.containerInfo===Ze.containerInfo&&je.stateNode.implementation===Ze.implementation){C(Ye,je.sibling),je=V(je,Ze.children||[]),je.return=Ye,Ye=je;break e}else{C(Ye,je);break}else g(Ye,je);je=je.sibling}je=rT(Ze,Ye.mode,xt),je.return=Ye,Ye=je}return ce(Ye);case tt:return gn=Ze._init,Zi(Ye,je,gn(Ze._payload),xt)}if($e(Ze))return tn(Ye,je,Ze,xt);if(ye(Ze))return nn(Ye,je,Ze,xt);xE(Ye,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,je!==null&&je.tag===6?(C(Ye,je.sibling),je=V(je,Ze),je.return=Ye,Ye=je):(C(Ye,je),je=nT(Ze,Ye.mode,xt),je.return=Ye,Ye=je),ce(Ye)):C(Ye,je)}return Zi}var bm=ph(!0),yI=ph(!1),LE=Rc(null),__=null,Tm=null,ME=null;function vb(){ME=Tm=__=null}function Sb(p){var g=LE.current;Pi(LE),p._currentValue=g}function bb(p,g,C){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===C)break;p=p.return}}function ud(p,g){__=p,ME=Tm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ta=!0),p.firstContext=null)}function Pc(p){var g=p._currentValue;if(ME!==p)if(p={context:p,memoizedValue:g,next:null},Tm===null){if(__===null)throw Error(i(308));Tm=p,__.dependencies={lanes:0,firstContext:p}}else Tm=Tm.next=p;return g}var Wp=null;function Tb(p){Wp===null?Wp=[p]:Wp.push(p)}function EI(p,g,C,O){var V=g.interleaved;return V===null?(C.next=C,Tb(g)):(C.next=V.next,V.next=C),g.interleaved=C,dd(p,O)}function dd(p,g){p.lanes|=g;var C=p.alternate;for(C!==null&&(C.lanes|=g),C=p,p=p.return;p!==null;)p.childLanes|=g,C=p.alternate,C!==null&&(C.childLanes|=g),C=p,p=p.return;return C.tag===3?C.stateNode:null}var fh=!1;function y_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vI(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function ru(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function mh(p,g,C){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Or&2)!==0){var V=O.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),O.pending=g,dd(p,C)}return V=O.interleaved,V===null?(g.next=g,Tb(O)):(g.next=V.next,V.next=g),O.interleaved=g,dd(p,C)}function E_(p,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,C|=O,g.lanes=C,$a(p,C)}}function SI(p,g){var C=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,C===O)){var V=null,H=null;if(C=C.firstBaseUpdate,C!==null){do{var ce={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};H===null?V=H=ce:H=H.next=ce,C=C.next}while(C!==null);H===null?V=H=g:H=H.next=g}else V=H=g;C={baseState:O.baseState,firstBaseUpdate:V,lastBaseUpdate:H,shared:O.shared,effects:O.effects},p.updateQueue=C;return}p=C.lastBaseUpdate,p===null?C.firstBaseUpdate=g:p.next=g,C.lastBaseUpdate=g}function UE(p,g,C,O){var V=p.updateQueue;fh=!1;var H=V.firstBaseUpdate,ce=V.lastBaseUpdate,Ae=V.shared.pending;if(Ae!==null){V.shared.pending=null;var Le=Ae,st=Le.next;Le.next=null,ce===null?H=st:ce.next=st,ce=Le;var At=p.alternate;At!==null&&(At=At.updateQueue,Ae=At.lastBaseUpdate,Ae!==ce&&(Ae===null?At.firstBaseUpdate=st:Ae.next=st,At.lastBaseUpdate=Le))}if(H!==null){var Pt=V.baseState;ce=0,At=st=Le=null,Ae=H;do{var Rt=Ae.lane,Kt=Ae.eventTime;if((O&Rt)===Rt){At!==null&&(At=At.next={eventTime:Kt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var tn=p,nn=Ae;switch(Rt=g,Kt=C,nn.tag){case 1:if(tn=nn.payload,typeof tn=="function"){Pt=tn.call(Kt,Pt,Rt);break e}Pt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=nn.payload,Rt=typeof tn=="function"?tn.call(Kt,Pt,Rt):tn,Rt==null)break e;Pt=ke({},Pt,Rt);break e;case 2:fh=!0}}Ae.callback!==null&&Ae.lane!==0&&(p.flags|=64,Rt=V.effects,Rt===null?V.effects=[Ae]:Rt.push(Ae))}else Kt={eventTime:Kt,lane:Rt,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},At===null?(st=At=Kt,Le=Pt):At=At.next=Kt,ce|=Rt;if(Ae=Ae.next,Ae===null){if(Ae=V.shared.pending,Ae===null)break;Rt=Ae,Ae=Rt.next,Rt.next=null,V.lastBaseUpdate=Rt,V.shared.pending=null}}while(!0);if(At===null&&(Le=Pt),V.baseState=Le,V.firstBaseUpdate=st,V.lastBaseUpdate=At,g=V.shared.interleaved,g!==null){V=g;do ce|=V.lane,V=V.next;while(V!==g)}else H===null&&(V.shared.lanes=0);qp|=ce,p.lanes=ce,p.memoizedState=Pt}}function bI(p,g,C){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],V=O.callback;if(V!==null){if(O.callback=null,O=C,typeof V!="function")throw Error(i(191,V));V.call(O)}}}var v_={},iu=Rc(v_),S_=Rc(v_),wm=Rc(v_);function zp(p){if(p===v_)throw Error(i(174));return p}function wb(p,g){switch(bi(wm,g),bi(S_,p),bi(iu,v_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Jt(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=Jt(g,p)}Pi(iu),bi(iu,g)}function Gp(){Pi(iu),Pi(S_),Pi(wm)}function TI(p){zp(wm.current);var g=zp(iu.current),C=Jt(g,p.type);g!==C&&(bi(S_,p),bi(iu,C))}function Cm(p){S_.current===p&&(Pi(iu),Pi(S_))}var Di=Rc(0);function gh(p){for(var g=p;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||C.data==="$?"||C.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Cb=[];function Rb(){for(var p=0;p<Cb.length;p++)Cb[p]._workInProgressVersionPrimary=null;Cb.length=0}var VE=oe.ReactCurrentDispatcher,Ib=oe.ReactCurrentBatchConfig,su=0,Ui=null,fs=null,ms=null,Rm=!1,b_=!1,T_=0,pD=0;function So(){throw Error(i(321))}function Ab(p,g){if(g===null)return!1;for(var C=0;C<g.length&&C<p.length;C++)if(!vl(p[C],g[C]))return!1;return!0}function Im(p,g,C,O,V,H){if(su=H,Ui=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,VE.current=p===null||p.memoizedState===null?gD:xI,p=C(O,V),b_){H=0;do{if(b_=!1,T_=0,25<=H)throw Error(i(301));H+=1,ms=fs=null,g.updateQueue=null,VE.current=_D,p=C(O,V)}while(b_)}if(VE.current=WE,g=fs!==null&&fs.next!==null,su=0,ms=fs=Ui=null,Rm=!1,g)throw Error(i(300));return p}function Pb(){var p=T_!==0;return T_=0,p}function Ko(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?Ui.memoizedState=ms=p:ms=ms.next=p,ms}function ba(){if(fs===null){var p=Ui.alternate;p=p!==null?p.memoizedState:null}else p=fs.next;var g=ms===null?Ui.memoizedState:ms.next;if(g!==null)ms=g,fs=p;else{if(p===null)throw Error(i(310));fs=p,p={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},ms===null?Ui.memoizedState=ms=p:ms=ms.next=p}return ms}function _h(p,g){return typeof g=="function"?g(p):g}function Hp(p){var g=ba(),C=g.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=p;var O=fs,V=O.baseQueue,H=C.pending;if(H!==null){if(V!==null){var ce=V.next;V.next=H.next,H.next=ce}O.baseQueue=V=H,C.pending=null}if(V!==null){H=V.next,O=O.baseState;var Ae=ce=null,Le=null,st=H;do{var At=st.lane;if((su&At)===At)Le!==null&&(Le=Le.next={lane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),O=st.hasEagerState?st.eagerState:p(O,st.action);else{var Pt={lane:At,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null};Le===null?(Ae=Le=Pt,ce=O):Le=Le.next=Pt,Ui.lanes|=At,qp|=At}st=st.next}while(st!==null&&st!==H);Le===null?ce=O:Le.next=Ae,vl(O,g.memoizedState)||(Ta=!0),g.memoizedState=O,g.baseState=ce,g.baseQueue=Le,C.lastRenderedState=O}if(p=C.interleaved,p!==null){V=p;do H=V.lane,Ui.lanes|=H,qp|=H,V=V.next;while(V!==p)}else V===null&&(C.lanes=0);return[g.memoizedState,C.dispatch]}function Am(p){var g=ba(),C=g.queue;if(C===null)throw Error(i(311));C.lastRenderedReducer=p;var O=C.dispatch,V=C.pending,H=g.memoizedState;if(V!==null){C.pending=null;var ce=V=V.next;do H=p(H,ce.action),ce=ce.next;while(ce!==V);vl(H,g.memoizedState)||(Ta=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),C.lastRenderedState=H}return[H,O]}function wI(){}function Ob(p,g){var C=Ui,O=ba(),V=g(),H=!vl(O.memoizedState,V);if(H&&(O.memoizedState=V,Ta=!0),O=O.queue,Oc(RI.bind(null,C,O,p),[p]),O.getSnapshot!==g||H||ms!==null&&ms.memoizedState.tag&1){if(C.flags|=2048,w_(9,kb.bind(null,C,O,V,g),void 0,null),Gs===null)throw Error(i(349));(su&30)!==0||CI(C,g,V)}return V}function CI(p,g,C){p.flags|=16384,p={getSnapshot:g,value:C},g=Ui.updateQueue,g===null?(g={lastEffect:null,stores:null},Ui.updateQueue=g,g.stores=[p]):(C=g.stores,C===null?g.stores=[p]:C.push(p))}function kb(p,g,C,O){g.value=C,g.getSnapshot=O,II(g)&&jE(p)}function RI(p,g,C){return C(function(){II(g)&&jE(p)})}function II(p){var g=p.getSnapshot;p=p.value;try{var C=g();return!vl(p,C)}catch{return!0}}function jE(p){var g=dd(p,1);g!==null&&xc(g,p,1,-1)}function FE(p){var g=Ko();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_h,lastRenderedState:p},g.queue=p,p=p.dispatch=mD.bind(null,Ui,p),[g.memoizedState,p]}function w_(p,g,C,O){return p={tag:p,create:g,destroy:C,deps:O,next:null},g=Ui.updateQueue,g===null?(g={lastEffect:null,stores:null},Ui.updateQueue=g,g.lastEffect=p.next=p):(C=g.lastEffect,C===null?g.lastEffect=p.next=p:(O=C.next,C.next=p,p.next=O,g.lastEffect=p)),p}function AI(){return ba().memoizedState}function C_(p,g,C,O){var V=Ko();Ui.flags|=p,V.memoizedState=w_(1|g,C,void 0,O===void 0?null:O)}function Pm(p,g,C,O){var V=ba();O=O===void 0?null:O;var H=void 0;if(fs!==null){var ce=fs.memoizedState;if(H=ce.destroy,O!==null&&Ab(O,ce.deps)){V.memoizedState=w_(g,C,H,O);return}}Ui.flags|=p,V.memoizedState=w_(1|g,C,H,O)}function PI(p,g){return C_(8390656,8,p,g)}function Oc(p,g){return Pm(2048,8,p,g)}function $p(p,g){return Pm(4,2,p,g)}function yh(p,g){return Pm(4,4,p,g)}function Nb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Db(p,g,C){return C=C!=null?C.concat([p]):null,Pm(4,4,Nb.bind(null,g,p),C)}function hd(){}function BE(p,g){var C=ba();g=g===void 0?null:g;var O=C.memoizedState;return O!==null&&g!==null&&Ab(g,O[1])?O[0]:(C.memoizedState=[p,g],p)}function OI(p,g){var C=ba();g=g===void 0?null:g;var O=C.memoizedState;return O!==null&&g!==null&&Ab(g,O[1])?O[0]:(p=p(),C.memoizedState=[p,g],p)}function xb(p,g,C){return(su&21)===0?(p.baseState&&(p.baseState=!1,Ta=!0),p.memoizedState=C):(vl(C,g)||(C=Zu(),Ui.lanes|=C,qp|=C,p.baseState=!0),g)}function fD(p,g){var C=ar;ar=C!==0&&4>C?C:4,p(!0);var O=Ib.transition;Ib.transition={};try{p(!1),g()}finally{ar=C,Ib.transition=O}}function Lb(){return ba().memoizedState}function kI(p,g,C){var O=Dc(p);if(C={lane:O,action:C,hasEagerState:!1,eagerState:null,next:null},pd(p))NI(g,C);else if(C=EI(p,g,C,O),C!==null){var V=no();xc(C,p,O,V),DI(C,g,O)}}function mD(p,g,C){var O=Dc(p),V={lane:O,action:C,hasEagerState:!1,eagerState:null,next:null};if(pd(p))NI(g,V);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ce=g.lastRenderedState,Ae=H(ce,C);if(V.hasEagerState=!0,V.eagerState=Ae,vl(Ae,ce)){var Le=g.interleaved;Le===null?(V.next=V,Tb(g)):(V.next=Le.next,Le.next=V),g.interleaved=V;return}}catch{}finally{}C=EI(p,g,V,O),C!==null&&(V=no(),xc(C,p,O,V),DI(C,g,O))}}function pd(p){var g=p.alternate;return p===Ui||g!==null&&g===Ui}function NI(p,g){b_=Rm=!0;var C=p.pending;C===null?g.next=g:(g.next=C.next,C.next=g),p.pending=g}function DI(p,g,C){if((C&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,C|=O,g.lanes=C,$a(p,C)}}var WE={readContext:Pc,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},gD={readContext:Pc,useCallback:function(p,g){return Ko().memoizedState=[p,g===void 0?null:g],p},useContext:Pc,useEffect:PI,useImperativeHandle:function(p,g,C){return C=C!=null?C.concat([p]):null,C_(4194308,4,Nb.bind(null,g,p),C)},useLayoutEffect:function(p,g){return C_(4194308,4,p,g)},useInsertionEffect:function(p,g){return C_(4,2,p,g)},useMemo:function(p,g){var C=Ko();return g=g===void 0?null:g,p=p(),C.memoizedState=[p,g],p},useReducer:function(p,g,C){var O=Ko();return g=C!==void 0?C(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=kI.bind(null,Ui,p),[O.memoizedState,p]},useRef:function(p){var g=Ko();return p={current:p},g.memoizedState=p},useState:FE,useDebugValue:hd,useDeferredValue:function(p){return Ko().memoizedState=p},useTransition:function(){var p=FE(!1),g=p[0];return p=fD.bind(null,p[1]),Ko().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,C){var O=Ui,V=Ko();if(pi){if(C===void 0)throw Error(i(407));C=C()}else{if(C=g(),Gs===null)throw Error(i(349));(su&30)!==0||CI(O,g,C)}V.memoizedState=C;var H={value:C,getSnapshot:g};return V.queue=H,PI(RI.bind(null,O,H,p),[p]),O.flags|=2048,w_(9,kb.bind(null,O,H,C,g),void 0,null),C},useId:function(){var p=Ko(),g=Gs.identifierPrefix;if(pi){var C=cd,O=ad;C=(O&~(1<<32-Zs(O)-1)).toString(32)+C,g=":"+g+"R"+C,C=T_++,0<C&&(g+="H"+C.toString(32)),g+=":"}else C=pD++,g=":"+g+"r"+C.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},xI={readContext:Pc,useCallback:BE,useContext:Pc,useEffect:Oc,useImperativeHandle:Db,useInsertionEffect:$p,useLayoutEffect:yh,useMemo:OI,useReducer:Hp,useRef:AI,useState:function(){return Hp(_h)},useDebugValue:hd,useDeferredValue:function(p){var g=ba();return xb(g,fs.memoizedState,p)},useTransition:function(){var p=Hp(_h)[0],g=ba().memoizedState;return[p,g]},useMutableSource:wI,useSyncExternalStore:Ob,useId:Lb,unstable_isNewReconciler:!1},_D={readContext:Pc,useCallback:BE,useContext:Pc,useEffect:Oc,useImperativeHandle:Db,useInsertionEffect:$p,useLayoutEffect:yh,useMemo:OI,useReducer:Am,useRef:AI,useState:function(){return Am(_h)},useDebugValue:hd,useDeferredValue:function(p){var g=ba();return fs===null?g.memoizedState=p:xb(g,fs.memoizedState,p)},useTransition:function(){var p=Am(_h)[0],g=ba().memoizedState;return[p,g]},useMutableSource:wI,useSyncExternalStore:Ob,useId:Lb,unstable_isNewReconciler:!1};function Ja(p,g){if(p&&p.defaultProps){g=ke({},g),p=p.defaultProps;for(var C in p)g[C]===void 0&&(g[C]=p[C]);return g}return g}function zE(p,g,C,O){g=p.memoizedState,C=C(O,g),C=C==null?g:ke({},g,C),p.memoizedState=C,p.lanes===0&&(p.updateQueue.baseState=C)}var GE={isMounted:function(p){return(p=p._reactInternals)?Ws(p)===p:!1},enqueueSetState:function(p,g,C){p=p._reactInternals;var O=no(),V=Dc(p),H=ru(O,V);H.payload=g,C!=null&&(H.callback=C),g=mh(p,H,V),g!==null&&(xc(g,p,V,O),E_(g,p,V))},enqueueReplaceState:function(p,g,C){p=p._reactInternals;var O=no(),V=Dc(p),H=ru(O,V);H.tag=1,H.payload=g,C!=null&&(H.callback=C),g=mh(p,H,V),g!==null&&(xc(g,p,V,O),E_(g,p,V))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var C=no(),O=Dc(p),V=ru(C,O);V.tag=2,g!=null&&(V.callback=g),g=mh(p,V,O),g!==null&&(xc(g,p,O,C),E_(g,p,O))}};function Mb(p,g,C,O,V,H,ce){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,H,ce):g.prototype&&g.prototype.isPureReactComponent?!i_(C,O)||!i_(V,H):!0}function LI(p,g,C){var O=!1,V=dh,H=g.contextType;return typeof H=="object"&&H!==null?H=Pc(H):(V=Ea(g)?jp:vo.current,O=g.contextTypes,H=(O=O!=null)?Fp(p,V):dh),g=new g(C,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=GE,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=V,p.__reactInternalMemoizedMaskedChildContext=H),g}function MI(p,g,C,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,O),g.state!==p&&GE.enqueueReplaceState(g,g.state,null)}function Ub(p,g,C,O){var V=p.stateNode;V.props=C,V.state=p.memoizedState,V.refs={},y_(p);var H=g.contextType;typeof H=="object"&&H!==null?V.context=Pc(H):(H=Ea(g)?jp:vo.current,V.context=Fp(p,H)),V.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(zE(p,g,H,C),V.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&GE.enqueueReplaceState(V,V.state,null),UE(p,C,V,O),V.state=p.memoizedState),typeof V.componentDidMount=="function"&&(p.flags|=4194308)}function Om(p,g){try{var C="",O=g;do C+=Ge(O),O=O.return;while(O);var V=C}catch(H){V=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:V,digest:null}}function Vb(p,g,C){return{value:p,source:null,stack:C??null,digest:g??null}}function jb(p,g){try{console.error(g.value)}catch(C){setTimeout(function(){throw C})}}var yD=typeof WeakMap=="function"?WeakMap:Map;function Fb(p,g,C){C=ru(-1,C),C.tag=3,C.payload={element:null};var O=g.value;return C.callback=function(){cv||(cv=!0,Jb=O),jb(p,g)},C}function fd(p,g,C){C=ru(-1,C),C.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var V=g.value;C.payload=function(){return O(V)},C.callback=function(){jb(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(C.callback=function(){jb(p,g),typeof O!="function"&&(Eh===null?Eh=new Set([this]):Eh.add(this));var ce=g.stack;this.componentDidCatch(g.value,{componentStack:ce!==null?ce:""})}),C}function UI(p,g,C){var O=p.pingCache;if(O===null){O=p.pingCache=new yD;var V=new Set;O.set(g,V)}else V=O.get(g),V===void 0&&(V=new Set,O.set(g,V));V.has(C)||(V.add(C),p=aA.bind(null,p,g,C),g.then(p,p))}function VI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function jI(p,g,C,O,V){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(g=ru(-1,1),g.tag=2,mh(C,g,1))),C.lanes|=1),p):(p.flags|=65536,p.lanes=V,p)}var ED=oe.ReactCurrentOwner,Ta=!1;function qo(p,g,C,O){g.child=p===null?yI(g,null,C,O):bm(g,p.child,C,O)}function HE(p,g,C,O,V){C=C.render;var H=g.ref;return ud(g,V),O=Im(p,g,C,O,H,V),C=Pb(),p!==null&&!Ta?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,ou(p,g,V)):(pi&&C&&NE(g),g.flags|=1,qo(p,g,O,V),g.child)}function FI(p,g,C,O,V){if(p===null){var H=C.type;return typeof H=="function"&&!Sh(H)&&H.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(g.tag=15,g.type=H,BI(p,g,H,O,V)):(p=vv(C.type,null,O,g,g.mode,V),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&V)===0){var ce=H.memoizedProps;if(C=C.compare,C=C!==null?C:i_,C(ce,O)&&p.ref===g.ref)return ou(p,g,V)}return g.flags|=1,p=_d(H,O),p.ref=g.ref,p.return=g,g.child=p}function BI(p,g,C,O,V){if(p!==null){var H=p.memoizedProps;if(i_(H,O)&&p.ref===g.ref)if(Ta=!1,g.pendingProps=O=H,(p.lanes&V)!==0)(p.flags&131072)!==0&&(Ta=!0);else return g.lanes=p.lanes,ou(p,g,V)}return Bb(p,g,C,O,V)}function WI(p,g,C){var O=g.pendingProps,V=O.children,H=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},bi(Sl,Qa),Qa|=C;else{if((C&1073741824)===0)return p=H!==null?H.baseLanes|C:C,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,bi(Sl,Qa),Qa|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=H!==null?H.baseLanes:C,bi(Sl,Qa),Qa|=O}else H!==null?(O=H.baseLanes|C,g.memoizedState=null):O=C,bi(Sl,Qa),Qa|=O;return qo(p,g,V,C),g.child}function zI(p,g){var C=g.ref;(p===null&&C!==null||p!==null&&p.ref!==C)&&(g.flags|=512,g.flags|=2097152)}function Bb(p,g,C,O,V){var H=Ea(C)?jp:vo.current;return H=Fp(g,H),ud(g,V),C=Im(p,g,C,O,H,V),O=Pb(),p!==null&&!Ta?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,ou(p,g,V)):(pi&&O&&NE(g),g.flags|=1,qo(p,g,C,V),g.child)}function GI(p,g,C,O,V){if(Ea(C)){var H=!0;AE(g)}else H=!1;if(ud(g,V),g.stateNode===null)JE(p,g),LI(g,C,O),Ub(g,C,O,V),O=!0;else if(p===null){var ce=g.stateNode,Ae=g.memoizedProps;ce.props=Ae;var Le=ce.context,st=C.contextType;typeof st=="object"&&st!==null?st=Pc(st):(st=Ea(C)?jp:vo.current,st=Fp(g,st));var At=C.getDerivedStateFromProps,Pt=typeof At=="function"||typeof ce.getSnapshotBeforeUpdate=="function";Pt||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==O||Le!==st)&&MI(g,ce,O,st),fh=!1;var Rt=g.memoizedState;ce.state=Rt,UE(g,O,ce,V),Le=g.memoizedState,Ae!==O||Rt!==Le||ya.current||fh?(typeof At=="function"&&(zE(g,C,At,O),Le=g.memoizedState),(Ae=fh||Mb(g,C,Ae,O,Rt,Le,st))?(Pt||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=Le),ce.props=O,ce.state=Le,ce.context=st,O=Ae):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ce=g.stateNode,vI(p,g),Ae=g.memoizedProps,st=g.type===g.elementType?Ae:Ja(g.type,Ae),ce.props=st,Pt=g.pendingProps,Rt=ce.context,Le=C.contextType,typeof Le=="object"&&Le!==null?Le=Pc(Le):(Le=Ea(C)?jp:vo.current,Le=Fp(g,Le));var Kt=C.getDerivedStateFromProps;(At=typeof Kt=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==Pt||Rt!==Le)&&MI(g,ce,O,Le),fh=!1,Rt=g.memoizedState,ce.state=Rt,UE(g,O,ce,V);var tn=g.memoizedState;Ae!==Pt||Rt!==tn||ya.current||fh?(typeof Kt=="function"&&(zE(g,C,Kt,O),tn=g.memoizedState),(st=fh||Mb(g,C,st,O,Rt,tn,Le)||!1)?(At||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(O,tn,Le),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(O,tn,Le)),typeof ce.componentDidUpdate=="function"&&(g.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=tn),ce.props=O,ce.state=tn,ce.context=Le,O=st):(typeof ce.componentDidUpdate!="function"||Ae===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=1024),O=!1)}return $E(p,g,C,O,H,V)}function $E(p,g,C,O,V,H){zI(p,g);var ce=(g.flags&128)!==0;if(!O&&!ce)return V&&hI(g,C,!1),ou(p,g,H);O=g.stateNode,ED.current=g;var Ae=ce&&typeof C.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&ce?(g.child=bm(g,p.child,null,H),g.child=bm(g,null,Ae,H)):qo(p,g,Ae,H),g.memoizedState=O.state,V&&hI(g,C,!0),g.child}function Wb(p){var g=p.stateNode;g.pendingContext?dI(p,g.pendingContext,g.pendingContext!==g.context):g.context&&dI(p,g.context,!1),wb(p,g.containerInfo)}function HI(p,g,C,O,V){return Sm(),yb(V),g.flags|=256,qo(p,g,C,O),g.child}var zb={dehydrated:null,treeContext:null,retryLane:0};function km(p){return{baseLanes:p,cachePool:null,transitions:null}}function KE(p,g,C){var O=g.pendingProps,V=Di.current,H=!1,ce=(g.flags&128)!==0,Ae;if((Ae=ce)||(Ae=p!==null&&p.memoizedState===null?!1:(V&2)!==0),Ae?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(V|=1),bi(Di,V&1),p===null)return _b(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ce=O.children,p=O.fallback,H?(O=g.mode,H=g.child,ce={mode:"hidden",children:ce},(O&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ce):H=bh(ce,O,0,null),p=Zp(p,O,C,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=km(C),g.memoizedState=zb,p):qE(g,ce));if(V=p.memoizedState,V!==null&&(Ae=V.dehydrated,Ae!==null))return $I(p,g,ce,O,Ae,V,C);if(H){H=O.fallback,ce=g.mode,V=p.child,Ae=V.sibling;var Le={mode:"hidden",children:O.children};return(ce&1)===0&&g.child!==V?(O=g.child,O.childLanes=0,O.pendingProps=Le,g.deletions=null):(O=_d(V,Le),O.subtreeFlags=V.subtreeFlags&14680064),Ae!==null?H=_d(Ae,H):(H=Zp(H,ce,C,null),H.flags|=2),H.return=g,O.return=g,O.sibling=H,g.child=O,O=H,H=g.child,ce=p.child.memoizedState,ce=ce===null?km(C):{baseLanes:ce.baseLanes|C,cachePool:null,transitions:ce.transitions},H.memoizedState=ce,H.childLanes=p.childLanes&~C,g.memoizedState=zb,O}return H=p.child,p=H.sibling,O=_d(H,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=C),O.return=g,O.sibling=null,p!==null&&(C=g.deletions,C===null?(g.deletions=[p],g.flags|=16):C.push(p)),g.child=O,g.memoizedState=null,O}function qE(p,g){return g=bh({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function Kp(p,g,C,O){return O!==null&&yb(O),bm(g,p.child,null,C),p=qE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function $I(p,g,C,O,V,H,ce){if(C)return g.flags&256?(g.flags&=-257,O=Vb(Error(i(422))),Kp(p,g,ce,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=O.fallback,V=g.mode,O=bh({mode:"visible",children:O.children},V,0,null),H=Zp(H,V,ce,null),H.flags|=2,O.return=g,H.return=g,O.sibling=H,g.child=O,(g.mode&1)!==0&&bm(g,p.child,null,ce),g.child.memoizedState=km(ce),g.memoizedState=zb,H);if((g.mode&1)===0)return Kp(p,g,ce,null);if(V.data==="$!"){if(O=V.nextSibling&&V.nextSibling.dataset,O)var Ae=O.dgst;return O=Ae,H=Error(i(419)),O=Vb(H,O,void 0),Kp(p,g,ce,O)}if(Ae=(ce&p.childLanes)!==0,Ta||Ae){if(O=Gs,O!==null){switch(ce&-ce){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(O.suspendedLanes|ce))!==0?0:V,V!==0&&V!==H.retryLane&&(H.retryLane=V,dd(p,V),xc(O,p,V,-1))}return eT(),O=Vb(Error(i(421))),Kp(p,g,ce,O)}return V.data==="$?"?(g.flags|=128,g.child=p.child,g=_v.bind(null,p),V._reactRetry=g,null):(p=H.treeContext,Sa=lh(V.nextSibling),va=g,pi=!0,$o=null,p!==null&&(Ac[Xa++]=ad,Ac[Xa++]=cd,Ac[Xa++]=Bp,ad=p.id,cd=p.overflow,Bp=g),g=qE(g,O.children),g.flags|=4096,g)}function KI(p,g,C){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),bb(p.return,g,C)}function YE(p,g,C,O,V){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:C,tailMode:V}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=O,H.tail=C,H.tailMode=V)}function XE(p,g,C){var O=g.pendingProps,V=O.revealOrder,H=O.tail;if(qo(p,g,O.children,C),O=Di.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&KI(p,C,g);else if(p.tag===19)KI(p,C,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(bi(Di,O),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(C=g.child,V=null;C!==null;)p=C.alternate,p!==null&&gh(p)===null&&(V=C),C=C.sibling;C=V,C===null?(V=g.child,g.child=null):(V=C.sibling,C.sibling=null),YE(g,!1,V,C,H);break;case"backwards":for(C=null,V=g.child,g.child=null;V!==null;){if(p=V.alternate,p!==null&&gh(p)===null){g.child=V;break}p=V.sibling,V.sibling=C,C=V,V=p}YE(g,!0,C,null,H);break;case"together":YE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function JE(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function ou(p,g,C){if(p!==null&&(g.dependencies=p.dependencies),qp|=g.lanes,(C&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(i(153));if(g.child!==null){for(p=g.child,C=_d(p,p.pendingProps),g.child=C,C.return=g;p.sibling!==null;)p=p.sibling,C=C.sibling=_d(p,p.pendingProps),C.return=g;C.sibling=null}return g.child}function qI(p,g,C){switch(g.tag){case 3:Wb(g),Sm();break;case 5:TI(g);break;case 1:Ea(g.type)&&AE(g);break;case 4:wb(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,V=g.memoizedProps.value;bi(LE,O._currentValue),O._currentValue=V;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(bi(Di,Di.current&1),g.flags|=128,null):(C&g.child.childLanes)!==0?KE(p,g,C):(bi(Di,Di.current&1),p=ou(p,g,C),p!==null?p.sibling:null);bi(Di,Di.current&1);break;case 19:if(O=(C&g.childLanes)!==0,(p.flags&128)!==0){if(O)return XE(p,g,C);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),bi(Di,Di.current),O)break;return null;case 22:case 23:return g.lanes=0,WI(p,g,C)}return ou(p,g,C)}var YI,QE,Gb,XI;YI=function(p,g){for(var C=g.child;C!==null;){if(C.tag===5||C.tag===6)p.appendChild(C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===g)break;for(;C.sibling===null;){if(C.return===null||C.return===g)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},QE=function(){},Gb=function(p,g,C,O){var V=p.memoizedProps;if(V!==O){p=g.stateNode,zp(iu.current);var H=null;switch(C){case"input":V=jn(p,V),O=jn(p,O),H=[];break;case"select":V=ke({},V,{value:void 0}),O=ke({},O,{value:void 0}),H=[];break;case"textarea":V=vt(p,V),O=vt(p,O),H=[];break;default:typeof V.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=wE)}Wa(C,O);var ce;C=null;for(st in V)if(!O.hasOwnProperty(st)&&V.hasOwnProperty(st)&&V[st]!=null)if(st==="style"){var Ae=V[st];for(ce in Ae)Ae.hasOwnProperty(ce)&&(C||(C={}),C[ce]="")}else st!=="dangerouslySetInnerHTML"&&st!=="children"&&st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(l.hasOwnProperty(st)?H||(H=[]):(H=H||[]).push(st,null));for(st in O){var Le=O[st];if(Ae=V!=null?V[st]:void 0,O.hasOwnProperty(st)&&Le!==Ae&&(Le!=null||Ae!=null))if(st==="style")if(Ae){for(ce in Ae)!Ae.hasOwnProperty(ce)||Le&&Le.hasOwnProperty(ce)||(C||(C={}),C[ce]="");for(ce in Le)Le.hasOwnProperty(ce)&&Ae[ce]!==Le[ce]&&(C||(C={}),C[ce]=Le[ce])}else C||(H||(H=[]),H.push(st,C)),C=Le;else st==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Ae=Ae?Ae.__html:void 0,Le!=null&&Ae!==Le&&(H=H||[]).push(st,Le)):st==="children"?typeof Le!="string"&&typeof Le!="number"||(H=H||[]).push(st,""+Le):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&(l.hasOwnProperty(st)?(Le!=null&&st==="onScroll"&&Ai("scroll",p),H||Ae===Le||(H=[])):(H=H||[]).push(st,Le))}C&&(H=H||[]).push("style",C);var st=H;(g.updateQueue=st)&&(g.flags|=4)}},XI=function(p,g,C,O){C!==O&&(g.flags|=4)};function R_(p,g){if(!pi)switch(p.tailMode){case"hidden":g=p.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?p.tail=null:C.sibling=null;break;case"collapsed":C=p.tail;for(var O=null;C!==null;)C.alternate!==null&&(O=C),C=C.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function bo(p){var g=p.alternate!==null&&p.alternate.child===p.child,C=0,O=0;if(g)for(var V=p.child;V!==null;)C|=V.lanes|V.childLanes,O|=V.subtreeFlags&14680064,O|=V.flags&14680064,V.return=p,V=V.sibling;else for(V=p.child;V!==null;)C|=V.lanes|V.childLanes,O|=V.subtreeFlags,O|=V.flags,V.return=p,V=V.sibling;return p.subtreeFlags|=O,p.childLanes=C,g}function ZE(p,g,C){var O=g.pendingProps;switch(f_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bo(g),null;case 1:return Ea(g.type)&&RE(),bo(g),null;case 3:return O=g.stateNode,Gp(),Pi(ya),Pi(vo),Rb(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(m_(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,$o!==null&&(pv($o),$o=null))),QE(p,g),bo(g),null;case 5:Cm(g);var V=zp(wm.current);if(C=g.type,p!==null&&g.stateNode!=null)Gb(p,g,C,O,V),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(i(166));return bo(g),null}if(p=zp(iu.current),m_(g)){O=g.stateNode,C=g.type;var H=g.memoizedProps;switch(O[nu]=g,O[uh]=H,p=(g.mode&1)!==0,C){case"dialog":Ai("cancel",O),Ai("close",O);break;case"iframe":case"object":case"embed":Ai("load",O);break;case"video":case"audio":for(V=0;V<c_.length;V++)Ai(c_[V],O);break;case"source":Ai("error",O);break;case"img":case"image":case"link":Ai("error",O),Ai("load",O);break;case"details":Ai("toggle",O);break;case"input":Qt(O,H),Ai("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!H.multiple},Ai("invalid",O);break;case"textarea":St(O,H),Ai("invalid",O)}Wa(C,H),V=null;for(var ce in H)if(H.hasOwnProperty(ce)){var Ae=H[ce];ce==="children"?typeof Ae=="string"?O.textContent!==Ae&&(H.suppressHydrationWarning!==!0&&TE(O.textContent,Ae,p),V=["children",Ae]):typeof Ae=="number"&&O.textContent!==""+Ae&&(H.suppressHydrationWarning!==!0&&TE(O.textContent,Ae,p),V=["children",""+Ae]):l.hasOwnProperty(ce)&&Ae!=null&&ce==="onScroll"&&Ai("scroll",O)}switch(C){case"input":jt(O),we(O,H,!0);break;case"textarea":jt(O),fn(O);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(O.onclick=wE)}O=V,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ce=V.nodeType===9?V:V.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=mn(C)),p==="http://www.w3.org/1999/xhtml"?C==="script"?(p=ce.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ce.createElement(C,{is:O.is}):(p=ce.createElement(C),C==="select"&&(ce=p,O.multiple?ce.multiple=!0:O.size&&(ce.size=O.size))):p=ce.createElementNS(p,C),p[nu]=g,p[uh]=O,YI(p,g,!1,!1),g.stateNode=p;e:{switch(ce=dl(C,O),C){case"dialog":Ai("cancel",p),Ai("close",p),V=O;break;case"iframe":case"object":case"embed":Ai("load",p),V=O;break;case"video":case"audio":for(V=0;V<c_.length;V++)Ai(c_[V],p);V=O;break;case"source":Ai("error",p),V=O;break;case"img":case"image":case"link":Ai("error",p),Ai("load",p),V=O;break;case"details":Ai("toggle",p),V=O;break;case"input":Qt(p,O),V=jn(p,O),Ai("invalid",p);break;case"option":V=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},V=ke({},O,{value:void 0}),Ai("invalid",p);break;case"textarea":St(p,O),V=vt(p,O),Ai("invalid",p);break;default:V=O}Wa(C,V),Ae=V;for(H in Ae)if(Ae.hasOwnProperty(H)){var Le=Ae[H];H==="style"?Qs(p,Le):H==="dangerouslySetInnerHTML"?(Le=Le?Le.__html:void 0,Le!=null&&fc(p,Le)):H==="children"?typeof Le=="string"?(C!=="textarea"||Le!=="")&&Bt(p,Le):typeof Le=="number"&&Bt(p,""+Le):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Le!=null&&H==="onScroll"&&Ai("scroll",p):Le!=null&&X(p,H,Le,ce))}switch(C){case"input":jt(p),we(p,O,!1);break;case"textarea":jt(p),fn(p);break;case"option":O.value!=null&&p.setAttribute("value",""+ht(O.value));break;case"select":p.multiple=!!O.multiple,H=O.value,H!=null?_t(p,!!O.multiple,H,!1):O.defaultValue!=null&&_t(p,!!O.multiple,O.defaultValue,!0);break;default:typeof V.onClick=="function"&&(p.onclick=wE)}switch(C){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return bo(g),null;case 6:if(p&&g.stateNode!=null)XI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(i(166));if(C=zp(wm.current),zp(iu.current),m_(g)){if(O=g.stateNode,C=g.memoizedProps,O[nu]=g,(H=O.nodeValue!==C)&&(p=va,p!==null))switch(p.tag){case 3:TE(O.nodeValue,C,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&TE(O.nodeValue,C,(p.mode&1)!==0)}H&&(g.flags|=4)}else O=(C.nodeType===9?C:C.ownerDocument).createTextNode(O),O[nu]=g,g.stateNode=O}return bo(g),null;case 13:if(Pi(Di),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(pi&&Sa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)_I(),Sm(),g.flags|=98560,H=!1;else if(H=m_(g),O!==null&&O.dehydrated!==null){if(p===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[nu]=g}else Sm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;bo(g),H=!1}else $o!==null&&(pv($o),$o=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=C,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Di.current&1)!==0?_s===0&&(_s=3):eT())),g.updateQueue!==null&&(g.flags|=4),bo(g),null);case 4:return Gp(),QE(p,g),p===null&&Lp(g.stateNode.containerInfo),bo(g),null;case 10:return Sb(g.type._context),bo(g),null;case 17:return Ea(g.type)&&RE(),bo(g),null;case 19:if(Pi(Di),H=g.memoizedState,H===null)return bo(g),null;if(O=(g.flags&128)!==0,ce=H.rendering,ce===null)if(O)R_(H,!1);else{if(_s!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ce=gh(p),ce!==null){for(g.flags|=128,R_(H,!1),O=ce.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=C,C=g.child;C!==null;)H=C,p=O,H.flags&=14680066,ce=H.alternate,ce===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ce.childLanes,H.lanes=ce.lanes,H.child=ce.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ce.memoizedProps,H.memoizedState=ce.memoizedState,H.updateQueue=ce.updateQueue,H.type=ce.type,p=ce.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),C=C.sibling;return bi(Di,Di.current&1|2),g.child}p=p.sibling}H.tail!==null&&$r()>xm&&(g.flags|=128,O=!0,R_(H,!1),g.lanes=4194304)}else{if(!O)if(p=gh(ce),p!==null){if(g.flags|=128,O=!0,C=p.updateQueue,C!==null&&(g.updateQueue=C,g.flags|=4),R_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ce.alternate&&!pi)return bo(g),null}else 2*$r()-H.renderingStartTime>xm&&C!==1073741824&&(g.flags|=128,O=!0,R_(H,!1),g.lanes=4194304);H.isBackwards?(ce.sibling=g.child,g.child=ce):(C=H.last,C!==null?C.sibling=ce:g.child=ce,H.last=ce)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=$r(),g.sibling=null,C=Di.current,bi(Di,O?C&1|2:C&1),g):(bo(g),null);case 22:case 23:return x_(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(Qa&1073741824)!==0&&(bo(g),g.subtreeFlags&6&&(g.flags|=8192)):bo(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function vD(p,g){switch(f_(g),g.tag){case 1:return Ea(g.type)&&RE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Gp(),Pi(ya),Pi(vo),Rb(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return Cm(g),null;case 13:if(Pi(Di),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(i(340));Sm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Pi(Di),null;case 4:return Gp(),null;case 10:return Sb(g.type._context),null;case 22:case 23:return x_(),null;case 24:return null;default:return null}}var ev=!1,To=!1,JI=typeof WeakSet=="function"?WeakSet:Set,Zt=null;function Nm(p,g){var C=p.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(O){Vi(p,g,O)}else C.current=null}function I_(p,g,C){try{C()}catch(O){Vi(p,g,O)}}var QI=!1;function Hb(p,g){if(CE=Se,p=ZR(),s_(p)){if("selectionStart"in p)var C={start:p.selectionStart,end:p.selectionEnd};else e:{C=(C=p.ownerDocument)&&C.defaultView||window;var O=C.getSelection&&C.getSelection();if(O&&O.rangeCount!==0){C=O.anchorNode;var V=O.anchorOffset,H=O.focusNode;O=O.focusOffset;try{C.nodeType,H.nodeType}catch{C=null;break e}var ce=0,Ae=-1,Le=-1,st=0,At=0,Pt=p,Rt=null;t:for(;;){for(var Kt;Pt!==C||V!==0&&Pt.nodeType!==3||(Ae=ce+V),Pt!==H||O!==0&&Pt.nodeType!==3||(Le=ce+O),Pt.nodeType===3&&(ce+=Pt.nodeValue.length),(Kt=Pt.firstChild)!==null;)Rt=Pt,Pt=Kt;for(;;){if(Pt===p)break t;if(Rt===C&&++st===V&&(Ae=ce),Rt===H&&++At===O&&(Le=ce),(Kt=Pt.nextSibling)!==null)break;Pt=Rt,Rt=Pt.parentNode}Pt=Kt}C=Ae===-1||Le===-1?null:{start:Ae,end:Le}}else C=null}C=C||{start:0,end:0}}else C=null;for(u_={focusedElem:p,selectionRange:C},Se=!1,Zt=g;Zt!==null;)if(g=Zt,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,Zt=p;else for(;Zt!==null;){g=Zt;try{var tn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var nn=tn.memoizedProps,Zi=tn.memoizedState,Ye=g.stateNode,je=Ye.getSnapshotBeforeUpdate(g.elementType===g.type?nn:Ja(g.type,nn),Zi);Ye.__reactInternalSnapshotBeforeUpdate=je}break;case 3:var Ze=g.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(xt){Vi(g,g.return,xt)}if(p=g.sibling,p!==null){p.return=g.return,Zt=p;break}Zt=g.return}return tn=QI,QI=!1,tn}function A_(p,g,C){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var V=O=O.next;do{if((V.tag&p)===p){var H=V.destroy;V.destroy=void 0,H!==void 0&&I_(g,C,H)}V=V.next}while(V!==O)}}function P_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var C=g=g.next;do{if((C.tag&p)===p){var O=C.create;C.destroy=O()}C=C.next}while(C!==g)}}function $b(p){var g=p.ref;if(g!==null){var C=p.stateNode;switch(p.tag){case 5:p=C;break;default:p=C}typeof g=="function"?g(p):g.current=p}}function ZI(p){var g=p.alternate;g!==null&&(p.alternate=null,ZI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[nu],delete g[uh],delete g[h_],delete g[lD],delete g[uD])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Kb(p){return p.tag===5||p.tag===3||p.tag===4}function eA(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Kb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function qb(p,g,C){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?C.nodeType===8?C.parentNode.insertBefore(p,g):C.insertBefore(p,g):(C.nodeType===8?(g=C.parentNode,g.insertBefore(p,C)):(g=C,g.appendChild(p)),C=C._reactRootContainer,C!=null||g.onclick!==null||(g.onclick=wE));else if(O!==4&&(p=p.child,p!==null))for(qb(p,g,C),p=p.sibling;p!==null;)qb(p,g,C),p=p.sibling}function tv(p,g,C){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?C.insertBefore(p,g):C.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(tv(p,g,C),p=p.sibling;p!==null;)tv(p,g,C),p=p.sibling}var eo=null,kc=!1;function au(p,g,C){for(C=C.child;C!==null;)tA(p,g,C),C=C.sibling}function tA(p,g,C){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(ql,C)}catch{}switch(C.tag){case 5:To||Nm(C,g);case 6:var O=eo,V=kc;eo=null,au(p,g,C),eo=O,kc=V,eo!==null&&(kc?(p=eo,C=C.stateNode,p.nodeType===8?p.parentNode.removeChild(C):p.removeChild(C)):eo.removeChild(C.stateNode));break;case 18:eo!==null&&(kc?(p=eo,C=C.stateNode,p.nodeType===8?fb(p.parentNode,C):p.nodeType===1&&fb(p,C),ga(p)):fb(eo,C.stateNode));break;case 4:O=eo,V=kc,eo=C.stateNode.containerInfo,kc=!0,au(p,g,C),eo=O,kc=V;break;case 0:case 11:case 14:case 15:if(!To&&(O=C.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){V=O=O.next;do{var H=V,ce=H.destroy;H=H.tag,ce!==void 0&&((H&2)!==0||(H&4)!==0)&&I_(C,g,ce),V=V.next}while(V!==O)}au(p,g,C);break;case 1:if(!To&&(Nm(C,g),O=C.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=C.memoizedProps,O.state=C.memoizedState,O.componentWillUnmount()}catch(Ae){Vi(C,g,Ae)}au(p,g,C);break;case 21:au(p,g,C);break;case 22:C.mode&1?(To=(O=To)||C.memoizedState!==null,au(p,g,C),To=O):au(p,g,C);break;default:au(p,g,C)}}function nA(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var C=p.stateNode;C===null&&(C=p.stateNode=new JI),g.forEach(function(O){var V=cA.bind(null,p,O);C.has(O)||(C.add(O),O.then(V,V))})}}function Yo(p,g){var C=g.deletions;if(C!==null)for(var O=0;O<C.length;O++){var V=C[O];try{var H=p,ce=g,Ae=ce;e:for(;Ae!==null;){switch(Ae.tag){case 5:eo=Ae.stateNode,kc=!1;break e;case 3:eo=Ae.stateNode.containerInfo,kc=!0;break e;case 4:eo=Ae.stateNode.containerInfo,kc=!0;break e}Ae=Ae.return}if(eo===null)throw Error(i(160));tA(H,ce,V),eo=null,kc=!1;var Le=V.alternate;Le!==null&&(Le.return=null),V.return=null}catch(st){Vi(V,g,st)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Yb(g,p),g=g.sibling}function Yb(p,g){var C=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Yo(g,p),wa(p),O&4){try{A_(3,p,p.return),P_(3,p)}catch(nn){Vi(p,p.return,nn)}try{A_(5,p,p.return)}catch(nn){Vi(p,p.return,nn)}}break;case 1:Yo(g,p),wa(p),O&512&&C!==null&&Nm(C,C.return);break;case 5:if(Yo(g,p),wa(p),O&512&&C!==null&&Nm(C,C.return),p.flags&32){var V=p.stateNode;try{Bt(V,"")}catch(nn){Vi(p,p.return,nn)}}if(O&4&&(V=p.stateNode,V!=null)){var H=p.memoizedProps,ce=C!==null?C.memoizedProps:H,Ae=p.type,Le=p.updateQueue;if(p.updateQueue=null,Le!==null)try{Ae==="input"&&H.type==="radio"&&H.name!=null&&Ot(V,H),dl(Ae,ce);var st=dl(Ae,H);for(ce=0;ce<Le.length;ce+=2){var At=Le[ce],Pt=Le[ce+1];At==="style"?Qs(V,Pt):At==="dangerouslySetInnerHTML"?fc(V,Pt):At==="children"?Bt(V,Pt):X(V,At,Pt,st)}switch(Ae){case"input":Lt(V,H);break;case"textarea":Ht(V,H);break;case"select":var Rt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!H.multiple;var Kt=H.value;Kt!=null?_t(V,!!H.multiple,Kt,!1):Rt!==!!H.multiple&&(H.defaultValue!=null?_t(V,!!H.multiple,H.defaultValue,!0):_t(V,!!H.multiple,H.multiple?[]:"",!1))}V[uh]=H}catch(nn){Vi(p,p.return,nn)}}break;case 6:if(Yo(g,p),wa(p),O&4){if(p.stateNode===null)throw Error(i(162));V=p.stateNode,H=p.memoizedProps;try{V.nodeValue=H}catch(nn){Vi(p,p.return,nn)}}break;case 3:if(Yo(g,p),wa(p),O&4&&C!==null&&C.memoizedState.isDehydrated)try{ga(g.containerInfo)}catch(nn){Vi(p,p.return,nn)}break;case 4:Yo(g,p),wa(p);break;case 13:Yo(g,p),wa(p),V=p.child,V.flags&8192&&(H=V.memoizedState!==null,V.stateNode.isHidden=H,!H||V.alternate!==null&&V.alternate.memoizedState!==null||(av=$r())),O&4&&nA(p);break;case 22:if(At=C!==null&&C.memoizedState!==null,p.mode&1?(To=(st=To)||At,Yo(g,p),To=st):Yo(g,p),wa(p),O&8192){if(st=p.memoizedState!==null,(p.stateNode.isHidden=st)&&!At&&(p.mode&1)!==0)for(Zt=p,At=p.child;At!==null;){for(Pt=Zt=At;Zt!==null;){switch(Rt=Zt,Kt=Rt.child,Rt.tag){case 0:case 11:case 14:case 15:A_(4,Rt,Rt.return);break;case 1:Nm(Rt,Rt.return);var tn=Rt.stateNode;if(typeof tn.componentWillUnmount=="function"){O=Rt,C=Rt.return;try{g=O,tn.props=g.memoizedProps,tn.state=g.memoizedState,tn.componentWillUnmount()}catch(nn){Vi(O,C,nn)}}break;case 5:Nm(Rt,Rt.return);break;case 22:if(Rt.memoizedState!==null){O_(Pt);continue}}Kt!==null?(Kt.return=Rt,Zt=Kt):O_(Pt)}At=At.sibling}e:for(At=null,Pt=p;;){if(Pt.tag===5){if(At===null){At=Pt;try{V=Pt.stateNode,st?(H=V.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ae=Pt.stateNode,Le=Pt.memoizedProps.style,ce=Le!=null&&Le.hasOwnProperty("display")?Le.display:null,Ae.style.display=Fs("display",ce))}catch(nn){Vi(p,p.return,nn)}}}else if(Pt.tag===6){if(At===null)try{Pt.stateNode.nodeValue=st?"":Pt.memoizedProps}catch(nn){Vi(p,p.return,nn)}}else if((Pt.tag!==22&&Pt.tag!==23||Pt.memoizedState===null||Pt===p)&&Pt.child!==null){Pt.child.return=Pt,Pt=Pt.child;continue}if(Pt===p)break e;for(;Pt.sibling===null;){if(Pt.return===null||Pt.return===p)break e;At===Pt&&(At=null),Pt=Pt.return}At===Pt&&(At=null),Pt.sibling.return=Pt.return,Pt=Pt.sibling}}break;case 19:Yo(g,p),wa(p),O&4&&nA(p);break;case 21:break;default:Yo(g,p),wa(p)}}function wa(p){var g=p.flags;if(g&2){try{e:{for(var C=p.return;C!==null;){if(Kb(C)){var O=C;break e}C=C.return}throw Error(i(160))}switch(O.tag){case 5:var V=O.stateNode;O.flags&32&&(Bt(V,""),O.flags&=-33);var H=eA(p);tv(p,H,V);break;case 3:case 4:var ce=O.stateNode.containerInfo,Ae=eA(p);qb(p,Ae,ce);break;default:throw Error(i(161))}}catch(Le){Vi(p,p.return,Le)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Dm(p,g,C){Zt=p,Xb(p)}function Xb(p,g,C){for(var O=(p.mode&1)!==0;Zt!==null;){var V=Zt,H=V.child;if(V.tag===22&&O){var ce=V.memoizedState!==null||ev;if(!ce){var Ae=V.alternate,Le=Ae!==null&&Ae.memoizedState!==null||To;Ae=ev;var st=To;if(ev=ce,(To=Le)&&!st)for(Zt=V;Zt!==null;)ce=Zt,Le=ce.child,ce.tag===22&&ce.memoizedState!==null?rA(V):Le!==null?(Le.return=ce,Zt=Le):rA(V);for(;H!==null;)Zt=H,Xb(H),H=H.sibling;Zt=V,ev=Ae,To=st}nv(p)}else(V.subtreeFlags&8772)!==0&&H!==null?(H.return=V,Zt=H):nv(p)}}function nv(p){for(;Zt!==null;){var g=Zt;if((g.flags&8772)!==0){var C=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:To||P_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!To)if(C===null)O.componentDidMount();else{var V=g.elementType===g.type?C.memoizedProps:Ja(g.type,C.memoizedProps);O.componentDidUpdate(V,C.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&bI(g,H,O);break;case 3:var ce=g.updateQueue;if(ce!==null){if(C=null,g.child!==null)switch(g.child.tag){case 5:C=g.child.stateNode;break;case 1:C=g.child.stateNode}bI(g,ce,C)}break;case 5:var Ae=g.stateNode;if(C===null&&g.flags&4){C=Ae;var Le=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Le.autoFocus&&C.focus();break;case"img":Le.src&&(C.src=Le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var st=g.alternate;if(st!==null){var At=st.memoizedState;if(At!==null){var Pt=At.dehydrated;Pt!==null&&ga(Pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}To||g.flags&512&&$b(g)}catch(Rt){Vi(g,g.return,Rt)}}if(g===p){Zt=null;break}if(C=g.sibling,C!==null){C.return=g.return,Zt=C;break}Zt=g.return}}function O_(p){for(;Zt!==null;){var g=Zt;if(g===p){Zt=null;break}var C=g.sibling;if(C!==null){C.return=g.return,Zt=C;break}Zt=g.return}}function rA(p){for(;Zt!==null;){var g=Zt;try{switch(g.tag){case 0:case 11:case 15:var C=g.return;try{P_(4,g)}catch(Le){Vi(g,C,Le)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var V=g.return;try{O.componentDidMount()}catch(Le){Vi(g,V,Le)}}var H=g.return;try{$b(g)}catch(Le){Vi(g,H,Le)}break;case 5:var ce=g.return;try{$b(g)}catch(Le){Vi(g,ce,Le)}}}catch(Le){Vi(g,g.return,Le)}if(g===p){Zt=null;break}var Ae=g.sibling;if(Ae!==null){Ae.return=g.return,Zt=Ae;break}Zt=g.return}}var SD=Math.ceil,rv=oe.ReactCurrentDispatcher,iv=oe.ReactCurrentOwner,Nc=oe.ReactCurrentBatchConfig,Or=0,Gs=null,Qi=null,gs=0,Qa=0,Sl=Rc(0),_s=0,to=null,qp=0,sv=0,ov=0,k_=null,Xo=null,av=0,xm=1/0,cu=null,cv=!1,Jb=null,Eh=null,Lm=!1,lu=null,lv=0,Yp=0,Qb=null,N_=-1,uv=0;function no(){return(Or&6)!==0?$r():N_!==-1?N_:N_=$r()}function Dc(p){return(p.mode&1)===0?1:(Or&2)!==0&&gs!==0?gs&-gs:hD.transition!==null?(uv===0&&(uv=Zu()),uv):(p=ar,p!==0||(p=window.event,p=p===void 0?16:Kr(p.type)),p)}function xc(p,g,C,O){if(50<Yp)throw Yp=0,Qb=null,Error(i(185));Jl(p,C,O),((Or&2)===0||p!==Gs)&&(p===Gs&&((Or&2)===0&&(sv|=C),_s===4&&md(p,gs)),wo(p,O),C===1&&Or===0&&(g.mode&1)===0&&(xm=$r()+500,PE&&hh()))}function wo(p,g){var C=p.callbackNode;Ha(p,g);var O=Xl(p,p===Gs?gs:0);if(O===0)C!==null&&Ju(C),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(C!=null&&Ju(C),g===1)p.tag===0?dD(Xp.bind(null,p)):pI(Xp.bind(null,p)),aD(function(){(Or&6)===0&&hh()}),C=null;else{switch(vc(O)){case 1:C=Ec;break;case 4:C=fl;break;case 16:C=fa;break;case 536870912:C=rh;break;default:C=fa}C=L_(C,dv.bind(null,p))}p.callbackPriority=g,p.callbackNode=C}}function dv(p,g){if(N_=-1,uv=0,(Or&6)!==0)throw Error(i(327));var C=p.callbackNode;if(Mm()&&p.callbackNode!==C)return null;var O=Xl(p,p===Gs?gs:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=uu(p,O);else{g=O;var V=Or;Or|=2;var H=iA();(Gs!==p||gs!==g)&&(cu=null,xm=$r()+500,vh(p,g));do try{bD();break}catch(Ae){Zb(p,Ae)}while(!0);vb(),rv.current=H,Or=V,Qi!==null?g=0:(Gs=null,gs=0,g=_s)}if(g!==0){if(g===2&&(V=Lo(p),V!==0&&(O=V,g=hv(p,V))),g===1)throw C=to,vh(p,0),md(p,O),wo(p,$r()),C;if(g===6)md(p,O);else{if(V=p.current.alternate,(O&30)===0&&!fv(V)&&(g=uu(p,O),g===2&&(H=Lo(p),H!==0&&(O=H,g=hv(p,H))),g===1))throw C=to,vh(p,0),md(p,O),wo(p,$r()),C;switch(p.finishedWork=V,p.finishedLanes=O,g){case 0:case 1:throw Error(i(345));case 2:Jp(p,Xo,cu);break;case 3:if(md(p,O),(O&130023424)===O&&(g=av+500-$r(),10<g)){if(Xl(p,0)!==0)break;if(V=p.suspendedLanes,(V&O)!==O){no(),p.pingedLanes|=p.suspendedLanes&V;break}p.timeoutHandle=d_(Jp.bind(null,p,Xo,cu),g);break}Jp(p,Xo,cu);break;case 4:if(md(p,O),(O&4194240)===O)break;for(g=p.eventTimes,V=-1;0<O;){var ce=31-Zs(O);H=1<<ce,ce=g[ce],ce>V&&(V=ce),O&=~H}if(O=V,O=$r()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*SD(O/1960))-O,10<O){p.timeoutHandle=d_(Jp.bind(null,p,Xo,cu),O);break}Jp(p,Xo,cu);break;case 5:Jp(p,Xo,cu);break;default:throw Error(i(329))}}}return wo(p,$r()),p.callbackNode===C?dv.bind(null,p):null}function hv(p,g){var C=k_;return p.current.memoizedState.isDehydrated&&(vh(p,g).flags|=256),p=uu(p,g),p!==2&&(g=Xo,Xo=C,g!==null&&pv(g)),p}function pv(p){Xo===null?Xo=p:Xo.push.apply(Xo,p)}function fv(p){for(var g=p;;){if(g.flags&16384){var C=g.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var O=0;O<C.length;O++){var V=C[O],H=V.getSnapshot;V=V.value;try{if(!vl(H(),V))return!1}catch{return!1}}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function md(p,g){for(g&=~ov,g&=~sv,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var C=31-Zs(g),O=1<<C;p[C]=-1,g&=~O}}function Xp(p){if((Or&6)!==0)throw Error(i(327));Mm();var g=Xl(p,0);if((g&1)===0)return wo(p,$r()),null;var C=uu(p,g);if(p.tag!==0&&C===2){var O=Lo(p);O!==0&&(g=O,C=hv(p,O))}if(C===1)throw C=to,vh(p,0),md(p,g),wo(p,$r()),C;if(C===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Jp(p,Xo,cu),wo(p,$r()),null}function D_(p,g){var C=Or;Or|=1;try{return p(g)}finally{Or=C,Or===0&&(xm=$r()+500,PE&&hh())}}function gd(p){lu!==null&&lu.tag===0&&(Or&6)===0&&Mm();var g=Or;Or|=1;var C=Nc.transition,O=ar;try{if(Nc.transition=null,ar=1,p)return p()}finally{ar=O,Nc.transition=C,Or=g,(Or&6)===0&&hh()}}function x_(){Qa=Sl.current,Pi(Sl)}function vh(p,g){p.finishedWork=null,p.finishedLanes=0;var C=p.timeoutHandle;if(C!==-1&&(p.timeoutHandle=-1,oD(C)),Qi!==null)for(C=Qi.return;C!==null;){var O=C;switch(f_(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&RE();break;case 3:Gp(),Pi(ya),Pi(vo),Rb();break;case 5:Cm(O);break;case 4:Gp();break;case 13:Pi(Di);break;case 19:Pi(Di);break;case 10:Sb(O.type._context);break;case 22:case 23:x_()}C=C.return}if(Gs=p,Qi=p=_d(p.current,null),gs=Qa=g,_s=0,to=null,ov=sv=qp=0,Xo=k_=null,Wp!==null){for(g=0;g<Wp.length;g++)if(C=Wp[g],O=C.interleaved,O!==null){C.interleaved=null;var V=O.next,H=C.pending;if(H!==null){var ce=H.next;H.next=V,O.next=ce}C.pending=O}Wp=null}return p}function Zb(p,g){do{var C=Qi;try{if(vb(),VE.current=WE,Rm){for(var O=Ui.memoizedState;O!==null;){var V=O.queue;V!==null&&(V.pending=null),O=O.next}Rm=!1}if(su=0,ms=fs=Ui=null,b_=!1,T_=0,iv.current=null,C===null||C.return===null){_s=1,to=g,Qi=null;break}e:{var H=p,ce=C.return,Ae=C,Le=g;if(g=gs,Ae.flags|=32768,Le!==null&&typeof Le=="object"&&typeof Le.then=="function"){var st=Le,At=Ae,Pt=At.tag;if((At.mode&1)===0&&(Pt===0||Pt===11||Pt===15)){var Rt=At.alternate;Rt?(At.updateQueue=Rt.updateQueue,At.memoizedState=Rt.memoizedState,At.lanes=Rt.lanes):(At.updateQueue=null,At.memoizedState=null)}var Kt=VI(ce);if(Kt!==null){Kt.flags&=-257,jI(Kt,ce,Ae,H,g),Kt.mode&1&&UI(H,st,g),g=Kt,Le=st;var tn=g.updateQueue;if(tn===null){var nn=new Set;nn.add(Le),g.updateQueue=nn}else tn.add(Le);break e}else{if((g&1)===0){UI(H,st,g),eT();break e}Le=Error(i(426))}}else if(pi&&Ae.mode&1){var Zi=VI(ce);if(Zi!==null){(Zi.flags&65536)===0&&(Zi.flags|=256),jI(Zi,ce,Ae,H,g),yb(Om(Le,Ae));break e}}H=Le=Om(Le,Ae),_s!==4&&(_s=2),k_===null?k_=[H]:k_.push(H),H=ce;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Ye=Fb(H,Le,g);SI(H,Ye);break e;case 1:Ae=Le;var je=H.type,Ze=H.stateNode;if((H.flags&128)===0&&(typeof je.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(Eh===null||!Eh.has(Ze)))){H.flags|=65536,g&=-g,H.lanes|=g;var xt=fd(H,Ae,g);SI(H,xt);break e}}H=H.return}while(H!==null)}oA(C)}catch(rn){g=rn,Qi===C&&C!==null&&(Qi=C=C.return);continue}break}while(!0)}function iA(){var p=rv.current;return rv.current=WE,p===null?WE:p}function eT(){(_s===0||_s===3||_s===2)&&(_s=4),Gs===null||(qp&268435455)===0&&(sv&268435455)===0||md(Gs,gs)}function uu(p,g){var C=Or;Or|=2;var O=iA();(Gs!==p||gs!==g)&&(cu=null,vh(p,g));do try{sA();break}catch(V){Zb(p,V)}while(!0);if(vb(),Or=C,rv.current=O,Qi!==null)throw Error(i(261));return Gs=null,gs=0,_s}function sA(){for(;Qi!==null;)mv(Qi)}function bD(){for(;Qi!==null&&!xo();)mv(Qi)}function mv(p){var g=yv(p.alternate,p,Qa);p.memoizedProps=p.pendingProps,g===null?oA(p):Qi=g,iv.current=null}function oA(p){var g=p;do{var C=g.alternate;if(p=g.return,(g.flags&32768)===0){if(C=ZE(C,g,Qa),C!==null){Qi=C;return}}else{if(C=vD(C,g),C!==null){C.flags&=32767,Qi=C;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{_s=6,Qi=null;return}}if(g=g.sibling,g!==null){Qi=g;return}Qi=g=p}while(g!==null);_s===0&&(_s=5)}function Jp(p,g,C){var O=ar,V=Nc.transition;try{Nc.transition=null,ar=1,TD(p,g,C,O)}finally{Nc.transition=V,ar=O}return null}function TD(p,g,C,O){do Mm();while(lu!==null);if((Or&6)!==0)throw Error(i(327));C=p.finishedWork;var V=p.finishedLanes;if(C===null)return null;if(p.finishedWork=null,p.finishedLanes=0,C===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var H=C.lanes|C.childLanes;if(Xr(p,H),p===Gs&&(Qi=Gs=null,gs=0),(C.subtreeFlags&2064)===0&&(C.flags&2064)===0||Lm||(Lm=!0,L_(fa,function(){return Mm(),null})),H=(C.flags&15990)!==0,(C.subtreeFlags&15990)!==0||H){H=Nc.transition,Nc.transition=null;var ce=ar;ar=1;var Ae=Or;Or|=4,iv.current=null,Hb(p,C),Yb(C,p),ab(u_),Se=!!CE,u_=CE=null,p.current=C,Dm(C),nh(),Or=Ae,ar=ce,Nc.transition=H}else p.current=C;if(Lm&&(Lm=!1,lu=p,lv=V),H=p.pendingLanes,H===0&&(Eh=null),nm(C.stateNode),wo(p,$r()),g!==null)for(O=p.onRecoverableError,C=0;C<g.length;C++)V=g[C],O(V.value,{componentStack:V.stack,digest:V.digest});if(cv)throw cv=!1,p=Jb,Jb=null,p;return(lv&1)!==0&&p.tag!==0&&Mm(),H=p.pendingLanes,(H&1)!==0?p===Qb?Yp++:(Yp=0,Qb=p):Yp=0,hh(),null}function Mm(){if(lu!==null){var p=vc(lv),g=Nc.transition,C=ar;try{if(Nc.transition=null,ar=16>p?16:p,lu===null)var O=!1;else{if(p=lu,lu=null,lv=0,(Or&6)!==0)throw Error(i(331));var V=Or;for(Or|=4,Zt=p.current;Zt!==null;){var H=Zt,ce=H.child;if((Zt.flags&16)!==0){var Ae=H.deletions;if(Ae!==null){for(var Le=0;Le<Ae.length;Le++){var st=Ae[Le];for(Zt=st;Zt!==null;){var At=Zt;switch(At.tag){case 0:case 11:case 15:A_(8,At,H)}var Pt=At.child;if(Pt!==null)Pt.return=At,Zt=Pt;else for(;Zt!==null;){At=Zt;var Rt=At.sibling,Kt=At.return;if(ZI(At),At===st){Zt=null;break}if(Rt!==null){Rt.return=Kt,Zt=Rt;break}Zt=Kt}}}var tn=H.alternate;if(tn!==null){var nn=tn.child;if(nn!==null){tn.child=null;do{var Zi=nn.sibling;nn.sibling=null,nn=Zi}while(nn!==null)}}Zt=H}}if((H.subtreeFlags&2064)!==0&&ce!==null)ce.return=H,Zt=ce;else e:for(;Zt!==null;){if(H=Zt,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:A_(9,H,H.return)}var Ye=H.sibling;if(Ye!==null){Ye.return=H.return,Zt=Ye;break e}Zt=H.return}}var je=p.current;for(Zt=je;Zt!==null;){ce=Zt;var Ze=ce.child;if((ce.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=ce,Zt=Ze;else e:for(ce=je;Zt!==null;){if(Ae=Zt,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:P_(9,Ae)}}catch(rn){Vi(Ae,Ae.return,rn)}if(Ae===ce){Zt=null;break e}var xt=Ae.sibling;if(xt!==null){xt.return=Ae.return,Zt=xt;break e}Zt=Ae.return}}if(Or=V,hh(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(ql,p)}catch{}O=!0}return O}finally{ar=C,Nc.transition=g}}return!1}function gv(p,g,C){g=Om(C,g),g=Fb(p,g,1),p=mh(p,g,1),g=no(),p!==null&&(Jl(p,1,g),wo(p,g))}function Vi(p,g,C){if(p.tag===3)gv(p,p,C);else for(;g!==null;){if(g.tag===3){gv(g,p,C);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Eh===null||!Eh.has(O))){p=Om(C,p),p=fd(g,p,1),g=mh(g,p,1),p=no(),g!==null&&(Jl(g,1,p),wo(g,p));break}}g=g.return}}function aA(p,g,C){var O=p.pingCache;O!==null&&O.delete(g),g=no(),p.pingedLanes|=p.suspendedLanes&C,Gs===p&&(gs&C)===C&&(_s===4||_s===3&&(gs&130023424)===gs&&500>$r()-av?vh(p,0):ov|=C),wo(p,g)}function tT(p,g){g===0&&((p.mode&1)===0?g=1:(g=_r,_r<<=1,(_r&130023424)===0&&(_r=4194304)));var C=no();p=dd(p,g),p!==null&&(Jl(p,g,C),wo(p,C))}function _v(p){var g=p.memoizedState,C=0;g!==null&&(C=g.retryLane),tT(p,C)}function cA(p,g){var C=0;switch(p.tag){case 13:var O=p.stateNode,V=p.memoizedState;V!==null&&(C=V.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(i(314))}O!==null&&O.delete(g),tT(p,C)}var yv;yv=function(p,g,C){if(p!==null)if(p.memoizedProps!==g.pendingProps||ya.current)Ta=!0;else{if((p.lanes&C)===0&&(g.flags&128)===0)return Ta=!1,qI(p,g,C);Ta=(p.flags&131072)!==0}else Ta=!1,pi&&(g.flags&1048576)!==0&&kE(g,OE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;JE(p,g),p=g.pendingProps;var V=Fp(g,vo.current);ud(g,C),V=Im(null,g,O,p,V,C);var H=Pb();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ea(O)?(H=!0,AE(g)):H=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,y_(g),V.updater=GE,g.stateNode=V,V._reactInternals=g,Ub(g,O,p,C),g=$E(null,g,O,!0,H,C)):(g.tag=0,pi&&H&&NE(g),qo(null,g,V,C),g=g.child),g;case 16:O=g.elementType;e:{switch(JE(p,g),p=g.pendingProps,V=O._init,O=V(O._payload),g.type=O,V=g.tag=Qp(O),p=Ja(O,p),V){case 0:g=Bb(null,g,O,p,C);break e;case 1:g=GI(null,g,O,p,C);break e;case 11:g=HE(null,g,O,p,C);break e;case 14:g=FI(null,g,O,Ja(O.type,p),C);break e}throw Error(i(306,O,""))}return g;case 0:return O=g.type,V=g.pendingProps,V=g.elementType===O?V:Ja(O,V),Bb(p,g,O,V,C);case 1:return O=g.type,V=g.pendingProps,V=g.elementType===O?V:Ja(O,V),GI(p,g,O,V,C);case 3:e:{if(Wb(g),p===null)throw Error(i(387));O=g.pendingProps,H=g.memoizedState,V=H.element,vI(p,g),UE(g,O,null,C);var ce=g.memoizedState;if(O=ce.element,H.isDehydrated)if(H={element:O,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){V=Om(Error(i(423)),g),g=HI(p,g,O,C,V);break e}else if(O!==V){V=Om(Error(i(424)),g),g=HI(p,g,O,C,V);break e}else for(Sa=lh(g.stateNode.containerInfo.firstChild),va=g,pi=!0,$o=null,C=yI(g,null,O,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Sm(),O===V){g=ou(p,g,C);break e}qo(p,g,O,C)}g=g.child}return g;case 5:return TI(g),p===null&&_b(g),O=g.type,V=g.pendingProps,H=p!==null?p.memoizedProps:null,ce=V.children,pb(O,V)?ce=null:H!==null&&pb(O,H)&&(g.flags|=32),zI(p,g),qo(p,g,ce,C),g.child;case 6:return p===null&&_b(g),null;case 13:return KE(p,g,C);case 4:return wb(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=bm(g,null,O,C):qo(p,g,O,C),g.child;case 11:return O=g.type,V=g.pendingProps,V=g.elementType===O?V:Ja(O,V),HE(p,g,O,V,C);case 7:return qo(p,g,g.pendingProps,C),g.child;case 8:return qo(p,g,g.pendingProps.children,C),g.child;case 12:return qo(p,g,g.pendingProps.children,C),g.child;case 10:e:{if(O=g.type._context,V=g.pendingProps,H=g.memoizedProps,ce=V.value,bi(LE,O._currentValue),O._currentValue=ce,H!==null)if(vl(H.value,ce)){if(H.children===V.children&&!ya.current){g=ou(p,g,C);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ae=H.dependencies;if(Ae!==null){ce=H.child;for(var Le=Ae.firstContext;Le!==null;){if(Le.context===O){if(H.tag===1){Le=ru(-1,C&-C),Le.tag=2;var st=H.updateQueue;if(st!==null){st=st.shared;var At=st.pending;At===null?Le.next=Le:(Le.next=At.next,At.next=Le),st.pending=Le}}H.lanes|=C,Le=H.alternate,Le!==null&&(Le.lanes|=C),bb(H.return,C,g),Ae.lanes|=C;break}Le=Le.next}}else if(H.tag===10)ce=H.type===g.type?null:H.child;else if(H.tag===18){if(ce=H.return,ce===null)throw Error(i(341));ce.lanes|=C,Ae=ce.alternate,Ae!==null&&(Ae.lanes|=C),bb(ce,C,g),ce=H.sibling}else ce=H.child;if(ce!==null)ce.return=H;else for(ce=H;ce!==null;){if(ce===g){ce=null;break}if(H=ce.sibling,H!==null){H.return=ce.return,ce=H;break}ce=ce.return}H=ce}qo(p,g,V.children,C),g=g.child}return g;case 9:return V=g.type,O=g.pendingProps.children,ud(g,C),V=Pc(V),O=O(V),g.flags|=1,qo(p,g,O,C),g.child;case 14:return O=g.type,V=Ja(O,g.pendingProps),V=Ja(O.type,V),FI(p,g,O,V,C);case 15:return BI(p,g,g.type,g.pendingProps,C);case 17:return O=g.type,V=g.pendingProps,V=g.elementType===O?V:Ja(O,V),JE(p,g),g.tag=1,Ea(O)?(p=!0,AE(g)):p=!1,ud(g,C),LI(g,O,V),Ub(g,O,V,C),$E(null,g,O,!0,p,C);case 19:return XE(p,g,C);case 22:return WI(p,g,C)}throw Error(i(156,g.tag))};function L_(p,g){return th(p,g)}function Ev(p,g,C,O){this.tag=p,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Za(p,g,C,O){return new Ev(p,g,C,O)}function Sh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Qp(p){if(typeof p=="function")return Sh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===he)return 11;if(p===ze)return 14}return 2}function _d(p,g){var C=p.alternate;return C===null?(C=Za(p.tag,g,p.key,p.mode),C.elementType=p.elementType,C.type=p.type,C.stateNode=p.stateNode,C.alternate=p,p.alternate=C):(C.pendingProps=g,C.type=p.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=p.flags&14680064,C.childLanes=p.childLanes,C.lanes=p.lanes,C.child=p.child,C.memoizedProps=p.memoizedProps,C.memoizedState=p.memoizedState,C.updateQueue=p.updateQueue,g=p.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=p.sibling,C.index=p.index,C.ref=p.ref,C}function vv(p,g,C,O,V,H){var ce=2;if(O=p,typeof p=="function")Sh(p)&&(ce=1);else if(typeof p=="string")ce=5;else e:switch(p){case te:return Zp(C.children,V,H,g);case Z:ce=8,V|=8;break;case ne:return p=Za(12,C,g,V|2),p.elementType=ne,p.lanes=H,p;case ue:return p=Za(13,C,g,V),p.elementType=ue,p.lanes=H,p;case Ue:return p=Za(19,C,g,V),p.elementType=Ue,p.lanes=H,p;case Ce:return bh(C,V,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ae:ce=10;break e;case me:ce=9;break e;case he:ce=11;break e;case ze:ce=14;break e;case tt:ce=16,O=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return g=Za(ce,C,g,V),g.elementType=p,g.type=O,g.lanes=H,g}function Zp(p,g,C,O){return p=Za(7,p,O,g),p.lanes=C,p}function bh(p,g,C,O){return p=Za(22,p,O,g),p.elementType=Ce,p.lanes=C,p.stateNode={isHidden:!1},p}function nT(p,g,C){return p=Za(6,p,null,g),p.lanes=C,p}function rT(p,g,C){return g=Za(4,p.children!==null?p.children:[],p.key,g),g.lanes=C,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function wD(p,g,C,O,V){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gl(0),this.expirationTimes=gl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gl(0),this.identifierPrefix=O,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function iT(p,g,C,O,V,H,ce,Ae,Le){return p=new wD(p,g,C,Ae,Le),g===1?(g=1,H===!0&&(g|=8)):g=0,H=Za(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:O,isDehydrated:C,cache:null,transitions:null,pendingSuspenseBoundaries:null},y_(H),p}function CD(p,g,C){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:O==null?null:""+O,children:p,containerInfo:g,implementation:C}}function lA(p){if(!p)return dh;p=p._reactInternals;e:{if(Ws(p)!==p||p.tag!==1)throw Error(i(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ea(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(p.tag===1){var C=p.type;if(Ea(C))return IE(p,C,g)}return g}function Sv(p,g,C,O,V,H,ce,Ae,Le){return p=iT(C,O,!0,p,V,H,ce,Ae,Le),p.context=lA(null),C=p.current,O=no(),V=Dc(C),H=ru(O,V),H.callback=g??null,mh(C,H,V),p.current.lanes=V,Jl(p,V,O),wo(p,O),p}function M_(p,g,C,O){var V=g.current,H=no(),ce=Dc(V);return C=lA(C),g.context===null?g.context=C:g.pendingContext=C,g=ru(H,ce),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=mh(V,g,ce),p!==null&&(xc(p,V,ce,H),E_(p,V,ce)),ce}function bv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function sT(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var C=p.retryLane;p.retryLane=C!==0&&C<g?C:g}}function oT(p,g){sT(p,g),(p=p.alternate)&&sT(p,g)}function U_(){return null}var bl=typeof reportError=="function"?reportError:function(p){console.error(p)};function Tv(p){this._internalRoot=p}wv.prototype.render=Tv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(i(409));M_(p,g,null,null)},wv.prototype.unmount=Tv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;gd(function(){M_(null,p,null,null)}),g[Cc]=null}};function wv(p){this._internalRoot=p}wv.prototype.unstable_scheduleHydration=function(p){if(p){var g=Ip();p={blockedOn:null,target:p,priority:g};for(var C=0;C<Fo.length&&g!==0&&g<Fo[C].priority;C++);Fo.splice(C,0,p),C===0&&Pp(p)}};function aT(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Um(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function cT(){}function RD(p,g,C,O,V){if(V){if(typeof O=="function"){var H=O;O=function(){var st=bv(ce);H.call(st)}}var ce=Sv(g,O,p,0,null,!1,!1,"",cT);return p._reactRootContainer=ce,p[Cc]=ce.current,Lp(p.nodeType===8?p.parentNode:p),gd(),ce}for(;V=p.lastChild;)p.removeChild(V);if(typeof O=="function"){var Ae=O;O=function(){var st=bv(Le);Ae.call(st)}}var Le=iT(p,0,!1,null,null,!1,!1,"",cT);return p._reactRootContainer=Le,p[Cc]=Le.current,Lp(p.nodeType===8?p.parentNode:p),gd(function(){M_(g,Le,C,O)}),Le}function ef(p,g,C,O,V){var H=C._reactRootContainer;if(H){var ce=H;if(typeof V=="function"){var Ae=V;V=function(){var Le=bv(ce);Ae.call(Le)}}M_(g,ce,p,V)}else ce=RD(C,g,p,V,O);return bv(ce)}rm=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var C=Yl(g.pendingLanes);C!==0&&($a(g,C|1),wo(g,$r()),(Or&6)===0&&(xm=$r()+500,hh()))}break;case 13:gd(function(){var O=dd(p,1);if(O!==null){var V=no();xc(O,p,1,V)}}),oT(p,1)}},Ql=function(p){if(p.tag===13){var g=dd(p,134217728);if(g!==null){var C=no();xc(g,p,134217728,C)}oT(p,134217728)}},oh=function(p){if(p.tag===13){var g=Dc(p),C=dd(p,g);if(C!==null){var O=no();xc(C,p,g,O)}oT(p,g)}},Ip=function(){return ar},im=function(p,g){var C=ar;try{return ar=p,g()}finally{ar=C}},Kl=function(p,g,C){switch(g){case"input":if(Lt(p,C),g=C.name,C.type==="radio"&&g!=null){for(C=p;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<C.length;g++){var O=C[g];if(O!==p&&O.form===p.form){var V=ym(O);if(!V)throw Error(i(90));Dt(O),Lt(O,V)}}}break;case"textarea":Ht(p,C);break;case"select":g=C.value,g!=null&&_t(p,!!C.multiple,g,!1)}},Ku=D_,_c=gd;var Th={usingClientEntryPoint:!1,Events:[_m,Vp,ym,gc,hl,D_]},yd={findFiberByHostInstance:Up,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ID={bundleType:yd.bundleType,version:yd.version,rendererPackageName:yd.rendererPackageName,rendererConfig:yd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oe.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=eh(p),p===null?null:p.stateNode},findFiberByHostInstance:yd.findFiberByHostInstance||U_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cv.isDisabled&&Cv.supportsFiber)try{ql=Cv.inject(ID),Eo=Cv}catch{}}return qc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Th,qc.createPortal=function(p,g){var C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!aT(g))throw Error(i(200));return CD(p,g,null,C)},qc.createRoot=function(p,g){if(!aT(p))throw Error(i(299));var C=!1,O="",V=bl;return g!=null&&(g.unstable_strictMode===!0&&(C=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=iT(p,1,!1,null,null,C,!1,O,V),p[Cc]=g.current,Lp(p.nodeType===8?p.parentNode:p),new Tv(g)},qc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=eh(g),p=p===null?null:p.stateNode,p},qc.flushSync=function(p){return gd(p)},qc.hydrate=function(p,g,C){if(!Um(g))throw Error(i(200));return ef(null,p,g,!0,C)},qc.hydrateRoot=function(p,g,C){if(!aT(p))throw Error(i(405));var O=C!=null&&C.hydratedSources||null,V=!1,H="",ce=bl;if(C!=null&&(C.unstable_strictMode===!0&&(V=!0),C.identifierPrefix!==void 0&&(H=C.identifierPrefix),C.onRecoverableError!==void 0&&(ce=C.onRecoverableError)),g=Sv(g,null,p,1,C??null,V,!1,H,ce),p[Cc]=g.current,Lp(p),O)for(p=0;p<O.length;p++)C=O[p],V=C._getVersion,V=V(C._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[C,V]:g.mutableSourceEagerHydrationData.push(C,V);return new wv(g)},qc.render=function(p,g,C){if(!Um(g))throw Error(i(200));return ef(null,p,g,!1,C)},qc.unmountComponentAtNode=function(p){if(!Um(p))throw Error(i(40));return p._reactRootContainer?(gd(function(){ef(null,null,p,!1,function(){p._reactRootContainer=null,p[Cc]=null})}),!0):!1},qc.unstable_batchedUpdates=D_,qc.unstable_renderSubtreeIntoContainer=function(p,g,C,O){if(!Um(C))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return ef(p,g,C,!1,O)},qc.version="18.3.1-next-f1338f8080-20240426",qc}var VK;function IZ(){if(VK)return vM.exports;VK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),vM.exports=NEe(),vM.exports}var jK;function DEe(){if(jK)return A1;jK=1;var n=IZ();return A1.createRoot=n.createRoot,A1.hydrateRoot=n.hydrateRoot,A1}var xEe=DEe();const AZ=Jf(xEe);var PZ=IZ();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function AC(){return AC=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},AC.apply(this,arguments)}var bg;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(bg||(bg={}));const FK="popstate";function LEe(n){n===void 0&&(n={});function e(a,l){let{pathname:u,search:f,hash:_}=a.location;return tV("",{pathname:u,search:f,hash:_},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function i(a,l){return typeof l=="string"?l:KO(l)}return UEe(e,i,null,n)}function Vs(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function OZ(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function MEe(){return Math.random().toString(36).substr(2,8)}function BK(n,e){return{usr:n.state,key:n.key,idx:e}}function tV(n,e,i,a){return i===void 0&&(i=null),AC({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?z0(e):e,{state:i,key:e&&e.key||a||MEe()})}function KO(n){let{pathname:e="/",search:i="",hash:a=""}=n;return i&&i!=="?"&&(e+=i.charAt(0)==="?"?i:"?"+i),a&&a!=="#"&&(e+=a.charAt(0)==="#"?a:"#"+a),e}function z0(n){let e={};if(n){let i=n.indexOf("#");i>=0&&(e.hash=n.substr(i),n=n.substr(0,i));let a=n.indexOf("?");a>=0&&(e.search=n.substr(a),n=n.substr(0,a)),n&&(e.pathname=n)}return e}function UEe(n,e,i,a){a===void 0&&(a={});let{window:l=document.defaultView,v5Compat:u=!1}=a,f=l.history,_=bg.Pop,E=null,S=w();S==null&&(S=0,f.replaceState(AC({},f.state,{idx:S}),""));function w(){return(f.state||{idx:null}).idx}function I(){_=bg.Pop;let B=w(),q=B==null?null:B-S;S=B,E&&E({action:_,location:F.location,delta:q})}function k(B,q){_=bg.Push;let $=tV(F.location,B,q);S=w()+1;let X=BK($,S),oe=F.createHref($);try{f.pushState(X,"",oe)}catch(re){if(re instanceof DOMException&&re.name==="DataCloneError")throw re;l.location.assign(oe)}u&&E&&E({action:_,location:F.location,delta:1})}function U(B,q){_=bg.Replace;let $=tV(F.location,B,q);S=w();let X=BK($,S),oe=F.createHref($);f.replaceState(X,"",oe),u&&E&&E({action:_,location:F.location,delta:0})}function L(B){let q=l.location.origin!=="null"?l.location.origin:l.location.href,$=typeof B=="string"?B:KO(B);return $=$.replace(/ $/,"%20"),Vs(q,"No window.location.(origin|href) available to create URL for href: "+$),new URL($,q)}let F={get action(){return _},get location(){return n(l,f)},listen(B){if(E)throw new Error("A history only accepts one active listener");return l.addEventListener(FK,I),E=B,()=>{l.removeEventListener(FK,I),E=null}},createHref(B){return e(l,B)},createURL:L,encodeLocation(B){let q=L(B);return{pathname:q.pathname,search:q.search,hash:q.hash}},push:k,replace:U,go(B){return f.go(B)}};return F}var WK;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(WK||(WK={}));function VEe(n,e,i){return i===void 0&&(i="/"),jEe(n,e,i)}function jEe(n,e,i,a){let l=typeof e=="string"?z0(e):e,u=Wj(l.pathname||"/",i);if(u==null)return null;let f=kZ(n);FEe(f);let _=null;for(let E=0;_==null&&E<f.length;++E){let S=QEe(u);_=YEe(f[E],S)}return _}function kZ(n,e,i,a){e===void 0&&(e=[]),i===void 0&&(i=[]),a===void 0&&(a="");let l=(u,f,_)=>{let E={relativePath:_===void 0?u.path||"":_,caseSensitive:u.caseSensitive===!0,childrenIndex:f,route:u};E.relativePath.startsWith("/")&&(Vs(E.relativePath.startsWith(a),'Absolute route path "'+E.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),E.relativePath=E.relativePath.slice(a.length));let S=Cg([a,E.relativePath]),w=i.concat(E);u.children&&u.children.length>0&&(Vs(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+S+'".')),kZ(u.children,e,w,S)),!(u.path==null&&!u.index)&&e.push({path:S,score:KEe(S,u.index),routesMeta:w})};return n.forEach((u,f)=>{var _;if(u.path===""||!((_=u.path)!=null&&_.includes("?")))l(u,f);else for(let E of NZ(u.path))l(u,f,E)}),e}function NZ(n){let e=n.split("/");if(e.length===0)return[];let[i,...a]=e,l=i.endsWith("?"),u=i.replace(/\?$/,"");if(a.length===0)return l?[u,""]:[u];let f=NZ(a.join("/")),_=[];return _.push(...f.map(E=>E===""?u:[u,E].join("/"))),l&&_.push(...f),_.map(E=>n.startsWith("/")&&E===""?"/":E)}function FEe(n){n.sort((e,i)=>e.score!==i.score?i.score-e.score:qEe(e.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}const BEe=/^:[\w-]+$/,WEe=3,zEe=2,GEe=1,HEe=10,$Ee=-2,zK=n=>n==="*";function KEe(n,e){let i=n.split("/"),a=i.length;return i.some(zK)&&(a+=$Ee),e&&(a+=zEe),i.filter(l=>!zK(l)).reduce((l,u)=>l+(BEe.test(u)?WEe:u===""?GEe:HEe),a)}function qEe(n,e){return n.length===e.length&&n.slice(0,-1).every((a,l)=>a===e[l])?n[n.length-1]-e[e.length-1]:0}function YEe(n,e,i){let{routesMeta:a}=n,l={},u="/",f=[];for(let _=0;_<a.length;++_){let E=a[_],S=_===a.length-1,w=u==="/"?e:e.slice(u.length)||"/",I=XEe({path:E.relativePath,caseSensitive:E.caseSensitive,end:S},w),k=E.route;if(!I)return null;Object.assign(l,I.params),f.push({params:l,pathname:Cg([u,I.pathname]),pathnameBase:nve(Cg([u,I.pathnameBase])),route:k}),I.pathnameBase!=="/"&&(u=Cg([u,I.pathnameBase]))}return f}function XEe(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[i,a]=JEe(n.path,n.caseSensitive,n.end),l=e.match(i);if(!l)return null;let u=l[0],f=u.replace(/(.)\/+$/,"$1"),_=l.slice(1);return{params:a.reduce((S,w,I)=>{let{paramName:k,isOptional:U}=w;if(k==="*"){let F=_[I]||"";f=u.slice(0,u.length-F.length).replace(/(.)\/+$/,"$1")}const L=_[I];return U&&!L?S[k]=void 0:S[k]=(L||"").replace(/%2F/g,"/"),S},{}),pathname:u,pathnameBase:f,pattern:n}}function JEe(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!0),OZ(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let a=[],l="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,_,E)=>(a.push({paramName:_,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(a.push({paramName:"*"}),l+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?l+="\\/*$":n!==""&&n!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,e?void 0:"i"),a]}function QEe(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return OZ(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function Wj(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,a=n.charAt(i);return a&&a!=="/"?null:n.slice(i)||"/"}function ZEe(n,e){e===void 0&&(e="/");let{pathname:i,search:a="",hash:l=""}=typeof n=="string"?z0(n):n;return{pathname:i?i.startsWith("/")?i:eve(i,e):e,search:rve(a),hash:ive(l)}}function eve(n,e){let i=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(l=>{l===".."?i.length>1&&i.pop():l!=="."&&i.push(l)}),i.length>1?i.join("/"):"/"}function TM(n,e,i,a){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tve(n){return n.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function zj(n,e){let i=tve(n);return e?i.map((a,l)=>l===i.length-1?a.pathname:a.pathnameBase):i.map(a=>a.pathnameBase)}function Gj(n,e,i,a){a===void 0&&(a=!1);let l;typeof n=="string"?l=z0(n):(l=AC({},n),Vs(!l.pathname||!l.pathname.includes("?"),TM("?","pathname","search",l)),Vs(!l.pathname||!l.pathname.includes("#"),TM("#","pathname","hash",l)),Vs(!l.search||!l.search.includes("#"),TM("#","search","hash",l)));let u=n===""||l.pathname==="",f=u?"/":l.pathname,_;if(f==null)_=i;else{let I=e.length-1;if(!a&&f.startsWith("..")){let k=f.split("/");for(;k[0]==="..";)k.shift(),I-=1;l.pathname=k.join("/")}_=I>=0?e[I]:"/"}let E=ZEe(l,_),S=f&&f!=="/"&&f.endsWith("/"),w=(u||f===".")&&i.endsWith("/");return!E.pathname.endsWith("/")&&(S||w)&&(E.pathname+="/"),E}const Cg=n=>n.join("/").replace(/\/\/+/g,"/"),nve=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),rve=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,ive=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function sve(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const DZ=["post","put","patch","delete"];new Set(DZ);const ove=["get",...DZ];new Set(ove);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function PC(){return PC=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},PC.apply(this,arguments)}const Hj=D.createContext(null),ave=D.createContext(null),Hg=D.createContext(null),Lk=D.createContext(null),vp=D.createContext({outlet:null,matches:[],isDataRoute:!1}),xZ=D.createContext(null);function cve(n,e){let{relative:i}=e===void 0?{}:e;G0()||Vs(!1);let{basename:a,navigator:l}=D.useContext(Hg),{hash:u,pathname:f,search:_}=UZ(n,{relative:i}),E=f;return a!=="/"&&(E=f==="/"?a:Cg([a,f])),l.createHref({pathname:E,search:_,hash:u})}function G0(){return D.useContext(Lk)!=null}function H0(){return G0()||Vs(!1),D.useContext(Lk).location}function LZ(n){D.useContext(Hg).static||D.useLayoutEffect(n)}function $j(){let{isDataRoute:n}=D.useContext(vp);return n?Tve():lve()}function lve(){G0()||Vs(!1);let n=D.useContext(Hj),{basename:e,future:i,navigator:a}=D.useContext(Hg),{matches:l}=D.useContext(vp),{pathname:u}=H0(),f=JSON.stringify(zj(l,i.v7_relativeSplatPath)),_=D.useRef(!1);return LZ(()=>{_.current=!0}),D.useCallback(function(S,w){if(w===void 0&&(w={}),!_.current)return;if(typeof S=="number"){a.go(S);return}let I=Gj(S,JSON.parse(f),u,w.relative==="path");n==null&&e!=="/"&&(I.pathname=I.pathname==="/"?e:Cg([e,I.pathname])),(w.replace?a.replace:a.push)(I,w.state,w)},[e,a,f,u,n])}const uve=D.createContext(null);function dve(n){let e=D.useContext(vp).outlet;return e&&D.createElement(uve.Provider,{value:n},e)}function MZ(){let{matches:n}=D.useContext(vp),e=n[n.length-1];return e?e.params:{}}function UZ(n,e){let{relative:i}=e===void 0?{}:e,{future:a}=D.useContext(Hg),{matches:l}=D.useContext(vp),{pathname:u}=H0(),f=JSON.stringify(zj(l,a.v7_relativeSplatPath));return D.useMemo(()=>Gj(n,JSON.parse(f),u,i==="path"),[n,f,u,i])}function hve(n,e){return pve(n,e)}function pve(n,e,i,a){G0()||Vs(!1);let{navigator:l,static:u}=D.useContext(Hg),{matches:f}=D.useContext(vp),_=f[f.length-1],E=_?_.params:{};_&&_.pathname;let S=_?_.pathnameBase:"/";_&&_.route;let w=H0(),I;if(e){var k;let q=typeof e=="string"?z0(e):e;S==="/"||(k=q.pathname)!=null&&k.startsWith(S)||Vs(!1),I=q}else I=w;let U=I.pathname||"/",L=U;if(S!=="/"){let q=S.replace(/^\//,"").split("/");L="/"+U.replace(/^\//,"").split("/").slice(q.length).join("/")}let F=VEe(n,{pathname:L}),B=yve(F&&F.map(q=>Object.assign({},q,{params:Object.assign({},E,q.params),pathname:Cg([S,l.encodeLocation?l.encodeLocation(q.pathname).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?S:Cg([S,l.encodeLocation?l.encodeLocation(q.pathnameBase).pathname:q.pathnameBase])})),f,i,a);return e&&B?D.createElement(Lk.Provider,{value:{location:PC({pathname:"/",search:"",hash:"",state:null,key:"default"},I),navigationType:bg.Pop}},B):B}function fve(){let n=bve(),e=sve(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),i=n instanceof Error?n.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return D.createElement(D.Fragment,null,D.createElement("h2",null,"Unexpected Application Error!"),D.createElement("h3",{style:{fontStyle:"italic"}},e),i?D.createElement("pre",{style:l},i):null,null)}const mve=D.createElement(fve,null);class gve extends D.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,i){return i.location!==e.location||i.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:i.error,location:i.location,revalidation:e.revalidation||i.revalidation}}componentDidCatch(e,i){console.error("React Router caught the following error during render",e,i)}render(){return this.state.error!==void 0?D.createElement(vp.Provider,{value:this.props.routeContext},D.createElement(xZ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _ve(n){let{routeContext:e,match:i,children:a}=n,l=D.useContext(Hj);return l&&l.static&&l.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=i.route.id),D.createElement(vp.Provider,{value:e},a)}function yve(n,e,i,a){var l;if(e===void 0&&(e=[]),i===void 0&&(i=null),a===void 0&&(a=null),n==null){var u;if(!i)return null;if(i.errors)n=i.matches;else if((u=a)!=null&&u.v7_partialHydration&&e.length===0&&!i.initialized&&i.matches.length>0)n=i.matches;else return null}let f=n,_=(l=i)==null?void 0:l.errors;if(_!=null){let w=f.findIndex(I=>I.route.id&&(_==null?void 0:_[I.route.id])!==void 0);w>=0||Vs(!1),f=f.slice(0,Math.min(f.length,w+1))}let E=!1,S=-1;if(i&&a&&a.v7_partialHydration)for(let w=0;w<f.length;w++){let I=f[w];if((I.route.HydrateFallback||I.route.hydrateFallbackElement)&&(S=w),I.route.id){let{loaderData:k,errors:U}=i,L=I.route.loader&&k[I.route.id]===void 0&&(!U||U[I.route.id]===void 0);if(I.route.lazy||L){E=!0,S>=0?f=f.slice(0,S+1):f=[f[0]];break}}}return f.reduceRight((w,I,k)=>{let U,L=!1,F=null,B=null;i&&(U=_&&I.route.id?_[I.route.id]:void 0,F=I.route.errorElement||mve,E&&(S<0&&k===0?(wve("route-fallback"),L=!0,B=null):S===k&&(L=!0,B=I.route.hydrateFallbackElement||null)));let q=e.concat(f.slice(0,k+1)),$=()=>{let X;return U?X=F:L?X=B:I.route.Component?X=D.createElement(I.route.Component,null):I.route.element?X=I.route.element:X=w,D.createElement(_ve,{match:I,routeContext:{outlet:w,matches:q,isDataRoute:i!=null},children:X})};return i&&(I.route.ErrorBoundary||I.route.errorElement||k===0)?D.createElement(gve,{location:i.location,revalidation:i.revalidation,component:F,error:U,children:$(),routeContext:{outlet:null,matches:q,isDataRoute:!0}}):$()},null)}var VZ=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(VZ||{}),jZ=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(jZ||{});function Eve(n){let e=D.useContext(Hj);return e||Vs(!1),e}function vve(n){let e=D.useContext(ave);return e||Vs(!1),e}function Sve(n){let e=D.useContext(vp);return e||Vs(!1),e}function FZ(n){let e=Sve(),i=e.matches[e.matches.length-1];return i.route.id||Vs(!1),i.route.id}function bve(){var n;let e=D.useContext(xZ),i=vve(),a=FZ();return e!==void 0?e:(n=i.errors)==null?void 0:n[a]}function Tve(){let{router:n}=Eve(VZ.UseNavigateStable),e=FZ(jZ.UseNavigateStable),i=D.useRef(!1);return LZ(()=>{i.current=!0}),D.useCallback(function(l,u){u===void 0&&(u={}),i.current&&(typeof l=="number"?n.navigate(l):n.navigate(l,PC({fromRouteId:e},u)))},[n,e])}const GK={};function wve(n,e,i){GK[n]||(GK[n]=!0)}function Cve(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Rve(n){let{to:e,replace:i,state:a,relative:l}=n;G0()||Vs(!1);let{future:u,static:f}=D.useContext(Hg),{matches:_}=D.useContext(vp),{pathname:E}=H0(),S=$j(),w=Gj(e,zj(_,u.v7_relativeSplatPath),E,l==="path"),I=JSON.stringify(w);return D.useEffect(()=>S(JSON.parse(I),{replace:i,state:a,relative:l}),[S,I,l,i,a]),null}function Ive(n){return dve(n.context)}function qh(n){Vs(!1)}function Ave(n){let{basename:e="/",children:i=null,location:a,navigationType:l=bg.Pop,navigator:u,static:f=!1,future:_}=n;G0()&&Vs(!1);let E=e.replace(/^\/*/,"/"),S=D.useMemo(()=>({basename:E,navigator:u,static:f,future:PC({v7_relativeSplatPath:!1},_)}),[E,_,u,f]);typeof a=="string"&&(a=z0(a));let{pathname:w="/",search:I="",hash:k="",state:U=null,key:L="default"}=a,F=D.useMemo(()=>{let B=Wj(w,E);return B==null?null:{location:{pathname:B,search:I,hash:k,state:U,key:L},navigationType:l}},[E,w,I,k,U,L,l]);return F==null?null:D.createElement(Hg.Provider,{value:S},D.createElement(Lk.Provider,{children:i,value:F}))}function Pve(n){let{children:e,location:i}=n;return hve(nV(e),i)}new Promise(()=>{});function nV(n,e){e===void 0&&(e=[]);let i=[];return D.Children.forEach(n,(a,l)=>{if(!D.isValidElement(a))return;let u=[...e,l];if(a.type===D.Fragment){i.push.apply(i,nV(a.props.children,u));return}a.type!==qh&&Vs(!1),!a.props.index||!a.props.children||Vs(!1);let f={id:a.props.id||u.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(f.children=nV(a.props.children,u)),i.push(f)}),i}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rV(){return rV=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},rV.apply(this,arguments)}function Ove(n,e){if(n==null)return{};var i={},a=Object.keys(n),l,u;for(u=0;u<a.length;u++)l=a[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function kve(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Nve(n,e){return n.button===0&&(!e||e==="_self")&&!kve(n)}const Dve=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],xve="6";try{window.__reactRouterVersion=xve}catch{}const Lve="startTransition",HK=eV[Lve];function Mve(n){let{basename:e,children:i,future:a,window:l}=n,u=D.useRef();u.current==null&&(u.current=LEe({window:l,v5Compat:!0}));let f=u.current,[_,E]=D.useState({action:f.action,location:f.location}),{v7_startTransition:S}=a||{},w=D.useCallback(I=>{S&&HK?HK(()=>E(I)):E(I)},[E,S]);return D.useLayoutEffect(()=>f.listen(w),[f,w]),D.useEffect(()=>Cve(a),[a]),D.createElement(Ave,{basename:e,children:i,location:_.location,navigationType:_.action,navigator:f,future:a})}const Uve=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Vve=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Lu=D.forwardRef(function(e,i){let{onClick:a,relative:l,reloadDocument:u,replace:f,state:_,target:E,to:S,preventScrollReset:w,viewTransition:I}=e,k=Ove(e,Dve),{basename:U}=D.useContext(Hg),L,F=!1;if(typeof S=="string"&&Vve.test(S)&&(L=S,Uve))try{let X=new URL(window.location.href),oe=S.startsWith("//")?new URL(X.protocol+S):new URL(S),re=Wj(oe.pathname,U);oe.origin===X.origin&&re!=null?S=re+oe.search+oe.hash:F=!0}catch{}let B=cve(S,{relative:l}),q=jve(S,{replace:f,state:_,target:E,preventScrollReset:w,relative:l,viewTransition:I});function $(X){a&&a(X),X.defaultPrevented||q(X)}return D.createElement("a",rV({},k,{href:L||B,onClick:F||u?a:$,ref:i,target:E}))});var $K;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})($K||($K={}));var KK;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(KK||(KK={}));function jve(n,e){let{target:i,replace:a,state:l,preventScrollReset:u,relative:f,viewTransition:_}=e===void 0?{}:e,E=$j(),S=H0(),w=UZ(n,{relative:f});return D.useCallback(I=>{if(Nve(I,i)){I.preventDefault();let k=a!==void 0?a:KO(S)===KO(w);E(n,{replace:k,state:l,preventScrollReset:u,relative:f,viewTransition:_})}},[S,E,w,a,l,i,n,u,f,_])}function Fve(n,e,i,a){return n.addEventListener(e,i,a),()=>{n.removeEventListener(e,i,a)}}function Mk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Bve(){return!!(globalThis!=null&&globalThis.document)}function BZ(n){return n.parentElement&&BZ(n.parentElement)?!0:n.hidden}function Wve(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function zve(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function Gve(n){var e;return((e=WZ(n))==null?void 0:e.defaultView)??window}function WZ(n){return Mk(n)?n.ownerDocument:document}function Hve(n){return n.view??window}function $ve(n){return WZ(n).activeElement}function Kve(n){const e=Hve(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function zZ(n){return!!n.touches}function qve(n){return zZ(n)&&n.touches.length>1}function Yve(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function Xve(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function GZ(n,e="page"){return zZ(n)?Yve(n,e):Xve(n,e)}function Jve(n){return e=>{const i=Kve(e);(!i||i&&e.button===0)&&n(e)}}function Qve(n,e=!1){function i(l){n(l,{point:GZ(l)})}return e?Jve(i):i}function hO(n,e,i,a){return Fve(n,e,Qve(i,e==="pointerdown"),a)}function Zve(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of e)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const pn=n=>n?"":void 0,Lf=n=>n?!0:void 0;function iV(n){return Array.isArray(n)}function po(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!iV(n)}function eSe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function tSe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function sV(n){if(n==null)return n;const{unitless:e}=tSe(n);return e||typeof n=="number"?`${n}px`:n}const HZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,Kj=n=>Object.fromEntries(Object.entries(n).sort(HZ));function qK(n){const e=Kj(n);return Object.assign(Object.values(e),e)}function nSe(n){const e=Object.keys(Kj(n));return new Set(e)}function YK(n){if(!n)return n;n=sV(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function Ww(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${sV(n)})`),e&&i.push("and",`(max-width: ${sV(e)})`),i.join(" ")}function rSe(n){if(!n)return null;n.base=n.base??"0px";const e=qK(n),i=Object.entries(n).sort(HZ).map(([u,f],_,E)=>{let[,S]=E[_+1]??[];return S=parseFloat(S)>0?YK(S):void 0,{_minW:YK(f),breakpoint:u,minW:f,maxW:S,maxWQuery:Ww(null,S),minWQuery:Ww(f),minMaxQuery:Ww(f,S)}}),a=nSe(n),l=Array.from(a.values());return{keys:a,normalized:e,isResponsive(u){const f=Object.keys(u);return f.length>0&&f.every(_=>a.has(_))},asObject:Kj(n),asArray:qK(n),details:i,get(u){return i.find(f=>f.breakpoint===u)},media:[null,...e.map(u=>Ww(u)).slice(1)],toArrayValue(u){if(!po(u))throw new Error("toArrayValue: value must be an object");const f=l.map(_=>u[_]??null);for(;eSe(f)===null;)f.pop();return f},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((f,_,E)=>{const S=l[E];return S!=null&&_!=null&&(f[S]=_),f},{})}}}function qj(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Rn(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function Yj(n){return D.Children.toArray(n).filter(e=>D.isValidElement(e))}function dR(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function iSe(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ni(n={}){const{name:e,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:u,defaultValue:f}=n,_=D.createContext(f);_.displayName=e;function E(){var w;const S=D.useContext(_);if(!S&&i){const I=new Error(u??iSe(a,l));throw I.name="ContextError",(w=Error.captureStackTrace)==null||w.call(Error,I,E),I}return S}return[_.Provider,E,_]}const ln=(...n)=>n.filter(Boolean).join(" "),$Z=n=>n.hasAttribute("tabindex"),sSe=n=>$Z(n)&&n.tabIndex===-1;function qO(n){if(!Mk(n)||BZ(n)||zve(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in a?a[e]():Wve(n)?!0:$Z(n)}function oSe(n){return n?Mk(n)&&qO(n)&&!sSe(n):!1}const aSe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],cSe=aSe.join(),lSe=n=>n.offsetWidth>0&&n.offsetHeight>0;function KZ(n){const e=Array.from(n.querySelectorAll(cSe));return e.unshift(n),e.filter(i=>qO(i)&&lSe(i))}function uSe(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const dSe=n=>{const e=new WeakMap;return(a,l,u,f)=>{if(typeof a>"u")return n(a,l,u);e.has(a)||e.set(a,new Map);const _=e.get(a);if(_.has(l))return _.get(l);const E=n(a,l,u,f);return _.set(l,E),E}},qZ=dSe(uSe),hSe=n=>n.default||n;function Xj(n){const{wasSelected:e,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&e)}function pSe(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function fSe(n,e){let i=pSe(n);const a=10**(e??10);return i=Math.round(i*a)/a,e?i.toFixed(e):i.toString()}function mSe(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function XK(n,e,i){return(n-e)*100/(i-e)}function gSe(n,e,i){return(i-e)*n+e}function JK(n,e,i){const a=Math.round((n-e)/i)*i+e,l=mSe(i);return fSe(a,l)}function wM(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function $0(n,e=[]){const i=Object.assign({},n);for(const a of e)a in i&&delete i[a];return i}function YZ(n,e){const i={};for(const a of e)a in n&&(i[a]=n[a]);return i}const XZ=Object.freeze(["base","sm","md","lg","xl","2xl"]);function Uk(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):po(n)?Object.keys(n).reduce((i,a)=>(i[a]=e(n[a]),i),{}):n!=null?e(n):null}function _Se(n,e=XZ){const i={};return n.forEach((a,l)=>{const u=e[l];a!=null&&(i[u]=a)}),i}const ySe=n=>typeof n=="function";function el(n,...e){return ySe(n)?n(...e):n}function ESe(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function vSe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function JZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Mk(n)&&ESe(n)?n:JZ(vSe(n))}function QZ(n,e){const i={},a={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:a[l]=u;return[i,a]}function SSe(n,...e){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=f=>{const _={};for(let E=0;E<f.length;E++){const S=f[E];i[S]&&(Object.defineProperty(_,S,i[S]),delete i[S])}return _},u=f=>l(Array.isArray(f)?f:a.filter(f));return e.map(u).concat(l(a))}function QK(n,e,i={}){const{stop:a,getKey:l}=i;function u(f,_=[]){if(po(f)||Array.isArray(f)){const E={};for(const[S,w]of Object.entries(f)){const I=(l==null?void 0:l(S))??S,k=[..._,I];if(a!=null&&a(f,k))return e(f,_);E[I]=u(w,k)}return E}return e(f,_)}return u(n)}var zw={exports:{}};zw.exports;var ZK;function bSe(){return ZK||(ZK=1,function(n,e){var i=200,a="__lodash_hash_undefined__",l=800,u=16,f=9007199254740991,_="[object Arguments]",E="[object Array]",S="[object AsyncFunction]",w="[object Boolean]",I="[object Date]",k="[object Error]",U="[object Function]",L="[object GeneratorFunction]",F="[object Map]",B="[object Number]",q="[object Null]",$="[object Object]",X="[object Proxy]",oe="[object RegExp]",re="[object Set]",pe="[object String]",te="[object Undefined]",Z="[object WeakMap]",ne="[object ArrayBuffer]",ae="[object DataView]",me="[object Float32Array]",he="[object Float64Array]",ue="[object Int8Array]",Ue="[object Int16Array]",ze="[object Int32Array]",tt="[object Uint8Array]",Ce="[object Uint8ClampedArray]",Ie="[object Uint16Array]",ye="[object Uint32Array]",ke=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,ve=/^(?:0|[1-9]\d*)$/,Re={};Re[me]=Re[he]=Re[ue]=Re[Ue]=Re[ze]=Re[tt]=Re[Ce]=Re[Ie]=Re[ye]=!0,Re[_]=Re[E]=Re[ne]=Re[w]=Re[ae]=Re[I]=Re[k]=Re[U]=Re[F]=Re[B]=Re[$]=Re[oe]=Re[re]=Re[pe]=Re[Z]=!1;var Me=typeof Py=="object"&&Py&&Py.Object===Object&&Py,Ge=typeof self=="object"&&self&&self.Object===Object&&self,Qe=Me||Ge||Function("return this")(),nt=e&&!e.nodeType&&e,ht=nt&&!0&&n&&!n.nodeType&&n,it=ht&&ht.exports===nt,It=it&&Me.process,jt=function(){try{var Se=ht&&ht.require&&ht.require("util").types;return Se||It&&It.binding&&It.binding("util")}catch{}}(),Dt=jt&&jt.isTypedArray;function an(Se,De,rt){switch(rt.length){case 0:return Se.call(De);case 1:return Se.call(De,rt[0]);case 2:return Se.call(De,rt[0],rt[1]);case 3:return Se.call(De,rt[0],rt[1],rt[2])}return Se.apply(De,rt)}function jn(Se,De){for(var rt=-1,Yt=Array(Se);++rt<Se;)Yt[rt]=De(rt);return Yt}function Qt(Se){return function(De){return Se(De)}}function Ot(Se,De){return Se==null?void 0:Se[De]}function Lt(Se,De){return function(rt){return Se(De(rt))}}var we=Array.prototype,Ve=Function.prototype,$e=Object.prototype,_t=Qe["__core-js_shared__"],vt=Ve.toString,St=$e.hasOwnProperty,Ht=function(){var Se=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),fn=$e.toString,mn=vt.call(Object),Jt=RegExp("^"+vt.call(St).replace(ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Hn=it?Qe.Buffer:void 0,fc=Qe.Symbol,Bt=Qe.Uint8Array;Hn&&Hn.allocUnsafe;var un=Lt(Object.getPrototypeOf,Object),rs=Object.create,Fs=$e.propertyIsEnumerable,Qs=we.splice,Ei=fc?fc.toStringTag:void 0,Wa=function(){try{var Se=Ha(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),dl=Hn?Hn.isBuffer:void 0,_o=Math.max,yo=Date.now,Kl=Ha(Qe,"Map"),Bs=Ha(Object,"create"),mc=function(){function Se(){}return function(De){if(!Sc(De))return{};if(rs)return rs(De);Se.prototype=De;var rt=new Se;return Se.prototype=void 0,rt}}();function ua(Se){var De=-1,rt=Se==null?0:Se.length;for(this.clear();++De<rt;){var Yt=Se[De];this.set(Yt[0],Yt[1])}}function gc(){this.__data__=Bs?Bs(null):{},this.size=0}function hl(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function Ku(Se){var De=this.__data__;if(Bs){var rt=De[Se];return rt===a?void 0:rt}return St.call(De,Se)?De[Se]:void 0}function _c(Se){var De=this.__data__;return Bs?De[Se]!==void 0:St.call(De,Se)}function pl(Se,De){var rt=this.__data__;return this.size+=this.has(Se)?0:1,rt[Se]=Bs&&De===void 0?a:De,this}ua.prototype.clear=gc,ua.prototype.delete=hl,ua.prototype.get=Ku,ua.prototype.has=_c,ua.prototype.set=pl;function Do(Se){var De=-1,rt=Se==null?0:Se.length;for(this.clear();++De<rt;){var Yt=Se[De];this.set(Yt[0],Yt[1])}}function Mi(){this.__data__=[],this.size=0}function ds(Se){var De=this.__data__,rt=nh(De,Se);if(rt<0)return!1;var Yt=De.length-1;return rt==Yt?De.pop():Qs.call(De,rt,1),--this.size,!0}function za(Se){var De=this.__data__,rt=nh(De,Se);return rt<0?void 0:De[rt][1]}function qu(Se){return nh(this.__data__,Se)>-1}function yc(Se,De){var rt=this.__data__,Yt=nh(rt,Se);return Yt<0?(++this.size,rt.push([Se,De])):rt[Yt][1]=De,this}Do.prototype.clear=Mi,Do.prototype.delete=ds,Do.prototype.get=za,Do.prototype.has=qu,Do.prototype.set=yc;function da(Se){var De=-1,rt=Se==null?0:Se.length;for(this.clear();++De<rt;){var Yt=Se[De];this.set(Yt[0],Yt[1])}}function ha(){this.size=0,this.__data__={hash:new ua,map:new(Kl||Do),string:new ua}}function Qd(Se){var De=Qu(this,Se).delete(Se);return this.size-=De?1:0,De}function Zg(Se){return Qu(this,Se).get(Se)}function Yu(Se){return Qu(this,Se).has(Se)}function wp(Se,De){var rt=Qu(this,Se),Yt=rt.size;return rt.set(Se,De),this.size+=rt.size==Yt?0:1,this}da.prototype.clear=ha,da.prototype.delete=Qd,da.prototype.get=Zg,da.prototype.has=Yu,da.prototype.set=wp;function Ws(Se){var De=this.__data__=new Do(Se);this.size=De.size}function Xu(){this.__data__=new Do,this.size=0}function pa(Se){var De=this.__data__,rt=De.delete(Se);return this.size=De.size,rt}function Zd(Se){return this.__data__.get(Se)}function eh(Se){return this.__data__.has(Se)}function Ga(Se,De){var rt=this.__data__;if(rt instanceof Do){var Yt=rt.__data__;if(!Kl||Yt.length<i-1)return Yt.push([Se,De]),this.size=++rt.size,this;rt=this.__data__=new da(Yt)}return rt.set(Se,De),this.size=rt.size,this}Ws.prototype.clear=Xu,Ws.prototype.delete=pa,Ws.prototype.get=Zd,Ws.prototype.has=eh,Ws.prototype.set=Ga;function th(Se,De){var rt=Uo(Se),Yt=!rt&&is(Se),Xn=!rt&&!Yt&&jo(Se),Tr=!rt&&!Yt&&!Xn&&Pp(Se),Kr=rt||Yt||Xn||Tr,dn=Kr?jn(Se.length,String):[],jr=dn.length;for(var Si in Se)Kr&&(Si=="length"||Xn&&(Si=="offset"||Si=="parent")||Tr&&(Si=="buffer"||Si=="byteLength"||Si=="byteOffset")||gl(Si,jr))||dn.push(Si);return dn}function Ju(Se,De,rt){(rt!==void 0&&!Mo(Se[De],rt)||rt===void 0&&!(De in Se))&&$r(Se,De,rt)}function xo(Se,De,rt){var Yt=Se[De];(!(St.call(Se,De)&&Mo(Yt,rt))||rt===void 0&&!(De in Se))&&$r(Se,De,rt)}function nh(Se,De){for(var rt=Se.length;rt--;)if(Mo(Se[rt][0],De))return rt;return-1}function $r(Se,De,rt){De=="__proto__"&&Wa?Wa(Se,De,{configurable:!0,enumerable:!0,value:rt,writable:!0}):Se[De]=rt}var vi=Xl();function Ec(Se){return Se==null?Se===void 0?te:q:Ei&&Ei in Object(Se)?Lo(Se):rm(Se)}function fl(Se){return hs(Se)&&Ec(Se)==_}function fa(Se){if(!Sc(Se)||$a(Se))return!1;var De=Fo(Se)?Jt:Te;return De.test(Ap(Se))}function Cp(Se){return hs(Se)&&sm(Se.length)&&!!Re[Ec(Se)]}function rh(Se){if(!Sc(Se))return vc(Se);var De=ar(Se),rt=[];for(var Yt in Se)Yt=="constructor"&&(De||!St.call(Se,Yt))||rt.push(Yt);return rt}function ql(Se,De,rt,Yt,Xn){Se!==De&&vi(De,function(Tr,Kr){if(Xn||(Xn=new Ws),Sc(Tr))Eo(Se,De,Kr,rt,ql,Yt,Xn);else{var dn=Yt?Yt(oh(Se,Kr),Tr,Kr+"",Se,De,Xn):void 0;dn===void 0&&(dn=Tr),Ju(Se,Kr,dn)}},eu)}function Eo(Se,De,rt,Yt,Xn,Tr,Kr){var dn=oh(Se,rt),jr=oh(De,rt),Si=Kr.get(jr);if(Si){Ju(Se,rt,Si);return}var Ps=Tr?Tr(dn,jr,rt+"",Se,De,Kr):void 0,Bo=Ps===void 0;if(Bo){var Wo=Uo(jr),td=!Wo&&jo(jr),Ji=!Wo&&!td&&Pp(jr);Ps=jr,Wo||td||Ji?Uo(dn)?Ps=dn:Zl(dn)?Ps=sh(dn):td?(Bo=!1,Ps=Rp(jr)):Ji?(Bo=!1,Ps=ih(jr)):Ps=[]:ed(jr)||is(jr)?(Ps=dn,is(dn)?Ps=_l(dn):(!Sc(dn)||Fo(dn))&&(Ps=Zu(jr))):Bo=!1}Bo&&(Kr.set(jr,Ps),Xn(Ps,jr,Yt,Tr,Kr),Kr.delete(jr)),Ju(Se,rt,Ps)}function nm(Se,De){return Ip(Ql(Se,De,ga),Se+"")}var Zs=Wa?function(Se,De){return Wa(Se,"toString",{configurable:!0,enumerable:!1,value:ma(De),writable:!0})}:ga;function Rp(Se,De){return Se.slice()}function ml(Se){var De=new Se.constructor(Se.byteLength);return new Bt(De).set(new Bt(Se)),De}function ih(Se,De){var rt=ml(Se.buffer);return new Se.constructor(rt,Se.byteOffset,Se.length)}function sh(Se,De){var rt=-1,Yt=Se.length;for(De||(De=Array(Yt));++rt<Yt;)De[rt]=Se[rt];return De}function _r(Se,De,rt,Yt){var Xn=!rt;rt||(rt={});for(var Tr=-1,Kr=De.length;++Tr<Kr;){var dn=De[Tr],jr=void 0;jr===void 0&&(jr=Se[dn]),Xn?$r(rt,dn,jr):xo(rt,dn,jr)}return rt}function Yl(Se){return nm(function(De,rt){var Yt=-1,Xn=rt.length,Tr=Xn>1?rt[Xn-1]:void 0,Kr=Xn>2?rt[2]:void 0;for(Tr=Se.length>3&&typeof Tr=="function"?(Xn--,Tr):void 0,Kr&&Jl(rt[0],rt[1],Kr)&&(Tr=Xn<3?void 0:Tr,Xn=1),De=Object(De);++Yt<Xn;){var dn=rt[Yt];dn&&Se(De,dn,Yt,Tr)}return De})}function Xl(Se){return function(De,rt,Yt){for(var Xn=-1,Tr=Object(De),Kr=Yt(De),dn=Kr.length;dn--;){var jr=Kr[++Xn];if(rt(Tr[jr],jr,Tr)===!1)break}return De}}function Qu(Se,De){var rt=Se.__data__;return Xr(De)?rt[typeof De=="string"?"string":"hash"]:rt.map}function Ha(Se,De){var rt=Ot(Se,De);return fa(rt)?rt:void 0}function Lo(Se){var De=St.call(Se,Ei),rt=Se[Ei];try{Se[Ei]=void 0;var Yt=!0}catch{}var Xn=fn.call(Se);return Yt&&(De?Se[Ei]=rt:delete Se[Ei]),Xn}function Zu(Se){return typeof Se.constructor=="function"&&!ar(Se)?mc(un(Se)):{}}function gl(Se,De){var rt=typeof Se;return De=De??f,!!De&&(rt=="number"||rt!="symbol"&&ve.test(Se))&&Se>-1&&Se%1==0&&Se<De}function Jl(Se,De,rt){if(!Sc(rt))return!1;var Yt=typeof De;return(Yt=="number"?Vo(rt)&&gl(De,rt.length):Yt=="string"&&De in rt)?Mo(rt[De],Se):!1}function Xr(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function $a(Se){return!!Ht&&Ht in Se}function ar(Se){var De=Se&&Se.constructor,rt=typeof De=="function"&&De.prototype||$e;return Se===rt}function vc(Se){var De=[];if(Se!=null)for(var rt in Object(Se))De.push(rt);return De}function rm(Se){return fn.call(Se)}function Ql(Se,De,rt){return De=_o(De===void 0?Se.length-1:De,0),function(){for(var Yt=arguments,Xn=-1,Tr=_o(Yt.length-De,0),Kr=Array(Tr);++Xn<Tr;)Kr[Xn]=Yt[De+Xn];Xn=-1;for(var dn=Array(De+1);++Xn<De;)dn[Xn]=Yt[Xn];return dn[De]=rt(Kr),an(Se,this,dn)}}function oh(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var Ip=im(Zs);function im(Se){var De=0,rt=0;return function(){var Yt=yo(),Xn=u-(Yt-rt);if(rt=Yt,Xn>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function Ap(Se){if(Se!=null){try{return vt.call(Se)}catch{}try{return Se+""}catch{}}return""}function Mo(Se,De){return Se===De||Se!==Se&&De!==De}var is=fl(function(){return arguments}())?fl:function(Se){return hs(Se)&&St.call(Se,"callee")&&!Fs.call(Se,"callee")},Uo=Array.isArray;function Vo(Se){return Se!=null&&sm(Se.length)&&!Fo(Se)}function Zl(Se){return hs(Se)&&Vo(Se)}var jo=dl||yl;function Fo(Se){if(!Sc(Se))return!1;var De=Ec(Se);return De==U||De==L||De==S||De==X}function sm(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=f}function Sc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function hs(Se){return Se!=null&&typeof Se=="object"}function ed(Se){if(!hs(Se)||Ec(Se)!=$)return!1;var De=un(Se);if(De===null)return!0;var rt=St.call(De,"constructor")&&De.constructor;return typeof rt=="function"&&rt instanceof rt&&vt.call(rt)==mn}var Pp=Dt?Qt(Dt):Cp;function _l(Se){return _r(Se,eu(Se))}function eu(Se){return Vo(Se)?th(Se):rh(Se)}var om=Yl(function(Se,De,rt,Yt){ql(Se,De,rt,Yt)});function ma(Se){return function(){return Se}}function ga(Se){return Se}function yl(){return!1}n.exports=om}(zw,zw.exports)),zw.exports}var TSe=bSe();const Uu=Jf(TSe);function nl(n,e=[]){const i=D.useRef(n);return D.useEffect(()=>{i.current=n}),D.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},e)}function n0(n,e,i,a){const l=nl(i);return D.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,a),()=>{u.removeEventListener(e,l,a)}},[e,n,a,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,a)}}function ZZ(n){const{isOpen:e,ref:i}=n,[a,l]=D.useState(e),[u,f]=D.useState(!1);return D.useEffect(()=>{u||(l(e),f(!0))},[e,u,a]),n0(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!a),onComplete(){var w;const E=Gve(i.current),S=new E.CustomEvent("animationend",{bubbles:!0});(w=i.current)==null||w.dispatchEvent(S)}}}var CM,eq;function wSe(){return eq||(eq=1,CM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],a=0;a<n.rangeCount;a++)i.push(n.getRangeAt(a));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),CM}var RM,tq;function CSe(){if(tq)return RM;tq=1;var n=wSe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function a(u){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,f)}function l(u,f){var _,E,S,w,I,k,U=!1;f||(f={}),_=f.debug||!1;try{S=n(),w=document.createRange(),I=document.getSelection(),k=document.createElement("span"),k.textContent=u,k.ariaHidden="true",k.style.all="unset",k.style.position="fixed",k.style.top=0,k.style.clip="rect(0, 0, 0, 0)",k.style.whiteSpace="pre",k.style.webkitUserSelect="text",k.style.MozUserSelect="text",k.style.msUserSelect="text",k.style.userSelect="text",k.addEventListener("copy",function(F){if(F.stopPropagation(),f.format)if(F.preventDefault(),typeof F.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var B=e[f.format]||e.default;window.clipboardData.setData(B,u)}else F.clipboardData.clearData(),F.clipboardData.setData(f.format,u);f.onCopy&&(F.preventDefault(),f.onCopy(F.clipboardData))}),document.body.appendChild(k),w.selectNodeContents(k),I.addRange(w);var L=document.execCommand("copy");if(!L)throw new Error("copy command was unsuccessful");U=!0}catch(F){_&&console.error("unable to copy using execCommand: ",F),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",u),f.onCopy&&f.onCopy(window.clipboardData),U=!0}catch(B){_&&console.error("unable to copy using clipboardData: ",B),_&&console.error("falling back to prompt"),E=a("message"in f?f.message:i),window.prompt(E,u)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(w):I.removeAllRanges()),k&&document.body.removeChild(k),S()}return U}return RM=l,RM}var RSe=CSe();const nq=Jf(RSe);function ISe(n,e={}){const[i,a]=D.useState(!1),[l,u]=D.useState(n);D.useEffect(()=>u(n),[n]);const{timeout:f=1500,..._}=typeof e=="number"?{timeout:e}:e,E=D.useCallback(S=>{const w=typeof S=="string"?S:l;"clipboard"in navigator?navigator.clipboard.writeText(w).then(()=>a(!0)).catch(()=>a(nq(w,_))):a(nq(w,_))},[l,_]);return D.useEffect(()=>{let S=null;return i&&(S=window.setTimeout(()=>{a(!1)},f)),()=>{S&&window.clearTimeout(S)}},[f,i]),{value:l,setValue:u,onCopy:E,hasCopied:i}}function eee(n){const{value:e,defaultValue:i,onChange:a,shouldUpdate:l=(k,U)=>k!==U}=n,u=nl(a),f=nl(l),[_,E]=D.useState(i),S=e!==void 0,w=S?e:_,I=nl(k=>{const L=typeof k=="function"?k(w):k;f(w,L)&&(S||E(L),u(L))},[S,u,w,f]);return[w,I]}function gp(n={}){const{onClose:e,onOpen:i,isOpen:a,id:l}=n,u=nl(i),f=nl(e),[_,E]=D.useState(n.defaultIsOpen||!1),S=a!==void 0?a:_,w=a!==void 0,I=D.useId(),k=l??`disclosure-${I}`,U=D.useCallback(()=>{w||E(!1),f==null||f()},[w,f]),L=D.useCallback(()=>{w||E(!0),u==null||u()},[w,u]),F=D.useCallback(()=>{S?U():L()},[S,L,U]);function B($={}){return{...$,"aria-expanded":S,"aria-controls":k,onClick(X){var oe;(oe=$.onClick)==null||oe.call($,X),F()}}}function q($={}){return{...$,hidden:!S,id:k}}return{isOpen:S,onOpen:L,onClose:U,onToggle:F,isControlled:w,getButtonProps:B,getDisclosureProps:q}}const Mf=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,Dg=(n,e)=>{const i=D.useRef(!1),a=D.useRef(!1);D.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},e),D.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function ASe(n){const e=n.current;if(!e)return!1;const i=$ve(e);return!i||e.contains(i)?!1:!!oSe(i)}function tee(n,e){const{shouldFocus:i,visible:a,focusRef:l}=e,u=i&&!a;Dg(()=>{if(!u||ASe(n))return;const f=(l==null?void 0:l.current)||n.current;let _;if(f)return _=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[u,n,l])}const PSe={preventScroll:!0,shouldFocus:!1};function OSe(n,e=PSe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:u}=e,f=kSe(n)?n.current:n,_=l&&u,E=D.useRef(_),S=D.useRef(u);Mf(()=>{!S.current&&u&&(E.current=_),S.current=u},[u,_]);const w=D.useCallback(()=>{if(!(!u||!f||!E.current)&&(E.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:a})});else{const I=KZ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[u,a,f,i]);Dg(()=>{w()},[w]),n0(f,"transitionend",w)}function kSe(n){return"current"in n}function NSe(n){return"current"in n}const nee=()=>typeof window<"u";function DSe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const xSe=n=>nee()&&n.test(navigator.vendor),LSe=n=>nee()&&n.test(DSe()),MSe=()=>LSe(/mac|iphone|ipad|ipod/i),USe=()=>MSe()&&xSe(/apple/i);function VSe(n){const{ref:e,elements:i,enabled:a}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};n0(l,"pointerdown",u=>{var S,w;if(!USe()||!a)return;const f=((w=(S=u.composedPath)==null?void 0:S.call(u))==null?void 0:w[0])??u.target,E=(i??[e]).some(I=>{const k=NSe(I)?I.current:I;return(k==null?void 0:k.contains(f))||k===f});l().activeElement!==f&&E&&(u.preventDefault(),f.focus())})}function jSe(n,e){const i=D.useId();return D.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function FSe(n,...e){const i=jSe(n);return D.useMemo(()=>e.map(a=>`${a}-${i}`),[i,e])}function ree(n){const e=D.useRef(null);return e.current=n,e}function BSe(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Ki(...n){return e=>{n.forEach(i=>{BSe(i,e)})}}function WSe(...n){return D.useMemo(()=>Ki(...n),n)}function iee(n){const{ref:e,handler:i,enabled:a=!0}=n,l=nl(i),f=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!a)return;const _=I=>{IM(I,e)&&(f.isPointerDown=!0)},E=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&IM(I,e)&&(f.isPointerDown=!1,l(I))},S=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&IM(I,e)&&(f.isPointerDown=!1,l(I))},w=see(e.current);return w.addEventListener("mousedown",_,!0),w.addEventListener("mouseup",E,!0),w.addEventListener("touchstart",_,!0),w.addEventListener("touchend",S,!0),()=>{w.removeEventListener("mousedown",_,!0),w.removeEventListener("mouseup",E,!0),w.removeEventListener("touchstart",_,!0),w.removeEventListener("touchend",S,!0)}},[i,e,l,f,a])}function IM(n,e){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!see(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function see(n){return(n==null?void 0:n.ownerDocument)??document}function zSe(n,e){const i=nl(n);D.useEffect(()=>{if(e==null)return;let a=null;return a=window.setTimeout(()=>{i()},e),()=>{a&&window.clearTimeout(a)}},[e,i])}const oee=1/60*1e3,GSe=typeof performance<"u"?()=>performance.now():()=>Date.now(),aee=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(GSe()),oee);function HSe(n){let e=[],i=[],a=0,l=!1,u=!1;const f=new WeakSet,_={schedule:(E,S=!1,w=!1)=>{const I=w&&l,k=I?e:i;return S&&f.add(E),k.indexOf(E)===-1&&(k.push(E),I&&l&&(a=e.length)),E},cancel:E=>{const S=i.indexOf(E);S!==-1&&i.splice(S,1),f.delete(E)},process:E=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,a=e.length,a)for(let S=0;S<a;S++){const w=e[S];w(E),f.has(w)&&(_.schedule(w),n())}l=!1,u&&(u=!1,_.process(E))}};return _}const $Se=40;let oV=!0,OC=!1,aV=!1;const r0={delta:0,timestamp:0},hR=["read","update","preRender","render","postRender"],Vk=hR.reduce((n,e)=>(n[e]=HSe(()=>OC=!0),n),{}),KSe=hR.reduce((n,e)=>{const i=Vk[e];return n[e]=(a,l=!1,u=!1)=>(OC||XSe(),i.schedule(a,l,u)),n},{}),qSe=hR.reduce((n,e)=>(n[e]=Vk[e].cancel,n),{});hR.reduce((n,e)=>(n[e]=()=>Vk[e].process(r0),n),{});const YSe=n=>Vk[n].process(r0),cee=n=>{OC=!1,r0.delta=oV?oee:Math.max(Math.min(n-r0.timestamp,$Se),1),r0.timestamp=n,aV=!0,hR.forEach(YSe),aV=!1,OC&&(oV=!1,aee(cee))},XSe=()=>{OC=!0,oV=!0,aV||aee(cee)},rq=()=>r0;var JSe=Object.defineProperty,QSe=(n,e,i)=>e in n?JSe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Ld=(n,e,i)=>(QSe(n,typeof e!="symbol"?e+"":e,i),i);class ZSe{constructor(e,i,a){if(Ld(this,"history",[]),Ld(this,"startEvent",null),Ld(this,"lastEvent",null),Ld(this,"lastEventInfo",null),Ld(this,"handlers",{}),Ld(this,"removeListeners",()=>{}),Ld(this,"threshold",3),Ld(this,"win"),Ld(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=AM(this.lastEventInfo,this.history),E=this.startEvent!==null,S=r0e(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!S)return;const{timestamp:w}=rq();this.history.push({..._.point,timestamp:w});const{onStart:I,onMove:k}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),k==null||k(this.lastEvent,_)}),Ld(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,KSe.update(this.updatePoint,!0)}),Ld(this,"onPointerUp",(_,E)=>{const S=AM(E,this.history),{onEnd:w,onSessionEnd:I}=this.handlers;I==null||I(_,S),this.end(),!(!w||!this.startEvent)&&(w==null||w(_,S))}),this.win=e.view??window,qve(e))return;this.handlers=i,a&&(this.threshold=a),e.stopPropagation(),e.preventDefault();const l={point:GZ(e)},{timestamp:u}=rq();this.history=[{...l.point,timestamp:u}];const{onSessionStart:f}=i;f==null||f(e,AM(l,this.history)),this.removeListeners=n0e(hO(this.win,"pointermove",this.onPointerMove),hO(this.win,"pointerup",this.onPointerUp),hO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),qSe.update(this.updatePoint)}}function iq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function AM(n,e){return{point:n.point,delta:iq(n.point,e[e.length-1]),offset:iq(n.point,e[0]),velocity:t0e(e,.1)}}const e0e=n=>n*1e3;function t0e(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>e0e(e)));)i--;if(!a)return{x:0,y:0};const u=(l.timestamp-a.timestamp)/1e3;if(u===0)return{x:0,y:0};const f={x:(l.x-a.x)/u,y:(l.y-a.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function n0e(...n){return e=>n.reduce((i,a)=>a(i),e)}function PM(n,e){return Math.abs(n-e)}function sq(n){return"x"in n&&"y"in n}function r0e(n,e){if(typeof n=="number"&&typeof e=="number")return PM(n,e);if(sq(n)&&sq(e)){const i=PM(n.x,e.x),a=PM(n.y,e.y);return Math.sqrt(i**2+a**2)}return 0}function i0e(n,e){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:f,threshold:_}=e,E=!!(i||a||l||u||f),S=D.useRef(null),w=ree({onSessionStart:u,onSessionEnd:f,onStart:a,onMove:i,onEnd(I,k){S.current=null,l==null||l(I,k)}});D.useEffect(()=>{var I;(I=S.current)==null||I.updateHandlers(w.current)}),D.useEffect(()=>{const I=n.current;if(!I||!E)return;function k(U){S.current=new ZSe(U,w.current,_)}return hO(I,"pointerdown",k)},[n,E,w,_]),D.useEffect(()=>()=>{var I;(I=S.current)==null||I.end(),S.current=null},[])}const co={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},$h=n=>lee(e=>n(e,"&"),"[role=group]","[data-group]",".group"),bf=n=>lee(e=>n(e,"~ &"),"[data-peer]",".peer"),lee=(n,...e)=>e.map(n).join(", "),i0={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:$h(co.open),_groupClosed:$h(co.closed),_groupHover:$h(co.hover),_peerHover:bf(co.hover),_groupFocus:$h(co.focus),_peerFocus:bf(co.focus),_groupFocusVisible:$h(co.focusVisible),_peerFocusVisible:bf(co.focusVisible),_groupActive:$h(co.active),_peerActive:bf(co.active),_groupDisabled:$h(co.disabled),_peerDisabled:bf(co.disabled),_groupInvalid:$h(co.invalid),_peerInvalid:bf(co.invalid),_groupChecked:$h(co.checked),_peerChecked:bf(co.checked),_groupFocusWithin:$h(co.focusWithin),_peerFocusWithin:bf(co.focusWithin),_peerPlaceholderShown:bf(co.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},uee=Object.keys(i0),s0e=n=>/!(important)?$/.test(n),oq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,o0e=(n,e)=>i=>{const a=String(e),l=s0e(a),u=oq(a),f=n?`${n}.${u}`:u;let _=po(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:e;return _=oq(_),l?`${_} !important`:_};function Jj(n){const{scale:e,transform:i,compose:a}=n;return(u,f)=>{const _=o0e(e,u)(f);let E=(i==null?void 0:i(_,f))??_;return a&&(E=a(E,f)),E}}const P1=(...n)=>e=>n.reduce((i,a)=>a(i),e);function Pu(n,e){return i=>{const a={property:i,scale:n};return a.transform=Jj({scale:n,transform:e}),a}}const a0e=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function c0e(n){const{property:e,scale:i,transform:a}=n;return{scale:i,property:a0e(e),transform:i?Jj({scale:i,compose:a}):a}}const dee=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function l0e(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...dee].join(" ")}function u0e(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...dee].join(" ")}const d0e={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},h0e={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function p0e(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const f0e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},cV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},m0e=new Set(Object.values(cV)),lV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),g0e=n=>n.trim();function _0e(n,e){if(n==null||lV.has(n))return n;if(!(uV(n)||lV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!u||!f)return n;const _=u.includes("-gradient")?u:`${u}-gradient`,[E,...S]=f.split(",").map(g0e).filter(Boolean);if((S==null?void 0:S.length)===0)return n;const w=E in cV?cV[E]:E;S.unshift(w);const I=S.map(k=>{if(m0e.has(k))return k;const U=k.indexOf(" "),[L,F]=U!==-1?[k.substr(0,U),k.substr(U+1)]:[k],B=uV(F)?F:F&&F.split(" "),q=`colors.${L}`,$=q in e.__cssMap?e.__cssMap[q].varRef:L;return B?[$,...Array.isArray(B)?B:[B]].join(" "):$});return`${_}(${I.join(", ")})`}const uV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),y0e=(n,e)=>_0e(n,e??{});function E0e(n){return/^var\(--.+\)$/.test(n)}const v0e=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Kh=n=>e=>`${n}(${e})`,xr={filter(n){return n!=="auto"?n:d0e},backdropFilter(n){return n!=="auto"?n:h0e},ring(n){return p0e(xr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?l0e():n==="auto-gpu"?u0e():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=v0e(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(E0e(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:y0e,blur:Kh("blur"),opacity:Kh("opacity"),brightness:Kh("brightness"),contrast:Kh("contrast"),dropShadow:Kh("drop-shadow"),grayscale:Kh("grayscale"),hueRotate:n=>Kh("hue-rotate")(xr.degree(n)),invert:Kh("invert"),saturate:Kh("saturate"),sepia:Kh("sepia"),bgImage(n){return n==null||uV(n)||lV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=f0e[n]??{},a={flexDirection:n};return e&&(a[e]=1),i&&(a[i]=1),a}},Be={borderWidths:Pu("borderWidths"),borderStyles:Pu("borderStyles"),colors:Pu("colors"),borders:Pu("borders"),gradients:Pu("gradients",xr.gradient),radii:Pu("radii",xr.px),space:Pu("space",P1(xr.vh,xr.px)),spaceT:Pu("space",P1(xr.vh,xr.px)),degreeT(n){return{property:n,transform:xr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:Jj({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Pu("sizes",P1(xr.vh,xr.px)),sizesT:Pu("sizes",P1(xr.vh,xr.fraction)),shadows:Pu("shadows"),logical:c0e,blur:Pu("blur",xr.blur)},pO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:xr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:xr.bgClip}};Object.assign(pO,{bgImage:pO.backgroundImage,bgImg:pO.backgroundImage});const Zr={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(Zr,{rounded:Zr.borderRadius,roundedTop:Zr.borderTopRadius,roundedTopLeft:Zr.borderTopLeftRadius,roundedTopRight:Zr.borderTopRightRadius,roundedTopStart:Zr.borderStartStartRadius,roundedTopEnd:Zr.borderStartEndRadius,roundedBottom:Zr.borderBottomRadius,roundedBottomLeft:Zr.borderBottomLeftRadius,roundedBottomRight:Zr.borderBottomRightRadius,roundedBottomStart:Zr.borderEndStartRadius,roundedBottomEnd:Zr.borderEndEndRadius,roundedLeft:Zr.borderLeftRadius,roundedRight:Zr.borderRightRadius,roundedStart:Zr.borderInlineStartRadius,roundedEnd:Zr.borderInlineEndRadius,borderStart:Zr.borderInlineStart,borderEnd:Zr.borderInlineEnd,borderTopStartRadius:Zr.borderStartStartRadius,borderTopEndRadius:Zr.borderStartEndRadius,borderBottomStartRadius:Zr.borderEndStartRadius,borderBottomEndRadius:Zr.borderEndEndRadius,borderStartRadius:Zr.borderInlineStartRadius,borderEndRadius:Zr.borderInlineEndRadius,borderStartWidth:Zr.borderInlineStartWidth,borderEndWidth:Zr.borderInlineEndWidth,borderStartColor:Zr.borderInlineStartColor,borderEndColor:Zr.borderInlineEndColor,borderStartStyle:Zr.borderInlineStartStyle,borderEndStyle:Zr.borderInlineEndStyle});const S0e={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},YO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:xr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(YO,{flexDir:YO.flexDirection});const Nu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",xr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Nu,{w:Nu.width,h:Nu.height,minW:Nu.minWidth,maxW:Nu.maxWidth,minH:Nu.minHeight,maxH:Nu.maxHeight,overscroll:Nu.overscrollBehavior,overscrollX:Nu.overscrollBehaviorX,overscrollY:Nu.overscrollBehaviorY});const b0e={filter:{transform:xr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",xr.brightness),contrast:Be.propT("--chakra-contrast",xr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",xr.hueRotate),invert:Be.propT("--chakra-invert",xr.invert),saturate:Be.propT("--chakra-saturate",xr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",xr.dropShadow),backdropFilter:{transform:xr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",xr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",xr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",xr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",xr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",xr.saturate)},T0e={ring:{transform:xr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},w0e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:xr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},hee={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function C0e(n,e,i,a){const l=typeof e=="string"?e.split("."):[e];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const R0e=n=>{const e=new WeakMap;return(a,l,u,f)=>{if(typeof a>"u")return n(a,l,u);e.has(a)||e.set(a,new Map);const _=e.get(a);if(_.has(l))return _.get(l);const E=n(a,l,u,f);return _.set(l,E),E}},I0e=R0e(C0e),A0e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},P0e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},OM=(n,e,i)=>{const a={},l=I0e(n,e,{});for(const u in l)u in i&&i[u]!=null||(a[u]=l[u]);return a},O0e={srOnly:{transform(n){return n===!0?A0e:n==="focusable"?P0e:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>OM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>OM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>OM(e,n,i)}},cC={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(cC,{insetStart:cC.insetInlineStart,insetEnd:cC.insetInlineEnd});const dV={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(dV,{shadow:dV.boxShadow});const Gi={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Gi,{m:Gi.margin,mt:Gi.marginTop,mr:Gi.marginRight,me:Gi.marginInlineEnd,marginEnd:Gi.marginInlineEnd,mb:Gi.marginBottom,ml:Gi.marginLeft,ms:Gi.marginInlineStart,marginStart:Gi.marginInlineStart,mx:Gi.marginX,my:Gi.marginY,p:Gi.padding,pt:Gi.paddingTop,py:Gi.paddingY,px:Gi.paddingX,pb:Gi.paddingBottom,pl:Gi.paddingLeft,ps:Gi.paddingInlineStart,paddingStart:Gi.paddingInlineStart,pr:Gi.paddingRight,pe:Gi.paddingInlineEnd,paddingEnd:Gi.paddingInlineEnd});const k0e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},N0e={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",xr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},D0e={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},x0e={clipPath:!0,transform:Be.propT("transform",xr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},L0e={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},M0e={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},Qj=Uu({},pO,Zr,S0e,YO,Nu,b0e,T0e,w0e,hee,O0e,cC,dV,Gi,k0e,N0e,D0e,x0e,L0e,M0e),U0e=Object.assign({},Gi,Nu,YO,hee,cC),pee=Object.keys(U0e),V0e=[...Object.keys(Qj),...uee],j0e={...Qj,...i0},F0e=n=>n in j0e,B0e=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=e.__breakpoints,u={};for(const f in n){let _=el(n[f],e);if(_==null)continue;if(_=po(_)&&i(_)?a(_):_,!Array.isArray(_)){u[f]=_;continue}const E=_.slice(0,l.length).length;for(let S=0;S<E;S+=1){const w=l==null?void 0:l[S];if(!w){u[f]=_[S];continue}u[w]=u[w]||{},_[S]!=null&&(u[w][f]=_[S])}}return u};function W0e(n){const e=[];let i="",a=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(a=!0,i+=u):u===")"?(a=!1,i+=u):u===","&&!a?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function z0e(n){return/^var\(--.+\)$/.test(n)}const G0e=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!z0e(e),H0e=(n,e)=>{if(e==null)return e;const i=f=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[f])==null?void 0:E.varRef},a=f=>i(f)??f,[l,u]=W0e(e);return e=i(l)??a(u)??a(e),e};function $0e(n){const{configs:e={},pseudos:i={},theme:a}=n,l=(u,f=!1)=>{var w;const _=el(u,a),E=B0e(_)(a);let S={};for(let I in E){const k=E[I];let U=el(k,a);I in i&&(I=i[I]),G0e(I,U)&&(U=H0e(a,U));let L=e[I];if(L===!0&&(L={property:I}),po(U)){S[I]=S[I]??{},S[I]=Uu({},S[I],l(U,!0));continue}let F=((w=L==null?void 0:L.transform)==null?void 0:w.call(L,U,a,_))??U;F=L!=null&&L.processResult?l(F,!0):F;const B=el(L==null?void 0:L.property,a);if(!f&&(L!=null&&L.static)){const q=el(L.static,a);S=Uu({},S,q)}if(B&&Array.isArray(B)){for(const q of B)S[q]=F;continue}if(B){B==="&"&&po(F)?S=Uu({},S,F):S[B]=F;continue}if(po(F)){S=Uu({},S,F);continue}S[I]=F}return S};return l}const fee=n=>e=>$0e({theme:e,pseudos:i0,configs:Qj})(n);function SGe(n){return n}function bGe(n){return n}function Li(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function K0e(n,e,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${e}.${i}`])==null?void 0:l.varRef)??i}function q0e(n,e){if(Array.isArray(n))return n;if(po(n))return e(n);if(n!=null)return[n]}function Y0e(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function X0e(n){const e=n.__breakpoints;return function(a,l,u,f){var k,U;if(!e)return;const _={},E=q0e(u,e.toArrayValue);if(!E)return _;const S=E.length,w=S===1,I=!!a.parts;for(let L=0;L<S;L++){const F=e.details[L],B=e.details[Y0e(E,L)],q=Ww(F.minW,B==null?void 0:B._minW),$=el((k=a[l])==null?void 0:k[E[L]],f);if($){if(I){(U=a.parts)==null||U.forEach(X=>{Uu(_,{[X]:w?$[X]:{[q]:$[X]}})});continue}if(!I){w?Uu(_,$):_[q]=$;continue}_[q]=$}}return _}}function J0e(n){return e=>{const{variant:i,size:a,theme:l}=e,u=X0e(l);return Uu({},el(n.baseStyle??{},e),u(n,"sizes",a,e),u(n,"variants",i,e))}}function Ii(n){return $0(n,["styleConfig","size","variant","colorScheme"])}function mee(n){return po(n)&&n.reference?n.reference:String(n)}const jk=(n,...e)=>e.map(mee).join(` ${n} `).replace(/calc/g,""),aq=(...n)=>`calc(${jk("+",...n)})`,cq=(...n)=>`calc(${jk("-",...n)})`,hV=(...n)=>`calc(${jk("*",...n)})`,lq=(...n)=>`calc(${jk("/",...n)})`,uq=n=>{const e=mee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:hV(e,-1)},Rf=Object.assign(n=>({add:(...e)=>Rf(aq(n,...e)),subtract:(...e)=>Rf(cq(n,...e)),multiply:(...e)=>Rf(hV(n,...e)),divide:(...e)=>Rf(lq(n,...e)),negate:()=>Rf(uq(n)),toString:()=>n.toString()}),{add:aq,subtract:cq,multiply:hV,divide:lq,negate:uq});function Q0e(n,e="-"){return n.replace(/\s+/g,e)}function Z0e(n){const e=Q0e(n.toString());return tbe(ebe(e))}function ebe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function tbe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function nbe(n,e=""){return[e,n].filter(Boolean).join("-")}function rbe(n,e){return`var(${n}${e?`, ${e}`:""})`}function ibe(n,e=""){return Z0e(`--${nbe(n,e)}`)}function xn(n,e,i){const a=ibe(n,i);return{variable:a,reference:rbe(a,e)}}function sbe(n,e){const i={};for(const a of e){if(Array.isArray(a)){const[l,u]=a;i[l]=xn(`${n}-${l}`,u);continue}i[a]=xn(`${n}-${a}`)}return i}const obe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function abe(n){return YZ(n,obe)}function cbe(n){return n.semanticTokens}function lbe(n){const{__cssMap:e,__cssVars:i,__breakpoints:a,...l}=n;return l}function ube(n){const e=abe(n),i=cbe(n),a=u=>uee.includes(u)||u==="default",l={};return QK(e,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!1,value:u})}),QK(i,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(a)}),l}function dq(n,e){return xn(String(n).replace(/\./g,"-"),void 0,e)}function dbe(n){var f;const e=ube(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function u(_,E){const w=[String(_).split(".")[0],E].join(".");if(!e[w])return E;const{reference:k}=dq(w,i);return k}for(const[_,E]of Object.entries(e)){const{isSemantic:S,value:w}=E,{variable:I,reference:k}=dq(_,i);if(!S){if(_.startsWith("space")){const L=_.split("."),[F,...B]=L,q=`${F}.-${B.join(".")}`,$=Rf.negate(w),X=Rf.negate(k);l[q]={value:$,var:I,varRef:X}}a[I]=w,l[_]={value:w,var:I,varRef:k};continue}const U=po(w)?w:{default:w};a=Uu(a,Object.entries(U).reduce((L,[F,B])=>{if(!B)return L;const q=u(_,`${B}`);if(F==="default")return L[I]=q,L;const $=(i0==null?void 0:i0[F])??F;return L[$]={[I]:q},L},{})),l[_]={value:k,var:I,varRef:k}}return{cssVars:a,cssMap:l}}function hbe(n){const e=lbe(n),{cssMap:i,cssVars:a}=dbe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:rSe(e.breakpoints)}),e}function ii(n,e={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...w){a();for(const I of w)e[I]=E(I);return ii(n,e)}function u(...w){for(const I of w)I in e||(e[I]=E(I));return ii(n,e)}function f(){return Object.fromEntries(Object.entries(e).map(([I,k])=>[I,k.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,k])=>[I,k.className]))}function E(w){const U=`chakra-${(["container","root"].includes(w??"")?[n]:[n,w]).filter(Boolean).join("__")}`;return{className:U,selector:`.${U}`,toString:()=>w}}return{parts:l,toPart:E,extend:u,selectors:f,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const pbe=ii("accordion").parts("root","container","button","panel","icon"),fbe=ii("alert").parts("title","description","container","icon","spinner"),mbe=ii("avatar").parts("label","badge","container","excessLabel","group"),gbe=ii("breadcrumb").parts("link","item","container","separator");ii("button").parts();const _be=ii("checkbox").parts("control","icon","container","label");ii("progress").parts("track","filledTrack","label");const ybe=ii("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Ebe=ii("editable").parts("preview","input","textarea"),vbe=ii("form").parts("container","requiredIndicator","helperText"),Sbe=ii("formError").parts("text","icon"),bbe=ii("input").parts("addon","field","element","group"),Tbe=ii("list").parts("container","item","icon"),wbe=ii("menu").parts("button","list","item","groupTitle","icon","command","divider"),Cbe=ii("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Rbe=ii("numberinput").parts("root","field","stepperGroup","stepper");ii("pininput").parts("field");const Ibe=ii("popover").parts("content","header","body","footer","popper","arrow","closeButton"),Abe=ii("progress").parts("label","filledTrack","track"),Pbe=ii("radio").parts("container","control","label"),Obe=ii("select").parts("field","icon"),kbe=ii("slider").parts("container","track","thumb","filledTrack","mark"),Nbe=ii("stat").parts("container","label","helpText","number","icon"),Dbe=ii("switch").parts("container","track","thumb","label"),xbe=ii("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Lbe=ii("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Mbe=ii("tag").parts("container","label","closeButton"),Ube=ii("card").parts("container","header","body","footer");ii("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Vbe,defineMultiStyleConfig:jbe}=Li(pbe.keys),Fbe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},Bbe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},Wbe={pt:"2",px:"4",pb:"5"},zbe={fontSize:"1.25em"},Gbe=Vbe({container:Fbe,button:Bbe,panel:Wbe,icon:zbe}),Hbe=jbe({baseStyle:Gbe});function Oy(n,e,i){return Math.min(Math.max(n,i),e)}class $be extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Gw=$be;function Zj(n){if(typeof n!="string")throw new Gw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=eTe.test(n)?Ybe(n):n;const i=Xbe.exec(e);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(_=>parseInt(kC(_,2),16)),parseInt(kC(f[3]||"f",2),16)/255]}const a=Jbe.exec(e);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,16)),parseInt(f[3]||"ff",16)/255]}const l=Qbe.exec(e);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,10)),parseFloat(f[3]||"1")]}const u=Zbe.exec(e);if(u){const[f,_,E,S]=Array.from(u).slice(1).map(parseFloat);if(Oy(0,100,_)!==_)throw new Gw(n);if(Oy(0,100,E)!==E)throw new Gw(n);return[...tTe(f,_,E),Number.isNaN(S)?1:S]}throw new Gw(n)}function Kbe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const hq=n=>parseInt(n.replace(/_/g,""),36),qbe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=hq(e.substring(0,3)),a=hq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-a.length;u++)l+="0";return n[i]=`${l}${a}`,n},{});function Ybe(n){const e=n.toLowerCase().trim(),i=qbe[Kbe(e)];if(!i)throw new Gw(n);return`#${i}`}const kC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),Xbe=new RegExp(`^#${kC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),Jbe=new RegExp(`^#${kC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Qbe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${kC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Zbe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,eTe=/^[a-z]+$/i,pq=n=>Math.round(n*255),tTe=(n,e,i)=>{let a=i/100;if(e===0)return[a,a,a].map(pq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*a-1))*(e/100),f=u*(1-Math.abs(l%2-1));let _=0,E=0,S=0;l>=0&&l<1?(_=u,E=f):l>=1&&l<2?(_=f,E=u):l>=2&&l<3?(E=u,S=f):l>=3&&l<4?(E=f,S=u):l>=4&&l<5?(_=f,S=u):l>=5&&l<6&&(_=u,S=f);const w=a-u/2,I=_+w,k=E+w,U=S+w;return[I,k,U].map(pq)};function nTe(n,e,i,a){return`rgba(${Oy(0,255,n).toFixed()}, ${Oy(0,255,e).toFixed()}, ${Oy(0,255,i).toFixed()}, ${parseFloat(Oy(0,1,a).toFixed(3))})`}function rTe(n,e){const[i,a,l,u]=Zj(n);return nTe(i,a,l,u-e)}function iTe(n){const[e,i,a,l]=Zj(n);let u=f=>{const _=Oy(0,255,f).toString(16);return _.length===1?`0${_}`:_};return`#${u(e)}${u(i)}${u(a)}${l<1?u(Math.round(l*255)):""}`}const sTe=n=>Object.keys(n).length===0;function oTe(n,e,i,a,l){for(e=e.split?e.split("."):e,a=0;a<e.length;a++)n=n?n[e[a]]:l;return n===l?i:n}const ac=(n,e,i)=>{const a=oTe(n,`colors.${e}`,e);try{return iTe(a),a}catch{return i??"#000000"}},aTe=n=>{const[e,i,a]=Zj(n);return(e*299+i*587+a*114)/1e3},cTe=n=>e=>{const i=ac(e,n);return aTe(i)<128?"dark":"light"},lTe=n=>e=>cTe(n)(e)==="dark",v0=(n,e)=>i=>{const a=ac(i,n);return rTe(a,1-e)};function fq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const uTe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function dTe(n){const e=uTe();return!n||sTe(n)?e:n.string&&n.colors?pTe(n.string,n.colors):n.string&&!n.colors?hTe(n.string):n.colors&&!n.string?fTe(n.colors):e}function hTe(n){let e=0;if(n.length===0)return e.toString();for(let a=0;a<n.length;a+=1)e=n.charCodeAt(a)+((e<<5)-e),e=e&e;let i="#";for(let a=0;a<3;a+=1){const l=e>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function pTe(n,e){let i=0;if(n.length===0)return e[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function fTe(n){return n[Math.floor(Math.random()*n.length)]}function Nn(n,e){return i=>i.colorMode==="dark"?e:n}function eF(n){const{orientation:e,vertical:i,horizontal:a}=n;return e?e==="vertical"?i:a:{}}function gee(n){return po(n)&&n.reference?n.reference:String(n)}const Fk=(n,...e)=>e.map(gee).join(` ${n} `).replace(/calc/g,""),mq=(...n)=>`calc(${Fk("+",...n)})`,gq=(...n)=>`calc(${Fk("-",...n)})`,pV=(...n)=>`calc(${Fk("*",...n)})`,_q=(...n)=>`calc(${Fk("/",...n)})`,yq=n=>{const e=gee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:pV(e,-1)},If=Object.assign(n=>({add:(...e)=>If(mq(n,...e)),subtract:(...e)=>If(gq(n,...e)),multiply:(...e)=>If(pV(n,...e)),divide:(...e)=>If(_q(n,...e)),negate:()=>If(yq(n)),toString:()=>n.toString()}),{add:mq,subtract:gq,multiply:pV,divide:_q,negate:yq});function mTe(n){return!Number.isInteger(parseFloat(n.toString()))}function gTe(n,e="-"){return n.replace(/\s+/g,e)}function _ee(n){const e=gTe(n.toString());return e.includes("\\.")?n:mTe(n)?e.replace(".","\\."):n}function _Te(n,e=""){return[e,_ee(n)].filter(Boolean).join("-")}function yTe(n,e){return`var(${_ee(n)}${e?`, ${e}`:""})`}function ETe(n,e=""){return`--${_Te(n,e)}`}function go(n,e){const i=ETe(n,e==null?void 0:e.prefix);return{variable:i,reference:yTe(i,vTe(e==null?void 0:e.fallback))}}function vTe(n){return n==null?void 0:n.reference}const{definePartsStyle:pR,defineMultiStyleConfig:STe}=Li(fbe.keys),jl=xn("alert-fg"),zf=xn("alert-bg"),bTe=pR({container:{bg:zf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:jl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:jl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function tF(n){const{theme:e,colorScheme:i}=n,a=v0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:a}}const TTe=pR(n=>{const{colorScheme:e}=n,i=tF(n);return{container:{[jl.variable]:`colors.${e}.600`,[zf.variable]:i.light,_dark:{[jl.variable]:`colors.${e}.200`,[zf.variable]:i.dark}}}}),wTe=pR(n=>{const{colorScheme:e}=n,i=tF(n);return{container:{[jl.variable]:`colors.${e}.600`,[zf.variable]:i.light,_dark:{[jl.variable]:`colors.${e}.200`,[zf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:jl.reference}}}),CTe=pR(n=>{const{colorScheme:e}=n,i=tF(n);return{container:{[jl.variable]:`colors.${e}.600`,[zf.variable]:i.light,_dark:{[jl.variable]:`colors.${e}.200`,[zf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:jl.reference}}}),RTe=pR(n=>{const{colorScheme:e}=n;return{container:{[jl.variable]:"colors.white",[zf.variable]:`colors.${e}.600`,_dark:{[jl.variable]:"colors.gray.900",[zf.variable]:`colors.${e}.200`},color:jl.reference}}}),ITe={subtle:TTe,"left-accent":wTe,"top-accent":CTe,solid:RTe},ATe=STe({baseStyle:bTe,variants:ITe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),yee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},PTe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},OTe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},Eee={...yee,...PTe,container:OTe},kTe=n=>typeof n=="function";function lc(n,...e){return kTe(n)?n(...e):n}const{definePartsStyle:vee,defineMultiStyleConfig:NTe}=Li(mbe.keys),s0=xn("avatar-border-color"),lC=xn("avatar-bg"),NC=xn("avatar-font-size"),S0=xn("avatar-size"),DTe={borderRadius:"full",border:"0.2em solid",borderColor:s0.reference,[s0.variable]:"white",_dark:{[s0.variable]:"colors.gray.800"}},xTe={bg:lC.reference,fontSize:NC.reference,width:S0.reference,height:S0.reference,lineHeight:"1",[lC.variable]:"colors.gray.200",_dark:{[lC.variable]:"colors.whiteAlpha.400"}},LTe=n=>{const{name:e,theme:i}=n,a=e?dTe({string:e}):"colors.gray.400",l=lTe(a)(i);let u="white";return l||(u="gray.800"),{bg:lC.reference,fontSize:NC.reference,color:u,borderColor:s0.reference,verticalAlign:"top",width:S0.reference,height:S0.reference,"&:not([data-loaded])":{[lC.variable]:a},[s0.variable]:"colors.white",_dark:{[s0.variable]:"colors.gray.800"}}},MTe={fontSize:NC.reference,lineHeight:"1"},UTe=vee(n=>({badge:lc(DTe,n),excessLabel:lc(xTe,n),container:lc(LTe,n),label:MTe}));function lg(n){const e=n!=="100%"?Eee[n]:void 0;return vee({container:{[S0.variable]:e??n,[NC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[S0.variable]:e??n,[NC.variable]:`calc(${e??n} / 2.5)`}})}const VTe={"2xs":lg(4),xs:lg(6),sm:lg(8),md:lg(12),lg:lg(16),xl:lg(24),"2xl":lg(32),full:lg("100%")},jTe=NTe({baseStyle:UTe,sizes:VTe,defaultProps:{size:"md"}}),Us=sbe("badge",["bg","color","shadow"]),FTe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Us.bg.reference,color:Us.color.reference,boxShadow:Us.shadow.reference},BTe=n=>{const{colorScheme:e,theme:i}=n,a=v0(`${e}.500`,.6)(i);return{[Us.bg.variable]:`colors.${e}.500`,[Us.color.variable]:"colors.white",_dark:{[Us.bg.variable]:a,[Us.color.variable]:"colors.whiteAlpha.800"}}},WTe=n=>{const{colorScheme:e,theme:i}=n,a=v0(`${e}.200`,.16)(i);return{[Us.bg.variable]:`colors.${e}.100`,[Us.color.variable]:`colors.${e}.800`,_dark:{[Us.bg.variable]:a,[Us.color.variable]:`colors.${e}.200`}}},zTe=n=>{const{colorScheme:e,theme:i}=n,a=v0(`${e}.200`,.8)(i);return{[Us.color.variable]:`colors.${e}.500`,_dark:{[Us.color.variable]:a},[Us.shadow.variable]:`inset 0 0 0px 1px ${Us.color.reference}`}},GTe={solid:BTe,subtle:WTe,outline:zTe},uC={baseStyle:FTe,variants:GTe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:HTe,definePartsStyle:$Te}=Li(gbe.keys),kM=xn("breadcrumb-link-decor"),KTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:kM.reference,[kM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[kM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},qTe=$Te({link:KTe}),YTe=HTe({baseStyle:qTe}),XTe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},See=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Nn("gray.800","whiteAlpha.900")(n),_hover:{bg:Nn("gray.100","whiteAlpha.200")(n)},_active:{bg:Nn("gray.200","whiteAlpha.300")(n)}};const a=v0(`${e}.200`,.12)(i),l=v0(`${e}.200`,.24)(i);return{color:Nn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Nn(`${e}.50`,a)(n)},_active:{bg:Nn(`${e}.100`,l)(n)}}},JTe=n=>{const{colorScheme:e}=n,i=Nn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...lc(See,n)}},QTe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},ZTe=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Nn("gray.100","whiteAlpha.200")(n);return{bg:_,color:Nn("gray.800","whiteAlpha.900")(n),_hover:{bg:Nn("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Nn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:a="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=QTe[e]??{},f=Nn(i,`${e}.200`)(n);return{bg:f,color:Nn(a,"gray.800")(n),_hover:{bg:Nn(l,`${e}.300`)(n),_disabled:{bg:f}},_active:{bg:Nn(u,`${e}.400`)(n)}}},ewe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Nn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Nn(`${e}.700`,`${e}.500`)(n)}}},twe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},nwe={ghost:See,outline:JTe,solid:ZTe,link:ewe,unstyled:twe},rwe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},iwe={baseStyle:XTe,variants:nwe,sizes:rwe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Ly,defineMultiStyleConfig:swe}=Li(Ube.keys),XO=xn("card-bg"),Uf=xn("card-padding"),bee=xn("card-shadow"),fO=xn("card-radius"),Tee=xn("card-border-width","0"),wee=xn("card-border-color"),owe=Ly({container:{[XO.variable]:"colors.chakra-body-bg",backgroundColor:XO.reference,boxShadow:bee.reference,borderRadius:fO.reference,color:"chakra-body-text",borderWidth:Tee.reference,borderColor:wee.reference},body:{padding:Uf.reference,flex:"1 1 0%"},header:{padding:Uf.reference},footer:{padding:Uf.reference}}),awe={sm:Ly({container:{[fO.variable]:"radii.base",[Uf.variable]:"space.3"}}),md:Ly({container:{[fO.variable]:"radii.md",[Uf.variable]:"space.5"}}),lg:Ly({container:{[fO.variable]:"radii.xl",[Uf.variable]:"space.7"}})},cwe={elevated:Ly({container:{[bee.variable]:"shadows.base",_dark:{[XO.variable]:"colors.gray.700"}}}),outline:Ly({container:{[Tee.variable]:"1px",[wee.variable]:"colors.chakra-border-color"}}),filled:Ly({container:{[XO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Uf.variable]:0},header:{[Uf.variable]:0},footer:{[Uf.variable]:0}}},lwe=swe({baseStyle:owe,variants:cwe,sizes:awe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:mO,defineMultiStyleConfig:uwe}=Li(_be.keys),dC=xn("checkbox-size"),dwe=n=>{const{colorScheme:e}=n;return{w:dC.reference,h:dC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Nn(`${e}.500`,`${e}.200`)(n),borderColor:Nn(`${e}.500`,`${e}.200`)(n),color:Nn("white","gray.900")(n),_hover:{bg:Nn(`${e}.600`,`${e}.300`)(n),borderColor:Nn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Nn("gray.200","transparent")(n),bg:Nn("gray.200","whiteAlpha.300")(n),color:Nn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Nn(`${e}.500`,`${e}.200`)(n),borderColor:Nn(`${e}.500`,`${e}.200`)(n),color:Nn("white","gray.900")(n)},_disabled:{bg:Nn("gray.100","whiteAlpha.100")(n),borderColor:Nn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Nn("red.500","red.300")(n)}}},hwe={_disabled:{cursor:"not-allowed"}},pwe={userSelect:"none",_disabled:{opacity:.4}},fwe={transitionProperty:"transform",transitionDuration:"normal"},mwe=mO(n=>({icon:fwe,container:hwe,control:lc(dwe,n),label:pwe})),gwe={sm:mO({control:{[dC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:mO({control:{[dC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:mO({control:{[dC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},fg=uwe({baseStyle:mwe,sizes:gwe,defaultProps:{size:"md",colorScheme:"blue"}}),hC=go("close-button-size"),Sw=go("close-button-bg"),_we={w:[hC.reference],h:[hC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Sw.variable]:"colors.blackAlpha.100",_dark:{[Sw.variable]:"colors.whiteAlpha.100"}},_active:{[Sw.variable]:"colors.blackAlpha.200",_dark:{[Sw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Sw.reference},ywe={lg:{[hC.variable]:"sizes.10",fontSize:"md"},md:{[hC.variable]:"sizes.8",fontSize:"xs"},sm:{[hC.variable]:"sizes.6",fontSize:"2xs"}},Ewe={baseStyle:_we,sizes:ywe,defaultProps:{size:"md"}},{variants:vwe,defaultProps:Swe}=uC,bwe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Us.bg.reference,color:Us.color.reference,boxShadow:Us.shadow.reference},Twe={baseStyle:bwe,variants:vwe,defaultProps:Swe},wwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Cwe={baseStyle:wwe},Rwe={opacity:.6,borderColor:"inherit"},Iwe={borderStyle:"solid"},Awe={borderStyle:"dashed"},Pwe={solid:Iwe,dashed:Awe},Owe={baseStyle:Rwe,variants:Pwe,defaultProps:{variant:"solid"}},{definePartsStyle:fV,defineMultiStyleConfig:kwe}=Li(ybe.keys),NM=xn("drawer-bg"),DM=xn("drawer-box-shadow");function PS(n){return fV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const Nwe={bg:"blackAlpha.600",zIndex:"modal"},Dwe={display:"flex",zIndex:"modal",justifyContent:"center"},xwe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[NM.variable]:"colors.white",[DM.variable]:"shadows.lg",_dark:{[NM.variable]:"colors.gray.700",[DM.variable]:"shadows.dark-lg"},bg:NM.reference,boxShadow:DM.reference}},Lwe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Mwe={position:"absolute",top:"2",insetEnd:"3"},Uwe={px:"6",py:"2",flex:"1",overflow:"auto"},Vwe={px:"6",py:"4"},jwe=fV(n=>({overlay:Nwe,dialogContainer:Dwe,dialog:lc(xwe,n),header:Lwe,closeButton:Mwe,body:Uwe,footer:Vwe})),Fwe={xs:PS("xs"),sm:PS("md"),md:PS("lg"),lg:PS("2xl"),xl:PS("4xl"),full:PS("full")},Bwe=kwe({baseStyle:jwe,sizes:Fwe,defaultProps:{size:"xs"}}),{definePartsStyle:Wwe,defineMultiStyleConfig:zwe}=Li(Ebe.keys),Gwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Hwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},$we={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Kwe=Wwe({preview:Gwe,input:Hwe,textarea:$we}),qwe=zwe({baseStyle:Kwe}),{definePartsStyle:Ywe,defineMultiStyleConfig:Xwe}=Li(vbe.keys),o0=xn("form-control-color"),Jwe={marginStart:"1",[o0.variable]:"colors.red.500",_dark:{[o0.variable]:"colors.red.300"},color:o0.reference},Qwe={mt:"2",[o0.variable]:"colors.gray.600",_dark:{[o0.variable]:"colors.whiteAlpha.600"},color:o0.reference,lineHeight:"normal",fontSize:"sm"},Zwe=Ywe({container:{width:"100%",position:"relative"},requiredIndicator:Jwe,helperText:Qwe}),eCe=Xwe({baseStyle:Zwe}),{definePartsStyle:tCe,defineMultiStyleConfig:nCe}=Li(Sbe.keys),a0=xn("form-error-color"),rCe={[a0.variable]:"colors.red.500",_dark:{[a0.variable]:"colors.red.300"},color:a0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},iCe={marginEnd:"0.5em",[a0.variable]:"colors.red.500",_dark:{[a0.variable]:"colors.red.300"},color:a0.reference},sCe=tCe({text:rCe,icon:iCe}),oCe=nCe({baseStyle:sCe}),aCe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},cCe={baseStyle:aCe},lCe={fontFamily:"heading",fontWeight:"bold"},uCe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},dCe={baseStyle:lCe,sizes:uCe,defaultProps:{size:"xl"}},{definePartsStyle:Pf,defineMultiStyleConfig:hCe}=Li(bbe.keys),zS=xn("input-height"),GS=xn("input-font-size"),HS=xn("input-padding"),$S=xn("input-border-radius"),pCe=Pf({addon:{height:zS.reference,fontSize:GS.reference,px:HS.reference,borderRadius:$S.reference},field:{width:"100%",height:zS.reference,fontSize:GS.reference,px:HS.reference,borderRadius:$S.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),ug={lg:{[GS.variable]:"fontSizes.lg",[HS.variable]:"space.4",[$S.variable]:"radii.md",[zS.variable]:"sizes.12"},md:{[GS.variable]:"fontSizes.md",[HS.variable]:"space.4",[$S.variable]:"radii.md",[zS.variable]:"sizes.10"},sm:{[GS.variable]:"fontSizes.sm",[HS.variable]:"space.3",[$S.variable]:"radii.sm",[zS.variable]:"sizes.8"},xs:{[GS.variable]:"fontSizes.xs",[HS.variable]:"space.2",[$S.variable]:"radii.sm",[zS.variable]:"sizes.6"}},fCe={lg:Pf({field:ug.lg,group:ug.lg}),md:Pf({field:ug.md,group:ug.md}),sm:Pf({field:ug.sm,group:ug.sm}),xs:Pf({field:ug.xs,group:ug.xs})};function nF(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Nn("blue.500","blue.300")(n),errorBorderColor:i||Nn("red.500","red.300")(n)}}const mCe=Pf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=nF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Nn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ac(e,a),boxShadow:`0 0 0 1px ${ac(e,a)}`},_focusVisible:{zIndex:1,borderColor:ac(e,i),boxShadow:`0 0 0 1px ${ac(e,i)}`}},addon:{border:"1px solid",borderColor:Nn("inherit","whiteAlpha.50")(n),bg:Nn("gray.100","whiteAlpha.300")(n)}}}),gCe=Pf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=nF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Nn("gray.100","whiteAlpha.50")(n),_hover:{bg:Nn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ac(e,a)},_focusVisible:{bg:"transparent",borderColor:ac(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Nn("gray.100","whiteAlpha.50")(n)}}}),_Ce=Pf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:a}=nF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:ac(e,a),boxShadow:`0px 1px 0px 0px ${ac(e,a)}`},_focusVisible:{borderColor:ac(e,i),boxShadow:`0px 1px 0px 0px ${ac(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),yCe=Pf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),ECe={outline:mCe,filled:gCe,flushed:_Ce,unstyled:yCe},ni=hCe({baseStyle:pCe,sizes:fCe,variants:ECe,defaultProps:{size:"md",variant:"outline"}}),xM=xn("kbd-bg"),vCe={[xM.variable]:"colors.gray.100",_dark:{[xM.variable]:"colors.whiteAlpha.100"},bg:xM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},SCe={baseStyle:vCe},bCe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},TCe={baseStyle:bCe},{defineMultiStyleConfig:wCe,definePartsStyle:CCe}=Li(Tbe.keys),RCe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},ICe=CCe({icon:RCe}),ACe=wCe({baseStyle:ICe}),{defineMultiStyleConfig:PCe,definePartsStyle:OCe}=Li(wbe.keys),Yh=xn("menu-bg"),LM=xn("menu-shadow"),kCe={[Yh.variable]:"#fff",[LM.variable]:"shadows.sm",_dark:{[Yh.variable]:"colors.gray.700",[LM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Yh.reference,boxShadow:LM.reference},NCe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Yh.variable]:"colors.gray.100",_dark:{[Yh.variable]:"colors.whiteAlpha.100"}},_active:{[Yh.variable]:"colors.gray.200",_dark:{[Yh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Yh.variable]:"colors.gray.100",_dark:{[Yh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Yh.reference},DCe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},xCe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},LCe={opacity:.6},MCe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},UCe={transitionProperty:"common",transitionDuration:"normal"},VCe=OCe({button:UCe,list:kCe,item:NCe,groupTitle:DCe,icon:xCe,command:LCe,divider:MCe}),jCe=PCe({baseStyle:VCe}),{defineMultiStyleConfig:FCe,definePartsStyle:mV}=Li(Cbe.keys),MM=xn("modal-bg"),UM=xn("modal-shadow"),BCe={bg:"blackAlpha.600",zIndex:"modal"},WCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},zCe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[MM.variable]:"colors.white",[UM.variable]:"shadows.lg",_dark:{[MM.variable]:"colors.gray.700",[UM.variable]:"shadows.dark-lg"},bg:MM.reference,boxShadow:UM.reference}},GCe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},HCe={position:"absolute",top:"2",insetEnd:"3"},$Ce=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},KCe={px:"6",py:"4"},qCe=mV(n=>({overlay:BCe,dialogContainer:lc(WCe,n),dialog:lc(zCe,n),header:GCe,closeButton:HCe,body:lc($Ce,n),footer:KCe}));function Md(n){return mV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const YCe={xs:Md("xs"),sm:Md("sm"),md:Md("md"),lg:Md("lg"),xl:Md("xl"),"2xl":Md("2xl"),"3xl":Md("3xl"),"4xl":Md("4xl"),"5xl":Md("5xl"),"6xl":Md("6xl"),full:Md("full")},XCe=FCe({baseStyle:qCe,sizes:YCe,defaultProps:{size:"md"}}),Cee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:JCe,definePartsStyle:Ree}=Li(Rbe.keys),rF=go("number-input-stepper-width"),Iee=go("number-input-input-padding"),QCe=If(rF).add("0.5rem").toString(),VM=go("number-input-bg"),jM=go("number-input-color"),FM=go("number-input-border-color"),ZCe={[rF.variable]:"sizes.6",[Iee.variable]:QCe},eRe=n=>{var e;return((e=lc(ni.baseStyle,n))==null?void 0:e.field)??{}},tRe={width:rF.reference},nRe={borderStart:"1px solid",borderStartColor:FM.reference,color:jM.reference,bg:VM.reference,[jM.variable]:"colors.chakra-body-text",[FM.variable]:"colors.chakra-border-color",_dark:{[jM.variable]:"colors.whiteAlpha.800",[FM.variable]:"colors.whiteAlpha.300"},_active:{[VM.variable]:"colors.gray.200",_dark:{[VM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},rRe=Ree(n=>({root:ZCe,field:lc(eRe,n)??{},stepperGroup:tRe,stepper:nRe}));function O1(n){var u,f;const e=(u=ni.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=e.field)==null?void 0:f.fontSize)??"md",l=Cee.fontSizes[a];return Ree({field:{...e.field,paddingInlineEnd:Iee.reference,verticalAlign:"top"},stepper:{fontSize:If(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const iRe={xs:O1("xs"),sm:O1("sm"),md:O1("md"),lg:O1("lg")},sRe=JCe({baseStyle:rRe,sizes:iRe,variants:ni.variants,defaultProps:ni.defaultProps});var uZ;const oRe={...(uZ=ni.baseStyle)==null?void 0:uZ.field,textAlign:"center"},aRe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var dZ;const cRe={outline:n=>{var e,i;return((i=lc((e=ni.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=lc((e=ni.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=lc((e=ni.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((dZ=ni.variants)==null?void 0:dZ.unstyled.field)??{}},lRe={baseStyle:oRe,sizes:aRe,variants:cRe,defaultProps:ni.defaultProps},{defineMultiStyleConfig:uRe,definePartsStyle:dRe}=Li(Ibe.keys),k1=go("popper-bg"),hRe=go("popper-arrow-bg"),Eq=go("popper-arrow-shadow-color"),pRe={zIndex:"popover"},fRe={[k1.variable]:"colors.white",bg:k1.reference,[hRe.variable]:k1.reference,[Eq.variable]:"colors.gray.200",_dark:{[k1.variable]:"colors.gray.700",[Eq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},mRe={px:3,py:2,borderBottomWidth:"1px"},gRe={px:3,py:2},_Re={px:3,py:2,borderTopWidth:"1px"},yRe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},ERe=dRe({popper:pRe,content:fRe,header:mRe,body:gRe,footer:_Re,closeButton:yRe}),vRe=uRe({baseStyle:ERe}),{defineMultiStyleConfig:SRe,definePartsStyle:Hw}=Li(Abe.keys),bRe=n=>{const{colorScheme:e,theme:i,isIndeterminate:a,hasStripe:l}=n,u=Nn(fq(),fq("1rem","rgba(0,0,0,0.1)"))(n),f=Nn(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${ac(i,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&u,...a?{bgImage:_}:{bgColor:f}}},TRe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},wRe=n=>({bg:Nn("gray.100","whiteAlpha.300")(n)}),CRe=n=>({transitionProperty:"common",transitionDuration:"slow",...bRe(n)}),RRe=Hw(n=>({label:TRe,filledTrack:CRe(n),track:wRe(n)})),IRe={xs:Hw({track:{h:"1"}}),sm:Hw({track:{h:"2"}}),md:Hw({track:{h:"3"}}),lg:Hw({track:{h:"4"}})},ARe=SRe({sizes:IRe,baseStyle:RRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:PRe,definePartsStyle:gO}=Li(Pbe.keys),ORe=n=>{var i;const e=(i=lc(fg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},kRe=gO(n=>{var e,i;return{label:(e=fg.baseStyle)==null?void 0:e.call(fg,n).label,container:(i=fg.baseStyle)==null?void 0:i.call(fg,n).container,control:ORe(n)}}),NRe={md:gO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:gO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:gO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},DRe=PRe({baseStyle:kRe,sizes:NRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:xRe,definePartsStyle:LRe}=Li(Obe.keys),N1=xn("select-bg");var hZ;const MRe={...(hZ=ni.baseStyle)==null?void 0:hZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:N1.reference,[N1.variable]:"colors.white",_dark:{[N1.variable]:"colors.gray.700"},"> option, > optgroup":{bg:N1.reference}},URe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},VRe=LRe({field:MRe,icon:URe}),D1={paddingInlineEnd:"8"};var pZ,fZ,mZ,gZ,_Z,yZ,EZ,vZ;const jRe={lg:{...(pZ=ni.sizes)==null?void 0:pZ.lg,field:{...(fZ=ni.sizes)==null?void 0:fZ.lg.field,...D1}},md:{...(mZ=ni.sizes)==null?void 0:mZ.md,field:{...(gZ=ni.sizes)==null?void 0:gZ.md.field,...D1}},sm:{...(_Z=ni.sizes)==null?void 0:_Z.sm,field:{...(yZ=ni.sizes)==null?void 0:yZ.sm.field,...D1}},xs:{...(EZ=ni.sizes)==null?void 0:EZ.xs,field:{...(vZ=ni.sizes)==null?void 0:vZ.xs.field,...D1},icon:{insetEnd:"1"}}},FRe=xRe({baseStyle:VRe,sizes:jRe,variants:ni.variants,defaultProps:ni.defaultProps}),BM=xn("skeleton-start-color"),WM=xn("skeleton-end-color"),BRe={[BM.variable]:"colors.gray.100",[WM.variable]:"colors.gray.400",_dark:{[BM.variable]:"colors.gray.800",[WM.variable]:"colors.gray.600"},background:BM.reference,borderColor:WM.reference,opacity:.7,borderRadius:"sm"},WRe={baseStyle:BRe},zM=xn("skip-link-bg"),zRe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[zM.variable]:"colors.white",_dark:{[zM.variable]:"colors.gray.700"},bg:zM.reference}},GRe={baseStyle:zRe},{defineMultiStyleConfig:HRe,definePartsStyle:Bk}=Li(kbe.keys),zy=xn("slider-thumb-size"),DC=xn("slider-track-size"),mg=xn("slider-bg"),$Re=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...eF({orientation:e,vertical:{h:"100%",px:Rf(zy.reference).divide(2).toString()},horizontal:{w:"100%",py:Rf(zy.reference).divide(2).toString()}})}},KRe=n=>({...eF({orientation:n.orientation,horizontal:{h:DC.reference},vertical:{w:DC.reference}}),overflow:"hidden",borderRadius:"sm",[mg.variable]:"colors.gray.200",_dark:{[mg.variable]:"colors.whiteAlpha.200"},_disabled:{[mg.variable]:"colors.gray.300",_dark:{[mg.variable]:"colors.whiteAlpha.300"}},bg:mg.reference}),qRe=n=>{const{orientation:e}=n;return{...eF({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:zy.reference,h:zy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},YRe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[mg.variable]:`colors.${e}.500`,_dark:{[mg.variable]:`colors.${e}.200`},bg:mg.reference}},XRe=Bk(n=>({container:$Re(n),track:KRe(n),thumb:qRe(n),filledTrack:YRe(n)})),JRe=Bk({container:{[zy.variable]:"sizes.4",[DC.variable]:"sizes.1"}}),QRe=Bk({container:{[zy.variable]:"sizes.3.5",[DC.variable]:"sizes.1"}}),ZRe=Bk({container:{[zy.variable]:"sizes.2.5",[DC.variable]:"sizes.0.5"}}),eIe={lg:JRe,md:QRe,sm:ZRe},tIe=HRe({baseStyle:XRe,sizes:eIe,defaultProps:{size:"md",colorScheme:"blue"}}),Iy=go("spinner-size"),nIe={width:[Iy.reference],height:[Iy.reference]},rIe={xs:{[Iy.variable]:"sizes.3"},sm:{[Iy.variable]:"sizes.4"},md:{[Iy.variable]:"sizes.6"},lg:{[Iy.variable]:"sizes.8"},xl:{[Iy.variable]:"sizes.12"}},iIe={baseStyle:nIe,sizes:rIe,defaultProps:{size:"md"}},{defineMultiStyleConfig:sIe,definePartsStyle:Aee}=Li(Nbe.keys),oIe={fontWeight:"medium"},aIe={opacity:.8,marginBottom:"2"},cIe={verticalAlign:"baseline",fontWeight:"semibold"},lIe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},uIe=Aee({container:{},label:oIe,helpText:aIe,number:cIe,icon:lIe}),dIe={md:Aee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},hIe=sIe({baseStyle:uIe,sizes:dIe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:pIe,definePartsStyle:$w}=Li(["stepper","step","title","description","indicator","separator","icon","number"]),Af=xn("stepper-indicator-size"),KS=xn("stepper-icon-size"),qS=xn("stepper-title-font-size"),Kw=xn("stepper-description-font-size"),bw=xn("stepper-accent-color"),fIe=$w(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[bw.variable]:`colors.${n}.500`,_dark:{[bw.variable]:`colors.${n}.200`}},title:{fontSize:qS.reference,fontWeight:"medium"},description:{fontSize:Kw.reference,color:"chakra-subtle-text"},number:{fontSize:qS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:KS.reference,height:KS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Af.reference,height:Af.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:bw.reference},"&[data-status=complete]":{bg:bw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:bw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Af.reference} - 8px)`,top:`calc(${Af.reference} + 4px)`,insetStart:`calc(${Af.reference} / 2 - 1px)`}}})),mIe=pIe({baseStyle:fIe,sizes:{xs:$w({stepper:{[Af.variable]:"sizes.4",[KS.variable]:"sizes.3",[qS.variable]:"fontSizes.xs",[Kw.variable]:"fontSizes.xs"}}),sm:$w({stepper:{[Af.variable]:"sizes.6",[KS.variable]:"sizes.4",[qS.variable]:"fontSizes.sm",[Kw.variable]:"fontSizes.xs"}}),md:$w({stepper:{[Af.variable]:"sizes.8",[KS.variable]:"sizes.5",[qS.variable]:"fontSizes.md",[Kw.variable]:"fontSizes.sm"}}),lg:$w({stepper:{[Af.variable]:"sizes.10",[KS.variable]:"sizes.6",[qS.variable]:"fontSizes.lg",[Kw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:gIe,definePartsStyle:_O}=Li(Dbe.keys),pC=go("switch-track-width"),My=go("switch-track-height"),GM=go("switch-track-diff"),_Ie=If.subtract(pC,My),gV=go("switch-thumb-x"),Tw=go("switch-bg"),yIe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[pC.reference],height:[My.reference],transitionProperty:"common",transitionDuration:"fast",[Tw.variable]:"colors.gray.300",_dark:{[Tw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Tw.variable]:`colors.${e}.500`,_dark:{[Tw.variable]:`colors.${e}.200`}},bg:Tw.reference}},EIe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[My.reference],height:[My.reference],_checked:{transform:`translateX(${gV.reference})`}},vIe=_O(n=>({container:{[GM.variable]:_Ie,[gV.variable]:GM.reference,_rtl:{[gV.variable]:If(GM).negate().toString()}},track:yIe(n),thumb:EIe})),SIe={sm:_O({container:{[pC.variable]:"1.375rem",[My.variable]:"sizes.3"}}),md:_O({container:{[pC.variable]:"1.875rem",[My.variable]:"sizes.4"}}),lg:_O({container:{[pC.variable]:"2.875rem",[My.variable]:"sizes.6"}})},bIe=gIe({baseStyle:vIe,sizes:SIe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:TIe,definePartsStyle:c0}=Li(xbe.keys),wIe=c0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),JO={"&[data-is-numeric=true]":{textAlign:"end"}},CIe=c0(n=>{const{colorScheme:e}=n;return{th:{color:Nn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...JO},td:{borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...JO},caption:{color:Nn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),RIe=c0(n=>{const{colorScheme:e}=n;return{th:{color:Nn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...JO},td:{borderBottom:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n),...JO},caption:{color:Nn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Nn(`${e}.100`,`${e}.700`)(n)},td:{background:Nn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),IIe={simple:CIe,striped:RIe,unstyled:{}},AIe={sm:c0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:c0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:c0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},PIe=TIe({baseStyle:wIe,variants:IIe,sizes:AIe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Qc=xn("tabs-color"),Fd=xn("tabs-bg"),x1=xn("tabs-border-color"),{defineMultiStyleConfig:OIe,definePartsStyle:sp}=Li(Lbe.keys),kIe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},NIe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},DIe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},xIe={p:4},LIe=sp(n=>({root:kIe(n),tab:NIe(n),tablist:DIe(n),tabpanel:xIe})),MIe={sm:sp({tab:{py:1,px:4,fontSize:"sm"}}),md:sp({tab:{fontSize:"md",py:2,px:4}}),lg:sp({tab:{fontSize:"lg",py:3,px:4}})},UIe=sp(n=>{const{colorScheme:e,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",u=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[Qc.variable]:`colors.${e}.600`,_dark:{[Qc.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Fd.variable]:"colors.gray.200",_dark:{[Fd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Qc.reference,bg:Fd.reference}}}),VIe=sp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[x1.variable]:"transparent",_selected:{[Qc.variable]:`colors.${e}.600`,[x1.variable]:"colors.white",_dark:{[Qc.variable]:`colors.${e}.300`,[x1.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:x1.reference},color:Qc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),jIe=sp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Fd.variable]:"colors.gray.50",_dark:{[Fd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Fd.variable]:"colors.white",[Qc.variable]:`colors.${e}.600`,_dark:{[Fd.variable]:"colors.gray.800",[Qc.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Qc.reference,bg:Fd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),FIe=sp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:ac(i,`${e}.700`),bg:ac(i,`${e}.100`)}}}}),BIe=sp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[Qc.variable]:"colors.gray.600",_dark:{[Qc.variable]:"inherit"},_selected:{[Qc.variable]:"colors.white",[Fd.variable]:`colors.${e}.600`,_dark:{[Qc.variable]:"colors.gray.800",[Fd.variable]:`colors.${e}.300`}},color:Qc.reference,bg:Fd.reference}}}),WIe=sp({}),zIe={line:UIe,enclosed:VIe,"enclosed-colored":jIe,"soft-rounded":FIe,"solid-rounded":BIe,unstyled:WIe},GIe=OIe({baseStyle:LIe,sizes:MIe,variants:zIe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:HIe,definePartsStyle:Uy}=Li(Mbe.keys),vq=xn("tag-bg"),Sq=xn("tag-color"),HM=xn("tag-shadow"),yO=xn("tag-min-height"),EO=xn("tag-min-width"),vO=xn("tag-font-size"),SO=xn("tag-padding-inline"),$Ie={fontWeight:"medium",lineHeight:1.2,outline:0,[Sq.variable]:Us.color.reference,[vq.variable]:Us.bg.reference,[HM.variable]:Us.shadow.reference,color:Sq.reference,bg:vq.reference,boxShadow:HM.reference,borderRadius:"md",minH:yO.reference,minW:EO.reference,fontSize:vO.reference,px:SO.reference,_focusVisible:{[HM.variable]:"shadows.outline"}},KIe={lineHeight:1.2,overflow:"visible"},qIe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},YIe=Uy({container:$Ie,label:KIe,closeButton:qIe}),XIe={sm:Uy({container:{[yO.variable]:"sizes.5",[EO.variable]:"sizes.5",[vO.variable]:"fontSizes.xs",[SO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Uy({container:{[yO.variable]:"sizes.6",[EO.variable]:"sizes.6",[vO.variable]:"fontSizes.sm",[SO.variable]:"space.2"}}),lg:Uy({container:{[yO.variable]:"sizes.8",[EO.variable]:"sizes.8",[vO.variable]:"fontSizes.md",[SO.variable]:"space.3"}})},JIe={subtle:Uy(n=>{var e;return{container:(e=uC.variants)==null?void 0:e.subtle(n)}}),solid:Uy(n=>{var e;return{container:(e=uC.variants)==null?void 0:e.solid(n)}}),outline:Uy(n=>{var e;return{container:(e=uC.variants)==null?void 0:e.outline(n)}})},QIe=HIe({variants:JIe,baseStyle:YIe,sizes:XIe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var SZ;const ZIe={...(SZ=ni.baseStyle)==null?void 0:SZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var bZ;const eAe={outline:n=>{var e;return((e=ni.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=ni.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=ni.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((bZ=ni.variants)==null?void 0:bZ.unstyled.field)??{}};var TZ,wZ,CZ,RZ;const tAe={xs:((TZ=ni.sizes)==null?void 0:TZ.xs.field)??{},sm:((wZ=ni.sizes)==null?void 0:wZ.sm.field)??{},md:((CZ=ni.sizes)==null?void 0:CZ.md.field)??{},lg:((RZ=ni.sizes)==null?void 0:RZ.lg.field)??{}},nAe={baseStyle:ZIe,sizes:tAe,variants:eAe,defaultProps:{size:"md",variant:"outline"}},L1=go("tooltip-bg"),$M=go("tooltip-fg"),rAe=go("popper-arrow-bg"),iAe={bg:L1.reference,color:$M.reference,[L1.variable]:"colors.gray.700",[$M.variable]:"colors.whiteAlpha.900",_dark:{[L1.variable]:"colors.gray.300",[$M.variable]:"colors.gray.900"},[rAe.variable]:L1.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},sAe={baseStyle:iAe},oAe={Accordion:Hbe,Alert:ATe,Avatar:jTe,Badge:uC,Breadcrumb:YTe,Button:iwe,Checkbox:fg,CloseButton:Ewe,Code:Twe,Container:Cwe,Divider:Owe,Drawer:Bwe,Editable:qwe,Form:eCe,FormError:oCe,FormLabel:cCe,Heading:dCe,Input:ni,Kbd:SCe,Link:TCe,List:ACe,Menu:jCe,Modal:XCe,NumberInput:sRe,PinInput:lRe,Popover:vRe,Progress:ARe,Radio:DRe,Select:FRe,Skeleton:WRe,SkipLink:GRe,Slider:tIe,Spinner:iIe,Stat:hIe,Switch:bIe,Table:PIe,Tabs:GIe,Tag:QIe,Textarea:nAe,Tooltip:sAe,Card:lwe,Stepper:mIe},aAe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},cAe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},lAe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},uAe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},dAe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},hAe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},pAe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},fAe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},mAe={property:hAe,easing:pAe,duration:fAe},gAe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},_Ae={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},yAe={breakpoints:cAe,zIndices:gAe,radii:uAe,blur:_Ae,colors:lAe,...Cee,sizes:Eee,shadows:dAe,space:yee,borders:aAe,transition:mAe},EAe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},vAe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},SAe=["borders","breakpoints","colors","components","config","direction","fonts","fontSizes","fontWeights","letterSpacings","lineHeights","radii","shadows","sizes","space","styles","transition","zIndices"];function bAe(n){return po(n)?SAe.every(e=>Object.prototype.hasOwnProperty.call(n,e)):!1}const TAe="ltr",wAe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},Pee={semanticTokens:EAe,direction:TAe,...yAe,components:oAe,styles:vAe,config:wAe};function CAe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function RAe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var IAe=function(){function n(i){var a=this;this._insertTag=function(l){var u;a.tags.length===0?a.insertionPoint?u=a.insertionPoint.nextSibling:a.prepend?u=a.container.firstChild:u=a.before:u=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,u),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(a){a.forEach(this._insertTag)},e.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(RAe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=CAe(l);try{u.insertRule(a,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},e.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),Da="-ms-",QO="-moz-",ei="-webkit-",Oee="comm",iF="rule",sF="decl",AAe="@import",kee="@keyframes",PAe="@layer",OAe=Math.abs,Wk=String.fromCharCode,kAe=Object.assign;function NAe(n,e){return oa(n,0)^45?(((e<<2^oa(n,0))<<2^oa(n,1))<<2^oa(n,2))<<2^oa(n,3):0}function Nee(n){return n.trim()}function DAe(n,e){return(n=e.exec(n))?n[0]:n}function ti(n,e,i){return n.replace(e,i)}function _V(n,e){return n.indexOf(e)}function oa(n,e){return n.charCodeAt(e)|0}function xC(n,e,i){return n.slice(e,i)}function Qh(n){return n.length}function oF(n){return n.length}function M1(n,e){return e.push(n),n}function xAe(n,e){return n.map(e).join("")}var zk=1,b0=1,Dee=0,sl=0,qs=0,K0="";function Gk(n,e,i,a,l,u,f){return{value:n,root:e,parent:i,type:a,props:l,children:u,line:zk,column:b0,length:f,return:""}}function ww(n,e){return kAe(Gk("",null,null,"",null,null,0),n,{length:-n.length},e)}function LAe(){return qs}function MAe(){return qs=sl>0?oa(K0,--sl):0,b0--,qs===10&&(b0=1,zk--),qs}function Fl(){return qs=sl<Dee?oa(K0,sl++):0,b0++,qs===10&&(b0=1,zk++),qs}function op(){return oa(K0,sl)}function bO(){return sl}function fR(n,e){return xC(K0,n,e)}function LC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function xee(n){return zk=b0=1,Dee=Qh(K0=n),sl=0,[]}function Lee(n){return K0="",n}function TO(n){return Nee(fR(sl-1,yV(n===91?n+2:n===40?n+1:n)))}function UAe(n){for(;(qs=op())&&qs<33;)Fl();return LC(n)>2||LC(qs)>3?"":" "}function VAe(n,e){for(;--e&&Fl()&&!(qs<48||qs>102||qs>57&&qs<65||qs>70&&qs<97););return fR(n,bO()+(e<6&&op()==32&&Fl()==32))}function yV(n){for(;Fl();)switch(qs){case n:return sl;case 34:case 39:n!==34&&n!==39&&yV(qs);break;case 40:n===41&&yV(n);break;case 92:Fl();break}return sl}function jAe(n,e){for(;Fl()&&n+qs!==57;)if(n+qs===84&&op()===47)break;return"/*"+fR(e,sl-1)+"*"+Wk(n===47?n:Fl())}function FAe(n){for(;!LC(op());)Fl();return fR(n,sl)}function BAe(n){return Lee(wO("",null,null,null,[""],n=xee(n),0,[0],n))}function wO(n,e,i,a,l,u,f,_,E){for(var S=0,w=0,I=f,k=0,U=0,L=0,F=1,B=1,q=1,$=0,X="",oe=l,re=u,pe=a,te=X;B;)switch(L=$,$=Fl()){case 40:if(L!=108&&oa(te,I-1)==58){_V(te+=ti(TO($),"&","&\f"),"&\f")!=-1&&(q=-1);break}case 34:case 39:case 91:te+=TO($);break;case 9:case 10:case 13:case 32:te+=UAe(L);break;case 92:te+=VAe(bO()-1,7);continue;case 47:switch(op()){case 42:case 47:M1(WAe(jAe(Fl(),bO()),e,i),E);break;default:te+="/"}break;case 123*F:_[S++]=Qh(te)*q;case 125*F:case 59:case 0:switch($){case 0:case 125:B=0;case 59+w:q==-1&&(te=ti(te,/\f/g,"")),U>0&&Qh(te)-I&&M1(U>32?Tq(te+";",a,i,I-1):Tq(ti(te," ","")+";",a,i,I-2),E);break;case 59:te+=";";default:if(M1(pe=bq(te,e,i,S,w,l,_,X,oe=[],re=[],I),u),$===123)if(w===0)wO(te,e,pe,pe,oe,u,I,_,re);else switch(k===99&&oa(te,3)===110?100:k){case 100:case 108:case 109:case 115:wO(n,pe,pe,a&&M1(bq(n,pe,pe,0,0,l,_,X,l,oe=[],I),re),l,re,I,_,a?oe:re);break;default:wO(te,pe,pe,pe,[""],re,0,_,re)}}S=w=U=0,F=q=1,X=te="",I=f;break;case 58:I=1+Qh(te),U=L;default:if(F<1){if($==123)--F;else if($==125&&F++==0&&MAe()==125)continue}switch(te+=Wk($),$*F){case 38:q=w>0?1:(te+="\f",-1);break;case 44:_[S++]=(Qh(te)-1)*q,q=1;break;case 64:op()===45&&(te+=TO(Fl())),k=op(),w=I=Qh(X=te+=FAe(bO())),$++;break;case 45:L===45&&Qh(te)==2&&(F=0)}}return u}function bq(n,e,i,a,l,u,f,_,E,S,w){for(var I=l-1,k=l===0?u:[""],U=oF(k),L=0,F=0,B=0;L<a;++L)for(var q=0,$=xC(n,I+1,I=OAe(F=f[L])),X=n;q<U;++q)(X=Nee(F>0?k[q]+" "+$:ti($,/&\f/g,k[q])))&&(E[B++]=X);return Gk(n,e,i,l===0?iF:_,E,S,w)}function WAe(n,e,i){return Gk(n,e,i,Oee,Wk(LAe()),xC(n,2,-2),0)}function Tq(n,e,i,a){return Gk(n,e,i,sF,xC(n,0,a),xC(n,a+1,-1),a)}function l0(n,e){for(var i="",a=oF(n),l=0;l<a;l++)i+=e(n[l],l,n,e)||"";return i}function zAe(n,e,i,a){switch(n.type){case PAe:if(n.children.length)break;case AAe:case sF:return n.return=n.return||n.value;case Oee:return"";case kee:return n.return=n.value+"{"+l0(n.children,a)+"}";case iF:n.value=n.props.join(",")}return Qh(i=l0(n.children,a))?n.return=n.value+"{"+i+"}":""}function GAe(n){var e=oF(n);return function(i,a,l,u){for(var f="",_=0;_<e;_++)f+=n[_](i,a,l,u)||"";return f}}function HAe(n){return function(e){e.root||(e=e.return)&&n(e)}}var wq=function(e){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=e(a);return i.set(a,l),l}};function Mee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var $Ae=function(e,i,a){for(var l=0,u=0;l=u,u=op(),l===38&&u===12&&(i[a]=1),!LC(u);)Fl();return fR(e,sl)},KAe=function(e,i){var a=-1,l=44;do switch(LC(l)){case 0:l===38&&op()===12&&(i[a]=1),e[a]+=$Ae(sl-1,i,a);break;case 2:e[a]+=TO(l);break;case 4:if(l===44){e[++a]=op()===58?"&\f":"",i[a]=e[a].length;break}default:e[a]+=Wk(l)}while(l=Fl());return e},qAe=function(e,i){return Lee(KAe(xee(e),i))},Cq=new WeakMap,YAe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,a=e.parent,l=e.column===a.column&&e.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!Cq.get(a))&&!l){Cq.set(e,!0);for(var u=[],f=qAe(i,u),_=a.props,E=0,S=0;E<f.length;E++)for(var w=0;w<_.length;w++,S++)e.props[S]=u[E]?f[E].replace(/&\f/g,_[w]):_[w]+" "+f[E]}}},XAe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Uee(n,e){switch(NAe(n,e)){case 5103:return ei+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ei+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ei+n+QO+n+Da+n+n;case 6828:case 4268:return ei+n+Da+n+n;case 6165:return ei+n+Da+"flex-"+n+n;case 5187:return ei+n+ti(n,/(\w+).+(:[^]+)/,ei+"box-$1$2"+Da+"flex-$1$2")+n;case 5443:return ei+n+Da+"flex-item-"+ti(n,/flex-|-self/,"")+n;case 4675:return ei+n+Da+"flex-line-pack"+ti(n,/align-content|flex-|-self/,"")+n;case 5548:return ei+n+Da+ti(n,"shrink","negative")+n;case 5292:return ei+n+Da+ti(n,"basis","preferred-size")+n;case 6060:return ei+"box-"+ti(n,"-grow","")+ei+n+Da+ti(n,"grow","positive")+n;case 4554:return ei+ti(n,/([^-])(transform)/g,"$1"+ei+"$2")+n;case 6187:return ti(ti(ti(n,/(zoom-|grab)/,ei+"$1"),/(image-set)/,ei+"$1"),n,"")+n;case 5495:case 3959:return ti(n,/(image-set\([^]*)/,ei+"$1$`$1");case 4968:return ti(ti(n,/(.+:)(flex-)?(.*)/,ei+"box-pack:$3"+Da+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ei+n+n;case 4095:case 3583:case 4068:case 2532:return ti(n,/(.+)-inline(.+)/,ei+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Qh(n)-1-e>6)switch(oa(n,e+1)){case 109:if(oa(n,e+4)!==45)break;case 102:return ti(n,/(.+:)(.+)-([^]+)/,"$1"+ei+"$2-$3$1"+QO+(oa(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~_V(n,"stretch")?Uee(ti(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(oa(n,e+1)!==115)break;case 6444:switch(oa(n,Qh(n)-3-(~_V(n,"!important")&&10))){case 107:return ti(n,":",":"+ei)+n;case 101:return ti(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ei+(oa(n,14)===45?"inline-":"")+"box$3$1"+ei+"$2$3$1"+Da+"$2box$3")+n}break;case 5936:switch(oa(n,e+11)){case 114:return ei+n+Da+ti(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ei+n+Da+ti(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ei+n+Da+ti(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ei+n+Da+n+n}return n}var JAe=function(e,i,a,l){if(e.length>-1&&!e.return)switch(e.type){case sF:e.return=Uee(e.value,e.length);break;case kee:return l0([ww(e,{value:ti(e.value,"@","@"+ei)})],l);case iF:if(e.length)return xAe(e.props,function(u){switch(DAe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return l0([ww(e,{props:[ti(u,/:(read-\w+)/,":"+QO+"$1")]})],l);case"::placeholder":return l0([ww(e,{props:[ti(u,/:(plac\w+)/,":"+ei+"input-$1")]}),ww(e,{props:[ti(u,/:(plac\w+)/,":"+QO+"$1")]}),ww(e,{props:[ti(u,/:(plac\w+)/,Da+"input-$1")]})],l)}return""})}},QAe=[JAe],ZAe=function(e){var i=e.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(F){var B=F.getAttribute("data-emotion");B.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var l=e.stylisPlugins||QAe,u={},f,_=[];f=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(F){for(var B=F.getAttribute("data-emotion").split(" "),q=1;q<B.length;q++)u[B[q]]=!0;_.push(F)});var E,S=[YAe,XAe];{var w,I=[zAe,HAe(function(F){w.insert(F)})],k=GAe(S.concat(l,I)),U=function(B){return l0(BAe(B),k)};E=function(B,q,$,X){w=$,U(B?B+"{"+q.styles+"}":q.styles),X&&(L.inserted[q.name]=!0)}}var L={key:i,sheet:new IAe({key:i,container:f,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:E};return L.sheet.hydrate(_),L};function Gy(){return Gy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Gy.apply(null,arguments)}var KM={exports:{}},li={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rq;function ePe(){if(Rq)return li;Rq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,S=n?Symbol.for("react.concurrent_mode"):60111,w=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,k=n?Symbol.for("react.suspense_list"):60120,U=n?Symbol.for("react.memo"):60115,L=n?Symbol.for("react.lazy"):60116,F=n?Symbol.for("react.block"):60121,B=n?Symbol.for("react.fundamental"):60117,q=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function X(re){if(typeof re=="object"&&re!==null){var pe=re.$$typeof;switch(pe){case e:switch(re=re.type,re){case E:case S:case a:case u:case l:case I:return re;default:switch(re=re&&re.$$typeof,re){case _:case w:case L:case U:case f:return re;default:return pe}}case i:return pe}}}function oe(re){return X(re)===S}return li.AsyncMode=E,li.ConcurrentMode=S,li.ContextConsumer=_,li.ContextProvider=f,li.Element=e,li.ForwardRef=w,li.Fragment=a,li.Lazy=L,li.Memo=U,li.Portal=i,li.Profiler=u,li.StrictMode=l,li.Suspense=I,li.isAsyncMode=function(re){return oe(re)||X(re)===E},li.isConcurrentMode=oe,li.isContextConsumer=function(re){return X(re)===_},li.isContextProvider=function(re){return X(re)===f},li.isElement=function(re){return typeof re=="object"&&re!==null&&re.$$typeof===e},li.isForwardRef=function(re){return X(re)===w},li.isFragment=function(re){return X(re)===a},li.isLazy=function(re){return X(re)===L},li.isMemo=function(re){return X(re)===U},li.isPortal=function(re){return X(re)===i},li.isProfiler=function(re){return X(re)===u},li.isStrictMode=function(re){return X(re)===l},li.isSuspense=function(re){return X(re)===I},li.isValidElementType=function(re){return typeof re=="string"||typeof re=="function"||re===a||re===S||re===u||re===l||re===I||re===k||typeof re=="object"&&re!==null&&(re.$$typeof===L||re.$$typeof===U||re.$$typeof===f||re.$$typeof===_||re.$$typeof===w||re.$$typeof===B||re.$$typeof===q||re.$$typeof===$||re.$$typeof===F)},li.typeOf=X,li}var Iq;function tPe(){return Iq||(Iq=1,KM.exports=ePe()),KM.exports}var qM,Aq;function nPe(){if(Aq)return qM;Aq=1;var n=tPe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=a,u[n.Memo]=l;function f(L){return n.isMemo(L)?l:u[L.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,S=Object.getOwnPropertySymbols,w=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,k=Object.prototype;function U(L,F,B){if(typeof F!="string"){if(k){var q=I(F);q&&q!==k&&U(L,q,B)}var $=E(F);S&&($=$.concat(S(F)));for(var X=f(L),oe=f(F),re=0;re<$.length;++re){var pe=$[re];if(!i[pe]&&!(B&&B[pe])&&!(oe&&oe[pe])&&!(X&&X[pe])){var te=w(F,pe);try{_(L,pe,te)}catch{}}}}return L}return qM=U,qM}nPe();var rPe=!0;function Vee(n,e,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(a+=l+" ")}),a}var aF=function(e,i,a){var l=e.key+"-"+i.name;(a===!1||rPe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},cF=function(e,i,a){aF(e,i,a);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function iPe(n){for(var e=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(a+2)&255)<<16;case 2:e^=(n.charCodeAt(a+1)&255)<<8;case 1:e^=n.charCodeAt(a)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var sPe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},oPe=/[A-Z]|^ms/g,aPe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,jee=function(e){return e.charCodeAt(1)===45},Pq=function(e){return e!=null&&typeof e!="boolean"},YM=Mee(function(n){return jee(n)?n:n.replace(oPe,"-$&").toLowerCase()}),Oq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(aPe,function(a,l,u){return Zh={name:l,styles:u,next:Zh},l})}return sPe[e]!==1&&!jee(e)&&typeof i=="number"&&i!==0?i+"px":i};function MC(n,e,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Zh={name:l.name,styles:l.styles,next:Zh},l.name;var u=i;if(u.styles!==void 0){var f=u.next;if(f!==void 0)for(;f!==void 0;)Zh={name:f.name,styles:f.styles,next:Zh},f=f.next;var _=u.styles+";";return _}return cPe(n,e,i)}case"function":{if(n!==void 0){var E=Zh,S=i(n);return Zh=E,MC(n,e,S)}break}}var w=i;if(e==null)return w;var I=e[w];return I!==void 0?I:w}function cPe(n,e,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=MC(n,e,i[l])+";";else for(var u in i){var f=i[u];if(typeof f!="object"){var _=f;e!=null&&e[_]!==void 0?a+=u+"{"+e[_]+"}":Pq(_)&&(a+=YM(u)+":"+Oq(u,_)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(e==null||e[f[0]]===void 0))for(var E=0;E<f.length;E++)Pq(f[E])&&(a+=YM(u)+":"+Oq(u,f[E])+";");else{var S=MC(n,e,f);switch(u){case"animation":case"animationName":{a+=YM(u)+":"+S+";";break}default:a+=u+"{"+S+"}"}}}return a}var kq=/label:\s*([^\s;{]+)\s*(;|$)/g,Zh;function Hk(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Zh=void 0;var u=n[0];if(u==null||u.raw===void 0)a=!1,l+=MC(i,e,u);else{var f=u;l+=f[0]}for(var _=1;_<n.length;_++)if(l+=MC(i,e,n[_]),a){var E=u;l+=E[_]}kq.lastIndex=0;for(var S="",w;(w=kq.exec(l))!==null;)S+="-"+w[1];var I=iPe(l)+S;return{name:I,styles:l,next:Zh}}var lPe=function(e){return e()},Fee=eV.useInsertionEffect?eV.useInsertionEffect:!1,Bee=Fee||lPe,Nq=Fee||D.useLayoutEffect,lF=D.createContext(typeof HTMLElement<"u"?ZAe({key:"css"}):null);lF.Provider;var uPe=function(){return D.useContext(lF)},uF=function(e){return D.forwardRef(function(i,a){var l=D.useContext(lF);return e(i,l,a)})},T0=D.createContext({}),dPe=function(e,i){if(typeof i=="function"){var a=i(e);return a}return Gy({},e,i)},hPe=wq(function(n){return wq(function(e){return dPe(n,e)})}),pPe=function(e){var i=D.useContext(T0);return e.theme!==i&&(i=hPe(i)(e.theme)),D.createElement(T0.Provider,{value:i},e.children)},dF={}.hasOwnProperty,EV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",fPe=function(e,i){var a={};for(var l in i)dF.call(i,l)&&(a[l]=i[l]);return a[EV]=e,a},mPe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return aF(i,a,l),Bee(function(){return cF(i,a,l)}),null},gPe=uF(function(n,e,i){var a=n.css;typeof a=="string"&&e.registered[a]!==void 0&&(a=e.registered[a]);var l=n[EV],u=[a],f="";typeof n.className=="string"?f=Vee(e.registered,u,n.className):n.className!=null&&(f=n.className+" ");var _=Hk(u,void 0,D.useContext(T0));f+=e.key+"-"+_.name;var E={};for(var S in n)dF.call(n,S)&&S!=="css"&&S!==EV&&(E[S]=n[S]);return E.className=f,i&&(E.ref=i),D.createElement(D.Fragment,null,D.createElement(mPe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),D.createElement(l,E))}),_Pe=gPe,Dq=function(e,i){var a=arguments;if(i==null||!dF.call(i,"css"))return D.createElement.apply(void 0,a);var l=a.length,u=new Array(l);u[0]=_Pe,u[1]=fPe(e,i);for(var f=2;f<l;f++)u[f]=a[f];return D.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(Dq||(Dq={}));var $k=uF(function(n,e){var i=n.styles,a=Hk([i],void 0,D.useContext(T0)),l=D.useRef();return Nq(function(){var u=e.key+"-global",f=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+u+" "+a.name+'"]');return e.sheet.tags.length&&(f.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",u),f.hydrate([E])),l.current=[f,_],function(){f.flush()}},[e]),Nq(function(){var u=l.current,f=u[0],_=u[1];if(_){u[1]=!1;return}if(a.next!==void 0&&cF(e,a.next,!0),f.tags.length){var E=f.tags[f.tags.length-1].nextElementSibling;f.before=E,f.flush()}e.insert("",a,f,!1)},[e,a.name]),null});function yPe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return Hk(e)}function mR(){var n=yPe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const hF=D.createContext({});hF.displayName="ColorModeContext";function Kk(){const n=D.useContext(hF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Of(n,e){const{colorMode:i}=Kk();return i==="dark"?e:n}const U1={light:"chakra-ui-light",dark:"chakra-ui-dark"};function EPe(n={}){const{preventTransition:e=!0,nonce:i}=n,a={setDataset:l=>{const u=e?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?U1.dark:U1.light),document.body.classList.remove(l?U1.light:U1.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=a.query(),f=_=>{l(_.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(f):u.addEventListener("change",f),()=>{typeof u.removeListener=="function"?u.removeListener(f):u.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const vPe="chakra-ui-color-mode";function SPe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const bPe=SPe(vPe),xq=()=>{},TPe=Bve()?D.useLayoutEffect:D.useEffect;function Lq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Wee=function(e){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:f}={},colorModeManager:_=bPe}=e,E=uPe(),S=u==="dark"?"dark":"light",[w,I]=D.useState(()=>Lq(_,S)),[k,U]=D.useState(()=>Lq(_)),{getSystemTheme:L,setClassName:F,setDataset:B,addListener:q}=D.useMemo(()=>EPe({preventTransition:f,nonce:E==null?void 0:E.nonce}),[f,E==null?void 0:E.nonce]),$=u==="system"&&!w?k:w,X=D.useCallback(pe=>{const te=pe==="system"?L():pe;I(te),F(te==="dark"),B(te),_.set(te)},[_,L,F,B]);TPe(()=>{u==="system"&&U(L())},[]),D.useEffect(()=>{const pe=_.get();if(pe){X(pe);return}if(u==="system"){X("system");return}X(S)},[_,S,u,X]);const oe=D.useCallback(()=>{X($==="dark"?"light":"dark")},[$,X]);D.useEffect(()=>{if(l)return q(X)},[l,q,X]);const re=D.useMemo(()=>({colorMode:i??$,toggleColorMode:i?xq:oe,setColorMode:i?xq:X,forced:i!==void 0}),[$,oe,X,i]);return b.jsx(hF.Provider,{value:re,children:a})};Wee.displayName="ColorModeProvider";const zee=String.raw,Gee=zee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,wPe=()=>b.jsx($k,{styles:Gee}),CPe=({scope:n=""})=>b.jsx($k,{styles:zee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${Gee}
    `});function RPe(n){const{cssVarsRoot:e,theme:i,children:a}=n,l=D.useMemo(()=>hbe(i),[i]);return b.jsxs(pPe,{theme:l,children:[b.jsx(IPe,{root:e}),a]})}function IPe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return b.jsx($k,{styles:i=>({[e]:i.__cssVars})})}Ni({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function APe(n){return Ni({name:`${n}StylesContext`,errorMessage:`useStyles: "styles" is undefined. Seems you forgot to wrap the components in "<${n} />" `})}function PPe(){const{colorMode:n}=Kk();return b.jsx($k,{styles:e=>{const i=qZ(e,"styles.global"),a=el(i,{theme:e,colorMode:n});return a?fee(a)(e):void 0}})}const[OPe,kPe]=Ni({strict:!1,name:"PortalManagerContext"});function pF(n){const{children:e,zIndex:i}=n;return b.jsx(OPe,{value:{zIndex:i},children:e})}pF.displayName="PortalManager";const fF=D.createContext({getDocument(){return document},getWindow(){return window}});fF.displayName="EnvironmentContext";function NPe({defer:n}={}){const[,e]=D.useReducer(i=>i+1,0);return Mf(()=>{n&&e()},[n]),D.useContext(fF)}function Hee(n){const{children:e,environment:i,disabled:a}=n,l=D.useRef(null),u=D.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),f=!a||!i;return b.jsxs(fF.Provider,{value:u,children:[e,f&&b.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Hee.displayName="EnvironmentProvider";const DPe=n=>{const{children:e,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:u=!0,theme:f={},environment:_,cssVarsRoot:E,disableEnvironment:S,disableGlobalStyle:w}=n,I=b.jsx(Hee,{environment:_,disabled:S,children:e});return b.jsx(RPe,{theme:f,cssVarsRoot:E,children:b.jsxs(Wee,{colorModeManager:i,options:f.config,children:[u?b.jsx(CPe,{scope:l}):b.jsx(wPe,{}),!w&&b.jsx(PPe,{}),a?b.jsx(pF,{zIndex:a,children:I}):I]})})},mF=D.createContext({});function gF(n){const e=D.useRef(null);return e.current===null&&(e.current=n()),e.current}const gR=D.createContext(null),_F=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class xPe extends D.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function LPe({children:n,isPresent:e}){const i=D.useId(),a=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=D.useContext(_F);return D.useInsertionEffect(()=>{const{width:f,height:_,top:E,left:S}=l.current;if(e||!a.current||!f||!_)return;a.current.dataset.motionPopId=i;const w=document.createElement("style");return u&&(w.nonce=u),document.head.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${S}px !important;
          }
        `),()=>{document.head.removeChild(w)}},[e]),b.jsx(xPe,{isPresent:e,childRef:a,sizeRef:l,children:D.cloneElement(n,{ref:a})})}const MPe=({children:n,initial:e,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:u,mode:f})=>{const _=gF(UPe),E=D.useId(),S=D.useCallback(I=>{_.set(I,!0);for(const k of _.values())if(!k)return;a&&a()},[_,a]),w=D.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:S,register:I=>(_.set(I,!1),()=>_.delete(I))}),u?[Math.random(),S]:[i,S]);return D.useMemo(()=>{_.forEach((I,k)=>_.set(k,!1))},[i]),D.useEffect(()=>{!i&&!_.size&&a&&a()},[i]),f==="popLayout"&&(n=b.jsx(LPe,{isPresent:i,children:n})),b.jsx(gR.Provider,{value:w,children:n})};function UPe(){return new Map}function yF(n=!0){const e=D.useContext(gR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=e,u=D.useId();D.useEffect(()=>{n&&l(u)},[n]);const f=D.useCallback(()=>n&&a&&a(u),[u,a,n]);return!i&&a?[!1,f]:[!0]}function VPe(){return jPe(D.useContext(gR))}function jPe(n){return n===null?!0:n.isPresent}const V1=n=>n.key||"";function Mq(n){const e=[];return D.Children.forEach(n,i=>{D.isValidElement(i)&&e.push(i)}),e}const EF=typeof window<"u",$ee=EF?D.useLayoutEffect:D.useEffect,iE=({children:n,custom:e,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:u="sync",propagate:f=!1})=>{const[_,E]=yF(f),S=D.useMemo(()=>Mq(n),[n]),w=f&&!_?[]:S.map(V1),I=D.useRef(!0),k=D.useRef(S),U=gF(()=>new Map),[L,F]=D.useState(S),[B,q]=D.useState(S);$ee(()=>{I.current=!1,k.current=S;for(let oe=0;oe<B.length;oe++){const re=V1(B[oe]);w.includes(re)?U.delete(re):U.get(re)!==!0&&U.set(re,!1)}},[B,w.length,w.join("-")]);const $=[];if(S!==L){let oe=[...S];for(let re=0;re<B.length;re++){const pe=B[re],te=V1(pe);w.includes(te)||(oe.splice(re,0,pe),$.push(pe))}u==="wait"&&$.length&&(oe=$),q(Mq(oe)),F(S);return}const{forceRender:X}=D.useContext(mF);return b.jsx(b.Fragment,{children:B.map(oe=>{const re=V1(oe),pe=f&&!_?!1:S===B||w.includes(re),te=()=>{if(U.has(re))U.set(re,!0);else return;let Z=!0;U.forEach(ne=>{ne||(Z=!1)}),Z&&(X==null||X(),q(k.current),f&&(E==null||E()),a&&a())};return b.jsx(MPe,{isPresent:pe,initial:!I.current||i?void 0:!1,custom:pe?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:pe?void 0:te,children:oe},re)})})},Bl=n=>n;let Kee=Bl;function vF(n){let e;return()=>(e===void 0&&(e=n()),e)}const w0=(n,e,i)=>{const a=e-n;return a===0?1:(i-n)/a},Vf=n=>n*1e3,jf=n=>n/1e3,FPe={useManualTiming:!1};function BPe(n){let e=new Set,i=new Set,a=!1,l=!1;const u=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function _(S){u.has(S)&&(E.schedule(S),n()),S(f)}const E={schedule:(S,w=!1,I=!1)=>{const U=I&&a?e:i;return w&&u.add(S),U.has(S)||U.add(S),S},cancel:S=>{i.delete(S),u.delete(S)},process:S=>{if(f=S,a){l=!0;return}a=!0,[e,i]=[i,e],e.forEach(_),e.clear(),a=!1,l&&(l=!1,E.process(S))}};return E}const j1=["read","resolveKeyframes","update","preRender","render","postRender"],WPe=40;function qee(n,e){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,f=j1.reduce((q,$)=>(q[$]=BPe(u),q),{}),{read:_,resolveKeyframes:E,update:S,preRender:w,render:I,postRender:k}=f,U=()=>{const q=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(q-l.timestamp,WPe),1),l.timestamp=q,l.isProcessing=!0,_.process(l),E.process(l),S.process(l),w.process(l),I.process(l),k.process(l),l.isProcessing=!1,i&&e&&(a=!1,n(U))},L=()=>{i=!0,a=!0,l.isProcessing||n(U)};return{schedule:j1.reduce((q,$)=>{const X=f[$];return q[$]=(oe,re=!1,pe=!1)=>(i||L(),X.schedule(oe,re,pe)),q},{}),cancel:q=>{for(let $=0;$<j1.length;$++)f[j1[$]].cancel(q)},state:l,steps:f}}const{schedule:Yi,cancel:xg,state:ia,steps:XM}=qee(typeof requestAnimationFrame<"u"?requestAnimationFrame:Bl,!0),Yee=D.createContext({strict:!1}),Uq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},C0={};for(const n in Uq)C0[n]={isEnabled:e=>Uq[n].some(i=>!!e[i])};function zPe(n){for(const e in n)C0[e]={...C0[e],...n[e]}}const GPe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ZO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||GPe.has(n)}let Xee=n=>!ZO(n);function HPe(n){n&&(Xee=e=>e.startsWith("on")?!ZO(e):n(e))}try{HPe(require("@emotion/is-prop-valid").default)}catch{}function $Pe(n,e,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(Xee(l)||i===!0&&ZO(l)||!e&&!ZO(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function KPe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const qk=D.createContext({});function UC(n){return typeof n=="string"||Array.isArray(n)}function Yk(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const SF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],bF=["initial",...SF];function Xk(n){return Yk(n.animate)||bF.some(e=>UC(n[e]))}function Jee(n){return!!(Xk(n)||n.variants)}function qPe(n,e){if(Xk(n)){const{initial:i,animate:a}=n;return{initial:i===!1||UC(i)?i:void 0,animate:UC(a)?a:void 0}}return n.inherit!==!1?e:{}}function YPe(n){const{initial:e,animate:i}=qPe(n,D.useContext(qk));return D.useMemo(()=>({initial:e,animate:i}),[Vq(e),Vq(i)])}function Vq(n){return Array.isArray(n)?n.join(" "):n}const XPe=Symbol.for("motionComponentSymbol");function YS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function JPe(n,e,i){return D.useCallback(a=>{a&&n.onMount&&n.onMount(a),e&&(a?e.mount(a):e.unmount()),i&&(typeof i=="function"?i(a):YS(i)&&(i.current=a))},[e])}const TF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),QPe="framerAppearId",Qee="data-"+TF(QPe),{schedule:wF}=qee(queueMicrotask,!1),Zee=D.createContext({});function ZPe(n,e,i,a,l){var u,f;const{visualElement:_}=D.useContext(qk),E=D.useContext(Yee),S=D.useContext(gR),w=D.useContext(_F).reducedMotion,I=D.useRef(null);a=a||E.renderer,!I.current&&a&&(I.current=a(n,{visualState:e,parent:_,props:i,presenceContext:S,blockInitialAnimation:S?S.initial===!1:!1,reducedMotionConfig:w}));const k=I.current,U=D.useContext(Zee);k&&!k.projection&&l&&(k.type==="html"||k.type==="svg")&&e1e(I.current,i,l,U);const L=D.useRef(!1);D.useInsertionEffect(()=>{k&&L.current&&k.update(i,S)});const F=i[Qee],B=D.useRef(!!F&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,F))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,F)));return $ee(()=>{k&&(L.current=!0,window.MotionIsMounted=!0,k.updateFeatures(),wF.render(k.render),B.current&&k.animationState&&k.animationState.animateChanges())}),D.useEffect(()=>{k&&(!B.current&&k.animationState&&k.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{var q;(q=window.MotionHandoffMarkAsComplete)===null||q===void 0||q.call(window,F)}),B.current=!1))}),k}function e1e(n,e,i,a){const{layoutId:l,layout:u,drag:f,dragConstraints:_,layoutScroll:E,layoutRoot:S}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:ete(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!f||_&&YS(_),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:a,layoutScroll:E,layoutRoot:S})}function ete(n){if(n)return n.options.allowProjection!==!1?n.projection:ete(n.parent)}function t1e({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:a,Component:l}){var u,f;n&&zPe(n);function _(S,w){let I;const k={...D.useContext(_F),...S,layoutId:n1e(S)},{isStatic:U}=k,L=YPe(S),F=a(S,U);if(!U&&EF){r1e();const B=i1e(k);I=B.MeasureLayout,L.visualElement=ZPe(l,F,k,e,B.ProjectionNode)}return b.jsxs(qk.Provider,{value:L,children:[I&&L.visualElement?b.jsx(I,{visualElement:L.visualElement,...k}):null,i(l,S,JPe(F,L.visualElement,w),F,U,L.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(f=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&f!==void 0?f:""})`}`;const E=D.forwardRef(_);return E[XPe]=l,E}function n1e({layoutId:n}){const e=D.useContext(mF).id;return e&&n!==void 0?e+"-"+n:n}function r1e(n,e){D.useContext(Yee).strict}function i1e(n){const{drag:e,layout:i}=C0;if(!e&&!i)return{};const a={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const s1e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function CF(n){return typeof n!="string"||n.includes("-")?!1:!!(s1e.indexOf(n)>-1||/[A-Z]/u.test(n))}function jq(n){const e=[{},{}];return n==null||n.values.forEach((i,a)=>{e[0][a]=i.get(),e[1][a]=i.getVelocity()}),e}function RF(n,e,i,a){if(typeof e=="function"){const[l,u]=jq(a);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=jq(a);e=e(i!==void 0?i:n.custom,l,u)}return e}const vV=n=>Array.isArray(n),o1e=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),a1e=n=>vV(n)?n[n.length-1]||0:n,Ua=n=>!!(n&&n.getVelocity);function CO(n){const e=Ua(n)?n.get():n;return o1e(e)?e.toValue():e}function c1e({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},a,l,u){const f={latestValues:l1e(a,l,u,n),renderState:e()};return i&&(f.onMount=_=>i({props:a,current:_,...f}),f.onUpdate=_=>i(_)),f}const tte=n=>(e,i)=>{const a=D.useContext(qk),l=D.useContext(gR),u=()=>c1e(n,e,a,l);return i?u():gF(u)};function l1e(n,e,i,a){const l={},u=a(n,{});for(const k in u)l[k]=CO(u[k]);let{initial:f,animate:_}=n;const E=Xk(n),S=Jee(n);e&&S&&!E&&n.inherit!==!1&&(f===void 0&&(f=e.initial),_===void 0&&(_=e.animate));let w=i?i.initial===!1:!1;w=w||f===!1;const I=w?_:f;if(I&&typeof I!="boolean"&&!Yk(I)){const k=Array.isArray(I)?I:[I];for(let U=0;U<k.length;U++){const L=RF(n,k[U]);if(L){const{transitionEnd:F,transition:B,...q}=L;for(const $ in q){let X=q[$];if(Array.isArray(X)){const oe=w?X.length-1:0;X=X[oe]}X!==null&&(l[$]=X)}for(const $ in F)l[$]=F[$]}}}return l}const q0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],sE=new Set(q0),nte=n=>e=>typeof e=="string"&&e.startsWith(n),rte=nte("--"),u1e=nte("var(--"),IF=n=>u1e(n)?d1e.test(n.split("/*")[0].trim()):!1,d1e=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,ite=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Gf=(n,e,i)=>i>e?e:i<n?n:i,Y0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},VC={...Y0,transform:n=>Gf(0,1,n)},F1={...Y0,default:1},_R=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),hg=_R("deg"),ap=_R("%"),Un=_R("px"),h1e=_R("vh"),p1e=_R("vw"),Fq={...ap,parse:n=>ap.parse(n)/100,transform:n=>ap.transform(n*100)},f1e={borderWidth:Un,borderTopWidth:Un,borderRightWidth:Un,borderBottomWidth:Un,borderLeftWidth:Un,borderRadius:Un,radius:Un,borderTopLeftRadius:Un,borderTopRightRadius:Un,borderBottomRightRadius:Un,borderBottomLeftRadius:Un,width:Un,maxWidth:Un,height:Un,maxHeight:Un,top:Un,right:Un,bottom:Un,left:Un,padding:Un,paddingTop:Un,paddingRight:Un,paddingBottom:Un,paddingLeft:Un,margin:Un,marginTop:Un,marginRight:Un,marginBottom:Un,marginLeft:Un,backgroundPositionX:Un,backgroundPositionY:Un},m1e={rotate:hg,rotateX:hg,rotateY:hg,rotateZ:hg,scale:F1,scaleX:F1,scaleY:F1,scaleZ:F1,skew:hg,skewX:hg,skewY:hg,distance:Un,translateX:Un,translateY:Un,translateZ:Un,x:Un,y:Un,z:Un,perspective:Un,transformPerspective:Un,opacity:VC,originX:Fq,originY:Fq,originZ:Un},Bq={...Y0,transform:Math.round},AF={...f1e,...m1e,zIndex:Bq,size:Un,fillOpacity:VC,strokeOpacity:VC,numOctaves:Bq},g1e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},_1e=q0.length;function y1e(n,e,i){let a="",l=!0;for(let u=0;u<_1e;u++){const f=q0[u],_=n[f];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(f.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const S=ite(_,AF[f]);if(!E){l=!1;const w=g1e[f]||f;a+=`${w}(${S}) `}i&&(e[f]=S)}}return a=a.trim(),i?a=i(e,l?"":a):l&&(a="none"),a}function PF(n,e,i){const{style:a,vars:l,transformOrigin:u}=n;let f=!1,_=!1;for(const E in e){const S=e[E];if(sE.has(E)){f=!0;continue}else if(rte(E)){l[E]=S;continue}else{const w=ite(S,AF[E]);E.startsWith("origin")?(_=!0,u[E]=w):a[E]=w}}if(e.transform||(f||i?a.transform=y1e(e,n.transform,i):a.transform&&(a.transform="none")),_){const{originX:E="50%",originY:S="50%",originZ:w=0}=u;a.transformOrigin=`${E} ${S} ${w}`}}const E1e={offset:"stroke-dashoffset",array:"stroke-dasharray"},v1e={offset:"strokeDashoffset",array:"strokeDasharray"};function S1e(n,e,i=1,a=0,l=!0){n.pathLength=1;const u=l?E1e:v1e;n[u.offset]=Un.transform(-a);const f=Un.transform(e),_=Un.transform(i);n[u.array]=`${f} ${_}`}function Wq(n,e,i){return typeof n=="string"?n:Un.transform(e+i*n)}function b1e(n,e,i){const a=Wq(e,n.x,n.width),l=Wq(i,n.y,n.height);return`${a} ${l}`}function OF(n,{attrX:e,attrY:i,attrScale:a,originX:l,originY:u,pathLength:f,pathSpacing:_=1,pathOffset:E=0,...S},w,I){if(PF(n,S,I),w){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:k,style:U,dimensions:L}=n;k.transform&&(L&&(U.transform=k.transform),delete k.transform),L&&(l!==void 0||u!==void 0||U.transform)&&(U.transformOrigin=b1e(L,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(k.x=e),i!==void 0&&(k.y=i),a!==void 0&&(k.scale=a),f!==void 0&&S1e(k,f,_,E,!1)}const kF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),ste=()=>({...kF(),attrs:{}}),NF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function ote(n,{style:e,vars:i},a,l){Object.assign(n.style,e,l&&l.getProjectionStyles(a));for(const u in i)n.style.setProperty(u,i[u])}const ate=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function cte(n,e,i,a){ote(n,e,void 0,a);for(const l in e.attrs)n.setAttribute(ate.has(l)?l:TF(l),e.attrs[l])}const ek={};function T1e(n){Object.assign(ek,n)}function lte(n,{layout:e,layoutId:i}){return sE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!ek[n]||n==="opacity")}function DF(n,e,i){var a;const{style:l}=n,u={};for(const f in l)(Ua(l[f])||e.style&&Ua(e.style[f])||lte(f,n)||((a=i==null?void 0:i.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(u[f]=l[f]);return u}function ute(n,e,i){const a=DF(n,e,i);for(const l in n)if(Ua(n[l])||Ua(e[l])){const u=q0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[u]=n[l]}return a}function w1e(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const zq=["x","y","width","height","cx","cy","r"],C1e={useVisualState:tte({scrapeMotionValuesFromProps:ute,createRenderState:ste,onUpdate:({props:n,prevProps:e,current:i,renderState:a,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const _ in l)if(sE.has(_)){u=!0;break}}if(!u)return;let f=!e;if(e)for(let _=0;_<zq.length;_++){const E=zq[_];n[E]!==e[E]&&(f=!0)}f&&Yi.read(()=>{w1e(i,a),Yi.render(()=>{OF(a,l,NF(i.tagName),n.transformTemplate),cte(i,a)})})}})},R1e={useVisualState:tte({scrapeMotionValuesFromProps:DF,createRenderState:kF})};function dte(n,e,i){for(const a in e)!Ua(e[a])&&!lte(a,i)&&(n[a]=e[a])}function I1e({transformTemplate:n},e){return D.useMemo(()=>{const i=kF();return PF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function A1e(n,e){const i=n.style||{},a={};return dte(a,i,n),Object.assign(a,I1e(n,e)),a}function P1e(n,e){const i={},a=A1e(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function O1e(n,e,i,a){const l=D.useMemo(()=>{const u=ste();return OF(u,e,NF(a),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};dte(u,n.style,n),l.style={...u,...l.style}}return l}function k1e(n=!1){return(i,a,l,{latestValues:u},f)=>{const E=(CF(i)?O1e:P1e)(a,u,f,i),S=$Pe(a,typeof i=="string",n),w=i!==D.Fragment?{...S,...E,ref:l}:{},{children:I}=a,k=D.useMemo(()=>Ua(I)?I.get():I,[I]);return D.createElement(i,{...w,children:k})}}function N1e(n,e){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...CF(a)?C1e:R1e,preloadedFeatures:n,useRender:k1e(l),createVisualElement:e,Component:a};return t1e(f)}}function hte(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}function Jk(n,e,i){const a=n.getProps();return RF(a,e,i!==void 0?i:a.custom,n)}const D1e=vF(()=>window.ScrollTimeline!==void 0);class x1e{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let a=0;a<this.animations.length;a++)this.animations[a][e]=i}attachTimeline(e,i){const a=this.animations.map(l=>{if(D1e()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class L1e extends x1e{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function xF(n,e){return n?n[e]||n.default||n:void 0}const SV=2e4;function pte(n){let e=0;const i=50;let a=n.next(e);for(;!a.done&&e<SV;)e+=i,a=n.next(e);return e>=SV?1/0:e}function LF(n){return typeof n=="function"}function Gq(n,e){n.timeline=e,n.onfinish=null}const MF=n=>Array.isArray(n)&&typeof n[0]=="number",M1e={linearEasing:void 0};function U1e(n,e){const i=vF(n);return()=>{var a;return(a=M1e[e])!==null&&a!==void 0?a:i()}}const tk=U1e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),fte=(n,e,i=10)=>{let a="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)a+=n(w0(0,l-1,u))+", ";return`linear(${a.substring(0,a.length-2)})`};function mte(n){return!!(typeof n=="function"&&tk()||!n||typeof n=="string"&&(n in bV||tk())||MF(n)||Array.isArray(n)&&n.every(mte))}const qw=([n,e,i,a])=>`cubic-bezier(${n}, ${e}, ${i}, ${a})`,bV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qw([0,.65,.55,1]),circOut:qw([.55,0,1,.45]),backIn:qw([.31,.01,.66,-.59]),backOut:qw([.33,1.53,.69,.99])};function gte(n,e){if(n)return typeof n=="function"&&tk()?fte(n,e):MF(n)?qw(n):Array.isArray(n)?n.map(i=>gte(i,e)||bV.easeOut):bV[n]}const Vd={x:!1,y:!1};function _te(){return Vd.x||Vd.y}function V1e(n,e,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function yte(n,e){const i=V1e(n),a=new AbortController,l={passive:!0,...e,signal:a.signal};return[i,l,()=>a.abort()]}function Hq(n){return e=>{e.pointerType==="touch"||_te()||n(e)}}function j1e(n,e,i={}){const[a,l,u]=yte(n,i),f=Hq(_=>{const{target:E}=_,S=e(_);if(typeof S!="function"||!E)return;const w=Hq(I=>{S(I),E.removeEventListener("pointerleave",w)});E.addEventListener("pointerleave",w,l)});return a.forEach(_=>{_.addEventListener("pointerenter",f,l)}),u}const Ete=(n,e)=>e?n===e?!0:Ete(n,e.parentElement):!1,UF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,F1e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function B1e(n){return F1e.has(n.tagName)||n.tabIndex!==-1}const Yw=new WeakSet;function $q(n){return e=>{e.key==="Enter"&&n(e)}}function JM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const W1e=(n,e)=>{const i=n.currentTarget;if(!i)return;const a=$q(()=>{if(Yw.has(i))return;JM(i,"down");const l=$q(()=>{JM(i,"up")}),u=()=>JM(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",a,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),e)};function Kq(n){return UF(n)&&!_te()}function z1e(n,e,i={}){const[a,l,u]=yte(n,i),f=_=>{const E=_.currentTarget;if(!Kq(_)||Yw.has(E))return;Yw.add(E);const S=e(_),w=(U,L)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",k),!(!Kq(U)||!Yw.has(E))&&(Yw.delete(E),typeof S=="function"&&S(U,{success:L}))},I=U=>{w(U,i.useGlobalTarget||Ete(E,U.target))},k=U=>{w(U,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",k,l)};return a.forEach(_=>{!B1e(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",f,l),_.addEventListener("focus",S=>W1e(S,l),l)}),u}function G1e(n){return n==="x"||n==="y"?Vd[n]?null:(Vd[n]=!0,()=>{Vd[n]=!1}):Vd.x||Vd.y?null:(Vd.x=Vd.y=!0,()=>{Vd.x=Vd.y=!1})}const vte=new Set(["width","height","top","left","right","bottom",...q0]);let RO;function H1e(){RO=void 0}const cp={now:()=>(RO===void 0&&cp.set(ia.isProcessing||FPe.useManualTiming?ia.timestamp:performance.now()),RO),set:n=>{RO=n,queueMicrotask(H1e)}};function VF(n,e){n.indexOf(e)===-1&&n.push(e)}function jF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class FF{constructor(){this.subscriptions=[]}add(e){return VF(this.subscriptions,e),()=>jF(this.subscriptions,e)}notify(e,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,a);else for(let u=0;u<l;u++){const f=this.subscriptions[u];f&&f(e,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Ste(n,e){return e?n*(1e3/e):0}const qq=30,$1e=n=>!isNaN(parseFloat(n));class K1e{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const u=cp.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=cp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=$1e(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new FF);const a=this.events[e].add(i);return e==="change"?()=>{a(),Yi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-a}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=cp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>qq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,qq);return Ste(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function jC(n,e){return new K1e(n,e)}function q1e(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,jC(i))}function Y1e(n,e){const i=Jk(n,e);let{transitionEnd:a={},transition:l={},...u}=i||{};u={...u,...a};for(const f in u){const _=a1e(u[f]);q1e(n,f,_)}}function X1e(n){return!!(Ua(n)&&n.add)}function TV(n,e){const i=n.getValue("willChange");if(X1e(i))return i.add(e)}function bte(n){return n.props[Qee]}const Tte=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,J1e=1e-7,Q1e=12;function Z1e(n,e,i,a,l){let u,f,_=0;do f=e+(i-e)/2,u=Tte(f,a,l)-n,u>0?i=f:e=f;while(Math.abs(u)>J1e&&++_<Q1e);return f}function yR(n,e,i,a){if(n===e&&i===a)return Bl;const l=u=>Z1e(u,0,1,n,i);return u=>u===0||u===1?u:Tte(l(u),e,a)}const wte=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,Cte=n=>e=>1-n(1-e),Rte=yR(.33,1.53,.69,.99),BF=Cte(Rte),Ite=wte(BF),Ate=n=>(n*=2)<1?.5*BF(n):.5*(2-Math.pow(2,-10*(n-1))),WF=n=>1-Math.sin(Math.acos(n)),Pte=Cte(WF),Ote=wte(WF),kte=n=>/^0[^.\s]+$/u.test(n);function eOe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||kte(n):!0}const fC=n=>Math.round(n*1e5)/1e5,zF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function tOe(n){return n==null}const nOe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,GF=(n,e)=>i=>!!(typeof i=="string"&&nOe.test(i)&&i.startsWith(n)||e&&!tOe(i)&&Object.prototype.hasOwnProperty.call(i,e)),Nte=(n,e,i)=>a=>{if(typeof a!="string")return a;const[l,u,f,_]=a.match(zF);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},rOe=n=>Gf(0,255,n),QM={...Y0,transform:n=>Math.round(rOe(n))},ky={test:GF("rgb","red"),parse:Nte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:a=1})=>"rgba("+QM.transform(n)+", "+QM.transform(e)+", "+QM.transform(i)+", "+fC(VC.transform(a))+")"};function iOe(n){let e="",i="",a="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,a+=a,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const wV={test:GF("#"),parse:iOe,transform:ky.transform},XS={test:GF("hsl","hue"),parse:Nte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+ap.transform(fC(e))+", "+ap.transform(fC(i))+", "+fC(VC.transform(a))+")"},xa={test:n=>ky.test(n)||wV.test(n)||XS.test(n),parse:n=>ky.test(n)?ky.parse(n):XS.test(n)?XS.parse(n):wV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?ky.transform(n):XS.transform(n)},sOe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function oOe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(zF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(sOe))===null||i===void 0?void 0:i.length)||0)>0}const Dte="number",xte="color",aOe="var",cOe="var(",Yq="${}",lOe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function FC(n){const e=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let u=0;const _=e.replace(lOe,E=>(xa.test(E)?(a.color.push(u),l.push(xte),i.push(xa.parse(E))):E.startsWith(cOe)?(a.var.push(u),l.push(aOe),i.push(E)):(a.number.push(u),l.push(Dte),i.push(parseFloat(E))),++u,Yq)).split(Yq);return{values:i,split:_,indexes:a,types:l}}function Lte(n){return FC(n).values}function Mte(n){const{split:e,types:i}=FC(n),a=e.length;return l=>{let u="";for(let f=0;f<a;f++)if(u+=e[f],l[f]!==void 0){const _=i[f];_===Dte?u+=fC(l[f]):_===xte?u+=xa.transform(l[f]):u+=l[f]}return u}}const uOe=n=>typeof n=="number"?0:n;function dOe(n){const e=Lte(n);return Mte(n)(e.map(uOe))}const Lg={test:oOe,parse:Lte,createTransformer:Mte,getAnimatableNone:dOe},hOe=new Set(["brightness","contrast","saturate","opacity"]);function pOe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[a]=i.match(zF)||[];if(!a)return n;const l=i.replace(a,"");let u=hOe.has(e)?1:0;return a!==i&&(u*=100),e+"("+u+l+")"}const fOe=/\b([a-z-]*)\(.*?\)/gu,CV={...Lg,getAnimatableNone:n=>{const e=n.match(fOe);return e?e.map(pOe).join(" "):n}},mOe={...AF,color:xa,backgroundColor:xa,outlineColor:xa,fill:xa,stroke:xa,borderColor:xa,borderTopColor:xa,borderRightColor:xa,borderBottomColor:xa,borderLeftColor:xa,filter:CV,WebkitFilter:CV},HF=n=>mOe[n];function Ute(n,e){let i=HF(n);return i!==CV&&(i=Lg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const gOe=new Set(["auto","none","0"]);function _Oe(n,e,i){let a=0,l;for(;a<n.length&&!l;){const u=n[a];typeof u=="string"&&!gOe.has(u)&&FC(u).values.length&&(l=n[a]),a++}if(l&&i)for(const u of e)n[u]=Ute(i,l)}const Xq=n=>n===Y0||n===Un,Jq=(n,e)=>parseFloat(n.split(", ")[e]),Qq=(n,e)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return Jq(l[1],e);{const u=a.match(/^matrix\((.+)\)$/u);return u?Jq(u[1],n):0}},yOe=new Set(["x","y","z"]),EOe=q0.filter(n=>!yOe.has(n));function vOe(n){const e=[];return EOe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(e.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),e}const R0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:Qq(4,13),y:Qq(5,14)};R0.translateX=R0.x;R0.translateY=R0.y;const Vy=new Set;let RV=!1,IV=!1;function Vte(){if(IV){const n=Array.from(Vy).filter(a=>a.needsMeasurement),e=new Set(n.map(a=>a.element)),i=new Map;e.forEach(a=>{const l=vOe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),e.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([u,f])=>{var _;(_=a.getValue(u))===null||_===void 0||_.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}IV=!1,RV=!1,Vy.forEach(n=>n.complete()),Vy.clear()}function jte(){Vy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(IV=!0)})}function SOe(){jte(),Vte()}class $F{constructor(e,i,a,l,u,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=a,this.motionValue=l,this.element=u,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Vy.add(this),RV||(RV=!0,Yi.read(jte),Yi.resolveKeyframes(Vte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:a,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const f=l==null?void 0:l.get(),_=e[e.length-1];if(f!==void 0)e[0]=f;else if(a&&i){const E=a.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&f===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Vy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Vy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Fte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),bOe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function TOe(n){const e=bOe.exec(n);if(!e)return[,];const[,i,a,l]=e;return[`--${i??a}`,l]}function Bte(n,e,i=1){const[a,l]=TOe(n);if(!a)return;const u=window.getComputedStyle(e).getPropertyValue(a);if(u){const f=u.trim();return Fte(f)?parseFloat(f):f}return IF(l)?Bte(l,e,i+1):l}const Wte=n=>e=>e.test(n),wOe={test:n=>n==="auto",parse:n=>n},zte=[Y0,Un,ap,hg,p1e,h1e,wOe],Zq=n=>zte.find(Wte(n));class Gte extends $F{constructor(e,i,a,l,u){super(e,i,a,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let S=e[E];if(typeof S=="string"&&(S=S.trim(),IF(S))){const w=Bte(S,i.current);w!==void 0&&(e[E]=w),E===e.length-1&&(this.finalKeyframe=S)}}if(this.resolveNoneKeyframes(),!vte.has(a)||e.length!==2)return;const[l,u]=e,f=Zq(l),_=Zq(u);if(f!==_)if(Xq(f)&&Xq(_))for(let E=0;E<e.length;E++){const S=e[E];typeof S=="string"&&(e[E]=parseFloat(S))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,a=[];for(let l=0;l<e.length;l++)eOe(e[l])&&a.push(l);a.length&&_Oe(e,a,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:a}=this;if(!e||!e.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=R0[a](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(a,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(a);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,_=l[f];l[f]=R0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,S])=>{i.getValue(E).set(S)}),this.resolveNoneKeyframes()}}const eY=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Lg.test(n)||n==="0")&&!n.startsWith("url("));function COe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function ROe(n,e,i,a){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],f=eY(l,e),_=eY(u,e);return!f||!_?!1:COe(n)||(i==="spring"||LF(i))&&a}const IOe=n=>n!==null;function Qk(n,{repeat:e,repeatType:i="loop"},a){const l=n.filter(IOe),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||a===void 0?l[u]:a}const AOe=40;class Hte{constructor({autoplay:e=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:f="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=cp.now(),this.options={autoplay:e,delay:i,type:a,repeat:l,repeatDelay:u,repeatType:f,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>AOe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&SOe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=cp.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:u,delay:f,onComplete:_,onUpdate:E,isGenerator:S}=this.options;if(!S&&!ROe(e,a,l,u))if(f)this.options.duration=0;else{E&&E(Qk(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const w=this.initPlayback(e,i);w!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...w},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const ls=(n,e,i)=>n+(e-n)*i;function ZM(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function POe({hue:n,saturation:e,lightness:i,alpha:a}){n/=360,e/=100,i/=100;let l=0,u=0,f=0;if(!e)l=u=f=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=ZM(E,_,n+1/3),u=ZM(E,_,n),f=ZM(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:a}}function nk(n,e){return i=>i>0?e:n}const eU=(n,e,i)=>{const a=n*n,l=i*(e*e-a)+a;return l<0?0:Math.sqrt(l)},OOe=[wV,ky,XS],kOe=n=>OOe.find(e=>e.test(n));function tY(n){const e=kOe(n);if(!e)return!1;let i=e.parse(n);return e===XS&&(i=POe(i)),i}const nY=(n,e)=>{const i=tY(n),a=tY(e);if(!i||!a)return nk(n,e);const l={...i};return u=>(l.red=eU(i.red,a.red,u),l.green=eU(i.green,a.green,u),l.blue=eU(i.blue,a.blue,u),l.alpha=ls(i.alpha,a.alpha,u),ky.transform(l))},NOe=(n,e)=>i=>e(n(i)),ER=(...n)=>n.reduce(NOe),AV=new Set(["none","hidden"]);function DOe(n,e){return AV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function xOe(n,e){return i=>ls(n,e,i)}function KF(n){return typeof n=="number"?xOe:typeof n=="string"?IF(n)?nk:xa.test(n)?nY:UOe:Array.isArray(n)?$te:typeof n=="object"?xa.test(n)?nY:LOe:nk}function $te(n,e){const i=[...n],a=i.length,l=n.map((u,f)=>KF(u)(u,e[f]));return u=>{for(let f=0;f<a;f++)i[f]=l[f](u);return i}}function LOe(n,e){const i={...n,...e},a={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(a[l]=KF(n[l])(n[l],e[l]));return l=>{for(const u in a)i[u]=a[u](l);return i}}function MOe(n,e){var i;const a=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const f=e.types[u],_=n.indexes[f][l[f]],E=(i=n.values[_])!==null&&i!==void 0?i:0;a[u]=E,l[f]++}return a}const UOe=(n,e)=>{const i=Lg.createTransformer(e),a=FC(n),l=FC(e);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?AV.has(n)&&!l.values.length||AV.has(e)&&!a.values.length?DOe(n,e):ER($te(MOe(a,l),l.values),i):nk(n,e)};function Kte(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?ls(n,e,i):KF(n)(n,e)}const VOe=5;function qte(n,e,i){const a=Math.max(e-VOe,0);return Ste(i-n(a),e-a)}const Rs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},rY=.001;function jOe({duration:n=Rs.duration,bounce:e=Rs.bounce,velocity:i=Rs.velocity,mass:a=Rs.mass}){let l,u,f=1-e;f=Gf(Rs.minDamping,Rs.maxDamping,f),n=Gf(Rs.minDuration,Rs.maxDuration,jf(n)),f<1?(l=S=>{const w=S*f,I=w*n,k=w-i,U=PV(S,f),L=Math.exp(-I);return rY-k/U*L},u=S=>{const I=S*f*n,k=I*i+i,U=Math.pow(f,2)*Math.pow(S,2)*n,L=Math.exp(-I),F=PV(Math.pow(S,2),f);return(-l(S)+rY>0?-1:1)*((k-U)*L)/F}):(l=S=>{const w=Math.exp(-S*n),I=(S-i)*n+1;return-.001+w*I},u=S=>{const w=Math.exp(-S*n),I=(i-S)*(n*n);return w*I});const _=5/n,E=BOe(l,u,_);if(n=Vf(n),isNaN(E))return{stiffness:Rs.stiffness,damping:Rs.damping,duration:n};{const S=Math.pow(E,2)*a;return{stiffness:S,damping:f*2*Math.sqrt(a*S),duration:n}}}const FOe=12;function BOe(n,e,i){let a=i;for(let l=1;l<FOe;l++)a=a-n(a)/e(a);return a}function PV(n,e){return n*Math.sqrt(1-e*e)}const WOe=["duration","bounce"],zOe=["stiffness","damping","mass"];function iY(n,e){return e.some(i=>n[i]!==void 0)}function GOe(n){let e={velocity:Rs.velocity,stiffness:Rs.stiffness,damping:Rs.damping,mass:Rs.mass,isResolvedFromDuration:!1,...n};if(!iY(n,zOe)&&iY(n,WOe))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,u=2*Gf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Rs.mass,stiffness:l,damping:u}}else{const i=jOe(n);e={...e,...i,mass:Rs.mass},e.isResolvedFromDuration=!0}return e}function Yte(n=Rs.visualDuration,e=Rs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:a,restDelta:l}=i;const u=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],_={done:!1,value:u},{stiffness:E,damping:S,mass:w,duration:I,velocity:k,isResolvedFromDuration:U}=GOe({...i,velocity:-jf(i.velocity||0)}),L=k||0,F=S/(2*Math.sqrt(E*w)),B=f-u,q=jf(Math.sqrt(E/w)),$=Math.abs(B)<5;a||(a=$?Rs.restSpeed.granular:Rs.restSpeed.default),l||(l=$?Rs.restDelta.granular:Rs.restDelta.default);let X;if(F<1){const re=PV(q,F);X=pe=>{const te=Math.exp(-F*q*pe);return f-te*((L+F*q*B)/re*Math.sin(re*pe)+B*Math.cos(re*pe))}}else if(F===1)X=re=>f-Math.exp(-q*re)*(B+(L+q*B)*re);else{const re=q*Math.sqrt(F*F-1);X=pe=>{const te=Math.exp(-F*q*pe),Z=Math.min(re*pe,300);return f-te*((L+F*q*B)*Math.sinh(Z)+re*B*Math.cosh(Z))/re}}const oe={calculatedDuration:U&&I||null,next:re=>{const pe=X(re);if(U)_.done=re>=I;else{let te=0;F<1&&(te=re===0?Vf(L):qte(X,re,pe));const Z=Math.abs(te)<=a,ne=Math.abs(f-pe)<=l;_.done=Z&&ne}return _.value=_.done?f:pe,_},toString:()=>{const re=Math.min(pte(oe),SV),pe=fte(te=>oe.next(re*te).value,re,30);return re+"ms "+pe}};return oe}function sY({keyframes:n,velocity:e=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:f,min:_,max:E,restDelta:S=.5,restSpeed:w}){const I=n[0],k={done:!1,value:I},U=Z=>_!==void 0&&Z<_||E!==void 0&&Z>E,L=Z=>_===void 0?E:E===void 0||Math.abs(_-Z)<Math.abs(E-Z)?_:E;let F=i*e;const B=I+F,q=f===void 0?B:f(B);q!==B&&(F=q-I);const $=Z=>-F*Math.exp(-Z/a),X=Z=>q+$(Z),oe=Z=>{const ne=$(Z),ae=X(Z);k.done=Math.abs(ne)<=S,k.value=k.done?q:ae};let re,pe;const te=Z=>{U(k.value)&&(re=Z,pe=Yte({keyframes:[k.value,L(k.value)],velocity:qte(X,Z,k.value),damping:l,stiffness:u,restDelta:S,restSpeed:w}))};return te(0),{calculatedDuration:null,next:Z=>{let ne=!1;return!pe&&re===void 0&&(ne=!0,oe(Z),te(Z)),re!==void 0&&Z>=re?pe.next(Z-re):(!ne&&oe(Z),k)}}}const HOe=yR(.42,0,1,1),$Oe=yR(0,0,.58,1),Xte=yR(.42,0,.58,1),KOe=n=>Array.isArray(n)&&typeof n[0]!="number",qOe={linear:Bl,easeIn:HOe,easeInOut:Xte,easeOut:$Oe,circIn:WF,circInOut:Ote,circOut:Pte,backIn:BF,backInOut:Ite,backOut:Rte,anticipate:Ate},oY=n=>{if(MF(n)){Kee(n.length===4);const[e,i,a,l]=n;return yR(e,i,a,l)}else if(typeof n=="string")return qOe[n];return n};function YOe(n,e,i){const a=[],l=i||Kte,u=n.length-1;for(let f=0;f<u;f++){let _=l(n[f],n[f+1]);if(e){const E=Array.isArray(e)?e[f]||Bl:e;_=ER(E,_)}a.push(_)}return a}function XOe(n,e,{clamp:i=!0,ease:a,mixer:l}={}){const u=n.length;if(Kee(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const f=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=YOe(e,a,l),E=_.length,S=w=>{if(f&&w<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(w<n[I+1]);I++);const k=w0(n[I],n[I+1],w);return _[I](k)};return i?w=>S(Gf(n[0],n[u-1],w)):S}function JOe(n,e){const i=n[n.length-1];for(let a=1;a<=e;a++){const l=w0(0,e,a);n.push(ls(i,1,l))}}function QOe(n){const e=[0];return JOe(e,n.length-1),e}function ZOe(n,e){return n.map(i=>i*e)}function eke(n,e){return n.map(()=>e||Xte).splice(0,n.length-1)}function rk({duration:n=300,keyframes:e,times:i,ease:a="easeInOut"}){const l=KOe(a)?a.map(oY):oY(a),u={done:!1,value:e[0]},f=ZOe(i&&i.length===e.length?i:QOe(e),n),_=XOe(f,e,{ease:Array.isArray(l)?l:eke(e,l)});return{calculatedDuration:n,next:E=>(u.value=_(E),u.done=E>=n,u)}}const tke=n=>{const e=({timestamp:i})=>n(i);return{start:()=>Yi.update(e,!0),stop:()=>xg(e),now:()=>ia.isProcessing?ia.timestamp:cp.now()}},nke={decay:sY,inertia:sY,tween:rk,keyframes:rk,spring:Yte},rke=n=>n/100;class qF extends Hte{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:a,element:l,keyframes:u}=this.options,f=(l==null?void 0:l.KeyframeResolver)||$F,_=(E,S)=>this.onKeyframesResolved(E,S);this.resolver=new f(u,_,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:u,velocity:f=0}=this.options,_=LF(i)?i:nke[i]||rk;let E,S;_!==rk&&typeof e[0]!="number"&&(E=ER(rke,Kte(e[0],e[1])),e=[0,100]);const w=_({...this.options,keyframes:e});u==="mirror"&&(S=_({...this.options,keyframes:[...e].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=pte(w));const{calculatedDuration:I}=w,k=I+l,U=k*(a+1)-l;return{generator:w,mirroredGenerator:S,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:k,totalDuration:U}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:a}=this;if(!a){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:f,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:S,totalDuration:w,resolvedDuration:I}=a;if(this.startTime===null)return u.next(0);const{delay:k,repeat:U,repeatType:L,repeatDelay:F,onUpdate:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-w/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const q=this.currentTime-k*(this.speed>=0?1:-1),$=this.speed>=0?q<0:q>w;this.currentTime=Math.max(q,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=w);let X=this.currentTime,oe=u;if(U){const Z=Math.min(this.currentTime,w)/I;let ne=Math.floor(Z),ae=Z%1;!ae&&Z>=1&&(ae=1),ae===1&&ne--,ne=Math.min(ne,U+1),!!(ne%2)&&(L==="reverse"?(ae=1-ae,F&&(ae-=F/I)):L==="mirror"&&(oe=f)),X=Gf(0,1,ae)*I}const re=$?{done:!1,value:E[0]}:oe.next(X);_&&(re.value=_(re.value));let{done:pe}=re;!$&&S!==null&&(pe=this.speed>=0?this.currentTime>=w:this.currentTime<=0);const te=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&pe);return te&&l!==void 0&&(re.value=Qk(E,this.options,l)),B&&B(re.value),te&&this.finish(),re}get duration(){const{resolved:e}=this;return e?jf(e.calculatedDuration):0}get time(){return jf(this.currentTime)}set time(e){e=Vf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=jf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=tke,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const ike=new Set(["opacity","clipPath","filter","transform"]);function ske(n,e,i,{delay:a=0,duration:l=300,repeat:u=0,repeatType:f="loop",ease:_="easeInOut",times:E}={}){const S={[e]:i};E&&(S.offset=E);const w=gte(_,l);return Array.isArray(w)&&(S.easing=w),n.animate(S,{delay:a,duration:l,easing:Array.isArray(w)?"linear":w,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"})}const oke=vF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),ik=10,ake=2e4;function cke(n){return LF(n.type)||n.type==="spring"||!mte(n.ease)}function lke(n,e){const i=new qF({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let u=0;for(;!a.done&&u<ake;)a=i.sample(u),l.push(a.value),u+=ik;return{times:void 0,keyframes:l,duration:u-ik,ease:"linear"}}const Jte={anticipate:Ate,backInOut:Ite,circInOut:Ote};function uke(n){return n in Jte}class aY extends Hte{constructor(e){super(e);const{name:i,motionValue:a,element:l,keyframes:u}=this.options;this.resolver=new Gte(u,(f,_)=>this.onKeyframesResolved(f,_),i,a,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:a=300,times:l,ease:u,type:f,motionValue:_,name:E,startTime:S}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof u=="string"&&tk()&&uke(u)&&(u=Jte[u]),cke(this.options)){const{onComplete:I,onUpdate:k,motionValue:U,element:L,...F}=this.options,B=lke(e,F);e=B.keyframes,e.length===1&&(e[1]=e[0]),a=B.duration,l=B.times,u=B.ease,f="keyframes"}const w=ske(_.owner.current,E,e,{...this.options,duration:a,times:l,ease:u});return w.startTime=S??this.calcStartTime(),this.pendingTimeline?(Gq(w,this.pendingTimeline),this.pendingTimeline=void 0):w.onfinish=()=>{const{onComplete:I}=this.options;_.set(Qk(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:w,duration:a,times:l,type:f,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return jf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return jf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Vf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Bl;const{animation:a}=i;Gq(a,e)}return Bl}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:a,duration:l,type:u,ease:f,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:S,onUpdate:w,onComplete:I,element:k,...U}=this.options,L=new qF({...U,keyframes:a,duration:l,type:u,ease:f,times:_,isGenerator:!0}),F=Vf(this.time);S.setWithVelocity(L.sample(F-ik).value,L.sample(F).value,ik)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:a,repeatDelay:l,repeatType:u,damping:f,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:S}=i.owner.getProps();return oke()&&a&&ike.has(a)&&!E&&!S&&!l&&u!=="mirror"&&f!==0&&_!=="inertia"}}const dke={type:"spring",stiffness:500,damping:25,restSpeed:10},hke=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),pke={type:"keyframes",duration:.8},fke={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},mke=(n,{keyframes:e})=>e.length>2?pke:sE.has(n)?n.startsWith("scale")?hke(e[1]):dke:fke;function gke({when:n,delay:e,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:u,repeatType:f,repeatDelay:_,from:E,elapsed:S,...w}){return!!Object.keys(w).length}const YF=(n,e,i,a={},l,u)=>f=>{const _=xF(a,n)||{},E=_.delay||a.delay||0;let{elapsed:S=0}=a;S=S-Vf(E);let w={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-S,onUpdate:k=>{e.set(k),_.onUpdate&&_.onUpdate(k)},onComplete:()=>{f(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:u?void 0:l};gke(_)||(w={...w,...mke(n,w)}),w.duration&&(w.duration=Vf(w.duration)),w.repeatDelay&&(w.repeatDelay=Vf(w.repeatDelay)),w.from!==void 0&&(w.keyframes[0]=w.from);let I=!1;if((w.type===!1||w.duration===0&&!w.repeatDelay)&&(w.duration=0,w.delay===0&&(I=!0)),I&&!u&&e.get()!==void 0){const k=Qk(w.keyframes,_);if(k!==void 0)return Yi.update(()=>{w.onUpdate(k),w.onComplete()}),new L1e([])}return!u&&aY.supports(w)?new aY(w):new qF(w)};function _ke({protectedKeys:n,needsAnimating:e},i){const a=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,a}function Qte(n,e,{delay:i=0,transitionOverride:a,type:l}={}){var u;let{transition:f=n.getDefaultTransition(),transitionEnd:_,...E}=e;a&&(f=a);const S=[],w=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const k=n.getValue(I,(u=n.latestValues[I])!==null&&u!==void 0?u:null),U=E[I];if(U===void 0||w&&_ke(w,I))continue;const L={delay:i,...xF(f||{},I)};let F=!1;if(window.MotionHandoffAnimation){const q=bte(n);if(q){const $=window.MotionHandoffAnimation(q,I,Yi);$!==null&&(L.startTime=$,F=!0)}}TV(n,I),k.start(YF(I,k,U,n.shouldReduceMotion&&vte.has(I)?{type:!1}:L,n,F));const B=k.animation;B&&S.push(B)}return _&&Promise.all(S).then(()=>{Yi.update(()=>{_&&Y1e(n,_)})}),S}function OV(n,e,i={}){var a;const l=Jk(n,e,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const f=l?()=>Promise.all(Qte(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(S=0)=>{const{delayChildren:w=0,staggerChildren:I,staggerDirection:k}=u;return yke(n,e,w+S,I,k,i)}:()=>Promise.resolve(),{when:E}=u;if(E){const[S,w]=E==="beforeChildren"?[f,_]:[_,f];return S().then(()=>w())}else return Promise.all([f(),_(i.delay)])}function yke(n,e,i=0,a=0,l=1,u){const f=[],_=(n.variantChildren.size-1)*a,E=l===1?(S=0)=>S*a:(S=0)=>_-S*a;return Array.from(n.variantChildren).sort(Eke).forEach((S,w)=>{S.notify("AnimationStart",e),f.push(OV(S,e,{...u,delay:i+E(w)}).then(()=>S.notify("AnimationComplete",e)))}),Promise.all(f)}function Eke(n,e){return n.sortNodePosition(e)}function vke(n,e,i={}){n.notify("AnimationStart",e);let a;if(Array.isArray(e)){const l=e.map(u=>OV(n,u,i));a=Promise.all(l)}else if(typeof e=="string")a=OV(n,e,i);else{const l=typeof e=="function"?Jk(n,e,i.custom):e;a=Promise.all(Qte(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",e)})}const Ske=bF.length;function Zte(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Zte(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<Ske;i++){const a=bF[i],l=n.props[a];(UC(l)||l===!1)&&(e[a]=l)}return e}const bke=[...SF].reverse(),Tke=SF.length;function wke(n){return e=>Promise.all(e.map(({animation:i,options:a})=>vke(n,i,a)))}function Cke(n){let e=wke(n),i=cY(),a=!0;const l=E=>(S,w)=>{var I;const k=Jk(n,w,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(k){const{transition:U,transitionEnd:L,...F}=k;S={...S,...F,...L}}return S};function u(E){e=E(n)}function f(E){const{props:S}=n,w=Zte(n.parent)||{},I=[],k=new Set;let U={},L=1/0;for(let B=0;B<Tke;B++){const q=bke[B],$=i[q],X=S[q]!==void 0?S[q]:w[q],oe=UC(X),re=q===E?$.isActive:null;re===!1&&(L=B);let pe=X===w[q]&&X!==S[q]&&oe;if(pe&&a&&n.manuallyAnimateOnMount&&(pe=!1),$.protectedKeys={...U},!$.isActive&&re===null||!X&&!$.prevProp||Yk(X)||typeof X=="boolean")continue;const te=Rke($.prevProp,X);let Z=te||q===E&&$.isActive&&!pe&&oe||B>L&&oe,ne=!1;const ae=Array.isArray(X)?X:[X];let me=ae.reduce(l(q),{});re===!1&&(me={});const{prevResolvedValues:he={}}=$,ue={...he,...me},Ue=Ce=>{Z=!0,k.has(Ce)&&(ne=!0,k.delete(Ce)),$.needsAnimating[Ce]=!0;const Ie=n.getValue(Ce);Ie&&(Ie.liveStyle=!1)};for(const Ce in ue){const Ie=me[Ce],ye=he[Ce];if(U.hasOwnProperty(Ce))continue;let ke=!1;vV(Ie)&&vV(ye)?ke=!hte(Ie,ye):ke=Ie!==ye,ke?Ie!=null?Ue(Ce):k.add(Ce):Ie!==void 0&&k.has(Ce)?Ue(Ce):$.protectedKeys[Ce]=!0}$.prevProp=X,$.prevResolvedValues=me,$.isActive&&(U={...U,...me}),a&&n.blockInitialAnimation&&(Z=!1),Z&&(!(pe&&te)||ne)&&I.push(...ae.map(Ce=>({animation:Ce,options:{type:q}})))}if(k.size){const B={};k.forEach(q=>{const $=n.getBaseTarget(q),X=n.getValue(q);X&&(X.liveStyle=!0),B[q]=$??null}),I.push({animation:B})}let F=!!I.length;return a&&(S.initial===!1||S.initial===S.animate)&&!n.manuallyAnimateOnMount&&(F=!1),a=!1,F?e(I):Promise.resolve()}function _(E,S){var w;if(i[E].isActive===S)return Promise.resolve();(w=n.variantChildren)===null||w===void 0||w.forEach(k=>{var U;return(U=k.animationState)===null||U===void 0?void 0:U.setActive(E,S)}),i[E].isActive=S;const I=f(E);for(const k in i)i[k].protectedKeys={};return I}return{animateChanges:f,setActive:_,setAnimateFunction:u,getState:()=>i,reset:()=>{i=cY(),a=!0}}}function Rke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!hte(e,n):!1}function Sy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function cY(){return{animate:Sy(!0),whileInView:Sy(),whileHover:Sy(),whileTap:Sy(),whileDrag:Sy(),whileFocus:Sy(),exit:Sy()}}class $g{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Ike extends $g{constructor(e){super(e),e.animationState||(e.animationState=Cke(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Yk(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let Ake=0;class Pke extends $g{constructor(){super(...arguments),this.id=Ake++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===a)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const Oke={animation:{Feature:Ike},exit:{Feature:Pke}};function BC(n,e,i,a={passive:!0}){return n.addEventListener(e,i,a),()=>n.removeEventListener(e,i)}function vR(n){return{point:{x:n.pageX,y:n.pageY}}}const kke=n=>e=>UF(e)&&n(e,vR(e));function mC(n,e,i,a){return BC(n,e,kke(i),a)}const lY=(n,e)=>Math.abs(n-e);function Nke(n,e){const i=lY(n.x,e.x),a=lY(n.y,e.y);return Math.sqrt(i**2+a**2)}class ene{constructor(e,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=nU(this.lastMoveEventInfo,this.history),k=this.startEvent!==null,U=Nke(I.offset,{x:0,y:0})>=3;if(!k&&!U)return;const{point:L}=I,{timestamp:F}=ia;this.history.push({...L,timestamp:F});const{onStart:B,onMove:q}=this.handlers;k||(B&&B(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),q&&q(this.lastMoveEvent,I)},this.handlePointerMove=(I,k)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=tU(k,this.transformPagePoint),Yi.update(this.updatePoint,!0)},this.handlePointerUp=(I,k)=>{this.end();const{onEnd:U,onSessionEnd:L,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const B=nU(I.type==="pointercancel"?this.lastMoveEventInfo:tU(k,this.transformPagePoint),this.history);this.startEvent&&U&&U(I,B),L&&L(I,B)},!UF(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const f=vR(e),_=tU(f,this.transformPagePoint),{point:E}=_,{timestamp:S}=ia;this.history=[{...E,timestamp:S}];const{onSessionStart:w}=i;w&&w(e,nU(_,this.history)),this.removeListeners=ER(mC(this.contextWindow,"pointermove",this.handlePointerMove),mC(this.contextWindow,"pointerup",this.handlePointerUp),mC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),xg(this.updatePoint)}}function tU(n,e){return e?{point:e(n.point)}:n}function uY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function nU({point:n},e){return{point:n,delta:uY(n,tne(e)),offset:uY(n,Dke(e)),velocity:xke(e,.1)}}function Dke(n){return n[0]}function tne(n){return n[n.length-1]}function xke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=tne(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Vf(e)));)i--;if(!a)return{x:0,y:0};const u=jf(l.timestamp-a.timestamp);if(u===0)return{x:0,y:0};const f={x:(l.x-a.x)/u,y:(l.y-a.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const nne=1e-4,Lke=1-nne,Mke=1+nne,rne=.01,Uke=0-rne,Vke=0+rne;function Gl(n){return n.max-n.min}function jke(n,e,i){return Math.abs(n-e)<=i}function dY(n,e,i,a=.5){n.origin=a,n.originPoint=ls(e.min,e.max,n.origin),n.scale=Gl(i)/Gl(e),n.translate=ls(i.min,i.max,n.origin)-n.originPoint,(n.scale>=Lke&&n.scale<=Mke||isNaN(n.scale))&&(n.scale=1),(n.translate>=Uke&&n.translate<=Vke||isNaN(n.translate))&&(n.translate=0)}function gC(n,e,i,a){dY(n.x,e.x,i.x,a?a.originX:void 0),dY(n.y,e.y,i.y,a?a.originY:void 0)}function hY(n,e,i){n.min=i.min+e.min,n.max=n.min+Gl(e)}function Fke(n,e,i){hY(n.x,e.x,i.x),hY(n.y,e.y,i.y)}function pY(n,e,i){n.min=e.min-i.min,n.max=n.min+Gl(e)}function _C(n,e,i){pY(n.x,e.x,i.x),pY(n.y,e.y,i.y)}function Bke(n,{min:e,max:i},a){return e!==void 0&&n<e?n=a?ls(e,n,a.min):Math.max(n,e):i!==void 0&&n>i&&(n=a?ls(i,n,a.max):Math.min(n,i)),n}function fY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function Wke(n,{top:e,left:i,bottom:a,right:l}){return{x:fY(n.x,i,l),y:fY(n.y,e,a)}}function mY(n,e){let i=e.min-n.min,a=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function zke(n,e){return{x:mY(n.x,e.x),y:mY(n.y,e.y)}}function Gke(n,e){let i=.5;const a=Gl(n),l=Gl(e);return l>a?i=w0(e.min,e.max-a,n.min):a>l&&(i=w0(n.min,n.max-l,e.min)),Gf(0,1,i)}function Hke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const kV=.35;function $ke(n=kV){return n===!1?n=0:n===!0&&(n=kV),{x:gY(n,"left","right"),y:gY(n,"top","bottom")}}function gY(n,e,i){return{min:_Y(n,e),max:_Y(n,i)}}function _Y(n,e){return typeof n=="number"?n:n[e]||0}const yY=()=>({translate:0,scale:1,origin:0,originPoint:0}),JS=()=>({x:yY(),y:yY()}),EY=()=>({min:0,max:0}),Ls=()=>({x:EY(),y:EY()});function Du(n){return[n("x"),n("y")]}function ine({top:n,left:e,right:i,bottom:a}){return{x:{min:e,max:i},y:{min:n,max:a}}}function Kke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function qke(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),a=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function rU(n){return n===void 0||n===1}function NV({scale:n,scaleX:e,scaleY:i}){return!rU(n)||!rU(e)||!rU(i)}function Ty(n){return NV(n)||sne(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function sne(n){return vY(n.x)||vY(n.y)}function vY(n){return n&&n!=="0%"}function sk(n,e,i){const a=n-i,l=e*a;return i+l}function SY(n,e,i,a,l){return l!==void 0&&(n=sk(n,l,a)),sk(n,i,a)+e}function DV(n,e=0,i=1,a,l){n.min=SY(n.min,e,i,a,l),n.max=SY(n.max,e,i,a,l)}function one(n,{x:e,y:i}){DV(n.x,e.translate,e.scale,e.originPoint),DV(n.y,i.translate,i.scale,i.originPoint)}const bY=.999999999999,TY=1.0000000000001;function Yke(n,e,i,a=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,f;for(let _=0;_<l;_++){u=i[_],f=u.projectionDelta;const{visualElement:E}=u.options;E&&E.props.style&&E.props.style.display==="contents"||(a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ZS(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(e.x*=f.x.scale,e.y*=f.y.scale,one(n,f)),a&&Ty(u.latestValues)&&ZS(n,u.latestValues))}e.x<TY&&e.x>bY&&(e.x=1),e.y<TY&&e.y>bY&&(e.y=1)}function QS(n,e){n.min=n.min+e,n.max=n.max+e}function wY(n,e,i,a,l=.5){const u=ls(n.min,n.max,l);DV(n,e,i,u,a)}function ZS(n,e){wY(n.x,e.x,e.scaleX,e.scale,e.originX),wY(n.y,e.y,e.scaleY,e.scale,e.originY)}function ane(n,e){return ine(qke(n.getBoundingClientRect(),e))}function Xke(n,e,i){const a=ane(n,i),{scroll:l}=e;return l&&(QS(a.x,l.offset.x),QS(a.y,l.offset.y)),a}const cne=({current:n})=>n?n.ownerDocument.defaultView:null,Jke=new WeakMap;class Qke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ls(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=w=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(vR(w).point)},u=(w,I)=>{const{drag:k,dragPropagation:U,onDragStart:L}=this.getProps();if(k&&!U&&(this.openDragLock&&this.openDragLock(),this.openDragLock=G1e(k),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Du(B=>{let q=this.getAxisMotionValue(B).get()||0;if(ap.test(q)){const{projection:$}=this.visualElement;if($&&$.layout){const X=$.layout.layoutBox[B];X&&(q=Gl(X)*(parseFloat(q)/100))}}this.originPoint[B]=q}),L&&Yi.postRender(()=>L(w,I)),TV(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},f=(w,I)=>{const{dragPropagation:k,dragDirectionLock:U,onDirectionLock:L,onDrag:F}=this.getProps();if(!k&&!this.openDragLock)return;const{offset:B}=I;if(U&&this.currentDirection===null){this.currentDirection=Zke(B),this.currentDirection!==null&&L&&L(this.currentDirection);return}this.updateAxis("x",I.point,B),this.updateAxis("y",I.point,B),this.visualElement.render(),F&&F(w,I)},_=(w,I)=>this.stop(w,I),E=()=>Du(w=>{var I;return this.getAnimationState(w)==="paused"&&((I=this.getAxisMotionValue(w).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:S}=this.getProps();this.panSession=new ene(e,{onSessionStart:l,onStart:u,onMove:f,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:S,contextWindow:cne(this.visualElement)})}stop(e,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&Yi.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,a){const{drag:l}=this.getProps();if(!a||!B1(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let f=this.originPoint[e]+a[e];this.constraints&&this.constraints[e]&&(f=Bke(f,this.constraints[e],this.elastic[e])),u.set(f)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&YS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=Wke(l.layoutBox,i):this.constraints=!1,this.elastic=$ke(a),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Du(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=Hke(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!YS(e))return!1;const a=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=Xke(a,l.root,this.visualElement.getTransformPagePoint());let f=zke(l.layout.layoutBox,u);if(i){const _=i(Kke(f));this.hasMutatedConstraints=!!_,_&&(f=ine(_))}return f}startAnimation(e){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},S=Du(w=>{if(!B1(w,i,this.currentDirection))return;let I=E&&E[w]||{};f&&(I={min:0,max:0});const k=l?200:1e6,U=l?40:1e7,L={type:"inertia",velocity:a?e[w]:0,bounceStiffness:k,bounceDamping:U,timeConstant:750,restDelta:1,restSpeed:10,...u,...I};return this.startAxisValueAnimation(w,L)});return Promise.all(S).then(_)}startAxisValueAnimation(e,i){const a=this.getAxisMotionValue(e);return TV(this.visualElement,e),a.start(YF(e,a,0,i,this.visualElement,!1))}stopAnimation(){Du(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Du(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(e,(a.initial?a.initial[e]:void 0)||0)}snapToCursor(e){Du(i=>{const{drag:a}=this.getProps();if(!B1(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:_}=l.layout.layoutBox[i];u.set(e[i]-ls(f,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!YS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Du(f=>{const _=this.getAxisMotionValue(f);if(_&&this.constraints!==!1){const E=_.get();l[f]=Gke({min:E,max:E},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Du(f=>{if(!B1(f,e,null))return;const _=this.getAxisMotionValue(f),{min:E,max:S}=this.constraints[f];_.set(ls(E,S,l[f]))})}addListeners(){if(!this.visualElement.current)return;Jke.set(this.visualElement,this);const e=this.visualElement.current,i=mC(e,"pointerdown",E=>{const{drag:S,dragListener:w=!0}=this.getProps();S&&w&&this.start(E)}),a=()=>{const{dragConstraints:E}=this.getProps();YS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Yi.read(a);const f=BC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:S})=>{this.isDragging&&S&&(Du(w=>{const I=this.getAxisMotionValue(w);I&&(this.originPoint[w]+=E[w].translate,I.set(I.get()+E[w].translate))}),this.visualElement.render())});return()=>{f(),i(),u(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:f=kV,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:u,dragElastic:f,dragMomentum:_}}}function B1(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function Zke(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class eNe extends $g{constructor(e){super(e),this.removeGroupControls=Bl,this.removeListeners=Bl,this.controls=new Qke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Bl}unmount(){this.removeGroupControls(),this.removeListeners()}}const CY=n=>(e,i)=>{n&&Yi.postRender(()=>n(e,i))};class tNe extends $g{constructor(){super(...arguments),this.removePointerDownListener=Bl}onPointerDown(e){this.session=new ene(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:cne(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:CY(e),onStart:CY(i),onMove:a,onEnd:(u,f)=>{delete this.session,l&&Yi.postRender(()=>l(u,f))}}}mount(){this.removePointerDownListener=mC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const IO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function RY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Cw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Un.test(n))n=parseFloat(n);else return n;const i=RY(n,e.target.x),a=RY(n,e.target.y);return`${i}% ${a}%`}},nNe={correct:(n,{treeScale:e,projectionDelta:i})=>{const a=n,l=Lg.parse(n);if(l.length>5)return a;const u=Lg.createTransformer(n),f=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+f]/=_,l[1+f]/=E;const S=ls(_,E,.5);return typeof l[2+f]=="number"&&(l[2+f]/=S),typeof l[3+f]=="number"&&(l[3+f]/=S),u(l)}};class rNe extends D.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:u}=e;T1e(iNe),u&&(i.group&&i.group.add(u),a&&a.register&&l&&a.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),IO.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:a,drag:l,isPresent:u}=this.props,f=a.projection;return f&&(f.isPresent=u,l||e.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?f.promote():f.relegate()||Yi.postRender(()=>{const _=f.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),wF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function lne(n){const[e,i]=yF(),a=D.useContext(mF);return b.jsx(rNe,{...n,layoutGroup:a,switchLayoutGroup:D.useContext(Zee),isPresent:e,safeToRemove:i})}const iNe={borderRadius:{...Cw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cw,borderTopRightRadius:Cw,borderBottomLeftRadius:Cw,borderBottomRightRadius:Cw,boxShadow:nNe};function sNe(n,e,i){const a=Ua(n)?n:jC(n);return a.start(YF("",a,e,i)),a.animation}function oNe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const aNe=(n,e)=>n.depth-e.depth;class cNe{constructor(){this.children=[],this.isDirty=!1}add(e){VF(this.children,e),this.isDirty=!0}remove(e){jF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(aNe),this.isDirty=!1,this.children.forEach(e)}}function lNe(n,e){const i=cp.now(),a=({timestamp:l})=>{const u=l-i;u>=e&&(xg(a),n(u-e))};return Yi.read(a,!0),()=>xg(a)}const une=["TopLeft","TopRight","BottomLeft","BottomRight"],uNe=une.length,IY=n=>typeof n=="string"?parseFloat(n):n,AY=n=>typeof n=="number"||Un.test(n);function dNe(n,e,i,a,l,u){l?(n.opacity=ls(0,i.opacity!==void 0?i.opacity:1,hNe(a)),n.opacityExit=ls(e.opacity!==void 0?e.opacity:1,0,pNe(a))):u&&(n.opacity=ls(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let f=0;f<uNe;f++){const _=`border${une[f]}Radius`;let E=PY(e,_),S=PY(i,_);if(E===void 0&&S===void 0)continue;E||(E=0),S||(S=0),E===0||S===0||AY(E)===AY(S)?(n[_]=Math.max(ls(IY(E),IY(S),a),0),(ap.test(S)||ap.test(E))&&(n[_]+="%")):n[_]=S}(e.rotate||i.rotate)&&(n.rotate=ls(e.rotate||0,i.rotate||0,a))}function PY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const hNe=dne(0,.5,Pte),pNe=dne(.5,.95,Bl);function dne(n,e,i){return a=>a<n?0:a>e?1:i(w0(n,e,a))}function OY(n,e){n.min=e.min,n.max=e.max}function Ou(n,e){OY(n.x,e.x),OY(n.y,e.y)}function kY(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function NY(n,e,i,a,l){return n-=e,n=sk(n,1/i,a),l!==void 0&&(n=sk(n,1/l,a)),n}function fNe(n,e=0,i=1,a=.5,l,u=n,f=n){if(ap.test(e)&&(e=parseFloat(e),e=ls(f.min,f.max,e/100)-f.min),typeof e!="number")return;let _=ls(u.min,u.max,a);n===u&&(_-=e),n.min=NY(n.min,e,i,_,l),n.max=NY(n.max,e,i,_,l)}function DY(n,e,[i,a,l],u,f){fNe(n,e[i],e[a],e[l],e.scale,u,f)}const mNe=["x","scaleX","originX"],gNe=["y","scaleY","originY"];function xY(n,e,i,a){DY(n.x,e,mNe,i?i.x:void 0,a?a.x:void 0),DY(n.y,e,gNe,i?i.y:void 0,a?a.y:void 0)}function LY(n){return n.translate===0&&n.scale===1}function hne(n){return LY(n.x)&&LY(n.y)}function MY(n,e){return n.min===e.min&&n.max===e.max}function _Ne(n,e){return MY(n.x,e.x)&&MY(n.y,e.y)}function UY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function pne(n,e){return UY(n.x,e.x)&&UY(n.y,e.y)}function VY(n){return Gl(n.x)/Gl(n.y)}function jY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class yNe{constructor(){this.members=[]}add(e){VF(this.members,e),e.scheduleRender()}remove(e){if(jF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){a=u;break}}return a?(this.promote(a),!0):!1}promote(e,i){const a=this.lead;if(e!==a&&(this.prevLead=a,this.lead=e,e.show(),a)){a.instance&&a.scheduleRender(),e.scheduleRender(),e.resumeFrom=a,i&&(e.resumeFrom.preserveOpacity=!0),a.snapshot&&(e.snapshot=a.snapshot,e.snapshot.latestValues=a.animationValues||a.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:a}=e;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function ENe(n,e,i){let a="";const l=n.x.translate/e.x,u=n.y.translate/e.y,f=(i==null?void 0:i.z)||0;if((l||u||f)&&(a=`translate3d(${l}px, ${u}px, ${f}px) `),(e.x!==1||e.y!==1)&&(a+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:S,rotate:w,rotateX:I,rotateY:k,skewX:U,skewY:L}=i;S&&(a=`perspective(${S}px) ${a}`),w&&(a+=`rotate(${w}deg) `),I&&(a+=`rotateX(${I}deg) `),k&&(a+=`rotateY(${k}deg) `),U&&(a+=`skewX(${U}deg) `),L&&(a+=`skewY(${L}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(a+=`scale(${_}, ${E})`),a||"none"}const wy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Xw=typeof window<"u"&&window.MotionDebug!==void 0,iU=["","X","Y","Z"],vNe={visibility:"hidden"},FY=1e3;let SNe=0;function sU(n,e,i,a){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),a&&(a[n]=0))}function fne(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=bte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",Yi,!(l||u))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&fne(a)}function mne({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},_=e==null?void 0:e()){this.id=SNe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Xw&&(wy.totalNodes=wy.resolvedTargetDeltas=wy.recalculatedProjection=0),this.nodes.forEach(wNe),this.nodes.forEach(PNe),this.nodes.forEach(ONe),this.nodes.forEach(CNe),Xw&&window.MotionDebug.record(wy)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new cNe)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new FF),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const E=this.eventHandlers.get(f);E&&E.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=oNe(f),this.instance=f;const{layoutId:E,layout:S,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(S||E)&&(this.isLayoutDirty=!0),n){let I;const k=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=lNe(k,250),IO.hasAnimatedSinceResize&&(IO.hasAnimatedSinceResize=!1,this.nodes.forEach(WY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&w&&(E||S)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:k,hasRelativeTargetChanged:U,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||w.getDefaultTransition()||LNe,{onLayoutAnimationStart:B,onLayoutAnimationComplete:q}=w.getProps(),$=!this.targetLayout||!pne(this.targetLayout,L)||U,X=!k&&U;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||X||k&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,X);const oe={...xF(F,"layout"),onPlay:B,onComplete:q};(w.shouldReduceMotion||this.options.layoutRoot)&&(oe.delay=0,oe.type=!1),this.startAnimation(oe)}else k||WY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,xg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(kNe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&fne(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let w=0;w<this.path.length;w++){const I=this.path[w];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const S=this.getTransformTemplate();this.prevTransformTemplateValue=S?S(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(BY);return}this.isUpdating||this.nodes.forEach(INe),this.isUpdating=!1,this.nodes.forEach(ANe),this.nodes.forEach(bNe),this.nodes.forEach(TNe),this.clearAllSnapshots();const _=cp.now();ia.delta=Gf(0,1e3/60,_-ia.timestamp),ia.timestamp=_,ia.isProcessing=!0,XM.update.process(ia),XM.preRender.process(ia),XM.render.process(ia),ia.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,wF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(RNe),this.sharedNodes.forEach(NNe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Yi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Yi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ls(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_){const E=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!hne(this.projectionDelta),E=this.getTransformTemplate(),S=E?E(this.latestValues,""):void 0,w=S!==this.prevTransformTemplateValue;f&&(_||Ty(this.latestValues)||w)&&(l(this.instance,S),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return f&&(E=this.removeTransform(E)),MNe(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:_}=this.options;if(!_)return Ls();const E=_.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(UNe))){const{scroll:w}=this.root;w&&(QS(E.x,w.offset.x),QS(E.y,w.offset.y))}return E}removeElementScroll(f){var _;const E=Ls();if(Ou(E,f),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let S=0;S<this.path.length;S++){const w=this.path[S],{scroll:I,options:k}=w;w!==this.root&&I&&k.layoutScroll&&(I.wasRoot&&Ou(E,f),QS(E.x,I.offset.x),QS(E.y,I.offset.y))}return E}applyTransform(f,_=!1){const E=Ls();Ou(E,f);for(let S=0;S<this.path.length;S++){const w=this.path[S];!_&&w.options.layoutScroll&&w.scroll&&w!==w.root&&ZS(E,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),Ty(w.latestValues)&&ZS(E,w.latestValues)}return Ty(this.latestValues)&&ZS(E,this.latestValues),E}removeTransform(f){const _=Ls();Ou(_,f);for(let E=0;E<this.path.length;E++){const S=this.path[E];if(!S.instance||!Ty(S.latestValues))continue;NV(S.latestValues)&&S.updateSnapshot();const w=Ls(),I=S.measurePageBox();Ou(w,I),xY(_,S.latestValues,S.snapshot?S.snapshot.layoutBox:void 0,w)}return Ty(this.latestValues)&&xY(_,this.latestValues),_}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ia.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const S=!!this.resumingFrom||this!==E;if(!(f||S&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:k}=this.options;if(!(!this.layout||!(I||k))){if(this.resolvedRelativeTargetAt=ia.timestamp,!this.targetDelta&&!this.relativeTarget){const U=this.getClosestProjectingParent();U&&U.layout&&this.animationProgress!==1?(this.relativeParent=U,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ls(),this.relativeTargetOrigin=Ls(),_C(this.relativeTargetOrigin,this.layout.layoutBox,U.layout.layoutBox),Ou(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Ls(),this.targetWithTransforms=Ls()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Fke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ou(this.target,this.layout.layoutBox),one(this.target,this.targetDelta)):Ou(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const U=this.getClosestProjectingParent();U&&!!U.resumingFrom==!!this.resumingFrom&&!U.options.layoutScroll&&U.target&&this.animationProgress!==1?(this.relativeParent=U,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ls(),this.relativeTargetOrigin=Ls(),_C(this.relativeTargetOrigin,this.target,U.target),Ou(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Xw&&wy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||NV(this.parent.latestValues)||sne(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let S=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(S=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(S=!1),this.resolvedRelativeTargetAt===ia.timestamp&&(S=!1),S)return;const{layout:w,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||I))return;Ou(this.layoutCorrected,this.layout.layoutBox);const k=this.treeScale.x,U=this.treeScale.y;Yke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=Ls());const{target:L}=_;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(kY(this.prevProjectionDelta.x,this.projectionDelta.x),kY(this.prevProjectionDelta.y,this.projectionDelta.y)),gC(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==k||this.treeScale.y!==U||!jY(this.projectionDelta.x,this.prevProjectionDelta.x)||!jY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L)),Xw&&wy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=JS(),this.projectionDelta=JS(),this.projectionDeltaWithTransform=JS()}setAnimationOrigin(f,_=!1){const E=this.snapshot,S=E?E.latestValues:{},w={...this.latestValues},I=JS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const k=Ls(),U=E?E.source:void 0,L=this.layout?this.layout.source:void 0,F=U!==L,B=this.getStack(),q=!B||B.members.length<=1,$=!!(F&&!q&&this.options.crossfade===!0&&!this.path.some(xNe));this.animationProgress=0;let X;this.mixTargetDelta=oe=>{const re=oe/1e3;zY(I.x,f.x,re),zY(I.y,f.y,re),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(_C(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),DNe(this.relativeTarget,this.relativeTargetOrigin,k,re),X&&_Ne(this.relativeTarget,X)&&(this.isProjectionDirty=!1),X||(X=Ls()),Ou(X,this.relativeTarget)),F&&(this.animationValues=w,dNe(w,S,this.latestValues,re,$,q)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(xg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Yi.update(()=>{IO.hasAnimatedSinceResize=!0,this.currentAnimation=sNe(0,FY,{...f,onUpdate:_=>{this.mixTargetDelta(_),f.onUpdate&&f.onUpdate(_)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(FY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:E,layout:S,latestValues:w}=f;if(!(!_||!E||!S)){if(this!==f&&this.layout&&S&&gne(this.options.animationType,this.layout.layoutBox,S.layoutBox)){E=this.target||Ls();const I=Gl(this.layout.layoutBox.x);E.x.min=f.target.x.min,E.x.max=E.x.min+I;const k=Gl(this.layout.layoutBox.y);E.y.min=f.target.y.min,E.y.max=E.y.min+k}Ou(_,E),ZS(_,w),gC(this.projectionDeltaWithTransform,this.layoutCorrected,_,w)}}registerSharedNode(f,_){this.sharedNodes.has(f)||this.sharedNodes.set(f,new yNe),this.sharedNodes.get(f).add(_);const S=_.options.initialPromotionConfig;_.promote({transition:S?S.transition:void 0,preserveFollowOpacity:S&&S.shouldPreserveFollowOpacity?S.shouldPreserveFollowOpacity(_):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:E}={}){const S=this.getStack();S&&S.promote(this,E),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:E}=f;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const S={};E.z&&sU("z",f,S,this.animationValues);for(let w=0;w<iU.length;w++)sU(`rotate${iU[w]}`,f,S,this.animationValues),sU(`skew${iU[w]}`,f,S,this.animationValues);f.render();for(const w in S)f.setStaticValue(w,S[w]),this.animationValues&&(this.animationValues[w]=S[w]);f.scheduleRender()}getProjectionStyles(f){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return vNe;const S={visibility:""},w=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,S.opacity="",S.pointerEvents=CO(f==null?void 0:f.pointerEvents)||"",S.transform=w?w(this.latestValues,""):"none",S;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=CO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!Ty(this.latestValues)&&(F.transform=w?w({},""):"none",this.hasProjected=!1),F}const k=I.animationValues||I.latestValues;this.applyTransformsToTarget(),S.transform=ENe(this.projectionDeltaWithTransform,this.treeScale,k),w&&(S.transform=w(k,S.transform));const{x:U,y:L}=this.projectionDelta;S.transformOrigin=`${U.origin*100}% ${L.origin*100}% 0`,I.animationValues?S.opacity=I===this?(E=(_=k.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:k.opacityExit:S.opacity=I===this?k.opacity!==void 0?k.opacity:"":k.opacityExit!==void 0?k.opacityExit:0;for(const F in ek){if(k[F]===void 0)continue;const{correct:B,applyTo:q}=ek[F],$=S.transform==="none"?k[F]:B(k[F],I);if(q){const X=q.length;for(let oe=0;oe<X;oe++)S[q[oe]]=$}else S[F]=$}return this.options.layoutId&&(S.pointerEvents=I===this?CO(f==null?void 0:f.pointerEvents)||"":"none"),S}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(BY),this.root.sharedNodes.clear()}}}function bNe(n){n.updateLayout()}function TNe(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:u}=n.options,f=i.source!==n.layout.source;u==="size"?Du(I=>{const k=f?i.measuredBox[I]:i.layoutBox[I],U=Gl(k);k.min=a[I].min,k.max=k.min+U}):gne(u,i.layoutBox,a)&&Du(I=>{const k=f?i.measuredBox[I]:i.layoutBox[I],U=Gl(a[I]);k.max=k.min+U,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+U)});const _=JS();gC(_,a,i.layoutBox);const E=JS();f?gC(E,n.applyTransform(l,!0),i.measuredBox):gC(E,a,i.layoutBox);const S=!hne(_);let w=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:k,layout:U}=I;if(k&&U){const L=Ls();_C(L,i.layoutBox,k.layoutBox);const F=Ls();_C(F,a,U.layoutBox),pne(L,F)||(w=!0),I.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=L,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:S,hasRelativeTargetChanged:w})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function wNe(n){Xw&&wy.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function CNe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function RNe(n){n.clearSnapshot()}function BY(n){n.clearMeasurements()}function INe(n){n.isLayoutDirty=!1}function ANe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function WY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function PNe(n){n.resolveTargetDelta()}function ONe(n){n.calcProjection()}function kNe(n){n.resetSkewAndRotation()}function NNe(n){n.removeLeadSnapshot()}function zY(n,e,i){n.translate=ls(e.translate,0,i),n.scale=ls(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function GY(n,e,i,a){n.min=ls(e.min,i.min,a),n.max=ls(e.max,i.max,a)}function DNe(n,e,i,a){GY(n.x,e.x,i.x,a),GY(n.y,e.y,i.y,a)}function xNe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const LNe={duration:.45,ease:[.4,0,.1,1]},HY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),$Y=HY("applewebkit/")&&!HY("chrome/")?Math.round:Bl;function KY(n){n.min=$Y(n.min),n.max=$Y(n.max)}function MNe(n){KY(n.x),KY(n.y)}function gne(n,e,i){return n==="position"||n==="preserve-aspect"&&!jke(VY(e),VY(i),.2)}function UNe(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const VNe=mne({attachResizeListener:(n,e)=>BC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),oU={current:void 0},_ne=mne({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!oU.current){const n=new VNe({});n.mount(window),n.setOptions({layoutScroll:!0}),oU.current=n}return oU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),jNe={pan:{Feature:tNe},drag:{Feature:eNe,ProjectionNode:_ne,MeasureLayout:lne}};function qY(n,e,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=a[l];u&&Yi.postRender(()=>u(e,vR(e)))}class FNe extends $g{mount(){const{current:e}=this.node;e&&(this.unmount=j1e(e,i=>(qY(this.node,i,"Start"),a=>qY(this.node,a,"End"))))}unmount(){}}class BNe extends $g{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ER(BC(this.node.current,"focus",()=>this.onFocus()),BC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function YY(n,e,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=a[l];u&&Yi.postRender(()=>u(e,vR(e)))}class WNe extends $g{mount(){const{current:e}=this.node;e&&(this.unmount=z1e(e,i=>(YY(this.node,i,"Start"),(a,{success:l})=>YY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const xV=new WeakMap,aU=new WeakMap,zNe=n=>{const e=xV.get(n.target);e&&e(n)},GNe=n=>{n.forEach(zNe)};function HNe({root:n,...e}){const i=n||document;aU.has(i)||aU.set(i,{});const a=aU.get(i),l=JSON.stringify(e);return a[l]||(a[l]=new IntersectionObserver(GNe,{root:n,...e})),a[l]}function $Ne(n,e,i){const a=HNe(e);return xV.set(n,i),a.observe(n),()=>{xV.delete(n),a.unobserve(n)}}const KNe={some:0,all:1};class qNe extends $g{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:u}=e,f={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:KNe[l]},_=E=>{const{isIntersecting:S}=E;if(this.isInView===S||(this.isInView=S,u&&!S&&this.hasEnteredView))return;S&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",S);const{onViewportEnter:w,onViewportLeave:I}=this.node.getProps(),k=S?w:I;k&&k(E)};return $Ne(this.node.current,f,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(YNe(e,i))&&this.startObserver()}unmount(){}}function YNe({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const XNe={inView:{Feature:qNe},tap:{Feature:WNe},focus:{Feature:BNe},hover:{Feature:FNe}},JNe={layout:{ProjectionNode:_ne,MeasureLayout:lne}},LV={current:null},yne={current:!1};function QNe(){if(yne.current=!0,!!EF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>LV.current=n.matches;n.addListener(e),e()}else LV.current=!1}const ZNe=[...zte,xa,Lg],eDe=n=>ZNe.find(Wte(n)),XY=new WeakMap;function tDe(n,e,i){for(const a in e){const l=e[a],u=i[a];if(Ua(l))n.addValue(a,l);else if(Ua(u))n.addValue(a,jC(l,{owner:n}));else if(u!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,jC(f!==void 0?f:l,{owner:n}))}}for(const a in i)e[a]===void 0&&n.removeValue(a);return e}const JY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class nDe{scrapeMotionValuesFromProps(e,i,a){return{}}constructor({parent:e,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:u,visualState:f},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=$F,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const U=cp.now();this.renderScheduledAt<U&&(this.renderScheduledAt=U,Yi.render(this.render,!1,!0))};const{latestValues:E,renderState:S,onUpdate:w}=f;this.onUpdate=w,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=S,this.parent=e,this.props=i,this.presenceContext=a,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!u,this.isControllingVariants=Xk(i),this.isVariantNode=Jee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...k}=this.scrapeMotionValuesFromProps(i,{},this);for(const U in k){const L=k[U];E[U]!==void 0&&Ua(L)&&L.set(E[U],!1)}}mount(e){this.current=e,XY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),yne.current||QNe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:LV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){XY.delete(this.current),this.projection&&this.projection.unmount(),xg(this.notifyUpdate),xg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const a=sE.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&Yi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),f&&f(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in C0){const i=C0[e];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[e]&&l&&a(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ls()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<JY.length;a++){const l=JY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,f=e[u];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=tDe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const a=this.values.get(e);i!==a&&(a&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let a=this.values.get(e);return a===void 0&&i!==void 0&&(a=jC(i===null?void 0:i,{owner:this}),this.addValue(e,a)),a}readValue(e,i){var a;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(a=this.getBaseTargetFromProps(this.props,e))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Fte(l)||kte(l))?l=parseFloat(l):!eDe(l)&&Lg.test(i)&&(l=Ute(e,i)),this.setBaseTarget(e,Ua(l)?l.get():l)),Ua(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=RF(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[e])}if(a&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!Ua(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new FF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Ene extends nDe{constructor(){super(...arguments),this.KeyframeResolver=Gte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:a}){delete i[e],delete a[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ua(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function rDe(n){return window.getComputedStyle(n)}class iDe extends Ene{constructor(){super(...arguments),this.type="html",this.renderInstance=ote}readValueFromInstance(e,i){if(sE.has(i)){const a=HF(i);return a&&a.default||0}else{const a=rDe(e),l=(rte(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return ane(e,i)}build(e,i,a){PF(e,i,a.transformTemplate)}scrapeMotionValuesFromProps(e,i,a){return DF(e,i,a)}}class sDe extends Ene{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ls}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(sE.has(i)){const a=HF(i);return a&&a.default||0}return i=ate.has(i)?i:TF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,a){return ute(e,i,a)}build(e,i,a){OF(e,i,this.isSVGTag,a.transformTemplate)}renderInstance(e,i,a,l){cte(e,i,a,l)}mount(e){this.isSVGTag=NF(e.tagName),super.mount(e)}}const oDe=(n,e)=>CF(n)?new sDe(e):new iDe(e,{allowProjection:n!==D.Fragment}),aDe=N1e({...Oke,...XNe,...jNe,...JNe},oDe),Sp=KPe(aDe),cDe=(n,e)=>n.find(i=>i.id===e);function QY(n,e){const i=vne(n,e),a=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:a}}function vne(n,e){for(const[i,a]of Object.entries(n))if(cDe(a,e))return i}function lDe(n){const e=n.includes("right"),i=n.includes("left");let a="center";return e&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function uDe(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:u,left:f}}var dDe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,hDe=Mee(function(n){return dDe.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),pDe=hDe,fDe=function(e){return e!=="theme"},ZY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?pDe:fDe},eX=function(e,i,a){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(f){return e.__emotion_forwardProp(f)&&u(f)}:u}return typeof l!="function"&&a&&(l=e.__emotion_forwardProp),l},mDe=function(e){var i=e.cache,a=e.serialized,l=e.isStringTag;return aF(i,a,l),Bee(function(){return cF(i,a,l)}),null},gDe=function n(e,i){var a=e.__emotion_real===e,l=a&&e.__emotion_base||e,u,f;i!==void 0&&(u=i.label,f=i.target);var _=eX(e,i,a),E=_||ZY(l),S=!E("as");return function(){var w=arguments,I=a&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&I.push("label:"+u+";"),w[0]==null||w[0].raw===void 0)I.push.apply(I,w);else{var k=w[0];I.push(k[0]);for(var U=w.length,L=1;L<U;L++)I.push(w[L],k[L])}var F=uF(function(B,q,$){var X=S&&B.as||l,oe="",re=[],pe=B;if(B.theme==null){pe={};for(var te in B)pe[te]=B[te];pe.theme=D.useContext(T0)}typeof B.className=="string"?oe=Vee(q.registered,re,B.className):B.className!=null&&(oe=B.className+" ");var Z=Hk(I.concat(re),q.registered,pe);oe+=q.key+"-"+Z.name,f!==void 0&&(oe+=" "+f);var ne=S&&_===void 0?ZY(X):E,ae={};for(var me in B)S&&me==="as"||ne(me)&&(ae[me]=B[me]);return ae.className=oe,$&&(ae.ref=$),D.createElement(D.Fragment,null,D.createElement(mDe,{cache:q,serialized:Z,isStringTag:typeof X=="string"}),D.createElement(X,ae))});return F.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",F.defaultProps=e.defaultProps,F.__emotion_real=F,F.__emotion_base=l,F.__emotion_styles=I,F.__emotion_forwardProp=_,Object.defineProperty(F,"toString",{value:function(){return"."+f}}),F.withComponent=function(B,q){var $=n(B,Gy({},i,q,{shouldForwardProp:eX(F,q,!0)}));return $.apply(void 0,I)},F}},_De=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],MV=gDe.bind(null);_De.forEach(function(n){MV[n]=MV(n)});const yDe=new Set([...V0e,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),EDe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function vDe(n){return(EDe.has(n)||!yDe.has(n))&&n[0]!=="_"}const SDe=hSe(MV),bDe=({baseStyle:n})=>e=>{const{theme:i,css:a,__css:l,sx:u,...f}=e,[_]=SSe(f,F0e),E=el(n,e),S=Zve({},l,E,dR(_),u),w=fee(S)(e.theme);return a?[w,a]:w};function cU(n,e){const{baseStyle:i,...a}=e??{};a.shouldForwardProp||(a.shouldForwardProp=vDe);const l=bDe({baseStyle:i}),u=SDe(n,a)(l);return D.forwardRef(function(E,S){const{children:w,...I}=E,{colorMode:k,forced:U}=Kk(),L=U?k:void 0;return D.createElement(u,{ref:S,"data-theme":L,...I},w)})}function TDe(){const n=new Map;return new Proxy(cU,{apply(e,i,a){return cU(...a)},get(e,i){return n.has(i)||n.set(i,cU(i)),n.get(i)}})}const kt=TDe(),wDe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let a=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Sne=D.memo(n=>{const{id:e,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:u=!1,position:f="bottom",duration:_=5e3,containerStyle:E,motionVariants:S=wDe,toastSpacing:w="0.5rem"}=n,[I,k]=D.useState(_),U=VPe();Dg(()=>{U||a==null||a()},[U]),Dg(()=>{k(_)},[_]);const L=()=>k(null),F=()=>k(_),B=()=>{U&&l()};D.useEffect(()=>{U&&u&&l()},[U,u,l]),zSe(B,I);const q=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:w,...E}),[E,w]),$=D.useMemo(()=>lDe(f),[f]);return b.jsx(Sp.div,{layout:!0,className:"chakra-toast",variants:S,initial:"initial",animate:"animate",exit:"exit",onHoverStart:L,onHoverEnd:F,custom:{position:f},style:$,children:b.jsx(kt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:q,children:el(i,{id:e,onClose:B})})})});Sne.displayName="ToastComponent";function Gt(n){return D.forwardRef(n)}var lU,tX;function CDe(){if(tX)return lU;tX=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,f){if(u===f)return!0;if(u&&f&&typeof u=="object"&&typeof f=="object"){if(u.constructor!==f.constructor)return!1;var _,E,S;if(Array.isArray(u)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(!l(u[E],f[E]))return!1;return!0}var w;if(e&&u instanceof Map&&f instanceof Map){if(u.size!==f.size)return!1;for(w=u.entries();!(E=w.next()).done;)if(!f.has(E.value[0]))return!1;for(w=u.entries();!(E=w.next()).done;)if(!l(E.value[1],f.get(E.value[0])))return!1;return!0}if(i&&u instanceof Set&&f instanceof Set){if(u.size!==f.size)return!1;for(w=u.entries();!(E=w.next()).done;)if(!f.has(E.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(f)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(u[E]!==f[E])return!1;return!0}if(u.constructor===RegExp)return u.source===f.source&&u.flags===f.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof f.valueOf=="function")return u.valueOf()===f.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof f.toString=="function")return u.toString()===f.toString();if(S=Object.keys(u),_=S.length,_!==Object.keys(f).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(f,S[E]))return!1;if(n&&u instanceof Element)return!1;for(E=_;E--!==0;)if(!((S[E]==="_owner"||S[E]==="__v"||S[E]==="__o")&&u.$$typeof)&&!l(u[S[E]],f[S[E]]))return!1;return!0}return u!==u&&f!==f}return lU=function(f,_){try{return l(f,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},lU}var RDe=CDe();const bne=Jf(RDe);function Kg(){const n=D.useContext(T0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Tne(){const n=Kk(),e=Kg();return{...n,theme:e}}function IDe(n,e,i){if(e==null)return e;const a=l=>{var u,f;return(f=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:f.value};return a(e)??a(i)??i}function ADe(n,e,i){const a=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const f=l.filter(Boolean),_=a.map((E,S)=>{const w=`${n}.${E}`;return IDe(u,w,f[S]??E)});return Array.isArray(e)?_:_[0]}}function wne(n,e={}){const{styleConfig:i,...a}=e,{theme:l,colorMode:u}=Tne(),f=n?qZ(l,`components.${n}`):void 0,_=i||f,E=Uu({theme:l,colorMode:u},(_==null?void 0:_.defaultProps)??{},dR($0(a,["children"])),(w,I)=>w?void 0:I),S=D.useRef({});if(_){const I=J0e(_)(E);bne(S.current,I)||(S.current=I)}return S.current}function al(n,e={}){return wne(n,e)}function Ba(n,e={}){return wne(n,e)}const nX={path:b.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[b.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),b.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),b.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Dn=Gt((n,e)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:u=!1,children:f,className:_,__css:E,...S}=n,w=ln("chakra-icon",_),I=al("Icon",n),k={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},U={ref:e,focusable:u,className:w,__css:k},L=a??nX.viewBox;if(i&&typeof i!="string")return b.jsx(kt.svg,{as:i,...U,...S});const F=f??nX.path;return b.jsx(kt.svg,{verticalAlign:"middle",viewBox:L,...U,...S,children:F})});Dn.displayName="Icon";function PDe(n){return b.jsx(Dn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function ODe(n){return b.jsx(Dn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function rX(n){return b.jsx(Dn,{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const kDe=mR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),la=Gt((n,e)=>{const i=al("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:f="transparent",className:_,...E}=Ii(n),S=ln("chakra-spinner",_),w={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${kDe} ${u} linear infinite`,...i};return b.jsx(kt.div,{ref:e,__css:w,className:S,...E,children:a&&b.jsx(kt.span,{srOnly:!0,children:a})})});la.displayName="Spinner";const[NDe,XF]=Ni({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[DDe,JF]=Ni({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Cne={info:{icon:ODe,colorScheme:"blue"},warning:{icon:rX,colorScheme:"orange"},success:{icon:PDe,colorScheme:"green"},error:{icon:rX,colorScheme:"red"},loading:{icon:la,colorScheme:"blue"}};function xDe(n){return Cne[n].colorScheme}function LDe(n){return Cne[n].icon}const Vu=Gt(function(e,i){const{status:a="info",addRole:l=!0,...u}=Ii(e),f=e.colorScheme??xDe(a),_=Ba("Alert",{...e,colorScheme:f}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return b.jsx(NDe,{value:{status:a},children:b.jsx(DDe,{value:_,children:b.jsx(kt.div,{"data-status":a,role:l?"alert":void 0,ref:i,...u,className:ln("chakra-alert",e.className),__css:E})})})});Vu.displayName="Alert";function ju(n){const{status:e}=XF(),i=LDe(e),a=JF(),l=e==="loading"?a.spinner:a.icon;return b.jsx(kt.span,{display:"inherit","data-status":e,...n,className:ln("chakra-alert__icon",n.className),__css:l,children:n.children||b.jsx(i,{h:"100%",w:"100%"})})}ju.displayName="AlertIcon";const WC=Gt(function(e,i){const a=JF(),{status:l}=XF();return b.jsx(kt.div,{ref:i,"data-status":l,...e,className:ln("chakra-alert__title",e.className),__css:a.title})});WC.displayName="AlertTitle";const zC=Gt(function(e,i){const{status:a}=XF(),l=JF(),u={display:"inline",...l.description};return b.jsx(kt.div,{ref:i,"data-status":a,...e,className:ln("chakra-alert__desc",e.className),__css:u})});zC.displayName="AlertDescription";function MDe(n){return b.jsx(Dn,{focusable:"false","aria-hidden":!0,...n,children:b.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const QF=Gt(function(e,i){const a=al("CloseButton",e),{children:l,isDisabled:u,__css:f,..._}=Ii(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return b.jsx(kt.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...E,...a,...f},..._,children:l||b.jsx(MDe,{width:"1em",height:"1em"})})});QF.displayName="CloseButton";const UDe=n=>{const{status:e,variant:i="solid",id:a,title:l,isClosable:u,onClose:f,description:_,colorScheme:E,icon:S}=n,w=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return b.jsxs(Vu,{addRole:!1,status:e,variant:i,id:w==null?void 0:w.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[b.jsx(ju,{children:S}),b.jsxs(kt.div,{flex:"1",maxWidth:"100%",children:[l&&b.jsx(WC,{id:w==null?void 0:w.title,children:l}),_&&b.jsx(zC,{id:w==null?void 0:w.description,display:"block",children:_})]}),u&&b.jsx(QF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function Rne(n={}){const{render:e,toastComponent:i=UDe}=n;return l=>typeof e=="function"?e({...l,...n}):b.jsx(i,{...l,...n})}const VDe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},ep=jDe(VDe);function jDe(n){let e=n;const i=new Set,a=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,u)=>{a(f=>({...f,[u]:f[u].filter(_=>_.id!=l)}))},notify:(l,u)=>{const f=FDe(l,u),{position:_,id:E}=f;return a(S=>{const I=_.includes("top")?[f,...S[_]??[]]:[...S[_]??[],f];return{...S,[_]:I}}),E},update:(l,u)=>{l&&a(f=>{const _={...f},{position:E,index:S}=QY(_,l);return E&&S!==-1&&(_[E][S]={..._[E][S],...u,message:Rne(u)}),_})},closeAll:({positions:l}={})=>{a(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,S)=>(E[S]=u[S].map(w=>({...w,requestClose:!0})),E),{...u}))},close:l=>{a(u=>{const f=vne(u,l);return f?{...u,[f]:u[f].map(_=>_.id==l?{..._,requestClose:!0}:_)}:u})},isActive:l=>!!QY(ep.getState(),l).position}}let iX=0;function FDe(n,e={}){iX+=1;const i=e.id??iX,a=e.position??"bottom";return{id:i,message:n,position:a,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>ep.removeToast(String(i),a),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}const[Ine,BDe]=Ni({strict:!1,name:"PortalContext"}),ZF="chakra-portal",WDe=".chakra-portal",zDe=n=>b.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),GDe=n=>{const{appendToParentPortal:e,children:i}=n,[a,l]=D.useState(null),u=D.useRef(null),[,f]=D.useState({});D.useEffect(()=>f({}),[]);const _=BDe(),E=kPe();Mf(()=>{if(!a)return;const w=a.ownerDocument,I=e?_??w.body:w.body;if(!I)return;u.current=w.createElement("div"),u.current.className=ZF,I.appendChild(u.current),f({});const k=u.current;return()=>{I.contains(k)&&I.removeChild(k)}},[a]);const S=E!=null&&E.zIndex?b.jsx(zDe,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return u.current?PZ.createPortal(b.jsx(Ine,{value:u.current,children:S}),u.current):b.jsx("span",{ref:w=>{w&&l(w)}})},HDe=n=>{const{children:e,containerRef:i,appendToParentPortal:a}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),f=D.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=ZF),E},[l]),[,_]=D.useState({});return Mf(()=>_({}),[]),Mf(()=>{if(!(!f||!u))return u.appendChild(f),()=>{u.removeChild(f)}},[f,u]),u&&f?PZ.createPortal(b.jsx(Ine,{value:a?f:null,children:e}),f):null};function $l(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...a}=e;return i?b.jsx(HDe,{containerRef:i,...a}):b.jsx(GDe,{...a})}$l.className=ZF;$l.selector=WDe;$l.displayName="Portal";const[$De,KDe]=Ni({name:"ToastOptionsContext",strict:!1}),qDe=n=>{const e=D.useSyncExternalStore(ep.subscribe,ep.getState,ep.getState),{motionVariants:i,component:a=Sne,portalProps:l,animatePresenceProps:u}=n,_=Object.keys(e).map(E=>{const S=e[E];return b.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:uDe(E),children:b.jsx(iE,{...u,initial:!1,children:S.map(w=>b.jsx(a,{motionVariants:i,...w},w.id))})},E)});return b.jsx($l,{...l,children:_})},YDe=n=>function({children:i,theme:a=n,toastOptions:l,...u}){return b.jsxs(DPe,{theme:a,...u,children:[b.jsx($De,{value:l==null?void 0:l.defaultOptions,children:i}),b.jsx(qDe,{...l})]})},Ane=YDe(Pee);function sX(n){return n.sort((e,i)=>{const a=e.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const XDe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function oX(n,e,i){let a=n+1;return i&&a>=e&&(a=0),a}function aX(n,e,i){let a=n-1;return i&&a<0&&(a=e),a}const uU=typeof window<"u"?D.useLayoutEffect:D.useEffect,cX=n=>n;var JDe=Object.defineProperty,QDe=(n,e,i)=>e in n?JDe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Cs=(n,e,i)=>(QDe(n,typeof e!="symbol"?e+"":e,i),i);class ZDe{constructor(){Cs(this,"descendants",new Map),Cs(this,"register",e=>{if(e!=null)return XDe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Cs(this,"unregister",e=>{this.descendants.delete(e);const i=sX(Array.from(this.descendants.keys()));this.assignIndex(i)}),Cs(this,"destroy",()=>{this.descendants.clear()}),Cs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const a=e.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),Cs(this,"count",()=>this.descendants.size),Cs(this,"enabledCount",()=>this.enabledValues().length),Cs(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),Cs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Cs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Cs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Cs(this,"first",()=>this.item(0)),Cs(this,"firstEnabled",()=>this.enabledItem(0)),Cs(this,"last",()=>this.item(this.descendants.size-1)),Cs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Cs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Cs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Cs(this,"next",(e,i=!0)=>{const a=oX(e,this.count(),i);return this.item(a)}),Cs(this,"nextEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),u=oX(l,this.enabledCount(),i);return this.enabledItem(u)}),Cs(this,"prev",(e,i=!0)=>{const a=aX(e,this.count()-1,i);return this.item(a)}),Cs(this,"prevEnabled",(e,i=!0)=>{const a=this.item(e);if(!a)return;const l=this.enabledIndexOf(a.node),u=aX(l,this.enabledCount()-1,i);return this.enabledItem(u)}),Cs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const a=Array.from(this.descendants.keys()).concat(e),l=sX(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function Pne(){const[n,e]=Ni({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=D.useRef(new ZDe);return uU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[f,_]=D.useState(-1),E=D.useRef(null);uU(()=>()=>{E.current&&u.unregister(E.current)},[]),uU(()=>{if(!E.current)return;const w=Number(E.current.dataset.index);f!=w&&!Number.isNaN(w)&&_(w)});const S=cX(l?u.register(l):u.register);return{descendants:u,index:f,enabledIndex:u.enabledIndexOf(E.current),register:Ki(S,E)}}]}const e0={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},jy={enter:{duration:.2,ease:e0.easeOut},exit:{duration:.1,ease:e0.easeIn}},Ff={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},exe=n=>n!=null&&parseInt(n.toString(),10)>0,lX={exit:{height:{duration:.2,ease:e0.ease},opacity:{duration:.3,ease:e0.ease}},enter:{height:{duration:.3,ease:e0.ease},opacity:{duration:.4,ease:e0.ease}}},txe={exit:({animateOpacity:n,startingHeight:e,transition:i,transitionEnd:a,delay:l})=>({...n&&{opacity:exe(e)?1:0},height:e,transitionEnd:a==null?void 0:a.exit,transition:(i==null?void 0:i.exit)??Ff.exit(lX.exit,l)}),enter:({animateOpacity:n,endingHeight:e,transition:i,transitionEnd:a,delay:l})=>({...n&&{opacity:1},height:e,transitionEnd:a==null?void 0:a.enter,transition:(i==null?void 0:i.enter)??Ff.enter(lX.enter,l)})},One=D.forwardRef((n,e)=>{const{in:i,unmountOnExit:a,animateOpacity:l=!0,startingHeight:u=0,endingHeight:f="auto",style:_,className:E,transition:S,transitionEnd:w,animatePresenceProps:I,...k}=n,[U,L]=D.useState(!1);D.useEffect(()=>{const X=setTimeout(()=>{L(!0)});return()=>clearTimeout(X)},[]);const F=parseFloat(u.toString())>0,B={startingHeight:u,endingHeight:f,animateOpacity:l,transition:U?S:{enter:{duration:0}},transitionEnd:{enter:w==null?void 0:w.enter,exit:a?w==null?void 0:w.exit:{...w==null?void 0:w.exit,display:F?"block":"none"}}},q=a?i:!0,$=i||a?"enter":"exit";return b.jsx(iE,{...I,initial:!1,custom:B,children:q&&b.jsx(Sp.div,{ref:e,...k,className:ln("chakra-collapse",E),style:{overflow:"hidden",display:"block",..._},custom:B,variants:txe,initial:a?"exit":!1,animate:$,exit:"exit"})})});One.displayName="Collapse";const[nxe,rxe]=Ni({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function ixe(n){const e=n.trim().split(" "),i=e[0]??"",a=e.length>1?e[e.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function kne(n){const{name:e,getInitials:i,...a}=n,l=rxe();return b.jsx(kt.div,{role:"img","aria-label":e,...a,__css:l.label,children:e?i==null?void 0:i(e):null})}kne.displayName="AvatarName";const Nne=n=>b.jsxs(kt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[b.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),b.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Dne(n){const{loading:e,src:i,srcSet:a,onLoad:l,onError:u,crossOrigin:f,sizes:_,ignoreFallback:E}=n,[S,w]=D.useState("pending");D.useEffect(()=>{w(i?"loading":"pending")},[i]);const I=D.useRef(null),k=D.useCallback(()=>{if(!i)return;U();const L=new Image;L.src=i,f&&(L.crossOrigin=f),a&&(L.srcset=a),_&&(L.sizes=_),e&&(L.loading=e),L.onload=F=>{U(),w("loaded"),l==null||l(F)},L.onerror=F=>{U(),w("failed"),u==null||u(F)},I.current=L},[i,f,a,_,l,u,e]),U=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return Mf(()=>{if(!E)return S==="loading"&&k(),()=>{U()}},[S,k,E]),E?"loaded":S}const sxe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function xne(n){const{src:e,srcSet:i,onError:a,onLoad:l,getInitials:u,name:f,borderRadius:_,loading:E,iconLabel:S,icon:w=b.jsx(Nne,{}),ignoreFallback:I,referrerPolicy:k,crossOrigin:U}=n,F=Dne({src:e,onError:a,crossOrigin:U,ignoreFallback:I})==="loaded";return!e||!F?f?b.jsx(kne,{className:"chakra-avatar__initials",getInitials:u,name:f}):D.cloneElement(w,{role:"img","aria-label":S}):b.jsx(kt.img,{src:e,srcSet:i,alt:f??S,onLoad:l,referrerPolicy:k,crossOrigin:U??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}xne.displayName="AvatarImage";const oxe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Wu=Gt((n,e)=>{const i=Ba("Avatar",n),[a,l]=D.useState(!1),{src:u,srcSet:f,name:_,showBorder:E,borderRadius:S="full",onError:w,onLoad:I,getInitials:k=ixe,icon:U=b.jsx(Nne,{}),iconLabel:L=" avatar",loading:F,children:B,borderColor:q,ignoreFallback:$,crossOrigin:X,referrerPolicy:oe,...re}=Ii(n),pe={borderRadius:S,borderWidth:E?"2px":void 0,...oxe,...i.container};return q&&(pe.borderColor=q),b.jsx(kt.span,{ref:e,...re,className:ln("chakra-avatar",n.className),"data-loaded":pn(a),__css:pe,children:b.jsxs(nxe,{value:i,children:[b.jsx(xne,{src:u,srcSet:f,loading:F,onLoad:Rn(I,()=>{l(!0)}),onError:w,getInitials:k,name:_,borderRadius:S,icon:U,iconLabel:L,ignoreFallback:$,crossOrigin:X,referrerPolicy:oe}),B]})})});Wu.displayName="Avatar";const zd=Gt(function(e,i){const a=al("Badge",e),{className:l,...u}=Ii(e);return b.jsx(kt.span,{ref:i,className:ln("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});zd.displayName="Badge";const Xe=kt("div");Xe.displayName="Box";const[wGe,axe]=Ni({strict:!1,name:"ButtonGroupContext"});function Jw(n){const{children:e,className:i,...a}=n,l=D.isValidElement(e)?D.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=ln("chakra-button__icon",i);return b.jsx(kt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:u,children:l})}Jw.displayName="ButtonIcon";function UV(n){const{label:e,placement:i,spacing:a="0.5rem",children:l=b.jsx(la,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:f,..._}=n,E=ln("chakra-button__spinner",u),S=i==="start"?"marginEnd":"marginStart",w=D.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[S]:e?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,e,S,a]);return b.jsx(kt.div,{className:E,..._,__css:w,children:l})}UV.displayName="ButtonSpinner";function cxe(n){const[e,i]=D.useState(!n);return{ref:D.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const Ar=Gt((n,e)=>{const i=axe(),a=al("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:f,children:_,leftIcon:E,rightIcon:S,loadingText:w,iconSpacing:I="0.5rem",type:k,spinner:U,spinnerPlacement:L="start",className:F,as:B,shouldWrapChildren:q,...$}=Ii(n),X=D.useMemo(()=>{const te={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:te}}},[a,i]),{ref:oe,type:re}=cxe(B),pe={rightIcon:S,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:q};return b.jsxs(kt.button,{disabled:l||u,ref:WSe(e,oe),as:B,type:k??re,"data-active":pn(f),"data-loading":pn(u),__css:X,className:ln("chakra-button",F),...$,children:[u&&L==="start"&&b.jsx(UV,{className:"chakra-button__spinner--start",label:w,placement:"start",spacing:I,children:U}),u?w||b.jsx(kt.span,{opacity:0,children:b.jsx(uX,{...pe})}):b.jsx(uX,{...pe}),u&&L==="end"&&b.jsx(UV,{className:"chakra-button__spinner--end",label:w,placement:"end",spacing:I,children:U})]})});Ar.displayName="Button";function uX(n){const{leftIcon:e,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:u}=n;return u?b.jsxs("span",{style:{display:"contents"},children:[e&&b.jsx(Jw,{marginEnd:l,children:e}),a,i&&b.jsx(Jw,{marginStart:l,children:i})]}):b.jsxs(b.Fragment,{children:[e&&b.jsx(Jw,{marginEnd:l,children:e}),a,i&&b.jsx(Jw,{marginStart:l,children:i})]})}const Ys=Gt((n,e)=>{const{icon:i,children:a,isRound:l,"aria-label":u,...f}=n,_=i||a,E=D.isValidElement(_)?D.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return b.jsx(Ar,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...f,children:E})});Ys.displayName="IconButton";const[lxe,Lne]=APe("Card"),W1=Gt(function(e,i){const{className:a,children:l,direction:u="column",justify:f,align:_,...E}=Ii(e),S=Ba("Card",e);return b.jsx(kt.div,{ref:i,className:ln("chakra-card",a),__css:{display:"flex",flexDirection:u,justifyContent:f,alignItems:_,position:"relative",minWidth:0,wordWrap:"break-word",...S.container},...E,children:b.jsx(lxe,{value:S,children:l})})}),z1=Gt(function(e,i){const{className:a,...l}=e,u=Lne();return b.jsx(kt.div,{ref:i,className:ln("chakra-card__body",a),__css:u.body,...l})}),dX=Gt(function(e,i){const{className:a,justify:l,...u}=e,f=Lne();return b.jsx(kt.div,{ref:i,className:ln("chakra-card__footer",a),__css:{display:"flex",justifyContent:l,...f.footer},...u})}),Zk=kt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Zk.displayName="Center";const uxe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Gt(function(e,i){const{axis:a="both",...l}=e;return b.jsx(kt.div,{ref:i,__css:uxe[a],...l,position:"absolute"})});var dxe=()=>typeof document<"u",hX=!1,SR=null,Hy=!1,VV=!1,jV=new Set;function e5(n,e){jV.forEach(i=>i(n,e))}var hxe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function pxe(n){return!(n.metaKey||!hxe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function pX(n){Hy=!0,pxe(n)&&(SR="keyboard",e5("keyboard",n))}function OS(n){if(SR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Hy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;e5("pointer",n)}}function fxe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function mxe(n){fxe(n)&&(Hy=!0,SR="virtual")}function gxe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Hy&&!VV&&(SR="virtual",e5("virtual",n)),Hy=!1,VV=!1)}function _xe(){Hy=!1,VV=!0}function fX(){return SR!=="pointer"}function yxe(){if(!dxe()||hX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Hy=!0,n.apply(this,i)},document.addEventListener("keydown",pX,!0),document.addEventListener("keyup",pX,!0),document.addEventListener("click",mxe,!0),window.addEventListener("focus",gxe,!0),window.addEventListener("blur",_xe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",OS,!0),document.addEventListener("pointermove",OS,!0),document.addEventListener("pointerup",OS,!0)):(document.addEventListener("mousedown",OS,!0),document.addEventListener("mousemove",OS,!0),document.addEventListener("mouseup",OS,!0)),hX=!0}function Mne(n){yxe(),n(fX());const e=()=>n(fX());return jV.add(e),()=>{jV.delete(e)}}const[Exe,Une]=Ni({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[vxe,oE]=Ni({strict:!1,name:"FormControlContext"});function Sxe(n){const{id:e,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:u,...f}=n,_=D.useId(),E=e||`field-${_}`,S=`${E}-label`,w=`${E}-feedback`,I=`${E}-helptext`,[k,U]=D.useState(!1),[L,F]=D.useState(!1),[B,q]=D.useState(!1),$=D.useCallback((te={},Z=null)=>({id:I,...te,ref:Ki(Z,ne=>{ne&&F(!0)})}),[I]),X=D.useCallback((te={},Z=null)=>({...te,ref:Z,"data-focus":pn(B),"data-disabled":pn(l),"data-invalid":pn(a),"data-readonly":pn(u),id:te.id!==void 0?te.id:S,htmlFor:te.htmlFor!==void 0?te.htmlFor:E}),[E,l,B,a,u,S]),oe=D.useCallback((te={},Z=null)=>({id:w,...te,ref:Ki(Z,ne=>{ne&&U(!0)}),"aria-live":"polite"}),[w]),re=D.useCallback((te={},Z=null)=>({...te,...f,ref:Z,role:"group","data-focus":pn(B),"data-disabled":pn(l),"data-invalid":pn(a),"data-readonly":pn(u)}),[f,l,B,a,u]),pe=D.useCallback((te={},Z=null)=>({...te,ref:Z,role:"presentation","aria-hidden":!0,children:te.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!u,isDisabled:!!l,isFocused:!!B,onFocus:()=>q(!0),onBlur:()=>q(!1),hasFeedbackText:k,setHasFeedbackText:U,hasHelpText:L,setHasHelpText:F,id:E,labelId:S,feedbackId:w,helpTextId:I,htmlProps:f,getHelpTextProps:$,getErrorMessageProps:oe,getRootProps:re,getLabelProps:X,getRequiredIndicatorProps:pe}}const kn=Gt(function(e,i){const a=Ba("Form",e),l=Ii(e),{getRootProps:u,htmlProps:f,..._}=Sxe(l),E=ln("chakra-form-control",e.className);return b.jsx(vxe,{value:_,children:b.jsx(Exe,{value:a,children:b.jsx(kt.div,{...u({},i),className:E,__css:a.container})})})});kn.displayName="FormControl";const GC=Gt(function(e,i){const a=oE(),l=Une(),u=ln("chakra-form__helper-text",e.className);return b.jsx(kt.div,{...a==null?void 0:a.getHelpTextProps(e,i),__css:l.helperText,className:u})});GC.displayName="FormHelperText";function t5(n){const{isDisabled:e,isInvalid:i,isReadOnly:a,isRequired:l,...u}=Vne(n);return{...u,disabled:e,readOnly:a,required:l,"aria-invalid":Lf(i),"aria-required":Lf(l),"aria-readonly":Lf(a)}}function Vne(n){const e=oE(),{id:i,disabled:a,readOnly:l,required:u,isRequired:f,isInvalid:_,isReadOnly:E,isDisabled:S,onFocus:w,onBlur:I,...k}=n,U=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&U.push(e.feedbackId),e!=null&&e.hasHelpText&&U.push(e.helpTextId),{...k,"aria-describedby":U.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:a??S??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:u??f??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:Rn(e==null?void 0:e.onFocus,w),onBlur:Rn(e==null?void 0:e.onBlur,I)}}const jne={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function bxe(n={}){const e=Vne(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:u,id:f,onBlur:_,onFocus:E,"aria-describedby":S}=e,{defaultChecked:w,isChecked:I,isFocusable:k,onChange:U,isIndeterminate:L,name:F,value:B,tabIndex:q=void 0,"aria-label":$,"aria-labelledby":X,"aria-invalid":oe,...re}=n,pe=$0(re,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),te=nl(U),Z=nl(_),ne=nl(E),[ae,me]=D.useState(!1),[he,ue]=D.useState(!1),[Ue,ze]=D.useState(!1),[tt,Ce]=D.useState(!1);D.useEffect(()=>Mne(me),[]);const Ie=D.useRef(null),[ye,ke]=D.useState(!0),[Te,ve]=D.useState(!!w),Re=I!==void 0,Me=Re?I:Te,Ge=D.useCallback(Qt=>{if(a||i){Qt.preventDefault();return}Re||ve(Me?Qt.currentTarget.checked:L?!0:Qt.currentTarget.checked),te==null||te(Qt)},[a,i,Me,Re,L,te]);Mf(()=>{Ie.current&&(Ie.current.indeterminate=!!L)},[L]),Dg(()=>{i&&ue(!1)},[i,ue]),Mf(()=>{const Qt=Ie.current;if(!(Qt!=null&&Qt.form))return;const Ot=()=>{ve(!!w)};return Qt.form.addEventListener("reset",Ot),()=>{var Lt;return(Lt=Qt.form)==null?void 0:Lt.removeEventListener("reset",Ot)}},[]);const Qe=i&&!k,nt=D.useCallback(Qt=>{Qt.key===" "&&Ce(!0)},[Ce]),ht=D.useCallback(Qt=>{Qt.key===" "&&Ce(!1)},[Ce]);Mf(()=>{if(!Ie.current)return;Ie.current.checked!==Me&&ve(Ie.current.checked)},[Ie.current]);const it=D.useCallback((Qt={},Ot=null)=>{const Lt=we=>{he&&we.preventDefault(),Ce(!0)};return{...Qt,ref:Ot,"data-active":pn(tt),"data-hover":pn(Ue),"data-checked":pn(Me),"data-focus":pn(he),"data-focus-visible":pn(he&&ae),"data-indeterminate":pn(L),"data-disabled":pn(i),"data-invalid":pn(u),"data-readonly":pn(a),"aria-hidden":!0,onMouseDown:Rn(Qt.onMouseDown,Lt),onMouseUp:Rn(Qt.onMouseUp,()=>Ce(!1)),onMouseEnter:Rn(Qt.onMouseEnter,()=>ze(!0)),onMouseLeave:Rn(Qt.onMouseLeave,()=>ze(!1))}},[tt,Me,i,he,ae,Ue,L,u,a]),It=D.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ot,"data-active":pn(tt),"data-hover":pn(Ue),"data-checked":pn(Me),"data-focus":pn(he),"data-focus-visible":pn(he&&ae),"data-indeterminate":pn(L),"data-disabled":pn(i),"data-invalid":pn(u),"data-readonly":pn(a)}),[tt,Me,i,he,ae,Ue,L,u,a]),jt=D.useCallback((Qt={},Ot=null)=>({...pe,htmlFor:ye?f:void 0,...Qt,ref:Ki(Ot,Lt=>{Lt&&ke(Lt.tagName==="LABEL")}),onClick:Rn(Qt.onClick,()=>{var Lt;ye||((Lt=Ie.current)==null||Lt.click(),requestAnimationFrame(()=>{var we;(we=Ie.current)==null||we.focus({preventScroll:!0})}))}),"data-disabled":pn(i),"data-checked":pn(Me),"data-invalid":pn(u)}),[pe,i,Me,u,ye,f]),Dt=D.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ki(Ie,Ot),type:"checkbox",name:F,value:B,id:f,tabIndex:q,onChange:Rn(Qt.onChange,Ge),onBlur:Rn(Qt.onBlur,Z,()=>ue(!1)),onFocus:Rn(Qt.onFocus,ne,()=>ue(!0)),onKeyDown:Rn(Qt.onKeyDown,nt),onKeyUp:Rn(Qt.onKeyUp,ht),required:l,checked:Me,disabled:Qe,readOnly:a,"aria-label":$,"aria-labelledby":X,"aria-invalid":oe?!!oe:u,"aria-describedby":S,"aria-disabled":i,"aria-checked":L?"mixed":Me,style:jne}),[F,B,f,q,Ge,Z,ne,nt,ht,l,Me,Qe,a,$,X,oe,u,S,i,L]),an=D.useCallback((Qt={},Ot=null)=>({...Qt,ref:Ot,onMouseDown:Rn(Qt.onMouseDown,Txe),"data-disabled":pn(i),"data-checked":pn(Me),"data-invalid":pn(u)}),[Me,i,u]);return{state:{isInvalid:u,isFocused:he,isChecked:Me,isActive:tt,isHovered:Ue,isIndeterminate:L,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:jt,getCheckboxProps:it,getIndicatorProps:It,getInputProps:Dt,getLabelProps:an,htmlProps:pe}}function Txe(n){n.preventDefault(),n.stopPropagation()}const Qw=Gt(function(e,i){const a=al("Code",e),{className:l,...u}=Ii(e);return b.jsx(kt.code,{ref:i,className:ln("chakra-code",e.className),...u,__css:{display:"inline-block",...a}})});Qw.displayName="Code";const Wl=Gt(function(e,i){const{className:a,centerContent:l,...u}=Ii(e),f=al("Container",e);return b.jsx(kt.div,{ref:i,className:ln("chakra-container",a),...u,__css:{...f,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});Wl.displayName="Container";const uo=Gt(function(e,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:f,borderWidth:_,borderStyle:E,borderColor:S,...w}=al("Divider",e),{className:I,orientation:k="horizontal",__css:U,...L}=Ii(e),F={vertical:{borderLeftWidth:a||f||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||_||"1px",width:"100%"}};return b.jsx(kt.hr,{ref:i,"aria-orientation":k,...L,__css:{...w,border:"0",borderColor:S,borderStyle:E,...F[k],...U},className:ln("chakra-divider",I)})});uo.displayName="Divider";function Zw(n){return typeof n=="function"}function wxe(...n){return e=>n.reduce((i,a)=>a(i),e)}const Cxe=n=>function(...i){let a=[...i],l=i[i.length-1];return bAe(l)&&a.length>1?a=a.slice(0,a.length-1):l=n,wxe(...a.map(u=>f=>Zw(u)?u(f):Ixe(f,u)))(l)},Rxe=Cxe(Pee);function Ixe(...n){return Uu({},...n,Fne)}function Fne(n,e,i,a){if((Zw(n)||Zw(e))&&Object.prototype.hasOwnProperty.call(a,i))return(...l)=>{const u=Zw(n)?n(...l):n,f=Zw(e)?e(...l):e;return Uu({},u,f,Fne)};if(po(n)&&iV(e)||iV(n)&&po(e))return e}const sr=Gt(function(e,i){const{direction:a,align:l,justify:u,wrap:f,basis:_,grow:E,shrink:S,...w}=e,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:u,flexWrap:f,flexBasis:_,flexGrow:E,flexShrink:S};return b.jsx(kt.div,{ref:i,__css:I,...w})});sr.displayName="Flex";function Axe(n,e){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(e.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var dU={exports:{}},hU,mX;function Pxe(){if(mX)return hU;mX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return hU=n,hU}var pU,gX;function Oxe(){if(gX)return pU;gX=1;var n=Pxe();function e(){}function i(){}return i.resetWarningCache=e,pU=function(){function a(f,_,E,S,w,I){if(I!==n){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}a.isRequired=a;function l(){return a}var u={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},pU}var _X;function kxe(){return _X||(_X=1,dU.exports=Oxe()()),dU.exports}var Nxe=kxe();const Hr=Jf(Nxe);var FV="data-focus-lock",Bne="data-focus-lock-disabled",Dxe="data-no-focus-lock",xxe="data-autofocus-inside",Lxe="data-no-autofocus";function fU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Mxe(n,e){var i=D.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=e,i.facade}var Uxe=typeof window<"u"?D.useLayoutEffect:D.useEffect,yX=new WeakMap;function Wne(n,e){var i=Mxe(null,function(a){return n.forEach(function(l){return fU(l,a)})});return Uxe(function(){var a=yX.get(i);if(a){var l=new Set(a),u=new Set(n),f=i.current;l.forEach(function(_){u.has(_)||fU(_,null)}),u.forEach(function(_){l.has(_)||fU(_,f)})}yX.set(i,n)},[n]),i}var mU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},tp=function(){return tp=Object.assign||function(e){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},tp.apply(this,arguments)};function bR(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function Vxe(n,e,i){if(i||arguments.length===2)for(var a=0,l=e.length,u;a<l;a++)(u||!(a in e))&&(u||(u=Array.prototype.slice.call(e,0,a)),u[a]=e[a]);return n.concat(u||Array.prototype.slice.call(e))}function zne(n){return n}function Gne(n,e){e===void 0&&(e=zne);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var f=e(u,a);return i.push(f),function(){i=i.filter(function(_){return _!==f})}},assignSyncMedium:function(u){for(a=!0;i.length;){var f=i;i=[],f.forEach(u)}i={push:function(_){return u(_)},filter:function(){return i}}},assignMedium:function(u){a=!0;var f=[];if(i.length){var _=i;i=[],_.forEach(u),f=i}var E=function(){var w=f;f=[],w.forEach(u)},S=function(){return Promise.resolve().then(E)};S(),i={push:function(w){f.push(w),S()},filter:function(w){return f=f.filter(w),i}}}};return l}function n5(n,e){return e===void 0&&(e=zne),Gne(n,e)}function Hne(n){n===void 0&&(n={});var e=Gne(null);return e.options=tp({async:!0,ssr:!1},n),e}var $ne=function(n){var e=n.sideCar,i=bR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=e.read();if(!a)throw new Error("Sidecar medium not found");return D.createElement(a,tp({},i))};$ne.isSideCarExport=!0;function jxe(n,e){return n.useMedium(e),$ne}var Kne=n5({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),qne=n5(),Fxe=n5(),Bxe=Hne({async:!0,ssr:typeof document<"u"}),Wxe=D.createContext(void 0),zxe=[],r5=D.forwardRef(function(e,i){var a,l=D.useState(),u=l[0],f=l[1],_=D.useRef(),E=D.useRef(!1),S=D.useRef(null),w=D.useState({}),I=w[1],k=e.children,U=e.disabled,L=U===void 0?!1:U,F=e.noFocusGuards,B=F===void 0?!1:F,q=e.persistentFocus,$=q===void 0?!1:q,X=e.crossFrame,oe=X===void 0?!0:X,re=e.autoFocus,pe=re===void 0?!0:re;e.allowTextSelection;var te=e.group,Z=e.className,ne=e.whiteList,ae=e.hasPositiveIndices,me=e.shards,he=me===void 0?zxe:me,ue=e.as,Ue=ue===void 0?"div":ue,ze=e.lockProps,tt=ze===void 0?{}:ze,Ce=e.sideCar,Ie=e.returnFocus,ye=Ie===void 0?!1:Ie,ke=e.focusOptions,Te=e.onActivation,ve=e.onDeactivation,Re=D.useState({}),Me=Re[0],Ge=D.useCallback(function(Ot){var Lt=Ot.captureFocusRestore;if(!S.current){var we,Ve=(we=document)==null?void 0:we.activeElement;S.current=Ve,Ve!==document.body&&(S.current=Lt(Ve))}_.current&&Te&&Te(_.current),E.current=!0,I()},[Te]),Qe=D.useCallback(function(){E.current=!1,ve&&ve(_.current),I()},[ve]),nt=D.useCallback(function(Ot){var Lt=S.current;if(Lt){var we=(typeof Lt=="function"?Lt():Lt)||document.body,Ve=typeof ye=="function"?ye(we):ye;if(Ve){var $e=typeof Ve=="object"?Ve:void 0;S.current=null,Ot?Promise.resolve().then(function(){return we.focus($e)}):we.focus($e)}}},[ye]),ht=D.useCallback(function(Ot){E.current&&Kne.useMedium(Ot)},[]),it=qne.useMedium,It=D.useCallback(function(Ot){_.current!==Ot&&(_.current=Ot,f(Ot))},[]),jt=Gy((a={},a[Bne]=L&&"disabled",a[FV]=te,a),tt),Dt=B!==!0,an=Dt&&B!=="tail",jn=Wne([i,It]),Qt=D.useMemo(function(){return{observed:_,shards:he,enabled:!L,active:E.current}},[L,E.current,he,u]);return mr.createElement(D.Fragment,null,Dt&&[mr.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:L?-1:0,style:mU}),ae?mr.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:L?-1:1,style:mU}):null],!L&&mr.createElement(Ce,{id:Me,sideCar:Bxe,observed:u,disabled:L,persistentFocus:$,crossFrame:oe,autoFocus:pe,whiteList:ne,shards:he,onActivation:Ge,onDeactivation:Qe,returnFocus:nt,focusOptions:ke,noFocusGuards:B}),mr.createElement(Ue,Gy({ref:jn},jt,{className:Z,onBlur:it,onFocus:ht}),mr.createElement(Wxe.Provider,{value:Qt},k)),an&&mr.createElement("div",{"data-focus-guard":!0,tabIndex:L?-1:0,style:mU}))});r5.propTypes={};function BV(n,e){return BV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},BV(n,e)}function Gxe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,BV(n,e)}function HC(n){"@babel/helpers - typeof";return HC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},HC(n)}function Hxe(n,e){if(HC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,e);if(HC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function $xe(n){var e=Hxe(n,"string");return HC(e)=="symbol"?e:e+""}function Kxe(n,e,i){return(e=$xe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function qxe(n,e){function i(a){return a.displayName||a.name||"Component"}return function(l){var u=[],f;function _(){f=n(u.map(function(S){return S.props})),e(f)}var E=function(S){Gxe(w,S);function w(){return S.apply(this,arguments)||this}w.peek=function(){return f};var I=w.prototype;return I.componentDidMount=function(){u.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var U=u.indexOf(this);u.splice(U,1),_()},I.render=function(){return mr.createElement(l,this.props)},w}(D.PureComponent);return Kxe(E,"displayName","SideEffect("+i(l)+")"),E}}var bp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},$y=function(n){return Array.isArray(n)?n:[n]},Yne=function(n){return Array.isArray(n)?n[0]:n},Yxe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Xne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Jne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},Xxe=function(n){return n.hasAttribute("inert")},Jxe=function(n,e){return!n||Jne(n)||!Yxe(n)&&!Xxe(n)&&e(Xne(n))},Qne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=Jxe(e,Qne.bind(void 0,n));return n.set(e,a),a},Qxe=function(n,e){return n&&!Jne(n)?tLe(n)?e(Xne(n)):!1:!0},Zne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var a=Qxe(e,Zne.bind(void 0,n));return n.set(e,a),a},ere=function(n){return n.dataset},Zxe=function(n){return n.tagName==="BUTTON"},tre=function(n){return n.tagName==="INPUT"},nre=function(n){return tre(n)&&n.type==="radio"},eLe=function(n){return!((tre(n)||Zxe(n))&&(n.type==="hidden"||n.disabled))},tLe=function(n){var e=n.getAttribute(Lxe);return![!0,"true",""].includes(e)},i5=function(n){var e;return!!(n&&(!((e=ere(n))===null||e===void 0)&&e.focusGuard))},WV=function(n){return!i5(n)},nLe=function(n){return!!n},rLe=function(n,e){var i=Math.max(0,n.tabIndex),a=Math.max(0,e.tabIndex),l=i-a,u=n.index-e.index;if(l){if(!i)return 1;if(!a)return-1}return l||u},iLe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},s5=function(n,e,i){return bp(n).map(function(a,l){var u=iLe(a);return{node:a,index:l,tabIndex:i&&u===-1?(a.dataset||{}).focusGuard?0:-1:u}}).filter(function(a){return!e||a.tabIndex>=0}).sort(rLe)},sLe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],o5=sLe.join(","),oLe="".concat(o5,", [data-focus-guard]"),rre=function(n,e){return bp((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(e?oLe:o5)?[a]:[],rre(a))},[])},aLe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?I0([n.contentDocument.body],e):[n]},I0=function(n,e){return n.reduce(function(i,a){var l,u=rre(a,e),f=(l=[]).concat.apply(l,u.map(function(_){return aLe(_,e)}));return i.concat(f,a.parentNode?bp(a.parentNode.querySelectorAll(o5)).filter(function(_){return _===a}):[])},[])},cLe=function(n){var e=n.querySelectorAll("[".concat(xxe,"]"));return bp(e).map(function(i){return I0([i])}).reduce(function(i,a){return i.concat(a)},[])},a5=function(n,e){return bp(n).filter(function(i){return Qne(e,i)}).filter(function(i){return eLe(i)})},EX=function(n,e){return e===void 0&&(e=new Map),bp(n).filter(function(i){return Zne(e,i)})},c5=function(n,e,i){return s5(a5(I0(n,i),e),!0,i)},$C=function(n,e){return s5(a5(I0(n),e),!1)},lLe=function(n,e){return a5(cLe(n),e)},Fy=function(n,e){return n.shadowRoot?Fy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:bp(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?Fy(l,e):!1}return Fy(i,e)})},uLe=function(n){for(var e=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var u=n[a].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(a)}return n.filter(function(f,_){return!e.has(_)})},ire=function(n){return n.parentNode?ire(n.parentNode):n},l5=function(n){var e=$y(n);return e.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(FV);return i.push.apply(i,l?uLe(bp(ire(a).querySelectorAll("[".concat(FV,'="').concat(l,'"]:not([').concat(Bne,'="disabled"])')))):[a]),i},[])},dLe=function(n){try{return n()}catch{return}},KC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?KC(e.shadowRoot):e instanceof HTMLIFrameElement&&dLe(function(){return e.contentWindow.document})?KC(e.contentWindow.document):e}},hLe=function(n,e){return n===e},pLe=function(n,e){return!!bp(n.querySelectorAll("iframe")).some(function(i){return hLe(i,e)})},sre=function(n,e){return e===void 0&&(e=KC(Yne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:l5(n).some(function(i){return Fy(i,e)||pLe(i,e)})},fLe=function(n){n===void 0&&(n=document);var e=KC(n);return e?bp(n.querySelectorAll("[".concat(Dxe,"]"))).some(function(i){return Fy(i,e)}):!1},mLe=function(n,e){return e.filter(nre).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},u5=function(n,e){return nre(n)&&n.name?mLe(n,e):n},gLe=function(n){var e=new Set;return n.forEach(function(i){return e.add(u5(i,n))}),n.filter(function(i){return e.has(i)})},vX=function(n){return n[0]&&n.length>1?u5(n[0],n):n[0]},SX=function(n,e){return n.indexOf(u5(e,n))},zV="NEW_FOCUS",_Le=function(n,e,i,a,l){var u=n.length,f=n[0],_=n[u-1],E=i5(a);if(!(a&&n.indexOf(a)>=0)){var S=a!==void 0?i.indexOf(a):-1,w=l?i.indexOf(l):S,I=l?n.indexOf(l):-1;if(S===-1)return I!==-1?I:zV;if(I===-1)return zV;var k=S-w,U=i.indexOf(f),L=i.indexOf(_),F=gLe(i),B=a!==void 0?F.indexOf(a):-1,q=l?F.indexOf(l):B,$=F.filter(function(Z){return Z.tabIndex>=0}),X=a!==void 0?$.indexOf(a):-1,oe=l?$.indexOf(l):X,re=X>=0&&oe>=0?oe-X:q-B;if(!k&&I>=0||e.length===0)return I;var pe=SX(n,e[0]),te=SX(n,e[e.length-1]);if(S<=U&&E&&Math.abs(k)>1)return te;if(S>=L&&E&&Math.abs(k)>1)return pe;if(k&&Math.abs(re)>1)return I;if(S<=U)return te;if(S>L)return pe;if(k)return Math.abs(k)>1?I:(u+I+k)%u}},yLe=function(n){return function(e){var i,a=(i=ere(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||a!==void 0&&a!=="false"||n.indexOf(e)>=0}},bX=function(n,e,i){var a=n.map(function(u){var f=u.node;return f}),l=EX(a.filter(yLe(i)));return l&&l.length?vX(l):vX(EX(e))},GV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&GV(n.parentNode.host||n.parentNode,e),e},gU=function(n,e){for(var i=GV(n),a=GV(e),l=0;l<i.length;l+=1){var u=i[l];if(a.indexOf(u)>=0)return u}return!1},ore=function(n,e,i){var a=$y(n),l=$y(e),u=a[0],f=!1;return l.filter(Boolean).forEach(function(_){f=gU(f||_,_)||f,i.filter(Boolean).forEach(function(E){var S=gU(u,E);S&&(!f||Fy(S,f)?f=S:f=gU(S,f))})}),f},TX=function(n,e){return n.reduce(function(i,a){return i.concat(lLe(a,e))},[])},ELe=function(n,e){var i=new Map;return e.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter(nLe)},vLe=function(n,e){var i=KC($y(n).length>0?document:Yne(n).ownerDocument),a=l5(n).filter(WV),l=ore(i||n,n,a),u=new Map,f=$C(a,u),_=f.filter(function(L){var F=L.node;return WV(F)});if(_[0]){var E=$C([l],u).map(function(L){var F=L.node;return F}),S=ELe(E,_),w=S.map(function(L){var F=L.node;return F}),I=S.filter(function(L){var F=L.tabIndex;return F>=0}).map(function(L){var F=L.node;return F}),k=_Le(w,I,E,i,e);if(k===zV){var U=bX(f,I,TX(a,u))||bX(f,w,TX(a,u));if(U)return{node:U};console.warn("focus-lock: cannot find any node to move focus into");return}return k===void 0?k:S[k]}},SLe=function(n){var e=l5(n).filter(WV),i=ore(n,n,e),a=s5(I0([i],!0),!0,!0),l=I0(e,!1);return a.map(function(u){var f=u.node,_=u.index;return{node:f,index:_,lockItem:l.indexOf(f)>=0,guard:i5(f)}})},d5=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},_U=0,yU=!1,are=function(n,e,i){i===void 0&&(i={});var a=vLe(n,e);if(!yU&&a){if(_U>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),yU=!0,setTimeout(function(){yU=!1},1);return}_U++,d5(a.node,i.focusOptions),_U--}};function Rw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var bLe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:Rw(i),parent:Rw(i.parentElement),left:Rw(i.previousElementSibling),right:Rw(i.nextElementSibling)}),i=i.parentElement;return{element:Rw(n),stack:e,ownerDocument:n.ownerDocument}},TLe=function(n){var e,i,a,l,u;if(n)for(var f=n.stack,_=n.ownerDocument,E=new Map,S=0,w=f;S<w.length;S++){var I=w[S],k=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(k&&_.contains(k)){for(var U=(i=I.left)===null||i===void 0?void 0:i.call(I),L=I.current(),F=k.contains(L)?L:void 0,B=(a=I.right)===null||a===void 0?void 0:a.call(I),q=c5([k],E),$=(u=(l=F??(U==null?void 0:U.nextElementSibling))!==null&&l!==void 0?l:B)!==null&&u!==void 0?u:U;$;){for(var X=0,oe=q;X<oe.length;X++){var re=oe[X];if($!=null&&$.contains(re.node))return re.node}$=$.nextElementSibling}if(q.length)return q[0].node}}},cre=function(n){var e=bLe(n);return function(){return TLe(e)}},wLe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var a=$y(e);if(a.every(function(f){return!Fy(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?c5(a,new Map):$C(a,new Map),u=l.findIndex(function(f){var _=f.node;return _===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},CLe=function(n,e){var i=e?c5($y(n),new Map):$C($y(n),new Map);return{first:i[0],last:i[i.length-1]}},RLe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},lre=function(n,e,i){e===void 0&&(e={});var a=RLe(e),l=wLe(n,a.scope,a.onlyTabbable);if(l){var u=i(l,a.cycle);u&&d5(u.node,a.focusOptions)}},ILe=function(n,e){e===void 0&&(e={}),lre(n,e,function(i,a){var l=i.next,u=i.first;return l||a&&u})},ALe=function(n,e){e===void 0&&(e={}),lre(n,e,function(i,a){var l=i.prev,u=i.last;return l||a&&u})},ure=function(n,e,i){var a,l=CLe(n,(a=e.onlyTabbable)!==null&&a!==void 0?a:!0),u=l[i];u&&d5(u.node,e.focusOptions)},PLe=function(n,e){e===void 0&&(e={}),ure(n,e,"first")},OLe=function(n,e){e===void 0&&(e={}),ure(n,e,"last")};function h5(n){setTimeout(n,1)}var kLe=function(e){return e&&"current"in e?e.current:e},dre=function(){return document&&document.activeElement===document.body},NLe=function(){return dre()||fLe()},u0=null,Yc=null,wX=function(){return null},d0=null,qC=!1,p5=!1,DLe=function(){return!0},xLe=function(e){return(u0.whiteList||DLe)(e)},LLe=function(e,i){d0={observerNode:e,portaledElement:i}},MLe=function(e){return d0&&d0.portaledElement===e};function CX(n,e,i,a){var l=null,u=n;do{var f=a[u];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var ULe=function(e){return e?!!qC:qC==="meanwhile"},VLe=function n(e,i,a){return i&&(i.host===e&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,a))},jLe=function(e,i){return i.some(function(a){return VLe(e,a,a)})},hre=function(e){return $C(e,new Map)},FLe=function(e){return!hre([e.parentNode]).some(function(i){return i.node===e})},ok=function(){var e=!1;if(u0){var i=u0,a=i.observed,l=i.persistentFocus,u=i.autoFocus,f=i.shards,_=i.crossFrame,E=i.focusOptions,S=i.noFocusGuards,w=a||d0&&d0.portaledElement;if(dre()&&Yc&&Yc!==document.body&&(!document.body.contains(Yc)||FLe(Yc))){var I=wX();I&&I.focus()}var k=document&&document.activeElement;if(w){var U=[w].concat(f.map(kLe).filter(Boolean)),L=function(){if(!ULe(_)||!S||!Yc||p5)return!1;var X=hre(U),oe=X.findIndex(function(re){var pe=re.node;return pe===Yc});return oe===0||oe===X.length-1};if((!k||xLe(k))&&(l||L()||!NLe()||!Yc&&u)&&(w&&!(sre(U)||k&&jLe(k,U)||MLe(k))&&(document&&!Yc&&k&&!u?(k.blur&&k.blur(),document.body.focus()):(e=are(U,Yc,{focusOptions:E}),d0={})),Yc=document&&document.activeElement,Yc!==document.body&&(wX=cre(Yc)),qC=!1),document&&k!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var F=document&&document.activeElement,B=SLe(U),q=B.map(function($){var X=$.node;return X}).indexOf(F);q>-1&&(B.filter(function($){var X=$.guard,oe=$.node;return X&&oe.dataset.focusAutoGuard}).forEach(function($){var X=$.node;return X.removeAttribute("tabIndex")}),CX(q,B.length,1,B),CX(q,-1,-1,B))}}}return e},pre=function(e){ok()&&e&&(e.stopPropagation(),e.preventDefault())},f5=function(){return h5(ok)},BLe=function(e){var i=e.target,a=e.currentTarget;a.contains(i)||LLe(a,i)},WLe=function(){return null},fre=function(){p5=!0},mre=function(){p5=!1,qC="just",h5(function(){qC="meanwhile"})},zLe=function(){document.addEventListener("focusin",pre),document.addEventListener("focusout",f5),window.addEventListener("focus",fre),window.addEventListener("blur",mre)},GLe=function(){document.removeEventListener("focusin",pre),document.removeEventListener("focusout",f5),window.removeEventListener("focus",fre),window.removeEventListener("blur",mre)};function HLe(n){return n.filter(function(e){var i=e.disabled;return!i})}var gre={moveFocusInside:are,focusInside:sre,focusNextElement:ILe,focusPrevElement:ALe,focusFirstElement:PLe,focusLastElement:OLe,captureFocusRestore:cre};function $Le(n){var e=n.slice(-1)[0];e&&!u0&&zLe();var i=u0,a=i&&e&&e.id===i.id;u0=e,i&&!a&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(Yc=null,(!a||i.observed!==e.observed)&&e.onActivation(gre),ok(),h5(ok)):(GLe(),Yc=null)}Kne.assignSyncMedium(BLe);qne.assignMedium(f5);Fxe.assignMedium(function(n){return n(gre)});const KLe=qxe(HLe,$Le)(WLe);var HV=D.forwardRef(function(e,i){return mr.createElement(r5,Gy({sideCar:KLe,ref:i},e))}),_re=r5.propTypes||{};_re.sideCar;Axe(_re,["sideCar"]);HV.propTypes={};const qLe=HV.default??HV,yre=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:a,restoreFocus:l,children:u,isDisabled:f,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:S}=n,w=D.useCallback(()=>{e!=null&&e.current?e.current.focus():a!=null&&a.current&&KZ(a.current).length===0&&requestAnimationFrame(()=>{var L;(L=a.current)==null||L.focus()})},[e,a]),I=D.useCallback(()=>{var U;(U=i==null?void 0:i.current)==null||U.focus()},[i]),k=l&&!i;return b.jsx(qLe,{crossFrame:S,persistentFocus:E,autoFocus:_,disabled:f,onActivation:w,onDeactivation:I,returnFocus:k,children:u})};yre.displayName="FocusLock";const[YLe,XLe]=Ni({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Mu=Gt((n,e)=>{const i=Ba("FormError",n),a=Ii(n),l=oE();return l!=null&&l.isInvalid?b.jsx(YLe,{value:i,children:b.jsx(kt.div,{...l==null?void 0:l.getErrorMessageProps(a,e),className:ln("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});Mu.displayName="FormErrorMessage";const JLe=Gt((n,e)=>{const i=XLe(),a=oE();if(!(a!=null&&a.isInvalid))return null;const l=ln("chakra-form__error-icon",n.className);return b.jsx(Dn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:b.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});JLe.displayName="FormErrorIcon";const Qn=Gt(function(e,i){const a=al("FormLabel",e),l=Ii(e),{className:u,children:f,requiredIndicator:_=b.jsx(Ere,{}),optionalIndicator:E=null,...S}=l,w=oE(),I=(w==null?void 0:w.getLabelProps(S,i))??{ref:i,...S};return b.jsxs(kt.label,{...I,className:ln("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,w!=null&&w.isRequired?_:E]})});Qn.displayName="FormLabel";const Ere=Gt(function(e,i){const a=oE(),l=Une();if(!(a!=null&&a.isRequired))return null;const u=ln("chakra-form__required-indicator",e.className);return b.jsx(kt.span,{...a==null?void 0:a.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});Ere.displayName="RequiredIndicator";const eN=Gt(function(e,i){const{templateAreas:a,gap:l,rowGap:u,columnGap:f,column:_,row:E,autoFlow:S,autoRows:w,templateRows:I,autoColumns:k,templateColumns:U,...L}=e,F={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:u,gridColumnGap:f,gridAutoColumns:k,gridColumn:_,gridRow:E,gridAutoFlow:S,gridAutoRows:w,gridTemplateRows:I,gridTemplateColumns:U};return b.jsx(kt.div,{ref:i,__css:F,...L})});eN.displayName="Grid";function RX(n){return Uk(n,e=>e==="auto"?"auto":`span ${e}/span ${e}`)}const YC=Gt(function(e,i){const{area:a,colSpan:l,colStart:u,colEnd:f,rowEnd:_,rowSpan:E,rowStart:S,...w}=e,I=dR({gridArea:a,gridColumn:RX(l),gridRow:RX(E),gridColumnStart:u,gridColumnEnd:f,gridRowStart:S,gridRowEnd:_});return b.jsx(kt.div,{ref:i,__css:I,...w})});YC.displayName="GridItem";const Ky=Gt(function(e,i){const{columns:a,spacingX:l,spacingY:u,spacing:f,minChildWidth:_,...E}=e,S=Kg(),w=_?ZLe(_,S):e2e(a);return b.jsx(eN,{ref:i,gap:f,columnGap:l,rowGap:u,templateColumns:w,...E})});Ky.displayName="SimpleGrid";function QLe(n){return typeof n=="number"?`${n}px`:n}function ZLe(n,e){return Uk(n,i=>{const a=ADe("sizes",i,QLe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function e2e(n){return Uk(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Qf(n){const{viewBox:e="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,u=D.Children.toArray(n.path),f=Gt((_,E)=>b.jsx(Dn,{ref:E,viewBox:e,...l,..._,children:u.length?u:b.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=a,f}const $V=Gt(function(e,i){const{htmlWidth:a,htmlHeight:l,alt:u,...f}=e;return b.jsx("img",{width:a,height:l,ref:i,alt:u,...f})});$V.displayName="NativeImage";const Va=Gt(function(e,i){const{fallbackSrc:a,fallback:l,src:u,srcSet:f,align:_,fit:E,loading:S,ignoreFallback:w,crossOrigin:I,fallbackStrategy:k="beforeLoadOrError",referrerPolicy:U,...L}=e,F=a!==void 0||l!==void 0,B=S!=null||w||!F,q=Dne({...e,crossOrigin:I,ignoreFallback:B}),$=sxe(q,k),X={ref:i,objectFit:E,objectPosition:_,...B?L:$0(L,["onError","onLoad"])};return $?l||b.jsx(kt.img,{as:$V,className:"chakra-image__placeholder",src:a,...X}):b.jsx(kt.img,{as:$V,src:u,srcSet:f,crossOrigin:I,loading:S,referrerPolicy:U,className:"chakra-image",...X})});Va.displayName="Image";const pr=Gt(function(e,i){const{htmlSize:a,...l}=e,u=Ba("Input",l),f=Ii(l),_=t5(f),E=ln("chakra-input",e.className);return b.jsx(kt.input,{size:a,..._,__css:u.field,ref:i,className:E})});pr.displayName="Input";pr.id="Input";const[t2e,n2e]=Ni({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),A0=Gt(function(e,i){const a=Ba("Input",e),{children:l,className:u,...f}=Ii(e),_=ln("chakra-input__group",u),E={},S=Yj(l),w=a.field;S.forEach(k=>{a&&(w&&k.type.id==="InputLeftElement"&&(E.paddingStart=w.height??w.h),w&&k.type.id==="InputRightElement"&&(E.paddingEnd=w.height??w.h),k.type.id==="InputRightAddon"&&(E.borderEndRadius=0),k.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=S.map(k=>{var L,F;const U=dR({size:((L=k.props)==null?void 0:L.size)||e.size,variant:((F=k.props)==null?void 0:F.variant)||e.variant});return k.type.id!=="Input"?D.cloneElement(k,U):D.cloneElement(k,Object.assign(U,E,k.props))});return b.jsx(kt.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:b.jsx(t2e,{value:a,children:I})})});A0.displayName="InputGroup";const r2e=kt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),tN=Gt(function(e,i){const{placement:a="left",...l}=e,u=n2e(),f=u.field,E={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...u.element};return b.jsx(r2e,{ref:i,__css:E,...l})});tN.id="InputElement";tN.displayName="InputElement";const qy=Gt(function(e,i){const{className:a,...l}=e,u=ln("chakra-input__left-element",a);return b.jsx(tN,{ref:i,placement:"left",className:u,...l})});qy.id="InputLeftElement";qy.displayName="InputLeftElement";const vre=Gt(function(e,i){const{className:a,...l}=e,u=ln("chakra-input__right-element",a);return b.jsx(tN,{ref:i,placement:"right",className:u,...l})});vre.id="InputRightElement";vre.displayName="InputRightElement";const ho=Gt(function(e,i){const a=al("Link",e),{className:l,isExternal:u,...f}=Ii(e);return b.jsx(kt.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:ln("chakra-link",l),...f,__css:a})});ho.displayName="Link";function Sre(n,e={}){const{ssr:i=!0,fallback:a}=e,{getWindow:l}=NPe(),u=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(S=>S!=null);const[_,E]=D.useState(()=>u.map((S,w)=>({media:S,matches:i?!!f[w]:l().matchMedia(S).matches})));return D.useEffect(()=>{const S=l();E(u.map(k=>({media:k,matches:S.matchMedia(k).matches})));const w=u.map(k=>S.matchMedia(k)),I=k=>{E(U=>U.slice().map(L=>L.media===k.media?{...L,matches:k.matches}:L))};return w.forEach(k=>{typeof k.addListener=="function"?k.addListener(I):k.addEventListener("change",I)}),()=>{w.forEach(k=>{typeof k.removeListener=="function"?k.removeListener(I):k.removeEventListener("change",I)})}},[l]),_.map(S=>S.matches)}function i2e(n){var _;const e=po(n)?n:{fallback:n??"base"},a=Kg().__breakpoints.details.map(({minMaxQuery:E,breakpoint:S})=>({breakpoint:S,query:E.replace("@media screen and ","")})),l=a.map(E=>E.breakpoint===e.fallback),f=Sre(a.map(E=>E.query),{fallback:l,ssr:e.ssr}).findIndex(E=>E==!0);return((_=a[f])==null?void 0:_.breakpoint)??e.fallback}function s2e(n,e,i=XZ){let a=Object.keys(n).indexOf(e);if(a!==-1)return n[e];let l=i.indexOf(e);for(;l>=0;){const u=i[l];if(n.hasOwnProperty(u)){a=l;break}l-=1}if(a!==-1){const u=i[a];return n[u]}}function o2e(n,e){var _;const i=po(e)?e:{fallback:"base"},a=i2e(i),l=Kg();if(!a)return;const u=Array.from(((_=l.__breakpoints)==null?void 0:_.keys)||[]),f=Array.isArray(n)?Object.fromEntries(Object.entries(_Se(n,u)).map(([E,S])=>[E,S])):n;return s2e(f,a,u)}function a2e(n,e,i,a){if(e==null)return a;if(!a)return n.find(f=>i(f).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(a)?(u=l.indexOf(a)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return a}function c2e(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function l2e(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[a,l]=D.useState([]),u=D.useRef(void 0),f=()=>{u.current&&(clearTimeout(u.current),u.current=null)},_=()=>{f(),u.current=setTimeout(()=>{l([]),u.current=null},e)};D.useEffect(()=>f,[]);function E(S){return w=>{if(w.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(c2e(w)){const I=a.concat(w.key);i(w)&&(w.preventDefault(),w.stopPropagation()),l(I),S(I.join("")),_()}}}return E}var rl="top",zu="bottom",Gu="right",il="left",m5="auto",TR=[rl,zu,Gu,il],P0="start",XC="end",u2e="clippingParents",bre="viewport",Iw="popper",d2e="reference",IX=TR.reduce(function(n,e){return n.concat([e+"-"+P0,e+"-"+XC])},[]),Tre=[].concat(TR,[m5]).reduce(function(n,e){return n.concat([e,e+"-"+P0,e+"-"+XC])},[]),h2e="beforeRead",p2e="read",f2e="afterRead",m2e="beforeMain",g2e="main",_2e="afterMain",y2e="beforeWrite",E2e="write",v2e="afterWrite",S2e=[h2e,p2e,f2e,m2e,g2e,_2e,y2e,E2e,v2e];function _p(n){return n?(n.nodeName||"").toLowerCase():null}function Hl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Yy(n){var e=Hl(n).Element;return n instanceof e||n instanceof Element}function Fu(n){var e=Hl(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function g5(n){if(typeof ShadowRoot>"u")return!1;var e=Hl(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function b2e(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var a=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!Fu(u)||!_p(u)||(Object.assign(u.style,a),Object.keys(l).forEach(function(f){var _=l[f];_===!1?u.removeAttribute(f):u.setAttribute(f,_===!0?"":_)}))})}function T2e(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(a){var l=e.elements[a],u=e.attributes[a]||{},f=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:i[a]),_=f.reduce(function(E,S){return E[S]="",E},{});!Fu(l)||!_p(l)||(Object.assign(l.style,_),Object.keys(u).forEach(function(E){l.removeAttribute(E)}))})}}const w2e={name:"applyStyles",enabled:!0,phase:"write",fn:b2e,effect:T2e,requires:["computeStyles"]};function lp(n){return n.split("-")[0]}var By=Math.max,ak=Math.min,O0=Math.round;function KV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function wre(){return!/^((?!chrome|android).)*safari/i.test(KV())}function k0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,u=1;e&&Fu(n)&&(l=n.offsetWidth>0&&O0(a.width)/n.offsetWidth||1,u=n.offsetHeight>0&&O0(a.height)/n.offsetHeight||1);var f=Yy(n)?Hl(n):window,_=f.visualViewport,E=!wre()&&i,S=(a.left+(E&&_?_.offsetLeft:0))/l,w=(a.top+(E&&_?_.offsetTop:0))/u,I=a.width/l,k=a.height/u;return{width:I,height:k,top:w,right:S+I,bottom:w+k,left:S,x:S,y:w}}function _5(n){var e=k0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function Cre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&g5(i)){var a=e;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Hf(n){return Hl(n).getComputedStyle(n)}function C2e(n){return["table","td","th"].indexOf(_p(n))>=0}function qg(n){return((Yy(n)?n.ownerDocument:n.document)||window.document).documentElement}function nN(n){return _p(n)==="html"?n:n.assignedSlot||n.parentNode||(g5(n)?n.host:null)||qg(n)}function AX(n){return!Fu(n)||Hf(n).position==="fixed"?null:n.offsetParent}function R2e(n){var e=/firefox/i.test(KV()),i=/Trident/i.test(KV());if(i&&Fu(n)){var a=Hf(n);if(a.position==="fixed")return null}var l=nN(n);for(g5(l)&&(l=l.host);Fu(l)&&["html","body"].indexOf(_p(l))<0;){var u=Hf(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function wR(n){for(var e=Hl(n),i=AX(n);i&&C2e(i)&&Hf(i).position==="static";)i=AX(i);return i&&(_p(i)==="html"||_p(i)==="body"&&Hf(i).position==="static")?e:i||R2e(n)||e}function y5(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function yC(n,e,i){return By(n,ak(e,i))}function I2e(n,e,i){var a=yC(n,e,i);return a>i?i:a}function Rre(){return{top:0,right:0,bottom:0,left:0}}function Ire(n){return Object.assign({},Rre(),n)}function Are(n,e){return e.reduce(function(i,a){return i[a]=n,i},{})}var A2e=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Ire(typeof e!="number"?e:Are(e,TR))};function P2e(n){var e,i=n.state,a=n.name,l=n.options,u=i.elements.arrow,f=i.modifiersData.popperOffsets,_=lp(i.placement),E=y5(_),S=[il,Gu].indexOf(_)>=0,w=S?"height":"width";if(!(!u||!f)){var I=A2e(l.padding,i),k=_5(u),U=E==="y"?rl:il,L=E==="y"?zu:Gu,F=i.rects.reference[w]+i.rects.reference[E]-f[E]-i.rects.popper[w],B=f[E]-i.rects.reference[E],q=wR(u),$=q?E==="y"?q.clientHeight||0:q.clientWidth||0:0,X=F/2-B/2,oe=I[U],re=$-k[w]-I[L],pe=$/2-k[w]/2+X,te=yC(oe,pe,re),Z=E;i.modifiersData[a]=(e={},e[Z]=te,e.centerOffset=te-pe,e)}}function O2e(n){var e=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||Cre(e.elements.popper,l)&&(e.elements.arrow=l))}const k2e={name:"arrow",enabled:!0,phase:"main",fn:P2e,effect:O2e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function N0(n){return n.split("-")[1]}var N2e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function D2e(n,e){var i=n.x,a=n.y,l=e.devicePixelRatio||1;return{x:O0(i*l)/l||0,y:O0(a*l)/l||0}}function PX(n){var e,i=n.popper,a=n.popperRect,l=n.placement,u=n.variation,f=n.offsets,_=n.position,E=n.gpuAcceleration,S=n.adaptive,w=n.roundOffsets,I=n.isFixed,k=f.x,U=k===void 0?0:k,L=f.y,F=L===void 0?0:L,B=typeof w=="function"?w({x:U,y:F}):{x:U,y:F};U=B.x,F=B.y;var q=f.hasOwnProperty("x"),$=f.hasOwnProperty("y"),X=il,oe=rl,re=window;if(S){var pe=wR(i),te="clientHeight",Z="clientWidth";if(pe===Hl(i)&&(pe=qg(i),Hf(pe).position!=="static"&&_==="absolute"&&(te="scrollHeight",Z="scrollWidth")),pe=pe,l===rl||(l===il||l===Gu)&&u===XC){oe=zu;var ne=I&&pe===re&&re.visualViewport?re.visualViewport.height:pe[te];F-=ne-a.height,F*=E?1:-1}if(l===il||(l===rl||l===zu)&&u===XC){X=Gu;var ae=I&&pe===re&&re.visualViewport?re.visualViewport.width:pe[Z];U-=ae-a.width,U*=E?1:-1}}var me=Object.assign({position:_},S&&N2e),he=w===!0?D2e({x:U,y:F},Hl(i)):{x:U,y:F};if(U=he.x,F=he.y,E){var ue;return Object.assign({},me,(ue={},ue[oe]=$?"0":"",ue[X]=q?"0":"",ue.transform=(re.devicePixelRatio||1)<=1?"translate("+U+"px, "+F+"px)":"translate3d("+U+"px, "+F+"px, 0)",ue))}return Object.assign({},me,(e={},e[oe]=$?F+"px":"",e[X]=q?U+"px":"",e.transform="",e))}function x2e(n){var e=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,u=i.adaptive,f=u===void 0?!0:u,_=i.roundOffsets,E=_===void 0?!0:_,S={placement:lp(e.placement),variation:N0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,PX(Object.assign({},S,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,PX(Object.assign({},S,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const L2e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:x2e,data:{}};var G1={passive:!0};function M2e(n){var e=n.state,i=n.instance,a=n.options,l=a.scroll,u=l===void 0?!0:l,f=a.resize,_=f===void 0?!0:f,E=Hl(e.elements.popper),S=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&S.forEach(function(w){w.addEventListener("scroll",i.update,G1)}),_&&E.addEventListener("resize",i.update,G1),function(){u&&S.forEach(function(w){w.removeEventListener("scroll",i.update,G1)}),_&&E.removeEventListener("resize",i.update,G1)}}const U2e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:M2e,data:{}};var V2e={left:"right",right:"left",bottom:"top",top:"bottom"};function AO(n){return n.replace(/left|right|bottom|top/g,function(e){return V2e[e]})}var j2e={start:"end",end:"start"};function OX(n){return n.replace(/start|end/g,function(e){return j2e[e]})}function E5(n){var e=Hl(n),i=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:i,scrollTop:a}}function v5(n){return k0(qg(n)).left+E5(n).scrollLeft}function F2e(n,e){var i=Hl(n),a=qg(n),l=i.visualViewport,u=a.clientWidth,f=a.clientHeight,_=0,E=0;if(l){u=l.width,f=l.height;var S=wre();(S||!S&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:u,height:f,x:_+v5(n),y:E}}function B2e(n){var e,i=qg(n),a=E5(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=By(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=By(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-a.scrollLeft+v5(n),E=-a.scrollTop;return Hf(l||i).direction==="rtl"&&(_+=By(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:f,x:_,y:E}}function S5(n){var e=Hf(n),i=e.overflow,a=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function Pre(n){return["html","body","#document"].indexOf(_p(n))>=0?n.ownerDocument.body:Fu(n)&&S5(n)?n:Pre(nN(n))}function EC(n,e){var i;e===void 0&&(e=[]);var a=Pre(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),u=Hl(a),f=l?[u].concat(u.visualViewport||[],S5(a)?a:[]):a,_=e.concat(f);return l?_:_.concat(EC(nN(f)))}function qV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function W2e(n,e){var i=k0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function kX(n,e,i){return e===bre?qV(F2e(n,i)):Yy(e)?W2e(e,i):qV(B2e(qg(n)))}function z2e(n){var e=EC(nN(n)),i=["absolute","fixed"].indexOf(Hf(n).position)>=0,a=i&&Fu(n)?wR(n):n;return Yy(a)?e.filter(function(l){return Yy(l)&&Cre(l,a)&&_p(l)!=="body"}):[]}function G2e(n,e,i,a){var l=e==="clippingParents"?z2e(n):[].concat(e),u=[].concat(l,[i]),f=u[0],_=u.reduce(function(E,S){var w=kX(n,S,a);return E.top=By(w.top,E.top),E.right=ak(w.right,E.right),E.bottom=ak(w.bottom,E.bottom),E.left=By(w.left,E.left),E},kX(n,f,a));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function Ore(n){var e=n.reference,i=n.element,a=n.placement,l=a?lp(a):null,u=a?N0(a):null,f=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case rl:E={x:f,y:e.y-i.height};break;case zu:E={x:f,y:e.y+e.height};break;case Gu:E={x:e.x+e.width,y:_};break;case il:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var S=l?y5(l):null;if(S!=null){var w=S==="y"?"height":"width";switch(u){case P0:E[S]=E[S]-(e[w]/2-i[w]/2);break;case XC:E[S]=E[S]+(e[w]/2-i[w]/2);break}}return E}function JC(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=a===void 0?n.placement:a,u=i.strategy,f=u===void 0?n.strategy:u,_=i.boundary,E=_===void 0?u2e:_,S=i.rootBoundary,w=S===void 0?bre:S,I=i.elementContext,k=I===void 0?Iw:I,U=i.altBoundary,L=U===void 0?!1:U,F=i.padding,B=F===void 0?0:F,q=Ire(typeof B!="number"?B:Are(B,TR)),$=k===Iw?d2e:Iw,X=n.rects.popper,oe=n.elements[L?$:k],re=G2e(Yy(oe)?oe:oe.contextElement||qg(n.elements.popper),E,w,f),pe=k0(n.elements.reference),te=Ore({reference:pe,element:X,placement:l}),Z=qV(Object.assign({},X,te)),ne=k===Iw?Z:pe,ae={top:re.top-ne.top+q.top,bottom:ne.bottom-re.bottom+q.bottom,left:re.left-ne.left+q.left,right:ne.right-re.right+q.right},me=n.modifiersData.offset;if(k===Iw&&me){var he=me[l];Object.keys(ae).forEach(function(ue){var Ue=[Gu,zu].indexOf(ue)>=0?1:-1,ze=[rl,zu].indexOf(ue)>=0?"y":"x";ae[ue]+=he[ze]*Ue})}return ae}function H2e(n,e){e===void 0&&(e={});var i=e,a=i.placement,l=i.boundary,u=i.rootBoundary,f=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,S=E===void 0?Tre:E,w=N0(a),I=w?_?IX:IX.filter(function(L){return N0(L)===w}):TR,k=I.filter(function(L){return S.indexOf(L)>=0});k.length===0&&(k=I);var U=k.reduce(function(L,F){return L[F]=JC(n,{placement:F,boundary:l,rootBoundary:u,padding:f})[lp(F)],L},{});return Object.keys(U).sort(function(L,F){return U[L]-U[F]})}function $2e(n){if(lp(n)===m5)return[];var e=AO(n);return[OX(n),e,OX(e)]}function K2e(n){var e=n.state,i=n.options,a=n.name;if(!e.modifiersData[a]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!0:f,E=i.fallbackPlacements,S=i.padding,w=i.boundary,I=i.rootBoundary,k=i.altBoundary,U=i.flipVariations,L=U===void 0?!0:U,F=i.allowedAutoPlacements,B=e.options.placement,q=lp(B),$=q===B,X=E||($||!L?[AO(B)]:$2e(B)),oe=[B].concat(X).reduce(function(Me,Ge){return Me.concat(lp(Ge)===m5?H2e(e,{placement:Ge,boundary:w,rootBoundary:I,padding:S,flipVariations:L,allowedAutoPlacements:F}):Ge)},[]),re=e.rects.reference,pe=e.rects.popper,te=new Map,Z=!0,ne=oe[0],ae=0;ae<oe.length;ae++){var me=oe[ae],he=lp(me),ue=N0(me)===P0,Ue=[rl,zu].indexOf(he)>=0,ze=Ue?"width":"height",tt=JC(e,{placement:me,boundary:w,rootBoundary:I,altBoundary:k,padding:S}),Ce=Ue?ue?Gu:il:ue?zu:rl;re[ze]>pe[ze]&&(Ce=AO(Ce));var Ie=AO(Ce),ye=[];if(u&&ye.push(tt[he]<=0),_&&ye.push(tt[Ce]<=0,tt[Ie]<=0),ye.every(function(Me){return Me})){ne=me,Z=!1;break}te.set(me,ye)}if(Z)for(var ke=L?3:1,Te=function(Ge){var Qe=oe.find(function(nt){var ht=te.get(nt);if(ht)return ht.slice(0,Ge).every(function(it){return it})});if(Qe)return ne=Qe,"break"},ve=ke;ve>0;ve--){var Re=Te(ve);if(Re==="break")break}e.placement!==ne&&(e.modifiersData[a]._skip=!0,e.placement=ne,e.reset=!0)}}const q2e={name:"flip",enabled:!0,phase:"main",fn:K2e,requiresIfExists:["offset"],data:{_skip:!1}};function NX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function DX(n){return[rl,Gu,zu,il].some(function(e){return n[e]>=0})}function Y2e(n){var e=n.state,i=n.name,a=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,f=JC(e,{elementContext:"reference"}),_=JC(e,{altBoundary:!0}),E=NX(f,a),S=NX(_,l,u),w=DX(E),I=DX(S);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:S,isReferenceHidden:w,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":w,"data-popper-escaped":I})}const X2e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Y2e};function J2e(n,e,i){var a=lp(n),l=[il,rl].indexOf(a)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,f=u[0],_=u[1];return f=f||0,_=(_||0)*l,[il,Gu].indexOf(a)>=0?{x:_,y:f}:{x:f,y:_}}function Q2e(n){var e=n.state,i=n.options,a=n.name,l=i.offset,u=l===void 0?[0,0]:l,f=Tre.reduce(function(w,I){return w[I]=J2e(I,e.rects,u),w},{}),_=f[e.placement],E=_.x,S=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=S),e.modifiersData[a]=f}const Z2e={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Q2e};function eMe(n){var e=n.state,i=n.name;e.modifiersData[i]=Ore({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const tMe={name:"popperOffsets",enabled:!0,phase:"read",fn:eMe,data:{}};function nMe(n){return n==="x"?"y":"x"}function rMe(n){var e=n.state,i=n.options,a=n.name,l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!1:f,E=i.boundary,S=i.rootBoundary,w=i.altBoundary,I=i.padding,k=i.tether,U=k===void 0?!0:k,L=i.tetherOffset,F=L===void 0?0:L,B=JC(e,{boundary:E,rootBoundary:S,padding:I,altBoundary:w}),q=lp(e.placement),$=N0(e.placement),X=!$,oe=y5(q),re=nMe(oe),pe=e.modifiersData.popperOffsets,te=e.rects.reference,Z=e.rects.popper,ne=typeof F=="function"?F(Object.assign({},e.rects,{placement:e.placement})):F,ae=typeof ne=="number"?{mainAxis:ne,altAxis:ne}:Object.assign({mainAxis:0,altAxis:0},ne),me=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,he={x:0,y:0};if(pe){if(u){var ue,Ue=oe==="y"?rl:il,ze=oe==="y"?zu:Gu,tt=oe==="y"?"height":"width",Ce=pe[oe],Ie=Ce+B[Ue],ye=Ce-B[ze],ke=U?-Z[tt]/2:0,Te=$===P0?te[tt]:Z[tt],ve=$===P0?-Z[tt]:-te[tt],Re=e.elements.arrow,Me=U&&Re?_5(Re):{width:0,height:0},Ge=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Rre(),Qe=Ge[Ue],nt=Ge[ze],ht=yC(0,te[tt],Me[tt]),it=X?te[tt]/2-ke-ht-Qe-ae.mainAxis:Te-ht-Qe-ae.mainAxis,It=X?-te[tt]/2+ke+ht+nt+ae.mainAxis:ve+ht+nt+ae.mainAxis,jt=e.elements.arrow&&wR(e.elements.arrow),Dt=jt?oe==="y"?jt.clientTop||0:jt.clientLeft||0:0,an=(ue=me==null?void 0:me[oe])!=null?ue:0,jn=Ce+it-an-Dt,Qt=Ce+It-an,Ot=yC(U?ak(Ie,jn):Ie,Ce,U?By(ye,Qt):ye);pe[oe]=Ot,he[oe]=Ot-Ce}if(_){var Lt,we=oe==="x"?rl:il,Ve=oe==="x"?zu:Gu,$e=pe[re],_t=re==="y"?"height":"width",vt=$e+B[we],St=$e-B[Ve],Ht=[rl,il].indexOf(q)!==-1,fn=(Lt=me==null?void 0:me[re])!=null?Lt:0,mn=Ht?vt:$e-te[_t]-Z[_t]-fn+ae.altAxis,Jt=Ht?$e+te[_t]+Z[_t]-fn-ae.altAxis:St,Hn=U&&Ht?I2e(mn,$e,Jt):yC(U?mn:vt,$e,U?Jt:St);pe[re]=Hn,he[re]=Hn-$e}e.modifiersData[a]=he}}const iMe={name:"preventOverflow",enabled:!0,phase:"main",fn:rMe,requiresIfExists:["offset"]};function sMe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function oMe(n){return n===Hl(n)||!Fu(n)?E5(n):sMe(n)}function aMe(n){var e=n.getBoundingClientRect(),i=O0(e.width)/n.offsetWidth||1,a=O0(e.height)/n.offsetHeight||1;return i!==1||a!==1}function cMe(n,e,i){i===void 0&&(i=!1);var a=Fu(e),l=Fu(e)&&aMe(e),u=qg(e),f=k0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(a||!a&&!i)&&((_p(e)!=="body"||S5(u))&&(_=oMe(e)),Fu(e)?(E=k0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):u&&(E.x=v5(u))),{x:f.left+_.scrollLeft-E.x,y:f.top+_.scrollTop-E.y,width:f.width,height:f.height}}function lMe(n){var e=new Map,i=new Set,a=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var f=[].concat(u.requires||[],u.requiresIfExists||[]);f.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),a.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),a}function uMe(n){var e=lMe(n);return S2e.reduce(function(i,a){return i.concat(e.filter(function(l){return l.phase===a}))},[])}function dMe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function hMe(n){var e=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(e).map(function(i){return e[i]})}var xX={placement:"bottom",modifiers:[],strategy:"absolute"};function LX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function pMe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,a=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?xX:l;return function(_,E,S){S===void 0&&(S=u);var w={placement:"bottom",orderedModifiers:[],options:Object.assign({},xX,u),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],k=!1,U={state:w,setOptions:function(q){var $=typeof q=="function"?q(w.options):q;F(),w.options=Object.assign({},u,w.options,$),w.scrollParents={reference:Yy(_)?EC(_):_.contextElement?EC(_.contextElement):[],popper:EC(E)};var X=uMe(hMe([].concat(a,w.options.modifiers)));return w.orderedModifiers=X.filter(function(oe){return oe.enabled}),L(),U.update()},forceUpdate:function(){if(!k){var q=w.elements,$=q.reference,X=q.popper;if(LX($,X)){w.rects={reference:cMe($,wR(X),w.options.strategy==="fixed"),popper:_5(X)},w.reset=!1,w.placement=w.options.placement,w.orderedModifiers.forEach(function(ae){return w.modifiersData[ae.name]=Object.assign({},ae.data)});for(var oe=0;oe<w.orderedModifiers.length;oe++){if(w.reset===!0){w.reset=!1,oe=-1;continue}var re=w.orderedModifiers[oe],pe=re.fn,te=re.options,Z=te===void 0?{}:te,ne=re.name;typeof pe=="function"&&(w=pe({state:w,options:Z,name:ne,instance:U})||w)}}}},update:dMe(function(){return new Promise(function(B){U.forceUpdate(),B(w)})}),destroy:function(){F(),k=!0}};if(!LX(_,E))return U;U.setOptions(S).then(function(B){!k&&S.onFirstUpdate&&S.onFirstUpdate(B)});function L(){w.orderedModifiers.forEach(function(B){var q=B.name,$=B.options,X=$===void 0?{}:$,oe=B.effect;if(typeof oe=="function"){var re=oe({state:w,name:q,instance:U,options:X}),pe=function(){};I.push(re||pe)}})}function F(){I.forEach(function(B){return B()}),I=[]}return U}}var fMe=[U2e,tMe,L2e,w2e,Z2e,q2e,iMe,k2e,X2e],mMe=pMe({defaultModifiers:fMe});const kS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),Xs={arrowShadowColor:kS("--popper-arrow-shadow-color"),arrowSize:kS("--popper-arrow-size","8px"),arrowSizeHalf:kS("--popper-arrow-size-half"),arrowBg:kS("--popper-arrow-bg"),transformOrigin:kS("--popper-transform-origin"),arrowOffset:kS("--popper-arrow-offset")};function gMe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const _Me={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},yMe=n=>_Me[n],MX={scroll:!0,resize:!0};function EMe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...MX,...n}}:e={enabled:n,options:MX},e}const vMe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},SMe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{UX(n)},effect:({state:n})=>()=>{UX(n)}},UX=n=>{n.elements.popper.style.setProperty(Xs.transformOrigin.var,yMe(n.placement))},bMe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{TMe(n)}},TMe=n=>{var i;if(!n.placement)return;const e=wMe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:Xs.arrowSize.varRef,height:Xs.arrowSize.varRef,zIndex:-1});const a={[Xs.arrowSizeHalf.var]:`calc(${Xs.arrowSize.varRef} / 2 - 1px)`,[Xs.arrowOffset.var]:`calc(${Xs.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},wMe=n=>{if(n.startsWith("top"))return{property:"bottom",value:Xs.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Xs.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Xs.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Xs.arrowOffset.varRef}},CMe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{VX(n)},effect:({state:n})=>()=>{VX(n)}},VX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=gMe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:Xs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},RMe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},IMe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function AMe(n,e="ltr"){var a;const i=((a=RMe[n])==null?void 0:a[e])||n;return e==="ltr"?i:IMe[n]??i}function b5(n={}){const{enabled:e=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:f=!0,offset:_,gutter:E=8,flip:S=!0,boundary:w="clippingParents",preventOverflow:I=!0,matchWidth:k,direction:U="ltr"}=n,L=D.useRef(null),F=D.useRef(null),B=D.useRef(null),q=AMe(a,U),$=D.useRef(()=>{}),X=D.useCallback(()=>{var ae;!e||!L.current||!F.current||((ae=$.current)==null||ae.call($),B.current=mMe(L.current,F.current,{placement:q,modifiers:[CMe,bMe,SMe,{...vMe,enabled:!!k},{name:"eventListeners",...EMe(f)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!S,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:w}},...i??[]],strategy:l}),B.current.forceUpdate(),$.current=B.current.destroy)},[q,e,i,k,f,u,_,E,S,I,w,l]);D.useEffect(()=>()=>{var ae;!L.current&&!F.current&&((ae=B.current)==null||ae.destroy(),B.current=null)},[]);const oe=D.useCallback(ae=>{L.current=ae,X()},[X]),re=D.useCallback((ae={},me=null)=>({...ae,ref:Ki(oe,me)}),[oe]),pe=D.useCallback(ae=>{F.current=ae,X()},[X]),te=D.useCallback((ae={},me=null)=>({...ae,ref:Ki(pe,me),style:{...ae.style,position:l,minWidth:k?void 0:"max-content",inset:"0 auto auto 0"}}),[l,pe,k]),Z=D.useCallback((ae={},me=null)=>{const{size:he,shadowColor:ue,bg:Ue,style:ze,...tt}=ae;return{...tt,ref:me,"data-popper-arrow":"",style:PMe(ae)}},[]),ne=D.useCallback((ae={},me=null)=>({...ae,ref:me,"data-popper-arrow-inner":""}),[]);return{update(){var ae;(ae=B.current)==null||ae.update()},forceUpdate(){var ae;(ae=B.current)==null||ae.forceUpdate()},transformOrigin:Xs.transformOrigin.varRef,referenceRef:oe,popperRef:pe,getPopperProps:te,getArrowProps:Z,getArrowInnerProps:ne,getReferenceProps:re}}function PMe(n){const{size:e,shadowColor:i,bg:a,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),a&&(u["--popper-arrow-bg"]=a),u}function OMe(){const n=D.useRef(new Map),e=n.current,i=D.useCallback((l,u,f,_)=>{n.current.set(f,{type:u,el:l,options:_}),l.addEventListener(u,f,_)},[]),a=D.useCallback((l,u,f,_)=>{l.removeEventListener(u,f,_),n.current.delete(f)},[]);return D.useEffect(()=>()=>{e.forEach((l,u)=>{a(l.el,l.type,u,l.options)})},[a,e]),{add:i,remove:a}}function EU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:a}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function kre(n={}){const{ref:e,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:f,onMouseUp:_,onClick:E,onKeyDown:S,onKeyUp:w,tabIndex:I,onMouseOver:k,onMouseLeave:U,...L}=n,[F,B]=D.useState(!0),[q,$]=D.useState(!1),X=OMe(),oe=Ce=>{Ce&&Ce.tagName!=="BUTTON"&&B(!1)},re=F?I:I||0,pe=i&&!a,te=D.useCallback(Ce=>{if(i){Ce.stopPropagation(),Ce.preventDefault();return}Ce.currentTarget.focus(),E==null||E(Ce)},[i,E]),Z=D.useCallback(Ce=>{q&&EU(Ce)&&(Ce.preventDefault(),Ce.stopPropagation(),$(!1),X.remove(document,"keyup",Z,!1))},[q,X]),ne=D.useCallback(Ce=>{if(S==null||S(Ce),i||Ce.defaultPrevented||Ce.metaKey||!EU(Ce.nativeEvent)||F)return;const Ie=l&&Ce.key==="Enter";u&&Ce.key===" "&&(Ce.preventDefault(),$(!0)),Ie&&(Ce.preventDefault(),Ce.currentTarget.click()),X.add(document,"keyup",Z,!1)},[i,F,S,l,u,X,Z]),ae=D.useCallback(Ce=>{if(w==null||w(Ce),i||Ce.defaultPrevented||Ce.metaKey||!EU(Ce.nativeEvent)||F)return;u&&Ce.key===" "&&(Ce.preventDefault(),$(!1),Ce.currentTarget.click())},[u,F,i,w]),me=D.useCallback(Ce=>{Ce.button===0&&($(!1),X.remove(document,"mouseup",me,!1))},[X]),he=D.useCallback(Ce=>{if(Ce.button!==0)return;if(i){Ce.stopPropagation(),Ce.preventDefault();return}F||$(!0),Ce.currentTarget.focus({preventScroll:!0}),X.add(document,"mouseup",me,!1),f==null||f(Ce)},[i,F,f,X,me]),ue=D.useCallback(Ce=>{Ce.button===0&&(F||$(!1),_==null||_(Ce))},[_,F]),Ue=D.useCallback(Ce=>{if(i){Ce.preventDefault();return}k==null||k(Ce)},[i,k]),ze=D.useCallback(Ce=>{q&&(Ce.preventDefault(),$(!1)),U==null||U(Ce)},[q,U]),tt=Ki(e,oe);return F?{...L,ref:tt,type:"button","aria-disabled":pe?void 0:i,disabled:pe,onClick:te,onMouseDown:f,onMouseUp:_,onKeyUp:w,onKeyDown:S,onMouseOver:k,onMouseLeave:U}:{...L,ref:tt,role:"button","data-active":pn(q),"aria-disabled":i?"true":void 0,tabIndex:pe?void 0:re,onClick:te,onMouseDown:he,onMouseUp:ue,onKeyUp:ae,onKeyDown:ne,onMouseOver:Ue,onMouseLeave:ze}}const[kMe,NMe,DMe,xMe]=Pne(),[LMe,CR]=Ni({strict:!1,name:"MenuContext"});function Nre(n){return(n==null?void 0:n.ownerDocument)??document}function MMe(n){return Nre(n).activeElement===n}function UMe(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:f,isOpen:_,defaultIsOpen:E,onClose:S,onOpen:w,placement:I="bottom-start",lazyBehavior:k="unmount",direction:U,computePositionOnMount:L=!1,...F}=n,B=D.useRef(null),q=D.useRef(null),$=D.useRef(!0),X=DMe(),oe=D.useCallback(()=>{requestAnimationFrame(()=>{var Re;(Re=B.current)==null||Re.focus({preventScroll:!1})})},[]),re=D.useCallback(()=>{const Re=setTimeout(()=>{var Me,Ge;if(l)(Me=l.current)==null||Me.focus();else if(!X.count())(Ge=B.current)==null||Ge.focus({preventScroll:!1});else{const Qe=X.firstEnabled();Qe&&Ue(Qe.index)}});ye.current.add(Re)},[X,l]),pe=D.useCallback(()=>{const Re=setTimeout(()=>{var Me;if(!X.count())(Me=B.current)==null||Me.focus({preventScroll:!1});else{const Ge=X.lastEnabled();Ge&&Ue(Ge.index)}});ye.current.add(Re)},[X]),te=D.useCallback(()=>{w==null||w(),u?re():oe()},[u,re,oe,w]),{isOpen:Z,onOpen:ne,onClose:ae,onToggle:me}=gp({isOpen:_,defaultIsOpen:E,onClose:S,onOpen:te});iee({enabled:Z&&a,ref:B,handler:Re=>{var Ge,Qe,nt;const Me=((Qe=(Ge=Re.composedPath)==null?void 0:Ge.call(Re))==null?void 0:Qe[0])??Re.target;(nt=q.current)!=null&&nt.contains(Me)||ae()}});const he=b5({...F,enabled:Z||L,placement:I,direction:U}),[ue,Ue]=D.useState(-1);tee(B,{focusRef:q,visible:Z,shouldFocus:!0});const ze=ZZ({isOpen:Z,ref:B}),[tt,Ce]=FSe(e,"menu-button","menu-list"),Ie=D.useCallback(()=>{ne(),oe()},[ne,oe]),ye=D.useRef(new Set([]));D.useEffect(()=>{const Re=ye.current;return()=>{Re.forEach(Me=>clearTimeout(Me)),Re.clear()}},[]),Dg(()=>{var Re;Z||(Ue(-1),(Re=B.current)==null||Re.scrollTo(0,0))},[Z]),Dg(()=>{Z&&ue===-1&&oe()},[ue,Z]),D.useEffect(()=>{var Me;if(!Z)return;const Re=X.item(ue);(Me=Re==null?void 0:Re.node)==null||Me.focus({preventScroll:!$.current})},[X,ue,Z]);const ke=D.useCallback(()=>{ne(),re()},[re,ne]),Te=D.useCallback(()=>{$.current=!0,ne(),pe()},[ne,pe]),ve=D.useCallback(()=>{var nt,ht;const Re=Nre(B.current),Me=(nt=B.current)==null?void 0:nt.contains(Re.activeElement);if(!(Z&&!Me))return;const Qe=(ht=X.item(ue))==null?void 0:ht.node;Qe==null||Qe.focus({preventScroll:!$.current})},[Z,ue,X]);return{openAndFocusMenu:Ie,openAndFocusFirstItem:ke,openAndFocusLastItem:Te,onTransitionEnd:ve,unstable__animationState:ze,descendants:X,popper:he,buttonId:tt,menuId:Ce,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:me,onOpen:ne,onClose:ae,menuRef:B,buttonRef:q,focusedIndex:ue,closeOnSelect:i,closeOnBlur:a,autoSelect:u,setFocusedIndex:Ue,isLazy:f,lazyBehavior:k,initialFocusRef:l,scrollIntoViewRef:$}}function VMe(n={},e=null){const i=CR(),{onToggle:a,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:f,scrollIntoViewRef:_}=i,E=D.useCallback(S=>{const w=S.key,k={Enter:u,ArrowDown:u,ArrowUp:f}[w];k&&(_.current=!0,S.preventDefault(),S.stopPropagation(),k(S))},[u,f,_]);return{...n,ref:Ki(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":pn(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Rn(n.onClick,a),onKeyDown:Rn(n.onKeyDown,E)}}function YV(n){var e;return WMe(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function jMe(n={},e=null){const i=CR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:u,isOpen:f,onClose:_,menuId:E,isLazy:S,lazyBehavior:w,scrollIntoViewRef:I,unstable__animationState:k}=i,U=NMe(),L=l2e({preventDefault:$=>$.key!==" "&&YV($.target)}),F=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const X=$.key,re={Tab:te=>te.preventDefault(),Escape:te=>{te.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const te=U.nextEnabled(a)??U.firstEnabled();te&&l(te.index)},ArrowUp:()=>{I.current=!0;const te=U.prevEnabled(a)??U.firstEnabled();te&&l(te.index)}}[X];if(re){$.preventDefault(),re($);return}const pe=L(te=>{const Z=a2e(U.values(),te,ne=>{var ae;return((ae=ne==null?void 0:ne.node)==null?void 0:ae.textContent)??""},U.item(a));if(Z){const ne=U.indexOf(Z.node);l(ne)}});YV($.target)&&pe($)},[U,a,L,_,l,I]),B=D.useRef(!1);f&&(B.current=!0);const q=Xj({wasSelected:B.current,enabled:S,mode:w,isSelected:k.present});return{...n,ref:Ki(u,e),children:q?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Rn(n.onKeyDown,F)}}function FMe(n={}){const{popper:e,isOpen:i}=CR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function BMe(n={},e=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:u,onFocus:f,isDisabled:_,isFocusable:E,closeOnSelect:S,type:w,...I}=n,k=CR(),{setFocusedIndex:U,focusedIndex:L,closeOnSelect:F,onClose:B,menuId:q,scrollIntoViewRef:$}=k,X=D.useRef(null),oe=`${q}-menuitem-${D.useId()}`,{index:re,register:pe}=xMe({disabled:_&&!E}),te=D.useCallback(Ue=>{i==null||i(Ue),!_&&($.current=!1,U(re))},[U,re,_,i,$]),Z=D.useCallback(Ue=>{a==null||a(Ue),X.current&&!MMe(X.current)&&te(Ue)},[te,a]),ne=D.useCallback(Ue=>{l==null||l(Ue),!_&&U(-1)},[U,_,l]),ae=D.useCallback(Ue=>{u==null||u(Ue),YV(Ue.currentTarget)&&(S??F)&&B()},[B,u,F,S]),me=D.useCallback(Ue=>{f==null||f(Ue),U(re)},[U,f,re]),he=re===L,ue=kre({onClick:ae,onFocus:me,onMouseEnter:te,onMouseMove:Z,onMouseLeave:ne,ref:Ki(pe,X,e),isDisabled:_,isFocusable:E});return{...I,...ue,type:w??ue.type,id:oe,role:"menuitem",tabIndex:he?0:-1}}function WMe(n){if(!zMe(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function zMe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[GMe,X0]=Ni({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),rN=n=>{const{children:e}=n,i=Ba("Menu",n),a=Ii(n),{direction:l}=Kg(),{descendants:u,...f}=UMe({...a,direction:l}),_=D.useMemo(()=>f,[f]),{isOpen:E,onClose:S,forceUpdate:w}=_;return b.jsx(kMe,{value:u,children:b.jsx(LMe,{value:_,children:b.jsx(GMe,{value:i,children:el(e,{isOpen:E,onClose:S,forceUpdate:w})})})})};rN.displayName="Menu";const HMe=Gt((n,e)=>{const i=X0();return b.jsx(kt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),iN=Gt((n,e)=>{const{children:i,as:a,...l}=n,u=VMe(l,e),f=a||HMe;return b.jsx(f,{...u,className:ln("chakra-menu__menu-button",n.className),children:b.jsx(kt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});iN.displayName="MenuButton";const Dre=Gt((n,e)=>{const i=X0();return b.jsx(kt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});Dre.displayName="MenuCommand";const xre=n=>{const{className:e,...i}=n,a=X0();return b.jsx(kt.hr,{"aria-orientation":"horizontal",className:ln("chakra-menu__divider",e),...i,__css:a.divider})};xre.displayName="MenuDivider";const Lre=n=>{const{className:e,children:i,...a}=n,l=X0(),u=D.Children.only(i),f=D.isValidElement(u)?D.cloneElement(u,{focusable:"false","aria-hidden":!0,className:ln("chakra-menu__icon",u.props.className)}):null,_=ln("chakra-menu__icon-wrapper",e);return b.jsx(kt.span,{className:_,...a,__css:l.icon,children:f})};Lre.displayName="MenuIcon";const $Me=Gt((n,e)=>{const{type:i,...a}=n,l=X0(),u=a.as||i?i??void 0:"button",f=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return b.jsx(kt.button,{ref:e,type:u,...a,__css:f})}),Tg=Gt((n,e)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:u="0.75rem",children:f,..._}=n,E=BMe(_,e),w=i||l?b.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return b.jsxs($Me,{...E,className:ln("chakra-menu__menuitem",E.className),children:[i&&b.jsx(Lre,{fontSize:"0.8em",marginEnd:a,children:i}),w,l&&b.jsx(Dre,{marginStart:u,children:l})]})});Tg.displayName="MenuItem";const KMe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},qMe=kt(Sp.div),sN=Gt(function(e,i){var k;const{rootProps:a,motionProps:l,...u}=e,{isOpen:f,onTransitionEnd:_,unstable__animationState:E}=CR(),S=jMe(u,i),w=FMe(a),I=X0();return b.jsx(kt.div,{...w,__css:{zIndex:e.zIndex??((k=I.list)==null?void 0:k.zIndex)},children:b.jsx(qMe,{variants:KMe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...S,className:ln("chakra-menu__menu-list",S.className),onUpdate:_,onAnimationComplete:qj(E.onComplete,S.onAnimationComplete)})})});sN.displayName="MenuList";var YMe=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},NS=new WeakMap,H1=new WeakMap,$1={},vU=0,Mre=function(n){return n&&(n.host||Mre(n.parentNode))},XMe=function(n,e){return e.map(function(i){if(n.contains(i))return i;var a=Mre(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},JMe=function(n,e,i,a){var l=XMe(e,Array.isArray(n)?n:[n]);$1[i]||($1[i]=new WeakMap);var u=$1[i],f=[],_=new Set,E=new Set(l),S=function(I){!I||_.has(I)||(_.add(I),S(I.parentNode))};l.forEach(S);var w=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(k){if(_.has(k))w(k);else try{var U=k.getAttribute(a),L=U!==null&&U!=="false",F=(NS.get(k)||0)+1,B=(u.get(k)||0)+1;NS.set(k,F),u.set(k,B),f.push(k),F===1&&L&&H1.set(k,!0),B===1&&k.setAttribute(i,"true"),L||k.setAttribute(a,"true")}catch(q){console.error("aria-hidden: cannot operate on ",k,q)}})};return w(e),_.clear(),vU++,function(){f.forEach(function(I){var k=NS.get(I)-1,U=u.get(I)-1;NS.set(I,k),u.set(I,U),k||(H1.has(I)||I.removeAttribute(a),H1.delete(I)),U||I.removeAttribute(i)}),vU--,vU||(NS=new WeakMap,NS=new WeakMap,H1=new WeakMap,$1={})}},QMe=function(n,e,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=YMe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),JMe(a,l,i,"aria-hidden")):function(){return null}},ZMe=Object.defineProperty,eUe=(n,e,i)=>e in n?ZMe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,tUe=(n,e,i)=>(eUe(n,e+"",i),i);class nUe{constructor(){tUe(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const XV=new nUe;function Ure(n,e){const[i,a]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(e){const u=XV.add(l);a(u)}return()=>{XV.remove(l),a(0)}}},[e,n]),i}function rUe(n){const{isOpen:e,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:f=!0,onOverlayClick:_,onEsc:E}=n,S=D.useRef(null),w=D.useRef(null),[I,k,U]=sUe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");iUe(S,e&&f);const L=Ure(S,e),F=D.useRef(null),B=D.useCallback(ne=>{F.current=ne.target},[]),q=D.useCallback(ne=>{ne.key==="Escape"&&(ne.stopPropagation(),u&&(i==null||i()),E==null||E())},[u,i,E]),[$,X]=D.useState(!1),[oe,re]=D.useState(!1),pe=D.useCallback((ne={},ae=null)=>({role:"dialog",...ne,ref:Ki(ae,S),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?k:void 0,"aria-describedby":oe?U:void 0,onClick:Rn(ne.onClick,me=>me.stopPropagation())}),[U,oe,I,k,$]),te=D.useCallback(ne=>{ne.stopPropagation(),F.current===ne.target&&XV.isTopModal(S.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),Z=D.useCallback((ne={},ae=null)=>({...ne,ref:Ki(ae,w),onClick:Rn(ne.onClick,te),onKeyDown:Rn(ne.onKeyDown,q),onMouseDown:Rn(ne.onMouseDown,B)}),[q,B,te]);return{isOpen:e,onClose:i,headerId:k,bodyId:U,setBodyMounted:re,setHeaderMounted:X,dialogRef:S,overlayRef:w,getDialogProps:pe,getDialogContainerProps:Z,index:L}}function iUe(n,e){const i=n.current;D.useEffect(()=>{if(!(!n.current||!e))return QMe(n.current)},[e,n,i])}function sUe(n,...e){const i=D.useId(),a=n||i;return D.useMemo(()=>e.map(l=>`${l}-${a}`),[a,e])}const[oUe,J0]=Ni({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[aUe,Xy]=Ni({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),hc=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:S,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:U,animatePresenceProps:L,onCloseComplete:F}=e,B=Ba("Modal",e),$={...rUe(e),autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:S,allowPinchZoom:w,preserveScrollBarGap:I,motionPreset:k,lockFocusAcrossFrames:U};return b.jsx(aUe,{value:$,children:b.jsx(oUe,{value:B,children:b.jsx(iE,{...L,onExitComplete:F,children:$.isOpen&&b.jsx($l,{...i,children:a})})})})};hc.displayName="Modal";var PO="right-scroll-bar-position",OO="width-before-scroll-bar",cUe="with-scroll-bars-hidden",lUe="--removed-body-scroll-bar-size",Vre=Hne(),SU=function(){},oN=D.forwardRef(function(n,e){var i=D.useRef(null),a=D.useState({onScrollCapture:SU,onWheelCapture:SU,onTouchMoveCapture:SU}),l=a[0],u=a[1],f=n.forwardProps,_=n.children,E=n.className,S=n.removeScrollBar,w=n.enabled,I=n.shards,k=n.sideCar,U=n.noIsolation,L=n.inert,F=n.allowPinchZoom,B=n.as,q=B===void 0?"div":B,$=n.gapMode,X=bR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),oe=k,re=Wne([i,e]),pe=tp(tp({},X),l);return D.createElement(D.Fragment,null,w&&D.createElement(oe,{sideCar:Vre,removeScrollBar:S,shards:I,noIsolation:U,inert:L,setCallbacks:u,allowPinchZoom:!!F,lockRef:i,gapMode:$}),f?D.cloneElement(D.Children.only(_),tp(tp({},pe),{ref:re})):D.createElement(q,tp({},pe,{className:E,ref:re}),_))});oN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};oN.classNames={fullWidth:OO,zeroRight:PO};var uUe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function dUe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=uUe();return e&&n.setAttribute("nonce",e),n}function hUe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function pUe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var fUe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=dUe())&&(hUe(e,i),pUe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},mUe=function(){var n=fUe();return function(e,i){D.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},jre=function(){var n=mUe(),e=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return e},gUe={left:0,top:0,right:0,gap:0},bU=function(n){return parseInt(n||"",10)||0},_Ue=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],a=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[bU(i),bU(a),bU(l)]},yUe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return gUe;var e=_Ue(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,a-i+e[2]-e[0])}},EUe=jre(),h0="data-scroll-locked",vUe=function(n,e,i,a){var l=n.left,u=n.top,f=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(cUe,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(_,"px ").concat(a,`;
  }
  body[`).concat(h0,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(PO,` {
    right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(OO,` {
    margin-right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(PO," .").concat(PO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(OO," .").concat(OO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(h0,`] {
    `).concat(lUe,": ").concat(_,`px;
  }
`)},jX=function(){var n=parseInt(document.body.getAttribute(h0)||"0",10);return isFinite(n)?n:0},SUe=function(){D.useEffect(function(){return document.body.setAttribute(h0,(jX()+1).toString()),function(){var n=jX()-1;n<=0?document.body.removeAttribute(h0):document.body.setAttribute(h0,n.toString())}},[])},bUe=function(n){var e=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;SUe();var u=D.useMemo(function(){return yUe(l)},[l]);return D.createElement(EUe,{styles:vUe(u,!e,l,i?"":"!important")})},JV=!1;if(typeof window<"u")try{var K1=Object.defineProperty({},"passive",{get:function(){return JV=!0,!0}});window.addEventListener("test",K1,K1),window.removeEventListener("test",K1,K1)}catch{JV=!1}var DS=JV?{passive:!1}:!1,TUe=function(n){return n.tagName==="TEXTAREA"},Fre=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!TUe(n)&&i[e]==="visible")},wUe=function(n){return Fre(n,"overflowY")},CUe=function(n){return Fre(n,"overflowX")},FX=function(n,e){var i=e.ownerDocument,a=e;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Bre(n,a);if(l){var u=Wre(n,a),f=u[1],_=u[2];if(f>_)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},RUe=function(n){var e=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[e,i,a]},IUe=function(n){var e=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[e,i,a]},Bre=function(n,e){return n==="v"?wUe(e):CUe(e)},Wre=function(n,e){return n==="v"?RUe(e):IUe(e)},AUe=function(n,e){return n==="h"&&e==="rtl"?-1:1},PUe=function(n,e,i,a,l){var u=AUe(n,window.getComputedStyle(e).direction),f=u*a,_=i.target,E=e.contains(_),S=!1,w=f>0,I=0,k=0;do{var U=Wre(n,_),L=U[0],F=U[1],B=U[2],q=F-B-u*L;(L||q)&&Bre(n,_)&&(I+=q,k+=L),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(w&&Math.abs(I)<1||!w&&Math.abs(k)<1)&&(S=!0),S},q1=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},BX=function(n){return[n.deltaX,n.deltaY]},WX=function(n){return n&&"current"in n?n.current:n},OUe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},kUe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},NUe=0,xS=[];function DUe(n){var e=D.useRef([]),i=D.useRef([0,0]),a=D.useRef(),l=D.useState(NUe++)[0],u=D.useState(jre)[0],f=D.useRef(n);D.useEffect(function(){f.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var F=Vxe([n.lockRef.current],(n.shards||[]).map(WX),!0).filter(Boolean);return F.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),F.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=D.useCallback(function(F,B){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!f.current.allowPinchZoom;var q=q1(F),$=i.current,X="deltaX"in F?F.deltaX:$[0]-q[0],oe="deltaY"in F?F.deltaY:$[1]-q[1],re,pe=F.target,te=Math.abs(X)>Math.abs(oe)?"h":"v";if("touches"in F&&te==="h"&&pe.type==="range")return!1;var Z=FX(te,pe);if(!Z)return!0;if(Z?re=te:(re=te==="v"?"h":"v",Z=FX(te,pe)),!Z)return!1;if(!a.current&&"changedTouches"in F&&(X||oe)&&(a.current=re),!re)return!0;var ne=a.current||re;return PUe(ne,B,F,ne==="h"?X:oe)},[]),E=D.useCallback(function(F){var B=F;if(!(!xS.length||xS[xS.length-1]!==u)){var q="deltaY"in B?BX(B):q1(B),$=e.current.filter(function(re){return re.name===B.type&&(re.target===B.target||B.target===re.shadowParent)&&OUe(re.delta,q)})[0];if($&&$.should){B.cancelable&&B.preventDefault();return}if(!$){var X=(f.current.shards||[]).map(WX).filter(Boolean).filter(function(re){return re.contains(B.target)}),oe=X.length>0?_(B,X[0]):!f.current.noIsolation;oe&&B.cancelable&&B.preventDefault()}}},[]),S=D.useCallback(function(F,B,q,$){var X={name:F,delta:B,target:q,should:$,shadowParent:xUe(q)};e.current.push(X),setTimeout(function(){e.current=e.current.filter(function(oe){return oe!==X})},1)},[]),w=D.useCallback(function(F){i.current=q1(F),a.current=void 0},[]),I=D.useCallback(function(F){S(F.type,BX(F),F.target,_(F,n.lockRef.current))},[]),k=D.useCallback(function(F){S(F.type,q1(F),F.target,_(F,n.lockRef.current))},[]);D.useEffect(function(){return xS.push(u),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:k}),document.addEventListener("wheel",E,DS),document.addEventListener("touchmove",E,DS),document.addEventListener("touchstart",w,DS),function(){xS=xS.filter(function(F){return F!==u}),document.removeEventListener("wheel",E,DS),document.removeEventListener("touchmove",E,DS),document.removeEventListener("touchstart",w,DS)}},[]);var U=n.removeScrollBar,L=n.inert;return D.createElement(D.Fragment,null,L?D.createElement(u,{styles:kUe(l)}):null,U?D.createElement(bUe,{gapMode:n.gapMode}):null)}function xUe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const LUe=jxe(Vre,DUe);var zre=D.forwardRef(function(n,e){return D.createElement(oN,tp({},n,{ref:e,sideCar:LUe}))});zre.classNames=oN.classNames;function MUe(n){const{autoFocus:e,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:f,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:S,lockFocusAcrossFrames:w,isOpen:I}=Xy(),[k,U]=yF();D.useEffect(()=>{!k&&U&&setTimeout(U)},[k,U]);const L=Ure(a,I);return b.jsx(yre,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:a,lockFocusAcrossFrames:w,children:b.jsx(zre,{removeScrollBar:!S,allowPinchZoom:f,enabled:L===1&&u,forwardProps:!0,children:n.children})})}const UUe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Ff.exit(jy.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Ff.enter(jy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:a,reverse:l,delay:u})=>{const f={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Ff.exit(jy.exit,u),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},eC={initial:"initial",animate:"enter",exit:"exit",variants:UUe},VUe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:u=!0,className:f,offsetX:_=0,offsetY:E=8,transition:S,transitionEnd:w,delay:I,animatePresenceProps:k,...U}=e,L=a?l&&a:!0,F=l||a?"enter":"exit",B={offsetX:_,offsetY:E,reverse:u,transition:S,transitionEnd:w,delay:I};return b.jsx(iE,{...k,custom:B,children:L&&b.jsx(Sp.div,{ref:i,className:ln("chakra-offset-slide",f),custom:B,...eC,animate:F,...U})})});VUe.displayName="SlideFade";const jUe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:e,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??Ff.exit(jy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Ff.enter(jy.enter,i),transitionEnd:n==null?void 0:n.enter})},Gre={initial:"exit",animate:"enter",exit:"exit",variants:jUe},FUe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,reverse:u=!0,initialScale:f=.95,className:_,transition:E,transitionEnd:S,delay:w,animatePresenceProps:I,...k}=e,U=a?l&&a:!0,L=l||a?"enter":"exit",F={initialScale:f,reverse:u,transition:E,transitionEnd:S,delay:w};return b.jsx(iE,{...I,custom:F,children:U&&b.jsx(Sp.div,{ref:i,className:ln("chakra-offset-slide",_),...Gre,animate:L,custom:F,...k})})});FUe.displayName="ScaleFade";const BUe={slideInBottom:{...eC,custom:{offsetY:16,reverse:!0}},slideInRight:{...eC,custom:{offsetX:16,reverse:!0}},slideInTop:{...eC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...eC,custom:{offsetX:-16,reverse:!0}},scale:{...Gre,custom:{initialScale:.95,reverse:!0}},none:{}},WUe=kt(Sp.section),zUe=n=>BUe[n||"none"],Hre=D.forwardRef((n,e)=>{const{preset:i,motionProps:a=zUe(i),...l}=n;return b.jsx(WUe,{ref:e,...a,...l})});Hre.displayName="ModalTransition";const pc=Gt((n,e)=>{const{className:i,children:a,containerProps:l,motionProps:u,...f}=n,{getDialogProps:_,getDialogContainerProps:E}=Xy(),S=_(f,e),w=E(l),I=ln("chakra-modal__content",i),k=J0(),U={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...k.dialog},L={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...k.dialogContainer},{motionPreset:F}=Xy();return b.jsx(MUe,{children:b.jsx(kt.div,{...w,className:"chakra-modal__content-container",tabIndex:-1,__css:L,children:b.jsx(Hre,{preset:F,motionProps:u,className:I,...S,__css:U,children:a})})})});pc.displayName="ModalContent";const uc=Gt((n,e)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:u}=Xy();D.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=ln("chakra-modal__body",i),_=J0();return b.jsx(kt.div,{ref:e,className:f,id:l,...a,__css:_.body})});uc.displayName="ModalBody";const cl=Gt((n,e)=>{const{onClick:i,className:a,...l}=n,{onClose:u}=Xy(),f=ln("chakra-modal__close-btn",a),_=J0();return b.jsx(QF,{ref:e,__css:_.closeButton,className:f,onClick:Rn(i,E=>{E.stopPropagation(),u()}),...l})});cl.displayName="ModalCloseButton";const D0=Gt((n,e)=>{const{className:i,...a}=n,l=ln("chakra-modal__footer",i),u=J0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return b.jsx(kt.footer,{ref:e,...a,__css:f,className:l})});D0.displayName="ModalFooter";const Hu=Gt((n,e)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:u}=Xy();D.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=ln("chakra-modal__header",i),_=J0(),E={flex:0,..._.header};return b.jsx(kt.header,{ref:e,className:f,id:l,...a,__css:E})});Hu.displayName="ModalHeader";const GUe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Ff.enter(jy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Ff.exit(jy.exit,i),transitionEnd:e==null?void 0:e.exit})},$re={initial:"exit",animate:"enter",exit:"exit",variants:GUe},HUe=D.forwardRef(function(e,i){const{unmountOnExit:a,in:l,className:u,transition:f,transitionEnd:_,delay:E,animatePresenceProps:S,...w}=e,I=l||a?"enter":"exit",k=a?l&&a:!0,U={transition:f,transitionEnd:_,delay:E};return b.jsx(iE,{...S,custom:U,children:k&&b.jsx(Sp.div,{ref:i,className:ln("chakra-fade",u),custom:U,...$re,animate:I,...w})})});HUe.displayName="Fade";const $Ue=kt(Sp.div),dc=Gt((n,e)=>{const{className:i,transition:a,motionProps:l,...u}=n,f=ln("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...J0().overlay},{motionPreset:S}=Xy(),I=l||(S==="none"?{}:$re);return b.jsx($Ue,{...I,__css:E,ref:e,className:f,...u})});dc.displayName="ModalOverlay";function KUe(n){const{leastDestructiveRef:e,...i}=n;return b.jsx(hc,{...i,initialFocusRef:e})}const qUe=Gt((n,e)=>b.jsx(pc,{ref:e,role:"alertdialog",...n})),[YUe,aN]=Ni({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[XUe,Kre]=Ni({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),LS={click:"click",hover:"hover"};function JUe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:u=!0,autoFocus:f=!0,arrowSize:_,arrowShadowColor:E,trigger:S=LS.click,openDelay:w=200,closeDelay:I=200,isLazy:k,lazyBehavior:U="unmount",computePositionOnMount:L,...F}=n,{isOpen:B,onClose:q,onOpen:$,onToggle:X}=gp(n),[oe,re]=D.useState(u);D.useEffect(()=>re(u),[u]);const pe=D.useRef(null),te=D.useRef(null),Z=D.useRef(null),ne=D.useRef(!1),ae=D.useRef(!1);B&&(ae.current=!0);const[me,he]=D.useState(!1),[ue,Ue]=D.useState(!1),ze=D.useId(),tt=l??ze,[Ce,Ie,ye,ke]=["popover-trigger","popover-content","popover-header","popover-body"].map(Lt=>`${Lt}-${tt}`),{referenceRef:Te,getArrowProps:ve,getPopperProps:Re,getArrowInnerProps:Me,forceUpdate:Ge}=b5({...F,enabled:B||!!L}),Qe=ZZ({isOpen:B,ref:Z});VSe({enabled:B,ref:te}),tee(Z,{focusRef:te,visible:B,shouldFocus:oe&&S===LS.click}),OSe(Z,{focusRef:a,visible:B,shouldFocus:f&&S===LS.click}),iee({enabled:B&&e,ref:Z,handler(Lt){var Ve;const we=((Ve=Lt.composedPath)==null?void 0:Ve.call(Lt)[0])??[Lt.target];Y1(te.current,we)||(we&&re(!qO(we)),q())}});const nt=Xj({wasSelected:ae.current,enabled:k,mode:U,isSelected:Qe.present}),ht=D.useCallback((Lt={},we=null)=>{const Ve={...Lt,style:{...Lt.style,transformOrigin:Xs.transformOrigin.varRef,[Xs.arrowSize.var]:_?`${_}px`:void 0,[Xs.arrowShadowColor.var]:E},ref:Ki(Z,we),children:nt?Lt.children:null,id:Ie,tabIndex:-1,role:"dialog",onKeyDown:Rn(Lt.onKeyDown,$e=>{$e.nativeEvent.isComposing||i&&$e.key==="Escape"&&($e.preventDefault(),$e.stopPropagation(),q())}),onBlur:Rn(Lt.onBlur,$e=>{const _t=zX($e),vt=Y1(Z.current,_t),St=Y1(te.current,_t),Ht=!vt&&!St;_t&&re(!qO(_t)),B&&e&&Ht&&q()}),"aria-labelledby":me?ye:void 0,"aria-describedby":ue?ke:void 0};return S===LS.hover&&(Ve.role="tooltip",Ve.onMouseEnter=Rn(Lt.onMouseEnter,()=>{ne.current=!0}),Ve.onMouseLeave=Rn(Lt.onMouseLeave,$e=>{$e.nativeEvent.relatedTarget!==null&&(ne.current=!1,setTimeout(()=>q(),I))})),Ve},[nt,Ie,me,ye,ue,ke,S,i,q,B,e,I,E,_]),it=D.useCallback((Lt={},we=null)=>Re({...Lt,style:{visibility:B?"visible":"hidden",...Lt.style}},we),[B,Re]),It=D.useCallback((Lt,we=null)=>({...Lt,ref:Ki(we,pe,Te)}),[pe,Te]),jt=D.useRef(void 0),Dt=D.useRef(void 0),an=D.useCallback(Lt=>{pe.current==null&&Te(Lt)},[Te]),jn=D.useCallback((Lt={},we=null)=>{const Ve={...Lt,ref:Ki(te,we,an),id:Ce,"aria-haspopup":"dialog","aria-expanded":B,"aria-controls":Ie};return S===LS.click&&(Ve.onClick=Rn(Lt.onClick,X)),S===LS.hover&&(Ve.onFocus=Rn(Lt.onFocus,()=>{jt.current===void 0&&$()}),Ve.onBlur=Rn(Lt.onBlur,$e=>{const _t=zX($e),vt=!Y1(Z.current,_t);B&&e&&vt&&q()}),Ve.onKeyDown=Rn(Lt.onKeyDown,$e=>{$e.key==="Escape"&&q()}),Ve.onMouseEnter=Rn(Lt.onMouseEnter,()=>{ne.current=!0,jt.current=window.setTimeout(()=>$(),w)}),Ve.onMouseLeave=Rn(Lt.onMouseLeave,()=>{ne.current=!1,jt.current&&(clearTimeout(jt.current),jt.current=void 0),Dt.current=window.setTimeout(()=>{ne.current===!1&&q()},I)})),Ve},[Ce,B,Ie,S,an,X,$,e,q,w,I]);D.useEffect(()=>()=>{jt.current&&clearTimeout(jt.current),Dt.current&&clearTimeout(Dt.current)},[]);const Qt=D.useCallback((Lt={},we=null)=>({...Lt,id:ye,ref:Ki(we,Ve=>{he(!!Ve)})}),[ye]),Ot=D.useCallback((Lt={},we=null)=>({...Lt,id:ke,ref:Ki(we,Ve=>{Ue(!!Ve)})}),[ke]);return{forceUpdate:Ge,isOpen:B,onAnimationComplete:Qe.onComplete,onClose:q,getAnchorProps:It,getArrowProps:ve,getArrowInnerProps:Me,getPopoverPositionerProps:it,getPopoverProps:ht,getTriggerProps:jn,getHeaderProps:Qt,getBodyProps:Ot}}function Y1(n,e){return n===e||(n==null?void 0:n.contains(e))}function zX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function qre(n){const e=Ba("Popover",n),{children:i,...a}=Ii(n),l=Kg(),u=JUe({...a,direction:l.direction});return b.jsx(YUe,{value:u,children:b.jsx(XUe,{value:e,children:el(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}qre.displayName="Popover";function Yre(n){var i;const e=D.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Xre=Gt(function(e,i){const{getBodyProps:a}=aN(),l=Kre();return b.jsx(kt.div,{...a(e,i),className:ln("chakra-popover__body",e.className),__css:l.body})});Xre.displayName="PopoverBody";function QUe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const ZUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},eVe=kt(Sp.section),Jre=Gt(function(e,i){const{variants:a=ZUe,...l}=e,{isOpen:u}=aN();return b.jsx(eVe,{ref:i,variants:QUe(a),initial:!1,animate:u?"enter":"exit",...l})});Jre.displayName="PopoverTransition";const Qre=Gt(function(e,i){const{rootProps:a,motionProps:l,...u}=e,{getPopoverProps:f,getPopoverPositionerProps:_,onAnimationComplete:E}=aN(),S=Kre(),w={position:"relative",display:"flex",flexDirection:"column",...S.content};return b.jsx(kt.div,{..._(a),__css:S.popper,className:"chakra-popover__popper",children:b.jsx(Jre,{...l,...f(u,i),onAnimationComplete:qj(E,u.onAnimationComplete),className:ln("chakra-popover__content",e.className),__css:w})})});Qre.displayName="PopoverContent";function Zre(n){const e=D.Children.only(n.children),{getTriggerProps:i}=aN();return b.jsx(b.Fragment,{children:D.cloneElement(e,i(e.props,Yre(e)))})}Zre.displayName="PopoverTrigger";function tVe(n,e,i){return(n-e)*100/(i-e)}mR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});mR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const nVe=mR({"0%":{left:"-40%"},"100%":{left:"100%"}}),rVe=mR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function iVe(n){const{value:e=0,min:i,max:a,valueText:l,getValueText:u,isIndeterminate:f,role:_="progressbar"}=n,E=tVe(e,i,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":f?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,E):l})(),role:_},percent:E,value:e}}const[sVe,oVe]=Ni({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),aVe=Gt((n,e)=>{const{min:i,max:a,value:l,isIndeterminate:u,role:f,..._}=n,E=iVe({value:l,min:i,max:a,isIndeterminate:u,role:f}),w={height:"100%",...oVe().filledTrack};return b.jsx(kt.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:w})}),x0=Gt((n,e)=>{var te;const{value:i,min:a=0,max:l=100,hasStripe:u,isAnimated:f,children:_,borderRadius:E,isIndeterminate:S,"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,title:U,role:L,...F}=Ii(n),B=Ba("Progress",n),q=E??((te=B.track)==null?void 0:te.borderRadius),$={animation:`${rVe} 1s linear infinite`},re={...!S&&u&&f&&$,...S&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${nVe} 1s ease infinite normal none running`}},pe={overflow:"hidden",position:"relative",...B.track};return b.jsx(kt.div,{ref:e,borderRadius:q,__css:pe,...F,children:b.jsxs(sVe,{value:B,children:[b.jsx(aVe,{"aria-label":w,"aria-labelledby":I,"aria-valuetext":k,min:a,max:l,value:i,isIndeterminate:S,css:re,borderRadius:q,title:U,role:L}),_]})})});x0.displayName="Progress";function cVe(n){return n&&po(n)&&po(n.target)}function lVe(n={}){const{onChange:e,value:i,defaultValue:a,name:l,isDisabled:u,isFocusable:f,isNative:_,...E}=n,[S,w]=D.useState(a||""),I=typeof i<"u",k=I?i:S,U=D.useRef(null),L=D.useCallback(()=>{const re=U.current;if(!re)return;let pe="input:not(:disabled):checked";const te=re.querySelector(pe);if(te){te.focus();return}pe="input:not(:disabled)";const Z=re.querySelector(pe);Z==null||Z.focus()},[]),B=`radio-${D.useId()}`,q=l||B,$=D.useCallback(re=>{const pe=cVe(re)?re.target.value:re;I||w(pe),e==null||e(String(pe))},[e,I]),X=D.useCallback((re={},pe=null)=>({...re,ref:Ki(pe,U),role:"radiogroup"}),[]),oe=D.useCallback((re={},pe=null)=>({...re,ref:pe,name:q,[_?"checked":"isChecked"]:k!=null?re.value===k:void 0,onChange(Z){$(Z)},"data-radiogroup":!0}),[_,q,$,k]);return{getRootProps:X,getRadioProps:oe,name:q,ref:U,focus:L,setValue:w,value:k,onChange:$,isDisabled:u,isFocusable:f,htmlProps:E}}const[uVe,eie]=Ni({name:"RadioGroupContext",strict:!1}),tie=Gt((n,e)=>{const{colorScheme:i,size:a,variant:l,children:u,className:f,isDisabled:_,isFocusable:E,...S}=n,{value:w,onChange:I,getRootProps:k,name:U,htmlProps:L}=lVe(S),F=D.useMemo(()=>({name:U,size:a,onChange:I,colorScheme:i,value:w,variant:l,isDisabled:_,isFocusable:E}),[U,a,I,i,w,l,_,E]);return b.jsx(uVe,{value:F,children:b.jsx(kt.div,{...k(L,e),className:ln("chakra-radio-group",f),children:u})})});tie.displayName="RadioGroup";function dVe(n={}){const{defaultChecked:e,isChecked:i,isFocusable:a,isDisabled:l,isReadOnly:u,isRequired:f,onChange:_,isInvalid:E,name:S,value:w,id:I,"data-radiogroup":k,"aria-describedby":U,...L}=n,F=`radio-${D.useId()}`,B=oE(),$=!!eie()||!!k;let oe=!!B&&!$?B.id:F;oe=I??oe;const re=l??(B==null?void 0:B.isDisabled),pe=u??(B==null?void 0:B.isReadOnly),te=f??(B==null?void 0:B.isRequired),Z=E??(B==null?void 0:B.isInvalid),[ne,ae]=D.useState(!1),[me,he]=D.useState(!1),[ue,Ue]=D.useState(!1),[ze,tt]=D.useState(!1),[Ce,Ie]=D.useState(!!e),ye=typeof i<"u",ke=ye?i:Ce;D.useEffect(()=>Mne(ae),[]);const Te=D.useCallback(jt=>{if(pe||re){jt.preventDefault();return}ye||Ie(jt.currentTarget.checked),_==null||_(jt)},[ye,re,pe,_]),ve=D.useCallback(jt=>{jt.key===" "&&tt(!0)},[tt]),Re=D.useCallback(jt=>{jt.key===" "&&tt(!1)},[tt]),Me=D.useCallback((jt={},Dt=null)=>({...jt,ref:Dt,"data-active":pn(ze),"data-hover":pn(ue),"data-disabled":pn(re),"data-invalid":pn(Z),"data-checked":pn(ke),"data-focus":pn(me),"data-focus-visible":pn(me&&ne),"data-readonly":pn(pe),"aria-hidden":!0,onMouseDown:Rn(jt.onMouseDown,()=>tt(!0)),onMouseUp:Rn(jt.onMouseUp,()=>tt(!1)),onMouseEnter:Rn(jt.onMouseEnter,()=>Ue(!0)),onMouseLeave:Rn(jt.onMouseLeave,()=>Ue(!1))}),[ze,ue,re,Z,ke,me,pe,ne]),{onFocus:Ge,onBlur:Qe}=B??{},nt=D.useCallback((jt={},Dt=null)=>{const an=re&&!a;return{...jt,id:oe,ref:Dt,type:"radio",name:S,value:w,onChange:Rn(jt.onChange,Te),onBlur:Rn(Qe,jt.onBlur,()=>he(!1)),onFocus:Rn(Ge,jt.onFocus,()=>he(!0)),onKeyDown:Rn(jt.onKeyDown,ve),onKeyUp:Rn(jt.onKeyUp,Re),checked:ke,disabled:an,readOnly:pe,required:te,"aria-invalid":Lf(Z),"aria-disabled":Lf(an),"aria-required":Lf(te),"data-readonly":pn(pe),"aria-describedby":U,style:jne}},[re,a,oe,S,w,Te,Qe,Ge,ve,Re,ke,pe,te,Z,U]);return{state:{isInvalid:Z,isFocused:me,isChecked:ke,isActive:ze,isHovered:ue,isDisabled:re,isReadOnly:pe,isRequired:te},getRadioProps:Me,getInputProps:nt,getLabelProps:(jt={},Dt=null)=>({...jt,ref:Dt,onMouseDown:Rn(jt.onMouseDown,hVe),"data-disabled":pn(re),"data-checked":pn(ke),"data-invalid":pn(Z)}),getRootProps:(jt,Dt=null)=>({htmlFor:oe,...jt,ref:Dt,"data-disabled":pn(re),"data-checked":pn(ke),"data-invalid":pn(Z)}),htmlProps:L}}function hVe(n){n.preventDefault(),n.stopPropagation()}const QV=Gt((n,e)=>{const i=eie(),{onChange:a,value:l}=n,u=Ba("Radio",{...i,...n}),f=Ii(n),{spacing:_="0.5rem",children:E,isDisabled:S=i==null?void 0:i.isDisabled,isFocusable:w=i==null?void 0:i.isFocusable,inputProps:I,...k}=f;let U=n.isChecked;(i==null?void 0:i.value)!=null&&l!=null&&(U=i.value===l);let L=a;i!=null&&i.onChange&&l!=null&&(L=qj(i.onChange,a));const F=(n==null?void 0:n.name)??(i==null?void 0:i.name),{getInputProps:B,getRadioProps:q,getLabelProps:$,getRootProps:X,htmlProps:oe}=dVe({...k,isChecked:U,isFocusable:w,isDisabled:S,onChange:L,name:F}),[re,pe]=QZ(oe,pee),te=q(pe),Z=B(I,e),ne=$(),ae=Object.assign({},re,X()),me={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...u.container},he={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...u.control},ue={userSelect:"none",marginStart:_,...u.label};return b.jsxs(kt.label,{className:"chakra-radio",...ae,__css:me,children:[b.jsx("input",{className:"chakra-radio__input",...Z}),b.jsx(kt.span,{className:"chakra-radio__control",...te,__css:he}),E&&b.jsx(kt.span,{className:"chakra-radio__label",...ne,__css:ue,children:E})]})});QV.displayName="Radio";const nie=Gt(function(e,i){const{children:a,placeholder:l,className:u,...f}=e;return b.jsxs(kt.select,{...f,ref:i,className:ln("chakra-select",u),children:[l&&b.jsx("option",{value:"",children:l}),a]})});nie.displayName="SelectField";const rie=Gt((n,e)=>{var X;const i=Ba("Select",n),{rootProps:a,placeholder:l,icon:u,color:f,height:_,h:E,minH:S,minHeight:w,iconColor:I,iconSize:k,...U}=Ii(n),[L,F]=QZ(U,pee),B=t5(F),q={width:"100%",height:"fit-content",position:"relative",color:f},$={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(X=i.field)==null?void 0:X._focus}};return b.jsxs(kt.div,{className:"chakra-select__wrapper",__css:q,...L,...a,children:[b.jsx(nie,{ref:e,height:E??_,minH:S??w,placeholder:l,...B,__css:$,children:n.children}),b.jsx(iie,{"data-disabled":pn(B.disabled),...(I||f)&&{color:I||f},__css:i.icon,...k&&{fontSize:k},children:u})]})});rie.displayName="Select";const pVe=n=>b.jsx("svg",{viewBox:"0 0 24 24",...n,children:b.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),fVe=kt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),iie=n=>{const{children:e=b.jsx(pVe,{}),...i}=n,a=D.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return b.jsx(fVe,{...i,className:"chakra-select__icon-wrapper",children:D.isValidElement(e)?a:null})};iie.displayName="SelectIcon";function TU(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function mVe(n){const{orientation:e,thumbPercents:i,isReversed:a}=n,l=U=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...TU({orientation:e,vertical:{bottom:`calc(${i[U]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[U]}% - var(--slider-thumb-size) / 2)`}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...TU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,a?100-i[0]:i[0]],S=_?E:i;let w=S[0];!_&&a&&(w=100-w);const I=Math.abs(S[S.length-1]-S[0]),k={...f,...TU({orientation:e,vertical:a?{height:`${I}%`,top:`${w}%`}:{height:`${I}%`,bottom:`${w}%`},horizontal:a?{width:`${I}%`,right:`${w}%`}:{width:`${I}%`,left:`${w}%`}})};return{trackStyle:f,innerTrackStyle:k,rootStyle:u,getThumbStyle:l}}function gVe(n){const{isReversed:e,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?e:!e}function _Ve(n){const{min:e=0,max:i=100,onChange:a,value:l,defaultValue:u,isReversed:f,direction:_="ltr",orientation:E="horizontal",id:S,isDisabled:w,isReadOnly:I,onChangeStart:k,onChangeEnd:U,step:L=1,getAriaValueText:F,"aria-valuetext":B,"aria-label":q,"aria-labelledby":$,name:X,focusThumbOnChange:oe=!0,...re}=n,pe=nl(k),te=nl(U),Z=nl(F),ne=gVe({isReversed:f,direction:_,orientation:E}),[ae,me]=eee({value:l,defaultValue:u??EVe(e,i),onChange:a}),[he,ue]=D.useState(!1),[Ue,ze]=D.useState(!1),tt=!(w||I),Ce=(i-e)/10,Ie=L||(i-e)/100,ye=wM(ae,e,i),ke=i-ye+e,ve=XK(ne?ke:ye,e,i),Re=E==="vertical",Me=ree({min:e,max:i,step:L,isDisabled:w,value:ye,isInteractive:tt,isReversed:ne,isVertical:Re,eventSource:null,focusThumbOnChange:oe,orientation:E}),Ge=D.useRef(null),Qe=D.useRef(null),nt=D.useRef(null),ht=D.useId(),it=S??ht,[It,jt]=[`slider-thumb-${it}`,`slider-track-${it}`],Dt=D.useCallback(Bt=>{var yo;if(!Ge.current)return;const un=Me.current;un.eventSource="pointer";const rs=Ge.current.getBoundingClientRect(),{clientX:Fs,clientY:Qs}=((yo=Bt.touches)==null?void 0:yo[0])??Bt,Ei=Re?rs.bottom-Qs:Fs-rs.left,Wa=Re?rs.height:rs.width;let dl=Ei/Wa;ne&&(dl=1-dl);let _o=gSe(dl,un.min,un.max);return un.step&&(_o=parseFloat(JK(_o,un.min,un.step))),_o=wM(_o,un.min,un.max),_o},[Re,ne,Me]),an=D.useCallback(Bt=>{const un=Me.current;un.isInteractive&&(Bt=parseFloat(JK(Bt,un.min,Ie)),Bt=wM(Bt,un.min,un.max),me(Bt))},[Ie,me,Me]),jn=D.useMemo(()=>({stepUp(Bt=Ie){const un=ne?ye-Bt:ye+Bt;an(un)},stepDown(Bt=Ie){const un=ne?ye+Bt:ye-Bt;an(un)},reset(){an(u||0)},stepTo(Bt){an(Bt)}}),[an,ne,ye,Ie,u]),Qt=D.useCallback(Bt=>{const un=Me.current,Fs={ArrowRight:()=>jn.stepUp(),ArrowUp:()=>jn.stepUp(),ArrowLeft:()=>jn.stepDown(),ArrowDown:()=>jn.stepDown(),PageUp:()=>jn.stepUp(Ce),PageDown:()=>jn.stepDown(Ce),Home:()=>an(un.min),End:()=>an(un.max)}[Bt.key];Fs&&(Bt.preventDefault(),Bt.stopPropagation(),Fs(Bt),un.eventSource="keyboard")},[jn,an,Ce,Me]),Ot=(Z==null?void 0:Z(ye))??B,{getThumbStyle:Lt,rootStyle:we,trackStyle:Ve,innerTrackStyle:$e}=D.useMemo(()=>{const Bt=Me.current;return mVe({isReversed:ne,orientation:Bt.orientation,thumbPercents:[ve]})},[ne,ve,Me]),_t=D.useCallback(()=>{Me.current.focusThumbOnChange&&setTimeout(()=>{var un;return(un=Qe.current)==null?void 0:un.focus()})},[Me]);Dg(()=>{const Bt=Me.current;_t(),Bt.eventSource==="keyboard"&&(te==null||te(Bt.value))},[ye,te]);function vt(Bt){const un=Dt(Bt);un!=null&&un!==Me.current.value&&me(un)}i0e(nt,{onPanSessionStart(Bt){const un=Me.current;un.isInteractive&&(ue(!0),_t(),vt(Bt),pe==null||pe(un.value))},onPanSessionEnd(){const Bt=Me.current;Bt.isInteractive&&(ue(!1),te==null||te(Bt.value))},onPan(Bt){Me.current.isInteractive&&vt(Bt)}});const St=D.useCallback((Bt={},un=null)=>({...Bt,...re,ref:Ki(un,nt),tabIndex:-1,"aria-disabled":Lf(w),"data-focused":pn(Ue),style:{...Bt.style,...we}}),[re,w,Ue,we]),Ht=D.useCallback((Bt={},un=null)=>({...Bt,ref:Ki(un,Ge),id:jt,"data-disabled":pn(w),style:{...Bt.style,...Ve}}),[w,jt,Ve]),fn=D.useCallback((Bt={},un=null)=>({...Bt,ref:un,style:{...Bt.style,...$e}}),[$e]),mn=D.useCallback((Bt={},un=null)=>({...Bt,ref:Ki(un,Qe),role:"slider",tabIndex:tt?0:void 0,id:It,"data-active":pn(he),"aria-valuetext":Ot,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":ye,"aria-orientation":E,"aria-disabled":Lf(w),"aria-readonly":Lf(I),"aria-label":q,"aria-labelledby":q?void 0:$,style:{...Bt.style,...Lt(0)},onKeyDown:Rn(Bt.onKeyDown,Qt),onFocus:Rn(Bt.onFocus,()=>ze(!0)),onBlur:Rn(Bt.onBlur,()=>ze(!1))}),[tt,It,he,Ot,e,i,ye,E,w,I,q,$,Lt,Qt]),Jt=D.useCallback((Bt,un=null)=>{const rs=!(Bt.value<e||Bt.value>i),Fs=ye>=Bt.value,Qs=XK(Bt.value,e,i),Ei={position:"absolute",pointerEvents:"none",...yVe({orientation:E,vertical:{bottom:ne?`${100-Qs}%`:`${Qs}%`},horizontal:{left:ne?`${100-Qs}%`:`${Qs}%`}})};return{...Bt,ref:un,role:"presentation","aria-hidden":!0,"data-disabled":pn(w),"data-invalid":pn(!rs),"data-highlighted":pn(Fs),style:{...Bt.style,...Ei}}},[w,ne,i,e,E,ye]),Hn=D.useCallback((Bt={},un=null)=>({...Bt,ref:un,type:"hidden",value:ye,name:X}),[X,ye]);return{state:{value:ye,isFocused:Ue,isDragging:he},actions:jn,getRootProps:St,getTrackProps:Ht,getInnerTrackProps:fn,getThumbProps:mn,getMarkerProps:Jt,getInputProps:Hn}}function yVe(n){const{orientation:e,vertical:i,horizontal:a}=n;return e==="vertical"?i:a}function EVe(n,e){return e<n?n:n+(e-n)/2}const[vVe,cN]=Ni({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[SVe,lN]=Ni({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),ZV=Gt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=Ba("Slider",i),l=Ii(i),{direction:u}=Kg();l.direction=u;const{getInputProps:f,getRootProps:_,...E}=_Ve(l),S=_(),w=f({},e);return b.jsx(vVe,{value:E,children:b.jsx(SVe,{value:a,children:b.jsxs(kt.div,{...S,className:ln("chakra-slider",i.className),__css:a.container,children:[i.children,b.jsx("input",{...w})]})})})});ZV.displayName="Slider";const ej=Gt((n,e)=>{const{getThumbProps:i}=cN(),a=lN(),l=i(n,e);return b.jsx(kt.div,{...l,className:ln("chakra-slider__thumb",n.className),__css:a.thumb})});ej.displayName="SliderThumb";const tj=Gt((n,e)=>{const{getTrackProps:i}=cN(),a=lN(),l=i(n,e);return b.jsx(kt.div,{...l,className:ln("chakra-slider__track",n.className),__css:a.track})});tj.displayName="SliderTrack";const nj=Gt((n,e)=>{const{getInnerTrackProps:i}=cN(),a=lN(),l=i(n,e);return b.jsx(kt.div,{...l,className:ln("chakra-slider__filled-track",n.className),__css:a.filledTrack})});nj.displayName="SliderFilledTrack";const bVe=Gt((n,e)=>{const{getMarkerProps:i}=cN(),a=lN(),l=i(n,e);return b.jsx(kt.div,{...l,className:ln("chakra-slider__marker",n.className),__css:a.mark})});bVe.displayName="SliderMark";const ck=kt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});ck.displayName="Spacer";const sie=n=>b.jsx(kt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});sie.displayName="StackItem";function TVe(n){const{spacing:e,direction:i}=n,a={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":Uk(i,l=>a[l])}}const tl=Gt((n,e)=>{const{isInline:i,direction:a,align:l,justify:u,spacing:f="0.5rem",wrap:_,children:E,divider:S,className:w,shouldWrapChildren:I,...k}=n,U=i?"row":a??"column",L=D.useMemo(()=>TVe({spacing:f,direction:U}),[f,U]),F=!!S,B=!I&&!F,q=D.useMemo(()=>{const X=Yj(E);return B?X:X.map((oe,re)=>{const pe=typeof oe.key<"u"?oe.key:re,te=re+1===X.length,ne=I?b.jsx(sie,{children:oe},pe):oe;if(!F)return ne;const ae=D.cloneElement(S,{__css:L}),me=te?null:ae;return b.jsxs(D.Fragment,{children:[ne,me]},pe)})},[S,L,F,B,I,E]),$=ln("chakra-stack",w);return b.jsx(kt.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:U,flexWrap:_,gap:F?void 0:f,className:$,...k,children:q})});tl.displayName="Stack";const ui=Gt((n,e)=>b.jsx(tl,{align:"center",...n,direction:"row",ref:e}));ui.displayName="HStack";const gr=Gt((n,e)=>b.jsx(tl,{align:"center",...n,direction:"column",ref:e}));gr.displayName="VStack";const Rg=Gt(function(e,i){const a=Ba("Switch",e),{spacing:l="0.5rem",children:u,...f}=Ii(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:S,getRootProps:w,getLabelProps:I}=bxe(f),k=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),U=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),L=D.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return b.jsxs(kt.label,{...w(),className:ln("chakra-switch",e.className),__css:k,children:[b.jsx("input",{className:"chakra-switch__input",...E({},i)}),b.jsx(kt.span,{...S(),className:"chakra-switch__track",__css:U,children:b.jsx(kt.span,{__css:a.thumb,className:"chakra-switch__thumb",..._()})}),u&&b.jsx(kt.span,{className:"chakra-switch__label",...I(),__css:L,children:u})]})});Rg.displayName="Switch";const[wVe,CVe,RVe,IVe]=Pne();function AVe(n){const{defaultIndex:e,onChange:i,index:a,isManual:l,isLazy:u,lazyBehavior:f="unmount",orientation:_="horizontal",direction:E="ltr",...S}=n,[w,I]=D.useState(e??0),[k,U]=eee({defaultValue:e??0,value:a,onChange:i});D.useEffect(()=>{a!=null&&I(a)},[a]);const L=RVe(),F=D.useId();return{id:`tabs-${n.id??F}`,selectedIndex:k,focusedIndex:w,setSelectedIndex:U,setFocusedIndex:I,isManual:l,isLazy:u,lazyBehavior:f,orientation:_,descendants:L,direction:E,htmlProps:S}}const[PVe,uN]=Ni({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function OVe(n){const{focusedIndex:e,orientation:i,direction:a}=uN(),l=CVe(),u=D.useCallback(f=>{const _=()=>{var X;const $=l.nextEnabled(e);$&&((X=$.node)==null||X.focus())},E=()=>{var X;const $=l.prevEnabled(e);$&&((X=$.node)==null||X.focus())},S=()=>{var X;const $=l.firstEnabled();$&&((X=$.node)==null||X.focus())},w=()=>{var X;const $=l.lastEnabled();$&&((X=$.node)==null||X.focus())},I=i==="horizontal",k=i==="vertical",U=f.key,L=a==="ltr"?"ArrowLeft":"ArrowRight",F=a==="ltr"?"ArrowRight":"ArrowLeft",q={[L]:()=>I&&E(),[F]:()=>I&&_(),ArrowDown:()=>k&&_(),ArrowUp:()=>k&&E(),Home:S,End:w}[U];q&&(f.preventDefault(),q(f))},[l,e,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Rn(n.onKeyDown,u)}}function kVe(n){const{isDisabled:e=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:u,id:f,setFocusedIndex:_,selectedIndex:E}=uN(),{index:S,register:w}=IVe({disabled:e&&!i}),I=S===E,k=()=>{l(S)},U=()=>{_(S),!u&&!(e&&i)&&l(S)};return{...kre({...a,ref:Ki(w,n.ref),isDisabled:e,isFocusable:i,onClick:Rn(n.onClick,k)}),id:oie(f,S),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":aie(f,S),onFocus:e?void 0:Rn(n.onFocus,U)}}const[NVe,DVe]=Ni({});function xVe(n){const e=uN(),{id:i,selectedIndex:a}=e,u=Yj(n.children).map((f,_)=>D.createElement(NVe,{key:f.key??_,value:{isSelected:_===a,id:aie(i,_),tabId:oie(i,_),selectedIndex:a}},f));return{...n,children:u}}function LVe(n){const{children:e,...i}=n,{isLazy:a,lazyBehavior:l}=uN(),{isSelected:u,id:f,tabId:_}=DVe(),E=D.useRef(!1);u&&(E.current=!0);const S=Xj({wasSelected:E.current,isSelected:u,enabled:a,mode:l});return{tabIndex:0,...i,children:S?e:null,role:"tabpanel","aria-labelledby":_,hidden:!u,id:f}}function oie(n,e){return`${n}--tab-${e}`}function aie(n,e){return`${n}--tabpanel-${e}`}const[MVe,dN]=Ni({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),RR=Gt(function(e,i){const a=Ba("Tabs",e),{children:l,className:u,...f}=Ii(e),{htmlProps:_,descendants:E,...S}=AVe(f),w=D.useMemo(()=>S,[S]),{isFitted:I,...k}=_,U={position:"relative",...a.root};return b.jsx(wVe,{value:E,children:b.jsx(PVe,{value:w,children:b.jsx(MVe,{value:a,children:b.jsx(kt.div,{className:ln("chakra-tabs",u),ref:i,...k,__css:U,children:l})})})})});RR.displayName="Tabs";const Ml=Gt(function(e,i){const a=dN(),l=kVe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return b.jsx(kt.button,{...l,className:ln("chakra-tabs__tab",e.className),__css:u})});Ml.displayName="Tab";const IR=Gt(function(e,i){const a=OVe({...e,ref:i}),l=dN(),u={display:"flex",...l.tablist};return b.jsx(kt.div,{...a,className:ln("chakra-tabs__tablist",e.className),__css:u})});IR.displayName="TabList";const Gd=Gt(function(e,i){const a=LVe({...e,ref:i}),l=dN();return b.jsx(kt.div,{outline:"0",...a,className:ln("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Gd.displayName="TabPanel";const hN=Gt(function(e,i){const a=xVe(e),l=dN();return b.jsx(kt.div,{...a,width:"100%",ref:i,className:ln("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});hN.displayName="TabPanels";const UVe=["h","minH","height","minHeight"],jd=Gt((n,e)=>{const i=al("Textarea",n),{className:a,rows:l,...u}=Ii(n),f=t5(u),_=l?$0(i,UVe):i;return b.jsx(kt.textarea,{ref:e,rows:l,...f,className:ln("chakra-textarea",a),__css:_})});jd.displayName="Textarea";function VVe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function jVe(n,e){const i=l=>({...e,...l,position:VVe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),a=l=>{const u=i(l),f=Rne(u);return ep.notify(f,u)};return a.update=(l,u)=>{ep.update(l,i(u))},a.promise=(l,u)=>{const f=a({...u.loading,status:"loading",duration:null});l.then(_=>a.update(f,{status:"success",duration:5e3,...el(u.success,_)})).catch(_=>a.update(f,{status:"error",duration:5e3,...el(u.error,_)}))},a.closeAll=ep.closeAll,a.close=ep.close,a.isActive=ep.isActive,a}function ll(n){const{theme:e}=Tne(),i=KDe();return D.useMemo(()=>jVe(e.direction,{...i,...n}),[n,e.direction,i])}const FVe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},rj=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},kO=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function BVe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:f=l,closeOnEsc:_=!0,onOpen:E,onClose:S,placement:w,id:I,isOpen:k,defaultIsOpen:U,arrowSize:L=10,arrowShadowColor:F,arrowPadding:B,modifiers:q,isDisabled:$,gutter:X,offset:oe,direction:re,...pe}=n,{isOpen:te,onOpen:Z,onClose:ne}=gp({isOpen:k,defaultIsOpen:U,onOpen:E,onClose:S}),{referenceRef:ae,getPopperProps:me,getArrowInnerProps:he,getArrowProps:ue}=b5({enabled:te,placement:w,arrowPadding:B,modifiers:q,gutter:X,offset:oe,direction:re}),Ue=D.useId(),tt=`tooltip-${I??Ue}`,Ce=D.useRef(null),Ie=D.useRef(void 0),ye=D.useCallback(()=>{Ie.current&&(clearTimeout(Ie.current),Ie.current=void 0)},[]),ke=D.useRef(void 0),Te=D.useCallback(()=>{ke.current&&(clearTimeout(ke.current),ke.current=void 0)},[]),ve=D.useCallback(()=>{Te(),ne()},[ne,Te]),Re=WVe(Ce,ve),Me=D.useCallback(()=>{if(!$&&!Ie.current){te&&Re();const Dt=kO(Ce);Ie.current=Dt.setTimeout(Z,e)}},[Re,$,te,Z,e]),Ge=D.useCallback(()=>{ye();const Dt=kO(Ce);ke.current=Dt.setTimeout(ve,i)},[i,ve,ye]),Qe=D.useCallback(()=>{te&&a&&Ge()},[a,Ge,te]),nt=D.useCallback(()=>{te&&f&&Ge()},[f,Ge,te]),ht=D.useCallback(Dt=>{te&&Dt.key==="Escape"&&Ge()},[te,Ge]);n0(()=>rj(Ce),"keydown",_?ht:void 0),n0(()=>{if(!u)return null;const Dt=Ce.current;if(!Dt)return null;const an=JZ(Dt);return an.localName==="body"?kO(Ce):an},"scroll",()=>{te&&u&&ve()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(ye(),te&&ne())},[$,te,ne,ye]),D.useEffect(()=>()=>{ye(),Te()},[ye,Te]),n0(()=>Ce.current,"pointerleave",Ge);const it=D.useCallback((Dt={},an=null)=>({...Dt,ref:Ki(Ce,an,ae),onPointerEnter:Rn(Dt.onPointerEnter,Qt=>{Qt.pointerType!=="touch"&&Me()}),onClick:Rn(Dt.onClick,Qe),onPointerDown:Rn(Dt.onPointerDown,nt),onFocus:Rn(Dt.onFocus,Me),onBlur:Rn(Dt.onBlur,Ge),"aria-describedby":te?tt:void 0}),[Me,Ge,nt,te,tt,Qe,ae]),It=D.useCallback((Dt={},an=null)=>me({...Dt,style:{...Dt.style,[Xs.arrowSize.var]:L?`${L}px`:void 0,[Xs.arrowShadowColor.var]:F}},an),[me,L,F]),jt=D.useCallback((Dt={},an=null)=>{const jn={...Dt.style,position:"relative",transformOrigin:Xs.transformOrigin.varRef};return{ref:an,...pe,...Dt,id:tt,role:"tooltip",style:jn}},[pe,tt]);return{isOpen:te,show:Me,hide:Ge,getTriggerProps:it,getTooltipProps:jt,getTooltipPositionerProps:It,getArrowProps:ue,getArrowInnerProps:he}}const wU="chakra-ui:close-tooltip";function WVe(n,e){return D.useEffect(()=>{const i=rj(n);return i.addEventListener(wU,e),()=>i.removeEventListener(wU,e)},[e,n]),()=>{const i=rj(n),a=kO(n);i.dispatchEvent(new a.CustomEvent(wU))}}const zVe=kt(Sp.div),up=Gt((n,e)=>{const i=al("Tooltip",n),a=Ii(n),l=Kg(),{children:u,label:f,shouldWrapChildren:_,"aria-label":E,hasArrow:S,bg:w,portalProps:I,background:k,backgroundColor:U,bgColor:L,motionProps:F,animatePresenceProps:B,...q}=a,$=k??U??w??L;if($){i.bg=$;const ae=K0e(l,"colors",$);i[Xs.arrowBg.var]=ae}const X=BVe({...q,direction:l.direction}),oe=!D.isValidElement(u)||_;let re;if(oe)re=b.jsx(kt.span,{display:"inline-block",tabIndex:0,...X.getTriggerProps(),children:u});else{const ae=D.Children.only(u);re=D.cloneElement(ae,X.getTriggerProps(ae.props,Yre(ae)))}const pe=!!E,te=X.getTooltipProps({},e),Z=pe?$0(te,["role","id"]):te,ne=YZ(te,["role","id"]);return f?b.jsxs(b.Fragment,{children:[re,b.jsx(iE,{...B,children:X.isOpen&&b.jsx($l,{...I,children:b.jsx(kt.div,{...X.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:b.jsxs(zVe,{variants:FVe,initial:"exit",animate:"enter",exit:"exit",...F,...Z,__css:i,children:[f,pe&&b.jsx(kt.span,{srOnly:!0,...ne,children:E}),S&&b.jsx(kt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:b.jsx(kt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):b.jsx(b.Fragment,{children:u})});up.displayName="Tooltip";const br=Gt(function(e,i){const a=al("Heading",e),{className:l,...u}=Ii(e);return b.jsx(kt.h2,{ref:i,className:ln("chakra-heading",e.className),...u,__css:a})});br.displayName="Heading";const et=Gt(function(e,i){const a=al("Text",e),{className:l,align:u,decoration:f,casing:_,...E}=Ii(e),S=dR({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return b.jsx(kt.p,{ref:i,className:ln("chakra-text",e.className),...S,...E,__css:a})});et.displayName="Text";var CU,GX;function GVe(){if(GX)return CU;GX=1;var n=function(e,i,a,l,u,f,_,E){if(!e){var S;if(i===void 0)S=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var w=[a,l,u,f,_,E],I=0;S=new Error(i.replace(/%s/g,function(){return w[I++]})),S.name="Invariant Violation"}throw S.framesToPop=1,S}};return CU=n,CU}var HVe=GVe();const HX=Jf(HVe);var RU,$X;function $Ve(){return $X||($X=1,RU=function(e,i,a,l){var u=a?a.call(l,e,i):void 0;if(u!==void 0)return!!u;if(e===i)return!0;if(typeof e!="object"||!e||typeof i!="object"||!i)return!1;var f=Object.keys(e),_=Object.keys(i);if(f.length!==_.length)return!1;for(var E=Object.prototype.hasOwnProperty.bind(i),S=0;S<f.length;S++){var w=f[S];if(!E(w))return!1;var I=e[w],k=i[w];if(u=a?a.call(l,I,k,w):void 0,u===!1||u===void 0&&I!==k)return!1}return!0}),RU}var KVe=$Ve();const qVe=Jf(KVe);var cie=(n=>(n.BASE="base",n.BODY="body",n.HEAD="head",n.HTML="html",n.LINK="link",n.META="meta",n.NOSCRIPT="noscript",n.SCRIPT="script",n.STYLE="style",n.TITLE="title",n.FRAGMENT="Symbol(react.fragment)",n))(cie||{}),IU={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},KX=Object.values(cie),T5={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},YVe=Object.entries(T5).reduce((n,[e,i])=>(n[i]=e,n),{}),Hd="data-rh",p0={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},f0=(n,e)=>{for(let i=n.length-1;i>=0;i-=1){const a=n[i];if(Object.prototype.hasOwnProperty.call(a,e))return a[e]}return null},XVe=n=>{let e=f0(n,"title");const i=f0(n,p0.TITLE_TEMPLATE);if(Array.isArray(e)&&(e=e.join("")),i&&e)return i.replace(/%s/g,()=>e);const a=f0(n,p0.DEFAULT_TITLE);return e||a||void 0},JVe=n=>f0(n,p0.ON_CHANGE_CLIENT_STATE)||(()=>{}),AU=(n,e)=>e.filter(i=>typeof i[n]<"u").map(i=>i[n]).reduce((i,a)=>({...i,...a}),{}),QVe=(n,e)=>e.filter(i=>typeof i.base<"u").map(i=>i.base).reverse().reduce((i,a)=>{if(!i.length){const l=Object.keys(a);for(let u=0;u<l.length;u+=1){const _=l[u].toLowerCase();if(n.indexOf(_)!==-1&&a[_])return i.concat(a)}}return i},[]),ZVe=n=>console&&typeof console.warn=="function"&&console.warn(n),Aw=(n,e,i)=>{const a={};return i.filter(l=>Array.isArray(l[n])?!0:(typeof l[n]<"u"&&ZVe(`Helmet: ${n} should be of type "Array". Instead found type "${typeof l[n]}"`),!1)).map(l=>l[n]).reverse().reduce((l,u)=>{const f={};u.filter(E=>{let S;const w=Object.keys(E);for(let k=0;k<w.length;k+=1){const U=w[k],L=U.toLowerCase();e.indexOf(L)!==-1&&!(S==="rel"&&E[S].toLowerCase()==="canonical")&&!(L==="rel"&&E[L].toLowerCase()==="stylesheet")&&(S=L),e.indexOf(U)!==-1&&(U==="innerHTML"||U==="cssText"||U==="itemprop")&&(S=U)}if(!S||!E[S])return!1;const I=E[S].toLowerCase();return a[S]||(a[S]={}),f[S]||(f[S]={}),a[S][I]?!1:(f[S][I]=!0,!0)}).reverse().forEach(E=>l.push(E));const _=Object.keys(f);for(let E=0;E<_.length;E+=1){const S=_[E],w={...a[S],...f[S]};a[S]=w}return l},[]).reverse()},eje=(n,e)=>{if(Array.isArray(n)&&n.length){for(let i=0;i<n.length;i+=1)if(n[i][e])return!0}return!1},tje=n=>({baseTag:QVe(["href"],n),bodyAttributes:AU("bodyAttributes",n),defer:f0(n,p0.DEFER),encode:f0(n,p0.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:AU("htmlAttributes",n),linkTags:Aw("link",["rel","href"],n),metaTags:Aw("meta",["name","charset","http-equiv","property","itemprop"],n),noscriptTags:Aw("noscript",["innerHTML"],n),onChangeClientState:JVe(n),scriptTags:Aw("script",["src","innerHTML"],n),styleTags:Aw("style",["cssText"],n),title:XVe(n),titleAttributes:AU("titleAttributes",n),prioritizeSeoTags:eje(n,p0.PRIORITIZE_SEO_TAGS)}),lie=n=>Array.isArray(n)?n.join(""):n,nje=(n,e)=>{const i=Object.keys(n);for(let a=0;a<i.length;a+=1)if(e[i[a]]&&e[i[a]].includes(n[i[a]]))return!0;return!1},PU=(n,e)=>Array.isArray(n)?n.reduce((i,a)=>(nje(a,e)?i.priority.push(a):i.default.push(a),i),{priority:[],default:[]}):{default:n,priority:[]},qX=(n,e)=>({...n,[e]:void 0}),rje=["noscript","script","style"],ij=(n,e=!0)=>e===!1?String(n):String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),uie=n=>Object.keys(n).reduce((e,i)=>{const a=typeof n[i]<"u"?`${i}="${n[i]}"`:`${i}`;return e?`${e} ${a}`:a},""),ije=(n,e,i,a)=>{const l=uie(i),u=lie(e);return l?`<${n} ${Hd}="true" ${l}>${ij(u,a)}</${n}>`:`<${n} ${Hd}="true">${ij(u,a)}</${n}>`},sje=(n,e,i=!0)=>e.reduce((a,l)=>{const u=l,f=Object.keys(u).filter(S=>!(S==="innerHTML"||S==="cssText")).reduce((S,w)=>{const I=typeof u[w]>"u"?w:`${w}="${ij(u[w],i)}"`;return S?`${S} ${I}`:I},""),_=u.innerHTML||u.cssText||"",E=rje.indexOf(n)===-1;return`${a}<${n} ${Hd}="true" ${f}${E?"/>":`>${_}</${n}>`}`},""),die=(n,e={})=>Object.keys(n).reduce((i,a)=>{const l=T5[a];return i[l||a]=n[a],i},e),oje=(n,e,i)=>{const a={key:e,[Hd]:!0},l=die(i,a);return[mr.createElement("title",l,e)]},NO=(n,e)=>e.map((i,a)=>{const l={key:a,[Hd]:!0};return Object.keys(i).forEach(u=>{const _=T5[u]||u;if(_==="innerHTML"||_==="cssText"){const E=i.innerHTML||i.cssText;l.dangerouslySetInnerHTML={__html:E}}else l[_]=i[u]}),mr.createElement(n,l)}),xu=(n,e,i=!0)=>{switch(n){case"title":return{toComponent:()=>oje(n,e.title,e.titleAttributes),toString:()=>ije(n,e.title,e.titleAttributes,i)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>die(e),toString:()=>uie(e)};default:return{toComponent:()=>NO(n,e),toString:()=>sje(n,e,i)}}},aje=({metaTags:n,linkTags:e,scriptTags:i,encode:a})=>{const l=PU(n,IU.meta),u=PU(e,IU.link),f=PU(i,IU.script);return{priorityMethods:{toComponent:()=>[...NO("meta",l.priority),...NO("link",u.priority),...NO("script",f.priority)],toString:()=>`${xu("meta",l.priority,a)} ${xu("link",u.priority,a)} ${xu("script",f.priority,a)}`},metaTags:l.default,linkTags:u.default,scriptTags:f.default}},cje=n=>{const{baseTag:e,bodyAttributes:i,encode:a=!0,htmlAttributes:l,noscriptTags:u,styleTags:f,title:_="",titleAttributes:E,prioritizeSeoTags:S}=n;let{linkTags:w,metaTags:I,scriptTags:k}=n,U={toComponent:()=>{},toString:()=>""};return S&&({priorityMethods:U,linkTags:w,metaTags:I,scriptTags:k}=aje(n)),{priority:U,base:xu("base",e,a),bodyAttributes:xu("bodyAttributes",i,a),htmlAttributes:xu("htmlAttributes",l,a),link:xu("link",w,a),meta:xu("meta",I,a),noscript:xu("noscript",u,a),script:xu("script",k,a),style:xu("style",f,a),title:xu("title",{title:_,titleAttributes:E},a)}},sj=cje,X1=[],hie=!!(typeof window<"u"&&window.document&&window.document.createElement),oj=class{constructor(n,e){Sf(this,"instances",[]);Sf(this,"canUseDOM",hie);Sf(this,"context");Sf(this,"value",{setHelmet:n=>{this.context.helmet=n},helmetInstances:{get:()=>this.canUseDOM?X1:this.instances,add:n=>{(this.canUseDOM?X1:this.instances).push(n)},remove:n=>{const e=(this.canUseDOM?X1:this.instances).indexOf(n);(this.canUseDOM?X1:this.instances).splice(e,1)}}});this.context=n,this.canUseDOM=e||!1,e||(n.helmet=sj({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},lje={},pie=mr.createContext(lje),xy,fie=(xy=class extends D.Component{constructor(i){super(i);Sf(this,"helmetData");this.helmetData=new oj(this.props.context||{},xy.canUseDOM)}render(){return mr.createElement(pie.Provider,{value:this.helmetData.value},this.props.children)}},Sf(xy,"canUseDOM",hie),xy),MS=(n,e)=>{const i=document.head||document.querySelector("head"),a=i.querySelectorAll(`${n}[${Hd}]`),l=[].slice.call(a),u=[];let f;return e&&e.length&&e.forEach(_=>{const E=document.createElement(n);for(const S in _)if(Object.prototype.hasOwnProperty.call(_,S))if(S==="innerHTML")E.innerHTML=_.innerHTML;else if(S==="cssText")E.styleSheet?E.styleSheet.cssText=_.cssText:E.appendChild(document.createTextNode(_.cssText));else{const w=S,I=typeof _[w]>"u"?"":_[w];E.setAttribute(S,I)}E.setAttribute(Hd,"true"),l.some((S,w)=>(f=w,E.isEqualNode(S)))?l.splice(f,1):u.push(E)}),l.forEach(_=>{var E;return(E=_.parentNode)==null?void 0:E.removeChild(_)}),u.forEach(_=>i.appendChild(_)),{oldTags:l,newTags:u}},aj=(n,e)=>{const i=document.getElementsByTagName(n)[0];if(!i)return;const a=i.getAttribute(Hd),l=a?a.split(","):[],u=[...l],f=Object.keys(e);for(const _ of f){const E=e[_]||"";i.getAttribute(_)!==E&&i.setAttribute(_,E),l.indexOf(_)===-1&&l.push(_);const S=u.indexOf(_);S!==-1&&u.splice(S,1)}for(let _=u.length-1;_>=0;_-=1)i.removeAttribute(u[_]);l.length===u.length?i.removeAttribute(Hd):i.getAttribute(Hd)!==f.join(",")&&i.setAttribute(Hd,f.join(","))},uje=(n,e)=>{typeof n<"u"&&document.title!==n&&(document.title=lie(n)),aj("title",e)},YX=(n,e)=>{const{baseTag:i,bodyAttributes:a,htmlAttributes:l,linkTags:u,metaTags:f,noscriptTags:_,onChangeClientState:E,scriptTags:S,styleTags:w,title:I,titleAttributes:k}=n;aj("body",a),aj("html",l),uje(I,k);const U={baseTag:MS("base",i),linkTags:MS("link",u),metaTags:MS("meta",f),noscriptTags:MS("noscript",_),scriptTags:MS("script",S),styleTags:MS("style",w)},L={},F={};Object.keys(U).forEach(B=>{const{newTags:q,oldTags:$}=U[B];q.length&&(L[B]=q),$.length&&(F[B]=U[B].oldTags)}),e&&e(),E(n,L,F)},Pw=null,dje=n=>{Pw&&cancelAnimationFrame(Pw),n.defer?Pw=requestAnimationFrame(()=>{YX(n,()=>{Pw=null})}):(YX(n),Pw=null)},hje=dje,XX=class extends D.Component{constructor(){super(...arguments);Sf(this,"rendered",!1)}shouldComponentUpdate(e){return!qVe(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:i}=this.props.context;let a=null;const l=tje(e.get().map(u=>{const f={...u.props};return delete f.context,f}));fie.canUseDOM?hje(l):sj&&(a=sj(l)),i(a)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},ZU,Q0=(ZU=class extends D.Component{shouldComponentUpdate(n){return!bne(qX(this.props,"helmetData"),qX(n,"helmetData"))}mapNestedChildrenToProps(n,e){if(!e)return null;switch(n.type){case"script":case"noscript":return{innerHTML:e};case"style":return{cssText:e};default:throw new Error(`<${n.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(n,e,i,a){return{...e,[n.type]:[...e[n.type]||[],{...i,...this.mapNestedChildrenToProps(n,a)}]}}mapObjectTypeChildren(n,e,i,a){switch(n.type){case"title":return{...e,[n.type]:a,titleAttributes:{...i}};case"body":return{...e,bodyAttributes:{...i}};case"html":return{...e,htmlAttributes:{...i}};default:return{...e,[n.type]:{...i}}}}mapArrayTypeChildrenToProps(n,e){let i={...e};return Object.keys(n).forEach(a=>{i={...i,[a]:n[a]}}),i}warnOnInvalidChildren(n,e){return HX(KX.some(i=>n.type===i),typeof n.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${KX.join(", ")} are allowed. Helmet does not support rendering <${n.type}> elements. Refer to our API for more information.`),HX(!e||typeof e=="string"||Array.isArray(e)&&!e.some(i=>typeof i!="string"),`Helmet expects a string as a child of <${n.type}>. Did you forget to wrap your children in braces? ( <${n.type}>{\`\`}</${n.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(n,e){let i={};return mr.Children.forEach(n,a=>{if(!a||!a.props)return;const{children:l,...u}=a.props,f=Object.keys(u).reduce((E,S)=>(E[YVe[S]||S]=u[S],E),{});let{type:_}=a;switch(typeof _=="symbol"?_=_.toString():this.warnOnInvalidChildren(a,l),_){case"Symbol(react.fragment)":e=this.mapChildrenToProps(l,e);break;case"link":case"meta":case"noscript":case"script":case"style":i=this.flattenArrayTypeChildren(a,i,f,l);break;default:e=this.mapObjectTypeChildren(a,e,f,l);break}}),this.mapArrayTypeChildrenToProps(i,e)}render(){const{children:n,...e}=this.props;let i={...e},{helmetData:a}=e;if(n&&(i=this.mapChildrenToProps(n,i)),a&&!(a instanceof oj)){const l=a;a=new oj(l.context,!0),delete i.helmetData}return a?mr.createElement(XX,{...i,context:a.value}):mr.createElement(pie.Consumer,null,l=>mr.createElement(XX,{...i,context:l}))}},Sf(ZU,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),ZU);const pje=()=>{};var JX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mie=function(n){const e=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},fje=function(n){const e=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)e[a++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[a++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],f=n[i++],_=n[i++],E=((l&7)<<18|(u&63)<<12|(f&63)<<6|_&63)-65536;e[a++]=String.fromCharCode(55296+(E>>10)),e[a++]=String.fromCharCode(56320+(E&1023))}else{const u=n[i++],f=n[i++];e[a++]=String.fromCharCode((l&15)<<12|(u&63)<<6|f&63)}}return e.join("")},gie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const u=n[l],f=l+1<n.length,_=f?n[l+1]:0,E=l+2<n.length,S=E?n[l+2]:0,w=u>>2,I=(u&3)<<4|_>>4;let k=(_&15)<<2|S>>6,U=S&63;E||(U=64,f||(k=64)),a.push(i[w],i[I],i[k],i[U])}return a.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(mie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):fje(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const S=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||_==null||S==null||I==null)throw new mje;const k=u<<2|_>>4;if(a.push(k),S!==64){const U=_<<4&240|S>>2;if(a.push(U),I!==64){const L=S<<6&192|I;a.push(L)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class mje extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gje=function(n){const e=mie(n);return gie.encodeByteArray(e,!0)},lk=function(n){return gje(n).replace(/\./g,"")},_ie=function(n){try{return gie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _je(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yje=()=>_je().__FIREBASE_DEFAULTS__,Eje=()=>{if(typeof process>"u"||typeof JX>"u")return;const n=JX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},vje=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&_ie(n[1]);return e&&JSON.parse(e)},pN=()=>{try{return pje()||yje()||Eje()||vje()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},yie=n=>{var e,i;return(i=(e=pN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},Eie=n=>{const e=yie(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const a=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),a]:[e.substring(0,i),a]},vie=()=>{var n;return(n=pN())===null||n===void 0?void 0:n.config},Sie=n=>{var e;return(e=pN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sje{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[lk(JSON.stringify(i)),lk(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bje(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fa())}function Tje(){var n;const e=(n=pN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function wje(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Cje(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Rje(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ije(){const n=Fa();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Aje(){return!Tje()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Pje(){try{return typeof indexedDB=="object"}catch{return!1}}function Oje(){return new Promise((n,e)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kje="FirebaseError";class Tp extends Error{constructor(e,i,a){super(i),this.code=e,this.customData=a,this.name=kje,Object.setPrototypeOf(this,Tp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,AR.prototype.create)}}class AR{constructor(e,i,a){this.service=e,this.serviceName=i,this.errors=a}create(e,...i){const a=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],f=u?Nje(u,a):"Error",_=`${this.serviceName}: ${f} (${l}).`;return new Tp(l,_,a)}}function Nje(n,e){return n.replace(Dje,(i,a)=>{const l=e[a];return l!=null?String(l):`<${a}?>`})}const Dje=/\{\$([^}]+)}/g;function xje(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Jy(n,e){if(n===e)return!0;const i=Object.keys(n),a=Object.keys(e);for(const l of i){if(!a.includes(l))return!1;const u=n[l],f=e[l];if(QX(u)&&QX(f)){if(!Jy(u,f))return!1}else if(u!==f)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function QX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PR(n){const e=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return e.length?"&"+e.join("&"):""}function tC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,u]=a.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function nC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function Lje(n,e){const i=new Mje(n,e);return i.subscribe.bind(i)}class Mje{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(a=>{this.error(a)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,a){let l;if(e===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");Uje(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:a},l.next===void 0&&(l.next=OU),l.error===void 0&&(l.error=OU),l.complete===void 0&&(l.complete=OU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Uje(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function OU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xi(n){return n&&n._delegate?n._delegate:n}class Mg{constructor(e,i,a){this.name=e,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vje{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const a=new Sje;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const a=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Fje(e))try{this.getOrInitializeService({instanceIdentifier:Cy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});a.resolve(u)}catch{}}}}clearInstance(e=Cy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Cy){return this.instances.has(e)}getOptions(e=Cy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,a=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[u,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);a===_&&f.resolve(l)}return l}onInit(e,i){var a;const l=this.normalizeInstanceIdentifier(i),u=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;u.add(e),this.onInitCallbacks.set(l,u);const f=this.instances.get(l);return f&&e(f,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:jje(e),options:i}),this.instances.set(e,a),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch{}return a||null}normalizeInstanceIdentifier(e=Cy){return this.component?this.component.multipleInstances?e:Cy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jje(n){return n===Cy?void 0:n}function Fje(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bje{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new Vje(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ir;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ir||(Ir={}));const Wje={debug:Ir.DEBUG,verbose:Ir.VERBOSE,info:Ir.INFO,warn:Ir.WARN,error:Ir.ERROR,silent:Ir.SILENT},zje=Ir.INFO,Gje={[Ir.DEBUG]:"log",[Ir.VERBOSE]:"log",[Ir.INFO]:"info",[Ir.WARN]:"warn",[Ir.ERROR]:"error"},Hje=(n,e,...i)=>{if(e<n.logLevel)return;const a=new Date().toISOString(),l=Gje[e];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let w5=class{constructor(e){this.name=e,this._logLevel=zje,this._logHandler=Hje,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ir))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Wje[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ir.DEBUG,...e),this._logHandler(this,Ir.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ir.VERBOSE,...e),this._logHandler(this,Ir.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ir.INFO,...e),this._logHandler(this,Ir.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ir.WARN,...e),this._logHandler(this,Ir.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ir.ERROR,...e),this._logHandler(this,Ir.ERROR,...e)}};const $je=(n,e)=>e.some(i=>n instanceof i);let ZX,eJ;function Kje(){return ZX||(ZX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qje(){return eJ||(eJ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Tie=new WeakMap,cj=new WeakMap,wie=new WeakMap,kU=new WeakMap,C5=new WeakMap;function Yje(n){const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",f)},u=()=>{i(Ig(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",f)});return e.then(i=>{i instanceof IDBCursor&&Tie.set(i,n)}).catch(()=>{}),C5.set(e,n),e}function Xje(n){if(cj.has(n))return;const e=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",f),n.removeEventListener("abort",f)},u=()=>{i(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",f),n.addEventListener("abort",f)});cj.set(n,e)}let lj={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return cj.get(n);if(e==="objectStoreNames")return n.objectStoreNames||wie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Ig(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Jje(n){lj=n(lj)}function Qje(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const a=n.call(NU(this),e,...i);return wie.set(a,e.sort?e.sort():[e]),Ig(a)}:qje().includes(n)?function(...e){return n.apply(NU(this),e),Ig(Tie.get(this))}:function(...e){return Ig(n.apply(NU(this),e))}}function Zje(n){return typeof n=="function"?Qje(n):(n instanceof IDBTransaction&&Xje(n),$je(n,Kje())?new Proxy(n,lj):n)}function Ig(n){if(n instanceof IDBRequest)return Yje(n);if(kU.has(n))return kU.get(n);const e=Zje(n);return e!==n&&(kU.set(n,e),C5.set(e,n)),e}const NU=n=>C5.get(n);function eFe(n,e,{blocked:i,upgrade:a,blocking:l,terminated:u}={}){const f=indexedDB.open(n,e),_=Ig(f);return a&&f.addEventListener("upgradeneeded",E=>{a(Ig(f.result),E.oldVersion,E.newVersion,Ig(f.transaction),E)}),i&&f.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{u&&E.addEventListener("close",()=>u()),l&&E.addEventListener("versionchange",S=>l(S.oldVersion,S.newVersion,S))}).catch(()=>{}),_}const tFe=["get","getKey","getAll","getAllKeys","count"],nFe=["put","add","delete","clear"],DU=new Map;function tJ(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(DU.get(e))return DU.get(e);const i=e.replace(/FromIndex$/,""),a=e!==i,l=nFe.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||tFe.includes(i)))return;const u=async function(f,..._){const E=this.transaction(f,l?"readwrite":"readonly");let S=E.store;return a&&(S=S.index(_.shift())),(await Promise.all([S[i](..._),l&&E.done]))[0]};return DU.set(e,u),u}Jje(n=>({...n,get:(e,i,a)=>tJ(e,i)||n.get(e,i,a),has:(e,i)=>!!tJ(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rFe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(iFe(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function iFe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const uj="@firebase/app",nJ="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f=new w5("@firebase/app"),sFe="@firebase/app-compat",oFe="@firebase/analytics-compat",aFe="@firebase/analytics",cFe="@firebase/app-check-compat",lFe="@firebase/app-check",uFe="@firebase/auth",dFe="@firebase/auth-compat",hFe="@firebase/database",pFe="@firebase/data-connect",fFe="@firebase/database-compat",mFe="@firebase/functions",gFe="@firebase/functions-compat",_Fe="@firebase/installations",yFe="@firebase/installations-compat",EFe="@firebase/messaging",vFe="@firebase/messaging-compat",SFe="@firebase/performance",bFe="@firebase/performance-compat",TFe="@firebase/remote-config",wFe="@firebase/remote-config-compat",CFe="@firebase/storage",RFe="@firebase/storage-compat",IFe="@firebase/firestore",AFe="@firebase/vertexai",PFe="@firebase/firestore-compat",OFe="firebase",kFe="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dj="[DEFAULT]",NFe={[uj]:"fire-core",[sFe]:"fire-core-compat",[aFe]:"fire-analytics",[oFe]:"fire-analytics-compat",[lFe]:"fire-app-check",[cFe]:"fire-app-check-compat",[uFe]:"fire-auth",[dFe]:"fire-auth-compat",[hFe]:"fire-rtdb",[pFe]:"fire-data-connect",[fFe]:"fire-rtdb-compat",[mFe]:"fire-fn",[gFe]:"fire-fn-compat",[_Fe]:"fire-iid",[yFe]:"fire-iid-compat",[EFe]:"fire-fcm",[vFe]:"fire-fcm-compat",[SFe]:"fire-perf",[bFe]:"fire-perf-compat",[TFe]:"fire-rc",[wFe]:"fire-rc-compat",[CFe]:"fire-gcs",[RFe]:"fire-gcs-compat",[IFe]:"fire-fst",[PFe]:"fire-fst-compat",[AFe]:"fire-vertex","fire-js":"fire-js",[OFe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk=new Map,DFe=new Map,hj=new Map;function rJ(n,e){try{n.container.addComponent(e)}catch(i){$f.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Qy(n){const e=n.name;if(hj.has(e))return $f.debug(`There were multiple attempts to register component ${e}.`),!1;hj.set(e,n);for(const i of uk.values())rJ(i,n);for(const i of DFe.values())rJ(i,n);return!0}function fN(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function Ll(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xFe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ag=new AR("app","Firebase",xFe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LFe{constructor(e,i,a){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Mg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ag.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aE=kFe;function Cie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const a=Object.assign({name:dj,automaticDataCollectionEnabled:!1},e),l=a.name;if(typeof l!="string"||!l)throw Ag.create("bad-app-name",{appName:String(l)});if(i||(i=vie()),!i)throw Ag.create("no-options");const u=uk.get(l);if(u){if(Jy(i,u.options)&&Jy(a,u.config))return u;throw Ag.create("duplicate-app",{appName:l})}const f=new Bje(l);for(const E of hj.values())f.addComponent(E);const _=new LFe(i,a,f);return uk.set(l,_),_}function R5(n=dj){const e=uk.get(n);if(!e&&n===dj&&vie())return Cie();if(!e)throw Ag.create("no-app",{appName:n});return e}function dp(n,e,i){var a;let l=(a=NFe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),f=e.match(/\s|\//);if(u||f){const _=[`Unable to register library "${l}" with version "${e}":`];u&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&f&&_.push("and"),f&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$f.warn(_.join(" "));return}Qy(new Mg(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MFe="firebase-heartbeat-database",UFe=1,QC="firebase-heartbeat-store";let xU=null;function Rie(){return xU||(xU=eFe(MFe,UFe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(QC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Ag.create("idb-open",{originalErrorMessage:n.message})})),xU}async function VFe(n){try{const i=(await Rie()).transaction(QC),a=await i.objectStore(QC).get(Iie(n));return await i.done,a}catch(e){if(e instanceof Tp)$f.warn(e.message);else{const i=Ag.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});$f.warn(i.message)}}}async function iJ(n,e){try{const a=(await Rie()).transaction(QC,"readwrite");await a.objectStore(QC).put(e,Iie(n)),await a.done}catch(i){if(i instanceof Tp)$f.warn(i.message);else{const a=Ag.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});$f.warn(a.message)}}}function Iie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jFe=1024,FFe=30;class BFe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new zFe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=sJ();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(f=>f.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>FFe){const f=GFe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){$f.warn(a)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=sJ(),{heartbeatsToSend:a,unsentEntries:l}=WFe(this._heartbeatsCache.heartbeats),u=lk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return $f.warn(i),""}}}function sJ(){return new Date().toISOString().substring(0,10)}function WFe(n,e=jFe){const i=[];let a=n.slice();for(const l of n){const u=i.find(f=>f.agent===l.agent);if(u){if(u.dates.push(l.date),oJ(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),oJ(i)>e){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class zFe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Pje()?Oje().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await VFe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return iJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return iJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function oJ(n){return lk(JSON.stringify({version:2,heartbeats:n})).length}function GFe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,e=a);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HFe(n){Qy(new Mg("platform-logger",e=>new rFe(e),"PRIVATE")),Qy(new Mg("heartbeat",e=>new BFe(e),"PRIVATE")),dp(uj,nJ,n),dp(uj,nJ,"esm2017"),dp("fire-js","")}HFe("");function Aie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const $Fe=Aie,Pie=new AR("auth","Firebase",Aie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=new w5("@firebase/auth");function KFe(n,...e){dk.logLevel<=Ir.WARN&&dk.warn(`Auth (${aE}): ${n}`,...e)}function DO(n,...e){dk.logLevel<=Ir.ERROR&&dk.error(`Auth (${aE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yd(n,...e){throw I5(n,...e)}function hp(n,...e){return I5(n,...e)}function Oie(n,e,i){const a=Object.assign(Object.assign({},$Fe()),{[e]:i});return new AR("auth","Firebase",a).create(e,{appName:n.name})}function Bf(n){return Oie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function I5(n,...e){if(typeof n!="string"){const i=e[0],a=[...e.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return Pie.create(n,...e)}function Vn(n,e,...i){if(!n)throw I5(e,...i)}function kf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw DO(e),new Error(e)}function Kf(n,e){n||kf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pj(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function qFe(){return aJ()==="http:"||aJ()==="https:"}function aJ(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YFe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qFe()||Cje()||"connection"in navigator)?navigator.onLine:!0}function XFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OR{constructor(e,i){this.shortDelay=e,this.longDelay=i,Kf(i>e,"Short delay should be less than long delay!"),this.isMobile=bje()||Rje()}get(){return YFe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A5(n,e){Kf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kie{static initialize(e,i,a){this.fetchImpl=e,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;kf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;kf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;kf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QFe=new OR(3e4,6e4);function Zf(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function em(n,e,i,a,l={}){return Nie(n,l,async()=>{let u={},f={};a&&(e==="GET"?f=a:u={body:JSON.stringify(a)});const _=PR(Object.assign({key:n.config.apiKey},f)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const S=Object.assign({method:e,headers:E},u);return wje()||(S.referrerPolicy="no-referrer"),kie.fetch()(Die(n,n.config.apiHost,i,_),S)})}async function Nie(n,e,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},JFe),e);try{const l=new e5e(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await u.json();if("needConfirmation"in f)throw J1(n,"account-exists-with-different-credential",f);if(u.ok&&!("errorMessage"in f))return f;{const _=u.ok?f.errorMessage:f.error.message,[E,S]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw J1(n,"credential-already-in-use",f);if(E==="EMAIL_EXISTS")throw J1(n,"email-already-in-use",f);if(E==="USER_DISABLED")throw J1(n,"user-disabled",f);const w=a[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(S)throw Oie(n,w,S);Yd(n,w)}}catch(l){if(l instanceof Tp)throw l;Yd(n,"network-request-failed",{message:String(l)})}}async function kR(n,e,i,a,l={}){const u=await em(n,e,i,a,l);return"mfaPendingCredential"in u&&Yd(n,"multi-factor-auth-required",{_serverResponse:u}),u}function Die(n,e,i,a){const l=`${e}${i}?${a}`;return n.config.emulator?A5(n.config,l):`${n.config.apiScheme}://${l}`}function ZFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class e5e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(hp(this.auth,"network-request-failed")),QFe.get())})}}function J1(n,e,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=hp(n,e,a);return l.customData._tokenResponse=i,l}function cJ(n){return n!==void 0&&n.enterprise!==void 0}class t5e{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return ZFe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function n5e(n,e){return em(n,"GET","/v2/recaptchaConfig",Zf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r5e(n,e){return em(n,"POST","/v1/accounts:delete",e)}async function xie(n,e){return em(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function i5e(n,e=!1){const i=Xi(n),a=await i.getIdToken(e),l=P5(a);Vn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,f=u==null?void 0:u.sign_in_provider;return{claims:l,token:a,authTime:vC(LU(l.auth_time)),issuedAtTime:vC(LU(l.iat)),expirationTime:vC(LU(l.exp)),signInProvider:f||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function LU(n){return Number(n)*1e3}function P5(n){const[e,i,a]=n.split(".");if(e===void 0||i===void 0||a===void 0)return DO("JWT malformed, contained fewer than 3 sections"),null;try{const l=_ie(i);return l?JSON.parse(l):(DO("Failed to decode base64 JWT payload"),null)}catch(l){return DO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function lJ(n){const e=P5(n);return Vn(e,"internal-error"),Vn(typeof e.exp<"u","internal-error"),Vn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZC(n,e,i=!1){if(i)return e;try{return await e}catch(a){throw a instanceof Tp&&s5e(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function s5e({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5e{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=vC(this.lastLoginAt),this.creationTime=vC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hk(n){var e;const i=n.auth,a=await n.getIdToken(),l=await ZC(n,xie(i,{idToken:a}));Vn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const f=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?Lie(u.providerUserInfo):[],_=c5e(n.providerData,f),E=n.isAnonymous,S=!(n.email&&u.passwordHash)&&!(_!=null&&_.length),w=E?S:!1,I={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new fj(u.createdAt,u.lastLoginAt),isAnonymous:w};Object.assign(n,I)}async function a5e(n){const e=Xi(n);await hk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function c5e(n,e){return[...n.filter(a=>!e.some(l=>l.providerId===a.providerId)),...e]}function Lie(n){return n.map(e=>{var{providerId:i}=e,a=bR(e,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l5e(n,e){const i=await Nie(n,{},async()=>{const a=PR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,f=Die(n,l,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",kie.fetch()(f,{method:"POST",headers:_,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function u5e(n,e){return em(n,"POST","/v2/accounts:revokeToken",Zf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Vn(e.idToken,"internal-error"),Vn(typeof e.idToken<"u","internal-error"),Vn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):lJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Vn(e.length!==0,"internal-error");const i=lJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Vn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:a,refreshToken:l,expiresIn:u}=await l5e(e,i);this.updateTokensAndExpiration(a,l,Number(u))}updateTokensAndExpiration(e,i,a){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(e,i){const{refreshToken:a,accessToken:l,expirationTime:u}=i,f=new m0;return a&&(Vn(typeof a=="string","internal-error",{appName:e}),f.refreshToken=a),l&&(Vn(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),u&&(Vn(typeof u=="number","internal-error",{appName:e}),f.expirationTime=u),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new m0,this.toJSON())}_performRefresh(){return kf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dg(n,e){Vn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Nf{constructor(e){var{uid:i,auth:a,stsTokenManager:l}=e,u=bR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new o5e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new fj(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await ZC(this,this.stsTokenManager.getToken(this.auth,e));return Vn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return i5e(this,e)}reload(){return a5e(this)}_assign(e){this!==e&&(Vn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Nf(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Vn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let a=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),a=!0),i&&await hk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ll(this.auth.app))return Promise.reject(Bf(this.auth));const e=await this.getIdToken();return await ZC(this,r5e(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var a,l,u,f,_,E,S,w;const I=(a=i.displayName)!==null&&a!==void 0?a:void 0,k=(l=i.email)!==null&&l!==void 0?l:void 0,U=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,L=(f=i.photoURL)!==null&&f!==void 0?f:void 0,F=(_=i.tenantId)!==null&&_!==void 0?_:void 0,B=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,q=(S=i.createdAt)!==null&&S!==void 0?S:void 0,$=(w=i.lastLoginAt)!==null&&w!==void 0?w:void 0,{uid:X,emailVerified:oe,isAnonymous:re,providerData:pe,stsTokenManager:te}=i;Vn(X&&te,e,"internal-error");const Z=m0.fromJSON(this.name,te);Vn(typeof X=="string",e,"internal-error"),dg(I,e.name),dg(k,e.name),Vn(typeof oe=="boolean",e,"internal-error"),Vn(typeof re=="boolean",e,"internal-error"),dg(U,e.name),dg(L,e.name),dg(F,e.name),dg(B,e.name),dg(q,e.name),dg($,e.name);const ne=new Nf({uid:X,auth:e,email:k,emailVerified:oe,displayName:I,isAnonymous:re,photoURL:L,phoneNumber:U,tenantId:F,stsTokenManager:Z,createdAt:q,lastLoginAt:$});return pe&&Array.isArray(pe)&&(ne.providerData=pe.map(ae=>Object.assign({},ae))),B&&(ne._redirectEventId=B),ne}static async _fromIdTokenResponse(e,i,a=!1){const l=new m0;l.updateFromServerResponse(i);const u=new Nf({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a});return await hk(u),u}static async _fromGetAccountInfoResponse(e,i,a){const l=i.users[0];Vn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?Lie(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),_=new m0;_.updateFromIdToken(a);const E=new Nf({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:f}),S={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new fj(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(E,S),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uJ=new Map;function Df(n){Kf(n instanceof Function,"Expected a class definition");let e=uJ.get(n);return e?(Kf(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,uJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Mie.type="NONE";const dJ=Mie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xO(n,e,i){return`firebase:${n}:${e}:${i}`}class g0{constructor(e,i,a){this.persistence=e,this.auth=i,this.userKey=a;const{config:l,name:u}=this.auth;this.fullUserKey=xO(this.userKey,l.apiKey,u),this.fullPersistenceKey=xO("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Nf._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,a="authUser"){if(!i.length)return new g0(Df(dJ),e,a);const l=(await Promise.all(i.map(async S=>{if(await S._isAvailable())return S}))).filter(S=>S);let u=l[0]||Df(dJ);const f=xO(a,e.config.apiKey,e.name);let _=null;for(const S of i)try{const w=await S._get(f);if(w){const I=Nf._fromJSON(e,w);S!==u&&(_=I),u=S;break}}catch{}const E=l.filter(S=>S._shouldAllowMigration);return!u._shouldAllowMigration||!E.length?new g0(u,e,a):(u=E[0],_&&await u._set(f,_.toJSON()),await Promise.all(i.map(async S=>{if(S!==u)try{await S._remove(f)}catch{}})),new g0(u,e,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Fie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Uie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Wie(e))return"Blackberry";if(zie(e))return"Webos";if(Vie(e))return"Safari";if((e.includes("chrome/")||jie(e))&&!e.includes("edge/"))return"Chrome";if(Bie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Uie(n=Fa()){return/firefox\//i.test(n)}function Vie(n=Fa()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function jie(n=Fa()){return/crios\//i.test(n)}function Fie(n=Fa()){return/iemobile/i.test(n)}function Bie(n=Fa()){return/android/i.test(n)}function Wie(n=Fa()){return/blackberry/i.test(n)}function zie(n=Fa()){return/webos/i.test(n)}function O5(n=Fa()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function d5e(n=Fa()){var e;return O5(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function h5e(){return Ije()&&document.documentMode===10}function Gie(n=Fa()){return O5(n)||Bie(n)||zie(n)||Wie(n)||/windows phone/i.test(n)||Fie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hie(n,e=[]){let i;switch(n){case"Browser":i=hJ(Fa());break;case"Worker":i=`${hJ(Fa())}-${n}`;break;default:i=n}const a=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${aE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5e{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const a=u=>new Promise((f,_)=>{try{const E=e(u);f(E)}catch(E){_(E)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const a of this.queue)await a(e),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f5e(n,e={}){return em(n,"GET","/v2/passwordPolicy",Zf(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m5e=6;class g5e{constructor(e){var i,a,l,u;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:m5e,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=e.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,a,l,u,f,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(a=E.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(u=E.containsUppercaseLetter)!==null&&u!==void 0?u:!0),E.isValid&&(E.isValid=(f=E.containsNumericCharacter)!==null&&f!==void 0?f:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=e.length>=a),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<e.length;l++)a=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(e,i,a,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5e{constructor(e,i,a,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new pJ(this),this.idTokenSubscription=new pJ(this),this.beforeStateQueue=new p5e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Df(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await g0.create(this,e),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await xie(this,{idToken:e}),a=await Nf._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Ll(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(_,_))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!f||f===_)&&(E!=null&&E.user)&&(l=E.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Vn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await hk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=XFe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ll(this.app))return Promise.reject(Bf(this));const i=e?Xi(e):null;return i&&Vn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Vn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ll(this.app)?Promise.reject(Bf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ll(this.app)?Promise.reject(Bf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Df(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await f5e(this),i=new g5e(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new AR("auth","Firebase",e())}onAuthStateChanged(e,i,a){return this.registerStateListener(this.authStateSubscription,e,i,a)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,a){return this.registerStateListener(this.idTokenSubscription,e,i,a)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const a=this.onAuthStateChanged(()=>{a(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await u5e(this,a)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const a=await this.getOrInitRedirectPersistenceManager(i);return e===null?a.removeCurrentUser():a.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Df(e)||this._popupRedirectResolver;Vn(i,this,"argument-error"),this.redirectPersistenceManager=await g0.create(this,[Df(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,a,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let f=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Vn(_,this,"internal-error"),_.then(()=>{f||u(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,a,l);return()=>{f=!0,E()}}else{const E=e.addObserver(i);return()=>{f=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Vn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Hie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(Ll(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&KFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function cE(n){return Xi(n)}class pJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=Lje(i=>this.observer=i)}get next(){return Vn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function y5e(n){mN=n}function $ie(n){return mN.loadJS(n)}function E5e(){return mN.recaptchaEnterpriseScript}function v5e(){return mN.gapiScript}function S5e(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class b5e{constructor(){this.enterprise=new T5e}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class T5e{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const w5e="recaptcha-enterprise",Kie="NO_RECAPTCHA";class C5e{constructor(e){this.type=w5e,this.auth=cE(e)}async verify(e="verify",i=!1){async function a(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(f,_)=>{n5e(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const S=new t5e(E);return u.tenantId==null?u._agentRecaptchaConfig=S:u._tenantRecaptchaConfigs[u.tenantId]=S,f(S.siteKey)}}).catch(E=>{_(E)})})}function l(u,f,_){const E=window.grecaptcha;cJ(E)?E.enterprise.ready(()=>{E.enterprise.execute(u,{action:e}).then(S=>{f(S)}).catch(()=>{f(Kie)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new b5e().execute("siteKey",{action:"verify"}):new Promise((u,f)=>{a(this.auth).then(_=>{if(!i&&cJ(window.grecaptcha))l(_,u,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let E=E5e();E.length!==0&&(E+=_),$ie(E).then(()=>{l(_,u,f)}).catch(S=>{f(S)})}}).catch(_=>{f(_)})})}}async function fJ(n,e,i,a=!1,l=!1){const u=new C5e(n);let f;if(l)f=Kie;else try{f=await u.verify(i)}catch{f=await u.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,S=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:S,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return a?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function mj(n,e,i,a,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await fJ(n,e,i,i==="getOobCode");return a(n,f)}else return a(n,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await fJ(n,e,i,i==="getOobCode");return a(n,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5e(n,e){const i=fN(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(Jy(u,e??{}))return l;Yd(l,"already-initialized")}return i.initialize({options:e})}function I5e(n,e){const i=(e==null?void 0:e.persistence)||[],a=(Array.isArray(i)?i:[i]).map(Df);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(a,e==null?void 0:e.popupRedirectResolver)}function A5e(n,e,i){const a=cE(n);Vn(/^https?:\/\//.test(e),a,"invalid-emulator-scheme");const l=!1,u=qie(e),{host:f,port:_}=P5e(e),E=_===null?"":`:${_}`,S={url:`${u}//${f}${E}/`},w=Object.freeze({host:f,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Vn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Vn(Jy(S,a.config.emulator)&&Jy(w,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=S,a.emulatorConfig=w,a.settings.appVerificationDisabledForTesting=!0,O5e()}function qie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function P5e(n){const e=qie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const u=l[1];return{host:u,port:mJ(a.substr(u.length+1))}}else{const[u,f]=a.split(":");return{host:u,port:mJ(f)}}}function mJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function O5e(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return kf("not implemented")}_getIdTokenResponse(e){return kf("not implemented")}_linkToIdToken(e,i){return kf("not implemented")}_getReauthenticationResolver(e){return kf("not implemented")}}async function k5e(n,e){return em(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N5e(n,e){return kR(n,"POST","/v1/accounts:signInWithPassword",Zf(n,e))}async function D5e(n,e){return em(n,"POST","/v1/accounts:sendOobCode",Zf(n,e))}async function x5e(n,e){return D5e(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L5e(n,e){return kR(n,"POST","/v1/accounts:signInWithEmailLink",Zf(n,e))}async function M5e(n,e){return kR(n,"POST","/v1/accounts:signInWithEmailLink",Zf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eR extends k5{constructor(e,i,a,l=null){super("password",a),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new eR(e,i,"password")}static _fromEmailAndCode(e,i,a=null){return new eR(e,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mj(e,i,"signInWithPassword",N5e);case"emailLink":return L5e(e,{email:this._email,oobCode:this._password});default:Yd(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mj(e,a,"signUpPassword",k5e);case"emailLink":return M5e(e,{idToken:i,email:this._email,oobCode:this._password});default:Yd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _0(n,e){return kR(n,"POST","/v1/accounts:signInWithIdp",Zf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U5e="http://localhost";class Zy extends k5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new Zy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Yd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:a,signInMethod:l}=i,u=bR(i,["providerId","signInMethod"]);if(!a||!l)return null;const f=new Zy(a,l);return f.idToken=u.idToken||void 0,f.accessToken=u.accessToken||void 0,f.secret=u.secret,f.nonce=u.nonce,f.pendingToken=u.pendingToken||null,f}_getIdTokenResponse(e){const i=this.buildRequest();return _0(e,i)}_linkToIdToken(e,i){const a=this.buildRequest();return a.idToken=i,_0(e,a)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,_0(e,i)}buildRequest(){const e={requestUri:U5e,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=PR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V5e(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function j5e(n){const e=tC(nC(n)).link,i=e?tC(nC(e)).deep_link_id:null,a=tC(nC(n)).deep_link_id;return(a?tC(nC(a)).link:null)||a||i||e||n}class N5{constructor(e){var i,a,l,u,f,_;const E=tC(nC(e)),S=(i=E.apiKey)!==null&&i!==void 0?i:null,w=(a=E.oobCode)!==null&&a!==void 0?a:null,I=V5e((l=E.mode)!==null&&l!==void 0?l:null);Vn(S&&w&&I,"argument-error"),this.apiKey=S,this.operation=I,this.code=w,this.continueUrl=(u=E.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(f=E.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=j5e(e);try{return new N5(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(){this.providerId=Z0.PROVIDER_ID}static credential(e,i){return eR._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const a=N5.parseLink(i);return Vn(a,"argument-error"),eR._fromEmailAndCode(e,a.code,a.tenantId)}}Z0.PROVIDER_ID="password";Z0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Z0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NR extends Yie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg extends NR{constructor(){super("facebook.com")}static credential(e){return Zy._fromParams({providerId:gg.PROVIDER_ID,signInMethod:gg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gg.credentialFromTaggedObject(e)}static credentialFromError(e){return gg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gg.credential(e.oauthAccessToken)}catch{return null}}}gg.FACEBOOK_SIGN_IN_METHOD="facebook.com";gg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g extends NR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return Zy._fromParams({providerId:_g.PROVIDER_ID,signInMethod:_g.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return _g.credentialFromTaggedObject(e)}static credentialFromError(e){return _g.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:a}=e;if(!i&&!a)return null;try{return _g.credential(i,a)}catch{return null}}}_g.GOOGLE_SIGN_IN_METHOD="google.com";_g.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg extends NR{constructor(){super("github.com")}static credential(e){return Zy._fromParams({providerId:yg.PROVIDER_ID,signInMethod:yg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yg.credentialFromTaggedObject(e)}static credentialFromError(e){return yg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yg.credential(e.oauthAccessToken)}catch{return null}}}yg.GITHUB_SIGN_IN_METHOD="github.com";yg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends NR{constructor(){super("twitter.com")}static credential(e,i){return Zy._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Eg.credentialFromTaggedObject(e)}static credentialFromError(e){return Eg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=e;if(!i||!a)return null;try{return Eg.credential(i,a)}catch{return null}}}Eg.TWITTER_SIGN_IN_METHOD="twitter.com";Eg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function F5e(n,e){return kR(n,"POST","/v1/accounts:signUp",Zf(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,a,l=!1){const u=await Nf._fromIdTokenResponse(e,a,l),f=gJ(a);return new eE({user:u,providerId:f,_tokenResponse:a,operationType:i})}static async _forOperation(e,i,a){await e._updateTokensIfNecessary(a,!0);const l=gJ(a);return new eE({user:e,providerId:l,_tokenResponse:a,operationType:i})}}function gJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pk extends Tp{constructor(e,i,a,l){var u;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,pk.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(e,i,a,l){return new pk(e,i,a,l)}}function Xie(n,e,i,a){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?pk._fromErrorAndOperation(n,u,e,a):u})}async function B5e(n,e,i=!1){const a=await ZC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return eE._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function W5e(n,e,i=!1){const{auth:a}=n;if(Ll(a.app))return Promise.reject(Bf(a));const l="reauthenticate";try{const u=await ZC(n,Xie(a,l,e,n),i);Vn(u.idToken,a,"internal-error");const f=P5(u.idToken);Vn(f,a,"internal-error");const{sub:_}=f;return Vn(n.uid===_,a,"user-mismatch"),eE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&Yd(a,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jie(n,e,i=!1){if(Ll(n.app))return Promise.reject(Bf(n));const a="signIn",l=await Xie(n,a,e),u=await eE._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(u.user),u}async function z5e(n,e){return Jie(cE(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qie(n){const e=cE(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function G5e(n,e,i){if(Ll(n.app))return Promise.reject(Bf(n));const a=cE(n),f=await mj(a,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",F5e).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&Qie(n),E}),_=await eE._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(_.user),_}function H5e(n,e,i){return Ll(n.app)?Promise.reject(Bf(n)):z5e(Xi(n),Z0.credential(e,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Qie(n),a})}async function $5e(n,e){const i=Xi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await x5e(i.auth,l);u!==n.email&&await n.reload()}function K5e(n,e,i,a){return Xi(n).onIdTokenChanged(e,i,a)}function q5e(n,e,i){return Xi(n).beforeAuthStateChanged(e,i)}function Zie(n,e,i,a){return Xi(n).onAuthStateChanged(e,i,a)}function Y5e(n){return Xi(n).signOut()}const fk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(fk,"1"),this.storage.removeItem(fk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X5e=1e3,J5e=10;class tse extends ese{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Gie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&e(i,l,a)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((f,_,E)=>{this.notifyListeners(f,E)});return}const a=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!i&&this.localCache[a]===f||this.notifyListeners(a,f)},u=this.storage.getItem(a);h5e()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,J5e):l()}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:a}),!0)})},X5e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}tse.type="LOCAL";const Q5e=tse;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nse extends ese{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}nse.type="SESSION";const rse=nse;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z5e(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const a=new gN(e);return this.receivers.push(a),a}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:a,eventType:l,data:u}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const _=Array.from(f).map(async S=>S(i.origin,u)),E=await Z5e(_);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D5(n="",e=10){let i="";for(let a=0;a<e;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3e{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,f;return new Promise((_,E)=>{const S=D5("",20);l.port1.start();const w=setTimeout(()=>{E(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const k=I;if(k.data.eventId===S)switch(k.data.status){case"ack":clearTimeout(w),u=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(k.data.response);break;default:clearTimeout(w),clearTimeout(u),E(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:S,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pp(){return window}function t3e(n){pp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(){return typeof pp().WorkerGlobalScope<"u"&&typeof pp().importScripts=="function"}async function n3e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function r3e(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function i3e(){return ise()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sse="firebaseLocalStorageDb",s3e=1,mk="firebaseLocalStorage",ose="fbase_key";class DR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function _N(n,e){return n.transaction([mk],e?"readwrite":"readonly").objectStore(mk)}function o3e(){const n=indexedDB.deleteDatabase(sse);return new DR(n).toPromise()}function gj(){const n=indexedDB.open(sse,s3e);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(mk,{keyPath:ose})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(mk)?e(a):(a.close(),await o3e(),e(await gj()))})})}async function _J(n,e,i){const a=_N(n,!0).put({[ose]:e,value:i});return new DR(a).toPromise()}async function a3e(n,e){const i=_N(n,!1).get(e),a=await new DR(i).toPromise();return a===void 0?null:a.value}function yJ(n,e){const i=_N(n,!0).delete(e);return new DR(i).toPromise()}const c3e=800,l3e=3;class ase{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await gj(),this.db)}async _withRetries(e){let i=0;for(;;)try{const a=await this._openDb();return await e(a)}catch(a){if(i++>l3e)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ise()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gN._getInstance(i3e()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await n3e(),!this.activeServiceWorker)return;this.sender=new e3e(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((e=a[0])===null||e===void 0)&&e.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||r3e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await gj();return await _J(e,fk,"1"),await yJ(e,fk),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>_J(a,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(a=>a3e(a,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>yJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=_N(l,!1).getAll();return new DR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const a=this.listeners[e];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),c3e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ase.type="LOCAL";const u3e=ase;new OR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d3e(n,e){return e?Df(e):(Vn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5 extends k5{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return _0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return _0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function h3e(n){return Jie(n.auth,new x5(n),n.bypassAuthState)}function p3e(n){const{auth:e,user:i}=n;return Vn(i,e,"internal-error"),W5e(i,new x5(n),n.bypassAuthState)}async function f3e(n){const{auth:e,user:i}=n;return Vn(i,e,"internal-error"),B5e(i,new x5(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cse{constructor(e,i,a,l,u=!1){this.auth=e,this.resolver=a,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:a,postBody:l,tenantId:u,error:f,type:_}=e;if(f){this.reject(f);return}const E={auth:this.auth,requestUri:i,sessionId:a,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(S){this.reject(S)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return h3e;case"linkViaPopup":case"linkViaRedirect":return f3e;case"reauthViaPopup":case"reauthViaRedirect":return p3e;default:Yd(this.auth,"internal-error")}}resolve(e){Kf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m3e=new OR(2e3,1e4);class t0 extends cse{constructor(e,i,a,l,u){super(e,i,l,u),this.provider=a,this.authWindow=null,this.pollId=null,t0.currentPopupAction&&t0.currentPopupAction.cancel(),t0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Vn(e,this.auth,"internal-error"),e}async onExecution(){Kf(this.filter.length===1,"Popup operations only handle one event");const e=D5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(hp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(hp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,t0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(hp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,m3e.get())};e()}}t0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g3e="pendingRedirect",LO=new Map;class _3e extends cse{constructor(e,i,a=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let e=LO.get(this.auth._key());if(!e){try{const a=await y3e(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(a)}catch(i){e=()=>Promise.reject(i)}LO.set(this.auth._key(),e)}return this.bypassAuthState||LO.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function y3e(n,e){const i=S3e(e),a=v3e(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function E3e(n,e){LO.set(n._key(),e)}function v3e(n){return Df(n._redirectPersistence)}function S3e(n){return xO(g3e,n.config.apiKey,n.name)}async function b3e(n,e,i=!1){if(Ll(n.app))return Promise.reject(Bf(n));const a=cE(n),l=d3e(a,e),f=await new _3e(a,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T3e=10*60*1e3;class w3e{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(e,a)&&(i=!0,this.sendToConsumer(e,a),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!C3e(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var a;if(e.error&&!lse(e)){const l=((a=e.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(hp(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const a=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&a}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=T3e&&this.cachedEventUids.clear(),this.cachedEventUids.has(EJ(e))}saveEventToCache(e){this.cachedEventUids.add(EJ(e)),this.lastProcessedEventTime=Date.now()}}function EJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function lse({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function C3e(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lse(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R3e(n,e={}){return em(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I3e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,A3e=/^https?/;async function P3e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await R3e(n);for(const i of e)try{if(O3e(i))return}catch{}Yd(n,"unauthorized-domain")}function O3e(n){const e=pj(),{protocol:i,hostname:a}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===a}if(!A3e.test(i))return!1;if(I3e.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k3e=new OR(3e4,6e4);function vJ(){const n=pp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function N3e(n){return new Promise((e,i)=>{var a,l,u;function f(){vJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vJ(),i(hp(n,"network-request-failed"))},timeout:k3e.get()})}if(!((l=(a=pp().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=pp().gapi)===null||u===void 0)&&u.load)f();else{const _=S5e("iframefcb");return pp()[_]=()=>{gapi.load?f():i(hp(n,"network-request-failed"))},$ie(`${v5e()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw MO=null,e})}let MO=null;function D3e(n){return MO=MO||N3e(n),MO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3e=new OR(5e3,15e3),L3e="__/auth/iframe",M3e="emulator/auth/iframe",U3e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},V3e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function j3e(n){const e=n.config;Vn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?A5(e,M3e):`https://${n.config.authDomain}/${L3e}`,a={apiKey:e.apiKey,appName:n.name,v:aE},l=V3e.get(n.config.apiHost);l&&(a.eid=l);const u=n._getFrameworks();return u.length&&(a.fw=u.join(",")),`${i}?${PR(a).slice(1)}`}async function F3e(n){const e=await D3e(n),i=pp().gapi;return Vn(i,n,"internal-error"),e.open({where:document.body,url:j3e(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:U3e,dontclear:!0},a=>new Promise(async(l,u)=>{await a.restyle({setHideOnLeave:!1});const f=hp(n,"network-request-failed"),_=pp().setTimeout(()=>{u(f)},x3e.get());function E(){pp().clearTimeout(_),l(a)}a.ping(E).then(E,()=>{u(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B3e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},W3e=500,z3e=600,G3e="_blank",H3e="http://localhost";class SJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $3e(n,e,i,a=W3e,l=z3e){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let _="";const E=Object.assign(Object.assign({},B3e),{width:a.toString(),height:l.toString(),top:u,left:f}),S=Fa().toLowerCase();i&&(_=jie(S)?G3e:i),Uie(S)&&(e=e||H3e,E.scrollbars="yes");const w=Object.entries(E).reduce((k,[U,L])=>`${k}${U}=${L},`,"");if(d5e(S)&&_!=="_self")return K3e(e||"",_),new SJ(null);const I=window.open(e||"",_,w);Vn(I,n,"popup-blocked");try{I.focus()}catch{}return new SJ(I)}function K3e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q3e="__/auth/handler",Y3e="emulator/auth/handler",X3e=encodeURIComponent("fac");async function bJ(n,e,i,a,l,u){Vn(n.config.authDomain,n,"auth-domain-config-required"),Vn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:aE,eventId:l};if(e instanceof Yie){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",xje(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[w,I]of Object.entries({}))f[w]=I}if(e instanceof NR){const w=e.getScopes().filter(I=>I!=="");w.length>0&&(f.scopes=w.join(","))}n.tenantId&&(f.tid=n.tenantId);const _=f;for(const w of Object.keys(_))_[w]===void 0&&delete _[w];const E=await n._getAppCheckToken(),S=E?`#${X3e}=${encodeURIComponent(E)}`:"";return`${J3e(n)}?${PR(_).slice(1)}${S}`}function J3e({config:n}){return n.emulator?A5(n,Y3e):`https://${n.authDomain}/${q3e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MU="webStorageSupport";class Q3e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rse,this._completeRedirectFn=b3e,this._overrideRedirectResult=E3e}async _openPopup(e,i,a,l){var u;Kf((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const f=await bJ(e,i,a,pj(),l);return $3e(e,f,D5())}async _openRedirect(e,i,a,l){await this._originValidation(e);const u=await bJ(e,i,a,pj(),l);return t3e(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(Kf(u,"If manager is not set, promise should be"),u)}const a=this.initAndGetManager(e);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(e){const i=await F3e(e),a=new w3e(e);return i.register("authEvent",l=>(Vn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:a},this.iframes[e._key()]=i,a}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(MU,{type:MU},l=>{var u;const f=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[MU];f!==void 0&&i(!!f),Yd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=P3e(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Gie()||Vie()||O5()}}const Z3e=Q3e;var TJ="@firebase/auth",wJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e4e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(a=>{e((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Vn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function n4e(n){Qy(new Mg("auth",(e,{options:i})=>{const a=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:f,authDomain:_}=a.options;Vn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const E={apiKey:f,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Hie(n)},S=new _5e(a,l,u,E);return I5e(S,i),S},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,a)=>{e.getProvider("auth-internal").initialize()})),Qy(new Mg("auth-internal",e=>{const i=cE(e.getProvider("auth").getImmediate());return(a=>new e4e(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),dp(TJ,wJ,t4e(n)),dp(TJ,wJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r4e=5*60,i4e=Sie("authIdTokenMaxAge")||r4e;let CJ=null;const s4e=n=>async e=>{const i=e&&await e.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>i4e)return;const l=i==null?void 0:i.token;CJ!==l&&(CJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function yN(n=R5()){const e=fN(n,"auth");if(e.isInitialized())return e.getImmediate();const i=R5e(n,{popupRedirectResolver:Z3e,persistence:[u3e,Q5e,rse]}),a=Sie("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(a,location.origin);if(location.origin===u.origin){const f=s4e(u.toString());q5e(i,f,()=>f(i.currentUser)),K5e(i,_=>f(_))}}const l=yie("auth");return l&&A5e(i,`http://${l}`),i}function o4e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}y5e({loadJS(n){return new Promise((e,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=e,a.onerror=l=>{const u=hp("internal-error");u.customData=l,i(u)},a.type="text/javascript",a.charset="UTF-8",o4e().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});n4e("Browser");var RJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pg,use;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(te,Z){function ne(){}ne.prototype=Z.prototype,te.D=Z.prototype,te.prototype=new ne,te.prototype.constructor=te,te.C=function(ae,me,he){for(var ue=Array(arguments.length-2),Ue=2;Ue<arguments.length;Ue++)ue[Ue-2]=arguments[Ue];return Z.prototype[me].apply(ae,ue)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(te,Z,ne){ne||(ne=0);var ae=Array(16);if(typeof Z=="string")for(var me=0;16>me;++me)ae[me]=Z.charCodeAt(ne++)|Z.charCodeAt(ne++)<<8|Z.charCodeAt(ne++)<<16|Z.charCodeAt(ne++)<<24;else for(me=0;16>me;++me)ae[me]=Z[ne++]|Z[ne++]<<8|Z[ne++]<<16|Z[ne++]<<24;Z=te.g[0],ne=te.g[1],me=te.g[2];var he=te.g[3],ue=Z+(he^ne&(me^he))+ae[0]+3614090360&4294967295;Z=ne+(ue<<7&4294967295|ue>>>25),ue=he+(me^Z&(ne^me))+ae[1]+3905402710&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=me+(ne^he&(Z^ne))+ae[2]+606105819&4294967295,me=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Z^me&(he^Z))+ae[3]+3250441966&4294967295,ne=me+(ue<<22&4294967295|ue>>>10),ue=Z+(he^ne&(me^he))+ae[4]+4118548399&4294967295,Z=ne+(ue<<7&4294967295|ue>>>25),ue=he+(me^Z&(ne^me))+ae[5]+1200080426&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=me+(ne^he&(Z^ne))+ae[6]+2821735955&4294967295,me=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Z^me&(he^Z))+ae[7]+4249261313&4294967295,ne=me+(ue<<22&4294967295|ue>>>10),ue=Z+(he^ne&(me^he))+ae[8]+1770035416&4294967295,Z=ne+(ue<<7&4294967295|ue>>>25),ue=he+(me^Z&(ne^me))+ae[9]+2336552879&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=me+(ne^he&(Z^ne))+ae[10]+4294925233&4294967295,me=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Z^me&(he^Z))+ae[11]+2304563134&4294967295,ne=me+(ue<<22&4294967295|ue>>>10),ue=Z+(he^ne&(me^he))+ae[12]+1804603682&4294967295,Z=ne+(ue<<7&4294967295|ue>>>25),ue=he+(me^Z&(ne^me))+ae[13]+4254626195&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=me+(ne^he&(Z^ne))+ae[14]+2792965006&4294967295,me=he+(ue<<17&4294967295|ue>>>15),ue=ne+(Z^me&(he^Z))+ae[15]+1236535329&4294967295,ne=me+(ue<<22&4294967295|ue>>>10),ue=Z+(me^he&(ne^me))+ae[1]+4129170786&4294967295,Z=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^me&(Z^ne))+ae[6]+3225465664&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=me+(Z^ne&(he^Z))+ae[11]+643717713&4294967295,me=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Z&(me^he))+ae[0]+3921069994&4294967295,ne=me+(ue<<20&4294967295|ue>>>12),ue=Z+(me^he&(ne^me))+ae[5]+3593408605&4294967295,Z=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^me&(Z^ne))+ae[10]+38016083&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=me+(Z^ne&(he^Z))+ae[15]+3634488961&4294967295,me=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Z&(me^he))+ae[4]+3889429448&4294967295,ne=me+(ue<<20&4294967295|ue>>>12),ue=Z+(me^he&(ne^me))+ae[9]+568446438&4294967295,Z=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^me&(Z^ne))+ae[14]+3275163606&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=me+(Z^ne&(he^Z))+ae[3]+4107603335&4294967295,me=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Z&(me^he))+ae[8]+1163531501&4294967295,ne=me+(ue<<20&4294967295|ue>>>12),ue=Z+(me^he&(ne^me))+ae[13]+2850285829&4294967295,Z=ne+(ue<<5&4294967295|ue>>>27),ue=he+(ne^me&(Z^ne))+ae[2]+4243563512&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=me+(Z^ne&(he^Z))+ae[7]+1735328473&4294967295,me=he+(ue<<14&4294967295|ue>>>18),ue=ne+(he^Z&(me^he))+ae[12]+2368359562&4294967295,ne=me+(ue<<20&4294967295|ue>>>12),ue=Z+(ne^me^he)+ae[5]+4294588738&4294967295,Z=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Z^ne^me)+ae[8]+2272392833&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=me+(he^Z^ne)+ae[11]+1839030562&4294967295,me=he+(ue<<16&4294967295|ue>>>16),ue=ne+(me^he^Z)+ae[14]+4259657740&4294967295,ne=me+(ue<<23&4294967295|ue>>>9),ue=Z+(ne^me^he)+ae[1]+2763975236&4294967295,Z=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Z^ne^me)+ae[4]+1272893353&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=me+(he^Z^ne)+ae[7]+4139469664&4294967295,me=he+(ue<<16&4294967295|ue>>>16),ue=ne+(me^he^Z)+ae[10]+3200236656&4294967295,ne=me+(ue<<23&4294967295|ue>>>9),ue=Z+(ne^me^he)+ae[13]+681279174&4294967295,Z=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Z^ne^me)+ae[0]+3936430074&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=me+(he^Z^ne)+ae[3]+3572445317&4294967295,me=he+(ue<<16&4294967295|ue>>>16),ue=ne+(me^he^Z)+ae[6]+76029189&4294967295,ne=me+(ue<<23&4294967295|ue>>>9),ue=Z+(ne^me^he)+ae[9]+3654602809&4294967295,Z=ne+(ue<<4&4294967295|ue>>>28),ue=he+(Z^ne^me)+ae[12]+3873151461&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=me+(he^Z^ne)+ae[15]+530742520&4294967295,me=he+(ue<<16&4294967295|ue>>>16),ue=ne+(me^he^Z)+ae[2]+3299628645&4294967295,ne=me+(ue<<23&4294967295|ue>>>9),ue=Z+(me^(ne|~he))+ae[0]+4096336452&4294967295,Z=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Z|~me))+ae[7]+1126891415&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=me+(Z^(he|~ne))+ae[14]+2878612391&4294967295,me=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(me|~Z))+ae[5]+4237533241&4294967295,ne=me+(ue<<21&4294967295|ue>>>11),ue=Z+(me^(ne|~he))+ae[12]+1700485571&4294967295,Z=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Z|~me))+ae[3]+2399980690&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=me+(Z^(he|~ne))+ae[10]+4293915773&4294967295,me=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(me|~Z))+ae[1]+2240044497&4294967295,ne=me+(ue<<21&4294967295|ue>>>11),ue=Z+(me^(ne|~he))+ae[8]+1873313359&4294967295,Z=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Z|~me))+ae[15]+4264355552&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=me+(Z^(he|~ne))+ae[6]+2734768916&4294967295,me=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(me|~Z))+ae[13]+1309151649&4294967295,ne=me+(ue<<21&4294967295|ue>>>11),ue=Z+(me^(ne|~he))+ae[4]+4149444226&4294967295,Z=ne+(ue<<6&4294967295|ue>>>26),ue=he+(ne^(Z|~me))+ae[11]+3174756917&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=me+(Z^(he|~ne))+ae[2]+718787259&4294967295,me=he+(ue<<15&4294967295|ue>>>17),ue=ne+(he^(me|~Z))+ae[9]+3951481745&4294967295,te.g[0]=te.g[0]+Z&4294967295,te.g[1]=te.g[1]+(me+(ue<<21&4294967295|ue>>>11))&4294967295,te.g[2]=te.g[2]+me&4294967295,te.g[3]=te.g[3]+he&4294967295}a.prototype.u=function(te,Z){Z===void 0&&(Z=te.length);for(var ne=Z-this.blockSize,ae=this.B,me=this.h,he=0;he<Z;){if(me==0)for(;he<=ne;)l(this,te,he),he+=this.blockSize;if(typeof te=="string"){for(;he<Z;)if(ae[me++]=te.charCodeAt(he++),me==this.blockSize){l(this,ae),me=0;break}}else for(;he<Z;)if(ae[me++]=te[he++],me==this.blockSize){l(this,ae),me=0;break}}this.h=me,this.o+=Z},a.prototype.v=function(){var te=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);te[0]=128;for(var Z=1;Z<te.length-8;++Z)te[Z]=0;var ne=8*this.o;for(Z=te.length-8;Z<te.length;++Z)te[Z]=ne&255,ne/=256;for(this.u(te),te=Array(16),Z=ne=0;4>Z;++Z)for(var ae=0;32>ae;ae+=8)te[ne++]=this.g[Z]>>>ae&255;return te};function u(te,Z){var ne=_;return Object.prototype.hasOwnProperty.call(ne,te)?ne[te]:ne[te]=Z(te)}function f(te,Z){this.h=Z;for(var ne=[],ae=!0,me=te.length-1;0<=me;me--){var he=te[me]|0;ae&&he==Z||(ne[me]=he,ae=!1)}this.g=ne}var _={};function E(te){return-128<=te&&128>te?u(te,function(Z){return new f([Z|0],0>Z?-1:0)}):new f([te|0],0>te?-1:0)}function S(te){if(isNaN(te)||!isFinite(te))return I;if(0>te)return B(S(-te));for(var Z=[],ne=1,ae=0;te>=ne;ae++)Z[ae]=te/ne|0,ne*=4294967296;return new f(Z,0)}function w(te,Z){if(te.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(te.charAt(0)=="-")return B(w(te.substring(1),Z));if(0<=te.indexOf("-"))throw Error('number format error: interior "-" character');for(var ne=S(Math.pow(Z,8)),ae=I,me=0;me<te.length;me+=8){var he=Math.min(8,te.length-me),ue=parseInt(te.substring(me,me+he),Z);8>he?(he=S(Math.pow(Z,he)),ae=ae.j(he).add(S(ue))):(ae=ae.j(ne),ae=ae.add(S(ue)))}return ae}var I=E(0),k=E(1),U=E(16777216);n=f.prototype,n.m=function(){if(F(this))return-B(this).m();for(var te=0,Z=1,ne=0;ne<this.g.length;ne++){var ae=this.i(ne);te+=(0<=ae?ae:4294967296+ae)*Z,Z*=4294967296}return te},n.toString=function(te){if(te=te||10,2>te||36<te)throw Error("radix out of range: "+te);if(L(this))return"0";if(F(this))return"-"+B(this).toString(te);for(var Z=S(Math.pow(te,6)),ne=this,ae="";;){var me=oe(ne,Z).g;ne=q(ne,me.j(Z));var he=((0<ne.g.length?ne.g[0]:ne.h)>>>0).toString(te);if(ne=me,L(ne))return he+ae;for(;6>he.length;)he="0"+he;ae=he+ae}},n.i=function(te){return 0>te?0:te<this.g.length?this.g[te]:this.h};function L(te){if(te.h!=0)return!1;for(var Z=0;Z<te.g.length;Z++)if(te.g[Z]!=0)return!1;return!0}function F(te){return te.h==-1}n.l=function(te){return te=q(this,te),F(te)?-1:L(te)?0:1};function B(te){for(var Z=te.g.length,ne=[],ae=0;ae<Z;ae++)ne[ae]=~te.g[ae];return new f(ne,~te.h).add(k)}n.abs=function(){return F(this)?B(this):this},n.add=function(te){for(var Z=Math.max(this.g.length,te.g.length),ne=[],ae=0,me=0;me<=Z;me++){var he=ae+(this.i(me)&65535)+(te.i(me)&65535),ue=(he>>>16)+(this.i(me)>>>16)+(te.i(me)>>>16);ae=ue>>>16,he&=65535,ue&=65535,ne[me]=ue<<16|he}return new f(ne,ne[ne.length-1]&-2147483648?-1:0)};function q(te,Z){return te.add(B(Z))}n.j=function(te){if(L(this)||L(te))return I;if(F(this))return F(te)?B(this).j(B(te)):B(B(this).j(te));if(F(te))return B(this.j(B(te)));if(0>this.l(U)&&0>te.l(U))return S(this.m()*te.m());for(var Z=this.g.length+te.g.length,ne=[],ae=0;ae<2*Z;ae++)ne[ae]=0;for(ae=0;ae<this.g.length;ae++)for(var me=0;me<te.g.length;me++){var he=this.i(ae)>>>16,ue=this.i(ae)&65535,Ue=te.i(me)>>>16,ze=te.i(me)&65535;ne[2*ae+2*me]+=ue*ze,$(ne,2*ae+2*me),ne[2*ae+2*me+1]+=he*ze,$(ne,2*ae+2*me+1),ne[2*ae+2*me+1]+=ue*Ue,$(ne,2*ae+2*me+1),ne[2*ae+2*me+2]+=he*Ue,$(ne,2*ae+2*me+2)}for(ae=0;ae<Z;ae++)ne[ae]=ne[2*ae+1]<<16|ne[2*ae];for(ae=Z;ae<2*Z;ae++)ne[ae]=0;return new f(ne,0)};function $(te,Z){for(;(te[Z]&65535)!=te[Z];)te[Z+1]+=te[Z]>>>16,te[Z]&=65535,Z++}function X(te,Z){this.g=te,this.h=Z}function oe(te,Z){if(L(Z))throw Error("division by zero");if(L(te))return new X(I,I);if(F(te))return Z=oe(B(te),Z),new X(B(Z.g),B(Z.h));if(F(Z))return Z=oe(te,B(Z)),new X(B(Z.g),Z.h);if(30<te.g.length){if(F(te)||F(Z))throw Error("slowDivide_ only works with positive integers.");for(var ne=k,ae=Z;0>=ae.l(te);)ne=re(ne),ae=re(ae);var me=pe(ne,1),he=pe(ae,1);for(ae=pe(ae,2),ne=pe(ne,2);!L(ae);){var ue=he.add(ae);0>=ue.l(te)&&(me=me.add(ne),he=ue),ae=pe(ae,1),ne=pe(ne,1)}return Z=q(te,me.j(Z)),new X(me,Z)}for(me=I;0<=te.l(Z);){for(ne=Math.max(1,Math.floor(te.m()/Z.m())),ae=Math.ceil(Math.log(ne)/Math.LN2),ae=48>=ae?1:Math.pow(2,ae-48),he=S(ne),ue=he.j(Z);F(ue)||0<ue.l(te);)ne-=ae,he=S(ne),ue=he.j(Z);L(he)&&(he=k),me=me.add(he),te=q(te,ue)}return new X(me,te)}n.A=function(te){return oe(this,te).h},n.and=function(te){for(var Z=Math.max(this.g.length,te.g.length),ne=[],ae=0;ae<Z;ae++)ne[ae]=this.i(ae)&te.i(ae);return new f(ne,this.h&te.h)},n.or=function(te){for(var Z=Math.max(this.g.length,te.g.length),ne=[],ae=0;ae<Z;ae++)ne[ae]=this.i(ae)|te.i(ae);return new f(ne,this.h|te.h)},n.xor=function(te){for(var Z=Math.max(this.g.length,te.g.length),ne=[],ae=0;ae<Z;ae++)ne[ae]=this.i(ae)^te.i(ae);return new f(ne,this.h^te.h)};function re(te){for(var Z=te.g.length+1,ne=[],ae=0;ae<Z;ae++)ne[ae]=te.i(ae)<<1|te.i(ae-1)>>>31;return new f(ne,te.h)}function pe(te,Z){var ne=Z>>5;Z%=32;for(var ae=te.g.length-ne,me=[],he=0;he<ae;he++)me[he]=0<Z?te.i(he+ne)>>>Z|te.i(he+ne+1)<<32-Z:te.i(he+ne);return new f(me,te.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,use=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=S,f.fromString=w,Pg=f}).apply(typeof RJ<"u"?RJ:typeof self<"u"?self:typeof window<"u"?window:{});var Q1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var dse,rC,hse,UO,_j,pse,fse,mse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,ee){return A==Array.prototype||A==Object.prototype||(A[z]=ee.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof Q1=="object"&&Q1];for(var z=0;z<A.length;++z){var ee=A[z];if(ee&&ee.Math==Math)return ee}throw Error("Cannot find global object")}var a=i(this);function l(A,z){if(z)e:{var ee=a;A=A.split(".");for(var fe=0;fe<A.length-1;fe++){var Ke=A[fe];if(!(Ke in ee))break e;ee=ee[Ke]}A=A[A.length-1],fe=ee[A],z=z(fe),z!=fe&&z!=null&&e(ee,A,{configurable:!0,writable:!0,value:z})}}function u(A,z){A instanceof String&&(A+="");var ee=0,fe=!1,Ke={next:function(){if(!fe&&ee<A.length){var ct=ee++;return{value:z(ct,A[ct]),done:!1}}return fe=!0,{done:!0,value:void 0}}};return Ke[Symbol.iterator]=function(){return Ke},Ke}l("Array.prototype.values",function(A){return A||function(){return u(this,function(z,ee){return ee})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},_=this||self;function E(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function S(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function w(A,z,ee){return A.call.apply(A.bind,arguments)}function I(A,z,ee){if(!A)throw Error();if(2<arguments.length){var fe=Array.prototype.slice.call(arguments,2);return function(){var Ke=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ke,fe),A.apply(z,Ke)}}return function(){return A.apply(z,arguments)}}function k(A,z,ee){return k=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?w:I,k.apply(null,arguments)}function U(A,z){var ee=Array.prototype.slice.call(arguments,1);return function(){var fe=ee.slice();return fe.push.apply(fe,arguments),A.apply(this,fe)}}function L(A,z){function ee(){}ee.prototype=z.prototype,A.aa=z.prototype,A.prototype=new ee,A.prototype.constructor=A,A.Qb=function(fe,Ke,ct){for(var Ut=Array(arguments.length-2),Jr=2;Jr<arguments.length;Jr++)Ut[Jr-2]=arguments[Jr];return z.prototype[Ke].apply(fe,Ut)}}function F(A){const z=A.length;if(0<z){const ee=Array(z);for(let fe=0;fe<z;fe++)ee[fe]=A[fe];return ee}return[]}function B(A,z){for(let ee=1;ee<arguments.length;ee++){const fe=arguments[ee];if(E(fe)){const Ke=A.length||0,ct=fe.length||0;A.length=Ke+ct;for(let Ut=0;Ut<ct;Ut++)A[Ke+Ut]=fe[Ut]}else A.push(fe)}}class q{constructor(z,ee){this.i=z,this.j=ee,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function $(A){return/^[\s\xa0]*$/.test(A)}function X(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function oe(A){return oe[" "](A),A}oe[" "]=function(){};var re=X().indexOf("Gecko")!=-1&&!(X().toLowerCase().indexOf("webkit")!=-1&&X().indexOf("Edge")==-1)&&!(X().indexOf("Trident")!=-1||X().indexOf("MSIE")!=-1)&&X().indexOf("Edge")==-1;function pe(A,z,ee){for(const fe in A)z.call(ee,A[fe],fe,A)}function te(A,z){for(const ee in A)z.call(void 0,A[ee],ee,A)}function Z(A){const z={};for(const ee in A)z[ee]=A[ee];return z}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ae(A,z){let ee,fe;for(let Ke=1;Ke<arguments.length;Ke++){fe=arguments[Ke];for(ee in fe)A[ee]=fe[ee];for(let ct=0;ct<ne.length;ct++)ee=ne[ct],Object.prototype.hasOwnProperty.call(fe,ee)&&(A[ee]=fe[ee])}}function me(A){var z=1;A=A.split(":");const ee=[];for(;0<z&&A.length;)ee.push(A.shift()),z--;return A.length&&ee.push(A.join(":")),ee}function he(A){_.setTimeout(()=>{throw A},0)}function ue(){var A=ye;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class Ue{constructor(){this.h=this.g=null}add(z,ee){const fe=ze.get();fe.set(z,ee),this.h?this.h.next=fe:this.g=fe,this.h=fe}}var ze=new q(()=>new tt,A=>A.reset());class tt{constructor(){this.next=this.g=this.h=null}set(z,ee){this.h=z,this.g=ee,this.next=null}reset(){this.next=this.g=this.h=null}}let Ce,Ie=!1,ye=new Ue,ke=()=>{const A=_.Promise.resolve(void 0);Ce=()=>{A.then(Te)}};var Te=()=>{for(var A;A=ue();){try{A.h.call(A.g)}catch(ee){he(ee)}var z=ze;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}Ie=!1};function ve(){this.s=this.s,this.C=this.C}ve.prototype.s=!1,ve.prototype.ma=function(){this.s||(this.s=!0,this.N())},ve.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Re(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}Re.prototype.h=function(){this.defaultPrevented=!0};var Me=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const ee=()=>{};_.addEventListener("test",ee,z),_.removeEventListener("test",ee,z)}catch{}return A}();function Ge(A,z){if(Re.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var ee=this.type=A.type,fe=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(re){e:{try{oe(z.nodeName);var Ke=!0;break e}catch{}Ke=!1}Ke||(z=null)}}else ee=="mouseover"?z=A.fromElement:ee=="mouseout"&&(z=A.toElement);this.relatedTarget=z,fe?(this.clientX=fe.clientX!==void 0?fe.clientX:fe.pageX,this.clientY=fe.clientY!==void 0?fe.clientY:fe.pageY,this.screenX=fe.screenX||0,this.screenY=fe.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:Qe[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&Ge.aa.h.call(this)}}L(Ge,Re);var Qe={2:"touch",3:"pen",4:"mouse"};Ge.prototype.h=function(){Ge.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),ht=0;function it(A,z,ee,fe,Ke){this.listener=A,this.proxy=null,this.src=z,this.type=ee,this.capture=!!fe,this.ha=Ke,this.key=++ht,this.da=this.fa=!1}function It(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function jt(A){this.src=A,this.g={},this.h=0}jt.prototype.add=function(A,z,ee,fe,Ke){var ct=A.toString();A=this.g[ct],A||(A=this.g[ct]=[],this.h++);var Ut=an(A,z,fe,Ke);return-1<Ut?(z=A[Ut],ee||(z.fa=!1)):(z=new it(z,this.src,ct,!!fe,Ke),z.fa=ee,A.push(z)),z};function Dt(A,z){var ee=z.type;if(ee in A.g){var fe=A.g[ee],Ke=Array.prototype.indexOf.call(fe,z,void 0),ct;(ct=0<=Ke)&&Array.prototype.splice.call(fe,Ke,1),ct&&(It(z),A.g[ee].length==0&&(delete A.g[ee],A.h--))}}function an(A,z,ee,fe){for(var Ke=0;Ke<A.length;++Ke){var ct=A[Ke];if(!ct.da&&ct.listener==z&&ct.capture==!!ee&&ct.ha==fe)return Ke}return-1}var jn="closure_lm_"+(1e6*Math.random()|0),Qt={};function Ot(A,z,ee,fe,Ke){if(Array.isArray(z)){for(var ct=0;ct<z.length;ct++)Ot(A,z[ct],ee,fe,Ke);return null}return ee=fn(ee),A&&A[nt]?A.K(z,ee,S(fe)?!!fe.capture:!1,Ke):Lt(A,z,ee,!1,fe,Ke)}function Lt(A,z,ee,fe,Ke,ct){if(!z)throw Error("Invalid event type");var Ut=S(Ke)?!!Ke.capture:!!Ke,Jr=St(A);if(Jr||(A[jn]=Jr=new jt(A)),ee=Jr.add(z,ee,fe,Ut,ct),ee.proxy)return ee;if(fe=we(),ee.proxy=fe,fe.src=A,fe.listener=ee,A.addEventListener)Me||(Ke=Ut),Ke===void 0&&(Ke=!1),A.addEventListener(z.toString(),fe,Ke);else if(A.attachEvent)A.attachEvent(_t(z.toString()),fe);else if(A.addListener&&A.removeListener)A.addListener(fe);else throw Error("addEventListener and attachEvent are unavailable.");return ee}function we(){function A(ee){return z.call(A.src,A.listener,ee)}const z=vt;return A}function Ve(A,z,ee,fe,Ke){if(Array.isArray(z))for(var ct=0;ct<z.length;ct++)Ve(A,z[ct],ee,fe,Ke);else fe=S(fe)?!!fe.capture:!!fe,ee=fn(ee),A&&A[nt]?(A=A.i,z=String(z).toString(),z in A.g&&(ct=A.g[z],ee=an(ct,ee,fe,Ke),-1<ee&&(It(ct[ee]),Array.prototype.splice.call(ct,ee,1),ct.length==0&&(delete A.g[z],A.h--)))):A&&(A=St(A))&&(z=A.g[z.toString()],A=-1,z&&(A=an(z,ee,fe,Ke)),(ee=-1<A?z[A]:null)&&$e(ee))}function $e(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[nt])Dt(z.i,A);else{var ee=A.type,fe=A.proxy;z.removeEventListener?z.removeEventListener(ee,fe,A.capture):z.detachEvent?z.detachEvent(_t(ee),fe):z.addListener&&z.removeListener&&z.removeListener(fe),(ee=St(z))?(Dt(ee,A),ee.h==0&&(ee.src=null,z[jn]=null)):It(A)}}}function _t(A){return A in Qt?Qt[A]:Qt[A]="on"+A}function vt(A,z){if(A.da)A=!0;else{z=new Ge(z,this);var ee=A.listener,fe=A.ha||A.src;A.fa&&$e(A),A=ee.call(fe,z)}return A}function St(A){return A=A[jn],A instanceof jt?A:null}var Ht="__closure_events_fn_"+(1e9*Math.random()>>>0);function fn(A){return typeof A=="function"?A:(A[Ht]||(A[Ht]=function(z){return A.handleEvent(z)}),A[Ht])}function mn(){ve.call(this),this.i=new jt(this),this.M=this,this.F=null}L(mn,ve),mn.prototype[nt]=!0,mn.prototype.removeEventListener=function(A,z,ee,fe){Ve(this,A,z,ee,fe)};function Jt(A,z){var ee,fe=A.F;if(fe)for(ee=[];fe;fe=fe.F)ee.push(fe);if(A=A.M,fe=z.type||z,typeof z=="string")z=new Re(z,A);else if(z instanceof Re)z.target=z.target||A;else{var Ke=z;z=new Re(fe,A),ae(z,Ke)}if(Ke=!0,ee)for(var ct=ee.length-1;0<=ct;ct--){var Ut=z.g=ee[ct];Ke=Hn(Ut,fe,!0,z)&&Ke}if(Ut=z.g=A,Ke=Hn(Ut,fe,!0,z)&&Ke,Ke=Hn(Ut,fe,!1,z)&&Ke,ee)for(ct=0;ct<ee.length;ct++)Ut=z.g=ee[ct],Ke=Hn(Ut,fe,!1,z)&&Ke}mn.prototype.N=function(){if(mn.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var ee=A.g[z],fe=0;fe<ee.length;fe++)It(ee[fe]);delete A.g[z],A.h--}}this.F=null},mn.prototype.K=function(A,z,ee,fe){return this.i.add(String(A),z,!1,ee,fe)},mn.prototype.L=function(A,z,ee,fe){return this.i.add(String(A),z,!0,ee,fe)};function Hn(A,z,ee,fe){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var Ke=!0,ct=0;ct<z.length;++ct){var Ut=z[ct];if(Ut&&!Ut.da&&Ut.capture==ee){var Jr=Ut.listener,hi=Ut.ha||Ut.src;Ut.fa&&Dt(A.i,Ut),Ke=Jr.call(hi,fe)!==!1&&Ke}}return Ke&&!fe.defaultPrevented}function fc(A,z,ee){if(typeof A=="function")ee&&(A=k(A,ee));else if(A&&typeof A.handleEvent=="function")A=k(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:_.setTimeout(A,z||0)}function Bt(A){A.g=fc(()=>{A.g=null,A.i&&(A.i=!1,Bt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class un extends ve{constructor(z,ee){super(),this.m=z,this.l=ee,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rs(A){ve.call(this),this.h=A,this.g={}}L(rs,ve);var Fs=[];function Qs(A){pe(A.g,function(z,ee){this.g.hasOwnProperty(ee)&&$e(z)},A),A.g={}}rs.prototype.N=function(){rs.aa.N.call(this),Qs(this)},rs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ei=_.JSON.stringify,Wa=_.JSON.parse,dl=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function _o(){}_o.prototype.h=null;function yo(A){return A.h||(A.h=A.i())}function Kl(){}var Bs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function mc(){Re.call(this,"d")}L(mc,Re);function ua(){Re.call(this,"c")}L(ua,Re);var gc={},hl=null;function Ku(){return hl=hl||new mn}gc.La="serverreachability";function _c(A){Re.call(this,gc.La,A)}L(_c,Re);function pl(A){const z=Ku();Jt(z,new _c(z))}gc.STAT_EVENT="statevent";function Do(A,z){Re.call(this,gc.STAT_EVENT,A),this.stat=z}L(Do,Re);function Mi(A){const z=Ku();Jt(z,new Do(z,A))}gc.Ma="timingevent";function ds(A,z){Re.call(this,gc.Ma,A),this.size=z}L(ds,Re);function za(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},z)}function qu(){this.g=!0}qu.prototype.xa=function(){this.g=!1};function yc(A,z,ee,fe,Ke,ct){A.info(function(){if(A.g)if(ct)for(var Ut="",Jr=ct.split("&"),hi=0;hi<Jr.length;hi++){var wr=Jr[hi].split("=");if(1<wr.length){var zs=wr[0];wr=wr[1];var ps=zs.split("_");Ut=2<=ps.length&&ps[1]=="type"?Ut+(zs+"="+wr+"&"):Ut+(zs+"=redacted&")}}else Ut=null;else Ut=ct;return"XMLHTTP REQ ("+fe+") [attempt "+Ke+"]: "+z+`
`+ee+`
`+Ut})}function da(A,z,ee,fe,Ke,ct,Ut){A.info(function(){return"XMLHTTP RESP ("+fe+") [ attempt "+Ke+"]: "+z+`
`+ee+`
`+ct+" "+Ut})}function ha(A,z,ee,fe){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+Zg(A,ee)+(fe?" "+fe:"")})}function Qd(A,z){A.info(function(){return"TIMEOUT: "+z})}qu.prototype.info=function(){};function Zg(A,z){if(!A.g)return z;if(!z)return null;try{var ee=JSON.parse(z);if(ee){for(A=0;A<ee.length;A++)if(Array.isArray(ee[A])){var fe=ee[A];if(!(2>fe.length)){var Ke=fe[1];if(Array.isArray(Ke)&&!(1>Ke.length)){var ct=Ke[0];if(ct!="noop"&&ct!="stop"&&ct!="close")for(var Ut=1;Ut<Ke.length;Ut++)Ke[Ut]=""}}}}return Ei(ee)}catch{return z}}var Yu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},wp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ws;function Xu(){}L(Xu,_o),Xu.prototype.g=function(){return new XMLHttpRequest},Xu.prototype.i=function(){return{}},Ws=new Xu;function pa(A,z,ee,fe){this.j=A,this.i=z,this.l=ee,this.R=fe||1,this.U=new rs(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zd}function Zd(){this.i=null,this.g="",this.h=!1}var eh={},Ga={};function th(A,z,ee){A.L=1,A.v=$a(Lo(z)),A.m=ee,A.P=!0,Ju(A,null)}function Ju(A,z){A.F=Date.now(),$r(A),A.A=Lo(A.v);var ee=A.A,fe=A.R;Array.isArray(fe)||(fe=[String(fe)]),Zl(ee.i,"t",fe),A.C=0,ee=A.j.J,A.h=new Zd,A.g=fE(A.j,ee?z:null,!A.m),0<A.O&&(A.M=new un(k(A.Y,A,A.g),A.O)),z=A.U,ee=A.g,fe=A.ca;var Ke="readystatechange";Array.isArray(Ke)||(Ke&&(Fs[0]=Ke.toString()),Ke=Fs);for(var ct=0;ct<Ke.length;ct++){var Ut=Ot(ee,Ke[ct],fe||z.handleEvent,!1,z.h||z);if(!Ut)break;z.g[Ut.key]=Ut}z=A.H?Z(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),pl(),yc(A.i,A.u,A.A,A.l,A.R,A.m)}pa.prototype.ca=function(A){A=A.target;const z=this.M;z&&Si(A)==3?z.j():this.Y(A)},pa.prototype.Y=function(A){try{if(A==this.g)e:{const ps=Si(this.g);var z=this.g.Ba();const Ka=this.g.Z();if(!(3>ps)&&(ps!=3||this.g&&(this.h.h||this.g.oa()||Ps(this.g)))){this.J||ps!=4||z==7||(z==8||0>=Ka?pl(3):pl(2)),Ec(this);var ee=this.g.Z();this.X=ee;t:if(xo(this)){var fe=Ps(this.g);A="";var Ke=fe.length,ct=Si(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fa(this),fl(this);var Ut="";break t}this.h.i=new _.TextDecoder}for(z=0;z<Ke;z++)this.h.h=!0,A+=this.h.i.decode(fe[z],{stream:!(ct&&z==Ke-1)});fe.length=0,this.h.g+=A,this.C=0,Ut=this.h.g}else Ut=this.g.oa();if(this.o=ee==200,da(this.i,this.u,this.A,this.l,this.R,ps,ee),this.o){if(this.T&&!this.K){t:{if(this.g){var Jr,hi=this.g;if((Jr=hi.g?hi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(Jr)){var wr=Jr;break t}}wr=null}if(ee=wr)ha(this.i,this.l,ee,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Cp(this,ee);else{this.o=!1,this.s=3,Mi(12),fa(this),fl(this);break e}}if(this.P){ee=!0;let Ho;for(;!this.J&&this.C<Ut.length;)if(Ho=nh(this,Ut),Ho==Ga){ps==4&&(this.s=4,Mi(14),ee=!1),ha(this.i,this.l,null,"[Incomplete Response]");break}else if(Ho==eh){this.s=4,Mi(15),ha(this.i,this.l,Ut,"[Invalid Chunk]"),ee=!1;break}else ha(this.i,this.l,Ho,null),Cp(this,Ho);if(xo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ps!=4||Ut.length!=0||this.h.h||(this.s=1,Mi(16),ee=!1),this.o=this.o&&ee,!ee)ha(this.i,this.l,Ut,"[Invalid Chunked Response]"),fa(this),fl(this);else if(0<Ut.length&&!this.W){this.W=!0;var zs=this.j;zs.g==this&&zs.ba&&!zs.M&&(zs.j.info("Great, no buffering proxy detected. Bytes received: "+Ut.length),t_(zs),zs.M=!0,Mi(11))}}else ha(this.i,this.l,Ut,null),Cp(this,Ut);ps==4&&fa(this),this.o&&!this.J&&(ps==4?um(this.j,this):(this.o=!1,$r(this)))}else Bo(this.g),ee==400&&0<Ut.indexOf("Unknown SID")?(this.s=3,Mi(12)):(this.s=0,Mi(13)),fa(this),fl(this)}}}catch{}finally{}};function xo(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function nh(A,z){var ee=A.C,fe=z.indexOf(`
`,ee);return fe==-1?Ga:(ee=Number(z.substring(ee,fe)),isNaN(ee)?eh:(fe+=1,fe+ee>z.length?Ga:(z=z.slice(fe,fe+ee),A.C=fe+ee,z)))}pa.prototype.cancel=function(){this.J=!0,fa(this)};function $r(A){A.S=Date.now()+A.I,vi(A,A.I)}function vi(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=za(k(A.ba,A),z)}function Ec(A){A.B&&(_.clearTimeout(A.B),A.B=null)}pa.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Qd(this.i,this.A),this.L!=2&&(pl(),Mi(17)),fa(this),this.s=2,fl(this)):vi(this,this.S-A)};function fl(A){A.j.G==0||A.J||um(A.j,A)}function fa(A){Ec(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,Qs(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function Cp(A,z){try{var ee=A.j;if(ee.G!=0&&(ee.g==A||Zs(ee.h,A))){if(!A.K&&Zs(ee.h,A)&&ee.G==3){try{var fe=ee.Da.g.parse(z)}catch{fe=null}if(Array.isArray(fe)&&fe.length==3){var Ke=fe;if(Ke[0]==0){e:if(!ee.u){if(ee.g)if(ee.g.F+3e3<A.F)lm(ee),El(ee);else break e;cm(ee),Mi(18)}}else ee.za=Ke[1],0<ee.za-ee.T&&37500>Ke[2]&&ee.F&&ee.v==0&&!ee.C&&(ee.C=za(k(ee.Za,ee),6e3));if(1>=nm(ee.h)&&ee.ca){try{ee.ca()}catch{}ee.ca=void 0}}else id(ee,11)}else if((A.K||ee.g==A)&&lm(ee),!$(z))for(Ke=ee.Da.g.parse(z),z=0;z<Ke.length;z++){let wr=Ke[z];if(ee.T=wr[0],wr=wr[1],ee.G==2)if(wr[0]=="c"){ee.K=wr[1],ee.ia=wr[2];const zs=wr[3];zs!=null&&(ee.la=zs,ee.j.info("VER="+ee.la));const ps=wr[4];ps!=null&&(ee.Aa=ps,ee.j.info("SVER="+ee.Aa));const Ka=wr[5];Ka!=null&&typeof Ka=="number"&&0<Ka&&(fe=1.5*Ka,ee.L=fe,ee.j.info("backChannelRequestTimeoutMs_="+fe)),fe=ee;const Ho=A.g;if(Ho){const Op=Ho.g?Ho.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Op){var ct=fe.h;ct.g||Op.indexOf("spdy")==-1&&Op.indexOf("quic")==-1&&Op.indexOf("h2")==-1||(ct.j=ct.l,ct.g=new Set,ct.h&&(Rp(ct,ct.h),ct.h=null))}if(fe.D){const hm=Ho.g?Ho.g.getResponseHeader("X-HTTP-Session-Id"):null;hm&&(fe.ya=hm,Xr(fe.I,fe.D,hm))}}ee.G=3,ee.l&&ee.l.ua(),ee.ba&&(ee.R=Date.now()-A.F,ee.j.info("Handshake RTT: "+ee.R+"ms")),fe=ee;var Ut=A;if(fe.qa=n_(fe,fe.J?fe.ia:null,fe.W),Ut.K){ml(fe.h,Ut);var Jr=Ut,hi=fe.L;hi&&(Jr.I=hi),Jr.B&&(Ec(Jr),$r(Jr)),fe.g=Ut}else tu(fe);0<ee.i.length&&bc(ee)}else wr[0]!="stop"&&wr[0]!="close"||id(ee,7);else ee.G==3&&(wr[0]=="stop"||wr[0]=="close"?wr[0]=="stop"?id(ee,7):Ji(ee):wr[0]!="noop"&&ee.l&&ee.l.ta(wr),ee.v=0)}}pl(4)}catch{}}var rh=class{constructor(A,z){this.g=A,this.map=z}};function ql(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Eo(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function nm(A){return A.h?1:A.g?A.g.size:0}function Zs(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function Rp(A,z){A.g?A.g.add(z):A.h=z}function ml(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}ql.prototype.cancel=function(){if(this.i=ih(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function ih(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const ee of A.g.values())z=z.concat(ee.D);return z}return F(A.i)}function sh(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var z=[],ee=A.length,fe=0;fe<ee;fe++)z.push(A[fe]);return z}z=[],ee=0;for(fe in A)z[ee++]=A[fe];return z}function _r(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var z=[];A=A.length;for(var ee=0;ee<A;ee++)z.push(ee);return z}z=[],ee=0;for(const fe in A)z[ee++]=fe;return z}}}function Yl(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var ee=_r(A),fe=sh(A),Ke=fe.length,ct=0;ct<Ke;ct++)z.call(void 0,fe[ct],ee&&ee[ct],A)}var Xl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Qu(A,z){if(A){A=A.split("&");for(var ee=0;ee<A.length;ee++){var fe=A[ee].indexOf("="),Ke=null;if(0<=fe){var ct=A[ee].substring(0,fe);Ke=A[ee].substring(fe+1)}else ct=A[ee];z(ct,Ke?decodeURIComponent(Ke.replace(/\+/g," ")):"")}}}function Ha(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof Ha){this.h=A.h,Zu(this,A.j),this.o=A.o,this.g=A.g,gl(this,A.s),this.l=A.l;var z=A.i,ee=new Mo;ee.i=z.i,z.g&&(ee.g=new Map(z.g),ee.h=z.h),Jl(this,ee),this.m=A.m}else A&&(z=String(A).match(Xl))?(this.h=!1,Zu(this,z[1]||"",!0),this.o=ar(z[2]||""),this.g=ar(z[3]||"",!0),gl(this,z[4]),this.l=ar(z[5]||"",!0),Jl(this,z[6]||"",!0),this.m=ar(z[7]||"")):(this.h=!1,this.i=new Mo(null,this.h))}Ha.prototype.toString=function(){var A=[],z=this.j;z&&A.push(vc(z,Ql,!0),":");var ee=this.g;return(ee||z=="file")&&(A.push("//"),(z=this.o)&&A.push(vc(z,Ql,!0),"@"),A.push(encodeURIComponent(String(ee)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ee=this.s,ee!=null&&A.push(":",String(ee))),(ee=this.l)&&(this.g&&ee.charAt(0)!="/"&&A.push("/"),A.push(vc(ee,ee.charAt(0)=="/"?Ip:oh,!0))),(ee=this.i.toString())&&A.push("?",ee),(ee=this.m)&&A.push("#",vc(ee,Ap)),A.join("")};function Lo(A){return new Ha(A)}function Zu(A,z,ee){A.j=ee?ar(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function gl(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function Jl(A,z,ee){z instanceof Mo?(A.i=z,Fo(A.i,A.h)):(ee||(z=vc(z,im)),A.i=new Mo(z,A.h))}function Xr(A,z,ee){A.i.set(z,ee)}function $a(A){return Xr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function ar(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function vc(A,z,ee){return typeof A=="string"?(A=encodeURI(A).replace(z,rm),ee&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function rm(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var Ql=/[#\/\?@]/g,oh=/[#\?:]/g,Ip=/[#\?]/g,im=/[#\?@]/g,Ap=/#/g;function Mo(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function is(A){A.g||(A.g=new Map,A.h=0,A.i&&Qu(A.i,function(z,ee){A.add(decodeURIComponent(z.replace(/\+/g," ")),ee)}))}n=Mo.prototype,n.add=function(A,z){is(this),this.i=null,A=jo(this,A);var ee=this.g.get(A);return ee||this.g.set(A,ee=[]),ee.push(z),this.h+=1,this};function Uo(A,z){is(A),z=jo(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function Vo(A,z){return is(A),z=jo(A,z),A.g.has(z)}n.forEach=function(A,z){is(this),this.g.forEach(function(ee,fe){ee.forEach(function(Ke){A.call(z,Ke,fe,this)},this)},this)},n.na=function(){is(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),ee=[];for(let fe=0;fe<z.length;fe++){const Ke=A[fe];for(let ct=0;ct<Ke.length;ct++)ee.push(z[fe])}return ee},n.V=function(A){is(this);let z=[];if(typeof A=="string")Vo(this,A)&&(z=z.concat(this.g.get(jo(this,A))));else{A=Array.from(this.g.values());for(let ee=0;ee<A.length;ee++)z=z.concat(A[ee])}return z},n.set=function(A,z){return is(this),this.i=null,A=jo(this,A),Vo(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function Zl(A,z,ee){Uo(A,z),0<ee.length&&(A.i=null,A.g.set(jo(A,z),F(ee)),A.h+=ee.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var ee=0;ee<z.length;ee++){var fe=z[ee];const ct=encodeURIComponent(String(fe)),Ut=this.V(fe);for(fe=0;fe<Ut.length;fe++){var Ke=ct;Ut[fe]!==""&&(Ke+="="+encodeURIComponent(String(Ut[fe]))),A.push(Ke)}}return this.i=A.join("&")};function jo(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function Fo(A,z){z&&!A.j&&(is(A),A.i=null,A.g.forEach(function(ee,fe){var Ke=fe.toLowerCase();fe!=Ke&&(Uo(this,fe),Zl(this,Ke,ee))},A)),A.j=z}function sm(A,z){const ee=new qu;if(_.Image){const fe=new Image;fe.onload=U(hs,ee,"TestLoadImage: loaded",!0,z,fe),fe.onerror=U(hs,ee,"TestLoadImage: error",!1,z,fe),fe.onabort=U(hs,ee,"TestLoadImage: abort",!1,z,fe),fe.ontimeout=U(hs,ee,"TestLoadImage: timeout",!1,z,fe),_.setTimeout(function(){fe.ontimeout&&fe.ontimeout()},1e4),fe.src=A}else z(!1)}function Sc(A,z){const ee=new qu,fe=new AbortController,Ke=setTimeout(()=>{fe.abort(),hs(ee,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:fe.signal}).then(ct=>{clearTimeout(Ke),ct.ok?hs(ee,"TestPingServer: ok",!0,z):hs(ee,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(Ke),hs(ee,"TestPingServer: error",!1,z)})}function hs(A,z,ee,fe,Ke){try{Ke&&(Ke.onload=null,Ke.onerror=null,Ke.onabort=null,Ke.ontimeout=null),fe(ee)}catch{}}function ed(){this.g=new dl}function Pp(A,z,ee){const fe=ee||"";try{Yl(A,function(Ke,ct){let Ut=Ke;S(Ke)&&(Ut=Ei(Ke)),z.push(fe+ct+"="+encodeURIComponent(Ut))})}catch(Ke){throw z.push(fe+"type="+encodeURIComponent("_badmap")),Ke}}function _l(A){this.l=A.Ub||null,this.j=A.eb||!1}L(_l,_o),_l.prototype.g=function(){return new eu(this.l,this.j)},_l.prototype.i=function(A){return function(){return A}}({});function eu(A,z){mn.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}L(eu,mn),n=eu.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,ga(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||_).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ma(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,ga(this)),this.g&&(this.readyState=3,ga(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;om(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function om(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?ma(this):ga(this),this.readyState==3&&om(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,ma(this))},n.Qa=function(A){this.g&&(this.response=A,ma(this))},n.ga=function(){this.g&&ma(this)};function ma(A){A.readyState=4,A.l=null,A.j=null,A.v=null,ga(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var ee=z.next();!ee.done;)ee=ee.value,A.push(ee[0]+": "+ee[1]),ee=z.next();return A.join(`\r
`)};function ga(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(eu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function yl(A){let z="";return pe(A,function(ee,fe){z+=fe,z+=":",z+=ee,z+=`\r
`}),z}function Se(A,z,ee){e:{for(fe in ee){var fe=!1;break e}fe=!0}fe||(ee=yl(ee),typeof A=="string"?ee!=null&&encodeURIComponent(String(ee)):Xr(A,z,ee))}function De(A){mn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}L(De,mn);var rt=/^https?$/i,Yt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,ee,fe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ws.g(),this.v=this.o?yo(this.o):yo(Ws),this.g.onreadystatechange=k(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(ct){Xn(this,ct);return}if(A=ee||"",ee=new Map(this.headers),fe)if(Object.getPrototypeOf(fe)===Object.prototype)for(var Ke in fe)ee.set(Ke,fe[Ke]);else if(typeof fe.keys=="function"&&typeof fe.get=="function")for(const ct of fe.keys())ee.set(ct,fe.get(ct));else throw Error("Unknown input type for opt_headers: "+String(fe));fe=Array.from(ee.keys()).find(ct=>ct.toLowerCase()=="content-type"),Ke=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Yt,z,void 0))||fe||Ke||ee.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ct,Ut]of ee)this.g.setRequestHeader(ct,Ut);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{jr(this),this.u=!0,this.g.send(A),this.u=!1}catch(ct){Xn(this,ct)}};function Xn(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,Tr(A),dn(A)}function Tr(A){A.A||(A.A=!0,Jt(A,"complete"),Jt(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,Jt(this,"complete"),Jt(this,"abort"),dn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),dn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Kr(this):this.bb())},n.bb=function(){Kr(this)};function Kr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||Si(A)!=4||A.Z()!=2)){if(A.u&&Si(A)==4)fc(A.Ea,0,A);else if(Jt(A,"readystatechange"),Si(A)==4){A.h=!1;try{const Ut=A.Z();e:switch(Ut){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var ee;if(!(ee=z)){var fe;if(fe=Ut===0){var Ke=String(A.D).match(Xl)[1]||null;!Ke&&_.self&&_.self.location&&(Ke=_.self.location.protocol.slice(0,-1)),fe=!rt.test(Ke?Ke.toLowerCase():"")}ee=fe}if(ee)Jt(A,"complete"),Jt(A,"success");else{A.m=6;try{var ct=2<Si(A)?A.g.statusText:""}catch{ct=""}A.l=ct+" ["+A.Z()+"]",Tr(A)}}finally{dn(A)}}}}function dn(A,z){if(A.g){jr(A);const ee=A.g,fe=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||Jt(A,"ready");try{ee.onreadystatechange=fe}catch{}}}function jr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Si(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Si(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),Wa(z)}};function Ps(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function Bo(A){const z={};A=(A.g&&2<=Si(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let fe=0;fe<A.length;fe++){if($(A[fe]))continue;var ee=me(A[fe]);const Ke=ee[0];if(ee=ee[1],typeof ee!="string")continue;ee=ee.trim();const ct=z[Ke]||[];z[Ke]=ct,ct.push(ee)}te(z,function(fe){return fe.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Wo(A,z,ee){return ee&&ee.internalChannelParams&&ee.internalChannelParams[A]||z}function td(A){this.Aa=0,this.i=[],this.j=new qu,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Wo("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Wo("baseRetryDelayMs",5e3,A),this.cb=Wo("retryDelaySeedMs",1e4,A),this.Wa=Wo("forwardChannelMaxRetries",2,A),this.wa=Wo("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new ql(A&&A.concurrentRequestLimit),this.Da=new ed,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=td.prototype,n.la=8,n.G=1,n.connect=function(A,z,ee,fe){Mi(0),this.W=A,this.H=z||{},ee&&fe!==void 0&&(this.H.OSID=ee,this.H.OAID=fe),this.F=this.X,this.I=n_(this,null,this.W),bc(this)};function Ji(A){if(ah(A),A.G==3){var z=A.U++,ee=Lo(A.I);if(Xr(ee,"SID",A.K),Xr(ee,"RID",z),Xr(ee,"TYPE","terminate"),nd(A,ee),z=new pa(A,A.j,z),z.L=2,z.v=$a(Lo(ee)),ee=!1,_.navigator&&_.navigator.sendBeacon)try{ee=_.navigator.sendBeacon(z.v.toString(),"")}catch{}!ee&&_.Image&&(new Image().src=z.v,ee=!0),ee||(z.g=fE(z.j,null),z.g.ea(z.v)),z.F=Date.now(),$r(z)}sd(A)}function El(A){A.g&&(t_(A),A.g.cancel(),A.g=null)}function ah(A){El(A),A.u&&(_.clearTimeout(A.u),A.u=null),lm(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function bc(A){if(!Eo(A.h)&&!A.s){A.s=!0;var z=A.Ga;Ce||ke(),Ie||(Ce(),Ie=!0),ye.add(z,A),A.B=0}}function e_(A,z){return nm(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=za(k(A.Ga,A,z),rd(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Ke=new pa(this,this.j,A);let ct=this.o;if(this.S&&(ct?(ct=Z(ct),ae(ct,this.S)):ct=this.S),this.m!==null||this.O||(Ke.H=ct,ct=null),this.P)e:{for(var z=0,ee=0;ee<this.i.length;ee++){t:{var fe=this.i[ee];if("__data__"in fe.map&&(fe=fe.map.__data__,typeof fe=="string")){fe=fe.length;break t}fe=void 0}if(fe===void 0)break;if(z+=fe,4096<z){z=ee;break e}if(z===4096||ee===this.i.length-1){z=ee+1;break e}}z=1e3}else z=1e3;z=zo(this,Ke,z),ee=Lo(this.I),Xr(ee,"RID",A),Xr(ee,"CVER",22),this.D&&Xr(ee,"X-HTTP-Session-Id",this.D),nd(this,ee),ct&&(this.O?z="headers="+encodeURIComponent(String(yl(ct)))+"&"+z:this.m&&Se(ee,this.m,ct)),Rp(this.h,Ke),this.Ua&&Xr(ee,"TYPE","init"),this.P?(Xr(ee,"$req",z),Xr(ee,"SID","null"),Ke.T=!0,th(Ke,ee,null)):th(Ke,ee,z),this.G=2}}else this.G==3&&(A?am(this,A):this.i.length==0||Eo(this.h)||am(this))};function am(A,z){var ee;z?ee=z.l:ee=A.U++;const fe=Lo(A.I);Xr(fe,"SID",A.K),Xr(fe,"RID",ee),Xr(fe,"AID",A.T),nd(A,fe),A.m&&A.o&&Se(fe,A.m,A.o),ee=new pa(A,A.j,ee,A.B+1),A.m===null&&(ee.H=A.o),z&&(A.i=z.D.concat(A.i)),z=zo(A,ee,1e3),ee.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Rp(A.h,ee),th(ee,fe,z)}function nd(A,z){A.H&&pe(A.H,function(ee,fe){Xr(z,fe,ee)}),A.l&&Yl({},function(ee,fe){Xr(z,fe,ee)})}function zo(A,z,ee){ee=Math.min(A.i.length,ee);var fe=A.l?k(A.l.Na,A.l,A):null;e:{var Ke=A.i;let ct=-1;for(;;){const Ut=["count="+ee];ct==-1?0<ee?(ct=Ke[0].g,Ut.push("ofs="+ct)):ct=0:Ut.push("ofs="+ct);let Jr=!0;for(let hi=0;hi<ee;hi++){let wr=Ke[hi].g;const zs=Ke[hi].map;if(wr-=ct,0>wr)ct=Math.max(0,Ke[hi].g-100),Jr=!1;else try{Pp(zs,Ut,"req"+wr+"_")}catch{fe&&fe(zs)}}if(Jr){fe=Ut.join("&");break e}}}return A=A.i.splice(0,ee),z.D=A,fe}function tu(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;Ce||ke(),Ie||(Ce(),Ie=!0),ye.add(z,A),A.v=0}}function cm(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=za(k(A.Fa,A),rd(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,pE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=za(k(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mi(10),El(this),pE(this))};function t_(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function pE(A){A.g=new pa(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=Lo(A.qa);Xr(z,"RID","rpc"),Xr(z,"SID",A.K),Xr(z,"AID",A.T),Xr(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&Xr(z,"TO",A.ja),Xr(z,"TYPE","xmlhttp"),nd(A,z),A.m&&A.o&&Se(z,A.m,A.o),A.L&&(A.g.I=A.L);var ee=A.g;A=A.ia,ee.L=1,ee.v=$a(Lo(z)),ee.m=null,ee.P=!0,Ju(ee,A)}n.Za=function(){this.C!=null&&(this.C=null,El(this),cm(this),Mi(19))};function lm(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function um(A,z){var ee=null;if(A.g==z){lm(A),t_(A),A.g=null;var fe=2}else if(Zs(A.h,z))ee=z.D,ml(A.h,z),fe=1;else return;if(A.G!=0){if(z.o)if(fe==1){ee=z.m?z.m.length:0,z=Date.now()-z.F;var Ke=A.B;fe=Ku(),Jt(fe,new ds(fe,ee)),bc(A)}else tu(A);else if(Ke=z.s,Ke==3||Ke==0&&0<z.X||!(fe==1&&e_(A,z)||fe==2&&cm(A)))switch(ee&&0<ee.length&&(z=A.h,z.i=z.i.concat(ee)),Ke){case 1:id(A,5);break;case 4:id(A,10);break;case 3:id(A,6);break;default:id(A,2)}}}function rd(A,z){let ee=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(ee*=2),ee*z}function id(A,z){if(A.j.info("Error code "+z),z==2){var ee=k(A.fb,A),fe=A.Xa;const Ke=!fe;fe=new Ha(fe||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||Zu(fe,"https"),$a(fe),Ke?sm(fe.toString(),ee):Sc(fe.toString(),ee)}else Mi(2);A.G=0,A.l&&A.l.sa(z),sd(A),ah(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Mi(2)):(this.j.info("Failed to ping google.com"),Mi(1))};function sd(A){if(A.G=0,A.ka=[],A.l){const z=ih(A.h);(z.length!=0||A.i.length!=0)&&(B(A.ka,z),B(A.ka,A.i),A.h.i.length=0,F(A.i),A.i.length=0),A.l.ra()}}function n_(A,z,ee){var fe=ee instanceof Ha?Lo(ee):new Ha(ee);if(fe.g!="")z&&(fe.g=z+"."+fe.g),gl(fe,fe.s);else{var Ke=_.location;fe=Ke.protocol,z=z?z+"."+Ke.hostname:Ke.hostname,Ke=+Ke.port;var ct=new Ha(null);fe&&Zu(ct,fe),z&&(ct.g=z),Ke&&gl(ct,Ke),ee&&(ct.l=ee),fe=ct}return ee=A.D,z=A.ya,ee&&z&&Xr(fe,ee,z),Xr(fe,"VER",A.la),nd(A,fe),fe}function fE(A,z,ee){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new _l({eb:ee})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Fn(){}n=Fn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function dm(){}dm.prototype.g=function(A,z){return new Go(A,z)};function Go(A,z){mn.call(this),this.g=new td(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!$(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!$(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new Tc(this)}L(Go,mn),Go.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Go.prototype.close=function(){Ji(this.g)},Go.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var ee={};ee.__data__=A,A=ee}else this.u&&(ee={},ee.__data__=Ei(A),A=ee);z.i.push(new rh(z.Ya++,A)),z.G==3&&bc(z)},Go.prototype.N=function(){this.g.l=null,delete this.j,Ji(this.g),delete this.g,Go.aa.N.call(this)};function mE(A){mc.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const ee in z){A=ee;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}L(mE,mc);function gE(){ua.call(this),this.status=1}L(gE,ua);function Tc(A){this.g=A}L(Tc,Fn),Tc.prototype.ua=function(){Jt(this.g,"a")},Tc.prototype.ta=function(A){Jt(this.g,new mE(A))},Tc.prototype.sa=function(A){Jt(this.g,new gE)},Tc.prototype.ra=function(){Jt(this.g,"b")},dm.prototype.createWebChannel=dm.prototype.g,Go.prototype.send=Go.prototype.o,Go.prototype.open=Go.prototype.m,Go.prototype.close=Go.prototype.close,mse=function(){return new dm},fse=function(){return Ku()},pse=gc,_j={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Yu.NO_ERROR=0,Yu.TIMEOUT=8,Yu.HTTP_ERROR=6,UO=Yu,wp.COMPLETE="complete",hse=wp,Kl.EventType=Bs,Bs.OPEN="a",Bs.CLOSE="b",Bs.ERROR="c",Bs.MESSAGE="d",mn.prototype.listen=mn.prototype.K,rC=Kl,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,dse=De}).apply(typeof Q1<"u"?Q1:typeof self<"u"?self:typeof window<"u"?window:{});const IJ="@firebase/firestore",AJ="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}La.UNAUTHENTICATED=new La(null),La.GOOGLE_CREDENTIALS=new La("google-credentials-uid"),La.FIRST_PARTY=new La("first-party-uid"),La.MOCK_USER=new La("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eb="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE=new w5("@firebase/firestore");function VS(){return tE.logLevel}function en(n,...e){if(tE.logLevel<=Ir.DEBUG){const i=e.map(L5);tE.debug(`Firestore (${eb}): ${n}`,...i)}}function qf(n,...e){if(tE.logLevel<=Ir.ERROR){const i=e.map(L5);tE.error(`Firestore (${eb}): ${n}`,...i)}}function L0(n,...e){if(tE.logLevel<=Ir.WARN){const i=e.map(L5);tE.warn(`Firestore (${eb}): ${n}`,...i)}}function L5(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gn(n="Unexpected state"){const e=`FIRESTORE (${eb}) INTERNAL ASSERTION FAILED: `+n;throw qf(e),new Error(e)}function di(n,e){n||Gn()}function Zn(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class on extends Tp{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wf{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gse{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class a4e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(La.UNAUTHENTICATED))}shutdown(){}}class c4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class l4e{constructor(e){this.t=e,this.currentUser=La.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){di(this.o===void 0);let a=this.i;const l=E=>this.i!==a?(a=this.i,i(E)):Promise.resolve();let u=new Wf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Wf,e.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const E=u;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{en("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(en("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Wf)}},0),f()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==e?(en("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(di(typeof a.accessToken=="string"),new gse(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return di(e===null||typeof e=="string"),new La(e)}}class u4e{constructor(e,i,a){this.l=e,this.h=i,this.P=a,this.type="FirstParty",this.user=La.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class d4e{constructor(e,i,a){this.l=e,this.h=i,this.P=a}getToken(){return Promise.resolve(new u4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(La.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class PJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class h4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ll(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){di(this.o===void 0);const a=u=>{u.error!=null&&en("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const f=u.token!==this.R;return this.R=u.token,en("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>a(u))};const l=u=>{en("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):en("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new PJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(di(typeof i.token=="string"),this.R=i.token,new PJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _se{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=p4e(40);for(let u=0;u<l.length;++u)a.length<20&&l[u]<i&&(a+=e.charAt(l[u]%62))}return a}}function Lr(n,e){return n<e?-1:n>e?1:0}function M0(n,e,i){return n.length===e.length&&n.every((a,l)=>i(a,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OJ=-62135596800,kJ=1e6;class fo{static now(){return fo.fromMillis(Date.now())}static fromDate(e){return fo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),a=Math.floor((e-1e3*i)*kJ);return new fo(i,a)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new on(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new on(wt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<OJ)throw new on(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new on(wt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kJ}_compareTo(e){return this.seconds===e.seconds?Lr(this.nanoseconds,e.nanoseconds):Lr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-OJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{static fromTimestamp(e){return new Yn(e)}static min(){return new Yn(new fo(0,0))}static max(){return new Yn(new fo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NJ="__name__";class Xh{constructor(e,i,a){i===void 0?i=0:i>e.length&&Gn(),a===void 0?a=e.length-i:a>e.length-i&&Gn(),this.segments=e,this.offset=i,this.len=a}get length(){return this.len}isEqual(e){return Xh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Xh?e.forEach(a=>{i.push(a)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,a=this.limit();i<a;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const a=Math.min(e.length,i.length);for(let l=0;l<a;l++){const u=Xh.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return Math.sign(e.length-i.length)}static compareSegments(e,i){const a=Xh.isNumericId(e),l=Xh.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?Xh.extractNumericId(e).compare(Xh.extractNumericId(i)):e<i?-1:e>i?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pg.fromString(e.substring(4,e.length-2))}}class $i extends Xh{construct(e,i,a){return new $i(e,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const a of e){if(a.indexOf("//")>=0)throw new on(wt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new $i(i)}static emptyPath(){return new $i([])}}const f4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class aa extends Xh{construct(e,i,a){return new aa(e,i,a)}static isValidIdentifier(e){return f4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),aa.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===NJ}static keyField(){return new aa([NJ])}static fromServerFormat(e){const i=[];let a="",l=0;const u=()=>{if(a.length===0)throw new on(wt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let f=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new on(wt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new on(wt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);a+=E,l+=2}else _==="`"?(f=!f,l++):_!=="."||f?(a+=_,l++):(u(),l++)}if(u(),f)throw new on(wt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new aa(i)}static emptyPath(){return new aa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.path=e}static fromPath(e){return new Tn($i.fromString(e))}static fromName(e){return new Tn($i.fromString(e).popFirst(5))}static empty(){return new Tn($i.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&$i.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return $i.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Tn(new $i(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tR=-1;function m4e(n,e){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Yn.fromTimestamp(a===1e9?new fo(i+1,0):new fo(i,a));return new Ug(l,Tn.empty(),e)}function g4e(n){return new Ug(n.readTime,n.key,tR)}class Ug{constructor(e,i,a){this.readTime=e,this.documentKey=i,this.largestBatchId=a}static min(){return new Ug(Yn.min(),Tn.empty(),tR)}static max(){return new Ug(Yn.max(),Tn.empty(),tR)}}function _4e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Tn.comparator(n.documentKey,e.documentKey),i!==0?i:Lr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y4e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class E4e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tb(n){if(n.code!==wt.FAILED_PRECONDITION||n.message!==y4e)throw n;en("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Gn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Tt((a,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(a,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(a,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Tt?i:Tt.resolve(i)}catch(i){return Tt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Tt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Tt.reject(i)}static resolve(e){return new Tt((i,a)=>{i(e)})}static reject(e){return new Tt((i,a)=>{a(e)})}static waitFor(e){return new Tt((i,a)=>{let l=0,u=0,f=!1;e.forEach(_=>{++l,_.next(()=>{++u,f&&u===l&&i()},E=>a(E))}),f=!0,u===l&&i()})}static or(e){let i=Tt.resolve(!1);for(const a of e)i=i.next(l=>l?Tt.resolve(l):a());return i}static forEach(e,i){const a=[];return e.forEach((l,u)=>{a.push(i.call(this,l,u))}),this.waitFor(a)}static mapArray(e,i){return new Tt((a,l)=>{const u=e.length,f=new Array(u);let _=0;for(let E=0;E<u;E++){const S=E;i(e[S]).next(w=>{f[S]=w,++_,_===u&&a(f)},w=>l(w))}})}static doWhile(e,i){return new Tt((a,l)=>{const u=()=>{e()===!0?i().next(()=>{u()},l):a()};u()})}}function v4e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function nb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}EN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M5=-1;function vN(n){return n==null}function gk(n){return n===0&&1/n==-1/0}function S4e(n){return typeof n=="number"&&Number.isInteger(n)&&!gk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yse="";function b4e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=DJ(e)),e=T4e(n.get(i),e);return DJ(e)}function T4e(n,e){let i=e;const a=n.length;for(let l=0;l<a;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case yse:i+="";break;default:i+=u}}return i}function DJ(n){return n+yse+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Yg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function Ese(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(e,i){this.comparator=e,this.root=i||sa.EMPTY}insert(e,i){return new us(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,sa.BLACK,null,null))}remove(e){return new us(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sa.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(e){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(e,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,a)=>(e(i,a),!1))}toString(){const e=[];return this.inorderTraversal((i,a)=>(e.push(`${i}:${a}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Z1(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Z1(this.root,e,this.comparator,!1)}getReverseIterator(){return new Z1(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Z1(this.root,e,this.comparator,!0)}}class Z1{constructor(e,i,a,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?a(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sa{constructor(e,i,a,l,u){this.key=e,this.value=i,this.color=a??sa.RED,this.left=l??sa.EMPTY,this.right=u??sa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,a,l,u){return new sa(e??this.key,i??this.value,a??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,a){let l=this;const u=a(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,a),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return sa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let a,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return sa.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,sa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,sa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Gn();const e=this.left.check();if(e!==this.right.check())throw Gn();return e+(this.isRed()?0:1)}}sa.EMPTY=null,sa.RED=!0,sa.BLACK=!1;sa.EMPTY=new class{constructor(){this.size=0}get key(){throw Gn()}get value(){throw Gn()}get color(){throw Gn()}get left(){throw Gn()}get right(){throw Gn()}copy(e,i,a,l,u){return this}insert(e,i,a){return new sa(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e){this.comparator=e,this.data=new us(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,a)=>(e(i),!1))}forEachInRange(e,i){const a=this.data.getIteratorFrom(e[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!e(a.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new LJ(this.data.getIterator())}getIteratorFrom(e){return new LJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(a=>{i=i.add(a)}),i}isEqual(e){if(!(e instanceof mo)||this.size!==e.size)return!1;const i=this.data.getIterator(),a=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=a.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new mo(this.comparator);return i.data=e,i}}class LJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e){this.fields=e,e.sort(aa.comparator)}static empty(){return new Ul([])}unionWith(e){let i=new mo(aa.comparator);for(const a of this.fields)i=i.add(a);for(const a of e)i=i.add(a);return new Ul(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return M0(this.fields,e.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vse extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ca{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new vse("Invalid base64 string: "+u):u}}(e);return new ca(i)}static fromUint8Array(e){const i=function(l){let u="";for(let f=0;f<l.length;++f)u+=String.fromCharCode(l[f]);return u}(e);return new ca(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Lr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ca.EMPTY_BYTE_STRING=new ca("");const w4e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vg(n){if(di(!!n),typeof n=="string"){let e=0;const i=w4e.exec(n);if(di(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:e}}return{seconds:Ms(n.seconds),nanos:Ms(n.nanos)}}function Ms(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function jg(n){return typeof n=="string"?ca.fromBase64String(n):ca.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sse="server_timestamp",bse="__type__",Tse="__previous_value__",wse="__local_write_time__";function U5(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[bse])===null||i===void 0?void 0:i.stringValue)===Sse}function SN(n){const e=n.mapValue.fields[Tse];return U5(e)?SN(e):e}function nR(n){const e=Vg(n.mapValue.fields[wse].timestampValue);return new fo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4e{constructor(e,i,a,l,u,f,_,E,S){this.databaseId=e,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=u,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=S}}const _k="(default)";class rR{constructor(e,i){this.projectId=e,this.database=i||_k}static empty(){return new rR("","")}get isDefaultDatabase(){return this.database===_k}isEqual(e){return e instanceof rR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cse="__type__",R4e="__max__",eO={mapValue:{}},Rse="__vector__",yk="value";function Fg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?U5(n)?4:A4e(n)?9007199254740991:I4e(n)?10:11:Gn()}function yp(n,e){if(n===e)return!0;const i=Fg(n);if(i!==Fg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return nR(n).isEqual(nR(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const f=Vg(l.timestampValue),_=Vg(u.timestampValue);return f.seconds===_.seconds&&f.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return jg(l.bytesValue).isEqual(jg(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return Ms(l.geoPointValue.latitude)===Ms(u.geoPointValue.latitude)&&Ms(l.geoPointValue.longitude)===Ms(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return Ms(l.integerValue)===Ms(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const f=Ms(l.doubleValue),_=Ms(u.doubleValue);return f===_?gk(f)===gk(_):isNaN(f)&&isNaN(_)}return!1}(n,e);case 9:return M0(n.arrayValue.values||[],e.arrayValue.values||[],yp);case 10:case 11:return function(l,u){const f=l.mapValue.fields||{},_=u.mapValue.fields||{};if(xJ(f)!==xJ(_))return!1;for(const E in f)if(f.hasOwnProperty(E)&&(_[E]===void 0||!yp(f[E],_[E])))return!1;return!0}(n,e);default:return Gn()}}function iR(n,e){return(n.values||[]).find(i=>yp(i,e))!==void 0}function U0(n,e){if(n===e)return 0;const i=Fg(n),a=Fg(e);if(i!==a)return Lr(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return Lr(n.booleanValue,e.booleanValue);case 2:return function(u,f){const _=Ms(u.integerValue||u.doubleValue),E=Ms(f.integerValue||f.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return MJ(n.timestampValue,e.timestampValue);case 4:return MJ(nR(n),nR(e));case 5:return Lr(n.stringValue,e.stringValue);case 6:return function(u,f){const _=jg(u),E=jg(f);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(u,f){const _=u.split("/"),E=f.split("/");for(let S=0;S<_.length&&S<E.length;S++){const w=Lr(_[S],E[S]);if(w!==0)return w}return Lr(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,f){const _=Lr(Ms(u.latitude),Ms(f.latitude));return _!==0?_:Lr(Ms(u.longitude),Ms(f.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return UJ(n.arrayValue,e.arrayValue);case 10:return function(u,f){var _,E,S,w;const I=u.fields||{},k=f.fields||{},U=(_=I[yk])===null||_===void 0?void 0:_.arrayValue,L=(E=k[yk])===null||E===void 0?void 0:E.arrayValue,F=Lr(((S=U==null?void 0:U.values)===null||S===void 0?void 0:S.length)||0,((w=L==null?void 0:L.values)===null||w===void 0?void 0:w.length)||0);return F!==0?F:UJ(U,L)}(n.mapValue,e.mapValue);case 11:return function(u,f){if(u===eO.mapValue&&f===eO.mapValue)return 0;if(u===eO.mapValue)return 1;if(f===eO.mapValue)return-1;const _=u.fields||{},E=Object.keys(_),S=f.fields||{},w=Object.keys(S);E.sort(),w.sort();for(let I=0;I<E.length&&I<w.length;++I){const k=Lr(E[I],w[I]);if(k!==0)return k;const U=U0(_[E[I]],S[w[I]]);if(U!==0)return U}return Lr(E.length,w.length)}(n.mapValue,e.mapValue);default:throw Gn()}}function MJ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Lr(n,e);const i=Vg(n),a=Vg(e),l=Lr(i.seconds,a.seconds);return l!==0?l:Lr(i.nanos,a.nanos)}function UJ(n,e){const i=n.values||[],a=e.values||[];for(let l=0;l<i.length&&l<a.length;++l){const u=U0(i[l],a[l]);if(u)return u}return Lr(i.length,a.length)}function V0(n){return yj(n)}function yj(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=Vg(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return jg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Tn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const u of i.values||[])l?l=!1:a+=",",a+=yj(u);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const f of a)u?u=!1:l+=",",l+=`${f}:${yj(i.fields[f])}`;return l+"}"}(n.mapValue):Gn()}function VO(n){switch(Fg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=SN(n);return e?16+VO(e):16;case 5:return 2*n.stringValue.length;case 6:return jg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,u)=>l+VO(u),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Yg(a.fields,(u,f)=>{l+=u.length+VO(f)}),l}(n.mapValue);default:throw Gn()}}function VJ(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ej(n){return!!n&&"integerValue"in n}function V5(n){return!!n&&"arrayValue"in n}function jJ(n){return!!n&&"nullValue"in n}function FJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function jO(n){return!!n&&"mapValue"in n}function I4e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Cse])===null||i===void 0?void 0:i.stringValue)===Rse}function SC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Yg(n.mapValue.fields,(i,a)=>e.mapValue.fields[i]=SC(a)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=SC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function A4e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===R4e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e){this.value=e}static empty(){return new Zc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let a=0;a<e.length-1;++a)if(i=(i.mapValue.fields||{})[e.get(a)],!jO(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=SC(i)}setAll(e){let i=aa.emptyPath(),a={},l=[];e.forEach((f,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,a,l),a={},l=[],i=_.popLast()}f?a[_.lastSegment()]=SC(f):l.push(_.lastSegment())});const u=this.getFieldsMap(i);this.applyChanges(u,a,l)}delete(e){const i=this.field(e.popLast());jO(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return yp(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<e.length;++a){let l=i.mapValue.fields[e.get(a)];jO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,a){Yg(i,(l,u)=>e[l]=u);for(const l of a)delete e[l]}clone(){return new Zc(SC(this.value))}}function Ise(n){const e=[];return Yg(n.fields,(i,a)=>{const l=new aa([i]);if(jO(a)){const u=Ise(a.mapValue).fields;if(u.length===0)e.push(l);else for(const f of u)e.push(l.child(f))}else e.push(l)}),new Ul(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,i,a,l,u,f,_){this.key=e,this.documentType=i,this.version=a,this.readTime=l,this.createTime=u,this.data=f,this.documentState=_}static newInvalidDocument(e){return new Ma(e,0,Yn.min(),Yn.min(),Yn.min(),Zc.empty(),0)}static newFoundDocument(e,i,a,l){return new Ma(e,1,i,Yn.min(),a,l,0)}static newNoDocument(e,i){return new Ma(e,2,i,Yn.min(),Yn.min(),Zc.empty(),0)}static newUnknownDocument(e,i){return new Ma(e,3,i,Yn.min(),Yn.min(),Zc.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Yn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Zc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Zc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Yn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ma&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ma(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ek{constructor(e,i){this.position=e,this.inclusive=i}}function BJ(n,e,i){let a=0;for(let l=0;l<n.position.length;l++){const u=e[l],f=n.position[l];if(u.field.isKeyField()?a=Tn.comparator(Tn.fromName(f.referenceValue),i.key):a=U0(f,i.data.field(u.field)),u.dir==="desc"&&(a*=-1),a!==0)break}return a}function WJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!yp(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk{constructor(e,i="asc"){this.field=e,this.dir=i}}function P4e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ase{}class Js extends Ase{constructor(e,i,a){super(),this.field=e,this.op=i,this.value=a}static create(e,i,a){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,a):new k4e(e,i,a):i==="array-contains"?new x4e(e,a):i==="in"?new L4e(e,a):i==="not-in"?new M4e(e,a):i==="array-contains-any"?new U4e(e,a):new Js(e,i,a)}static createKeyFieldInFilter(e,i,a){return i==="in"?new N4e(e,a):new D4e(e,a)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(U0(i,this.value)):i!==null&&Fg(this.value)===Fg(i)&&this.matchesComparison(U0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Gn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Xd extends Ase{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Xd(e,i)}matches(e){return Pse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Pse(n){return n.op==="and"}function Ose(n){return O4e(n)&&Pse(n)}function O4e(n){for(const e of n.filters)if(e instanceof Xd)return!1;return!0}function vj(n){if(n instanceof Js)return n.field.canonicalString()+n.op.toString()+V0(n.value);if(Ose(n))return n.filters.map(e=>vj(e)).join(",");{const e=n.filters.map(i=>vj(i)).join(",");return`${n.op}(${e})`}}function kse(n,e){return n instanceof Js?function(a,l){return l instanceof Js&&a.op===l.op&&a.field.isEqual(l.field)&&yp(a.value,l.value)}(n,e):n instanceof Xd?function(a,l){return l instanceof Xd&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((u,f,_)=>u&&kse(f,l.filters[_]),!0):!1}(n,e):void Gn()}function Nse(n){return n instanceof Js?function(i){return`${i.field.canonicalString()} ${i.op} ${V0(i.value)}`}(n):n instanceof Xd?function(i){return i.op.toString()+" {"+i.getFilters().map(Nse).join(" ,")+"}"}(n):"Filter"}class k4e extends Js{constructor(e,i,a){super(e,i,a),this.key=Tn.fromName(a.referenceValue)}matches(e){const i=Tn.comparator(e.key,this.key);return this.matchesComparison(i)}}class N4e extends Js{constructor(e,i){super(e,"in",i),this.keys=Dse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class D4e extends Js{constructor(e,i){super(e,"not-in",i),this.keys=Dse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function Dse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>Tn.fromName(a.referenceValue))}class x4e extends Js{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return V5(i)&&iR(i.arrayValue,this.value)}}class L4e extends Js{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&iR(this.value.arrayValue,i)}}class M4e extends Js{constructor(e,i){super(e,"not-in",i)}matches(e){if(iR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!iR(this.value.arrayValue,i)}}class U4e extends Js{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!V5(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>iR(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4e{constructor(e,i=null,a=[],l=[],u=null,f=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=u,this.startAt=f,this.endAt=_,this.le=null}}function zJ(n,e=null,i=[],a=[],l=null,u=null,f=null){return new V4e(n,e,i,a,l,u,f)}function j5(n){const e=Zn(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(a=>vj(a)).join(","),i+="|ob:",i+=e.orderBy.map(a=>function(u){return u.field.canonicalString()+u.dir}(a)).join(","),vN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(a=>V0(a)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(a=>V0(a)).join(",")),e.le=i}return e.le}function F5(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!P4e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!kse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!WJ(n.startAt,e.startAt)&&WJ(n.endAt,e.endAt)}function Sj(n){return Tn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(e,i=null,a=[],l=[],u=null,f="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=u,this.limitType=f,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function j4e(n,e,i,a,l,u,f,_){return new xR(n,e,i,a,l,u,f,_)}function bN(n){return new xR(n)}function GJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function xse(n){return n.collectionGroup!==null}function bC(n){const e=Zn(n);if(e.he===null){e.he=[];const i=new Set;for(const u of e.explicitOrderBy)e.he.push(u),i.add(u.field.canonicalString());const a=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let _=new mo(aa.comparator);return f.filters.forEach(E=>{E.getFlattenedFilters().forEach(S=>{S.isInequality()&&(_=_.add(S.field))})}),_})(e).forEach(u=>{i.has(u.canonicalString())||u.isKeyField()||e.he.push(new vk(u,a))}),i.has(aa.keyField().canonicalString())||e.he.push(new vk(aa.keyField(),a))}return e.he}function fp(n){const e=Zn(n);return e.Pe||(e.Pe=F4e(e,bC(n))),e.Pe}function F4e(n,e){if(n.limitType==="F")return zJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new vk(l.field,u)});const i=n.endAt?new Ek(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new Ek(n.startAt.position,n.startAt.inclusive):null;return zJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,a)}}function bj(n,e){const i=n.filters.concat([e]);return new xR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function Sk(n,e,i){return new xR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function TN(n,e){return F5(fp(n),fp(e))&&n.limitType===e.limitType}function Lse(n){return`${j5(fp(n))}|lt:${n.limitType}`}function jS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>Nse(l)).join(", ")}]`),vN(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>V0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>V0(l)).join(",")),`Target(${a})`}(fp(n))}; limitType=${n.limitType})`}function wN(n,e){return e.isFoundDocument()&&function(a,l){const u=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(u):Tn.isDocumentKey(a.path)?a.path.isEqual(u):a.path.isImmediateParentOf(u)}(n,e)&&function(a,l){for(const u of bC(a))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(a,l){for(const u of a.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(a,l){return!(a.startAt&&!function(f,_,E){const S=BJ(f,_,E);return f.inclusive?S<=0:S<0}(a.startAt,bC(a),l)||a.endAt&&!function(f,_,E){const S=BJ(f,_,E);return f.inclusive?S>=0:S>0}(a.endAt,bC(a),l))}(n,e)}function B4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Mse(n){return(e,i)=>{let a=!1;for(const l of bC(n)){const u=W4e(l,e,i);if(u!==0)return u;a=a||l.field.isKeyField()}return 0}}function W4e(n,e,i){const a=n.field.isKeyField()?Tn.comparator(e.key,i.key):function(u,f,_){const E=f.data.field(u),S=_.data.field(u);return E!==null&&S!==null?U0(E,S):Gn()}(n.field,e,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return Gn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a!==void 0){for(const[l,u]of a)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const a=this.mapKeyFn(e),l=this.inner[a];if(l===void 0)return this.inner[a]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Yg(this.inner,(i,a)=>{for(const[l,u]of a)e(l,u)})}isEmpty(){return Ese(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z4e=new us(Tn.comparator);function Yf(){return z4e}const Use=new us(Tn.comparator);function iC(...n){let e=Use;for(const i of n)e=e.insert(i.key,i);return e}function Vse(n){let e=Use;return n.forEach((i,a)=>e=e.insert(i,a.overlayedDocument)),e}function Ny(){return TC()}function jse(){return TC()}function TC(){return new lE(n=>n.toString(),(n,e)=>n.isEqual(e))}const G4e=new us(Tn.comparator),H4e=new mo(Tn.comparator);function Pr(...n){let e=H4e;for(const i of n)e=e.add(i);return e}const $4e=new mo(Lr);function K4e(){return $4e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B5(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:gk(e)?"-0":e}}function Fse(n){return{integerValue:""+n}}function q4e(n,e){return S4e(e)?Fse(e):B5(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CN{constructor(){this._=void 0}}function Y4e(n,e,i){return n instanceof sR?function(l,u){const f={fields:{[bse]:{stringValue:Sse},[wse]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&U5(u)&&(u=SN(u)),u&&(f.fields[Tse]=u),{mapValue:f}}(i,e):n instanceof oR?Wse(n,e):n instanceof aR?zse(n,e):function(l,u){const f=Bse(l,u),_=HJ(f)+HJ(l.Ie);return Ej(f)&&Ej(l.Ie)?Fse(_):B5(l.serializer,_)}(n,e)}function X4e(n,e,i){return n instanceof oR?Wse(n,e):n instanceof aR?zse(n,e):i}function Bse(n,e){return n instanceof bk?function(a){return Ej(a)||function(u){return!!u&&"doubleValue"in u}(a)}(e)?e:{integerValue:0}:null}class sR extends CN{}class oR extends CN{constructor(e){super(),this.elements=e}}function Wse(n,e){const i=Gse(e);for(const a of n.elements)i.some(l=>yp(l,a))||i.push(a);return{arrayValue:{values:i}}}class aR extends CN{constructor(e){super(),this.elements=e}}function zse(n,e){let i=Gse(e);for(const a of n.elements)i=i.filter(l=>!yp(l,a));return{arrayValue:{values:i}}}class bk extends CN{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function HJ(n){return Ms(n.integerValue||n.doubleValue)}function Gse(n){return V5(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(e,i){this.field=e,this.transform=i}}function Q4e(n,e){return n.field.isEqual(e.field)&&function(a,l){return a instanceof oR&&l instanceof oR||a instanceof aR&&l instanceof aR?M0(a.elements,l.elements,yp):a instanceof bk&&l instanceof bk?yp(a.Ie,l.Ie):a instanceof sR&&l instanceof sR}(n.transform,e.transform)}class Z4e{constructor(e,i){this.version=e,this.transformResults=i}}class qd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new qd}static exists(e){return new qd(void 0,e)}static updateTime(e){return new qd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function FO(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class RN{}function Hse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Kse(n.key,qd.none()):new LR(n.key,n.data,qd.none());{const i=n.data,a=Zc.empty();let l=new mo(aa.comparator);for(let u of e.fields)if(!l.has(u)){let f=i.field(u);f===null&&u.length>1&&(u=u.popLast(),f=i.field(u)),f===null?a.delete(u):a.set(u,f),l=l.add(u)}return new Xg(n.key,a,new Ul(l.toArray()),qd.none())}}function eBe(n,e,i){n instanceof LR?function(l,u,f){const _=l.value.clone(),E=KJ(l.fieldTransforms,u,f.transformResults);_.setAll(E),u.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,e,i):n instanceof Xg?function(l,u,f){if(!FO(l.precondition,u))return void u.convertToUnknownDocument(f.version);const _=KJ(l.fieldTransforms,u,f.transformResults),E=u.data;E.setAll($se(l)),E.setAll(_),u.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,e,i):function(l,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,i)}function wC(n,e,i,a){return n instanceof LR?function(u,f,_,E){if(!FO(u.precondition,f))return _;const S=u.value.clone(),w=qJ(u.fieldTransforms,E,f);return S.setAll(w),f.convertToFoundDocument(f.version,S).setHasLocalMutations(),null}(n,e,i,a):n instanceof Xg?function(u,f,_,E){if(!FO(u.precondition,f))return _;const S=qJ(u.fieldTransforms,E,f),w=f.data;return w.setAll($se(u)),w.setAll(S),f.convertToFoundDocument(f.version,w).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(I=>I.field))}(n,e,i,a):function(u,f,_){return FO(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):_}(n,e,i)}function tBe(n,e){let i=null;for(const a of n.fieldTransforms){const l=e.data.field(a.field),u=Bse(a.transform,l||null);u!=null&&(i===null&&(i=Zc.empty()),i.set(a.field,u))}return i||null}function $J(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&M0(a,l,(u,f)=>Q4e(u,f))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class LR extends RN{constructor(e,i,a,l=[]){super(),this.key=e,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Xg extends RN{constructor(e,i,a,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function $se(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);e.set(i,a)}}),e}function KJ(n,e,i){const a=new Map;di(n.length===i.length);for(let l=0;l<i.length;l++){const u=n[l],f=u.transform,_=e.data.field(u.field);a.set(u.field,X4e(f,_,i[l]))}return a}function qJ(n,e,i){const a=new Map;for(const l of n){const u=l.transform,f=i.data.field(l.field);a.set(l.field,Y4e(u,f,e))}return a}class Kse extends RN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nBe extends RN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rBe{constructor(e,i,a,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(e,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&eBe(u,e,a[l])}}applyToLocalView(e,i){for(const a of this.baseMutations)a.key.isEqual(e.key)&&(i=wC(a,e,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(e.key)&&(i=wC(a,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const a=jse();return this.mutations.forEach(l=>{const u=e.get(l.key),f=u.overlayedDocument;let _=this.applyToLocalView(f,u.mutatedFields);_=i.has(l.key)?null:_;const E=Hse(f,_);E!==null&&a.set(l.key,E),f.isValidDocument()||f.convertToNoDocument(Yn.min())}),a}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Pr())}isEqual(e){return this.batchId===e.batchId&&M0(this.mutations,e.mutations,(i,a)=>$J(i,a))&&M0(this.baseMutations,e.baseMutations,(i,a)=>$J(i,a))}}class W5{constructor(e,i,a,l){this.batch=e,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(e,i,a){di(e.mutations.length===a.length);let l=function(){return G4e}();const u=e.mutations;for(let f=0;f<u.length;f++)l=l.insert(u[f].key,a[f].version);return new W5(e,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iBe{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sBe{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $s,Vr;function oBe(n){switch(n){case wt.OK:return Gn();case wt.CANCELLED:case wt.UNKNOWN:case wt.DEADLINE_EXCEEDED:case wt.RESOURCE_EXHAUSTED:case wt.INTERNAL:case wt.UNAVAILABLE:case wt.UNAUTHENTICATED:return!1;case wt.INVALID_ARGUMENT:case wt.NOT_FOUND:case wt.ALREADY_EXISTS:case wt.PERMISSION_DENIED:case wt.FAILED_PRECONDITION:case wt.ABORTED:case wt.OUT_OF_RANGE:case wt.UNIMPLEMENTED:case wt.DATA_LOSS:return!0;default:return Gn()}}function qse(n){if(n===void 0)return qf("GRPC error has no .code"),wt.UNKNOWN;switch(n){case $s.OK:return wt.OK;case $s.CANCELLED:return wt.CANCELLED;case $s.UNKNOWN:return wt.UNKNOWN;case $s.DEADLINE_EXCEEDED:return wt.DEADLINE_EXCEEDED;case $s.RESOURCE_EXHAUSTED:return wt.RESOURCE_EXHAUSTED;case $s.INTERNAL:return wt.INTERNAL;case $s.UNAVAILABLE:return wt.UNAVAILABLE;case $s.UNAUTHENTICATED:return wt.UNAUTHENTICATED;case $s.INVALID_ARGUMENT:return wt.INVALID_ARGUMENT;case $s.NOT_FOUND:return wt.NOT_FOUND;case $s.ALREADY_EXISTS:return wt.ALREADY_EXISTS;case $s.PERMISSION_DENIED:return wt.PERMISSION_DENIED;case $s.FAILED_PRECONDITION:return wt.FAILED_PRECONDITION;case $s.ABORTED:return wt.ABORTED;case $s.OUT_OF_RANGE:return wt.OUT_OF_RANGE;case $s.UNIMPLEMENTED:return wt.UNIMPLEMENTED;case $s.DATA_LOSS:return wt.DATA_LOSS;default:return Gn()}}(Vr=$s||($s={}))[Vr.OK=0]="OK",Vr[Vr.CANCELLED=1]="CANCELLED",Vr[Vr.UNKNOWN=2]="UNKNOWN",Vr[Vr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vr[Vr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vr[Vr.NOT_FOUND=5]="NOT_FOUND",Vr[Vr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vr[Vr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vr[Vr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vr[Vr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vr[Vr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vr[Vr.ABORTED=10]="ABORTED",Vr[Vr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vr[Vr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vr[Vr.INTERNAL=13]="INTERNAL",Vr[Vr.UNAVAILABLE=14]="UNAVAILABLE",Vr[Vr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aBe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cBe=new Pg([4294967295,4294967295],0);function YJ(n){const e=aBe().encode(n),i=new use;return i.update(e),new Uint8Array(i.digest())}function XJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),a=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Pg([i,a],0),new Pg([l,u],0)]}class z5{constructor(e,i,a){if(this.bitmap=e,this.padding=i,this.hashCount=a,i<0||i>=8)throw new sC(`Invalid padding: ${i}`);if(a<0)throw new sC(`Invalid hash count: ${a}`);if(e.length>0&&this.hashCount===0)throw new sC(`Invalid hash count: ${a}`);if(e.length===0&&i!==0)throw new sC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Pg.fromNumber(this.Ee)}Ae(e,i,a){let l=e.add(i.multiply(Pg.fromNumber(a)));return l.compare(cBe)===1&&(l=new Pg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=YJ(e),[a,l]=XJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(a,l,u);if(!this.Re(f))return!1}return!0}static create(e,i,a){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),f=new z5(u,l,i);return a.forEach(_=>f.insert(_)),f}insert(e){if(this.Ee===0)return;const i=YJ(e),[a,l]=XJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(a,l,u);this.Ve(f)}}Ve(e){const i=Math.floor(e/8),a=e%8;this.bitmap[i]|=1<<a}}class sC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{constructor(e,i,a,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,a){const l=new Map;return l.set(e,MR.createSynthesizedTargetChangeForCurrentChange(e,i,a)),new IN(Yn.min(),l,new us(Lr),Yf(),Pr())}}class MR{constructor(e,i,a,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,a){return new MR(a,i,Pr(),Pr(),Pr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BO{constructor(e,i,a,l){this.me=e,this.removedTargetIds=i,this.key=a,this.fe=l}}class Yse{constructor(e,i){this.targetId=e,this.ge=i}}class Xse{constructor(e,i,a=ca.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=a,this.cause=l}}class JJ{constructor(){this.pe=0,this.ye=QJ(),this.we=ca.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=Pr(),i=Pr(),a=Pr();return this.ye.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:Gn()}}),new MR(this.we,this.be,e,i,a)}Me(){this.Se=!1,this.ye=QJ()}xe(e,i){this.Se=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,di(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class lBe{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Yf(),this.$e=tO(),this.Ke=tO(),this.Ue=new us(Lr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const a=this.He(i);switch(e.state){case 0:this.Je(i)&&a.Ce(e.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(e.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(e.resumeToken));break;default:Gn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,a=e.ge.count,l=this.Xe(i);if(l){const u=l.target;if(Sj(u))if(a===0){const f=new Tn(u.path);this.ze(i,f,Ma.newNoDocument(f,Yn.min()))}else di(a===1);else{const f=this.et(i);if(f!==a){const _=this.tt(e),E=_?this.nt(_,e,f):1;if(E!==0){this.Ye(i);const S=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,S)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:u=0}=i;let f,_;try{f=jg(a).toUint8Array()}catch(E){if(E instanceof vse)return L0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new z5(f,l,u)}catch(E){return L0(E instanceof sC?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,a){return i.ge.count===a-this.st(e,i.targetId)?0:2}st(e,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(u=>{const f=this.ke.it(),_=`projects/${f.projectId}/databases/${f.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,u,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((u,f)=>{const _=this.Xe(f);if(_){if(u.current&&Sj(_.target)){const E=new Tn(_.target.path);this._t(E).has(f)||this.ut(f,E)||this.ze(f,E,Ma.newNoDocument(E,e))}u.ve&&(i.set(f,u.Fe()),u.Me())}});let a=Pr();this.Ke.forEach((u,f)=>{let _=!0;f.forEachWhile(E=>{const S=this.Xe(E);return!S||S.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(a=a.add(u))}),this.Qe.forEach((u,f)=>f.setReadTime(e));const l=new IN(e,i,this.Ue,this.Qe,a);return this.Qe=Yf(),this.$e=tO(),this.Ke=tO(),this.Ue=new us(Lr),l}Ge(e,i){if(!this.Je(e))return;const a=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ke=this.Ke.insert(i.key,this.ct(i.key).add(e))}ze(e,i,a){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ke=this.Ke.insert(i,this.ct(i).delete(e)),this.Ke=this.Ke.insert(i,this.ct(i).add(e)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new JJ,this.qe.set(e,i)),i}ct(e){let i=this.Ke.get(e);return i||(i=new mo(Lr),this.Ke=this.Ke.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new mo(Lr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||en("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new JJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function tO(){return new us(Tn.comparator)}function QJ(){return new us(Tn.comparator)}const uBe={asc:"ASCENDING",desc:"DESCENDING"},dBe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hBe={and:"AND",or:"OR"};class pBe{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function Tj(n,e){return n.useProto3Json||vN(e)?e:{value:e}}function Tk(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Jse(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function fBe(n,e){return Tk(n,e.toTimestamp())}function mp(n){return di(!!n),Yn.fromTimestamp(function(i){const a=Vg(i);return new fo(a.seconds,a.nanos)}(n))}function G5(n,e){return wj(n,e).canonicalString()}function wj(n,e){const i=function(l){return new $i(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Qse(n){const e=$i.fromString(n);return di(roe(e)),e}function Cj(n,e){return G5(n.databaseId,e.path)}function UU(n,e){const i=Qse(e);if(i.get(1)!==n.databaseId.projectId)throw new on(wt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new on(wt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Tn(eoe(i))}function Zse(n,e){return G5(n.databaseId,e)}function mBe(n){const e=Qse(n);return e.length===4?$i.emptyPath():eoe(e)}function Rj(n){return new $i(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function eoe(n){return di(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function ZJ(n,e,i){return{name:Cj(n,e),fields:i.value.mapValue.fields}}function gBe(n,e){let i;if("targetChange"in e){e.targetChange;const a=function(S){return S==="NO_CHANGE"?0:S==="ADD"?1:S==="REMOVE"?2:S==="CURRENT"?3:S==="RESET"?4:Gn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(S,w){return S.useProto3Json?(di(w===void 0||typeof w=="string"),ca.fromBase64String(w||"")):(di(w===void 0||w instanceof Buffer||w instanceof Uint8Array),ca.fromUint8Array(w||new Uint8Array))}(n,e.targetChange.resumeToken),f=e.targetChange.cause,_=f&&function(S){const w=S.code===void 0?wt.UNKNOWN:qse(S.code);return new on(w,S.message||"")}(f);i=new Xse(a,l,u,_||null)}else if("documentChange"in e){e.documentChange;const a=e.documentChange;a.document,a.document.name,a.document.updateTime;const l=UU(n,a.document.name),u=mp(a.document.updateTime),f=a.document.createTime?mp(a.document.createTime):Yn.min(),_=new Zc({mapValue:{fields:a.document.fields}}),E=Ma.newFoundDocument(l,u,f,_),S=a.targetIds||[],w=a.removedTargetIds||[];i=new BO(S,w,E.key,E)}else if("documentDelete"in e){e.documentDelete;const a=e.documentDelete;a.document;const l=UU(n,a.document),u=a.readTime?mp(a.readTime):Yn.min(),f=Ma.newNoDocument(l,u),_=a.removedTargetIds||[];i=new BO([],_,f.key,f)}else if("documentRemove"in e){e.documentRemove;const a=e.documentRemove;a.document;const l=UU(n,a.document),u=a.removedTargetIds||[];i=new BO([],u,l,null)}else{if(!("filter"in e))return Gn();{e.filter;const a=e.filter;a.targetId;const{count:l=0,unchangedNames:u}=a,f=new sBe(l,u),_=a.targetId;i=new Yse(_,f)}}return i}function _Be(n,e){let i;if(e instanceof LR)i={update:ZJ(n,e.key,e.value)};else if(e instanceof Kse)i={delete:Cj(n,e.key)};else if(e instanceof Xg)i={update:ZJ(n,e.key,e.data),updateMask:RBe(e.fieldMask)};else{if(!(e instanceof nBe))return Gn();i={verify:Cj(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(a=>function(u,f){const _=f.transform;if(_ instanceof sR)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof oR)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof aR)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof bk)return{fieldPath:f.field.canonicalString(),increment:_.Ie};throw Gn()}(0,a))),e.precondition.isNone||(i.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:fBe(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Gn()}(n,e.precondition)),i}function yBe(n,e){return n&&n.length>0?(di(e!==void 0),n.map(i=>function(l,u){let f=l.updateTime?mp(l.updateTime):mp(u);return f.isEqual(Yn.min())&&(f=mp(u)),new Z4e(f,l.transformResults||[])}(i,e))):[]}function EBe(n,e){return{documents:[Zse(n,e.path)]}}function vBe(n,e){const i={structuredQuery:{}},a=e.path;let l;e.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=Zse(n,l);const u=function(S){if(S.length!==0)return noe(Xd.create(S,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const f=function(S){if(S.length!==0)return S.map(w=>function(k){return{field:FS(k.field),direction:TBe(k.dir)}}(w))}(e.orderBy);f&&(i.structuredQuery.orderBy=f);const _=Tj(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(S){return{before:S.inclusive,values:S.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(S){return{before:!S.inclusive,values:S.position}}(e.endAt)),{ht:i,parent:l}}function SBe(n){let e=mBe(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){di(a===1);const w=i.from[0];w.allDescendants?l=w.collectionId:e=e.child(w.collectionId)}let u=[];i.where&&(u=function(I){const k=toe(I);return k instanceof Xd&&Ose(k)?k.getFilters():[k]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(k=>function(L){return new vk(BS(L.field),function(B){switch(B){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(k))}(i.orderBy));let _=null;i.limit&&(_=function(I){let k;return k=typeof I=="object"?I.value:I,vN(k)?null:k}(i.limit));let E=null;i.startAt&&(E=function(I){const k=!!I.before,U=I.values||[];return new Ek(U,k)}(i.startAt));let S=null;return i.endAt&&(S=function(I){const k=!I.before,U=I.values||[];return new Ek(U,k)}(i.endAt)),j4e(e,l,f,u,_,"F",E,S)}function bBe(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Gn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function toe(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=BS(i.unaryFilter.field);return Js.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=BS(i.unaryFilter.field);return Js.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=BS(i.unaryFilter.field);return Js.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=BS(i.unaryFilter.field);return Js.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Gn()}}(n):n.fieldFilter!==void 0?function(i){return Js.create(BS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Gn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Xd.create(i.compositeFilter.filters.map(a=>toe(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Gn()}}(i.compositeFilter.op))}(n):Gn()}function TBe(n){return uBe[n]}function wBe(n){return dBe[n]}function CBe(n){return hBe[n]}function FS(n){return{fieldPath:n.canonicalString()}}function BS(n){return aa.fromServerFormat(n.fieldPath)}function noe(n){return n instanceof Js?function(i){if(i.op==="=="){if(FJ(i.value))return{unaryFilter:{field:FS(i.field),op:"IS_NAN"}};if(jJ(i.value))return{unaryFilter:{field:FS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(FJ(i.value))return{unaryFilter:{field:FS(i.field),op:"IS_NOT_NAN"}};if(jJ(i.value))return{unaryFilter:{field:FS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:FS(i.field),op:wBe(i.op),value:i.value}}}(n):n instanceof Xd?function(i){const a=i.getFilters().map(l=>noe(l));return a.length===1?a[0]:{compositeFilter:{op:CBe(i.op),filters:a}}}(n):Gn()}function RBe(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function roe(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(e,i,a,l,u=Yn.min(),f=Yn.min(),_=ca.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new wg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new wg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IBe{constructor(e){this.Tt=e}}function ABe(n){const e=SBe({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Sk(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PBe{constructor(){this.Tn=new OBe}addToCollectionParentIndex(e,i){return this.Tn.add(i),Tt.resolve()}getCollectionParents(e,i){return Tt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Tt.resolve()}deleteFieldIndex(e,i){return Tt.resolve()}deleteAllFieldIndexes(e){return Tt.resolve()}createTargetIndexes(e,i){return Tt.resolve()}getDocumentsMatchingTarget(e,i){return Tt.resolve(null)}getIndexType(e,i){return Tt.resolve(0)}getFieldIndexes(e,i){return Tt.resolve([])}getNextCollectionGroupToUpdate(e){return Tt.resolve(null)}getMinOffset(e,i){return Tt.resolve(Ug.min())}getMinOffsetFromCollectionGroup(e,i){return Tt.resolve(Ug.min())}updateCollectionGroup(e,i,a){return Tt.resolve()}updateIndexEntries(e,i){return Tt.resolve()}}class OBe{constructor(){this.index={}}add(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i]||new mo($i.comparator),u=!l.has(a);return this.index[i]=l.add(a),u}has(e){const i=e.lastSegment(),a=e.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(e){return(this.index[e]||new mo($i.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ioe=41943040;class Jc{static withCacheSize(e){return new Jc(e,Jc.DEFAULT_COLLECTION_PERCENTILE,Jc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,a){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Jc.DEFAULT_COLLECTION_PERCENTILE=10,Jc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Jc.DEFAULT=new Jc(ioe,Jc.DEFAULT_COLLECTION_PERCENTILE,Jc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Jc.DISABLED=new Jc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new j0(0)}static Un(){return new j0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tQ="LruGarbageCollector",kBe=1048576;function nQ([n,e],[i,a]){const l=Lr(n,i);return l===0?Lr(e,a):l}class NBe{constructor(e){this.Hn=e,this.buffer=new mo(nQ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();nQ(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class DBe{constructor(e,i,a){this.garbageCollector=e,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){en(tQ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){nb(i)?en(tQ,"Ignoring IndexedDB error during garbage collection: ",i):await tb(i)}await this.er(3e5)})}}class xBe{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(a=>Math.floor(i/100*a))}nthSequenceNumber(e,i){if(i===0)return Tt.resolve(EN.ae);const a=new NBe(i);return this.tr.forEachTarget(e,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(e,i,a){return this.tr.removeTargets(e,i,a)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(en("LruGarbageCollector","Garbage collection skipped; disabled"),Tt.resolve(eQ)):this.getCacheSize(e).next(a=>a<this.params.cacheSizeCollectionThreshold?(en("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),eQ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let a,l,u,f,_,E,S;const w=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(en("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(a=I,_=Date.now(),this.removeTargets(e,a,i))).next(I=>(u=I,E=Date.now(),this.removeOrphanedDocuments(e,a))).next(I=>(S=Date.now(),VS()<=Ir.DEBUG&&en("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-w}ms
	Determined least recently used ${l} in `+(_-f)+`ms
	Removed ${u} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(S-E)+`ms
Total Duration: ${S-w}ms`),Tt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:I})))}}function LBe(n,e){return new xBe(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MBe{constructor(){this.changes=new lE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Ma.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?Tt.resolve(a):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UBe{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VBe{constructor(e,i,a,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(e,i){let a=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(a!==null&&wC(a.mutation,l,Ul.empty(),fo.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.getLocalViewOfDocuments(e,a,Pr()).next(()=>a))}getLocalViewOfDocuments(e,i,a=Pr()){const l=Ny();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,a).next(u=>{let f=iC();return u.forEach((_,E)=>{f=f.insert(_,E.overlayedDocument)}),f}))}getOverlayedDocuments(e,i){const a=Ny();return this.populateOverlays(e,a,i).next(()=>this.computeViews(e,i,a,Pr()))}populateOverlays(e,i,a){const l=[];return a.forEach(u=>{i.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((f,_)=>{i.set(f,_)})})}computeViews(e,i,a,l){let u=Yf();const f=TC(),_=function(){return TC()}();return i.forEach((E,S)=>{const w=a.get(S.key);l.has(S.key)&&(w===void 0||w.mutation instanceof Xg)?u=u.insert(S.key,S):w!==void 0?(f.set(S.key,w.mutation.getFieldMask()),wC(w.mutation,S,w.mutation.getFieldMask(),fo.now())):f.set(S.key,Ul.empty())}),this.recalculateAndSaveOverlays(e,u).next(E=>(E.forEach((S,w)=>f.set(S,w)),i.forEach((S,w)=>{var I;return _.set(S,new UBe(w,(I=f.get(S))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const a=TC();let l=new us((f,_)=>f-_),u=Pr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(f=>{for(const _ of f)_.keys().forEach(E=>{const S=i.get(E);if(S===null)return;let w=a.get(E)||Ul.empty();w=_.applyToLocalView(S,w),a.set(E,w);const I=(l.get(_.batchId)||Pr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const f=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),S=E.key,w=E.value,I=jse();w.forEach(k=>{if(!u.has(k)){const U=Hse(i.get(k),a.get(k));U!==null&&I.set(k,U),u=u.add(k)}}),f.push(this.documentOverlayCache.saveOverlays(e,S,I))}return Tt.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(a=>this.recalculateAndSaveOverlays(e,a))}getDocumentsMatchingQuery(e,i,a,l){return function(f){return Tn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):xse(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,a,l):this.getDocumentsMatchingCollectionQuery(e,i,a,l)}getNextDocuments(e,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,a,l).next(u=>{const f=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,a.largestBatchId,l-u.size):Tt.resolve(Ny());let _=tR,E=u;return f.next(S=>Tt.forEach(S,(w,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),u.get(w)?Tt.resolve():this.remoteDocumentCache.getEntry(e,w).next(k=>{E=E.insert(w,k)}))).next(()=>this.populateOverlays(e,S,u)).next(()=>this.computeViews(e,E,S,Pr())).next(w=>({batchId:_,changes:Vse(w)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Tn(i)).next(a=>{let l=iC();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,a,l){const u=i.collectionGroup;let f=iC();return this.indexManager.getCollectionParents(e,u).next(_=>Tt.forEach(_,E=>{const S=function(I,k){return new xR(k,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(u));return this.getDocumentsMatchingCollectionQuery(e,S,a,l).next(w=>{w.forEach((I,k)=>{f=f.insert(I,k)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,i,a,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,a.largestBatchId).next(f=>(u=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,a,u,l))).next(f=>{u.forEach((E,S)=>{const w=S.getKey();f.get(w)===null&&(f=f.insert(w,Ma.newInvalidDocument(w)))});let _=iC();return f.forEach((E,S)=>{const w=u.get(E);w!==void 0&&wC(w.mutation,S,Ul.empty(),fo.now()),wN(i,S)&&(_=_.insert(E,S))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jBe{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Tt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:mp(l.createTime)}}(i)),Tt.resolve()}getNamedQuery(e,i){return Tt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:ABe(l.bundledQuery),readTime:mp(l.readTime)}}(i)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FBe{constructor(){this.overlays=new us(Tn.comparator),this.Rr=new Map}getOverlay(e,i){return Tt.resolve(this.overlays.get(i))}getOverlays(e,i){const a=Ny();return Tt.forEach(i,l=>this.getOverlay(e,l).next(u=>{u!==null&&a.set(l,u)})).next(()=>a)}saveOverlays(e,i,a){return a.forEach((l,u)=>{this.Et(e,i,u)}),Tt.resolve()}removeOverlaysForBatchId(e,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Rr.delete(a)),Tt.resolve()}getOverlaysForCollection(e,i,a){const l=Ny(),u=i.length+1,f=new Tn(i.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const E=_.getNext().value,S=E.getKey();if(!i.isPrefixOf(S.path))break;S.path.length===u&&E.largestBatchId>a&&l.set(E.getKey(),E)}return Tt.resolve(l)}getOverlaysForCollectionGroup(e,i,a,l){let u=new us((S,w)=>S-w);const f=this.overlays.getIterator();for(;f.hasNext();){const S=f.getNext().value;if(S.getKey().getCollectionGroup()===i&&S.largestBatchId>a){let w=u.get(S.largestBatchId);w===null&&(w=Ny(),u=u.insert(S.largestBatchId,w)),w.set(S.getKey(),S)}}const _=Ny(),E=u.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((S,w)=>_.set(S,w)),!(_.size()>=l)););return Tt.resolve(_)}Et(e,i,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new iBe(i,a));let u=this.Rr.get(i);u===void 0&&(u=Pr(),this.Rr.set(i,u)),this.Rr.set(i,u.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BBe{constructor(){this.sessionToken=ca.EMPTY_BYTE_STRING}getSessionToken(e){return Tt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H5{constructor(){this.Vr=new mo(No.mr),this.gr=new mo(No.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const a=new No(e,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(e,i){e.forEach(a=>this.addReference(a,i))}removeReference(e,i){this.wr(new No(e,i))}br(e,i){e.forEach(a=>this.removeReference(a,i))}Sr(e){const i=new Tn(new $i([])),a=new No(i,e),l=new No(i,e+1),u=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),u.push(f.key)}),u}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Tn(new $i([])),a=new No(i,e),l=new No(i,e+1);let u=Pr();return this.gr.forEachInRange([a,l],f=>{u=u.add(f.key)}),u}containsKey(e){const i=new No(e,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&e.isEqual(a.key)}}class No{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Tn.comparator(e.key,i.key)||Lr(e.Cr,i.Cr)}static pr(e,i){return Lr(e.Cr,i.Cr)||Tn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WBe{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new mo(No.mr)}checkEmpty(e){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,a,l){const u=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new rBe(u,i,a,l);this.mutationQueue.push(f);for(const _ of l)this.Mr=this.Mr.add(new No(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Tt.resolve(f)}lookupMutationBatch(e,i){return Tt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const a=i+1,l=this.Nr(a),u=l<0?0:l;return Tt.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?M5:this.Fr-1)}getAllMutationBatches(e){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const a=new No(i,0),l=new No(i,Number.POSITIVE_INFINITY),u=[];return this.Mr.forEachInRange([a,l],f=>{const _=this.Or(f.Cr);u.push(_)}),Tt.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let a=new mo(Lr);return i.forEach(l=>{const u=new No(l,0),f=new No(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([u,f],_=>{a=a.add(_.Cr)})}),Tt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(e,i){const a=i.path,l=a.length+1;let u=a;Tn.isDocumentKey(u)||(u=u.child(""));const f=new No(new Tn(u),0);let _=new mo(Lr);return this.Mr.forEachWhile(E=>{const S=E.key.path;return!!a.isPrefixOf(S)&&(S.length===l&&(_=_.add(E.Cr)),!0)},f),Tt.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){di(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Tt.forEach(i.mutations,l=>{const u=new No(l.key,i.batchId);return a=a.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=a})}qn(e){}containsKey(e,i){const a=new No(i,0),l=this.Mr.firstAfterOrEqual(a);return Tt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Tt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zBe{constructor(e){this.kr=e,this.docs=function(){return new us(Tn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const a=i.key,l=this.docs.get(a),u=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:f}),this.size+=f-u,this.indexManager.addToCollectionParentIndex(e,a.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const a=this.docs.get(i);return Tt.resolve(a?a.document.mutableCopy():Ma.newInvalidDocument(i))}getEntries(e,i){let a=Yf();return i.forEach(l=>{const u=this.docs.get(l);a=a.insert(l,u?u.document.mutableCopy():Ma.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(e,i,a,l){let u=Yf();const f=i.path,_=new Tn(f.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:S,value:{document:w}}=E.getNext();if(!f.isPrefixOf(S.path))break;S.path.length>f.length+1||_4e(g4e(w),a)<=0||(l.has(w.key)||wN(i,w))&&(u=u.insert(w.key,w.mutableCopy()))}return Tt.resolve(u)}getAllFromCollectionGroup(e,i,a,l){Gn()}qr(e,i){return Tt.forEach(this.docs,a=>i(a))}newChangeBuffer(e){return new GBe(this)}getSize(e){return Tt.resolve(this.size)}}class GBe extends MBe{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(a)}),Tt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HBe{constructor(e){this.persistence=e,this.Qr=new lE(i=>j5(i),F5),this.lastRemoteSnapshotVersion=Yn.min(),this.highestTargetId=0,this.$r=0,this.Kr=new H5,this.targetCount=0,this.Ur=j0.Kn()}forEachTarget(e,i){return this.Qr.forEach((a,l)=>i(l)),Tt.resolve()}getLastRemoteSnapshotVersion(e){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Tt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),Tt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Ur=new j0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Tt.resolve()}updateTargetData(e,i){return this.zn(i),Tt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Kr.Sr(i.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(e,i,a){let l=0;const u=[];return this.Qr.forEach((f,_)=>{_.sequenceNumber<=i&&a.get(_.targetId)===null&&(this.Qr.delete(f),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),Tt.waitFor(u).next(()=>l)}getTargetCount(e){return Tt.resolve(this.targetCount)}getTargetData(e,i){const a=this.Qr.get(i)||null;return Tt.resolve(a)}addMatchingKeys(e,i,a){return this.Kr.yr(i,a),Tt.resolve()}removeMatchingKeys(e,i,a){this.Kr.br(i,a);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach(f=>{u.push(l.markPotentiallyOrphaned(e,f))}),Tt.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.Kr.Sr(i),Tt.resolve()}getMatchingKeysForTargetId(e,i){const a=this.Kr.vr(i);return Tt.resolve(a)}containsKey(e,i){return Tt.resolve(this.Kr.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class soe{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new EN(0),this.zr=!1,this.zr=!0,this.jr=new BBe,this.referenceDelegate=e(this),this.Hr=new HBe(this),this.indexManager=new PBe,this.remoteDocumentCache=function(l){return new zBe(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new IBe(i),this.Yr=new jBe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new FBe,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let a=this.Wr[e.toKey()];return a||(a=new WBe(i,this.referenceDelegate),this.Wr[e.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,a){en("MemoryPersistence","Starting transaction:",e);const l=new $Be(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(u=>this.referenceDelegate.Xr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}ei(e,i){return Tt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(e,i)))}}class $Be extends E4e{constructor(e){super(),this.currentSequenceNumber=e}}class $5{constructor(e){this.persistence=e,this.ti=new H5,this.ni=null}static ri(e){return new $5(e)}get ii(){if(this.ni)return this.ni;throw Gn()}addReference(e,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),Tt.resolve()}removeReference(e,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Tt.resolve()}removeTarget(e,i){this.ti.Sr(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(u=>this.ii.add(u.toString()))}).next(()=>a.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.ii,a=>{const l=Tn.fromPath(a);return this.si(e,l).next(u=>{u||i.removeEntry(l,Yn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Tt.or([()=>Tt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class wk{constructor(e,i){this.persistence=e,this.oi=new lE(a=>b4e(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=LBe(this,i)}static ri(e,i){return new wk(e,i)}Zr(){}Xr(e){return Tt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(a=>i.next(l=>a+l))}sr(e){let i=0;return this.rr(e,a=>{i++}).next(()=>i)}rr(e,i){return Tt.forEach(this.oi,(a,l)=>this.ar(e,a,l).next(u=>u?Tt.resolve():i(l)))}removeTargets(e,i,a){return this.persistence.getTargetCache().removeTargets(e,i,a)}removeOrphanedDocuments(e,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.qr(e,f=>this.ar(e,f,i).next(_=>{_||(a++,u.removeEntry(f,Yn.min()))})).next(()=>u.apply(e)).next(()=>a)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Tt.resolve()}removeTarget(e,i){const a=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,a)}addReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),Tt.resolve()}removeReference(e,i,a){return this.oi.set(a,e.currentSequenceNumber),Tt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Tt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=VO(e.data.value)),i}ar(e,i,a){return Tt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Tt.resolve(l!==void 0&&l>a)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K5{constructor(e,i,a,l){this.targetId=e,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(e,i){let a=Pr(),l=Pr();for(const u of i.docChanges)switch(u.type){case 0:a=a.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new K5(e,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KBe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qBe{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Aje()?8:v4e(Fa())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,a,l){const u={result:null};return this.rs(e,i).next(f=>{u.result=f}).next(()=>{if(!u.result)return this.ss(e,i,l,a).next(f=>{u.result=f})}).next(()=>{if(u.result)return;const f=new KBe;return this._s(e,i,f).next(_=>{if(u.result=_,this.Xi)return this.us(e,i,f,_.size)})}).next(()=>u.result)}us(e,i,a,l){return a.documentReadCount<this.es?(VS()<=Ir.DEBUG&&en("QueryEngine","SDK will not create cache indexes for query:",jS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Tt.resolve()):(VS()<=Ir.DEBUG&&en("QueryEngine","Query:",jS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(VS()<=Ir.DEBUG&&en("QueryEngine","The SDK decides to create cache indexes for query:",jS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,fp(i))):Tt.resolve())}rs(e,i){if(GJ(i))return Tt.resolve(null);let a=fp(i);return this.indexManager.getIndexType(e,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=Sk(i,null,"F"),a=fp(i)),this.indexManager.getDocumentsMatchingTarget(e,a).next(u=>{const f=Pr(...u);return this.ns.getDocuments(e,f).next(_=>this.indexManager.getMinOffset(e,a).next(E=>{const S=this.cs(i,_);return this.ls(i,S,f,E.readTime)?this.rs(e,Sk(i,null,"F")):this.hs(e,S,i,E)}))})))}ss(e,i,a,l){return GJ(i)||l.isEqual(Yn.min())?Tt.resolve(null):this.ns.getDocuments(e,a).next(u=>{const f=this.cs(i,u);return this.ls(i,f,a,l)?Tt.resolve(null):(VS()<=Ir.DEBUG&&en("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),jS(i)),this.hs(e,f,i,m4e(l,tR)).next(_=>_))})}cs(e,i){let a=new mo(Mse(e));return i.forEach((l,u)=>{wN(e,u)&&(a=a.add(u))}),a}ls(e,i,a,l){if(e.limit===null)return!1;if(a.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}_s(e,i,a){return VS()<=Ir.DEBUG&&en("QueryEngine","Using full collection scan to execute query:",jS(i)),this.ns.getDocumentsMatchingQuery(e,i,Ug.min(),a)}hs(e,i,a,l){return this.ns.getDocumentsMatchingQuery(e,a,l).next(u=>(i.forEach(f=>{u=u.insert(f.key,f)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q5="LocalStore",YBe=3e8;class XBe{constructor(e,i,a,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new us(Lr),this.Is=new lE(u=>j5(u),F5),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(a)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new VBe(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function JBe(n,e,i,a){return new XBe(n,e,i,a)}async function ooe(n,e){const i=Zn(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(u=>(l=u,i.As(e),i.mutationQueue.getAllMutationBatches(a))).next(u=>{const f=[],_=[];let E=Pr();for(const S of l){f.push(S.batchId);for(const w of S.mutations)E=E.add(w.key)}for(const S of u){_.push(S.batchId);for(const w of S.mutations)E=E.add(w.key)}return i.localDocuments.getDocuments(a,E).next(S=>({Rs:S,removedBatchIds:f,addedBatchIds:_}))})})}function QBe(n,e){const i=Zn(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=e.batch.keys(),u=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,S,w){const I=S.batch,k=I.keys();let U=Tt.resolve();return k.forEach(L=>{U=U.next(()=>w.getEntry(E,L)).next(F=>{const B=S.docVersions.get(L);di(B!==null),F.version.compareTo(B)<0&&(I.applyToRemoteDocument(F,S),F.isValidDocument()&&(F.setReadTime(S.commitVersion),w.addEntry(F)))})}),U.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,a,e,u).next(()=>u.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(_){let E=Pr();for(let S=0;S<_.mutationResults.length;++S)_.mutationResults[S].transformResults.length>0&&(E=E.add(_.batch.mutations[S].key));return E}(e))).next(()=>i.localDocuments.getDocuments(a,l))})}function aoe(n){const e=Zn(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function ZBe(n,e){const i=Zn(n),a=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((w,I)=>{const k=l.get(I);if(!k)return;_.push(i.Hr.removeMatchingKeys(u,w.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(u,w.addedDocuments,I)));let U=k.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(I)!==null?U=U.withResumeToken(ca.EMPTY_BYTE_STRING,Yn.min()).withLastLimboFreeSnapshotVersion(Yn.min()):w.resumeToken.approximateByteSize()>0&&(U=U.withResumeToken(w.resumeToken,a)),l=l.insert(I,U),function(F,B,q){return F.resumeToken.approximateByteSize()===0||B.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=YBe?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0}(k,U,w)&&_.push(i.Hr.updateTargetData(u,U))});let E=Yf(),S=Pr();if(e.documentUpdates.forEach(w=>{e.resolvedLimboDocuments.has(w)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(u,w))}),_.push(e6e(u,f,e.documentUpdates).next(w=>{E=w.Vs,S=w.fs})),!a.isEqual(Yn.min())){const w=i.Hr.getLastRemoteSnapshotVersion(u).next(I=>i.Hr.setTargetsMetadata(u,u.currentSequenceNumber,a));_.push(w)}return Tt.waitFor(_).next(()=>f.apply(u)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,E,S)).next(()=>E)}).then(u=>(i.Ts=l,u))}function e6e(n,e,i){let a=Pr(),l=Pr();return i.forEach(u=>a=a.add(u)),e.getEntries(n,a).next(u=>{let f=Yf();return i.forEach((_,E)=>{const S=u.get(_);E.isFoundDocument()!==S.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(Yn.min())?(e.removeEntry(_,E.readTime),f=f.insert(_,E)):!S.isValidDocument()||E.version.compareTo(S.version)>0||E.version.compareTo(S.version)===0&&S.hasPendingWrites?(e.addEntry(E),f=f.insert(_,E)):en(q5,"Ignoring outdated watch update for ",_,". Current version:",S.version," Watch version:",E.version)}),{Vs:f,fs:l}})}function t6e(n,e){const i=Zn(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(e===void 0&&(e=M5),i.mutationQueue.getNextMutationBatchAfterBatchId(a,e)))}function n6e(n,e){const i=Zn(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,e).next(u=>u?(l=u,Tt.resolve(l)):i.Hr.allocateTargetId(a).next(f=>(l=new wg(e,f,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(e,a.targetId)),a})}async function Ij(n,e,i){const a=Zn(n),l=a.Ts.get(e),u=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",u,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!nb(f))throw f;en(q5,`Failed to update sequence numbers for target ${e}: ${f}`)}a.Ts=a.Ts.remove(e),a.Is.delete(l.target)}function rQ(n,e,i){const a=Zn(n);let l=Yn.min(),u=Pr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(E,S,w){const I=Zn(E),k=I.Is.get(w);return k!==void 0?Tt.resolve(I.Ts.get(k)):I.Hr.getTargetData(S,w)}(a,f,fp(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,_.targetId).next(E=>{u=E})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,e,i?l:Yn.min(),i?u:Pr())).next(_=>(r6e(a,B4e(e),_),{documents:_,gs:u})))}function r6e(n,e,i){let a=n.Es.get(e)||Yn.min();i.forEach((l,u)=>{u.readTime.compareTo(a)>0&&(a=u.readTime)}),n.Es.set(e,a)}class iQ{constructor(){this.activeTargetIds=K4e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class i6e{constructor(){this.ho=new iQ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,a){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,a){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new iQ,Promise.resolve()}handleUserChange(e,i,a){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s6e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sQ="ConnectivityMonitor";class oQ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){en(sQ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){en(sQ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nO=null;function Aj(){return nO===null?nO=function(){return 268435456+Math.round(2147483648*Math.random())}():nO++,"0x"+nO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VU="RestConnection",o6e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class a6e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===_k?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(e,i,a,l,u){const f=Aj(),_=this.So(e,i.toUriEncodedString());en(VU,`Sending RPC '${e}' ${f}:`,_,a);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,u),this.vo(e,_,E,a).then(S=>(en(VU,`Received RPC '${e}' ${f}: `,S),S),S=>{throw L0(VU,`RPC '${e}' ${f} failed with error: `,S,"url: ",_,"request:",a),S})}Co(e,i,a,l,u,f){return this.bo(e,i,a,l,u)}Do(e,i,a){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+eb}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,u)=>e[u]=l),a&&a.headers.forEach((l,u)=>e[u]=l)}So(e,i){const a=o6e[e];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c6e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na="WebChannelConnection";class l6e extends a6e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,a,l){const u=Aj();return new Promise((f,_)=>{const E=new dse;E.setWithCredentials(!0),E.listenOnce(hse.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case UO.NO_ERROR:const w=E.getResponseJson();en(Na,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(w)),f(w);break;case UO.TIMEOUT:en(Na,`RPC '${e}' ${u} timed out`),_(new on(wt.DEADLINE_EXCEEDED,"Request time out"));break;case UO.HTTP_ERROR:const I=E.getStatus();if(en(Na,`RPC '${e}' ${u} failed with status:`,I,"response text:",E.getResponseText()),I>0){let k=E.getResponseJson();Array.isArray(k)&&(k=k[0]);const U=k==null?void 0:k.error;if(U&&U.status&&U.message){const L=function(B){const q=B.toLowerCase().replace(/_/g,"-");return Object.values(wt).indexOf(q)>=0?q:wt.UNKNOWN}(U.status);_(new on(L,U.message))}else _(new on(wt.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new on(wt.UNAVAILABLE,"Connection failed."));break;default:Gn()}}finally{en(Na,`RPC '${e}' ${u} completed.`)}});const S=JSON.stringify(l);en(Na,`RPC '${e}' ${u} sending request:`,l),E.send(i,"POST",S,a,15)})}Wo(e,i,a){const l=Aj(),u=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=mse(),_=fse(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},S=this.longPollingOptions.timeoutSeconds;S!==void 0&&(E.longPollingTimeout=Math.round(1e3*S)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,a),E.encodeInitMessageHeaders=!0;const w=u.join("");en(Na,`Creating RPC '${e}' stream ${l}: ${w}`,E);const I=f.createWebChannel(w,E);let k=!1,U=!1;const L=new c6e({Fo:B=>{U?en(Na,`Not sending because RPC '${e}' stream ${l} is closed:`,B):(k||(en(Na,`Opening RPC '${e}' stream ${l} transport.`),I.open(),k=!0),en(Na,`RPC '${e}' stream ${l} sending:`,B),I.send(B))},Mo:()=>I.close()}),F=(B,q,$)=>{B.listen(q,X=>{try{$(X)}catch(oe){setTimeout(()=>{throw oe},0)}})};return F(I,rC.EventType.OPEN,()=>{U||(en(Na,`RPC '${e}' stream ${l} transport opened.`),L.Qo())}),F(I,rC.EventType.CLOSE,()=>{U||(U=!0,en(Na,`RPC '${e}' stream ${l} transport closed`),L.Ko())}),F(I,rC.EventType.ERROR,B=>{U||(U=!0,L0(Na,`RPC '${e}' stream ${l} transport errored:`,B),L.Ko(new on(wt.UNAVAILABLE,"The operation could not be completed")))}),F(I,rC.EventType.MESSAGE,B=>{var q;if(!U){const $=B.data[0];di(!!$);const X=$,oe=(X==null?void 0:X.error)||((q=X[0])===null||q===void 0?void 0:q.error);if(oe){en(Na,`RPC '${e}' stream ${l} received error:`,oe);const re=oe.status;let pe=function(ne){const ae=$s[ne];if(ae!==void 0)return qse(ae)}(re),te=oe.message;pe===void 0&&(pe=wt.INTERNAL,te="Unknown error status: "+re+" with message "+oe.message),U=!0,L.Ko(new on(pe,te)),I.close()}else en(Na,`RPC '${e}' stream ${l} received:`,$),L.Uo($)}}),F(_,pse.STAT_EVENT,B=>{B.stat===_j.PROXY?en(Na,`RPC '${e}' stream ${l} detected buffering proxy`):B.stat===_j.NOPROXY&&en(Na,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{L.$o()},0),L}}function jU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AN(n){return new pBe(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class coe{constructor(e,i,a=1e3,l=1.5,u=6e4){this.Ti=e,this.timerId=i,this.Go=a,this.zo=l,this.jo=u,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&en("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aQ="PersistentStream";class loe{constructor(e,i,a,l,u,f,_,E){this.Ti=e,this.n_=a,this.r_=l,this.connection=u,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new coe(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===wt.RESOURCE_EXHAUSTED?(qf(i.toString()),qf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===wt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{e(()=>{const l=new on(wt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(e,i){const a=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return en(aQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(en(aQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class u6e extends loe{constructor(e,i,a,l,u,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,f),this.serializer=u}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=gBe(this.serializer,e),a=function(u){if(!("targetChange"in u))return Yn.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?Yn.min():f.readTime?mp(f.readTime):Yn.min()}(e);return this.listener.p_(i,a)}y_(e){const i={};i.database=Rj(this.serializer),i.addTarget=function(u,f){let _;const E=f.target;if(_=Sj(E)?{documents:EBe(u,E)}:{query:vBe(u,E).ht},_.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){_.resumeToken=Jse(u,f.resumeToken);const S=Tj(u,f.expectedCount);S!==null&&(_.expectedCount=S)}else if(f.snapshotVersion.compareTo(Yn.min())>0){_.readTime=Tk(u,f.snapshotVersion.toTimestamp());const S=Tj(u,f.expectedCount);S!==null&&(_.expectedCount=S)}return _}(this.serializer,e);const a=bBe(this.serializer,e);a&&(i.labels=a),this.I_(i)}w_(e){const i={};i.database=Rj(this.serializer),i.removeTarget=e,this.I_(i)}}class d6e extends loe{constructor(e,i,a,l,u,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,f),this.serializer=u}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return di(!!e.streamToken),this.lastStreamToken=e.streamToken,di(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){di(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=yBe(e.writeResults,e.commitTime),a=mp(e.commitTime);return this.listener.v_(a,i)}C_(){const e={};e.database=Rj(this.serializer),this.I_(e)}S_(e){const i={streamToken:this.lastStreamToken,writes:e.map(a=>_Be(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h6e{}class p6e extends h6e{constructor(e,i,a,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new on(wt.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.bo(e,wj(i,a),l,u,f)).catch(u=>{throw u.name==="FirebaseError"?(u.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new on(wt.UNKNOWN,u.toString())})}Co(e,i,a,l,u){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Co(e,wj(i,a),l,f,_,u)).catch(f=>{throw f.name==="FirebaseError"?(f.code===wt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new on(wt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class f6e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(qf(i),this.N_=!1):en("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nE="RemoteStore";class m6e{constructor(e,i,a,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=u,this.z_.To(f=>{a.enqueueAndForget(async()=>{uE(this)&&(en(nE,"Restarting streams for network reachability change."),await async function(E){const S=Zn(E);S.W_.add(4),await UR(S),S.j_.set("Unknown"),S.W_.delete(4),await PN(S)}(this))})}),this.j_=new f6e(a,l)}}async function PN(n){if(uE(n))for(const e of n.G_)await e(!0)}async function UR(n){for(const e of n.G_)await e(!1)}function uoe(n,e){const i=Zn(n);i.U_.has(e.targetId)||(i.U_.set(e.targetId,e),Q5(i)?J5(i):rb(i).c_()&&X5(i,e))}function Y5(n,e){const i=Zn(n),a=rb(i);i.U_.delete(e),a.c_()&&doe(i,e),i.U_.size===0&&(a.c_()?a.P_():uE(i)&&i.j_.set("Unknown"))}function X5(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Yn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}rb(n).y_(e)}function doe(n,e){n.H_.Ne(e),rb(n).w_(e)}function J5(n){n.H_=new lBe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.U_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),rb(n).start(),n.j_.B_()}function Q5(n){return uE(n)&&!rb(n).u_()&&n.U_.size>0}function uE(n){return Zn(n).W_.size===0}function hoe(n){n.H_=void 0}async function g6e(n){n.j_.set("Online")}async function _6e(n){n.U_.forEach((e,i)=>{X5(n,e)})}async function y6e(n,e){hoe(n),Q5(n)?(n.j_.q_(e),J5(n)):n.j_.set("Unknown")}async function E6e(n,e,i){if(n.j_.set("Online"),e instanceof Xse&&e.state===2&&e.cause)try{await async function(l,u){const f=u.cause;for(const _ of u.targetIds)l.U_.has(_)&&(await l.remoteSyncer.rejectListen(_,f),l.U_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(a){en(nE,"Failed to remove targets %s: %s ",e.targetIds.join(","),a),await Ck(n,a)}else if(e instanceof BO?n.H_.We(e):e instanceof Yse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Yn.min()))try{const a=await aoe(n.localStore);i.compareTo(a)>=0&&await function(u,f){const _=u.H_.ot(f);return _.targetChanges.forEach((E,S)=>{if(E.resumeToken.approximateByteSize()>0){const w=u.U_.get(S);w&&u.U_.set(S,w.withResumeToken(E.resumeToken,f))}}),_.targetMismatches.forEach((E,S)=>{const w=u.U_.get(E);if(!w)return;u.U_.set(E,w.withResumeToken(ca.EMPTY_BYTE_STRING,w.snapshotVersion)),doe(u,E);const I=new wg(w.target,E,S,w.sequenceNumber);X5(u,I)}),u.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(a){en(nE,"Failed to raise snapshot:",a),await Ck(n,a)}}async function Ck(n,e,i){if(!nb(e))throw e;n.W_.add(1),await UR(n),n.j_.set("Offline"),i||(i=()=>aoe(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{en(nE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await PN(n)})}function poe(n,e){return e().catch(i=>Ck(n,i,e))}async function ON(n){const e=Zn(n),i=Bg(e);let a=e.K_.length>0?e.K_[e.K_.length-1].batchId:M5;for(;v6e(e);)try{const l=await t6e(e.localStore,a);if(l===null){e.K_.length===0&&i.P_();break}a=l.batchId,S6e(e,l)}catch(l){await Ck(e,l)}foe(e)&&moe(e)}function v6e(n){return uE(n)&&n.K_.length<10}function S6e(n,e){n.K_.push(e);const i=Bg(n);i.c_()&&i.b_&&i.S_(e.mutations)}function foe(n){return uE(n)&&!Bg(n).u_()&&n.K_.length>0}function moe(n){Bg(n).start()}async function b6e(n){Bg(n).C_()}async function T6e(n){const e=Bg(n);for(const i of n.K_)e.S_(i.mutations)}async function w6e(n,e,i){const a=n.K_.shift(),l=W5.from(a,e,i);await poe(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await ON(n)}async function C6e(n,e){e&&Bg(n).b_&&await async function(a,l){if(function(f){return oBe(f)&&f!==wt.ABORTED}(l.code)){const u=a.K_.shift();Bg(a).h_(),await poe(a,()=>a.remoteSyncer.rejectFailedWrite(u.batchId,l)),await ON(a)}}(n,e),foe(n)&&moe(n)}async function cQ(n,e){const i=Zn(n);i.asyncQueue.verifyOperationInProgress(),en(nE,"RemoteStore received new credentials");const a=uE(i);i.W_.add(3),await UR(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await PN(i)}async function R6e(n,e){const i=Zn(n);e?(i.W_.delete(2),await PN(i)):e||(i.W_.add(2),await UR(i),i.j_.set("Unknown"))}function rb(n){return n.J_||(n.J_=function(i,a,l){const u=Zn(i);return u.M_(),new u6e(a,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:g6e.bind(null,n),No:_6e.bind(null,n),Lo:y6e.bind(null,n),p_:E6e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),Q5(n)?J5(n):n.j_.set("Unknown")):(await n.J_.stop(),hoe(n))})),n.J_}function Bg(n){return n.Y_||(n.Y_=function(i,a,l){const u=Zn(i);return u.M_(),new d6e(a,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:b6e.bind(null,n),Lo:C6e.bind(null,n),D_:T6e.bind(null,n),v_:w6e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await ON(n)):(await n.Y_.stop(),n.K_.length>0&&(en(nE,`Stopping write stream with ${n.K_.length} pending writes`),n.K_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z5{constructor(e,i,a,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=u,this.deferred=new Wf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,a,l,u){const f=Date.now()+a,_=new Z5(e,i,f,l,u);return _.start(a),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new on(wt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function e3(n,e){if(qf("AsyncQueue",`${e}: ${n}`),nb(n))return new on(wt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y0{static emptySet(e){return new y0(e.comparator)}constructor(e){this.comparator=e?(i,a)=>e(i,a)||Tn.comparator(i.key,a.key):(i,a)=>Tn.comparator(i.key,a.key),this.keyedMap=iC(),this.sortedSet=new us(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,a)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof y0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),a=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=a.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const a=new y0;return a.comparator=this.comparator,a.keyedMap=e,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lQ{constructor(){this.Z_=new us(Tn.comparator)}track(e){const i=e.doc.key,a=this.Z_.get(i);a?e.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:e.doc}):e.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&a.type===0?this.Z_=this.Z_.remove(i):e.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):e.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Gn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,a)=>{e.push(a)}),e}}class F0{constructor(e,i,a,l,u,f,_,E,S){this.query=e,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=u,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=S}static fromInitialDocuments(e,i,a,l,u){const f=[];return i.forEach(_=>{f.push({type:0,doc:_})}),new F0(e,i,y0.emptySet(i),f,a,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&TN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,a=e.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class A6e{constructor(){this.queries=uQ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=Zn(i),u=l.queries;l.queries=uQ(),u.forEach((f,_)=>{for(const E of _.ta)E.onError(a)})})(this,new on(wt.ABORTED,"Firestore shutting down"))}}function uQ(){return new lE(n=>Lse(n),TN)}async function t3(n,e){const i=Zn(n);let a=3;const l=e.query;let u=i.queries.get(l);u?!u.na()&&e.ra()&&(a=2):(u=new I6e,a=e.ra()?0:1);try{switch(a){case 0:u.ea=await i.onListen(l,!0);break;case 1:u.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const _=e3(f,`Initialization of query '${jS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,u),u.ta.push(e),e.sa(i.onlineState),u.ea&&e.oa(u.ea)&&r3(i)}async function n3(n,e){const i=Zn(n),a=e.query;let l=3;const u=i.queries.get(a);if(u){const f=u.ta.indexOf(e);f>=0&&(u.ta.splice(f,1),u.ta.length===0?l=e.ra()?0:1:!u.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function P6e(n,e){const i=Zn(n);let a=!1;for(const l of e){const u=l.query,f=i.queries.get(u);if(f){for(const _ of f.ta)_.oa(l)&&(a=!0);f.ea=l}}a&&r3(i)}function O6e(n,e,i){const a=Zn(n),l=a.queries.get(e);if(l)for(const u of l.ta)u.onError(i);a.queries.delete(e)}function r3(n){n.ia.forEach(e=>{e.next()})}var Pj,dQ;(dQ=Pj||(Pj={}))._a="default",dQ.Cache="cache";class i3{constructor(e,i,a){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(e){if(!this.options.includeMetadataChanges){const a=[];for(const l of e.docChanges)l.type!==3&&a.push(l);e=new F0(e.query,e.docs,e.oldDocs,a,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=F0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Pj.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class goe{constructor(e){this.key=e}}class _oe{constructor(e){this.key=e}}class k6e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Pr(),this.mutatedKeys=Pr(),this.ya=Mse(e),this.wa=new y0(this.ya)}get ba(){return this.fa}Sa(e,i){const a=i?i.Da:new lQ,l=i?i.wa:this.wa;let u=i?i.mutatedKeys:this.mutatedKeys,f=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,S=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((w,I)=>{const k=l.get(w),U=wN(this.query,I)?I:null,L=!!k&&this.mutatedKeys.has(k.key),F=!!U&&(U.hasLocalMutations||this.mutatedKeys.has(U.key)&&U.hasCommittedMutations);let B=!1;k&&U?k.data.isEqual(U.data)?L!==F&&(a.track({type:3,doc:U}),B=!0):this.va(k,U)||(a.track({type:2,doc:U}),B=!0,(E&&this.ya(U,E)>0||S&&this.ya(U,S)<0)&&(_=!0)):!k&&U?(a.track({type:0,doc:U}),B=!0):k&&!U&&(a.track({type:1,doc:k}),B=!0,(E||S)&&(_=!0)),B&&(U?(f=f.add(U),u=F?u.add(w):u.delete(w)):(f=f.delete(w),u=u.delete(w)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const w=this.query.limitType==="F"?f.last():f.first();f=f.delete(w.key),u=u.delete(w.key),a.track({type:1,doc:w})}return{wa:f,Da:a,ls:_,mutatedKeys:u}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,a,l){const u=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const f=e.Da.X_();f.sort((w,I)=>function(U,L){const F=B=>{switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gn()}};return F(U)-F(L)}(w.type,I.type)||this.ya(w.doc,I.doc)),this.Ca(a),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,S=E!==this.ga;return this.ga=E,f.length!==0||S?{snapshot:new F0(this.query,e.wa,u,f,e.mutatedKeys,E===0,S,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new lQ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Pr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return e.forEach(a=>{this.pa.has(a)||i.push(new _oe(a))}),this.pa.forEach(a=>{e.has(a)||i.push(new goe(a))}),i}Oa(e){this.fa=e.gs,this.pa=Pr();const i=this.Sa(e.documents);return this.applyChanges(i,!0)}Na(){return F0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const s3="SyncEngine";class N6e{constructor(e,i,a){this.query=e,this.targetId=i,this.view=a}}class D6e{constructor(e){this.key=e,this.Ba=!1}}class x6e{constructor(e,i,a,l,u,f){this.localStore=e,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new lE(_=>Lse(_),TN),this.qa=new Map,this.Qa=new Set,this.$a=new us(Tn.comparator),this.Ka=new Map,this.Ua=new H5,this.Wa={},this.Ga=new Map,this.za=j0.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function L6e(n,e,i=!0){const a=Toe(n);let l;const u=a.ka.get(e);return u?(a.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Na()):l=await yoe(a,e,i,!0),l}async function M6e(n,e){const i=Toe(n);await yoe(i,e,!0,!1)}async function yoe(n,e,i,a){const l=await n6e(n.localStore,fp(e)),u=l.targetId,f=n.sharedClientState.addLocalQueryTarget(u,i);let _;return a&&(_=await U6e(n,e,u,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&uoe(n.remoteStore,l),_}async function U6e(n,e,i,a,l){n.Ha=(I,k,U)=>async function(F,B,q,$){let X=B.view.Sa(q);X.ls&&(X=await rQ(F.localStore,B.query,!1).then(({documents:te})=>B.view.Sa(te,X)));const oe=$&&$.targetChanges.get(B.targetId),re=$&&$.targetMismatches.get(B.targetId)!=null,pe=B.view.applyChanges(X,F.isPrimaryClient,oe,re);return pQ(F,B.targetId,pe.Ma),pe.snapshot}(n,I,k,U);const u=await rQ(n.localStore,e,!0),f=new k6e(e,u.gs),_=f.Sa(u.documents),E=MR.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),S=f.applyChanges(_,n.isPrimaryClient,E);pQ(n,i,S.Ma);const w=new N6e(e,i,f);return n.ka.set(e,w),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),S.snapshot}async function V6e(n,e,i){const a=Zn(n),l=a.ka.get(e),u=a.qa.get(l.targetId);if(u.length>1)return a.qa.set(l.targetId,u.filter(f=>!TN(f,e))),void a.ka.delete(e);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await Ij(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&Y5(a.remoteStore,l.targetId),Oj(a,l.targetId)}).catch(tb)):(Oj(a,l.targetId),await Ij(a.localStore,l.targetId,!0))}async function j6e(n,e){const i=Zn(n),a=i.ka.get(e),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),Y5(i.remoteStore,a.targetId))}async function F6e(n,e,i){const a=K6e(n);try{const l=await function(f,_){const E=Zn(f),S=fo.now(),w=_.reduce((U,L)=>U.add(L.key),Pr());let I,k;return E.persistence.runTransaction("Locally write mutations","readwrite",U=>{let L=Yf(),F=Pr();return E.ds.getEntries(U,w).next(B=>{L=B,L.forEach((q,$)=>{$.isValidDocument()||(F=F.add(q))})}).next(()=>E.localDocuments.getOverlayedDocuments(U,L)).next(B=>{I=B;const q=[];for(const $ of _){const X=tBe($,I.get($.key).overlayedDocument);X!=null&&q.push(new Xg($.key,X,Ise(X.value.mapValue),qd.exists(!0)))}return E.mutationQueue.addMutationBatch(U,S,q,_)}).next(B=>{k=B;const q=B.applyToLocalDocumentSet(I,F);return E.documentOverlayCache.saveOverlays(U,B.batchId,q)})}).then(()=>({batchId:k.batchId,changes:Vse(I)}))}(a.localStore,e);a.sharedClientState.addPendingMutation(l.batchId),function(f,_,E){let S=f.Wa[f.currentUser.toKey()];S||(S=new us(Lr)),S=S.insert(_,E),f.Wa[f.currentUser.toKey()]=S}(a,l.batchId,i),await VR(a,l.changes),await ON(a.remoteStore)}catch(l){const u=e3(l,"Failed to persist write");i.reject(u)}}async function Eoe(n,e){const i=Zn(n);try{const a=await ZBe(i.localStore,e);e.targetChanges.forEach((l,u)=>{const f=i.Ka.get(u);f&&(di(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?di(f.Ba):l.removedDocuments.size>0&&(di(f.Ba),f.Ba=!1))}),await VR(i,a,e)}catch(a){await tb(a)}}function hQ(n,e,i){const a=Zn(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((u,f)=>{const _=f.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(f,_){const E=Zn(f);E.onlineState=_;let S=!1;E.queries.forEach((w,I)=>{for(const k of I.ta)k.sa(_)&&(S=!0)}),S&&r3(E)}(a.eventManager,e),l.length&&a.La.p_(l),a.onlineState=e,a.isPrimaryClient&&a.sharedClientState.setOnlineState(e)}}async function B6e(n,e,i){const a=Zn(n);a.sharedClientState.updateQueryState(e,"rejected",i);const l=a.Ka.get(e),u=l&&l.key;if(u){let f=new us(Tn.comparator);f=f.insert(u,Ma.newNoDocument(u,Yn.min()));const _=Pr().add(u),E=new IN(Yn.min(),new Map,new us(Lr),f,_);await Eoe(a,E),a.$a=a.$a.remove(u),a.Ka.delete(e),o3(a)}else await Ij(a.localStore,e,!1).then(()=>Oj(a,e,i)).catch(tb)}async function W6e(n,e){const i=Zn(n),a=e.batch.batchId;try{const l=await QBe(i.localStore,e);Soe(i,a,null),voe(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await VR(i,l)}catch(l){await tb(l)}}async function z6e(n,e,i){const a=Zn(n);try{const l=await function(f,_){const E=Zn(f);return E.persistence.runTransaction("Reject batch","readwrite-primary",S=>{let w;return E.mutationQueue.lookupMutationBatch(S,_).next(I=>(di(I!==null),w=I.keys(),E.mutationQueue.removeMutationBatch(S,I))).next(()=>E.mutationQueue.performConsistencyCheck(S)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(S,w,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,w)).next(()=>E.localDocuments.getDocuments(S,w))})}(a.localStore,e);Soe(a,e,i),voe(a,e),a.sharedClientState.updateMutationState(e,"rejected",i),await VR(a,l)}catch(l){await tb(l)}}function voe(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function Soe(n,e,i){const a=Zn(n);let l=a.Wa[a.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),a.Wa[a.currentUser.toKey()]=l}}function Oj(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const a of n.qa.get(e))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(e),n.isPrimaryClient&&n.Ua.Sr(e).forEach(a=>{n.Ua.containsKey(a)||boe(n,a)})}function boe(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(Y5(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ka.delete(i),o3(n))}function pQ(n,e,i){for(const a of i)a instanceof goe?(n.Ua.addReference(a.key,e),G6e(n,a)):a instanceof _oe?(en(s3,"Document no longer in limbo: "+a.key),n.Ua.removeReference(a.key,e),n.Ua.containsKey(a.key)||boe(n,a.key)):Gn()}function G6e(n,e){const i=e.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(en(s3,"New document in limbo: "+i),n.Qa.add(a),o3(n))}function o3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Tn($i.fromString(e)),a=n.za.next();n.Ka.set(a,new D6e(i)),n.$a=n.$a.insert(i,a),uoe(n.remoteStore,new wg(fp(bN(i.path)),a,"TargetPurposeLimboResolution",EN.ae))}}async function VR(n,e,i){const a=Zn(n),l=[],u=[],f=[];a.ka.isEmpty()||(a.ka.forEach((_,E)=>{f.push(a.Ha(E,e,i).then(S=>{var w;if((S||i)&&a.isPrimaryClient){const I=S?!S.fromCache:(w=i==null?void 0:i.targetChanges.get(E.targetId))===null||w===void 0?void 0:w.current;a.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(S){l.push(S);const I=K5.Yi(E.targetId,S);u.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(E,S){const w=Zn(E);try{await w.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Tt.forEach(S,k=>Tt.forEach(k.Hi,U=>w.persistence.referenceDelegate.addReference(I,k.targetId,U)).next(()=>Tt.forEach(k.Ji,U=>w.persistence.referenceDelegate.removeReference(I,k.targetId,U)))))}catch(I){if(!nb(I))throw I;en(q5,"Failed to update sequence numbers: "+I)}for(const I of S){const k=I.targetId;if(!I.fromCache){const U=w.Ts.get(k),L=U.snapshotVersion,F=U.withLastLimboFreeSnapshotVersion(L);w.Ts=w.Ts.insert(k,F)}}}(a.localStore,u))}async function H6e(n,e){const i=Zn(n);if(!i.currentUser.isEqual(e)){en(s3,"User change. New user:",e.toKey());const a=await ooe(i.localStore,e);i.currentUser=e,function(u,f){u.Ga.forEach(_=>{_.forEach(E=>{E.reject(new on(wt.CANCELLED,f))})}),u.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,a.removedBatchIds,a.addedBatchIds),await VR(i,a.Rs)}}function $6e(n,e){const i=Zn(n),a=i.Ka.get(e);if(a&&a.Ba)return Pr().add(a.key);{let l=Pr();const u=i.qa.get(e);if(!u)return l;for(const f of u){const _=i.ka.get(f);l=l.unionWith(_.view.ba)}return l}}function Toe(n){const e=Zn(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Eoe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$6e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=B6e.bind(null,e),e.La.p_=P6e.bind(null,e.eventManager),e.La.Ja=O6e.bind(null,e.eventManager),e}function K6e(n){const e=Zn(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=W6e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=z6e.bind(null,e),e}class Rk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=AN(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return JBe(this.persistence,new qBe,e.initialUser,this.serializer)}Xa(e){return new soe($5.ri,this.serializer)}Za(e){return new i6e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Rk.provider={build:()=>new Rk};class q6e extends Rk{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){di(this.persistence.referenceDelegate instanceof wk);const a=this.persistence.referenceDelegate.garbageCollector;return new DBe(a,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?Jc.withCacheSize(this.cacheSizeBytes):Jc.DEFAULT;return new soe(a=>wk.ri(a,i),this.serializer)}}class kj{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>hQ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=H6e.bind(null,this.syncEngine),await R6e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new A6e}()}createDatastore(e){const i=AN(e.databaseInfo.databaseId),a=function(u){return new l6e(u)}(e.databaseInfo);return function(u,f,_,E){return new p6e(u,f,_,E)}(e.authCredentials,e.appCheckCredentials,a,i)}createRemoteStore(e){return function(a,l,u,f,_){return new m6e(a,l,u,f,_)}(this.localStore,this.datastore,e.asyncQueue,i=>hQ(this.syncEngine,i,0),function(){return oQ.D()?new oQ:new s6e}())}createSyncEngine(e,i){return function(l,u,f,_,E,S,w){const I=new x6e(l,u,f,_,E,S);return w&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const u=Zn(l);en(nE,"RemoteStore shutting down."),u.W_.add(5),await UR(u),u.z_.shutdown(),u.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}kj.provider={build:()=>new kj};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):qf("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg="FirestoreClient";class Y6e{constructor(e,i,a,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=La.UNAUTHENTICATED,this.clientId=_se.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(a,async f=>{en(Wg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(en(Wg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const a=e3(i,"Failed to shutdown persistence");e.reject(a)}}),e.promise}}async function FU(n,e){n.asyncQueue.verifyOperationInProgress(),en(Wg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await ooe(e.localStore,l),a=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function fQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await X6e(n);en(Wg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(a=>cQ(e.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>cQ(e.remoteStore,l)),n._onlineComponents=e}async function X6e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){en(Wg,"Using user provided OfflineComponentProvider");try{await FU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===wt.FAILED_PRECONDITION||l.code===wt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;L0("Error using user provided cache. Falling back to memory cache: "+i),await FU(n,new Rk)}}else en(Wg,"Using default OfflineComponentProvider"),await FU(n,new q6e(void 0));return n._offlineComponents}async function woe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(en(Wg,"Using user provided OnlineComponentProvider"),await fQ(n,n._uninitializedComponentsProvider._online)):(en(Wg,"Using default OnlineComponentProvider"),await fQ(n,new kj))),n._onlineComponents}function J6e(n){return woe(n).then(e=>e.syncEngine)}async function Ik(n){const e=await woe(n),i=e.eventManager;return i.onListen=L6e.bind(null,e.syncEngine),i.onUnlisten=V6e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=M6e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=j6e.bind(null,e.syncEngine),i}function Q6e(n,e,i={}){const a=new Wf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,S){const w=new a3({next:k=>{w.su(),f.enqueueAndForget(()=>n3(u,I));const U=k.docs.has(_);!U&&k.fromCache?S.reject(new on(wt.UNAVAILABLE,"Failed to get document because the client is offline.")):U&&k.fromCache&&E&&E.source==="server"?S.reject(new on(wt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):S.resolve(k)},error:k=>S.reject(k)}),I=new i3(bN(_.path),w,{includeMetadataChanges:!0,Ta:!0});return t3(u,I)}(await Ik(n),n.asyncQueue,e,i,a)),a.promise}function Z6e(n,e,i={}){const a=new Wf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,S){const w=new a3({next:k=>{w.su(),f.enqueueAndForget(()=>n3(u,I)),k.fromCache&&E.source==="server"?S.reject(new on(wt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):S.resolve(k)},error:k=>S.reject(k)}),I=new i3(_,w,{includeMetadataChanges:!0,Ta:!0});return t3(u,I)}(await Ik(n),n.asyncQueue,e,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Coe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Roe(n,e,i){if(!i)throw new on(wt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function e8e(n,e,i,a){if(e===!0&&a===!0)throw new on(wt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function gQ(n){if(!Tn.isDocumentKey(n))throw new on(wt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function _Q(n){if(Tn.isDocumentKey(n))throw new on(wt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function kN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(a){return a.constructor?a.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Gn()}function zl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new on(wt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=kN(n);throw new on(wt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ioe="firestore.googleapis.com",yQ=!0;class EQ{constructor(e){var i,a;if(e.host===void 0){if(e.ssl!==void 0)throw new on(wt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ioe,this.ssl=yQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:yQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ioe;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<kBe)throw new on(wt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}e8e("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Coe((a=e.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new on(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new on(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new on(wt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class NN{constructor(e,i,a,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new EQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new on(wt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new on(wt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new EQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new a4e;switch(a.type){case"firstParty":return new d4e(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new on(wt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=mQ.get(i);a&&(en("ComponentProvider","Removing Datastore"),mQ.delete(i),a.terminate())}(this),Promise.resolve()}}function t8e(n,e,i,a={}){var l;const u=(n=zl(n,NN))._getSettings(),f=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;u.host!==Ioe&&u.host!==_&&L0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},u),{host:_,ssl:!1,emulatorOptions:a});if(!Jy(E,f)&&(n._setSettings(E),a.mockUserToken)){let S,w;if(typeof a.mockUserToken=="string")S=a.mockUserToken,w=La.MOCK_USER;else{S=bie(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new on(wt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");w=new La(I)}n._authCredentials=new c4e(new gse(S,w))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jg{constructor(e,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=e}withConverter(e){return new Jg(this.firestore,e,this._query)}}class ja{constructor(e,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Og(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ja(this.firestore,e,this._key)}}class Og extends Jg{constructor(e,i,a){super(e,i,bN(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ja(this.firestore,null,new Tn(e))}withConverter(e){return new Og(this.firestore,e,this._path)}}function Xf(n,e,...i){if(n=Xi(n),Roe("collection","path",e),n instanceof NN){const a=$i.fromString(e,...i);return _Q(a),new Og(n,null,a)}{if(!(n instanceof ja||n instanceof Og))throw new on(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child($i.fromString(e,...i));return _Q(a),new Og(n.firestore,null,a)}}function qi(n,e,...i){if(n=Xi(n),arguments.length===1&&(e=_se.newId()),Roe("doc","path",e),n instanceof NN){const a=$i.fromString(e,...i);return gQ(a),new ja(n,null,new Tn(a))}{if(!(n instanceof ja||n instanceof Og))throw new on(wt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child($i.fromString(e,...i));return gQ(a),new ja(n.firestore,n instanceof Og?n.converter:null,new Tn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vQ="AsyncQueue";class SQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new coe(this,"async_queue_retry"),this.bu=()=>{const a=jU();a&&en(vQ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=e;const i=jU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=jU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Wf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!nb(e))throw e;en(vQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.Su.then(()=>(this.pu=!0,e().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let _=f.message||"";return f.stack&&(_=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),_}(a);throw qf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=i,i}enqueueAfterDelay(e,i,a){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=Z5.createAndSchedule(this,e,i,a,u=>this.Fu(u));return this.fu.push(l),l}Du(){this.gu&&Gn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.Su,await e;while(e!==this.Su)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function bQ(n){return function(i,a){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of a)if(u in l&&typeof l[u]=="function")return!0;return!1}(n,["next","error","complete"])}class zg extends NN{constructor(e,i,a,l){super(e,i,a,l),this.type="firestore",this._queue=new SQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new SQ(e),this._firestoreClient=void 0,await e}}}function Aoe(n,e){const i=typeof n=="object"?n:R5(),a=typeof n=="string"?n:_k,l=fN(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const u=Eie("firestore");u&&t8e(l,...u)}return l}function DN(n){if(n._terminated)throw new on(wt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||n8e(n),n._firestoreClient}function n8e(n){var e,i,a;const l=n._freezeSettings(),u=function(_,E,S,w){return new C4e(_,E,S,w.host,w.ssl,w.experimentalForceLongPolling,w.experimentalAutoDetectLongPolling,Coe(w.experimentalLongPollingOptions),w.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new Y6e(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new B0(ca.fromBase64String(e))}catch(i){throw new on(wt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new B0(ca.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new on(wt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new aa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c3{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new on(wt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new on(wt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Lr(this._lat,e._lat)||Lr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(a,l){if(a.length!==l.length)return!1;for(let u=0;u<a.length;++u)if(a[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r8e=/^__.*__$/;class i8e{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return this.fieldMask!==null?new Xg(e,this.data,this.fieldMask,i,this.fieldTransforms):new LR(e,this.data,i,this.fieldTransforms)}}class Poe{constructor(e,i,a){this.data=e,this.fieldMask=i,this.fieldTransforms=a}toMutation(e,i){return new Xg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function Ooe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Gn()}}class u3{constructor(e,i,a,l,u,f){this.settings=e,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,u===void 0&&this.Bu(),this.fieldTransforms=u||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new u3(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.$u(e),l}Ku(e){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Ak(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(Ooe(this.Lu)&&r8e.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class s8e{constructor(e,i,a){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=a||AN(e)}ju(e,i,a,l=!1){return new u3({Lu:e,methodName:i,zu:a,path:aa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function MN(n){const e=n._freezeSettings(),i=AN(n._databaseId);return new s8e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function koe(n,e,i,a,l,u={}){const f=n.ju(u.merge||u.mergeFields?2:0,e,i,l);h3("Data must be an object, but it was:",f,a);const _=Noe(a,f);let E,S;if(u.merge)E=new Ul(f.fieldMask),S=f.fieldTransforms;else if(u.mergeFields){const w=[];for(const I of u.mergeFields){const k=Nj(e,I,i);if(!f.contains(k))throw new on(wt.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);xoe(w,k)||w.push(k)}E=new Ul(w),S=f.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,S=f.fieldTransforms;return new i8e(new Zc(_),E,S)}class UN extends LN{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof UN}}class d3 extends LN{_toFieldTransform(e){return new J4e(e.path,new sR)}isEqual(e){return e instanceof d3}}function o8e(n,e,i,a){const l=n.ju(1,e,i);h3("Data must be an object, but it was:",l,a);const u=[],f=Zc.empty();Yg(a,(E,S)=>{const w=p3(e,E,i);S=Xi(S);const I=l.Ku(w);if(S instanceof UN)u.push(w);else{const k=jR(S,I);k!=null&&(u.push(w),f.set(w,k))}});const _=new Ul(u);return new Poe(f,_,l.fieldTransforms)}function a8e(n,e,i,a,l,u){const f=n.ju(1,e,i),_=[Nj(e,a,i)],E=[l];if(u.length%2!=0)throw new on(wt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<u.length;k+=2)_.push(Nj(e,u[k])),E.push(u[k+1]);const S=[],w=Zc.empty();for(let k=_.length-1;k>=0;--k)if(!xoe(S,_[k])){const U=_[k];let L=E[k];L=Xi(L);const F=f.Ku(U);if(L instanceof UN)S.push(U);else{const B=jR(L,F);B!=null&&(S.push(U),w.set(U,B))}}const I=new Ul(S);return new Poe(w,I,f.fieldTransforms)}function c8e(n,e,i,a=!1){return jR(i,n.ju(a?4:3,e))}function jR(n,e){if(Doe(n=Xi(n)))return h3("Unsupported field value:",e,n),Noe(n,e);if(n instanceof LN)return function(a,l){if(!Ooe(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const u=a._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(a,l){const u=[];let f=0;for(const _ of a){let E=jR(_,l.Uu(f));E==null&&(E={nullValue:"NULL_VALUE"}),u.push(E),f++}return{arrayValue:{values:u}}}(n,e)}return function(a,l){if((a=Xi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return q4e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const u=fo.fromDate(a);return{timestampValue:Tk(l.serializer,u)}}if(a instanceof fo){const u=new fo(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Tk(l.serializer,u)}}if(a instanceof c3)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof B0)return{bytesValue:Jse(l.serializer,a._byteString)};if(a instanceof ja){const u=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(u))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:G5(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof l3)return function(f,_){return{mapValue:{fields:{[Cse]:{stringValue:Rse},[yk]:{arrayValue:{values:f.toArray().map(S=>{if(typeof S!="number")throw _.Wu("VectorValues must only contain numeric values.");return B5(_.serializer,S)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${kN(a)}`)}(n,e)}function Noe(n,e){const i={};return Ese(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Yg(n,(a,l)=>{const u=jR(l,e.qu(a));u!=null&&(i[a]=u)}),{mapValue:{fields:i}}}function Doe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof fo||n instanceof c3||n instanceof B0||n instanceof ja||n instanceof LN||n instanceof l3)}function h3(n,e,i){if(!Doe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=kN(i);throw a==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+a)}}function Nj(n,e,i){if((e=Xi(e))instanceof xN)return e._internalPath;if(typeof e=="string")return p3(n,e);throw Ak("Field path arguments must be of type string or ",n,!1,void 0,i)}const l8e=new RegExp("[~\\*/\\[\\]]");function p3(n,e,i){if(e.search(l8e)>=0)throw Ak(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new xN(...e.split("."))._internalPath}catch{throw Ak(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function Ak(n,e,i,a,l){const u=a&&!a.isEmpty(),f=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(u||f)&&(E+=" (found",u&&(E+=` in field ${a}`),f&&(E+=` in document ${l}`),E+=")"),new on(wt.INVALID_ARGUMENT,_+n+E)}function xoe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Loe{constructor(e,i,a,l,u){this._firestore=e,this._userDataWriter=i,this._key=a,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new ja(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new u8e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(f3("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class u8e extends Loe{data(){return super.data()}}function f3(n,e){return typeof e=="string"?p3(n,e):e instanceof xN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Moe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new on(wt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class m3{}class Uoe extends m3{}function cR(n,e,...i){let a=[];e instanceof m3&&a.push(e),a=a.concat(i),function(u){const f=u.filter(E=>E instanceof g3).length,_=u.filter(E=>E instanceof VN).length;if(f>1||f>0&&_>0)throw new on(wt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class VN extends Uoe{constructor(e,i,a){super(),this._field=e,this._op=i,this._value=a,this.type="where"}static _create(e,i,a){return new VN(e,i,a)}_apply(e){const i=this._parse(e);return Voe(e._query,i),new Jg(e.firestore,e.converter,bj(e._query,i))}_parse(e){const i=MN(e.firestore);return function(u,f,_,E,S,w,I){let k;if(S.isKeyField()){if(w==="array-contains"||w==="array-contains-any")throw new on(wt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${w}' queries on documentId().`);if(w==="in"||w==="not-in"){wQ(I,w);const L=[];for(const F of I)L.push(TQ(E,u,F));k={arrayValue:{values:L}}}else k=TQ(E,u,I)}else w!=="in"&&w!=="not-in"&&w!=="array-contains-any"||wQ(I,w),k=c8e(_,f,I,w==="in"||w==="not-in");return Js.create(S,w,k)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function Pk(n,e,i){const a=e,l=f3("where",n);return VN._create(l,a,i)}class g3 extends m3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new g3(e,i)}_parse(e){const i=this._queryConstraints.map(a=>a._parse(e)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:Xd.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,u){let f=l;const _=u.getFlattenedFilters();for(const E of _)Voe(f,E),f=bj(f,E)}(e._query,i),new Jg(e.firestore,e.converter,bj(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class _3 extends Uoe{constructor(e,i,a){super(),this.type=e,this._limit=i,this._limitType=a}static _create(e,i,a){return new _3(e,i,a)}_apply(e){return new Jg(e.firestore,e.converter,Sk(e._query,this._limit,this._limitType))}}function d8e(n){return _3._create("limit",n,"F")}function TQ(n,e,i){if(typeof(i=Xi(i))=="string"){if(i==="")throw new on(wt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xse(e)&&i.indexOf("/")!==-1)throw new on(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=e.path.child($i.fromString(i));if(!Tn.isDocumentKey(a))throw new on(wt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return VJ(n,new Tn(a))}if(i instanceof ja)return VJ(n,i._key);throw new on(wt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${kN(i)}.`)}function wQ(n,e){if(!Array.isArray(n)||n.length===0)throw new on(wt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Voe(n,e){const i=function(l,u){for(const f of l)for(const _ of f.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new on(wt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new on(wt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class h8e{convertValue(e,i="none"){switch(Fg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ms(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(jg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Gn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const a={};return Yg(e,(l,u)=>{a[l]=this.convertValue(u,i)}),a}convertVectorValue(e){var i,a,l;const u=(l=(a=(i=e.fields)===null||i===void 0?void 0:i[yk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Ms(f.doubleValue));return new l3(u)}convertGeoPoint(e){return new c3(Ms(e.latitude),Ms(e.longitude))}convertArray(e,i){return(e.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(e,i){switch(i){case"previous":const a=SN(e);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(nR(e));default:return null}}convertTimestamp(e){const i=Vg(e);return new fo(i.seconds,i.nanos)}convertDocumentKey(e,i){const a=$i.fromString(e);di(roe(a));const l=new rR(a.get(1),a.get(3)),u=new Tn(a.popFirst(5));return l.isEqual(i)||qf(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function joe(n,e,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Foe extends Loe{constructor(e,i,a,l,u,f){super(e,i,a,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new WO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const a=this._document.data.field(f3("DocumentSnapshot.get",e));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class WO extends Foe{data(e={}){return super.data(e)}}class Boe{constructor(e,i,a,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new oC(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(a=>{e.call(i,new WO(this._firestore,this._userDataWriter,a.key,a,new oC(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new on(wt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(_=>{const E=new WO(l._firestore,l._userDataWriter,_.doc.key,_.doc,new oC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>u||_.type!==3).map(_=>{const E=new WO(l._firestore,l._userDataWriter,_.doc.key,_.doc,new oC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let S=-1,w=-1;return _.type!==0&&(S=f.indexOf(_.doc.key),f=f.delete(_.doc.key)),_.type!==1&&(f=f.add(_.doc),w=f.indexOf(_.doc.key)),{type:p8e(_.type),doc:E,oldIndex:S,newIndex:w}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function p8e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(n){n=zl(n,ja);const e=zl(n.firestore,zg);return Q6e(DN(e),n._key).then(i=>Woe(e,n,i))}class y3 extends h8e{constructor(e){super(),this.firestore=e}convertBytes(e){return new B0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new ja(this.firestore,null,i)}}function Gg(n){n=zl(n,Jg);const e=zl(n.firestore,zg),i=DN(e),a=new y3(e);return Moe(n._query),Z6e(i,n._query).then(l=>new Boe(e,a,n,l))}function Ok(n,e,i){n=zl(n,ja);const a=zl(n.firestore,zg),l=joe(n.converter,e,i);return E3(a,[koe(MN(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,qd.none())])}function $u(n,e,i,...a){n=zl(n,ja);const l=zl(n.firestore,zg),u=MN(l);let f;return f=typeof(e=Xi(e))=="string"||e instanceof xN?a8e(u,"updateDoc",n._key,e,i,a):o8e(u,"updateDoc",n._key,e),E3(l,[f.toMutation(n._key,qd.exists(!0))])}function f8e(n,e){const i=zl(n.firestore,zg),a=qi(n),l=joe(n.converter,e);return E3(i,[koe(MN(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,qd.exists(!1))]).then(()=>a)}function m8e(n,...e){var i,a,l;n=Xi(n);let u={includeMetadataChanges:!1,source:"default"},f=0;typeof e[f]!="object"||bQ(e[f])||(u=e[f],f++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(bQ(e[f])){const I=e[f];e[f]=(i=I.next)===null||i===void 0?void 0:i.bind(I),e[f+1]=(a=I.error)===null||a===void 0?void 0:a.bind(I),e[f+2]=(l=I.complete)===null||l===void 0?void 0:l.bind(I)}let E,S,w;if(n instanceof ja)S=zl(n.firestore,zg),w=bN(n._key.path),E={next:I=>{e[f]&&e[f](Woe(S,n,I))},error:e[f+1],complete:e[f+2]};else{const I=zl(n,Jg);S=zl(I.firestore,zg),w=I._query;const k=new y3(S);E={next:U=>{e[f]&&e[f](new Boe(S,k,I,U))},error:e[f+1],complete:e[f+2]},Moe(n._query)}return function(k,U,L,F){const B=new a3(F),q=new i3(U,B,L);return k.asyncQueue.enqueueAndForget(async()=>t3(await Ik(k),q)),()=>{B.su(),k.asyncQueue.enqueueAndForget(async()=>n3(await Ik(k),q))}}(DN(S),w,_,E)}function E3(n,e){return function(a,l){const u=new Wf;return a.asyncQueue.enqueueAndForget(async()=>F6e(await J6e(a),l,u)),u.promise}(DN(n),e)}function Woe(n,e,i){const a=i.docs.get(e._key),l=new y3(n);return new Foe(n,l,e._key,a,new oC(i.hasPendingWrites,i.fromCache),e.converter)}function g8e(){return new d3("serverTimestamp")}(function(e,i=!0){(function(l){eb=l})(aE),Qy(new Mg("firestore",(a,{instanceIdentifier:l,options:u})=>{const f=a.getProvider("app").getImmediate(),_=new zg(new l4e(a.getProvider("auth-internal")),new h4e(f,a.getProvider("app-check-internal")),function(S,w){if(!Object.prototype.hasOwnProperty.apply(S.options,["projectId"]))throw new on(wt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rR(S.options.projectId,w)}(f,l),f);return u=Object.assign({useFetchStreams:i},u),_._setSettings(u),_},"PUBLIC").setMultipleInstances(!0)),dp(IJ,AJ,e),dp(IJ,AJ,"esm2017")})();var _8e="firebase",y8e="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */dp(_8e,y8e,"app");const E8e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!1);console.log("import.meta.env:",E8e);const pg={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:pg.apiKey?`${pg.apiKey.substring(0,5)}...`:"missing",authDomain:pg.authDomain,projectId:pg.projectId,storageBucket:pg.storageBucket,messagingSenderId:pg.messagingSenderId?"present":"missing",appId:pg.appId?"present":"missing"});const zoe=Cie(pg),v8e=yN(zoe),ri=Aoe(zoe),rO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${a}.${l}`},be={log:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${rO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${rO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${rO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${rO()}] ${n}`)}},Ep=async n=>{try{be.log("userFirestore: Get user Profile data for user ID: "+n);const e=qi(ri,"users",n),i=await cc(e);return i.exists()?(be.log("userFirestore: Found Profile for : "+i.data().Nickname),i.data()):(be.error("userFirestore: user profile document not found"),null)}catch(e){throw be.error("userFirestore: Error fetching user profile data:",e),e}},S8e=async(n,e,i)=>{try{be.log("userFirestore: Registering new user with email:",n);const l=(await G5e(v8e,n,e)).user,u={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!0,...i};be.log("userFirestore: Creating user document with data:",u);const f=qi(ri,"users",l.uid);return await Ok(f,u),be.log("userFirestore: User created successfully with groups:",u.groups),{...l,...u}}catch(a){throw be.error("userFirestore: Error creating user:",a),a}},Goe=async(n,e)=>{try{be.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=qi(ri,"users",n);await $u(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),be.log("userFirestore: rpmURL updated successfully.")}catch(i){throw be.error("userFirestore: Error updating rpmURL:",i),i}},b8e=(n,e)=>{if(e==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning true`),!0;if(e==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(n);return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and admin group ${e} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${n} and group ${e} - Returning false`),!1},Hoe=async(n,e)=>b8e(n,e),T8e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],$d={sendUserToUnity:"sendUserToUnity"};class w8e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const a=this.events[e];a?(a.forEach(l=>{l(i)}),be.log(`EventBus: Published event '${e}'`)):be.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const a=(l=this.events[e])==null?void 0:l.indexOf(i);a>-1&&this.events[e].splice(a,1)}}const Kd=new w8e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $oe="firebasestorage.googleapis.com",Koe="storageBucket",C8e=2*60*1e3,R8e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As extends Tp{constructor(e,i,a=0){super(BU(e),`Firebase Storage: ${i} (${BU(e)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,As.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return BU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Is;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Is||(Is={}));function BU(n){return"storage/"+n}function v3(){const n="An unknown error occurred, please check the error payload for server response.";return new As(Is.UNKNOWN,n)}function I8e(n){return new As(Is.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function A8e(n){return new As(Is.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function P8e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new As(Is.UNAUTHENTICATED,n)}function O8e(){return new As(Is.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function k8e(n){return new As(Is.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function N8e(){return new As(Is.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function D8e(){return new As(Is.CANCELED,"User canceled the upload/download.")}function x8e(n){return new As(Is.INVALID_URL,"Invalid URL '"+n+"'.")}function L8e(n){return new As(Is.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function M8e(){return new As(Is.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Koe+"' property when initializing the app?")}function U8e(){return new As(Is.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function V8e(){return new As(Is.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function j8e(n){return new As(Is.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Dj(n){return new As(Is.INVALID_ARGUMENT,n)}function qoe(){return new As(Is.APP_DELETED,"The Firebase app was deleted.")}function F8e(n){return new As(Is.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function CC(n,e){return new As(Is.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Ow(n){throw new As(Is.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let a;try{a=Vl.makeFromUrl(e,i)}catch{return new Vl(e,"")}if(a.path==="")return a;throw L8e(e)}static makeFromUrl(e,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function u(oe){oe.path.charAt(oe.path.length-1)==="/"&&(oe.path_=oe.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+l+f,"i"),E={bucket:1,path:3};function S(oe){oe.path_=decodeURIComponent(oe.path)}const w="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),k="(/([^?#]*).*)?$",U=new RegExp(`^https?://${I}/${w}/b/${l}/o${k}`,"i"),L={bucket:1,path:3},F=i===$oe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,B="([^?#]*)",q=new RegExp(`^https?://${F}/${l}/${B}`,"i"),X=[{regex:_,indices:E,postModify:u},{regex:U,indices:L,postModify:S},{regex:q,indices:{bucket:1,path:2},postModify:S}];for(let oe=0;oe<X.length;oe++){const re=X[oe],pe=re.regex.exec(e);if(pe){const te=pe[re.indices.bucket];let Z=pe[re.indices.path];Z||(Z=""),a=new Vl(te,Z),re.postModify(a);break}}if(a==null)throw x8e(e);return a}}class B8e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W8e(n,e,i){let a=1,l=null,u=null,f=!1,_=0;function E(){return _===2}let S=!1;function w(...B){S||(S=!0,e.apply(null,B))}function I(B){l=setTimeout(()=>{l=null,n(U,E())},B)}function k(){u&&clearTimeout(u)}function U(B,...q){if(S){k();return}if(B){k(),w.call(null,B,...q);return}if(E()||f){k(),w.call(null,B,...q);return}a<64&&(a*=2);let X;_===1?(_=2,X=0):X=(a+Math.random())*1e3,I(X)}let L=!1;function F(B){L||(L=!0,k(),!S&&(l!==null?(B||(_=2),clearTimeout(l),I(0)):B||(_=1)))}return I(0),u=setTimeout(()=>{f=!0,F(!0)},i),F}function z8e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G8e(n){return n!==void 0}function H8e(n){return typeof n=="object"&&!Array.isArray(n)}function S3(n){return typeof n=="string"||n instanceof String}function CQ(n){return b3()&&n instanceof Blob}function b3(){return typeof Blob<"u"}function RQ(n,e,i,a){if(a<e)throw Dj(`Invalid value for '${n}'. Expected ${e} or greater.`);if(a>i)throw Dj(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jN(n,e,i){let a=e;return i==null&&(a=`https://${e}`),`${i}://${a}/v0${n}`}function Yoe(n){const e=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=e(a)+"="+e(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Wy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Wy||(Wy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $8e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K8e{constructor(e,i,a,l,u,f,_,E,S,w,I,k=!0){this.url_=e,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=E,this.timeout_=S,this.progressCallback_=w,this.connectionFactory_=I,this.retry=k,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((U,L)=>{this.resolve_=U,this.reject_=L,this.start_()})}start_(){const e=(a,l)=>{if(l){a(!1,new iO(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const f=_=>{const E=_.loaded,S=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,S)};this.progressCallback_!==null&&u.addUploadProgressListener(f),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(f),this.pendingConnection_=null;const _=u.getErrorCode()===Wy.NO_ERROR,E=u.getStatus();if(!_||$8e(E,this.additionalRetryCodes_)&&this.retry){const w=u.getErrorCode()===Wy.ABORT;a(!1,new iO(!1,null,w));return}const S=this.successCodes_.indexOf(E)!==-1;a(!0,new iO(S,u))})},i=(a,l)=>{const u=this.resolve_,f=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());G8e(E)?u(E):u()}catch(E){f(E)}else if(_!==null){const E=v3();E.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,E)):f(E)}else if(l.canceled){const E=this.appDelete_?qoe():D8e();f(E)}else{const E=N8e();f(E)}};this.canceled_?i(!1,new iO(!1,null,!0)):this.backoffId_=W8e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&z8e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class iO{constructor(e,i,a){this.wasSuccessCode=e,this.connection=i,this.canceled=!!a}}function q8e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Y8e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function X8e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function J8e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function Q8e(n,e,i,a,l,u,f=!0){const _=Yoe(n.urlParams),E=n.url+_,S=Object.assign({},n.headers);return X8e(S,e),q8e(S,i),Y8e(S,u),J8e(S,a),new K8e(E,n.method,S,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z8e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function eWe(...n){const e=Z8e();if(e!==void 0){const i=new e;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(b3())return new Blob(n);throw new As(Is.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function tWe(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nWe(n){if(typeof atob>"u")throw j8e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class WU{constructor(e,i){this.data=e,this.contentType=i||null}}function rWe(n,e){switch(n){case rp.RAW:return new WU(Xoe(e));case rp.BASE64:case rp.BASE64URL:return new WU(Joe(n,e));case rp.DATA_URL:return new WU(sWe(e),oWe(e))}throw v3()}function Xoe(n){const e=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)e.push(a);else if(a<=2047)e.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=a,f=n.charCodeAt(++i);a=65536|(u&1023)<<10|f&1023,e.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?e.push(239,191,189):e.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(e)}function iWe(n){let e;try{e=decodeURIComponent(n)}catch{throw CC(rp.DATA_URL,"Malformed data URL.")}return Xoe(e)}function Joe(n,e){switch(n){case rp.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw CC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case rp.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw CC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=nWe(e)}catch(l){throw l.message.includes("polyfill")?l:CC(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class Qoe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw CC(rp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=aWe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=e.substring(e.indexOf(",")+1)}}function sWe(n){const e=new Qoe(n);return e.base64?Joe(rp.BASE64,e.rest):iWe(e.rest)}function oWe(n){return new Qoe(n).contentType}function aWe(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,i){let a=0,l="";CQ(e)?(this.data_=e,a=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),a=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),a=e.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(CQ(this.data_)){const a=this.data_,l=tWe(a,e,i);return l===null?null:new vg(l)}else{const a=new Uint8Array(this.data_.buffer,e,i-e);return new vg(a,!0)}}static getBlob(...e){if(b3()){const i=e.map(a=>a instanceof vg?a.data_:a);return new vg(eWe.apply(null,i))}else{const i=e.map(f=>S3(f)?rWe(rp.RAW,f).data:f.data_);let a=0;i.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let u=0;return i.forEach(f=>{for(let _=0;_<f.length;_++)l[u++]=f[_]}),new vg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zoe(n){let e;try{e=JSON.parse(n)}catch{return null}return H8e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cWe(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function lWe(n,e){const i=e.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function eae(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uWe(n,e){return e}class sc{constructor(e,i,a,l){this.server=e,this.local=i||e,this.writable=!!a,this.xform=l||uWe}}let sO=null;function dWe(n){return!S3(n)||n.length<2?n:eae(n)}function tae(){if(sO)return sO;const n=[];n.push(new sc("bucket")),n.push(new sc("generation")),n.push(new sc("metageneration")),n.push(new sc("name","fullPath",!0));function e(u,f){return dWe(f)}const i=new sc("name");i.xform=e,n.push(i);function a(u,f){return f!==void 0?Number(f):f}const l=new sc("size");return l.xform=a,n.push(l),n.push(new sc("timeCreated")),n.push(new sc("updated")),n.push(new sc("md5Hash",null,!0)),n.push(new sc("cacheControl",null,!0)),n.push(new sc("contentDisposition",null,!0)),n.push(new sc("contentEncoding",null,!0)),n.push(new sc("contentLanguage",null,!0)),n.push(new sc("contentType",null,!0)),n.push(new sc("metadata","customMetadata",!0)),sO=n,sO}function hWe(n,e){function i(){const a=n.bucket,l=n.fullPath,u=new Vl(a,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function pWe(n,e,i){const a={};a.type="file";const l=i.length;for(let u=0;u<l;u++){const f=i[u];a[f.local]=f.xform(a,e[f.server])}return hWe(a,n),a}function nae(n,e,i){const a=Zoe(e);return a===null?null:pWe(n,a,i)}function fWe(n,e,i,a){const l=Zoe(e);if(l===null||!S3(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const f=encodeURIComponent;return u.split(",").map(S=>{const w=n.bucket,I=n.fullPath,k="/b/"+f(w)+"/o/"+f(I),U=jN(k,i,a),L=Yoe({alt:"media",token:S});return U+L})[0]}function mWe(n,e){const i={},a=e.length;for(let l=0;l<a;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class T3{constructor(e,i,a,l){this.url=e,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rae(n){if(!n)throw v3()}function gWe(n,e){function i(a,l){const u=nae(n,l,e);return rae(u!==null),u}return i}function _We(n,e){function i(a,l){const u=nae(n,l,e);return rae(u!==null),fWe(u,l,n.host,n._protocol)}return i}function iae(n){function e(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=O8e():l=P8e():i.getStatus()===402?l=A8e(n.bucket):i.getStatus()===403?l=k8e(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return e}function sae(n){const e=iae(n);function i(a,l){let u=e(a,l);return a.getStatus()===404&&(u=I8e(n.path)),u.serverResponse=l.serverResponse,u}return i}function yWe(n,e,i){const a=e.fullServerUrl(),l=jN(a,n.host,n._protocol),u="GET",f=n.maxOperationRetryTime,_=new T3(l,u,_We(n,i),f);return _.errorHandler=sae(e),_}function EWe(n,e){const i=e.fullServerUrl(),a=jN(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function f(E,S){}const _=new T3(a,l,f,u);return _.successCodes=[200,204],_.errorHandler=sae(e),_}function vWe(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function SWe(n,e,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=e.size(),a.contentType||(a.contentType=vWe(null,e)),a}function bWe(n,e,i,a,l){const u=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function _(){let X="";for(let oe=0;oe<2;oe++)X=X+Math.random().toString().slice(2);return X}const E=_();f["Content-Type"]="multipart/related; boundary="+E;const S=SWe(e,a,l),w=mWe(S,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+w+`\r
--`+E+`\r
Content-Type: `+S.contentType+`\r
\r
`,k=`\r
--`+E+"--",U=vg.getBlob(I,a,k);if(U===null)throw U8e();const L={name:S.fullPath},F=jN(u,n.host,n._protocol),B="POST",q=n.maxUploadRetryTime,$=new T3(F,B,gWe(n,i),q);return $.urlParams=L,$.headers=f,$.body=U.uploadData(),$.errorHandler=iae(e),$}class TWe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Wy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Wy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Wy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,a,l){if(this.sent_)throw Ow("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ow("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ow("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ow("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ow("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class wWe extends TWe{initXhr(){this.xhr_.responseType="text"}}function w3(){return new wWe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e,i){this._service=e,i instanceof Vl?this._location=i:this._location=Vl.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new rE(e,i)}get root(){const e=new Vl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return eae(this._location.path)}get storage(){return this._service}get parent(){const e=cWe(this._location.path);if(e===null)return null;const i=new Vl(this._location.bucket,e);return new rE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw F8e(e)}}function CWe(n,e,i){n._throwIfRoot("uploadBytes");const a=bWe(n.storage,n._location,tae(),new vg(e,!0),i);return n.storage.makeRequestWithTokens(a,w3).then(l=>({metadata:l,ref:n}))}function RWe(n){n._throwIfRoot("getDownloadURL");const e=yWe(n.storage,n._location,tae());return n.storage.makeRequestWithTokens(e,w3).then(i=>{if(i===null)throw V8e();return i})}function IWe(n){n._throwIfRoot("deleteObject");const e=EWe(n.storage,n._location);return n.storage.makeRequestWithTokens(e,w3)}function AWe(n,e){const i=lWe(n._location.path,e),a=new Vl(n._location.bucket,i);return new rE(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PWe(n){return/^[A-Za-z]+:\/\//.test(n)}function OWe(n,e){return new rE(n,e)}function oae(n,e){if(n instanceof C3){const i=n;if(i._bucket==null)throw M8e();const a=new rE(i,i._bucket);return e!=null?oae(a,e):a}else return e!==void 0?AWe(n,e):n}function kWe(n,e){if(e&&PWe(e)){if(n instanceof C3)return OWe(n,e);throw Dj("To use ref(service, url), the first argument must be a Storage instance.")}else return oae(n,e)}function IQ(n,e){const i=e==null?void 0:e[Koe];return i==null?null:Vl.makeFromBucketSpec(i,n)}function NWe(n,e,i,a={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:bie(l,n.app.options.projectId))}class C3{constructor(e,i,a,l,u){this.app=e,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=$oe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=C8e,this._maxUploadRetryTime=R8e,this._requests=new Set,l!=null?this._bucket=Vl.makeFromBucketSpec(l,this._host):this._bucket=IQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Vl.makeFromBucketSpec(this._url,e):this._bucket=IQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){RQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){RQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Ll(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new rE(this,e)}_makeRequest(e,i,a,l,u=!0){if(this._deleted)return new B8e(qoe());{const f=Q8e(e,this._appId,a,l,i,this._firebaseVersion,u);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,a,l).getPromise()}}const AQ="@firebase/storage",PQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aae="storage";function R3(n,e,i){return n=Xi(n),CWe(n,e,i)}function FN(n){return n=Xi(n),RWe(n)}function I3(n){return n=Xi(n),IWe(n)}function dE(n,e){return n=Xi(n),kWe(n,e)}function hE(n=R5(),e){n=Xi(n);const a=fN(n,aae).getImmediate({identifier:e}),l=Eie("storage");return l&&DWe(a,...l),a}function DWe(n,e,i,a={}){NWe(n,e,i,a)}function xWe(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new C3(i,a,l,e,aE)}function LWe(){Qy(new Mg(aae,xWe,"PUBLIC").setMultipleInstances(!0)),dp(AQ,PQ,""),dp(AQ,PQ,"esm2017")}LWe();const zO=async n=>{const e=hE(),i=dE(e,n);try{return await FN(i)}catch(a){throw be.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let lR={};const kg=async n=>{try{const e=qi(ri,"spaces",n),i=await cc(e);if(i.exists()){let a=i.data();if(a.webglBuildId){const l=qi(ri,"webglBuilds",a.webglBuildId),u=await cc(l);if(u.exists()){const f=u.data();a={...a,...f}}else be.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await MWe(a),a=UWe(a),console.log("Space data:",a),be.log(`spacesFirestore: Caching space data for: ${n}`),lR[n]=a,a}else return be.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw be.error("spacesFirestore: Error fetching item data:",e),e}},MWe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await zO(l))});return await Promise.all(i),n},UWe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let zU={};const cae=async n=>{be.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(zU[n])return be.log("spacesFirestore: Returning cached videos for space:",n),zU[n];const e=Xf(ri,`spaces/${n}/videos`),i=await Gg(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),zU[n]=a,a}catch(e){throw be.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},VWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=hE(),a=Date.now(),l=e.name.split(".").pop(),u=`logo_${a}.${l}`,f=dE(i,`spaces/${n}/logo/${u}`);be.log(`Uploading logo for space ${n}`);const _=await R3(f,e),E=await FN(_.ref),S=qi(ri,"spaces",n);return await $u(S,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:u,updatedAt:new Date().toISOString()}),be.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw be.error("Error uploading space logo:",i),i}},jWe=async n=>{try{const e=qi(ri,"spaces",n),i=await cc(e);if(!i.exists())return be.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=hE(),u=dE(l,a.logoGsUrl);try{await I3(u),be.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){be.warn(`Could not delete logo file from storage: ${f.message}`)}}return await $u(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),be.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw be.error("Error deleting space logo:",e),e}},FWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=hE(),a=Date.now(),l=e.name.split(".").pop(),u=`background_${a}.${l}`,f=dE(i,`spaces/${n}/background/${u}`);be.log(`Uploading background for space ${n}`);const _=await R3(f,e),E=await FN(_.ref),S=qi(ri,"spaces",n);return await $u(S,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:u,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),be.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw be.error("Error uploading space background:",i),i}},BWe=async n=>{try{const e=qi(ri,"spaces",n),i=await cc(e);if(!i.exists())return be.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=hE(),u=dE(l,a.backgroundGsUrl);try{await I3(u),be.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){be.warn(`Could not delete background file from storage: ${f.message}`)}}return await $u(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),be.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw be.error("Error deleting space background:",e),e}},WWe=async(n,e)=>{try{be.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=qi(ri,"spaces",n),a=await cc(i);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),u={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await $u(i,u),lR[n]&&delete lR[n],be.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw be.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},zWe=async(n,e)=>{try{be.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=qi(ri,"spaces",n);if(!(await cc(i)).exists())throw new Error(`Space with ID ${n} not found`);await $u(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),lR[n]&&delete lR[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),be.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw be.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},ul=D.createContext(null),FR=({children:n})=>{const[e,i]=D.useState(null),a=D.useRef(null),[l,u]=D.useState(!0),f=yN(),_=$=>$?$.Nickname?$.Nickname:`${$.firstName} ${$.lastName}`:"Anon";D.useEffect(()=>{const $=Zie(f,async X=>{if(be.log("UserProvider: Firebase onAuthStateChanged() fired"),X)try{const oe=await Ep(X.uid),re=_(oe),pe={uid:X.uid,email:X.email,emailVerified:X.emailVerified,...oe,displayName:re};console.log(pe),i(pe),a.current=pe,I(pe)}catch(oe){be.error("UserProvider: Error fetching user profile data:",oe)}else i(null),a.current=null;u(!1)});return()=>{$&&$()}},[]);const E=async($,X,oe)=>{try{const{firstName:re,lastName:pe}=oe,te=`${re}${pe.charAt(0).toUpperCase()}`,Z={...oe,Nickname:te,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},ne=await S8e($,X,Z),ae=_(Z),me={uid:ne.uid,email:ne.email,...Z,displayName:ae};return i(me),a.current=me,be.log("UserProvider: User registered successfully with groups:",Z.groups),me}catch(re){throw be.error("UserProvider: Error creating user:",re),re}},S=async($,X)=>{try{const oe=await H5e(f,$,X),re=await Ep(oe.user.uid),pe=_(re),te={uid:oe.user.uid,email:oe.user.email,emailVerified:oe.user.emailVerified,...re,displayName:pe};i(te),I(te)}catch(oe){throw be.error("UserProvider: Error signing in:",oe),oe}},w=async()=>{try{await Y5e(f),i(null),be.log("UserProvider: User signed out.")}catch($){throw be.error("UserProvider: Error signing out:",$),$}},I=()=>{const $=a.current;if($){const X=k($);be.log("UserProvider: sendUserToUnity() using the eventBus",X),Kd.publish($d.sendUserToUnity,X)}else be.log("UserProvider: No current user to send to Unity.")},k=$=>{const X={};return[...T8e,"uid"].forEach(re=>{$.hasOwnProperty(re)&&(X[re]=$[re])}),X},U=async $=>!e||!e.uid?!1:await Hoe(e.uid,$),L=async $=>{if(!e||!e.uid)return!1;try{const X=await kg($);if(X.usersAllowed.includes(e.uid)||X.userAdmin.includes(e.uid)||X.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const re=`space_${$}_owners`,pe=`space_${$}_hosts`;if(e.groups.includes(re)||e.groups.includes(pe))return be.log(`UserProvider: User ${e.uid} has access to space ${$} as owner/host`),!0}return X.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(X){return be.error("UserProvider: Error verifying user access to space:",X),!1}},F=async $=>{if(!e||!e.uid)return!1;try{return(await kg($)).userAdmin.includes(e.uid)}catch(X){return be.error("UserProvider: Error verifying user admin status for space:",X),!1}},B=async $=>{if(!e||!e.uid)return!1;try{return(await kg($)).usersModerators.includes(e.uid)}catch(X){return be.error("UserProvider: Error verifying user moderator status for space:",X),!1}},q=async()=>{try{const $=f.currentUser;return $&&!$.emailVerified?(await $5e($),be.log("UserProvider: Verification email resent to:",$.email),!0):!1}catch($){throw be.error("UserProvider: Error resending verification email:",$),$}};return b.jsx(ul.Provider,{value:{user:e,loading:l,register:E,signIn:S,signOut:w,sendUserToUnity:I,isUserInGroup:U,userHasAccessToSpace:L,userIsAdminOfSpace:F,userIsModeratorOfSpace:B,resendVerificationEmail:q},children:n})},lae=D.createContext(),Jd=()=>D.useContext(lae),BR=({children:n})=>{const[e,i]=D.useState(!1),a=D.useRef(null),[l,u]=D.useState(!1);D.useEffect(()=>{const E=()=>{const S=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(S)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const f=D.useCallback(E=>{a.current=E},[]),_=D.useCallback(()=>{const E=a.current;if(!E)return;const S=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const w=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(w.webkitEnterFullscreen)try{w.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(w.webkitRequestFullscreen){w.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{S?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{S?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(w=>console.error("Error exiting fullscreen:",w)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(w=>console.error("Error entering fullscreen:",w)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(w){console.error("Fullscreen error:",w)}},[l]);return D.useEffect(()=>{const E=()=>{const S=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!S)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),b.jsx(lae.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:b.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},GWe=Xf(ri,"website"),HWe=async()=>{const n=await Gg(GWe),e={};return n.forEach(i=>{e[i.id]=i.data()}),e},A3=async n=>{const e=qi(ri,"website",n),i=await cc(e);return i.exists()?i.data():null},uae=async(n,e)=>{const i=qi(ri,"website",n);return(await cc(i)).exists()?await $u(i,e):await Ok(i,e),!0},dae=D.createContext(),hae=()=>D.useContext(dae),$We=({children:n})=>{const[e,i]=D.useState({}),[a,l]=D.useState(!0),[u,f]=D.useState(null);D.useEffect(()=>{(async()=>{try{l(!0);const w=await HWe();i(w),f(null)}catch(w){console.error("Error loading website content:",w),f(w.message)}finally{l(!1)}})()},[]);const E={content:e,loading:a,error:u,getContent:async S=>{if(e[S])return e[S];try{const w=await A3(S);return w&&i(I=>({...I,[S]:w})),w}catch(w){return console.error(`Error fetching content for ${S}:`,w),f(w.message),null}}};return b.jsx(dae.Provider,{value:E,children:n})},KWe=Rxe({colors:{brand:{50:"#e0f2ff",100:"#b0d5ff",200:"#80b9ff",300:"#509eff",400:"#2084ff",500:"#0080ff",600:"#0059b3",700:"#003d80",800:"#00264d",900:"#00101f"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"}},fonts:{heading:"'Montserrat', sans-serif",body:"'Lato', sans-serif"},styles:{global:{body:{bg:"white",color:"gray.800"}}},components:{Button:{baseStyle:{fontWeight:"medium"},variants:{solid:{bg:"brand.500",color:"white",_hover:{bg:"brand.600"}}}},Link:{baseStyle:{_hover:{textDecoration:"none",color:"brand.500"}}}}}),qWe=({videoSrc:n})=>(n==null?void 0:n.includes("vimeo.com"))?b.jsx(Xe,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",children:b.jsx(Xe,{as:"iframe",src:`${n}&background=1&autoplay=1&loop=1&byline=0&title=0&muted=1`,frameBorder:"0",allow:"autoplay; fullscreen",loading:"lazy",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:"100%",minHeight:"100%",width:"auto",height:"auto",objectFit:"cover",overflow:"hidden","@media (max-width: 768px)":{width:"250%",height:"250%"},"@media (min-width: 769px) and (max-width: 1200px)":{width:"150%",height:"150%"},"@media (min-width: 1201px)":{width:"100%",height:"120%"}}})}):b.jsx(Xe,{as:"video",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,position:"absolute",top:"0",left:"0",width:"100%",height:"100%",sx:{objectFit:"cover",objectPosition:"center center",minWidth:"100%",minHeight:"100%"},src:n}),YWe=()=>{var u;const{content:n,loading:e,getContent:i}=hae(),[a,l]=D.useState(null);return D.useEffect(()=>{(async()=>{let _=n==null?void 0:n.homepage;_||(_=await i("homepage")),l(_)})()},[n,i]),e||!a?b.jsx(Zk,{h:"100vh",children:b.jsx(la,{size:"xl"})}):b.jsxs(b.Fragment,{children:[b.jsxs(Q0,{children:[b.jsx("title",{children:a.title}),b.jsx("meta",{name:"description",content:a.description})]}),b.jsxs(Xe,{position:"relative",height:{base:"100vh",md:"100vh"},width:"100%",overflow:"hidden",children:[b.jsx(qWe,{videoSrc:a.videoSrc}),b.jsx(Xe,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.5)",zIndex:"1"}),b.jsx(sr,{height:"100%",width:"100%",position:"relative",zIndex:"2",align:"center",justify:"center",px:4,children:b.jsx(br,{as:"h1",color:"white",fontSize:{base:"4xl",sm:"5xl",md:"6xl"},fontWeight:"bold",textAlign:"center",children:a.heroHeading})})]}),b.jsx(Xe,{as:"section",py:16,children:b.jsx(Wl,{maxW:"container.xl",children:b.jsxs(eN,{templateColumns:{base:"1fr",md:"1fr 1fr"},gap:10,children:[b.jsxs(YC,{children:[b.jsx(br,{as:"h2",fontSize:"2xl",fontWeight:"normal",color:"gray.500",mb:3,children:a.missionHeading}),b.jsx(br,{as:"h1",fontSize:{base:"4xl",md:"5xl"},fontWeight:"bold",children:a.missionTitle})]}),b.jsxs(YC,{children:[b.jsx(Xe,{mb:8,children:(u=a.missionPoints)==null?void 0:u.map((f,_)=>b.jsx(et,{fontSize:"xl",mb:3,children:f},_))}),b.jsxs(sr,{align:"center",children:[b.jsx(Lu,{to:"/about",style:{color:"#0080ff",fontWeight:500,marginRight:"10px"},children:a.learnMoreText}),b.jsx(Xe,{as:"svg",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",fill:"#0080ff",children:b.jsx("path",{d:"M10 20A10 10 0 1 0 0 10a10 10 0 0 0 10 10zM8.711 4.3l5.7 5.766L8.7 15.711l-1.4-1.422 4.289-4.242-4.3-4.347z"})})]})]})]})})})]})},XWe=()=>{const{content:n,loading:e,getContent:i}=hae(),[a,l]=D.useState(null);D.useEffect(()=>{(async()=>{let E=n==null?void 0:n.aboutpage;E||(E=await i("aboutpage")),l(E)})()},[n,i]);const f=a||{title:"About Spaces",description:"Learn about the Spaces platform, our vision, and how we empower virtual collaboration and connection.",tagline:"A platform for creating virtual spaces that bring people together.",whoWeAre:{title:"Who We Are",content:"We create metaverses that are simple, accessible, and limitless. Our platform is focused on ease of use, designed for everyone, and built for creativity and connection."},ourVision:{title:"Our Vision",content:"To empower everyone to build their own virtual spaces, tailored to their needs. Whether you need public or private options, fully customizable environments, our platform offers limitless possibilities."},whatWeOffer:{title:"What We Offer",content:"Open spaces for exploration, exclusive environments for privacy, and powerful tools to shape your world exactly as you imagine it."},howItWorks:{title:"How It Works",content:"Accessible on any device, our metaverses are easy to customize and share. No downloads required - everything runs seamlessly in web browsers with simple tools for building and sharing."},contactSection:{title:"Reach Out",intro:"Interested in learning more about our spaces? Have questions about how it works? We'd love to hear from you and help you get started on your journey.",callToAction:"Fill out the form and we'll get back to you as soon as possible."},images:{topImage:"/images/Space-office-example-2-min.jpg",bottomImage:"/images/Spaces-Office-example-min.jpg"}};return e&&!a?b.jsx(Zk,{h:"100vh",children:b.jsx(la,{size:"xl"})}):b.jsxs(b.Fragment,{children:[b.jsxs(Q0,{children:[b.jsx("title",{children:f.title}),b.jsx("meta",{name:"description",content:f.description})]}),b.jsx(Wl,{maxW:"container.xl",py:10,children:b.jsxs(gr,{spacing:10,align:"stretch",children:[b.jsxs(Xe,{textAlign:"center",children:[b.jsx(br,{as:"h1",size:"2xl",mb:6,children:f.title}),b.jsx(et,{fontSize:"xl",children:f.tagline})]}),b.jsxs(Ky,{columns:{base:1,md:2},spacing:10,children:[b.jsx(Xe,{children:b.jsx(Va,{src:f.images.topImage,alt:"Office Space Example",borderRadius:"md",width:"100%"})}),b.jsxs(gr,{align:"start",spacing:6,children:[b.jsxs(Xe,{children:[b.jsx(br,{as:"h2",size:"xl",mb:4,children:f.whoWeAre.title}),b.jsx(et,{children:f.whoWeAre.content})]}),b.jsxs(Xe,{children:[b.jsx(br,{as:"h2",size:"xl",mb:4,children:f.ourVision.title}),b.jsx(et,{children:f.ourVision.content})]})]})]}),b.jsxs(Ky,{columns:{base:1,md:2},spacing:10,pt:10,children:[b.jsxs(gr,{align:"start",spacing:6,children:[b.jsxs(Xe,{children:[b.jsx(br,{as:"h2",size:"xl",mb:4,children:f.whatWeOffer.title}),b.jsx(et,{children:f.whatWeOffer.content})]}),b.jsxs(Xe,{children:[b.jsx(br,{as:"h2",size:"xl",mb:4,children:f.howItWorks.title}),b.jsx(et,{children:f.howItWorks.content})]})]}),b.jsx(Xe,{children:b.jsx(Va,{src:f.images.bottomImage,alt:"Another Office Space Example",borderRadius:"md",width:"100%"})})]}),b.jsxs(Xe,{bg:"blue.50",p:10,borderRadius:"md",mt:10,children:[b.jsx(br,{as:"h2",size:"xl",mb:6,textAlign:"center",children:f.contactSection.title}),b.jsxs(sr,{direction:{base:"column",md:"row"},justify:"space-between",gap:8,children:[b.jsxs(gr,{align:"start",spacing:4,flex:1,children:[b.jsx(et,{fontSize:"lg",children:f.contactSection.intro}),b.jsx(et,{fontSize:"lg",children:f.contactSection.callToAction})]}),b.jsx(Xe,{flex:1,bg:"white",p:6,borderRadius:"md",children:b.jsx(gr,{spacing:4,children:b.jsx(et,{children:"Contact form placeholder"})})})]})]})]})})]})},JWe=Qf({d:"M23.384,21.619,16.855,15.09a9.284,9.284,0,1,0-1.768,1.768l6.529,6.529a1.266,1.266,0,0,0,1.768,0A1.251,1.251,0,0,0,23.384,21.619ZM2.75,9.5a6.75,6.75,0,1,1,6.75,6.75A6.758,6.758,0,0,1,2.75,9.5Z",displayName:"SearchIcon"}),QWe=Qf({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),ZWe=Qf({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),eze=Qf({displayName:"DeleteIcon",path:b.jsx("g",{fill:"currentColor",children:b.jsx("path",{d:"M19.452 7.5H4.547a.5.5 0 00-.5.545l1.287 14.136A2 2 0 007.326 24h9.347a2 2 0 001.992-1.819L19.95 8.045a.5.5 0 00-.129-.382.5.5 0 00-.369-.163zm-9.2 13a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zm5 0a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zM22 4h-4.75a.25.25 0 01-.25-.25V2.5A2.5 2.5 0 0014.5 0h-5A2.5 2.5 0 007 2.5v1.25a.25.25 0 01-.25.25H2a1 1 0 000 2h20a1 1 0 000-2zM9 3.75V2.5a.5.5 0 01.5-.5h5a.5.5 0 01.5.5v1.25a.25.25 0 01-.25.25h-5.5A.25.25 0 019 3.75z"})})}),tze=Qf({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),nze=Qf({displayName:"EmailIcon",path:b.jsxs("g",{fill:"currentColor",children:[b.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),b.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),pae=Qf({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),rze=Qf({displayName:"QuestionOutlineIcon",path:b.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[b.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),b.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),b.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),fae=Qf({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),ize=[{id:"sample1",name:"Conference Room",description:"Professional virtual meeting space for team collaboration.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}},{id:"sample2",name:"Art Gallery",description:"Immersive gallery for showcasing digital art and exhibitions.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}},{id:"sample3",name:"Social Lounge",description:"Casual environment for social gatherings and networking events.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}}],GU={id:"thepotato",name:"Spaces Metaverse",description:"Welcome to the Spaces Metaverse! This is our first test space where you can explore and interact with the virtual environment. We plan to add more functionality as we go. Please check back soon for updates.",visibility:"public",createdAt:{toDate:()=>new Date("2025-03-15")},createdBy:{displayName:"Disruptive Live"},category:"development",thumbnailUrl:"https://placehold.co/400x200?text=Spaces+Metaverse"};function sze(){const[n,e]=D.useState([]),[i,a]=D.useState(!0),[l,u]=D.useState(null),[f,_]=D.useState(""),[E,S]=D.useState(null);D.useEffect(()=>{async function L(){try{a(!0),console.log("Fetching spaces from Firebase...");const F=cR(Xf(ri,"spaces"),d8e(50));console.log("Executing Firebase query:",F);const B=await Gg(F);console.log("Query snapshot size:",B.size),B.forEach(X=>{console.log("Found space document:",X.id,X.data())});const q=[];B.forEach(X=>{const oe=X.data();if(oe){const re={id:X.id,...oe,name:oe.name||`Space ${X.id}`,description:oe.description||"No description available",visibility:oe.visibility||"public"};q.push(re)}}),console.log(`Found ${q.length} spaces in Firebase:`,q),q.sort((X,oe)=>{var te,Z,ne,ae;const re=((Z=(te=X.createdAt)==null?void 0:te.toDate)==null?void 0:Z.call(te))||new Date(0);return(((ae=(ne=oe.createdAt)==null?void 0:ne.toDate)==null?void 0:ae.call(ne))||new Date(0))-re}),q.some(X=>X.id==="thepotato")||(console.log("Adding potato space data to the list"),q.push(GU)),e(q),S({spacesCount:q.length,firstSpace:q.length>0?q[0].id:"none",allSpaceIds:q.map(X=>X.id),firebaseQuerySize:B.size})}catch(F){console.error("Error fetching spaces:",F),S({error:F.message,code:F.code,stack:F.stack}),F.code==="permission-denied"||F.message.includes("requires an index")?(console.log("Using sample spaces data due to Firebase error:",F.message),e([...ize,GU])):(u(`Failed to load spaces: ${F.message}`),e([GU]))}finally{a(!1)}}L()},[]);const w=n.filter(L=>L&&L.name&&L.name.toLowerCase().includes(f.toLowerCase())||L&&L.description&&L.description.toLowerCase().includes(f.toLowerCase())),I=(L,F)=>!L||!F?"unknown-space":F==="thepotato"?"the-potato-website":`${L.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}_${F}`,k=w.map(L=>L?{...L,calculatedSlug:L.slug||I(L.name,L.id)}:null).filter(Boolean),U=k.filter(L=>L&&L.slug);return i?b.jsx(Xe,{height:"50vh",display:"flex",alignItems:"center",justifyContent:"center",children:b.jsx(la,{size:"xl",color:"brand.500",thickness:"4px"})}):b.jsxs(b.Fragment,{children:[b.jsxs(Q0,{children:[b.jsx("title",{children:"Explore Spaces | Disruptive Spaces"}),b.jsx("meta",{name:"description",content:"Explore virtual spaces created by our community"})]}),b.jsx(Xe,{py:10,children:b.jsx(Wl,{maxW:"container.xl",children:b.jsxs(tl,{spacing:8,children:[b.jsx(br,{as:"h1",size:"xl",children:"Explore Spaces"}),b.jsxs(A0,{children:[b.jsx(qy,{pointerEvents:"none",children:b.jsx(JWe,{color:"gray.400"})}),b.jsx(pr,{placeholder:"Search spaces...",value:f,onChange:L=>_(L.target.value),bg:"white",borderRadius:"md",boxShadow:"sm"})]}),l&&b.jsxs(Vu,{status:"error",borderRadius:"md",children:[b.jsx(ju,{}),b.jsx(et,{children:l})]}),E&&b.jsxs(Vu,{status:"info",borderRadius:"md",variant:"subtle",children:[b.jsx(ju,{}),b.jsxs(Xe,{children:[b.jsx(et,{fontWeight:"bold",children:"Debug Info:"}),b.jsx(Qw,{children:JSON.stringify(E,null,2)})]})]}),b.jsxs(W1,{overflow:"hidden",variant:"outline",boxShadow:"md",children:[b.jsx(Xe,{p:4,bg:"blue.50",children:b.jsx(br,{size:"md",children:"Spaces with Defined Slugs"})}),b.jsx(z1,{children:U.length===0?b.jsxs(Vu,{status:"info",borderRadius:"md",children:[b.jsx(ju,{}),b.jsx(et,{children:"No spaces with defined slugs found. Add a 'slug' property to your spaces in Firebase."})]}):b.jsx(tl,{spacing:3,children:U.map(L=>b.jsx(Xe,{p:3,borderWidth:"1px",borderRadius:"md",children:b.jsxs(sr,{justify:"space-between",wrap:"wrap",gap:2,children:[b.jsxs(Xe,{children:[b.jsx(et,{fontWeight:"bold",children:L.name}),b.jsxs(et,{fontSize:"sm",color:"gray.500",children:["ID: ",L.id]})]}),b.jsxs(Xe,{children:[b.jsx(et,{fontSize:"sm",fontWeight:"bold",children:"Slug:"}),b.jsx(Qw,{p:1,children:L.slug})]}),b.jsx(Ar,{as:Lu,to:`/w/${L.slug}`,size:"sm",colorScheme:"blue",children:"Visit"})]})},L.id))})})]}),b.jsxs(W1,{overflow:"hidden",variant:"outline",boxShadow:"md",children:[b.jsx(Xe,{p:4,bg:"gray.50",children:b.jsx(br,{size:"md",children:"All Spaces (with calculated slugs)"})}),b.jsx(z1,{children:b.jsx(tl,{spacing:3,children:k.map(L=>b.jsx(Xe,{p:3,borderWidth:"1px",borderRadius:"md",children:b.jsxs(sr,{justify:"space-between",wrap:"wrap",gap:2,children:[b.jsxs(Xe,{children:[b.jsx(et,{fontWeight:"bold",children:L.name}),b.jsxs(et,{fontSize:"sm",color:"gray.500",children:["ID: ",L.id]})]}),b.jsxs(Xe,{children:[b.jsx(et,{fontSize:"sm",fontWeight:"bold",children:L.slug?"Defined Slug:":"Calculated Slug:"}),b.jsx(Qw,{p:1,bg:L.slug?"green.50":"gray.50",children:L.calculatedSlug})]}),b.jsx(Ar,{as:Lu,to:`/w/${L.calculatedSlug}`,size:"sm",colorScheme:L.slug?"green":"blue",children:"Visit"})]})},L.id))})})]}),b.jsxs(W1,{overflow:"hidden",variant:"outline",boxShadow:"md",bg:"yellow.50",children:[b.jsx(Xe,{p:4,bg:"yellow.100",children:b.jsx(br,{size:"md",children:"Test Space: The Potato Website"})}),b.jsx(z1,{children:b.jsx(et,{color:"gray.600",mb:4,children:'This is a special test space with ID "thepotato" and slug "the-potato-website".'})}),b.jsx(dX,{children:b.jsx(Ar,{as:Lu,to:"/w/the-potato-website",colorScheme:"yellow",width:"100%",children:"Enter Test Space"})})]}),w.length===0?b.jsxs(Vu,{status:"info",borderRadius:"md",children:[b.jsx(ju,{}),b.jsx(et,{children:"No spaces found. Try a different search term or check back later."})]}):b.jsx(Ky,{columns:{base:1,md:2,lg:3},spacing:6,children:w.map(L=>b.jsxs(W1,{overflow:"hidden",variant:"outline",boxShadow:"md",children:[b.jsx(Va,{src:L.backgroundUrl||L.thumbnailUrl||`https://placehold.co/400x200?text=${encodeURIComponent(L.name)}`,alt:L.name,height:"200px",objectFit:"cover"}),b.jsx(z1,{children:b.jsxs(tl,{spacing:2,children:[b.jsxs(sr,{justify:"space-between",align:"center",children:[b.jsx(br,{size:"md",children:L.name}),b.jsx(zd,{colorScheme:"green",children:"Public"})]}),b.jsx(et,{color:"gray.600",noOfLines:2,children:L.description||"No description available"}),b.jsxs(et,{fontSize:"sm",color:"gray.500",children:["ID: ",L.id]}),b.jsxs(et,{fontSize:"sm",color:"gray.500",children:["Slug: ",b.jsx(Qw,{p:1,children:L.calculatedSlug})]})]})}),b.jsx(dX,{children:b.jsx(Ar,{as:Lu,to:`/w/${L.calculatedSlug}`,colorScheme:"blue",width:"100%",children:"Enter Space"})})]},L.id))})]})})})]})}var HU={},kw={},Nw={},OQ;function oze(){if(OQ)return Nw;OQ=1,Object.defineProperty(Nw,"__esModule",{value:!0}),Nw.useUnityCanvasId=void 0;var n=Bu(),e=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var u=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return u};return Nw.useUnityCanvasId=a,Nw}var Tf={},Dw={},kQ;function mae(){if(kQ)return Dw;kQ=1,Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(Dw.UnityLoaderStatus=n={})),Dw}var xw={},NQ;function P3(){return NQ||(NQ=1,Object.defineProperty(xw,"__esModule",{value:!0}),xw.isBrowserEnvironment=void 0,xw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),xw}var DQ;function aze(){if(DQ)return Tf;DQ=1;var n=Tf&&Tf.__awaiter||function(f,_,E,S){function w(I){return I instanceof E?I:new E(function(k){k(I)})}return new(E||(E=Promise))(function(I,k){function U(B){try{F(S.next(B))}catch(q){k(q)}}function L(B){try{F(S.throw(B))}catch(q){k(q)}}function F(B){B.done?I(B.value):w(B.value).then(U,L)}F((S=S.apply(f,_||[])).next())})},e=Tf&&Tf.__generator||function(f,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},S,w,I,k=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return k.next=U(0),k.throw=U(1),k.return=U(2),typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function U(F){return function(B){return L([F,B])}}function L(F){if(S)throw new TypeError("Generator is already executing.");for(;k&&(k=0,F[0]&&(E=0)),E;)try{if(S=1,w&&(I=F[0]&2?w.return:F[0]?w.throw||((I=w.return)&&I.call(w),0):w.next)&&!(I=I.call(w,F[1])).done)return I;switch(w=0,I&&(F=[F[0]&2,I.value]),F[0]){case 0:case 1:I=F;break;case 4:return E.label++,{value:F[1],done:!1};case 5:E.label++,w=F[1],F=[0];continue;case 7:F=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(F[0]===6||F[0]===2)){E=0;continue}if(F[0]===3&&(!I||F[1]>I[0]&&F[1]<I[3])){E.label=F[1];break}if(F[0]===6&&E.label<I[1]){E.label=I[1],I=F;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(F);break}I[2]&&E.ops.pop(),E.trys.pop();continue}F=_.call(f,E)}catch(B){F=[6,B],w=0}finally{S=I=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.useUnityInstance=void 0;var i=Bu(),a=mae(),l=P3(),u=function(f,_,E,S){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var w,I;return e(this,function(k){switch(k.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||_===null)return S.setUnityInstance(null),S.setInitialisationError(null),[2];k.label=1;case 1:return k.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,S.setLoadingProgression)];case 2:return w=k.sent(),S.setUnityInstance(w),S.setInitialisationError(null),[3,4];case 3:return I=k.sent(),S.setUnityInstance(null),S.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,_,E,S])};return Tf.useUnityInstance=u,Tf}var Lw={},xQ;function cze(){if(xQ)return Lw;xQ=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.useUnityArguments=void 0;var n=Bu(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Lw.useUnityArguments=e,Lw}var Mw={},LQ;function lze(){if(LQ)return Mw;LQ=1,Object.defineProperty(Mw,"__esModule",{value:!0}),Mw.useUnityLoader=void 0;var n=Bu(),e=P3(),i=mae(),a=function(l){var u=(0,n.useState)(i.UnityLoaderStatus.Loading),f=u[0],_=u[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var S=function(w){return _(w.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",S),E.addEventListener("error",S),function(){E!==null&&(E.removeEventListener("load",S),E.removeEventListener("error",S),window.document.body.removeChild(E))}}},[l.loaderUrl]),f};return Mw.useUnityLoader=a,Mw}var MQ;function uze(){if(MQ)return kw;MQ=1,Object.defineProperty(kw,"__esModule",{value:!0}),kw.Unity=void 0;var n=Bu(),e=Bu(),i=oze(),a=aze(),l=cze(),u=lze(),f=(0,e.forwardRef)(function(_,E){var S=(0,e.useRef)(null),w=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),k=(0,u.useUnityLoader)(_.unityProvider.unityConfig);return(0,a.useUnityInstance)(k,S.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return S.current}),(0,n.createElement)("canvas",{ref:S,id:w,style:_.style,className:_.className,tabIndex:_.tabIndex})});return kw.Unity=f,kw}var wf={},Uw={},UQ;function gae(){if(UQ)return Uw;UQ=1,Object.defineProperty(Uw,"__esModule",{value:!0}),Uw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Uw.errorMessages=n,Uw}var by={},VQ;function dze(){if(VQ)return by;VQ=1;var n=by&&by.__spreadArray||function(_,E,S){if(S||arguments.length===2)for(var w=0,I=E.length,k;w<I;w++)(k||!(w in E))&&(k||(k=Array.prototype.slice.call(E,0,w)),k[w]=E[w]);return _.concat(k||Array.prototype.slice.call(E))};Object.defineProperty(by,"__esModule",{value:!0}),by.useEventSystem=void 0;var e=Bu(),i=gae(),a=P3(),l=[],u=function(_){for(var E=[],S=1;S<arguments.length;S++)E[S-1]=arguments[S];var w=void 0;return l.forEach(function(I){w=I.apply(void 0,n([_],E,!1))}),w};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=u);var f=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,k){_.current=n(n([],_.current,!0),[{eventName:I,callback:k}],!1)},[_]),S=(0,e.useCallback)(function(I,k){_.current=_.current.filter(function(U){return U.eventName!==I&&U.callback!==k})},[_]),w=(0,e.useCallback)(function(I){for(var k=[],U=1;U<arguments.length;U++)k[U-1]=arguments[U];var L=_.current.find(function(F){return F.eventName===I});if(typeof L>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return L.callback.apply(L,k)},[_]);return(0,e.useEffect)(function(){return l.push(w),function(){l.splice(l.indexOf(w),1)}},[w]),{addEventListener:E,removeEventListener:S}};return by.useEventSystem=f,by}var Vw={},jQ;function hze(){if(jQ)return Vw;jQ=1,Object.defineProperty(Vw,"__esModule",{value:!0}),Vw.useNullableState=void 0;var n=Bu(),e=function(i){return(0,n.useState)(i||null)};return Vw.useNullableState=e,Vw}var FQ;function pze(){if(FQ)return wf;FQ=1;var n=wf&&wf.__awaiter||function(_,E,S,w){function I(k){return k instanceof S?k:new S(function(U){U(k)})}return new(S||(S=Promise))(function(k,U){function L(q){try{B(w.next(q))}catch($){U($)}}function F(q){try{B(w.throw(q))}catch($){U($)}}function B(q){q.done?k(q.value):I(q.value).then(L,F)}B((w=w.apply(_,E||[])).next())})},e=wf&&wf.__generator||function(_,E){var S={label:0,sent:function(){if(k[0]&1)throw k[1];return k[1]},trys:[],ops:[]},w,I,k,U=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return U.next=L(0),U.throw=L(1),U.return=L(2),typeof Symbol=="function"&&(U[Symbol.iterator]=function(){return this}),U;function L(B){return function(q){return F([B,q])}}function F(B){if(w)throw new TypeError("Generator is already executing.");for(;U&&(U=0,B[0]&&(S=0)),S;)try{if(w=1,I&&(k=B[0]&2?I.return:B[0]?I.throw||((k=I.return)&&k.call(I),0):I.next)&&!(k=k.call(I,B[1])).done)return k;switch(I=0,k&&(B=[B[0]&2,k.value]),B[0]){case 0:case 1:k=B;break;case 4:return S.label++,{value:B[1],done:!1};case 5:S.label++,I=B[1],B=[0];continue;case 7:B=S.ops.pop(),S.trys.pop();continue;default:if(k=S.trys,!(k=k.length>0&&k[k.length-1])&&(B[0]===6||B[0]===2)){S=0;continue}if(B[0]===3&&(!k||B[1]>k[0]&&B[1]<k[3])){S.label=B[1];break}if(B[0]===6&&S.label<k[1]){S.label=k[1],k=B;break}if(k&&S.label<k[2]){S.label=k[2],S.ops.push(B);break}k[2]&&S.ops.pop(),S.trys.pop();continue}B=E.call(_,S)}catch(q){B=[6,q],I=0}finally{w=k=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(wf,"__esModule",{value:!0}),wf.useUnityContext=void 0;var i=Bu(),a=gae(),l=dze(),u=hze(),f=function(_){var E=(0,u.useNullableState)(),S=E[0],w=E[1],I=(0,i.useState)(0),k=I[0],U=I[1],L=(0,i.useState)(!1),F=L[0],B=L[1],q=(0,u.useNullableState)(),$=q[0],X=q[1],oe=(0,l.useEventSystem)(),re=(0,i.useRef)({setLoadingProgression:U,setInitialisationError:X,setUnityInstance:w,setIsLoaded:B,unityConfig:_}),pe=(0,i.useCallback)(function(he){if(S===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}S.SetFullscreen(he===!0?1:0)},[S]),te=(0,i.useCallback)(function(){if(S===null||typeof S.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return S.Module.canvas.requestPointerLock()},[S]),Z=(0,i.useCallback)(function(he,ue,Ue){if(S===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}S.SendMessage(he,ue,Ue)},[S]),ne=(0,i.useCallback)(function(he,ue){if(S===null||typeof S.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return S.Module.canvas.toDataURL(he,ue)},[S]),ae=(0,i.useCallback)(function(){return S===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):S.Quit()},[S]),me=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var he;return e(this,function(ue){switch(ue.label){case 0:return S===null||typeof S.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=S.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,ae()]);case 1:return ue.sent(),he.remove(),[2]}})})},[S]);return(0,i.useEffect)(function(){B(k===1)},[k]),{unityProvider:re.current,loadingProgression:k,initialisationError:$,isLoaded:F,UNSAFE__unityInstance:S,requestFullscreen:pe,requestPointerLock:te,sendMessage:Z,takeScreenshot:ne,unload:ae,UNSAFE__detachAndUnloadImmediate:me,addEventListener:oe.addEventListener,removeEventListener:oe.removeEventListener}};return wf.useUnityContext=f,wf}var BQ;function fze(){return BQ||(BQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=uze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=pze();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(HU)),HU}var _ae=fze();const Ud="[UnityProvider]",xj=D.createContext(),mze=({spaceID:n,children:e,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u,loadingBackground:f,showLoginButton:_,showDisruptiveLogo:E})=>{be.log(`${Ud} Initializing with spaceID:`,n),be.log(`${Ud} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u});const{unityProvider:S,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:U,removeEventListener:L,error:F}=_ae.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u}),B={unityProvider:S,loadingProgression:w,isLoaded:I,sendMessage:k,addEventListener:U,removeEventListener:L,error:F,spaceID:n},q=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const pe=()=>{document.hidden?(be.log(`${Ud} Page hidden, starting keep-alive`),X()):(be.log(`${Ud} Page visible, stopping keep-alive`),oe())};return document.addEventListener("visibilitychange",pe),()=>{document.removeEventListener("visibilitychange",pe),oe()}},[]),D.useEffect(()=>{const pe=()=>{$.current=Date.now(),document.hidden&&k("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",pe),window.addEventListener("keydown",pe),window.addEventListener("touchstart",pe),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("keydown",pe),window.removeEventListener("touchstart",pe)}},[k]);const X=()=>{q.current||(q.current=setInterval(()=>{I&&document.hidden&&(k("WebGLInputManager","KeepAlive"),be.debug(`${Ud} Sent keep-alive message`))},1e4))},oe=()=>{q.current&&(clearInterval(q.current),q.current=null)};D.useEffect(()=>(be.log(`${Ud} Component mounted`),()=>{be.log(`${Ud} Component unmounting`),oe()}),[]),D.useEffect(()=>{be.log(`${Ud} Loading progress:`,w)},[w]),D.useEffect(()=>{I&&(be.log(`${Ud} Unity instance loaded for:`,n),document.hidden&&X())},[I,n]),D.useEffect(()=>{F&&be.error(`${Ud} Unity error:`,F)},[F]),be.log(`${Ud} Rendering provider with instance:`,B),D.useEffect(()=>{be.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:u})},[i,a,l,u]);const re=[];if(i||re.push("loaderUrl"),a||re.push("dataUrl"),l||re.push("frameworkUrl"),u||re.push("codeUrl"),re.length>0)return be.error(`UnityProvider: Missing required Unity build URLs: ${re.join(", ")}`),b.jsx(xj.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${re.join(", ")}`),spaceID:n},children:e});try{return D.useEffect(()=>{be.log("UnityProvider: Unity context created:",S),S?be.log("UnityProvider: Unity provider is available"):be.error("UnityProvider: Unity provider is not available"),I?be.log("UnityProvider: Unity is loaded"):be.log("UnityProvider: Unity is not loaded yet")},[S,I]),b.jsx(xj.Provider,{value:B,children:e})}catch(pe){return be.error("UnityProvider: Error creating Unity context:",pe),b.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[b.jsx("h3",{children:"Unity Error"}),b.jsxs("p",{children:["Error creating Unity context: ",pe.message]}),b.jsx("p",{children:"Please check the console for more details."})]})}},ol=()=>D.useContext(xj),Qg=()=>{const{sendMessage:n,isLoaded:e}=ol(),i=D.useRef([]),a=D.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:f}=i.current.shift();be.log("useSendUnityEvent: Processing queued event to Unity:",u,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(f)}))}catch(_){be.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:u,data:f});break}}},[n,e]);return D.useEffect(()=>{const u=setInterval(()=>{a()},1e3);return()=>clearInterval(u)},[a]),D.useCallback((u,f)=>{be.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:f}),a()},[a])},tm=()=>{const{addEventListener:n,removeEventListener:e}=ol();return D.useCallback((i,a)=>{const l=u=>{be.log(i+" unity message received.");let f=null;if(u)try{f=JSON.parse(u)}catch(_){be.warn("Failed to parse JSON data from Unity message:",_)}a(f)};return n(i,l),()=>{e(i,l)}},[n,e])},gze=()=>{const[n,e]=D.useState(!1),i=tm();return D.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{be.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},_ze=n=>{const[e,i]=D.useState(null),a=tm(),{spaceID:l}=ol();return D.useEffect(()=>{let f=!0;const E=a("PlayVideo",async S=>{try{const{gameObjectName:w}=S;if(!w){be.error("Game object name is missing in Unity event data.");return}const I=await cae(l);be.log("SPACES VIDEOS",I);const k=I.find(U=>U.id===w);k&&f?(i(k.url),be.log("Video URL set to:",k.url)):console.error("Video not found for game object:",w)}catch(w){console.error("Error fetching space videos:",w)}});return()=>{f=!1,E()}},[a,l,n]),[e,()=>{i(null)}]},yze=()=>{const n=tm(),{sendUserToUnity:e}=D.useContext(ul);return D.useEffect(()=>{const a=n("RequestUserForUnity",()=>{be.log("React: Request from Unity to send user data"),e()});return()=>{a()}},[n,e]),!0},Eze=()=>{const{spaceID:n}=ol(),e=Qg(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){be.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{be.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){be.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}be.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await cae(n),f=async S=>{const w=`https://vimeo.com/api/oembed.json?url=${S}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const k=await I.json(),U=k.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let F=null;for(let B of L){const q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${U}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(q,{method:"HEAD"})).ok){F=q;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${q}`,$)}}return F||k.thumbnail_url},_=u.map(async S=>{const w=await f(S.url);return{gameObjectName:S.id,thumbnailUrl:w}}),E=await Promise.all(_);be.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:S,thumbnailUrl:w})=>{e("SetThumbnail",{gameObjectName:S,thumbnailUrl:w})})}catch(u){be.error("Error fetching thumbnails:",u)}})()},[e,n,i])},vze=()=>{const[n,e]=D.useState(null),i=tm();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof f=="string"?JSON.parse(f):f;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},yae=()=>{const[n,e]=D.useState([]),i=tm();return D.useEffect(()=>{let a=!0,l=null;const u=()=>{window.unityInstance&&(be.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=U=>{if(a){be.log("UpdatePlayerList unity message received.");try{let L=[];if(typeof U=="object"&&U!==null?L=U.players||[]:L=JSON.parse(U).players||[],Array.isArray(L)){const F=Array.from(new Map(L.map(B=>[B.playerId,B])).values());e(F),l&&(clearTimeout(l),l=null)}}catch(L){be.error("Error handling player list data:",L),l||(l=setTimeout(u,1e3))}}},_=()=>{be.log("Player disconnected, requesting fresh player list"),u()},E=()=>{be.log("Player left, requesting fresh player list"),u()};u();const S=i("UpdatePlayerList",f),w=i("PlayerDisconnected",_),I=i("PlayerLeft",E),k=setInterval(u,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof S=="function"&&S(),typeof w=="function"&&w(),typeof I=="function"&&I(),clearInterval(k)}},[i]),n},WQ=async(n,e,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:f=null}=a;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=hE(),S=Date.now(),w=i.name.split(".").pop(),I=`${e}_${S}.${w}`,k=dE(E,`spaces/${n}/mediaScreens/${I}`);be.log(`Uploading image for media screen ${e} in space ${n}`);const U=await R3(k,i);_=await FN(U.ref);const L=qi(ri,`spaces/${n}/mediaScreens`,e);await Ok(L,{imageUrl:_,gsUrl:`gs://${U.ref.bucket}/${U.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){_=f;const E=qi(ri,`spaces/${n}/mediaScreens`,e);await Ok(E,{videoUrl:f,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return be.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),_}catch(l){throw be.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},O3=async n=>{be.log(`Getting media screen images for space: ${n}`);try{const e=Xf(ri,`spaces/${n}/mediaScreens`),i=await Gg(e),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(e){throw be.error("Error fetching media screen images from Firestore:",e),e}},xf=async(n,e)=>{try{const i=qi(ri,`spaces/${n}/mediaScreens`,e),a=await cc(i);return a.exists()?{id:a.id,...a.data()}:(be.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw be.error("Error fetching media screen image:",i),i}},Sze=async(n,e)=>{try{const i=await xf(n,e);if(!i)return be.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=hE(),u=dE(l,i.gsUrl);try{await I3(u),be.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){be.warn(`Could not delete file from storage: ${f.message}`)}}const a=qi(ri,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await $u(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),be.log(`Successfully removed video for media screen ${e}`)):(await $u(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),be.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw be.error("Error deleting media screen image:",i),i}},bze=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await xf(n,e);if(!a||!a.imageUrl&&!a.videoUrl)return be.warn(`No media screen content found with ID: ${e} to update`),!1;const l=qi(ri,`spaces/${n}/mediaScreens`,e);return await $u(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),be.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(a){throw be.error("Error updating media screen display mode:",a),a}},Tze=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},Eae=()=>{const{spaceID:n}=ol(),e=Qg(),[i,a]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){be.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{be.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){be.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}be.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await O3(n);be.log("Fetched Media Screen Images",u),u.forEach(f=>{const{id:_,imageUrl:E,displayAsVideo:S,videoUrl:w}=f;let I=null;(!S||!w)&&(I=E?Tze(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:w||null,displayAsVideo:S||!1,timestamp:Date.now()}),be.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${S})`),S&&w&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:w,timestamp:Date.now()}),be.log(`Set display mode to video for screen ${_}`))})}catch(u){be.error("Error fetching media screen images:",u)}})()},[e,n,i])},wze=n=>({opacity:1});var WR=n=>n.type==="checkbox",Dy=n=>n instanceof Date,oc=n=>n==null;const vae=n=>typeof n=="object";var js=n=>!oc(n)&&!Array.isArray(n)&&vae(n)&&!Dy(n),Cze=n=>js(n)&&n.target?WR(n.target)?n.target.checked:n.target.value:n,Rze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,Ize=(n,e)=>n.has(Rze(e)),Aze=n=>{const e=n.constructor&&n.constructor.prototype;return js(e)&&e.hasOwnProperty("isPrototypeOf")},k3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ku(n){let e;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(k3&&(n instanceof Blob||a))&&(i||js(n)))if(e=i?[]:{},!i&&!Aze(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=ku(n[l]));else return n;return e}var BN=n=>Array.isArray(n)?n.filter(Boolean):[],Ks=n=>n===void 0,cn=(n,e,i)=>{if(!e||!js(n))return i;const a=BN(e.split(/[,[\].]+?/)).reduce((l,u)=>oc(l)?l:l[u],n);return Ks(a)||a===n?Ks(n[e])?i:n[e]:a},Jh=n=>typeof n=="boolean",N3=n=>/^\w*$/.test(n),Sae=n=>BN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Hi=(n,e,i)=>{let a=-1;const l=N3(e)?[e]:Sae(e),u=l.length,f=u-1;for(;++a<u;){const _=l[a];let E=i;if(a!==f){const S=n[_];E=js(S)||Array.isArray(S)?S:isNaN(+l[a+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const zQ={BLUR:"blur",FOCUS_OUT:"focusout"},Bd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Cf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};mr.createContext(null);var Pze=(n,e,i,a=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const f=u;return e._proxyFormState[f]!==Bd.all&&(e._proxyFormState[f]=!a||Bd.all),n[f]}});return l},Xc=n=>js(n)&&!Object.keys(n).length,Oze=(n,e,i,a)=>{i(n);const{name:l,...u}=n;return Xc(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(f=>e[f]===Bd.all)},GO=n=>Array.isArray(n)?n:[n];function kze(n){const e=mr.useRef(n);e.current=n,mr.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var ip=n=>typeof n=="string",Nze=(n,e,i,a,l)=>ip(n)?(a&&e.watch.add(n),cn(i,n,l)):Array.isArray(n)?n.map(u=>(a&&e.watch.add(u),cn(i,u))):(a&&(e.watchAll=!0),i),Dze=(n,e,i,a,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},GQ=n=>({isOnSubmit:!n||n===Bd.onSubmit,isOnBlur:n===Bd.onBlur,isOnChange:n===Bd.onChange,isOnAll:n===Bd.all,isOnTouch:n===Bd.onTouched}),HQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const RC=(n,e,i,a)=>{for(const l of i||Object.keys(n)){const u=cn(n,l);if(u){const{_f:f,..._}=u;if(f){if(f.refs&&f.refs[0]&&e(f.refs[0],l)&&!a)return!0;if(f.ref&&e(f.ref,f.name)&&!a)return!0;if(RC(_,e))break}else if(js(_)&&RC(_,e))break}}};var xze=(n,e,i)=>{const a=GO(cn(n,i));return Hi(a,"root",e[i]),Hi(n,i,a),n},D3=n=>n.type==="file",np=n=>typeof n=="function",kk=n=>{if(!k3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},HO=n=>ip(n),x3=n=>n.type==="radio",Nk=n=>n instanceof RegExp;const $Q={value:!1,isValid:!1},KQ={value:!0,isValid:!0};var bae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Ks(n[0].attributes.value)?Ks(n[0].value)||n[0].value===""?KQ:{value:n[0].value,isValid:!0}:KQ:$Q}return $Q};const qQ={isValid:!1,value:null};var Tae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,qQ):qQ;function YQ(n,e,i="validate"){if(HO(n)||Array.isArray(n)&&n.every(HO)||Jh(n)&&!n)return{type:i,message:HO(n)?n:"",ref:e}}var US=n=>js(n)&&!Nk(n)?n:{value:n,message:""},XQ=async(n,e,i,a,l,u)=>{const{ref:f,refs:_,required:E,maxLength:S,minLength:w,min:I,max:k,pattern:U,validate:L,name:F,valueAsNumber:B,mount:q}=n._f,$=cn(i,F);if(!q||e.has(F))return{};const X=_?_[0]:f,oe=he=>{l&&X.reportValidity&&(X.setCustomValidity(Jh(he)?"":he||""),X.reportValidity())},re={},pe=x3(f),te=WR(f),Z=pe||te,ne=(B||D3(f))&&Ks(f.value)&&Ks($)||kk(f)&&f.value===""||$===""||Array.isArray($)&&!$.length,ae=Dze.bind(null,F,a,re),me=(he,ue,Ue,ze=Cf.maxLength,tt=Cf.minLength)=>{const Ce=he?ue:Ue;re[F]={type:he?ze:tt,message:Ce,ref:f,...ae(he?ze:tt,Ce)}};if(u?!Array.isArray($)||!$.length:E&&(!Z&&(ne||oc($))||Jh($)&&!$||te&&!bae(_).isValid||pe&&!Tae(_).isValid)){const{value:he,message:ue}=HO(E)?{value:!!E,message:E}:US(E);if(he&&(re[F]={type:Cf.required,message:ue,ref:X,...ae(Cf.required,ue)},!a))return oe(ue),re}if(!ne&&(!oc(I)||!oc(k))){let he,ue;const Ue=US(k),ze=US(I);if(!oc($)&&!isNaN($)){const tt=f.valueAsNumber||$&&+$;oc(Ue.value)||(he=tt>Ue.value),oc(ze.value)||(ue=tt<ze.value)}else{const tt=f.valueAsDate||new Date($),Ce=ke=>new Date(new Date().toDateString()+" "+ke),Ie=f.type=="time",ye=f.type=="week";ip(Ue.value)&&$&&(he=Ie?Ce($)>Ce(Ue.value):ye?$>Ue.value:tt>new Date(Ue.value)),ip(ze.value)&&$&&(ue=Ie?Ce($)<Ce(ze.value):ye?$<ze.value:tt<new Date(ze.value))}if((he||ue)&&(me(!!he,Ue.message,ze.message,Cf.max,Cf.min),!a))return oe(re[F].message),re}if((S||w)&&!ne&&(ip($)||u&&Array.isArray($))){const he=US(S),ue=US(w),Ue=!oc(he.value)&&$.length>+he.value,ze=!oc(ue.value)&&$.length<+ue.value;if((Ue||ze)&&(me(Ue,he.message,ue.message),!a))return oe(re[F].message),re}if(U&&!ne&&ip($)){const{value:he,message:ue}=US(U);if(Nk(he)&&!$.match(he)&&(re[F]={type:Cf.pattern,message:ue,ref:f,...ae(Cf.pattern,ue)},!a))return oe(ue),re}if(L){if(np(L)){const he=await L($,i),ue=YQ(he,X);if(ue&&(re[F]={...ue,...ae(Cf.validate,ue.message)},!a))return oe(ue.message),re}else if(js(L)){let he={};for(const ue in L){if(!Xc(he)&&!a)break;const Ue=YQ(await L[ue]($,i),X,ue);Ue&&(he={...Ue,...ae(ue,Ue.message)},oe(Ue.message),a&&(re[F]=he))}if(!Xc(he)&&(re[F]={ref:X,...he},!a))return re}}return oe(!0),re};function Lze(n,e){const i=e.slice(0,-1).length;let a=0;for(;a<i;)n=Ks(n)?a++:n[e[a++]];return n}function Mze(n){for(const e in n)if(n.hasOwnProperty(e)&&!Ks(n[e]))return!1;return!0}function lo(n,e){const i=Array.isArray(e)?e:N3(e)?[e]:Sae(e),a=i.length===1?n:Lze(n,i),l=i.length-1,u=i[l];return a&&delete a[u],l!==0&&(js(a)&&Xc(a)||Array.isArray(a)&&Mze(a))&&lo(n,i.slice(0,-1)),n}var $U=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}},Lj=n=>oc(n)||!vae(n);function Sg(n,e){if(Lj(n)||Lj(e))return n===e;if(Dy(n)&&Dy(e))return n.getTime()===e.getTime();const i=Object.keys(n),a=Object.keys(e);if(i.length!==a.length)return!1;for(const l of i){const u=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=e[l];if(Dy(u)&&Dy(f)||js(u)&&js(f)||Array.isArray(u)&&Array.isArray(f)?!Sg(u,f):u!==f)return!1}}return!0}var wae=n=>n.type==="select-multiple",Uze=n=>x3(n)||WR(n),KU=n=>kk(n)&&n.isConnected,Cae=n=>{for(const e in n)if(np(n[e]))return!0;return!1};function Dk(n,e={}){const i=Array.isArray(n);if(js(n)||i)for(const a in n)Array.isArray(n[a])||js(n[a])&&!Cae(n[a])?(e[a]=Array.isArray(n[a])?[]:{},Dk(n[a],e[a])):oc(n[a])||(e[a]=!0);return e}function Rae(n,e,i){const a=Array.isArray(n);if(js(n)||a)for(const l in n)Array.isArray(n[l])||js(n[l])&&!Cae(n[l])?Ks(e)||Lj(i[l])?i[l]=Array.isArray(n[l])?Dk(n[l],[]):{...Dk(n[l])}:Rae(n[l],oc(e)?{}:e[l],i[l]):i[l]=!Sg(n[l],e[l]);return i}var jw=(n,e)=>Rae(n,e,Dk(e)),Iae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:a})=>Ks(n)?n:e?n===""?NaN:n&&+n:i&&ip(n)?new Date(n):a?a(n):n;function qU(n){const e=n.ref;return D3(e)?e.files:x3(e)?Tae(n.refs).value:wae(e)?[...e.selectedOptions].map(({value:i})=>i):WR(e)?bae(n.refs).value:Iae(Ks(e.value)?n.ref.value:e.value,n)}var Vze=(n,e,i,a)=>{const l={};for(const u of n){const f=cn(e,u);f&&Hi(l,u,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},Fw=n=>Ks(n)?n:Nk(n)?n.source:js(n)?Nk(n.value)?n.value.source:n.value:n;const JQ="AsyncFunction";var jze=n=>!!n&&!!n.validate&&!!(np(n.validate)&&n.validate.constructor.name===JQ||js(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===JQ)),Fze=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function QQ(n,e,i){const a=cn(n,i);if(a||N3(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),f=cn(e,u),_=cn(n,u);if(f&&!Array.isArray(f)&&i!==u)return{name:i};if(_&&_.type)return{name:u,error:_};l.pop()}return{name:i}}var Bze=(n,e,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,Wze=(n,e)=>!BN(cn(n,e)).length&&lo(n,e);const zze={mode:Bd.onSubmit,reValidateMode:Bd.onChange,shouldFocusError:!0};function Gze(n={}){let e={...zze,...n},i={submitCount:0,isDirty:!1,isLoading:np(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},a={},l=js(e.defaultValues)||js(e.values)?ku(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:ku(l),f={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,S=0;const w={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:$U(),array:$U(),state:$U()},k=GQ(e.mode),U=GQ(e.reValidateMode),L=e.criteriaMode===Bd.all,F=we=>Ve=>{clearTimeout(S),S=setTimeout(we,Ve)},B=async we=>{if(!e.disabled&&(w.isValid||we)){const Ve=e.resolver?Xc((await Z()).errors):await ae(a,!0);Ve!==i.isValid&&I.state.next({isValid:Ve})}},q=(we,Ve)=>{!e.disabled&&(w.isValidating||w.validatingFields)&&((we||Array.from(_.mount)).forEach($e=>{$e&&(Ve?Hi(i.validatingFields,$e,Ve):lo(i.validatingFields,$e))}),I.state.next({validatingFields:i.validatingFields,isValidating:!Xc(i.validatingFields)}))},$=(we,Ve=[],$e,_t,vt=!0,St=!0)=>{if(_t&&$e&&!e.disabled){if(f.action=!0,St&&Array.isArray(cn(a,we))){const Ht=$e(cn(a,we),_t.argA,_t.argB);vt&&Hi(a,we,Ht)}if(St&&Array.isArray(cn(i.errors,we))){const Ht=$e(cn(i.errors,we),_t.argA,_t.argB);vt&&Hi(i.errors,we,Ht),Wze(i.errors,we)}if(w.touchedFields&&St&&Array.isArray(cn(i.touchedFields,we))){const Ht=$e(cn(i.touchedFields,we),_t.argA,_t.argB);vt&&Hi(i.touchedFields,we,Ht)}w.dirtyFields&&(i.dirtyFields=jw(l,u)),I.state.next({name:we,isDirty:he(we,Ve),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else Hi(u,we,Ve)},X=(we,Ve)=>{Hi(i.errors,we,Ve),I.state.next({errors:i.errors})},oe=we=>{i.errors=we,I.state.next({errors:i.errors,isValid:!1})},re=(we,Ve,$e,_t)=>{const vt=cn(a,we);if(vt){const St=cn(u,we,Ks($e)?cn(l,we):$e);Ks(St)||_t&&_t.defaultChecked||Ve?Hi(u,we,Ve?St:qU(vt._f)):ze(we,St),f.mount&&B()}},pe=(we,Ve,$e,_t,vt)=>{let St=!1,Ht=!1;const fn={name:we};if(!e.disabled){const mn=!!(cn(a,we)&&cn(a,we)._f&&cn(a,we)._f.disabled);if(!$e||_t){w.isDirty&&(Ht=i.isDirty,i.isDirty=fn.isDirty=he(),St=Ht!==fn.isDirty);const Jt=mn||Sg(cn(l,we),Ve);Ht=!!(!mn&&cn(i.dirtyFields,we)),Jt||mn?lo(i.dirtyFields,we):Hi(i.dirtyFields,we,!0),fn.dirtyFields=i.dirtyFields,St=St||w.dirtyFields&&Ht!==!Jt}if($e){const Jt=cn(i.touchedFields,we);Jt||(Hi(i.touchedFields,we,$e),fn.touchedFields=i.touchedFields,St=St||w.touchedFields&&Jt!==$e)}St&&vt&&I.state.next(fn)}return St?fn:{}},te=(we,Ve,$e,_t)=>{const vt=cn(i.errors,we),St=w.isValid&&Jh(Ve)&&i.isValid!==Ve;if(e.delayError&&$e?(E=F(()=>X(we,$e)),E(e.delayError)):(clearTimeout(S),E=null,$e?Hi(i.errors,we,$e):lo(i.errors,we)),($e?!Sg(vt,$e):vt)||!Xc(_t)||St){const Ht={..._t,...St&&Jh(Ve)?{isValid:Ve}:{},errors:i.errors,name:we};i={...i,...Ht},I.state.next(Ht)}},Z=async we=>{q(we,!0);const Ve=await e.resolver(u,e.context,Vze(we||_.mount,a,e.criteriaMode,e.shouldUseNativeValidation));return q(we),Ve},ne=async we=>{const{errors:Ve}=await Z(we);if(we)for(const $e of we){const _t=cn(Ve,$e);_t?Hi(i.errors,$e,_t):lo(i.errors,$e)}else i.errors=Ve;return Ve},ae=async(we,Ve,$e={valid:!0})=>{for(const _t in we){const vt=we[_t];if(vt){const{_f:St,...Ht}=vt;if(St){const fn=_.array.has(St.name),mn=vt._f&&jze(vt._f);mn&&w.validatingFields&&q([_t],!0);const Jt=await XQ(vt,_.disabled,u,L,e.shouldUseNativeValidation&&!Ve,fn);if(mn&&w.validatingFields&&q([_t]),Jt[St.name]&&($e.valid=!1,Ve))break;!Ve&&(cn(Jt,St.name)?fn?xze(i.errors,Jt,St.name):Hi(i.errors,St.name,Jt[St.name]):lo(i.errors,St.name))}!Xc(Ht)&&await ae(Ht,Ve,$e)}}return $e.valid},me=()=>{for(const we of _.unMount){const Ve=cn(a,we);Ve&&(Ve._f.refs?Ve._f.refs.every($e=>!KU($e)):!KU(Ve._f.ref))&&Qe(we)}_.unMount=new Set},he=(we,Ve)=>!e.disabled&&(we&&Ve&&Hi(u,we,Ve),!Sg(Te(),l)),ue=(we,Ve,$e)=>Nze(we,_,{...f.mount?u:Ks(Ve)?l:ip(we)?{[we]:Ve}:Ve},$e,Ve),Ue=we=>BN(cn(f.mount?u:l,we,e.shouldUnregister?cn(l,we,[]):[])),ze=(we,Ve,$e={})=>{const _t=cn(a,we);let vt=Ve;if(_t){const St=_t._f;St&&(!St.disabled&&Hi(u,we,Iae(Ve,St)),vt=kk(St.ref)&&oc(Ve)?"":Ve,wae(St.ref)?[...St.ref.options].forEach(Ht=>Ht.selected=vt.includes(Ht.value)):St.refs?WR(St.ref)?St.refs.length>1?St.refs.forEach(Ht=>(!Ht.defaultChecked||!Ht.disabled)&&(Ht.checked=Array.isArray(vt)?!!vt.find(fn=>fn===Ht.value):vt===Ht.value)):St.refs[0]&&(St.refs[0].checked=!!vt):St.refs.forEach(Ht=>Ht.checked=Ht.value===vt):D3(St.ref)?St.ref.value="":(St.ref.value=vt,St.ref.type||I.values.next({name:we,values:{...u}})))}($e.shouldDirty||$e.shouldTouch)&&pe(we,vt,$e.shouldTouch,$e.shouldDirty,!0),$e.shouldValidate&&ke(we)},tt=(we,Ve,$e)=>{for(const _t in Ve){const vt=Ve[_t],St=`${we}.${_t}`,Ht=cn(a,St);(_.array.has(we)||js(vt)||Ht&&!Ht._f)&&!Dy(vt)?tt(St,vt,$e):ze(St,vt,$e)}},Ce=(we,Ve,$e={})=>{const _t=cn(a,we),vt=_.array.has(we),St=ku(Ve);Hi(u,we,St),vt?(I.array.next({name:we,values:{...u}}),(w.isDirty||w.dirtyFields)&&$e.shouldDirty&&I.state.next({name:we,dirtyFields:jw(l,u),isDirty:he(we,St)})):_t&&!_t._f&&!oc(St)?tt(we,St,$e):ze(we,St,$e),HQ(we,_)&&I.state.next({...i}),I.values.next({name:f.mount?we:void 0,values:{...u}})},Ie=async we=>{f.mount=!0;const Ve=we.target;let $e=Ve.name,_t=!0;const vt=cn(a,$e),St=()=>Ve.type?qU(vt._f):Cze(we),Ht=fn=>{_t=Number.isNaN(fn)||Dy(fn)&&isNaN(fn.getTime())||Sg(fn,cn(u,$e,fn))};if(vt){let fn,mn;const Jt=St(),Hn=we.type===zQ.BLUR||we.type===zQ.FOCUS_OUT,fc=!Fze(vt._f)&&!e.resolver&&!cn(i.errors,$e)&&!vt._f.deps||Bze(Hn,cn(i.touchedFields,$e),i.isSubmitted,U,k),Bt=HQ($e,_,Hn);Hi(u,$e,Jt),Hn?(vt._f.onBlur&&vt._f.onBlur(we),E&&E(0)):vt._f.onChange&&vt._f.onChange(we);const un=pe($e,Jt,Hn,!1),rs=!Xc(un)||Bt;if(!Hn&&I.values.next({name:$e,type:we.type,values:{...u}}),fc)return w.isValid&&(e.mode==="onBlur"&&Hn?B():Hn||B()),rs&&I.state.next({name:$e,...Bt?{}:un});if(!Hn&&Bt&&I.state.next({...i}),e.resolver){const{errors:Fs}=await Z([$e]);if(Ht(Jt),_t){const Qs=QQ(i.errors,a,$e),Ei=QQ(Fs,a,Qs.name||$e);fn=Ei.error,$e=Ei.name,mn=Xc(Fs)}}else q([$e],!0),fn=(await XQ(vt,_.disabled,u,L,e.shouldUseNativeValidation))[$e],q([$e]),Ht(Jt),_t&&(fn?mn=!1:w.isValid&&(mn=await ae(a,!0)));_t&&(vt._f.deps&&ke(vt._f.deps),te($e,mn,fn,un))}},ye=(we,Ve)=>{if(cn(i.errors,Ve)&&we.focus)return we.focus(),1},ke=async(we,Ve={})=>{let $e,_t;const vt=GO(we);if(e.resolver){const St=await ne(Ks(we)?we:vt);$e=Xc(St),_t=we?!vt.some(Ht=>cn(St,Ht)):$e}else we?(_t=(await Promise.all(vt.map(async St=>{const Ht=cn(a,St);return await ae(Ht&&Ht._f?{[St]:Ht}:Ht)}))).every(Boolean),!(!_t&&!i.isValid)&&B()):_t=$e=await ae(a);return I.state.next({...!ip(we)||w.isValid&&$e!==i.isValid?{}:{name:we},...e.resolver||!we?{isValid:$e}:{},errors:i.errors}),Ve.shouldFocus&&!_t&&RC(a,ye,we?vt:_.mount),_t},Te=we=>{const Ve={...f.mount?u:l};return Ks(we)?Ve:ip(we)?cn(Ve,we):we.map($e=>cn(Ve,$e))},ve=(we,Ve)=>({invalid:!!cn((Ve||i).errors,we),isDirty:!!cn((Ve||i).dirtyFields,we),error:cn((Ve||i).errors,we),isValidating:!!cn(i.validatingFields,we),isTouched:!!cn((Ve||i).touchedFields,we)}),Re=we=>{we&&GO(we).forEach(Ve=>lo(i.errors,Ve)),I.state.next({errors:we?i.errors:{}})},Me=(we,Ve,$e)=>{const _t=(cn(a,we,{_f:{}})._f||{}).ref,vt=cn(i.errors,we)||{},{ref:St,message:Ht,type:fn,...mn}=vt;Hi(i.errors,we,{...mn,...Ve,ref:_t}),I.state.next({name:we,errors:i.errors,isValid:!1}),$e&&$e.shouldFocus&&_t&&_t.focus&&_t.focus()},Ge=(we,Ve)=>np(we)?I.values.subscribe({next:$e=>we(ue(void 0,Ve),$e)}):ue(we,Ve,!0),Qe=(we,Ve={})=>{for(const $e of we?GO(we):_.mount)_.mount.delete($e),_.array.delete($e),Ve.keepValue||(lo(a,$e),lo(u,$e)),!Ve.keepError&&lo(i.errors,$e),!Ve.keepDirty&&lo(i.dirtyFields,$e),!Ve.keepTouched&&lo(i.touchedFields,$e),!Ve.keepIsValidating&&lo(i.validatingFields,$e),!e.shouldUnregister&&!Ve.keepDefaultValue&&lo(l,$e);I.values.next({values:{...u}}),I.state.next({...i,...Ve.keepDirty?{isDirty:he()}:{}}),!Ve.keepIsValid&&B()},nt=({disabled:we,name:Ve,field:$e,fields:_t})=>{(Jh(we)&&f.mount||we||_.disabled.has(Ve))&&(we?_.disabled.add(Ve):_.disabled.delete(Ve),pe(Ve,qU($e?$e._f:cn(_t,Ve)._f),!1,!1,!0))},ht=(we,Ve={})=>{let $e=cn(a,we);const _t=Jh(Ve.disabled)||Jh(e.disabled);return Hi(a,we,{...$e||{},_f:{...$e&&$e._f?$e._f:{ref:{name:we}},name:we,mount:!0,...Ve}}),_.mount.add(we),$e?nt({field:$e,disabled:Jh(Ve.disabled)?Ve.disabled:e.disabled,name:we}):re(we,!0,Ve.value),{..._t?{disabled:Ve.disabled||e.disabled}:{},...e.progressive?{required:!!Ve.required,min:Fw(Ve.min),max:Fw(Ve.max),minLength:Fw(Ve.minLength),maxLength:Fw(Ve.maxLength),pattern:Fw(Ve.pattern)}:{},name:we,onChange:Ie,onBlur:Ie,ref:vt=>{if(vt){ht(we,Ve),$e=cn(a,we);const St=Ks(vt.value)&&vt.querySelectorAll&&vt.querySelectorAll("input,select,textarea")[0]||vt,Ht=Uze(St),fn=$e._f.refs||[];if(Ht?fn.find(mn=>mn===St):St===$e._f.ref)return;Hi(a,we,{_f:{...$e._f,...Ht?{refs:[...fn.filter(KU),St,...Array.isArray(cn(l,we))?[{}]:[]],ref:{type:St.type,name:we}}:{ref:St}}}),re(we,!1,void 0,St)}else $e=cn(a,we,{}),$e._f&&($e._f.mount=!1),(e.shouldUnregister||Ve.shouldUnregister)&&!(Ize(_.array,we)&&f.action)&&_.unMount.add(we)}}},it=()=>e.shouldFocusError&&RC(a,ye,_.mount),It=we=>{Jh(we)&&(I.state.next({disabled:we}),RC(a,(Ve,$e)=>{const _t=cn(a,$e);_t&&(Ve.disabled=_t._f.disabled||we,Array.isArray(_t._f.refs)&&_t._f.refs.forEach(vt=>{vt.disabled=_t._f.disabled||we}))},0,!1))},jt=(we,Ve)=>async $e=>{let _t;$e&&($e.preventDefault&&$e.preventDefault(),$e.persist&&$e.persist());let vt=ku(u);if(_.disabled.size)for(const St of _.disabled)Hi(vt,St,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:St,values:Ht}=await Z();i.errors=St,vt=Ht}else await ae(a);if(lo(i.errors,"root"),Xc(i.errors)){I.state.next({errors:{}});try{await we(vt,$e)}catch(St){_t=St}}else Ve&&await Ve({...i.errors},$e),it(),setTimeout(it);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Xc(i.errors)&&!_t,submitCount:i.submitCount+1,errors:i.errors}),_t)throw _t},Dt=(we,Ve={})=>{cn(a,we)&&(Ks(Ve.defaultValue)?Ce(we,ku(cn(l,we))):(Ce(we,Ve.defaultValue),Hi(l,we,ku(Ve.defaultValue))),Ve.keepTouched||lo(i.touchedFields,we),Ve.keepDirty||(lo(i.dirtyFields,we),i.isDirty=Ve.defaultValue?he(we,ku(cn(l,we))):he()),Ve.keepError||(lo(i.errors,we),w.isValid&&B()),I.state.next({...i}))},an=(we,Ve={})=>{const $e=we?ku(we):l,_t=ku($e),vt=Xc(we),St=vt?l:_t;if(Ve.keepDefaultValues||(l=$e),!Ve.keepValues){if(Ve.keepDirtyValues){const Ht=new Set([..._.mount,...Object.keys(jw(l,u))]);for(const fn of Array.from(Ht))cn(i.dirtyFields,fn)?Hi(St,fn,cn(u,fn)):Ce(fn,cn(St,fn))}else{if(k3&&Ks(we))for(const Ht of _.mount){const fn=cn(a,Ht);if(fn&&fn._f){const mn=Array.isArray(fn._f.refs)?fn._f.refs[0]:fn._f.ref;if(kk(mn)){const Jt=mn.closest("form");if(Jt){Jt.reset();break}}}}a={}}u=e.shouldUnregister?Ve.keepDefaultValues?ku(l):{}:ku(St),I.array.next({values:{...St}}),I.values.next({values:{...St}})}_={mount:Ve.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!w.isValid||!!Ve.keepIsValid||!!Ve.keepDirtyValues,f.watch=!!e.shouldUnregister,I.state.next({submitCount:Ve.keepSubmitCount?i.submitCount:0,isDirty:vt?!1:Ve.keepDirty?i.isDirty:!!(Ve.keepDefaultValues&&!Sg(we,l)),isSubmitted:Ve.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:vt?{}:Ve.keepDirtyValues?Ve.keepDefaultValues&&u?jw(l,u):i.dirtyFields:Ve.keepDefaultValues&&we?jw(l,we):Ve.keepDirty?i.dirtyFields:{},touchedFields:Ve.keepTouched?i.touchedFields:{},errors:Ve.keepErrors?i.errors:{},isSubmitSuccessful:Ve.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},jn=(we,Ve)=>an(np(we)?we(u):we,Ve);return{control:{register:ht,unregister:Qe,getFieldState:ve,handleSubmit:jt,setError:Me,_executeSchema:Z,_getWatch:ue,_getDirty:he,_updateValid:B,_removeUnmounted:me,_updateFieldArray:$,_updateDisabledField:nt,_getFieldArray:Ue,_reset:an,_resetDefaultValues:()=>np(e.defaultValues)&&e.defaultValues().then(we=>{jn(we,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:we=>{i={...i,...we}},_disableForm:It,_subjects:I,_proxyFormState:w,_setErrors:oe,get _fields(){return a},get _formValues(){return u},get _state(){return f},set _state(we){f=we},get _defaultValues(){return l},get _names(){return _},set _names(we){_=we},get _formState(){return i},set _formState(we){i=we},get _options(){return e},set _options(we){e={...e,...we}}},trigger:ke,register:ht,handleSubmit:jt,watch:Ge,setValue:Ce,getValues:Te,reset:jn,resetField:Dt,clearErrors:Re,unregister:Qe,setError:Me,setFocus:(we,Ve={})=>{const $e=cn(a,we),_t=$e&&$e._f;if(_t){const vt=_t.refs?_t.refs[0]:_t.ref;vt.focus&&(vt.focus(),Ve.shouldSelect&&np(vt.select)&&vt.select())}},getFieldState:ve}}function Aae(n={}){const e=mr.useRef(void 0),i=mr.useRef(void 0),[a,l]=mr.useState({isDirty:!1,isValidating:!1,isLoading:np(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:np(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...Gze(n),formState:a});const u=e.current.control;return u._options=n,kze({subject:u._subjects.state,next:f=>{Oze(f,u._proxyFormState,u._updateFormState)&&l({...u._formState})}}),mr.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),mr.useEffect(()=>{if(u._proxyFormState.isDirty){const f=u._getDirty();f!==a.isDirty&&u._subjects.state.next({isDirty:f})}},[u,a.isDirty]),mr.useEffect(()=>{n.values&&!Sg(n.values,i.current)?(u._reset(n.values,u._options.resetOptions),i.current=n.values,l(f=>({...f}))):u._resetDefaultValues()},[n.values,u]),mr.useEffect(()=>{n.errors&&u._setErrors(n.errors)},[n.errors,u]),mr.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),mr.useEffect(()=>{n.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[n.shouldUnregister,u]),e.current.formState=Pze(a,u),e.current}const WN=(n,e="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),be.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){be.error(`Failed to disable Unity input for ${e}:`,l)}},a=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),be.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):be.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){be.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,e])};function zN({mode:n,label:e,buttonProps:i={},isOpen:a,onClose:l}){const{register:u,handleSubmit:f,formState:{errors:_}}=Aae(),{register:E}=D.useContext(ul),S=ll(),{fullscreenRef:w}=Jd(),[I,k]=D.useState(!1),[U,L]=D.useState(!1),F=a!==void 0?a:I,B=l||(()=>k(!1));WN(F);const q=async oe=>{const{email:re,password:pe,confirmPassword:te,...Z}=oe;if(pe!==te){S({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}L(!0);try{const ne=await E(re,pe,Z);be.log("User: Registration process complete."),B(),S({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(ne){be.error("User: Registration Error:",ne),S({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{L(!1)}},$=()=>{l?l():k(!I)},X=n==="link"?b.jsx(ho,{variant:"header",onClick:$,children:e}):b.jsx(Ar,{onClick:$,...i,children:e});return b.jsxs(b.Fragment,{children:[!a&&X,b.jsxs(hc,{isOpen:F,onClose:B,size:"md",portalProps:{containerRef:w},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[b.jsx(dc,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),b.jsxs(pc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:oe=>{oe.stopPropagation()},children:[b.jsxs(Hu,{p:8,textAlign:"center",children:[b.jsx(br,{size:"lg",mb:2,children:"Create Account"}),b.jsx(et,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),b.jsx(cl,{color:"gray.400"}),b.jsx(uc,{px:8,children:b.jsx("form",{onSubmit:f(q),children:b.jsxs(gr,{spacing:4,children:[b.jsxs(kn,{isInvalid:_.companyName,isRequired:!0,children:[b.jsx(pr,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required"})}),b.jsx(Mu,{children:_.companyName&&_.companyName.message})]}),b.jsxs(sr,{gap:4,w:"100%",children:[b.jsxs(kn,{isInvalid:_.firstName,isRequired:!0,children:[b.jsx(pr,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required"})}),b.jsx(Mu,{children:_.firstName&&_.firstName.message})]}),b.jsxs(kn,{isInvalid:_.lastName,isRequired:!0,children:[b.jsx(pr,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required"})}),b.jsx(Mu,{children:_.lastName&&_.lastName.message})]})]}),b.jsxs(kn,{isInvalid:_.email,isRequired:!0,children:[b.jsx(pr,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),b.jsx(Mu,{children:_.email&&_.email.message})]}),b.jsxs(sr,{gap:4,w:"100%",children:[b.jsxs(kn,{isInvalid:_.password,isRequired:!0,children:[b.jsx(pr,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),b.jsx(Mu,{children:_.password&&_.password.message})]}),b.jsxs(kn,{isInvalid:_.confirmPassword,isRequired:!0,children:[b.jsx(pr,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),b.jsx(Mu,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),b.jsx(kn,{children:b.jsx(pr,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("accessCode")})}),b.jsx(kn,{children:b.jsx(pr,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile")})})]})})}),b.jsxs(D0,{px:8,pb:8,flexDirection:"column",gap:4,children:[b.jsx(Ar,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(q),isLoading:U,loadingText:"Creating Account",children:"Create Account"}),b.jsxs(et,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",b.jsx(ho,{color:"blue.400",onClick:()=>{B(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}zN.propTypes={mode:Hr.oneOf(["button","link"]),label:Hr.string,buttonProps:Hr.object,isOpen:Hr.bool,onClose:Hr.func};function GN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=D.useContext(ul),{fullscreenRef:u}=Jd(),f=ll(),{register:_,handleSubmit:E,formState:{errors:S,isSubmitting:w}}=Aae({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[I,k]=D.useState(a),[U,L]=D.useState(!1);WN(I),D.useEffect(()=>{const X=()=>{k(!0)};return window.addEventListener("openSignInModal",X),()=>{window.removeEventListener("openSignInModal",X)}},[]);const F=async X=>{try{await l(X.email,X.password),be.log("User: Sign-in process complete."),k(!1),window.location.reload()}catch(oe){be.error("User: SignIn Error:",oe);const re=oe.message||"An error occurred while logging in. Please check your credentials.",pe=re.includes("verify your email");f({title:pe?"Email Verification Required":"Error",description:re,status:pe?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:u.current})}},B=()=>k(X=>!X),q=()=>{k(!1),L(!0)},$=n==="link"?b.jsx(ho,{variant:"header",onClick:B,children:e}):b.jsx(Ar,{onClick:B,...i,children:e});return b.jsxs(b.Fragment,{children:[$,b.jsxs(hc,{isOpen:I,onClose:B,size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[b.jsx(dc,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),b.jsx("form",{onSubmit:E(F),children:b.jsxs(pc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:X=>{X.stopPropagation()},children:[b.jsxs(Hu,{p:8,textAlign:"center",children:[b.jsx(br,{size:"lg",mb:2,children:"Welcome Back"}),b.jsx(et,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),b.jsx(cl,{color:"gray.400"}),b.jsx(uc,{px:8,pb:8,children:b.jsxs(gr,{spacing:4,children:[b.jsxs(kn,{isInvalid:S.email,children:[b.jsxs(A0,{children:[b.jsx(qy,{pointerEvents:"none",children:b.jsx(nze,{color:"gray.500"})}),b.jsx(pr,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),b.jsx(Mu,{children:S.email&&S.email.message})]}),b.jsxs(kn,{isInvalid:S.password,children:[b.jsxs(A0,{children:[b.jsx(qy,{pointerEvents:"none",children:b.jsx(ZWe,{color:"gray.500"})}),b.jsx(pr,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),b.jsx(Mu,{children:S.password&&S.password.message})]})]})}),b.jsxs(D0,{px:8,pb:8,flexDirection:"column",gap:4,children:[b.jsx(Ar,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:w,loadingText:"Signing In",children:"Sign In"}),b.jsxs(et,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",b.jsx(ho,{color:"blue.400",onClick:q,children:"Sign Up"})]})]})]})})]}),b.jsx(zN,{mode:"link",isOpen:U,onClose:()=>L(!1)})]})}GN.propTypes={mode:Hr.oneOf(["button","link"]),label:Hr.string,buttonProps:Hr.object,initialIsOpen:Hr.bool};function Hze(){const{loadingProgression:n,isLoaded:e,error:i}=ol(),{user:a}=D.useContext(ul),[l,u]=D.useState(!1),[f,_]=D.useState(!1),[E,S]=D.useState(!1),[w,I]=D.useState(!1),k=D.useRef(!1),U=D.useRef(!1),L=D.useRef(null),F=D.useRef(null),B=D.useRef(null),q=tm(),$=D.useRef(null),X=D.useRef(null),oe=D.useRef(null),re=D.useRef(null);D.useEffect(()=>{u(!a&&n===0)},[a,n]),D.useEffect(()=>{const Z=document.createElement("style");return Z.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Z),$.current=Z,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const Z=()=>{const ne=document.getElementById("unity-canvas"),ae=document.getElementById("unity-container");ne&&(L.current=ne,console.log("LoaderProgress: Found Unity canvas"),ne.style.zIndex="1"),ae&&(F.current=ae,console.log("LoaderProgress: Found Unity container"),ae.style.zIndex="1"),ne&&ae&&oe.current&&(clearInterval(oe.current),oe.current=null)};return Z(),oe.current=setInterval(Z,100),()=>{oe.current&&(clearInterval(oe.current),oe.current=null)}},[]),D.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),U.current=!0,I(!0));const ne=q("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),U.current=!0,I(!0),window.isFirstSceneLoaded=!0}),ae=setTimeout(()=>{U.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),U.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{ne(),clearTimeout(ae)}},[q]),D.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),k.current=!0,S(!0),U.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),U.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Z=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),k.current=!0,S(!0),U.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),U.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Z);const ne=q("PlayerInstantiated",Z),ae=setTimeout(()=>{k.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),k.current=!0,S(!0),U.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),U.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Z),ne(),clearTimeout(ae)}},[q]),D.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:w,isPlayerInstantiated:E}),w&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),L.current&&(L.current.style.opacity="1",L.current.style.removeProperty("opacity")),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="0",B.current.style.pointerEvents="none",setTimeout(()=>{B.current&&(B.current.style.display="none")},1500))},2e3)),()=>{X.current&&clearTimeout(X.current)}),[w,E]),D.useEffect(()=>(re.current=setInterval(()=>{var Z,ne;console.log("LoaderProgress: Debug interval",{isLoaded:e,isFirstSceneLoaded:U.current,isPlayerInstantiated:k.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(Z=L.current)==null?void 0:Z.style.zIndex,loaderZIndex:(ne=B.current)==null?void 0:ne.style.zIndex})},5e3),()=>{re.current&&clearInterval(re.current)}),[e]),D.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:e,isFirstSceneLoaded:w,isPlayerInstantiated:E,loadingProgression:n})},[e,w,E,n]);const pe=()=>e?e&&!w&&!E?"Scene initializing":w&&!E?"Player initializing":"Ready":"World loading",te=()=>e?e&&!w&&!E?85:w&&!E?95:100:n*80;return b.jsx(b.Fragment,{children:l?b.jsx(Xe,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:b.jsxs(gr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[b.jsx(et,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),b.jsx(et,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),b.jsx(Ar,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):b.jsx(Xe,{ref:B,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:b.jsxs(sr,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[b.jsx(et,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),b.jsx(et,{fontSize:"sm",children:pe()}),b.jsx(x0,{value:te(),size:"lg",width:"100%",marginY:2})]})})})}function L3({mode:n="button",label:e="Sign Out"}){const i=ll(),{signOut:a}=D.useContext(ul),{fullscreenRef:l}=Jd(),u=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?b.jsx(ho,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return b.jsx(b.Fragment,{children:f})}L3.propTypes={mode:Hr.oneOf(["button","link"]),label:Hr.string};function $ze(){const{user:n}=D.useContext(ul);return b.jsx("div",{children:n!==null?b.jsx("div",{children:b.jsx(L3,{})}):b.jsxs("div",{children:[b.jsx(zN,{}),b.jsx(GN,{})]})})}function Kze(){const{fullscreenRef:n}=Jd(),[e,i]=D.useState(!1),a=()=>{i(!e)};return b.jsxs(b.Fragment,{children:[b.jsx(up,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:b.jsx(Ys,{"aria-label":"Controller Help",icon:b.jsx(rze,{}),onClick:a,variant:"iconButton"})}),b.jsxs(hc,{isOpen:e,onClose:a,size:"md",portalProps:{containerRef:n},children:[b.jsx(dc,{}),b.jsxs(pc,{children:[b.jsx(Hu,{children:"Notes"}),b.jsx(cl,{}),b.jsx(uc,{children:b.jsx(et,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),b.jsx(D0,{children:b.jsx(Ar,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Pae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ZQ=mr.createContext&&mr.createContext(Pae),Ng=function(){return Ng=Object.assign||function(n){for(var e,i=1,a=arguments.length;i<a;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},Ng.apply(this,arguments)},qze=function(n,e){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function Oae(n){return n&&n.map(function(e,i){return mr.createElement(e.tag,Ng({key:i},e.attr),Oae(e.child))})}function or(n){return function(e){return mr.createElement(Yze,Ng({attr:Ng({},n.attr)},e),Oae(n.child))}}function Yze(n){var e=function(i){var a=n.attr,l=n.size,u=n.title,f=qze(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),mr.createElement("svg",Ng({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,f,{className:E,style:Ng(Ng({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),u&&mr.createElement("title",null,u),n.children)};return ZQ!==void 0?mr.createElement(ZQ.Consumer,null,function(i){return e(i)}):e(Pae)}function kae(n){return or({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"}}]})(n)}function HN(n){return or({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function Nae(n){return or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"}}]})(n)}function Xze(n){return or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function Mj(n){return or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function Jze(n){return or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function Qze(n){return or({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function Zze(n){return or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Dae(n){return or({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function e9e(n){return or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function t9e(n){return or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Uj(n){return or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function Vj(n){return or({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function n9e(n){return or({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function r9e(n){return or({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function i9e(n){return or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function jj(n){return or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function s9e(n){return or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function o9e(n){return or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function a9e(n){return or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function c9e(n){return or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function xae({open:n,onClose:e}){const i=D.useRef(null),a=Qg(),{user:l}=D.useContext(ul),u=E=>{i.current&&!i.current.contains(E.target)&&e()},f=async E=>{const S=_(E);if((S==null?void 0:S.source)==="readyplayerme"&&(S.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),S.eventName==="v1.avatar.exported")){const w=S.data.url;if(console.log(`Avatar URL: ${w}`),a("AvatarUrlFromReact",{url:w}),l&&l.uid)try{await Goe(l.uid,w),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",f)}),[n]),n&&b.jsx($l,{children:b.jsx(Xe,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:b.jsx(Xe,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:b.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function l9e({isOpen:n,onClose:e}){const[i,a]=D.useState(!1),[l,u]=D.useState(null),{user:f}=D.useContext(ul),_=Qg(),E=L=>{L.stopPropagation(),a(!0)},S=()=>{a(!1),e()},w=async L=>{if(u(L),f&&f.uid)try{await Goe(f.uid,L.url),_("AvatarUrlFromReact",{url:L.url}),e()}catch(F){console.error("Error updating RPM URL:",F)}else console.error("No authenticated user found to update rpmURL.")},I=Of("gray.200","whiteAlpha.300"),k="rgba(0, 0, 0, 0.3)",U=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return b.jsxs(b.Fragment,{children:[b.jsx($l,{children:b.jsxs(hc,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[b.jsx(dc,{bg:"rgba(0, 0, 0, 0.7)"}),b.jsxs(pc,{bg:"gray.800",color:"white",maxW:"900px",children:[b.jsx(Hu,{fontSize:"lg",children:"Customise Your Avatar"}),b.jsx(cl,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),b.jsx(uc,{pb:4,children:b.jsxs(gr,{spacing:4,align:"stretch",children:[b.jsx(et,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),b.jsxs(Ky,{columns:5,spacing:2,children:[b.jsx(Xe,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:k},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:b.jsxs(gr,{spacing:1,children:[b.jsx(Dn,{as:r9e,boxSize:4}),b.jsx(et,{fontSize:"xs",children:"Create Custom Avatar"})]})}),U.map(L=>b.jsxs(Xe,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===L.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>w(L),_hover:{bg:k},transition:"all 0.2s",aspectRatio:"1",children:[b.jsx(Va,{src:L.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:L.name,width:"100%",height:"100%",objectFit:"cover"}),b.jsx(Xe,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:b.jsx(et,{fontSize:"xs",children:L.name})})]},L.id))]})]})})]})]})}),i&&b.jsx(xae,{open:i,onClose:S})]})}function u9e(){const{fullscreenRef:n}=Jd(),[e,i]=D.useState(!1),[a,l]=D.useState(!1),[u,f]=D.useState(!1),[_,E]=D.useState(!1),{user:S}=D.useContext(ul),[w,I]=D.useState(null),[k,U]=D.useState(!0),L=($,X)=>!$||!X?"?":`${$.charAt(0)}${X.charAt(0)}`.toUpperCase(),F=async()=>{if(S!=null&&S.uid){U(!0);try{const $=await Ep(S.uid);I({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{U(!1)}}};D.useEffect(()=>{F()},[S==null?void 0:S.uid]),D.useEffect(()=>{const $=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const B=()=>l(!a),q=()=>{l(!1),F()};return e?b.jsxs(b.Fragment,{children:[b.jsx(up,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:b.jsxs(Xe,{position:"relative",onMouseEnter:()=>{f(!0),E(!0)},onMouseLeave:()=>{f(!1),E(!1)},cursor:"pointer",onClick:B,children:[b.jsx(Wu,{src:k||w==null?void 0:w.rpmURL,size:"md",borderRadius:"full",bg:"white",name:k?L(w==null?void 0:w.firstName,w==null?void 0:w.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&b.jsx(Xe,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:b.jsx(et,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),b.jsx(l9e,{isOpen:a,onClose:q})]}):null}function d9e(n){return or({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function h9e(n){return or({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function p9e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:a}=Jd(),l=ll();D.useEffect(()=>{const f=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const u=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return b.jsx(up,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:b.jsx(Ys,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?b.jsx(d9e,{}):b.jsx(h9e,{}),onClick:u,variant:"iconButton",size:a?"lg":"md"})})}const eZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function f9e(){const{isOpen:n,onOpen:e,onClose:i}=gp(),{fullscreenRef:a}=Jd(),[l,u]=_ze(!1);D.useEffect(()=>{be.log("VideoPlayer: Current video URL:",l),l&&(be.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const f=()=>{be.log("VideoPlayer: Closing modal"),u(),i()};return b.jsx($l,{containerRef:a,children:b.jsxs(hc,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[b.jsx(dc,{bg:"rgba(0, 0, 0, 0.8)"}),b.jsxs(pc,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[b.jsx(cl,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),b.jsx(uc,{p:0,width:"100%",children:l&&b.jsx(Xe,{style:eZ.iframeContainer,children:b.jsx("iframe",{src:l,style:eZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function m9e({isOpen:n,onClose:e,playerName:i,playerId:a,uid:l}){const[u,f]=D.useState(null),[_,E]=D.useState(!0),[S,w]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(E(!0),w(null),!l){be.warn("NameplateModal: No UID provided for player:",i),w("No user ID available for this player"),E(!1);return}try{be.log("NameplateModal: Fetching profile for UID:",l);const k=await Ep(l);k?f({firstName:k.firstName,lastName:k.lastName,linkedinUrl:k.linkedinUrl,websiteUrl:k.websiteUrl,rpmURL:k.rpmURL?k.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):w("Could not find profile data for this player")}catch(k){be.error("Error fetching profile data:",k),w("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),b.jsxs(hc,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[b.jsx(dc,{backdropFilter:"blur(10px)"}),b.jsxs(pc,{bg:"gray.900",color:"white",borderRadius:"xl",children:[b.jsx(Hu,{children:"Player Info"}),b.jsx(cl,{}),b.jsx(uc,{pb:6,children:_?b.jsx(Zk,{py:8,children:b.jsx(la,{size:"xl",color:"blue.400"})}):S?b.jsxs(Vu,{status:"warning",variant:"solid",borderRadius:"md",children:[b.jsx(ju,{}),S]}):b.jsxs(gr,{spacing:4,align:"center",children:[b.jsx(Wu,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),b.jsxs(gr,{spacing:1,children:[b.jsx(et,{fontSize:"2xl",fontWeight:"bold",children:i}),(u==null?void 0:u.firstName)&&b.jsxs(et,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),b.jsxs(et,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&b.jsxs(b.Fragment,{children:[b.jsx(uo,{borderColor:"whiteAlpha.300"}),b.jsxs(ui,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&b.jsx(ho,{href:u.linkedinUrl,isExternal:!0,children:b.jsx(Ys,{icon:b.jsx(HN,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&b.jsx(ho,{href:u.websiteUrl,isExternal:!0,children:b.jsx(Ys,{icon:b.jsx(Dae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const g9e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[a]=Sre("(max-width: 768px)"),[l,u]=D.useState(!1);D.useEffect(()=>{(()=>{const Ie=navigator.userAgent||navigator.vendor||window.opera,ke=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ie);u(ke),ke&&be.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,_=yae(),[E,S]=D.useState(!1),[w,I]=D.useState([]),[k,U]=D.useState(!1),[L,F]=D.useState({}),[B,q]=D.useState({}),[$,X]=D.useState(null),[oe,re]=D.useState(!1),pe=ll(),te=window.currentUser||{},ne=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const Ie=(window.location.pathname||"").split("/"),ye=Ie[Ie.length-1];if(ye&&ye.length>5)return ye;const ke=document.body.getAttribute("data-space-id");if(ke)return ke;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const ye=await kg(ne);ye&&ye.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),re(!0)):re(!1)}catch(ye){console.error("UnityPlayerList: Error checking if voice is disabled:",ye)}})();const Ie=ye=>{ye.detail&&typeof ye.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ye.detail.voiceDisabled),re(ye.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ie),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ie)}},[ne]),D.useEffect(()=>{const Ce={};_.forEach(Ie=>{if(Ie.uid){if(Ie.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)Ce[Ie.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ye=window.agoraClient.client.remoteUsers,ke=ye.find(Te=>String(Te.uid)===String(Ie.uid));if(ke)Ce[Ie.uid]=ke.uid;else{const Te=ye.find(ve=>typeof ve.uid=="string"&&ve.uid.includes(Ie.uid));if(Te)Ce[Ie.uid]=Te.uid;else{const ve=ye.find(Re=>typeof Ie.uid=="string"&&Ie.uid.includes(String(Re.uid)));if(ve)Ce[Ie.uid]=ve.uid;else{const Re=ye.filter(Me=>!(typeof Me.uid=="string"&&Me.uid.startsWith("screen-")));Re.length===1&&!Ie.isLocalPlayer&&(Ce[Ie.uid]=Re[0].uid)}}}}}}),q(Ce)},[_]);const ae=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const Ce=window.agoraClient.isVoiceEnabled;Ce!==k&&U(Ce)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ce=window.agoraClient.client.remoteUsers,Ie={};Ce.forEach(ye=>{typeof ye.uid=="string"&&ye.uid.startsWith("screen-")||(Ie[ye.uid]=!!ye.audioTrack&&!ye.audioTrack.muted)}),JSON.stringify(Ie)!==JSON.stringify(L)&&F(Ie)}};D.useEffect(()=>{const Ce=setInterval(ae,500),Ie=ye=>{ye.detail&&typeof ye.detail.enabled=="boolean"&&U(ye.detail.enabled)};return window.addEventListener("VoiceToggled",Ie),ae(),()=>{clearInterval(Ce),window.removeEventListener("VoiceToggled",Ie)}},[]),D.useEffect(()=>{const Ce=()=>{be.log("UnityPlayerList: Player instantiated, showing list"),S(!0)};return window.addEventListener("PlayerInstantiated",Ce),window.isPlayerInstantiated&&(be.log("UnityPlayerList: Player was already instantiated"),S(!0)),()=>{window.removeEventListener("PlayerInstantiated",Ce)}},[]),D.useEffect(()=>{(async()=>{const Ie=await Promise.all(_.map(async ye=>{if(ye.uid)try{const ke=await Ep(ye.uid);let Te=null;if(ke.groups){const ve=`space_${ne}_owners`,Re=`space_${ne}_hosts`;ke.groups.includes(ve)?Te="owner":ke.groups.includes(Re)&&(Te="host")}return ue({uid:ye.uid})&&X(Te),{...ye,firstName:ke.firstName,lastName:ke.lastName,linkedInProfile:ke.linkedInProfile,websiteUrl:ke.websiteUrl,rpmURL:ke.rpmURL?ke.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(ke){return be.error(`Error fetching data for player ${ye.playerName}:`,ke),ye}return ye}));I(Ie)})()},[_,ne]);const me=[...w].sort((Ce,Ie)=>Ce.isLocalPlayer?-1:Ie.isLocalPlayer?1:0),he=()=>{be.log("UnityPlayerList: Toggling visibility"),e&&e()},ue=Ce=>!!(Ce.isLocalPlayer||te&&te.uid&&Ce.uid===te.uid),Ue=Ce=>{try{if(ue(Ce))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:k;if(Ce.uid){if(L[Ce.uid])return!0;const Ie=B[Ce.uid];if(Ie&&L[Ie])return!0;const ye=parseInt(Ce.uid);if(!isNaN(ye)&&L[ye])return!0}return!1}catch(Ie){return console.error("Error in hasActiveMic:",Ie),!1}},ze=({player:Ce})=>{const Ie=Ce.role;return Ie==="owner"?b.jsxs(ui,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[b.jsx(Dn,{as:Mj,color:"green.400",boxSize:5}),b.jsx(zd,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ie==="host"?b.jsxs(ui,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[b.jsx(Dn,{as:jj,color:"purple.400",boxSize:5}),b.jsx(zd,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},tt=(Ce,Ie)=>{switch(console.log(`Action "${Ce}" performed on player: ${Ie.playerName}`),Ce){case"mute":pe({title:"Player Muted",description:`${Ie.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":pe({title:"Player Kicked",description:`${Ie.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":pe({title:"Player Promoted",description:`${Ie.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return b.jsxs(Xe,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!f?"visible":"hidden",role:"group",children:[b.jsx(Xe,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:b.jsx(Ys,{icon:b.jsx(pae,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:he,_hover:{opacity:.8}})}),b.jsxs(et,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),b.jsx(Xe,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:b.jsx(gr,{align:"stretch",spacing:1,width:"100%",children:me.map((Ce,Ie)=>{const ye=ue(Ce),ke=!oe&&Ue(Ce);return b.jsx(Xe,{children:b.jsxs(qre,{placement:"left",trigger:"hover",children:[b.jsx(Zre,{children:b.jsxs(ui,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[b.jsx(Wu,{size:"xs",src:Ce.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),b.jsx(et,{fontSize:"xs",children:Ce.playerName}),Ce.role==="owner"&&b.jsx(Dn,{as:Mj,color:"green.400",boxSize:2.5}),Ce.role==="host"&&b.jsx(Dn,{as:jj,color:"purple.400",boxSize:2.5}),b.jsx(ck,{}),$==="owner"&&b.jsxs(rN,{closeOnSelect:!0,placement:"bottom-end",children:[b.jsx(iN,{as:Ys,"aria-label":"Options",icon:b.jsx(Qze,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),b.jsxs(sN,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[b.jsx(Tg,{icon:b.jsx(c9e,{}),onClick:()=>tt("mute",Ce),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:oe,children:"Mute Player"}),b.jsx(Tg,{icon:b.jsx(s9e,{}),onClick:()=>tt("promote",Ce),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),b.jsx(xre,{borderColor:"whiteAlpha.300"}),b.jsx(Tg,{icon:b.jsx(Xze,{}),onClick:()=>tt("kick",Ce),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!oe&&(ke?b.jsx(Xe,{color:"green.400",children:b.jsx(Vj,{})}):b.jsx(Xe,{color:"red.400",children:b.jsx(Uj,{})})),ye&&b.jsx(et,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),b.jsx(Qre,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:b.jsx(Xre,{children:b.jsxs(gr,{align:"center",spacing:3,children:[b.jsx(Wu,{size:"xl",src:Ce.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),b.jsx(et,{fontSize:"xl",fontWeight:"bold",children:Ce.playerName}),b.jsx(ze,{player:Ce}),Ce.firstName&&b.jsxs(et,{fontSize:"sm",color:"gray.300",children:[Ce.firstName," ",Ce.lastName]}),b.jsxs(ui,{spacing:4,pt:2,children:[Ce.linkedInProfile&&b.jsx(ho,{href:Ce.linkedInProfile,isExternal:!0,children:b.jsx(Ys,{icon:b.jsx(HN,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),Ce.websiteUrl&&b.jsx(ho,{href:Ce.websiteUrl,isExternal:!0,children:b.jsx(Ys,{icon:b.jsx(Dae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!oe&&b.jsx(Ys,{icon:ke?b.jsx(Vj,{}):b.jsx(Uj,{}),variant:"ghost",colorScheme:ke?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),oe&&b.jsx(Ys,{icon:b.jsx(a9e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ie)})})})]})};var $O={exports:{}},_9e=$O.exports,tZ;function y9e(){return tZ||(tZ=1,function(n,e){(function(i,a){n.exports=a()})(_9e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in t)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(t,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(t)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Py<"u"?Py:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},f=!u(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=f,E=Function.prototype,S=E.call,w=_&&E.bind.bind(S,S),I=_?w:function(t){return function(){return S.apply(t,arguments)}},k=I({}.isPrototypeOf),U=function(t){return t&&t.Math==Math&&t},L=U(typeof globalThis=="object"&&globalThis)||U(typeof window=="object"&&window)||U(typeof self=="object"&&self)||U(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),F=f,B=Function.prototype,q=B.apply,$=B.call,X=typeof Reflect=="object"&&Reflect.apply||(F?$.bind(q):function(){return $.apply(q,arguments)}),oe=I,re=oe({}.toString),pe=oe("".slice),te=function(t){return pe(re(t),8,-1)},Z=te,ne=I,ae=function(t){if(Z(t)==="Function")return ne(t)},me=typeof document=="object"&&document.all,he={all:me,IS_HTMLDDA:me===void 0&&me!==void 0},ue=he.all,Ue=he.IS_HTMLDDA?function(t){return typeof t=="function"||t===ue}:function(t){return typeof t=="function"},ze={},tt=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ce=f,Ie=Function.prototype.call,ye=Ce?Ie.bind(Ie):function(){return Ie.apply(Ie,arguments)},ke={},Te={}.propertyIsEnumerable,ve=Object.getOwnPropertyDescriptor,Re=ve&&!Te.call({1:2},1);ke.f=Re?function(t){var r=ve(this,t);return!!r&&r.enumerable}:Te;var Me,Ge,Qe=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},nt=u,ht=te,it=Object,It=I("".split),jt=nt(function(){return!it("z").propertyIsEnumerable(0)})?function(t){return ht(t)=="String"?It(t,""):it(t)}:it,Dt=function(t){return t==null},an=Dt,jn=TypeError,Qt=function(t){if(an(t))throw jn("Can't call method on "+t);return t},Ot=jt,Lt=Qt,we=function(t){return Ot(Lt(t))},Ve=Ue,$e=he.all,_t=he.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Ve(t)||t===$e}:function(t){return typeof t=="object"?t!==null:Ve(t)},vt={},St=vt,Ht=L,fn=Ue,mn=function(t){return fn(t)?t:void 0},Jt=function(t,r){return arguments.length<2?mn(St[t])||mn(Ht[t]):St[t]&&St[t][r]||Ht[t]&&Ht[t][r]},Hn=typeof navigator<"u"&&String(navigator.userAgent)||"",fc=L,Bt=Hn,un=fc.process,rs=fc.Deno,Fs=un&&un.versions||rs&&rs.version,Qs=Fs&&Fs.v8;Qs&&(Ge=(Me=Qs.split("."))[0]>0&&Me[0]<4?1:+(Me[0]+Me[1])),!Ge&&Bt&&(!(Me=Bt.match(/Edge\/(\d+)/))||Me[1]>=74)&&(Me=Bt.match(/Chrome\/(\d+)/))&&(Ge=+Me[1]);var Ei=Ge,Wa=Ei,dl=u,_o=L.String,yo=!!Object.getOwnPropertySymbols&&!dl(function(){var t=Symbol();return!_o(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Wa&&Wa<41}),Kl=yo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Bs=Jt,mc=Ue,ua=k,gc=Object,hl=Kl?function(t){return typeof t=="symbol"}:function(t){var r=Bs("Symbol");return mc(r)&&ua(r.prototype,gc(t))},Ku=String,_c=function(t){try{return Ku(t)}catch{return"Object"}},pl=Ue,Do=_c,Mi=TypeError,ds=function(t){if(pl(t))return t;throw Mi(Do(t)+" is not a function")},za=ds,qu=Dt,yc=function(t,r){var s=t[r];return qu(s)?void 0:za(s)},da=ye,ha=Ue,Qd=_t,Zg=TypeError,Yu={exports:{}},wp=L,Ws=Object.defineProperty,Xu=function(t,r){try{Ws(wp,t,{value:r,configurable:!0,writable:!0})}catch{wp[t]=r}return r},pa="__core-js_shared__",Zd=L[pa]||Xu(pa,{}),eh=Zd;(Yu.exports=function(t,r){return eh[t]||(eh[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ga=Yu.exports,th=Qt,Ju=Object,xo=function(t){return Ju(th(t))},nh=xo,$r=I({}.hasOwnProperty),vi=Object.hasOwn||function(t,r){return $r(nh(t),r)},Ec=I,fl=0,fa=Math.random(),Cp=Ec(1 .toString),rh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Cp(++fl+fa,36)},ql=Ga,Eo=vi,nm=rh,Zs=yo,Rp=Kl,ml=L.Symbol,ih=ql("wks"),sh=Rp?ml.for||ml:ml&&ml.withoutSetter||nm,_r=function(t){return Eo(ih,t)||(ih[t]=Zs&&Eo(ml,t)?ml[t]:sh("Symbol."+t)),ih[t]},Yl=ye,Xl=_t,Qu=hl,Ha=yc,Lo=function(t,r){var s,o;if(ha(s=t.toString)&&!Qd(o=da(s,t))||ha(s=t.valueOf)&&!Qd(o=da(s,t)))return o;throw Zg("Can't convert object to primitive value")},Zu=TypeError,gl=_r("toPrimitive"),Jl=function(t,r){if(!Xl(t)||Qu(t))return t;var s,o=Ha(t,gl);if(o){if(s=Yl(o,t,r),!Xl(s)||Qu(s))return s;throw Zu("Can't convert object to primitive value")}return Lo(t)},Xr=hl,$a=function(t){var r=Jl(t,"string");return Xr(r)?r:r+""},ar=_t,vc=L.document,rm=ar(vc)&&ar(vc.createElement),Ql=function(t){return rm?vc.createElement(t):{}},oh=Ql,Ip=!tt&&!u(function(){return Object.defineProperty(oh("div"),"a",{get:function(){return 7}}).a!=7}),im=tt,Ap=ye,Mo=ke,is=Qe,Uo=we,Vo=$a,Zl=vi,jo=Ip,Fo=Object.getOwnPropertyDescriptor;ze.f=im?Fo:function(t,r){if(t=Uo(t),r=Vo(r),jo)try{return Fo(t,r)}catch{}if(Zl(t,r))return is(!Ap(Mo.f,t,r),t[r])};var sm=u,Sc=Ue,hs=/#|\.prototype\./,ed=function(t,r){var s=_l[Pp(t)];return s==om||s!=eu&&(Sc(r)?sm(r):!!r)},Pp=ed.normalize=function(t){return String(t).replace(hs,".").toLowerCase()},_l=ed.data={},eu=ed.NATIVE="N",om=ed.POLYFILL="P",ma=ed,ga=ds,yl=f,Se=ae(ae.bind),De=function(t,r){return ga(t),r===void 0?t:yl?Se(t,r):function(){return t.apply(r,arguments)}},rt={},Yt=tt&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Xn=_t,Tr=String,Kr=TypeError,dn=function(t){if(Xn(t))return t;throw Kr(Tr(t)+" is not an object")},jr=tt,Si=Ip,Ps=Yt,Bo=dn,Wo=$a,td=TypeError,Ji=Object.defineProperty,El=Object.getOwnPropertyDescriptor,ah="enumerable",bc="configurable",e_="writable";rt.f=jr?Ps?function(t,r,s){if(Bo(t),r=Wo(r),Bo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&e_ in s&&!s[e_]){var o=El(t,r);o&&o[e_]&&(t[r]=s.value,s={configurable:bc in s?s[bc]:o[bc],enumerable:ah in s?s[ah]:o[ah],writable:!1})}return Ji(t,r,s)}:Ji:function(t,r,s){if(Bo(t),r=Wo(r),Bo(s),Si)try{return Ji(t,r,s)}catch{}if("get"in s||"set"in s)throw td("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var am=rt,nd=Qe,zo=tt?function(t,r,s){return am.f(t,r,nd(1,s))}:function(t,r,s){return t[r]=s,t},tu=L,cm=X,t_=ae,pE=Ue,lm=ze.f,um=ma,rd=vt,id=De,sd=zo,n_=vi,fE=function(t){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,o)}return new t(s,o,c)}return cm(t,this,arguments)};return r.prototype=t.prototype,r},Fn=function(t,r){var s,o,c,d,h,m,y,v,T,R=t.target,P=t.global,N=t.stat,G=t.proto,j=P?tu:N?tu[R]:(tu[R]||{}).prototype,W=P?rd:rd[R]||sd(rd,R,{})[R],Y=W.prototype;for(d in r)o=!(s=um(P?d:R+(N?".":"#")+d,t.forced))&&j&&n_(j,d),m=W[d],o&&(y=t.dontCallGetSet?(T=lm(j,d))&&T.value:j[d]),h=o&&y?y:r[d],o&&typeof m==typeof h||(v=t.bind&&o?id(h,tu):t.wrap&&o?fE(h):G&&pE(h)?t_(h):h,(t.sham||h&&h.sham||m&&m.sham)&&sd(v,"sham",!0),sd(W,d,v),G&&(n_(rd,c=R+"Prototype")||sd(rd,c,{}),sd(rd[c],d,h),t.real&&Y&&(s||!Y[d])&&sd(Y,d,h)))},dm=Math.ceil,Go=Math.floor,mE=Math.trunc||function(t){var r=+t;return(r>0?Go:dm)(r)},gE=mE,Tc=function(t){var r=+t;return r!=r||r===0?0:gE(r)},A=Tc,z=Math.max,ee=Math.min,fe=function(t,r){var s=A(t);return s<0?z(s+r,0):ee(s,r)},Ke=Tc,ct=Math.min,Ut=function(t){return t>0?ct(Ke(t),9007199254740991):0},Jr=Ut,hi=function(t){return Jr(t.length)},wr=we,zs=fe,ps=hi,Ka=function(t){return function(r,s,o){var c,d=wr(r),h=ps(d),m=zs(o,h);if(t&&s!=s){for(;h>m;)if((c=d[m++])!=c)return!0}else for(;h>m;m++)if((t||m in d)&&d[m]===s)return t||m||0;return!t&&-1}},Ho={includes:Ka(!0),indexOf:Ka(!1)},Op=Ho.includes;Fn({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return Op(this,t,arguments.length>1?arguments[1]:void 0)}});var hm=vt,qa=function(t){return hm[t+"Prototype"]},zR=qa("Array").includes,GR=_t,pm=te,KN=_r("match"),HR=function(t){var r;return GR(t)&&((r=t[KN])!==void 0?!!r:pm(t)=="RegExp")},qN=HR,$R=TypeError,ib={};ib[_r("toStringTag")]="z";var kp=String(ib)==="[object z]",r_=kp,YN=Ue,Np=te,XN=_r("toStringTag"),KR=Object,sb=Np(function(){return arguments}())=="Arguments",wc=r_?Np:function(t){var r,s,o;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(r=KR(t),XN))=="string"?s:sb?Np(r):(o=Np(r))=="Object"&&YN(r.callee)?"Arguments":o},qR=wc,YR=String,_a=function(t){if(qR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return YR(t)},JN=_r("match"),QN=Fn,ZN=function(t){if(qN(t))throw $R("The method doesn't accept regular expressions");return t},eD=Qt,XR=_a,vl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[JN]=!1,"/./"[t](r)}catch{}}return!1},i_=I("".indexOf);QN({target:"String",proto:!0,forced:!vl("includes")},{includes:function(t){return!!~i_(XR(eD(this)),XR(ZN(t)),arguments.length>1?arguments[1]:void 0)}});var JR=qa("String").includes,ob=k,QR=zR,ZR=JR,s_=Array.prototype,ab=String.prototype,tD=function(t){var r=t.includes;return t===s_||ob(s_,t)&&r===s_.includes?QR:typeof t=="string"||t===ab||ob(ab,t)&&r===ab.includes?ZR:r},at=l(tD),cb=ds,o_=xo,lb=jt,eI=hi,_E=TypeError,fm=function(t){return function(r,s,o,c){cb(s);var d=o_(r),h=lb(d),m=eI(d),y=t?m-1:0,v=t?-1:1;if(o<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw _E("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,d));return c}},ub={left:fm(!1)},tI=u,Dp=function(t,r){var s=[][t];return!!s&&tI(function(){s.call(null,r||function(){return 1},1)})},xp=typeof process<"u"&&te(process)=="process",nI=ub.left;Fn({target:"Array",proto:!0,forced:!xp&&Ei>79&&Ei<83||!Dp("reduce")},{reduce:function(t){var r=arguments.length;return nI(this,t,r,r>1?arguments[1]:void 0)}});var rI=qa("Array").reduce,iI=k,sI=rI,yE=Array.prototype,ch=function(t){var r=t.reduce;return t===yE||iI(yE,t)&&r===yE.reduce?sI:r},EE=ch,Ya=l(EE),nD=te,a_=Array.isArray||function(t){return nD(t)=="Array"},c_=Fn,rD=a_,oI=I([].reverse),db=[1,2];c_({target:"Array",proto:!0,forced:String(db)===String(db.reverse())},{reverse:function(){return rD(this)&&(this.length=this.length),oI(this)}});var Ai=qa("Array").reverse,hb=k,vE=Ai,Lp=Array.prototype,aI=function(t){var r=t.reverse;return t===Lp||hb(Lp,t)&&r===Lp.reverse?vE:r},SE=aI,mm=l(SE),bE=rh,Mp=Ga("keys"),l_=function(t){return Mp[t]||(Mp[t]=bE(t))},iD=!u(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),sD=vi,cI=Ue,TE=xo,wE=iD,CE=l_("IE_PROTO"),u_=Object,pb=u_.prototype,d_=wE?u_.getPrototypeOf:function(t){var r=TE(t);if(sD(r,CE))return r[CE];var s=r.constructor;return cI(s)&&r instanceof s?s.prototype:r instanceof u_?pb:null},oD=I,lI=ds,aD=Ue,cD=String,fb=TypeError,lh=function(t,r,s){try{return oD(lI(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},uI=dn,gm=function(t){if(typeof t=="object"||aD(t))return t;throw fb("Can't set "+cD(t)+" as a prototype")},nu=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=lh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return uI(o),gm(c),r?t(o,c):o.__proto__=c,o}}():void 0),uh={},Cc={},h_=vi,lD=we,uD=Ho.indexOf,Up=Cc,_m=I([].push),Vp=function(t,r){var s,o=lD(t),c=0,d=[];for(s in o)!h_(Up,s)&&h_(o,s)&&_m(d,s);for(;r.length>c;)h_(o,s=r[c++])&&(~uD(d,s)||_m(d,s));return d},ym=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],mb=Vp,Em=ym.concat("length","prototype");uh.f=Object.getOwnPropertyNames||function(t){return mb(t,Em)};var Rc={};Rc.f=Object.getOwnPropertySymbols;var Pi=Jt,bi=uh,dh=Rc,vo=dn,ya=I([].concat),jp=Pi("Reflect","ownKeys")||function(t){var r=bi.f(vo(t)),s=dh.f;return s?ya(r,s(t)):r},Fp=vi,Ea=jp,RE=ze,dI=rt,IE={},AE=Vp,hI=ym,Ic=Object.keys||function(t){return AE(t,hI)},PE=tt,gb=Yt,pI=rt,dD=dn,hh=we,vm=Ic;IE.f=PE&&!gb?Object.defineProperties:function(t,r){dD(t);for(var s,o=hh(r),c=vm(r),d=c.length,h=0;d>h;)pI.f(t,s=c[h++],o[s]);return t};var od,p_=Jt("document","documentElement"),OE=dn,Ac=IE,Xa=ym,Bp=Cc,ad=p_,cd=Ql,ld="prototype",kE="script",NE=l_("IE_PROTO"),f_=function(){},va=function(t){return"<"+kE+">"+t+"</"+kE+">"},Sa=function(t){t.write(va("")),t.close();var r=t.parentWindow.Object;return t=null,r},pi=function(){try{od=new ActiveXObject("htmlfile")}catch{}var t,r,s;pi=typeof document<"u"?document.domain&&od?Sa(od):(r=cd("iframe"),s="java"+kE+":",r.style.display="none",ad.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(va("document.F=Object")),t.close(),t.F):Sa(od);for(var o=Xa.length;o--;)delete pi[ld][Xa[o]];return pi()};Bp[NE]=!0;var $o=Object.create||function(t,r){var s;return t!==null?(f_[ld]=OE(t),s=new f_,f_[ld]=null,s[NE]=t):s=pi(),r===void 0?s:Ac.f(s,r)},fI=_t,mI=zo,DE=Error,_b=I("".replace),gI=String(DE("zxcasd").stack),m_=/\n\s*at [^:]*:[^\n]*/,_I=m_.test(gI),Sm=Qe,yb=!u(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Sm(1,7)),t.stack!==7)}),hD=zo,g_=function(t,r){if(_I&&typeof t=="string"&&!DE.prepareStackTrace)for(;r--;)t=_b(t,m_,"");return t},xE=yb,Eb=Error.captureStackTrace,ph={},bm=ph,yI=_r("iterator"),LE=Array.prototype,__=function(t){return t!==void 0&&(bm.Array===t||LE[yI]===t)},Tm=wc,ME=yc,vb=Dt,Sb=ph,bb=_r("iterator"),ud=function(t){if(!vb(t))return ME(t,bb)||ME(t,"@@iterator")||Sb[Tm(t)]},Pc=ye,Wp=ds,Tb=dn,EI=_c,dd=ud,fh=TypeError,y_=function(t,r){var s=arguments.length<2?dd(t):r;if(Wp(s))return Tb(Pc(s,t));throw fh(EI(t)+" is not iterable")},vI=ye,ru=dn,mh=yc,E_=function(t,r,s){var o,c;ru(t);try{if(!(o=mh(t,"return"))){if(r==="throw")throw s;return s}o=vI(o,t)}catch(d){c=!0,o=d}if(r==="throw")throw s;if(c)throw o;return ru(o),s},SI=De,UE=ye,bI=dn,v_=_c,iu=__,S_=hi,wm=k,zp=y_,wb=ud,Gp=E_,TI=TypeError,Cm=function(t,r){this.stopped=t,this.result=r},Di=Cm.prototype,gh=function(t,r,s){var o,c,d,h,m,y,v,T=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),N=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),j=SI(r,T),W=function(J){return o&&Gp(o,"normal",J),new Cm(!0,J)},Y=function(J){return R?(bI(J),G?j(J[0],J[1],W):j(J[0],J[1])):G?j(J,W):j(J)};if(P)o=t.iterator;else if(N)o=t;else{if(!(c=wb(t)))throw TI(v_(t)+" is not iterable");if(iu(c)){for(d=0,h=S_(t);h>d;d++)if((m=Y(t[d]))&&wm(Di,m))return m;return new Cm(!1)}o=zp(t,c)}for(y=P?t.next:o.next;!(v=UE(y,o)).done;){try{m=Y(v.value)}catch(J){Gp(o,"throw",J)}if(typeof m=="object"&&m&&wm(Di,m))return m}return new Cm(!1)},Cb=_a,Rb=Fn,VE=k,Ib=d_,su=nu,Ui=function(t,r,s){for(var o=Ea(r),c=dI.f,d=RE.f,h=0;h<o.length;h++){var m=o[h];Fp(t,m)||s&&Fp(s,m)||c(t,m,d(r,m))}},fs=$o,ms=zo,Rm=Qe,b_=function(t,r){fI(r)&&"cause"in r&&mI(t,"cause",r.cause)},T_=function(t,r,s,o){xE&&(Eb?Eb(t,r):hD(t,"stack",g_(s,o)))},pD=gh,So=function(t,r){return t===void 0?arguments.length<2?"":r:Cb(t)},Ab=_r("toStringTag"),Im=Error,Pb=[].push,Ko=function(t,r){var s,o=VE(ba,this);su?s=su(Im(),o?Ib(this):ba):(s=o?this:fs(ba),ms(s,Ab,"Error")),r!==void 0&&ms(s,"message",So(r)),T_(s,Ko,s.stack,1),arguments.length>2&&b_(s,arguments[2]);var c=[];return pD(t,Pb,{that:c}),ms(s,"errors",c),s};su?su(Ko,Im):Ui(Ko,Im,{name:!0});var ba=Ko.prototype=fs(Im.prototype,{constructor:Rm(1,Ko),message:Rm(1,""),name:Rm(1,"AggregateError")});Rb({global:!0},{AggregateError:Ko});var _h,Hp,Am,wI=Ue,Ob=L.WeakMap,CI=wI(Ob)&&/native code/.test(String(Ob)),kb=L,RI=_t,II=zo,jE=vi,FE=Zd,w_=l_,AI=Cc,C_="Object already initialized",Pm=kb.TypeError,PI=kb.WeakMap;if(CI||FE.state){var Oc=FE.state||(FE.state=new PI);Oc.get=Oc.get,Oc.has=Oc.has,Oc.set=Oc.set,_h=function(t,r){if(Oc.has(t))throw Pm(C_);return r.facade=t,Oc.set(t,r),r},Hp=function(t){return Oc.get(t)||{}},Am=function(t){return Oc.has(t)}}else{var $p=w_("state");AI[$p]=!0,_h=function(t,r){if(jE(t,$p))throw Pm(C_);return r.facade=t,II(t,$p,r),r},Hp=function(t){return jE(t,$p)?t[$p]:{}},Am=function(t){return jE(t,$p)}}var yh,Nb,Db,hd={set:_h,get:Hp,has:Am,enforce:function(t){return Am(t)?Hp(t):_h(t,{})},getterFor:function(t){return function(r){var s;if(!RI(r)||(s=Hp(r)).type!==t)throw Pm("Incompatible receiver, "+t+" required");return s}}},BE=tt,OI=vi,xb=Function.prototype,fD=BE&&Object.getOwnPropertyDescriptor,Lb=OI(xb,"name"),kI={PROPER:Lb&&(function(){}).name==="something",CONFIGURABLE:Lb&&(!BE||BE&&fD(xb,"name").configurable)},mD=zo,pd=function(t,r,s,o){return o&&o.enumerable?t[r]=s:mD(t,r,s),t},NI=u,DI=Ue,WE=_t,gD=$o,xI=d_,_D=pd,Ja=_r("iterator"),zE=!1;[].keys&&("next"in(Db=[].keys())?(Nb=xI(xI(Db)))!==Object.prototype&&(yh=Nb):zE=!0);var GE=!WE(yh)||NI(function(){var t={};return yh[Ja].call(t)!==t});DI((yh=GE?{}:gD(yh))[Ja])||_D(yh,Ja,function(){return this});var Mb={IteratorPrototype:yh,BUGGY_SAFARI_ITERATORS:zE},LI=wc,MI=kp?{}.toString:function(){return"[object "+LI(this)+"]"},Ub=kp,Om=rt.f,Vb=zo,jb=vi,yD=MI,Fb=_r("toStringTag"),fd=function(t,r,s,o){if(t){var c=s?t:t.prototype;jb(c,Fb)||Om(c,Fb,{configurable:!0,value:r}),o&&!Ub&&Vb(c,"toString",yD)}},UI=Mb.IteratorPrototype,VI=$o,jI=Qe,ED=fd,Ta=ph,qo=function(){return this},HE=function(t,r,s,o){var c=r+" Iterator";return t.prototype=VI(UI,{next:jI(+!o,s)}),ED(t,c,!1,!0),Ta[c]=qo,t},FI=Fn,BI=ye,WI=kI,zI=HE,Bb=d_,GI=fd,$E=pd,Wb=ph,HI=Mb,zb=WI.PROPER,km=HI.BUGGY_SAFARI_ITERATORS,KE=_r("iterator"),qE="keys",Kp="values",$I="entries",KI=function(){return this},YE=function(t,r,s,o,c,d,h){zI(s,r,o);var m,y,v,T=function(Y){if(Y===c&&j)return j;if(!km&&Y in N)return N[Y];switch(Y){case qE:case Kp:case $I:return function(){return new s(this,Y)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,N=t.prototype,G=N[KE]||N["@@iterator"]||c&&N[c],j=!km&&G||T(c),W=r=="Array"&&N.entries||G;if(W&&(m=Bb(W.call(new t)))!==Object.prototype&&m.next&&(GI(m,R,!0,!0),Wb[R]=KI),zb&&c==Kp&&G&&G.name!==Kp&&(P=!0,j=function(){return BI(G,this)}),c)if(y={values:T(Kp),keys:d?j:T(qE),entries:T($I)},h)for(v in y)(km||P||!(v in N))&&$E(N,v,y[v]);else FI({target:r,proto:!0,forced:km||P},y);return h&&N[KE]!==j&&$E(N,KE,j,{}),Wb[r]=j,y},XE=function(t,r){return{value:t,done:r}},JE=we,ou=ph,qI=hd;rt.f;var YI=YE,QE=XE,Gb="Array Iterator",XI=qI.set,R_=qI.getterFor(Gb);YI(Array,"Array",function(t,r){XI(this,{type:Gb,target:JE(t),index:0,kind:r})},function(){var t=R_(this),r=t.target,s=t.kind,o=t.index++;return!r||o>=r.length?(t.target=void 0,QE(void 0,!0)):QE(s=="keys"?o:s=="values"?r[o]:[o,r[o]],!1)},"values"),ou.Arguments=ou.Array;var bo=rt,ZE=function(t,r,s){return bo.f(t,r,s)},vD=Jt,ev=ZE,To=tt,JI=_r("species"),Zt=k,Nm=TypeError,I_=function(t,r){if(Zt(r,t))return t;throw Nm("Incorrect invocation")},QI=Ue,Hb=Zd,A_=I(Function.toString);QI(Hb.inspectSource)||(Hb.inspectSource=function(t){return A_(t)});var P_=Hb.inspectSource,$b=I,ZI=u,Kb=Ue,eA=wc,qb=P_,tv=function(){},eo=[],kc=Jt("Reflect","construct"),au=/^\s*(?:class|function)\b/,tA=$b(au.exec),nA=!au.exec(tv),Yo=function(t){if(!Kb(t))return!1;try{return kc(tv,eo,t),!0}catch{return!1}},Yb=function(t){if(!Kb(t))return!1;switch(eA(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return nA||!!tA(au,qb(t))}catch{return!0}};Yb.sham=!0;var wa,Dm,Xb,nv,O_=!kc||ZI(function(){var t;return Yo(Yo.call)||!Yo(Object)||!Yo(function(){t=!0})||t})?Yb:Yo,rA=O_,SD=_c,rv=TypeError,iv=dn,Nc=function(t){if(rA(t))return t;throw rv(SD(t)+" is not a constructor")},Or=Dt,Gs=_r("species"),Qi=function(t,r){var s,o=iv(t).constructor;return o===void 0||Or(s=iv(o)[Gs])?r:Nc(s)},gs=I([].slice),Qa=TypeError,Sl=function(t,r){if(t<r)throw Qa("Not enough arguments");return t},_s=/(?:ipad|iphone|ipod).*applewebkit/i.test(Hn),to=L,qp=X,sv=De,ov=Ue,k_=vi,Xo=u,av=p_,xm=gs,cu=Ql,cv=Sl,Jb=_s,Eh=xp,Lm=to.setImmediate,lu=to.clearImmediate,lv=to.process,Yp=to.Dispatch,Qb=to.Function,N_=to.MessageChannel,uv=to.String,no=0,Dc={},xc="onreadystatechange";Xo(function(){wa=to.location});var wo=function(t){if(k_(Dc,t)){var r=Dc[t];delete Dc[t],r()}},dv=function(t){return function(){wo(t)}},hv=function(t){wo(t.data)},pv=function(t){to.postMessage(uv(t),wa.protocol+"//"+wa.host)};Lm&&lu||(Lm=function(t){cv(arguments.length,1);var r=ov(t)?t:Qb(t),s=xm(arguments,1);return Dc[++no]=function(){qp(r,void 0,s)},Dm(no),no},lu=function(t){delete Dc[t]},Eh?Dm=function(t){lv.nextTick(dv(t))}:Yp&&Yp.now?Dm=function(t){Yp.now(dv(t))}:N_&&!Jb?(nv=(Xb=new N_).port2,Xb.port1.onmessage=hv,Dm=sv(nv.postMessage,nv)):to.addEventListener&&ov(to.postMessage)&&!to.importScripts&&wa&&wa.protocol!=="file:"&&!Xo(pv)?(Dm=pv,to.addEventListener("message",hv,!1)):Dm=xc in cu("script")?function(t){av.appendChild(cu("script"))[xc]=function(){av.removeChild(this),wo(t)}}:function(t){setTimeout(dv(t),0)});var fv={set:Lm,clear:lu},md=function(){this.head=null,this.tail=null};md.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Xp,D_,gd,x_,vh,Zb=md,iA=/ipad|iphone|ipod/i.test(Hn)&&typeof Pebble<"u",eT=/web0s(?!.*chrome)/i.test(Hn),uu=L,sA=De,bD=ze.f,mv=fv.set,oA=Zb,Jp=_s,TD=iA,Mm=eT,gv=xp,Vi=uu.MutationObserver||uu.WebKitMutationObserver,aA=uu.document,tT=uu.process,_v=uu.Promise,cA=bD(uu,"queueMicrotask"),yv=cA&&cA.value;if(!yv){var L_=new oA,Ev=function(){var t,r;for(gv&&(t=tT.domain)&&t.exit();r=L_.get();)try{r()}catch(s){throw L_.head&&Xp(),s}t&&t.enter()};Jp||gv||Mm||!Vi||!aA?!TD&&_v&&_v.resolve?((x_=_v.resolve(void 0)).constructor=_v,vh=sA(x_.then,x_),Xp=function(){vh(Ev)}):gv?Xp=function(){tT.nextTick(Ev)}:(mv=sA(mv,uu),Xp=function(){mv(Ev)}):(D_=!0,gd=aA.createTextNode(""),new Vi(Ev).observe(gd,{characterData:!0}),Xp=function(){gd.data=D_=!D_}),yv=function(t){L_.head||Xp(),L_.add(t)}}var Za=yv,Sh=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Qp=L.Promise,_d=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",vv=!_d&&!xp&&typeof window=="object"&&typeof document=="object",Zp=L,bh=Qp,nT=Ue,rT=ma,wD=P_,iT=_r,CD=vv,lA=_d,Sv=Ei,M_=bh&&bh.prototype,bv=iT("species"),sT=nT(Zp.PromiseRejectionEvent),oT=rT("Promise",function(){var t=wD(bh),r=t!==String(bh);if(!r&&Sv===66||!M_.catch||!M_.finally)return!0;if(!Sv||Sv<51||!/native code/.test(t)){var s=new bh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[bv]=o,!(s.then(function(){})instanceof o))return!0}return!r&&(CD||lA)&&!sT}),U_={CONSTRUCTOR:oT,REJECTION_EVENT:sT},bl={},Tv=ds,wv=TypeError,aT=function(t){var r,s;this.promise=new t(function(o,c){if(r!==void 0||s!==void 0)throw wv("Bad Promise constructor");r=o,s=c}),this.resolve=Tv(r),this.reject=Tv(s)};bl.f=function(t){return new aT(t)};var Um,cT,RD=Fn,ef=xp,Th=L,yd=ye,ID=pd,Cv=fd,p=function(t){var r=vD(t);To&&r&&!r[JI]&&ev(r,JI,{configurable:!0,get:function(){return this}})},g=ds,C=Ue,O=_t,V=I_,H=Qi,ce=fv.set,Ae=Za,Le=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},st=Sh,At=Zb,Pt=hd,Rt=Qp,Kt=U_,tn=bl,nn="Promise",Zi=Kt.CONSTRUCTOR,Ye=Kt.REJECTION_EVENT,je=Pt.getterFor(nn),Ze=Pt.set,xt=Rt&&Rt.prototype,rn=Rt,gn=xt,vn=Th.TypeError,Ln=Th.document,ys=Th.process,Cr=tn.f,wh=Cr,AD=!!(Ln&&Ln.createEvent&&Th.dispatchEvent),V3="unhandledrejection",j3=function(t){var r;return!(!O(t)||!C(r=t.then))&&r},F3=function(t,r){var s,o,c,d=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,T=t.domain;try{m?(h||(r.rejection===2&&Kae(r),r.rejection=1),m===!0?s=d:(T&&T.enter(),s=m(d),T&&(T.exit(),c=!0)),s===t.promise?v(vn("Promise-chain cycle")):(o=j3(s))?yd(o,s,y,v):y(s)):v(d)}catch(R){T&&!c&&T.exit(),v(R)}},B3=function(t,r){t.notified||(t.notified=!0,Ae(function(){for(var s,o=t.reactions;s=o.get();)F3(s,t);t.notified=!1,r&&!t.rejection&&$ae(t)}))},W3=function(t,r,s){var o,c;AD?((o=Ln.createEvent("Event")).promise=r,o.reason=s,o.initEvent(t,!1,!0),Th.dispatchEvent(o)):o={promise:r,reason:s},!Ye&&(c=Th["on"+t])?c(o):t===V3&&Le("Unhandled promise rejection",s)},$ae=function(t){yd(ce,Th,function(){var r,s=t.facade,o=t.value;if(z3(t)&&(r=st(function(){ef?ys.emit("unhandledRejection",o,s):W3(V3,s,o)}),t.rejection=ef||z3(t)?2:1,r.error))throw r.value})},z3=function(t){return t.rejection!==1&&!t.parent},Kae=function(t){yd(ce,Th,function(){var r=t.facade;ef?ys.emit("rejectionHandled",r):W3("rejectionhandled",r,t.value)})},Rv=function(t,r,s){return function(o){t(r,o,s)}},Iv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,B3(t,!0))},PD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw vn("Promise can't be resolved itself");var o=j3(r);o?Ae(function(){var c={done:!1};try{yd(o,r,Rv(PD,c,t),Rv(Iv,c,t))}catch(d){Iv(c,d,t)}}):(t.value=r,t.state=1,B3(t,!1))}catch(c){Iv({done:!1},c,t)}}};Zi&&(gn=(rn=function(t){V(this,gn),g(t),yd(Um,this);var r=je(this);try{t(Rv(PD,r),Rv(Iv,r))}catch(s){Iv(r,s)}}).prototype,(Um=function(t){Ze(this,{type:nn,done:!1,notified:!1,parent:!1,reactions:new At,rejection:!1,state:0,value:void 0})}).prototype=ID(gn,"then",function(t,r){var s=je(this),o=Cr(H(this,rn));return s.parent=!0,o.ok=!C(t)||t,o.fail=C(r)&&r,o.domain=ef?ys.domain:void 0,s.state==0?s.reactions.add(o):Ae(function(){F3(o,s)}),o.promise}),cT=function(){var t=new Um,r=je(t);this.promise=t,this.resolve=Rv(PD,r),this.reject=Rv(Iv,r)},tn.f=Cr=function(t){return t===rn||t===void 0?new cT(t):wh(t)}),RD({global:!0,wrap:!0,forced:Zi},{Promise:rn}),Cv(rn,nn,!1,!0),p(nn);var G3=_r("iterator"),H3=!1;try{var qae=0,$3={next:function(){return{done:!!qae++}},return:function(){H3=!0}};$3[G3]=function(){return this},Array.from($3,function(){throw 2})}catch{}var Yae=Qp,Xae=function(t,r){if(!H3)return!1;var s=!1;try{var o={};o[G3]=function(){return{next:function(){return{done:s=!0}}}},t(o)}catch{}return s},uA=U_.CONSTRUCTOR||!Xae(function(t){Yae.all(t).then(void 0,function(){})}),Jae=ye,Qae=ds,Zae=bl,ece=Sh,tce=gh;Fn({target:"Promise",stat:!0,forced:uA},{all:function(t){var r=this,s=Zae.f(r),o=s.resolve,c=s.reject,d=ece(function(){var h=Qae(r.resolve),m=[],y=0,v=1;tce(t,function(T){var R=y++,P=!1;v++,Jae(h,r,T).then(function(N){P||(P=!0,m[R]=N,--v||o(m))},c)}),--v||o(m)});return d.error&&c(d.value),s.promise}});var nce=Fn,rce=U_.CONSTRUCTOR;Qp&&Qp.prototype,nce({target:"Promise",proto:!0,forced:rce,real:!0},{catch:function(t){return this.then(void 0,t)}});var ice=ye,sce=ds,oce=bl,ace=Sh,cce=gh;Fn({target:"Promise",stat:!0,forced:uA},{race:function(t){var r=this,s=oce.f(r),o=s.reject,c=ace(function(){var d=sce(r.resolve);cce(t,function(h){ice(d,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var lce=ye,uce=bl;Fn({target:"Promise",stat:!0,forced:U_.CONSTRUCTOR},{reject:function(t){var r=uce.f(this);return lce(r.reject,void 0,t),r.promise}});var dce=dn,hce=_t,pce=bl,K3=function(t,r){if(dce(t),hce(r)&&r.constructor===t)return r;var s=pce.f(t);return(0,s.resolve)(r),s.promise},fce=Fn,mce=Qp,gce=U_.CONSTRUCTOR,_ce=K3,yce=Jt("Promise"),Ece=!gce;fce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return _ce(Ece&&this===yce?mce:this,t)}});var vce=ye,Sce=ds,bce=bl,Tce=Sh,wce=gh;Fn({target:"Promise",stat:!0,forced:uA},{allSettled:function(t){var r=this,s=bce.f(r),o=s.resolve,c=s.reject,d=Tce(function(){var h=Sce(r.resolve),m=[],y=0,v=1;wce(t,function(T){var R=y++,P=!1;v++,vce(h,r,T).then(function(N){P||(P=!0,m[R]={status:"fulfilled",value:N},--v||o(m))},function(N){P||(P=!0,m[R]={status:"rejected",reason:N},--v||o(m))})}),--v||o(m)});return d.error&&c(d.value),s.promise}});var Cce=ye,Rce=ds,Ice=Jt,Ace=bl,Pce=Sh,Oce=gh,q3="No one promise resolved";Fn({target:"Promise",stat:!0,forced:uA},{any:function(t){var r=this,s=Ice("AggregateError"),o=Ace.f(r),c=o.resolve,d=o.reject,h=Pce(function(){var m=Rce(r.resolve),y=[],v=0,T=1,R=!1;Oce(t,function(P){var N=v++,G=!1;T++,Cce(m,r,P).then(function(j){G||R||(R=!0,c(j))},function(j){G||R||(G=!0,y[N]=j,--T||d(new s(y,q3)))})}),--T||d(new s(y,q3))});return h.error&&d(h.value),o.promise}});var kce=Fn,OD=Qp,Nce=u,Dce=Jt,xce=Ue,Lce=Qi,Y3=K3,Mce=OD&&OD.prototype;kce({target:"Promise",proto:!0,real:!0,forced:!!OD&&Nce(function(){Mce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Lce(this,Dce("Promise")),s=xce(t);return this.then(s?function(o){return Y3(r,t()).then(function(){return o})}:t,s?function(o){return Y3(r,t()).then(function(){throw o})}:t)}});var kD=I,Uce=Tc,Vce=_a,jce=Qt,Fce=kD("".charAt),X3=kD("".charCodeAt),Bce=kD("".slice),J3=function(t){return function(r,s){var o,c,d=Vce(jce(r)),h=Uce(s),m=d.length;return h<0||h>=m?t?"":void 0:(o=X3(d,h))<55296||o>56319||h+1===m||(c=X3(d,h+1))<56320||c>57343?t?Fce(d,h):o:t?Bce(d,h,h+2):c-56320+(o-55296<<10)+65536}},ND={codeAt:J3(!1),charAt:J3(!0)},Wce=ND.charAt,zce=_a,Q3=hd,Gce=YE,Z3=XE,e4="String Iterator",Hce=Q3.set,$ce=Q3.getterFor(e4);Gce(String,"String",function(t){Hce(this,{type:e4,string:zce(t),index:0})},function(){var t,r=$ce(this),s=r.string,o=r.index;return o>=s.length?Z3(void 0,!0):(t=Wce(s,o),r.index+=t.length,Z3(t,!1))});var Kce=vt.Promise,qce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Yce=L,Xce=wc,Jce=zo,t4=ph,n4=_r("toStringTag");for(var DD in qce){var r4=Yce[DD],xD=r4&&r4.prototype;xD&&Xce(xD)!==n4&&Jce(xD,n4,DD),t4[DD]=t4.Array}var i4=Kce,ut=l(i4),Qce=qa("Array").values,Zce=wc,ele=vi,tle=k,nle=Qce,LD=Array.prototype,rle={DOMTokenList:!0,NodeList:!0},ile=function(t){var r=t.values;return t===LD||tle(LD,t)&&r===LD.values||ele(rle,Zce(t))?nle:r},Lc=l(ile),sle=u,ole=_r("iterator"),MD=!sle(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),o="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),o+=d+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[ole]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),ale=pd,cle=$a,lle=rt,ule=Qe,dA=function(t,r,s){var o=cle(r);o in t?lle.f(t,o,ule(0,s)):t[o]=s},s4=fe,dle=hi,hle=dA,ple=Array,fle=Math.max,UD=function(t,r,s){for(var o=dle(t),c=s4(r,o),d=s4(s===void 0?o:s,o),h=ple(fle(d-c,0)),m=0;c<d;c++,m++)hle(h,m,t[c]);return h.length=m,h},o4=UD,mle=Math.floor,VD=function(t,r){var s=t.length,o=mle(s/2);return s<8?gle(t,r):_le(t,VD(o4(t,0,o),r),VD(o4(t,o),r),r)},gle=function(t,r){for(var s,o,c=t.length,d=1;d<c;){for(o=d,s=t[d];o&&r(t[o-1],s)>0;)t[o]=t[--o];o!==d++&&(t[o]=s)}return t},_le=function(t,r,s,o){for(var c=r.length,d=s.length,h=0,m=0;h<c||m<d;)t[h+m]=h<c&&m<d?o(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},a4=VD,jD=Fn,Av=L,hA=ye,Ch=I,Pv=tt,c4=MD,l4=pd,yle=ZE,Ele=function(t,r,s){for(var o in r)s&&s.unsafe&&t[o]?t[o]=r[o]:ale(t,o,r[o],s);return t},vle=fd,Sle=HE,FD=hd,u4=I_,BD=Ue,ble=vi,Tle=De,wle=wc,Cle=dn,d4=_t,ec=_a,Rle=$o,h4=Qe,WD=y_,Ile=ud,Ov=Sl,Ale=a4,Ple=_r("iterator"),lT="URLSearchParams",p4=lT+"Iterator",f4=FD.set,du=FD.getterFor(lT),Ole=FD.getterFor(p4),kle=Object.getOwnPropertyDescriptor,zD=function(t){if(!Pv)return Av[t];var r=kle(Av,t);return r&&r.value},m4=zD("fetch"),pA=zD("Request"),uT=zD("Headers"),GD=pA&&pA.prototype,g4=uT&&uT.prototype,Nle=Av.RegExp,Dle=Av.TypeError,_4=Av.decodeURIComponent,xle=Av.encodeURIComponent,Lle=Ch("".charAt),y4=Ch([].join),V_=Ch([].push),HD=Ch("".replace),Mle=Ch([].shift),E4=Ch([].splice),v4=Ch("".split),Ule=Ch("".slice),Vle=/\+/g,S4=Array(4),jle=function(t){return S4[t-1]||(S4[t-1]=Nle("((?:%[\\da-f]{2}){"+t+"})","gi"))},Fle=function(t){try{return _4(t)}catch{return t}},b4=function(t){var r=HD(t,Vle," "),s=4;try{return _4(r)}catch{for(;s;)r=HD(r,jle(s--),Fle);return r}},Ble=/[!'()~]|%20/g,Wle={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zle=function(t){return Wle[t]},T4=function(t){return HD(xle(t),Ble,zle)},$D=Sle(function(t,r){f4(this,{type:p4,iterator:WD(du(t).entries),kind:r})},"Iterator",function(){var t=Ole(this),r=t.kind,s=t.iterator.next(),o=s.value;return s.done||(s.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),s},!0),w4=function(t){this.entries=[],this.url=null,t!==void 0&&(d4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Lle(t,0)==="?"?Ule(t,1):t:ec(t)))};w4.prototype={type:lT,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,o,c,d,h,m,y=Ile(t);if(y)for(s=(r=WD(t,y)).next;!(o=hA(s,r)).done;){if(d=(c=WD(Cle(o.value))).next,(h=hA(d,c)).done||(m=hA(d,c)).done||!hA(d,c).done)throw Dle("Expected sequence with length 2");V_(this.entries,{key:ec(h.value),value:ec(m.value)})}else for(var v in t)ble(t,v)&&V_(this.entries,{key:v,value:ec(t[v])})},parseQuery:function(t){if(t)for(var r,s,o=v4(t,"&"),c=0;c<o.length;)(r=o[c++]).length&&(s=v4(r,"="),V_(this.entries,{key:b4(Mle(s)),value:b4(y4(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],o=0;o<r.length;)t=r[o++],V_(s,T4(t.key)+"="+T4(t.value));return y4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var fA=function(){u4(this,kv);var t=f4(this,new w4(arguments.length>0?arguments[0]:void 0));Pv||(this.size=t.entries.length)},kv=fA.prototype;if(Ele(kv,{append:function(t,r){var s=du(this);Ov(arguments.length,2),V_(s.entries,{key:ec(t),value:ec(r)}),Pv||this.length++,s.updateURL()},delete:function(t){for(var r=du(this),s=Ov(arguments.length,1),o=r.entries,c=ec(t),d=s<2?void 0:arguments[1],h=d===void 0?d:ec(d),m=0;m<o.length;){var y=o[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(E4(o,m,1),h!==void 0)break}Pv||(this.size=o.length),r.updateURL()},get:function(t){var r=du(this).entries;Ov(arguments.length,1);for(var s=ec(t),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(t){var r=du(this).entries;Ov(arguments.length,1);for(var s=ec(t),o=[],c=0;c<r.length;c++)r[c].key===s&&V_(o,r[c].value);return o},has:function(t){for(var r=du(this).entries,s=Ov(arguments.length,1),o=ec(t),c=s<2?void 0:arguments[1],d=c===void 0?c:ec(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=du(this);Ov(arguments.length,1);for(var o,c=s.entries,d=!1,h=ec(t),m=ec(r),y=0;y<c.length;y++)(o=c[y]).key===h&&(d?E4(c,y--,1):(d=!0,o.value=m));d||V_(c,{key:h,value:m}),Pv||(this.size=c.length),s.updateURL()},sort:function(){var t=du(this);Ale(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=du(this).entries,o=Tle(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new $D(this,"keys")},values:function(){return new $D(this,"values")},entries:function(){return new $D(this,"entries")}},{enumerable:!0}),l4(kv,Ple,kv.entries,{}),l4(kv,"toString",function(){return du(this).serialize()},{enumerable:!0}),Pv&&yle(kv,"size",{get:function(){return du(this).entries.length},configurable:!0,enumerable:!0}),vle(fA,lT),jD({global:!0,forced:!c4},{URLSearchParams:fA}),!c4&&BD(uT)){var Gle=Ch(g4.has),Hle=Ch(g4.set),C4=function(t){if(d4(t)){var r,s=t.body;if(wle(s)===lT)return r=t.headers?new uT(t.headers):new uT,Gle(r,"content-type")||Hle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Rle(t,{body:h4(0,ec(s)),headers:h4(0,r)})}return t};if(BD(m4)&&jD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return m4(t,arguments.length>1?C4(arguments[1]):{})}}),BD(pA)){var KD=function(t){return u4(this,GD),new pA(t,arguments.length>1?C4(arguments[1]):{})};GD.constructor=KD,KD.prototype=GD,jD({global:!0,dontCallGetSet:!0,forced:!0},{Request:KD})}}var hu,$le={URLSearchParams:fA,getState:du},Kle=vt.URLSearchParams,R4=tt,qle=I,Yle=ye,Xle=u,qD=Ic,Jle=Rc,Qle=ke,Zle=xo,eue=jt,Nv=Object.assign,I4=Object.defineProperty,tue=qle([].concat),nue=!Nv||Xle(function(){if(R4&&Nv({b:1},Nv(I4({},"a",{enumerable:!0,get:function(){I4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),o="abcdefghijklmnopqrst";return t[s]=7,o.split("").forEach(function(c){r[c]=c}),Nv({},t)[s]!=7||qD(Nv({},r)).join("")!=o})?function(t,r){for(var s=Zle(t),o=arguments.length,c=1,d=Jle.f,h=Qle.f;o>c;)for(var m,y=eue(arguments[c++]),v=d?tue(qD(y),d(y)):qD(y),T=v.length,R=0;T>R;)m=v[R++],R4&&!Yle(h,y,m)||(s[m]=y[m]);return s}:Nv,rue=dn,iue=E_,sue=De,oue=ye,aue=xo,cue=function(t,r,s,o){try{return o?r(rue(s)[0],s[1]):r(s)}catch(c){iue(t,"throw",c)}},lue=__,uue=O_,due=hi,A4=dA,hue=y_,pue=ud,P4=Array,j_=I,YD=2147483647,fue=/[^\0-\u007E]/,O4=/[.\u3002\uFF0E\uFF61]/g,k4="Overflow: input needs wider integers to process",N4=RangeError,mue=j_(O4.exec),Dv=Math.floor,XD=String.fromCharCode,D4=j_("".charCodeAt),x4=j_([].join),Vm=j_([].push),gue=j_("".replace),_ue=j_("".split),yue=j_("".toLowerCase),L4=function(t){return t+22+75*(t<26)},Eue=function(t,r,s){var o=0;for(t=s?Dv(t/700):t>>1,t+=Dv(t/r);t>455;)t=Dv(t/35),o+=36;return Dv(o+36*t/(t+38))},vue=function(t){var r=[];t=function(Y){for(var J=[],le=0,_e=Y.length;le<_e;){var Ee=D4(Y,le++);if(Ee>=55296&&Ee<=56319&&le<_e){var ge=D4(Y,le++);(64512&ge)==56320?Vm(J,((1023&Ee)<<10)+(1023&ge)+65536):(Vm(J,Ee),le--)}else Vm(J,Ee)}return J}(t);var s,o,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(o=t[s])<128&&Vm(r,XD(o));var y=r.length,v=y;for(y&&Vm(r,"-");v<c;){var T=YD;for(s=0;s<t.length;s++)(o=t[s])>=d&&o<T&&(T=o);var R=v+1;if(T-d>Dv((YD-h)/R))throw N4(k4);for(h+=(T-d)*R,d=T,s=0;s<t.length;s++){if((o=t[s])<d&&++h>YD)throw N4(k4);if(o==d){for(var P=h,N=36;;){var G=N<=m?1:N>=m+26?26:N-m;if(P<G)break;var j=P-G,W=36-G;Vm(r,XD(L4(G+j%W))),P=Dv(j/W),N+=36}Vm(r,XD(L4(P))),m=Eue(h,R,v==y),h=0,v++}}h++,d++}return x4(r,"")},Sue=Fn,JD=tt,bue=MD,QD=L,M4=De,pu=I,mA=pd,fu=ZE,Tue=I_,ZD=vi,ex=nue,xv=function(t){var r=aue(t),s=uue(this),o=arguments.length,c=o>1?arguments[1]:void 0,d=c!==void 0;d&&(c=sue(c,o>2?arguments[2]:void 0));var h,m,y,v,T,R,P=pue(r),N=0;if(!P||this===P4&&lue(P))for(h=due(r),m=s?new this(h):P4(h);h>N;N++)R=d?c(r[N],N):r[N],A4(m,N,R);else for(T=(v=hue(r,P)).next,m=s?new this:[];!(y=oue(T,v)).done;N++)R=d?cue(v,c,[y.value,N],!0):y.value,A4(m,N,R);return m.length=N,m},Ed=UD,wue=ND.codeAt,Cue=function(t){var r,s,o=[],c=_ue(gue(yue(t),O4,"."),".");for(r=0;r<c.length;r++)s=c[r],Vm(o,mue(fue,s)?"xn--"+vue(s):s);return x4(o,".")},tf=_a,Rue=fd,Iue=Sl,U4=$le,V4=hd,Aue=V4.set,gA=V4.getterFor("URL"),Pue=U4.URLSearchParams,Oue=U4.getState,dT=QD.URL,tx=QD.TypeError,_A=QD.parseInt,kue=Math.floor,j4=Math.pow,mu=pu("".charAt),vd=pu(/./.exec),hT=pu([].join),Nue=pu(1 .toString),Due=pu([].pop),Lv=pu([].push),nx=pu("".replace),xue=pu([].shift),Lue=pu("".split),pT=pu("".slice),yA=pu("".toLowerCase),Mue=pu([].unshift),rx="Invalid scheme",F_="Invalid host",F4="Invalid port",B4=/[a-z]/i,Uue=/[\d+-.a-z]/i,ix=/\d/,Vue=/^0x/i,jue=/^[0-7]+$/,Fue=/^\d+$/,W4=/^[\da-f]+$/i,Bue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Wue=/[\0\t\n\r #/:<>?@[\\\]^|]/,zue=/^[\u0000-\u0020]+/,Gue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Hue=/[\t\n\r]/g,fT=function(t){var r,s,o,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Mue(r,t%256),t=kue(t/256);return hT(r,".")}if(typeof t=="object"){for(r="",o=function(d){for(var h=null,m=1,y=null,v=0,T=0;T<8;T++)d[T]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=T),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=Nue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},EA={},z4=ex({},EA,{" ":1,'"':1,"<":1,">":1,"`":1}),G4=ex({},z4,{"#":1,"?":1,"{":1,"}":1}),sx=ex({},G4,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),jm=function(t,r){var s=wue(t,0);return s>32&&s<127&&!ZD(r,t)?t:encodeURIComponent(t)},vA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},mT=function(t,r){var s;return t.length==2&&vd(B4,mu(t,0))&&((s=mu(t,1))==":"||!r&&s=="|")},H4=function(t){var r;return t.length>1&&mT(pT(t,0,2))&&(t.length==2||(r=mu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},$ue=function(t){return t==="."||yA(t)==="%2e"},ox={},$4={},ax={},K4={},q4={},cx={},Y4={},X4={},SA={},bA={},lx={},ux={},dx={},hx={},J4={},px={},Mv={},Rh={},Q4={},B_={},nf={},fx=function(t,r,s){var o,c,d,h=tf(t);if(r){if(c=this.parse(h))throw tx(c);this.searchParams=null}else{if(s!==void 0&&(o=new fx(s,!0)),c=this.parse(h,null,o))throw tx(c);(d=Oue(new Pue)).bindURL(this),this.searchParams=d}};fx.prototype={type:"URL",parse:function(t,r,s){var o,c,d,h,m,y=this,v=r||ox,T=0,R="",P=!1,N=!1,G=!1;for(t=tf(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=nx(t,zue,""),t=nx(t,Gue,"$1")),t=nx(t,Hue,""),o=xv(t);T<=o.length;){switch(c=o[T],v){case ox:if(!c||!vd(B4,c)){if(r)return rx;v=ax;continue}R+=yA(c),v=$4;break;case $4:if(c&&(vd(Uue,c)||c=="+"||c=="-"||c=="."))R+=yA(c);else{if(c!=":"){if(r)return rx;R="",v=ax,T=0;continue}if(r&&(y.isSpecial()!=ZD(vA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&vA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=hx:y.isSpecial()&&s&&s.scheme==y.scheme?v=K4:y.isSpecial()?v=X4:o[T+1]=="/"?(v=q4,T++):(y.cannotBeABaseURL=!0,Lv(y.path,""),v=Q4)}break;case ax:if(!s||s.cannotBeABaseURL&&c!="#")return rx;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=Ed(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=nf;break}v=s.scheme=="file"?hx:cx;continue;case K4:if(c!="/"||o[T+1]!="/"){v=cx;continue}v=SA,T++;break;case q4:if(c=="/"){v=bA;break}v=Rh;continue;case cx:if(y.scheme=s.scheme,c==hu)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ed(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=Y4;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ed(s.path),y.query="",v=B_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ed(s.path),y.path.length--,v=Rh;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Ed(s.path),y.query=s.query,y.fragment="",v=nf}break;case Y4:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=Rh;continue}v=bA}else v=SA;break;case X4:if(v=SA,c!="/"||mu(R,T+1)!="/")continue;T++;break;case SA:if(c!="/"&&c!="\\"){v=bA;continue}break;case bA:if(c=="@"){P&&(R="%40"+R),P=!0,d=xv(R);for(var j=0;j<d.length;j++){var W=d[j];if(W!=":"||G){var Y=jm(W,sx);G?y.password+=Y:y.username+=Y}else G=!0}R=""}else if(c==hu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";T-=xv(R).length+1,R="",v=lx}else R+=c;break;case lx:case ux:if(r&&y.scheme=="file"){v=px;continue}if(c!=":"||N){if(c==hu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return F_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=Mv,r)return;continue}c=="["?N=!0:c=="]"&&(N=!1),R+=c}else{if(R=="")return F_;if(h=y.parseHost(R))return h;if(R="",v=dx,r==ux)return}break;case dx:if(!vd(ix,c)){if(c==hu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var J=_A(R,10);if(J>65535)return F4;y.port=y.isSpecial()&&J===vA[y.scheme]?null:J,R=""}if(r)return;v=Mv;continue}return F4}R+=c;break;case hx:if(y.scheme="file",c=="/"||c=="\\")v=J4;else{if(!s||s.scheme!="file"){v=Rh;continue}if(c==hu)y.host=s.host,y.path=Ed(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=Ed(s.path),y.query="",v=B_;else{if(c!="#"){H4(hT(Ed(o,T),""))||(y.host=s.host,y.path=Ed(s.path),y.shortenPath()),v=Rh;continue}y.host=s.host,y.path=Ed(s.path),y.query=s.query,y.fragment="",v=nf}}break;case J4:if(c=="/"||c=="\\"){v=px;break}s&&s.scheme=="file"&&!H4(hT(Ed(o,T),""))&&(mT(s.path[0],!0)?Lv(y.path,s.path[0]):y.host=s.host),v=Rh;continue;case px:if(c==hu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&mT(R))v=Rh;else if(R==""){if(y.host="",r)return;v=Mv}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=Mv}continue}R+=c;break;case Mv:if(y.isSpecial()){if(v=Rh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=hu&&(v=Rh,c!="/"))continue}else y.fragment="",v=nf;else y.query="",v=B_;break;case Rh:if(c==hu||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=yA(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||Lv(y.path,"")):$ue(R)?c=="/"||c=="\\"&&y.isSpecial()||Lv(y.path,""):(y.scheme=="file"&&!y.path.length&&mT(R)&&(y.host&&(y.host=""),R=mu(R,0)+":"),Lv(y.path,R)),R="",y.scheme=="file"&&(c==hu||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)xue(y.path);c=="?"?(y.query="",v=B_):c=="#"&&(y.fragment="",v=nf)}else R+=jm(c,G4);break;case Q4:c=="?"?(y.query="",v=B_):c=="#"?(y.fragment="",v=nf):c!=hu&&(y.path[0]+=jm(c,EA));break;case B_:r||c!="#"?c!=hu&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":jm(c,EA)):(y.fragment="",v=nf);break;case nf:c!=hu&&(y.fragment+=jm(c,z4))}T++}},parseHost:function(t){var r,s,o;if(mu(t,0)=="["){if(mu(t,t.length-1)!="]"||(r=function(c){var d,h,m,y,v,T,R,P=[0,0,0,0,0,0,0,0],N=0,G=null,j=0,W=function(){return mu(c,j)};if(W()==":"){if(mu(c,1)!=":")return;j+=2,G=++N}for(;W();){if(N==8)return;if(W()!=":"){for(d=h=0;h<4&&vd(W4,W());)d=16*d+_A(W(),16),j++,h++;if(W()=="."){if(h==0||(j-=h,N>6))return;for(m=0;W();){if(y=null,m>0){if(!(W()=="."&&m<4))return;j++}if(!vd(ix,W()))return;for(;vd(ix,W());){if(v=_A(W(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;j++}P[N]=256*P[N]+y,++m!=2&&m!=4||N++}if(m!=4)return;break}if(W()==":"){if(j++,!W())return}else if(W())return;P[N++]=d}else{if(G!==null)return;j++,G=++N}}if(G!==null)for(T=N-G,N=7;N!=0&&T>0;)R=P[N],P[N--]=P[G+T-1],P[G+--T]=R;else if(N!=8)return;return P}(pT(t,1,-1)),!r))return F_;this.host=r}else if(this.isSpecial()){if(t=Cue(t),vd(Bue,t)||(r=function(c){var d,h,m,y,v,T,R,P=Lue(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(d=P.length)>4)return c;for(h=[],m=0;m<d;m++){if((y=P[m])=="")return c;if(v=10,y.length>1&&mu(y,0)=="0"&&(v=vd(Vue,y)?16:8,y=pT(y,v==8?1:2)),y==="")T=0;else{if(!vd(v==10?Fue:v==8?jue:W4,y))return c;T=_A(y,v)}Lv(h,T)}for(m=0;m<d;m++)if(T=h[m],m==d-1){if(T>=j4(256,5-d))return null}else if(T>255)return null;for(R=Due(h),m=0;m<h.length;m++)R+=h[m]*j4(256,3-m);return R}(t),r===null))return F_;this.host=r}else{if(vd(Wue,t))return F_;for(r="",s=xv(t),o=0;o<s.length;o++)r+=jm(s[o],EA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return ZD(vA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&mT(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,o=t.password,c=t.host,d=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(o?":"+o:"")+"@"),v+=fT(c),d!==null&&(v+=":"+d)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+hT(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw tx(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Uv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+fT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(tf(t)+":",ox)},getUsername:function(){return this.username},setUsername:function(t){var r=xv(tf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=jm(r[s],sx)}},getPassword:function(){return this.password},setPassword:function(t){var r=xv(tf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=jm(r[s],sx)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?fT(t):fT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,lx)},getHostname:function(){var t=this.host;return t===null?"":fT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,ux)},getPort:function(){var t=this.port;return t===null?"":tf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=tf(t))==""?this.port=null:this.parse(t,dx))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+hT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Mv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=tf(t))==""?this.query=null:(mu(t,0)=="?"&&(t=pT(t,1)),this.query="",this.parse(t,B_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=tf(t))!=""?(mu(t,0)=="#"&&(t=pT(t,1)),this.fragment="",this.parse(t,nf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Uv=function(t){var r=Tue(this,tc),s=Iue(arguments.length,1)>1?arguments[1]:void 0,o=Aue(r,new fx(t,!1,s));JD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},tc=Uv.prototype,gu=function(t,r){return{get:function(){return gA(this)[t]()},set:r&&function(s){return gA(this)[r](s)},configurable:!0,enumerable:!0}};if(JD&&(fu(tc,"href",gu("serialize","setHref")),fu(tc,"origin",gu("getOrigin")),fu(tc,"protocol",gu("getProtocol","setProtocol")),fu(tc,"username",gu("getUsername","setUsername")),fu(tc,"password",gu("getPassword","setPassword")),fu(tc,"host",gu("getHost","setHost")),fu(tc,"hostname",gu("getHostname","setHostname")),fu(tc,"port",gu("getPort","setPort")),fu(tc,"pathname",gu("getPathname","setPathname")),fu(tc,"search",gu("getSearch","setSearch")),fu(tc,"searchParams",gu("getSearchParams")),fu(tc,"hash",gu("getHash","setHash"))),mA(tc,"toJSON",function(){return gA(this).serialize()},{enumerable:!0}),mA(tc,"toString",function(){return gA(this).serialize()},{enumerable:!0}),dT){var Z4=dT.createObjectURL,eB=dT.revokeObjectURL;Z4&&mA(Uv,"createObjectURL",M4(Z4,dT)),eB&&mA(Uv,"revokeObjectURL",M4(eB,dT))}Rue(Uv,"URL"),Sue({global:!0,forced:!bue,sham:!JD},{URL:Uv});var Kue=Fn,que=u,Yue=Sl,tB=_a,Xue=MD,nB=Jt("URL");Kue({target:"URL",stat:!0,forced:!(Xue&&que(function(){nB.canParse()}))},{canParse:function(t){var r=Yue(arguments.length,1),s=tB(t),o=r<2||arguments[1]===void 0?void 0:tB(arguments[1]);try{return!!new nB(s,o)}catch{return!1}}});var TA=l(vt.URL);let rB=!0,iB=!0;function wA(t,r,s){const o=t.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function W_(t,r,s){if(!t.RTCPeerConnection)return;const o=t.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const T=s(v);T&&(m.handleEvent?m.handleEvent(T):m(T))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const d=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,y])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Jue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(rB=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Que(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(iB=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function sB(){if(typeof window=="object"){if(rB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function mx(t,r){iB&&console.warn(t+" is deprecated, please use "+r+" instead.")}function oB(t){return Object.prototype.toString.call(t)==="[object Object]"}function aB(t){var r;return oB(t)?Ya(r=Object.keys(t)).call(r,function(s,o){const c=oB(t[o]),d=c?aB(t[o]):t[o],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[o]:d})},{}):t}function gx(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?gx(t,t.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{gx(t,t.get(c),s)})}))}function cB(t,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{t.forEach(m=>{m.type===o&&m.trackId===h.id&&gx(t,m,c)})}),c}const lB=sB;function uB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const T=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[T("min",y)]=v.ideal,m.optional.push(R),R={},R[T("max",y)]=v.ideal,m.optional.push(R)):(R[T("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[T("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[T(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,T,R){T in v&&!(R in v)&&(v[R]=v[T],delete v[T])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let T;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?T=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(T=["front"]),T)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(N=>N.kind==="videoinput")).find(N=>T.some(G=>{var j;return at(j=N.label.toLowerCase()).call(j,G)}));return!P&&R.length&&at(T).call(T,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),lB("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return lB("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,T=>{y&&y(d(T))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(T=>{T.stop()}),new DOMException("","NotFoundError");return v},v=>ut.reject(d(v))))}}}function dB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function hB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const d=new Event("track");d.track=o.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(o=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const d=new Event("track");d.track=o,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else W_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function pB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function fB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const y={};return m.result().forEach(v=>{const T={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{T[R]=v.stat(R)}),y[T.id]=T}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){o(h(d(y)))};return r.apply(this,[m,s])}return new ut((m,y)=>{r.apply(this,[function(v){m(h(d(v)))},y])}).then(o,c)}}function mB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});const o=t.RTCPeerConnection.prototype.addTrack;o&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>cB(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),W_(t,"track",o=>(o.receiver._pc=o.srcElement,o)),t.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>cB(c,o.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let o,c,d;return this.getSenders().forEach(h=>{h.track===s&&(o?d=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||o&&c?ut.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ut.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function gB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(y=>{if(this.getSenders().find(T=>T.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const o=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],o.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function _B(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return gB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const o=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}o.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function d(y,v){let T=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],N=y._streams[P.id];T=T.replace(new RegExp(N.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:T})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const T=[].slice.call(arguments,1);if(T.length!==1||!T[0].getTracks().find(N=>N===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(N=>N.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(y),ut.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const N=new t.MediaStream([y]);this._streams[v.id]=N,this._reverseStreams[N.id]=v,this.addStream(N)}return this.getSenders().find(N=>N.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],T={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[P=>{const N=d(this,P);R[0].apply(null,[N])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):v.apply(this,arguments).then(P=>d(this,P))}};t.RTCPeerConnection.prototype[y]=T[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let T=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],N=y._streams[P.id];T=T.replace(new RegExp(P.id,"g"),N.id)}),new RTCSessionDescription({type:v.type,sdp:T})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:d(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(T=>{this._streams[T].getTracks().find(R=>y.track===R)&&(v=this._streams[T])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function _x(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function yB(t,r){W_(t,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var EB=Object.freeze({__proto__:null,fixNegotiationNeeded:yB,shimAddTrackRemoveTrack:_B,shimAddTrackRemoveTrackWithNative:gB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:pB,shimGetStats:fB,shimGetUserMedia:uB,shimMediaStream:dB,shimOnTrack:hB,shimPeerConnection:_x,shimSenderReceiverGetStats:mB});function vB(t,r){const s=t&&t.navigator,o=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){mx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function SB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!d)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,T)=>{m.set(T,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(d,h)}}function bB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ut.resolve(new Map)}}function TB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),W_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function wB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){mx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&at(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function CB(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function RB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function IB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function AB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ut.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function PB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ut.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var OB=Object.freeze({__proto__:null,shimAddTransceiver:RB,shimCreateAnswer:PB,shimCreateOffer:AB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ut.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:IB,shimGetUserMedia:vB,shimOnTrack:SB,shimPeerConnection:yx,shimRTCDataChannel:CB,shimReceiverGetStats:TB,shimRemoveStream:wB,shimSenderGetStats:bB});function kB(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),at(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var m;this._localStreams?at(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{at(o).call(o,c.track)&&this.removeTrack(c)})})}}function NB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),at(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),r.apply(s,arguments)}}}function DB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const T=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[T]);return v?(R.then(y,v),ut.resolve()):R},r.createAnswer=function(y,v){const T=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[T]);return v?(R.then(y,v),ut.resolve()):R};let m=function(y,v,T){const R=c.apply(this,[y]);return T?(R.then(v,T),ut.resolve()):R};r.setLocalDescription=m,m=function(y,v,T){const R=d.apply(this,[y]);return T?(R.then(v,T),ut.resolve()):R},r.setRemoteDescription=m,m=function(y,v,T){const R=h.apply(this,[y]);return T?(R.then(v,T),ut.resolve()):R},r.addIceCandidate=m}function xB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(LB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function LB(t){return t&&t.video!==void 0?Object.assign({},t,{video:aB(t.video)}):t}function MB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(mx("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function UB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function VB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function jB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var FB=Object.freeze({__proto__:null,shimAudioContext:jB,shimCallbacksAPI:DB,shimConstraints:LB,shimCreateOfferLegacy:VB,shimGetUserMedia:xB,shimLocalStreamsAPI:kB,shimRTCIceServerUrls:MB,shimRemoteStreamsAPI:NB,shimTrackEventTransceiver:UB}),BB=`	
\v\f\r \u2028\u2029\uFEFF`,Zue=Qt,ede=_a,Ex=BB,WB=I("".replace),tde=RegExp("^["+Ex+"]+"),nde=RegExp("(^|[^"+Ex+"])["+Ex+"]+$"),rde=function(t){return function(r){var s=ede(Zue(r));return 1&t&&(s=WB(s,tde,"")),2&t&&(s=WB(s,nde,"$1")),s}},ide={trim:rde(3)},sde=kI.PROPER,ode=u,zB=BB,ade=ide.trim;Fn({target:"String",proto:!0,forced:function(t){return ode(function(){return!!zB[t]()||""[t]()!==""||sde&&zB[t].name!==t})}("trim")},{trim:function(){return ade(this)}});var cde=qa("String").trim,lde=k,ude=cde,vx=String.prototype,dde=function(t){var r=t.trim;return typeof t=="string"||t===vx||lde(vx,t)&&r===vx.trim?ude:r},ro=l(dde),GB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let d=8;d<o.length;d+=2)switch(o[d]){case"raddr":c.relatedAddress=o[d+1];break;case"rport":c.relatedPort=parseInt(o[d+1],10);break;case"tcptype":c.tcpType=o[d+1];break;case"ufrag":c.ufrag=o[d+1],c.usernameFragment=o[d+1];break;default:c[o[d]]===void 0&&(c[o[d]]=o[d+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const d=s.type;return o.push("typ"),o.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),o+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{o+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},d=s.indexOf(":",o);return d>-1?(c.attribute=s.substring(o+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],d=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),T=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=T.length?r.parseFmtp(T[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{d.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let d=0;return o.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const T=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(N=>parseInt(N,10)));T.length>0&&T[0].length>1&&T[0][0]===y&&(v=T[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let N={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&v&&(N.rtx={ssrc:v}),o.push(N),d&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},o.push(N))}}),o.length===0&&y&&o.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=d.length>0,o.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const d=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(o=d[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let d;const h=o!==void 0?o:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(GB);var HB=GB.exports,Vv=l(HB),hde=i({__proto__:null,default:Vv},[HB]);function CA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=Vv.parseCandidate(s.candidate),d=Object.assign(o,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,W_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function Sx(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||W_(t,"icecandidate",r=>{if(r.candidate){const s=Vv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function RA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=Vv.splitSections(m.sdp);return y.shift(),y.some(v=>{const T=Vv.parseMLine(v);return T&&T.kind==="application"&&T.protocol.indexOf("SCTP")!==-1})},o=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},d=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const T=Vv.matchPrefix(m.sdp,"a=max-message-size:");return T.length>0?v=parseInt(T[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),y=c(m),v=d(arguments[0],m);let T;T=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>T}),this._sctp=R}return h.apply(this,arguments)}}function IA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(o,c){const d=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(o,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},W_(t,"datachannel",o=>(r(o.channel,o.target),o))}function bx(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function Tx(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(d=>ro(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&o instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function AA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ut.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ut.resolve())})}function PA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var pde=Object.freeze({__proto__:null,removeExtmapAllowMixed:Tx,shimAddIceCandidateNullOrEmpty:AA,shimConnectionState:bx,shimMaxMessageSize:RA,shimParameterlessSetLocalDescription:PA,shimRTCIceCandidate:CA,shimRTCIceCandidateRelayProtocol:Sx,shimSendThrowTypeError:IA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=sB,o=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=wA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=wA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=wA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:o,commonShim:pde,extractVersion:wA,disableLog:Jue,disableWarnings:Que,sdp:hde};switch(o.browser){case"chrome":if(!EB||!_x||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=EB,AA(t,o),PA(t),uB(t,o),dB(t),_x(t,o),hB(t),_B(t,o),pB(t),fB(t),mB(t),yB(t,o),CA(t),Sx(t),bx(t),RA(t,o),IA(t),Tx(t,o);break;case"firefox":if(!OB||!yx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=OB,AA(t,o),PA(t),vB(t,o),yx(t,o),SB(t),wB(t),bB(t),TB(t),CB(t),RB(t),IB(t),AB(t),PB(t),CA(t),bx(t),RA(t,o),IA(t);break;case"safari":if(!FB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=FB,AA(t,o),PA(t),MB(t),VB(t),DB(t),kB(t),NB(t),UB(t),xB(t),jB(t),CA(t),Sx(t),RA(t,o),IA(t),Tx(t,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var $B=_c,fde=TypeError,KB=Hn.match(/firefox\/(\d+)/i),mde=!!KB&&+KB[1],gde=/MSIE|Trident/.test(Hn),qB=Hn.match(/AppleWebKit\/(\d+)\./),_de=!!qB&&+qB[1],yde=Fn,YB=I,Ede=ds,vde=xo,XB=hi,Sde=function(t,r){if(!delete t[r])throw fde("Cannot delete property "+$B(r)+" of "+$B(t))},JB=_a,wx=u,bde=a4,Tde=Dp,QB=mde,wde=gde,ZB=Ei,e6=_de,Fm=[],t6=YB(Fm.sort),Cde=YB(Fm.push),Rde=wx(function(){Fm.sort(void 0)}),Ide=wx(function(){Fm.sort(null)}),Ade=Tde("sort"),n6=!wx(function(){if(ZB)return ZB<70;if(!(QB&&QB>3)){if(wde)return!0;if(e6)return e6<603;var t,r,s,o,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)Fm.push({k:r+o,v:s})}for(Fm.sort(function(d,h){return h.v-d.v}),o=0;o<Fm.length;o++)r=Fm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});yde({target:"Array",proto:!0,forced:Rde||!Ide||!Ade||!n6},{sort:function(t){t!==void 0&&Ede(t);var r=vde(this);if(n6)return t===void 0?t6(r):t6(r,t);var s,o,c=[],d=XB(r);for(o=0;o<d;o++)o in r&&Cde(c,r[o]);for(bde(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:JB(m)>JB(y)?1:-1}}(t)),s=XB(c),o=0;o<s;)r[o]=c[o++];for(;o<d;)Sde(r,o++);return r}});var Pde=qa("Array").sort,Ode=k,kde=Pde,Cx=Array.prototype,Nde=function(t){var r=t.sort;return t===Cx||Ode(Cx,t)&&r===Cx.sort?kde:r},gT=l(Nde),Rx=L;Fn({global:!0,forced:Rx.globalThis!==Rx},{globalThis:Rx});var r6=l(L),Ix={exports:{}};(function(t,r){(function(s,o){var c="function",d="undefined",h="object",m="string",y="major",v="model",T="name",R="type",P="vendor",N="version",G="architecture",j="console",W="mobile",Y="tablet",J="smarttv",le="wearable",_e="embedded",Ee="Amazon",ge="Apple",Ne="ASUS",qe="BlackBerry",dt="Browser",ft="Chrome",Sn="Firefox",bn="Google",hr="Huawei",ai="LG",Yr="Microsoft",ra="Motorola",Fe="Opera",ot="Samsung",bt="Sharp",We="Sony",M="Xiaomi",se="Zebra",de="Facebook",Je="Chromium OS",qt="Mac OS",ir=function(Ri){for(var zi={},Rr=0;Rr<Ri.length;Rr++)zi[Ri[Rr].toUpperCase()]=Ri[Rr];return zi},Wi=function(Ri,zi){return typeof Ri===m&&Oa(zi).indexOf(Oa(Ri))!==-1},Oa=function(Ri){return Ri.toLowerCase()},vf=function(Ri,zi){if(typeof Ri===m)return Ri=Ri.replace(/^\s\s*/,""),typeof zi===d?Ri:Ri.substring(0,350)},Ey=function(Ri,zi){for(var Rr,ic,Hh,ci,zn,ka,cg=0;cg<zi.length&&!zn;){var xd=zi[cg],OK=zi[cg+1];for(Rr=ic=0;Rr<xd.length&&!zn&&xd[Rr];)if(zn=xd[Rr++].exec(Ri))for(Hh=0;Hh<OK.length;Hh++)ka=zn[++ic],typeof(ci=OK[Hh])===h&&ci.length>0?ci.length===2?typeof ci[1]==c?this[ci[0]]=ci[1].call(this,ka):this[ci[0]]=ci[1]:ci.length===3?typeof ci[1]!==c||ci[1].exec&&ci[1].test?this[ci[0]]=ka?ka.replace(ci[1],ci[2]):o:this[ci[0]]=ka?ci[1].call(this,ka,ci[2]):o:ci.length===4&&(this[ci[0]]=ka?ci[3].call(this,ka.replace(ci[1],ci[2])):o):this[ci]=ka||o;cg+=2}},Ew=function(Ri,zi){for(var Rr in zi)if(typeof zi[Rr]===h&&zi[Rr].length>0){for(var ic=0;ic<zi[Rr].length;ic++)if(Wi(zi[Rr][ic],Ri))return Rr==="?"?o:Rr}else if(Wi(zi[Rr],Ri))return Rr==="?"?o:Rr;return Ri},R1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},I1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[T,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[T,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[T,N],[/opios[\/ ]+([\w\.]+)/i],[N,[T,Fe+" Mini"]],[/\bopr\/([\w\.]+)/i],[N,[T,Fe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[T,N],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[T,"UC"+dt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[N,[T,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[N,[T,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[T,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[T,"IE"]],[/yabrowser\/([\w\.]+)/i],[N,[T,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[T,/(.+)/,"$1 Secure "+dt],N],[/\bfocus\/([\w\.]+)/i],[N,[T,Sn+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[T,Fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[T,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[T,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[T,Fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[T,"MIUI "+dt]],[/fxios\/([-\w\.]+)/i],[N,[T,Sn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[T,"360 "+dt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[T,/(.+)/,"$1 "+dt],N],[/(comodo_dragon)\/([\w\.]+)/i],[[T,/_/g," "],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[T,N],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[T],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[T,de],N],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[T,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[T,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[T,ft+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[T,ft+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[T,"Android "+dt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[T,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[T,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,T],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[T,[N,Ew,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[T,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[T,"Netscape"],N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[T,Sn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[T,N],[/(cobalt)\/([\w\.]+)/i],[T,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Oa]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Oa]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Oa]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[P,ot],[R,Y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[P,ot],[R,W]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[P,ge],[R,W]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[P,ge],[R,Y]],[/(macintosh);/i],[v,[P,ge]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[P,bt],[R,W]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[P,hr],[R,Y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[P,hr],[R,W]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,W]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,Y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[P,"OPPO"],[R,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[P,"Vivo"],[R,W]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[P,"Realme"],[R,W]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[P,ra],[R,W]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[P,ra],[R,Y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[P,ai],[R,Y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[P,ai],[R,W]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[P,"Lenovo"],[R,Y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[P,"Nokia"],[R,W]],[/(pixel c)\b/i],[v,[P,bn],[R,Y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[P,bn],[R,W]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[P,We],[R,W]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[P,We],[R,Y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[P,"OnePlus"],[R,W]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[P,Ee],[R,Y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[P,Ee],[R,W]],[/(playbook);[-\w\),; ]+(rim)/i],[v,P,[R,Y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[P,qe],[R,W]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[P,Ne],[R,Y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[P,Ne],[R,W]],[/(nexus 9)/i],[v,[P,"HTC"],[R,Y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[v,/_/g," "],[R,W]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[P,"Acer"],[R,Y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[P,"Meizu"],[R,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,v,[R,W]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,v,[R,Y]],[/(surface duo)/i],[v,[P,Yr],[R,Y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[P,"Fairphone"],[R,W]],[/(u304aa)/i],[v,[P,"AT&T"],[R,W]],[/\bsie-(\w*)/i],[v,[P,"Siemens"],[R,W]],[/\b(rct\w+) b/i],[v,[P,"RCA"],[R,Y]],[/\b(venue[\d ]{2,7}) b/i],[v,[P,"Dell"],[R,Y]],[/\b(q(?:mv|ta)\w+) b/i],[v,[P,"Verizon"],[R,Y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[P,"Barnes & Noble"],[R,Y]],[/\b(tm\d{3}\w+) b/i],[v,[P,"NuVision"],[R,Y]],[/\b(k88) b/i],[v,[P,"ZTE"],[R,Y]],[/\b(nx\d{3}j) b/i],[v,[P,"ZTE"],[R,W]],[/\b(gen\d{3}) b.+49h/i],[v,[P,"Swiss"],[R,W]],[/\b(zur\d{3}) b/i],[v,[P,"Swiss"],[R,Y]],[/\b((zeki)?tb.*\b) b/i],[v,[P,"Zeki"],[R,Y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],v,[R,Y]],[/\b(ns-?\w{0,9}) b/i],[v,[P,"Insignia"],[R,Y]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[P,"NextBook"],[R,Y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],v,[R,W]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],v,[R,W]],[/\b(ph-1) /i],[v,[P,"Essential"],[R,W]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[P,"Envizen"],[R,Y]],[/\b(trio[-\w\. ]+) b/i],[v,[P,"MachSpeed"],[R,Y]],[/\btu_(1491) b/i],[v,[P,"Rotor"],[R,Y]],[/(shield[\w ]+) b/i],[v,[P,"Nvidia"],[R,Y]],[/(sprint) (\w+)/i],[P,v,[R,W]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[P,Yr],[R,W]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[P,se],[R,Y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[P,se],[R,W]],[/smart-tv.+(samsung)/i],[P,[R,J]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[P,ot],[R,J]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ai],[R,J]],[/(apple) ?tv/i],[P,[v,ge+" TV"],[R,J]],[/crkey/i],[[v,ft+"cast"],[P,bn],[R,J]],[/droid.+aft(\w)( bui|\))/i],[v,[P,Ee],[R,J]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[P,bt],[R,J]],[/(bravia[\w ]+)( bui|\))/i],[v,[P,We],[R,J]],[/(mitv-\w{5}) bui/i],[v,[P,M],[R,J]],[/Hbbtv.*(technisat) (.*);/i],[P,v,[R,J]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,vf],[v,vf],[R,J]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,J]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,v,[R,j]],[/droid.+; (shield) bui/i],[v,[P,"Nvidia"],[R,j]],[/(playstation [345portablevi]+)/i],[v,[P,We],[R,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[P,Yr],[R,j]],[/((pebble))app/i],[P,v,[R,le]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[P,ge],[R,le]],[/droid.+; (glass) \d/i],[v,[P,bn],[R,le]],[/droid.+; (wt63?0{2,3})\)/i],[v,[P,se],[R,le]],[/(quest( 2| pro)?)/i],[v,[P,de],[R,le]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,_e]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,Y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,Y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,W]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[T,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[T,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[T,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,T]],os:[[/microsoft (windows) (vista|xp)/i],[T,N],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[T,[N,Ew,R1]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,"Windows"],[N,Ew,R1]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[T,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[T,qt],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,T],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[T,N],[/\(bb(10);/i],[N,[T,qe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[T,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[T,Sn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[T,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[T,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[T,ft+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[T,Je],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[T,N],[/(sunos) ?([\w\.\d]*)/i],[[T,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[T,N]]},Dl=function(Ri,zi){if(typeof Ri===h&&(zi=Ri,Ri=o),!(this instanceof Dl))return new Dl(Ri,zi).getResult();var Rr=typeof s!==d&&s.navigator?s.navigator:o,ic=Ri||(Rr&&Rr.userAgent?Rr.userAgent:""),Hh=Rr&&Rr.userAgentData?Rr.userAgentData:o,ci=zi?function(zn,ka){var cg={};for(var xd in zn)ka[xd]&&ka[xd].length%2==0?cg[xd]=ka[xd].concat(zn[xd]):cg[xd]=zn[xd];return cg}(I1,zi):I1;return this.getBrowser=function(){var zn={};return zn[T]=o,zn[N]=o,Ey.call(zn,ic,ci.browser),zn[y]=function(ka){return typeof ka===m?ka.replace(/[^\d\.]/g,"").split(".")[0]:o}(zn[N]),Rr&&Rr.brave&&typeof Rr.brave.isBrave==c&&(zn[T]="Brave"),zn},this.getCPU=function(){var zn={};return zn[G]=o,Ey.call(zn,ic,ci.cpu),zn},this.getDevice=function(){var zn={};return zn[P]=o,zn[v]=o,zn[R]=o,Ey.call(zn,ic,ci.device),!zn[R]&&Hh&&Hh.mobile&&(zn[R]=W),zn[v]=="Macintosh"&&Rr&&typeof Rr.standalone!==d&&Rr.maxTouchPoints&&Rr.maxTouchPoints>2&&(zn[v]="iPad",zn[R]=Y),zn},this.getEngine=function(){var zn={};return zn[T]=o,zn[N]=o,Ey.call(zn,ic,ci.engine),zn},this.getOS=function(){var zn={};return zn[T]=o,zn[N]=o,Ey.call(zn,ic,ci.os),!zn[T]&&Hh&&Hh.platform!="Unknown"&&(zn[T]=Hh.platform.replace(/chrome os/i,Je).replace(/macos/i,qt)),zn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ic},this.setUA=function(zn){return ic=typeof zn===m&&zn.length>350?vf(zn,350):zn,this},this.setUA(ic),this};Dl.VERSION="0.7.34",Dl.BROWSER=ir([T,N,y]),Dl.CPU=ir([G]),Dl.DEVICE=ir([v,P,R,j,W,J,Y,le,_e]),Dl.ENGINE=Dl.OS=ir([T,N]),t.exports&&(r=t.exports=Dl),r.UAParser=Dl;var ag=typeof s!==d&&(s.jQuery||s.Zepto);if(ag&&!ag.ua){var vy=new Dl;ag.ua=vy.getResult(),ag.ua.get=function(){return vy.getUA()},ag.ua.set=function(Ri){vy.setUA(Ri);var zi=vy.getResult();for(var Rr in zi)ag.ua[Rr]=zi[Rr]}}})(typeof window=="object"?window:a)})(Ix,Ix.exports);var Dde=l(Ix.exports),xde=wc,Lde=vi,Mde=Dt,Ude=ph,Vde=_r("iterator"),jde=Object,Fde=function(t){if(Mde(t))return!1;var r=jde(t);return r[Vde]!==void 0||"@@iterator"in r||Lde(Ude,xde(r))},Bde=l(Fde),i6=fv.clear;Fn({global:!0,bind:!0,forced:L.clearImmediate!==i6},{clearImmediate:i6});var Wde=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",s6=L,zde=X,Gde=Ue,Hde=Wde,$de=Hn,Kde=gs,qde=Sl,Yde=s6.Function,Xde=/MSIE .\./.test($de)||Hde&&function(){var t=s6.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Jde=Fn,o6=L,a6=fv.set,Qde=function(t,r){var s=1;return Xde?function(o,c){var d=qde(arguments.length,1)>s,h=Gde(o)?o:Yde(o),m=d?Kde(arguments,s):[],y=d?function(){zde(h,this,m)}:h;return t(y)}:t},c6=o6.setImmediate?Qde(a6):a6;Jde({global:!0,bind:!0,forced:o6.setImmediate!==c6},{setImmediate:c6});var l6=l(vt.setImmediate),Zde=Fn,ehe=Za,the=ds,nhe=Sl,rhe=xp,ihe=L.process;Zde({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){nhe(arguments.length,1),the(t);var r=rhe&&ihe.domain;ehe(r?r.bind(t):t)}});var u6=l(vt.queueMicrotask);function d6(t,r){return function(){return t.apply(r,arguments)}}const{toString:she}=Object.prototype,{getPrototypeOf:Ax}=Object,OA=(Px=Object.create(null),t=>{const r=she.call(t);return Px[r]||(Px[r]=r.slice(8,-1).toLowerCase())});var Px;const Sd=t=>(t=t.toLowerCase(),r=>OA(r)===t),kA=t=>r=>typeof r===t,{isArray:jv}=Array,_T=kA("undefined"),h6=Sd("ArrayBuffer"),ohe=kA("string"),Tl=kA("function"),p6=kA("number"),NA=t=>t!==null&&typeof t=="object",DA=t=>{if(OA(t)!=="object")return!1;const r=Ax(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Bde(t))},ahe=Sd("Date"),che=Sd("File"),lhe=Sd("Blob"),uhe=Sd("FileList"),dhe=Sd("URLSearchParams"),[hhe,phe,fhe,mhe]=["ReadableStream","Request","Response","Headers"].map(Sd);function yT(t,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),jv(t))for(s=0,o=t.length;s<o;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function f6(t,r){r=r.toLowerCase();const s=Object.keys(t);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const z_=r6!==void 0?r6:typeof self<"u"?self:typeof window<"u"?window:Py,m6=t=>!_T(t)&&t!==z_,ghe=(Ox=typeof Uint8Array<"u"&&Ax(Uint8Array),t=>Ox&&t instanceof Ox);var Ox;const _he=Sd("HTMLFormElement"),g6=(t=>{let{hasOwnProperty:r}=t;return(s,o)=>r.call(s,o)})(Object.prototype),yhe=Sd("RegExp"),_6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),o={};yT(s,(c,d)=>{let h;(h=r(c,d,t))!==!1&&(o[d]=h||c)}),Object.defineProperties(t,o)},kx="abcdefghijklmnopqrstuvwxyz",y6="0123456789",E6={DIGIT:y6,ALPHA:kx,ALPHA_DIGIT:kx+kx.toUpperCase()+y6},Ehe=Sd("AsyncFunction"),v6=(S6=typeof l6=="function",b6=Tl(z_.postMessage),S6?l6:b6?(Nx="axios@".concat(Math.random()),xA=[],z_.addEventListener("message",t=>{let{source:r,data:s}=t;r===z_&&s===Nx&&xA.length&&xA.shift()()},!1),t=>{xA.push(t),z_.postMessage(Nx,"*")}):t=>setTimeout(t));var S6,b6,Nx,xA;const vhe=u6!==void 0?u6.bind(z_):typeof process<"u"&&process.nextTick||v6;var lt={isArray:jv,isArrayBuffer:h6,isBuffer:function(t){return t!==null&&!_T(t)&&t.constructor!==null&&!_T(t.constructor)&&Tl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Tl(t.append)&&((r=OA(t))==="formdata"||r==="object"&&Tl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&h6(t.buffer),r},isString:ohe,isNumber:p6,isBoolean:t=>t===!0||t===!1,isObject:NA,isPlainObject:DA,isReadableStream:hhe,isRequest:phe,isResponse:fhe,isHeaders:mhe,isUndefined:_T,isDate:ahe,isFile:che,isBlob:lhe,isRegExp:yhe,isFunction:Tl,isStream:t=>NA(t)&&Tl(t.pipe),isURLSearchParams:dhe,isTypedArray:ghe,isFileList:uhe,forEach:yT,merge:function t(){const{caseless:r}=m6(this)&&this||{},s={},o=(c,d)=>{const h=r&&f6(s,d)||d;DA(s[h])&&DA(c)?s[h]=t(s[h],c):DA(c)?s[h]=t({},c):jv(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&yT(arguments[c],o);return s},extend:function(t,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return yT(r,(c,d)=>{s&&Tl(c)?t[d]=d6(c,s):t[d]=c},{allOwnKeys:o}),t},trim:t=>ro(t)?ro(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,o)=>{t.prototype=Object.create(r.prototype,o),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,o)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],o&&!o(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&Ax(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:OA,kindOfTest:Sd,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const o=t.indexOf(r,s);return o!==-1&&o===s},toArray:t=>{if(!t)return null;if(jv(t))return t;let r=t.length;if(!p6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const o=[];for(;(s=t.exec(r))!==null;)o.push(s);return o},isHTMLForm:_he,hasOwnProperty:g6,hasOwnProp:g6,reduceDescriptors:_6,freezeMethods:t=>{_6(t,(r,s)=>{if(Tl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=t[s];Tl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},o=c=>{c.forEach(d=>{s[d]=!0})};return jv(t)?o(t):o(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:f6,global:z_,isContextDefined:m6,ALPHABET:E6,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E6.ALPHA_DIGIT,s="";const{length:o}=r;for(;t--;)s+=r[Math.random()*o|0];return s},isSpecCompliantForm:function(t){return!!(t&&Tl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(o,c)=>{if(NA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const d=jv(o)?[]:{};return yT(o,(h,m)=>{const y=s(h,c+1);!_T(y)&&(d[m]=y)}),r[c]=void 0,d}}return o};return s(t,0)},isAsyncFn:Ehe,isThenable:t=>t&&(NA(t)||Tl(t))&&Tl(t.then)&&Tl(t.catch),setImmediate:v6,asap:vhe};function nr(t,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}lt.inherits(nr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const T6=nr.prototype,w6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{w6[t]={value:t}}),Object.defineProperties(nr,w6),Object.defineProperty(T6,"isAxiosError",{value:!0}),nr.from=(t,r,s,o,c,d)=>{const h=Object.create(T6);return lt.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),nr.call(h,t.message,r,s,o,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function Dx(t){return lt.isPlainObject(t)||lt.isArray(t)}function C6(t){return lt.endsWith(t,"[]")?t.slice(0,-2):t}function R6(t,r,s){return t?t.concat(r).map(function(o,c){return o=C6(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const She=lt.toFlatObject(lt,{},null,function(t){return/^is[A-Z]/.test(t)});function LA(t,r,s){if(!lt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=lt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,N){return!lt.isUndefined(N[P])})).metaTokens,c=s.visitor||v,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(r);if(!lt.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(lt.isDate(P))return P.toISOString();if(!m&&lt.isBlob(P))throw new nr("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(P)||lt.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function v(P,N,G){let j=P;if(P&&!G&&typeof P=="object"){if(lt.endsWith(N,"{}"))N=o?N:N.slice(0,-2),P=JSON.stringify(P);else if(lt.isArray(P)&&function(W){return lt.isArray(W)&&!W.some(Dx)}(P)||(lt.isFileList(P)||lt.endsWith(N,"[]"))&&(j=lt.toArray(P)))return N=C6(N),j.forEach(function(W,Y){!lt.isUndefined(W)&&W!==null&&r.append(h===!0?R6([N],Y,d):h===null?N:N+"[]",y(W))}),!1}return!!Dx(P)||(r.append(R6(G,N,d),y(P)),!1)}const T=[],R=Object.assign(She,{defaultVisitor:v,convertValue:y,isVisitable:Dx});if(!lt.isObject(t))throw new TypeError("data must be an object");return function P(N,G){if(!lt.isUndefined(N)){if(T.indexOf(N)!==-1)throw Error("Circular reference detected in "+G.join("."));T.push(N),lt.forEach(N,function(j,W){(!(lt.isUndefined(j)||j===null)&&c.call(r,j,lt.isString(W)?ro(W).call(W):W,G,R))===!0&&P(j,G?G.concat(W):[W])}),T.pop()}}(t),r}function I6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function xx(t,r){this._pairs=[],t&&LA(t,this,r)}const A6=xx.prototype;function bhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function P6(t,r,s){if(!r)return t;const o=s&&s.encode||bhe;lt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):lt.isURLSearchParams(r)?r.toString():new xx(r,s).toString(o),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}A6.append=function(t,r){this._pairs.push([t,r])},A6.toString=function(t){const r=t?function(s){return t.call(this,s,I6)}:I6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var O6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lt.forEach(this.handlers,function(r){r!==null&&t(r)})}},k6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},N6={exports:{}},The=Fn,whe=tt,D6=rt.f;The({target:"Object",stat:!0,forced:Object.defineProperty!==D6,sham:!whe},{defineProperty:D6});var x6=vt.Object,Che=N6.exports=function(t,r,s){return x6.defineProperty(t,r,s)};x6.defineProperty.sham&&(Che.sham=!0);var L6=l(N6.exports),Rhe=TypeError,M6=a_,Ihe=O_,Ahe=_t,Phe=_r("species"),U6=Array,Ohe=function(t){var r;return M6(t)&&(r=t.constructor,(Ihe(r)&&(r===U6||M6(r.prototype))||Ahe(r)&&(r=r[Phe])===null)&&(r=void 0)),r===void 0?U6:r},V6=function(t,r){return new(Ohe(t))(r===0?0:r)},khe=u,Nhe=Ei,Dhe=_r("species"),j6=function(t){return Nhe>=51||!khe(function(){var r=[];return(r.constructor={})[Dhe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},xhe=Fn,Lhe=u,Mhe=a_,Uhe=_t,Vhe=xo,jhe=hi,F6=function(t){if(t>9007199254740991)throw Rhe("Maximum allowed index exceeded");return t},B6=dA,Fhe=V6,Bhe=j6,Whe=Ei,W6=_r("isConcatSpreadable"),zhe=Whe>=51||!Lhe(function(){var t=[];return t[W6]=!1,t.concat()[0]!==t}),Ghe=function(t){if(!Uhe(t))return!1;var r=t[W6];return r!==void 0?!!r:Mhe(t)};xhe({target:"Array",proto:!0,forced:!zhe||!Bhe("concat")},{concat:function(t){var r,s,o,c,d,h=Vhe(this),m=Fhe(h,0),y=0;for(r=-1,o=arguments.length;r<o;r++)if(Ghe(d=r===-1?h:arguments[r]))for(c=jhe(d),F6(y+c),s=0;s<c;s++,y++)s in d&&B6(m,y,d[s]);else F6(y+1),B6(m,y++,d);return m.length=y,m}});var z6={},Hhe=te,$he=we,G6=uh.f,Khe=UD,H6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];z6.f=function(t){return H6&&Hhe(t)=="Window"?function(r){try{return G6(r)}catch{return Khe(H6)}}(t):G6($he(t))};var Fv={},qhe=_r;Fv.f=qhe;var $6=vt,Yhe=vi,Xhe=Fv,Jhe=rt.f,Es=function(t){var r=$6.Symbol||($6.Symbol={});Yhe(r,t)||Jhe(r,t,{value:Xhe.f(t)})},Qhe=ye,Zhe=Jt,epe=_r,tpe=pd,K6=function(){var t=Zhe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,o=epe("toPrimitive");r&&!r[o]&&tpe(r,o,function(c){return Qhe(s,this)},{})},npe=De,rpe=jt,ipe=xo,spe=hi,ope=V6,q6=I([].push),ape=function(t){var r=t==1,s=t==2,o=t==3,c=t==4,d=t==6,h=t==7,m=t==5||d;return function(y,v,T,R){for(var P,N,G=ipe(y),j=rpe(G),W=npe(v,T),Y=spe(j),J=0,le=R||ope,_e=r?le(y,Y):s||h?le(y,0):void 0;Y>J;J++)if((m||J in j)&&(N=W(P=j[J],J,G),t))if(r)_e[J]=N;else if(N)switch(t){case 3:return!0;case 5:return P;case 6:return J;case 2:q6(_e,P)}else switch(t){case 4:return!1;case 7:q6(_e,P)}return d?-1:o||c?c:_e}},Y6={forEach:ape(0)},MA=Fn,Lx=L,Mx=ye,cpe=I,Bv=tt,Wv=yo,lpe=u,Co=vi,upe=k,Ux=dn,UA=we,Vx=$a,dpe=_a,jx=Qe,ET=$o,X6=Ic,hpe=uh,J6=z6,ppe=Rc,Q6=ze,Z6=rt,fpe=IE,e8=ke,t8=pd,mpe=ZE,Fx=Ga,n8=Cc,r8=rh,gpe=_r,_pe=Fv,ype=Es,Epe=K6,vpe=fd,i8=hd,VA=Y6.forEach,Mc=l_("hidden"),jA="Symbol",vT="prototype",Spe=i8.set,s8=i8.getterFor(jA),bd=Object[vT],G_=Lx.Symbol,FA=G_&&G_[vT],bpe=Lx.TypeError,Bx=Lx.QObject,o8=Q6.f,H_=Z6.f,a8=J6.f,Tpe=e8.f,c8=cpe([].push),rf=Fx("symbols"),ST=Fx("op-symbols"),wpe=Fx("wks"),Wx=!Bx||!Bx[vT]||!Bx[vT].findChild,zx=Bv&&lpe(function(){return ET(H_({},"a",{get:function(){return H_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var o=o8(bd,r);o&&delete bd[r],H_(t,r,s),o&&t!==bd&&H_(bd,r,o)}:H_,Gx=function(t,r){var s=rf[t]=ET(FA);return Spe(s,{type:jA,tag:t,description:r}),Bv||(s.description=r),s},BA=function(t,r,s){t===bd&&BA(ST,r,s),Ux(t);var o=Vx(r);return Ux(s),Co(rf,o)?(s.enumerable?(Co(t,Mc)&&t[Mc][o]&&(t[Mc][o]=!1),s=ET(s,{enumerable:jx(0,!1)})):(Co(t,Mc)||H_(t,Mc,jx(1,{})),t[Mc][o]=!0),zx(t,o,s)):H_(t,o,s)},Hx=function(t,r){Ux(t);var s=UA(r),o=X6(s).concat(h8(s));return VA(o,function(c){Bv&&!Mx(l8,s,c)||BA(t,c,s[c])}),t},l8=function(t){var r=Vx(t),s=Mx(Tpe,this,r);return!(this===bd&&Co(rf,r)&&!Co(ST,r))&&(!(s||!Co(this,r)||!Co(rf,r)||Co(this,Mc)&&this[Mc][r])||s)},u8=function(t,r){var s=UA(t),o=Vx(r);if(s!==bd||!Co(rf,o)||Co(ST,o)){var c=o8(s,o);return!c||!Co(rf,o)||Co(s,Mc)&&s[Mc][o]||(c.enumerable=!0),c}},d8=function(t){var r=a8(UA(t)),s=[];return VA(r,function(o){Co(rf,o)||Co(n8,o)||c8(s,o)}),s},h8=function(t){var r=t===bd,s=a8(r?ST:UA(t)),o=[];return VA(s,function(c){!Co(rf,c)||r&&!Co(bd,c)||c8(o,rf[c])}),o};Wv||(G_=function(){if(upe(FA,this))throw bpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?dpe(arguments[0]):void 0,r=r8(t),s=function(o){this===bd&&Mx(s,ST,o),Co(this,Mc)&&Co(this[Mc],r)&&(this[Mc][r]=!1),zx(this,r,jx(1,o))};return Bv&&Wx&&zx(bd,r,{configurable:!0,set:s}),Gx(r,t)},t8(FA=G_[vT],"toString",function(){return s8(this).tag}),t8(G_,"withoutSetter",function(t){return Gx(r8(t),t)}),e8.f=l8,Z6.f=BA,fpe.f=Hx,Q6.f=u8,hpe.f=J6.f=d8,ppe.f=h8,_pe.f=function(t){return Gx(gpe(t),t)},Bv&&mpe(FA,"description",{configurable:!0,get:function(){return s8(this).description}})),MA({global:!0,wrap:!0,forced:!Wv,sham:!Wv},{Symbol:G_}),VA(X6(wpe),function(t){ype(t)}),MA({target:jA,stat:!0,forced:!Wv},{useSetter:function(){Wx=!0},useSimple:function(){Wx=!1}}),MA({target:"Object",stat:!0,forced:!Wv,sham:!Bv},{create:function(t,r){return r===void 0?ET(t):Hx(ET(t),r)},defineProperty:BA,defineProperties:Hx,getOwnPropertyDescriptor:u8}),MA({target:"Object",stat:!0,forced:!Wv},{getOwnPropertyNames:d8}),Epe(),vpe(G_,jA),n8[Mc]=!0;var p8=yo&&!!Symbol.for&&!!Symbol.keyFor,Cpe=Fn,Rpe=Jt,Ipe=vi,Ape=_a,f8=Ga,Ppe=p8,$x=f8("string-to-symbol-registry"),Ope=f8("symbol-to-string-registry");Cpe({target:"Symbol",stat:!0,forced:!Ppe},{for:function(t){var r=Ape(t);if(Ipe($x,r))return $x[r];var s=Rpe("Symbol")(r);return $x[r]=s,Ope[s]=r,s}});var kpe=Fn,Npe=vi,Dpe=hl,xpe=_c,Lpe=p8,m8=Ga("symbol-to-string-registry");kpe({target:"Symbol",stat:!0,forced:!Lpe},{keyFor:function(t){if(!Dpe(t))throw TypeError(xpe(t)+" is not a symbol");if(Npe(m8,t))return m8[t]}});var g8=a_,Mpe=Ue,_8=te,Upe=_a,y8=I([].push),Vpe=Fn,E8=Jt,v8=X,jpe=ye,bT=I,S8=u,b8=Ue,T8=hl,w8=gs,Fpe=function(t){if(Mpe(t))return t;if(g8(t)){for(var r=t.length,s=[],o=0;o<r;o++){var c=t[o];typeof c=="string"?y8(s,c):typeof c!="number"&&_8(c)!="Number"&&_8(c)!="String"||y8(s,Upe(c))}var d=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(g8(this))return y;for(var v=0;v<d;v++)if(s[v]===m)return y}}},Bpe=yo,Wpe=String,Bm=E8("JSON","stringify"),WA=bT(/./.exec),C8=bT("".charAt),zpe=bT("".charCodeAt),Gpe=bT("".replace),Hpe=bT(1 .toString),$pe=/[\uD800-\uDFFF]/g,R8=/^[\uD800-\uDBFF]$/,I8=/^[\uDC00-\uDFFF]$/,A8=!Bpe||S8(function(){var t=E8("Symbol")();return Bm([t])!="[null]"||Bm({a:t})!="{}"||Bm(Object(t))!="{}"}),P8=S8(function(){return Bm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Bm("\uDEAD")!=='"\\udead"'}),Kpe=function(t,r){var s=w8(arguments),o=Fpe(r);if(b8(o)||t!==void 0&&!T8(t))return s[1]=function(c,d){if(b8(o)&&(d=jpe(o,this,Wpe(c),d)),!T8(d))return d},v8(Bm,null,s)},qpe=function(t,r,s){var o=C8(s,r-1),c=C8(s,r+1);return WA(R8,t)&&!WA(I8,c)||WA(I8,t)&&!WA(R8,o)?"\\u"+Hpe(zpe(t,0),16):t};Bm&&Vpe({target:"JSON",stat:!0,forced:A8||P8},{stringify:function(t,r,s){var o=w8(arguments),c=v8(A8?Kpe:Bm,null,o);return P8&&typeof c=="string"?Gpe(c,$pe,qpe):c}});var O8=Rc,Ype=xo;Fn({target:"Object",stat:!0,forced:!yo||u(function(){O8.f(1)})},{getOwnPropertySymbols:function(t){var r=O8.f;return r?r(Ype(t)):[]}}),Es("asyncIterator"),Es("hasInstance"),Es("isConcatSpreadable"),Es("iterator"),Es("match"),Es("matchAll"),Es("replace"),Es("search"),Es("species"),Es("split");var Xpe=K6;Es("toPrimitive"),Xpe();var Jpe=Jt,Qpe=fd;Es("toStringTag"),Qpe(Jpe("Symbol"),"Symbol"),Es("unscopables"),fd(L.JSON,"JSON",!0);var Zpe=vt.Symbol,efe=_r,tfe=rt.f,k8=efe("metadata"),N8=Function.prototype;N8[k8]===void 0&&tfe(N8,k8,{value:null}),Es("dispose"),Es("metadata");var nfe=Zpe;Es("asyncDispose");var rfe=I,Kx=Jt("Symbol"),ife=Kx.keyFor,sfe=rfe(Kx.prototype.valueOf),D8=Kx.isRegisteredSymbol||function(t){try{return ife(sfe(t))!==void 0}catch{return!1}};Fn({target:"Symbol",stat:!0},{isRegisteredSymbol:D8});for(var ofe=Ga,x8=Jt,afe=I,cfe=hl,lfe=_r,zA=x8("Symbol"),L8=zA.isWellKnownSymbol,M8=x8("Object","getOwnPropertyNames"),ufe=afe(zA.prototype.valueOf),U8=ofe("wks"),qx=0,V8=M8(zA),dfe=V8.length;qx<dfe;qx++)try{var j8=V8[qx];cfe(zA[j8])&&lfe(j8)}catch{}var F8=function(t){if(L8&&L8(t))return!0;try{for(var r=ufe(t),s=0,o=M8(U8),c=o.length;s<c;s++)if(U8[o[s]]==r)return!0}catch{}return!1};Fn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:F8}),Es("matcher"),Es("observable"),Fn({target:"Symbol",stat:!0},{isRegistered:D8}),Fn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:F8}),Es("metadataKey"),Es("patternMatch"),Es("replaceAll");var zv=l(nfe),B8=l(Fv.f("iterator"));function TT(t){return TT=typeof zv=="function"&&typeof B8=="symbol"?function(r){return typeof r}:function(r){return r&&typeof zv=="function"&&r.constructor===zv&&r!==zv.prototype?"symbol":typeof r},TT(t)}var hfe=l(Fv.f("toPrimitive"));function pfe(t){var r=function(s,o){if(TT(s)!=="object"||s===null)return s;var c=s[hfe];if(c!==void 0){var d=c.call(s,o);if(TT(d)!=="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(t,"string");return TT(r)==="symbol"?r:String(r)}function K(t,r,s){return(r=pfe(r))in t?L6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var W8=l(Kle),ffe={isBrowser:!0,classes:{URLSearchParams:W8!==void 0?W8:xx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Yx=typeof window<"u"&&typeof document<"u",Xx=typeof navigator=="object"&&navigator||void 0,mfe=Yx&&(!Xx||["ReactNative","NativeScript","NS"].indexOf(Xx.product)<0),gfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",_fe=Yx&&window.location.href||"http://localhost";function z8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function G8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?z8(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):z8(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var Ca=G8(G8({},Object.freeze({__proto__:null,hasBrowserEnv:Yx,hasStandardBrowserEnv:mfe,hasStandardBrowserWebWorkerEnv:gfe,navigator:Xx,origin:_fe})),ffe),yfe=dn,Efe=ye,vfe=vi,Sfe=k,bfe=function(){var t=yfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},H8=RegExp.prototype,$8=function(t){var r=t.flags;return r!==void 0||"flags"in H8||vfe(t,"flags")||!Sfe(H8,t)?r:Efe(bfe,t)},Tfe=ND.charAt,K8=ye,wfe=dn,Cfe=Ue,Rfe=te,Ife=/./.exec,Afe=TypeError,Pfe=Fn,q8=ye,Y8=ae,Ofe=HE,GA=XE,X8=Qt,J8=Ut,wT=_a,kfe=dn,Nfe=Dt,Dfe=te,xfe=HR,Q8=$8,Lfe=yc,Mfe=u,Ufe=Qi,Vfe=function(t,r,s){return r+(s?Tfe(t,r).length:1)},jfe=function(t,r){var s=t.exec;if(Cfe(s)){var o=K8(s,t,r);return o!==null&&wfe(o),o}if(Rfe(t)==="RegExp")return K8(Ife,t,r);throw Afe("RegExp#exec called on incompatible receiver")},Z8=hd,Ffe=_r("matchAll"),eW="RegExp String",tW=eW+" Iterator",Bfe=Z8.set,Wfe=Z8.getterFor(tW),zfe=TypeError,Jx=Y8("".indexOf),HA=Y8("".matchAll),Qx=!!HA&&!Mfe(function(){HA("a",/./)}),Gfe=Ofe(function(t,r,s,o){Bfe(this,{type:tW,regexp:t,string:r,global:s,unicode:o,done:!1})},eW,function(){var t=Wfe(this);if(t.done)return GA(void 0,!0);var r=t.regexp,s=t.string,o=jfe(r,s);return o===null?(t.done=!0,GA(void 0,!0)):t.global?(wT(o[0])===""&&(r.lastIndex=Vfe(s,J8(r.lastIndex),t.unicode)),GA(o,!1)):(t.done=!0,GA(o,!1))}),nW=function(t){var r,s,o,c=kfe(this),d=wT(t),h=Ufe(c,RegExp),m=wT(Q8(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Jx(m,"g"),o=!!~Jx(m,"u"),r.lastIndex=J8(c.lastIndex),new Gfe(r,d,s,o)};Pfe({target:"String",proto:!0,forced:Qx},{matchAll:function(t){var r,s,o,c,d=X8(this);if(Nfe(t)){if(Qx)return HA(d,t)}else{if(xfe(t)&&(r=wT(X8(Q8(t))),!~Jx(r,"g")))throw zfe("`.matchAll` does not allow non-global regexes");if(Qx)return HA(d,t);if((o=Lfe(t,Ffe))===void 0&&Dfe(t)=="RegExp"&&(o=nW),o)return q8(o,t,d)}return s=wT(d),c=new RegExp(t,"g"),q8(nW,c,s)}});var Hfe=qa("String").matchAll,$fe=k,Kfe=Hfe,Zx=String.prototype,qfe=function(t){var r=t.matchAll;return typeof t=="string"||t===Zx||$fe(Zx,t)&&r===Zx.matchAll?Kfe:r},Yfe=l(qfe);function rW(t){function r(s,o,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=d>=s.length;return h=!h&&lt.isArray(c)?c.length:h,y?(lt.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&lt.isObject(c[h])||(c[h]=[]),r(s,o,c[h],d)&&lt.isArray(c[h])&&(c[h]=function(v){const T={},R=Object.keys(v);let P;const N=R.length;let G;for(P=0;P<N;P++)G=R[P],T[G]=v[G];return T}(c[h])),!m)}if(lt.isFormData(t)&&lt.isFunction(t.entries)){const s={};return lt.forEachEntry(t,(o,c)=>{r(function(d){return Yfe(lt).call(lt,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const eL={transitional:k6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=lt.isObject(t);if(c&&lt.isHTMLForm(t)&&(t=new FormData(t)),lt.isFormData(t))return o?JSON.stringify(rW(t)):t;if(lt.isArrayBuffer(t)||lt.isBuffer(t)||lt.isStream(t)||lt.isFile(t)||lt.isBlob(t)||lt.isReadableStream(t))return t;if(lt.isArrayBufferView(t))return t.buffer;if(lt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return LA(h,new Ca.classes.URLSearchParams,Object.assign({visitor:function(y,v,T,R){return Ca.isNode&&lt.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=lt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return LA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,y){if(lt.isString(h))try{return(m||JSON.parse)(h),ro(lt).call(lt,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||eL.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(lt.isResponse(t)||lt.isReadableStream(t))return t;if(t&&lt.isString(t)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?nr.from(d,nr.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ca.classes.FormData,Blob:Ca.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],t=>{eL.headers[t]={}});var tL=eL;const Xfe=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),iW=Symbol("internals");function CT(t){var r;return t&&ro(r=String(t)).call(r).toLowerCase()}function $A(t){return t===!1||t==null?t:lt.isArray(t)?t.map($A):String(t)}function nL(t,r,s,o,c){return lt.isFunction(o)?o.call(this,r,s):(c&&(r=s),lt.isString(r)?lt.isString(o)?r.indexOf(o)!==-1:lt.isRegExp(o)?o.test(r):void 0:void 0)}class KA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function d(y,v,T){const R=CT(v);if(!R)throw new Error("header name must be a non-empty string");const P=lt.findKey(c,R);(!P||c[P]===void 0||T===!0||T===void 0&&c[P]!==!1)&&(c[P||v]=$A(y))}const h=(y,v)=>lt.forEach(y,(T,R)=>d(T,R,v));if(lt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(lt.isString(r)&&(r=ro(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(ro(m=r).call(m)))h((y=>{const v={};let T,R,P;return y&&y.split(`
`).forEach(function(N){var G,j;P=N.indexOf(":"),T=ro(G=N.substring(0,P)).call(G).toLowerCase(),R=ro(j=N.substring(P+1)).call(j),!T||v[T]&&Xfe[T]||(T==="set-cookie"?v[T]?v[T].push(R):v[T]=[R]:v[T]=v[T]?v[T]+", "+R:R)}),v})(r),s);else if(lt.isHeaders(r))for(const[y,v]of r.entries())d(v,y,o);else r!=null&&d(s,r,o);var m;return this}get(r,s){if(r=CT(r)){const o=lt.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(d);)h[y[1]]=y[2];return h}(c);if(lt.isFunction(s))return s.call(this,c,o);if(lt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=CT(r)){const o=lt.findKey(this,r);return!(!o||this[o]===void 0||s&&!nL(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function d(h){if(h=CT(h)){const m=lt.findKey(o,h);!m||s&&!nL(0,o[m],m,s)||(delete o[m],c=!0)}}return lt.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const d=s[o];r&&!nL(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,o={};return lt.forEach(this,(c,d)=>{var h;const m=lt.findKey(o,d);if(m)return s[m]=$A(c),void delete s[d];const y=r?function(v){return ro(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(T,R,P)=>R.toUpperCase()+P)}(d):ro(h=String(d)).call(h);y!==d&&delete s[d],s[y]=$A(c),o[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return lt.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&lt.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[iW]=this[iW]={accessors:{}}).accessors,o=this.prototype;function c(d){const h=CT(d);s[h]||(function(m,y){const v=lt.toCamelCase(" "+y);["get","set","has"].forEach(T=>{Object.defineProperty(m,T+v,{value:function(R,P,N){return this[T].call(this,y,R,P,N)},configurable:!0})})}(o,d),s[h]=!0)}return lt.isArray(r)?r.forEach(c):c(r),this}}KA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),lt.reduceDescriptors(KA.prototype,(t,r)=>{let{value:s}=t,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),lt.freezeMethods(KA);var Td=KA;function rL(t,r){const s=this||tL,o=r||s,c=Td.from(o.headers);let d=o.data;return lt.forEach(t,function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function sW(t){return!(!t||!t.__CANCEL__)}function Gv(t,r,s){nr.call(this,t??"canceled",nr.ERR_CANCELED,r,s),this.name="CanceledError"}function oW(t,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new nr("Request failed with status code "+s.status,[nr.ERR_BAD_REQUEST,nr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}lt.inherits(Gv,nr,{__CANCEL__:!0});const qA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(d,h){d=d||10;const m=new Array(d),y=new Array(d);let v,T=0,R=0;return h=h!==void 0?h:1e3,function(P){const N=Date.now(),G=y[R];v||(v=N),m[T]=P,y[T]=N;let j=R,W=0;for(;j!==T;)W+=m[j++],j%=d;if(T=(T+1)%d,T===R&&(R=(R+1)%d),N-v<h)return;const Y=G&&N-G;return Y?Math.round(1e3*W/Y):void 0}}(50,250);return function(d,h){let m,y,v=0,T=1e3/h;const R=function(P){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),d.apply(null,P)};return[function(){const P=Date.now(),N=P-v;for(var G=arguments.length,j=new Array(G),W=0;W<G;W++)j[W]=arguments[W];N>=T?R(j,P):(m=j,y||(y=setTimeout(()=>{y=null,R(m)},T-N)))},()=>m&&R(m)]}(d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,y=h-o,v=c(y);o=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},aW=(t,r)=>{const s=t!=null;return[o=>r[0]({lengthComputable:s,total:t,loaded:o}),r[1]]},cW=t=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return lt.asap(()=>t(...s))};var Jfe=Ca.hasStandardBrowserEnv?((t,r)=>s=>(s=new TA(s,Ca.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new TA(Ca.origin),Ca.navigator&&/(msie|trident)/i.test(Ca.navigator.userAgent)):()=>!0,Qfe=Ca.hasStandardBrowserEnv?{write(t,r,s,o,c,d){const h=[t+"="+encodeURIComponent(r)];lt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),lt.isString(o)&&h.push("path="+o),lt.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function lW(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s}(t,r):r}function uW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const dW=t=>t instanceof Td?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?uW(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):uW(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t):t;function $_(t,r){r=r||{};const s={};function o(v,T,R,P){return lt.isPlainObject(v)&&lt.isPlainObject(T)?lt.merge.call({caseless:P},v,T):lt.isPlainObject(T)?lt.merge({},T):lt.isArray(T)?T.slice():T}function c(v,T,R,P){return lt.isUndefined(T)?lt.isUndefined(v)?void 0:o(void 0,v,0,P):o(v,T,0,P)}function d(v,T){if(!lt.isUndefined(T))return o(void 0,T)}function h(v,T){return lt.isUndefined(T)?lt.isUndefined(v)?void 0:o(void 0,v):o(void 0,T)}function m(v,T,R){return R in r?o(v,T):R in t?o(void 0,v):void 0}const y={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,T,R)=>c(dW(v),dW(T),0,!0)};return lt.forEach(Object.keys(Object.assign({},t,r)),function(v){const T=y[v]||c,R=T(t[v],r[v],v);lt.isUndefined(R)&&T!==m||(s[v]=R)}),s}var hW=t=>{const r=$_({},t);let s,{data:o,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=Td.from(m),r.url=P6(lW(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),lt.isFormData(o)){if(Ca.hasStandardBrowserEnv||Ca.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...T]=s?s.split(";").map(R=>ro(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...T].join("; "))}}if(Ca.hasStandardBrowserEnv&&(c&&lt.isFunction(c)&&(c=c(r)),c||c!==!1&&Jfe(r.url))){const v=d&&h&&Qfe.read(h);v&&m.set(d,v)}return r},Zfe=typeof XMLHttpRequest<"u"&&function(t){return new ut(function(r,s){const o=hW(t);let c=o.data;const d=Td.from(o.headers).normalize();let h,m,y,v,T,{responseType:R,onUploadProgress:P,onDownloadProgress:N}=o;function G(){v&&v(),T&&T(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function W(){if(!j)return;const J=Td.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());oW(function(le){r(le),G()},function(le){s(le),G()},{data:R&&R!=="text"&&R!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:J,config:t,request:j}),j=null}j.open(o.method.toUpperCase(),o.url,!0),j.timeout=o.timeout,"onloadend"in j?j.onloadend=W:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(W)},j.onabort=function(){j&&(s(new nr("Request aborted",nr.ECONNABORTED,t,j)),j=null)},j.onerror=function(){s(new nr("Network Error",nr.ERR_NETWORK,t,j)),j=null},j.ontimeout=function(){let J=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const le=o.transitional||k6;o.timeoutErrorMessage&&(J=o.timeoutErrorMessage),s(new nr(J,le.clarifyTimeoutError?nr.ETIMEDOUT:nr.ECONNABORTED,t,j)),j=null},c===void 0&&d.setContentType(null),"setRequestHeader"in j&&lt.forEach(d.toJSON(),function(J,le){j.setRequestHeader(le,J)}),lt.isUndefined(o.withCredentials)||(j.withCredentials=!!o.withCredentials),R&&R!=="json"&&(j.responseType=o.responseType),N&&([y,T]=qA(N,!0),j.addEventListener("progress",y)),P&&j.upload&&([m,v]=qA(P),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",v)),(o.cancelToken||o.signal)&&(h=J=>{j&&(s(!J||J.type?new Gv(null,t,j):J),j.abort(),j=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const Y=function(J){const le=/^([-+\w]{1,25})(:?\/\/|:)/.exec(J);return le&&le[1]||""}(o.url);Y&&Ca.protocols.indexOf(Y)===-1?s(new nr("Unsupported protocol "+Y+":",nr.ERR_BAD_REQUEST,t)):j.send(c||null)})},eme=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let o,c=new AbortController;const d=function(v){if(!o){o=!0,m();const T=v instanceof Error?v:this.reason;c.abort(T instanceof nr?T:new Gv(T instanceof Error?T.message:T))}};let h=r&&setTimeout(()=>{h=null,d(new nr("timeout ".concat(r," of ms exceeded"),nr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)}),t=null)};t.forEach(v=>v.addEventListener("abort",d));const{signal:y}=c;return y.unsubscribe=()=>lt.asap(m),y}},tme=i4,nme=bl;Fn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=nme.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var rme=bl,ime=Sh;Fn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=rme.f(this),s=ime(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var iL=l(tme),pW=Fv.f("asyncIterator"),sme=l(pW);function sL(t,r){this.v=t,this.k=r}function RT(t){var r,s;function o(d,h){try{var m=t[d](h),y=m.value,v=y instanceof sL;iL.resolve(v?y.v:y).then(function(T){if(v){var R=d==="return"?"return":"next";if(!y.k||T.done)return o(R,T);T=t[R](T).value}c(m.done?"return":"normal",T)},function(T){o("throw",T)})}catch(T){c("throw",T)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(d,h){return new iL(function(m,y){var v={key:d,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,o(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function wl(t){return function(){return new RT(t.apply(this,arguments))}}function In(t){return new sL(t,0)}function YA(t){var r={},s=!1;function o(c,d){return s=!0,{done:!1,value:new sL(d=new iL(function(h){h(t[c](d))}),1)}}return r[zv!==void 0&&B8||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}RT.prototype[typeof zv=="function"&&sme||"@@asyncIterator"]=function(){return this},RT.prototype.next=function(t){return this._invoke("next",t)},RT.prototype.throw=function(t){return this._invoke("throw",t)},RT.prototype.return=function(t){return this._invoke("return",t)};var oL=l(pW);function aL(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=oL,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new XA(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function XA(t){function r(s){if(Object(s)!==s)return ut.reject(new TypeError(s+" is not an object."));var o=s.done;return ut.resolve(s.value).then(function(c){return{value:c,done:o}})}return XA=function(s){this.s=s,this.n=s.next},XA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ut.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ut.reject(s):r(o.apply(this.s,arguments))}},new XA(t)}const ome=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let o,c=0;for(;c<s;)o=c+r,yield t.slice(c,o),c=o},ame=function(){var t=wl(function*(r,s){var o,c=!1,d=!1;try{for(var h,m=aL(cme(r));c=!(h=yield In(m.next())).done;c=!1){const y=h.value;yield*YA(aL(ome(y,s)))}}catch(y){d=!0,o=y}finally{try{c&&m.return!=null&&(yield In(m.return()))}finally{if(d)throw o}}});return function(r,s){return t.apply(this,arguments)}}(),cme=function(){var t=wl(function*(r){if(r[oL])return void(yield*YA(aL(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield In(s.read());if(o)break;yield c}}finally{yield In(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),fW=(t,r,s,o)=>{const c=ame(t,r);let d,h=0,m=y=>{d||(d=!0,o&&o(y))};return new ReadableStream({async pull(y){try{const{done:v,value:T}=await c.next();if(v)return m(),void y.close();let R=T.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(T))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function mW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function gW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?mW(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):mW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const JA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",_W=JA&&typeof ReadableStream=="function",lme=JA&&(typeof TextEncoder=="function"?(yW=new TextEncoder,t=>yW.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var yW;const EW=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!t(...s)}catch{return!1}},ume=_W&&EW(()=>{let t=!1;const r=new Request(Ca.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),cL=_W&&EW(()=>lt.isReadableStream(new Response("").body)),QA={stream:cL&&(t=>t.body)};var vW;JA&&(vW=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!QA[t]&&(QA[t]=lt.isFunction(vW[t])?r=>r[t]():(r,s)=>{throw new nr("Response type '".concat(t,"' is not supported"),nr.ERR_NOT_SUPPORT,s)})}));const dme=async(t,r)=>{const s=lt.toFiniteNumber(t.getContentLength());return s??(async o=>o==null?0:lt.isBlob(o)?o.size:lt.isSpecCompliantForm(o)?(await new Request(Ca.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:lt.isArrayBufferView(o)||lt.isArrayBuffer(o)?o.byteLength:(lt.isURLSearchParams(o)&&(o+=""),lt.isString(o)?(await lme(o)).byteLength:void 0))(r)};var hme=JA&&(async t=>{let{url:r,method:s,data:o,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:T,withCredentials:R="same-origin",fetchOptions:P}=hW(t);v=v?(v+"").toLowerCase():"text";let N,G=eme([c,d&&d.toAbortSignal()],h);const j=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let W;try{if(y&&ume&&s!=="get"&&s!=="head"&&(W=await dme(T,o))!==0){let Ee,ge=new Request(r,{method:"POST",body:o,duplex:"half"});if(lt.isFormData(o)&&(Ee=ge.headers.get("content-type"))&&T.setContentType(Ee),ge.body){const[Ne,qe]=aW(W,qA(cW(y)));o=fW(ge.body,65536,Ne,qe)}}lt.isString(R)||(R=R?"include":"omit");const Y="credentials"in Request.prototype;N=new Request(r,gW(gW({},P),{},{signal:G,method:s.toUpperCase(),headers:T.normalize().toJSON(),body:o,duplex:"half",credentials:Y?R:void 0}));let J=await fetch(N);const le=cL&&(v==="stream"||v==="response");if(cL&&(m||le&&j)){const Ee={};["status","statusText","headers"].forEach(dt=>{Ee[dt]=J[dt]});const ge=lt.toFiniteNumber(J.headers.get("content-length")),[Ne,qe]=m&&aW(ge,qA(cW(m),!0))||[];J=new Response(fW(J.body,65536,Ne,()=>{qe&&qe(),j&&j()}),Ee)}v=v||"text";let _e=await QA[lt.findKey(QA,v)||"text"](J,t);return!le&&j&&j(),await new ut((Ee,ge)=>{oW(Ee,ge,{data:_e,headers:Td.from(J.headers),status:J.status,statusText:J.statusText,config:t,request:N})})}catch(Y){throw j&&j(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new nr("Network Error",nr.ERR_NETWORK,t,N),{cause:Y.cause||Y}):nr.from(Y,Y&&Y.code,t,N)}});const lL={http:null,xhr:Zfe,fetch:hme};lt.forEach(lL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const SW=t=>"- ".concat(t),pme=t=>lt.isFunction(t)||t===null||t===!1;var bW={getAdapter:t=>{t=lt.isArray(t)?t:[t];const{length:r}=t;let s,o;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],o=s,!pme(s)&&(o=lL[(h=String(s)).toLowerCase()],o===void 0))throw new nr("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+d]=o}if(!o){const d=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new nr("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(SW).join(`
`):" "+SW(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:lL};function uL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Gv(null,t)}function TW(t){return uL(t),t.headers=Td.from(t.headers),t.data=rL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),bW.getAdapter(t.adapter||tL.adapter)(t).then(function(r){return uL(t),r.data=rL.call(t,t.transformResponse,r),r.headers=Td.from(r.headers),r},function(r){return sW(r)||(uL(t),r&&r.response&&(r.response.data=rL.call(t,t.transformResponse,r.response),r.response.headers=Td.from(r.response.headers))),ut.reject(r)})}const wW="1.7.9",ZA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{ZA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const CW={};ZA.transitional=function(t,r,s){function o(c,d){return"[Axios v"+wW+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new nr(o(d," has been removed"+(r?" in "+r:"")),nr.ERR_DEPRECATED);return r&&!CW[d]&&(CW[d]=!0,console.warn(o(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},ZA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var eP={assertOptions:function(t,r,s){if(typeof t!="object")throw new nr("options must be an object",nr.ERR_BAD_OPTION_VALUE);const o=Object.keys(t);let c=o.length;for(;c-- >0;){const d=o[c],h=r[d];if(h){const m=t[d],y=m===void 0||h(m,d,t);if(y!==!0)throw new nr("option "+d+" must be "+y,nr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new nr("Unknown option "+d,nr.ERR_BAD_OPTION)}},validators:ZA};const Ih=eP.validators;let tP=class{constructor(t){this.defaults=t,this.interceptors={request:new O6,response:new O6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=$_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&eP.assertOptions(s,{silentJSONParsing:Ih.transitional(Ih.boolean),forcedJSONParsing:Ih.transitional(Ih.boolean),clarifyTimeoutError:Ih.transitional(Ih.boolean)},!1),o!=null&&(lt.isFunction(o)?r.paramsSerializer={serialize:o}:eP.assertOptions(o,{encode:Ih.function,serialize:Ih.function},!0)),eP.assertOptions(r,{baseUrl:Ih.spelling("baseURL"),withXsrfToken:Ih.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&lt.merge(c.common,c[r.method]);c&&lt.forEach(["delete","get","head","post","put","patch","common"],N=>{delete c[N]}),r.headers=Td.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))});const y=[];let v;this.interceptors.response.forEach(function(N){y.push(N.fulfilled,N.rejected)});let T,R=0;if(!m){const N=[TW.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,y),T=N.length,v=ut.resolve(r);R<T;)v=v.then(N[R++],N[R++]);return v}T=h.length;let P=r;for(R=0;R<T;){const N=h[R++],G=h[R++];try{P=N(P)}catch(j){G.call(this,j);break}}try{v=TW.call(this,P)}catch(N){return ut.reject(N)}for(R=0,T=y.length;R<T;)v=v.then(y[R++],y[R++]);return v}getUri(t){return P6(lW((t=$_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};lt.forEach(["delete","get","head","options"],function(t){tP.prototype[t]=function(r,s){return this.request($_(s||{},{method:t,url:r,data:(s||{}).data}))}}),lt.forEach(["post","put","patch"],function(t){function r(s){return function(o,c,d){return this.request($_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}tP.prototype[t]=r(),tP.prototype[t+"Form"]=r(!0)});var nP=tP;class dL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new ut(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let d=o._listeners.length;for(;d-- >0;)o._listeners[d](c);o._listeners=null}),this.promise.then=c=>{let d;const h=new ut(m=>{o.subscribe(m),d=m}).then(c);return h.cancel=function(){o.unsubscribe(d)},h},r(function(c,d,h){o.reason||(o.reason=new Gv(c,d,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new dL(function(o){r=o}),cancel:r}}}var fme=dL;const hL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(hL).forEach(t=>{let[r,s]=t;hL[s]=r});var mme=hL;const Hs=function t(r){const s=new nP(r),o=d6(nP.prototype.request,s);return lt.extend(o,nP.prototype,s,{allOwnKeys:!0}),lt.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return t($_(r,c))},o}(tL);Hs.Axios=nP,Hs.CanceledError=Gv,Hs.CancelToken=fme,Hs.isCancel=sW,Hs.VERSION=wW,Hs.toFormData=LA,Hs.AxiosError=nr,Hs.Cancel=Hs.CanceledError,Hs.all=function(t){return ut.all(t)},Hs.spread=function(t){return function(r){return t.apply(null,r)}},Hs.isAxiosError=function(t){return lt.isObject(t)&&t.isAxiosError===!0},Hs.mergeConfig=$_,Hs.AxiosHeaders=Td,Hs.formToJSON=t=>rW(lt.isHTMLForm(t)?new FormData(t):t),Hs.getAdapter=bW.getAdapter,Hs.HttpStatusCode=mme,Hs.default=Hs;var Jo=Hs;const gme=()=>{};function IT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:gme};return t.promise=new ut((r,s)=>{t.resolve=o=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(o),t.value=o)},t.reject=o=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(o))}}),t}const rP=new Map,iP=new Map,Ah=new Map;let ji=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Bn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const RW=new Dde;let wd=RW.getResult(),pL=null;function An(t){if(!pL){wd=RW.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Bn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Bn.CHROME;case"Safari":case"Mobile Safari":return Bn.SAFARI;case"Edge":return Bn.EDGE;case"Firefox":return Bn.FIREFOX;case"QQ":case"QQBrowser":return Bn.QQ;case"Opera":return Bn.OPERA;case"WeChat":return Bn.WECHAT;default:return m.browser.name||""}}(wd),s=IW(wd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(wd),c=wd.os.version,d=IW(wd,!1),h=wd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:d,deviceType:h};pL={name:r,version:s,os:o,osVersion:c,browserVersion:d,deviceType:h}}return pL}function IW(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function sP(){return An().os}function AW(){const t=An();return"".concat(t.os," ").concat(t.osVersion)}function oP(){const t=An();return!!(wd.engine.name==="WebKit"&&t.os===ji.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Bn.SAFARI||Ro()&&t.name!==Bn.SAFARI)}function sf(){return An().name===Bn.CHROME}function vs(){return An().name===Bn.SAFARI}function PW(){return An().name===Bn.EDGE}function Fr(){return An().name===Bn.FIREFOX}function Ro(){return An().os===ji.IOS}function AT(t){const r=An();return!(r.name!==Bn.CHROME||!r.osVersion)&&Number(r.version)>=t}function OW(t){const r=An();return!(r.name!==Bn.CHROME||!r.osVersion)&&Number(r.version)<t}function fL(t,r,s){const o=An();return!(o.name!==t||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function mL(t){const r=An();return!(r.name!==Bn.EDGE||!r.osVersion)&&Number(r.version)>=t}function kW(t){const r=An();return!(r.name!==Bn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function NW(t,r,s){const o=An();if(o.os!==ji.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function DW(t,r,s){const o=An();if(o.name!==Bn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function gL(t){const r=An();return!(r.name!==Bn.OPERA||!r.osVersion)&&Number(r.version)>=t}function xW(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Hv(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function _L(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function LW(){const t=An();if(t.os!==ji.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function _u(){return vs()&&navigator.maxTouchPoints>0}function MW(){return An().name===Bn.WECHAT}function UW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function yL(){const t=sP();return function(){const{deviceType:r}=An();return r==="mobile"||r==="tablet"}()||t===ji.ANDROID||t===ji.IOS||t===ji.HARMONY_OS}function of(){const t=An();return t.name!==Bn.EDGE&&t.name!==Bn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function aP(){return sP()===ji.ANDROID}function PT(){const t=An();return aP()&&(t.name===Bn.CHROME||t.name===Bn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function VW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VW(Object(s),!0).forEach(function(o){$t(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VW(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function $t(t,r,s){return(r=function(o){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let Q=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),xe=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),$t(this,"code",void 0),$t(this,"message",void 0),$t(this,"data",void 0),$t(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function af(t,r){if(typeof t!="boolean")throw new xe(Q.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function xi(t,r,s){if(!at(s).call(s,t))throw new xe(Q.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function rr(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new xe(Q.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function EL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new xe(Q.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&rr(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&rr(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&rr(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&rr(t.ideal,"".concat(r,".ideal"),1,1/0)}else rr(t,r,1,1/0)}function ss(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new xe(Q.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!jW(t,s,o,c))throw new xe(Q.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function cf(t,r){if(!Array.isArray(t))throw new xe(Q.INVALID_PARAMS,"".concat(r," should be an array"))}function Br(t){return t==null}function jW(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}var OT=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(OT||{}),vL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(vL||{});const FW=new class{constructor(){$t(this,"_clientSize",null),$t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$t(this,"getStyle",t=>window.getComputedStyle(t,null)),$t(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const o=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=o;return(c==="none"||at(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const T=y.split("(")[0];return at(v=["brightness","blur","opacity"]).call(v,T)}).map(y=>{const[v,T]=y.split(/\(|\)/);return[v,Number(T.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,T]=y;switch(v){case"brightness":(T<.1||T>3)&&(s=!1);break;case"blur":T>3&&(s=!1);break;case"opacity":T<.1&&(s=!1)}}),s)}),$t(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,o=!0;const c=h=>r(h);let d=t;for(;d&&o;)c(d)||(s=!1,o=!1),d=d.parentElement,d||(o=!1);return s}),$t(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),$t(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:o,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:d,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),$t(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),$t(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),$t(this,"checkCoverForAPoint",(t,r,s)=>{const o=this.elementFromPoint(t,r);return o!==null&&o!==s}),$t(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:o}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const T=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(o*m+(v===0?.1:v===4?(d*v*m-1e5)/m:d*v)*m)/m;h.push({x:T,y:R})}return[...h]}),$t(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),$t(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),$t(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:o,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,y,v,T;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(y=r<d?r:d,s<0)v=0;else{if(!(s<c))return!1;v=s}if(o<0)return!1;T=o<c?o:c;const R=y-m,P=T-v;return this.checkSizeIsVisible(R,P,h)}),$t(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),$t(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(OT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(OT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(OT.SIZE)}}return this.returnHiddenResult(OT.STYLE)}return this.returnHiddenResult(vL.UNMOUNTED)}return this.returnHiddenResult(vL.INVALID_HTML_ELEMENT)}),$t(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function SL(t){return new TextEncoder().encode(t)}const BW=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},bL=async t=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",SL(t)),16);let Mr=class{constructor(){$t(this,"_events",{}),$t(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],o=this._indexOfListener(s,r);o!==-1&&s.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(d=>d);for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];for(let d=0;d<r.length;d+=1){const h=r[d];h.once&&this.off(t,h.listener),h.listener.apply(this,o||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},kT=null;function WW(){if(kT)return kT;if(window.electron)return kT=window.electron;if(!window.require)return null;try{return kT=window.require("electron"),kT}catch{return null}}let Ti=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Wr=function(t){return t.TRACER="tracer",t}({});function zW(t){return rr(t.timeout,"config.timeout",0,1e5),rr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),rr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),rr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let _me=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),$n=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function NT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function GW(t){return ss(t.turnServerURL,"turnServerURL"),ss(t.username,"username"),ss(t.password,"password"),t.udpport&&rr(t.udpport,"udpport",1,99999,!0),t.forceturn&&af(t.forceturn,"forceturn"),t.security&&af(t.security,"security"),t.tcpport&&rr(t.tcpport,"tcpport",1,99999,!0),!0}function TL(t){return t.level!==void 0&&xi(t.level,"level",[1,2,3]),t.delay!==void 0&&rr(t.delay,"delay",0,3e3,!0),!0}let _n=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Ss=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),nc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),$v=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function bs(t,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return t.getListeners(r).length===0?ut.reject(new xe(Q.UNEXPECTED_ERROR,"can not emit promise")):new ut((d,h)=>{t.emit(r,...o,d,h)})}function lr(t,r){if(t.getListeners(r).length===0)return ut.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return bs(t,r,...o)}function Uc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return DT(t,r,...o)}function DT(t,r){let s=null,o=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new xe(Q.UNEXPECTED_ERROR,"handler is not sync");return s}const fi=new class extends Mr{set networkState(t){this.emit($v.NETWORK_STATE_CHANGE,t,this._networkState),t===nc.ONLINE?this.emit($v.ONLINE):t===nc.OFFLINE&&(this.onlineWaiter=new ut(r=>{this.once($v.ONLINE,()=>{this.onlineWaiter=void 0,r(nc.ONLINE)})}),this.emit($v.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===nc.ONLINE}constructor(){super(),$t(this,"_moduleName","network-indicator"),$t(this,"_networkState",nc.ONLINE),$t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=nc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=nc.OFFLINE})}};function cP(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Kv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function lP(t){ut!==void 0?ut.resolve().then(t):setTimeout(t,0)}function zr(t){return JSON.parse(JSON.stringify(t))}function K_(t){try{return zr(t)}catch{return t}}const HW={};function Wm(t,r){HW[r]||(HW[r]=!0,t())}function q_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function zm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function $W(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function KW(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=Ya(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let d=0;return r.forEach(h=>{c.set(h,d),d+=h.length}),c}function Ph(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function qW(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?Ph(s):s.size}),r+138}function yme(t){const r=new xe(Q.TIMEOUT,"timeout");return new ut((s,o)=>{window.setTimeout(()=>o(r),t)})}function os(t){return new ut(r=>{window.setTimeout(r,t)})}function ur(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+ur(t-s.length,"")}function Y_(){return ur(32,"").toUpperCase()}const uP=()=>{},YW=new class{constructor(){$t(this,"fnMap",new Map)}throttleByKey(t,r,s,o){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:d,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,mt(mt({},m),{},{fn:t,args:d,skipFn:o}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:o})}}},XW=YW.throttleByKey.bind(YW);function JW(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function wL(t,r){if(!JW(t)||!JW(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let o=0;o<r.length;o++)s[o]=wL(t[o],r[o]);return s}{const s=mt({},t);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(t,o)?s[o]=wL(t[o],r[o]):s[o]=r[o]);return s}}function QW(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let o=0;for(;t>0&&(s[o]=255&t,t>>=8,o++,o!==r););return s}function CL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function ZW(t){const r="0123456789abcdef";function s(le){let _e,Ee="";for(_e=0;_e<=3;_e++)Ee+=r.charAt(le>>8*_e+4&15)+r.charAt(le>>8*_e&15);return Ee}function o(le,_e){const Ee=(65535&le)+(65535&_e);return(le>>16)+(_e>>16)+(Ee>>16)<<16|65535&Ee}function c(le,_e,Ee,ge,Ne,qe){return o(function(dt,ft){return dt<<ft|dt>>>32-ft}(o(o(_e,le),o(ge,qe)),Ne),Ee)}function d(le,_e,Ee,ge,Ne,qe,dt){return c(_e&Ee|~_e&ge,le,_e,Ne,qe,dt)}function h(le,_e,Ee,ge,Ne,qe,dt){return c(_e&ge|Ee&~ge,le,_e,Ne,qe,dt)}function m(le,_e,Ee,ge,Ne,qe,dt){return c(_e^Ee^ge,le,_e,Ne,qe,dt)}function y(le,_e,Ee,ge,Ne,qe,dt){return c(Ee^(_e|~ge),le,_e,Ne,qe,dt)}const v=function(le){let _e;const Ee=1+(le.length+8>>6),ge=new Array(16*Ee);for(_e=0;_e<16*Ee;_e++)ge[_e]=0;for(_e=0;_e<le.length;_e++)ge[_e>>2]|=le.charCodeAt(_e)<<_e%4*8;return ge[_e>>2]|=128<<_e%4*8,ge[16*Ee-2]=8*le.length,ge}(t);let T,R,P,N,G,j=1732584193,W=-271733879,Y=-1732584194,J=271733878;for(T=0;T<v.length;T+=16)R=j,P=W,N=Y,G=J,j=d(j,W,Y,J,v[T+0],7,-680876936),J=d(J,j,W,Y,v[T+1],12,-389564586),Y=d(Y,J,j,W,v[T+2],17,606105819),W=d(W,Y,J,j,v[T+3],22,-1044525330),j=d(j,W,Y,J,v[T+4],7,-176418897),J=d(J,j,W,Y,v[T+5],12,1200080426),Y=d(Y,J,j,W,v[T+6],17,-1473231341),W=d(W,Y,J,j,v[T+7],22,-45705983),j=d(j,W,Y,J,v[T+8],7,1770035416),J=d(J,j,W,Y,v[T+9],12,-1958414417),Y=d(Y,J,j,W,v[T+10],17,-42063),W=d(W,Y,J,j,v[T+11],22,-1990404162),j=d(j,W,Y,J,v[T+12],7,1804603682),J=d(J,j,W,Y,v[T+13],12,-40341101),Y=d(Y,J,j,W,v[T+14],17,-1502002290),W=d(W,Y,J,j,v[T+15],22,1236535329),j=h(j,W,Y,J,v[T+1],5,-165796510),J=h(J,j,W,Y,v[T+6],9,-1069501632),Y=h(Y,J,j,W,v[T+11],14,643717713),W=h(W,Y,J,j,v[T+0],20,-373897302),j=h(j,W,Y,J,v[T+5],5,-701558691),J=h(J,j,W,Y,v[T+10],9,38016083),Y=h(Y,J,j,W,v[T+15],14,-660478335),W=h(W,Y,J,j,v[T+4],20,-405537848),j=h(j,W,Y,J,v[T+9],5,568446438),J=h(J,j,W,Y,v[T+14],9,-1019803690),Y=h(Y,J,j,W,v[T+3],14,-187363961),W=h(W,Y,J,j,v[T+8],20,1163531501),j=h(j,W,Y,J,v[T+13],5,-1444681467),J=h(J,j,W,Y,v[T+2],9,-51403784),Y=h(Y,J,j,W,v[T+7],14,1735328473),W=h(W,Y,J,j,v[T+12],20,-1926607734),j=m(j,W,Y,J,v[T+5],4,-378558),J=m(J,j,W,Y,v[T+8],11,-2022574463),Y=m(Y,J,j,W,v[T+11],16,1839030562),W=m(W,Y,J,j,v[T+14],23,-35309556),j=m(j,W,Y,J,v[T+1],4,-1530992060),J=m(J,j,W,Y,v[T+4],11,1272893353),Y=m(Y,J,j,W,v[T+7],16,-155497632),W=m(W,Y,J,j,v[T+10],23,-1094730640),j=m(j,W,Y,J,v[T+13],4,681279174),J=m(J,j,W,Y,v[T+0],11,-358537222),Y=m(Y,J,j,W,v[T+3],16,-722521979),W=m(W,Y,J,j,v[T+6],23,76029189),j=m(j,W,Y,J,v[T+9],4,-640364487),J=m(J,j,W,Y,v[T+12],11,-421815835),Y=m(Y,J,j,W,v[T+15],16,530742520),W=m(W,Y,J,j,v[T+2],23,-995338651),j=y(j,W,Y,J,v[T+0],6,-198630844),J=y(J,j,W,Y,v[T+7],10,1126891415),Y=y(Y,J,j,W,v[T+14],15,-1416354905),W=y(W,Y,J,j,v[T+5],21,-57434055),j=y(j,W,Y,J,v[T+12],6,1700485571),J=y(J,j,W,Y,v[T+3],10,-1894986606),Y=y(Y,J,j,W,v[T+10],15,-1051523),W=y(W,Y,J,j,v[T+1],21,-2054922799),j=y(j,W,Y,J,v[T+8],6,1873313359),J=y(J,j,W,Y,v[T+15],10,-30611744),Y=y(Y,J,j,W,v[T+6],15,-1560198380),W=y(W,Y,J,j,v[T+13],21,1309151649),j=y(j,W,Y,J,v[T+4],6,-145523070),J=y(J,j,W,Y,v[T+11],10,-1120210379),Y=y(Y,J,j,W,v[T+2],15,718787259),W=y(W,Y,J,j,v[T+9],21,-343485551),j=o(j,R),W=o(W,P),Y=o(Y,N),J=o(J,G);return s(j)+s(W)+s(Y)+s(J)}let Eme=1,ez=console,Os=class{static setLogger(t){ez=t}constructor(t,r){$t(this,"id",void 0),$t(this,"lockingPromise",ut.resolve()),$t(this,"locks",0),$t(this,"name",""),$t(this,"lockId",void 0),this.lockId=Eme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");ez.debug("".concat(s," ").concat(o))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new ut(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function qv(t,r){return function(s,o,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(o));try{for(var y=arguments.length,v=new Array(y),T=0;T<y;T++)v[T]=arguments[T];return await d.apply(this,v)}finally{m()}},c}}const wi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function RL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function Cd(t,r,s,o){const c=Object.assign({},wi,o);let d=c.timeout;const h=async()=>{await function(v){return new ut(T=>{window.setTimeout(T,v)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const y=new ut(async(v,T)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return T(new xe(Q.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return v(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return T(P);await h()}}});return y.cancel=()=>m=!0,y}let dP,tz=class{constructor(t){$t(this,"input",[]),$t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ya(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},hP=0,IL=0;function AL(t,r,s,o){return new ut((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),hP+=Ph(r.data)):s&&(r.data.size?hP+=r.data.size:r.data instanceof FormData?hP+=qW(r.data):hP+=Ph(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Jo.request(r).then(h=>{typeof h.data=="string"?IL+=Ph(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?IL+=h.data.byteLength:IL+=Ph(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Jo.isCancel(h)?d(new xe(Q.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new xe(Q.NETWORK_TIMEOUT,h.message)):h.response?d(new xe(Q.NETWORK_RESPONSE_ERROR,h.response.status)):d(new xe(Q.NETWORK_ERROR,h.message))})})}async function vme(t,r){const s=new Blob([r.data],{type:"buffer"});return await AL(t,mt(mt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const nz=()=>window.isSecureContext!==void 0;function yu(t){if(Array.isArray(t))return t.map(s=>s);if(!rz(t))return t;const r={};for(const s in t){const o=t[s];rz(o)||Array.isArray(o)?r[s]=yu(o):r[s]=o}return r}function rz(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let PL=class{constructor(t){$t(this,"input",[]),$t(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Oh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},xT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Oh,remoteCandidate:Oh},updateInterval:0},iz={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},sz={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},oz={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},az={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let OL=class{constructor(t,r){$t(this,"onFirstVideoReceived",void 0),$t(this,"onFirstVideoDecoded",void 0),$t(this,"onFirstAudioReceived",void 0),$t(this,"onFirstVideoDecodedTimeout",void 0),$t(this,"onFirstAudioDecoded",void 0),$t(this,"onSelectedLocalCandidateChanged",void 0),$t(this,"onSelectedRemoteCandidateChanged",void 0),$t(this,"videoIsReady",!1),$t(this,"videoIsReady2",{}),$t(this,"pc",void 0),$t(this,"options",void 0),$t(this,"intervalTimer",void 0),$t(this,"stats",yu(xT)),$t(this,"isFirstVideoReceived",{}),$t(this,"isFirstVideoDecoded",{}),$t(this,"isFirstAudioReceived",{}),$t(this,"isFirstAudioDecoded",{}),$t(this,"isFirstVideoDecodedTimeout",{}),$t(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ut(t=>{t({local:mt({},Oh),remote:mt({},Oh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,d=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const T=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(o+=T,d+=R):(c+=T,h+=R),Number.isNaN(T)||Number.isNaN(T)?y.packetLostRate=0:y.packetLostRate=T<=0||R<=0?0:R/(T+R)});t.sendPacketLossRate=o<=0||d<=0?0:d/(o+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Sme=class extends OL{constructor(){super(...arguments),$t(this,"_stats",xT),$t(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=yu(xT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const o=at(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=yu(sz);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=yu(iz),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:mt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=yu(az);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=yu(oz);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ut((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},LT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),pP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),kL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),Vc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Yv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Yv||{});function MT(t,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Yv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[o]);if(typeof y!="number")return;const v=h-y;return v?(d-m)/v*c:void 0}let cz=class extends OL{constructor(){super(...arguments),$t(this,"_stats",xT),$t(this,"report",void 0),$t(this,"lastDecodeVideoReceiverStats",new Map),$t(this,"lastVideoFramesRecv",new Map),$t(this,"lastVideoFramesSent",new Map),$t(this,"lastVideoFramesDecode",new Map),$t(this,"lastVideoFramesOutput",new Map),$t(this,"lastVideoJBDelay",new Map),$t(this,"lastAudioJBDelay",new Map),$t(this,"mediaBytesSent",new Map),$t(this,"mediaBytesRetransmit",new Map),$t(this,"mediaBytesTargetEncode",new Map),$t(this,"lastDecodeAudioReceiverStats",new Map),$t(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=yu(xT),this.report.forEach(t=>{switch(t.type){case Vc.OUTBOUND:case Vc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,o=!r&&!("frameWidth"in t);t.type===Vc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===Vc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case Vc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Vc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:mt({},Oh),remote:mt({},Oh)};return t.forEach(s=>{let o;if(s.type===Vc.TRANSPORT&&(o=t.get(s.selectedCandidatePairId)),s.type===Vc.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const d=t.get(o.localCandidateId);d&&c(r.local,d)}if(o.remoteCandidateId){const d=t.get(o.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===Vc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===Vc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===Vc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.localCandidate)),t.type===Vc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(mt({},r),mt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(o=>o.ssrc===t.ssrc);r||(r=yu(az),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=MT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Yv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,mt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=yu(iz),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=MT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=MT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Yv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=MT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Yv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=MT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Yv.kMillisecondsFromSeconds),o&&d-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((d-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:mt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);r||(r=yu(sz),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const o=new PL(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const c=new PL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const c=new PL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-o.lastFrameCount,d=t.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const o=this.findRemoteStatsId(t.ssrc,Vc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=yu(oz),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,Vc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const o=Array.from(Lc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return o?o.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var o,c,d,h;const m=r?this.report.get(r):void 0,y=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,T=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof T=="number"||(v=0,T=0),R==null){const P=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&P-N.lts>=800?(R=Math.round((y-N.count)/((P-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):N?R=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:v,height:T,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var o,c,d,h,m;const y=r?this.report.get(r):void 0,v=(o=y==null?void 0:y.framesReceived)!==null&&o!==void 0?o:t.framesReceived,T=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(d=y==null?void 0:y.frameHeight)!==null&&d!==void 0?d:t.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,N=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=v;let W=0;G&&j-G.lts>=800?(W=Math.round((v-G.count)/((j-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:W})):G?W=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:0}),s.receivedFrame={width:T||0,height:R||0,frameRate:W||0},s.decodedFrame={width:T||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:T||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&N){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=G.jitterBufferMs;const W=N-G.jitterBufferEmittedCount;W>0&&(j=1e3*(P-G.jitterBufferDelay)/W),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var o,c,d,h;const m=r?this.report.get(r):void 0,y=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&o!==void 0?o:0,v=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var o,c,d,h,m,y,v;const T=r?this.report.get(r):void 0,R=(o=T==null?void 0:T.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,P=(c=T==null?void 0:T.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,N=(d=T==null?void 0:T.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,G=(h=T==null?void 0:T.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,j=(m=T==null?void 0:T.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,W=(y=T==null?void 0:T.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,Y=(v=T==null?void 0:T.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),N&&G){const le=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _e=le.jitterBufferMs;const Ee=G-le.jitterBufferEmittedCount;Ee>0&&(_e=1e3*(N-le.jitterBufferDelay)/Ee),s.jitterBufferMs=Math.round(_e),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=j;let J=1920;W&&P&&(J=P/W/50,s.receivedFrames=Math.round(P/J)),Y&&(s.droppedFrames=Math.round(Y/J))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},bme=class extends OL{updateStats(){return ut.resolve()}};function NL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new Sme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new cz(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ut||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new cz(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new bme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const lz="websdk_ng_install_id";function DL(){try{if(ie("INSTALL_ID"))return ie("INSTALL_ID");let t=window.localStorage.getItem(lz);return t||(t=Y_(),window.localStorage.setItem(lz,t)),er("INSTALL_ID",t),t}catch{return}}const Cl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.23.2"),xL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let X_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ts=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=o,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ts;const fP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},LL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},ML="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",UL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},vr=mt(mt(mt({},UL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:LL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},fP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function er(t,r,s){var o,c,d;at(o=Object.keys(vr)).call(o,t)&&(!s&&at(c=Object.keys(Rd)).call(c,t)||(vr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(vr.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(vr.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,vr.USE_NEW_NETWORK_CONFIG=d,d&&(vr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],vr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],vr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],vr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],vr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",vr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",vr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(vr.ENABLE_INSTANT_VIDEO=!0,vr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(vr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(vr.NEW_TURN_MODE||(vr.NEW_TURN_MODE=4))))}function ie(t){return vr[t]}xL||(vr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],vr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],vr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],vr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],vr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],vr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],vr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",vr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",vr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",vr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",vr.AREAS=["NORTH_AMERICA","OVERSEA"]);let uz=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Rd={};var yn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(yn||{});let mP=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const dz=128,Tme=96,hz=1e3,Xv=10;let wme=0;var pz=(()=>{var t={8:(o,c,d)=>{d.r(c),d.d(c,{Parser:()=>dt,Printer:()=>ai,parse:()=>ot,print:()=>bt});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function T(We){return We>="0"&&We<="9"}function R(We){return We>="!"&&We<="~"}function P(We){return R(We)||We>=""&&We<=""}function N(We){return We==="!"||We>="#"&&We<="'"||We>="*"&&We<="+"||We>="-"&&We<="."||We>="0"&&We<="9"||We>="A"&&We<="Z"||We>="^"&&We<="~"}function G(We){return We>="1"&&We<="9"}function j(We){return We>="A"&&We<="Z"||We>="a"&&We<="z"}function W(We){return We==="d"||We==="h"||We==="m"||We==="s"}function Y(We){return We>""&&We<"	"||We>"\v"&&We<"\f"||We>""&&We<""}function J(We){return j(We)||T(We)||We==="+"||We==="/"}function le(We){return T(We)||j(We)||We==="+"||We==="/"||We==="-"||We==="_"}function _e(We){return j(We)||T(We)||We==="+"||We==="/"}function Ee(We,M){var se=Object.keys(We);if(Object.getOwnPropertySymbols){var de=Object.getOwnPropertySymbols(We);M&&(de=de.filter(function(Je){return Object.getOwnPropertyDescriptor(We,Je).enumerable})),se.push.apply(se,de)}return se}function ge(We){for(var M=1;M<arguments.length;M++){var se=arguments[M]!=null?arguments[M]:{};M%2?Ee(Object(se),!0).forEach(function(de){Ne(We,de,se[de])}):Object.getOwnPropertyDescriptors?Object.defineProperties(We,Object.getOwnPropertyDescriptors(se)):Ee(Object(se)).forEach(function(de){Object.defineProperty(We,de,Object.getOwnPropertyDescriptor(se,de))})}return We}function Ne(We,M,se){return M in We?Object.defineProperty(We,M,{value:se,enumerable:!0,configurable:!0,writable:!0}):We[M]=se,We}(function(We){We.VERSION="v",We.ORIGIN="o",We.SESSION_NAME="s",We.INFORMATION="i",We.URI="u",We.EMAIL="e",We.PHONE="p",We.CONNECTION="c",We.BANDWIDTH="b",We.TIME="t",We.REPEAT="r",We.ZONE_ADJUSTMENTS="z",We.KEY="k",We.ATTRIBUTE="a",We.MEDIA="m"})(v||(v={}));class qe{consumeText(M,se){let de=se;for(;de<M.length;){const Je=M[de];if(Je==="\0"||Je==="\r"||Je===h)break;de+=1}if(de-se==0)throw new Error("Invalid text, at ".concat(M));return de}consumeUnicastAddress(M,se,de){return this.consumeTill(M,se,y)}consumeOneOrMore(M,se,de){let Je=se;for(;de(M[Je]);)Je++;if(Je-se==0)throw new Error("Invalid rule at ".concat(se,"."));return Je}consumeSpace(M,se){if(M[se]===y)return se+1;throw new Error("Invalid space at ".concat(se,"."))}consumeIP4Address(M,se){let de=se;for(let Je=0;Je<4;Je++)if(de=this.consumeDecimalUChar(M,de),Je!==3){if(M[de]!==".")throw new Error("Invalid IP4 address.");de++}return de}consumeDecimalUChar(M,se){let de=se;for(let qt=0;qt<3&&T(M[de]);qt++,de++);if(de-se==0)throw new Error("Invalid decimal uchar.");const Je=parseInt(M.slice(se,de));if(Je>=0&&Je<=255)return de;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,se){let de=this.consumeHexpart(M,se);return M[de]===":"&&(de+=1,de=this.consumeIP4Address(M,de)),de}consumeHexpart(M,se){let de=se;if(M[de]===":"&&M[de+1]===":"){de+=2;try{de=this.consumeHexseq(M,de)}catch{}return de}if(de=this.consumeHexseq(M,de),M[de]===":"&&M[de+1]===":"){de+=2;try{de=this.consumeHexseq(M,de)}catch{}return de}return de}consumeHexseq(M,se){let de=se;for(;de=this.consumeHex4(M,de),M[de]===":"&&M[de+1]!==":";)de+=1;return de}consumeHex4(M,se){let de=0;for(;de<4;de++)if(!((Je=M[se+de])>="0"&&Je<="9"||Je>="a"&&Je<="f"||Je>="A"&&Je<="F")){if(de===0)throw new Error("Invalid hex 4");break}var Je;return se+de}consumeFQDN(M,se){let de=se;for(;T(M[de])||j(M[de])||M[de]==="-"||M[de]===".";)de+=1;if(de-se<4)throw new Error("Invalid FQDN");return de}consumeExtnAddr(M,se){return this.consumeOneOrMore(M,se,P)}consumeMulticastAddress(M,se,de){switch(de){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,se);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,se);default:try{return this.consumeFQDN(M,se)}catch{return this.consumeExtnAddr(M,se)}}}consumeIP6MulticastAddress(M,se){const de=this.consumeHexpart(M,se);return M[de]==="/"?this.consumeInteger(M,de+1):de}consumeIP4MulticastAddress(M,se){let de=se+3;const Je=M.slice(se,de),qt=parseInt(Je);if(qt<224||qt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ir=0;ir<3;ir++){if(M[de]!==".")throw new Error("Invalid IP4 multicast address.");de+=1,de=this.consumeDecimalUChar(M,de)}return M[de]==="/"&&(de+=1),de=this.consumeTTL(M,de),M[de]==="/"&&(de=this.consumeInteger(M,de)),de}consumeInteger(M,se){if(!G(M[se]))throw new Error("Invalid integer.");for(se+=1;T(M[se]);)se+=1;return se}consumeTTL(M,se){if(M[se]==="0")return se+1;if(!G(M[se]))throw new Error("Invalid TTL.");se+=1;for(let de=0;de<2&&T(M[se]);de++)se+=1;return se}consumeToken(M,se){return this.consumeOneOrMore(M,se,N)}consumeTime(M,se){let de=se;if(M[de]==="0")return de+1;for(G(M[de])&&(de+=1);T(M[de]);)de++;if(de-se<10)throw new Error("Invalid time");return de}consumeAddress(M,se){return this.consumeTill(M,se,y)}consumeTypedTime(M,se){let de=se;return de=this.consumeOneOrMore(M,de,T),W(M[de])?de+1:de}consumeRepeatInterval(M,se){if(!G(M[se]))throw new Error("Invalid repeat interval");for(se+=1;T(M[se]);)se+=1;return W(M[se])&&(se+=1),se}consumePort(M,se){return this.consumeOneOrMore(M,se,T)}consume(M,se,de){for(let Je=0;Je<de.length;Je++){if(se+Je>=M.length)throw new Error("consume exceeding value length");if(M[se+Je]!==de[Je])throw new Error("consume ".concat(de," failed at ").concat(Je))}return se+de.length}consumeTill(M,se,de){let Je=se;for(;Je<M.length&&(typeof de!="string"||M[Je]!==de)&&(typeof de!="function"||!de(M[Je]));)Je++;return Je}}class dt extends qe{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(M){const se=this.probeEOL(M);this.records=M.split(se).filter(vy=>!!ro(vy).call(vy)).map(this.parseLine),this.currentLine=0;const de=this.parseVersion(),Je=this.parseOrigin(),qt=this.parseSessionName(),ir=this.parseInformation(),Wi=this.parseUri(),Oa=this.parseEmail(),vf=this.parsePhone(),Ey=this.parseConnection(),Ew=this.parseBandWidth(),R1=this.parseTimeFields(),I1=this.parseKey(),Dl=this.parseSessionAttribute(),ag=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:de,origin:Je,sessionName:qt,information:ir,uri:Wi,emails:Oa,phones:vf,connection:Ey,bandwidths:Ew,timeFields:R1,key:I1,attributes:Dl,mediaDescriptions:ag}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let se=0;se<M.length;se++)if(M[se]===h)return M[se-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,se){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const de=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:de,value:M.slice(2),line:se,cur:0}}parseSessionAttribute(){const M=new Sn;for(;this.currentLine<this.records.length;){const se=this.getCurrentRecord();if(se.type!==v.ATTRIBUTE)break;const de={attField:this.extractOneOrMore(se,Je=>N(Je)&&Je!==":"),_cur:0};se.value[se.cur]===":"&&(se.cur+=1,de.attValue=this.extractOneOrMore(se,Y)),M.parse(de),this.currentLine++}return M.digest()}parseMediaAttributes(M){const se=new bn(M);for(;this.currentLine<this.records.length;){const de=this.getCurrentRecord();if(de.type!==v.ATTRIBUTE)break;const Je={attField:this.extractOneOrMore(de,qt=>N(qt)&&qt!==":"),_cur:0};de.value[de.cur]===":"&&(de.cur+=1,Je.attValue=this.extractOneOrMore(de,Y)),se.parse(Je),this.currentLine++}return se.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===v.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===v.ZONE_ADJUSTMENTS){const se=[];for(;;)try{const de=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let Je=!1;M.value[M.cur]==="-"&&(Je=!0,M.cur+=1);const qt=this.extract(M,this.consumeTypedTime);se.push({time:de,typedTime:qt,back:Je})}catch{break}if(se.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,se}return[]}parseRepeat(){const M=[];for(;;){const se=this.getCurrentRecord();if(se.type!==v.REPEAT)break;{const de=this.extract(se,this.consumeRepeatInterval),Je=this.parseTypedTime(se);M.push({repeatInterval:de,typedTimes:Je}),this.currentLine++}}return M}parseTypedTime(M){const se=[];for(;;)try{this.consumeSpaceForRecord(M),se.push(this.extract(M,this.consumeTypedTime))}catch{break}if(se.length===0)throw new Error("Invalid typed time.");return se}parseTime(){const M=this.getCurrentRecord(),se=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const de=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:se,stopTime:de}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const se=this.getCurrentRecord();if(se.type!==v.BANDWIDTH)break;{const de=this.extractOneOrMore(se,N);if(se.value[se.cur]!==":")throw new Error("Invalid bandwidth field.");se.cur++;const Je=this.extractOneOrMore(se,T);M.push({bwtype:de,bandwidth:Je}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==v.VERSION)throw new Error("first sdp record must be version");const se=M.value.slice(0,this.consumeOneOrMore(M.value,0,T));if(se.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,se}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const se=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);const de=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);const Je=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);const qt=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const ir=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Wi=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:se,sessId:de,sessVersion:Je,nettype:qt,addrtype:ir,unicastAddress:Wi}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===v.SESSION_NAME){const se=this.extract(M,this.consumeText);return this.currentLine++,se}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==v.INFORMATION)return;const se=this.extract(M,this.consumeText);return this.currentLine++,se}parseUri(){const M=this.getCurrentRecord();if(M.type===v.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const se=this.getCurrentRecord();if(se.type!==v.EMAIL)break;M.push(se.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const se=this.getCurrentRecord();if(se.type!==v.PHONE)break;M.push(se.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===v.CONNECTION){const se=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const de=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Je=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:se,addrtype:de,address:Je}}}parseMedia(){const M=this.getCurrentRecord(),se=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let de=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,de+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const Je=[];for(Je.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,Je.push(this.extract(M,this.consumeToken));if(Je.length===0)throw new Error("Invalid proto");const qt=this.parseFmt(M);return this.currentLine++,{mediaType:se,port:de,protos:Je,fmts:qt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===v.TIME;){const se=this.parseTime(),de=this.parseRepeat(),Je=this.parseZone();M.push({time:se,repeats:de,zones:Je})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const se=this.parseMedia(),de=this.parseInformation(),Je=this.parseConnections(),qt=this.parseBandWidth(),ir=this.parseKey(),Wi=this.parseMediaAttributes(se);M.push({media:se,information:de,connections:Je,bandwidths:qt,key:ir,attributes:Wi})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const se=[];for(;;)try{this.consumeSpaceForRecord(M),se.push(this.extract(M,this.consumeToken))}catch{break}if(se.length===0)throw new Error("Invalid fmts");return se}extract(M,se){for(var de=arguments.length,Je=new Array(de>2?de-2:0),qt=2;qt<de;qt++)Je[qt-2]=arguments[qt];const ir=se.call(this,M.value,M.cur,...Je),Wi=M.value.slice(M.cur,ir);return M.cur=ir,Wi}extractOneOrMore(M,se){const de=this.consumeOneOrMore(M.value,M.cur,se),Je=M.value.slice(M.cur,de);return M.cur=de,Je}consumeSpaceForRecord(M){if(M.value[M.cur]!==y)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class ft extends qe{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(M,se,de){const Je=this.consumeOneOrMore(M.attValue,M._cur,se),qt=M.attValue.slice(M._cur,Je),[ir,Wi]=de||[];if(typeof ir=="number"&&qt.length<ir)throw new Error("error in length, should be more or equal than ".concat(ir," characters."));if(typeof Wi=="number"&&qt.length>Wi)throw new Error("error in length, should be less or equal than ".concat(Wi," characters."));return M._cur=Je,qt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==y)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,se){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var de=arguments.length,Je=new Array(de>2?de-2:0),qt=2;qt<de;qt++)Je[qt-2]=arguments[qt];const ir=se.call(this,M.attValue,M._cur,...Je),Wi=M.attValue.slice(M._cur,ir);return M._cur=ir,Wi}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,se){if(!M.attValue)throw new Error;for(let de=0;de<se.length;de++)if(se[de]!==M.attValue[M._cur+de])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,J,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,J,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const se=[];for(;!this.atEnd(M);){se.push(this.extractOneOrMore(M,J));try{this.consumeAttributeSpace(M)}catch(de){if(this.atEnd(M))break;throw de}}this.attributes.iceOptions=se}parseFingerprint(M){const se=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:se,fingerprint:de})}parseExtmap(M){const se=this.extractOneOrMore(M,T);let de;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),de=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const Je=this.extract(M,this.consumeTill,y),qt=ge(ge({entry:parseInt(se,10)},de&&{direction:de}),{},{extensionName:Je});this.peekChar(M)===y&&(this.consumeAttributeSpace(M),qt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(qt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const se=this.extract(M,this.consumeTill);if(se!=="active"&&se!=="passive"&&se!=="actpass"&&se!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=se}}class Sn extends ft{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(se){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),se}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const se=this.extract(M,this.consumeToken),de=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;)this.consumeAttributeSpace(M),de.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:se,identificationTag:de})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,le)}parseIdentity(M){const se=this.extractOneOrMore(M,_e),de=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;){this.consumeAttributeSpace(M);const Je=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const qt=this.extractOneOrMore(M,ir=>ir!==y&&Y(ir));de.push({name:Je,value:qt})}this.attributes.identities.push({assertionValue:se,extensions:de})}parseMsidSemantic(M){this.peekChar(M)===y&&this.consumeAttributeSpace(M);const se={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),se.applyForAll=!0;break}{const de=this.extract(M,this.consumeTill,y);se.identifierList.push(de)}}this.attributes.msidSemantic=se}}class bn extends ft{constructor(M){super(),Ne(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(se){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),se}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const se=this.extractOneOrMore(M,J,[1,32]);this.consumeAttributeSpace(M);const de=this.extractOneOrMore(M,T,[1,5]);this.consumeAttributeSpace(M);const Je=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const qt=this.extractOneOrMore(M,T,[1,10]);this.consumeAttributeSpace(M);const ir=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Wi=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const Oa={foundation:se,componentId:de,transport:Je,priority:qt,connectionAddress:ir,port:Wi,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),Oa.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),Oa.relPort=this.extract(M,this.consumePort));this.peekChar(M)===y;){this.consumeAttributeSpace(M);const vf=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),Oa.extension[vf]=this.extractOneOrMore(M,R)}this.attributes.candidates.push(Oa)}parseRemoteCandidate(M){const se=[];for(;;){const de=this.extractOneOrMore(M,T,[1,5]);this.consumeAttributeSpace(M);const Je=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const qt=this.extract(M,this.consumePort);se.push({componentId:de,connectionAddress:Je,port:qt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(se)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const se=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const Je={encodingName:de,clockRate:this.extractOneOrMore(M,T)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),Je.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const qt=this.attributes.payloads.find(ir=>ir.payloadType===parseInt(se,10));qt?qt.rtpMap=Je:this.attributes.payloads.push({payloadType:parseInt(se,10),rtpMap:Je,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const se=this.extractOneOrMore(M,T);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill,":");let Je;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),Je=this.extract(M,this.consumeTill));const qt=this.attributes.ssrcs.find(ir=>ir.ssrcId===parseInt(se,10));qt?qt.attributes[de]=Je:this.attributes.ssrcs.push({ssrcId:parseInt(se,10),attributes:{[de]:Je}})}parseFmtp(M){const se=this.extract(M,this.consumeTill,y);this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill),Je={};de.split(";").forEach(ir=>{let[Wi,Oa]=ir.split("=");Wi=ro(Wi).call(Wi);const vf=typeof Oa=="string"?ro(Oa).call(Oa):null;typeof Wi=="string"&&Wi.length>0&&(Je[Wi]=vf)});const qt=this.attributes.payloads.find(ir=>ir.payloadType===parseInt(se,10));qt?qt.fmtp={parameters:Je}:this.attributes.payloads.push({payloadType:parseInt(se,10),rtcpFeedbacks:[],fmtp:{parameters:Je}})}parseFmtParameters(M){const se={},de=this.extract(M,this.consumeTill,"=");M._cur++;const Je=this.extract(M,this.consumeTill,";");for(se[de]=Je;M.attValue[M._cur]===";";){const qt=this.extract(M,this.consumeTill,"=");M._cur++;const ir=this.extract(M,this.consumeTill,";");se[qt]=ir}return se}parseRtcpFb(M){let se="";se=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,y),this.consumeAttributeSpace(M);const de=this.extract(M,this.consumeTill,y);let Je;if(de==="trr-int")Je={type:de,interval:this.extract(M,this.consumeTill)};else{const qt={type:de};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),qt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===y&&(qt.additional=this.extract(M,this.consumeTill))),Je=qt}if(se==="*")this.attributes.rtcpFeedbackWildcards.push(Je);else{const qt=this.attributes.payloads.find(ir=>ir.payloadType===parseInt(se,10));qt?qt.rtcpFeedbacks.push(Je):this.attributes.payloads.push({payloadType:parseInt(se,10),rtcpFeedbacks:[Je]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const se={port:this.extract(M,this.consumePort)};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),se.netType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),se.addressType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),se.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=se}parseMsid(M){const se={id:this.extractOneOrMore(M,N,[1,64])};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),se.appdata=this.extractOneOrMore(M,N,[1,64])),this.attributes.msids.push(se)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const se=this.extractOneOrMore(M,Je=>j(Je)||T(Je)||Je==="_"||Je==="-");this.consumeAttributeSpace(M);const de={id:se,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===y){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const Je=[];for(;;){const qt=this.extract(M,this.consumeToken);Je.push(qt);try{this.extract(M,this.consume,",")}catch{break}}de.payloads=Je,this.peekChar(M)===y&&this.extract(M,this.consume,y)}for(;;){const Je=this.extract(M,this.consumeToken);switch(Je){case"depend":{const qt={type:Je,rids:this.extract(M,this.consume,"=").split(",")};de.params.push(qt);break}default:{const qt={type:Je};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),qt.val=this.extract(M,this.consumeTill,";")),de.params.push(qt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(de)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,T,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const se=this.extract(M,this.consumeToken),de=[];for(;;)try{this.consumeAttributeSpace(M);const Je=this.extract(M,this.consumeInteger);de.push(parseInt(Je,10))}catch{break}this.attributes.ssrcGroups.push({semantic:se,ssrcIds:de})}}function hr(We,M,se){return M in We?Object.defineProperty(We,M,{value:se,enumerable:!0,configurable:!0,writable:!0}):We[M]=se,We}class ai{constructor(){hr(this,"eol",m)}print(M,se){let de="";return se&&(this.eol=se),de+=this.printVersion(M.version),de+=this.printOrigin(M.origin),de+=this.printSessionName(M.sessionName),de+=this.printInformation(M.information),de+=this.printUri(M.uri),de+=this.printEmail(M.emails),de+=this.printPhone(M.phones),de+=this.printConnection(M.connection),de+=this.printBandwidth(M.bandwidths),de+=this.printTimeFields(M.timeFields),de+=this.printKey(M.key),de+=this.printSessionAttributes(M.attributes),de+=this.printMediaDescription(M.mediaDescriptions),de}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let se="";for(const de of M)se+="e=".concat(de).concat(this.eol);return se}printPhone(M){let se="";for(const de of M)se+="e=".concat(de).concat(this.eol);return se}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let se="";for(const de of M)se+="b=".concat(de.bwtype,":").concat(de.bandwidth).concat(this.eol);return se}printTimeFields(M){let se="";for(const de of M){se+="t=".concat(de.time.startTime," ").concat(de.time.startTime).concat(this.eol);for(const Je of de.repeats)se+="r=".concat(Je.repeatInterval," ").concat(Je.typedTimes.join(" ")).concat(this.eol);de.zoneAdjustments&&(se+="z=",se+="z=".concat(de.zoneAdjustments.map(Je=>"".concat(Je.time," ").concat(Je.back?"-":""," ").concat(Je.typedTime)).join(" ")).concat(this.eol),se+=this.eol)}return se}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let se="";for(const de of M)se+="a=".concat(de.attField).concat(de.attValue?":".concat(de.attValue):"").concat(this.eol);return se}printMediaDescription(M){let se="";for(const de of M)se+=this.printMedia(de.media),se+=this.printInformation(de.information),se+=this.printConnections(de.connections),se+=this.printBandwidth(de.bandwidths),se+=this.printKey(de.key),se+=this.printMediaAttributes(de);return se}printConnections(M){let se="";for(const de of M)se+=this.printConnection(de);return se}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new ra(this.eol).print(M)}printMediaAttributes(M){return new Fe(this.eol).print(M)}}class Yr{constructor(M){hr(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(y)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(se=>"a=fingerprint:".concat(se.hashFunction).concat(y).concat(se.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(se=>"a=extmap:".concat(se.entry).concat(se.direction?"/".concat(se.direction):"").concat(y).concat(se.extensionName).concat(se.extensionAttributes?"".concat(y).concat(se.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(se=>"a=".concat(se.attField).concat(se.attValue?":".concat(se.attValue):"").concat(this.eol)).join("")}}class ra extends Yr{print(M){let se="";return se+=this.printGroups(M.groups),se+=this.printMsidSemantic(M.msidSemantic),se+=this.printIceLite(M.iceLite),se+=this.printIceUfrag(M.iceUfrag),se+=this.printIcePwd(M.icePwd),se+=this.printIceOptions(M.iceOptions),se+=this.printFingerprints(M.fingerprints),se+=this.printSetup(M.setup),se+=this.printTlsId(M.tlsId),se+=this.printIdentity(M.identities),se+=this.printExtmap(M.extmaps),se+=this.printUnrecognized(M.unrecognized),se}printGroups(M){let se="";return M.length>0&&(se+=M.map(de=>"a=group:".concat(de.semantic).concat(de.identificationTag.map(Je=>"".concat(y).concat(Je)).join("")).concat(this.eol)).join("")),se}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(se=>"a=identity:".concat(se.assertionValue).concat(se.extensions.map(de=>"".concat(y).concat(de.name).concat(de.value?"=".concat(de.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let se="a=msid-semantic:".concat(M.semantic);return M.applyForAll?se+="".concat(y,"*"):M.identifierList.length>0&&(se+=M.identifierList.map(de=>"".concat(y).concat(de))),se+this.eol}}class Fe extends Yr{print(M){const se=M.attributes;let de="";return de+=this.printRTCP(se.rtcp),de+=this.printIceUfrag(se.iceUfrag),de+=this.printIcePwd(se.icePwd),de+=this.printIceOptions(se.iceOptions),de+=this.printCandidates(se.candidates),de+=this.printRemoteCandidatesList(se.remoteCandidatesList),de+=this.printEndOfCandidates(se.endOfCandidates),de+=this.printFingerprints(se.fingerprints),de+=this.printSetup(se.setup),de+=this.printMid(se.mid),de+=this.printExtmap(se.extmaps),de+=this.printRTPRelated(se),de+=this.printPtime(se.ptime),de+=this.printMaxPtime(se.maxPtime),de+=this.printDirection(se.direction),de+=this.printSSRCGroups(se.ssrcGroups),de+=this.printSSRC(se.ssrcs),de+=this.printRTCPMux(se.rtcpMux),de+=this.printRTCPMuxOnly(se.rtcpMuxOnly),de+=this.printRTCPRsize(se.rtcpRsize),de+=this.printMSId(se.msids),de+=this.printImageattr(se.imageattr),de+=this.printRid(se.rids),de+=this.printSimulcast(se.simulcast),de+=this.printSCTPPort(se.sctpPort),de+=this.printMaxMessageSize(se.maxMessageSize),de+=this.printUnrecognized(se.unrecognized),de}printCandidates(M){return M.map(se=>"a=candidate:".concat(se.foundation).concat(y).concat(se.componentId).concat(y).concat(se.transport).concat(y).concat(se.priority).concat(y).concat(se.connectionAddress).concat(y).concat(se.port).concat(y,"typ").concat(y).concat(se.type).concat(se.relAddr?"".concat(y,"raddr").concat(y).concat(se.relAddr):"").concat(se.relPort?"".concat(y,"rport").concat(y).concat(se.relPort):"").concat(Object.keys(se.extension).map(de=>"".concat(y).concat(de).concat(y).concat(se.extension[de])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(se=>"a=remote-candidates:".concat(se.join(y)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const se=M.payloads;let de="";de+=M.rtcpFeedbackWildcards.map(Je=>this.printRTCPFeedback("*",Je)).join("");for(const Je of se)de+=this.printRtpMap(Je.payloadType,Je.rtpMap),de+=this.printFmtp(Je.payloadType,Je.fmtp),de+=Je.rtcpFeedbacks.map(qt=>this.printRTCPFeedback(Je.payloadType,qt)).join("");return de}printFmtp(M,se){if(!se)return"";const de=Object.keys(se.parameters);return de.length===1&&se.parameters[de[0]]===null?"a=fmtp:".concat(M).concat(y).concat(de[0]).concat(this.eol):"a=fmtp:".concat(M).concat(y).concat(Object.keys(se.parameters).map(Je=>"".concat(Je,"=").concat(se.parameters[Je])).join(";")).concat(this.eol)}printRtpMap(M,se){return se?"a=rtpmap:".concat(M).concat(y).concat(se.encodingName,"/").concat(se.clockRate).concat(se.encodingParameters?"/".concat(se.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,se){let de="a=rtcp-fb:".concat(M).concat(y),Je=se;return Je.type==="trr-int"?de+="ttr-int".concat(y).concat(Je.interval):(de+="".concat(Je.type),Je.parameter&&(de+="".concat(y).concat(Je.parameter),Je.additional&&(de+="".concat(y).concat(Je.additional)))),de+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(se=>Object.keys(se.attributes).map(de=>"a=ssrc:".concat(se.ssrcId.toString(10)).concat(y).concat(de).concat(se.attributes[de]?":".concat(se.attributes[de]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let se="a=rtcp:".concat(M.port);return M.netType&&(se+="".concat(y).concat(M.netType)),M.addressType&&(se+="".concat(y).concat(M.addressType)),M.address&&(se+="".concat(y).concat(M.address)),se+this.eol}printMSId(M){return M.map(se=>"a=msid:".concat(se.id).concat(se.appdata?"".concat(y).concat(se.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(se=>"a=imageattr:".concat(se).concat(this.eol)).join("")}printRid(M){return M.map(se=>{let de="a=rid:".concat(se.id).concat(y).concat(se.direction);return se.payloads&&(de+="".concat(y,"pt=").concat(se.payloads.join(","))),se.params.length>0&&(de+="".concat(y).concat(se.params.map(Je=>Je.type==="depend"?"depend=".concat(Je.rids.join(",")):"".concat(Je.type,"=").concat(Je.val)).join(";"))),de+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(se=>"a=ssrc-group:".concat(se.semantic).concat(se.ssrcIds.map(de=>"".concat(y).concat(de.toString(10))).join("")).concat(this.eol)).join("")}}function ot(We){return new dt().parse(We)}function bt(We,M){return new ai().print(We,M)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return t[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var d in c)s.o(c,d)&&!s.o(o,d)&&Object.defineProperty(o,d,{enumerable:!0,get:c[d]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function Ra(t){return pz.parse(t)}function Gm(t,r){return pz.print(t,r)}var Cme=qa("Array").keys,Rme=wc,Ime=vi,Ame=k,Pme=Cme,VL=Array.prototype,Ome={DOMTokenList:!0,NodeList:!0},kme=function(t){var r=t.keys;return t===VL||Ame(VL,t)&&r===VL.keys||Ime(Ome,Rme(t))?Pme:r},jc=l(kme);function fz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?fz(Object(s),!0).forEach(function(o){Gr(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):fz(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Gr(t,r,s){return(r=function(o){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const mz=new class extends Mr{constructor(){super(...arguments),Gr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Nme{constructor(r){Gr(this,"logger",void 0),Gr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function jL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function gz(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Rl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},gP=Date.now(),UT=t=>{for(const r in Rl)if(Object.prototype.hasOwnProperty.call(Rl,r)&&Rl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Gr(this,"proxyServerURL",void 0),Gr(this,"logLevel",Rl.DEBUG),Gr(this,"uploadState","collecting"),Gr(this,"uploadLogWaitingList",[]),Gr(this,"uploadLogUploadingList",[]),Gr(this,"uploadErrorCount",0),Gr(this,"currentLogID",0),Gr(this,"url",void 0),Gr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const o=[Rl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){er("UPLOAD_LOG",!0)}disableLogUpload(){er("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Nme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-gP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-gP);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=jL()+" Agora-SDK [".concat(UT(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=jL()+" %cAgora-SDK [".concat(UT(o),"]:");let d=[];if(!ie("USE_NEW_LOG"))switch(o){case Rl.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Rl.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Rl.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Rl.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-gP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-gP);const o=Math.max(0,Math.min(4,r[0]));r[0]=jL()+" Agora-SDK [".concat(UT(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(t){if(!ie("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=gz()+" Agora-SDK [".concat(UT(t),"]:"):s[0]=gz()+" Agora-SDK [".concat(UT(t),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Cl,process_id:ie("PROCESS_ID"),payload:JSON.stringify(t)};return Cd(async()=>{const s=await Jo.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(ie("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(ie("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),mz.reportLogUploadError(o),!0},{timeout:ie("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:ie("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,ie("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),ie("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),ie("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),ie("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var _z;function Dme(t){return ss(t.reportId,"params.reportId",0,100,!1),ss(t.category,"params.category",0,100,!1),ss(t.event,"params.event",0,100,!1),ss(t.label,"params.label",0,100,!1),rr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(_z={}).FREE="free",_z.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const xme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Fi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),kr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Lme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Vt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let T=y;if(t.argsMap)try{T=t.argsMap(this,...y)}catch(P){x.warning(P),T=[]}try{JSON.stringify(T)}catch{x.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),T=[]}const R=(t.report||Ct).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:T,tag:Wr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,y);return P instanceof ut?P.then(N=>(R.onSuccess(t.reportResult&&N),N)).catch(N=>{throw R.onError(N),N}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Ct=new class{constructor(){Gr(this,"baseInfoMap",new Map),Gr(this,"proxyServer",void 0),Gr(this,"eventUploadTimer",void 0),Gr(this,"setSessionIdTimer",void 0),Gr(this,"url",void 0),Gr(this,"sids",new Set),Gr(this,"backupUrl",void 0),Gr(this,"_appId",void 0),Gr(this,"_aid",0),Gr(this,"keyEventUploadPendingItems",[]),Gr(this,"normalEventUploadPendingItems",[]),Gr(this,"apiInvokeUploadPendingItems",[]),Gr(this,"apiInvokeCount",0),Gr(this,"apiInvokeLoggedCount",0),Gr(this,"ltsList",[]),Gr(this,"lastSendNormalEventTime",Date.now()),Gr(this,"customReportCounterTimer",void 0),Gr(this,"customReportCount",0),Gr(this,"extApiInvoke",async t=>{for(const r of t){const s=sn(sn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Wr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),ie("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),ie("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!ie("SHOW_REPORT_INVOKER_LOG"),h=!!ie("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(N,G){if(m){let j="[apiInvoke-".concat(y,"]");r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]")),x.info("".concat(j," ").concat(N),N==="start"?r.options:G||"")}}const T=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});v("start");let R=!1;os(r.timeout).then(()=>{R||(this.sendApiInvoke(sn(sn({},T()),{},{error:Q.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const P=new xe(Q.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(sn(sn({},T()),{},{success:!0},r.reportResult&&{result:N})),v("onSuccess"),N};return s?XW(G,r.name+"Success",s,()=>R=!0):G()},onError:N=>{const G=()=>{if(R)throw N;R=!0,this.sendApiInvoke(sn(sn({},T()),{},{success:!1,error:N})),v("onFailure",N.toString())};return s?XW(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),o=this.createBaseInfo(t,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:ie("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:xL?"global":"oversea",areas:ie("AREAS")&&ie("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:T}=r,R=Date.now(),P=sn(sn({},o),{},{eventType:Fi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:ML,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:ie("PROCESS_ID"),appType:ie("APP_TYPE"),success:!0,version:Cl,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:at(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:T,serviceId:ie("PROCESS_ID"),extensionID:ie("PLUGIN_INFO").join(",")||""});var N;this.send({type:kr.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{role:r.role,eventType:Fi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:kr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{eventType:Fi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:kr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:d,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(d&&h?h:s.startTime),T=sn(sn({},o),{},{eventType:Fi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:DL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=T.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:kr.JOIN_GATEWAY,data:T},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),j=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),j=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete T.success,delete T.eventType,delete T.firstSuccess,T.vid=Number(T.vid);const N=Object.assign({},T,P,{eventType:Fi.REJOIN_GATEWAY});this.send({type:kr.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=Date.now(),c=sn(sn({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:kr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{eventType:Fi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:kr.PUBLISH,data:d},!0)}subscribe(t,r,s){const o=this.baseInfoMap.get(t);if(!o)return;const c=o.info,d=Date.now(),h=sn(sn({},c),{},{eventType:Fi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:kr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...jc(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const d=c.info,h=Date.now(),m=sn(sn({},d),{},{eventType:Fi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:kr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=sn(sn(sn({},d),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=sn(sn(sn({},d),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Fi.AB_TEST,lts:c});this.send({type:kr.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Fi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:kr.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn(sn({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Fi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:kr.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,o){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=sn(sn(sn({},d),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{eventType:Fi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:kr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{eventType:Fi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{eventType:Fi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:kr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:kr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now();(function(d,h,m){const y=d[h];if(!y||typeof y!="string")return[d];d[h]="";const v=Ph(JSON.stringify(d));let T=0;const R=[];let P=0;for(let N=0;N<y.length;N++)P+=y.charCodeAt(N)<=127?1:3,P<=m-v||(R[R.length]=mt(mt({},d),{},{[h]:y.substring(T,N)}),T=N,P=y.charCodeAt(N)<=127?1:3);return T!==y.length-1&&(R[R.length]=mt(mt({},d),{},{[h]:y.substring(T)})),R})(sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:kr.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:kr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:kr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const o=s.info,c=Date.now(),d=sn(sn(sn({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:kr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>ie("CUSTOM_REPORT_LIMIT"))throw new xe(Q.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:kr.USER_ANALYTICS,data:sn(sn({sid:t},c),{},{lts:s})}));try{ie("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new xe(Q.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=ie("NOT_REPORT_EVENT");if(t.tag&&at(r)&&at(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:o,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof xe){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:o,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:kr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>ie("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],o=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):o.push(d)}t.push(...o);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),gT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),ie("ENABLE_EVENT_REPORT")&&s.length&&(ie("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{ie("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>ie("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-ie("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){fi.networkState===nc.OFFLINE&&await ut.race([fi.onlineWaiter,os(2*wi.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(h=>{const m=SL(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let P=0;return Object.entries(kr).forEach(N=>{let[G,j]=N;j===R.type&&(P=Lme[G])}),P})(h),T=new DataView(y);T.setUint16(0,m.byteLength,!0),T.setUint8(2,255&v),T.setUint8(3,v>>>8&255),T.setUint8(4,v>>>16&255),d=BW(d,new Uint8Array(y)),d=BW(d,m)}),d},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(ie("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(ie("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await AL(o,{timeout:1e4,data:r(t),headers:sn(sn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:o};fi.networkState===nc.OFFLINE&&await ut.race([fi.onlineWaiter,os(2*wi.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("EVENT_REPORT_DOMAIN"),"&p=").concat(ie("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(ie("EVENT_REPORT_DOMAIN"),":").concat(ie("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(ie("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(ie("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(ie("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(ie("STATS_COLLECTOR_PORT")).concat(d)));try{r?await vme(h,{timeout:1e4,data:c}):await AL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},xme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Wr.TRACER}).onSuccess()}};mz.on("REPORT_LOG_UPLOAD",t=>{t.networkState=fi.networkState,Ct.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Wr.TRACER}).onSuccess("logUploadError")});class Oe extends xe{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Gr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const as={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Mn(){return as}function yz(){return"setSinkId"in HTMLAudioElement.prototype&&(!ie("RESTRICTION_SET_PLAYBACK_DEVICE")||(sf()||PW())&&!yL())}function Ez(){return!as.supportUnifiedPlan||ie("CHROME_FORCE_PLAN_B")&&of()}let cs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Jv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Pn(t,r,s,o,c){return{width:t,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function Eu(t,r,s,o,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function FL(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Mme={"90p":Pn(160,90),"90p_1":Pn(160,90),"120p":Pn(160,120,15,30,65),"120p_1":Pn(160,120,15,30,65),"120p_3":Pn(120,120,15,30,50),"120p_4":Pn(212,120),"180p":Pn(320,180,15,30,140),"180p_1":Pn(320,180,15,30,140),"180p_3":Pn(180,180,15,30,100),"180p_4":Pn(240,180,15,30,120),"240p":Pn(320,240,15,40,200),"240p_1":Pn(320,240,15,40,200),"240p_3":Pn(240,240,15,40,140),"240p_4":Pn(424,240,15,40,220),"360p":Pn(640,360,15,80,400),"360p_1":Pn(640,360,15,80,400),"360p_3":Pn(360,360,15,80,260),"360p_4":Pn(640,360,30,80,600),"360p_6":Pn(360,360,30,80,400),"360p_7":Pn(480,360,15,80,320),"360p_8":Pn(480,360,30,80,490),"360p_9":Pn(640,360,15,80,800),"360p_10":Pn(640,360,24,80,800),"360p_11":Pn(640,360,24,80,1e3),"480p":Pn(640,480,15,100,500),"480p_1":Pn(640,480,15,100,500),"480p_2":Pn(640,480,30,100,1e3),"480p_3":Pn(480,480,15,100,400),"480p_4":Pn(640,480,30,100,750),"480p_6":Pn(480,480,30,100,600),"480p_8":Pn(848,480,15,100,610),"480p_9":Pn(848,480,30,100,930),"480p_10":Pn(640,480,10,100,400),"720p":Pn(1280,720,15,120,1130),"720p_auto":Pn(1280,720,30,900,3e3),"720p_1":Pn(1280,720,15,120,1130),"720p_2":Pn(1280,720,30,120,2e3),"720p_3":Pn(1280,720,30,120,1710),"720p_5":Pn(960,720,15,120,910),"720p_6":Pn(960,720,30,120,1380),"1080p":Pn(1920,1080,15,120,2080),"1080p_1":Pn(1920,1080,15,120,2080),"1080p_2":Pn(1920,1080,30,120,3e3),"1080p_3":Pn(1920,1080,30,120,3150),"1080p_5":Pn(1920,1080,60,120,4780),"1440p":Pn(2560,1440,30,120,4850),"1440p_1":Pn(2560,1440,30,120,4850),"1440p_2":Pn(2560,1440,60,120,7350),"4k":Pn(3840,2160,30,120,8910),"4k_1":Pn(3840,2160,30,120,8910),"4k_3":Pn(3840,2160,60,120,13500)},Ume={"480p":Eu(640,480,5),"480p_1":Eu(640,480,5),"480p_2":Eu(640,480,30),"480p_3":Eu(640,480,15),"720p":Eu(1280,720,5),"720p_auto":Pn(1280,720,30,900,3e3),"720p_1":Eu(1280,720,5),"720p_2":Eu(1280,720,30),"720p_3":Eu(1280,720,15),"1080p":Eu(1920,1080,5),"1080p_1":Eu(1920,1080,5),"1080p_2":Eu(1920,1080,30),"1080p_3":Eu(1920,1080,15)},Vme={"1SL1TL":FL(1,1),"3SL3TL":FL(3,3),"2SL3TL":FL(2,3)};function kh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Mme[t]):t}function BL(t){return typeof t=="string"?Object.assign({},Ume[t]):t}function _P(t){return typeof t=="string"?Object.assign({},Vme[t]):t}const jme={speech_low_quality:Jv(16e3,!1),speech_standard:Jv(32e3,!1,18),music_standard:Jv(48e3,!1),standard_stereo:Jv(48e3,!0,56),high_quality:Jv(48e3,!1,128),high_quality_stereo:Jv(48e3,!0,192)};function yP(t){return typeof t=="string"?Object.assign({},jme[t]):t}const Qv=[];function vz(t){return xi(t,"mediaSource",["screen","window","application"]),!0}let yt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),dr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Zv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Fme=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Bme=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),J_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),eS=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),tS=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),nS=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Fc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const WL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},zL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Sz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Wme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},bz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Io=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Bc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),VT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Q_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),io=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Nh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const GL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let EP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Tz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Nr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Tz(Object(s),!0).forEach(function(o){Pe(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Tz(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Pe(t,r,s){return(r=function(o){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(o);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function On(t,r,s,o,c){var d,h,m={};return Object.keys(o).forEach(function(y){m[y]=o[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ya(d=mm(h=s.slice()).call(h)).call(d,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class wz extends Mr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(J_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||ur(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){at(Qv).call(Qv,o)||Qv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Wm(()=>{var s;Ct.reportApiInvoke(null,{name:Ti.GET_MEDIA_STREAM_TRACK,options:[],tag:Wr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Zv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Qv.indexOf(r);s!==-1&&Qv.splice(s,1)}(this),this.emit(eS.CLOSED),this.removeAllListeners(J_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Zv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(J_.TRANSCEIVER_UPDATED,r,s)}}class rS extends wz{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Os("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(yt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lr(this,yt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eS.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),af(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new xe(Q.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new xe(Q.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ut.resolve([])}}const Cz=window.AudioContext||window.webkitAudioContext;let Wc=null;const tr=new class extends Mr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(cs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(Wc&&await Wc.suspend(),this.emit(cs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function iS(){if(!Wc){if(function(){if(!Cz)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Nr({},ie("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),Wc=new Cz(t),tr.curState=Wc.state,Wc.onstatechange=()=>{tr.prevState=tr.curState,tr.curState=Wc?Wc.state:void 0;const{prevState:r,curState:s}=tr,o=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",y=An().osVersion;(Ro()||_u())&&d&&c&&(x.info("ios".concat(y,"-interruption-start")),tr.emit(cs.IOS_INTERRUPTION_START)),(Ro()||_u())&&(h||m)&&o&&(x.info("ios".concat(y,"-interruption-end")),tr.emit(cs.IOS_INTERRUPTION_END)),r!==s&&tr.emit(cs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=Wc)===null||r===void 0?void 0:r.currentTime;tr.currentTime!==s?(tr.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),tr.currentTimeStuckAt=void 0),tr.currentTime=s):(s!==tr.currentTimeStuckAt&&(Ct.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Wr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),tr.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,d=!1,h=!1;function m(j){r.state==="running"?y(!1):Ro()||_u()?r.state==="suspended"&&(y(!0),j&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),j&&r.resume().then(v,v))}function y(j){if(c!==j){c=j;for(let W=0,Y=s;W<Y.length;W+=1){const J=Y[W];j?window.addEventListener(J,T,{capture:!0,passive:!0}):window.removeEventListener(J,T,{capture:!0,passive:!0})}}}function v(){m(!1)}function T(){m(!0)}function R(j){if(!h)if(o.paused)if(j){let W;P(!1),h=!0;try{W=o.play(),W?W.then(N,N):(o.addEventListener("playing",N),o.addEventListener("abort",N),o.addEventListener("error",N))}catch{N()}}else P(!0);else P(!1)}function P(j){if(d!==j){d=j;for(let W=0,Y=s;W<Y.length;W++){const J=Y[W];j?window.addEventListener(J,G,{capture:!0,passive:!0}):window.removeEventListener(J,G,{capture:!0,passive:!0})}}}function N(){o.removeEventListener("playing",N),o.removeEventListener("abort",N),o.removeEventListener("error",N),h=!1,R(!1)}function G(){R(!0)}if(Ro()){const j=r.createMediaStreamDestination(),W=document.createElement("div");W.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=W.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=j.stream,R(!0)}tr.on(cs.STATE_CHANGE,function(){m(!0)}),m(!1)}(Wc)}(),!Wc)throw new xe(Q.NOT_SUPPORTED,"can not create audio context");return Wc}return Wc}function Z_(t){if(function(){if(HL!==null)return HL;const o=iS(),c=o.createBufferSource(),d=o.createGain(),h=o.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),HL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(o,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),at(h=t._inputNodes).call(h,o)||(o instanceof AudioNode?(t._inputNodes.push(o),r.call(t,o,c,d)):r.call(t,o,c)),t},t.disconnect=(o,c,d)=>{s.call(t),o?cP(t._inputNodes,o):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let HL=null;function $L(t,r){let s=!1;const o=1/r;if(ie("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*o)}else{const c=iS();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+o),t(c.currentTime)};h()}return()=>{s=!0}}class Rz{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=iS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ro()||_u()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=Ya(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Iz extends Mr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=iS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Z_(this.outputNode),this.volumeLevelAnalyser=new Rz}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Fc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const d=o.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Mn().webAudioMediaStreamDest)throw new xe(Q.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&lP(()=>{tr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ro()||_u()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let d=0;d<o.length;d++)o[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await os(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Az extends Iz{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),Z_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),Z_(this.outputNode),this.emit(Fc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new xe(Q.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),Z_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));Z_(y),this.originVolumeLevelAnalyser=new Rz,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=An();s&&h.os===ji.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(tr.on(cs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),Z_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Fc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),tr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));Z_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Pz(t,r,s){const o=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function zme(t,r){const s=await Oz(t.mediaSource),{sourceId:o,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ut((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const T=document.createElement("div");T.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Y);const J=new Error("NotAllowedError");J.name="NotAllowedError",y(J)};let j=h;const W=document.createElement("div");if(h){const J=document.createElement("input");J.setAttribute("type","checkbox");const le=document.createElement("span");J.setAttribute("style","margin-right: 6px;"),le.innerText="Share audio",J.checked=j,J.onchange=()=>{j=J.checked},W.appendChild(J),W.appendChild(le)}N.appendChild(W),N.appendChild(G),T.appendChild(R),T.appendChild(P),T.appendChild(N);const Y=document.createElement("div");Y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Y.appendChild(v),Y.appendChild(T),document.body.appendChild(Y),d.map(J=>{if(J.id){const le=document.createElement("div");le.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _e=J.thumbnail;try{const{width:Ee}=_e.getSize();Ee>1920&&(_e=_e.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}le.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_e.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+J.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",le.onclick=()=>{document.body.removeChild(Y),m({sourceId:J.id,audio:j})},P.appendChild(le)}})})}(s,r);return await Pz(o,t,c)}async function Oz(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=WW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new xe(Q.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new ut((d,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):d(y)})}));try{return await o}catch(d){throw new xe(Q.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const KL=new Os("safari");let kz=!1,Nz=!1;async function zc(t,r){let s=0,o=null;for(;s<2;)try{o=await Gme(t,r,s>0);break}catch(c){if(c instanceof xe)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const d=vP(c.name||c.code||c,c.message);if(d.code===Q.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await os(500);continue}throw x.error("[".concat(r,"] ").concat(d.toString())),d}if(!o)throw new xe(Q.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function Gme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new xe(Q.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const o=Mn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(WW())t.screen.sourceId?sS(c,await Pz(t.screen.sourceId,t.screen,!!t.screenAudio)):sS(c,await zme(t.screen,!!t.screenAudio));else if(sf()&&t.screen.extensionId&&t.screen.mandatory){if(!o.getStreamFromExtension)throw new xe(Q.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new ut((N,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void G(new xe(Q.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(j.streamId)})}catch(j){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),G(new xe(Q.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,sS(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(o.getDisplayMedia){var d;t.screen.mediaSource&&vz(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:G,systemAudio:j,preferCurrentTab:W}=t.screen,Y={selfBrowserSurface:N,surfaceSwitching:G,systemAudio:j,preferCurrentTab:W};!N&&delete Y.selfBrowserSurface,!G&&delete Y.surfaceSwitching,!j&&delete Y.systemAudio,!W&&delete Y.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:Y})),sS(c,await navigator.mediaDevices.getDisplayMedia(Nr({video:P,audio:t.screenAudio},Y)))}else{if(!Fr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new xe(Q.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&vz(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),sS(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=ie("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=wL(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),An();let T,R=null;(vs()||Ro()||oP())&&(R=await KL.lock());try{T=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(kz=!0),y.video&&(Nz=!0),sS(c,T),R&&R(),c}function vP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new xe(Q.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new xe(Q.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new xe(Q.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new xe(Q.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new xe(Q.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new xe(Q.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new xe(Q.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function sS(t,r){const s=t.getVideoTracks()[0],o=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(o&&t.removeTrack(o),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const Gc=new class extends Mr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Q_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",VT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(ie("ENUMERATE_DEVICES_INTERVAL")||(aP()||sP()===ji.HARMONY_OS)&&of())&&this.updateDevicesInfo()},ie("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new xe(Q.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(d||h)){if(KL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await KL.lock())(),x.debug("[device manager] GUM unlock")),kz&&(d=!1,this.isAccessMicrophonePermission=!0),Nz&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(T){const R=vP(T.name||T.code||T,T.message);if(R.code===Q.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(T){const R=vP(T.name||T.code||T,T.message);if(R.code===Q.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(T){const R=vP(T.name||T.code||T,T.message);if(R.code===Q.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const T=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,T}catch(T){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new xe(Q.ENUMERATE_DEVICES_FAILED,T.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new xe(Q.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=VT.INITING;try{await this.updateDevicesInfo(),this.state=VT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=VT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new xe(Q.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==VT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Q_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Q_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Q_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let qL=!1;const Hc=new class extends Mr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function Dz(){if(An(),!qL){const t=r=>{r.preventDefault(),qL=!1,PT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};qL=!0,PT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Hc.onAutoplayFailed?Hc.onAutoplayFailed():Hc.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Hc.emit("autoplay-failed")}}function xz(t,r,s,o){if(!t)return;const c=Ct.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Nr(Nr({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:Hc.onAutoplayFailed||Hc.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});Ct.send({type:kr.AUTOPLAY_FAILED,data:m},!0)}const Hme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Qo=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),d=o.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return o.pause(),void o.play();if(tr.curState==="running")return Hv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),tr.on(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tr.on(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),tr.on(cs.STATE_CHANGE,()=>{Ro()&&tr.prevState==="suspended"&&tr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(o){throw new xe(Q.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(t,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,io.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&xz(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),lP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Dz()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Hme.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(t),d=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new ut(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{PT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function si(){return function(t,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new xe(Q.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=o.apply(this,d);return m instanceof ut?new ut((y,v)=>{m.then(y).catch(v)}):m}),s}}class Lz extends Mr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new xe(Q.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new xe(Q.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Io.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Io.ON_TRACK,void 0)}}class Mz extends Mr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await bs(this,Bc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),lr(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),lr(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new xe(Q.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ut&&(o=await o),r.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class Uz extends Mr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new xe(Q.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new xe(Q.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Io.ON_TRACK,void 0),this.emit(Io.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Io.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Io.ON_NODE,this.inputNode))}}class Vz extends Mr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return bs(this,Bc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),lr(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),lr(this,Bc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Lc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new xe(Q.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ut&&(o=await o),r.push(Nr(Nr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class YL extends Mr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new $me}setVolume(){}createOutputTrack(){throw new xe(Q.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class $me{disconnect(){}connect(){}}function jz(t){return new ut((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=Ro()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Fr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(uP),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function SP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=kh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!UW()&&s.frameRate&&(r.frameRate=s.frameRate),PW()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Fr()&&(r.frameRate={ideal:30,max:30}),r}function Fz(t){const r={};return UW()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,sf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function Bz(t){const r=Fz(t);if(t.encoderConfig){const s=yP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),aP()&&(r.sampleRate=void 0),r}const Kme=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=o,height:m=c}=r;if(!d||!h||!m)return;h=CL(h),m=CL(m),d=CL(d);const{max:y,min:v}=function(N,G,j){const W=200*Math.pow(j/15,.6)*Math.pow(N*G/640/360,.75);return{min:Math.floor(W),max:Math.floor(4*W)}}(h,m,d),{bitrateMax:T,bitrateMin:R}=r||{};T||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(T,", brMin: ").concat(R,"]"));const{maxFramerate:P}=ie("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(d=Math.min(d,P)),{frameRate:d,bitrateMax:T||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},Wz=async(t,r,s)=>await(async(o,c,d)=>{const h=function(v){const T=[];for(let R=0;R<v.length;R+=2)T.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(T)}(ZW(""+c+d)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,o))})(t.buffer,r,s),XL=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ut((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await zz(c);s({buffer:d,width:r.width,height:r.height})}else o(new xe(Q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},zz=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,e9,t9,n9,r9,i9,s9,o9,a9,Ur,c9,l9,u9,d9,h9,p9,Dh,f9,m9,g9,_9,y9,E9,v9,S9,b9,T9,w9,C9,R9,ws;let qr=(Gz=Vt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),Hz=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),$z=si(),Kz=qv("LocalAudioTrack","_enabledMutex"),qz=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),Yz=si(),Xz=qv("LocalAudioTrack","_enabledMutex"),Jz=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),Qz=si(),Zz=si(),e9=si(),t9=Vt({argsMap:t=>[t.getTrackId()]}),n9=si(),r9=Vt({argsMap:t=>[t.getTrackId()]}),i9=si(),s9=Vt({argsMap:t=>[t.getTrackId()]}),o9=Vt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),a9=Vt({argsMap:t=>[t.getTrackId()]}),On((Ur=class extends rS{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Qo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,o){super(t,s),Pe(this,"trackMediaType",nS.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new YL,ie("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),ie("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),vs()&&!Wc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){rr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Qo.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,lr(this,yt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!yz())throw new xe(Q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qo.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await lr(this,yt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(o){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await lr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await lr(this,yt.NEED_MUTE_TRACK,this):await lr(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return Wm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Uc(this,yt.GET_STATS)||Nr({},WL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Fc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Fc.ON_AUDIO_BUFFER),this._source.on(Fc.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Qo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Qo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lr(this,yt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return ut.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new xe(Q.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new xe(Q.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Io.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await lr(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lr(this,yt.NEED_REPLACE_TRACK,this))}),t.on(Io.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Io.ON_TRACK),t.removeAllListeners(Io.ON_NODE)}bindProcessorContextEvents(t){t.on(Bc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Bc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof YL&&(this._trackSource=new Az(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Vz(this._source.context,this.getTrackId(),"local"),r=new Uz(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Fc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Qo.stop(this.getTrackId()),this._source.play()),lr(this,yt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[Gz],Object.getOwnPropertyDescriptor(Ur.prototype,"setVolume"),Ur.prototype),On(Ur.prototype,"setPlaybackDevice",[Hz,$z],Object.getOwnPropertyDescriptor(Ur.prototype,"setPlaybackDevice"),Ur.prototype),On(Ur.prototype,"setEnabled",[Kz,qz,Yz],Object.getOwnPropertyDescriptor(Ur.prototype,"setEnabled"),Ur.prototype),On(Ur.prototype,"setMuted",[Xz,Jz,Qz],Object.getOwnPropertyDescriptor(Ur.prototype,"setMuted"),Ur.prototype),On(Ur.prototype,"getStats",[Zz],Object.getOwnPropertyDescriptor(Ur.prototype,"getStats"),Ur.prototype),On(Ur.prototype,"setAudioFrameCallback",[e9],Object.getOwnPropertyDescriptor(Ur.prototype,"setAudioFrameCallback"),Ur.prototype),On(Ur.prototype,"play",[t9,n9],Object.getOwnPropertyDescriptor(Ur.prototype,"play"),Ur.prototype),On(Ur.prototype,"stop",[r9,i9],Object.getOwnPropertyDescriptor(Ur.prototype,"stop"),Ur.prototype),On(Ur.prototype,"close",[s9],Object.getOwnPropertyDescriptor(Ur.prototype,"close"),Ur.prototype),On(Ur.prototype,"pipe",[o9],Object.getOwnPropertyDescriptor(Ur.prototype,"pipe"),Ur.prototype),On(Ur.prototype,"unpipe",[a9],Object.getOwnPropertyDescriptor(Ur.prototype,"unpipe"),Ur.prototype),Ur),bP=(c9=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),l9=si(),u9=qv("MicrophoneAudioTrack","_enabledMutex"),d9=Vt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),h9=si(),p9=Vt({argsMap:t=>[t.getTrackId()]}),On((Dh=class extends qr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,o){super(t,r.encoderConfig?yP(r.encoderConfig):{},o,ie("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Hv()||_L())&&tr.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Gc.getDeviceById(t),s={};s.audio=Nr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=await zc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await zc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Gc.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),ie("AUTO_RESET_AUDIO_ROUTE")&&(Ro()||_u())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await lr(this,yt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Nr({},this._constraints),d=Gc.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await zc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await lr(this,yt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Hv()||_L())&&tr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ro()||_u())&&this._enabled&&!this._isClosed&&tr.duringInterruption){const t=async()=>{tr.off(cs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tr.on(cs.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eS.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=Gc.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await zc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Bc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Bc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[c9,l9],Object.getOwnPropertyDescriptor(Dh.prototype,"setDevice"),Dh.prototype),On(Dh.prototype,"setEnabled",[u9,d9,h9],Object.getOwnPropertyDescriptor(Dh.prototype,"setEnabled"),Dh.prototype),On(Dh.prototype,"close",[p9],Object.getOwnPropertyDescriptor(Dh.prototype,"close"),Dh.prototype),Dh),qme=(f9=Vt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),m9=si(),g9=Vt({argsMap:t=>[t.getTrackId()]}),_9=si(),y9=Vt({argsMap:t=>[t.getTrackId()]}),E9=si(),v9=Vt({argsMap:t=>[t.getTrackId()]}),S9=si(),b9=Vt({argsMap:t=>[t.getTrackId()]}),T9=si(),w9=Vt({argsMap:t=>[t.getTrackId()]}),C9=Vt({argsMap:t=>[t.getTrackId()]}),R9=si(),On((ws=class extends qr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,o){super(r.createOutputTrack(),s,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Fc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(eS.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){rr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[f9,m9],Object.getOwnPropertyDescriptor(ws.prototype,"startProcessAudioBuffer"),ws.prototype),On(ws.prototype,"pauseProcessAudioBuffer",[g9,_9],Object.getOwnPropertyDescriptor(ws.prototype,"pauseProcessAudioBuffer"),ws.prototype),On(ws.prototype,"seekAudioBuffer",[y9,E9],Object.getOwnPropertyDescriptor(ws.prototype,"seekAudioBuffer"),ws.prototype),On(ws.prototype,"resumeProcessAudioBuffer",[v9,S9],Object.getOwnPropertyDescriptor(ws.prototype,"resumeProcessAudioBuffer"),ws.prototype),On(ws.prototype,"stopProcessAudioBuffer",[b9,T9],Object.getOwnPropertyDescriptor(ws.prototype,"stopProcessAudioBuffer"),ws.prototype),On(ws.prototype,"close",[w9],Object.getOwnPropertyDescriptor(ws.prototype,"close"),ws.prototype),On(ws.prototype,"setAudioBufferPlaybackSpeed",[C9,R9],Object.getOwnPropertyDescriptor(ws.prototype,"setAudioBufferPlaybackSpeed"),ws.prototype),ws);class Oi extends qr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=iS().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,ur(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}cP(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Oi?s.emit(J_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Yme extends Iz{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Fc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const I9=new Map;class JL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",Nh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",io.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&tr.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(AW())),LW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=io.PLAYING;break;case"loadeddata":if(this.videoState=Nh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=io.CANPLAY;break;case"stalled":this.videoElementStatus=io.STALLED;break;case"suspend":this.videoElementStatus=io.SUSPEND;break;case"pause":this.videoElementStatus=io.PAUSED,Ro()||_u()||vs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=io.WAITING;break;case"abort":this.videoElementStatus=io.ABORT;break;case"ended":this.videoElementStatus=io.ENDED;break;case"emptied":this.videoElementStatus=io.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=io.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,lf.lastVisibleTime<lf.lastHiddenTime||d<lf.lastHiddenTime||d<lf.lastVisibleTime)return;for(c>ie("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(AW())),LW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),tr.on(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tr.on(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&xz(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=An();if((o.name==="Safari"&&Number(o.version)===15||Hv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ut((d,h)=>{o.toBlob(async m=>{if(o.remove(),m){const y=await zz(m);d({buffer:y,width:o.width,height:o.height})}else h(new xe(Q.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await XL(r)}destroy(){this.renderStats=void 0,tr.off(cs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),tr.off(cs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Nh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=io.INIT,!this.videoElementCheckInterval&&(A9.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)||(this.videoElementStatus=io.DESTROYED)},1e3),ie("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,ie("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Nh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Nh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,T)=>{if(this.videoElementStatus===io.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=T.mediaTime):this.renderStats={lastTs:T.mediaTime,curTs:T.mediaTime,lastRenderNum:0,renderNum:0},d){const N=T.presentationTime-d.presentationTime;this.videoState===Nh.VideoStateStarting&&(this.videoState=Nh.VideoStateDecoding),this.videoState===Nh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,ie("VIDEO_FREEZE_DURATION"))),N<ie("VIDEO_FREEZE_DURATION")&&this.videoState===Nh.VideoStateFrozen&&(this.videoState=Nh.VideoStateDecoding),N>ie("VIDEO_FREEZE_DURATION")&&lf.lastVisibleTime>=lf.lastHiddenTime&&d.timestamp>lf.lastVisibleTime&&d.timestamp>lf.lastHiddenTime&&(this.renderFreezeAccTime+=N)}d=Nr(Nr({},T),{},{timestamp:v})}var R,P;ie("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),aP()&&!ie("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=An();o.name==="Safari"&&Number(o.version)===15||Hv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{x.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){A9.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=io.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,PT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};PT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),Dz()}}const A9=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class P9 extends JL{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await XL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",ie("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var O9,k9,N9,D9,x9,L9,M9,U9,V9,j9,F9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,wn,eG,tG,nG,rG,iG,sG,oG,aG,$c;let Sr=(O9=Vt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),k9=si(),N9=Vt({argsMap:t=>[t.getTrackId()]}),D9=qv("LocalVideoTrack","_enabledMutex"),x9=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),L9=si(),M9=qv("LocalVideoTrack","_enabledMutex"),U9=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),V9=si(),j9=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),F9=si(),B9=si(),W9=Vt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),z9=si(),G9=si(),H9=si(),$9=si(),K9=si(),q9=si(),Y9=si(),X9=Vt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),J9=Vt({argsMap:t=>[t.getTrackId()]}),Q9=Vt({argsMap:t=>[t.getTrackId()]}),Z9=Vt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),wn=class Lae extends rS{get videoHeight(){if(vs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(vs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==io.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,d,h){if(super(r,d),Pe(this,"trackMediaType",nS.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),vs()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(dr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(fL(Bn.CHROME,115)&&sP().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&Mn().supportWebRTCInsertableStream){const T=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,N,G=Date.now();const j=()=>{W&&(clearInterval(W),W=void 0),P&&(P.close(),P=void 0),y.stop(),N=void 0,R.removeEventListener("ended",j)};let W=window.setInterval(()=>{if(N&&P&&Date.now()-G>1e3)try{R.readyState==="live"?N.enqueue(P.clone()):j()}catch{j()}},1e3);const Y=new TransformStream({transform:(J,le)=>{R.readyState==="live"?(N=le,G=Date.now(),P===void 0?(P=J,le.enqueue(J.clone())):(le.enqueue(P),P=J)):J.close()}});return R.addEventListener("ended",j),T.readable.pipeThrough(Y).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(dr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Mz(this.getTrackId(),"local"),this._processorDestination=new Lz(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Nr(Nr(Nr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new JL(o):this._player=new P9(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(eS.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},ie("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await lr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await lr(this,yt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await lr(this,yt.NEED_MUTE_TRACK,this):await lr(this,yt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new xe(Q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=kh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=SP({encoderConfig:r});(vs()||Ro()||_u())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const d=new xe(Q.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await lr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return Wm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Uc(this,yt.GET_STATS)||Nr({},zL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await XL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(Q.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await lr(this,yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(Q.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){jz(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(uP)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new xe(Q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=kh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await lr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=function(y,v,T,R,P){const N=ie("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const W=Math.floor(200*Math.pow(T/15,.6)*Math.pow(y*v/640/360,.75));P=N==="STANDARD_BITRATE"?4*W:2*W,R=(G=R)!==null&&G!==void 0?G:W}else{var j;R=(j=R)!==null&&j!==void 0?j:Math.floor(P/10)}return{min:R,max:P}}(r,s,o,d,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=FW.checkOneElementVisible(d),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=Ct.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(o){throw new xe(Q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new xe(Q.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Nr(Nr({},o),kh(r))),o=K_(o);const c=ur(8,"track-video-cloned-"),d=new Lae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,K_(this._scalabilityMode),this._optimizationMode,c,K_(this._hints));return r&&o&&d.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new xe(Q.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new xe(Q.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Wm(()=>{Ct.reportApiInvoke(null,{name:Ti.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Wr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!ie("ENABLE_VIDEO_SEI")||!ie("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new xe(Q.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Io.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await lr(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await lr(this,yt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Io.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Bc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Bc.REQUEST_CONSTRAINTS)}},On(wn.prototype,"play",[O9,k9],Object.getOwnPropertyDescriptor(wn.prototype,"play"),wn.prototype),On(wn.prototype,"stop",[N9],Object.getOwnPropertyDescriptor(wn.prototype,"stop"),wn.prototype),On(wn.prototype,"setEnabled",[D9,x9,L9],Object.getOwnPropertyDescriptor(wn.prototype,"setEnabled"),wn.prototype),On(wn.prototype,"setMuted",[M9,U9,V9],Object.getOwnPropertyDescriptor(wn.prototype,"setMuted"),wn.prototype),On(wn.prototype,"setEncoderConfiguration",[j9,F9],Object.getOwnPropertyDescriptor(wn.prototype,"setEncoderConfiguration"),wn.prototype),On(wn.prototype,"getStats",[B9],Object.getOwnPropertyDescriptor(wn.prototype,"getStats"),wn.prototype),On(wn.prototype,"setBeautyEffect",[W9,z9],Object.getOwnPropertyDescriptor(wn.prototype,"setBeautyEffect"),wn.prototype),On(wn.prototype,"getCurrentFrameData",[G9],Object.getOwnPropertyDescriptor(wn.prototype,"getCurrentFrameData"),wn.prototype),On(wn.prototype,"getCurrentFrameImage",[H9],Object.getOwnPropertyDescriptor(wn.prototype,"getCurrentFrameImage"),wn.prototype),On(wn.prototype,"setBitrateLimit",[$9],Object.getOwnPropertyDescriptor(wn.prototype,"setBitrateLimit"),wn.prototype),On(wn.prototype,"setOptimizationMode",[K9],Object.getOwnPropertyDescriptor(wn.prototype,"setOptimizationMode"),wn.prototype),On(wn.prototype,"setScalabiltyMode",[q9],Object.getOwnPropertyDescriptor(wn.prototype,"setScalabiltyMode"),wn.prototype),On(wn.prototype,"updateMediaStreamTrackResolution",[Y9],Object.getOwnPropertyDescriptor(wn.prototype,"updateMediaStreamTrackResolution"),wn.prototype),On(wn.prototype,"pipe",[X9],Object.getOwnPropertyDescriptor(wn.prototype,"pipe"),wn.prototype),On(wn.prototype,"unpipe",[J9],Object.getOwnPropertyDescriptor(wn.prototype,"unpipe"),wn.prototype),On(wn.prototype,"close",[Q9],Object.getOwnPropertyDescriptor(wn.prototype,"close"),wn.prototype),On(wn.prototype,"replaceTrack",[Z9],Object.getOwnPropertyDescriptor(wn.prototype,"replaceTrack"),wn.prototype),wn),QL=(eG=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),tG=si(),nG=qv("CameraVideoTrack","_enabledMutex"),rG=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),iG=si(),sG=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),oG=si(),aG=Vt({argsMap:t=>[t.getTrackId()]}),$c=class Mae extends Sr{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,d,h){super(r,kh(s.encoderConfig),c,d,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Hv()||_L())&&!function(){const m=An();if(m.os!==ji.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&MW()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=kh(this._config.encoderConfig),tr.on(cs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tr.on(cs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await Gc.getDeviceById(r),o={};o.video=Nr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await zc(o,this.getTrackId())}catch(d){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await zc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Gc.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Nr(Nr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await zc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await zc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Nr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await zc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await lr(this,yt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await lr(this,yt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new xe(Q.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=kh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=zr(this._config);o.encoderConfig=r;const c=SP(o);(vs()||Ro()||_u())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new xe(Q.UNEXPECTED_ERROR,d.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(dr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await lr(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ro()||_u())&&this._enabled&&!this._isClosed&&tr.duringInterruption){const r=async()=>{tr.off(cs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};tr.on(cs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(eS.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=Gc.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await zc({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),tr.off(cs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),tr.off(cs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Nr(Nr({},o),kh(r))),o=K_(o);const c=ur(8,"track-cam-cloned-"),d=new Mae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,K_(Nr(Nr({},this._config),{},{encoderConfig:o})),K_(this._constraints),K_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&d.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(Bc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(Bc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},On($c.prototype,"setDevice",[eG,tG],Object.getOwnPropertyDescriptor($c.prototype,"setDevice"),$c.prototype),On($c.prototype,"setEnabled",[nG,rG,iG],Object.getOwnPropertyDescriptor($c.prototype,"setEnabled"),$c.prototype),On($c.prototype,"setEncoderConfiguration",[sG,oG],Object.getOwnPropertyDescriptor($c.prototype,"setEncoderConfiguration"),$c.prototype),On($c.prototype,"close",[aG],Object.getOwnPropertyDescriptor($c.prototype,"close"),$c.prototype),$c);function ZL(t,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Nr(Nr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var cG,lG,uG,dG,Il,hG,pG,fG,mG,gG,_G,so;class yG extends wz{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(ur(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let oS=(cG=Vt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),lG=Vt({argsMap:t=>[t.getTrackId()]}),uG=Vt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),dG=Vt({argsMap:t=>[t.getTrackId()]}),On((Il=class extends yG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==io.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",nS.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Mz(this.getTrackId(),"remote"),this.processorDestination=new Lz(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Uc(this,yt.GET_STATS)||Nr({},bz)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Nr(Nr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new JL(s):this._player=new P9(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(tS.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(tS.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(tS.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},ie("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){jz(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(uP)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=FW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=Ct.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new xe(Q.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new xe(Q.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Io.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Io.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(J_.SEI_RECEIVED,t)}}).prototype,"play",[cG],Object.getOwnPropertyDescriptor(Il.prototype,"play"),Il.prototype),On(Il.prototype,"stop",[lG],Object.getOwnPropertyDescriptor(Il.prototype,"stop"),Il.prototype),On(Il.prototype,"pipe",[uG],Object.getOwnPropertyDescriptor(Il.prototype,"pipe"),Il.prototype),On(Il.prototype,"unpipe",[dG],Object.getOwnPropertyDescriptor(Il.prototype,"unpipe"),Il.prototype),Il),aS=(hG=Vt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),pG=Vt({argsMap:(t,r)=>[t.getTrackId(),r]}),fG=Vt({argsMap:t=>[t.getTrackId()]}),mG=Vt({argsMap:t=>[t.getTrackId()]}),gG=Vt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),_G=Vt({argsMap:t=>[t.getTrackId()]}),On((so=class extends yG{get isPlaying(){return this._useAudioElement?Qo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,o){super(t,r,s,o),Pe(this,"trackMediaType",nS.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),ie("DISABLE_WEBAUDIO")?(this._source=new YL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Az(t,!0),ie("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Fc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(tS.FIRST_FRAME_DECODED)}),this.processorContext=new Vz(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Uz(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Fc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Fc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Fc.ON_AUDIO_BUFFER),this._source.on(Fc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?Qo.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!yz())throw new xe(Q.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Qo.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Uc(this,yt.GET_STATS)||Nr({},Sz)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),Qo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Qo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Qo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new xe(Q.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new xe(Q.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new xe(Q.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Io.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Io.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Io.ON_TRACK),this.processorDestination.removeAllListeners(Io.ON_NODE)}}).prototype,"setVolume",[hG],Object.getOwnPropertyDescriptor(so.prototype,"setVolume"),so.prototype),On(so.prototype,"setPlaybackDevice",[pG],Object.getOwnPropertyDescriptor(so.prototype,"setPlaybackDevice"),so.prototype),On(so.prototype,"play",[fG],Object.getOwnPropertyDescriptor(so.prototype,"play"),so.prototype),On(so.prototype,"stop",[mG],Object.getOwnPropertyDescriptor(so.prototype,"stop"),so.prototype),On(so.prototype,"pipe",[gG],Object.getOwnPropertyDescriptor(so.prototype,"pipe"),so.prototype),On(so.prototype,"unpipe",[_G],Object.getOwnPropertyDescriptor(so.prototype,"unpipe"),so.prototype),so);const lf=new class extends Mr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class EG extends Mr{constructor(r,s){super(),Pe(this,"trackMediaType",nS.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return ie("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ut((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new xe(Q.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new xe(Q.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new xe(Q.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[EP.OPEN,EP.CLOSE,EP.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class Xme extends EG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(ie("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(EP.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Jme extends EG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function TP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>TA.revokeObjectURL(t),0),new Worker(TA.createObjectURL(t))}const vG=71,e2=1,t2=2,n2=1,SG=2;var uf=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(uf||{});function bG(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==vG)return;const o=t.getUint16(1),c=e2+t2+o,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:d};let m=e2+t2;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+n2),T=n2+SG;if(y===uf.AUDIO_LEVEL){let R=t.getUint8(m+T);for(let P=1;P<v;P++)R=R<<8|t.getUint8(m+T+P);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===uf.METADATA||y===uf.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let P=0;P<v;P++)R[P]=t.getUint8(m+T+P);h.tlv.push({tag:y,length:v,value:R})}m+=T+v}return h}const wP=new Map,CP=127,ey=1e-10,r2=139/13,RP=new Map;function i2(t,r,s){const o="".concat(t,"-").concat(r,"-").concat(s);let c=0;return RP.has(o)?c=RP.get(o):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let T=h,R=1;T>m;T--,R++)v=v*T/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,RP.set(o,c)),c<ey&&(c=ey),c}function TG(t,r,s){const o=r.length,c=t.length/o;let d=!1;for(let h=0,m=0;h<o;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,d=!0)}return d}window.cache=RP;let Qme=0;class wG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",ey),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",ey),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",ey),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Qme++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+r2;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<o&&(h=0);const m=Math.floor(h/r2);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return TG(this.mediums,this.longs,4)}computeMediums(){return TG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=i2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=i2(this.longs[0],10,47),this.longSpeechActivityScore>ey&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=i2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(mm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>CP&&(o=CP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+r2?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>CP&&(s=CP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Zme{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class s2{constructor(r,s,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class ege extends Mr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const d=c.levelChanged(s,o);return this.updateLoudestList(c,d,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new wG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new s2(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new s2(c,0,r.energyScore);const d=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new s2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Zme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=Lc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const T=this.speakers.entries().next();T.value&&(d=T.value[0],m=T.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const T of this.speakers.entries()){const[R,P]=T;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let W=0;W<y.length;++W){const Y=m==null?ey:m.getSpeechActivityScore(W);y[W]=Math.log(P.getSpeechActivityScore(W)/Y)}const N=y[0],G=y[1],j=y[2];N>3&&G>2&&j>0&&G>v&&(v=G,d=R)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of Lc(o=this.speakers).call(o)){var o;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const cS=new Map;let Id=null,IP=null;const CG=3;let ty=[];const Ad=new Map,AP=new Map;class tge{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(Ad.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],d=[];return Array.from(Lc(Ad).call(Ad)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(Lc(Ad).call(Ad)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(Lc(Ad).call(Ad)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let PP;function RG(t){const r=Ad.get(t);r&&(Ad.delete(t),r.clearTimer())}const OP=new Map,nge=new Map;function rge(t,r,s){let o=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&o[d]===0&&o[d+1]===0&&o[d+2]===3&&(o[d+3]===0||o[d+3]===1||o[d+3]===2||o[d+3]===3)?(c.push(o[d],o[d+1],o[d+3]),d+=4):(c.push(o[d]),d++);return new Uint8Array(c)}const kP=new Map,jT=new Map;(function(){const t=An();as.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),as.getStreamFromExtension=t.name===Bn.CHROME&&Number(t.version)>34,as.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),as.supportMinBitrate=t.name===Bn.CHROME||t.name===Bn.EDGE,as.supportSetRtpSenderParameters=function(){const r=An();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!of()||!(!vs()&&!oP())||r.name===Bn.FIREFOX&&Number(r.version)>=64)}(),t.name===Bn.SAFARI&&(Number(t.version)>=14?as.supportDualStream=!0:as.supportDualStream=!1),as.webAudioMediaStreamDest=function(){const r=An();return!(r.name===Bn.SAFARI&&Number(r.version)<12)}(),as.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",as.supportWebGL=typeof WebGLRenderingContext<"u",as.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,of()||(as.webAudioWithAEC=!0),as.supportShareAudio=function(){const r=An();return(r.os===ji.WIN_10||r.os===ji.WIN_81||r.os===ji.WIN_7||r.os===ji.LINUX||r.os===ji.MAC_OS||r.os===ji.CHROMIUM_OS)&&r.name===Bn.CHROME&&Number(r.version)>=74}(),as.supportDataChannel=!!(AT(76)||function(r){const s=An();return!(s.name!==Bn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||kW(14)),as.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Fr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),as.supportWebRTCEncodedTransform=function(){const r=An();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),as.supportWebRTCInsertableStream=function(){const r=An();return(r.name===Bn.CHROME||r.name===Bn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),as.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,as.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,lP(()=>{as.supportDualStreamEncoding=function(){const r=An();return!!ie("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&ie("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",as)})})();const ige=["CHINA","GLOBAL"],IG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],ny=[],lS=[];function ry(t,r){return!!r&&ny.some(s=>s.uid===t&&s.channelName===r)}function o2(){return lS.length>0}var sge=Y6.forEach,AG=Dp("forEach")?[].forEach:function(t){return sge(this,t,arguments.length>1?arguments[1]:void 0)};Fn({target:"Array",proto:!0,forced:[].forEach!=AG},{forEach:AG});var oge=qa("Array").forEach,age=wc,cge=vi,lge=k,uge=oge,a2=Array.prototype,dge={DOMTokenList:!0,NodeList:!0},hge=function(t){var r=t.forEach;return t===a2||lge(a2,t)&&r===a2.forEach||cge(dge,age(t))?uge:r},pge=l(hge),fge=xo,PG=Ic;Fn({target:"Object",stat:!0,forced:u(function(){PG(1)})},{keys:function(t){return PG(fge(t))}});var OG=l(vt.Object.keys),mge=l(EE),gge=l(SE),_ge=Fn,kG=a_,yge=O_,Ege=_t,NG=fe,vge=hi,Sge=we,bge=dA,Tge=_r,wge=gs,Cge=j6("slice"),Rge=Tge("species"),c2=Array,Ige=Math.max;_ge({target:"Array",proto:!0,forced:!Cge},{slice:function(t,r){var s,o,c,d=Sge(this),h=vge(d),m=NG(t,h),y=NG(r===void 0?h:r,h);if(kG(d)&&(s=d.constructor,(yge(s)&&(s===c2||kG(s.prototype))||Ege(s)&&(s=s[Rge])===null)&&(s=void 0),s===c2||s===void 0))return wge(d,m,y);for(o=new(s===void 0?c2:s)(Ige(y-m,0)),c=0;m<y;m++,c++)m in d&&bge(o,c,d[m]);return o.length=c,o}});var Age=qa("Array").slice,Pge=k,Oge=Age,l2=Array.prototype,kge=function(t){var r=t.slice;return t===l2||Pge(l2,t)&&r===l2.slice?Oge:r},Nge=l(kge);function Et(t,r,s,o,c){var d,h,m,y={};return pge(d=OG(o)).call(d,function(v){y[v]=o[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=mge(h=gge(m=Nge(s).call(s)).call(m)).call(h,function(v,T){return T(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(L6(t,r,y),y=null),y}let NP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),u2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),vu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ao=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Mt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),fr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),zt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Wt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),FT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),En=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Po=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Xt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function DP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Oe(Q.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function xP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||jW(t,1,255)))throw new Oe(Q.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let df=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const Dge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},d2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function h2(t,r){ss(t.url,"".concat(r,".url"),1,1e3,!1),Br(t.x)||rr(t.x,"".concat(r,".x"),0,1e4),Br(t.y)||rr(t.y,"".concat(r,".y"),0,1e4),Br(t.width)||rr(t.width,"".concat(r,".width"),0,1e4),Br(t.height)||rr(t.height,"".concat(r,".height"),0,1e4),Br(t.zOrder)||rr(t.zOrder,"".concat(r,".zOrder"),0,255),Br(t.alpha)||rr(t.alpha,"".concat(r,".alpha"),0,1,!1)}const xge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Hm=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),p2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),ki=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function DG(t){if(!t.channelName)throw new Oe(Q.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(Q.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ss(t.token,"info.token",1,2047),xP(t.uid),DP(t.channelName),!0}let Oo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),hf=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ia=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),uS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),qn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),es=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),LP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Bi=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Wn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const xG=[Wn.AFRICA,Wn.ASIA,Wn.CHINA,Wn.EUROPE,Wn.GLOBAL,Wn.INDIA,Wn.JAPAN,Wn.NORTH_AMERICA,Wn.OCEANIA,Wn.OVERSEA,Wn.SOUTH_AMERICA];let ks=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const MP={CHINA:{},ASIA:{CODE:ks.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ks.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ks.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ks.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ks.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ks.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ks.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ks.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ks.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ks.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ks.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ks.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ks.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};xL&&(MP.CHINA={CODE:ks.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let BT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function LG(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class MG extends Mr{constructor(r,s){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class UG extends MG{constructor(r,s){super(r,s),K(this,"establishPromise",void 0)}}let gt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ns=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),pf=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const VG=["disconnected","failed"];let He=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Kn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Nt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Su=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),bu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ts=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),jG=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),xh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Al=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Pd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),dS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),oi=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),hS=function(t){return t.ABORT="abort",t}({}),$m=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Lge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Mge={[NP.ACCESS_POINT]:{[Ao.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ao.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ao.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ao.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ao.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ao.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ao.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[NP.UNILBS]:{[vu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[vu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[vu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[vu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[vu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[vu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[vu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[vu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[vu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[vu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[vu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[vu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[NP.STRING_UID_ALLOCATOR]:{[u2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[u2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[u2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function pS(t){const r=Mge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===NP.ACCESS_POINT){const o=t%1e4;if(o.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Uge={[Mt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Mt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Mt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Mt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Mt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Mt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Mt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Mt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Mt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Mt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Mt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Mt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Mt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Mt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Mt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Mt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Mt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Mt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Mt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Mt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Mt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Mt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Mt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Mt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Mt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Mt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Mt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Mt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Mt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Mt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Mt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Mt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Mt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Mt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Mt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Mt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Mt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Mt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Mt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Mt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Mt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Mt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Mt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Mt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Mt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Mt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Mt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Mt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Mt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Mt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Mt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Mt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Mt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Mt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Mt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Mt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function WT(t){return Uge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function FG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function f2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?FG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):FG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function BG(t,r){if(typeof t=="string")return t;const{proxy:s,host:o,port:c}=t;if(r){const d=ie("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Vge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,jge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Fge=/wss:\/\/(.+):([0-9]+)\/?/,Bge=/wss:\/\/(.[^\/]+)\/?/;let Wge=0;class zge{constructor(r,s){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++Wge,this.try443PortDuration=ie("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=ie("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find(P=>{var N;return at(N=r.host).call(N,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(BG(f2(f2({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=f2({},r);if(s&&m){const N=c.find(G=>G!==m);N&&(P.host=P.host.replace(m,N))}y.push(BG(P,s))}try{y.forEach(P=>{const N=new WebSocket(P);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(N=>N.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Oe(Q.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const v=IT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(N=>{N!==P&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))}),this.websockets.length=0,v.resolve(P)},P.onclose=N=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(P.readyState));const G=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),v.reject({code:N.code,reason:LP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=N=>this.logger("".concat(P.url," onmessage: ").concat(N.data))}),this.websockets.push(...h);const T=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(v.isResolved)return T();An().os===ji.MAC_OS&&Fr()&&T(),this.createWebSocket(r,!0,!0).then(P=>{v.resolve(P)}).catch(P=>{this.isNormalPortFailed&&v.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,T()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,T()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(d){let h,m,y;return[,h,m,y]=d.match(Vge)||[],h||([,m,y]=d.match(jge)||[]),m&&y||([,m,y]=d.match(Fge)||[]),m&&y||([,m]=d.match(Bge)||[]),m||x.warning("un-destructible url: ",d),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function WG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class zG extends Mr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;at(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Xt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Xt.CONNECTED):this._state==="closed"?this.emit(Xt.CLOSED):this._state==="failed"&&this.emit(Xt.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var N=arguments[P]!=null?arguments[P]:{};P%2?WG(Object(N),!0).forEach(function(G){K(R,G,N[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(N)):WG(Object(N)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(N,G))})}return R}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Os("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),T=Math.max(1.2,Math.floor(8*y)/10);nc.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=T),fi.on($v.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===nc.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=T):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=IT(),d=this.urls[this.currentURLIndex];ie("ENABLE_PREALLOC_PC")&&this.emit(jG.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(c.resolve).catch(c.reject),this.once(Xt.CLOSED,()=>{c.reject(new xe(Q.WS_DISCONNECT))}),this.once(Xt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new xe(Q.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new xe(Q.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=IT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=T=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),T),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},d=async T=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(T.code,", reason: ").concat(T.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new xe(Q.WS_DISCONNECT,"websocket close: ".concat(T.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=T.reason,this.state="reconnecting");const P=Uc(this,Xt.WILL_RECONNECT,this.reconnectMode,T.reason)||this.reconnectMode,N=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return o.reject(new xe(Q.WS_DISCONNECT,"websocket reconnect failed: ".concat(T.code))),this.close(!0);o.resolve()}},h=T=>{this.emit(Xt.ON_MESSAGE,T)},m=T=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(T))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),ie("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=ie("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const T=await this.chooseBestWebsocketConnection(r);this.websocket=T,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(T){const R=this.state==="closed",P=T instanceof xe,N=P&&T.code===Q.WS_ABORT,G=P&&T.code===Q.WS_ERR,j=P?T.message:T&&(T.reason||T.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[T]},y),R||G?(o.reject(R?new xe(Q.WS_DISCONNECT,"websocket is closed: ".concat(j)):new xe(Q.WS_ERR,"init websocket failed: ".concat(j))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(j))):d&&d(T)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||fi.isOnline||!fi.onlineWaiter||(this.onlineReconnectListener=fi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=RL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ut.race([os(h),this.onlineReconnectListener||new ut(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Xt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await bs(this,Xt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&at(m).call(m,"dynamic key expired")?(this.emit(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class m2 extends zG{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=IT(),c=function(h,m){return new zge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new xe(Q.WS_ABORT,"choose best websocket aborted"))};const d=ie("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class zT extends zG{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new ut((o,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new xe(Q.WS_ABORT,"choose best websocket aborted"))};const m=ie("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),T=m.find(G=>v!==-1?at(r).call(r,G,v):at(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",T,", domains: ",m);let R=!this.tryDoubleDomain||!T;if(!R&&T){var P;const G=Date.now();try{m.forEach(j=>{const W=v===-1?r.replace(T,j):r.substr(0,v)+r.substr(v).replace(T,j),Y=new WebSocket(W);Y.binaryType="arraybuffer",h.push(Y),x.debug("[choose-best-ws] ws is connecting:",Y.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(W=>W.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(d)return;const W=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(W,"ms")),h.filter(Y=>Y!==j).forEach(Y=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Y.url)),Y.close()}),d=!0,o(j)},j.onclose=W=>{y=W,!d&&(h.find(Y=>!(Y.readyState===WebSocket.CLOSED||Y.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),d=!0,c(y)))},j.onmessage=W=>{x.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(W.data))}}),os(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(R){var N;let G;x.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(j){const W=new xe(Q.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return x.error("[".concat(this.name,"]").concat(W)),void c(W)}G.onopen=()=>{o(G)},G.onclose=j=>{c(j)},G.onmessage=j=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(j.data))},os(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class Gge extends Mr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===fr.CONNECTED?this.emit(zt.WS_CONNECTED):r===fr.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):r===fr.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",fr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new tz(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close($n.UID_BANNED);break;case 15:this.close($n.IP_BANNED);break;case 16:this.close($n.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close($n.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close($n.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close($n.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close($n.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($n.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close($n.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new m2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,ie("JOIN_GATEWAY_USE_DUAL_DOMAIN"),ie("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",Ss.OFFLINE)})}async request(r,s,o,c){const d=ur(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new ut((G,j)=>{if(this.connectionState===fr.CONNECTED)return G();const W=()=>{this.off(zt.WS_CLOSED,Y),G()},Y=()=>{this.off(zt.WS_CONNECTED,W),j(new Oe(Q.WS_ABORT))};this.once(zt.WS_CONNECTED,W),this.once(zt.WS_CLOSED,Y),r!==Wt.PUBLISH&&r!==Wt.PUBLISH_DATASTREAM&&r!==Wt.SUBSCRIBE&&r!==Wt.SUBSCRIBE_DATASTREAM&&r!==Wt.UNSUBSCRIBE&&r!==Wt.UNSUBSCRIBE_DATASTREAM&&r!==Wt.UNPUBLISH&&r!==Wt.UNPUBLISH_DATASTREAM&&r!==Wt.CONTROL&&r!==Wt.RESTART_ICE||this.once(zt.DISCONNECT_P2P,()=>{j(new Oe(Q.DISCONNECT_P2P))}),r!==Wt.PUBLISH&&r!==Wt.RESTART_ICE||this.once(zt.ABORT_P2P_EXECUTION,()=>{j(new Oe(Q.DISCONNECT_P2P))})});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||r===Wt.JOIN||r===Wt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new ut((G,j)=>{let W=!1;const Y=(le,_e)=>{W=!0,G({isSuccess:le==="success",message:_e||{}}),this.off(zt.WS_CLOSED,J),this.off(zt.WS_RECONNECTING,J),this.emit(zt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Y);const J=()=>{j(new Oe(Q.WS_ABORT,"type: ".concat(r))),this.off(zt.WS_CLOSED,J),this.off(zt.WS_RECONNECTING,J),this.off("res-@".concat(d),Y)};this.once(zt.WS_CLOSED,J),this.once(zt.WS_RECONNECTING,J),os(ie("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(zt.REQUEST_TIMEOUT,r,s))})});let T=null;try{T=await v}catch(G){if(this.connectionState===fr.CLOSED||r===Wt.LEAVE)throw new Oe(Q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Wt.JOIN||r===Wt.REJOIN?null:(await y(),await this.request(r,s))}if(T.isSuccess)return T.message;const R=Number(T.message.error_code||T.message.code),P=WT(R),N=new Oe(Q.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(T.message.error_str),{code:R,data:T.message,desc:P.desc});return P.action==="success"?T.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Wt.JOIN||r===Wt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ss.MULTI_IP)):this.reconnect(P.action,Ss.SERVER_ERROR),r===Wt.JOIN||r===Wt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ut(o=>{const c=d=>{(!s||s(d))&&(this.off(r,c),o(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(FT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const d=ie("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},ie("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ut((s,o)=>{this.once(zt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(zt.WS_CLOSED,c=>o(this.initError||new Oe(Q.WS_ABORT,c))),this.connectionState=fr.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||$n.LEAVE,this.connectionState=fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const r=await bs(this,zt.REQUEST_JOIN_INFO),s=await this.request(Wt.JOIN,r);if(!s)return this.emit(zt.REPORT_JOIN_GATEWAY,LP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(Q.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=DT(this,zt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Wt.REJOIN,r);return!!s&&(this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(En.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(En.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(En.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(En.MUTE_AUDIO,{uid:o.uid}):this.emit(En.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(En.MUTE_VIDEO,{uid:o.uid}):this.emit(En.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(En.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(En.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(En.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(En.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=WT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(zt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($n.UID_BANNED),void this.close()):void this.reconnect(s.action,Ss.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=ie("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ie("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ss.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),ie("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(FT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Xt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Xt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(Xt.FAILED,()=>{this._disconnectedReason=$n.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(Xt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(Xt.WILL_RECONNECT,(r,s,o)=>{const c=DT(this,zt.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=LP.P2P_DISCONNECTED),d&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(zt.REPORT_JOIN_GATEWAY,s||LP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(zt.DISCONNECT_P2P)),o(r)}),this.websocket.on(Xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ss.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===Q.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return this.initError=new Oe(Q.TOKEN_EXPIRE,"dynamic key expired"),void this.close($n.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ss.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Xt.REQUEST_NEW_URLS,(r,s)=>{bs(this,zt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(jG.PRE_CONNECT_PC,()=>{this.emit(zt.PRE_CONNECT_PC)})}}let Hge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),mi=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function GG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function UP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?GG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):GG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function Km(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(ie("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function g2(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(ie("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:N}=R;return{address:"".concat(P,":").concat(N)}});const v=ie("GATEWAY_DOMAINS");let T=v[1]&&at(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:N,ip:G}=R;if(P)return{address:"".concat(P,".").concat(v[T++%v.length],":").concat(N)};const j=/^[\.\:\d]+$/.test(G),W=j?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[T++%v.length],":").concat(N):"".concat(G,":").concat(N);return j||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:N,address:W}})}(t.addresses,r),o=Array.isArray(t.detail)&&t.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let y=0;y<m.length;y++){var c;const v=ro(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,y]=d.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function rc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function HG(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(rc(r.width),"x").concat(rc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function $G(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function GT(t,r){let s,o,c;switch(r){case mi.CHOOSE_SERVER:o=4096,c="choose server";break;case mi.CLOUD_PROXY:o=1048576,c="proxy";break;case mi.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case mi.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(Q.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===o&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>UP(UP({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:UP(UP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!s)throw new Oe(Q.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function KG(t,r){return await ut.all(t.addresses.map(async s=>({address:ie("USE_TURN_IP")?s.ip:Km(s.ip),tcpport:s.port,udpport:s.port,username:r&&ie("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ts.username,password:r&&ie("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await bL(r.toString()):Ts.password})))}function _2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(rc(t.height),rc(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function qm(t){let{candidateType:r,relayProtocol:s,type:o,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=d}return m}function VP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ie("SVC_MODE");if(ie("ENABLE_SVC"))return function(r){return r in pP}(t)?t:pP.L1T3}const qG={[gt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[gt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function jP(t,r,s){r.forEach(o=>{var c;const d=qG[t].find(m=>{var y;let{key:v}=m;return at(y=o.extensionName).call(y,v)});if(!d)return;const h=s.find(m=>{let{extensionName:y}=m;return at(y).call(y,d.key)});h&&at(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function fS(t,r){r.forEach(s=>{var o;const c=qG[t].find(d=>{var h;let{key:m}=d;return at(h=s.extensionName).call(h,m)});at(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function YG(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||at(t).call(t,"abs-send-time")}function FP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||at(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function XG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function JG(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?XG(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):XG(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function HT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let T=[],R=[],P=[],N=[],G=!1,j=!1;if(Ra(t).mediaDescriptions.forEach(Y=>{o&&o!==Y.attributes.direction||(Y.media.mediaType!=="video"||G||(R=Y.attributes.payloads,N=Y.attributes.extmaps,G=!0),Y.media.mediaType!=="audio"||j||(T=Y.attributes.payloads,P=Y.attributes.extmaps,j=!0))}),!N||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||T.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(Y=>{var J;(J=Y.rtpMap)!==null&&J!==void 0&&J.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),v&&Y.rtcpFeedbacks.push({type:"rrtr"})}),T.forEach(Y=>{var J;(J=Y.rtpMap)!==null&&J!==void 0&&J.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),v&&Y.rtcpFeedbacks.push({type:"rrtr"})}),c&&(T=T.filter(Y=>{var J;return((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"}),R=R.filter(Y=>{var J;return((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())!=="rtx"})),d&&(R=R.filter(Y=>{var J;return!/(red)|(ulpfec)|(flexfec)/i.test(((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")})),h&&(T=T.filter(Y=>{var J;return!/(red)|(ulpfec)|(flexfec)/i.test(((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(T=T.filter(Y=>{var J;return at(m).call(m,((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const Y=R.filter(J=>{var le;return at(y).call(y,((le=J.rtpMap)===null||le===void 0?void 0:le.encodingName.toLowerCase())||"")});R=Y.concat(c?[]:v2(Y,R))}const W=ie("UNSUPPORTED_VIDEO_CODEC");return W&&W.length>0&&(R=R.filter(Y=>!(Y.rtpMap&&at(W).call(W,Y.rtpMap.encodingName.toLowerCase())))),{audioCodecs:T,videoCodecs:R,audioExtensions:P,videoExtensions:N}}function Ym(t){const r=Ra(t);let s,o;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!o){const d=c.attributes.fingerprints;d.length>0&&(o={fingerprints:d})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function QG(t,r){const s=[],o=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=o.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function ZG(t,r,s){const{cname:o}=t;let c=[];r&&(c=eH(r)),c.length===0&&(c=t.iceParameters.candidates.map(T=>({foundation:T.foundation,componentId:"1",transport:T.protocol,priority:T.priority.toString(),connectionAddress:T.ip,port:T.port.toString(),type:T.type,extension:{}})),x.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(T=>({hashFunction:T.algorithm,fingerprint:T.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=WP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(T=>{v.push({kind:gt.VIDEO,ssrcId:T.v,rtx:T.v_rtx,mslabel:"".concat(T.v,"_").concat(T.a)},{kind:gt.AUDIO,ssrcId:T.a,mslabel:"".concat(T.v,"_").concat(T.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:o,preSSRCs:v}}function eH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function iy(t,r,s){const o=[],c=[];return t.forEach(d=>{let{ssrcId:h,rtx:m}=d;const y=ur(8,"track-"),v={ssrcId:h,attributes:JG({label:y,mslabel:s=s||ur(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(o.push(v),m!==void 0){const T={ssrcId:m,attributes:JG({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};o.push(T),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:o,ssrcGroups:c}}function mS(t,r){r instanceof qr&&t.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!Fr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function y2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function E2(t,r){var s;if(!(r instanceof Sr&&r._encoderConfig&&r._hints.indexOf(dr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Mn().supportMinBitrate&&o.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,h;at(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Mn().supportMinBitrate&&!at(s=r._hints).call(s,dr.LOW_STREAM)&&o.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,h;at(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(ie("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function tH(t){if(t.media.mediaType!=="video")return;const r=An();if(r.name!==Bn.SAFARI&&r.os!==ji.IOS)return;const s=t.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function BP(t,r,s){if(!r)return;let o,c;if(t.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=o.find(h=>FP(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>FP(y.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(T=>!!y.find(R=>R.payloadType===T.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>FP(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const d=o.find(h=>YG(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(T=>!!y.find(R=>R.payloadType===T.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(h=>YG(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function nH(t,r,s){if(Fr()||t.media.mediaType!=="video"||!(r instanceof Sr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!ie("SIMULCAST")||s==="vp9"&&ie("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:zr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:zr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function rH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const T=HT(v,m,y,"sendonly"),R=HT(v,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Tu(T,R,"videoExtensions",P,N,G),Tu(T,R,"videoCodecs",P,N,G),Tu(T,R,"audioExtensions",P,N,G),Tu(T,R,"audioCodecs",P,N,G),ie("RAISE_H264_BASELINE_PRIORITY")){const j=[],W=[];G.videoCodecs.forEach((Y,J)=>{var le;if(((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){var _e,Ee;const ge=G.videoCodecs[J+1],Ne=ge&&cH(Y,ge),qe=(_e=Y.fmtp)===null||_e===void 0?void 0:_e.parameters["profile-level-id"],dt=(Ee=Y.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!qe||qe!==ie("FIRST_H264_PROFILE_LEVEL_ID")||ie("FIRST_PACKETIZATION_MODE")&&dt!==ie("FIRST_PACKETIZATION_MODE")?Ne?W.push([Y,ge]):W.push([Y]):Ne?j.push([Y,ge]):j.push([Y])}}),j.length>0&&W.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Y,J)=>{var le;if(((le=Y.rtpMap)===null||le===void 0?void 0:le.encodingName.toLocaleLowerCase())==="h264"){const _e=cH(Y,G.videoCodecs[J+1]),Ee=j.shift()||W.shift()||[];Ee.length>0&&(_e?G.videoCodecs.splice(J,2,...Ee):G.videoCodecs.splice(J,1,...Ee))}}),N.videoCodecs=N.videoCodecs.filter(Y=>{var J,le;return!(((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((le=Y.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==ie("FIRST_H264_PROFILE_LEVEL_ID"))}),ie("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>{var J,le;return!(((J=Y.rtpMap)===null||J===void 0?void 0:J.encodingName.toLocaleLowerCase())==="h264"&&((le=Y.fmtp)===null||le===void 0?void 0:le.parameters["profile-level-id"])!==ie("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:N,sendrecv:G}}(t,r,o);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function iH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=HT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Tu(t,r,"videoExtensions",s,o,c),Tu(t,r,"videoCodecs",s,o,c),Tu(t,r,"audioExtensions",s,o,c),Tu(t,r,"audioCodecs",s,o,c),ie("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function Tu(t,r,s,o,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?d[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?d[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function WP(t){const{send:r,recv:s,sendrecv:o}=t;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...o.audioCodecs],d.videoCodecs=[...s.videoCodecs,...o.videoCodecs],d.audioExtensions=[...s.audioExtensions,...o.audioExtensions],d.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):d=o,{send:c,recv:d}}function gS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function $T(t,r,s,o){let c=[];if(t===gt.VIDEO){if(ie("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(d=>{var h;return at(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===ie("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const T=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";at(T).call(T,o)?d.push(v):at(T).call(T,"vp9")?h.push(v):at(T).call(T,"vp8")?m.push(v):at(T).call(T,"h264")&&y.push(v)}),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):m.length!==0?(d=m,v="vp8"):y.length!==0&&(d=y,v="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=r.videoCodecs.filter(v=>d.some(T=>T.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),ie("USE_PUB_RTX")||ie("USE_SUB_RTX")){const d=v2(c,r.videoCodecs);c=[...c,...d]}}else c=r.audioCodecs.filter(d=>{var h;return at(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(d=>{var h;return at(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function v2(t,r){const s=t.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&at(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function KT(t,r,s){const o=r.toString(),c=oH(o,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:o});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=sH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function sH(t,r,s){const o=Ra(t),{useXR:c}=r;return o.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!at(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&gS(d),c&&at(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Gm(o)}function oH(t,r,s,o){if(ie("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),t),r==="offer"?c=>{oH(c,"answer",s==="local"?"remote":"local",o)}:void 0}function aH(t){const r=ie("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>at(t).call(t,s))}function cH(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function lH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Pl(t,r){return typeof ie(t)===r?ie(t):void 0}function $ge(){try{const t=ie("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?lH(Object(o),!0).forEach(function(c){K(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):lH(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const uH={};function Xm(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),uH[t.name]=t}function ff(t){const r=uH[t];if(!r)throw new xe(Q.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function dH(t,r){return ff("DataStream").create(t,r)}function zP(){return ff("InterceptFrame").create()}function hH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function mf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?hH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):hH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const S2=new Map;class Kge extends Mr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(es.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(es.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,d;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:mf(mf({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=ff("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,o)):new Gge(mf(mf({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=S2.get(r.cname);if(d||(d=new Map,S2.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const v=new Oe(Q.UID_CONFLICT);throw Ct.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(T=>{let{address:R}=T;const[P,N]=R.split(":"),G={host:P,port:N};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Ct.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(es.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(es.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(es.NETWORK_QUALITY,{uplinkNetworkQuality:$G(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:$G(this._statsCollector.trafficStats.B_dnq)}):this.emit(es.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==$n.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==fr.CONNECTED||await function(o,c){return c===1/0?o:ut.race([o,yme(c)])}(this.signal.request(Wt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==$n.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:ie("PUB_EXTEND"),twcc:!!ie("PUBLISH_TWCC"),rtx:!!ie("USE_PUB_RTX")};try{return(await this.signal.request(Wt.PUBLISH,c,!0))._message}catch(d){if(o&&d.data&&d.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Wt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(o&&h.data&&h.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Wt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ut.all(r.map(s=>this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!ie("SUBSCRIBE_TWCC"),rtx:!!ie("USE_SUB_RTX")||void 0,extend:ie("SUB_EXTEND"),svc:Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0};try{return await this.signal.request(Wt.PRE_SUBSCRIBE,c,!0)}catch(d){if(o&&d.data&&d.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!ie("SUBSCRIBE_TWCC"),rtx:!!ie("USE_SUB_RTX"),extend:ie("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0};try{return(await this.signal.request(Wt.SUBSCRIBE,c,!0))._message}catch(d){if(o&&d.data&&d.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Wt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(o&&d.data&&d.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!ie("USE_SUB_RTX"),twcc:!!ie("SUBSCRIBE_TWCC"),svc:Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0};try{return await this.signal.request(Wt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,d=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(Wt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ut.all(r.map(o=>this.signal.request(Wt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Wt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Wt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Wt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),ie("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(ie("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},ie("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),ie("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},ie("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(ie("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Wt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Wt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Wt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Wt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Wt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Wt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),mf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Wt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=S2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:Ts.username,password:Ts.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(mf(mf({},Ts),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Wt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&lP(()=>{this.emit(es.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(Q.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=ie("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(es.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,at(lS).call(lS,c)||lS.push(c);const d=!(Fr()||OW(87)||Ez())&&typeof ie("ENABLE_PRE_SUB")=="boolean"&&ie("ENABLE_PRE_SUB"),h=!Ez()&&Pl("ENABLE_PREALLOC_PC","boolean"),m=$ge(),y=AT(87)||function(){const T=An();if(T.name!==Bn.SAFARI||!T.browserVersion)return!1;const R=T.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=mf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Cl,browser:navigator.userAgent,process_id:ie("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:ie("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:mf({enableEncodedTransform:!!ie("ENABLE_AUDIO_METADATA")&&y||!!ie("ENABLE_AUDIO_TOPN")&&fL(Bn.CHROME,87,116)||void 0,enableAudioMetadata:!!ie("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!ie("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:ie("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:ie("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:ie("TOPN_SWITCH_HOLD_MS"),topnAudioGain:ie("TOPN_AUDIO_GAIN"),enablePublishedUserList:ie("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:ie("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Pl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Pl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Pl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:ie("USE_PUB_RTX")===!0||ie("USE_SUB_RTX")===!0||void 0,disableFEC:ie("DISABLE_FEC"),enableNTPReport:!!ie("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!ie("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!ie("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Pl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!ie("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!ie("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Pl("USE_XR","boolean"),enableLossbasedBwe:Pl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!ie("ENABLE_AUT_CC")||void 0,enableCCFallback:Pl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:d?Pl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Pl("PUBLISH_TWCC","boolean"),enableSubTWCC:Pl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Pl("USE_PUB_RTX","boolean"),enableSubRTX:Pl("USE_SUB_RTX","boolean"),enableSubSVC:ie("ENABLE_SVC")?ie("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(ie("SVC"))&&ie("SVC").length!==0?ie("SVC"):void 0,enableSvcExtended:ie("ENABLE_SVC")&&Array.isArray(ie("SVC_EXTENDED"))&&ie("SVC_EXTENDED").length!==0?ie("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,ie("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Oe(Q.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(zt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(zt.WS_RECONNECTING,r=>{this.joinInfo&&Ct.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ss.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ct.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(zt.WS_CLOSED,r=>{let s;switch(r){case $n.LEAVE:s=Ss.LEAVE;break;case $n.UID_BANNED:case $n.IP_BANNED:case $n.CHANNEL_BANNED:case $n.SERVER_ERROR:s=Ss.SERVER_ERROR;break;case $n.FALLBACK:s=Ss.FALLBACK;break;case $n.LICENSE_MISSING:case $n.LICENSE_EXPIRED:case $n.LICENSE_MINUTES_EXCEEDED:case $n.LICENSE_PERIOD_INVALID:case $n.LICENSE_MULTIPLE_SDK_SERVICE:case $n.LICENSE_ILLEGAL:case $n.TOKEN_EXPIRE:s=r;break;default:s=Ss.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ss.NETWORK_ERROR)),this.joinInfo&&Ct.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===$n.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==$n.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(zt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=ie("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Ct.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));er("EVENT_REPORT_DOMAIN",r[1]),er("EVENT_REPORT_BACKUP_DOMAIN",r[1]),er("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(En.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(zt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new Oe(Q.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,bs(this,es.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(zt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const d=zr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(ie("NEW_TURN_MODE")&&d){let v=d.servers,T=d.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],d.servers=v),Array.isArray(T)&&T.length>0&&(T=[T[0]],d.serversFromGateway=T),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await bs(this,es.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on(zt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(zt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var d;r instanceof Oe?(o=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):o=r,Ct.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(zt.IS_P2P_DISCONNECTED,r=>{r(DT(this,es.IS_P2P_DISCONNECTED))}),this.signal.on(zt.DISCONNECT_P2P,()=>{this.emit(es.DISCONNECT_P2P)}),this.signal.on(zt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(zt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(zt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(es.JOIN_RESPONSE,r,s)}),this.signal.on(zt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=ie("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const o=eH(r);this.emit(es.PRE_CONNECT_PC,{candidates:o,fingerprint:s})}}}),this.signal.on(zt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof ie("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(ie("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Wt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Wt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Wt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Wt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Wt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===qn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===qn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===gt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===gt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Wt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Wt.RESTART_ICE,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ss.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!ie("GATEWAY_WSS_ADDRESS"))return ie("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Wt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let GP=0,b2=0;function Od(t,r,s,o){return new ut((c,d)=>{r.timeout=r.timeout||ie("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),GP+=Ph(r.data)):s&&(r.data.size?GP+=r.data.size:r.data instanceof FormData?GP+=qW(r.data):GP+=Ph(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,Jo.request(r).then(h=>{typeof h.data=="string"?b2+=Ph(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?b2+=h.data.byteLength:b2+=Ph(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Jo.isCancel(h)?d(new Oe(Q.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Oe(Q.NETWORK_TIMEOUT,h.message)):h.response?d(new Oe(Q.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Oe(Q.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(Fe){var ot=0;return function(){return ot<Fe.length?{done:!1,value:Fe[ot++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(Fe,ot,bt){return Fe==Array.prototype||Fe==Object.prototype||(Fe[ot]=bt.value),Fe},o,c=function(Fe){Fe=[typeof globalThis=="object"&&globalThis,Fe,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var ot=0;ot<Fe.length;++ot){var bt=Fe[ot];if(bt&&bt.Math==Math)return bt}throw Error("Cannot find global object")}(this);function d(Fe,ot){if(ot)e:{var bt=c;Fe=Fe.split(".");for(var We=0;We<Fe.length-1;We++){var M=Fe[We];if(!(M in bt))break e;bt=bt[M]}(ot=ot(We=bt[Fe=Fe[Fe.length-1]]))!=We&&ot!=null&&s(bt,Fe,{configurable:!0,writable:!0,value:ot})}}function h(Fe){return(Fe={next:Fe})[Symbol.iterator]=function(){return this},Fe}function m(Fe){var ot=typeof Symbol<"u"&&Symbol.iterator&&Fe[Symbol.iterator];return ot?ot.call(Fe):{next:r(Fe)}}if(d("Symbol",function(Fe){function ot(M,se){this.A=M,s(this,"description",{configurable:!0,writable:!0,value:se})}if(Fe)return Fe;ot.prototype.toString=function(){return this.A};var bt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",We=0;return function M(se){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new ot(bt+(se||"")+"_"+We++,se)}}),d("Symbol.iterator",function(Fe){if(Fe)return Fe;Fe=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),bt=0;bt<ot.length;bt++){var We=c[ot[bt]];typeof We=="function"&&typeof We.prototype[Fe]!="function"&&s(We.prototype,Fe,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return Fe}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}o=y?function(Fe,ot){if(Fe.__proto__=ot,Fe.__proto__!==ot)throw new TypeError(Fe+" is not extensible");return Fe}:null}var T=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(Fe){if(Fe.m)throw new TypeError("Generator is already running");Fe.m=!0}function N(Fe,ot){return Fe.h=3,{value:ot}}function G(Fe){this.g=new R,this.G=Fe}function j(Fe,ot,bt,We){try{var M=ot.call(Fe.g.j,bt);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return Fe.g.m=!1,M;var se=M.value}catch(de){return Fe.g.j=null,Fe.g.s(de),W(Fe)}return Fe.g.j=null,We.call(Fe.g,se),W(Fe)}function W(Fe){for(;Fe.g.h;)try{var ot=Fe.G(Fe.g);if(ot)return Fe.g.m=!1,{value:ot.value,done:!1}}catch(bt){Fe.g.v=void 0,Fe.g.s(bt)}if(Fe.g.m=!1,Fe.g.l){if(ot=Fe.g.l,Fe.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function Y(Fe){this.next=function(ot){return Fe.o(ot)},this.throw=function(ot){return Fe.s(ot)},this.return=function(ot){return function(bt,We){P(bt.g);var M=bt.g.j;return M?j(bt,"return"in M?M.return:function(se){return{value:se,done:!0}},We,bt.g.return):(bt.g.return(We),W(bt))}(Fe,ot)},this[Symbol.iterator]=function(){return this}}function J(Fe,ot){return ot=new Y(new G(ot)),T&&Fe.prototype&&T(ot,Fe.prototype),ot}if(R.prototype.o=function(Fe){this.v=Fe},R.prototype.s=function(Fe){this.l={D:Fe,F:!0},this.h=this.C||this.u},R.prototype.return=function(Fe){this.l={return:Fe},this.h=this.u},G.prototype.o=function(Fe){return P(this.g),this.g.j?j(this,this.g.j.next,Fe,this.g.o):(this.g.o(Fe),W(this))},G.prototype.s=function(Fe){return P(this.g),this.g.j?j(this,this.g.j.throw,Fe,this.g.o):(this.g.s(Fe),W(this))},d("Array.prototype.entries",function(Fe){return Fe||function(){return function(ot,bt){ot instanceof String&&(ot+="");var We=0,M=!1,se={next:function(){if(!M&&We<ot.length){var de=We++;return{value:bt(de,ot[de]),done:!1}}return M=!0,{done:!0,value:void 0}}};return se[Symbol.iterator]=function(){return se},se}(this,function(ot,bt){return[ot,bt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var le=function(Fe,ot){for(var bt=0;bt<Fe.length;bt++)ot(Fe[bt])},_e=function(Fe){return Fe.replace(/\r?\n|\r/g,`\r
`)},Ee=function(Fe,ot,bt){return ot instanceof Blob?(bt=bt!==void 0?bt+"":typeof ot.name=="string"?ot.name:"blob",ot.name===bt&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],bt)),[String(Fe),ot]):[String(Fe),String(ot)]},ge=function(Fe,ot){if(Fe.length<ot)throw new TypeError(ot+" argument required, but only "+Fe.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,qe=Ne.FormData,dt=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,ft=Ne.Request&&Ne.fetch,Sn=Ne.navigator&&Ne.navigator.sendBeacon,bn=Ne.Element&&Ne.Element.prototype,hr=Ne.Symbol&&Symbol.toStringTag;hr&&(Blob.prototype[hr]||(Blob.prototype[hr]="Blob"),"File"in Ne&&!File.prototype[hr]&&(File.prototype[hr]="File"));try{new File([],"")}catch{Ne.File=function(ot,bt,We){return ot=new Blob(ot,We||{}),Object.defineProperties(ot,{name:{value:bt},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),hr&&Object.defineProperty(ot,hr,{value:"File"}),ot}}var ai=function(Fe){return Fe.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Yr=function(Fe){this.i=[];var ot=this;Fe&&le(Fe.elements,function(bt){if(bt.name&&!bt.disabled&&bt.type!=="submit"&&bt.type!=="button"&&!bt.matches("form fieldset[disabled] *"))if(bt.type==="file"){var We=bt.files&&bt.files.length?bt.files:[new File([],"",{type:"application/octet-stream"})];le(We,function(M){ot.append(bt.name,M)})}else bt.type==="select-multiple"||bt.type==="select-one"?le(bt.options,function(M){!M.disabled&&M.selected&&ot.append(bt.name,M.value)}):bt.type==="checkbox"||bt.type==="radio"?bt.checked&&ot.append(bt.name,bt.value):(We=bt.type==="textarea"?_e(bt.value):bt.value,ot.append(bt.name,We))})};if((t=Yr.prototype).append=function(Fe,ot,bt){ge(arguments,2),this.i.push(Ee(Fe,ot,bt))},t.delete=function(Fe){ge(arguments,1);var ot=[];Fe=String(Fe),le(this.i,function(bt){bt[0]!==Fe&&ot.push(bt)}),this.i=ot},t.entries=function Fe(){var ot,bt=this;return J(Fe,function(We){if(We.h==1&&(ot=0),We.h!=3)return ot<bt.i.length?We=N(We,bt.i[ot]):(We.h=0,We=void 0),We;ot++,We.h=2})},t.forEach=function(Fe,ot){ge(arguments,1);for(var bt=m(this),We=bt.next();!We.done;We=bt.next()){var M=m(We.value);We=M.next().value,M=M.next().value,Fe.call(ot,M,We,this)}},t.get=function(Fe){ge(arguments,1);var ot=this.i;Fe=String(Fe);for(var bt=0;bt<ot.length;bt++)if(ot[bt][0]===Fe)return ot[bt][1];return null},t.getAll=function(Fe){ge(arguments,1);var ot=[];return Fe=String(Fe),le(this.i,function(bt){bt[0]===Fe&&ot.push(bt[1])}),ot},t.has=function(Fe){ge(arguments,1),Fe=String(Fe);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===Fe)return!0;return!1},t.keys=function Fe(){var ot,bt,We,M,se=this;return J(Fe,function(de){if(de.h==1&&(ot=m(se),bt=ot.next()),de.h!=3)return bt.done?void(de.h=0):(We=bt.value,M=m(We),N(de,M.next().value));bt=ot.next(),de.h=2})},t.set=function(Fe,ot,bt){ge(arguments,2),Fe=String(Fe);var We=[],M=Ee(Fe,ot,bt),se=!0;le(this.i,function(de){de[0]===Fe?se&&(se=!We.push(M)):We.push(de)}),se&&We.push(M),this.i=We},t.values=function Fe(){var ot,bt,We,M,se=this;return J(Fe,function(de){if(de.h==1&&(ot=m(se),bt=ot.next()),de.h!=3)return bt.done?void(de.h=0):(We=bt.value,(M=m(We)).next(),N(de,M.next().value));bt=ot.next(),de.h=2})},Yr.prototype._asNative=function(){for(var Fe=new qe,ot=m(this),bt=ot.next();!bt.done;bt=ot.next()){var We=m(bt.value);bt=We.next().value,We=We.next().value,Fe.append(bt,We)}return Fe},Yr.prototype._blob=function(){var Fe="----formdata-polyfill-"+Math.random(),ot=[],bt="--"+Fe+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(We,M){return typeof We=="string"?ot.push(bt+ai(_e(M))+`"\r
\r
`+_e(We)+`\r
`):ot.push(bt+ai(_e(M))+'"; filename="'+ai(We.name)+`"\r
Content-Type: `+(We.type||"application/octet-stream")+`\r
\r
`,We,`\r
`)}),ot.push("--"+Fe+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+Fe})},Yr.prototype[Symbol.iterator]=function(){return this.entries()},Yr.prototype.toString=function(){return"[object FormData]"},bn&&!bn.matches&&(bn.matches=bn.matchesSelector||bn.mozMatchesSelector||bn.msMatchesSelector||bn.oMatchesSelector||bn.webkitMatchesSelector||function(Fe){for(var ot=(Fe=(this.document||this.ownerDocument).querySelectorAll(Fe)).length;0<=--ot&&Fe.item(ot)!==this;);return-1<ot}),hr&&(Yr.prototype[hr]="FormData"),dt){var ra=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(Fe,ot){ra.call(this,Fe,ot),Fe.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(Fe){Fe instanceof Yr?(Fe=Fe._blob(),this.B||this.setRequestHeader("Content-Type",Fe.type),dt.call(this,Fe)):dt.call(this,Fe)}}ft&&(Ne.fetch=function(Fe,ot){return ot&&ot.body&&ot.body instanceof Yr&&(ot.body=ot.body._blob()),ft.call(this,Fe,ot)}),Sn&&(Ne.navigator.sendBeacon=function(Fe,ot){return ot instanceof Yr&&(ot=ot._asNative()),Sn.call(this,Fe,ot)}),Ne.FormData=Yr}})();const qT=()=>{const t=ie("AREAS");return t.length===0&&t.push(Wn.GLOBAL),Ya(t).call(t,(r,s,o)=>{const c=pH(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},pH=t=>t===Wn.OVERSEA?"".concat(ks.ASIA,",").concat(ks.EUROPE,",").concat(ks.AFRICA,",").concat(ks.NORTH_AMERICA,",").concat(ks.SOUTH_AMERICA,",").concat(ks.OCEANIA):ks[t],qge=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const o=MP[s],c=Object.keys(o);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(o[d]))})}),r},HP={GLOBAL:{ASIA:[Wn.CHINA,Wn.JAPAN,Wn.INDIA,Wn.KOREA,Wn.HKMC],EUROPE:[],NORTH_AMERICA:[Wn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},$P=Object.keys(HP[Wn.GLOBAL]),T2=[Wn.CHINA,Wn.NORTH_AMERICA,Wn.EUROPE,Wn.ASIA,Wn.JAPAN,Wn.INDIA,Wn.OCEANIA,Wn.SOUTH_AMERICA,Wn.AFRICA,Wn.KOREA,Wn.HKMC,Wn.US],Yge=function(t,r){let s=[];if(at(t).call(t,Wn.GLOBAL)){const d=[Wn.GLOBAL,Wn.OVERSEA],h=Object.keys(MP);if(r===Wn.GLOBAL)throw new Oe(Q.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Wn.CHINA)s=[Wn.OVERSEA];else if(c=r,at($P).call($P,c)){const m=(o=r,HP[Wn.GLOBAL][o]||[]),y=[...d,r,...m];s=h.filter(v=>!at(y).call(y,v))}else if(function(m){let y=!1;return $P.forEach(v=>{var T;at(T=HP[Wn.GLOBAL][v]).call(T,m)&&(y=!0)}),y}(r)){const m=function(v){let T;return $P.forEach(R=>{var P;at(P=HP[Wn.GLOBAL][R]).call(P,v)&&(T=R)}),T}(r),y=[...d,m,r];s=h.filter(v=>!at(y).call(y,v))}else s=t;s=function(m){const y=[];return T2.forEach(v=>{at(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!at(T2).call(T2,v)))}(s)}else s=t;var o,c;return s};function fH(t){var r,s;if(!t&&at(r=ie("AREAS")).call(r,Wn.EXTENSIONS))return x.debug("update area from ap : reset"),void w2(ige,!0);if(!at(s=ie("AREAS")).call(s,Wn.GLOBAL)||!t)return;let o=MP.EXTENSIONS;o&&(o={CODE:pH(Wn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),o),er("AREAS",[Wn.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?er(c,o[c][0]):er(c,o[c])}))}function w2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Ct.reportApiInvoke(null,{name:Ti.SET_AREA,options:t,tag:Wr.TRACER});try{let o=[];if(typeof t=="string"&&(o=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!at(xG).call(xG,d))throw new Oe(Q.INVALID_PARAMS,"invalid area code")}),o=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new Oe(Q.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),o=h?Yge(m,h):m}if(!r){if(Rd.AREAS){const d=new Oe(Q.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void x.warning("setArea is prohibited because of config-distribute")}if(at(o).call(o,Wn.GLOBAL)&&ie("AREAS")===Wn.EXTENSIONS){const d=new Oe(Q.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void x.warning("setArea is prohibited because of ap extensions")}}er("AREAS",o,r);const c=qge(o);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?er(d,c[d][0]):er(d,c[d])}),x.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function mH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Lh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?mH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):mH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let C2=1;function Xge(t,r,s,o,c){C2+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:C2,requestId:C2,version:Cl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,y,v=t[0];return Cd(async()=>{m=Date.now();const T=await Od(v,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,T.code!==0){const N=new Oe(Q.UNEXPECTED_RESPONSE,"live streaming ap error, code"+T.code,{retry:!0,responseTime:y});throw x.error(N.toString()),N}const R=JSON.parse(T.json_body);if(R.code!==200){const N=new Oe(Q.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(N.toString()),N}if(!R.servers||R.servers.length===0){const N=new Oe(Q.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(N.toString()),N}const P=function(N,G){return{addressList:N.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(ie("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:N.workerToken,vid:N.vid}}(R,r);return ie("LIVE_STREAMING_ADDRESS")&&(P.addressList=ie("LIVE_STREAMING_ADDRESS")instanceof Array?ie("LIVE_STREAMING_ADDRESS"):[ie("LIVE_STREAMING_ADDRESS")]),Lh(Lh({},P),{},{responseTime:y})},(T,R)=>(Ct.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(T.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(T,R)=>(Ct.apworkerEvent(s.sid,{success:!1,sc:T.data&&T.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(T.code!==Q.OPERATION_ABORTED&&T.code!==Q.UNEXPECTED_RESPONSE||T.data&&T.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let R2=1;function gH(t,r,s,o){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const T=r.role,[R,P]=A2(r,d,[mi.CHOOSE_SERVER]);let N=fi.networkState;return Cd(async()=>{N&&fi.networkState===nc.OFFLINE&&fi.onlineWaiter&&await ut.race([fi.onlineWaiter,os(o&&o.maxRetryTimeout||wi.maxRetryTimeout)]),N=fi.networkState;const{data:G,headers:j}=await Od(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=j.http3==="1"?1:-1,Ct.reportResourceTiming(c,m),yH(G,c,r,y,[mi.CHOOSE_SERVER],v);const W=GT(G,mi.CHOOSE_SERVER);return I2(W),g2(W,c)},G=>(G&&Ct.joinChooseServer(m,{role:T,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(j=>j.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==Q.OPERATION_ABORTED&&(G.code===Q.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Ct.joinChooseServer(m,{role:T,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function _H(t,r,s,o){let c,{url:d,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[T,R]=A2(r,h,m);let P;return Cd(async()=>{P&&fi.networkState===nc.OFFLINE&&fi.onlineWaiter&&await ut.race([fi.onlineWaiter,os(o&&o.maxRetryTimeout||wi.maxRetryTimeout)]),P=fi.networkState;const{data:N,headers:G}=await Od(d,{data:T,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Ct.reportResourceTiming(d,r.sid),yH(N,d,r,y,m,c);const j=GT(N,mi.CHOOSE_SERVER),W=GT(N,r.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK);return I2(j),{gatewayInfo:g2(j,d),proxyInfo:W,url:d}},N=>(N.gatewayInfo&&Ct.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:d,serverList:N.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38]}),N.proxyInfo&&Ct.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:d,turnServerAddrList:N.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),N=>N.code!==Q.OPERATION_ABORTED&&(N.code===Q.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(Ct.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0)),o)}const yH=(t,r,s,o,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],T=R=>{R.flag===4096?Ct.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Ct.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const N={error:new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(N),T(N)}if(P!==0){const N=pS(P),G={error:new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),T(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},I2=t=>{var r,s,o,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(ie("AP_AREA")&&((o=t.detail)!==null&&o!==void 0&&o[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?fH(t.detail[23].toLowerCase()):fH()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var d;const v=ro(d=m[y]).call(d);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(ie("GATEWAY_ADDRESS")&&ie("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",ie("GATEWAY_ADDRESS"));const h=ie("GATEWAY_ADDRESS").map(m=>{var y,v;const T=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:T}});t.addresses=h}},Jge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const o=pS(s.buffer.code);throw new Oe(Q.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Oe(Q.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},A2=(t,r,s)=>{const o=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:o,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Lh(Lh(Lh({6:t.stringUid,11:r,12:ie("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,o]},Qge=(t,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let _S=0;function yS(t){return ut.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const YT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let y,v=0;const T=async()=>{const R=(()=>{const P=h*m,N=P+m;return s.slice(P,N).map(o)})();d&&d.push(...R);try{y=await yS(R)}catch(P){if(v+=m,h++,!(v>=s.length))return void await T();c(P)}R.forEach(P=>P.cancel())};return await T(),y},EH=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(d++,d>=c||o!=null&&o(y))throw y;return h()}};return h()};async function P2(t,r,s,o){return{gatewayInfo:await async function(d,h,m,y){let v=null;const T=[],R=async()=>{const N=ie("WEBCS_DOMAIN").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(W=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:qT()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await YT({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(d.clientId,"] Connect to choose_server:"),W.url),gH(W,d,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:T});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},P=async()=>{if(await os(1e3),v!==null)return v;const N=ie("WEBCS_DOMAIN_BACKUP_LIST").map(W=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:qT()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await YT({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),W.url),gH(W,d,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:T});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};try{return v=await yS([R(),P()]),T.length&&T.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),v}catch(N){throw N[0]}}(t,r,s,o)}}async function vH(t,r,s,o,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await P2(t,r,s,c);if(ie("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:N}=await TH(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=N.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Ts.tcpport,udpport:j.udpport||Ts.udpport,username:j.username||Ts.username,password:j.password||Ts.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=t.uid)!==null&&h!==void 0?h:P.uid,W="glb:".concat(j.toString()),Y=await bL(W),J=N.map(le=>({turnServerURL:le.address,tcpport:le.tcpport||Ts.tcpport,udpport:le.udpport||Ts.udpport,username:W,password:Y,forceturn:!1,security:!0}));G.push(...J)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await P2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await TH(t,r,s,c),v={gatewayInfo:y},T=m.map(P=>({turnServerURL:P.address,tcpport:d==="proxy3"?void 0:P.tcpport?P.tcpport:Ts.tcpport,udpport:d==="proxy4"?void 0:P.udpport?P.udpport:Ts.udpport,username:P.username||Ts.username,password:P.password||Ts.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:y.uid,N="glb:".concat(P.toString()),G=await bL(N),j=m.map(W=>({turnServerURL:W.address,tcpport:d==="proxy3"?void 0:W.tcpport||Ts.tcpport,udpport:d==="proxy4"?void 0:W.udpport||Ts.udpport,username:N,password:G,forceturn:d!=="proxy4",security:d==="proxy5"}));T.push(...j)}return t.turnServer={mode:"manual",servers:T},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),v}async function SH(t,r,s,o,c){const d=ie("ACCOUNT_REGISTER").slice(0,ie("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):d.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,T,R,P,N){const G=Date.now(),j={sid:R.sid,opid:10,appid:R.appId,string_uid:T};let W=v[0];const Y=await Cd(()=>Od(W+"".concat(W.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(J,le)=>{if(J.code===0){if(J.uid<=0||J.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(T," => ").concat(J.uid),J),Ct.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:J.uid,errorCode:Q.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Oe(Q.INVALID_UINT_UID_FROM_STRING_UID);return Ct.reqUserAccount(j.sid,{lts:G,success:!0,serverAddr:W,stringUid:j.string_uid,uid:J.uid,errorCode:null,extend:j}),!1}const _e=pS(J.code);return _e.retry&&(W=v[(le+1)%v.length]),Ct.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:J.uid,errorCode:_e.desc,extend:j}),_e.retry},(J,le)=>J.code!==Q.OPERATION_ABORTED&&(Ct.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:null,errorCode:J.code,extend:j}),W=v[(le+1)%v.length],!0),N);if(Y.code!==0){const J=pS(Y.code);throw new Oe(Q.UNEXPECTED_RESPONSE,J.desc)}return Y}(h,t,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function Zge(t,r,s){const o=ie("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):o.map(d=>"https://".concat(d,"/api/v1"));try{return await EH({referenceList:c,asyncMapHandler:h=>async function(m,y,v,T){const R=Date.now(),P={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const N=await Od(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const G=pS(N.code);throw new Oe(Q.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new Oe(Q.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:N.uid,elapse:Date.now()-R}}catch(N){throw N}}(h,t,r,s),closeFn:h=>h.code===Q.OPERATION_ABORTED||h.code===Q.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function e_e(t,r,s){const o=ie("CDS_AP").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=o.map(y=>function(v,T,R,P){const N=An(),G={flag:64,cipher_method:0,features:Lh(Lh(Lh(Lh(Lh({install_id:DL(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:T.appId,version:Cl,cname:T.cname,session_id:T.sid,proxyServer:T.proxyServer,sdk_type:Hge.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:T.cname},T.stringUid&&{string_uid:T.stringUid}),T.uid&&{uid:T.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return Cd(()=>Od(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==Q.OPERATION_ABORTED,P)}(y,t,r,s));let d=null,h=null,m={};try{d=await yS(c)}catch(y){if(y.code===Q.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),Ct.reportApiInvoke(t.sid,{name:Ti.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,T=Object.keys(v),R={};return T.forEach(P=>{var N;const G=ro(N=P.slice(4)).call(N),j=JSON.parse(v[P]),W=j[1];R[G]={tag:j[0]||"",value:W}}),R}(d)}catch{}return m}async function bH(t,r){const s=ie("WEBCS_DOMAIN").concat(ie("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:qT(),serviceIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK]}));try{return await EH({referenceList:s,asyncMapHandler:c=>async function(d,h,m){let y,{url:v,areaCode:T,serviceIds:R}=d;const P=Date.now(),[N,G]=A2(h,T,R);let j=fi.networkState;try{j&&fi.networkState===nc.OFFLINE&&fi.onlineWaiter&&await ut.race([fi.onlineWaiter,os(wi.maxRetryTimeout)]),j=fi.networkState;const{data:W,headers:Y}=await Od(v,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=Y.http3==="1"?1:-1,(Ee=>{const ge=[];if(Ee.response_body.forEach(Ne=>{const qe=Ne.buffer.code;if(Ne.uri===23&&qe===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const dt={error:new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:Ne.buffer.flag};ge.push(dt)}if(qe!==0){const dt=pS(qe),ft={error:new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,dt.desc,{desc:dt.desc,retry:dt.retry,csIp:Ee.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(ft.error.toString()):ge.push(ft)}}),ge.length)throw new Oe(Q.CAN_NOT_GET_GATEWAY_SERVER,ge.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!ge.find(Ne=>Ne.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(ge.map(Ne=>{var qe;return Ne==null||(qe=Ne.error)===null||qe===void 0||(qe=qe.data)===null||qe===void 0?void 0:qe.desc}).filter(Ne=>!!Ne))]})})(W);const le=GT(W,mi.CHOOSE_SERVER),_e=GT(W,mi.CLOUD_PROXY_FALLBACK);return I2(le),{gatewayInfo:g2(le,v),proxyInfo:_e,opid:G,requestTime:P,url:v,isHttp3:y,elapse:Date.now()-P}}catch(W){throw W}}(c,t,r),closeFn:c=>c.code===Q.OPERATION_ABORTED||c.code===Q.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function TH(t,r,s,o){const c=ie("PROXY_SERVER_TYPE3"),d=(N,G,j)=>{let W=j||c;return Array.isArray(W)&&(W=G%2==0?c[1]:c[0]),"https://".concat(W,"/ap/?url=").concat(N)};let h=null;const m=[],y=async()=>{const N=ie("WEBCS_DOMAIN").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map((W,Y)=>{let J;return J=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y),{url:J,areaCode:qT(),serviceIds:[mi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await YT({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),W.url),_H(W,t,r,s)),allFailedhandler:W=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},v=async()=>{if(await os(1e3),h!==null)return h;const N=ie("WEBCS_DOMAIN_BACKUP_LIST").map((W,Y)=>{let J;return J=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Y),{url:J,areaCode:qT(),serviceIds:[mi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?mi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?mi.CLOUD_PROXY:mi.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(W=>W.url)}),j=await YT({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),W.url),_H(W,t,r,s)),allFailedhandler:W=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};let T,R,P;try{({gatewayInfo:T,proxyInfo:R,url:P}=await yS([y(),v()]))}catch(N){throw N[0]}if(m.length&&m.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),!T||!R)throw new Oe(Q.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];at(c).call(c,N)&&(t.proxyServer=N,x.setProxyServer(N),Ct.setProxyServer(N))}return h={gatewayInfo:T,proxyInfo:await KG(R,T.uid)},h}async function t_e(t,r,s){const o=ie("UAP_AP").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=o.map(d=>function(h,m,y,v){const T={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Cl,cname:m.cname,uid:m.uid.toString(),requestId:R2,seq:R2};R2+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(T)};return Cd(async()=>{const P=await Od(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(Q.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const N=JSON.parse(P.json_body);if(N.code!==200){const G=new Oe(Q.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw x.error(G.toString()),G}if(!N.servers||N.servers.length===0){const G=new Oe(Q.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:N.vid,workerToken:N.workerToken,addressList:(ie("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(ie("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==Q.OPERATION_ABORTED&&P.code!==Q.UNEXPECTED_RESPONSE||P.data&&P.data.retry),v)}(d,t,r,s));try{const d=await yS(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function n_e(t,r,s){let o=null;const c=[],d=async h=>{const m=ie(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await os(1e3),o!==null)?o:await YT({fragementLength:ie("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,T,R,P){const[N]=Qge(T,[mi.CHOOSE_SERVER]);let G=fi.networkState;return Cd(async()=>{G&&fi.networkState===nc.OFFLINE&&fi.onlineWaiter&&await ut.race([fi.onlineWaiter,os(P&&P.maxRetryTimeout||wi.maxRetryTimeout)]),G=fi.networkState;const j=await Od(v,{data:N,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Jge(j,v)},()=>!1,j=>j.code!==Q.OPERATION_ABORTED&&(j.code===Q.UPDATE_TICKET_FAILED?j.data.retry:(x.warning("[".concat(T.clientId,"] update ticket network error, retry"),j),!0)),P)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return o=await yS([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function wH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function O2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?wH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):wH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class r_e extends Mr{get isSuccess(){return!!this.configs}constructor(r,s){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Os("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),ie("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},ie("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ct.reportApiInvoke(null,{options:void 0,name:Ti.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Wr.TRACER}).onSuccess(JSON.stringify(Rd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await e_e(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var d;const h=gT(d=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(d);for(let v=0;v<h.length;v++)for(let T=h.length-1;T>v;T--){const R=h[T],P=c[R].value;if(typeof P.__priority=="number"){const N=P.__priority,G=h[T-1],j=c[G].value;if(typeof j.__priority=="number"){if(!(N>j.__priority))continue;{const W=R;h[T]=h[T-1],h[T-1]=W}}else{const W=R;h[T]=h[T-1],h[T-1]=W}}}const m=Date.now();let y={};return h.forEach(v=>{const T=c[v].value.__expires;T&&T<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(Q.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){LG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(BT.UPDATE_BITRATE_LIMIT,r):this.emit(BT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&O2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const y=h.__type,v=r[d].value,T=r[d].tag;let R=0;y?y===uz.REALTIME&&(R=1):Object.keys(v).some(P=>Object.prototype.hasOwnProperty.call(UL,P)||!o2()&&Object.prototype.hasOwnProperty.call(fP,P)?(R=1,!0):void 0),c.push({tag:T,isApplied:R,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:m,params:y,isApplied:v}=d;this.store.sessionId&&Ct.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const d={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(T=>{T==="__id"||T==="__type"||T==="__priority"||T==="__expires"||Object.prototype.hasOwnProperty.call(d,T)||(d[T]=O2(O2({value:m[T]},y&&{expires:y}),v&&{type:v}))})}),d}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&LG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:T,type:R,expires:P}=m[v];P&&P<=y||((R===uz.REALTIME||Object.prototype.hasOwnProperty.call(UL,v))&&(Rd[v]=T,vr[v]=T,x.debug("Update realtime parameters from config distribute",v,T)),R||o2()||!Object.prototype.hasOwnProperty.call(fP,v)||(Rd[v]=T,vr[v]=T,x.debug("Update gateway parameters from config distribute",v,T)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(d))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(vr,o)){const{value:c,expires:d}=r[o];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(vr[o],c)||(Rd[o]=c,vr[o]=c,this.emit(BT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class i_e extends Mr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(ie("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var d;const h=at(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",CH[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",CH[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Oi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=rc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Oi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const CH={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ds=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function RH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function sy(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?RH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):RH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class XT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",pP.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new i_e,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(He.LocalAudioTrack)||sy({},WL)}getLocalVideoTrackStats(){return this.localStats.get(He.LocalVideoTrack)||sy({},zL)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(o[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(o[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const d=this.localStats.get(He.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(He.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(He.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:T,videoStats:R}=v;T&&(o+=T.receiveBytes,c+=T.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?Ds.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ds.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,d=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case He.LocalVideoTrack:case He.LocalVideoLowTrack:{const h=c,m=sy({},zL),y=r.getStats(),v=r.getLocalMedia(o);if(y){const T=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(He.LocalVideoTrack);T.codec!=="H264"&&T.codec!=="H265"&&T.codec!=="VP8"&&T.codec!=="VP9"&&T.codec!=="AV1X"&&T.codec!=="AV1"||(m.codecType=T.codec),m.sendBytes=T.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,T.inputFrame?(m.captureFrameRate=T.inputFrame.frameRate,m.captureResolutionHeight=T.inputFrame.height,m.captureResolutionWidth=T.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),T.sentFrame?(m.sendFrameRate=T.sentFrame.frameRate,m.sendResolutionHeight=T.sentFrame.height,m.sendResolutionWidth=T.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),T.avgEncodeMs&&(m.encodeDelay=T.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(T)&&(m.totalFreezeTime+=1),T.scalabilityMode&&this.scalabilityMode!==T.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(T.scalabilityMode)),this.scalabilityMode=T.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case He.LocalAudioTrack:{const h=c,m=sy({},WL),y=r.getStats(),v=r.getLocalMedia(o);if(y){const T=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(T){if(T.codec!=="opus"&&T.codec!=="aac"&&T.codec!=="PCMU"&&T.codec!=="PCMA"&&T.codec!=="G722"||(m.codecType=T.codec),T.inputLevel)m.sendVolumeLevel=Math.round(32767*T.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=T.bytes,m.sendPackets=T.packets,m.sendPacketsLost=T.packetsLost,m.sendJitterMs=T.jitterMs,m.sendRttMs=T.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(He.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[d,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,T=h,R=y,P=sy({},Sz),N=sy({},bz),G=sy({},Wme),{audioTrack:j,videoTrack:W,audioSSRC:Y,videoSSRC:J}=r.getRemoteMedia(d);let le;le=this.store.useP2P?r.getStats(!0):r.getStats();const _e=(o=le)===null||o===void 0?void 0:o.audioRecv.find(qe=>qe.ssrc===Y),Ee=(c=le)===null||c===void 0?void 0:c.videoRecv.find(qe=>qe.ssrc===J),ge=this.trafficStats&&this.trafficStats.peer_delay.find(qe=>qe.peer_uid===d);if(_e&&(_e.codec!=="opus"&&_e.codec!=="aac"&&_e.codec!=="PCMU"&&_e.codec!=="PCMA"&&_e.codec!=="G722"||(P.codecType=_e.codec),_e.outputLevel?P.receiveLevel=Math.round(32767*_e.outputLevel):j&&(P.receiveLevel=Math.round(32767*j.getVolumeLevel())),P.receiveBytes=_e.bytes,P.receivePackets=_e.packets,P.receivePacketsLost=_e.packetsLost,P.receivePacketsDiscarded=_e.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=v?8*Math.max(0,P.receiveBytes-v.receiveBytes):0,P.totalDuration=v?v.totalDuration+1:1,P.totalFreezeTime=v?v.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=_e.jitterBufferMs,P.totalDuration>10&&XT.isRemoteAudioFreeze(j)&&(P.totalFreezeTime+=1)),Ee){var Ne;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(N.codecType=Ee.codec),N.receiveBytes=Ee.bytes,N.receiveBitrate=T?8*Math.max(0,N.receiveBytes-T.receiveBytes):0,N.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,N.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(N.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(N.receiveFrameRate=Ee.receivedFrame.frameRate,N.receiveResolutionHeight=Ee.receivedFrame.height,N.receiveResolutionWidth=Ee.receivedFrame.width):W&&(N.receiveResolutionHeight=W._videoHeight||0,N.receiveResolutionWidth=W._videoWidth||0),Ee.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(Ee.framesRateFirefox)),N.receivePackets=Ee.packets,N.receivePacketsLost=Ee.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const qe=T?T.totalFreezeTime:0,dt=T?T.totalDuration:0;N.totalDuration=T?T.totalDuration+1:1,N.totalFreezeTime=(Ne=Ee.totalFreezesDuration)!==null&&Ne!==void 0?Ne:qe||0,N.receiveDelay=Ee.jitterBufferMs||0;const ft=!!J&&r.getRemoteVideoIsReady(J);Ee.totalFreezesDuration===void 0&&W&&ft&&XT.isRemoteVideoFreeze(W,Ee,R)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-qe)/(N.totalDuration-dt),1))}ge&&(P.end2EndDelay=ge.B_ad,N.end2EndDelay=ge.B_vd,P.transportDelay=ge.B_ed,N.transportDelay=ge.B_ed,P.currentPacketLossRate=ge.B_ealr4/100,N.currentPacketLossRate=ge.B_evlr4/100,G.uplinkNetworkQuality=ge.B_punq?ge.B_punq:0,G.downlinkNetworkQuality=ge.B_pdnq?ge.B_pdnq:0),this.remoteStats.set(d,{audioStats:P,videoStats:N,videoPcStats:Ee,networkStats:G}),j&&this.exceptionMonitor.setRemoteAudioStats(j,P),W&&this.exceptionMonitor.setRemoteVideoStats(W,N)})}}class IH{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){DG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){DG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){DP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function AH(t){if(!(t instanceof IH))return new Oe(Q.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(Q.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(Q.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Jm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function PH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function OH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?PH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):PH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const JT="9",kH=4e4;function NH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function gf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?NH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):NH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}var ES=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(ES||{});const KP=new Map;function DH(t,r,s,o){let{scale:c}=t;if(c===0&&o===ES.UP||c>=r.length-1&&o===ES.DOWN)return t;let d=gf(gf({},t),{},{scale:o===ES.DOWN?++c:--c});switch(s){case"maintain-framerate":d=gf(gf({},d),r[c].motion);break;case"maintain-resolution":d=gf(gf({},d),r[c].detail);break;case"balanced":d=gf(gf({},d),r[c].balanced)}return d}function xH(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:LH(r)};KP.set(t,s)}else KP.delete(t)}function LH(t){const r=gf({},t),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:T,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:W,BALANCE_RESOLUTION_FACTOR:Y,MOTION_RESOLUTION_FACTOR:J,MOTION_BITRATE_FACTOR:le,DETAIL_FRAMERATE_FACTOR:_e,DETAIL_BITRATE_FACTOR:Ee}=LL,ge=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(N,1)*ge),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:d}}];for(let qe=1;qe<=y;qe++){const dt={bwe_up:Math.round(Math.pow(R,qe)*s),bwe_down:Math.round(Math.pow(P,qe+1)*s),fps_up:Math.round(Math.pow(G,qe)*ge),fps_down:Math.round(Math.pow(N,qe+1)*ge)},ft={scaleResolutionDownBy:c/Math.pow(Y,qe),frameRate:Math.max(Math.round(Math.pow(W,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(j,qe)*s),T),bitrateMin:Math.max(Math.round(Math.pow(j,qe)*d),v)},Sn={scaleResolutionDownBy:c/Math.pow(J,qe),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(le,qe)*s),T),bitrateMin:Math.max(Math.round(Math.pow(le,qe)*d),v)},bn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_e,qe)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,qe)*s),T),bitrateMin:Math.max(Math.round(Math.pow(Ee,qe)*d),v)};Ne.push({scale:qe,threshold:dt,balanced:ft,motion:Sn,detail:bn})}return Ne}function s_e(t,r,s,o,c,d){const h=KP.get(t)||{overUse:0,underUse:0,adaptationList:LH(c)},{adaptationList:m}=h;KP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=LL,{scale:T}=o;let R,P;return typeof r=="number"&&r>0&&function(N,G,j,W){if(G>=j.length)return!1;let{threshold:{fps_down:Y}}=j[G];return ie("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Y=j[0].threshold.fps_down),N<Y}(r,T,m,d)&&(h.overUse++,P=LT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(N,G,j){if(G>=j.length)return!1;const{threshold:{bwe_down:W}}=j[G];return N<W}(s,T,m)&&(h.overUse++,P=LT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=DH(o,m,d,ES.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(N,G,j,W){if(G===0)return;let{threshold:{fps_up:Y}}=j[G];return ie("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Y=j[1].threshold.fps_up),N>Y}(r,T,m,d)&&function(N,G,j){if(G===0)return;const{threshold:{bwe_up:W}}=j[G];return N>W}(s,T,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=DH(o,m,d,ES.UP),R.scale===0&&(P=LT.NONE))),[R,P])}function MH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function k2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?MH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):MH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function o_e(t){var r;return!!ie("ENABLE_AG_ADAPTATION")&&!!(t instanceof QL||at(r=t._hints).call(r,dr.CUSTOM_TRACK))&&(!!ie("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const o=An();if(o.os!==ji.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=s}(14)&&NW(17,4)||kW(14)&&DW(17,4,!0)))}const qP=new Map;function YP(t,r){const s=qP.get(t);if(s){const{timer:o}=s;window.clearTimeout(o),qP.delete(t)}r.qualityLimitationReason=LT.NONE,xH(t)}function a_e(t,r){var s;let o;switch(r){case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoTrack:o=at(s=t._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalVideoLowTrack:o=qn.Low}return o}function N2(t){const r=Mn();if(t.some(s=>s._bypassWebAudio))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function D2(t,r){N2(t);const s=new Oi;return t.forEach(o=>s.addAudioTrack(o)),s}const c_e=!Mn().supportUnifiedPlan||ie("CHROME_FORCE_PLAN_B")&&of();function XP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return c_e?(s={spec:r,store:t},ff("PlanBConnection").create(s)):new Mh(r,t)}function x2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function UH(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(NT(t.turnServer.servers))return!1;if(ie("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Cn;function VH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function kd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let Mh=(Cn=class Ry extends UG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return at(s=Object.keys(mP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"id",ur(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:ie("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",LT.NONE),K(this,"isFirstConnected",!1),this.store=s,this.forceTurn=UH(r),this.mutex=new Os("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Ry.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=NL(this.peerConnection,ie("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(o)return{transceiver:o,track:o.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ym(o.sdp),d=await rH({filterRTX:!ie("USE_PUB_RTX")&&!ie("USE_SUB_RTX"),filterVideoFec:ie("FILTER_VIDEO_FEC"),filterAudioFec:ie("FILTER_AUDIO_FEC"),filterVideoCodec:ie("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=WP(d),this.initialOffer=o,ie("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:pP.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const T=Ra(v.sdp).mediaDescriptions[0];if(!T)return;const R=T.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&aH(o.sdp)&&(h=zr(d),(s=h).send&&(fS(gt.VIDEO,s.send.videoExtensions),fS(gt.AUDIO,s.send.audioExtensions)),s.recv&&(fS(gt.VIDEO,s.recv.videoExtensions),fS(gt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(fS(gt.VIDEO,s.sendrecv.videoExtensions),fS(gt.AUDIO,s.sendrecv.audioExtensions))),kd(kd({},c),{},{rtpCapabilities:h||d,offerSDP:o.sdp})}catch(o){throw new xe(Q.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&aH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(jP(gt.VIDEO,s.send.videoExtensions,o.send.videoExtensions),jP(gt.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(jP(gt.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),jP(gt.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return zr(this._localCapabilities)}get rtpCapabilities(){return zr(this._rtpCapabilities)}get candidates(){return zr(this._candidates)}get iceParameters(){return zr(this._iceParameters)}get dtlsParameters(){return zr(this._dtlsParameters)}constructor(v){let T=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=T,v=zr(v);const{iceParameters:R,dtlsParameters:P,candidates:N,rtpCapabilities:G,setup:j,localCapabilities:W,cname:Y}=v;this._rtpCapabilities=G,this._candidates=N,this._originCandidates=zr(N),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=W,this.setup=j,this.cname=Y,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const T=this.candidates,R=this.dtlsParameters,P=this.iceParameters,N=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let j=1;j<v;j++){const W=2*j+2e4,Y=2*j+kH,{ssrcs:J,ssrcGroups:le}=iy([{ssrcId:W}],this.cname),{ssrcs:_e,ssrcGroups:Ee}=iy([{ssrcId:Y,rtx:ie("USE_SUB_RTX")?Y+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:JT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:T,extmaps:N.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_e,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:JT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:T,extmaps:N.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:J,ssrcGroups:le,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Gm(this.sessionDesc)}send(v,T,R,P){const{ssrcs:N,ssrcGroups:G}=iy(T,this.cname,ie("SYNC_GROUP")?R:void 0),j=this.findPreloadMediaDesc(N);if(j){if(Fr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,j.attributes.mid),P&&(P.twcc||P.remb)){const W=this.sessionDesc.mediaDescriptions.indexOf(j);return this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(j,P),{mid:j.attributes.mid,needExchangeSDP:!0}}return{mid:j.attributes.mid,needExchangeSDP:!1}}{const W=this.findAvailableMediaIndex(v,N);let Y;return W===-1||W===1&&(vs()||function(){const J=An();return!(J.name!==Bn.CHROME||!J.osVersion)&&Number(J.version)<=90}()||ie("ENABLE_ENCODED_TRANSFORM")&&sf())||W===0&&ie("USE_SUB_RTX")||xW()?(Y=this.createOrRecycleSendMedia(v,N,G,"sendonly",P),this.updateBundleMids()):(Y=zr(this.sessionDesc.mediaDescriptions[W]),Y.attributes.direction="sendonly",Y.attributes.ssrcs=N,Y.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(Y,P)),Fr()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,Y.attributes.mid),{mid:Y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:T}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:T}}batchSend(v){const T=v.map(N=>{let{kind:G,ssrcMsg:j,mslabel:W}=N;return this.send(G,j,W)}),R=[];let P=!1;return T.forEach(N=>{let{mid:G,needExchangeSDP:j}=N;j&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");T.forEach(R=>{R.attributes.mid==="0"||Fr()||xW()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!T)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));T.attributes.direction="inactive"}unmute(v){const T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!T)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));T.attributes.direction="sendonly"}muteRemote(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>at(v).call(v,R.attributes.mid||""));if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>at(v).call(v,R.attributes.mid||""));if(T.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");T.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,T,R,P){v.forEach((N,G)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",T,R,P[G])}),this.updateBundleMids()}stopReceiving(v){const T=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(T.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");T.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const T=this.sessionDesc||Ra((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const P=this.rtpCapabilities.send,N=this.localCapabilities.send;for(const G of T.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const j=N.videoCodecs.filter(W=>{var Y,J;return(Y=W.rtpMap)===null||Y===void 0?void 0:at(J=Y.encodingName.toLowerCase()).call(J,"vp8")})||[N.videoCodecs[0]];G.media.fmts=j.map(W=>W.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,ie("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:W}=iy([{ssrcId:kH,rtx:ie("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=W}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const j=N.audioCodecs.filter(W=>{var Y,J;return(Y=W.rtpMap)===null||Y===void 0?void 0:at(J=Y.encodingName.toLowerCase()).call(J,"opus")})||[N.audioCodecs[0]];G.media.fmts=j.map(W=>W.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,gS(G),ie("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:W}=iy([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=W}}}return this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const T=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(T.forEach(P=>{R.push(OH(OH({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),T.length!==0){switch(v){case Ns.TCP_RELAY:this._candidates=R;break;case Ns.UDP_TCP_RELAY:case Ns.RELAY:this._candidates=[...T,...R];break;default:this._candidates=T}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(v){v=zr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.iceUfrag=v.iceUfrag,T.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const T=[];for(let R=0;R<v;R++)T.push((this.currentMidIndex+R+1).toString(10));return T}findAvailableMediaIndex(v,T){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Fr()){if(P){const N=this.firefoxSsrcMidMap.get(T[0].ssrcId);return!(N||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!N||N!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),T={media:{mediaType:"application",port:JT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(T),{mediaDesc:T,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,T,R,P,N,G){const j=v._mediaStreamTrack.kind,W=this.rtpCapabilities.recv,Y=$T(j,W,this.localCapabilities.send,j===gt.VIDEO?P:N),J=j===gt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const le="".concat(this.currentMidIndex);let _e={media:{mediaType:j,port:JT,protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:J,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(le)}};_e=this.mungRecvMediaDsec(_e,v,G);const Ee=this.findFirstClosedMedia(j);if(Ee){const ge=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[ge]=_e}else this.sessionDesc.mediaDescriptions.push(_e);return _e}updateRemoteCodec(v,T,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").filter(_e=>{var Ee;return at(Ee=Object.keys(mP)).call(Ee,_e)}))],N=new Set(T);if(P.every(_e=>N.has(_e)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(T)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(_e=>T.some(Ee=>{var ge;return at(ge=_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").call(ge,Ee)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(T)),!1;const j=[...new Set(G.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||""))];let W;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(j)),v.length===0)W=this.sessionDesc.mediaDescriptions.filter(_e=>_e.media.mediaType==="video"&&_e.attributes.direction==="recvonly");else if(W=this.sessionDesc.mediaDescriptions.filter(_e=>_e.attributes.mid&&at(v).call(v,_e.attributes.mid)&&_e.attributes.direction==="recvonly"),W.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(T)),!1;if(ie("USE_PUB_RTX")||ie("USE_SUB_RTX")){const _e=v2(G,this.rtpCapabilities.recv.videoCodecs);G.push(..._e)}this._rtpCapabilities.recv.videoCodecs=G;const Y=this.localCapabilities.send,J=this.rtpCapabilities.recv,le=$T(gt.VIDEO,J,Y,R);return W.forEach(_e=>{const Ee=le.map(ge=>ge.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(_e.attributes.mid,", from"),_e.attributes.payloads,"to",le),_e.attributes.payloads=le,_e.media.fmts=Ee}),!0}createOrRecycleSendMedia(v,T,R,P,N){const G=this.rtpCapabilities.send,j=v===gt.VIDEO?G.videoCodecs:G.audioCodecs,W=v===gt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let J={media:{mediaType:v,port:JT,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:W,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:T,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};J=this.mungSendMediaDesc(J,N);const le=this.findFirstClosedMedia(v);if(le){const _e=this.sessionDesc.mediaDescriptions.indexOf(le);this.sessionDesc.mediaDescriptions[_e]=J}else this.sessionDesc.mediaDescriptions.push(J);return J}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,T,R){const P=zr(v);return y2(P),mS(P,T),E2(P,T),tH(P),BP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(v,T){const R=zr(v);return BP(R,T,this.localCapabilities.recv),gS(R),R}updateRecvMedia(v,T){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===v);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],T);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(T=>Fr()?T.media.port==="0"&&T.media.mediaType===v:T.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(T=>{var R;return((R=T.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var T;return(T=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||T===void 0?void 0:T.attributes.ssrcs}}(kd(kd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=sH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),ie("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(ie("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const T=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(T)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(T=>({kind:T.kind,ssrcMsg:[{ssrcId:T.ssrcId,rtx:T.rtx}],mslabel:T.mslabel})));v.forEach((T,R)=>{this.preSSRCMap.set(y[R].ssrcId,T)}),await KT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(d=>Object.assign({},{kind:d.kind,ssrcMsg:[{ssrcId:d.ssrcId,rtx:d.rtx}],mslabel:d.mslabel})));c.forEach((d,h)=>{this.preSSRCMap.set(o[h].ssrcId,d)})}await KT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return wl(function*(){const d=yield In(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=VP();r.forEach(W=>{const Y=c.peerConnection.addTransceiver(W._mediaStreamTrack,kd({direction:"sendonly"},W.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Y),W._updateRtpTransceiver(Y)}),Fr()&&ie("SIMULCAST")===!0&&(yield In(c.applySimulcastForFirefox(h,r)));const y=yield In(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),T=c.mungSendOfferSDP(y.sdp,r,v),R=Ra(T),P=v.map(W=>{const Y=R.mediaDescriptions.find(J=>J.attributes.mid===W);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return QG(Y,ie("USE_PUB_RTX"))});let N;try{N=yield P}catch(W){N=[],c.remoteSDP.receive(r,s,o,N);const Y=c.remoteSDP.toString();throw yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield In(c.stopSending(v,!0)),W}c.remoteSDP.receive(r,s,o,N);const G=c.remoteSDP.toString(),j=c.logSDPExchange(T,"offer","local","send");return yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(c.applySimulcastEncodings(h,r)),yield In(c.applySendEncodings(h,r)),j==null||j(G),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Y)=>{const J=v[Y];return{localSSRC:P[Y],id:J,transceiver:W}})}catch(h){throw h instanceof xe?h:new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:ie("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(d=>{d._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof xe?o:new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof xe?s:new xe(Q.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;YP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await KT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await KT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===d)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return wl(function*(){const o=yield In(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Mn().supportPCSetConfiguration,d=ie("FORCE_TURN_TCP")||s.forceTurn;if(r===Ns.RELAY&&!c)return;if(c&&!d){const R=r===Ns.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield In(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Ym(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),T=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield In(s.peerConnection.setLocalDescription(h)),T==null||T(v),yield In(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ns.TCP_RELAY),await KT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{YP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return kd(kd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new xe(Q.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Fr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:kd(kd({},Oh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:kd(kd({},Oh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ie("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(NT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:ie("NEW_TURN_MODE")&&s.iceServers?(ie("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Ry.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Ry.newTurnServerConfigToIceServers(r.turnServer.servers)),ie("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Ry.turnServerConfigToIceServers(r.turnServer.servers)),ie("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Ry.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),ie("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),ie("ENABLE_ENCODED_TRANSFORM")&&Mn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Km(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!ie("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=ie("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Km(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Km(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:d}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(W=>W.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Mn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(j,W){return j.getTransceivers().find(Y=>Y.sender.track===W||Y.receiver.track===W)}(this.peerConnection,r._mediaStreamTrack),y=Kme(r);if(o_e(r)&&m&&s&&y&&this.getLocalVideoStats&&at(o=["vp8","vp9"]).call(o,this.store.codec)){var v;const j=d.degradationPreference||(at(v=r._hints).call(v,dr.CUSTOM_TRACK)?ie("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(W,Y,J,le,_e,Ee){if(YP(W,J),_e(Y),le!=="balanced"&&le!=="maintain-framerate"&&le!=="maintain-resolution")return;let ge=-1;xH(W,Y);const Ne=window.setInterval(()=>{const dt=qP.get(W);if(!ie("ENABLE_AG_ADAPTATION")||!dt)return YP(W,J),void _e(Y);const ft=Ee();if(ft.sendPackets>0&&ft.OutgoingAvailableBandwidth>0){if(ge===-1)return void(ge=Date.now());if(Date.now()-ge<1e3)return;const Sn=ft.sendFrameRate,bn=ft.OutgoingAvailableBandwidth,[hr,ai]=s_e(W,Sn,bn,dt.adaptationConfig,Y,le);ai&&(J.qualityLimitationReason=ai),hr&&dt.adaptationConfig.scale!==hr.scale&&(x.debug("[".concat(W,"] applyAdaptation: ").concat(J.qualityLimitationReason,`
           sendFps `).concat(Sn,", bwe ").concat(bn,", switch from ").concat(dt.adaptationConfig.scale," to ").concat(hr.scale," ")),dt.adaptationConfig=k2(k2({},dt.adaptationConfig),hr),_e(hr))}},ie("CHECK_LOCAL_STATS_INTERVAL")),qe=k2({},Y);qP.set(W,{timer:Ne,adaptationConfig:qe,originConfig:Y,adaptationFunc:_e}),x.debug("[".concat(W,"] start adaptation, originConfig: ").concat(JSON.stringify(Y),", degradationPreference: ").concat(le))})(this.id+m.mid,y,this,j,W=>{s&&this.updateAdaptation(s,W)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var T;const{bitrateMax:j,frameRate:W,scaleResolutionDownBy:Y}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(at(T=r._hints).call(T,dr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(W&&(h.maxFramerate=rc(W)),Y&&Y>=1&&(h.scaleResolutionDownBy=Y))}const{maxFramerate:R}=ie("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),ie("DSCP_TYPE")&&of()){var P;const j=ie("DSCP_TYPE");at(P=["very-low","low","medium","high"]).call(P,j)&&(h.networkPriority=j)}const N=s.getParameters(),G=(c=N.encodings)===null||c===void 0?void 0:c[0];Fr()&&!G&&(d.encodings=[h]),G&&Object.assign(G,h),Object.assign(N,d),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await s.setParameters(N),await async function(j,W,Y){try{var J;if(!Mn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(j)||!ie("ENABLE_SVC"))return;const le={},_e={},Ee=W.getParameters(),ge=(J=Ee.encodings)===null||J===void 0?void 0:J[0];_e.scalabilityMode=VP(Y),ge&&Object.assign(ge,_e),Object.assign(Ee,le),await W.setParameters(Ee),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(le){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",le)}}(this.store.codec,s,ie("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Mn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=rc(m)),y&&y>=1&&at(o=["vp8","vp9"]).call(o,this.store.codec)&&(d.scaleResolutionDownBy=y);const v=r.getParameters(),T=(c=v.encodings)===null||c===void 0?void 0:c[0];T&&Object.assign(T,d),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Mn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],d=s[o];d instanceof Sr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ra(r);return s.forEach((d,h)=>{const m=o[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(mS(y,d),nH(y,d,this.store.codec))}),Gm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,d,h,m;const v=r[y],T=s[y];if(T instanceof Sr&&!at(o=T._hints).call(o,dr.LOW_STREAM)&&(c=T._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=T._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,s){if(!Fr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Sr&&this.isVP8Simulcast(c)){const d=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,d,h;return!!(r instanceof Sr&&ie("SIMULCAST")&&this.store.codec==="vp8"&&!at(s=r._hints).call(s,dr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(ie("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Mn().supportPCSetConfiguration){const s=Ry.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Et(Cn.prototype,"updateRemoteRTPCapabilities",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateRemoteRTPCapabilities"),Cn.prototype),Et(Cn.prototype,"connect",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"connect"),Cn.prototype),Et(Cn.prototype,"updateRemoteConnect",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateRemoteConnect"),Cn.prototype),Et(Cn.prototype,"createDataChannels",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"createDataChannels"),Cn.prototype),Et(Cn.prototype,"receive",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"receive"),Cn.prototype),Et(Cn.prototype,"batchReceive",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"batchReceive"),Cn.prototype),Et(Cn.prototype,"stopReceiving",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"stopReceiving"),Cn.prototype),Et(Cn.prototype,"muteRemote",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"muteRemote"),Cn.prototype),Et(Cn.prototype,"unmuteRemote",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"unmuteRemote"),Cn.prototype),Et(Cn.prototype,"muteLocal",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"muteLocal"),Cn.prototype),Et(Cn.prototype,"unmuteLocal",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"unmuteLocal"),Cn.prototype),Et(Cn.prototype,"close",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"close"),Cn.prototype),Et(Cn.prototype,"updateEncoderConfig",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateEncoderConfig"),Cn.prototype),Et(Cn.prototype,"updateSendParameters",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateSendParameters"),Cn.prototype),Et(Cn.prototype,"replaceTrack",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"replaceTrack"),Cn.prototype),Et(Cn.prototype,"updateAdaptation",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"updateAdaptation"),Cn.prototype),Et(Cn.prototype,"getRemoteSSRC",[Zo],Object.getOwnPropertyDescriptor(Cn.prototype,"getRemoteSSRC"),Cn.prototype),Cn);function Zo(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}function L2(t,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=rc(r.width),o.height=rc(r.height);const c=rc(r.framerate||15);document.body.append(s),document.body.append(o);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=o.getContext("2d");if(!h)throw new Oe(Q.UNEXPECTED_ERROR,"can not get canvas context");const m=Mn(),y=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const T=s.videoWidth,R=s.videoHeight/T,P=o.width*R;Math.abs(P-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(s,0,0,o.width,o.height),y.requestFrame&&y.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},o.stopCapture=$L(()=>o.startCapture&&o.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},y}var JP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(JP||{}),gi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(gi||{}),oy=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(oy||{}),_i=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(_i||{}),ay=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(ay||{}),jH=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(jH||{}),Uh=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Uh||{}),ea=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(ea||{}),FH=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(FH||{}),ta=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ta||{}),QP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(QP||{});const cy=1e3,ly=6,ZP=3,l_e=Math.max(ly,ZP);function Ft(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function BH(t){const r={[ta.CONN_TYPE]:0,[ta.RTT]:t.rtt,[ta.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[ta.CONN_TYPE]=1),s==="tcp"&&(r[ta.CONN_TYPE]=3),s==="tls"&&(r[ta.CONN_TYPE]=4);break}case"srflx":r[ta.CONN_TYPE]=2;break;case"unknown":r[ta.CONN_TYPE]=5;break;default:r[ta.CONN_TYPE]=0}return r}function WH(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class zH extends Mr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%ZP==0,o=r%ly==0;let c,d;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),c||d){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,d,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,o?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,o);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&d){const v=this.getInboundStats(d,o?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,o);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[QP.RTC_PEER_CONNECTION_STATE]=kL[y]):m.misc=[{addition:{[QP.RTC_PEER_CONNECTION_STATE]:kL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=d,this.lastSendStats=c,o&&(this.lastFullRecvStats=d,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=d,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[QP.RTC_PEER_CONNECTION_STATE]:kL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===l_e+1&&(r=1)},cy)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[ta.RTT]:r.rtt,[ta.CONN_TYPE]:void 0,[ta.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=BH(r);if(this.store.useP2P){if(s){const d=BH(s);c[ta.CONN_TYPE]+=d[ta.CONN_TYPE]<<3}c[ta.CONN_TYPE]+=110}else c[ta.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let h,m,y;return d.forEach(v=>{let[T,{track:R,ssrcs:P}]=v;switch(T){case He.LocalVideoLowTrack:case He.LocalVideoTrack:if(T===He.LocalVideoTrack){const N=function(W,Y,J,le,_e,Ee){const ge=Y.videoSend.find(ft=>ft.ssrc===W);if(!ge)return;const Ne={},{sentFrame:qe,inputFrame:dt}=ge;if(Ee&&(Ft(Ne,gi.QP_SUM,ge.qpSumPerFrame),dt&&qe)){const ft=dt.frameRate,Sn=qe.frameRate;Ne[gi.FREEZE]=function(bn,hr){let ai=!0;return ai=!(bn<=5)&&(bn<=10?hr<3:bn<=20?hr<4:hr<5),ai}(ft,Sn)?1:0}if(_e){switch(qe&&(Ft(Ne,gi.HEIGHT,qe.height),Ft(Ne,gi.WIDTH,qe.width),Ft(Ne,gi.FRAME_RATE,qe.frameRate)),Ne[gi.DISABLED]=le._originMediaStreamTrack&&!le._originMediaStreamTrack.enabled||le._mediaStreamTrack&&!le._mediaStreamTrack.enabled?1:0,ge.adaptionChangeReason){case"none":Ne[gi.ADAPTATION]=0;break;case"cpu":Ne[gi.ADAPTATION]=1;break;case"bandwidth":Ne[gi.ADAPTATION]=2;break;case"other":Ne[gi.ADAPTATION]=3}let ft=0;ge.adaptionChangeReason&&(ft+=WH(ge.adaptionChangeReason)),Y.qualityLimitationReason&&(ft+=WH(Y.qualityLimitationReason)<<3),Ne[gi.ADAPTATION]=ft,Ne[gi.PLAYER_STATUS]=GL[le._player?le._player.videoElementStatus:"uninit"],Ft(Ne,gi.NACKS,ge.nacksCount),Ft(Ne,gi.PLIS,ge.plisCount),Ft(Ne,gi.FIRS,ge.firsCount),Ft(Ne,gi.AVG_ENCODE,ge.avgEncodeMs),Ft(Ne,gi.HUGE_FRAME_SENT,ge.hugeFramesSent),Ft(Ne,gi.BYTES_RETRANSMIT,ge.retransmittedBytesSent),Ft(Ne,gi.PACKAGES_RETRANSMIT,ge.retransmittedPacketsSent),Ft(Ne,gi.KEY_FRAMES_ENCODED,ge.keyFramesEncoded);const Sn=J&&J.videoSend.find(bn=>bn.ssrc===W);if(Sn){let bn=_e?cy:cy*ly;Sn.timestamp&&ge.timestamp&&(bn=ge.timestamp-Sn.timestamp),Sn.packets!=null&&ge.packets!=null&&Ft(Ne,gi.PACKAGE_RATE,1e3*(ge.packets-Sn.packets)/bn),ge.packetsLost!=null&&Sn.packetsLost!=null&&Ft(Ne,gi.PACKAGE_LOST,ge.packetsLost-Sn.packetsLost),Sn.bytes!=null&&ge.bytes!=null&&Ft(Ne,gi.BITRATE,8*(ge.bytes-Sn.bytes)/bn)}}return Ne}(P[0].ssrcId,r,s,R,o,c),G=R&&function(W,Y,J,le){const _e=Y.videoSend.find(ge=>ge.ssrc===W);if(!_e)return null;const Ee={};if(le){const ge=_e.inputFrame,Ne=ge&&ge.height||J.videoHeight||0,qe=ge&&ge.width||J.videoWidth||0,dt=ge&&ge.frameRate||0;Ft(Ee,JP.HEIGHT,Ne),Ft(Ee,JP.WIDTH,qe),Ft(Ee,JP.FRAME_RATE,dt)}return Ee}(P[0].ssrcId,r,R,o),j=function(W,Y){const J={};return Y&&(Ft(J,gi.RETRANSMIT,W.bitrate.retransmit),Ft(J,gi.TARGET_ENCODED,W.bitrate.targetEncoded),Ft(J,gi.ACTUAL_ENCODED,W.bitrate.actualEncoded),Ft(J,gi.TRANSMIT,W.bitrate.transmit),Ft(J,gi.BANDWIDTH,W.sendBandwidth)),J}(r,o);m=Object.assign({},N,G,j)}else y=function(N,G,j,W){const Y=G.videoSend.find(le=>le.ssrc===N);if(!Y)return;const J={};if(W){const le=Y.sentFrame;if(le&&(Ft(J,oy.HEIGHT,le.height),Ft(J,oy.WIDTH,le.width),Ft(J,oy.FRAME_RATE,le.frameRate)),j){const _e=j.videoSend.find(Ee=>Ee.ssrc===N);if(_e){let Ee=cy*ly;_e.timestamp&&Y.timestamp&&(Ee=Y.timestamp-_e.timestamp),_e.packets!=null&&Y.packets!=null&&Ft(J,oy.PACKAGE_RATE,1e3*(Y.packets-_e.packets)/Ee),Y.packetsLost!=null&&_e.packetsLost!=null&&Ft(J,oy.PACKAGE_LOST,Y.packetsLost-_e.packetsLost),_e.bytes!=null&&Y.bytes!=null&&Ft(J,oy.BITRATE,8*(Y.bytes-_e.bytes)/Ee)}}}return J}(P[0].ssrcId,r,s,o);break;case He.LocalAudioTrack:h=R&&function(N,G,j,W,Y){const J=G.audioSend.find(_e=>_e.ssrc===N);if(!J)return;const le={};if(Y){le[Uh.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const _e=100*W._source.getAccurateVolumeLevel(),Ee=J.inputLevel;if(Ee!=null){const Ne=Math.ceil(50*Math.log10(100*Ee+1));Ft(le,Uh.LEVEL,Ne)}Ft(le,jH.PCM_LEVEL,_e),Ft(le,Uh.AEC_RETURN_LOSS,J.aecReturnLoss),Ft(le,Uh.AEC_RETURN_LOSS_ENH,J.aecReturnLossEnhancement),Ft(le,Uh.BYTES_RETRANSMIT,J.retransmittedBytesSent),Ft(le,Uh.PACKAGES_RETRANSMIT,J.retransmittedPacketsSent),le[Uh.FREEZE]=0;const ge=j&&j.audioSend.find(Ne=>Ne.ssrc===N);if(ge){let Ne=cy*ly;ge.timestamp&&J.timestamp&&(Ne=J.timestamp-ge.timestamp),ge.bytes!=null&&J.bytes!=null&&Ft(le,Uh.BITRATE,8*(J.bytes-ge.bytes)/Ne),ge.packets!=null&&J.packets!=null&&Ft(le,Uh.PACKAGE_RATE,1e3*(J.packets-ge.packets)/Ne)}}return le}(P[0].ssrcId,r,s,R,o)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(m=>{let[y,v]=m;const T={peer:y.uid};if(v.has(gt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(N,G,j,W,Y,J,le,_e){const Ee=G.videoRecv.find(bn=>bn.ssrc===N);if(!Ee)return;const ge={},{receivedFrame:Ne,outputFrame:qe,decodeFrameRate:dt}=Ee,ft=j&&j.videoRecv.find(bn=>bn.ssrc===N);if(Ft(ge,ay.FRAME_RATE_DECODE,dt),Ee.framesRateFirefox&&Ft(ge,_i.FRAME_RATE,Ee.framesRateFirefox),Ne&&Ft(ge,_i.FRAME_RATE,Ne.frameRate),Ft(ge,_i.FRAMES_DROPPED,Ee.framesDroppedCount),Ft(ge,_i.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),Ft(ge,_i.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),Ft(ge,_i.PACKAGES_DISCARDED,Ee.packetsDiscarded),Ft(ge,_i.AVG_DECODE,Ee.avgDecodeMs),Ft(ge,_i.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),Ft(ge,_i.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),Ft(ge,_i.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),Ft(ge,_i.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),ft){const bn=G.timestamp-j.timestamp||cy*(_e?ly:le?ZP:1);Ee.packetsLost!=null&&ft.packetsLost!=null&&Ft(ge,_i.PACKAGE_LOST,Ee.packetsLost-ft.packetsLost),ft.bytes!=null&&Ee.bytes!=null&&Ft(ge,_i.BITRATE,8*(Ee.bytes-ft.bytes)/bn),ft.packets!=null&&Ee.packets!=null&&Ft(ge,_i.PACKAGE_RATE,1e3*(Ee.packets-ft.packets)/bn)}if(_e&&(Ft(ge,_i.QP_SUM,Ee.qpSumPerFrame),ge[_i.FREEZE]=Y&&XT.isRemoteVideoFreeze(W,Ee,ft)?1:0),le){var Sn;Ne?(Ft(ge,_i.HEIGHT,Ne.height),Ft(ge,_i.WIDTH,Ne.width)):W&&(Ft(ge,_i.HEIGHT,W._videoHeight||0),Ft(ge,_i.WIDTH,W._videoWidth||0)),qe&&Ft(ge,ay.FRAME_RATE_OUTPUT,qe.frameRate);const bn=(Sn=W._player)===null||Sn===void 0?void 0:Sn.rendFrameRate.toFixed(0);if(bn&&Ft(ge,ay.FRAME_RATE_RENDER,+bn),Ft(ge,_i.JITTER_BUFFER,Ee.jitterBufferMs),Ft(ge,_i.CURRENT_DELAY,Ee.currentDelayMs),Ft(ge,_i.FIRS,Ee.firsCount),Ft(ge,_i.NACKS,Ee.nacksCount),Ft(ge,_i.PLIS,Ee.plisCount),W){ge[_i.DISABLED]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1;const hr=W._player;if(hr){const{freezeTimeCounterList:ai,renderFreezeAccTime:Yr,videoElementStatus:ra}=hr;if(ai&&ai.length>0&&Ft(ge,ay.FREEZE_TIME,ai.splice(0,1)[0]),J&&lf.visibility==="visible"&&ra===io.PLAYING&&Mn().supportRequestVideoFrameCallback){const Fe=Math.min(6e3,Yr);hr.renderFreezeAccTime=Math.max(0,Yr-Fe),Ft(ge,ay.FREEZE_TIME_RENDER,Fe)}if(typeof Ee.totalFreezesDuration=="number"){const Fe=ft&&ft.totalFreezesDuration?Ee.totalFreezesDuration-ft.totalFreezesDuration:Ee.totalFreezesDuration;Ft(ge,ay.FREEZE_DURATION,1e3*Fe)}}}if(ge[_i.PLAYER_STATUS]=GL[W._player?W._player.videoElementStatus:"uninit"],ft&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&ft.totalInterFrameDelay!==void 0&&ft.totalSquaredInterFrameDelay!==void 0){const hr=Ee.totalInterFrameDelay-ft.totalInterFrameDelay,ai=Ee.totalSquaredInterFrameDelay-ft.totalSquaredInterFrameDelay,Yr=Ee.framesDecodeCount-ft.framesDecodeCount,ra=hr/Yr*1e3,Fe=Math.round(1e3*Math.sqrt((ai-Math.pow(hr,2)/Yr)/Yr));!isNaN(Fe)&&ra+Fe>Math.max(3*ra,ra+150)&&(ge[_i.I_FRAME_DELAY]=Fe)}}return ge}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(T.video=P)}if(v.has(gt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,N,G,j,W,Y){const J=N.audioRecv.find(ge=>ge.ssrc===P);if(!J)return;const le={},_e=G&&G.audioRecv.find(ge=>ge.ssrc===P);if(Ft(le,ea.JITTER,J.jitterMs),Ft(le,ea.BYTES_RETRANSMIT,J.retransmittedBytesReceived),Ft(le,ea.PACKAGES_RETRANSMIT,J.retransmittedPacketsReceived),Ft(le,ea.PACKAGES_DISCARDED,J.packetsDiscarded),Ft(le,ea.AVG_PROCESSING_DELAY,J.avgProcessingDelayMs),_e){const ge=N.timestamp-G.timestamp||cy*(Y?ly:W?ZP:1);J.packets!=null&&_e.packets!=null&&Ft(le,ea.PACKAGE_RATE,1e3*(J.packets-_e.packets)/ge),W&&_e.bytes!=null&&J.bytes!=null&&Ft(le,ea.BITRATE,8*(J.bytes-_e.bytes)/ge),J.packetsLost!=null&&_e.packetsLost!=null&&Ft(le,ea.PACKAGE_LOST,J.packetsLost-_e.packetsLost)}if(Y){const{receivedFrames:ge,droppedFrames:Ne}=J;ge!=null&&Ne!=null&&(le[ea.FREEZE]=(Ee=ge)===0||100*Ne/Ee>20?1:0)}var Ee;if(W){const ge=100*j._source.getAccurateVolumeLevel(),Ne=J.outputLevel;if(Ne!=null){const qe=Math.ceil(50*Math.log10(100*Ne+1));Ft(le,FH.LEVEL,qe)}if(Ft(le,ea.PCM_LEVEL,ge),j&&(le[ea.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1),Ft(le,ea.JITTER_BUFFER,J.jitterBufferMs),Ft(le,ea.CURRENT_DELAY,J.jitterBufferMs),le[ea.PLAYER_STATUS]=GL[Qo.getPlayerState(j.getTrackId())],_e){const qe=J.concealedSamples-_e.concealedSamples;qe>0&&Ft(le,ea.CONCEALED_SAMPLES,qe);const dt=J.totalSamplesReceived-_e.totalSamplesReceived;dt>0&&Ft(le,ea.TOTAL_SAMPLES_RECEIVED,dt)}}return le}(y._audioSSRC,r,s,y.audioTrack,o,c):void 0;R&&(T.audio=R)}(T.video||T.audio)&&h.push(T)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof bP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(FT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(gt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(gt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:ie("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,T]of h)T.has(gt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),T.has(gt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(v,T){const R={};for(const{id:j,value:W,level:Y,direction:J}of v){var P;const le=(P=T.get(j))!==null&&P!==void 0?P:0,_e=W===2?le+ie("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:le;var N,G;T.set(j,_e),R[j]?(W===2&&(R[j].value=W),Y>R[j].level&&(R[j].level=Y),J==="remote"&&(R[j].remoteUidCount+=1),R[j].totalTs=(N=T.get(j))!==null&&N!==void 0?N:0):R[j]={value:W,level:Y,remoteUidCount:J==="local"?0:1,totalTs:(G=T.get(j))!==null&&G!==void 0?G:0}}return Object.keys(R).map(j=>{const{level:W,value:Y,totalTs:J}=R[j];return{id:j,level:W,value:Y,totalTs:J}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(FT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:y})},ie("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const u_e=ie("ICE_RESTART_INTERVAL");let e1=new Map,vS=new Map,Qm=[Ns.UDP_TCP_RELAY,Ns.TCP_RELAY,Ns.RELAY],M2=ie("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Mn().supportPCSetConfiguration;function GH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=e1.get(t.id);s&&(window.clearTimeout(s),e1.delete(t.id));const o=vS.get(t.id);r&&o&&o.index===Qm.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),vS.delete(t.id))}function HH(t,r,s){if(e1.size===0&&vS.size===0&&(Array.isArray(ie("RESTART_SEQUENCE"))&&ie("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const T=m[v];if(m.filter(R=>R===T).length!==y.filter(R=>R===T).length)return!1}return!0}(Qm,ie("RESTART_SEQUENCE"))&&(Qm=ie("RESTART_SEQUENCE").filter(m=>{var y;if(at(y=Object.values(Ns)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Qm.join(" => ")))),M2=ie("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Mn().supportPCSetConfiguration),Qm.length===0)return void s();let o,{index:c=0,type:d}=vS.get(t.id)||{};if(M2&&d===Ns.RELAY)return void s();let h=d&&c>=Qm.length-1;if(M2)d=Ns.RELAY;else{if(h)return void s();d?(c++,d=Qm[c]):(d=Qm[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),vS.set(t.id,{index:c,type:d}),o=window.setTimeout(()=>HH(t,r,s),u_e),e1.set(t.id,o)}var hn;function $H(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Vh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$H(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$H(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}function KH(t){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=oL,o=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(o&&(r=t[o])!=null)return new t1(r.call(t));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function t1(t){function r(s){if(Object(s)!==s)return ut.reject(new TypeError(s+" is not an object."));var o=s.done;return ut.resolve(s.value).then(function(c){return{value:c,done:o}})}return t1=function(s){this.s=s,this.n=s.next},t1.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ut.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ut.reject(s):r(o.apply(this.s,arguments))}},new t1(t)}let QT=(hn=class extends Mr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Nt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Kn.Disconnected),K(this,"_pcStatsUploadType",ie("NEW_ICE_RESTART")?pf.FIRST_CONNECTION:pf.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(s,o,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Kn.Connected)return void c(new xe(Q.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const y=this.createMuteMessage(h);await lr(this,Nt.RequestMuteLocal,y),o()}catch(h){c(h)}finally{d()}}),K(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Kn.Connected)return void c(new xe(Q.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding){const T=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T}else{const T=L2(s,DT(this,Nt.RequestLowStreamParameter));v.track._mediaStreamTrack=T,v.track._originMediaStreamTrack=T}await new ut((T,R)=>{this.handleReplaceTrack(v.track,T,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const y=this.createUnmuteMessage(h);await lr(this,Nt.RequestUnmuteLocal,y),o()}catch(h){c(h)}finally{d()}}),K(this,"handleUpdateVideoEncoder",async(s,o,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(He.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Kn.Connected)return void o();const{id:v,track:T}=y;await this.connection.updateSendParameters(v,T),await this.connection.updateEncoderConfig(v,T),this.emit(Nt.UpdateVideoEncoder,T),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(He.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Kn.Connected)return void o();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{d()}}),K(this,"handleReplaceMixingTrack",async(s,o,c,d)=>{if(!this.connection||this.state!==Kn.Connected)return void o();const h=D2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),K(this,"handleReplaceTrack",async(s,o,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:R}]=T;return s===R});if(!this.connection||!v||this.state!==Kn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const T=v[1];T.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],T)}if(v[0]===He.LocalVideoTrack&&!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding){const T=this.localTrackMap.get(He.LocalVideoLowTrack);if(T){const R=s._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=R,T.track._originMediaStreamTrack=R,await new ut((P,N)=>{this.handleReplaceTrack(T.track,P,N,!0)})}}o()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new zH(this.store),this.bindStatsUploaderEvents(),this.mutex=new Os("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Mn().supportUnifiedPlan||ie("CHROME_FORCE_PLAN_B")&&of(),this.shouldForwardP2PCreation=ie("FORWARD_P2P_CREATION")&&Mn().supportPCSetConfiguration&&yL(),this.shouldForwardP2PCreation&&(this.connection=XP(this.store),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Kn.New,this._forceTurn=UH(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=XP(this.store,t),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new xe(Q.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=ie("NEW_ICE_RESTART")?pf.FIRST_CONNECTION:pf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new xe(Q.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");ie("ENABLE_PREALLOC_PC")&&this.state===Kn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Kn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return at(d=[He.LocalVideoLowTrack,He.LocalVideoTrack]).call(d,h)}),s=r.map(c=>{let[,{id:d}]=c;return d}),o=r.map(c=>{let[d]=c;return d});if(this.connection instanceof Mh){if(Ct.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!at(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>at(t).call(t,d));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Mh&&this.connection.peerConnectionState!=="closed"&&at(t=[Kn.New,Kn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Kn.Connected){if(this.state===Kn.Disconnected)throw new xe(Q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var o;at(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var o=this;return wl(function*(){const c=yield In(o.mutex.lock("From P2PChannel.publish"));try{var d;const h=o.connection&&at(d=["disconnected","failed"]).call(d,o.connection.peerConnectionState);if(!o.connection||o.state!==Kn.Connected||h){if(o.state===Kn.Disconnected)throw new xe(Q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(y),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ds.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield In(o.tryToUnmuteAudio(t)));yield*YA(KH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return wl(function*(){r.forEach(P=>{let{track:N,type:G}=P;const j=Date.now();s.store.publish(N.getTrackId(),G===He.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:N}=P;return N}),c=yield In(t.send(o,s.store.codec,s.store.audioCodec)),d=(yield In(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===Q.WS_ABORT&&r.forEach(N=>{let{track:G}=N;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,o),v=(yield In(c.next(y))).value;if(s.state===Kn.Disconnected)throw new xe(Q.UNEXPECTED_ERROR,"PeerConnection already disconnected.");ie("ENABLE_VIDEO_SEI");const T=ie("ENABLE_ENCODED_TRANSFORM"),R=ie("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const N=P.getRTCRtpTransceiver();if(!N||!T)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:j}=zP();P.trackMediaType===gt.VIDEO?await G(N.sender,P):P.trackMediaType===gt.AUDIO&&await j(N.sender,{metadata:R?()=>{const W=P.metadata.shift();return W&&W.value}:void 0})}),r.forEach(P=>{let{type:N}=P;s.statsCollector.addLocalStats(N)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:N,type:G}=P;const j=Date.now();s.store.publish(N.getTrackId(),G===He.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Sr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=_2(d,h)),m.maxFramerate=d.framerate?rc(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,o);if(o._encoderConfig||(o._encoderConfig={}),r!==He.LocalVideoLowTrack||!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=o._originMediaStreamTrack;if(!d.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=rc(m.width)),m.height&&(y.height=rc(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=$L(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},rc(m.framerate)))})(d,t)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(t){var r=this;return wl(function*(){if(!r.connection||r.state!==Kn.Connected)return;const s=yield In(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(He.LocalVideoTrack);if(!c)throw new xe(Q.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(He.LocalVideoLowTrack))throw new xe(Q.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:He.LocalVideoLowTrack}];if(yield*YA(KH(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(He.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield In(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await bs(this,Nt.RequestRePublish,this.pendingLocalTracks),this.emit(Nt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await bs(this,Nt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==gt.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==gt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await bs(this,Nt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===gt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(Nt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Kn.Connected)return void t.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Kn.Connected)return void t.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Kn.Connected)return;const t=this.localTrackMap.get(He.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[He.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:d}]=o;return{type:c,track:d}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Kn.Connected)throw new xe(Q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(t,new Map([[o.id,o]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===o.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(o=>o.id)}async subscribe(t,r,s,o,c){var d;if(!this.connection||this.state!==Kn.Connected)throw new xe(Q.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const P=c.find(G=>{let{stream_type:j}=G;return j===r});if(!P)throw new xe(Q.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof Mh&&(y=N.transceiver),h=N.track,m=N.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(t._uintid),void 0);this.connection instanceof Mh&&(y=P.transceiver),h=P.track,m=P.id}if(r===gt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new aS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new oS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&ie("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:N}=zP();r==gt.VIDEO?await P(y.receiver,{onSei:ie("ENABLE_VIDEO_SEI")&&(G=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(G)})}):r==gt.AUDIO&&await N(y.receiver,{enableTopn:!!ie("ENABLE_AUDIO_TOPN"),enableMetadata:!!ie("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(Nt.AudioMetadata,G)}})}const T=this.remoteUserMap.get(t);T?T.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:N,kind:G}=P;return N.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Nt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Kn.Connected)throw new xe(Q.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);d?s.set(c.ssrcId,d):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{s.set(c.ssrcId,o[d])});for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:y,id:v,transceiver:T}=m;if(T&&ie("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=zP();d==gt.VIDEO?await N(T.receiver,{onSei:ie("ENABLE_VIDEO_SEI")&&(j=>{var W;return(W=c._videoTrack)===null||W===void 0?void 0:W._onSei(j)})}):d==gt.AUDIO&&await G(T.receiver,{enableTopn:!!ie("ENABLE_AUDIO_TOPN"),enableMetadata:!!ie("ENABLE_AUDIO_METADATA"),onMetadata:j=>{this.safeEmit(Nt.AudioMetadata,j)}})}if(d===gt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new aS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),T&&c._audioTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new oS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),T&&c._videoTrack._updateRtpTransceiver(T),this.bindRemoteTrackEvents(c,c._videoTrack)),ie("ENABLE_VIDEO_SEI")&&T){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=zP();d==gt.VIDEO?await N(T.receiver,{onSei:j=>{var W;(W=c._videoTrack)===null||W===void 0||W._onSei(j)}}):d==gt.AUDIO&&await G(T.receiver)}const R=this.remoteUserMap.get(c);R?R.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(N=>{let{user:G,kind:j}=N;return G.uid===c.uid&&d===j});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(Nt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Kn.Connected||s||o.forEach(h=>{let{kind:m}=h;var y;if(m===gt.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===gt.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Kn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,T;if(y===gt.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===gt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((T=m._videoTrack)===null||T===void 0||T._destroy(),m._videoTrack=void 0);else if(y===gt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(t);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return d!==void 0?y.uid===c.uid&&d===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Kn.Connected)return void r.forEach(c=>{let{user:d,kind:h}=c;var m;if(h===gt.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===gt.VIDEO){var y;(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0}});const s=Ya(t).call(t,(c,d)=>{let{user:h,mediaType:m}=d;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var m,y;if(h===gt.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===gt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0;else if(h===gt.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}}),o}isPreSubScribe(t){return!this.connection||this.state!==Kn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(He.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(He.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Oi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==He.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===He.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===He.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get(He.LocalAudioTrack),m=o?this.localTrackMap.get(He.LocalVideoLowTrack):this.localTrackMap.get(He.LocalVideoTrack);Ct.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof qr),m=o?(d=this.localTrackMap.get(He.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Sr);Ct.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===gt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ct.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ds.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Os("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=XP(this.store),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(He.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Oi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Kn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(He.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(He.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Sr||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(jc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(He.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=gT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Kn.Reconnecting,ie("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=XP(this.store),this.emit(Nt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case He.LocalVideoTrack:at(r=o._hints).call(r,dr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case He.LocalAudioTrack:o instanceof Oi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case He.LocalVideoLowTrack:}}),this.emit(Nt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(jc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Nt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(jc(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((t instanceof Jm?t.uid:t)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Jm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return wl(function*(){if(!r.connection||r.state!==Kn.Connected)return;const s=yield In(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield In(r.connection.restartICE(t));const d=yield In(o.next());if(d.done)return;const h=d.value,m=yield h;switch(x2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ns.UDP_TCP_RELAY:r._pcStatsUploadType=pf.UDP_TCP_RESTART;break;case Ns.TCP_RELAY:r._pcStatsUploadType=pf.TCP_RESTART;break;case Ns.RELAY:r._pcStatsUploadType=pf.RELAY_RESTART;break;default:r._pcStatsUploadType=pf.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(d){var c;(c=o)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(He.LocalVideoTrack),s=this.localTrackMap.get(He.LocalAudioTrack),o=t.videoSend.find(N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(N=>N.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const d=Uc(this,Nt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,T=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(dr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const j=(1e3*N-G)/(1e3*N);return IG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,d=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=Uc(this,Nt.NeedSignalRTT),v=t.rtt,T=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let N=.7*P*100/50+.3*T/1500;R&&(N=.6*P*100/50+.2*T/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ut((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Kn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!o)return;const c=o[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const d=o[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===He.LocalVideoTrack&&!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding){const d=this.localTrackMap.get(He.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new ut((m,y)=>{this.handleReplaceTrack(d.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const o=[],c=this.getAllTracks();t=Kv(t=t.filter(y=>c.indexOf(y)===-1));let d,h=!1;const m=this.localTrackMap.get(He.LocalAudioTrack);for(const y of t){if(y instanceof Sr&&(this.localTrackMap.has(He.LocalVideoTrack)||h?new xe(Q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:He.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);o.push({track:v,type:He.LocalVideoLowTrack})}if(y instanceof qr)if(m){const v=m.track;if(v instanceof Oi)N2([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const T=D2([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(T.getTrackId(),"]")),this.replaceTrack(v,T)}}else d instanceof Oi?(N2([y]),d.addAudioTrack(y)):d||!y._useAudioElement&&Mn().webAudioMediaStreamDest&&!y._bypassWebAudio?d=D2(d?[y,d]:[y]):d=y}return d&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),o.push({track:d,type:He.LocalAudioTrack})),o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Kv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof qr){const c=this.localTrackMap.get(He.LocalAudioTrack);if(!c)continue;c.track instanceof Oi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([He.LocalAudioTrack,c]),c.track.close())):r.push([He.LocalAudioTrack,c])}if(o instanceof Sr){const c=this.localTrackMap.get(He.LocalVideoTrack);if(!c)continue;r.push([He.LocalVideoTrack,c]);const d=this.localTrackMap.get(He.LocalVideoLowTrack);d&&r.push([He.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Kv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Kv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case He.LocalVideoTrack:s.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(yt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case He.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Oi?t.trackList.forEach(s=>{s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case He.LocalVideoTrack:s.off(yt.GET_STATS,this.handleGetLocalVideoStats),s.off(yt.GET_RTC_STATS,this.handleGetRTCStats),s.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case He.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Oi?t.trackList.forEach(r=>{r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof oS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof aS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let d,h,{track:m,type:y}=s;switch(y){case He.LocalAudioTrack:d=qn.Audio,h={dtx:m instanceof bP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case He.LocalVideoTrack:d=at(c=m._hints).call(c,dr.SCREEN_TRACK)?qn.Screen:qn.High,h=Vh(Vh({},HG(m)),{},{codec:this.store.codec,svc_mode:VP()});break;case He.LocalVideoLowTrack:d=qn.Low,h=Vh(Vh({},HG(m)),{},{codec:this.store.codec,svc_mode:VP()})}return{stream_type:d,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case He.LocalVideoTrack:o=at(s=d._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Nt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Mh&&!Fr()&&ie("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},ie("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Mh&&GH(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=pf.DISCONNECTED_OR_FAILED,Uc(this,Nt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Ct.reportApiInvoke(this.store.sessionId,{name:Ti.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:Wr.TRACER}).onSuccess(),this.republish()}if(ie("NEW_ICE_RESTART")&&t instanceof Mh&&!Fr()&&!this._forceTurn){if(at(VG).call(VG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{x2(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Uc(this,Nt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Nt.RequestRestartICE,c))},o=()=>{x2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Nt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{HH(t,s,o)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&ie("ICE_RESTART")&&Uc(this,Nt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Nt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Nt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Nt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Ct.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(Nt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(jc(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(tS.FIRST_FRAME_DECODED),Ct.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(jc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Ct.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(jc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Ct.firstRemoteFrame(this.store.sessionId,Fi.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Nt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Vh(Vh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Mh&&function(r){vS.delete(r.id),GH(r)}(t),t.close(),this.emit(Nt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(He.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive||r.push([He.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o&&(r.push(o),o[0]===He.LocalVideoTrack)){const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&r.push([He.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(He.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive&&r.push([He.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o)if(o[0]===He.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&r.push([He.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoTrack:o=at(s=d._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoTrack:o=at(s=d._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:d}]=s;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let d=r.get(o);c===gt.VIDEO?d|=Bi.Video:d|=Bi.Audio,r.set(o,d)}else c===gt.VIDEO?r.set(o,Bi.Video):r.set(o,Bi.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(He.LocalVideoTrack),s=this.localTrackMap.get(He.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ut((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ut((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((o,c)=>{var d;let{stream_type:h}=o;const m=(d=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||d===void 0?void 0:d.attributes;if(m&&ie("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(at(y).call(y,dr.SCREEN_TRACK)||at(y).call(y,dr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof qr){var r;const o=this.filterTobeUnmutedTracks(t[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(o);return void await lr(this,Nt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Nt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Nt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await os(RL(this.dtlsFailedCount,wi)),this.emit(Nt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await bs(this,Nt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Nt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(He.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Sr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Sr).length>1)throw new xe(Q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof qr).length>1&&(t.some(r=>r instanceof qr&&r._bypassWebAudio)||!Mn().webAudioMediaStreamDest))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Sr&&this.pendingLocalTracks.some(s=>s instanceof Sr))throw new xe(Q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof qr&&this.pendingLocalTracks.some(s=>s instanceof qr)&&(!Mn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof qr&&s._bypassWebAudio)))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const o=!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding,c=Vh(Vh({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=o?t._mediaStreamTrack.clone():L2(t,c);const h=ur(8,"track-low-"),m=new Sr(d,Vh(Vh({},o&&{scaleResolutionDownBy:_2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(J_.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,Zv.LOW_STREAM)}),m._hints.push(dr.LOW_STREAM),at(s=t._hints).call(s,dr.SCREEN_TRACK)&&m._hints.push(dr.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(yt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Mh){var c,d,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:T,peerConnectionState:R}=this.connection,{local:P,remote:N}=await this.connection.getSelectedCandidatePair();Ct.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:T,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=P.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,o){var c;const d=Array.from(jc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){o||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Ct.firstRemoteVideoDecode(this.store.sessionId,Fi.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===He.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Zv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Et(hn.prototype,"startP2PConnection",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"startP2PConnection"),hn.prototype),Et(hn.prototype,"connect",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"connect"),hn.prototype),Et(hn.prototype,"updateRemoteRTPCapabilities",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"updateRemoteRTPCapabilities"),hn.prototype),Et(hn.prototype,"publishDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"publishDataChannel"),hn.prototype),Et(hn.prototype,"unpublish",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unpublish"),hn.prototype),Et(hn.prototype,"unpublishDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishDataChannel"),hn.prototype),Et(hn.prototype,"unpublishLowStream",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unpublishLowStream"),hn.prototype),Et(hn.prototype,"subscribeDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"subscribeDataChannel"),hn.prototype),Et(hn.prototype,"subscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"subscribe"),hn.prototype),Et(hn.prototype,"massSubscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"massSubscribe"),hn.prototype),Et(hn.prototype,"unsubscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribe"),hn.prototype),Et(hn.prototype,"unsubscribeDataChannel",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unsubscribeDataChannel"),hn.prototype),Et(hn.prototype,"massUnsubscribe",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"massUnsubscribe"),hn.prototype),Et(hn.prototype,"muteRemote",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"muteRemote"),hn.prototype),Et(hn.prototype,"unmuteRemote",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"unmuteRemote"),hn.prototype),Et(hn.prototype,"hasRemoteMediaWithLock",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"hasRemoteMediaWithLock"),hn.prototype),Et(hn.prototype,"disconnectForReconnect",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"disconnectForReconnect"),hn.prototype),Et(hn.prototype,"updateBitrateLimit",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"updateBitrateLimit"),hn.prototype),Et(hn.prototype,"remoteMediaSsrcChanged",[oo],Object.getOwnPropertyDescriptor(hn.prototype,"remoteMediaSsrcChanged"),hn.prototype),hn);function oo(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}function qH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function YH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?qH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):qH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const d_e=Date.now(),h_e=20,U2=new Map,n1=new Map;async function XH(t){const r=U2.get(t),s=Array.isArray(r)&&r[r.length-1],o=n1.get(t);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const d=s.sendTs-o.firstSendTs,h=d-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),JH(s.context,c),m=0):m=Math.min(m,h_e),setTimeout(()=>r.length&&XH(t),m)}function JH(t,r){t.safeEmit(_n.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function p_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return JH(s,{uid:t.uid,payload:t.payload});const o="".concat(s.id,"-").concat(t.uid),c=U2.get(o)||[],d=c.findIndex(v=>t.sendTs>=v.sendTs),h=YH(YH({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),U2.set(o,c);let m=!1;var y;n1.has(o)?m=!((y=n1.get(o))===null||y===void 0||!y.isSyncing):n1.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||XH(o)}const f_e=An().name;function QH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function ZH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?QH(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):QH(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const SS="websdk_ng_cache_parameter",m_e=ie("MAX_PRELOAD_ASYNC_LENGTH"),g_e=1e4,uy=new Map,dy=[];let V2=null,j2=0,F2=0;const r1=new Map,__e=function(t,r){const s=[];let o=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&o<r?c():o--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new ut(async(y,v)=>{s.push(async()=>{try{const T=await t(...h);y(T)}catch(T){v(T)}}),o<r&&(o++,c())})}}(e7,m_e),B2=Jo.CancelToken.source();async function e7(t,r,s,o,c,d){try{if(!ie("ENABLE_PRELOAD"))return;if(!Mn().supportWebCrypto)return void Wm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new xe(Q.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ss(s,"token",1,2047),ss(t,"appid",1,2047),DP(r),o&&xP(o);const h=Y_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:t,cname:r,token:s||t,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let y,v;typeof o=="string"?(m.stringUid=o,[v,y]=await ut.all([Zge(o,{sid:h,appId:t},B2.token),bH(ZH(ZH({},m),{},{token:s||t,uid:0}),B2.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),y=await bH(m,B2.token));const T={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||o,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let P;try{R.uid&&n7({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const N=o7(R),G=await async function(W,Y){try{const J=await window.crypto.subtle.importKey("raw",$W(Y),"AES-GCM",!1,["encrypt"]),le=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},J,q_(window.btoa(JSON.stringify(W))));return zm(new Uint8Array(le))}catch{return}}(R,R.token||R.appId);if(!G)return;P=s7(SS);const j=P?JSON.parse(P):[];j.push({[N]:G}),j.length>ie("AP_CACHE_NUM")&&j.shift(),i1(SS,JSON.stringify(j))}catch(N){x.warn("Error caching server parameters:",N.message),i1(SS,"")}}(T),j2++}catch(h){throw F2++,function(m){V2||(V2=window.setTimeout(()=>{let v="";r1.forEach((T,R)=>{v+="".concat(R,": ").concat(T," ;")}),Ct.reportApiInvoke(null,{name:Ti.PRELOAD,options:{success:j2,failed:F2,err:v}}).onError(m),j2=0,F2=0,r1.clear(),V2=null},g_e));const y=r1.get(m.code)||0;r1.set(m.code,y+1)}(h),h}}async function t7(t){try{if(ie("AP_REQUEST_DETAIL")||ie("ENABLE_ROLE_SELECT_EDGE"))return;const r=n7(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const d=await window.crypto.subtle.importKey("raw",$W(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,q_(o));return JSON.parse(window.atob(zm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<ie("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function n7(t){let r;try{if(r=s7(SS),!r)return;const s=JSON.parse(r),o=o7(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>o in h);if(c===-1)return;const d=s.splice(c,1)[0];return i1(SS,JSON.stringify(s)),d[o]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),i1(SS,"")}}function W2(t){if(t){let r=uy.get(t);r&&(window.clearTimeout(r),r=null,uy.delete(t)),at(dy).call(dy,t)||t.cloudProxyServer!=="disabled"||dy.push(t)}if(uy.size<ie("AP_CACHE_NUM")&&dy.length>0){const r=dy.shift();uy.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await __e(s,o,c,h,m,d),uy.has(r)&&W2(r)}catch(y){x.warn("update preload failed",y.message),r7(r)}},ie("AP_UPDATE_INTERVAL")))}}function r7(t){const r=dy.indexOf(t);r!==-1&&dy.splice(r,1);let s=uy.get(t);s&&(window.clearTimeout(s),s=null,uy.delete(t),W2())}function i7(t,r){const s=t.sua,o=t.ap;r&&s&&Ct.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Ct.reportResourceTiming(t.ap.url,t.sid),Ct.joinWebProxyAP(t.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[mi.CHOOSE_SERVER,mi.CLOUD_PROXY_FALLBACK].toString()}),Ct.joinChooseServer(t.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[mi.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function s7(t){return window.atob(window.localStorage.getItem(t)||"")}function i1(t,r){window.localStorage.setItem(t,window.btoa(r))}function o7(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),ZW(r)}function y_e(t){let r=function(){const s=S_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(yi(o,10),Zm(o,c));let d=s.cid;d!==void 0&&(yi(o,16),yi(o,d));let h=s.cname;h!==void 0&&(yi(o,26),Zm(o,h));let m=s.deviceId;m!==void 0&&(yi(o,34),Zm(o,m));let y=s.elapse;y!==void 0&&(yi(o,40),eg(o,y));let v=s.fileSize;v!==void 0&&(yi(o,48),eg(o,bS(v)));let T=s.height;T!==void 0&&(yi(o,56),eg(o,bS(T)));let R=s.jpg;R!==void 0&&(yi(o,66),yi(o,R.length),c7(o,R));let P=s.networkType;P!==void 0&&(yi(o,72),eg(o,bS(P)));let N=s.osType;N!==void 0&&(yi(o,80),eg(o,bS(N)));let G=s.requestId;G!==void 0&&(yi(o,90),Zm(o,G));let j=s.sdkVersion;j!==void 0&&(yi(o,98),Zm(o,j));let W=s.sequence;W!==void 0&&(yi(o,104),eg(o,bS(W)));let Y=s.sid;Y!==void 0&&(yi(o,114),Zm(o,Y));let J=s.timestamp;J!==void 0&&(yi(o,120),eg(o,J));let le=s.uid;le!==void 0&&(yi(o,128),yi(o,le));let _e=s.vid;_e!==void 0&&(yi(o,136),yi(o,_e));let Ee=s.width;Ee!==void 0&&(yi(o,144),eg(o,bS(Ee)));let ge=s.service;ge!==void 0&&(yi(o,152),yi(o,ge));let Ne=s.callbackData;Ne!==void 0&&(yi(o,162),yi(o,Ne.length),c7(o,Ne));let qe=s.ticket;qe!==void 0&&(yi(o,170),Zm(o,qe));let dt=s.vendorConfigs;dt!==void 0&&(yi(o,178),Zm(o,dt))}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function E_e(t){return function(s){let o={};e:for(;!b_e(s);){let c=ZT(s);switch(c>>>3){case 0:break e;case 1:o.code=ZT(s);break;case 2:o.msg=l7(s,ZT(s));break;case 3:o.requestId=l7(s,ZT(s));break;case 4:o.timestamp=T_e(s,!1);break;default:v_e(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function v_e(t,r){switch(r){case 0:for(;128&wu(t););break;case 2:z2(t,ZT(t));break;case 5:z2(t,4);break;case 1:z2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function bS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let S_e=[];function z2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function b_e(t){return t.offset>=t.limit}function s1(t,r){let s=t.bytes,o=t.offset,c=t.limit,d=o+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),o}function a7(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function c7(t,r){let s=s1(t,r.length);t.bytes.set(r,s)}function l7(t,r){let s=a7(t,r),o=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,T,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&P)<<6|63&y,R<128?h+=d:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],T=c[m+s+3],(12632256&(y|v<<8|T<<16))!=8421504?h+=d:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&T,R<65536||R>1114111?h+=d:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function Zm(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}yi(t,o);let c=s1(t,o),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function wu(t){return t.bytes[a7(t,1)]}function u7(t,r){let s=s1(t,1);t.bytes[s]=r}function ZT(t){let r,s=0,o=0;do r=wu(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function yi(t,r){for(r>>>=0;r>=128;)u7(t,127&r|128),r>>>=7;u7(t,r)}function T_e(t,r){let s,o=0,c=0,d=0;return s=wu(t),o=127&s,128&s&&(s=wu(t),o|=(127&s)<<7,128&s&&(s=wu(t),o|=(127&s)<<14,128&s&&(s=wu(t),o|=(127&s)<<21,128&s&&(s=wu(t),c=127&s,128&s&&(s=wu(t),c|=(127&s)<<7,128&s&&(s=wu(t),c|=(127&s)<<14,128&s&&(s=wu(t),c|=(127&s)<<21,128&s&&(s=wu(t),d=127&s,128&s&&(s=wu(t),d|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|d<<24,unsigned:r}}function eg(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=s1(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=d!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=d!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=d!==5?128|o:127&o;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const d7={},h7={},o1=4294967296,w_e=o1*o1,C_e=w_e/2;f7(0,!0);const p7=f7(0),R_e=ew(0,-2147483648,!1),I_e=ew(-1,2147483647,!1);function f7(t,r){let s,o,c;return r?(c=0<=(t>>>=0)&&t<256)&&(o=h7[t],o)?o:(s=ew(t,0,!0),c&&(h7[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(o=d7[t],o)?o:(s=ew(t,t<0?-1:0,!1),c&&(d7[t]=s),s)}function ew(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function m7(t,r){if(isNaN(t))return p7;{if(t<=-9223372036854776e3)return R_e;if(t+1>=C_e)return I_e}return t<0?p7:ew(t%o1|0,t/o1|0,r)}function g7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}class G2 extends Mr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Pd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",Al.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Jo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==Al.CONNECTED)throw new Oe(Q.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Al.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ur(5,"image-moderation-"),this._workerMessageLengthLimit=ie("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=ie("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=ie("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new zT("worker-"+this._moderationId,wi),this.on(Pd.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(dS[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Pd.STATE_CHANGE,dS.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ut((c,d)=>{this.on(Pd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Al.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Al.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=ie("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),d=await function(y,v,T,R){let{appId:P,areaCode:N,cname:G,sid:j,token:W,uid:Y}=v;_S++;const J="moderation_plugin",le={service_name:J,json_body:JSON.stringify({appId:P,areaCode:N,cname:G,command:"allocateEdge",requestId:_S,seq:_S,sid:j,appToken:W,ts:Date.now(),uid:Y+""})};let _e,Ee,ge=y[0];return Cd(async()=>{_e=Date.now();const Ne=await Od(ge,{data:le,cancelToken:T,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-_e,Ne.code!==0){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:Ee});throw x.error(ft.toString()),ft}const qe=JSON.parse(Ne.json_body);if(qe.code!==200){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(qe.code,", reason: ").concat(qe.reason),{code:qe.code,responseTime:Ee});throw x.error(ft.toString()),ft}if(!qe.servers||!Array.isArray(qe.servers)||qe.servers.length===0){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:qe.code,responseTime:Ee});throw x.error(ft.toString()),ft}if(!qe.servers.some(ft=>!!ft.wss)){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:qe.code,responseTime:Ee});throw x.error(ft.toString()),ft}const dt=ie("IMAGE_MODERATION_WORKER_HOST");return{addressList:qe.servers.map(ft=>{let{address:Sn,wss:bn}=ft;if(Sn&&bn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(dt,":").concat(bn,"/moderation")}).filter(ft=>!!ft),workerToken:qe.workerToken,vid:qe.vid,ticket:qe.appTicket,responseTime:Ee}},(Ne,qe)=>(Ct.apworkerEvent(j,{success:!0,sc:200,serviceName:J,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:qe===0,responseTime:Ee,serverIp:y[qe%y.length]}),!1),(Ne,qe)=>(Ct.apworkerEvent(j,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:J,responseTime:Ee,serverIp:y[qe%y.length]}),!!(Ne.code!==Q.OPERATION_ABORTED&&Ne.code!==Q.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(ge=y[(qe+1)%y.length],!0)),R)}(c,r,s,o);this.emit(Pd.STATE_CHANGE,dS.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(Pd.STATE_CHANGE,dS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Xt.CONNECTED,async()=>{this.emit(Pd.STATE_CHANGE,dS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Al.CONNECTED}),this._workerConnection.on(Xt.CLOSED,()=>{this.connectionState=Al.CLOSED}),this._workerConnection.on(Xt.FAILED,()=>{this.connectionState=Al.CLOSED}),this._workerConnection.on(Xt.RECONNECTING,()=>{this.connectionState=this.connectionState===Al.CONNECTED?Al.RECONNECTING:Al.CONNECTING}),this._workerConnection.on(Xt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=E_e(new Uint8Array(r.data));ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ct.reportApiInvoke(this._connectInfo.sid||null,{name:Ti.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Wr.TRACER}).onError(new Oe(Q.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},ie("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Xt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(Xt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Uc(this,Pd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),T=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await Wz(T,o,c),P=this._sequence+"-"+d+"-"+y+"-"+v+"-"+ur(12,""),N={appId:o,cid:d,cname:c,deviceId:"",elapse:G2.intToLong(Number(v-this._moderationStartTime)),fileSize:T.buffer.byteLength,height:T.height,width:T.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:m7(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const G=y_e(N);if(G.byteLength<this._workerMessageLengthLimit){if(ie("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(W){for(var Y=1;Y<arguments.length;Y++){var J=arguments[Y]!=null?arguments[Y]:{};Y%2?g7(Object(J),!0).forEach(function(le){K(W,le,J[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(J)):g7(Object(J)).forEach(function(le){Object.defineProperty(W,le,Object.getOwnPropertyDescriptor(J,le))})}return W}({},N);delete j.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return G}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Jo.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Al.CLOSED,this.emit(Pd.STATE_CHANGE,dS.CLOSED)}}function _7(t){if(rr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(Q.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(Q.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const A_e={name:"ImageModeration",create:function(t){let{config:r}=t;return _7(r),new G2(r)}};var y7,E7,v7,S7,b7,T7,w7,C7,R7,I7,A7,P7,O7,k7,N7,D7,x7,L7,M7,U7,V7,j7,F7,B7,W7,z7,G7,H7,$7,K7,q7,Y7,X7,J7,Q7,Z7,e$,t$,n$,r$,i$,pt;function s$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Cu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?s$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):s$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}Os.setLogger(x);let P_e=(y7=Vt(),E7=Vt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof rS))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),v7=Vt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==nS.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),S7=Vt({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),b7=Vt({argsMap:(t,r,s)=>[r,s]}),T7=Vt({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),w7=Vt({argsMap:(t,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),C7=Vt({argsMap:(t,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),R7=Vt(),I7=Vt(),A7=Vt(),P7=Vt(),O7=Vt(),k7=Vt(),N7=Vt(),D7=Vt(),x7=Vt(),L7=Vt(),M7=Vt(),U7=Vt(),V7=Vt(),j7=Vt(),F7=Vt(),B7=Vt({argsMap:(t,r)=>[r]}),W7=Vt(),z7=Vt(),G7=Vt(),H7=Vt(),$7=Vt(),K7=Vt(),q7=Vt(),Y7=Vt(),X7=Vt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),J7=Vt(),Q7=Vt(),Z7=Vt(),e$=Vt(),t$=Vt(),n$=Vt(),r$=Vt({reportResult:!0}),i$=Vt(),pt=class extends Mr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",Jo.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),K(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),K(this,"_handleUserOnline",c=>{if(ie("BLOCK_LOCAL_CLIENT")&&ry(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(_n.USER_JOINED,d));else{const h=new Jm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(_n.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(ie("BLOCK_LOCAL_CLIENT")&&ry(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:cP(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(_n.USER_LEAVED,d,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,d,h,m,y,v,T)=>{if(ie("BLOCK_LOCAL_CLIENT")&&ry(d,this.channelName))return;const R=this._users.find(N=>N.uid===d);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||d),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),T!==void 0&&(R._rtxSsrcId=T),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(_n.USER_PUBLISHED,R,c)),c==="video"?Ct.onGatewayStream(this._sessionId,Fi.ON_ADD_VIDEO_STREAM,kr.ON_ADD_VIDEO_STREAM,{peer:y||d,ssrc:R._videoSSRC}):Ct.onGatewayStream(this._sessionId,Fi.ON_ADD_AUDIO_STREAM,kr.ON_ADD_AUDIO_STREAM,{peer:y||d,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(N=>{if(N&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof QT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(N=>{x.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),K(this,"_handleRemoveStream",c=>{if(ie("BLOCK_LOCAL_CLIENT")&&ry(c.uid,this.channelName))return;const d=this._users.find(m=>m.uid===c.uid);if(!d)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(_n.USER_UNPUBLISHED,d,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(_n.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(_n.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(_n.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof QT&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Ct.onGatewayStream(this._sessionId,Fi.ON_REMOVE_STREAM,kr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(ie("BLOCK_LOCAL_CLIENT")&&ry(d,this.channelName))return;const m=this._users.find(T=>T.uid===d);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const T=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===T)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,d,R)}}else{m._trust_video_enabled_state_=!0;const T=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===T)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,d,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(_n.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(_n.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,d,h)=>{if(ie("BLOCK_LOCAL_CLIENT")&&ry(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find(T=>T.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const T=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===T)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const T=m._video_muted_;if(m._video_muted_=h,m._video_muted_===T)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(_n.USER_INFO_UPDATED,c,R)}}const v=d==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(_n.USER_PUBLISHED,m,d)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(_n.USER_UNPUBLISHED,m,d)}}),K(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(_n.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(_n.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(_n.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,m)=>{const y=this._users.find(T=>T.uid===d);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(_n.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(T=>{x.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._config=t,this._clientId=r||ur(5,"client-"),this.store=new class{constructor(c,d,h,m){$t(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:X_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case yn.SET_SESSION_ID:return mt(mt({},d),{},{sessionId:h.sessionId});case yn.SET_P2P_ID:return mt(mt({},d),{},{p2pId:h.p2pId});case yn.SET_UID:return mt(mt({},d),{},{uid:h.uid});case yn.SET_INT_UID:return mt(mt({},d),{},{intUid:h.intUid});case yn.SET_PUB_ID:return mt(mt({},d),{},{pubId:h.pubId});case yn.KEY_METRIC_CLIENT_CREATED:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{clientCreated:h.metric})});case yn.KEY_METRIC_JOIN_START:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{joinStart:h.metric})});case yn.AVOID_JOIN_START:return mt(mt({},d),{},{avoidJoinStart:h.avoidJoinStart});case yn.KEY_METRIC_JOIN_END:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{joinEnd:h.metric})});case yn.KEY_METRIC_REQUEST_AP_START:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{requestAPStart:h.metric})});case yn.KEY_METRIC_REQUEST_AP_END:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{requestAPEnd:h.metric})});case yn.KEY_METRIC_JOIN_GATEWAY_START:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case yn.KEY_METRIC_JOIN_GATEWAY_END:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case yn.KEY_METRIC_PEER_CONNECTION_START:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case yn.KEY_METRIC_PEER_CONNECTION_END:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case yn.KEY_METRIC_DESCRIPTION_START:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{descriptionStart:h.metric})});case yn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case yn.KEY_METRIC_ICE_CONNECTION_END:return mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case yn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=mt(mt({},m[y]),h.metric),mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{publish:[...m]})})):mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case yn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=mt(mt({},m[y]),h.metric),mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{subscribe:[...m]})})):mt(mt({},d),{},{keyMetrics:mt(mt({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case yn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case yn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=mt(mt({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case yn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case yn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case yn.SET_USE_P2P:return mt(mt({},d),{},{useP2P:h.val});case yn.SET_TRANSPORT_TYPE:return mt(mt({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set sessionId(c){this.dispatch({type:yn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:yn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:yn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:yn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:yn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:yn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:yn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:yn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:yn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:yn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:yn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:yn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:yn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:yn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:yn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:yn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:yn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:yn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:yn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:yn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:yn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:yn.KEY_METRIC_PUBLISH,metric:mt(mt({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,y,v,T){this.dispatch({type:yn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt(mt(mt({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),T&&{firstDecoded:T})})}massSubscribe(c,d,h,m){c.forEach(y=>{this.dispatch({type:yn.KEY_METRIC_SUBSCRIBE,metric:mt(mt(mt({userId:y.userId,type:y.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:yn.RECORD_JOIN_CHANNEL_SERVICE,record:mt(mt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:yn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:yn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:yn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:yn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Os("client-leave",this._clientId),this._publishMutex=new Os("client-publish",this._clientId),this._renewTokenMutex=new Os("client-renewtoken",this._clientId),this._subscribeMutex=new Os("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Cl," build: ").concat(ML,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{TL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new XT(this.store),this._statsCollector.onStatsException=(c,d,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(_n.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&Ct.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Kge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||wi,httpRetryConfig:t.httpRetryConfig||wi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new r_e(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},ff("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new QT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,o,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];er("JOIN_GATEWAY_USE_443PORT_ONLY",d),er("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof m2&&(m.use443PortOnly=d,m.tryDoubleDomain=h),async function(y,v,T){rP.get(y)||rP.set(y,[]),iP.get(y)||iP.set(y,v),Ah.get(y)||Ah.set(y,0);const R=rP.get(y),P=iP.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ah.get(y)===P){const Y=IT();R.push(Y),await Y.promise}Ah.set(y,Ah.get(y)+1);for(var N=arguments.length,G=new Array(N>3?N-3:0),j=3;j<N;j++)G[j-3]=arguments[j];const W=await T(...G);return Ah.set(y,Ah.get(y)-1),Ah.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),Ah.get(y)===0&&(rP.set(y,[]),iP.set(y,0),Ah.set(y,0)),W}("client.join",ie("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,o,c)}async join(t,r,s,o,c){const d=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(dP||dP||(dP=(window.location.protocol.split(":")[0]||"").toUpperCase(),dP))==="HTTPS",m=nz()?window.isSecureContext:"Browser Not Support";(!nz()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Ct.setAppId(t);try{if(!s&&s!==null)throw new Oe(Q.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&ss(s,"token",1,2047),ss(t,"appid",1,2047),DP(r),o&&xP(o),c&&ss(c,"optionalInfo",1,2047)}catch(j){throw Ct.reportApiInvoke(Y_(),{name:Ti.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ct.reportApiInvoke(Y_(),{name:Ti.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}).onError(j),j}this._gateway.state="CONNECTING";const y=await t7({appId:t,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||Y_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const T=Ct.reportApiInvoke(v,{id:this._clientId,name:Ti.JOIN,options:[t,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Wr.TRACER}),R=Cu(Cu(Cu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:ie("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async j=>{const W=function(_e){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ge=new Uint8Array(new ArrayBuffer(Ee.length));for(let Ne=0;Ne<Ee.length;Ne+=1)ge[Ne]=Ee.charCodeAt(Ne);return ge}(),Y=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=SL(j),le=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,J);return function(_e){let Ee="";for(let ge=0;ge<_e.length;ge+=1)Ee+=String.fromCharCode(_e[ge]);return window.btoa(Ee)}(new Uint8Array(le))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,W=ie("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(R.appId+this._encryptionSecret+this._encryptionSecret):j.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,J,le){const _e=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=Y==="aes-128-gcm2"?128:256,ge=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:hz,hash:"SHA-256",salt:le},_e,Ee+Tme);return new Uint8Array(ge).subarray(Ee/8)}(this._encryptionMode,W,q_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,J,le){const _e=await window.crypto.subtle.importKey("raw",J,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:hz,hash:"SHA-256",salt:le},_e,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,W,q_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Ct.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let j;const W=R.cloudProxyServer;if(at(N=["proxy3","proxy4","proxy5"]).call(N,W)){const Ee=ie("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(Ct.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},ie("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await KG(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(ge=>({turnServerURL:ge.address,tcpport:ge.tcpport||Ts.tcpport,udpport:ge.udpport||Ts.udpport,username:ge.username||Ts.username,password:ge.password||Ts.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}i7(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,j]=await ut.all([SH(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,this.store),vH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,j.gatewayInfo.uid=Ee,j.gatewayInfo.res.uid=Ee}else j=await vH(R,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(BT.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(BT.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=s||t;const Y=j.gatewayInfo,J=R.uid?R.uid:Y.uid;this._joinInfo=Cu(Cu({},R),{},{cid:Y.cid,uid:J,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=J,this.store.cid=Y.cid;const le=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));T.onSuccess(le),this._appId=t,this._channelName=R.cname,this._uid=le,this.store.uid=le,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,at(ny).call(ny,G)||ny.push(G),this._cloudProxyServerMode==="disabled"&&Mn().supportWebCrypto&&ie("ENABLE_PRELOAD")&&W2(this._joinInfo),le}catch(j){const W=Array.isArray(j)?j[0]:j;throw W&&W.code===Q.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W):x.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W),W.code!==Q.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),T.onError(W),W}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(Q.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!ie("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=ny.indexOf(r);s!==-1&&ny.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",$n.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof rS))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(Q.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(Q.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof rS))throw new Oe(Q.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(Q.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Sr&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(t){rr(t.id,"id",0,65535,!0),af(t.ordered,"ordered"),ss(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(Q.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(Q.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ie("FORCE_TURN")&&!ie("TURN_ENABLE_TCP")&&!ie("TURN_ENABLE_UDP"))throw new Oe(Q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return dH(c,!1)}(t),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(Q.CREATE_DATACHANNEL_ERROR);try{await ut.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==Q.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(Q.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof rS))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(oi.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(o=>"".concat(o.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof Jm)){const o=this.remoteUsers.find(c=>c.uid===t);if(!o)throw new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");t=o}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(xi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(Q.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===gt.AUDIO,o=r===gt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new Oe(Q.UNEXPECTED_RESPONSE,"no ssrc id");let T=this._users.find(P=>P.uid===t);T||(T=new Jm(t,v||t),T._is_pre_created=!0,this._users.push(T)),y&&(T._cname=y),T._uintid||(T._uintid=v||t),s&&(T._audioSSRC=d,T._audio_pre_subscribed=!0,h&&(T._audioOrtc=h)),o&&(T._videoSSRC=d,T._video_pre_subscribed=!0,h&&(T._videoOrtc=h),m!=null&&(T._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(T,r,d,m,h);const R=s?T._audioTrack:T._videoTrack;if(!R)throw new Oe(Q.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(T._trust_audio_stream_added_state_=!0,T._audio_added_=!0),o&&(T._trust_video_stream_added_state_=!0,T._video_added_=!0),R}catch(d){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(rr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(Q.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(Q.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&at(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(Q.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==Q.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(xi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new Oe(Q.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new Oe(Q.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new Oe(Q.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(xi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Oe(Q.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Oe(Q.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const T=r==="audio"?t._audioSSRC:t._videoSSRC;T!==void 0&&T!==c&&(c=T,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?gt.AUDIO:gt.VIDEO,ssrcId:c}),Ds.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==Q.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(T){throw this._p2pChannel.reportSubscribeEvent(!1,T==null?void 0:T.code,t,r),T}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(T=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),T)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Oe(Q.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(cf(t,"subscribeList"),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),d=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:T,mediaType:R}=v;if(xi(R,"mediaType",["audio","video"]),!T){const j=new Oe(Q.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===T)){const j=new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(T.uid,", this user is not in the channel")),c[y].error=j,t.splice(y,1);continue}if(R==="audio"&&(!T.hasAudio||T._audioSSRC===void 0)||R==="video"&&(!T.hasVideo||T._videoSSRC===void 0)){const j=new Oe(Q.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(T.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=j,t.splice(y,1);continue}const N=Bi.Video|Bi.LwoVideo,G=s.get(T);if(G){if(R==="video"?G&N:G&Bi.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(T.uid,", mediaType:").concat(R," twice"));continue}s.set(T,G|(R==="video"?N:Bi.Audio))}else s.set(T,R==="video"?N:Bi.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:T,mediaType:R}=v,P=Bi.Video|Bi.LwoVideo;if(this._p2pChannel.hasRemoteMedia(T,R)){await this._p2pChannel.unmuteRemoteNoLock(T,R);const N=s.get(T);s.set(T,R==="video"?N^P:N^Bi.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=Ya(h=Array.from(s.entries())).call(h,(y,v)=>{let[T,R]=v;if(R===0)return y;const P={stream_id:T.uid,stream_type:R};return R&Bi.Audio&&(P.audio_ssrc=T._audioSSRC),R&Bi.Video&&(P.video_ssrc=T._videoSSRC),y.push(P),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:T,mediaType:R}=v;return{user:T,mediaType:R,ssrcId:R===gt.VIDEO?T._videoSSRC:T._audioSSRC,rtxSsrcId:R===gt.VIDEO?T._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(T=>{let{stream_id:R,video_error_code:P,audio_error_code:N,error_code:G}=T;(P||N||G)&&y.set(R,{video_error_code:P,audio_error_code:N,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(T=>{let[R,P]=T;const N=this.remoteUsers.find(G=>G.uid===R);if(N){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=gt.VIDEO:P.audio_error_code&&(G=gt.AUDIO),v.push({user:N,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const T=y.get(v.user.uid);if(T){const R=T.error_code||v.mediaType==="audio"&&T.audio_error_code||v.mediaType==="video"&&T.video_error_code;if(R){const P=WT(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(P.desc)),v.error=new Oe(Q.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var T;Ct.subscribe(this.store.sessionId,{succ:!!v.error,ec:((T=v.error)===null||T===void 0?void 0:T.code)||null,video:v.mediaType===gt.VIDEO,audio:v.mediaType===gt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===gt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:T,mediaType:R}=v;return"user: ".concat(T==null?void 0:T.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{d(),o()}}async unsubscribe(t,r,s){if(!(t instanceof Jm)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&xi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&cP(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===Q.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&rr(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(Q.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(o=[c])}else o=t._dataChannels;if(o===void 0){const c=new Oe(Q.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,o);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===Q.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(cf(t,"unsubscribeList"),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:o,mediaType:c}=t[s];if(!o){const m=new Oe(Q.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(xi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),t.splice(s,1);continue}const h=Bi.Video|Bi.LwoVideo;if(r.has(o)){const m=r.get(o);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&Bi.Audio;break;default:y=m&(Bi.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(o,m|Bi.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Bi.Audio|h)}else c?c==="audio"?r.set(o,Bi.Audio):c==="video"&&r.set(o,h):r.set(o,Bi.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(o=>{let{user:c,mediaType:d}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===Q.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new xe(Q.INVALID_PARAMS);Br(s.width)||EL(s.width,"streamParameter.width"),Br(s.height)||EL(s.height,"streamParameter.height"),Br(s.framerate)||EL(s.framerate,"streamParameter.framerate"),Br(s.bitrate)||rr(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,He.LocalVideoLowTrack)}async enableDualStream(){if(!Mn().supportDualStream)throw Ct.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(Q.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(Q.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Ct.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Ct.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(He.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Ct.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Ct.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(o){xi(o,"role",["audience","host"])}(t),r&&TL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(Q.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(Q.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(Q.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&ie("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Ss.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&TL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(ss(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(Q.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(Q.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Ct.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(Q.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(Q.INVALID_OPERATION,"You have already set the proxy")}if(NT(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>GW(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(Q.INVALID_OPERATION,"you should set license before join channel");if(ss(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(Q.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(Q.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(Q.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(Q.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(Q.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(Q.INVALID_OPERATION,"Stop proxy server after leave channel");Ct.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(Q.INVALID_PARAMS,"accessPoints is required.");cf(t.accessPoints.serverList,"accessPoints.serverList"),ss(t.accessPoints.domain,"accessPoints.domain");const r=(P,N)=>{rr(P,N,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(Q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");ie("CLOSE_AFB_FOR_LOCAL_AP")&&(er("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),er("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=d.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,er("WEBCS_DOMAIN",h),er("WEBCS_DOMAIN_BACKUP_LIST",h),er("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(cf(t.report.hostname,"report.hostname"),er("EVENT_REPORT_DOMAIN",t.report.hostname[0]),er("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(er("EVENT_REPORT_DOMAIN",d[0]),er("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),er("STATS_COLLECTOR_PORT",m),t.report?er("ENABLE_EVENT_REPORT",!0):er("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(cf(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=d[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),er("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let T=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(cf(t.cds.hostname,"cds.hostname"),T=t.cds.hostname):T=d;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),er("CDS_AP",T.map(P=>"".concat(P,":").concat(R))),t.cds?er("ENABLE_CONFIG_DISTRIBUTE",!0):er("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(cf(t,"serverList"),ss(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(Q.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,er("WEBCS_DOMAIN",t),er("WEBCS_DOMAIN_BACKUP_LIST",t),er("GATEWAY_DOMAINS",[r]),er("EVENT_REPORT_DOMAIN",t[0]),er("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),er("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(xi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){xi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){xi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,o){(function(d){xi(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ss(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(at(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(Q.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(Q.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(af(o,"encryptDataStream"),!at(c).call(c,t))throw new Oe(Q.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=zm(s))}async renewToken(t){if(ss(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(ie("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await n_e(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wi);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(_n.VOLUME_INDICATOR,t)},ie("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(Q.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(Q.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(Q.LIVE_STREAMING_TASK_CONFLICT);const s=r?df.TRANSCODE:df.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(df.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(Q.INVALID_PARAMS,"can not find live streaming url to stop");await ut.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){AH(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){AH(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof QT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&at(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,t.payload=await async function(c,d,h){var m;const y=Ya(m=Array.from(h)).call(m,(j,W)=>j+W,0),v={serverTs:0,seq:wme++,length:h.length,checkSum:y},T=new Uint8Array(QW(y,2)),R=new ArrayBuffer(Xv),P=new DataView(R);P.setUint32(0,v.serverTs),P.setUint16(4,v.seq),P.setUint16(6,v.length),P.setUint16(8,v.checkSum);const N=16-h.length%16;h=KW(h,new Uint8Array(N));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:dz,additionalData:T},d,h);return KW(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(Q.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Wt.DATA_STREAM,{payload:zm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-d_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(Q.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Wt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:zm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Dme),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"can not send custom report, not joined");await Ct.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){xi(r.spatialLayer,"spatialLayer",[0,1,2,3]),xi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(af(r,"apRTM"),rr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=lS.indexOf(t);r!==-1&&lS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Jo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&r7(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ct.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Os("client-publish",this._clientId),this._subscribeMutex=new Os("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const o=t||Y_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=t?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Ct.addSid(o);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Ct.sessionInit(this._sessionId,Cu({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(Q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&ie("FORCE_TURN")&&!ie("TURN_ENABLE_TCP")&&!ie("TURN_ENABLE_UDP"))throw new Oe(Q.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(oi.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(d){if(d.code!==Q.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Sr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===Q.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(Q.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(Q.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(d){if(d.code!==Q.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===Q.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(Q.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ff("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,d)=>{Ct.reportApiInvoke(this._sessionId,{name:Ti.ON_LIVE_STREAM_ERROR,options:[c,d],tag:Wr.TRACER}).onSuccess(),this.safeEmit(_n.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Ct.reportApiInvoke(this._sessionId,{name:Ti.ON_LIVE_STREAM_WARNING,options:[c,d],tag:Wr.TRACER}).onSuccess(),this.safeEmit(_n.LIVE_STREAMING_WARNING,c,d)},s.on(p2.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Oe(Q.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,T){const R=ie("UAP_AP").slice(0,ie("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Xge(R,m,y,v,T)})(c,this._joinInfo,this._axiosCancelSource.token,wi).then(d).catch(h)}),s};return t===df.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(Q.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},ff("ChannelMediaRelay").create(t));o.on("state",c=>{c===Ia.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(_n.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(_n.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:o}=t,c=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:T}=d,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),at(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===d.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:v,metadata:T},N=function(G){return dH(G,!0)}(P);R._dataChannels.push(N),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(_n.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,d.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,d.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(_n.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(d=>{const{uid:h,stream_id:m}=d,y=this._users.find(T=>T._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(T=>T.id===d.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(T=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),T)return this._gateway.unsubscribeDataChannel(T,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(_n.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(_n.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(es.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:d,expires:h}=r[o];h&&h<=s||d||o2()||!Object.prototype.hasOwnProperty.call(fP,o)||(Rd[o]=c,vr[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(es.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(es.CONNECTION_STATE_CHANGE,(t,r,s)=>{var o;if(s===$n.FALLBACK)return;const c=()=>{this.safeEmit(_n.CONNECTION_STATE_CHANGE,t,r,s)};if(Ct.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Ti.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Wr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,gt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(es.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(Q.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await t7(Cu(Cu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,i7(o),this._joinInfo.preload=!0):(s=await P2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||wi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(es.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(_n.NETWORK_QUALITY,t)}),this._gateway.on(es.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(_n.STREAM_TYPE_CHANGED,t,r),Ct.reportApiInvoke(this._sessionId,{name:Ti.STREAM_TYPE_CHANGE,options:[t,r],tag:Wr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(es.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(es.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();ie("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(t)),r(o)}catch(o){s(o)}}),this._gateway.on(es.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=ZG(t.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(es.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:d}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(d,"_").concat(c),icePwd:"".concat(d,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=ie("FINGERPRINT"))!==null&&o!==void 0?o:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(En.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(En.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(En.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(En.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(En.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(En.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(En.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(En.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(En.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,gt.AUDIO,!0)),this._gateway.signal.on(En.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,gt.AUDIO,!1)),this._gateway.signal.on(En.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,gt.VIDEO,!0)),this._gateway.signal.on(En.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,gt.VIDEO,!1)),this._gateway.signal.on(En.RECEIVE_METADATA,t=>{const r=q_(t.metadata);this.safeEmit(_n.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(En.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=q_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&at(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Xv)throw new Oe(Q.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Xv));s=await async function(d,h,m){const y=m.subarray(0,Xv),v=y.slice(8,Xv),T=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:dz,additionalData:new Uint8Array(QW(T,2))},h,m.subarray(Xv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),p_e(Cu(Cu({},t),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(En.ON_CRYPT_ERROR,()=>{Wm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(_n.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,$n.TOKEN_EXPIRE),this.safeEmit(_n.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(En.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(_n.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(En.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(En.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(En.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(zt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Wt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const d=c.some(y=>{let{stream_type:v}=y;return v===qn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==qn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===qn.Screen||v===qn.ScreenLow});r.state==="offer"&&Ct.publish(this._joinInfo.sid,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Q.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find(y=>{let{stream_type:v}=y;return v===qn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(y=>{let{stream_type:v}=y;return v!==qn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Wt.SUBSCRIBE:r&&Ct.subscribe(this._joinInfo.sid,{succ:!1,ec:Q.TIMEOUT,audio:r.stream_type===gt.AUDIO,video:r.stream_type===gt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Ds.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(En.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(En.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;ie("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(o=>!ry(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of t.users){let c=this._users.find(T=>T._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Jm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(_n.USER_JOINED,c)));const d=Bi.Audio&o.stream_type,h=(Bi.Video|Bi.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,y=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),d&&!y&&this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(_n.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(_n.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(_n.USER_PUBLISHED,c,"video")),(d&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(_n.PUBLISHED_USER_LIST).length>0?ie("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(_n.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(En.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof QT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return at(o=Object.keys(mP)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(En.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oi.PUBLISH,(t,r,s)=>{const{uid:o}=t;t.forEach(c=>{const{kind:d,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(d,o,h[0].ssrcId,m);const v=this._users.find(T=>T.uid===o);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,d,!!y)})}),this._gateway.signal.on(oi.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(zt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(oi.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=t,d=this._users.find(h=>h.uid===c);if(!d)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const y=m===qn.Audio?gt.AUDIO:gt.VIDEO;await this._p2pChannel.unsubscribe(d,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(oi.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case $m.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,gt.VIDEO,!0);break;case $m.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,gt.AUDIO,!0);break;case $m.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,gt.VIDEO,!1);break;case $m.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,gt.AUDIO,!1)}}),this._gateway.signal.on(oi.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=t;o!==Po.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(oi.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(Nt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:o}=t;r(await this._gateway.sendExtensionMessage(oi.RESTART_ICE,t,o===Po.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(Nt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(oi.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Nt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(oi.CONTROL,t,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(Nt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Q.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Q.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.StateChange,(t,r)=>{r===Kn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Nt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(_n.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(Nt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Q.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Q.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(Nt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(Nt.RequestRePublishDataChannel,(t,r,s)=>{ut.all(t.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==Q.DISCONNECT_P2P)throw d}})).then(r).catch(s)}),this._p2pChannel.on(Nt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:o,kind:c}of t)c===gt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(Nt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(Nt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Nt.MediaReconnectStart,t=>{this.safeEmit(_n.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Nt.MediaReconnectEnd,t=>{this.safeEmit(_n.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Nt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Nt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:d}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(Nt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Nt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=ZG(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Nt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(Nt.P2PLost,()=>{this.safeEmit(_n.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Nt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Nt.ConnectionTypeChange,t=>{this.safeEmit(_n.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Nt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Nt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(Nt.AudioMetadata,t=>{this.safeEmit(_n.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},ff("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:d,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:y,vid:v?Number(v):0},wi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(ts.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(_n.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Su.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(_n.CONTENT_INSPECT_ERROR,new Oe(Q.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(ts.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===Q.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(_n.CONTENT_INSPECT_RESULT,r,s)}),t.on(ts.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(af(t,"enabled"),t){if(!r)throw new Oe(Q.INVALID_PARAMS,"config is required");if(_7(r),!this._joinInfo)throw new Oe(Q.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},ff("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:d,sid:h,token:m,uid:y,cid:v,vid:T}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:y,cid:v,vid:T?Number(T):0},wi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Oe(Q.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(t){t.on(Pd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(_n.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Al.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(Q.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Pd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){xi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(Q.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){af(t,"enabled"),er("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Et(pt.prototype,"leave",[y7],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),Et(pt.prototype,"publish",[E7],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),Et(pt.prototype,"unpublish",[v7],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),Et(pt.prototype,"subscribe",[S7],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),Et(pt.prototype,"presubscribe",[b7],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),Et(pt.prototype,"massSubscribe",[T7],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),Et(pt.prototype,"unsubscribe",[w7],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),Et(pt.prototype,"massUnsubscribe",[C7],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),Et(pt.prototype,"setLowStreamParameter",[R7],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),Et(pt.prototype,"enableDualStream",[I7],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),Et(pt.prototype,"disableDualStream",[A7],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),Et(pt.prototype,"setClientRole",[P7],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),Et(pt.prototype,"_setClientRoleOptions",[O7],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),Et(pt.prototype,"setProxyServer",[k7],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),Et(pt.prototype,"setTurnServer",[N7],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),Et(pt.prototype,"setLicense",[D7],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),Et(pt.prototype,"startProxyServer",[x7],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),Et(pt.prototype,"stopProxyServer",[L7],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),Et(pt.prototype,"setLocalAccessPointsV2",[M7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),Et(pt.prototype,"setLocalAccessPoints",[U7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),Et(pt.prototype,"setRemoteDefaultVideoStreamType",[V7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),Et(pt.prototype,"setRemoteVideoStreamType",[j7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),Et(pt.prototype,"setStreamFallbackOption",[F7],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),Et(pt.prototype,"setEncryptionConfig",[B7],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),Et(pt.prototype,"renewToken",[W7],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),Et(pt.prototype,"enableAudioVolumeIndicator",[z7],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),Et(pt.prototype,"startLiveStreaming",[G7],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),Et(pt.prototype,"setLiveTranscoding",[H7],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),Et(pt.prototype,"stopLiveStreaming",[$7],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),Et(pt.prototype,"startChannelMediaRelay",[K7],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),Et(pt.prototype,"updateChannelMediaRelay",[q7],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),Et(pt.prototype,"stopChannelMediaRelay",[Y7],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),Et(pt.prototype,"sendCustomReportMessage",[X7],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),Et(pt.prototype,"pickSVCLayer",[J7],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),Et(pt.prototype,"setRTMConfig",[Q7],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),Et(pt.prototype,"enableContentInspect",[Z7],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),Et(pt.prototype,"disableContentInspect",[e$],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),Et(pt.prototype,"setImageModeration",[t$],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),Et(pt.prototype,"setP2PTransport",[n$],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),Et(pt.prototype,"getJoinChannelServiceRecords",[r$],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),Et(pt.prototype,"setPublishAudioFilterEnabled",[i$],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class tw{constructor(r,s){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),tw.count+=1,this.id=tw.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const d=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(d),o.iceGatheringState==="complete"?o.localDescription:new ut(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new Oe(Q.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(Q.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(Q.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var o$,a1;K(tw,"count",0);const O_e=window.AudioContext||window.webkitAudioContext,k_e=new(o$=Vt({report:Ct}),Et((a1=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new O_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new tw(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return An().name!==Bn.SAFARI}}).prototype,"processExternalMediaAEC",[o$],Object.getOwnPropertyDescriptor(a1.prototype,"processExternalMediaAEC"),a1.prototype),a1);function a$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function c$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}const H2=window||document;function l$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!H2)return;const s=Ci._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(Ci.onSecurityPolicyViolation||Ci.getListeners(xh.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;ie("CSP_DETECTED_HOSTNAME_LIST").some(h=>at(d).call(d,h))&&(Ci.onSecurityPolicyViolation&&typeof Ci.onSecurityPolicyViolation=="function"&&Ci.onSecurityPolicyViolation(c),Ci.getListeners(xh.SECURITY_POLICY_VIOLATION).length>0&&Ci.safeEmit(xh.SECURITY_POLICY_VIOLATION,c))};s&&H2.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Ci.getListeners(xh.SECURITY_POLICY_VIOLATION).length>0)&&H2.addEventListener("securitypolicyviolation",o),Ci._cspEventHandlerPointer=o}var N_e=k,D_e=$8,u$=RegExp.prototype,x_e=function(t){return t===u$||N_e(u$,t)?D_e(t):t.flags},ao=l(x_e);function TS(t){let r=t.length;for(;--r>=0;)t[r]=0}const $2=256,d$=286,nw=30,rw=15,K2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),c1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),h$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_f=new Array(576);TS(_f);const iw=new Array(60);TS(iw);const sw=new Array(512);TS(sw);const ow=new Array(256);TS(ow);const q2=new Array(29);TS(q2);const l1=new Array(nw);function Y2(t,r,s,o,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=t&&t.length}let p$,f$,m$;function X2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}TS(l1);const g$=t=>t<256?sw[t]:sw[256+(t>>>7)],aw=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},Kc=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,aw(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},jh=(t,r,s)=>{Kc(t,s[2*r],s[2*r+1])},_$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},y$=(t,r,s)=>{const o=new Array(16);let c,d,h=0;for(c=1;c<=rw;c++)h=h+s[c-1]<<1,o[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=_$(o[m]++,m))}},E$=t=>{let r;for(r=0;r<d$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<nw;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},v$=t=>{t.bi_valid>8?aw(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},S$=(t,r,s,o)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&o[r]<=o[s]},J2=(t,r,s)=>{const o=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&S$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!S$(r,o,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=o},b$=(t,r,s)=>{let o,c,d,h,m=0;if(t.sym_next!==0)do o=255&t.pending_buf[t.sym_buf+m++],o+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],o===0?jh(t,c,r):(d=ow[c],jh(t,d+$2+1,r),h=K2[d],h!==0&&(c-=q2[d],Kc(t,c,h)),o--,d=g$(o),jh(t,d,s),h=c1[d],h!==0&&(o-=l1[d],Kc(t,o,h)));while(m<t.sym_next);jh(t,256,r)},Q2=(t,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=o[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)J2(t,s,h);y=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],J2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,J2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((T,R)=>{const P=R.dyn_tree,N=R.max_code,G=R.stat_desc.static_tree,j=R.stat_desc.has_stree,W=R.stat_desc.extra_bits,Y=R.stat_desc.extra_base,J=R.stat_desc.max_length;let le,_e,Ee,ge,Ne,qe,dt=0;for(ge=0;ge<=rw;ge++)T.bl_count[ge]=0;for(P[2*T.heap[T.heap_max]+1]=0,le=T.heap_max+1;le<573;le++)_e=T.heap[le],ge=P[2*P[2*_e+1]+1]+1,ge>J&&(ge=J,dt++),P[2*_e+1]=ge,_e>N||(T.bl_count[ge]++,Ne=0,_e>=Y&&(Ne=W[_e-Y]),qe=P[2*_e],T.opt_len+=qe*(ge+Ne),j&&(T.static_len+=qe*(G[2*_e+1]+Ne)));if(dt!==0){do{for(ge=J-1;T.bl_count[ge]===0;)ge--;T.bl_count[ge]--,T.bl_count[ge+1]+=2,T.bl_count[J]--,dt-=2}while(dt>0);for(ge=J;ge!==0;ge--)for(_e=T.bl_count[ge];_e!==0;)Ee=T.heap[--le],Ee>N||(P[2*Ee+1]!==ge&&(T.opt_len+=(ge-P[2*Ee+1])*P[2*Ee],P[2*Ee+1]=ge),_e--)}})(t,r),y$(s,v,t.bl_count)},T$=(t,r,s)=>{let o,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},w$=(t,r,s)=>{let o,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<y&&c===h)){if(m<v)do jh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(jh(t,c,t.bl_tree),m--),jh(t,16,t.bl_tree),Kc(t,m-3,2)):m<=10?(jh(t,17,t.bl_tree),Kc(t,m-3,3)):(jh(t,18,t.bl_tree),Kc(t,m-11,7));m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let C$=!1;const R$=(t,r,s,o)=>{Kc(t,0+(o?1:0),3),v$(t),aw(t,s),aw(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var M_e=t=>{C$||((()=>{let r,s,o,c,d;const h=new Array(16);for(o=0,c=0;c<28;c++)for(q2[c]=o,r=0;r<1<<K2[c];r++)ow[o++]=c;for(ow[o-1]=c,d=0,c=0;c<16;c++)for(l1[c]=d,r=0;r<1<<c1[c];r++)sw[d++]=c;for(d>>=7;c<nw;c++)for(l1[c]=d<<7,r=0;r<1<<c1[c]-7;r++)sw[256+d++]=c;for(s=0;s<=rw;s++)h[s]=0;for(r=0;r<=143;)_f[2*r+1]=8,r++,h[8]++;for(;r<=255;)_f[2*r+1]=9,r++,h[9]++;for(;r<=279;)_f[2*r+1]=7,r++,h[7]++;for(;r<=287;)_f[2*r+1]=8,r++,h[8]++;for(y$(_f,287,h),r=0;r<nw;r++)iw[2*r+1]=5,iw[2*r]=_$(r,5);p$=new Y2(_f,K2,257,d$,rw),f$=new Y2(iw,c1,0,nw,rw),m$=new Y2(new Array(0),L_e,0,19,7)})(),C$=!0),t.l_desc=new X2(t.dyn_ltree,p$),t.d_desc=new X2(t.dyn_dtree,f$),t.bl_desc=new X2(t.bl_tree,m$),t.bi_buf=0,t.bi_valid=0,E$(t)},U_e=(t,r,s,o)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<$2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),Q2(t,t.l_desc),Q2(t,t.d_desc),h=(m=>{let y;for(T$(m,m.dyn_ltree,m.l_desc.max_code),T$(m,m.dyn_dtree,m.d_desc.max_code),Q2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*h$[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?R$(t,r,s,o):t.strategy===4||d===c?(Kc(t,2+(o?1:0),3),b$(t,_f,iw)):(Kc(t,4+(o?1:0),3),((m,y,v,T)=>{let R;for(Kc(m,y-257,5),Kc(m,v-1,5),Kc(m,T-4,4),R=0;R<T;R++)Kc(m,m.bl_tree[2*h$[R]+1],3);w$(m,m.dyn_ltree,y-1),w$(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),b$(t,t.dyn_ltree,t.dyn_dtree)),E$(t),o&&v$(t)},V_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(ow[s]+$2+1)]++,t.dyn_dtree[2*g$(r)]++),t.sym_next===t.sym_end),j_e=t=>{Kc(t,2,3),jh(t,256,_f),(r=>{r.bi_valid===16?(aw(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},F_e={_tr_init:M_e,_tr_stored_block:R$,_tr_flush_block:U_e,_tr_tally:V_e,_tr_align:j_e},cw=(t,r,s,o)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const B_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var ko=(t,r,s,o)=>{const c=B_e,d=o+s;t^=-1;for(let h=o;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},hy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},u1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:W_e,_tr_stored_block:Z2,_tr_flush_block:z_e,_tr_tally:tg,_tr_align:G_e}=F_e,{Z_NO_FLUSH:ng,Z_PARTIAL_FLUSH:H_e,Z_FULL_FLUSH:$_e,Z_FINISH:Ru,Z_BLOCK:I$,Z_OK:na,Z_STREAM_END:A$,Z_STREAM_ERROR:Fh,Z_DATA_ERROR:K_e,Z_BUF_ERROR:eM,Z_DEFAULT_COMPRESSION:q_e,Z_FILTERED:Y_e,Z_HUFFMAN_ONLY:d1,Z_RLE:X_e,Z_FIXED:J_e,Z_DEFAULT_STRATEGY:Q_e,Z_UNKNOWN:Z_e,Z_DEFLATED:h1}=u1,tM=286,eye=30,tye=19,nye=2*tM+1,rye=15,py=258,Bh=262,wS=42,fy=113,lw=666,my=(t,r)=>(t.msg=hy[r],r),P$=t=>2*t-(t>4?9:0),rg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},iye=t=>{let r,s,o,c=t.w_size;r=t.hash_size,o=r;do s=t.head[--o],t.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=t.prev[--o],t.prev[o]=s>=c?s-c:0;while(--r)};let ig=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Ol=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},kl=(t,r)=>{z_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Ol(t.strm)},Qr=(t,r)=>{t.pending_buf[t.pending++]=r},uw=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},nM=(t,r,s,o)=>{let c=t.avail_in;return c>o&&(c=o),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=cw(t.adler,r,c,s):t.state.wrap===2&&(t.adler=ko(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},O$=(t,r)=>{let s,o,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-Bh?t.strstart-(t.w_size-Bh):0,v=t.window,T=t.w_mask,R=t.prev,P=t.strstart+py;let N=v[d+h-1],G=v[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===N&&v[s]===v[d]&&v[++s]===v[d+1]){d+=2,s++;do;while(v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&d<P);if(o=py-(P-d),d=P-py,o>h){if(t.match_start=r,h=o,o>=m)break;N=v[d+h-1],G=v[d+h]}}while((r=R[r&T])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},CS=t=>{const r=t.w_size;let s,o,c;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Bh)&&(t.window.set(t.window.subarray(r,r+r-o),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),iye(t),o+=r),t.strm.avail_in===0)break;if(s=nM(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=ig(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=ig(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Bh&&t.strm.avail_in!==0)},k$=(t,r)=>{let s,o,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,o=t.strstart-t.block_start,s>o+t.strm.avail_in&&(s=o+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==Ru||r===ng||s!==o+t.strm.avail_in)))break;h=r===Ru&&s===o+t.strm.avail_in?1:0,Z2(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Ol(t.strm),o&&(o>s&&(o=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+o),t.strm.next_out),t.strm.next_out+=o,t.strm.avail_out-=o,t.strm.total_out+=o,t.block_start+=o,s-=o),s&&(nM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==ng&&r!==Ru&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(nM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,o=t.strstart-t.block_start,(o>=d||(o||r===Ru)&&r!==ng&&t.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===Ru&&t.strm.avail_in===0&&s===o?1:0,Z2(t,t.block_start,s,h),t.block_start+=s,Ol(t.strm)),h?3:1)},rM=(t,r)=>{let s,o;for(;;){if(t.lookahead<Bh){if(CS(t),t.lookahead<Bh&&r===ng)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=ig(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Bh&&(t.match_length=O$(t,s)),t.match_length>=3)if(o=tg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=ig(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ig(t,t.ins_h,t.window[t.strstart+1]);else o=tg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(kl(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Ru?(kl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(kl(t,!1),t.strm.avail_out===0)?1:2},RS=(t,r)=>{let s,o,c;for(;;){if(t.lookahead<Bh){if(CS(t),t.lookahead<Bh&&r===ng)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=ig(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Bh&&(t.match_length=O$(t,s),t.match_length<=5&&(t.strategy===Y_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,o=tg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=ig(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(kl(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(o=tg(t,0,t.window[t.strstart-1]),o&&kl(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=tg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Ru?(kl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(kl(t,!1),t.strm.avail_out===0)?1:2};function Wh(t,r,s,o,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const dw=[new Wh(0,0,0,0,k$),new Wh(4,4,8,4,rM),new Wh(4,5,16,8,rM),new Wh(4,6,32,32,rM),new Wh(4,4,16,16,RS),new Wh(8,16,32,32,RS),new Wh(8,16,128,128,RS),new Wh(8,32,128,256,RS),new Wh(32,128,258,1024,RS),new Wh(32,258,258,4096,RS)];function sye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=h1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nye),this.dyn_dtree=new Uint16Array(2*(2*eye+1)),this.bl_tree=new Uint16Array(2*(2*tye+1)),rg(this.dyn_ltree),rg(this.dyn_dtree),rg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rye+1),this.heap=new Uint16Array(2*tM+1),rg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*tM+1),rg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const hw=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==wS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==fy&&r.status!==lw?1:0},N$=t=>{if(hw(t))return my(t,Fh);t.total_in=t.total_out=0,t.data_type=Z_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?wS:fy,t.adler=r.wrap===2?0:1,r.last_flush=-2,W_e(r),na},D$=t=>{const r=N$(t);return r===na&&(s=>{s.window_size=2*s.w_size,rg(s.head),s.max_lazy_match=dw[s.level].max_lazy,s.good_match=dw[s.level].good_length,s.nice_match=dw[s.level].nice_length,s.max_chain_length=dw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},x$=(t,r,s,o,c,d)=>{if(!t)return Fh;let h=1;if(r===q_e&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==h1||o<8||o>15||r<0||r>9||d<0||d>J_e||o===8&&h!==1)return my(t,Fh);o===8&&(o=9);const m=new sye;return t.state=m,m.strm=t,m.status=wS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,D$(t)};var oye=(t,r)=>{if(hw(t)||r>I$||r<0)return t?my(t,Fh):Fh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===lw&&r!==Ru)return my(t,t.avail_out===0?eM:Fh);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Ol(t),t.avail_out===0)return s.last_flush=-1,na}else if(t.avail_in===0&&P$(r)<=P$(o)&&r!==Ru)return my(t,eM);if(s.status===lw&&t.avail_in!==0)return my(t,eM);if(s.status===wS&&s.wrap===0&&(s.status=fy),s.status===wS){let c=h1+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=d1||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,uw(s,c),s.strstart!==0&&(uw(s,t.adler>>>16),uw(s,65535&t.adler)),t.adler=1,s.status=fy,Ol(t),s.pending!==0)return s.last_flush=-1,na}if(s.status===57){if(t.adler=0,Qr(s,31),Qr(s,139),Qr(s,8),s.gzhead)Qr(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Qr(s,255&s.gzhead.time),Qr(s,s.gzhead.time>>8&255),Qr(s,s.gzhead.time>>16&255),Qr(s,s.gzhead.time>>24&255),Qr(s,s.level===9?2:s.strategy>=d1||s.level<2?4:0),Qr(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Qr(s,255&s.gzhead.extra.length),Qr(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=ko(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Qr(s,0),Qr(s,0),Qr(s,0),Qr(s,0),Qr(s,0),Qr(s,s.level===9?2:s.strategy>=d1||s.level<2?4:0),Qr(s,3),s.status=fy,Ol(t),s.pending!==0)return s.last_flush=-1,na}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=ko(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Ol(t),s.pending!==0)return s.last_flush=-1,na;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=ko(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ko(t.adler,s.pending_buf,s.pending-d,d)),Ol(t),s.pending!==0)return s.last_flush=-1,na;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Qr(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ko(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=ko(t.adler,s.pending_buf,s.pending-d,d)),Ol(t),s.pending!==0)return s.last_flush=-1,na;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Qr(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=ko(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ol(t),s.pending!==0))return s.last_flush=-1,na;Qr(s,255&t.adler),Qr(s,t.adler>>8&255),t.adler=0}if(s.status=fy,Ol(t),s.pending!==0)return s.last_flush=-1,na}if(t.avail_in!==0||s.lookahead!==0||r!==ng&&s.status!==lw){let c=s.level===0?k$(s,r):s.strategy===d1?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(CS(d),d.lookahead===0)){if(h===ng)return 1;break}if(d.match_length=0,m=tg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(kl(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Ru?(kl(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(kl(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===X_e?((d,h)=>{let m,y,v,T;const R=d.window;for(;;){if(d.lookahead<=py){if(CS(d),d.lookahead<=py&&h===ng)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){T=d.strstart+py;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<T);d.match_length=py-(T-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=tg(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=tg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(kl(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Ru?(kl(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(kl(d,!1),d.strm.avail_out===0)?1:2})(s,r):dw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=lw),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),na;if(c===2&&(r===H_e?G_e(s):r!==I$&&(Z2(s,0,0,!1),r===$_e&&(rg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Ol(t),t.avail_out===0))return s.last_flush=-1,na}return r!==Ru?na:s.wrap<=0?A$:(s.wrap===2?(Qr(s,255&t.adler),Qr(s,t.adler>>8&255),Qr(s,t.adler>>16&255),Qr(s,t.adler>>24&255),Qr(s,255&t.total_in),Qr(s,t.total_in>>8&255),Qr(s,t.total_in>>16&255),Qr(s,t.total_in>>24&255)):(uw(s,t.adler>>>16),uw(s,65535&t.adler)),Ol(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?na:A$)},aye=(t,r)=>{let s=r.length;if(hw(t))return Fh;const o=t.state,c=o.wrap;if(c===2||c===1&&o.status!==wS||o.lookahead)return Fh;if(c===1&&(t.adler=cw(t.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(rg(o.head),o.strstart=0,o.block_start=0,o.insert=0);let y=new Uint8Array(o.w_size);y.set(r.subarray(s-o.w_size,s),0),r=y,s=o.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,CS(o);o.lookahead>=3;){let y=o.strstart,v=o.lookahead-2;do o.ins_h=ig(o,o.ins_h,o.window[y+3-1]),o.prev[y&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=y,y++;while(--v);o.strstart=y,o.lookahead=2,CS(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,o.wrap=c,na},pw={deflateInit:(t,r)=>x$(t,r,h1,15,8,Q_e),deflateInit2:x$,deflateReset:D$,deflateResetKeep:N$,deflateSetHeader:(t,r)=>hw(t)||t.state.wrap!==2?Fh:(t.state.gzhead=r,na),deflate:oye,deflateEnd:t=>{if(hw(t))return Fh;const r=t.state.status;return t.state=null,r===fy?my(t,K_e):na},deflateSetDictionary:aye,deflateInfo:"pako deflate (from Nodeca project)"};const cye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var p1={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)cye(s,o)&&(t[o]=s[o])}}return t},flattenChunks:t=>{let r=0;for(let o=0,c=t.length;o<c;o++)r+=t[o].length;const s=new Uint8Array(r);for(let o=0,c=0,d=t.length;o<d;o++){let h=t[o];s.set(h,c),c+=h.length}return s}};let L$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{L$=!1}const fw=new Uint8Array(256);for(let t=0;t<256;t++)fw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;fw[254]=fw[254]=1;var mw={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,o,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=t.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let o,c;const d=new Array(2*s);for(c=0,o=0;o<s;){let h=t[o++];if(h<128){d[c++]=h;continue}let m=fw[h];if(m>4)d[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&t[o++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&L$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+fw[t[s]]>r?s:r}},M$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const U$=Object.prototype.toString,{Z_NO_FLUSH:lye,Z_SYNC_FLUSH:uye,Z_FULL_FLUSH:dye,Z_FINISH:hye,Z_OK:f1,Z_STREAM_END:pye,Z_DEFAULT_COMPRESSION:fye,Z_DEFAULT_STRATEGY:mye,Z_DEFLATED:gye}=u1;function m1(t){this.options=p1.assign({level:fye,method:gye,chunkSize:16384,windowBits:15,memLevel:8,strategy:mye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new M$,this.strm.avail_out=0;let s=pw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==f1)throw new Error(hy[s]);if(r.header&&pw.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?mw.string2buf(r.dictionary):U$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=pw.deflateSetDictionary(this.strm,o),s!==f1)throw new Error(hy[s]);this._dict_set=!0}}function _ye(t,r){const s=new m1(r);if(s.push(t,!0),s.err)throw s.msg||hy[s.err];return s.result}m1.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?hye:lye,typeof t=="string"?s.input=mw.string2buf(t):U$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(d===uye||d===dye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=pw.deflate(s,d),c===pye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=pw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===f1;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},m1.prototype.onData=function(t){this.chunks.push(t)},m1.prototype.onEnd=function(t){t===f1&&(this.result=p1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var yye={deflate:_ye};const g1=16209;var Eye=function(t,r){let s,o,c,d,h,m,y,v,T,R,P,N,G,j,W,Y,J,le,_e,Ee,ge,Ne,qe,dt;const ft=t.state;s=t.next_in,qe=t.input,o=s+(t.avail_in-5),c=t.next_out,dt=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=ft.dmax,y=ft.wsize,v=ft.whave,T=ft.wnext,R=ft.window,P=ft.hold,N=ft.bits,G=ft.lencode,j=ft.distcode,W=(1<<ft.lenbits)-1,Y=(1<<ft.distbits)-1;e:do{N<15&&(P+=qe[s++]<<N,N+=8,P+=qe[s++]<<N,N+=8),J=G[P&W];t:for(;;){if(le=J>>>24,P>>>=le,N-=le,le=J>>>16&255,le===0)dt[c++]=65535&J;else{if(!(16&le)){if((64&le)==0){J=G[(65535&J)+(P&(1<<le)-1)];continue t}if(32&le){ft.mode=16191;break e}t.msg="invalid literal/length code",ft.mode=g1;break e}_e=65535&J,le&=15,le&&(N<le&&(P+=qe[s++]<<N,N+=8),_e+=P&(1<<le)-1,P>>>=le,N-=le),N<15&&(P+=qe[s++]<<N,N+=8,P+=qe[s++]<<N,N+=8),J=j[P&Y];n:for(;;){if(le=J>>>24,P>>>=le,N-=le,le=J>>>16&255,!(16&le)){if((64&le)==0){J=j[(65535&J)+(P&(1<<le)-1)];continue n}t.msg="invalid distance code",ft.mode=g1;break e}if(Ee=65535&J,le&=15,N<le&&(P+=qe[s++]<<N,N+=8,N<le&&(P+=qe[s++]<<N,N+=8)),Ee+=P&(1<<le)-1,Ee>m){t.msg="invalid distance too far back",ft.mode=g1;break e}if(P>>>=le,N-=le,le=c-d,Ee>le){if(le=Ee-le,le>v&&ft.sane){t.msg="invalid distance too far back",ft.mode=g1;break e}if(ge=0,Ne=R,T===0){if(ge+=y-le,le<_e){_e-=le;do dt[c++]=R[ge++];while(--le);ge=c-Ee,Ne=dt}}else if(T<le){if(ge+=y+T-le,le-=T,le<_e){_e-=le;do dt[c++]=R[ge++];while(--le);if(ge=0,T<_e){le=T,_e-=le;do dt[c++]=R[ge++];while(--le);ge=c-Ee,Ne=dt}}}else if(ge+=T-le,le<_e){_e-=le;do dt[c++]=R[ge++];while(--le);ge=c-Ee,Ne=dt}for(;_e>2;)dt[c++]=Ne[ge++],dt[c++]=Ne[ge++],dt[c++]=Ne[ge++],_e-=3;_e&&(dt[c++]=Ne[ge++],_e>1&&(dt[c++]=Ne[ge++]))}else{ge=c-Ee;do dt[c++]=dt[ge++],dt[c++]=dt[ge++],dt[c++]=dt[ge++],_e-=3;while(_e>2);_e&&(dt[c++]=dt[ge++],_e>1&&(dt[c++]=dt[ge++]))}break}}break}}while(s<o&&c<h);_e=N>>3,s-=_e,N-=_e<<3,P&=(1<<N)-1,t.next_in=s,t.next_out=c,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=c<h?h-c+257:257-(c-h),ft.hold=P,ft.bits=N};const _1=15,vye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Sye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),bye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Tye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var gw=(t,r,s,o,c,d,h,m)=>{const y=m.bits;let v,T,R,P,N,G,j=0,W=0,Y=0,J=0,le=0,_e=0,Ee=0,ge=0,Ne=0,qe=0,dt=null;const ft=new Uint16Array(16),Sn=new Uint16Array(16);let bn,hr,ai,Yr=null;for(j=0;j<=_1;j++)ft[j]=0;for(W=0;W<o;W++)ft[r[s+W]]++;for(le=y,J=_1;J>=1&&ft[J]===0;J--);if(le>J&&(le=J),J===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(Y=1;Y<J&&ft[Y]===0;Y++);for(le<Y&&(le=Y),ge=1,j=1;j<=_1;j++)if(ge<<=1,ge-=ft[j],ge<0)return-1;if(ge>0&&(t===0||J!==1))return-1;for(Sn[1]=0,j=1;j<_1;j++)Sn[j+1]=Sn[j]+ft[j];for(W=0;W<o;W++)r[s+W]!==0&&(h[Sn[r[s+W]]++]=W);if(t===0?(dt=Yr=h,G=20):t===1?(dt=vye,Yr=Sye,G=257):(dt=bye,Yr=Tye,G=0),qe=0,W=0,j=Y,N=d,_e=le,Ee=0,R=-1,Ne=1<<le,P=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){bn=j-Ee,h[W]+1<G?(hr=0,ai=h[W]):h[W]>=G?(hr=Yr[h[W]-G],ai=dt[h[W]-G]):(hr=96,ai=0),v=1<<j-Ee,T=1<<_e,Y=T;do T-=v,c[N+(qe>>Ee)+T]=bn<<24|hr<<16|ai|0;while(T!==0);for(v=1<<j-1;qe&v;)v>>=1;if(v!==0?(qe&=v-1,qe+=v):qe=0,W++,--ft[j]==0){if(j===J)break;j=r[s+h[W]]}if(j>le&&(qe&P)!==R){for(Ee===0&&(Ee=le),N+=Y,_e=j-Ee,ge=1<<_e;_e+Ee<J&&(ge-=ft[_e+Ee],!(ge<=0));)_e++,ge<<=1;if(Ne+=1<<_e,t===1&&Ne>852||t===2&&Ne>592)return 1;R=qe&P,c[R]=le<<24|_e<<16|N-d|0}}return qe!==0&&(c[N+qe]=j-Ee<<24|64<<16|0),m.bits=le,0};const{Z_FINISH:V$,Z_BLOCK:wye,Z_TREES:y1,Z_OK:gy,Z_STREAM_END:Cye,Z_NEED_DICT:Rye,Z_STREAM_ERROR:Iu,Z_DATA_ERROR:j$,Z_MEM_ERROR:F$,Z_BUF_ERROR:Iye,Z_DEFLATED:B$}=u1,E1=16180,v1=16190,yf=16191,iM=16192,sM=16194,S1=16199,b1=16200,oM=16206,ns=16209,W$=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Aye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const _y=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<E1||r.mode>16211?1:0},z$=t=>{if(_y(t))return Iu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=E1,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,gy},G$=t=>{if(_y(t))return Iu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,z$(t)},H$=(t,r)=>{let s;if(_y(t))return Iu;const o=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Iu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,G$(t))},$$=(t,r)=>{if(!t)return Iu;const s=new Aye;t.state=s,s.strm=t,s.window=null,s.mode=E1;const o=H$(t,r);return o!==gy&&(t.state=null),o};let aM,cM,K$=!0;const Pye=t=>{if(K$){aM=new Int32Array(512),cM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(gw(1,t.lens,0,288,aM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;gw(2,t.lens,0,32,cM,0,t.work,{bits:5}),K$=!1}t.lencode=aM,t.lenbits=9,t.distcode=cM,t.distbits=5},q$=(t,r,s,o)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),o>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>o&&(c=o),d.window.set(r.subarray(s-o,s-o+c),d.wnext),(o-=c)?(d.window.set(r.subarray(s-o,s),0),d.wnext=o,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Oye=(t,r)=>{let s,o,c,d,h,m,y,v,T,R,P,N,G,j,W,Y,J,le,_e,Ee,ge,Ne,qe=0;const dt=new Uint8Array(4);let ft,Sn;const bn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(_y(t)||!t.output||!t.input&&t.avail_in!==0)return Iu;s=t.state,s.mode===yf&&(s.mode=iM),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,o=t.input,m=t.avail_in,v=s.hold,T=s.bits,R=m,P=y,Ne=gy;e:for(;;)switch(s.mode){case E1:if(s.wrap===0){s.mode=iM;break}for(;T<16;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,dt[0]=255&v,dt[1]=v>>>8&255,s.check=ko(s.check,dt,2,0),v=0,T=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ns;break}if((15&v)!==B$){t.msg="unknown compression method",s.mode=ns;break}if(v>>>=4,T-=4,ge=8+(15&v),s.wbits===0&&(s.wbits=ge),ge>15||ge>s.wbits){t.msg="invalid window size",s.mode=ns;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:yf,v=0,T=0;break;case 16181:for(;T<16;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(s.flags=v,(255&ao(s))!==B$){t.msg="unknown compression method",s.mode=ns;break}if(57344&ao(s)){t.msg="unknown header flags set",s.mode=ns;break}s.head&&(s.head.text=v>>8&1),512&ao(s)&&4&s.wrap&&(dt[0]=255&v,dt[1]=v>>>8&255,s.check=ko(s.check,dt,2,0)),v=0,T=0,s.mode=16182;case 16182:for(;T<32;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}s.head&&(s.head.time=v),512&ao(s)&&4&s.wrap&&(dt[0]=255&v,dt[1]=v>>>8&255,dt[2]=v>>>16&255,dt[3]=v>>>24&255,s.check=ko(s.check,dt,4,0)),v=0,T=0,s.mode=16183;case 16183:for(;T<16;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&ao(s)&&4&s.wrap&&(dt[0]=255&v,dt[1]=v>>>8&255,s.check=ko(s.check,dt,2,0)),v=0,T=0,s.mode=16184;case 16184:if(1024&ao(s)){for(;T<16;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}s.length=v,s.head&&(s.head.extra_len=v),512&ao(s)&&4&s.wrap&&(dt[0]=255&v,dt[1]=v>>>8&255,s.check=ko(s.check,dt,2,0)),v=0,T=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&ao(s)&&(N=s.length,N>m&&(N=m),N&&(s.head&&(ge=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(d,d+N),ge)),512&ao(s)&&4&s.wrap&&(s.check=ko(s.check,o,N,d)),m-=N,d+=N,s.length-=N),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&ao(s)){if(m===0)break e;N=0;do ge=o[d+N++],s.head&&ge&&s.length<65536&&(s.head.name+=String.fromCharCode(ge));while(ge&&N<m);if(512&ao(s)&&4&s.wrap&&(s.check=ko(s.check,o,N,d)),m-=N,d+=N,ge)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&ao(s)){if(m===0)break e;N=0;do ge=o[d+N++],s.head&&ge&&s.length<65536&&(s.head.comment+=String.fromCharCode(ge));while(ge&&N<m);if(512&ao(s)&&4&s.wrap&&(s.check=ko(s.check,o,N,d)),m-=N,d+=N,ge)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&ao(s)){for(;T<16;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ns;break}v=0,T=0}s.head&&(s.head.hcrc=ao(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=yf;break;case 16189:for(;T<32;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}t.adler=s.check=W$(v),v=0,T=0,s.mode=v1;case v1:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=T,Rye;t.adler=s.check=1,s.mode=yf;case yf:if(r===wye||r===y1)break e;case iM:if(s.last){v>>>=7&T,T-=7&T,s.mode=oM;break}for(;T<3;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}switch(s.last=1&v,v>>>=1,T-=1,3&v){case 0:s.mode=16193;break;case 1:if(Pye(s),s.mode=S1,r===y1){v>>>=2,T-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ns}v>>>=2,T-=2;break;case 16193:for(v>>>=7&T,T-=7&T;T<32;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ns;break}if(s.length=65535&v,v=0,T=0,s.mode=sM,r===y1)break e;case sM:s.mode=16195;case 16195:if(N=s.length,N){if(N>m&&(N=m),N>y&&(N=y),N===0)break e;c.set(o.subarray(d,d+N),h),m-=N,d+=N,y-=N,h+=N,s.length-=N;break}s.mode=yf;break;case 16196:for(;T<14;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(s.nlen=257+(31&v),v>>>=5,T-=5,s.ndist=1+(31&v),v>>>=5,T-=5,s.ncode=4+(15&v),v>>>=4,T-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ns;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;T<3;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}s.lens[bn[s.have++]]=7&v,v>>>=3,T-=3}for(;s.have<19;)s.lens[bn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,ft={bits:s.lenbits},Ne=gw(0,s.lens,0,19,s.lencode,0,s.work,ft),s.lenbits=ft.bits,Ne){t.msg="invalid code lengths set",s.mode=ns;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;qe=s.lencode[v&(1<<s.lenbits)-1],W=qe>>>24,Y=qe>>>16&255,J=65535&qe,!(W<=T);){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(J<16)v>>>=W,T-=W,s.lens[s.have++]=J;else{if(J===16){for(Sn=W+2;T<Sn;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(v>>>=W,T-=W,s.have===0){t.msg="invalid bit length repeat",s.mode=ns;break}ge=s.lens[s.have-1],N=3+(3&v),v>>>=2,T-=2}else if(J===17){for(Sn=W+3;T<Sn;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}v>>>=W,T-=W,ge=0,N=3+(7&v),v>>>=3,T-=3}else{for(Sn=W+7;T<Sn;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}v>>>=W,T-=W,ge=0,N=11+(127&v),v>>>=7,T-=7}if(s.have+N>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ns;break}for(;N--;)s.lens[s.have++]=ge}}if(s.mode===ns)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ns;break}if(s.lenbits=9,ft={bits:s.lenbits},Ne=gw(1,s.lens,0,s.nlen,s.lencode,0,s.work,ft),s.lenbits=ft.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ns;break}if(s.distbits=6,s.distcode=s.distdyn,ft={bits:s.distbits},Ne=gw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,ft),s.distbits=ft.bits,Ne){t.msg="invalid distances set",s.mode=ns;break}if(s.mode=S1,r===y1)break e;case S1:s.mode=b1;case b1:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=T,Eye(t,P),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,o=t.input,m=t.avail_in,v=s.hold,T=s.bits,s.mode===yf&&(s.back=-1);break}for(s.back=0;qe=s.lencode[v&(1<<s.lenbits)-1],W=qe>>>24,Y=qe>>>16&255,J=65535&qe,!(W<=T);){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(Y&&(240&Y)==0){for(le=W,_e=Y,Ee=J;qe=s.lencode[Ee+((v&(1<<le+_e)-1)>>le)],W=qe>>>24,Y=qe>>>16&255,J=65535&qe,!(le+W<=T);){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}v>>>=le,T-=le,s.back+=le}if(v>>>=W,T-=W,s.back+=W,s.length=J,Y===0){s.mode=16205;break}if(32&Y){s.back=-1,s.mode=yf;break}if(64&Y){t.msg="invalid literal/length code",s.mode=ns;break}s.extra=15&Y,s.mode=16201;case 16201:if(s.extra){for(Sn=s.extra;T<Sn;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,T-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;qe=s.distcode[v&(1<<s.distbits)-1],W=qe>>>24,Y=qe>>>16&255,J=65535&qe,!(W<=T);){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if((240&Y)==0){for(le=W,_e=Y,Ee=J;qe=s.distcode[Ee+((v&(1<<le+_e)-1)>>le)],W=qe>>>24,Y=qe>>>16&255,J=65535&qe,!(le+W<=T);){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}v>>>=le,T-=le,s.back+=le}if(v>>>=W,T-=W,s.back+=W,64&Y){t.msg="invalid distance code",s.mode=ns;break}s.offset=J,s.extra=15&Y,s.mode=16203;case 16203:if(s.extra){for(Sn=s.extra;T<Sn;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,T-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ns;break}s.mode=16204;case 16204:if(y===0)break e;if(N=P-y,s.offset>N){if(N=s.offset-N,N>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ns;break}N>s.wnext?(N-=s.wnext,G=s.wsize-N):G=s.wnext-N,N>s.length&&(N=s.length),j=s.window}else j=c,G=h-s.offset,N=s.length;N>y&&(N=y),y-=N,s.length-=N;do c[h++]=j[G++];while(--N);s.length===0&&(s.mode=b1);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=b1;break;case oM:if(s.wrap){for(;T<32;){if(m===0)break e;m--,v|=o[d++]<<T,T+=8}if(P-=y,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=ao(s)?ko(s.check,c,P,h-P):cw(s.check,c,P,h-P)),P=y,4&s.wrap&&(ao(s)?v:W$(v))!==s.check){t.msg="incorrect data check",s.mode=ns;break}v=0,T=0}s.mode=16207;case 16207:if(s.wrap&&ao(s)){for(;T<32;){if(m===0)break e;m--,v+=o[d++]<<T,T+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ns;break}v=0,T=0}s.mode=16208;case 16208:Ne=Cye;break e;case ns:Ne=j$;break e;case 16210:return F$;default:return Iu}return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=T,(s.wsize||P!==t.avail_out&&s.mode<ns&&(s.mode<oM||r!==V$))&&q$(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=ao(s)?ko(s.check,c,P,t.next_out-P):cw(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===yf?128:0)+(s.mode===S1||s.mode===sM?256:0),(R===0&&P===0||r===V$)&&Ne===gy&&(Ne=Iye),Ne},Ef={inflateReset:G$,inflateReset2:H$,inflateResetKeep:z$,inflateInit:t=>$$(t,15),inflateInit2:$$,inflate:Oye,inflateEnd:t=>{if(_y(t))return Iu;let r=t.state;return r.window&&(r.window=null),t.state=null,gy},inflateGetHeader:(t,r)=>{if(_y(t))return Iu;const s=t.state;return(2&s.wrap)==0?Iu:(s.head=r,r.done=!1,gy)},inflateSetDictionary:(t,r)=>{const s=r.length;let o,c,d;return _y(t)?Iu:(o=t.state,o.wrap!==0&&o.mode!==v1?Iu:o.mode===v1&&(c=1,c=cw(c,r,s,0),c!==o.check)?j$:(d=q$(t,r,s,s),d?(o.mode=16210,F$):(o.havedict=1,gy)))},inflateInfo:"pako inflate (from Nodeca project)"},kye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Y$=Object.prototype.toString,{Z_NO_FLUSH:Nye,Z_FINISH:Dye,Z_OK:_w,Z_STREAM_END:lM,Z_NEED_DICT:uM,Z_STREAM_ERROR:xye,Z_DATA_ERROR:X$,Z_MEM_ERROR:Lye}=u1;function T1(t){this.options=p1.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new M$,this.strm.avail_out=0;let s=Ef.inflateInit2(this.strm,r.windowBits);if(s!==_w)throw new Error(hy[s]);if(this.header=new kye,Ef.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=mw.string2buf(r.dictionary):Y$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=Ef.inflateSetDictionary(this.strm,r.dictionary),s!==_w)))throw new Error(hy[s])}function Mye(t,r){const s=new T1(r);if(s.push(t),s.err)throw s.msg||hy[s.err];return s.result}T1.prototype.push=function(t,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Dye:Nye,Y$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),d=Ef.inflate(s,h),d===uM&&c&&(d=Ef.inflateSetDictionary(s,c),d===_w?d=Ef.inflate(s,h):d===X$&&(d=uM));s.avail_in>0&&d===lM&&s.state.wrap>0&&t[s.next_in]!==0;)Ef.inflateReset(s),d=Ef.inflate(s,h);switch(d){case xye:case X$:case uM:case Lye:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===lM))if(this.options.to==="string"){let y=mw.utf8border(s.output,s.next_out),v=s.next_out-y,T=mw.buf2string(s.output,y);s.next_out=v,s.avail_out=o-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(T)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==_w||m!==0){if(d===lM)return d=Ef.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},T1.prototype.onData=function(t){this.chunks.push(t)},T1.prototype.onEnd=function(t){t===_w&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=p1.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Uye={inflate:Mye};const{deflate:Vye}=yye,{inflate:jye}=Uye;var Fye=Vye,Bye=jye,J$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(J$||{});class Wye{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;ie("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),d=new DataView(o);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,ie("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(o,!0),o+=2,d.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let y=!1;if(m.datas.length>0){const v=m.datas.find(T=>T.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,d=new ArrayBuffer(o+2),h=new Uint8Array(d),m=new DataView(d);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,o),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==o+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(o+2));return d}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const d=s.getUint8(o);o++;const h=c===J$.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<d;){let T=0,R=0,P=new ArrayBuffer(0);h?(T=y.getUint8(v),v++,R=y.getUint8(v),v++):(T=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(P=y.buffer.slice(v+2,v+2+R),v+=P.byteLength),m.push({id:T,length:R,data:P})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return Bye(new Uint8Array(r))}compress(r){return Fye(new Uint8Array(r))}}const zye={name:"DataStream",create:(t,r)=>{const s=r?new Xme(t):new Jme(t);return s.useDataStream(new Wye),s}};class Gye extends Mr{constructor(r,s,o){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=s,this.ws=new zT("cross-channel-".concat(this.clientId),o),this.ws.on(Xt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Xt.CONNECTED,this.onOpen),this.ws.on(Xt.ON_MESSAGE,this.onMessage),this.ws.on(Xt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new ut((s,o)=>{const c=window.setTimeout(()=>{o(new Oe(Q.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?o(new Oe(Q.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(Q.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(Q.WS_DISCONNECT);const s=()=>new ut((h,m)=>{this.ws.once(Xt.CLOSED,()=>m(new Oe(Q.WS_ABORT))),this.ws.once(Xt.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new ut((h,m)=>{const y=()=>{m(new Oe(Q.WS_ABORT))};this.ws.once(Xt.RECONNECTING,y),this.ws.once(Xt.CLOSED,y),this.once("req_".concat(o),h),os(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Xt.RECONNECTING,y),this.ws.off(Xt.CLOSED,y),m(new Oe(Q.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Oe(Q.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(Xt.REQUEST_NEW_URLS),this.ws.on(Xt.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Hye extends Mr{set state(r){r!==this._state&&(r!==Ia.RELAY_STATE_FAILURE&&(this.errorCode=uS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,d){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",Jo.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",Ia.RELAY_STATE_IDLE),K(this,"errorCode",uS.RELAY_OK),K(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",hf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",hf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=uS.SRC_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=uS.DEST_TOKEN_EXPIRED,this.state=Ia.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",hf.NETWORK_DISCONNECTED),this.state=Ia.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ia.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=uS.SERVER_CONNECTION_LOST,this.state=Ia.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=Y_(),this.signal=new Gye(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==Ia.RELAY_STATE_IDLE)throw new Oe(Q.INVALID_OPERATION);this.state=Ia.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(Q.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(Q.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(Q.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ia.RELAY_STATE_RUNNING)throw new Oe(Q.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ia.RELAY_STATE_RUNNING)throw new Oe(Q.INVALID_OPERATION);const s=this.genMessage(Oo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ia.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Jo.CancelToken.source(),this.state=Ia.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await t_e(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",hf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Oo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Oo.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Oo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",hf.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(Oo.SetSourceUserId,r);await this.signal.request(d),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Oo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",hf.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Oo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",hf.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ia.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Oo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",hf.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Oo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Cl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Oo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Oo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(Q.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Oo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(Q.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Oo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(Q.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:d},h;case Oo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Oo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Oo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Oo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(Q.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{o.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:d},h;case Oo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const $ye={name:"ChannelMediaRelay",create:function(t){return new Hye(t.joinInfo,t.clientId,t.websocketRetryConfig||wi,t.httpRetryConfig||wi,t.resolution)}};function Q$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function yw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Q$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Q$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class Kye extends Mr{constructor(r,s,o,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Ct.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===df.TRANSCODE?1:2}),this.emit(Hm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new zT("live-streaming",o),this.websocket.on(Xt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Xt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Xt.REQUEST_NEW_URLS,(d,h)=>{bs(this,Hm.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(Xt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(Q.UNEXPECTED_ERROR);const m=yw({command:r,sdkVersion:Cl==="4.23.2"?"0.0.1":Cl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(Q.WS_DISCONNECT);const y=()=>new ut((P,N)=>{this.websocket.once(Xt.CLOSED,()=>N(new Oe(Q.WS_ABORT))),this.websocket.once(Xt.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new ut((P,N)=>{const G=()=>{N(new Oe(Q.WS_ABORT))};this.websocket.once(Xt.RECONNECTING,G),this.websocket.once(Xt.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{P(j)})});c&&Ct.workerEvent(this.spec.sid,yw(yw({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const T=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,o)}return c&&Ct.workerEvent(this.spec.sid,yw(yw({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-T})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Cl==="4.23.2"?"0.0.1":Cl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case ki.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case ki.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ki.LIVE_STREAM_RESPONSE_BAD_STREAM:case ki.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(Q.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ki.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(Q.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(Q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Hm.WARNING,s,r.serverResponse.url)}case ki.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(Q.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Hm.WARNING,s,r.serverResponse.url)}case ki.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ki.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(Q.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(Q.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Hm.WARNING,s,r.serverResponse.url)}case ki.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case ki.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ki.LIVE_STREAM_RESPONSE_WORKER_LOST:case ki.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ki.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ki.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(Q.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(uP)},6e3)}}function Z$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function Aa(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Z$(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Z$(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class qye extends Mr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wi;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Os("live-streaming")),K(this,"cancelToken",Jo.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Aa(Aa({},xge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Aa(Aa(Aa({},Dge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Br(h.width)||rr(h.width,"config.width",0,1e4),Br(h.height)||rr(h.height,"config.height",0,1e4),Br(h.videoBitrate)||rr(h.videoBitrate,"config.videoBitrate",1,1e6),Br(h.videoFrameRate)||rr(h.videoFrameRate,"config.videoFrameRate"),Br(h.lowLatency)||af(h.lowLatency,"config.lowLatency"),Br(h.audioSampleRate)||xi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Br(h.audioBitrate)||rr(h.audioBitrate,"config.audioBitrate",1,128),Br(h.audioChannels)||xi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Br(h.videoGop)||rr(h.videoGop,"config.videoGop"),Br(h.videoCodecProfile)||xi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Br(h.userCount)||rr(h.userCount,"config.userCount",0,17),Br(h.backgroundColor)||rr(h.backgroundColor,"config.backgroundColor",0,16777215),Br(h.userConfigExtraInfo)||ss(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Br(h.transcodingUsers)&&(cf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{xP(m.uid),Br(m.x)||rr(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Br(m.y)||rr(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Br(m.width)||rr(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Br(m.height)||rr(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Br(m.zOrder)||rr(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Br(m.alpha)||rr(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Br(h.watermark)||h2(h.watermark,"watermark"),Br(h.backgroundImage)||h2(h.backgroundImage,"backgroundImage"),h.images&&!Br(h.images)&&(cf(h.images,"config.images"),h.images.forEach((m,y)=>{h2(m,"images[".concat(y,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>Aa(Aa(Aa({},d2),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(Aa(Aa(Aa({},d2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(Aa(Aa(Aa({},d2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Aa({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?ut.resolve(h.uid):SH(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ut.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Lc(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===df.TRANSCODE)throw new Oe(Q.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&o)return void d();if(this.streamingTasks.get(r)&&!o)return d(),new Oe(Q.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case df.TRANSCODE:c.transcodingConfig=Aa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ut((v,T)=>{os(this.retryTimeout).then(()=>{if(o)return T(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),T(R)):void 0})}),y=await ut.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===df.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new ut((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(Q.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===df.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(Lc(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Jo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(Q.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await bs(this,p2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new Kye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Hm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Hm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Hm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(Q.UNEXPECTED_ERROR,"can not get new live streaming address list"));bs(this,p2.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,o(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case ki.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ki.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(Q.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case ki.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(Q.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case ki.LIVE_STREAM_RESPONSE_WORKER_LOST:case ki.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Lc(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(Q.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const Yye={name:"LiveStreaming",create:function(t){return new qye(t.joinInfo,t.websocketRetryConfig||wi,t.httpRetryConfig||wi)}};function Xye(t){let r=nK();return function(s,o){let c=s.appId;c!==void 0&&(Jn(o,10),zh(o,c));let d=s.cid;d!==void 0&&(Jn(o,16),Jn(o,d));let h=s.cname;h!==void 0&&(Jn(o,26),zh(o,h));let m=s.deviceId;m!==void 0&&(Jn(o,34),zh(o,m));let y=s.elapse;y!==void 0&&(Jn(o,40),sg(o,y));let v=s.fileSize;v!==void 0&&(Jn(o,48),sg(o,IS(v)));let T=s.height;T!==void 0&&(Jn(o,56),sg(o,IS(T)));let R=s.jpg;R!==void 0&&(Jn(o,66),Jn(o,R.length),function(ra,Fe){let ot=AS(ra,Fe.length);ra.bytes.set(Fe,ot)}(o,R));let P=s.networkType;P!==void 0&&(Jn(o,72),sg(o,IS(P)));let N=s.osType;N!==void 0&&(Jn(o,80),sg(o,IS(N)));let G=s.requestId;G!==void 0&&(Jn(o,90),zh(o,G));let j=s.sdkVersion;j!==void 0&&(Jn(o,98),zh(o,j));let W=s.sequence;W!==void 0&&(Jn(o,104),sg(o,IS(W)));let Y=s.sid;Y!==void 0&&(Jn(o,114),zh(o,Y));let J=s.timestamp;J!==void 0&&(Jn(o,120),sg(o,J));let le=s.uid;le!==void 0&&(Jn(o,128),Jn(o,le));let _e=s.vid;_e!==void 0&&(Jn(o,136),Jn(o,_e));let Ee=s.width;Ee!==void 0&&(Jn(o,144),sg(o,IS(Ee)));let ge=s.service;ge!==void 0&&(Jn(o,152),Jn(o,ge));let Ne=s.callbackData;Ne!==void 0&&(Jn(o,162),zh(o,Ne));let qe=s.jpgEncryption;qe!==void 0&&(Jn(o,168),Jn(o,qe));let dt=s.requestType;dt!==void 0&&(Jn(o,176),Jn(o,dt));let ft=s.scorePorn;ft!==void 0&&(Jn(o,185),mM(o,ft));let Sn=s.scoreSexy;Sn!==void 0&&(Jn(o,193),mM(o,Sn));let bn=s.scoreNeutral;bn!==void 0&&(Jn(o,201),mM(o,bn));let hr=s.scene;hr!==void 0&&(Jn(o,208),Jn(o,hr));let ai=s.ossFilePrefix;ai!==void 0&&(Jn(o,218),zh(o,ai));let Yr=s.serviceVendor;if(Yr!==void 0)for(let ra of Yr){Jn(o,226);let Fe=nK();Zye(ra,Fe),Jn(o,Fe.limit),rEe(o,Fe),nEe(Fe)}}(t,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Jye(t){return function(s){let o={};e:for(;!rK(s);){let c=Gh(s);switch(c>>>3){case 0:break e;case 1:o.code=Gh(s);break;case 2:o.msg=iK(s,Gh(s));break;case 3:{let d=eEe(s);o.data=Qye(s),s.limit=d;break}default:eK(s,7&c)}}return o}({bytes:r=t,offset:0,limit:r.length});var r}function Qye(t){let r={};e:for(;!rK(t);){let s=Gh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=iK(t,Gh(t));break;case 2:r.requestType=Gh(t)>>>0;break;case 3:r.scorePorn=fM(t);break;case 4:r.scoreSexy=fM(t);break;case 5:r.scoreNeutral=fM(t);break;case 6:r.requestScene=Gh(t)>>>0;break;case 7:r.scene=Gh(t)>>>0;break;default:eK(t,7&s)}}return r}function Zye(t,r){let s=t.service;s!==void 0&&(Jn(r,8),Jn(r,s));let o=t.vendor;o!==void 0&&(Jn(r,16),Jn(r,o));let c=t.token;c!==void 0&&(Jn(r,26),zh(r,c));let d=t.callbackUrl;d!==void 0&&(Jn(r,34),zh(r,d))}function eEe(t){let r=Gh(t),s=t.limit;return t.limit=t.offset+r,s}function eK(t,r){switch(r){case 0:for(;128&sK(t););break;case 2:hM(t,Gh(t));break;case 5:hM(t,4);break;case 1:hM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let tEe=new Float32Array(1);new Uint8Array(tEe.buffer);let dM=new Float64Array(1),Pa=new Uint8Array(dM.buffer);function IS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let tK=[];function nK(){const t=tK.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function nEe(t){tK.push(t)}function hM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function rK(t){return t.offset>=t.limit}function AS(t,r){let s=t.bytes,o=t.offset,c=t.limit,d=o+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),o}function pM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function iK(t,r){let s=pM(t,r),o=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,T,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&P)<<6|63&y,R<128?h+=d:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],T=c[m+s+3],(12632256&(y|v<<8|T<<16))!=8421504?h+=d:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&T,R<65536||R>1114111?h+=d:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function zh(t,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}Jn(t,o);let c=AS(t,o),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function rEe(t,r){let s=AS(t,r.limit),o=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)o[d+s]=c[d]}function sK(t){return t.bytes[pM(t,1)]}function oK(t,r){let s=AS(t,1);t.bytes[s]=r}function fM(t){let r=pM(t,8),s=t.bytes;return Pa[0]=s[r++],Pa[1]=s[r++],Pa[2]=s[r++],Pa[3]=s[r++],Pa[4]=s[r++],Pa[5]=s[r++],Pa[6]=s[r++],Pa[7]=s[r++],dM[0]}function mM(t,r){let s=AS(t,8),o=t.bytes;dM[0]=r,o[s++]=Pa[0],o[s++]=Pa[1],o[s++]=Pa[2],o[s++]=Pa[3],o[s++]=Pa[4],o[s++]=Pa[5],o[s++]=Pa[6],o[s++]=Pa[7]}function Gh(t){let r,s=0,o=0;do r=sK(t),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function Jn(t,r){for(r>>>=0;r>=128;)oK(t,127&r|128),r>>>=7;oK(t,r)}function sg(t,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=AS(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=d!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=d!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=d!==5?128|o:127&o;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function aK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}const iEe=new Map([["moderation",1],["supervise",2]]);class sEe extends Mr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(ts.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ya(s=r.map(o=>iEe.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",Su.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",Jo.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==Su.CONNECTED)throw new Oe(Q.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Su.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ur(5,"inspect-"),this.workerMessageLengthLimit=ie("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=ie("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=ie("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new zT("worker-manager-"+this._inspectId,wi),this.on(ts.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(bu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new zT("worker-"+this._inspectId,wi),this.handleWorkerEvents()}async init(r,s){this.emit(ts.STATE_CHANGE,bu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ut((c,d)=>{this.on(ts.CONNECTION_STATE_CHANGE,(h,m)=>{m===Su.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(r,s,o){const c=ie("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,y,v,T){let{appId:R,areaCode:P,cname:N,sid:G,token:j,uid:W}=y;_S++;const Y="image_moderation_api",J={service_name:Y,json_body:JSON.stringify({appId:R,areaCode:P,cname:N,command:"allocateEdge",requestId:_S,seq:_S,sid:G,token:j,ts:Date.now(),uid:W+""})};let le,_e,Ee=m[0];return Cd(async()=>{le=Date.now();const ge=await Od(Ee,{data:J,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-le,ge.code!==0){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ge.code,{retry:!0,responseTime:_e});throw x.error(ft.toString()),ft}const Ne=JSON.parse(ge.json_body);if(Ne.code!==200){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:_e});throw x.error(ft.toString()),ft}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const ft=new Oe(Q.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:_e});throw x.error(ft.toString()),ft}const qe=ie("VIDEO_INSPECT_WORKER_MANAGER_HOST"),dt=ie("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(ft=>{let{address:Sn,wss:bn}=ft;if(Sn&&bn)return"wss://".concat(Sn.replace(/\./g,"-"),".").concat(qe,":").concat(dt||bn)}).filter(ft=>!!ft),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:_e}},(ge,Ne)=>(Ct.apworkerEvent(G,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ge.addressList),firstSuccess:Ne===0,responseTime:_e,serverIp:m[Ne%m.length]}),!1),(ge,Ne)=>(Ct.apworkerEvent(G,{success:!1,sc:ge.data&&ge.data.code||200,serviceName:Y,responseTime:_e,serverIp:m[Ne%m.length]}),!!(ge.code!==Q.OPERATION_ABORTED&&ge.code!==Q.UNEXPECTED_RESPONSE||ge.data&&ge.data.retry)&&(Ee=m[(Ne+1)%m.length],!0)),T)}(c,r,s,o);this.emit(ts.STATE_CHANGE,bu.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ts.STATE_CHANGE,bu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Xt.CONNECTED,async()=>{this.emit(ts.STATE_CHANGE,bu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Xt.CLOSED,()=>{this._innerConnectionState<bu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Xt.FAILED,()=>{this._innerConnectionState<bu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Xt.RECONNECTING,()=>{this._innerConnectionState<bu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Xt.ON_MESSAGE,async r=>{this.emit(ts.STATE_CHANGE,bu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(Q.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(Q.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=ie("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(ts.STATE_CHANGE,bu.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(ts.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(Xt.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(Xt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(Xt.CONNECTED,async()=>{this.emit(ts.STATE_CHANGE,bu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Su.CONNECTED}),this.workerConnection.on(Xt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=Jye(new Uint8Array(r.data));if(ie("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ts.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},d=Ya(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===d);this.emit(ts.INSPECT_RESULT,h)}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(Q.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(Q.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ts.INSPECT_RESULT,void 0,new Oe(Q.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Xt.CLOSED,()=>{this.connectionState=Su.CLOSED}),this.workerConnection.on(Xt.FAILED,()=>{this.connectionState=Su.CLOSED}),this.workerConnection.on(Xt.RECONNECTING,()=>{this.connectionState=this.connectionState===Su.CONNECTED?Su.RECONNECTING:Su.CONNECTING}),this.workerConnection.on(Xt.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(Xt.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(ts.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=Uc(this,ts.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(ts.INSPECT_RESULT,void 0,new Oe(Q.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(ts.INSPECT_RESULT,void 0,new Oe(Q.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),T=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await Wz(T,o,c),P=this.sequence+"-"+d+"-"+y+"-"+v+"-"+ur(12,""),N={appId:o,cid:d,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:T.height,width:T.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:m7(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const j=Xye(N);if(j.byteLength<this.workerMessageLengthLimit){if(ie("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const W=function(Y){for(var J=1;J<arguments.length;J++){var le=arguments[J]!=null?arguments[J]:{};J%2?aK(Object(le),!0).forEach(function(_e){K(Y,_e,le[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(le)):aK(Object(le)).forEach(function(_e){Object.defineProperty(Y,_e,Object.getOwnPropertyDescriptor(le,_e))})}return Y}({},N);delete W.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(W))}return j}{const W=this.quality*this.qualityRatio;return this.quality=W,await this.generateRequestData(r,{appId:o,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Jo.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Su.CLOSED,this.emit(ts.STATE_CHANGE,bu.CLOSED)}}const oEe={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(Q.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(Q.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var d;if(!at(d=["supervise","moderation"]).call(d,c))throw new Oe(Q.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(Q.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new sEe(r)}};var cK=l(vt.Object.getOwnPropertySymbols),aEe=Fn,cEe=Ho.indexOf,lEe=Dp,gM=ae([].indexOf),lK=!!gM&&1/gM([1],1,-0)<0;aEe({target:"Array",proto:!0,forced:lK||!lEe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return lK?gM(this,t,r)||0:cEe(this,t,r)}});var uEe=qa("Array").indexOf,dEe=k,hEe=uEe,_M=Array.prototype,pEe=function(t){var r=t.indexOf;return t===_M||dEe(_M,t)&&r===_M.indexOf?hEe:r},uK=l(pEe);function fEe(t,r){if(t==null)return{};var s,o,c=function(h,m){if(h==null)return{};var y,v,T={},R=OG(h);for(v=0;v<R.length;v++)y=R[v],uK(m).call(m,y)>=0||(T[y]=h[y]);return T}(t,r);if(cK){var d=cK(t);for(o=0;o<d.length;o++)s=d[o],uK(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let dK=class{get localCapabilities(){return zr(this._localCapabilities)}get rtpCapabilities(){return zr(this._rtpCapabilities)}get candidates(){return zr(this._candidates)}get iceParameters(){return zr(this._iceParameters)}get dtlsParameters(){return zr(this._dtlsParameters)}constructor(t){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),t=zr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let T;this.setup=m,T=h===Po.RECEIVE_ONLY?Ra(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ra(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const R=h===Po.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Po.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===Po.RECEIVE_ONLY?c.send.videoCodecs:$T(gt.VIDEO,R,P,y),G=h===Po.RECEIVE_ONLY?c.send.audioCodecs:$T(gt.AUDIO,R,P,v);for(const j of T.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=o,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=N.map(W=>W.payloadType.toString(10)),j.attributes.payloads=N,j.attributes.extmaps=R.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=G.map(W=>W.payloadType.toString(10)),j.attributes.payloads=G,j.attributes.extmaps=R.audioExtensions,gS(j));this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return Gm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=iy(r,this.cname,ie("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(Fr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,d,o);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,d,h,"sendonly",o,c),this.updateBundleMids()):(v=zr(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),Fr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const o=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=zr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:y})}),o}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:o,port:c,type:d,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:o??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(T=>T.priority===v.priority&&T.connectionAddress===v.connectionAddress&&T.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(T=>{T.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,o,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=$T(d,h,this.localCapabilities.send,d===gt.AUDIO?c:o),y=d===gt.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let T={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};T=this.mungRecvMediaDsec(T,t);const R=this.findFirstClosedMedia(d);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=T}else this.sessionDesc.mediaDescriptions.push(T);return T}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>at(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>at(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Fr()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!d||d!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=zr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,o,c,d){const h=this.rtpCapabilities.send,m=t===gt.VIDEO?h.videoCodecs:h.audioCodecs,y=t===gt.VIDEO?h.videoExtensions:h.audioExtensions;Fr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const T=this.findFirstClosedMedia(t);if(T){const R=this.sessionDesc.mediaDescriptions.indexOf(T);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const o=zr(t);return y2(o),mS(o,r),E2(o,r),tH(o),BP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(t,r){const s=zr(t);return BP(s,r,this.localCapabilities.recv),gS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Fr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const mEe=["sdp"];var yr;function hK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function og(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?hK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):hK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let pK=(yr=class WS extends MG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Os("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(WS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Po.SEND_ONLY,this.name=this.direction===Po.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=NL(this.peerConnection,ie("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await rH();if(this.localCapabilities=WP(s),r){const{sdp:o}=r,c=fEe(r,mEe),d=function(){const T={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=HT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Tu(R,T,"videoExtensions",P,N,G),Tu(R,T,"videoCodecs",P,N,G),Tu(R,T,"audioExtensions",P,N,G),Tu(R,T,"audioCodecs",P,N,G),ie("RAISE_H264_BASELINE_PRIORITY")){const j=G.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const W=G.videoCodecs.findIndex(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(W<j){x.debug("raising H264 baseline profile priority");const Y=G.videoCodecs[j];G.videoCodecs.splice(j,1),G.videoCodecs.splice(W,0,Y)}W!==-1&&ie("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>!(Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Y.fmtp&&Y.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:N,sendrecv:G}}({},{},o);this.remoteSDP=new dK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Ym(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await iH({},{},h.sdp);this.localCapabilities=WP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),og(og({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ym(o.sdp);return this.initialOffer=o,og(og({},c),{},{sdp:o.sdp})}}catch(s){throw new xe(Q.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,d=await iH({},{},s);this.remoteSDP=new dK({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new xe(Q.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return wl(function*(){const d=yield In(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((W,Y)=>{if(m[Y].needCreateTransceiver){const J=c.peerConnection.addTransceiver(W._mediaStreamTrack,{direction:"sendonly"});h.push(J),W._updateRtpTransceiver(J)}else{const J=c.peerConnection.getTransceivers().find(le=>le.mid===m[Y].mid);if(!J)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Y].mid));h.push(J),W._updateRtpTransceiver(J)}}),Fr()&&ie("SIMULCAST")===!0&&(yield In(c.applySimulcastForFirefox(h,r)));const y=m.map(W=>W.mid),v=yield In(c.peerConnection.createOffer()),T=c.mungSendOfferSDP(v.sdp,r,y),R=Ra(T),P=y.map(W=>{const Y=R.mediaDescriptions.find(J=>J.attributes.mid===W);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return QG(Y,ie("USE_PUB_RTX"))}),N=h.map((W,Y)=>{const J=y[Y];return{localSSRC:P[Y],id:J}});yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T}));try{yield N}catch(W){const Y=c.remoteSDP.toString();throw yield In(c.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield In(c.stopSending(y,!0)),W}yield In(c.applySimulcastEncodings(h,r)),yield In(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),j=c.logSDPExchange(T,"offer","local","send");return j==null||j(G),yield In(c.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Y)=>{const J=y[Y];return{localSSRC:P[Y],id:J}})}catch(h){throw h instanceof xe?h:new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const T=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(T.sdp,d,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),T=this.mungReceiveAnswerSDP(v.sdp,d,r);y==null||y(T||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:T}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===X_.Auto&&(this.store.p2pTransport=X_.SdRtn,Mn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(WS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Mn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(WS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Ym(s.sdp);return this.store.descriptionStart(),this.direction===Po.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Po.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Ym(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new xe(Q.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Fr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:og(og({},Oh),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:og(og({},Oh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;at(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(NT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...WS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),ie("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...WS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),at(d=[X_.Relay,X_.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),ie("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),ie("ENABLE_ENCODED_TRANSFORM")&&Mn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(o));const h=d.length>o?d[o]:d[0];switch(s){case X_.SdRtn:const m=r.filter(v=>{var T;return at(T=v.username).call(T,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>o?m[o]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(Km(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(Km(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case X_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Km(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Km(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(T=>T.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Mn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:T,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;T&&(d.maxBitrate=1e3*T),at(h=r._hints).call(h,dr.LOW_STREAM)&&(R&&(d.maxFramerate=rc(R)),P&&P>=1&&(d.scaleResolutionDownBy=P))}if(ie("DSCP_TYPE")&&of()){var m;const T=ie("DSCP_TYPE");at(m=["very-low","low","medium","high"]).call(m,T)&&(d.networkPriority=T)}const y=s.getParameters(),v=(o=y.encodings)===null||o===void 0?void 0:o[0];Fr()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!Mn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],d=s[o];d instanceof Sr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=Ra(r);return s.forEach((d,h)=>{const m=o[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(mS(y,d),nH(y,d,this.store.codec))}),Gm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,d,h,m;const v=r[y],T=s[y];if(T instanceof Sr&&!at(o=T._hints).call(o,dr.LOW_STREAM)&&(c=T._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=T._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=T._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=T._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(T._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,s){if(!Fr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Sr&&this.isVP8Simulcast(c)){const d=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,d,h;return!!(r instanceof Sr&&ie("SIMULCAST")&&this.store.codec==="vp8"&&!at(s=r._hints).call(s,dr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(ie("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o,c;if(s=(o=s)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var d;const h=(d=Ra(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||d===void 0?void 0:d.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),at(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=Ra(r),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&o===gt.AUDIO&&d.media.mediaType==="audio"&&gS(d),Gm(c)}},Et(yr.prototype,"establish",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"establish"),yr.prototype),Et(yr.prototype,"connect",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"connect"),yr.prototype),Et(yr.prototype,"receive",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"receive"),yr.prototype),Et(yr.prototype,"mockReceive",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"mockReceive"),yr.prototype),Et(yr.prototype,"stopReceiving",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"stopReceiving"),yr.prototype),Et(yr.prototype,"restartICE",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"restartICE"),yr.prototype),Et(yr.prototype,"close",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),Et(yr.prototype,"updateEncoderConfig",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"updateEncoderConfig"),yr.prototype),Et(yr.prototype,"updateSendParameters",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"updateSendParameters"),yr.prototype),Et(yr.prototype,"replaceTrack",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"replaceTrack"),yr.prototype),Et(yr.prototype,"muteLocal",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"muteLocal"),yr.prototype),Et(yr.prototype,"unmuteLocal",[Au],Object.getOwnPropertyDescriptor(yr.prototype,"unmuteLocal"),yr.prototype),yr);function Au(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}let Nd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var fK,mK,gK,_K,yK,EK,vK,SK,bK,TK,wK,Dr;function CK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function w1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?CK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):CK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let gEe=(fK=Dd(Nd.SEND_ONLY),mK=Dd(Nd.SEND_ONLY),gK=Dd(),_K=Dd(Nd.RECEIVE_ONLY),yK=Dd(Nd.RECEIVE_ONLY),EK=Dd(Nd.RECEIVE_ONLY),vK=Dd(Nd.RECEIVE_ONLY),SK=Dd(Nd.RECEIVE_ONLY),bK=Dd(Nd.RECEIVE_ONLY),TK=Dd(),wK=Dd(Nd.RECEIVE_ONLY),Dr=class extends Mr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Nt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Kn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(s,o,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Kn.Connected)return void c(new xe(Q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void o();const v=y.find(N=>N[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(N=>{let[,{id:G}]=N;return G}));let T=!1;var h,m;s.trackMediaType==="video"?T=!((h=this.localTrackMap.get(He.LocalAudioTrack))===null||h===void 0||!h.track._muted):T=((m=this.localTrackMap.get(He.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await lr(this,Nt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?$m.MUTE_LOCAL_VIDEO:$m.MUTE_LOCAL_AUDIO;await lr(this,Nt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:T}),o()}catch(y){c(y)}finally{d()}}),K(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Kn.Connected)return void c(new xe(Q.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:T}]=v;return T}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?$m.UNMUTE_LOCAL_VIDEO:$m.UNMUTE_LOCAL_AUDIO;await lr(this,Nt.RequestP2PMuteLocal,{action:y,message:m}),o()}catch(h){c(h)}finally{d()}}),K(this,"handleUpdateVideoEncoder",async(s,o,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(He.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Kn.Connected)return void o();const{id:v,track:T}=y;v&&(await this.sendConnection.updateSendParameters(v,T),await this.sendConnection.updateEncoderConfig(v,T),this.emit(Nt.UpdateVideoEncoder,T)),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(He.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Kn.Connected)return void o();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{d()}}),K(this,"handleReplaceTrack",async(s,o,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(T=>{let[,{track:R}]=T;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Kn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===He.LocalVideoTrack&&Mn().supportDualStreamEncoding){const T=this.localTrackMap.get(He.LocalVideoLowTrack);if(T){const R=s._mediaStreamTrack.clone();T.track._originMediaStreamTrack.stop(),T.track._mediaStreamTrack=R,T.track._originMediaStreamTrack=R,await new ut((P,N)=>{this.handleReplaceTrack(T.track,P,N,!0)})}}o()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new zH(t),this.bindStatsUploaderEvents(),this.sendMutex=new Os("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Os("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},ie("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new pK(t,this.store,Po.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Kn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new pK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new xe(Q.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Kn.Connected}async addRemoteCandidate(t,r){if(r===Po.RECEIVE_ONLY){if(!this.sendConnection)throw new xe(Q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new xe(Q.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var o=this;return wl(function*(){const c=yield In(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Kn.Connected){o.throwIfTrackTypeNotMatch(t);const v=t.filter(T=>o.pendingLocalTracks.indexOf(T)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(v))}o.store.pubId=o.store.pubId+1,Ds.markPublishStart(o.store.clientId,o.store.pubId);const d=o.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield In(o.tryToUnmuteAudio(t)));d.forEach(v=>{let{track:T,type:R}=v;const P=Date.now();o.store.publish(T.getTrackId(),R===He.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(d);const h=yield In(o.sendConnection.send(d.map(v=>{let{track:T}=v;return T}),o.store.codec,o.store.audioCodec)),m=(yield In(h.next())).value,y=o.createGatewayPublishMessage(d,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===Q.WS_ABORT&&d.forEach(T=>{let{track:R}=T;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(d),v}yield In(h.next()),d.forEach(v=>{let{type:T}=v;o.statsCollector.addLocalStats(T)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(d,m),d.forEach(v=>{let{track:T,type:R}=v;const P=Date.now();o.store.publish(T.getTrackId(),R===He.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Kn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!at(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Kn.Connected)return s&&s[1].track.close(),o;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:d,ssrcs:h}]=o;const m={stream_type:a_e(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{lr(this,Nt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{lr(this,Nt.RequestUnmuteLocal,[o])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return wl(function*(){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await bs(this,Nt.RequestRePublish,this.pendingLocalTracks),this.emit(Nt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,o){var c;if(!this.recvConnection)throw new xe(Q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),o);r===gt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new aS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new oS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(T=>{let{user:R,kind:P}=T;return R.uid===t.uid&&r===P});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(Nt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,o){if(!this.recvConnection)throw new xe(Q.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),o)}async unsubscribe(t,r,s){const o=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(o.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(d=>{let{kind:h}=d;var m;if(h===gt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===gt.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:m}]=d;var y,v;if(m===gt.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===gt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===gt.AUDIO){var T;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((T=h._audioTrack)===null||T===void 0||T._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;lr(this,Nt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[gt.VIDEO,gt.AUDIO].forEach(o=>{s.has(o)?lr(this,Nt.RequestP2PUnmuteRemote,o):lr(this,Nt.RequestP2PMuteRemote,o)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new xe(Q.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const o=r===gt.VIDEO?t._videoSSRC:t._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(He.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Oi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==He.LocalAudioTrack}).filter(o=>{let[c]=o;return!(t&&c===He.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(t&&o===He.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(t,r,s,o,c){if(t){const h=this.localTrackMap.get(He.LocalAudioTrack),m=o?this.localTrackMap.get(He.LocalVideoLowTrack):this.localTrackMap.get(He.LocalVideoTrack);Ct.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof qr),m=o?(d=this.localTrackMap.get(He.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Sr);Ct.publish(this.store.sessionId,{eventElapse:Ds.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(dr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,o){const c=o===gt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Ct.subscribe(this.store.sessionId,{succ:t,ec:r,video:o===gt.VIDEO,audio:o===gt.AUDIO,peerid:s.uid,subscribeRequestid:o===gt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ds.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Os("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Os("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(He.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Oi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Kn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(He.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(He.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Sr||r&&r.track instanceof qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(jc(r=this.remoteUserMap).call(r)).find(o=>o.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(He.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=gT(t).call(t,(s,o)=>s.level-o.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Kn.Reconnecting,ie("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:o}]=t;switch(s){case He.LocalVideoTrack:at(r=o._hints).call(r,dr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case He.LocalAudioTrack:o instanceof Oi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case He.LocalVideoLowTrack:}}),this.emit(Nt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(jc(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(Nt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((t instanceof Jm?t.uid:t)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,o;if(t===Po.SEND_ONLY){if(!this.sendConnection)throw new xe(Q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new xe(Q.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const d=await bs(this,Nt.RequestP2PRestartICE,{direction:Po.RECEIVE_ONLY,iceParameter:c});await o.restartICE(d),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(He.LocalVideoTrack),s=this.localTrackMap.get(He.LocalAudioTrack),o=t.videoSend.find(N=>{var G;return N.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(N=>{var G;return N.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const d=Uc(this,Nt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,T=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=T<.17?1:T<.36?2:T<.59?3:T<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(dr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const j=(1e3*N-G)/(1e3*N);return IG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,d=o._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=Uc(this,Nt.NeedSignalRTT),v=t.rtt,T=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let N=.7*P*100/50+.3*T/1500;R&&(N=.6*P*100/50+.2*T/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new ut((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const o=[],c=Mn(),d=this.getAllTracks();t=Kv(t=t.filter(y=>d.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Sr&&(this.localTrackMap.has(He.LocalVideoTrack)||h?new xe(Q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:He.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);o.push({track:v,type:He.LocalVideoLowTrack})}if(y instanceof qr){const v=this.localTrackMap.get(He.LocalAudioTrack);if(v){if(!(v.track instanceof Oi))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const T=o.find(R=>{let{type:P}=R;return P===He.LocalAudioTrack});if(!(T.track instanceof Oi))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");T.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Oi||y._bypassWebAudio)o.push({track:y,type:He.LocalAudioTrack});else{const T=new Oi;T.addAudioTrack(y),o.push({track:T,type:He.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Kv(t=t.filter(o=>s.indexOf(o)!==-1));for(const o of t){if(o instanceof qr){const c=this.localTrackMap.get(He.LocalAudioTrack);if(!c)continue;c.track instanceof Oi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([He.LocalAudioTrack,c]),c.track.close())):r.push([He.LocalAudioTrack,c])}if(o instanceof Sr){const c=this.localTrackMap.get(He.LocalVideoTrack);if(!c)continue;r.push([He.LocalVideoTrack,c]);const d=this.localTrackMap.get(He.LocalVideoLowTrack);d&&r.push([He.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:o}=r;switch(o){case He.LocalVideoTrack:s.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case He.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Oi?t.trackList.forEach(s=>{s.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),t.forEach(r=>{let{track:s,type:o}=r;switch(o){case He.LocalVideoTrack:s.off(yt.GET_STATS,this.handleGetLocalVideoStats),s.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(yt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case He.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Oi?t.trackList.forEach(r=>{r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(yt.GET_STATS,this.handleGetLocalAudioStats),t.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof oS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof aS&&r.addListener(yt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(gt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(gt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,o)=>{var c;let d,{track:h,type:m}=s;switch(m){case He.LocalAudioTrack:d=qn.Audio;break;case He.LocalVideoTrack:d=at(c=h._hints).call(c,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalVideoLowTrack:d=qn.Low}return{kind:m===He.LocalAudioTrack?gt.AUDIO:gt.VIDEO,stream_type:d,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case He.LocalVideoTrack:o=at(s=d._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,o)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Nt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),at(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await os(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Ct.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Wr.TRACER}).onSuccess(),this.emit(Nt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const o=Array.from(jc(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(tS.FIRST_FRAME_DECODED),Ct.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_DECODE,kr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const o=Array.from(jc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Ct.firstRemoteFrame(this.store.sessionId,Fi.FIRST_AUDIO_RECEIVED,kr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},t.onFirstVideoReceived=r=>{var s;const o=Array.from(jc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Ct.firstRemoteFrame(this.store.sessionId,Fi.FIRST_VIDEO_RECEIVED,kr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(Nt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Nt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Po.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Po.SEND_ONLY?this.restartICE(t):bs(this,Nt.RequestP2PRestartICE,{direction:Po.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(He.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive||r.push([He.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o&&(r.push(o),o[0]===He.LocalVideoTrack)){const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&r.push([He.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(He.LocalAudioTrack);if(t instanceof qr&&(s==null?void 0:s.track)instanceof Oi)return s.track.isActive&&r.push([He.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(o)if(o[0]===He.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(He.LocalVideoLowTrack);c&&r.push([He.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoTrack:o=at(s=d._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let o,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case He.LocalAudioTrack:o=qn.Audio;break;case He.LocalVideoTrack:o=at(s=d._hints).call(s,dr.SCREEN_TRACK)?qn.Screen:qn.High;break;case He.LocalVideoLowTrack:o=qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],o=this.remoteUserMap.get(t);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[o,{kind:c,id:d}]=s;switch(c){case gt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:gt.VIDEO,ssrcId:o._videoSSRC}));case gt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:gt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(He.LocalVideoTrack),s=this.localTrackMap.get(He.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new ut((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new ut((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof qr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await lr(this,Nt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Nt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Nt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await os(RL(this.dtlsFailedCount,wi)),this.emit(Nt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(He.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Sr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Sr).length>1)throw new xe(Q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof qr).length>1&&(t.some(r=>r instanceof qr&&r._bypassWebAudio)||!Mn().webAudioMediaStreamDest))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Sr&&this.pendingLocalTracks.some(s=>s instanceof Sr))throw new xe(Q.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof qr&&this.pendingLocalTracks.some(s=>s instanceof qr)&&(!Mn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof qr&&s._bypassWebAudio)))throw new xe(Q.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!ie("DISABLE_DUAL_STREAM_USE_ENCODING")&&Mn().supportDualStreamEncoding,o=w1(w1({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():L2(t,o);const d=ur(8,"track-low-"),h=new Sr(c,w1(w1({},s&&{scaleResolutionDownBy:_2(o,t)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return h.on(J_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Zv.LOW_STREAM)}),h._hints.push(dr.LOW_STREAM),t.addListener(yt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,o){var c;const d=Array.from(jc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){o||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Ct.firstRemoteVideoDecode(this.store.sessionId,Fi.FIRST_VIDEO_DECODE,kr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Ds.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(t);if(!o)return!1;const c=o.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new xe(Q.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new xe(Q.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new xe(Q.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new xe(Q.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new xe(Q.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new xe(Q.NOT_SUPPORTED)}async preConnect(t){throw new xe(Q.NOT_SUPPORTED)}getEstablishParams(){throw new xe(Q.NOT_SUPPORTED)}async reSubscribe(t){throw new xe(Q.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new xe(Q.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===He.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Zv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Et(Dr.prototype,"p2pConnect",[fK],Object.getOwnPropertyDescriptor(Dr.prototype,"p2pConnect"),Dr.prototype),Et(Dr.prototype,"unpublish",[mK],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublish"),Dr.prototype),Et(Dr.prototype,"unpublishLowStream",[gK],Object.getOwnPropertyDescriptor(Dr.prototype,"unpublishLowStream"),Dr.prototype),Et(Dr.prototype,"subscribe",[_K],Object.getOwnPropertyDescriptor(Dr.prototype,"subscribe"),Dr.prototype),Et(Dr.prototype,"mockSubscribe",[yK],Object.getOwnPropertyDescriptor(Dr.prototype,"mockSubscribe"),Dr.prototype),Et(Dr.prototype,"unsubscribe",[EK],Object.getOwnPropertyDescriptor(Dr.prototype,"unsubscribe"),Dr.prototype),Et(Dr.prototype,"muteRemote",[vK],Object.getOwnPropertyDescriptor(Dr.prototype,"muteRemote"),Dr.prototype),Et(Dr.prototype,"unmuteRemote",[SK],Object.getOwnPropertyDescriptor(Dr.prototype,"unmuteRemote"),Dr.prototype),Et(Dr.prototype,"hasRemoteMediaWithLock",[bK],Object.getOwnPropertyDescriptor(Dr.prototype,"hasRemoteMediaWithLock"),Dr.prototype),Et(Dr.prototype,"disconnectForReconnect",[TK],Object.getOwnPropertyDescriptor(Dr.prototype,"disconnectForReconnect"),Dr.prototype),Et(Dr.prototype,"remoteMediaSsrcChanged",[wK],Object.getOwnPropertyDescriptor(Dr.prototype,"remoteMediaSsrcChanged"),Dr.prototype),Dr);function Dd(t){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case Nd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Nd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},o}}class yy extends Mr{constructor(r,s){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===fr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*ie("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,d){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(Lc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:ur(6,""),d=(y=d)!==null&&y!==void 0?y:this._sequence++;const T={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(v)};ie("SHOW_P2P_LOG")&&x.debug("send message",T,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(T)).forEach(P=>{this.signal.request(Wt.DATA_STREAM,{payload:zm(this.encoder.encode(P))})});const R=new ut((P,N)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Y),this.off(hS.ABORT,W),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?N(new xe(Q.INVALID_REMOTE_USER)):N(new xe(Q.TIMEOUT))},ie("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),j=()=>{G&&window.clearTimeout(G),this.off(hS.ABORT,W),o&&P()},W=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Y),N(new xe(Q.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(hS.ABORT,W),this.once("res-@".concat(c,"_ack"),j);const Y=(le,_e)=>{J=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off(hS.ABORT,W),le==="success"?P(_e):N(new xe(Q.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let J=!1;o||(this.once("res-@".concat(c),Y),os(ie("SIGNAL_REQUEST_TIMEOUT")).then(()=>{J||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(T))}))});try{return await R}catch(P){if(P.code===Q.TIMEOUT)return await this.send(r,s,o,c,d);throw P}}onMessage(r){var s;const{_uid:o}=r;let c,d=this.userMap.get(o);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==oi.CHECK)return;const{token:v}=r;c=new Map,d={uid:o,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,d),this.signal.emit(En.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:T}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==T)return;{const P=gT(R).call(R,(N,G)=>N.index-G.index).map(N=>N.payload).join("");c.delete(v),(r=JSON.parse(P))._uid=o}}const{_type:m,token:y}=r;if(at(s=[oi.ACK,oi.CHECK]).call(s,m))return m===oi.CHECK&&this.handleCheckToken(d,y),void this.receiveMessage(r);y==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:ur(6,""),token:this.token,_type:oi.CHECK};ie("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Wt.DATA_STREAM,{payload:zm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:oi.ACK,token:this.token};ie("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Wt.DATA_STREAM,{payload:zm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(oi.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:T,nextExpectedSequenceNumber:R}=v;for(;T.has(R);){const P=T.get(R);T.delete(R),this.receiveMessage(P),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,d=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=d;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:d}=r;if(ie("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==oi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case oi.CANDIDATE:case oi.CONTROL:this.signal.emit(o,h,d);break;case oi.PUBLISH:case oi.UNPUBLISH:case oi.RESTART_ICE:case oi.CALL:h.uid=d,bs(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case oi.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case oi.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<yy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=ur(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const y={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(y).length>yy.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},ie("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await bs(this.signal,oi.CALL,void 0),s=await this.send(oi.CALL,r);this.signal.emit(zt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(hS.ABORT),this.signal.emit(En.ON_USER_OFFLINE,{uid:o.uid,reason:Lge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=ur(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(hS.ABORT)}}K(yy,"MAX_SIZE",1),K(yy,"MAX_MESSAGE_SIZE",1024);class _Ee extends Mr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===fr.CONNECTED?this.emit(zt.WS_CONNECTED):r===fr.RECONNECTING?this.emit(zt.WS_RECONNECTING,this._websocketReconnectReason):r===fr.CLOSED&&this.emit(zt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",fr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new tz(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(zt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case En.ON_DATA_STREAM:return void this.handleDataStream(c._message);case En.MUTE_AUDIO:case En.MUTE_VIDEO:case En.ON_P2P_LOST:case En.ON_USER_ONLINE:return;case En.ON_USER_OFFLINE:const{uid:d}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===En.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===En.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close($n.UID_BANNED);break;case 15:this.close($n.IP_BANNED);break;case 16:this.close($n.CHANNEL_BANNED)}if(c._type===En.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close($n.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close($n.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close($n.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close($n.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close($n.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close($n.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new m2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,ie("JOIN_GATEWAY_USE_DUAL_DOMAIN"),ie("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===fr.CONNECTED&&this.reconnect("retry",Ss.OFFLINE)}),this.p2pToken=ur(6,""),this._external_signal=new yy(this,this.p2pToken)}async request(r,s,o,c){const d=ur(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new ut((G,j)=>{if(this.connectionState===fr.CONNECTED)return G();const W=()=>{this.off(zt.WS_CLOSED,Y),G()},Y=()=>{this.off(zt.WS_CONNECTED,W),j(new xe(Q.WS_ABORT))};this.once(zt.WS_CONNECTED,W),this.once(zt.WS_CLOSED,Y)});if(this.connectionState!==fr.CONNECTING&&this.connectionState!==fr.RECONNECTING||r===Wt.JOIN||r===Wt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new ut((G,j)=>{let W=!1;const Y=(le,_e)=>{W=!0,G({isSuccess:le==="success",message:_e||{}}),this.off(zt.WS_CLOSED,J),this.off(zt.WS_RECONNECTING,J),this.emit(zt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Y);const J=()=>{j(new xe(Q.WS_ABORT,"type: ".concat(r))),this.off(zt.WS_CLOSED,J),this.off(zt.WS_RECONNECTING,J),this.off("res-@".concat(d),Y)};this.once(zt.WS_CLOSED,J),this.once(zt.WS_RECONNECTING,J),os(ie("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(zt.REQUEST_TIMEOUT,r,s))})});let T=null;try{T=await v}catch(G){if(this.connectionState===fr.CLOSED||r===Wt.LEAVE)throw new xe(Q.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Wt.JOIN||r===Wt.REJOIN?null:(await y(),await this.request(r,s))}if(T.isSuccess)return T.message;const R=Number(T.message.error_code||T.message.code),P=WT(R),N=new xe(Q.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(T.message.error_str),{code:R,data:T.message,desc:P.desc});return P.action==="success"?T.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Wt.JOIN||r===Wt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=T.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ss.MULTI_IP)):this.reconnect(P.action,Ss.SERVER_ERROR),r===Wt.JOIN||r===Wt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ut(o=>{const c=d=>{(!s||s(d))&&(this.off(r,c),o(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(FT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const d=ie("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==fr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},ie("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ut((s,o)=>{this.once(zt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(zt.WS_CLOSED,()=>o(this.initError||new xe(Q.WS_ABORT))),this.connectionState=fr.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||$n.LEAVE,this.connectionState=fr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ur(6,""),this._external_signal.clear(),this._external_signal=new yy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(zt.ABORT_P2P_EXECUTION);const r=await bs(this,zt.REQUEST_JOIN_INFO),s=await this.request(Wt.JOIN,r);if(!s)return this.emit(zt.REPORT_JOIN_GATEWAY,Q.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(zt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=fr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const o=q_(r.payload),c=new TextDecoder().decode(o),d=JSON.parse(c);"total"in d&&"id"in d||at(s=Object.values(oi)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(En.ON_DATA_STREAM,r)}catch{this.emit(En.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=WT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close($n.UID_BANNED),void this.close()):void this.reconnect(s.action,Ss.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=ie("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>ie("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ss.TIMEOUT):this.request(Wt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),ie("REPORT_STATS")&&this.send(Wt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Xt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(zt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Xt.CLOSED,()=>{this.connectionState=fr.CLOSED}),this.websocket.on(Xt.FAILED,()=>{this._disconnectedReason=$n.NETWORK_ERROR,this.connectionState=fr.CLOSED}),this.websocket.on(Xt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===fr.CONNECTED?this.connectionState=fr.RECONNECTING:this.connectionState=fr.CONNECTING}),this.websocket.on(Xt.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(Xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(zt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof xe&&r.code===Q.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ss.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ss.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Xt.REQUEST_NEW_URLS,(r,s)=>{bs(this,zt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(En.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const yEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new gEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new _Ee(s,r)}};function RK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function IK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?RK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):RK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}class EEe{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=zr(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,T=Ra(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=zr(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<T.mediaDescriptions.length;R++){const P=T.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=d.videoCodecs.map(G=>G.payloadType.toString(10));let N=d.videoCodecs.filter(G=>{var j,W;return(j=G.rtpMap)===null||j===void 0?void 0:at(W=j.encodingName.toLowerCase()).call(W,y)});N.length===0&&(N=d.videoCodecs),P.attributes.payloads=N,P.attributes.extmaps=d.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=d.audioCodecs.map(N=>N.payloadType.toString(10)),P.attributes.payloads=d.audioCodecs,P.attributes.extmaps=d.audioExtensions),T.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=T,this.currentMidIndex=T.mediaDescriptions.length-1}toString(){return Gm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:d}=iy(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===gt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{at(r).call(r,h.attributes.label||"")?d.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;at(m=d.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(IK(IK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Ns.TCP_RELAY:this.candidates=o;break;case Ns.UDP_TCP_RELAY:case Ns.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=zr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=zr(r);return mS(o,s),E2(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===gt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=o,(d=h.attributes.msid)===null||d===void 0||d.replace(s,o))}}mungMediaDesc(r){const s=zr(r);return y2(s),function(o){const c=o.attributes.extmaps.find(d=>FP(d.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var cr;function AK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,o)}return s}function C1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?AK(Object(s),!0).forEach(function(o){K(t,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):AK(Object(s)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(s,o))})}return t}let vEe=(cr=class aC extends UG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return at(s=Object.keys(mP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=s,this.mutex=new Os("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(aC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=NL(this.peerConnection,ie("STATS_UPDATE_INTERVAL"),void 0,Fr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Ym(r.sdp),o=HT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:ie("FILTER_VIDEO_FEC"),filterAudioFec:ie("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,C1(C1({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new xe(Q.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new EEe(C1(C1({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new xe(Q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return wl(function*(){const c=yield In(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield In(o.peerConnection.createOffer()),m=Ra(h.sdp),y=r.map(P=>{const N=P._mediaStreamTrack,G=m.mediaDescriptions.find(j=>j.attributes.mid===N.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,W,Y){const J=j.attributes.ssrcs.filter(_e=>_e.attributes.label===W),le=j.attributes.ssrcGroups;if(J.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(le&&J.length>1){const _e=le.find(Ee=>Ee.ssrcIds.indexOf(J[0].ssrcId)!==-1);return _e?[{ssrcId:_e.ssrcIds[0],rtx:Y?_e.ssrcIds[1]:void 0}]:[{ssrcId:J[0].ssrcId}]}return[{ssrcId:J[0].ssrcId}]}(G,N.id,o.useRTX)});let v;try{v=yield y}catch(P){throw d.forEach(N=>{vs()&&N.replaceTrack(null),o.peerConnection.removeTrack(N)}),P}const T=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,v);const R=o.remoteSDP.toString();return yield In(o.peerConnection.setLocalDescription({type:"offer",sdp:T})),yield In(o.applySendEncodings(d,r)),yield In(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,N)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[N],id:G}})}catch(d){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{vs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new ut((T,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(d)))},1e4),N=G=>{const j=An();if((j.name==="Safari"&&Number(j.version)===11||Ro())&&G.track.id!==d&&G.streams[0].id===h){var W;const Y=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(r,d,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T(Y)}if(G.track.id===d)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T(G.track)};this.peerConnection.addEventListener("track",N)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:d}}catch(d){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(vs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(d=>d.active=!1),o.setParameters(c)}})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(vs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return wl(function*(){const o=yield In(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Mn().supportPCSetConfiguration;if(r===Ns.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),T=r===Ns.RELAY?"relay":"all";v.iceTransportPolicy!==T&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(T,"]")),v.iceTransportPolicy=T,s.peerConnection.setConfiguration(v))}r!==Ns.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield In(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Ym(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield In(s.peerConnection.setLocalDescription(d)),yield In(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(o){throw new xe(Q.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new xe(Q.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new xe(Q.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},ie("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(NT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...aC.turnServerConfigToIceServers(r.turnServer.servers)),ie("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...aC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(v=>{var T;return((T=v.track)===null||T===void 0?void 0:T.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Mn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Sr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(ie("DSCP_TYPE")&&of()){var h;const v=ie("DSCP_TYPE");at(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const m=s.getParameters(),y=(o=m.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,d),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Mn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],d=s[o];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=Ra(r);return s.forEach((c,d)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&mS(m,c)}),Gm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((d,h)=>{let{id:m,mslabel:y}=d;const{kind:v}=r[h];return new ut((T,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=G=>{const j=An();if(j.name==="Safari"&&Number(j.version)===11&&G.track.id!==m&&G.streams[0].id===y){var W;const Y=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T({track:Y,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void T({track:G.track,id:m})};this.peerConnection.addEventListener("track",N)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ut.all(s)}catch(s){throw new xe(Q.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Mn().supportPCSetConfiguration){const s=aC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Et(cr.prototype,"connect",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"connect"),cr.prototype),Et(cr.prototype,"stopSending",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"stopSending"),cr.prototype),Et(cr.prototype,"receive",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"receive"),cr.prototype),Et(cr.prototype,"stopReceiving",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"stopReceiving"),cr.prototype),Et(cr.prototype,"muteRemote",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"muteRemote"),cr.prototype),Et(cr.prototype,"unmuteRemote",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteRemote"),cr.prototype),Et(cr.prototype,"muteLocal",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"muteLocal"),cr.prototype),Et(cr.prototype,"unmuteLocal",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteLocal"),cr.prototype),Et(cr.prototype,"close",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"close"),cr.prototype),Et(cr.prototype,"updateEncoderConfig",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"updateEncoderConfig"),cr.prototype),Et(cr.prototype,"updateSendParameters",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"updateSendParameters"),cr.prototype),Et(cr.prototype,"replaceTrack",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"replaceTrack"),cr.prototype),Et(cr.prototype,"getRemoteSSRC",[Nl],Object.getOwnPropertyDescriptor(cr.prototype,"getRemoteSSRC"),cr.prototype),cr);function Nl(t,r,s){const o=t[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{d()}},s}const SEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new vEe(s,r)}},bEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(wP.has(t)||!t.track)return;const s={track:t.track};if(sf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const y=r.metadata&&r.metadata();y?function(v,T){const{chunk:R,controller:P}=T,N=ie("ENABLE_AUDIO_PTS_METADATA")?uf.AUDIO_64_BIT_PTS:uf.METADATA;R.data=function(G,j,W){const Y=W.byteLength,J=Y+n2+SG,le=e2+t2+J,_e=new ArrayBuffer(G.byteLength+le),Ee=new DataView(_e);Ee.setUint8(0,vG),Ee.setUint16(1,J),Ee.setUint8(3,j),Ee.setUint16(4,Y);for(let Ne=0;Ne<Y;Ne++)Ee.setUint8(6+Ne,W[Ne]);const ge=new Uint8Array(Ee.buffer);return ge.set(new Uint8Array(G),le),ge.buffer}(R.data,N,v),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=TP(),d=new MessageChannel;await new ut(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new ut(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&d.port1.postMessage({metadata:v})}},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=wP.get(t);if(c){wP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}wP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(OP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(sf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");fL(Bn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)),r.enableTopn?function(y,v,T){var R;const P=bG(new DataView(v.data));if(!P)return T.enqueue(v);const N=y.track.id;nge.set(N,y.track);const G=(R=P.tlv.find(_e=>_e.tag===uf.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let j=0;typeof G=="number"&&(j=127-G);const W=Math.round(Math.pow(10,j/60)-1),{selected:Y,speaker:J}=function(_e,Ee){let ge=cS.get(_e);if(ge||(ge=function(Ne){const qe=new wG;return cS.set(Ne,qe),Id||(Id=new ege(ie("TOPN_SILENCE_THRESHOLD")||500),Id.on("ActiveSpeakerChanged",dt=>{dt!=null&&(IP=dt)})),Id.addSpeakers([qe]),qe}(_e)),cS.size<=CG)return{selected:!0,speaker:ge};if(!Id)throw new Error("no active speaker detector");return Id.levelChanged(ge.id,Ee),ty=Id.loudest.map(Ne=>Ne.id),IP&&!at(ty).call(ty,IP)&&ty.length>=CG&&ty.pop(),{selected:at(ty).call(ty,ge.id)||ge.id===IP,speaker:ge}}(y,W),le=function(_e,Ee,ge){const Ne=Ad.get(_e)||new tge(_e,Ee);return Ne.score=ge,Ad.set(_e,Ne),function(qe){if(AP.set(qe,!0),!PP)return void(PP=Date.now());const dt=Date.now();dt-PP>1e3&&(AP.get(qe)?AP.set(qe,!1):(RG(qe),AP.delete(qe)),PP=dt)}(_e),Ne}(N,y.track,J.energyScore);le.addSample(Y),le.active&&(v.data=P.frame.buffer,T.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,T){const R=bG(new DataView(y.data));if(!R)return v.enqueue(y);const P=R.tlv.find(N=>N.tag===uf.METADATA||N.tag===uf.AUDIO_64_BIT_PTS);P&&T&&P.value instanceof Uint8Array&&T(P.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=TP(),d=new MessageChannel;await new ut(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new ut(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function o(){t.track.removeEventListener("ended",o),function(c){const d=OP.get(c);if(d){(function(y){const v=cS.get(y);v&&(cS.delete(y),Id&&(Id.removeSpeakers([v]),cS.size===0&&(Id.destroy(),Id=null)))})(c),RG(c.track.id),OP.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}OP.set(t,s),t.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(t,r){if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(kP.has(t)||!t.track)return;const s={track:t.track};if(sf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",m=>{d.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const v=d.shift();v&&(m.data=function(T,R){const P=function(J){const le=J.length;let _e=[],Ee=0;for(;Ee<le;)Ee+2<le&&J[Ee]===0&&J[Ee+1]===0&&(J[Ee+2]===0||J[Ee+2]===1||J[Ee+2]===2||J[Ee+2]===3)?(_e.push(J[Ee],J[Ee+1],3,J[Ee+2]),Ee+=3):(_e.push(J[Ee]),Ee++);return new Uint8Array(_e)}(R),N=P.length,G=Math.floor(N/255),j=N%255,W=new Uint8Array(6+G+1+N+T.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=6,W[5]=101;let Y=0;for(;Y<G;)W[6+Y]=255,Y++;return W[6+Y]=j,Y++,W.set(P,6+Y),W.set(new Uint8Array(T),6+Y+N),W.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!vs())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=TP(),d=new MessageChannel;await new ut(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new ut(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}const c=kP.get(t);if(c){kP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}kP.set(t,s),t.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Mn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(jT.has(t)){const c=jT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(sf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o));const y=function(v){const T=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(T.getUint8(R+0)===0&&T.getUint8(R+1)===0&&T.getUint8(R+2)===0&&T.getUint8(R+3)===1&&T.getUint8(R+4)===6){let P=R+6,N=0,G=0;for(;(G=T.getUint8(P++))===255;)N+=255;N+=G;const j=rge(v.data,P,N);return new Uint8Array(j)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(vs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=TP(),d=new MessageChannel;await new ut(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new ut(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",o),s.track=t.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",o)}(function(c){const d=jT.get(c);if(d){jT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}jT.set(t,s),t.track.addEventListener("ended",o)}},TEe={name:"InterceptFrame",create:()=>bEe};DL(),er("PROCESS_ID","process-".concat(ur(8,""),"-").concat(ur(4,""),"-").concat(ur(4,""),"-").concat(ur(4,""),"-").concat(ur(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(vr,o)){const{value:c,expires:d}=r[o];if(d&&d<=s)return;Rd[o]=c,vr[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Rd.AREAS)&&Rd.AREAS.length>0&&w2(Rd.AREAS,!0);const PK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),er(t,r,s)};Xm($ye,!1),Xm(Yye,!1),Xm(A_e,!1),Xm(oEe,!1),Xm(zye,!1),Xm(yEe,!1),Xm(SEe,!1),Xm(TEe,!1);const Ci=function(t){const r=new Mr,s=t,o={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(h,m){h===xh.SECURITY_POLICY_VIOLATION&&l$(m,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return c$(c$({},s),o)}({__TRACK_LIST__:Qv,VERSION:Cl,BUILD:ML,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:PK,getParameter:ie,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return Mn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(Q.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Ct.reportApiInvoke(null,{name:Ti.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Wr.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&yL()&&OW(75)&&new d().close()}catch(d){return x.error("check system requirement failed: ",d),!1}let s=!1;const o=An();o.name===Bn.CHROME&&Number(o.version)>=58&&(wd.engine.name!=="WebKit"||function(){const d=An();if(oP()){if(d.os===ji.MAC_OS)return!0;if(d.os===ji.IOS){const h=wd.os.version&&wd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Bn.FIREFOX&&Number(o.version)>=56||o.name===Bn.OPERA&&Number(o.version)>=45||o.name===Bn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Ro()||_u())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||MW()||An().name===Bn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return Gc.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Gc.getRecordingDevices(t)},getCameras:function(t){return Gc.getCamerasDevices(t)},getElectronScreenSources:Oz,getPlaybackDevices:function(t){return Gc.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=ur(5,"client-"),o=Ct.reportApiInvoke(null,{id:s,name:Ti.CREATE_CLIENT,options:[r],tag:Wr.TRACER});try{(function(c){xi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),xi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&xi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&ss(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&GW(c.turnServer),c.httpRetryConfig!==void 0&&zW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&zW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return(NW(16,0)||DW(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),er("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new P_e(Cu(Cu({forceWaitGatewayResponse:!0},r),{},{role:at(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=ie("CAMERA_CAPTURE_CONFIG"),s=ur(8,"track-cam-"),o=Ct.reportApiInvoke(null,{id:s,tag:Wr.TRACER,name:Ti.CREATE_CAM_VIDEO_TRACK,options:[Nr({},t),r]});r&&(t.encoderConfig=r);const c=SP(t);let d=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await zc({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!d){const m=new xe(Q.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}t.optimizationMode&&ZL(s,d,t,kh(t.encoderConfig));const h=new QL(d,t,c,t.scalabiltyMode?_P(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=ur(8,"track-cus-"),s=Ct.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ti.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),o=new Sr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?_P(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[dr.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),x.info("create custom video track success with config",t,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return Fz(P)}(r):void 0;s&&(r="auto");const o=ur(8,"track-scr-v-"),c=Ct.reportApiInvoke(null,{id:o,tag:Wr.TRACER,name:Ti.CREATE_SCREEN_VIDEO_TRACK,options:[Nr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(P){const N={};P.screenSourceType&&(N.mediaSource=P.screenSourceType),P.extensionId&&sf()&&(N.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:j,surfaceSwitching:W,systemAudio:Y,preferCurrentTab:J}=P;(AT(107)||mL(107)||gL(93))&&(G&&(xi(G,"displaySurface",["browser","window","monitor"]),N.displaySurface=G),j?(xi(j,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=j):N.selfBrowserSurface="include",W&&(xi(W,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=W)),(AT(105)||mL(105)||gL(91))&&Y&&(xi(Y,"systemAudio",["exclude","include"]),N.systemAudio=Y),(AT(94)||mL(94)||gL(80))&&J&&(N.preferCurrentTab=!0),P.electronScreenSourceId&&(N.sourceId=P.electronScreenSourceId);const le=P.encoderConfig?BL(P.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:le?le.width:void 0,maxHeight:le?le.height:void 0},le&&(le.frameRate&&(typeof le.frameRate=="number"?(N.mandatory.maxFrameRate=le.frameRate,N.mandatory.minFrameRate=le.frameRate):(N.mandatory.maxFrameRate=le.frameRate.max||le.frameRate.ideal||le.frameRate.exact||void 0,N.mandatory.minFrameRate=le.frameRate.min||le.frameRate.ideal||le.frameRate.exact||void 0),N.frameRate=le.frameRate),le.width&&(N.width=le.width),le.height&&(N.height=le.height)),N}(t);let h=null,m=null;const y=Mn();if(!y.supportShareAudio&&r==="enable"){const P=new xe(Q.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",o);const v=y.supportShareAudio&&r!=="disable";try{const P=await zc({screen:d,screenAudio:v?s||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new xe(Q.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new xe(Q.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(ZL(o,h,t,t.encoderConfig&&BL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const T=new Sr(h,t.encoderConfig?BL(t.encoderConfig):{},t.scalabiltyMode?_P(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o,[dr.SCREEN_TRACK]);if(!m)return c.onSuccess(T.getTrackId()),x.info("create screen video track success","video:",T.getTrackId()),T;const R=new qr(m,void 0,ur(8,"track-scr-a-"),!1);return c.onSuccess([T.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",T.getTrackId(),"audio:",R.getTrackId()),[T,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=ie("CAMERA_CAPTURE_CONFIG"),o=ur(8,"track-mic-"),c=ur(8,"track-cam-"),d=Ct.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Wr.TRACER,name:Ti.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=SP(r),m=Bz(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await zc({audio:m,video:h},"".concat(o,"-").concat(c));y=P.getAudioTracks()[0],v=P.getVideoTracks()[0]}catch(P){throw d.onError(P),P}if(!y||!v){const P=new xe(Q.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(P),P.throw(x)}r.optimizationMode&&ZL(c,v,r,kh(r.encoderConfig));const T=new bP(y,t,m,o),R=new QL(v,r,h,r.scalabiltyMode?_P(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([T.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[T,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=ur(8,"track-mic-"),s=Ct.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ti.CREATE_MIC_AUDIO_TRACK,options:[t]}),o=Bz(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await zc({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new xe(Q.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const d=new bP(c,t,o,r);return s.onSuccess(d.getTrackId()),x.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=ur(8,"track-cus-"),s=Ct.reportApiInvoke(null,{id:r,tag:Wr.TRACER,name:Ti.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),o=new qr(t.mediaStreamTrack,t.encoderConfig?yP(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:o}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=ur(8,"track-buf-"),m=Ct.reportApiInvoke(null,{id:h,tag:Wr.TRACER,name:Ti.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(ie("DISABLE_WEBAUDIO"))throw new xe(Q.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let N=null;if(typeof R=="string"){const j=I9.get(R);if(j)return x.debug("use cached audio resource: ",R),j;try{N=(await Cd(()=>Jo.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(W){throw new xe(Q.FETCH_AUDIO_FILE_FAILED,W.toString())}}else N=await new ut((W,Y)=>{const J=new FileReader;J.onload=le=>{le.target?W(le.target.result):Y(new xe(Q.READ_LOCAL_AUDIO_FILE_ERROR))},J.onerror=()=>{Y(new xe(Q.READ_LOCAL_AUDIO_FILE_ERROR))},J.readAsArrayBuffer(R)});const G=await function(j){const W=iS();return new ut((Y,J)=>{W.decodeAudioData(j,le=>{Y(le)},le=>{J(new xe(Q.DECODE_AUDIO_FILE_FAILED,le.toString()))})})}(N);return typeof R=="string"&&P&&I9.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new Yme(c),T=new qme(y,v,o?yP(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(T.getTrackId()),T},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Oe(Q.INVALID_PARAMS,"invalid app type",t);er("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){ie("USE_NEW_LOG")?er("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){ie("USE_NEW_LOG")?er("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new IH},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ct.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof qr||t instanceof aS)){const y=new Oe(Q.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof qr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new ut(y=>{const v=setInterval(()=>{const T=t.getVolumeLevel();d=T>d?T:d,h=T<h?T:h;const R=d-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(v);const N=R,G={duration:P,deviceLabel:o,maxVolumeLevel:d,result:N};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(N)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Ct.reportApiInvoke(null,{tag:Wr.TRACER,name:Ti.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Sr||t instanceof oS)){const R=new Oe(Q.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=t instanceof Sr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(vs()||oP())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,N,G,j){let W,Y=0,J=null;return new ut((le,_e)=>{function Ee(){Y>j&&W&&(W(),le(Y));const ge=G.getContext("2d");if(!ge){const dt=new Oe(Q.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(dt.toString()),void _e(dt)}ge.drawImage(P,0,0,160,120);const Ne=ge.getImageData(0,0,G.width,G.height),qe=Math.floor(Ne.data.length/3);if(J){for(let dt=0;dt<qe;dt+=3)if(Ne.data[dt]!==J[dt])return Y+=1,void(J=Ne.data);J=Ne.data}else J=Ne.data}setTimeout(()=>{W&&(W(),le(Y))},N),W=$L(()=>{Ee()},30)})}(d,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}f_e===Bn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=m>4,T={duration:y,changedPicNum:m,deviceLabel:o,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(T))),s.onSuccess(T),v},setArea:w2,audioElementPlayCenter:Qo,resumeAudioContext:function(){Qo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){k_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=ie("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!at(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=Ct.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=ie(c)})}),PK("PLUGIN_INFO",r)},ChannelMediaRelayError:uS,ChannelMediaRelayEvent:hf,ChannelMediaRelayState:Ia,RemoteStreamFallbackType:Bme,RemoteStreamType:Fme,ConnectionDisconnectedReason:$n,AudienceLatencyLevelType:_me,AREAS:Wn,preload:async function(t,r,s,o){return e7(t,r,s,o)}});return Object.defineProperties(Ci,{onAudioAutoplayFailed:{get:()=>Hc.onAudioAutoplayFailed,set:t=>{Hc.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Hc.onAutoplayFailed,set:t=>{Hc.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ci._onSecurityPolicyViolation,set(t){Ci._onSecurityPolicyViolation=t,l$(t)}},__CLIENT_LIST__:{get:()=>ie("SHOW_GLOBAL_CLIENT_LIST")?ny:[]}}),Gc.on(Q_.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Ci.onCameraChanged&&Ci.onCameraChanged(t),Ci.safeEmit(xh.CAMERA_CHANGED,t)}),Gc.on(Q_.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Ci.onMicrophoneChanged&&Ci.onMicrophoneChanged(t),Ci.safeEmit(xh.MICROPHONE_CHANGED,t)}),Gc.on(Q_.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Ci.onPlaybackDeviceChanged&&Ci.onPlaybackDeviceChanged(t),Ci.safeEmit(xh.PLAYBACK_DEVICE_CHANGED,t)}),Qo.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),Hc.onAudioAutoplayFailed&&Hc.onAudioAutoplayFailed()},tr.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),Hc.onAudioAutoplayFailed&&Hc.onAudioAutoplayFailed(),Ci.safeEmit(xh.AUTOPLAY_FAILED)}),tr.on(cs.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Ci.onAudioContextStateChanged&&Ci.onAudioContextStateChanged(t,r),Ci.safeEmit(xh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),fi.on($v.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Ci),Ci})}($O)),$O.exports}var E9e=y9e();const uR=Jf(E9e),v9e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Uae="";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",Uae);console.log("AgoraProvider: import.meta.env:",v9e);const S9e=uR.createClient({mode:"rtc",codec:"vp8"});let Bw=null;const Vae=D.createContext(null),jae=({children:n,appId:e=Uae,channel:i=null,token:a=null,uid:l=null,enabled:u=!0,startMuted:f=!0,onClientReady:_=()=>{}})=>{console.log("AgoraProvider: appId prop:",e);const[E,S]=D.useState(!1),[w,I]=D.useState(!1),[k,U]=D.useState([]),[L,F]=D.useState(null),[B,q]=D.useState(null),[$,X]=D.useState(null),[oe,re]=D.useState(!1),[pe,te]=D.useState(!1),[Z,ne]=D.useState(!1),[ae,me]=D.useState(null),[he,ue]=D.useState(!1),Ue=ll(),ze=D.useRef(S9e),tt=D.useRef({appId:e,channel:i,uid:l,enabled:u}),Ce=D.useRef(!1),Ie=D.useRef(null);D.useRef(null),D.useEffect(()=>{tt.current={appId:e,channel:i,uid:l,enabled:u},console.log("AgoraProvider: Updated props ref:",{appId:e,channel:i,uid:l,enabled:u})},[e,i,l,u]),D.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:e,channel:i,uid:l,enabled:u}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:ze.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[e,i,l,u]),D.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",i),q(i)},[i]),D.useEffect(()=>{if(!ze.current)return;const nt=ht=>{console.log(`Connection state changed to: ${ht}`),ht==="DISCONNECTED"?(S(!1),console.log("Disconnected from Agora")):ht==="CONNECTED"&&(S(!0),F(null))};return ze.current.on("connection-state-change",nt),()=>{ze.current.off("connection-state-change",nt)}},[]),D.useEffect(()=>{if(!i||!u){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:i,enabled:u});return}console.log("AgoraProvider: Initial setup for channel",i,"with UID",l);const nt=async(Dt,an)=>{console.log("AgoraProvider: User published:",Dt.uid,an);try{await ze.current.subscribe(Dt,an),console.log("AgoraProvider: Subscribed to user:",Dt.uid,"mediaType:",an),an==="audio"&&(Dt.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Dt.uid)),U(jn=>jn.some(Qt=>Qt.uid===Dt.uid)?jn:[...jn,Dt])}catch(jn){console.error("AgoraProvider: Error subscribing to user:",jn)}},ht=(Dt,an)=>{console.log("AgoraProvider: User unpublished:",Dt.uid,an),an==="audio"&&Dt.audioTrack&&(Dt.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Dt.uid))},it=Dt=>{console.log("AgoraProvider: User joined:",Dt.uid),U(an=>an.some(jn=>jn.uid===Dt.uid)?an:[...an,Dt])},It=Dt=>{console.log("AgoraProvider: User left:",Dt.uid),U(an=>an.filter(jn=>jn.uid!==Dt.uid))};ze.current.on("user-published",nt),ze.current.on("user-unpublished",ht),ze.current.on("user-joined",it),ze.current.on("user-left",It);const jt=async()=>{if(Ce.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}Ce.current=!0;try{if(E&&Ie.current===i){console.log("AgoraProvider: Already joined to channel",i),re(!0),_(ze.current);return}if(ze.current.connectionState==="CONNECTING"||ze.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",ze.current.connectionState),Ie.current&&Ie.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(Dt){console.error("AgoraProvider: Error leaving channel:",Dt)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),S(!0),re(!0),Ie.current=i,Bw=i,_(ze.current);return}console.log("AgoraProvider: Joining channel",i,"current joined channel:",Ie.current),await ke(),console.log("AgoraProvider: Join channel completed")}catch(Dt){console.error("AgoraProvider: Error during initialization:",Dt)}finally{Ce.current=!1}};return console.log("AgoraProvider: Running initialization"),jt(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),ze.current.off("user-published",nt),ze.current.off("user-unpublished",ht),ze.current.off("user-joined",it),ze.current.off("user-left",It)}},[i,u,l,_,E]);const ye=async()=>{if(!u||$)return $;console.log("Initializing microphone");try{const nt=await uR.createMicrophoneAudioTrack();return await nt.setMuted(f),X(nt),console.log("Microphone initialized successfully"),nt}catch(nt){return console.error("Error initializing microphone:",nt),F("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(i)try{const It=await kg(i);It&&It.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),ue(!0),E&&await Te()):ue(!1)}catch(it){console.error("AgoraProvider: Error checking if voice is disabled:",it)}})();const ht=it=>{it.detail&&typeof it.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",it.detail.voiceDisabled),ue(it.detail.voiceDisabled),it.detail.voiceDisabled&&E?Te():!it.detail.voiceDisabled&&!E&&u&&i&&ke())};return window.addEventListener("SpaceVoiceSettingChanged",ht),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ht)}},[i,E,u]);const ke=async()=>{if(!u)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(he)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),F("Voice chat is disabled for this space"),!1;if(!i)return console.error("AgoraProvider: No channel specified"),F("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",i,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:E,isJoining:pe,connectionState:ze.current.connectionState,joinedChannel:Ie.current}),E&&Ie.current===i)return console.log("AgoraProvider: Already joined to channel:",i),!0;if(pe)return console.log("AgoraProvider: Already in the process of joining"),!1;if(ze.current.connectionState==="CONNECTED")if(Ie.current&&Ie.current!==i){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(nt){console.error("AgoraProvider: Error leaving channel:",nt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),S(!0),re(!0),Ie.current=i,Bw=i,_(ze.current),!0;if(ze.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),te(!0),new Promise(nt=>{const ht=setInterval(()=>{ze.current.connectionState==="CONNECTED"&&(clearInterval(ht),S(!0),te(!1),re(!0),Ie.current=i,Bw=i,_(ze.current),nt(!0))},500);setTimeout(()=>{clearInterval(ht),console.log("AgoraProvider: Connection timeout, considering join failed"),te(!1),nt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",i,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",e,"Type:",typeof e,"Length:",e.length),!e||e.trim()===""){const ht="AgoraProvider: App ID is empty or invalid";return console.error(ht),F(ht),te(!1),!1}te(!0);const nt=l||Math.floor(Math.random()*1e6);return await ze.current.join(e,i,a,nt),console.log("AgoraProvider: Joined channel successfully with UID:",ze.current.uid),S(!0),te(!1),re(!0),Ie.current=i,Bw=i,_(ze.current),!0}catch(nt){return console.error("AgoraProvider: Error joining channel:",nt),F(`Error joining channel: ${nt.toString()}`),te(!1),!1}},Te=async()=>{if(E)try{$&&await ze.current.unpublish($),await ze.current.leave(),Bw=null,Ie.current=null,console.log("Left channel successfully"),S(!1),U([])}catch(nt){console.error("Error leaving channel:",nt),F(nt.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{u&&i&&(!E||Ie.current!==i)&&ke()},[u,i,E]);const ve=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(nt){return console.error("Error checking microphone status:",nt),!1}};D.useEffect(()=>{const nt=()=>{const it=ve();it!==w&&(console.log("Syncing microphone state:",{actualStatus:it,currentState:w}),I(it),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:it}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=it,window.agoraClient.microphoneTrack=$))};$&&nt();const ht=setInterval(nt,1e3);return()=>{clearInterval(ht)}},[$,w]);const Re=async()=>{var nt;if(he)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Ue({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ht=w!==void 0?w:$?!$.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:w,currentState:ht,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ye()))return console.error("AgoraProvider: Failed to initialize microphone"),ht;const it=!ht;if(console.log("AgoraProvider: New voice state will be:",it),ht){if($)try{console.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(It){return console.error("Error muting track:",It),ht}}else if($)try{ze.current&&E&&!((nt=ze.current.localTracks)!=null&&nt.includes($))&&(console.log("AgoraProvider: Publishing microphone track"),await ze.current.publish($),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(It){return console.error("Error unmuting track:",It),ht}return I(it),it}catch(ht){return console.error("AgoraProvider: Error toggling voice:",ht),w}},Me=async nt=>{try{X(nt),console.log("Microphone track updated successfully")}catch(ht){throw console.error("Error updating microphone track:",ht),ht}},Ge=async()=>{if(!ze.current||!i)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return console.log("AgoraProvider: Stopping screen share"),ae&&(Array.isArray(ae)?(await ze.current.unpublish(ae),ae.forEach(nt=>nt.close())):(await ze.current.unpublish(ae),ae.close()),me(null)),ne(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const nt=await uR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",nt),nt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),ze.current.unpublish(nt),nt.close(),me(null),ne(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await ze.current.publish(nt),me(nt),ne(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=nt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(nt){return console.error("AgoraProvider: Error creating screen track:",nt),ne(!1),me(null),!1}}catch(nt){return console.error("AgoraProvider: Error toggling screen share:",nt),ne(!1),me(null),!1}};D.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:ze.current,isScreenSharing:!1,screenTrack:null};const nt=it=>{console.log("AgoraProvider: Received ToggleScreenShare event"),Ge().then(It=>{it.detail&&it.detail.callback&&it.detail.callback(!0,It)}).catch(It=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",It),it.detail&&it.detail.callback&&it.detail.callback(!1,Z)})},ht=it=>{console.log("AgoraProvider: Received JoinVoiceChat event"),ke().then(It=>{it.detail&&it.detail.callback&&it.detail.callback(It)}).catch(It=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",It),it.detail&&it.detail.callback&&it.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",nt),window.addEventListener("JoinVoiceChat",ht),()=>{window.removeEventListener("ToggleScreenShare",nt),window.removeEventListener("JoinVoiceChat",ht),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",w),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=w,window.agoraClient.microphoneTrack=$,window.agoraClient.client=ze.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:w}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:w}))},[w,$]);const Qe={client:ze.current,isJoined:E,isVoiceEnabled:w,users:k,error:L,channel:B,appId:e,toggleVoice:Re,leaveChannel:Te,joinChannel:ke,microphoneTrack:$,isReady:oe,createMicrophoneTrack:Me,isScreenSharing:Z,screenTrack:ae,toggleScreenShare:Ge,voiceDisabled:he};return b.jsx(Vae.Provider,{value:Qe,children:n})},Fae=()=>{const n=D.useContext(Vae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};jae.propTypes={children:Hr.node.isRequired,appId:Hr.string.isRequired,channel:Hr.string.isRequired,token:Hr.string,uid:Hr.oneOfType([Hr.string,Hr.number])};const b9e=()=>{var Ce,Ie;const{client:n,isVoiceEnabled:e,isJoined:i,users:a,error:l,microphoneTrack:u,isReady:f,channel:_,appId:E,toggleVoice:S,joinChannel:w,leaveChannel:I,createMicrophoneTrack:k,isScreenSharing:U,screenTrack:L,toggleScreenShare:F,voiceDisabled:B}=Fae(),[q,$]=D.useState(e!==void 0?e:((Ce=window.agoraClient)==null?void 0:Ce.isVoiceEnabled)||!1),[X,oe]=D.useState(U!==void 0?U:((Ie=window.agoraClient)==null?void 0:Ie.isScreenSharing)||!1),[re,pe]=D.useState(B!==void 0?B:!1),[te,Z]=D.useState(!0);D.useEffect(()=>{var ye;e!==void 0?$(e):((ye=window.agoraClient)==null?void 0:ye.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):u&&$(!u.muted)},[e,u]),D.useEffect(()=>{var ye;U!==void 0?oe(U):((ye=window.agoraClient)==null?void 0:ye.isScreenSharing)!==void 0&&oe(window.agoraClient.isScreenSharing)},[U]),D.useEffect(()=>{B!==void 0&&pe(B)},[B]);const ne=D.useRef({isVoiceEnabled:q,isScreenSharing:X,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:E,voiceDisabled:re});D.useEffect(()=>{ne.current={isVoiceEnabled:q,isScreenSharing:X,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:E,voiceDisabled:re}},[q,X,i,a,l,f,_,E,re]),D.useEffect(()=>{const ye=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(ye)},[]),D.useEffect(()=>{f&&Z(!1)},[f]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:q,contextIsScreenSharing:U,localScreenSharing:X,isJoined:i,users:a.length,error:l,isReady:f,channel:_,appId:E,hasMicrophoneTrack:!!u,trackMuted:u==null?void 0:u.muted,hasScreenTrack:!!L})},[e,q,U,X,i,a,l,f,_,E,u,L]);const ae=async()=>{try{console.log("useVoiceChat: Toggling voice from:",q);const ye=await S();if(console.log("useVoiceChat: Toggle result:",ye),ye!==void 0)$(ye);else{const ke=!q;$(ke),window.agoraClient&&(window.agoraClient.isVoiceEnabled=ke)}return ye!==void 0?ye:!q}catch(ye){return console.error("useVoiceChat: Error toggling voice:",ye),q}},me=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",X);const ye=await F();if(console.log("useVoiceChat: Screen share toggle result:",ye),ye!==void 0)oe(ye);else{const ke=!X;oe(ke),window.agoraClient&&(window.agoraClient.isScreenSharing=ke)}return ye!==void 0?ye:!X}catch(ye){return console.error("useVoiceChat: Error toggling screen share:",ye),X}},he=async()=>{q&&u&&await ae()},ue=async()=>{!q&&u&&await ae()},Ue=ye=>a.some(ke=>{var Te;return ke.uid===ye&&((Te=ke.audioTrack)==null?void 0:Te.isPlaying)}),ze=D.useCallback(()=>{if(!u||!q)return 0;try{return u.getVolumeLevel()}catch(ye){return console.error("Error getting volume level:",ye),0}},[u,q]);return{isVoiceEnabled:q,isScreenSharing:X,isJoined:i,users:a,error:l,toggleVoice:ae,toggleScreenShare:me,mute:he,unmute:ue,isUserSpeaking:Ue,getVolumeLevel:ze,microphoneTrack:u,screenTrack:L,isLoading:te,channel:_,appId:E,joinChannel:w,leaveChannel:I,client:n,setMicrophoneDevice:async ye=>{try{if(!ye){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(q&&await n.unpublish(u),await u.close());const ke=await uR.createMicrophoneAudioTrack({microphoneId:ye,encoderConfig:"music_standard"});k&&await k(ke),q&&await n.publish(ke),console.log("Microphone device changed successfully")}catch(ke){throw console.error("Error changing microphone device:",ke),ke}},voiceDisabled:re}},T9e=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:f,isJoined:_,joinChannel:E,channel:S,client:w,voiceDisabled:I}=b9e(),[k,U]=D.useState(!1),[L,F]=D.useState(!1);D.useEffect(()=>{const $=()=>{be.log("VoiceButton: Player instantiated, showing button"),F(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(be.log("VoiceButton: Player was already instantiated"),F(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:u,isJoined:_,channel:S,hasClient:!!w,clientState:w==null?void 0:w.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:L,voiceDisabled:I})},[u,_,S,w,L,I]);const B=async()=>{if(!(k||I)){U(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:u,isJoined:_});try{if(!_&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(X){X.message&&X.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",X)}console.log("VoiceButton: Toggling voice state from:",u);const $=await f();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{U(!1)}}},q=()=>I?"Voice chat is disabled for this space":L?k?"Processing...":_?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!L||I?null:b.jsx(up,{label:q(),placement:e,hasArrow:!0,children:b.jsxs(Xe,{position:"relative",cursor:"pointer",onClick:B,children:[b.jsx(Wu,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?b.jsx(Vj,{color:"white"}):b.jsx(Uj,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),k&&b.jsx(Xe,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:b.jsx(la,{size:"sm",color:"white"})})]})})},w9e=mr.createContext({user:null}),C9e=({userNickname:n})=>{const{client:e,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:u}=Fae(),[f,_]=D.useState([]),[E,S]=D.useState(!1),[w,I]=D.useState(!0);D.useRef({});const k=D.useRef(null);D.useRef(null);const{user:U}=D.useContext(w9e)||{user:null},[L,F]=D.useState({}),B=D.useRef(a),[q,$]=D.useState(null),{isOpen:X,onOpen:oe,onClose:re}=gp(),[pe,te]=D.useState(!1),Z=D.useRef(null),ne=D.useRef(null);D.useEffect(()=>{B.current=a},[a]),D.useEffect(()=>{if(!e||!i){S(!1);return}const Ue=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const ze=e.connectionState;if(console.log("Current connection state:",ze),ze==="CONNECTED")S(!0),I(!1);else{S(!1);const tt=Ce=>{console.log("Connection state changed:",Ce),Ce==="CONNECTED"?(S(!0),I(!1)):S(!1)};return e.on("connection-state-change",tt),()=>{e.off("connection-state-change",tt),clearTimeout(Ue)}}return()=>{clearTimeout(Ue)}},[e,i]),D.useEffect(()=>{const Ue=async()=>{const ze={...L};let tt=!1;for(const Ce of f){if(L[Ce.uid])continue;let Ie=null,ye=Ce.uid;if(typeof ye=="string"&&(ye.includes("-")?(Ie=ye.split("-")[0],ye=ye.split("-")[1]):ye.includes("_")&&(Ie=ye.split("_")[0],ye=ye.split("_")[1])),ye)try{console.log("Trying to fetch nickname for user ID:",ye);const ke=await Ep(ye);ke&&ke.Nickname?(console.log("Found nickname in Firebase for user ID:",ye,"Nickname:",ke.Nickname),ze[Ce.uid]=ke.Nickname,tt=!0):Ie?(console.log("Using extracted name for user ID:",ye,"Name:",Ie),ze[Ce.uid]=Ie,tt=!0):(ze[Ce.uid]="User",tt=!0)}catch(ke){console.error("Error fetching user profile:",ke),Ie?(ze[Ce.uid]=Ie,tt=!0):(ze[Ce.uid]="User",tt=!0)}else Ie?(ze[Ce.uid]=Ie,tt=!0):(ze[Ce.uid]="User",tt=!0)}tt&&F(ze)};f.length>0&&Ue()},[f,L]),D.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const Ue=async(Ce,Ie)=>{if(console.log("User published:",Ce.uid,Ie,Ce),Ie==="video"){console.log("Remote video track detected:",Ce.uid);try{await e.subscribe(Ce,Ie),console.log("Subscribed to remote video track:",Ce.uid),_(ye=>ye.some(ke=>ke.uid===Ce.uid)?ye:[...ye,Ce])}catch(ye){console.error("Error subscribing to remote video track:",ye)}}},ze=(Ce,Ie)=>{if(console.log("User unpublished:",Ce.uid,Ie),Ie==="video"){if(console.log("Remote video track unpublished:",Ce.uid),Ce.videoTrack)try{Ce.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(_(ye=>ye.filter(ke=>ke.uid!==Ce.uid)),l&&B.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),B.current.play(k.current)}catch(ye){console.error("Error replaying local screen track:",ye)}}},tt=Ce=>{console.log("User left:",Ce.uid);const Ie=f.find(ye=>ye.uid===Ce.uid);if(Ie&&Ie.videoTrack)try{Ie.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(_(ye=>ye.filter(ke=>ke.uid!==Ce.uid)),l&&B.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote user left"),B.current.play(k.current)}catch(ye){console.error("Error replaying local screen track:",ye)}};return e.on("user-published",Ue),e.on("user-unpublished",ze),e.on("user-left",tt),()=>{e.off("user-published",Ue),e.off("user-unpublished",ze),e.off("user-left",tt)}},[e,i,E,f,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Ue=>{if(Ue.videoTrack)try{console.log("Playing video track for:",Ue.uid),Ue.videoTrack.play(`video-container-${Ue.uid}`)}catch(ze){console.error("Error playing video track:",ze)}}),l&&B.current&&k.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),B.current.play(k.current)}catch(Ue){console.error("Error replaying local screen track:",Ue)}},[f,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&k.current)try{console.log("Playing local screen track"),a.play(k.current)}catch(Ue){console.error("Error playing local screen track:",Ue)}},[l,a]),D.useEffect(()=>()=>{if(f.forEach(Ue=>{if(Ue.videoTrack)try{Ue.videoTrack.stop()}catch(ze){console.error("Error stopping video track on unmount:",ze)}}),a)try{a.stop()}catch(Ue){console.error("Error stopping local screen track on unmount:",Ue)}},[f,a]);const ae=()=>{console.log("Stopping local screen share"),u()},me=Ue=>(console.log("Getting display name for UID:",Ue,"type:",typeof Ue),l&&U&&(Ue===U.uid||Ue===(e==null?void 0:e.uid))?n||"You":L[Ue]?L[Ue]:typeof Ue=="string"?Ue.includes("-")?Ue.split("-")[0]:Ue.includes("_")?Ue.split("_")[0]:Ue:"User"),he=Ue=>{console.log("Opening modal for remote screen",Ue),$(Ue),oe()},ue=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),oe()};return D.useEffect(()=>{X&&q?(console.log("Modal opened, activeScreen:",q),setTimeout(()=>{if(q.isLocal&&B.current)try{console.log("Playing local screen in modal"),B.current.play("modal-screen-container"),te(!0)}catch(Ue){console.error("Error playing local screen in modal:",Ue)}else if(q.videoTrack)try{console.log("Playing remote screen in modal"),q.videoTrack.play("modal-screen-container"),te(!0)}catch(Ue){console.error("Error playing remote screen in modal:",Ue)}},500)):X||(te(!1),$(null),setTimeout(()=>{if(l&&B.current)try{B.current.play("local-screen-container")}catch(Ue){console.error("Error playing local screen in small container:",Ue)}f.forEach(Ue=>{if(Ue.videoTrack)try{Ue.videoTrack.play(`video-container-${Ue.uid}`)}catch(ze){console.error(`Error playing remote screen ${Ue.uid} in small container:`,ze)}})},500))},[X,q,l,f]),!E||w&&f.length===0&&!l||f.length===0&&!l?null:b.jsxs(b.Fragment,{children:[!X&&b.jsxs(Xe,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&a&&b.jsxs(Xe,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[b.jsx(Xe,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),b.jsx(Xe,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Ue=>{const ze=L[Ue.uid]||me(Ue.uid);return b.jsxs(Xe,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Ue),children:[b.jsx(Xe,{id:`video-container-${Ue.uid}`,width:"100%",height:"100%",position:"relative"}),b.jsx(Xe,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${ze}'s Screen`})]},Ue.uid)})]}),X&&b.jsx(Xe,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:re,children:b.jsxs(Xe,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Ue=>Ue.stopPropagation(),children:[!pe&&b.jsxs(Xe,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[b.jsx(la,{size:"xl"}),b.jsx(et,{mt:4,children:"Loading screen share..."})]}),b.jsx(Xe,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:ne}),b.jsx(Xe,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:re,children:""}),b.jsx(Xe,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:q!=null&&q.isLocal?n?`${n}'s Screen`:"Your Screen":`${L[q==null?void 0:q.uid]||me(q==null?void 0:q.uid)}'s Screen`}),(q==null?void 0:q.isLocal)&&b.jsx(Xe,{position:"absolute",bottom:4,right:4,children:b.jsx(Ar,{colorScheme:"red",size:"sm",onClick:ae,children:"Stop Sharing"})})]})})]})},R9e=({onClose:n})=>{const e=ll(),[i,a]=D.useState(!1),[l,u]=D.useState(!1);D.useEffect(()=>{const E=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};E();const S=setInterval(E,1e3),w=()=>{E()};return window.addEventListener("ScreenShareToggled",w),()=>{clearInterval(S),window.removeEventListener("ScreenShareToggled",w)}},[]);const f=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const S=new CustomEvent("JoinVoiceChat",{detail:{callback:w=>{if(!w){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}_()}}});window.dispatchEvent(S)}}catch(S){console.error("Error in screen share handler:",S),a(!1),e({title:"Screen sharing error",description:S.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(S,w)=>{a(!1),S?(u(w),e(w?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),a(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return b.jsx(et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function I9e({open:n,onClose:e}){const[i,a]=D.useState(0);return b.jsxs(hc,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[b.jsx(dc,{backdropFilter:"blur(4px)"}),b.jsxs(pc,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[b.jsx(Hu,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),b.jsx(cl,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),b.jsx(uc,{p:0,display:"flex",children:b.jsxs(RR,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[b.jsxs(IR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:t9e,mb:1}),b.jsx(et,{fontSize:"xs",children:"Movement"})]}),b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:n9e,mb:1}),b.jsx(et,{fontSize:"xs",children:"Camera"})]}),b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:Zze,mb:1}),b.jsx(et,{fontSize:"xs",children:"Actions"})]}),b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:e9e,mb:1}),b.jsx(et,{fontSize:"xs",children:"Tips"})]})]}),b.jsxs(hN,{flexGrow:1,display:"flex",flexDirection:"column",children:[b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),b.jsxs(sr,{wrap:"wrap",gap:3,children:[b.jsx(xl,{keyLabel:"W",description:"Move Forward"}),b.jsx(xl,{keyLabel:"A",description:"Move Left"}),b.jsx(xl,{keyLabel:"S",description:"Move Backward"}),b.jsx(xl,{keyLabel:"D",description:"Move Right"}),b.jsx(xl,{keyLabel:"Shift",description:"Run"}),b.jsx(xl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),b.jsxs(sr,{wrap:"wrap",gap:3,children:[b.jsx(xl,{keyLabel:"Mouse",description:"Look Around"}),b.jsx(xl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),b.jsx(xl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),b.jsxs(sr,{wrap:"wrap",gap:3,children:[b.jsx(xl,{keyLabel:"E",description:"Interact"}),b.jsx(xl,{keyLabel:"F",description:"Emote Menu"}),b.jsx(xl,{keyLabel:"T",description:"Chat"}),b.jsx(xl,{keyLabel:"M",description:"Mute Mic"})]})]}),b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),b.jsxs(gr,{align:"stretch",spacing:2,children:[b.jsx(et,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),b.jsx(et,{fontSize:"xs",children:" Press ESC to access settings"}),b.jsx(et,{fontSize:"xs",children:" Click on players to view their profile"}),b.jsx(et,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const xl=({keyLabel:n,description:e})=>b.jsx(Xe,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:b.jsxs(ui,{spacing:2,children:[b.jsx(Xe,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),b.jsx(et,{fontSize:"xs",children:e})]})}),A9e=()=>{const[n,e]=D.useState([]),[i,a]=D.useState(""),[l,u]=D.useState(0),[f,_]=D.useState(100),[E,S]=D.useState(100),[w,I]=D.useState(!0),[k,U]=D.useState(!0),[L,F]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const re=await uR.getMicrophones();e(re),re.length>0&&a(re[0].deviceId)}catch(re){console.error("Error getting audio devices:",re)}})()},[]),D.useEffect(()=>{const oe=setInterval(()=>{u(L?Math.random()*50:0)},100);return()=>clearInterval(oe)},[L]);const B=oe=>{const re=oe.target.value;a(re),console.log("Microphone changed to:",re)},q=oe=>{_(oe),console.log("Microphone volume set to:",oe)},$=oe=>{S(oe),console.log("Speaker volume set to:",oe)},X=()=>{F(!L)};return b.jsxs(gr,{spacing:6,align:"stretch",children:[b.jsxs(kn,{children:[b.jsxs(Qn,{children:["Microphone",b.jsx(zd,{ml:2,colorScheme:L?"green":"red",children:L?"Enabled":"Muted"})]}),b.jsxs(rie,{value:i,onChange:B,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(oe=>b.jsx("option",{value:oe.deviceId,children:oe.label||`Microphone ${oe.deviceId.slice(0,5)}...`},oe.deviceId)),n.length===0&&b.jsx("option",{value:"",children:"No microphones found"})]})]}),b.jsxs(Xe,{children:[b.jsx(et,{mb:2,children:"Microphone Level"}),b.jsx(x0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),b.jsxs(kn,{children:[b.jsxs(Qn,{children:["Microphone Volume: ",f,"%"]}),b.jsxs(ZV,{value:f,onChange:q,min:0,max:100,step:1,colorScheme:"blue",children:[b.jsx(tj,{bg:"gray.700",children:b.jsx(nj,{})}),b.jsx(ej,{boxSize:6})]})]}),b.jsxs(kn,{children:[b.jsxs(Qn,{children:["Speaker Volume: ",E,"%"]}),b.jsxs(ZV,{value:E,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[b.jsx(tj,{bg:"gray.700",children:b.jsx(nj,{})}),b.jsx(ej,{boxSize:6})]})]}),b.jsxs(kn,{display:"flex",alignItems:"center",children:[b.jsx(Qn,{mb:"0",children:"Microphone Enabled"}),b.jsx(Rg,{isChecked:L,onChange:X,colorScheme:"green",size:"lg"})]}),b.jsxs(kn,{display:"flex",alignItems:"center",children:[b.jsx(Qn,{mb:"0",children:"Echo Cancellation"}),b.jsx(Rg,{isChecked:w,onChange:()=>I(!w),colorScheme:"green",size:"lg"})]}),b.jsxs(kn,{display:"flex",alignItems:"center",children:[b.jsx(Qn,{mb:"0",children:"Noise Suppression"}),b.jsx(Rg,{isChecked:k,onChange:()=>U(!k),colorScheme:"green",size:"lg"})]}),b.jsxs(Vu,{status:"info",borderRadius:"md",children:[b.jsx(ju,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function P9e({open:n,onClose:e,containerRef:i}){return b.jsx($l,{containerRef:i,children:b.jsxs(hc,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[b.jsx(dc,{}),b.jsxs(pc,{bg:"gray.900",color:"white",borderRadius:"lg",children:[b.jsx(Hu,{children:"Settings"}),b.jsx(cl,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),b.jsx(uc,{children:b.jsxs(RR,{variant:"enclosed",children:[b.jsxs(IR,{mb:4,children:[b.jsx(Ml,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),b.jsx(Ml,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),b.jsxs(hN,{children:[b.jsx(Gd,{children:b.jsx(Xe,{p:4,bg:"gray.800",borderRadius:"md",children:b.jsx(A9e,{})})}),b.jsx(Gd,{children:b.jsx(Xe,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function O9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function k9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function E0(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function N9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function D9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function x9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function L9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function IC(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function Fj(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function nZ(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function oO(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function M9e(n){return or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const U9e=({isOpen:n,onClose:e})=>{const{spaceID:i}=ol(),[a,l]=D.useState(0),[u,f]=D.useState(null),[_,E]=D.useState(null),[S,w]=D.useState(!1),[I,k]=D.useState(0),[U,L]=D.useState(null),F=D.useRef(null),[B,q]=D.useState(null),[$,X]=D.useState(null),[oe,re]=D.useState(!1),[pe,te]=D.useState(0),[Z,ne]=D.useState(null),ae=D.useRef(null),[me,he]=D.useState([]),[ue,Ue]=D.useState([]),[ze,tt]=D.useState(!1),[Ce,Ie]=D.useState(!1),[ye,ke]=D.useState(!0),[Te,ve]=D.useState(!1),Re=ll();D.useEffect(()=>{n&&i&&Ge()},[n,i]);const Me=async Ot=>{if(i&&n){tt(!0);try{const Lt=Aoe(),we=`space_${i}_owners`,Ve=cR(Xf(Lt,"users"),Pk("groups","array-contains",we)),$e=await Gg(Ve),_t=[];for(const mn of $e.docs){const Jt=mn.data(),Hn=await Ep(mn.id);_t.push({uid:mn.id,email:Jt.email,displayName:Jt.displayName||Hn.Nickname||"Unknown User",photoURL:Jt.photoURL||Hn.photoURL,firstName:Hn.firstName,lastName:Hn.lastName})}he(_t);const vt=`space_${i}_hosts`,St=cR(Xf(Lt,"users"),Pk("groups","array-contains",vt)),Ht=await Gg(St),fn=[];for(const mn of Ht.docs){const Jt=mn.data(),Hn=await Ep(mn.id);fn.push({uid:mn.id,email:Jt.email,displayName:Jt.displayName||Hn.Nickname||"Unknown User",photoURL:Jt.photoURL||Hn.photoURL,firstName:Hn.firstName,lastName:Hn.lastName})}Ue(fn)}catch(Lt){be.error("Error fetching space users:",Lt),Re({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{tt(!1)}}},Ge=async()=>{try{const Ot=await kg(i);Ot.logoUrl&&L(Ot.logoUrl),Ot.backgroundUrl&&ne(Ot.backgroundUrl),Ot.voiceDisabled!==void 0&&Ie(Ot.voiceDisabled),Ot.accessibleToAllUsers!==void 0&&ke(Ot.accessibleToAllUsers),Me(Ot)}catch(Ot){be.error("Error fetching space data:",Ot),Re({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{i&&n&&a===3&&Me()},[i,n,a]);const Qe=Ot=>{const Lt=Ot.target.files[0];if(Lt){if(!Lt.type.startsWith("image/")){Re({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}f(Lt);const we=new FileReader;we.onloadend=()=>{E(we.result)},we.readAsDataURL(Lt)}},nt=Ot=>{const Lt=Ot.target.files[0];if(Lt){if(!Lt.type.startsWith("image/")){Re({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}q(Lt);const we=new FileReader;we.onloadend=()=>{X(we.result)},we.readAsDataURL(Lt)}},ht=async()=>{if(!u){Re({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{w(!0);const Ot=setInterval(()=>{k(we=>{const Ve=we+10;return Ve>=90?90:Ve})},300),Lt=await VWe(i,u);clearInterval(Ot),k(100),L(Lt),Re({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{f(null),E(null),k(0),w(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Lt}}))}catch(Ot){console.error("Error uploading logo:",Ot),Re({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),w(!1),k(0)}},it=async()=>{if(!B){Re({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{re(!0);const Ot=setInterval(()=>{te(we=>{const Ve=we+10;return Ve>=90?90:Ve})},300),Lt=await FWe(i,B);clearInterval(Ot),te(100),ne(Lt),Re({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{q(null),X(null),te(0),re(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Lt}}))}catch(Ot){console.error("Error uploading background:",Ot),Re({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),re(!1),te(0)}},It=async()=>{if(U)try{w(!0),await jWe(i),L(null),Re({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),w(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ot){console.error("Error deleting logo:",Ot),Re({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),w(!1)}},jt=async()=>{if(Z)try{re(!0),await BWe(i),ne(null),Re({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),re(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ot){console.error("Error deleting background:",Ot),Re({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),re(!1)}},Dt=()=>{F.current&&F.current.click()},an=()=>{ae.current&&ae.current.click()},jn=async()=>{ve(!0);try{await WWe(i,{voiceDisabled:!Ce}),Ie(!Ce),Re({title:"Settings Updated",description:`Voice chat has been ${Ce?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){be.error("Error updating voice settings:",Ot),Re({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{ve(!1)}},Qt=async()=>{ve(!0);try{await zWe(i,!ye),ke(!ye),Re({title:"Settings Updated",description:`Space is now ${ye?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){be.error("Error updating accessibility settings:",Ot),Re({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{ve(!1)}};return b.jsxs(hc,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[b.jsx(dc,{backdropFilter:"blur(4px)"}),b.jsxs(pc,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[b.jsx(Hu,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),b.jsx(cl,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),b.jsx(uc,{p:0,display:"flex",children:b.jsxs(RR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[b.jsxs(IR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:E0,mb:1}),b.jsx(et,{fontSize:"xs",children:"Logo"})]}),b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:k9e,mb:1}),b.jsx(et,{fontSize:"xs",children:"Background"})]}),b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:x9e,mb:1}),b.jsx(et,{fontSize:"xs",children:"Settings"})]}),b.jsxs(Ml,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[b.jsx(Dn,{as:nZ,mb:1}),b.jsx(et,{fontSize:"xs",children:"Users"})]})]}),b.jsxs(hN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),b.jsx(et,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(U||_)&&b.jsxs(sr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[U&&b.jsxs(Xe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),b.jsx(Va,{src:U,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),b.jsx(Ar,{mt:3,colorScheme:"red",leftIcon:b.jsx(Dn,{as:IC}),onClick:It,isLoading:S,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),_&&b.jsxs(Xe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),b.jsx(Va,{src:_,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),b.jsxs(kn,{children:[b.jsx(Qn,{fontSize:"xs",children:"Upload New Logo"}),b.jsx(pr,{type:"file",accept:"image/*",onChange:Qe,ref:F,display:"none"}),S&&b.jsxs(Xe,{mt:3,mb:3,children:[b.jsxs(et,{fontSize:"xs",mb:1,children:["Uploading... ",I,"%"]}),b.jsx(x0,{value:I,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),b.jsxs(ui,{mt:3,spacing:3,children:[b.jsx(Ar,{colorScheme:"blue",leftIcon:b.jsx(Dn,{as:E0}),onClick:Dt,isDisabled:S,size:"sm",variant:"outline",children:"Browse"}),b.jsx(Ar,{colorScheme:"green",leftIcon:b.jsx(Dn,{as:Fj}),onClick:ht,isLoading:S,loadingText:"Uploading...",isDisabled:!u||S,size:"sm",children:"Upload"})]}),b.jsx(GC,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),b.jsx(et,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Z||$)&&b.jsxs(sr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Z&&b.jsxs(Xe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),b.jsx(Va,{src:Z,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),b.jsx(Ar,{mt:3,colorScheme:"red",leftIcon:b.jsx(Dn,{as:IC}),onClick:jt,isLoading:oe,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),$&&b.jsxs(Xe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[b.jsx(et,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),b.jsx(Va,{src:$,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),b.jsxs(kn,{children:[b.jsx(Qn,{fontSize:"xs",children:"Upload New Background"}),b.jsx(pr,{type:"file",accept:"image/*",onChange:nt,ref:ae,display:"none"}),oe&&b.jsxs(Xe,{mt:3,mb:3,children:[b.jsxs(et,{fontSize:"xs",mb:1,children:["Uploading... ",pe,"%"]}),b.jsx(x0,{value:pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),b.jsxs(ui,{mt:3,spacing:3,children:[b.jsx(Ar,{colorScheme:"blue",leftIcon:b.jsx(Dn,{as:E0}),onClick:an,isDisabled:oe,size:"sm",variant:"outline",children:"Browse"}),b.jsx(Ar,{colorScheme:"green",leftIcon:b.jsx(Dn,{as:Fj}),onClick:it,isLoading:oe,loadingText:"Uploading...",isDisabled:!B||oe,size:"sm",children:"Upload"})]}),b.jsx(GC,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),b.jsx(et,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),b.jsxs(gr,{spacing:4,align:"stretch",children:[b.jsx(Xe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:b.jsxs(ui,{justify:"space-between",align:"center",children:[b.jsxs(Xe,{children:[b.jsxs(ui,{mb:1,spacing:2,children:[b.jsxs(Xe,{position:"relative",w:"16px",h:"16px",children:[b.jsx(Dn,{as:M9e,color:Ce?"red.400":"green.400"}),Ce&&b.jsx(Xe,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),b.jsx(et,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),b.jsx(et,{fontSize:"xs",color:"whiteAlpha.800",children:Ce?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),b.jsx(Rg,{isChecked:!Ce,onChange:jn,colorScheme:"green",size:"md",isDisabled:Te})]})}),b.jsx(Xe,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:b.jsxs(ui,{justify:"space-between",align:"center",children:[b.jsxs(Xe,{children:[b.jsxs(ui,{mb:1,spacing:2,children:[b.jsx(Xe,{position:"relative",w:"16px",h:"16px",children:b.jsx(Dn,{as:nZ,color:ye?"green.400":"red.400"})}),b.jsx(et,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),b.jsx(et,{fontSize:"xs",color:"whiteAlpha.800",children:ye?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),b.jsx(et,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),b.jsx(Rg,{isChecked:ye,onChange:Qt,colorScheme:"green",size:"md",isDisabled:Te})]})}),b.jsxs(Vu,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[b.jsx(ju,{color:"blue.300"}),b.jsxs(Xe,{children:[b.jsx(WC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),b.jsx(zC,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),b.jsxs(Gd,{p:4,display:"flex",flexDirection:"column",children:[b.jsx(et,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),b.jsx(et,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),ze?b.jsx(sr,{justify:"center",align:"center",h:"200px",children:b.jsx(la,{color:"blue.300"})}):b.jsxs(gr,{spacing:4,align:"stretch",children:[b.jsxs(Xe,{children:[b.jsxs(ui,{mb:2,children:[b.jsx(Dn,{as:O9e,color:"green.400"}),b.jsx(et,{fontSize:"sm",fontWeight:"600",children:"Owners"}),b.jsx(zd,{colorScheme:"green",ml:2,children:me.length})]}),b.jsx(Xe,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:me.length===0?b.jsx(et,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):b.jsx(gr,{spacing:1,align:"stretch",children:me.map(Ot=>b.jsxs(ui,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[b.jsx(Wu,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),b.jsxs(Xe,{children:[b.jsx(et,{fontSize:"xs",children:Ot.displayName}),b.jsx(et,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),b.jsx(ck,{}),b.jsx(zd,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ot.uid))})})]}),b.jsxs(Xe,{children:[b.jsxs(ui,{mb:2,children:[b.jsx(Dn,{as:L9e,color:"purple.400"}),b.jsx(et,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),b.jsx(zd,{colorScheme:"purple",ml:2,children:ue.length})]}),b.jsx(Xe,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ue.length===0?b.jsx(et,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):b.jsx(gr,{spacing:1,align:"stretch",children:ue.map(Ot=>b.jsxs(ui,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[b.jsx(Wu,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),b.jsxs(Xe,{children:[b.jsx(et,{fontSize:"xs",children:Ot.displayName}),b.jsx(et,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),b.jsx(ck,{}),b.jsx(zd,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ot.uid))})})]}),b.jsx(uo,{borderColor:"whiteAlpha.200"}),b.jsxs(Vu,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[b.jsx(ju,{color:"blue.300",boxSize:4}),b.jsxs(Xe,{children:[b.jsx(WC,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),b.jsx(zC,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},V9e=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Jd(),[a,l]=D.useState(!0),[u,f]=D.useState(!1),[_,E]=D.useState(!1),[S,w]=D.useState(!1),[I,k]=D.useState(!1),[U,L]=D.useState(!1),[F,B]=D.useState(null),[q,$]=D.useState(!1),[X,oe]=D.useState(!1),[re,pe]=D.useState(!1),[te,Z]=D.useState(!1),ne=ll(),{user:ae}=D.useContext(ul),me=(ae==null?void 0:ae.Nickname)||"Unknown",[he,ue]=D.useState(!1),Ue=async()=>{if(ae!=null&&ae.uid&&e)try{const ve=await Ep(ae.uid);let Re=!1,Me=!1;if(ve.groups){const Qe=`space_${e}_owners`,nt=`space_${e}_hosts`;Re=ve.groups.includes(Qe),Me=ve.groups.includes(nt)}const Ge=await Hoe(ae.uid,"disruptiveAdmin");if(Z(Ge),B({rpmURL:ve.rpmURL?ve.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),oe(Re||Ge),pe(Me),!Re&&!Ge&&q){$(!1);const Qe=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Qe),ne({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(ve){console.error("Error fetching profile data:",ve),oe(!1),pe(!1),Z(!1)}else oe(!1),pe(!1),Z(!1)};D.useEffect(()=>{Ue()},[ae==null?void 0:ae.uid,e,q]),D.useEffect(()=>{const ve=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",ve),()=>{window.removeEventListener("PlayerInstantiated",ve)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(Me){console.error("Error checking if voice is disabled:",Me)}})();const Re=Me=>{Me.detail&&typeof Me.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Me.detail.voiceDisabled),ue(Me.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Re),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Re)}},[]);const ze=()=>E(!_),tt=()=>w(!S),Ce=()=>{L(!U),ke()},Ie=()=>{k(!1),Ue()},ye=ve=>{ve.stopPropagation(),typeof n=="function"&&(be.log("CanvasMainMenu: Toggling player list"),n())},ke=()=>{f(!1)},Te=ve=>{if(ve.stopPropagation(),!X){ne({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Re=!q;$(Re);const Me=new CustomEvent("editModeChanged",{detail:{enabled:Re}});window.dispatchEvent(Me),ne({title:Re?"Edit Mode Enabled":"Edit Mode Disabled",description:Re?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Re?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return b.jsxs(b.Fragment,{children:[b.jsxs(rN,{isOpen:u,onClose:()=>f(!1),children:[b.jsx(iN,{as:Ys,icon:b.jsx(fae,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:u?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:u?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!u)}),b.jsx($l,{containerRef:i,children:b.jsx(sN,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:b.jsxs(gr,{align:"stretch",spacing:4,children:[b.jsxs(ui,{children:[b.jsx(Wu,{size:"md",src:F==null?void 0:F.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),b.jsxs(gr,{align:"start",spacing:0,children:[b.jsxs(ui,{children:[b.jsx(et,{fontWeight:"bold",children:me}),X&&!te&&b.jsx(up,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:b.jsx(Xe,{display:"inline-block",children:b.jsx(Dn,{as:Mj,color:"green.400",boxSize:3})})}),!X&&re&&!te&&b.jsx(up,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:b.jsx(Xe,{display:"inline-block",children:b.jsx(Dn,{as:jj,color:"purple.400",boxSize:3})})}),te&&b.jsx(up,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:b.jsx(Xe,{display:"inline-block",children:b.jsx(Dn,{as:i9e,color:"blue.400",boxSize:3})})})]}),b.jsx(et,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),b.jsxs(ui,{spacing:4,justify:"center",children:[b.jsx(Ys,{icon:b.jsx(o9e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ye}),X&&b.jsx(Ys,{icon:b.jsx(Jze,{}),variant:"ghost",colorScheme:q?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),b.jsx(Ys,{icon:b.jsx(Xe,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),b.jsx(Ys,{icon:b.jsx(Xe,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),b.jsx(uo,{borderColor:"whiteAlpha.300"}),b.jsxs(gr,{align:"stretch",spacing:2,children:[X&&b.jsxs(ui,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:ve=>ve.stopPropagation(),justify:"space-between",children:[b.jsx(et,{fontSize:"md",children:"Edit Mode"}),b.jsx(Rg,{id:"edit-mode-toggle",isChecked:q,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:q?"green.500":"black"}}})]}),X&&b.jsx(et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Ce,children:"Manage Space"}),ae&&e&&!he&&b.jsx(R9e,{onClose:ke}),b.jsx(et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ze,children:"Settings"}),b.jsx(et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:tt,children:"Controls"}),b.jsx(et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),b.jsx(et,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),S&&b.jsx(I9e,{open:S,onClose:tt}),_&&b.jsx(P9e,{open:_,onClose:ze}),I&&b.jsx(xae,{open:I,onClose:Ie}),b.jsx(U9e,{isOpen:U,onClose:Ce})]})},j9e=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=ol(),u=Qg(),f=ll(),_=D.useRef(null),E=D.useRef(null),S=D.useRef(),[w,I]=D.useState(null),[k,U]=D.useState(""),[L,F]=D.useState(!1),[B,q]=D.useState(0),[$,X]=D.useState(null),[oe,re]=D.useState(!0),[pe,te]=D.useState(!1),[Z,ne]=D.useState(!1),[ae,me]=D.useState(0),[he,ue]=D.useState("image"),[Ue,ze]=D.useState(""),[tt,Ce]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&i&&l){re(!0);try{const It=await xf(l,i);if(It&&(It.imageUrl||It.videoUrl)){X(It);const jt=It.mediaType==="video";ue(jt?"video":"image"),Ce(It.displayAsVideo||!1),jt&&It.videoUrl&&(ze(It.videoUrl),me(1))}else X(null)}catch(It){be.error("Error fetching existing image:",It),X(null)}finally{re(!1)}}})()},[n,i,l]),D.useEffect(()=>{n||(I(null),U(""),q(0),ze(""))},[n]);const Ie=D.useCallback(it=>{it.preventDefault(),it.stopPropagation(),ne(!0)},[]),ye=D.useCallback(it=>{it.preventDefault(),it.stopPropagation(),ne(!1)},[]),ke=D.useCallback(it=>{it.preventDefault(),it.stopPropagation()},[]),Te=D.useCallback(it=>{if(it.preventDefault(),it.stopPropagation(),ne(!1),it.dataTransfer.files&&it.dataTransfer.files.length>0){const It=it.dataTransfer.files[0];ve(It)}},[]);D.useEffect(()=>{const it=E.current;if(it)return it.addEventListener("dragenter",Ie),it.addEventListener("dragleave",ye),it.addEventListener("dragover",ke),it.addEventListener("drop",Te),()=>{it.removeEventListener("dragenter",Ie),it.removeEventListener("dragleave",ye),it.removeEventListener("dragover",ke),it.removeEventListener("drop",Te)}},[Ie,ye,ke,Te]);const ve=it=>{if(!it)return;if(!it.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(it);const It=new FileReader;It.onloadend=()=>{U(It.result)},It.readAsDataURL(it)},Re=it=>{const It=it.target.files[0];ve(It)},Me=async it=>{const It=it.target.checked;if(Ce(It),$)try{await bze(l,i,It),It?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),X({...$,displayAsVideo:It}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${It?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),be.log(`Updated display mode for media screen ${i} to ${It?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:It})}catch(jt){be.error("Error updating display mode:",jt),f({title:"Update failed",description:jt.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Ce(!It)}},Ge=async()=>{if(he==="image"&&!w){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!Ue){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const it=setInterval(()=>{q(an=>{const jn=an+10;return jn>=90?90:jn})},300);let It;he==="image"?It=await WQ(l,i,w,{mediaType:he,displayAsVideo:tt}):(It=Ue,await WQ(l,i,null,{mediaType:"video",directUrl:Ue,displayAsVideo:tt})),clearInterval(it),q(100);let jt=null,Dt=null;he==="image"?(jt=tt?null:It,Dt=($==null?void 0:$.videoUrl)||null):(jt=!tt&&($!=null&&$.imageUrl)?$.imageUrl:null,Dt=It),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:jt,videoUrl:Dt,mediaType:he,displayAsVideo:tt}),be.log(`Uploaded and sent ${he} for media screen ${i} (display as video: ${tt})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:he==="image"?It:$==null?void 0:$.imageUrl,videoUrl:he==="video"?It:$==null?void 0:$.videoUrl,mediaType:he,displayAsVideo:tt}),f({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),U(""),F(!1),q(0),e()},1e3)}catch(it){be.error(`Error uploading ${he}:`,it),f({title:"Upload failed",description:it.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),F(!1),q(0)}},Qe=async()=>{te(!1);try{F(!0),await Sze(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:he==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:he==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),be.log(`Deleted ${he} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),f({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),X(null),F(!1),ze(""),Ce(!1),setTimeout(()=>{e()},500)}catch(it){be.error(`Error deleting ${he}:`,it),f({title:"Deletion failed",description:it.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),F(!1)}},nt=()=>{L||(I(null),U(""),q(0),e())},ht=it=>{me(it),ue(it===0?"image":"video")};return b.jsxs(b.Fragment,{children:[b.jsxs(hc,{isOpen:n,onClose:nt,size:"xl",children:[b.jsx(dc,{backdropFilter:"blur(10px)"}),b.jsxs(pc,{bg:"gray.800",color:"white",maxW:"900px",children:[b.jsx(Hu,{children:"Media Screen Content"}),b.jsx(cl,{isDisabled:L}),b.jsxs(Xe,{px:6,pb:2,children:[b.jsxs(sr,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[b.jsxs(ui,{spacing:4,children:[b.jsx(et,{fontWeight:"medium",children:"Display as:"}),b.jsxs(ui,{spacing:2,children:[b.jsx(Dn,{as:E0,color:tt?"gray.400":"green.300"}),b.jsx(Rg,{colorScheme:"purple",size:"md",isChecked:tt,onChange:Me}),b.jsx(Dn,{as:oO,color:tt?"purple.300":"gray.400"})]})]}),b.jsx(zd,{colorScheme:tt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:tt?"Video Output":"Image Output"})]}),b.jsxs(et,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",b.jsx("strong",{children:i})]}),b.jsx(et,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),b.jsx(uo,{mb:4})]}),b.jsx(uc,{children:b.jsxs(sr,{children:[b.jsx(RR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ae,onChange:ht,h:"100%",minW:"120px",mr:4,children:b.jsxs(IR,{children:[b.jsxs(Ml,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[b.jsx(Dn,{as:E0,mr:2})," Image"]}),b.jsxs(Ml,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[b.jsx(Dn,{as:oO,mr:2})," Video"]})]})}),b.jsx(Xe,{flex:"1",children:oe?b.jsx(sr,{justify:"center",align:"center",h:"150px",children:b.jsx(la,{size:"xl",color:"blue.400"})}):b.jsxs(b.Fragment,{children:[b.jsx(Xe,{children:ae===0?b.jsxs(gr,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&he==="image"&&b.jsxs(Xe,{children:[b.jsx(et,{fontWeight:"semibold",mb:2,children:"Current Image:"}),b.jsxs(sr,{children:[b.jsx(Xe,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:b.jsx(Va,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),b.jsxs(gr,{align:"flex-start",spacing:2,children:[b.jsxs(et,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),b.jsxs(et,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),b.jsx(Ar,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:b.jsx(Dn,{as:IC}),onClick:()=>te(!0),isDisabled:L,children:"Delete"})]})]}),b.jsx(uo,{my:4})]}),b.jsx(et,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),b.jsxs(Xe,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[k?b.jsx(Xe,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:b.jsx(Va,{src:k,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):b.jsxs(gr,{spacing:2,children:[b.jsx(Dn,{as:Fj,boxSize:"24px",color:"gray.400"}),b.jsx(et,{children:"Drag and drop an image here, or click to browse"}),b.jsx(et,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),b.jsx(pr,{type:"file",accept:"image/*",onChange:Re,ref:_,display:"none"})]}),w&&b.jsxs(et,{fontSize:"sm",children:["Selected file: ",w.name," (",Math.round(w.size/1024)," KB)"]})]}):b.jsxs(gr,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&he==="video"&&b.jsxs(Xe,{children:[b.jsx(et,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),b.jsxs(sr,{children:[b.jsx(Xe,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:b.jsx(et,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),b.jsxs(gr,{align:"flex-start",spacing:2,children:[b.jsxs(et,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),b.jsxs(et,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),b.jsx(Ar,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:b.jsx(Dn,{as:IC}),onClick:()=>te(!0),isDisabled:L,children:"Delete"})]})]}),b.jsx(uo,{my:4})]}),b.jsx(et,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),b.jsx(Xe,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:b.jsxs(ui,{children:[b.jsx(Dn,{as:N9e,color:"blue.300"}),b.jsx(et,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),b.jsxs(kn,{children:[b.jsx(Qn,{fontSize:"sm",children:"Video URL"}),b.jsx(pr,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Ue,onChange:it=>ze(it.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),b.jsx(et,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),b.jsxs(Xe,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[b.jsxs(ui,{children:[b.jsx(Dn,{as:oO,color:"blue.300"}),b.jsx(et,{fontWeight:"medium",children:"Video Support"})]}),b.jsx(et,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),b.jsx(et,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Ue&&b.jsxs(Xe,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[b.jsxs(ui,{mb:2,children:[b.jsx(Dn,{as:D9e,color:"blue.300"}),b.jsx(et,{fontWeight:"medium",children:"URL Preview"})]}),b.jsx(et,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Ue}),b.jsx(et,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),L&&b.jsxs(Xe,{mt:4,children:[b.jsxs(et,{mb:2,children:["Uploading: ",B,"%"]}),b.jsx(x0,{value:B,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),b.jsxs(D0,{children:[b.jsx(Ar,{variant:"ghost",mr:3,onClick:nt,isDisabled:L,children:"Cancel"}),b.jsx(Ar,{colorScheme:"blue",onClick:Ge,isLoading:L,loadingText:"Uploading",isDisabled:he==="image"&&!w||he==="video"&&!Ue||L||oe,leftIcon:b.jsx(Dn,{as:he==="image"?E0:oO}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),b.jsx(KUe,{isOpen:pe,leastDestructiveRef:S,onClose:()=>te(!1),children:b.jsx(dc,{children:b.jsxs(qUe,{bg:"gray.800",color:"white",children:[b.jsxs(Hu,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),b.jsxs(uc,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),b.jsxs(D0,{children:[b.jsx(Ar,{ref:S,onClick:()=>te(!1),children:"Cancel"}),b.jsx(Ar,{colorScheme:"red",onClick:Qe,ml:3,leftIcon:b.jsx(Dn,{as:IC}),children:"Delete"})]})]})})})]})},F9e=n=>{const[e,i]=D.useState(null),[a,l]=D.useState(""),[u,f]=D.useState(null),[_,E]=D.useState(!1),S=tm(),{spaceID:w}=ol(),I=D.useCallback(L=>{var F,B;try{if(!L)return null;if(L.includes("youtube.com")||L.includes("youtu.be")){let q="";return L.includes("youtube.com/watch")?q=new URLSearchParams(new URL(L).search).get("v"):L.includes("youtu.be/")&&(q=L.split("youtu.be/")[1].split("?")[0]),q?`https://www.youtube.com/embed/${q}?autoplay=1`:L}if(L.includes("vimeo.com")){if(L.includes("player.vimeo.com/video"))return L;const q=(B=(F=L.split("vimeo.com/")[1])==null?void 0:F.split("?")[0])==null?void 0:B.split("/")[0];return q?`https://player.vimeo.com/video/${q}?autoplay=1`:L}return L}catch(q){return be.error("Error converting to embed URL:",q),L}},[]),k=D.useCallback(()=>{setTimeout(()=>{E(!1),be.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let L=!0,F=null;const q=S("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:X,videoUrl:oe}=$||{};if(!X){be.error("Media screen ID is missing in Unity event data."),k();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${X}, setting ID but not playing video`),be.log("Edit mode is active, setting media screen ID but not playing video"),f(X);return}if(E(!0),F=setTimeout(()=>{L&&(be.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),oe){if(console.log(`Using direct video URL from event: ${oe}`),L)try{const re=I(oe);console.log(`Setting video URL to: ${re} (original: ${oe})`),i(re),l(`Media Screen ${X}`),f(X),be.log("Media screen video URL set directly from event:",re)}catch(re){be.error("Error setting video URL from direct URL:",re)}finally{k(),clearTimeout(F)}return}console.log(`Fetching media screen data for ID: ${X}`);try{const re=await xf(w,X);if(console.log("Media screen data from Firestore:",re),!re||!re.videoUrl){be.error("No video URL found for media screen:",X),k(),clearTimeout(F);return}if(!re.displayAsVideo){be.log("Media screen is not set to display as video:",X),console.log("displayAsVideo flag is false for this media screen"),k(),clearTimeout(F);return}if(L)try{const pe=I(re.videoUrl);console.log(`Setting video URL to: ${pe} (original: ${re.videoUrl})`),i(pe),l(re.title||`Media Screen ${X}`),f(X),be.log("Media screen video URL set to:",pe)}catch(pe){be.error("Error setting video URL from Firestore:",pe)}finally{k(),clearTimeout(F)}}catch(re){be.error(`Error fetching media screen data for ${X}:`,re),k(),clearTimeout(F)}}catch(X){be.error("Error handling media screen video play:",X),console.error("Error handling media screen video play:",X),k(),clearTimeout(F)}});return()=>{L=!1,F&&clearTimeout(F),q()}},[S,w,n,I,k]);const U=D.useCallback(()=>{i(null),l(""),f(null),E(!1),be.log("Video player state reset")},[]);return[e,a,u,U,_]},B9e=()=>{const{spaceID:n}=ol(),e=Qg(),i=tm(),[a,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){be.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const S=()=>{be.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",S),()=>{window.removeEventListener("PlayerInstantiated",S)}},[]);const u=D.useCallback(async S=>{try{return S.includes("vimeo.com")?await f(S):S.includes("youtube.com")||S.includes("youtu.be")?await _(S):"https://via.placeholder.com/640x360?text=Video"}catch(w){return be.error(`Error fetching thumbnail for ${S}:`,w),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async S=>{try{const w=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(S)}`,I=await fetch(w);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const k=await I.json(),U=k.thumbnail_url.replace(/_\d+x\d+/,""),L=["640x360","295x166"];let F=null;for(let B of L){const q=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${U}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(q,{method:"HEAD"})).ok){F=q;break}}catch($){be.warn(`Failed to validate thumbnail URL: ${q}`,$)}}return F||k.thumbnail_url}catch(w){return be.error(`Error fetching Vimeo thumbnail: ${w.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async S=>{let w="";if(S.includes("youtube.com/watch")?w=new URLSearchParams(new URL(S).search).get("v"):S.includes("youtu.be/")&&(w=S.split("youtu.be/")[1].split("?")[0]),!w)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${w}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(k){be.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${w}`,k)}return`https://img.youtube.com/vi/${w}/hqdefault.jpg`},E=D.useCallback(async S=>{try{if(!n||!S)return;be.log(`Refreshing thumbnail for media screen ${S}`);const w=await xf(n,S);if(!w){be.log(`No media screen found with ID ${S}`);return}if(be.log("Media screen data:",w),!w.displayAsVideo||!w.videoUrl){be.log(`Media screen ${S} is not set to display as video or has no video URL`);return}const I=await u(w.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:S,thumbnailUrl:I}),be.log(`Sent refreshed thumbnail for media screen ${S}: ${I}`)}catch(w){be.error(`Error refreshing thumbnail for media screen ${S}:`,w)}},[n,u,e]);D.useEffect(()=>{if(!a){be.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}be.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const w=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:k,thumbnailUrl:U}=I;U==="refresh"&&k&&(console.log(`Received request to refresh thumbnail for media screen ${k}`),await E(k))}catch(k){console.error("Error handling SetMediaScreenThumbnail event:",k)}});return()=>{w()}},[i,E,a]),D.useEffect(()=>{if(!a){be.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}be.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const S=async()=>{try{if(!n)throw new Error("spaceID is not defined.");be.log("Fetching media screens for thumbnails...");const I=await O3(n);be.log("All media screens:",I);const k=I.filter(F=>F.displayAsVideo&&F.videoUrl);if(be.log("Media screens set to display as videos:",k),k.length===0){be.log("No media screens set to display as videos found.");return}be.log(`Found ${k.length} media screens set to display as videos.`);const U=k.map(async F=>{try{const B=await u(F.videoUrl);return be.log(`Fetched thumbnail for ${F.id}: ${B}`),{mediaScreenId:F.id,thumbnailUrl:B}}catch(B){return be.error(`Error processing thumbnail for media screen ${F.id}:`,B),{mediaScreenId:F.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),L=await Promise.all(U);be.log("Fetched Media Screen Thumbnails",L),L.forEach(({mediaScreenId:F,thumbnailUrl:B})=>{e("SetMediaScreenThumbnail",{mediaScreenId:F,thumbnailUrl:B}),be.log(`Sent thumbnail to Unity for media screen ${F}: ${B}`)})}catch(I){be.error("Error fetching media screen thumbnails:",I)}};S();const w=setInterval(S,5*60*1e3);return()=>{clearInterval(w)}},[e,n,u,a])},rZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},W9e=()=>b.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),z9e=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:u}=Jd();return WN(a,`video-modal-${i}`),D.useEffect(()=>{if(a){const f=S=>{S.target.classList&&S.target.classList.contains("chakra-modal__overlay")&&(S.stopPropagation(),S.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(S){console.error("Error disabling Unity input:",S)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(S){console.error("Error re-enabling Unity input:",S)}}}},[a]),b.jsxs(b.Fragment,{children:[b.jsx(W9e,{}),b.jsxs(hc,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[b.jsx(dc,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),b.jsxs(pc,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[b.jsx(cl,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),b.jsx(uc,{p:0,width:"100%",children:n?b.jsx(Xe,{className:"iframe-container",style:rZ.iframeContainer,children:b.jsx("iframe",{className:"video-iframe",src:n,style:rZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):b.jsxs(sr,{direction:"column",align:"center",justify:"center",h:"400px",children:[b.jsx(la,{size:"xl",mb:4}),b.jsx(et,{children:"Unable to load video"}),b.jsx(et,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},xs=(...n)=>{},G9e=()=>{const{isOpen:n,onOpen:e,onClose:i}=gp(),[a,l]=D.useState(null),[u,f]=D.useState("image"),_=D.useRef(null);WN(n,"image-viewer-modal");const E=D.useCallback(I=>{I.stopPropagation()},[]);return D.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const k=document.getElementById("unity-canvas");return k&&(k.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),k&&(k.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:a,currentMediaType:u,openImageViewer:(I,k="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${k}`);const U=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),L=U?"image":k;console.log(`[DEBUG] Detected URL as ${U?"image":"non-image"}, using media type: ${L}`),l(I),f(L),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:_,preventPropagation:E}},H9e=()=>b.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),YU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),a=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),a&&e.searchParams.set("token",a),xs(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},$9e=()=>{const{spaceID:n}=ol(),[e,i]=D.useState(!1),[a,l]=D.useState([]),[u,f]=D.useState(null),{isOpen:_,onOpen:E,onClose:S}=gp(),[w,I]=D.useState({}),[k,U]=D.useState(0);D.useRef(null);const L=Qg(),{fullscreenRef:F}=Jd(),B=tm(),[q,$]=D.useState(!1),{isOpen:X,currentImageUrl:oe,currentMediaType:re,openImageViewer:pe,closeImageViewer:te,modalContentRef:Z,preventPropagation:ne}=G9e(),[ae,me,he,ue,Ue]=F9e(e),{isOpen:ze,onOpen:tt,onClose:Ce}=gp();B9e(),Eae(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const ve=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",ve),()=>{window.removeEventListener("PlayerInstantiated",ve)}},[]);const Ie=D.useCallback(ve=>{if(Array.isArray(a)&&a.length>0){const Re=a.find(Me=>Me.mediaScreenId===ve);if(Re){const Me=Re.imageUrl,Ge=Re.videoUrl;return{screen:Re,imageUrl:Me,videoUrl:Ge,mediaType:Re.mediaType||"image",displayAsVideo:Re.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(oe){let Re=null;return Array.isArray(a)&&(Re=a.find(Me=>Me.mediaScreenId===ve)),{screen:Re||{mediaScreenId:ve},imageUrl:oe,videoUrl:null,mediaType:(Re==null?void 0:Re.mediaType)||"image",displayAsVideo:(Re==null?void 0:Re.displayAsVideo)||!1}}return n&&ve&&xf(n,ve).then(Re=>{Re&&l(Me=>Array.isArray(Me)&&Me.some(Qe=>Qe.mediaScreenId===ve)?Me.map(Qe=>Qe.mediaScreenId===ve?{...Qe,imageUrl:Re.imageUrl,videoUrl:Re.videoUrl,mediaType:Re.mediaType||"image",displayAsVideo:Re.displayAsVideo||!1,hasImage:!!Re.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Qe):[...Array.isArray(Me)?Me:[],{mediaScreenId:ve,imageUrl:Re.imageUrl,videoUrl:Re.videoUrl,mediaType:Re.mediaType||"image",displayAsVideo:Re.displayAsVideo||!1,hasImage:!!Re.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Re=>{console.error(`Error fetching media screen data for ${ve}:`,Re)}),console.warn("No screen data found for:",ve),null},[a,oe,n,l]),ye=D.useCallback(ve=>{if(console.log(`[DEBUG] Processing click on screen: ${ve}, isEditMode: ${e}`),f(ve),e)console.log(`[DEBUG] Opening upload modal for screen: ${ve} in edit mode`),E();else{const Re=Ie(ve);if(Re){if(console.log(`[DEBUG] Screen data for ${ve}:`,Re),xs("Screen data details:",{mediaScreenId:ve,imageUrl:Re.imageUrl,videoUrl:Re.videoUrl,mediaType:Re.mediaType,displayAsVideo:Re.displayAsVideo}),ze&&he===ve)return;if(Re.displayAsVideo&&Re.videoUrl)xs(`Opening video player for: ${Re.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:ve,videoUrl:Re.videoUrl});else if(Re.imageUrl){xs(`Opening viewer modal with ${Re.mediaType}: ${Re.imageUrl}`);const Ge=YU(Re.imageUrl);pe(Ge,Re.mediaType||"image")}else n&&xf(n,ve).then(Ge=>{if(Ge){if(Ge.displayAsVideo&&Ge.videoUrl)xs(`Opening video player for: ${Ge.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:ve,videoUrl:Ge.videoUrl});else if(Ge.imageUrl){xs(`Opening viewer modal with image: ${Ge.imageUrl}`);const Qe=YU(Ge.imageUrl);pe(Qe,Ge.mediaType||"image")}l(Qe=>Array.isArray(Qe)&&Qe.some(ht=>ht.mediaScreenId===ve)?Qe.map(ht=>ht.mediaScreenId===ve?{...ht,...Ge,mediaScreenId:ve,source:"firestore-click",lastUpdated:new Date().toISOString()}:ht):[...Array.isArray(Qe)?Qe:[],{...Ge,mediaScreenId:ve,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ge=>{console.error(`Error fetching media screen data for ${ve}:`,Ge)})}else n&&xf(n,ve).then(Me=>{if(Me){if(Me.displayAsVideo&&Me.videoUrl)xs(`Opening video player for: ${Me.videoUrl}`),L("PlayMediaScreenVideo",{mediaScreenId:ve,videoUrl:Me.videoUrl});else if(Me.imageUrl){xs(`Opening viewer modal with image: ${Me.imageUrl}`);const Ge=YU(Me.imageUrl);pe(Ge,Me.mediaType||"image")}l(Ge=>Array.isArray(Ge)&&Ge.some(nt=>nt.mediaScreenId===ve)?Ge.map(nt=>nt.mediaScreenId===ve?{...nt,...Me,mediaScreenId:ve,source:"firestore-click",lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(Ge)?Ge:[],{...Me,mediaScreenId:ve,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Me=>{console.error(`Error fetching media screen data for ${ve}:`,Me)})}},[e,E,Ie,ze,he,L,pe,n]);D.useEffect(()=>{if(!q)return;const ve=async()=>{if(n)try{const Me=await O3(n),Ge={};Me.forEach(Qe=>{Qe.id&&Qe.imageUrl&&(Ge[Qe.id]=Qe.imageUrl)}),l(Qe=>Qe.map(nt=>{const ht=!!Ge[nt.mediaScreenId],it=Ge[nt.mediaScreenId],It=nt.mediaType||"image";return{...nt,hasImage:ht,imageUrl:it,mediaType:It}}))}catch(Me){console.error("Error fetching media screen images:",Me)}};ve();let Re=null;return e&&(Re=setInterval(ve,5e3)),()=>{Re&&clearInterval(Re)}},[n,e,k,q]);const ke=ve=>{l(Re=>Re.map(Me=>{if(Me.mediaScreenId===ve.mediaScreenId){if(ve.type==="upload")return{...Me,hasImage:!0,imageUrl:ve.imageUrl,mediaType:ve.mediaType||"image"};if(ve.type==="delete")return{...Me,hasImage:!1,imageUrl:null,mediaType:null}}return Me})),ve.type==="delete"?(setTimeout(()=>{l(Re=>Re.filter(Me=>Me.mediaScreenId!==ve.mediaScreenId))},100),setTimeout(()=>{l(Re=>Re.filter(Me=>Me.mediaScreenId!==ve.mediaScreenId))},1500)):setTimeout(()=>{l(Re=>Re.some(Ge=>Ge.mediaScreenId===ve.mediaScreenId)?Re.map(Ge=>Ge.mediaScreenId===ve.mediaScreenId?{...Ge,imageUrl:ve.imageUrl,hasImage:!0,mediaType:ve.mediaType||"image"}:Ge):[...Re,{mediaScreenId:ve.mediaScreenId,imageUrl:ve.imageUrl,hasImage:!0,mediaType:ve.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const ve=Re=>{const Me=Re.detail.enabled;i(Me),Me?L("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):L("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",ve),()=>{window.removeEventListener("editModeChanged",ve)}},[L]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(ve){console.log("Unity: MediaScreenClick received with data:",ve);try{const Re=JSON.parse(ve),Me=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Re)});window.dispatchEvent(Me)}catch(Re){console.error("Error processing MediaScreenClick data:",Re)}},window.handleMediaScreenClick=function(ve){console.log("Direct call to handleMediaScreenClick with ID:",ve),ye(ve)},window.TestJavaScriptFromUnity=function(ve){console.log("Unity called TestJavaScriptFromUnity with:",ve),alert("Unity called JavaScript: "+ve)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ye]),D.useEffect(()=>{const ve=Ge=>{try{const Qe=JSON.parse(Ge.detail);be.log(`MediaScreen registered: ${Qe.mediaScreenId}`),xs("MediaScreen registered from Unity:",Qe),l(ht=>ht.some(It=>It.mediaScreenId===Qe.mediaScreenId)?ht.map(It=>It.mediaScreenId===Qe.mediaScreenId?{...It,...Qe,source:"event",lastUpdated:new Date().toISOString()}:It):[...ht,{...Qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&L("SetMediaScreenEditMode",{mediaScreenId:Qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const nt=Qe.mediaScreenId;nt&&xf(n,nt).then(ht=>{ht&&(xs(`Media screen data for ${nt}:`,ht),ht.displayAsVideo&&ht.videoUrl&&(xs(`Media screen ${nt} should display as video, sending null imageUrl`),L("SetMediaScreenImage",{mediaScreenId:nt,imageUrl:null,displayAsVideo:!0})))}).catch(ht=>{console.error(`Error fetching media screen data for ${nt}:`,ht)})}catch(Qe){console.error("Error handling MediaScreen registration:",Qe)}},Re=Ge=>{try{xs("MediaScreenClick event received:",Ge);let Qe;if(typeof Ge=="string")Qe=Ge,xs("MediaScreenClick: Direct call with ID:",Qe);else{xs("MediaScreenClick: Event from Unity:",Ge),xs("MediaScreenClick: Event detail:",Ge.detail);try{Qe=JSON.parse(Ge.detail).mediaScreenId,xs("MediaScreenClick: Parsed mediaScreenId:",Qe)}catch(nt){if(console.error("MediaScreenClick: Error parsing event detail:",nt),Ge.detail&&Ge.detail.mediaScreenId)Qe=Ge.detail.mediaScreenId,xs("MediaScreenClick: Using direct mediaScreenId from detail:",Qe);else throw new Error("Could not extract mediaScreenId from event")}}be.log(`MediaScreen clicked: ${Qe}`),xs("MediaScreen clicked:",Qe),ye(Qe)}catch(Qe){console.error("Error handling MediaScreen click:",Qe)}},Me=Ge=>{if(Ge.detail&&Ge.detail.eventName==="RegisterMediaScreen")ve({detail:Ge.detail.eventData});else if(Ge.detail&&Ge.detail.eventName==="MediaScreenClick")Re({detail:Ge.detail.eventData});else if(Ge.detail&&Ge.detail.eventName==="SetMediaScreenImage")try{const Qe=JSON.parse(Ge.detail.eventData);Qe.mediaScreenId&&(xs("SetMediaScreenImage event received:",Qe),l(nt=>Array.isArray(nt)&&nt.some(it=>it.mediaScreenId===Qe.mediaScreenId)?nt.map(it=>it.mediaScreenId===Qe.mediaScreenId?{...it,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:it):[...Array.isArray(nt)?nt:[],{mediaScreenId:Qe.mediaScreenId,imageUrl:Qe.imageUrl,hasImage:!!Qe.imageUrl,displayAsVideo:Qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Qe){console.error("Error handling SetMediaScreenImage event:",Qe)}};return window.addEventListener("RegisterMediaScreen",ve),window.addEventListener("MediaScreenClick",Re),window.addEventListener("reactUnityEvent",Me),()=>{window.removeEventListener("RegisterMediaScreen",ve),window.removeEventListener("MediaScreenClick",Re),window.removeEventListener("reactUnityEvent",Me)}},[e,E,L,a,X,ze,pe,ye,n]),D.useEffect(()=>{const ve=Re=>{try{xs("Direct MediaScreenClick event received:",Re);let Me;if(Re.detail)try{Me=JSON.parse(Re.detail).mediaScreenId}catch(Ge){console.error("Error parsing MediaScreenClick event detail:",Ge);return}if(!Me){console.error("No mediaScreenId found in MediaScreenClick event");return}xs(`Direct handler: Processing click for media screen ${Me}`),ye(Me)}catch(Me){console.error("Error in direct MediaScreenClick handler:",Me)}};return window.addEventListener("MediaScreenClick",ve),()=>{window.removeEventListener("MediaScreenClick",ve)}},[ye]),D.useEffect(()=>{ae&&tt()},[ae,tt]);const Te=()=>{ue(),Ce()};return D.useEffect(()=>{const Re=B("RegisterMediaScreen",Me=>{try{if(be.log("Direct RegisterMediaScreen event received with data:",Me),!Me||!Me.mediaScreenId){be.warn("RegisterMediaScreen event received with invalid data");return}const Ge=Me.mediaScreenId;be.log(`Media screen registered directly: ${Ge}`),l(Qe=>Qe.some(ht=>ht.mediaScreenId===Ge)?Qe.map(ht=>ht.mediaScreenId===Ge?{...ht,...Me,source:"direct-event",lastUpdated:new Date().toISOString()}:ht):[...Qe,{...Me,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&L("SetMediaScreenEditMode",{mediaScreenId:Ge,enabled:!0,showUploadIcon:!0})}catch(Ge){console.error("Error handling direct RegisterMediaScreen event:",Ge)}});return()=>{Re()}},[B,e,L]),D.useEffect(()=>{const Re=B("MediaScreenClick",Me=>{try{if(be.log("Direct MediaScreenClick event received with data:",Me),!Me||!Me.mediaScreenId){be.warn("MediaScreenClick event received with invalid data");return}const Ge=Me.mediaScreenId;be.log(`Media screen clicked directly: ${Ge}`),ye(Ge)}catch(Ge){console.error("Error handling direct MediaScreenClick event:",Ge)}});return()=>{Re()}},[B,ye]),D.useEffect(()=>{e&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),f(he),E(),ue())},[e,he,E,ue]),b.jsxs(b.Fragment,{children:[b.jsx(j9e,{isOpen:_,onClose:S,mediaScreenId:u,onImageChange:ke}),b.jsx(H9e,{}),b.jsx($l,{containerRef:F,children:b.jsxs(hc,{isOpen:X,onClose:te,size:"lg",isCentered:!0,portalProps:{containerRef:F},id:"image-viewer-modal",blockScrollOnMount:!0,children:[b.jsx(dc,{bg:"rgba(0, 0, 0, 0.8)",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne}),b.jsxs(pc,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[b.jsx(cl,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),b.jsx(uc,{p:0,width:"100%",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:oe?b.jsx(Xe,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:re==="image"?b.jsx(Va,{src:oe,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",oe),onError:ve=>console.error("Error loading image:",ve,oe),onClick:ne}):b.jsxs(Xe,{width:"100%",textAlign:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[b.jsx(et,{mb:4,fontSize:"lg",children:"Video URL:"}),b.jsx(et,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:oe}),b.jsx(et,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):b.jsx(sr,{direction:"column",align:"center",justify:"center",h:"400px",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:b.jsx(et,{children:"No image available"})})})]})]})}),b.jsx(z9e,{videoUrl:ae,videoTitle:me,mediaScreenId:he,isOpen:ze,onClose:Te})]})},Bae=({backgroundUrl:n=null,containerRef:e})=>{const[i,a]=D.useState(!1),[l,u]=D.useState(n),f=D.useRef(null),_=D.useRef(null);return D.useEffect(()=>{const E=S=>{const{backgroundUrl:w}=S.detail;u(w),f.current&&(w?(f.current.style.backgroundImage=`url('${w}')`,f.current.style.display="block",_.current&&(_.current.style.display="block")):(f.current.style.display="none",_.current&&(_.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",E),()=>{window.removeEventListener("SpaceBackgroundUpdated",E)}},[]),D.useEffect(()=>{u(n),f.current&&n!==l&&(f.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!e||!e.current)return;const E=document.createElement("div");f.current=E,Object.assign(E.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const S=document.createElement("div");_.current=S,Object.assign(S.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),e.current.appendChild(E),e.current.appendChild(S);const w=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),E.style.opacity="0",S.style.opacity="0",setTimeout(()=>{e.current&&e.current.contains(E)&&e.current.removeChild(E),e.current&&e.current.contains(S)&&e.current.removeChild(S)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),w();else{Kd.subscribe($d.playerInstantiated,w);const I=()=>w();window.addEventListener("PlayerInstantiated",I);const k=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),w()},3e4);return()=>{Kd.unsubscribe($d.playerInstantiated,w),window.removeEventListener("PlayerInstantiated",I),clearTimeout(k),e.current&&e.current.contains(E)&&e.current.removeChild(E),e.current&&e.current.contains(S)&&e.current.removeChild(S)}}},[l,e]),null};Bae.propTypes={backgroundUrl:Hr.string,containerRef:Hr.shape({current:Hr.instanceOf(Element)})};const Wae=({containerRef:n})=>{const{spaceID:e}=ol(),[i,a]=D.useState(!1),[l,u]=D.useState(!1),[f,_]=D.useState(0),[E,S]=D.useState("Initialising World"),[w,I]=D.useState(null),k=D.useRef(null),U=D.useRef(null),L=D.useRef(null),F=D.useRef(null);D.useEffect(()=>(be.log("PersistentLoader: Component mounted with spaceID:",e),be.log("PersistentLoader: Container ref:",n),()=>{be.log("PersistentLoader: Component unmounting")}),[]);const{error:B}=ol(),[q,$]=D.useState(!1);return D.useEffect(()=>{B&&(be.error("PersistentLoader: Unity error detected:",B),$(!0),setTimeout(()=>{if(k.current){const X=k.current.querySelector("div:first-child");X&&(X.textContent="Reconnecting...")}},3e3))},[B]),D.useEffect(()=>{(async()=>{if(e){be.log(`PersistentLoader: Fetching logo for space ${e}`);try{const oe=await kg(e);oe&&oe.logoUrl?(be.log(`PersistentLoader: Found logo URL: ${oe.logoUrl}`),I(oe.logoUrl)):be.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(oe){be.error("PersistentLoader: Error fetching space logo:",oe)}}else be.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),D.useEffect(()=>{const X=oe=>{const{logoUrl:re}=oe.detail;be.log(`PersistentLoader: Logo update event received with URL: ${re}`),I(re),U.current?re?(be.log("PersistentLoader: Updating logo element with new URL"),U.current.src=re,L.current.style.display="flex"):(be.log("PersistentLoader: Hiding logo element (no URL)"),L.current.style.display="none"):be.warn("PersistentLoader: Logo ref is null during update")};return be.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",X),()=>{be.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",X)}},[]),D.useEffect(()=>{if(!n||!n.current){be.error("PersistentLoader: Container ref is null or has no current property");return}be.log("PersistentLoader: Creating loader elements");const X=document.createElement("div");if(k.current=X,Object.assign(X.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),w){be.log(`PersistentLoader: Creating logo element with URL: ${w}`);const ze=document.createElement("div");L.current=ze,Object.assign(ze.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const tt=document.createElement("img");U.current=tt,tt.src=w,tt.alt="Space Logo",tt.style.maxHeight="100px",tt.style.maxWidth="100%",tt.style.objectFit="contain",tt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",ze.appendChild(tt),n.current.appendChild(ze),be.log("PersistentLoader: Logo container added to main container")}else be.log("PersistentLoader: No logo URL available, skipping logo creation");const oe=document.createElement("style");oe.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(oe),be.log("PersistentLoader: Animation styles added to document head");const re=document.createElement("div");re.style.fontSize="16px",re.style.fontWeight="bold",re.style.textAlign="center",re.style.marginBottom="16px",re.style.color="#ffffff",re.textContent="Initialising World";const pe=document.createElement("div");pe.style.width="100%",pe.style.height="12px",pe.style.backgroundColor="rgba(255, 255, 255, 0.2)",pe.style.borderRadius="6px",pe.style.overflow="hidden",pe.style.position="relative",pe.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const te=document.createElement("div");te.style.height="100%",te.style.width="0%",te.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",te.style.backgroundSize="200% 200%",te.style.animation="progress-glow 2s ease infinite",te.style.transition="width 0.5s ease-out",te.style.borderRadius="6px",te.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",pe.appendChild(te);const Z=document.createElement("div");Z.style.marginTop="8px",Z.style.fontSize="14px",Z.style.fontWeight="bold",Z.style.color="#ffffff",Z.textContent="0%",X.appendChild(re),X.appendChild(pe),X.appendChild(Z),n.current.appendChild(X),be.log("PersistentLoader: Loader element added to container");const ne=ze=>{_(ze),te.style.width=`${Math.round(ze*100)}%`,Z.textContent=`${Math.round(ze*100)}%`,be.log(`PersistentLoader: Progress updated to ${Math.round(ze*100)}%`)},ae=ze=>{S(ze),re.textContent=ze,be.log(`PersistentLoader: Loading stage updated to "${ze}"`)},me=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];q&&(me[0].stage="Connecting to Space",me[1].stage="Reconnecting...",me[2].stage="Please Wait"),ae(me[0].stage),ne(.05);const he=ze=>{const tt=ze.detail.progress;be.log(`PersistentLoader: Progress event received with value: ${tt}`),ne(tt),tt<.33?ae(me[0].stage):tt<.66?ae(me[1].stage):ae(me[2].stage)},ue=()=>{be.log("PersistentLoader: First scene loaded event received"),a(!0),ae(me[1].stage),ne(.66)},Ue=()=>{if(be.log("PersistentLoader: Player instantiated event received"),F.current&&(clearInterval(F.current),be.log("PersistentLoader: Progress interval cleared")),u(!0),ae(me[2].stage),ne(1),q){be.log("PersistentLoader: Keeping loader visible due to Unity error");return}X.style.opacity="0",L.current&&(L.current.style.opacity="0"),setTimeout(()=>{n.current&&n.current.contains(X)?(n.current.removeChild(X),be.log("PersistentLoader: Loader element removed after fade")):be.warn("PersistentLoader: Could not remove loader element (not found in container)"),L.current&&n.current&&n.current.contains(L.current)?(n.current.removeChild(L.current),be.log("PersistentLoader: Logo container removed after fade")):L.current&&be.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)be.log("PersistentLoader: Player was already instantiated"),Ue();else{be.log("PersistentLoader: Subscribing to playerInstantiated event"),Kd.subscribe($d.playerInstantiated,Ue);const ze=()=>Ue();be.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",ze),be.log("PersistentLoader: Adding firstSceneLoaded event listener"),Kd.subscribe($d.firstSceneLoaded,ue),be.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",he),F.current=setInterval(()=>{l||_(Ce=>{const Ie=Math.min(Ce+.01,.95);return te.style.width=`${Math.round(Ie*100)}%`,Z.textContent=`${Math.round(Ie*100)}%`,Ie<.33&&E!==me[0].stage?ae(me[0].stage):Ie>=.33&&Ie<.66&&E!==me[1].stage?ae(me[1].stage):Ie>=.66&&E!==me[2].stage&&ae(me[2].stage),Ie})},500);const tt=setTimeout(()=>{be.log("PersistentLoader: Forcing loader removal after timeout"),Ue()},6e4);return()=>{be.log("PersistentLoader: Cleaning up event listeners"),Kd.unsubscribe($d.playerInstantiated,Ue),window.removeEventListener("PlayerInstantiated",ze),Kd.unsubscribe($d.firstSceneLoaded,ue),window.removeEventListener("UnityProgress",he),clearInterval(F.current),clearTimeout(tt),n.current&&n.current.contains(X)&&(n.current.removeChild(X),be.log("PersistentLoader: Loader element removed during cleanup")),L.current&&n.current&&n.current.contains(L.current)&&(n.current.removeChild(L.current),be.log("PersistentLoader: Logo container removed during cleanup"))}}},[w,n]),null};Wae.propTypes={containerRef:Hr.shape({current:Hr.instanceOf(Element)})};const W0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,M3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),_=document.activeElement===u;!l&&(f||_)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},zae=()=>{document.body.classList.remove("unity-focused")};function xk(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?M3():zae(),new Promise(e=>{try{const i=W0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),Bj(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function Bj(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const a=()=>{i++;const l=W0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(u){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",u);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${u}ms`),window.__unityInstancePoller=setTimeout(a,u)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function K9e(){const n=W0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function Ay(n=!0){return console.log("Focusing Unity canvas"),n?M3():zae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){xk(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function Wd(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),M3(),new Promise(e=>{try{if(n)xk(!1).then(i=>{var u;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=W0();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=W0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),xk(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function q9e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function Y9e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=xk,window.focusUnity=Ay,window.blockUnityKeyboardInput=Wd,window.hasUnityKeyboardFocus=K9e,window.getUnityInstance=W0,window.registerUnityInstance=q9e,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),Bj(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),Bj(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),Wd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),Wd(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),Wd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(Y9e,0);const X9e="",XU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),U3=D.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:a,error:l}=ol(),u=gze();yze();const f=Qg(),_=wze(u),{user:E}=D.useContext(ul),[S,w]=D.useState(!1),[I,k]=D.useState(window.devicePixelRatio),[U,L]=vze();yae().find(ke=>ke.isLocalPlayer);const[B,q]=D.useState(!0),[$,X]=D.useState(!0),[oe,re]=D.useState(!1),[pe,te]=D.useState(!1),[Z,ne]=D.useState(!1);D.useEffect(()=>{Z?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),Wd(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!pe&&Wd(!1).then(()=>{setTimeout(()=>{Ay(!0)},100)}))},[Z,a,pe]);const ae=n.spaceID||"default",me=D.useMemo(()=>{const ve=new URLSearchParams(window.location.search).get("sessionId")||ae;return console.log("WebGLRenderer: Using session ID:",ve),ve},[ae]),[he,ue]=D.useState(null);D.useEffect(()=>{E!=null&&E.uid&&Ep(E.uid).then(ke=>{ue(ke),console.log("WebGLRenderer: User profile loaded:",(ke==null?void 0:ke.Nickname)||"Unknown")}).catch(ke=>{console.error("Error fetching user profile:",ke)})},[E==null?void 0:E.uid]),D.useEffect(()=>{if(l||!E){be.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ke=setTimeout(()=>{te(!0),ne(!0)},1e3);return()=>clearTimeout(ke)}else te(!1)},[l,E]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ke=()=>{console.log("WebGLRenderer: Player instantiated event received"),X(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),X(!0)),Kd.subscribe($d.playerInstantiated,ke);const Te=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),X(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Kd.unsubscribe($d.playerInstantiated,ke),clearTimeout(Te)}},[$]),D.useEffect(()=>{const ke=()=>{console.log("WebGLRenderer: Modal opened"),ne(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),ne(!1)};return window.addEventListener("modal-opened",ke),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",ke),window.removeEventListener("modal-closed",Te)}},[]),D.useEffect(()=>{ne(U!==null)},[U]),D.useEffect(()=>{a||u?setTimeout(()=>{w(!0),be.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):be.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,u]),D.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ke){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ke)}},1e3)},[a,i]),D.useEffect(()=>{const ke=document.getElementById("webgl-root");return ke?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ke.style.display="block",ke.getAttribute("data-space-id")!==ae&&(ke.setAttribute("data-space-id",ae),console.log(`WebGLRenderer: Set data-space-id attribute to ${ae}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ae]),D.useEffect(()=>{const ke=()=>{const Re=XU();Re?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Re.tabIndex=1,Re.style.outline="none",Re.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||Ay(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ke();const Te=setTimeout(ke,1e3),ve=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ke()};return window.addEventListener("unityReady",ve),()=>{clearTimeout(Te),window.removeEventListener("unityReady",ve)}},[a,Z]);const Ue=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||Ay(!0)},[Z]);D.useEffect(()=>{if(a&&i){const ke=XU();if(ke)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ke.addEventListener("click",Ue),()=>{ke.removeEventListener("click",Ue)}}},[a,i,Ue]),D.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const ke=Te=>{if(Z){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const ve=XU();if(ve&&(Te.target===ve||ve.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Z||Ay(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{ve&&!Z&&((ve.tabIndex===void 0||ve.tabIndex<0)&&(ve.tabIndex=1),ve.focus(),Ay(!0))},50)};return document.addEventListener("click",ke,!0),()=>{document.removeEventListener("click",ke,!0)}}},[a,i,Z]),D.useEffect(()=>{const ke=Te=>{be.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",Te)};return Kd.subscribe($d.sendUserToUnity,ke),()=>Kd.unsubscribe($d.sendUserToUnity,ke)},[f]);const{setFullscreenRef:ze,fullscreenRef:tt}=Jd();D.useEffect(()=>{ze(e.current)},[e,ze]);const Ce=()=>{q(!B)},Ie=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:$,showVoiceChat:Ie,sessionId:me}),D.useEffect(()=>{const ke=Te=>{re(Te.detail.enabled)};return window.addEventListener("editModeChanged",ke),()=>{window.removeEventListener("editModeChanged",ke)}},[]),Eae(),Eze();const ye=D.useRef(null);return b.jsxs(Xe,{className:"webgl-renderer",children:[n.urlLoadingBackground&&b.jsx(Bae,{backgroundUrl:n.urlLoadingBackground,containerRef:ye}),!pe&&b.jsx(Wae,{containerRef:ye}),pe&&b.jsx(Xe,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:b.jsx(GN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),b.jsx(pF,{containerRef:tt.current?tt:document.body,children:b.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"16/9",position:"relative"},children:[b.jsxs(Xe,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&b.jsx($ze,{}),Ie&&b.jsxs(jae,{appId:X9e,channel:me,uid:E==null?void 0:E.uid,enabled:!0,children:[b.jsx(T9e,{size:"md",defaultMuted:!0,joinOnClick:!0}),b.jsx(C9e,{userNickname:he==null?void 0:he.Nickname})]}),b.jsx(u9e,{}),b.jsx(Xe,{position:"relative",zIndex:"9999",children:b.jsx(V9e,{onTogglePlayerList:Ce,spaceID:ae})})]}),b.jsxs(Xe,{ref:ye,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[b.jsx(Xe,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),b.jsx(Xe,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?b.jsx(_ae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):b.jsx(Xe,{width:"100%",height:"100%"})}),b.jsx(Xe,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:b.jsx(Hze,{})})]}),b.jsx(Xe,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&b.jsx(Va,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),b.jsx(Xe,{..._,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),b.jsxs(Xe,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&b.jsx(Kze,{}),b.jsx(p9e,{})]}),b.jsx(f9e,{}),b.jsx(m9e,{isOpen:U!==null,onClose:()=>{console.log(" Closing nameplate modal"),L()},playerName:(U==null?void 0:U.playerName)||"Unknown Player",playerId:(U==null?void 0:U.playerId)||"Unknown ID"}),b.jsx(g9e,{isVisible:B,onToggleVisibility:q,spaceID:ae}),b.jsx($9e,{})]})})]})});U3.displayName="WebGLRenderer";U3.propTypes={settings:Hr.shape({urlLoadingBackground:Hr.string,showAuthButton:Hr.bool,showDisruptiveLogo:Hr.bool,urlDisruptiveLogo:Hr.string,showHelpButton:Hr.bool,enableVoiceChat:Hr.bool,spaceID:Hr.string})};const $N=({spaceID:n,overrideSettings:e})=>{const i=D.useRef(null),[a,l]=D.useState(!0),[u,f]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[_,E]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const w=await kg(n);if(w){f(U=>({...U,spaceID:n,loaderUrl:w.loaderUrl,dataUrl:w.dataUrl,frameworkUrl:w.frameworkUrl,codeUrl:w.codeUrl}));const I=await zO(_.urlDisruptiveLogo);let k="";if(w.backgroundUrl)k=w.backgroundUrl;else if(w.backgroundGsUrl)try{k=await zO(w.backgroundGsUrl)}catch(U){be.warn("WebGLLoader: Error fetching background from GS URL:",U)}else if(w.gsUrlLoadingBackground)try{k=await zO(w.gsUrlLoadingBackground)}catch(U){be.warn("WebGLLoader: Error fetching background from legacy GS URL:",U)}E(U=>({...U,urlLoadingBackground:k,showAuthButton:w.showAuthButton!==void 0?w.showAuthButton:!0,showDisruptiveLogo:w.showDisruptiveLogo!==void 0?w.showDisruptiveLogo:!0,showHelpButton:w.showHelpButton!==void 0?w.showHelpButton:!0,enableVoiceChat:w.enableVoiceChat!==void 0?w.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...e||{}})),l(!1)}else be.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(w){be.error("WebGLLoader: Error fetching space data:",w)}finally{l(!1)}})()},[n,_.urlDisruptiveLogo,e]),D.useEffect(()=>{a||(be.log("WebGLLoader: Unity config from Firebase",u),be.log("WebGLLoader: Space settings from Firebase",_))},[a]),b.jsx(b.Fragment,{children:a?b.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):b.jsx(mze,{...u,children:b.jsx(U3,{ref:i,settings:_})})})};$N.propTypes={spaceID:Hr.string.isRequired,overrideSettings:Hr.object};const J9e=({isOpen:n,onClose:e,user:i,profileImageUrl:a})=>{const[l,u]=D.useState(!1),[f,_]=D.useState({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,S]=D.useState(!1),[w,I]=D.useState(!1),k=ll(),{sendUserToUnity:U}=D.useContext(ul),L=D.useRef(null);D.useEffect(()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),D.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),Wd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),Wd(!1).then(()=>{setTimeout(()=>{Ay(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),Wd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),D.useEffect(()=>{if(l&&L.current){const oe=()=>{L.current.focus(),I(!0),Wd(!0)};oe();const re=setTimeout(oe,100),pe=setTimeout(oe,300);return()=>{clearTimeout(re),clearTimeout(pe)}}else I(!1)},[l]);const F=()=>{u(!1),I(!1),e()},B=oe=>{const{name:re,value:pe}=oe.target;_(te=>({...te,[re]:pe}))},q=async()=>{if(f.Nickname.trim()===""){k({title:"Error",description:"Nickname cannot be empty",status:"error",duration:3e3,isClosable:!0});return}S(!0);try{const oe=qi(ri,"users",i.uid),re=m8e(oe,pe=>{pe.exists()&&pe.data().Nickname===f.Nickname&&(U(),re())});await $u(oe,{...f,lastUpdated:new Date().toISOString()}),await updateUser(),_({Nickname:f.Nickname,companyName:f.companyName,firstName:f.firstName,lastName:f.lastName,linkedInProfile:f.linkedInProfile}),k({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),u(!1)}catch(oe){k({title:"Error",description:"Failed to update profile",status:"error",duration:3e3,isClosable:!0}),console.error("Error updating profile:",oe)}finally{S(!1)}},$=()=>b.jsxs(gr,{spacing:4,align:"stretch",w:"100%",children:[b.jsx(sr,{direction:"column",align:"center",gap:2,children:b.jsx(et,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname})}),b.jsxs(gr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[b.jsxs(sr,{direction:"column",children:[b.jsx(et,{color:"gray.400",fontSize:"sm",children:"Company"}),b.jsx(et,{children:i.companyName||"Not specified"})]}),b.jsxs(sr,{direction:"column",children:[b.jsx(et,{color:"gray.400",fontSize:"sm",children:"Full Name"}),b.jsx(et,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),b.jsxs(sr,{direction:"column",children:[b.jsx(et,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),b.jsx(et,{children:i.linkedInProfile||"Not specified"})]})]}),b.jsx(Ar,{onClick:()=>u(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),X=()=>b.jsxs(gr,{spacing:4,align:"stretch",w:"100%",children:[b.jsxs(kn,{children:[b.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"Nickname"}),b.jsx(pr,{ref:L,name:"Nickname",value:f.Nickname,onChange:B,onFocus:()=>{I(!0),Wd(!0)},placeholder:"Enter nickname",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(kn,{children:[b.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"Company Name"}),b.jsx(pr,{name:"companyName",value:f.companyName,onChange:B,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(sr,{gap:4,children:[b.jsxs(kn,{children:[b.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"First Name"}),b.jsx(pr,{name:"firstName",value:f.firstName,onChange:B,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(kn,{children:[b.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"Last Name"}),b.jsx(pr,{name:"lastName",value:f.lastName,onChange:B,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),b.jsxs(kn,{children:[b.jsx(Qn,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),b.jsx(pr,{name:"linkedInProfile",value:f.linkedInProfile,onChange:B,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),b.jsxs(sr,{gap:2,justify:"flex-end",mt:2,children:[b.jsx(Ar,{onClick:()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),u(!1)},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),b.jsx(Ar,{onClick:q,colorScheme:"blue",size:"sm",isLoading:E,children:"Save Changes"})]})]});return b.jsxs(hc,{isOpen:n,onClose:F,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[b.jsx(dc,{backdropFilter:"blur(10px)"}),b.jsxs(pc,{bg:"gray.800",color:"white",children:[b.jsx(Hu,{children:"Profile"}),b.jsx(cl,{}),b.jsx(uc,{pb:6,children:b.jsxs(gr,{spacing:6,children:[b.jsx(Wu,{src:a,size:"2xl",borderRadius:"full"}),l?X():$()]})})]})]})},aO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},Q9e=()=>{const{user:n,updateUser:e}=D.useContext(ul),[i,a]=D.useState(!0),{isOpen:l,onOpen:u,onClose:f}=gp();D.useEffect(()=>{const S=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(S)},[]);const _=()=>{f(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null;return i?null:b.jsx(sr,{align:"center",gap:"4",children:n?b.jsxs(b.Fragment,{children:[b.jsx(J9e,{isOpen:l,onClose:_,user:n,profileImageUrl:E}),b.jsxs(rN,{children:[b.jsx(iN,{as:Xe,cursor:"pointer",children:b.jsx(sr,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:b.jsxs(sr,{align:"center",gap:"3",children:[b.jsx(Xe,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:b.jsx(Wu,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),b.jsx(et,{color:"white",fontWeight:"medium",children:n.Nickname}),b.jsx(Xe,{display:"flex",alignItems:"center",height:"28px",children:b.jsx(tze,{color:"white",w:4,h:4})})]})})}),b.jsx($l,{children:b.jsxs(sN,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[b.jsxs(Xe,{p:4,display:"flex",alignItems:"center",gap:3,children:[b.jsx(Wu,{src:E,size:"md",borderRadius:"full"}),b.jsx(et,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),b.jsx(uo,{borderColor:"gray.700"}),b.jsx(Tg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),b.jsx(Tg,{onClick:u,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),b.jsx(uo,{borderColor:"gray.700"}),b.jsx(Tg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),b.jsx(Tg,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:b.jsx(L3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):b.jsxs(b.Fragment,{children:[b.jsx(zN,{mode:"button",label:"Register",buttonProps:{...aO,width:["100%","auto"]},customButton:b.jsxs(Ar,{...aO,children:[b.jsx(Xe,{as:"span",fontSize:"xl",children:""}),"Register"]})}),b.jsx(GN,{mode:"button",label:"Sign In",buttonProps:{...aO,width:["100%","auto"]},customButton:b.jsxs(Ar,{...aO,children:[b.jsx(Xe,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},Gae=({transparent:n=!1})=>{const{isOpen:e,onToggle:i}=gp(),a=o2e({base:!0,md:!1});return b.jsx(Xe,{as:"header",py:4,boxShadow:n?"none":"sm",bg:n?"rgba(26, 32, 44, 0.2)":"gray.800",backdropFilter:n?"blur(5px)":"none",position:n?"absolute":"relative",width:"100%",zIndex:"10",children:b.jsxs(Wl,{maxW:"container.xl",children:[b.jsxs(sr,{justify:"space-between",align:"center",children:[b.jsx(Lu,{to:"/",children:b.jsx(Va,{src:"/SpaceEmblem.png",alt:"Space Emblem",h:"40px",filter:"brightness(0) invert(1)",fallbackSrc:"https://placehold.co/150x40?text=Logo"})}),!a&&b.jsxs(ui,{spacing:8,color:"white",position:"absolute",left:"50%",transform:"translateX(-50%)",children:[b.jsx(ho,{as:Lu,to:"/",fontWeight:"medium",children:"Home"}),b.jsx(ho,{as:Lu,to:"/spaces",fontWeight:"medium",children:"Spaces"}),b.jsx(ho,{as:Lu,to:"/about",fontWeight:"medium",children:"About"})]}),a&&b.jsx(Ys,{onClick:i,icon:e?b.jsx(pae,{w:3,h:3}):b.jsx(fae,{w:5,h:5}),variant:"ghost",color:"white","aria-label":"Toggle Navigation"}),b.jsx(Xe,{children:b.jsx(FR,{children:b.jsx(BR,{children:b.jsx(Q9e,{})})})})]}),b.jsx(One,{in:e,animateOpacity:!0,children:b.jsx(Xe,{pt:4,pb:4,display:{md:"none"},children:b.jsxs(tl,{spacing:4,color:"white",children:[b.jsx(ho,{as:Lu,to:"/",fontWeight:"medium",children:"Home"}),b.jsx(ho,{as:Lu,to:"/spaces",fontWeight:"medium",children:"Spaces"}),b.jsx(ho,{as:Lu,to:"/about",fontWeight:"medium",children:"About"})]})})})]})})},Hae=()=>{const n=new Date().getFullYear();return b.jsx(Xe,{as:"footer",bg:"gray.50",py:10,children:b.jsx(Wl,{maxW:"container.xl",children:b.jsxs(tl,{direction:{base:"column",md:"row"},spacing:4,justify:"space-between",align:{base:"center",md:"center"},children:[b.jsxs(et,{children:[" ",n," Disruptive Spaces. All rights reserved."]}),b.jsxs(ui,{spacing:4,children:[b.jsx(ho,{href:"https://twitter.com/disruptivespaces",isExternal:!0,children:b.jsx(Dn,{as:Nae,boxSize:5})}),b.jsx(ho,{href:"https://linkedin.com/company/disruptive-spaces",isExternal:!0,children:b.jsx(Dn,{as:HN,boxSize:5})}),b.jsx(ho,{href:"https://github.com/disruptive-spaces",isExternal:!0,children:b.jsx(Dn,{as:kae,boxSize:5})})]})]})})})},cO="thepotato",iZ=n=>({id:n,name:n==="sample1"?"Conference Room":n==="sample2"?"Art Gallery":"Social Lounge",description:n==="sample1"?"Professional virtual meeting space for team collaboration.":n==="sample2"?"Immersive gallery for showcasing digital art and exhibitions.":"Casual environment for social gatherings and networking events.",visibility:"public",createdAt:{toDate:()=>new Date},createdBy:{displayName:"Demo User"}}),lO={id:"thepotato",name:"Spaces Metaverse",description:"Welcome to the Spaces Metaverse! This is our first test space where you can explore and interact with the virtual environment. We plan to add more functionality as we go. Please check back soon for updates.",visibility:"public",createdAt:{toDate:()=>new Date("2025-03-15")},createdBy:{displayName:"Disruptive Live"},category:"development"},sZ="seoContent";function Z9e(){const n=window.fetch;return window.fetch=function(e,i){if(typeof e=="string"&&e.includes("firebasestorage.googleapis.com")){console.log("Intercepting Firebase Storage URL:",e);const a=e.replace("https://firebasestorage.googleapis.com","/firebase-proxy");return console.log("Using proxy URL:",a),n(a,i)}return n(e,i)},()=>{window.fetch=n}}function eGe(){var U,L;console.log("SpacePage component rendering");const{spaceSlug:n}=MZ();console.log("Space slug from URL:",n);const[e,i]=D.useState(null),[a,l]=D.useState(!0),[u,f]=D.useState(null),[_,E]=D.useState(null),S=D.useRef(null),[w,I]=D.useState(null);if(D.useEffect(()=>{async function F(){try{if(l(!0),console.log("Fetching space with slug:",n),n==="the-potato-website"){console.log("Using hardcoded potato space data"),i(lO),E(cO),l(!1);return}const B=qi(ri,"spaces",n),q=await cc(B);if(q.exists()){console.log("Found space by ID:",q.id);const $={id:q.id,...q.data()};i($),E(q.id)}else{console.log("Space not found by ID, checking by slug...");try{const $=cR(Xf(ri,"spaces"),Pk("slug","==",n)),X=await Gg($);if(X.empty)if(n.startsWith("sample")){console.log("Using sample space data");const oe=iZ(n);i(oe),E(n)}else console.log("Space not found by slug either"),f("Space not found");else{const oe=X.docs[0];console.log("Found space by slug:",oe.id);const re={id:oe.id,...oe.data()};i(re),E(oe.id)}}catch($){console.error("Error querying by slug:",$),f("Failed to load space")}}}catch(B){if(console.error("Error fetching space:",B),B.code==="permission-denied")if(n.startsWith("sample")){console.log("Using sample space data due to Firebase permissions issue");const q=iZ(n);i(q),E(n)}else n==="the-potato-website"?(console.log("Using special potato space data due to permissions issue"),i(lO),E(cO)):f("Failed to load space - Permission denied");else f("Failed to load space")}finally{l(!1)}}n?F():(f("Invalid space URL"),l(!1))},[n]),D.useEffect(()=>(console.log("Setting up Firebase Storage proxy"),Z9e()),[]),D.useEffect(()=>{async function F(){if(n)try{if(console.log("Fetching SEO data for:",n),n==="the-potato-website"){console.log("Using hardcoded data for SEO (potato website)"),I({title:lO.name,description:lO.description,image:""});try{const $=qi(ri,sZ,n),X=await cc($);if(X.exists())console.log("Found SEO data from collection:",X.data()),I(oe=>({title:X.data().title||oe.title,description:X.data().description||oe.description,image:X.data().image||oe.image}));else{const oe=qi(ri,"spaces",cO),re=await cc(oe);if(re.exists()){const pe=re.data();console.log("Found space data for SEO:",pe),I(te=>({title:pe.name||te.title,description:pe.description||te.description,image:pe.imageUrl||te.image}))}}}catch($){console.error("Error fetching additional SEO data:",$)}return}const B=qi(ri,sZ,n),q=await cc(B);q.exists()?(console.log("Found SEO data:",q.data()),I(q.data())):e&&I({title:e.name,description:e.description,image:e.imageUrl})}catch(B){console.error("Error fetching SEO data:",B)}}F()},[n,e]),a)return b.jsx(Xe,{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",children:b.jsx(la,{size:"xl",color:"brand.500",thickness:"4px"})});if(u)return b.jsx(Wl,{maxW:"container.xl",py:10,children:b.jsxs(Vu,{status:"error",borderRadius:"md",children:[b.jsx(ju,{}),b.jsx(WC,{mr:2,children:"Error!"}),b.jsx(zC,{children:u})]})});const k=n==="the-potato-website"?cO:_;return b.jsxs(Xe,{bg:"#1a1a1a",color:"white",minH:"100vh",children:[b.jsxs(Q0,{children:[b.jsxs("title",{children:[(w==null?void 0:w.title)||(e==null?void 0:e.name)||"Space"," | Disruptive Spaces"]}),b.jsx("meta",{name:"description",content:(w==null?void 0:w.description)||(e==null?void 0:e.description)||"Explore this virtual space"}),(w==null?void 0:w.image)&&b.jsx("meta",{property:"og:image",content:w.image})]}),b.jsx(Gae,{}),b.jsxs(Wl,{maxW:"container.xl",py:8,mt:"60px",children:[b.jsx(Xe,{borderRadius:"md",overflow:"hidden",mb:8,height:"70vh",position:"relative",border:"1px solid rgba(255, 255, 255, 0.1)",ref:S,children:b.jsx("div",{id:"webgl-root","data-space-id":k,style:{display:"block",width:"100%",height:"100%",position:"relative"},children:k&&b.jsx(FR,{children:b.jsx(BR,{children:b.jsx($N,{spaceID:k})})})})}),b.jsxs(Xe,{mb:6,children:[b.jsx(br,{as:"h1",size:"2xl",mb:2,children:(w==null?void 0:w.title)||(e==null?void 0:e.name)||"Space"}),b.jsxs(ui,{spacing:2,children:[b.jsx(et,{color:"#4fd1c5",children:(U=e==null?void 0:e.createdBy)==null?void 0:U.displayName}),b.jsx(et,{color:"gray.500",children:"|"}),b.jsx(et,{color:"gray.500",children:(e==null?void 0:e.visibility)==="public"?"Public Space":"Private Space"})]})]}),b.jsxs(sr,{gap:8,direction:{base:"column",lg:"row"},children:[b.jsxs(Xe,{flex:"2",children:[b.jsx(et,{fontSize:"lg",mb:6,children:(w==null?void 0:w.description)||(e==null?void 0:e.description)||"No description available."}),b.jsx(uo,{borderColor:"gray.700",mb:6})]}),b.jsxs(Xe,{flex:"1",bg:"#2D2D2D",p:6,borderRadius:"md",border:"1px solid rgba(255, 255, 255, 0.1)",children:[b.jsx(br,{as:"h2",size:"lg",mb:6,children:"Information"}),b.jsxs(gr,{align:"stretch",spacing:4,children:[b.jsxs(Xe,{children:[b.jsx(et,{color:"gray.400",children:"Released:"}),b.jsx(et,{children:e!=null&&e.createdAt?new Date(e.createdAt.toDate()).toLocaleDateString():"15/3/2025"})]}),b.jsxs(Xe,{children:[b.jsx(et,{color:"gray.400",children:"Category:"}),b.jsx(Xe,{mt:2,children:b.jsx(zd,{bg:"#2D2D2D",color:"white",px:3,py:1,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.2)",children:(e==null?void 0:e.category)||"development"})})]}),b.jsxs(Xe,{children:[b.jsx(et,{color:"gray.400",children:"Creators:"}),b.jsx(Xe,{mt:2,children:b.jsx(et,{children:((L=e==null?void 0:e.createdBy)==null?void 0:L.displayName)||"Disruptive Live"})})]})]})]})]})]}),b.jsx(Hae,{})]})}const tGe="modulepreload",nGe=function(n,e){return new URL(n,e).href},oZ={},JU=function(e,i,a){let l=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(S=>{if(S=nGe(S,a),S in oZ)return;oZ[S]=!0;const w=S.endsWith(".css"),I=w?'[rel="stylesheet"]':"";if(!!a)for(let L=f.length-1;L>=0;L--){const F=f[L];if(F.href===S&&(!w||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${S}"]${I}`))return;const U=document.createElement("link");if(U.rel=w?"stylesheet":tGe,w||(U.as="script"),U.crossOrigin="",U.href=S,E&&U.setAttribute("nonce",E),document.head.appendChild(U),w)return new Promise((L,F)=>{U.addEventListener("load",L),U.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${S}`)))})}))}function u(f){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=f,window.dispatchEvent(_),!_.defaultPrevented)throw f}return l.then(f=>{for(const _ of f||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})};async function rGe(n){let e;try{switch(n){case"default":e=await JU(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:e=await JU(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return e.default}catch(i){return be.error("Failed to load theme:",i),e=await JU(()=>import("./index.v0.9.22.js"),[],import.meta.url),e.default}}function aZ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,u]=D.useState(null);return D.useEffect(()=>{rGe(i).then(u)},[]),l?b.jsx(Ane,{theme:l,children:b.jsx(FR,{children:b.jsx(BR,{children:b.jsx($N,{spaceID:e})})})}):b.jsx("div",{children:"Loading theme..."})};try{AZ.createRoot(n).render(b.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",aZ):aZ());const uO="thepotato",cZ="SpacesMetaverse_SDK",dO={id:"thepotato",name:"Spaces Metaverse",description:"Welcome to the Spaces Metaverse! This is our first test space where you can explore and interact with the virtual environment.",visibility:"public",createdAt:{toDate:()=>new Date("2025-03-15")},createdBy:{displayName:"Disruptive Live"},category:"development",webglBuildId:"fassssss"},iGe=()=>{const{spaceSlug:n}=MZ(),[e,i]=D.useState(null),[a,l]=D.useState(!0),[u,f]=D.useState(null),[_,E]=D.useState(null),[S,w]=D.useState(null),I=D.useRef(null),k=n==="the-potato-website";D.useEffect(()=>{be.log(`EmbedPage: Initializing with slug: ${n}`),I.current&&(I.current.style.width="100%",I.current.style.height="100vh",I.current.style.position="relative",I.current.style.overflow="hidden"),U()},[n]);const U=async()=>{try{if(be.log(`EmbedPage: Fetching space data for slug: ${n}`),l(!0),k){be.log("EmbedPage: Using hardcoded potato space data"),i(dO),w(uO),E(dO.webglBuildId||cZ),l(!1);return}const L=qi(ri,"spaces",n),F=await cc(L);if(F.exists()){be.log(`EmbedPage: Found space by ID: ${F.id}`);const B={id:F.id,...F.data()};i(B),w(F.id),B.webglBuildId?(be.log(`EmbedPage: Using webglBuildId from space: ${B.webglBuildId}`),E(B.webglBuildId)):(be.log(`EmbedPage: No webglBuildId found, using space ID as fallback: ${B.id}`),E(B.id))}else{be.log("EmbedPage: Space not found by ID, checking by slug...");try{const B=cR(Xf(ri,"spaces"),Pk("slug","==",n)),q=await Gg(B);if(q.empty)be.error(`EmbedPage: Space not found for slug: ${n}`),f("Space not found");else{const $=q.docs[0];be.log(`EmbedPage: Found space by slug: ${$.id}`);const X={id:$.id,...$.data()};i(X),w($.id),X.webglBuildId?(be.log(`EmbedPage: Using webglBuildId from space: ${X.webglBuildId}`),E(X.webglBuildId)):(be.log(`EmbedPage: No webglBuildId found, using space ID as fallback: ${X.id}`),E(X.id))}}catch(B){be.error("EmbedPage: Error querying by slug:",B),f("Failed to load space")}}l(!1)}catch(L){be.error("EmbedPage: Error fetching space:",L),L.code==="permission-denied"&&k?(be.log("EmbedPage: Using special potato space data due to permissions issue"),i(dO),w(uO),E(dO.webglBuildId||cZ)):f(`Error loading space: ${L.message}`),l(!1)}};return a?b.jsx(sr,{width:"100%",height:"100vh",justifyContent:"center",alignItems:"center",bg:"gray.900",children:b.jsx(la,{size:"xl",color:"blue.400"})}):u?b.jsxs(sr,{width:"100%",height:"100vh",justifyContent:"center",alignItems:"center",bg:"gray.900",color:"white",flexDirection:"column",p:4,children:[b.jsx(et,{fontSize:"xl",fontWeight:"bold",mb:4,children:u}),b.jsx(et,{children:"The requested space could not be loaded. Please check the URL and try again."})]}):b.jsx(Xe,{width:"100%",height:"100vh",position:"relative",overflow:"hidden",ref:I,children:b.jsx("div",{id:"webgl-root","data-space-id":k?uO:S||_,style:{display:"block",width:"100%",height:"100%",position:"relative"},children:(S||_)&&b.jsx(FR,{children:b.jsx(BR,{children:b.jsx($N,{spaceID:k?uO:S||_})})})})})};function sGe(n){return or({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M4 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1ZM4 5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM7.5 5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1ZM4.5 8a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Zm2.5.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1Zm3.5-.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1Z"}},{tag:"path",attr:{d:"M2 1a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V1Zm11 0H3v14h3v-2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V15h3V1Z"}}]})(n)}function oGe(n){return or({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"}}]})(n)}function aGe(n){return or({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"}}]})(n)}function cGe(n){return or({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"}}]})(n)}function lGe(n){return or({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h6zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z"}},{tag:"path",attr:{d:"M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"}}]})(n)}function uGe(n){return or({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"}}]})(n)}function dGe(n){return or({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"}}]})(n)}const hGe=()=>{const{hasCopied:n,onCopy:e}=ISe("hello@disruptivespaces.com"),i=ll(),[a,l]=D.useState({name:"",email:"",message:""}),[u,f]=D.useState(!1),[_,E]=D.useState({}),S=k=>{const{name:U,value:L}=k.target;l(F=>({...F,[U]:L})),_[U]&&E(F=>({...F,[U]:""}))},w=()=>{const k={};return a.name.trim()||(k.name="Name is required"),a.email.trim()?/\S+@\S+\.\S+/.test(a.email)||(k.email="Email is invalid"):k.email="Email is required",a.message.trim()||(k.message="Message is required"),E(k),Object.keys(k).length===0},I=async k=>{if(k.preventDefault(),!!w()){f(!0);try{await f8e(Xf(ri,"contactSubmissions"),{name:a.name,email:a.email,message:a.message,timestamp:g8e(),status:"new",recipient:"andrew@disruptive.live"}),i({title:"Message sent!",description:"We've received your message and will get back to you soon.",status:"success",duration:5e3,isClosable:!0}),l({name:"",email:"",message:""})}catch(U){console.error("Error submitting contact form:",U),i({title:"Error",description:"There was an error sending your message. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{f(!1)}}};return b.jsxs(b.Fragment,{children:[b.jsxs(Q0,{children:[b.jsx("title",{children:"Contact Us - Disruptive Spaces"}),b.jsx("meta",{name:"description",content:"Get in touch with the Disruptive Spaces team for inquiries, demos, or support."})]}),b.jsx(Xe,{as:"section",py:20,children:b.jsxs(Wl,{maxW:"6xl",children:[b.jsxs(tl,{spacing:{base:8,md:10},children:[b.jsx(br,{fontWeight:600,fontSize:{base:"3xl",sm:"4xl",md:"5xl"},lineHeight:"110%",textAlign:"center",children:"Get in Touch"}),b.jsx(et,{color:"gray.500",maxW:"3xl",textAlign:"center",fontSize:"xl",mx:"auto",children:"Have questions about our platform? Want to schedule a demo? We'd love to hear from you."})]}),b.jsxs(Ky,{columns:{base:1,md:2},spacing:10,mt:10,children:[b.jsxs(tl,{spacing:8,children:[b.jsx(br,{fontSize:"2xl",fontWeight:"500",mb:5,children:"Contact Information"}),b.jsxs(tl,{spacing:4,children:[b.jsxs(sr,{align:"center",children:[b.jsx(Dn,{as:oGe,mr:2,color:"brand.500"}),b.jsx(et,{fontWeight:"medium",children:"andrew@disruptive.live"}),b.jsx(up,{label:n?"Email Copied!":"Copy Email",closeOnClick:!1,hasArrow:!0,children:b.jsx(Ys,{"aria-label":"Copy Email",variant:"ghost",size:"sm",fontSize:"lg",icon:b.jsx(dGe,{}),_hover:{bg:"brand.500",color:Of("white","gray.700")},onClick:e,ml:2})})]}),b.jsxs(sr,{align:"center",children:[b.jsx(Dn,{as:lGe,mr:2,color:"brand.500"}),b.jsx(et,{fontWeight:"medium",children:"+1 (555) 123-4567"})]}),b.jsxs(sr,{align:"center",children:[b.jsx(Dn,{as:sGe,mr:2,color:"brand.500"}),b.jsxs(et,{fontWeight:"medium",children:["Disruptive Spaces HQ",b.jsx("br",{}),"London, UK"]})]}),b.jsxs(sr,{align:"center",children:[b.jsx(Dn,{as:aGe,mr:2,color:"brand.500"}),b.jsx(et,{fontWeight:"medium",children:"Operating Hours: Monday-Friday, 9AM-6PM GMT"})]})]}),b.jsxs(tl,{direction:"row",spacing:6,mt:8,children:[b.jsx(QU,{label:"Twitter",href:"#",children:b.jsx(Nae,{})}),b.jsx(QU,{label:"LinkedIn",href:"#",children:b.jsx(HN,{})}),b.jsx(QU,{label:"GitHub",href:"#",children:b.jsx(kae,{})})]})]}),b.jsx(Xe,{bg:Of("white","gray.700"),borderRadius:"lg",p:8,color:Of("gray.700","whiteAlpha.900"),shadow:"base",children:b.jsxs(gr,{spacing:5,as:"form",onSubmit:I,children:[b.jsx(br,{fontSize:"2xl",fontWeight:"500",children:"Send us a message"}),b.jsxs(kn,{isRequired:!0,isInvalid:!!_.name,children:[b.jsx(Qn,{children:"Name"}),b.jsxs(A0,{children:[b.jsx(qy,{children:b.jsx(cGe,{})}),b.jsx(pr,{type:"text",name:"name",placeholder:"Your Name",value:a.name,onChange:S})]}),_.name&&b.jsx(Mu,{children:_.name})]}),b.jsxs(kn,{isRequired:!0,isInvalid:!!_.email,children:[b.jsx(Qn,{children:"Email"}),b.jsxs(A0,{children:[b.jsx(qy,{children:b.jsx(uGe,{})}),b.jsx(pr,{type:"email",name:"email",placeholder:"Your Email",value:a.email,onChange:S})]}),_.email&&b.jsx(Mu,{children:_.email})]}),b.jsxs(kn,{isRequired:!0,isInvalid:!!_.message,children:[b.jsx(Qn,{children:"Message"}),b.jsx(jd,{name:"message",placeholder:"Your Message",rows:6,resize:"none",value:a.message,onChange:S}),_.message&&b.jsx(Mu,{children:_.message})]}),b.jsx(Ar,{type:"submit",colorScheme:"brand",bg:"brand.500",color:"white",_hover:{bg:"brand.600"},width:"full",isLoading:u,loadingText:"Sending...",children:"Send Message"})]})})]})]})}),b.jsx(Xe,{as:"section",py:10,bg:Of("gray.50","gray.900"),children:b.jsxs(Wl,{maxW:"6xl",children:[b.jsx(br,{fontSize:"2xl",fontWeight:"500",mb:5,textAlign:"center",children:"Visit Our Office"}),b.jsx(Xe,{borderRadius:"lg",overflow:"hidden",height:"400px",width:"100%",position:"relative",children:b.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d19868.687200276698!2d-0.1365972346495695!3d51.50701470841451!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x487604ce3941eb1f%3A0x1a5b0945da5764f0!2sCity%20of%20Westminster%2C%20London%2C%20UK!5e0!3m2!1sen!2sus!4v1710894636826!5m2!1sen!2sus",width:"100%",height:"100%",style:{border:0},allowFullScreen:"",loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Office Location"})})]})})]})},QU=({children:n,label:e,href:i})=>b.jsx(up,{label:e,children:b.jsx(Ys,{bg:Of("blackAlpha.100","whiteAlpha.100"),borderRadius:"full",as:"a",href:i,target:"_blank","aria-label":e,icon:n,_hover:{bg:"brand.500",color:Of("white","gray.700")}})}),pGe=()=>{const[n,e]=D.useState({title:"About Spaces",description:"Learn about the Spaces platform, our vision, and how we empower virtual collaboration and connection.",tagline:"A platform for creating virtual spaces that bring people together.",whoWeAre:{title:"Who We Are",content:"We create metaverses that are simple, accessible, and limitless. Our platform is focused on ease of use, designed for everyone, and built for creativity and connection."},ourVision:{title:"Our Vision",content:"To empower everyone to build their own virtual spaces, tailored to their needs. Whether you need public or private options, fully customizable environments, our platform offers limitless possibilities."},whatWeOffer:{title:"What We Offer",content:"Open spaces for exploration, exclusive environments for privacy, and powerful tools to shape your world exactly as you imagine it."},howItWorks:{title:"How It Works",content:"Accessible on any device, our metaverses are easy to customize and share. No downloads required - everything runs seamlessly in web browsers with simple tools for building and sharing."},contactSection:{title:"Reach Out",intro:"Interested in learning more about our spaces? Have questions about how it works? We'd love to hear from you and help you get started on your journey.",callToAction:"Fill out the form and we'll get back to you as soon as possible."},images:{topImage:"/images/Space-office-example-2-min.jpg",bottomImage:"/images/Spaces-Office-example-min.jpg"}}),[i,a]=D.useState(!0),[l,u]=D.useState(!1),f=ll();D.useEffect(()=>{(async()=>{try{a(!0);const I=await A3("aboutpage");I&&e(I)}catch(I){console.error("Error fetching about page content:",I),f({title:"Error",description:"Failed to load about page content",status:"error",duration:5e3,isClosable:!0})}finally{a(!1)}})()},[f]);const _=w=>{const{name:I,value:k}=w.target;e(U=>({...U,[I]:k}))},E=(w,I,k)=>{e(U=>({...U,[w]:{...U[w],[I]:k}}))},S=async()=>{try{u(!0),await uae("aboutpage",n),f({title:"Success",description:"About page content updated successfully",status:"success",duration:3e3,isClosable:!0})}catch(w){console.error("Error updating about page content:",w),f({title:"Error",description:"Failed to update about page content",status:"error",duration:5e3,isClosable:!0})}finally{u(!1)}};return i?b.jsx(Xe,{p:4,textAlign:"center",children:b.jsx(la,{size:"xl"})}):b.jsx(Xe,{p:4,children:b.jsxs(gr,{spacing:6,align:"stretch",children:[b.jsx(br,{size:"md",children:"About Page Content"}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"SEO Settings"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Page Title"}),b.jsx(pr,{name:"title",value:n.title,onChange:_,placeholder:"Page title for SEO"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Description"}),b.jsx(jd,{name:"description",value:n.description,onChange:_,placeholder:"Meta description for SEO"})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Header"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Tagline"}),b.jsx(jd,{name:"tagline",value:n.tagline,onChange:_,placeholder:"Tagline that appears below the main heading"})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Images"}),b.jsxs(Ky,{columns:2,spacing:4,children:[b.jsxs(kn,{children:[b.jsx(Qn,{children:"Top Image Path"}),b.jsx(pr,{value:n.images.topImage,onChange:w=>E("images","topImage",w.target.value),placeholder:"/images/example.jpg"}),n.images.topImage&&b.jsx(Va,{src:n.images.topImage,alt:"Top image preview",mt:2,maxH:"100px",objectFit:"cover"})]}),b.jsxs(kn,{children:[b.jsx(Qn,{children:"Bottom Image Path"}),b.jsx(pr,{value:n.images.bottomImage,onChange:w=>E("images","bottomImage",w.target.value),placeholder:"/images/example.jpg"}),n.images.bottomImage&&b.jsx(Va,{src:n.images.bottomImage,alt:"Bottom image preview",mt:2,maxH:"100px",objectFit:"cover"})]})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Who We Are Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Title"}),b.jsx(pr,{value:n.whoWeAre.title,onChange:w=>E("whoWeAre","title",w.target.value),placeholder:"Section title"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Content"}),b.jsx(jd,{value:n.whoWeAre.content,onChange:w=>E("whoWeAre","content",w.target.value),placeholder:"Section content",rows:4})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Our Vision Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Title"}),b.jsx(pr,{value:n.ourVision.title,onChange:w=>E("ourVision","title",w.target.value),placeholder:"Section title"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Content"}),b.jsx(jd,{value:n.ourVision.content,onChange:w=>E("ourVision","content",w.target.value),placeholder:"Section content",rows:4})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"What We Offer Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Title"}),b.jsx(pr,{value:n.whatWeOffer.title,onChange:w=>E("whatWeOffer","title",w.target.value),placeholder:"Section title"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Content"}),b.jsx(jd,{value:n.whatWeOffer.content,onChange:w=>E("whatWeOffer","content",w.target.value),placeholder:"Section content",rows:4})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"How It Works Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Title"}),b.jsx(pr,{value:n.howItWorks.title,onChange:w=>E("howItWorks","title",w.target.value),placeholder:"Section title"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Content"}),b.jsx(jd,{value:n.howItWorks.content,onChange:w=>E("howItWorks","content",w.target.value),placeholder:"Section content",rows:4})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Contact Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Title"}),b.jsx(pr,{value:n.contactSection.title,onChange:w=>E("contactSection","title",w.target.value),placeholder:"Section title"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Introduction"}),b.jsx(jd,{value:n.contactSection.intro,onChange:w=>E("contactSection","intro",w.target.value),placeholder:"Introduction text",rows:3})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Call to Action"}),b.jsx(jd,{value:n.contactSection.callToAction,onChange:w=>E("contactSection","callToAction",w.target.value),placeholder:"Call to action text",rows:2})]})]}),b.jsx(Ar,{colorScheme:"blue",onClick:S,isLoading:l,loadingText:"Saving",mt:4,children:"Save Changes"})]})})},lZ=()=>{const[n,e]=D.useState({title:"",description:"",heroHeading:"",videoSrc:"",videoType:"local",missionHeading:"",missionTitle:"",missionPoints:[],learnMoreText:""}),[i,a]=D.useState(!0),[l,u]=D.useState(!1),f=ll();D.useEffect(()=>{(async()=>{var B;try{a(!0);const q=await A3("homepage");if(q){const $={...q,videoType:(B=q.videoSrc)!=null&&B.includes("vimeo.com")?"vimeo":"local"};e($)}}catch(q){console.error("Error fetching homepage content:",q),f({title:"Error",description:"Failed to load homepage content",status:"error",duration:5e3,isClosable:!0})}finally{a(!1)}})()},[f]);const _=F=>{const{name:B,value:q}=F.target;e($=>({...$,[B]:q}))},E=F=>{e(B=>({...B,videoType:F,videoSrc:""}))},S=(F,B)=>{const q=[...n.missionPoints];q[F]=B,e($=>({...$,missionPoints:q}))},w=()=>{e(F=>({...F,missionPoints:[...F.missionPoints,""]}))},I=F=>{const B=[...n.missionPoints];B.splice(F,1),e(q=>({...q,missionPoints:B}))},k=async()=>{try{u(!0);const{videoType:F,...B}=n;await uae("homepage",B),f({title:"Success",description:"Homepage content updated successfully",status:"success",duration:3e3,isClosable:!0})}catch(F){console.error("Error updating homepage content:",F),f({title:"Error",description:"Failed to update homepage content",status:"error",duration:5e3,isClosable:!0})}finally{u(!1)}},L=(F=>{if(!F||!F.includes("vimeo.com"))return null;const B=/(?:vimeo\.com\/)(\d+)(?:\?.*)?$/,q=/(?:player\.vimeo\.com\/video\/)(\d+)(?:\?.*)?$/,$=F.match(B),X=F.match(q);return $?$[1]:X?X[1]:null})(n.videoSrc);return i?b.jsx(Xe,{p:4,textAlign:"center",children:b.jsx(la,{size:"xl"})}):b.jsx(Xe,{p:4,children:b.jsxs(gr,{spacing:6,align:"stretch",children:[b.jsx(br,{size:"md",children:"Homepage Content"}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"SEO Settings"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Page Title"}),b.jsx(pr,{name:"title",value:n.title,onChange:_,placeholder:"Page title for SEO"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Description"}),b.jsx(jd,{name:"description",value:n.description,onChange:_,placeholder:"Meta description for SEO"})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Hero Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Heading"}),b.jsx(pr,{name:"heroHeading",value:n.heroHeading,onChange:_,placeholder:"Main hero heading"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Video Type"}),b.jsx(tie,{onChange:E,value:n.videoType,mb:3,children:b.jsxs(tl,{direction:"row",children:[b.jsx(QV,{value:"local",children:"Local Video File"}),b.jsx(QV,{value:"vimeo",children:"Vimeo Video"})]})}),n.videoType==="local"?b.jsxs(b.Fragment,{children:[b.jsx(Qn,{children:"Local Video Path"}),b.jsx(pr,{name:"videoSrc",value:n.videoSrc,onChange:_,placeholder:"/videos/example.mp4"}),b.jsx(GC,{children:"Path to video file in the public directory"})]}):b.jsxs(b.Fragment,{children:[b.jsx(Qn,{children:"Vimeo Video URL"}),b.jsx(pr,{name:"videoSrc",value:n.videoSrc,onChange:_,placeholder:"https://player.vimeo.com/video/123456789?h=31a7abd0d0"}),b.jsx(GC,{children:"Full Vimeo video URL (e.g., https://player.vimeo.com/video/123456789?h=31a7abd0d0 or https://vimeo.com/123456789)"}),L&&b.jsxs(Xe,{mt:2,p:2,borderWidth:"1px",borderRadius:"md",children:[b.jsxs(et,{fontSize:"sm",mb:1,children:["Preview Vimeo ID: ",L]}),b.jsx(et,{fontSize:"sm",color:"green.500",children:"Video recognized successfully. It will autoplay muted when viewed."})]})]})]})]}),b.jsx(uo,{}),b.jsxs(Xe,{children:[b.jsx(br,{size:"sm",mb:3,children:"Mission Section"}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Subtitle"}),b.jsx(pr,{name:"missionHeading",value:n.missionHeading,onChange:_,placeholder:"Mission subtitle"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Title"}),b.jsx(pr,{name:"missionTitle",value:n.missionTitle,onChange:_,placeholder:"Mission title"})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Mission Points"}),b.jsxs(gr,{spacing:2,align:"stretch",children:[n.missionPoints.map((F,B)=>b.jsxs(ui,{children:[b.jsx(pr,{value:F,onChange:q=>S(B,q.target.value),placeholder:`Point ${B+1}`}),b.jsx(Ys,{"aria-label":"Remove point",icon:b.jsx(eze,{}),colorScheme:"red",onClick:()=>I(B)})]},B)),b.jsx(Ar,{leftIcon:b.jsx(QWe,{}),onClick:w,size:"sm",children:"Add Point"})]})]}),b.jsxs(kn,{mb:3,children:[b.jsx(Qn,{children:"Learn More Text"}),b.jsx(pr,{name:"learnMoreText",value:n.learnMoreText,onChange:_,placeholder:"Text for learn more link"})]})]}),b.jsx(Ar,{colorScheme:"blue",onClick:k,isLoading:l,loadingText:"Saving",mt:4,children:"Save Changes"})]})})},fGe=()=>{const[n,e]=D.useState(!1),[i,a]=D.useState(!0),l=yN();return D.useEffect(()=>{(async()=>{try{if(!l.currentUser){e(!1),a(!1);return}const _=(await l.currentUser.getIdTokenResult()).claims.groups||[];e(_.includes("disruptiveAdmin"))}catch(f){console.error("Error checking admin status:",f),e(!1)}finally{a(!1)}})()},[l.currentUser]),{isAdmin:n,loading:i}},mGe=()=>{const[n,e]=D.useState("homepage"),{isAdmin:i,loading:a}=fGe(),l=$j(),u=Of("gray.50","gray.700"),f=Of("gray.200","gray.600");if(D.useEffect(()=>{!a&&!i&&l("/")},[i,a,l]),a)return b.jsx(Wl,{maxW:"container.xl",py:10,children:b.jsx(sr,{justify:"center",align:"center",h:"50vh",children:b.jsx(la,{size:"xl"})})});if(!i)return b.jsx(Wl,{maxW:"container.xl",py:10,children:b.jsxs(Vu,{status:"error",children:[b.jsx(ju,{}),"You don't have permission to access this page"]})});const _=()=>{switch(n){case"homepage":return b.jsx(lZ,{});case"about":return b.jsx(pGe,{});default:return b.jsx(lZ,{})}};return b.jsxs(b.Fragment,{children:[b.jsx(Q0,{children:b.jsx("title",{children:"Website Content Manager"})}),b.jsxs(Wl,{maxW:"container.xl",py:10,children:[b.jsx(br,{as:"h1",mb:6,children:"Website Content Manager"}),b.jsxs(eN,{templateColumns:"250px 1fr",gap:6,children:[b.jsx(YC,{children:b.jsxs(gr,{align:"stretch",spacing:0,bg:u,borderRadius:"md",borderWidth:"1px",borderColor:f,overflow:"hidden",children:[b.jsx(Ar,{variant:"ghost",justifyContent:"flex-start",py:4,borderBottomWidth:"1px",borderRadius:"0",colorScheme:n==="homepage"?"blue":"gray",bg:n==="homepage"?"blue.50":"transparent",onClick:()=>e("homepage"),children:"Homepage"}),b.jsx(Ar,{variant:"ghost",justifyContent:"flex-start",py:4,borderRadius:"0",colorScheme:n==="about"?"blue":"gray",bg:n==="about"?"blue.50":"transparent",onClick:()=>e("about"),children:"About Page"})]})}),b.jsx(YC,{bg:"white",p:6,borderRadius:"md",borderWidth:"1px",borderColor:f,children:_()})]})]})]})};function gGe(){const e=H0().pathname==="/";return b.jsxs(sr,{direction:"column",minH:"100vh",children:[b.jsx(Gae,{transparent:e}),b.jsx(Xe,{as:"main",flex:"1",children:b.jsx(Ive,{})}),b.jsx(Hae,{})]})}const _Ge=({children:n})=>{const[e,i]=D.useState(!1),[a,l]=D.useState(!0),u=yN();return D.useEffect(()=>{const f=Zie(u,_=>{i(!!_),l(!1)});return()=>f()},[u]),a?null:e?n:b.jsx(Rve,{to:"/",replace:!0})};function yGe(){return b.jsx(Xe,{minH:"100vh",children:b.jsxs(Pve,{children:[b.jsxs(qh,{path:"/",element:b.jsx(gGe,{}),children:[b.jsx(qh,{index:!0,element:b.jsx(YWe,{})}),b.jsx(qh,{path:"about",element:b.jsx(XWe,{})}),b.jsx(qh,{path:"spaces",element:b.jsx(sze,{})}),b.jsx(qh,{path:"contact",element:b.jsx(hGe,{})}),b.jsx(qh,{path:"admin",children:b.jsx(qh,{path:"website",element:b.jsx(_Ge,{children:b.jsx(mGe,{})})})})]}),b.jsx(qh,{path:"/w/:spaceSlug",element:b.jsx(eGe,{})}),b.jsx(qh,{path:"/embed/:spaceSlug",element:b.jsx(iGe,{})})]})})}const EGe=console.error;console.error=function(n,...e){typeof n=="string"&&n.includes("Root element 'webgl-root' not found")||EGe.apply(console,[n,...e])};window.Webflow&&window.Webflow.destroy();window.Webflow&&window.Webflow.ready();window.Webflow&&window.Webflow.require("ix2").init();document.dispatchEvent(new Event("readystatechange"));AZ.createRoot(document.getElementById("root")).render(b.jsx(mr.StrictMode,{children:b.jsx(Ane,{theme:KWe,children:b.jsx(fie,{children:b.jsx(Mve,{children:b.jsx(FR,{children:b.jsx(BR,{children:b.jsx($We,{children:b.jsx(yGe,{})})})})})})})}));export{SGe as a,fbe as b,Li as c,bGe as d,Rxe as e,bbe as i,Cbe as m};
//# sourceMappingURL=main.v0.9.22.js.map
